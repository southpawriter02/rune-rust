# v0.0.9a Implementation Plan: Monster Definitions

**Version:** 0.0.9a
**Parent:** v0.0.9 (Monster Variety & Loot)
**Prerequisites:** v0.0.8 Complete (Experience & Leveling), v0.0.6b (AIBehavior enum)
**Design Specification:** [v0.0.9a-design-specification.md](v0.0.9a-design-specification.md)
**Status:** Ready for Implementation
**Target Tests:** ~317 -> ~335 (+18 tests)

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Dependencies from Previous Phases](#dependencies-from-previous-phases)
3. [Current System Analysis](#current-system-analysis)
4. [Detailed Implementation](#detailed-implementation)
   - [Domain Layer](#domain-layer)
   - [Application Layer](#application-layer)
   - [Infrastructure Layer](#infrastructure-layer)
   - [Presentation Layer](#presentation-layer)
5. [Configuration](#configuration)
6. [Flow Diagrams](#flow-diagrams)
7. [Testing Strategy](#testing-strategy)
8. [Logging Strategy](#logging-strategy)
9. [Implementation Checklist](#implementation-checklist)
10. [Acceptance Criteria](#acceptance-criteria)
11. [Risk Assessment](#risk-assessment)
12. [File Summary](#file-summary)

---

## Executive Summary

### Purpose
This implementation phase replaces the hardcoded monster creation logic (e.g., `Monster.CreateGoblin()`) with a robust, data-driven system. We will introduce `MonsterDefinition`s loaded from a JSON configuration file, allowing for easy addition and modification of monster types without recompiling the code. A new `MonsterService` will handle spawning monsters based on these definitions, supporting weighted random spawns and tag-based filtering.

### Scope
- **In Scope:**
  - `MonsterDefinition` entity and `MonsterService` implementation.
  - JSON configuration (`config/monsters.json`) with initial set of monsters (Goblin, Skeleton, Orc, Giant Spider, Slime).
  - Updates to `Monster` entity to link back to definitions.
  - Integration into `GameSessionService` for enhanced "Examine" functionality.
  - Updates to `SpectreGameRenderer` to display monster details.
  - Migration of existing spawning logic to use the new service.

- **Out of Scope:**
  - Damage type resistances (reserved for v0.0.9b).
  - Tier system and stat multipliers (reserved for v0.0.9c).
  - Monster traits/abilities (reserved for v0.0.9c).
  - Loot tables and currency drops (reserved for v0.0.9d).

### Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Definition Storage** | JSON File | Simple human-readable format, matches existing configuration strategy (e.g., resources). |
| **Spawning Logic** | New `MonsterService` | Decouples spawning logic from the `Monster` entity and allows for complex selection logic (weights, tags). |
| **Legacy Support** | `DefinitionId` Nullable | Ensures existing tests or saved states with "legacy" monsters don't crash, though we will migrate creating new ones. |

---

## Dependencies from Previous Phases

### Dependencies from v0.0.6b (AI Systems)

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `AIBehavior` | `src/Core/RuneAndRust.Domain/Enums/AIBehavior.cs` | Used in `MonsterDefinition` to determine monster behavior. |

### Dependencies from v0.0.8a (Experience System)

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `Monster` | `src/Core/RuneAndRust.Domain/Entities/Monster.cs` | Being modified to support definitions and XP values. |

---

## Current System Analysis

### Existing Monster Creation

**Location:** `src/Core/RuneAndRust.Domain/Entities/Monster.cs`

**Current Flow:**
```
Room.RefillMonsters()
    â””â”€â”€ Monster.CreateGoblin() (Static Factory)
        â””â”€â”€ new Monster("Goblin", ...)
```

**Current Types:**
```csharp
public class Monster : Entity
{
    // Hardcoded factory methods
    public static Monster CreateGoblin() => ...
}
```

### New Monster Spawning Flow

```
IMonsterService.SpawnMonster("goblin")
    â”œâ”€â”€ Lookup MonsterDefinition ("goblin")
    â””â”€â”€ Create new Monster instance using Definition stats
```

**Refill Monsters Flow:**
```
Room.RefillMonsters(IMonsterService)
    â””â”€â”€ IMonsterService.SpawnRandomMonster()
        â”œâ”€â”€ Select weighted random Definition
        â””â”€â”€ Return new Monster
```

---

## Detailed Implementation

### Domain Layer

#### 1. MonsterDefinition.cs (NEW)

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a monster type that can be spawned in the game world.
/// </summary>
public class MonsterDefinition
{
    // ===== Properties =====

    public string Id { get; init; } = string.Empty;
    public string Name { get; init; } = string.Empty;
    public string Description { get; init; } = string.Empty;
    public string ExamineText { get; init; } = string.Empty;
    public int BaseHealth { get; init; }
    public int BaseAttack { get; init; }
    public int BaseDefense { get; init; }
    public int BaseExperienceValue { get; init; }
    public AIBehavior AIBehavior { get; init; } = AIBehavior.Aggressive;
    public IReadOnlyList<string> Tags { get; init; } = [];
    public int SpawnWeight { get; init; } = 100;
    public int SortOrder { get; init; } = 0;

    // ===== Factory =====

    public static MonsterDefinition Create(
        string id,
        string name,
        string description,
        string examineText,
        int baseHealth,
        int baseAttack,
        int baseDefense,
        int baseExperienceValue,
        AIBehavior aiBehavior = AIBehavior.Aggressive,
        IEnumerable<string>? tags = null,
        int spawnWeight = 100,
        int sortOrder = 0)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(baseHealth);
        ArgumentOutOfRangeException.ThrowIfNegative(baseAttack);
        ArgumentOutOfRangeException.ThrowIfNegative(baseDefense);
        ArgumentOutOfRangeException.ThrowIfNegative(baseExperienceValue);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(spawnWeight);

        return new MonsterDefinition
        {
            Id = id.ToLowerInvariant(),
            Name = name,
            Description = description,
            ExamineText = examineText,
            BaseHealth = baseHealth,
            BaseAttack = baseAttack,
            BaseDefense = baseDefense,
            BaseExperienceValue = baseExperienceValue,
            AIBehavior = aiBehavior,
            Tags = tags?.Select(t => t.ToLowerInvariant()).ToList() ?? [],
            SpawnWeight = spawnWeight,
            SortOrder = sortOrder
        };
    }
}
```

#### 2. Update Monster.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Domain/Entities/Monster.cs`

```csharp
// Changes to Monster class:

// 1. Add Properties
/// <summary>
/// Gets the ID of the MonsterDefinition this monster was spawned from.
/// </summary>
public string? DefinitionId { get; private set; }

/// <summary>
/// Gets the experience value awarded when this monster is defeated.
/// </summary>
public int ExperienceValue { get; private set; }

// 2. Add Constructor
internal Monster(string definitionId, string name, string description,
    int maxHealth, Stats stats, int experienceValue)
{
    Id = Guid.NewGuid();
    DefinitionId = definitionId;
    Name = name ?? throw new ArgumentNullException(nameof(name));
    Description = description ?? throw new ArgumentNullException(nameof(description));
    MaxHealth = maxHealth > 0 ? maxHealth : throw new ArgumentOutOfRangeException(nameof(maxHealth));
    Health = maxHealth;
    Stats = stats;
    ExperienceValue = experienceValue;
}

// 3. Mark CreateGoblin Obsolete
[Obsolete("Use IMonsterService.SpawnMonster(\"goblin\") instead. Will be removed in v0.1.0.")]
public static Monster CreateGoblin() => ...
```

### Application Layer

#### 3. IMonsterService.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Interfaces/IMonsterService.cs`

```csharp
using RuneAndRust.Domain.Definitions;
using RuneAndRust.Domain.Entities;

namespace RuneAndRust.Application.Interfaces;

public interface IMonsterService
{
    MonsterDefinition? GetDefinition(string definitionId);
    IReadOnlyList<MonsterDefinition> GetAllDefinitions();
    IReadOnlyList<MonsterDefinition> GetDefinitionsByTag(string tag);
    Monster SpawnMonster(string definitionId);
    Monster SpawnRandomMonster();
    Monster SpawnRandomMonsterByTag(string tag);
}
```

#### 4. MonsterConfigurationDto.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Configuration/MonsterConfigurationDto.cs`

```csharp
using System.Text.Json.Serialization;

namespace RuneAndRust.Application.Configuration;

public class MonsterConfiguration
{
    [JsonPropertyName("monsters")]
    public List<MonsterDefinitionDto> Monsters { get; set; } = [];
}

public class MonsterDefinitionDto
{
    [JsonPropertyName("id")]
    public string Id { get; set; } = string.Empty;
    [JsonPropertyName("name")]
    public string Name { get; set; } = string.Empty;
    [JsonPropertyName("description")]
    public string Description { get; set; } = string.Empty;
    [JsonPropertyName("examineText")]
    public string ExamineText { get; set; } = string.Empty;
    [JsonPropertyName("baseHealth")]
    public int BaseHealth { get; set; }
    [JsonPropertyName("baseAttack")]
    public int BaseAttack { get; set; }
    [JsonPropertyName("baseDefense")]
    public int BaseDefense { get; set; }
    [JsonPropertyName("baseExperienceValue")]
    public int BaseExperienceValue { get; set; }
    [JsonPropertyName("aiBehavior")]
    public string AIBehavior { get; set; } = "Aggressive";
    [JsonPropertyName("tags")]
    public List<string> Tags { get; set; } = [];
    [JsonPropertyName("spawnWeight")]
    public int SpawnWeight { get; set; } = 100;
    [JsonPropertyName("sortOrder")]
    public int SortOrder { get; set; } = 0;
}
```

#### 5. Update IGameConfigurationProvider.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`

```csharp
// Add:
IReadOnlyList<MonsterDefinition> GetMonsters();
MonsterDefinition? GetMonsterById(string monsterId);
```

#### 6. MonsterService.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Services/MonsterService.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Definitions;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

public class MonsterService : IMonsterService
{
    private readonly IGameConfigurationProvider _configProvider;
    private readonly Random _random;

    public MonsterService(IGameConfigurationProvider configProvider)
    {
        _configProvider = configProvider ?? throw new ArgumentNullException(nameof(configProvider));
        _random = new Random();
    }
    
    internal MonsterService(IGameConfigurationProvider configProvider, Random random)
    {
        _configProvider = configProvider;
        _random = random;
    }

    public MonsterDefinition? GetDefinition(string definitionId)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);
        return _configProvider.GetMonsterById(definitionId.ToLowerInvariant());
    }

    public IReadOnlyList<MonsterDefinition> GetAllDefinitions() => _configProvider.GetMonsters();

    public IReadOnlyList<MonsterDefinition> GetDefinitionsByTag(string tag)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(tag);
        var normalized = tag.ToLowerInvariant();
        return _configProvider.GetMonsters().Where(m => m.Tags.Contains(normalized)).ToList();
    }

    public Monster SpawnMonster(string definitionId)
    {
        var def = GetDefinition(definitionId) 
            ?? throw new ArgumentException($"Monster definition '{definitionId}' not found.", nameof(definitionId));
        return CreateMonsterFromDefinition(def);
    }

    public Monster SpawnRandomMonster()
    {
        var defs = GetAllDefinitions();
        if (defs.Count == 0) throw new InvalidOperationException("No monster definitions available.");
        return CreateMonsterFromDefinition(SelectWeightedRandom(defs));
    }

    public Monster SpawnRandomMonsterByTag(string tag)
    {
        var defs = GetDefinitionsByTag(tag);
        if (defs.Count == 0) throw new InvalidOperationException($"No monster definitions found with tag '{tag}'.");
        return CreateMonsterFromDefinition(SelectWeightedRandom(defs));
    }

    private Monster CreateMonsterFromDefinition(MonsterDefinition def)
    {
        var stats = new Stats(def.BaseHealth, def.BaseAttack, def.BaseDefense);
        return new Monster(def.Id, def.Name, def.Description, def.BaseHealth, stats, def.BaseExperienceValue);
    }

    private MonsterDefinition SelectWeightedRandom(IReadOnlyList<MonsterDefinition> definitions)
    {
        var totalWeight = definitions.Sum(d => d.SpawnWeight);
        var roll = _random.Next(totalWeight);
        var current = 0;
        foreach (var def in definitions)
        {
            current += def.SpawnWeight;
            if (roll < current) return def;
        }
        return definitions[^1];
    }
}
```

### Infrastructure Layer

#### 7. JsonConfigurationProvider.cs (MODIFY)

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`

```csharp
private List<MonsterDefinition>? _monsters;

public IReadOnlyList<MonsterDefinition> GetMonsters()
{
    if (_monsters == null)
    {
        var config = LoadConfiguration<MonsterConfiguration>("monsters.json");
        _monsters = config.Monsters.Select(MapToMonsterDefinition).ToList();
    }
    return _monsters;
}

public MonsterDefinition? GetMonsterById(string monsterId)
{
    return GetMonsters().FirstOrDefault(m => m.Id.Equals(monsterId, StringComparison.OrdinalIgnoreCase));
}

private static MonsterDefinition MapToMonsterDefinition(MonsterDefinitionDto dto)
{
    Enum.TryParse<AIBehavior>(dto.AIBehavior, true, out var behavior);
    return MonsterDefinition.Create(
        dto.Id, dto.Name, dto.Description, dto.ExamineText,
        dto.BaseHealth, dto.BaseAttack, dto.BaseDefense, dto.BaseExperienceValue,
        behavior, dto.Tags, dto.SpawnWeight, dto.SortOrder);
}
```

### Presentation Layer

#### 8. MonsterExamineDto.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/DTOs/MonsterExamineDto.cs`

```csharp
namespace RuneAndRust.Application.DTOs;

public class MonsterExamineDto
{
    public string Name { get; init; } = string.Empty;
    public string ExamineText { get; init; } = string.Empty;
    public int CurrentHealth { get; init; }
    public int MaxHealth { get; init; }
    public IReadOnlyList<string> Tags { get; init; } = [];
    public string Behavior { get; init; } = string.Empty;
}
```

#### 9. GameSessionService.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Application/Services/GameSessionService.cs`

```csharp
// Update HandleExamineCommand to check for monster:
// (See Design Spec 6.1 for implementation logic referencing MonsterService)
```

#### 10. Update SpectreGameRenderer.cs (MODIFY)

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Adapters/SpectreGameRenderer.cs`

- Update `RenderMonsters` to display tags.

---

## Configuration

### 11. monsters.json (NEW)

**File:** `config/monsters.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "monsters": [
    {
      "id": "goblin",
      "name": "Goblin",
      "description": "A small, green creature with sharp teeth and beady eyes.",
      "examineText": "This goblin clutches a rusty dagger...",
      "baseHealth": 30,
      "baseAttack": 8,
      "baseDefense": 2,
      "baseExperienceValue": 25,
      "aiBehavior": "Aggressive",
      "tags": ["humanoid"],
      "spawnWeight": 100,
      "sortOrder": 1
    },
    {
      "id": "skeleton",
      "name": "Skeleton",
      "description": "An animated pile of bones.",
      "examineText": "Dark magic holds these bones together...",
      "baseHealth": 25,
      "baseAttack": 10,
      "baseDefense": 1,
      "baseExperienceValue": 30,
      "aiBehavior": "Aggressive",
      "tags": ["undead"],
      "spawnWeight": 80,
      "sortOrder": 2
    },
    {
      "id": "orc",
      "name": "Orc",
      "description": "A hulking, brutish warrior.",
      "examineText": "This orc towers over you...",
      "baseHealth": 50,
      "baseAttack": 12,
      "baseDefense": 4,
      "baseExperienceValue": 50,
      "aiBehavior": "Aggressive",
      "tags": ["humanoid"],
      "spawnWeight": 50,
      "sortOrder": 3
    },
    {
      "id": "giant_spider",
      "name": "Giant Spider",
      "description": "A horse-sized spider.",
      "examineText": "Eight multi-faceted eyes gleam...",
      "baseHealth": 20,
      "baseAttack": 6,
      "baseDefense": 1,
      "baseExperienceValue": 20,
      "aiBehavior": "Defensive",
      "tags": ["beast"],
      "spawnWeight": 60,
      "sortOrder": 4
    },
    {
      "id": "slime",
      "name": "Slime",
      "description": "A quivering mass of translucent gel.",
      "examineText": "This gelatinous creature pulses...",
      "baseHealth": 40,
      "baseAttack": 4,
      "baseDefense": 0,
      "baseExperienceValue": 15,
      "aiBehavior": "Chaotic",
      "tags": ["ooze"],
      "spawnWeight": 40,
      "sortOrder": 5
    }
  ]
}
```

---

## Flow Diagrams

### Monster Spawning Flow

```
IMonsterService.SpawnMonster("id")
       â”‚
       â–¼
  GetDefinition("id") â”€â”€â–¶ Return MonsterDefinition or Error
       â”‚
       â–¼
  CreateMonsterFromDefinition()
       â”œâ”€â”€ Calculate Stats
       â”œâ”€â”€ Create Monster Entity
       â””â”€â”€ Return Monster
```

---

## Testing Strategy

### Test Files

#### 1. MonsterDefinitionTests.cs
**File:** `tests/RuneAndRust.Domain.UnitTests/Definitions/MonsterDefinitionTests.cs`
- `Create_ValidInputs_ReturnsDefinition`
- `Create_InvalidInputs_ThrowsException`

#### 2. MonsterServiceTests.cs
**File:** `tests/RuneAndRust.Application.UnitTests/Services/MonsterServiceTests.cs`
- `SpawnMonster_ValidId_ReturnsMonster`
- `SpawnMonster_InvalidId_ThrowsException`
- `SpawnRandomMonster_ReturnsMonsterFromList`
- `SpawnRandomMonsterByTag_ValidTag_ReturnsMatchingMonster`

---

## Logging Strategy

| Operation | Level | Example |
|-----------|-------|---------|
| Spawn (Specific) | Debug | "Spawning monster: goblin" |
| Spawn (Random) | Debug | "Spawning random monster..." |
| Config Load | Info | "Loaded 5 monster definitions." |

---

## Implementation Checklist

> **Legend:** ğŸŸ¢ No dependencies | ğŸŸ¡ Has dependencies | ğŸ”´ Critical path
> **Complexity:** â­ Simple | â­â­ Moderate | â­â­â­ Complex

---

### Phase 1: Domain Layer (Foundation)

#### 1.1 Create `MonsterDefinition.cs` ğŸŸ¢ â­â­

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`

- [ ] Create new file in `Definitions/` directory
- [ ] Add namespace declaration: `RuneAndRust.Domain.Definitions`
- [ ] Add using for `RuneAndRust.Domain.Enums` (for `AIBehavior`)
- [ ] Define `MonsterDefinition` class with XML documentation
- [ ] **Properties (all `init`-only):**
  - [ ] `string Id` - unique identifier (lowercase)
  - [ ] `string Name` - display name
  - [ ] `string Description` - brief room description
  - [ ] `string ExamineText` - detailed examine output
  - [ ] `int BaseHealth` - base HP before tier modifiers
  - [ ] `int BaseAttack` - base attack value
  - [ ] `int BaseDefense` - base defense value
  - [ ] `int BaseExperienceValue` - XP awarded on defeat
  - [ ] `AIBehavior AIBehavior` - AI behavior enum (default: `Aggressive`)
  - [ ] `IReadOnlyList<string> Tags` - category tags (default: empty)
  - [ ] `int SpawnWeight` - weighted random selection (default: 100)
  - [ ] `int SortOrder` - display ordering (default: 0)
- [ ] **Factory method `Create()`:**
  - [ ] Validate `Id` not null/whitespace (`ArgumentException.ThrowIfNullOrWhiteSpace`)
  - [ ] Validate `Name` not null/whitespace
  - [ ] Validate `BaseHealth > 0` (`ThrowIfNegativeOrZero`)
  - [ ] Validate `BaseAttack >= 0` (`ThrowIfNegative`)
  - [ ] Validate `BaseDefense >= 0`
  - [ ] Validate `BaseExperienceValue >= 0`
  - [ ] Validate `SpawnWeight > 0`
  - [ ] Normalize `Id` to lowercase
  - [ ] Normalize all `Tags` to lowercase
  - [ ] Return new instance with validated values

**Acceptance:** `MonsterDefinition.Create("goblin", "Goblin", ...)` returns valid instance with normalized ID.

---

#### 1.2 Update `Monster.cs` ğŸŸ¡ â­â­

**File:** `src/Core/RuneAndRust.Domain/Entities/Monster.cs`
**Depends on:** 1.1 (uses `MonsterDefinition` pattern)

- [ ] **Add new properties (after `Description`):**
  - [ ] `public string? DefinitionId { get; private set; }` with XML docs
  - [ ] `public int ExperienceValue { get; private set; }` with XML docs
- [ ] **Add new internal constructor:**
  - [ ] Parameters: `string definitionId, string name, string description, int maxHealth, Stats stats, int experienceValue`
  - [ ] Assign `DefinitionId = definitionId`
  - [ ] Assign `ExperienceValue = experienceValue`
  - [ ] Existing validation for `name`, `description`, `maxHealth`
  - [ ] Mark as `internal` to restrict to Application layer
- [ ] **Update private EF constructor:**
  - [ ] Initialize `ExperienceValue = 0` (for legacy compatibility)
- [ ] **Deprecate `CreateGoblin()` factory:**
  - [ ] Add `[Obsolete("Use IMonsterService.SpawnMonster(\"goblin\") instead. Will be removed in v0.1.0.")]`
  - [ ] Set `DefinitionId = null` in existing implementation (legacy marker)
  - [ ] Set `ExperienceValue = 25` (hardcoded for backward compat)

**Acceptance:** Tests using `CreateGoblin()` show deprecation warning but still compile. New constructor only accessible from Application layer.

---

### Phase 2: Application Layer (Service Contracts)

#### 2.1 Create `MonsterConfigurationDto.cs` ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Application/Configuration/MonsterConfigurationDto.cs`

- [ ] Create new file in `Configuration/` directory
- [ ] Add namespace: `RuneAndRust.Application.Configuration`
- [ ] Add using for `System.Text.Json.Serialization`
- [ ] **Define `MonsterConfiguration` class:**
  - [ ] `[JsonPropertyName("monsters")] List<MonsterDefinitionDto> Monsters` (default: empty list)
- [ ] **Define `MonsterDefinitionDto` class:**
  - [ ] `[JsonPropertyName("id")] string Id` (default: empty)
  - [ ] `[JsonPropertyName("name")] string Name`
  - [ ] `[JsonPropertyName("description")] string Description`
  - [ ] `[JsonPropertyName("examineText")] string ExamineText`
  - [ ] `[JsonPropertyName("baseHealth")] int BaseHealth`
  - [ ] `[JsonPropertyName("baseAttack")] int BaseAttack`
  - [ ] `[JsonPropertyName("baseDefense")] int BaseDefense`
  - [ ] `[JsonPropertyName("baseExperienceValue")] int BaseExperienceValue`
  - [ ] `[JsonPropertyName("aiBehavior")] string AIBehavior` (default: "Aggressive")
  - [ ] `[JsonPropertyName("tags")] List<string> Tags` (default: empty list)
  - [ ] `[JsonPropertyName("spawnWeight")] int SpawnWeight` (default: 100)
  - [ ] `[JsonPropertyName("sortOrder")] int SortOrder` (default: 0)

**Acceptance:** DTO can be deserialized from JSON without exceptions.

---

#### 2.2 Update `IGameConfigurationProvider.cs` ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`
**Depends on:** 1.1 (references `MonsterDefinition`)

- [ ] Add using for `RuneAndRust.Domain.Definitions` (if not present)
- [ ] **Add interface method declarations (after `GetAbilitiesForClass`):**
  - [ ] `IReadOnlyList<MonsterDefinition> GetMonsters()` with XML docs
  - [ ] `MonsterDefinition? GetMonsterById(string monsterId)` with XML docs

**Acceptance:** Interface compiles; `JsonConfigurationProvider` shows compile error (expected until implemented).

---

#### 2.3 Create `IMonsterService.cs` ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Interfaces/IMonsterService.cs`
**Depends on:** 1.1, 1.2

- [ ] Create new file in `Interfaces/` directory
- [ ] Add namespace: `RuneAndRust.Application.Interfaces`
- [ ] Add usings for `Domain.Definitions` and `Domain.Entities`
- [ ] **Define `IMonsterService` interface with XML docs:**
  - [ ] `MonsterDefinition? GetDefinition(string definitionId)`
  - [ ] `IReadOnlyList<MonsterDefinition> GetAllDefinitions()`
  - [ ] `IReadOnlyList<MonsterDefinition> GetDefinitionsByTag(string tag)`
  - [ ] `Monster SpawnMonster(string definitionId)` - throws `ArgumentException` if not found
  - [ ] `Monster SpawnRandomMonster()` - throws `InvalidOperationException` if no definitions
  - [ ] `Monster SpawnRandomMonsterByTag(string tag)` - throws `InvalidOperationException` if no matches

**Acceptance:** Interface compiles with complete XML documentation.

---

#### 2.4 Create `MonsterService.cs` ğŸŸ¡ â­â­â­

**File:** `src/Core/RuneAndRust.Application/Services/MonsterService.cs`
**Depends on:** 2.2, 2.3, 1.1, 1.2

- [ ] Create new file in `Services/` directory
- [ ] Add namespace: `RuneAndRust.Application.Services`
- [ ] Add usings for interfaces, definitions, entities, value objects
- [ ] **Define `MonsterService` class implementing `IMonsterService`:**
- [ ] **Private fields:**
  - [ ] `readonly IGameConfigurationProvider _configProvider`
  - [ ] `readonly Random _random`
- [ ] **Public constructor:**
  - [ ] Parameter: `IGameConfigurationProvider configProvider`
  - [ ] Null check with `ArgumentNullException`
  - [ ] Initialize `_random = new Random()`
- [ ] **Internal constructor (for testing):**
  - [ ] Parameters: `IGameConfigurationProvider configProvider, Random random`
  - [ ] Null checks for both
- [ ] **Implement `GetDefinition(string definitionId)`:**
  - [ ] Validate input with `ThrowIfNullOrWhiteSpace`
  - [ ] Normalize to lowercase
  - [ ] Return `_configProvider.GetMonsterById()`
- [ ] **Implement `GetAllDefinitions()`:**
  - [ ] Return `_configProvider.GetMonsters()`
- [ ] **Implement `GetDefinitionsByTag(string tag)`:**
  - [ ] Validate input
  - [ ] Normalize tag to lowercase
  - [ ] Filter and return matching definitions
- [ ] **Implement `SpawnMonster(string definitionId)`:**
  - [ ] Get definition or throw `ArgumentException` with descriptive message
  - [ ] Call `CreateMonsterFromDefinition()`
- [ ] **Implement `SpawnRandomMonster()`:**
  - [ ] Get all definitions
  - [ ] Throw `InvalidOperationException` if empty
  - [ ] Call `SelectWeightedRandom()` and `CreateMonsterFromDefinition()`
- [ ] **Implement `SpawnRandomMonsterByTag(string tag)`:**
  - [ ] Get filtered definitions
  - [ ] Throw `InvalidOperationException` if empty
  - [ ] Call `SelectWeightedRandom()` and `CreateMonsterFromDefinition()`
- [ ] **Private helper `CreateMonsterFromDefinition(MonsterDefinition def)`:**
  - [ ] Create `Stats` value object from definition
  - [ ] Return new `Monster` via internal constructor
- [ ] **Private helper `SelectWeightedRandom(IReadOnlyList<MonsterDefinition> definitions)`:**
  - [ ] Calculate total weight
  - [ ] Generate random roll: `_random.Next(totalWeight)`
  - [ ] Iterate and accumulate weights
  - [ ] Return definition when roll < accumulated weight
  - [ ] Fallback return last definition (edge case)

**Acceptance:** Service can spawn "goblin" by ID and return randomized monsters weighted correctly.

---

#### 2.5 Create `MonsterExamineDto.cs` ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Application/DTOs/MonsterExamineDto.cs`

- [ ] Create new file in `DTOs/` directory
- [ ] Add namespace: `RuneAndRust.Application.DTOs`
- [ ] **Define `MonsterExamineDto` class with XML docs:**
  - [ ] `string Name { get; init; }` (default: empty)
  - [ ] `string ExamineText { get; init; }` (default: empty)
  - [ ] `int CurrentHealth { get; init; }`
  - [ ] `int MaxHealth { get; init; }`
  - [ ] `IReadOnlyList<string> Tags { get; init; }` (default: empty)
  - [ ] `string Behavior { get; init; }` (default: empty)

**Acceptance:** DTO can be instantiated with object initializer.

---

#### 2.6 Update `GameSessionService.cs` ğŸŸ¡ â­â­

**File:** `src/Core/RuneAndRust.Application/Services/GameSessionService.cs`
**Depends on:** 2.3, 2.4

- [ ] **Add dependency injection:**
  - [ ] Add `private readonly IMonsterService _monsterService` field
  - [ ] Add constructor parameter `IMonsterService monsterService`
  - [ ] Assign in constructor with null check
- [ ] **Update `HandleExamineCommand()` method:**
  - [ ] Add monster check before item check:
    - [ ] Normalize target to lowercase
    - [ ] Find monster in `CurrentRoom.GetAliveMonsters()` matching name or `DefinitionId`
    - [ ] If found, return `FormatMonsterExamination(monster)`
- [ ] **Add private helper `FormatMonsterExamination(Monster monster)`:**
  - [ ] Build `StringBuilder` with header: `=== {monster.Name} ===`
  - [ ] If `DefinitionId` is not null:
    - [ ] Get definition via `_monsterService.GetDefinition()`
    - [ ] If definition has `ExamineText`, append it
    - [ ] If definition has `Tags`, append: `Type: {joined tags}`
  - [ ] Else append `monster.Description`
  - [ ] Append: `Health: {monster.Health}/{monster.MaxHealth}`
  - [ ] Return formatted string

**Acceptance:** `examine goblin` returns detailed ExamineText with tags and health.

---

### Phase 3: Infrastructure Layer (Data Loading)

#### 3.1 Update `JsonConfigurationProvider.cs` ğŸŸ¡ â­â­ ğŸ”´

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`
**Depends on:** 2.1, 2.2, 1.1
**Critical:** Enables all configuration loading

- [ ] Add usings for DTOs and `AIBehavior` enum
- [ ] **Add private field:**
  - [ ] `private List<MonsterDefinition>? _monsters;`
- [ ] **Implement `GetMonsters()`:**
  - [ ] Null check `_monsters`
  - [ ] If null, load from `monsters.json` via `LoadConfiguration<MonsterConfiguration>`
  - [ ] Map each DTO with `MapToMonsterDefinition()`
  - [ ] Cache in `_monsters`
  - [ ] Return cached list
- [ ] **Implement `GetMonsterById(string monsterId)`:**
  - [ ] Call `GetMonsters()` to ensure loaded
  - [ ] Return `FirstOrDefault` matching ID (case-insensitive)
- [ ] **Add private helper `MapToMonsterDefinition(MonsterDefinitionDto dto)`:**
  - [ ] Parse `dto.AIBehavior` to enum with `Enum.TryParse` (default: `Aggressive`)
  - [ ] Call `MonsterDefinition.Create()` with all mapped values
  - [ ] Return created definition

**Acceptance:** `GetMonsters()` returns 5 definitions from JSON. Second call returns cached instance.

---

### Phase 4: Configuration (Data Files)

#### 4.1 Create `config/monsters.json` ğŸŸ¢ â­â­

**File:** `config/monsters.json`

- [ ] Create new file in `config/` directory
- [ ] Add JSON structure with `$schema` reference
- [ ] **Add `monsters` array with 5 definitions:**
- [ ] **Goblin:**
  - [ ] id: "goblin", name: "Goblin"
  - [ ] description: "A small, green creature with sharp teeth and beady eyes. It looks hostile."
  - [ ] examineText: Detailed paragraph about rusty dagger, malicious intent, chattering
  - [ ] baseHealth: 30, baseAttack: 8, baseDefense: 2, baseExperienceValue: 25
  - [ ] aiBehavior: "Aggressive", tags: ["humanoid"], spawnWeight: 100, sortOrder: 1
- [ ] **Skeleton:**
  - [ ] id: "skeleton", name: "Skeleton"
  - [ ] description: "An animated pile of bones held together by dark magic."
  - [ ] examineText: Detailed paragraph about eerie blue light, jerky movement
  - [ ] baseHealth: 25, baseAttack: 10, baseDefense: 1, baseExperienceValue: 30
  - [ ] aiBehavior: "Aggressive", tags: ["undead"], spawnWeight: 80, sortOrder: 2
- [ ] **Orc:**
  - [ ] id: "orc", name: "Orc"
  - [ ] description: "A hulking, brutish warrior with green skin and tusks."
  - [ ] examineText: Detailed paragraph about muscles, yellowed tusks, crude weapon
  - [ ] baseHealth: 50, baseAttack: 12, baseDefense: 4, baseExperienceValue: 50
  - [ ] aiBehavior: "Aggressive", tags: ["humanoid"], spawnWeight: 50, sortOrder: 3
- [ ] **Giant Spider:**
  - [ ] id: "giant_spider", name: "Giant Spider"
  - [ ] description: "A horse-sized spider with glistening fangs dripping venom."
  - [ ] examineText: Detailed paragraph about eight eyes, hairy legs, venom
  - [ ] baseHealth: 20, baseAttack: 6, baseDefense: 1, baseExperienceValue: 20
  - [ ] aiBehavior: "Defensive", tags: ["beast"], spawnWeight: 60, sortOrder: 4
- [ ] **Slime:**
  - [ ] id: "slime", name: "Slime"
  - [ ] description: "A quivering mass of translucent, acidic gel."
  - [ ] examineText: Detailed paragraph about gelatinous pulsing, acidic residue, dissolved remains
  - [ ] baseHealth: 40, baseAttack: 4, baseDefense: 0, baseExperienceValue: 15
  - [ ] aiBehavior: "Chaotic", tags: ["ooze"], spawnWeight: 40, sortOrder: 5
- [ ] Validate JSON syntax (no trailing commas)
- [ ] Verify copy-to-output in build configuration (if needed)

**Acceptance:** JSON parses without errors. All 5 monsters load with correct stats.

---

### Phase 5: Presentation Layer (Display)

#### 5.1 Update `SpectreGameRenderer.cs` ğŸŸ¡ â­â­

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Adapters/SpectreGameRenderer.cs`
**Depends on:** 2.3

- [ ] **Add dependency injection:**
  - [ ] Add `private readonly IMonsterService _monsterService` field
  - [ ] Update constructor to accept `IMonsterService` parameter
  - [ ] Assign with null check
- [ ] **Update monster rendering method (likely `RenderMonsters` or similar):**
  - [ ] For each monster in room:
    - [ ] Check if `DefinitionId` is not null
    - [ ] If so, get definition via `_monsterService.GetDefinition()`
    - [ ] If definition has tags, build tags display: ` ({joined tags})`
  - [ ] Format output: `â€¢ [red]{monster.Name}[/]{tagsDisplay} - HP: {Health}/{MaxHealth}`
- [ ] **Update DI registration (if needed):**
  - [ ] Ensure `IMonsterService` is registered in container

**Acceptance:** Room display shows `Goblin (humanoid) - HP: 30/30` format.

---

### Phase 6: Testing (Verification)

#### 6.1 Create `MonsterDefinitionTests.cs` ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Domain.UnitTests/Definitions/MonsterDefinitionTests.cs`
**Depends on:** 1.1

- [ ] Create `Definitions/` directory in test project
- [ ] Create test file with `[Fact]` and `[Theory]` tests
- [ ] **Test cases (~6 tests):**
  - [ ] `Create_ValidInputs_ReturnsDefinitionWithCorrectValues`
  - [ ] `Create_EmptyId_ThrowsArgumentException`
  - [ ] `Create_WhitespaceId_ThrowsArgumentException`
  - [ ] `Create_NegativeHealth_ThrowsArgumentOutOfRangeException`
  - [ ] `Create_ZeroHealth_ThrowsArgumentOutOfRangeException`
  - [ ] `Create_NormalizesIdToLowercase`
  - [ ] `Create_NormalizesTagsToLowercase`
  - [ ] `Create_NullTags_ReturnsEmptyList`
  - [ ] `Create_DefaultAIBehavior_IsAggressive`
  - [ ] `Create_DefaultSpawnWeight_Is100`

**Acceptance:** All tests pass. Edge cases covered for validation.

---

#### 6.2 Create `MonsterServiceTests.cs` ğŸŸ¡ â­â­â­

**File:** `tests/RuneAndRust.Application.UnitTests/Services/MonsterServiceTests.cs`
**Depends on:** 2.4

- [ ] Create test file with mock `IGameConfigurationProvider`
- [ ] **Setup mock with test definitions:**
  - [ ] Create 3+ test definitions with different weights/tags
- [ ] **Test cases (~8 tests):**
  - [ ] `GetDefinition_ValidId_ReturnsDefinition`
  - [ ] `GetDefinition_InvalidId_ReturnsNull`
  - [ ] `GetDefinition_IsCaseInsensitive`
  - [ ] `GetAllDefinitions_ReturnsAllFromProvider`
  - [ ] `GetDefinitionsByTag_ValidTag_ReturnsMatchingDefinitions`
  - [ ] `GetDefinitionsByTag_NoMatches_ReturnsEmptyList`
  - [ ] `SpawnMonster_ValidId_ReturnsMonsterWithCorrectStats`
  - [ ] `SpawnMonster_InvalidId_ThrowsArgumentException`
  - [ ] `SpawnRandomMonster_NoDefinitions_ThrowsInvalidOperationException`
  - [ ] `SpawnRandomMonster_UsesWeightedSelection` (use seeded Random)
  - [ ] `SpawnRandomMonsterByTag_ValidTag_ReturnsMatchingMonster`
  - [ ] `SpawnMonster_SetsDefinitionIdOnMonster`
  - [ ] `SpawnMonster_SetsExperienceValueOnMonster`

**Acceptance:** All tests pass with mocked configuration. Weighted selection test verifies distribution.

---

#### 6.3 Update `JsonConfigurationProviderTests.cs` ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Infrastructure.UnitTests/Configuration/JsonConfigurationProviderTests.cs`
**Depends on:** 3.1

- [ ] **Add test cases (~4 tests):**
  - [ ] `GetMonsters_LoadsFromJson_ReturnsAllDefinitions`
  - [ ] `GetMonsters_CachesResults_ReturnsSameInstance`
  - [ ] `GetMonsterById_ValidId_ReturnsCorrectDefinition`
  - [ ] `GetMonsterById_InvalidId_ReturnsNull`
  - [ ] `GetMonsterById_IsCaseInsensitive`
- [ ] **Setup:**
  - [ ] Ensure test `monsters.json` in test data directory
  - [ ] Or mock file system for isolation

**Acceptance:** Configuration loading tests pass with actual JSON parsing.

---

### Phase 7: Integration & Migration

#### 7.1 Update DI Container Registration ğŸŸ¡ â­

**File:** (Likely `Program.cs` or DI setup file in Presentation layer)
**Depends on:** 2.4, 5.1

- [ ] Register `IMonsterService` â†’ `MonsterService` (scoped or singleton)
- [ ] Verify `IGameConfigurationProvider` already registered
- [ ] Update any affected constructor chains

**Acceptance:** Application starts without DI resolution errors.

---

#### 7.2 Migrate Existing Spawn Calls ğŸŸ¡ â­â­

**Depends on:** 2.4, 7.1

- [ ] **Search for all usages of `Monster.CreateGoblin()`:**
  - [ ] In `Room.cs` or `Dungeon.cs` spawn logic
  - [ ] In test fixtures
- [ ] **Replace with `IMonsterService` calls:**
  - [ ] `_monsterService.SpawnMonster("goblin")` for specific spawns
  - [ ] `_monsterService.SpawnRandomMonster()` for variety
- [ ] **Update affected classes to accept `IMonsterService` dependency**

**Acceptance:** No usages of `CreateGoblin()` in production code. Deprecation warnings only in legacy test compatibility.

---

### Implementation Order Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Domain (Foundation)                                â”‚
â”‚  1.1 MonsterDefinition.cs â”€â”€â”€â”¬â”€â†’ Phase 2 & 3                â”‚
â”‚  1.2 Monster.cs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: Application (Services)                             â”‚
â”‚  2.1 MonsterConfigurationDto.cs (parallel)                  â”‚
â”‚  2.2 IConfigurationProvider.cs  â”€â”€â”€â”¬â”€â†’ 2.4 MonsterService   â”‚
â”‚  2.3 IMonsterService.cs  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  2.4 MonsterService.cs  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚  2.5 MonsterExamineDto.cs â”€â”€â”€â†’ 2.6 GameSessionService       â”‚
â”‚  2.6 GameSessionService.cs                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: Infrastructure (Data)                              â”‚
â”‚  3.1 JsonConfigurationProvider.cs (CRITICAL PATH)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 4: Configuration                                      â”‚
â”‚  4.1 config/monsters.json                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 5: Presentation                                       â”‚
â”‚  5.1 SpectreGameRenderer.cs                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 6: Testing                                            â”‚
â”‚  6.1 MonsterDefinitionTests.cs (can start after 1.1)        â”‚
â”‚  6.2 MonsterServiceTests.cs (after 2.4)                     â”‚
â”‚  6.3 JsonConfigurationProviderTests.cs (after 3.1)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 7: Integration                                        â”‚
â”‚  7.1 DI Container Registration                              â”‚
â”‚  7.2 Migrate Existing Spawn Calls                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Estimated Effort

| Phase | Tasks | Complexity | Est. Time |
|-------|-------|------------|-----------|
| Domain Layer | 2 files | â­â­ | 1-2 hours |
| Application Layer | 6 files | â­â­â­ | 3-4 hours |
| Infrastructure Layer | 1 file | â­â­ | 1 hour |
| Configuration | 1 file | â­â­ | 30 min |
| Presentation Layer | 1 file | â­â­ | 1 hour |
| Testing | 3 files | â­â­â­ | 2-3 hours |
| Integration | 2 tasks | â­ | 30 min |
| **Total** | **16 items** | | **9-12 hours** |

---

## Acceptance Criteria

1. **Configurable Monsters**: Can add a new monster to `monsters.json` and spawn it without code changes.
2. **Examine Details**: Examining a monster shows its specific description/tags.
3. **Random Spawning**: `SpawnRandomMonster` respects weights (Goblin spawns more than Slime).
4. **Backward Compatibility**: Existing saves/monsters work (though migration to new system is preferred).

---

## File Summary

### Files to Create
- `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IMonsterService.cs`
- `src/Core/RuneAndRust.Application/Services/MonsterService.cs`
- `src/Core/RuneAndRust.Application/Configuration/MonsterConfigurationDto.cs`
- `src/Core/RuneAndRust.Application/DTOs/MonsterExamineDto.cs`
- `config/monsters.json`

### Files to Modify
- `src/Core/RuneAndRust.Domain/Entities/Monster.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`
- `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`
- `src/Core/RuneAndRust.Application/Services/GameSessionService.cs`
- `src/Presentation/RuneAndRust.Presentation.Tui/Adapters/SpectreGameRenderer.cs`

### Test Files Summary

| File | Test Count |
|------|------------|
| `MonsterDefinitionTests.cs` | ~6 |
| `MonsterServiceTests.cs` | ~8 |
| `JsonConfigurationProviderTests.cs` (Updates) | ~4 |
| **Total** | **~18** |

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Monster constructor changes break tests | Medium | Medium | Add default parameter values |
| monsters.json parsing fails | Low | High | Validate JSON schema, provide clear errors |
| Weighted random not truly random | Low | Low | Use seeded Random for testing |
| Missing monster definition on spawn | Medium | Medium | Throw descriptive exception with ID |
| Performance with many definitions | Low | Low | Lazy loading, cache definitions |

---

## Provides to Future Phases

### To v0.0.9b (Damage Types & Resistances)

| Type | Usage |
|------|-------|
| `MonsterDefinition` | Extended with `BaseResistances` property |
| `Monster` | Extended with `Resistances` property |
| `MonsterService` | Spawns monsters with resistances |

### To v0.0.9c (Monster Tiers & Traits)

| Type | Usage |
|------|-------|
| `MonsterDefinition` | Extended with `PossibleTiers`, `PossibleTraits` |
| `Monster` | Extended with `TierId`, `TraitIds`, `DisplayName` |
| `MonsterService` | Tier selection and stat multiplication |

### To v0.0.9d (Loot & Currency)

| Type | Usage |
|------|-------|
| `MonsterDefinition` | Extended with `LootTable` |
| `Monster.DefinitionId` | Used by LootService to look up loot table |
