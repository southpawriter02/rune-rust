# v0.0.7 Implementation Specification: Equipment System

**Version:** 0.0.7
**Implementation Date:** 2026-01-08
**Design Specification:** [v0.0.7-scope-breakdown.md](../v0.0.7-scope-breakdown.md)
**Changelogs:** [v0.0.7a](../../changelogs/v0.0.7a-changelog.md), [v0.0.7b](../../changelogs/v0.0.7b-changelog.md), [v0.0.7c](../../changelogs/v0.0.7c-changelog.md)

---

## 1. Overview

### 1.1 Summary

v0.0.7 implements a comprehensive equipment system with weapons, armor, and accessories. Items provide stat bonuses, defense values, and can have equip requirements based on attributes or class. The system supports multiple equipment slots and calculates effective stats from all equipped items.

### 1.2 Key Features

- **Equipment Slots**: Main Hand, Off Hand, Head, Chest, Hands, Feet, Ring, Amulet
- **Weapon Types**: Swords, axes, daggers, staves with damage types
- **Armor Types**: Light, Medium, Heavy with defense bonuses
- **Accessories**: Rings and amulets with stat modifiers
- **Requirements**: Attribute minimums and class restrictions
- **Initiative Penalties**: Heavy gear affects combat speed

### 1.3 Deviations from Design

None significant; implementation matches design specification.

---

## 2. Architecture

### 2.1 Layer Interactions

```
┌─────────────────────────────────────────────────────────────┐
│                    Presentation Layer                        │
│  GameView → equip, unequip, equipment commands              │
│  SpectreGameRenderer → Equipment display panels             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    Application Layer                         │
│  ArmorDto, EquipmentDisplayDto                              │
│  Equipment validation and mapping                           │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Domain Layer                            │
│  Item (extended), EquipmentService                          │
│  EquipmentRequirements, WeaponStats, ArmorType              │
│  Player.GetEffectiveStats(), GetEffectiveAttributes()       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                   Infrastructure Layer                       │
│  config/weapons.json, config/armor.json                     │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 Key Patterns

- **Composite Pattern**: Equipment bonuses aggregate from multiple slots
- **Factory Pattern**: Item factory methods for weapons, armor
- **Validation Pattern**: Requirement checks before equipping
- **Builder Pattern**: EquipmentRequirements.ForMight(), ForClasses()

### 2.3 Dependencies

- v0.0.9: Weapons provide damage types for resistance calculations
- v0.0.6: Initiative penalties affect combat turn order

---

## 3. Data Model

### 3.1 Equipment Slots

| Slot | Item Types | Typical Stat |
|------|------------|--------------|
| MainHand | Weapons | Attack |
| OffHand | Shield, Dagger | Defense |
| Head | Helmet, Hood | Defense |
| Chest | Armor, Robe | Defense |
| Hands | Gloves, Gauntlets | Mixed |
| Feet | Boots | Defense |
| Ring | Rings | Varies |
| Amulet | Amulets | Varies |

### 3.2 Item Extensions

| Property | Type | Description |
|----------|------|-------------|
| `ArmorType` | ArmorType? | Light, Medium, Heavy |
| `DefenseBonus` | int | Direct defense contribution |
| `StatModifiers` | StatModifiers | Attribute bonuses |
| `InitiativePenalty` | int | Combat speed reduction |
| `Requirements` | EquipmentRequirements | Equip restrictions |
| `WeaponStats` | WeaponStats? | Damage type, range |

### 3.3 EquipmentRequirements

```csharp
public readonly record struct EquipmentRequirements(
    int MinMight = 0,
    int MinFortitude = 0,
    int MinWill = 0,
    int MinWits = 0,
    int MinFinesse = 0,
    IReadOnlyList<string>? RequiredClassIds = null)
{
    public bool HasRequirements => ...;
    public bool MeetsRequirements(Player player) => ...;
    public IReadOnlyList<string> GetUnmetRequirements(Player player) => ...;

    public static EquipmentRequirements None => new();
    public static EquipmentRequirements ForMight(int min) => new(MinMight: min);
    public static EquipmentRequirements ForFortitude(int min) => new(MinFortitude: min);
    public static EquipmentRequirements ForClasses(params string[] classIds) => ...;
}
```

---

## 4. Services

### 4.1 EquipmentService

```csharp
// Equipment Operations
Equip(player, item) → EquipResult
Unequip(player, slot) → UnequipResult
CanEquip(player, item) → (bool, IReadOnlyList<string>)
GetSlotForItem(item) → EquipmentSlot
SwapEquipment(player, newItem, slot) → SwapResult
```

### 4.2 Player Extensions

```csharp
// Effective Stats (base + equipment)
GetEffectiveStats() → Stats
GetEffectiveAttributes() → PlayerAttributes
GetTotalDefenseBonus() → int
GetTotalInitiativePenalty() → int
GetEquippedWeaponDamageType() → DamageType?
```

---

## 5. Configuration

### 5.1 JSON Files

| File | Content |
|------|---------|
| `weapons.json` | Weapon definitions with damage types |
| `armor.json` | 18 equipment definitions |

### 5.2 Armor Types

| Type | Defense | Initiative Penalty | Example |
|------|---------|-------------------|---------|
| Light | Low | 0 | Leather Armor |
| Medium | Medium | -1 | Chain Mail |
| Heavy | High | -3 | Plate Armor |

### 5.3 Sample Configuration

```json
{
  "armor": [
    {
      "id": "chain-mail",
      "name": "Chain Mail",
      "armorType": "Medium",
      "defenseBonus": 5,
      "initiativePenalty": 1,
      "requirements": {
        "minFortitude": 12
      }
    }
  ]
}
```

---

## 6. Commands & Rendering

### 6.1 Commands

| Command | Action |
|---------|--------|
| `equip [item]` | Equip item from inventory |
| `unequip [slot]` | Remove item from slot |
| `equipment` | Show all equipped items |

### 6.2 Equipment Display

```
╭─────────────────────────────────────╮
│           EQUIPMENT                 │
├─────────────────────────────────────┤
│  Main Hand: Steel Longsword (+7 Atk)│
│  Off Hand:  Iron Shield (+3 Def)    │
│  Head:      Iron Helm (+2 Def)      │
│  Chest:     Chain Mail (+5 Def)     │
│  Hands:     (empty)                 │
│  Feet:      Leather Boots (+1 Def)  │
│  Ring:      Ring of Strength (+2 Atk│
│  Amulet:    (empty)                 │
├─────────────────────────────────────┤
│  Total Bonuses:                     │
│    Attack: +9  Defense: +11         │
│    Initiative: -1                   │
╰─────────────────────────────────────╯
```

---

## 7. Use Cases

### 7.1 Primary Use Cases

- [UC-009: Equip Item](../../use-cases/player/UC-009-equip-item.md)

### 7.2 Edge Cases

- Equipping when slot is occupied (swap)
- Unmet attribute requirements
- Class-restricted items
- Inventory full during swap

---

## 8. Testing

### 8.1 Test Coverage

| Phase | Tests | Areas |
|-------|-------|-------|
| v0.0.7a | ~25 | Weapons, damage types |
| v0.0.7b | ~30 | Equipment slots, effective stats |
| v0.0.7c | 38 | Armor, requirements, penalties |
| **Total** | **482** | +95 from v0.0.6 |

### 8.2 Key Test Scenarios

- Equipment requirement validation
- Effective stat calculation
- Weapon damage type propagation
- Initiative penalty accumulation
- Equipment slot management
- Class restriction enforcement

---

## 9. Known Limitations

### 9.1 Current Limitations

- No durability system
- No socketing or enchanting
- No set bonuses
- No two-handed weapons blocking off-hand

### 9.2 Future Improvements

- Equipment durability and repair
- Item quality tiers
- Enchantment system
- Set bonus mechanics

---

## 10. Related Documentation

- **ADRs**: [ADR-002](../../architecture/ADR-002-json-configuration.md) (equipment config)
- **Use Cases**: UC-009
- **Integration**: v0.0.9 (damage types), v0.0.6 (initiative)
