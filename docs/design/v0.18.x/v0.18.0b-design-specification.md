# v0.18.0b Design Specification: Stress Result Objects

**Version:** 0.18.0b
**Parent:** v0.18.0 (Psychic Stress System)
**Prerequisites:** v0.18.0a Complete (Stress Enums & State)
**Status:** Design Complete
**Estimated Unit Tests:** ~3

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [StressCheckResult](#5-stresscheckresult)
6. [StressApplicationResult](#6-stressapplicationresult)
7. [StressRecoveryResult](#7-stressrecoveryresult)
8. [Data Model Summary](#8-data-model-summary)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

This design specification defines the result value objects for stress system operations. These immutable records capture the before/after state of stress changes, enabling the service layer and UI to respond appropriately to stress events.

v0.18.0b establishes the **Result Object Pattern** for the Trauma Economy — a consistent approach for communicating operation outcomes including previous state, new state, computed deltas, and triggered conditions.

### Key Deliverables

| Category                 | Items                                                                  |
| ------------------------ | ---------------------------------------------------------------------- |
| **Domain Value Objects** | `StressCheckResult`, `StressApplicationResult`, `StressRecoveryResult` |
| **Tests**                | ~3 unit tests                                                          |

### Architectural Significance

These result objects serve as the return types for `IStressService` methods (v0.18.0c) and will be consumed by:

- Combat system for defense penalty updates
- UI layer for threshold transition notifications
- Event system for trauma check triggers
- Analytics for stress source tracking

---

## 2. Feature Overview

```
v0.18.0b Features
├── StressCheckResult (Record)
│   ├── Succeeded: bool
│   ├── Successes: int
│   ├── BaseStress: int
│   ├── FinalStress: int
│   └── ReductionPercent: decimal (computed)
│
├── StressApplicationResult (Record)
│   ├── PreviousStress: int
│   ├── NewStress: int
│   ├── StressGained: int
│   ├── Source: StressSource
│   ├── PreviousThreshold: StressThreshold
│   ├── NewThreshold: StressThreshold
│   ├── ThresholdCrossed: bool (computed)
│   ├── TraumaCheckTriggered: bool
│   └── ResistanceResult: StressCheckResult?
│
└── StressRecoveryResult (Record)
    ├── PreviousStress: int
    ├── NewStress: int
    ├── AmountRecovered: int
    ├── RecoverySource: RestType
    ├── PreviousThreshold: StressThreshold
    ├── NewThreshold: StressThreshold
    └── ThresholdDropped: bool (computed)
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FROM v0.18.0a (Dependencies)                                          │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐            │
│  │ StressThreshold│  │  StressSource  │  │    RestType    │            │
│  └────────────────┘  └────────────────┘  └────────────────┘            │
│           │                   │                   │                     │
│           └───────────────────┼───────────────────┘                     │
│                               │                                         │
│                               ▼                                         │
│  NEW: RESULT VALUE OBJECTS                                              │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     StressCheckResult                            │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + Succeeded: bool                                                │   │
│  │ + Successes: int (0-4+)                                          │   │
│  │ + BaseStress: int                                                │   │
│  │ + FinalStress: int                                               │   │
│  │ + ReductionPercent: decimal (computed from Successes)            │   │
│  │ + WasFullyResisted: bool (computed: FinalStress == 0)            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                   StressApplicationResult                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + PreviousStress: int                                            │   │
│  │ + NewStress: int                                                 │   │
│  │ + StressGained: int                                              │   │
│  │ + Source: StressSource                                           │   │
│  │ + PreviousThreshold: StressThreshold                             │   │
│  │ + NewThreshold: StressThreshold                                  │   │
│  │ + ThresholdCrossed: bool (computed)                              │   │
│  │ + TraumaCheckTriggered: bool                                     │   │
│  │ + ResistanceResult: StressCheckResult?                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    StressRecoveryResult                          │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + PreviousStress: int                                            │   │
│  │ + NewStress: int                                                 │   │
│  │ + AmountRecovered: int                                           │   │
│  │ + RecoverySource: RestType                                       │   │
│  │ + PreviousThreshold: StressThreshold                             │   │
│  │ + NewThreshold: StressThreshold                                  │   │
│  │ + ThresholdDropped: bool (computed)                              │   │
│  │ + IsFullyRecovered: bool (computed: NewStress == 0)              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Resistance Check Reduction Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   STRESS RESISTANCE REDUCTION TABLE                     │
├───────────────┬─────────────┬───────────────────────────────────────────┤
│   Successes   │  Reduction  │              Result                       │
├───────────────┼─────────────┼───────────────────────────────────────────┤
│      0        │     0%      │  Full stress applied                      │
│      1        │    50%      │  Half stress applied                      │
│     2-3       │    75%      │  Quarter stress applied                   │
│     4+        │   100%      │  No stress gained (fully resisted)        │
└───────────────┴─────────────┴───────────────────────────────────────────┘

    Input: BaseStress = 20, Successes = 2
                    │
                    ▼
    ┌───────────────────────────────────────┐
    │  ReductionPercent = 0.75 (75%)        │
    │  FinalStress = 20 * (1 - 0.75) = 5    │
    │  Succeeded = true (Successes > 0)     │
    └───────────────────────────────────────┘
```

### 3.3 Stress Application Flow

```
              ┌──────────────────────────┐
              │    Apply Stress Event    │
              │  (BaseStress, Source)    │
              └────────────┬─────────────┘
                           │
                           ▼
              ┌──────────────────────────┐
              │  Resistance Check?       │
              │  (Has DC and is         │
              │   resistable source)     │
              └────────────┬─────────────┘
                    │            │
                   YES          NO
                    │            │
                    ▼            │
         ┌─────────────────┐     │
         │ StressCheckResult│     │
         │ (calc reduction) │     │
         └────────┬────────┘     │
                  │              │
                  └──────┬───────┘
                         │
                         ▼
              ┌──────────────────────────┐
              │  Calculate New Stress    │
              │  Clamp to 0-100          │
              └────────────┬─────────────┘
                           │
                           ▼
              ┌──────────────────────────┐
              │  Determine Thresholds    │
              │  Previous vs New         │
              └────────────┬─────────────┘
                           │
                           ▼
              ┌──────────────────────────┐
              │  StressApplicationResult │
              │  ├─ ThresholdCrossed?    │
              │  └─ TraumaCheckTriggered?│
              └──────────────────────────┘
```

### 3.4 Threshold Crossing Detection

```
    ┌─────────────────────────────────────────────────────────────────┐
    │              THRESHOLD CROSSING DETECTION                        │
    └─────────────────────────────────────────────────────────────────┘

    STRESS APPLICATION (ThresholdCrossed):
    ┌─────────────────────────────────────────────────────────────────┐
    │  ThresholdCrossed = (NewThreshold > PreviousThreshold)          │
    │                                                                  │
    │  Example: Stress 35 → 45                                        │
    │           Uneasy (1) → Anxious (2)                              │
    │           ThresholdCrossed = true                               │
    └─────────────────────────────────────────────────────────────────┘

    STRESS RECOVERY (ThresholdDropped):
    ┌─────────────────────────────────────────────────────────────────┐
    │  ThresholdDropped = (NewThreshold < PreviousThreshold)          │
    │                                                                  │
    │  Example: Stress 85 → 35                                        │
    │           Breaking (4) → Uneasy (1)                             │
    │           ThresholdDropped = true                               │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 4. User Stories

### US-18b-1: Capture Resistance Check Outcome

**As a** stress service implementer
**I want to** record the outcome of a WILL-based resistance check
**So that** stress reduction can be calculated consistently

**Acceptance Criteria:**

- Successes (0-4+) mapped to reduction percentage
- Original and final stress values captured
- Computed properties for common queries

### US-18b-2: Track Stress Application Changes

**As a** combat system developer
**I want to** see before/after state when stress is applied
**So that** I can update UI and trigger appropriate events

**Acceptance Criteria:**

- Previous and new stress values captured
- Threshold transition detected
- Trauma check trigger flagged
- Optional resistance result included

### US-18b-3: Track Stress Recovery Changes

**As a** rest system developer
**I want to** see recovery results after rest
**So that** I can display appropriate feedback to the player

**Acceptance Criteria:**

- Amount recovered tracked
- Recovery source (RestType) recorded
- Threshold improvement detected

---

## 5. StressCheckResult

### 5.1 Purpose

Captures the outcome of a WILL-based resistance check against incoming stress, including the success count and calculated reduction.

### 5.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/StressCheckResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the result of a stress resistance check.
/// </summary>
/// <remarks>
/// <para>
/// When a character encounters a stress source, they may roll a WILL-based
/// resistance check. The number of successes determines stress reduction:
/// </para>
/// <list type="table">
/// <listheader><term>Successes</term><description>Reduction</description></listheader>
/// <item><term>0</term><description>0% (full stress)</description></item>
/// <item><term>1</term><description>50% (half stress)</description></item>
/// <item><term>2-3</term><description>75% (quarter stress)</description></item>
/// <item><term>4+</term><description>100% (no stress)</description></item>
/// </list>
/// </remarks>
/// <example>
/// <code>
/// // Character rolls 2 successes against 20 base stress
/// var result = StressCheckResult.Create(successes: 2, baseStress: 20);
/// Console.WriteLine(result.ReductionPercent); // 0.75m (75%)
/// Console.WriteLine(result.FinalStress);      // 5
/// Console.WriteLine(result.Succeeded);        // true
/// </code>
/// </example>
public readonly record struct StressCheckResult
{
    /// <summary>
    /// Gets whether the resistance check had any successes.
    /// </summary>
    /// <remarks>
    /// True if <see cref="Successes"/> > 0, meaning some stress was reduced.
    /// </remarks>
    public bool Succeeded { get; }

    /// <summary>
    /// Gets the number of successes rolled on the resistance check.
    /// </summary>
    /// <remarks>
    /// Typically 0-4+, based on WILL dice pool vs DC.
    /// </remarks>
    public int Successes { get; }

    /// <summary>
    /// Gets the original stress amount before resistance reduction.
    /// </summary>
    public int BaseStress { get; }

    /// <summary>
    /// Gets the final stress amount after resistance reduction.
    /// </summary>
    /// <remarks>
    /// Calculated as: BaseStress × (1 - ReductionPercent), rounded down.
    /// </remarks>
    public int FinalStress { get; }

    /// <summary>
    /// Gets the reduction percentage based on successes.
    /// </summary>
    /// <remarks>
    /// <list type="bullet">
    /// <item>0 successes: 0.00m (0%)</item>
    /// <item>1 success: 0.50m (50%)</item>
    /// <item>2-3 successes: 0.75m (75%)</item>
    /// <item>4+ successes: 1.00m (100%)</item>
    /// </list>
    /// </remarks>
    public decimal ReductionPercent { get; }

    /// <summary>
    /// Gets whether the stress was fully resisted (no stress gained).
    /// </summary>
    public bool WasFullyResisted => FinalStress == 0;

    /// <summary>
    /// Gets whether partial resistance occurred (some but not all stress reduced).
    /// </summary>
    public bool WasPartiallyResisted => Succeeded && FinalStress > 0;

    /// <summary>
    /// Private constructor to enforce factory pattern.
    /// </summary>
    private StressCheckResult(int successes, int baseStress)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(successes);
        ArgumentOutOfRangeException.ThrowIfNegative(baseStress);

        Successes = successes;
        BaseStress = baseStress;
        Succeeded = successes > 0;
        ReductionPercent = CalculateReductionPercent(successes);
        FinalStress = (int)(baseStress * (1m - ReductionPercent));
    }

    /// <summary>
    /// Creates a stress check result from the number of successes and base stress.
    /// </summary>
    /// <param name="successes">Number of successes on the resistance check.</param>
    /// <param name="baseStress">The original stress amount before reduction.</param>
    /// <returns>A new <see cref="StressCheckResult"/> instance.</returns>
    public static StressCheckResult Create(int successes, int baseStress) =>
        new(successes, baseStress);

    /// <summary>
    /// Creates a result representing no resistance check (full stress applied).
    /// </summary>
    /// <param name="baseStress">The stress amount applied without resistance.</param>
    /// <returns>A result with 0 successes and full stress.</returns>
    public static StressCheckResult NoResistance(int baseStress) =>
        new(0, baseStress);

    /// <summary>
    /// Calculates the reduction percentage from success count.
    /// </summary>
    private static decimal CalculateReductionPercent(int successes) => successes switch
    {
        0 => 0.00m,
        1 => 0.50m,
        2 or 3 => 0.75m,
        _ => 1.00m // 4+ successes = full resistance
    };

    /// <inheritdoc/>
    public override string ToString() =>
        $"Resistance: {Successes} successes, {ReductionPercent:P0} reduction ({BaseStress} → {FinalStress})";
}
```

---

## 6. StressApplicationResult

### 6.1 Purpose

Captures the complete outcome of applying stress to a character, including threshold transitions and trauma check triggers.

### 6.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/StressApplicationResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the result of applying stress to a character.
/// </summary>
/// <remarks>
/// <para>
/// This result object captures:
/// <list type="bullet">
/// <item>Previous and new stress values</item>
/// <item>Threshold transitions for UI notification</item>
/// <item>Trauma check trigger for game logic</item>
/// <item>Optional resistance check result</item>
/// </list>
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var result = StressApplicationResult.Create(
///     previousStress: 35,
///     newStress: 65,
///     source: StressSource.Combat,
///     resistanceResult: checkResult);
///
/// if (result.ThresholdCrossed)
///     ShowThresholdNotification(result.NewThreshold);
///
/// if (result.TraumaCheckTriggered)
///     InitiateTraumaCheck();
/// </code>
/// </example>
public readonly record struct StressApplicationResult
{
    /// <summary>
    /// Gets the stress value before application.
    /// </summary>
    public int PreviousStress { get; }

    /// <summary>
    /// Gets the stress value after application.
    /// </summary>
    public int NewStress { get; }

    /// <summary>
    /// Gets the actual stress gained (after any resistance).
    /// </summary>
    public int StressGained { get; }

    /// <summary>
    /// Gets the source category of the stress.
    /// </summary>
    public StressSource Source { get; }

    /// <summary>
    /// Gets the threshold tier before stress application.
    /// </summary>
    public StressThreshold PreviousThreshold { get; }

    /// <summary>
    /// Gets the threshold tier after stress application.
    /// </summary>
    public StressThreshold NewThreshold { get; }

    /// <summary>
    /// Gets whether a threshold boundary was crossed (stress increased to new tier).
    /// </summary>
    /// <remarks>
    /// True when NewThreshold > PreviousThreshold.
    /// Used to trigger UI notifications and sound effects.
    /// </remarks>
    public bool ThresholdCrossed { get; }

    /// <summary>
    /// Gets whether stress reached 100, triggering a Trauma Check.
    /// </summary>
    public bool TraumaCheckTriggered { get; }

    /// <summary>
    /// Gets the optional resistance check result, if a check was made.
    /// </summary>
    /// <remarks>
    /// Null if no resistance check was performed (e.g., unavoidable stress).
    /// </remarks>
    public StressCheckResult? ResistanceResult { get; }

    /// <summary>
    /// Gets whether resistance was attempted and reduced some stress.
    /// </summary>
    public bool WasResisted => ResistanceResult?.Succeeded ?? false;

    /// <summary>
    /// Gets the defense penalty change from this stress application.
    /// </summary>
    public int DefensePenaltyChange => (NewStress / 20) - (PreviousStress / 20);

    /// <summary>
    /// Private constructor to enforce factory pattern.
    /// </summary>
    private StressApplicationResult(
        int previousStress,
        int newStress,
        StressSource source,
        StressCheckResult? resistanceResult)
    {
        PreviousStress = previousStress;
        NewStress = Math.Clamp(newStress, StressState.MinStress, StressState.MaxStress);
        StressGained = NewStress - previousStress;
        Source = source;
        PreviousThreshold = StressThresholdExtensions.FromStressValue(previousStress);
        NewThreshold = StressThresholdExtensions.FromStressValue(NewStress);
        ThresholdCrossed = NewThreshold > PreviousThreshold;
        TraumaCheckTriggered = NewStress >= StressState.MaxStress;
        ResistanceResult = resistanceResult;
    }

    /// <summary>
    /// Creates a stress application result.
    /// </summary>
    /// <param name="previousStress">Stress before application.</param>
    /// <param name="newStress">Stress after application (will be clamped).</param>
    /// <param name="source">The source category of the stress.</param>
    /// <param name="resistanceResult">Optional resistance check result.</param>
    /// <returns>A new <see cref="StressApplicationResult"/> instance.</returns>
    public static StressApplicationResult Create(
        int previousStress,
        int newStress,
        StressSource source,
        StressCheckResult? resistanceResult = null) =>
        new(previousStress, newStress, source, resistanceResult);

    /// <inheritdoc/>
    public override string ToString() =>
        $"Stress: {PreviousStress} → {NewStress} [{Source}] " +
        $"(Threshold: {PreviousThreshold} → {NewThreshold}" +
        $"{(ThresholdCrossed ? " CROSSED" : "")}" +
        $"{(TraumaCheckTriggered ? " TRAUMA!" : "")})";
}
```

---

## 7. StressRecoveryResult

### 7.1 Purpose

Captures the outcome of stress recovery from rest or other healing sources.

### 7.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/StressRecoveryResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the result of stress recovery.
/// </summary>
/// <remarks>
/// <para>
/// Created when a character recovers stress through rest or other means.
/// Tracks the recovery amount, source, and any threshold improvements.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// // Character with WILL 4 takes Long Rest (WILL × 5 = 20 recovery)
/// var result = StressRecoveryResult.Create(
///     previousStress: 75,
///     newStress: 55,
///     recoverySource: RestType.Long);
///
/// Console.WriteLine(result.AmountRecovered);   // 20
/// Console.WriteLine(result.ThresholdDropped);  // true (Panicked → Anxious)
/// </code>
/// </example>
public readonly record struct StressRecoveryResult
{
    /// <summary>
    /// Gets the stress value before recovery.
    /// </summary>
    public int PreviousStress { get; }

    /// <summary>
    /// Gets the stress value after recovery.
    /// </summary>
    public int NewStress { get; }

    /// <summary>
    /// Gets the amount of stress recovered.
    /// </summary>
    public int AmountRecovered { get; }

    /// <summary>
    /// Gets the source of the recovery.
    /// </summary>
    public RestType RecoverySource { get; }

    /// <summary>
    /// Gets the threshold tier before recovery.
    /// </summary>
    public StressThreshold PreviousThreshold { get; }

    /// <summary>
    /// Gets the threshold tier after recovery.
    /// </summary>
    public StressThreshold NewThreshold { get; }

    /// <summary>
    /// Gets whether a threshold boundary was crossed downward.
    /// </summary>
    /// <remarks>
    /// True when NewThreshold &lt; PreviousThreshold.
    /// Used to trigger positive UI feedback.
    /// </remarks>
    public bool ThresholdDropped { get; }

    /// <summary>
    /// Gets whether stress was fully recovered (now at 0).
    /// </summary>
    public bool IsFullyRecovered => NewStress == StressState.MinStress;

    /// <summary>
    /// Gets whether the character is now calm (below 20 stress).
    /// </summary>
    public bool IsNowCalm => NewThreshold == StressThreshold.Calm;

    /// <summary>
    /// Gets the defense penalty improvement from this recovery.
    /// </summary>
    public int DefensePenaltyImprovement => (PreviousStress / 20) - (NewStress / 20);

    /// <summary>
    /// Private constructor to enforce factory pattern.
    /// </summary>
    private StressRecoveryResult(
        int previousStress,
        int newStress,
        RestType recoverySource)
    {
        PreviousStress = previousStress;
        NewStress = Math.Max(newStress, StressState.MinStress);
        AmountRecovered = previousStress - NewStress;
        RecoverySource = recoverySource;
        PreviousThreshold = StressThresholdExtensions.FromStressValue(previousStress);
        NewThreshold = StressThresholdExtensions.FromStressValue(NewStress);
        ThresholdDropped = NewThreshold < PreviousThreshold;
    }

    /// <summary>
    /// Creates a stress recovery result.
    /// </summary>
    /// <param name="previousStress">Stress before recovery.</param>
    /// <param name="newStress">Stress after recovery (will be clamped to min 0).</param>
    /// <param name="recoverySource">The type of rest that provided recovery.</param>
    /// <returns>A new <see cref="StressRecoveryResult"/> instance.</returns>
    public static StressRecoveryResult Create(
        int previousStress,
        int newStress,
        RestType recoverySource) =>
        new(previousStress, newStress, recoverySource);

    /// <inheritdoc/>
    public override string ToString() =>
        $"Recovery: {PreviousStress} → {NewStress} (-{AmountRecovered}) [{RecoverySource}] " +
        $"(Threshold: {PreviousThreshold} → {NewThreshold}" +
        $"{(ThresholdDropped ? " IMPROVED" : "")})";
}
```

---

## 8. Data Model Summary

### 8.1 New Domain Types

| Type                      | Kind          | Layer  | File Path                                 |
| ------------------------- | ------------- | ------ | ----------------------------------------- |
| `StressCheckResult`       | Record Struct | Domain | `ValueObjects/StressCheckResult.cs`       |
| `StressApplicationResult` | Record Struct | Domain | `ValueObjects/StressApplicationResult.cs` |
| `StressRecoveryResult`    | Record Struct | Domain | `ValueObjects/StressRecoveryResult.cs`    |

### 8.2 Dependencies from v0.18.0a

| Type                        | Usage                                          |
| --------------------------- | ---------------------------------------------- |
| `StressThreshold`           | Threshold tier comparison in results           |
| `StressSource`              | Categorize stress origin in application result |
| `RestType`                  | Categorize recovery source in recovery result  |
| `StressState`               | Min/Max constants, threshold calculation       |
| `StressThresholdExtensions` | Convert stress values to thresholds            |

---

## 9. Logging Specifications

### 9.1 Log Events

| Event             | Level       | Template                                                                                                     | Properties                                                 |
| ----------------- | ----------- | ------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------- |
| Resistance Result | Debug       | `"Stress resistance: {Successes} successes, {ReductionPercent:P0} reduction ({BaseStress} → {FinalStress})"` | Successes, ReductionPercent, BaseStress, FinalStress       |
| Stress Applied    | Information | `"Stress applied: {PreviousStress} → {NewStress} [{Source}]"`                                                | PreviousStress, NewStress, Source                          |
| Threshold Crossed | Information | `"Stress threshold crossed: {PreviousThreshold} → {NewThreshold}"`                                           | PreviousThreshold, NewThreshold                            |
| Trauma Triggered  | Warning     | `"TRAUMA CHECK TRIGGERED: Stress at {NewStress}"`                                                            | NewStress                                                  |
| Stress Recovered  | Information | `"Stress recovered: {AmountRecovered} from {RecoverySource} ({PreviousStress} → {NewStress})"`               | AmountRecovered, RecoverySource, PreviousStress, NewStress |

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature                 | Test Count |
| ----------------------- | ---------- |
| StressCheckResult       | ~1         |
| StressApplicationResult | ~1         |
| StressRecoveryResult    | ~1         |
| **Total**               | **~3**     |

### 10.2 StressCheckResultTests

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressCheckResultTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.ValueObjects;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.ValueObjects;

[TestFixture]
public class StressCheckResultTests
{
    [Test]
    [TestCase(0, 20, 0.00, 20)]
    [TestCase(1, 20, 0.50, 10)]
    [TestCase(2, 20, 0.75, 5)]
    [TestCase(3, 20, 0.75, 5)]
    [TestCase(4, 20, 1.00, 0)]
    [TestCase(5, 20, 1.00, 0)]
    public void Create_CalculatesReductionCorrectly(
        int successes, int baseStress, decimal expectedPercent, int expectedFinal)
    {
        // Arrange & Act
        var result = StressCheckResult.Create(successes, baseStress);

        // Assert
        result.ReductionPercent.Should().Be(expectedPercent);
        result.FinalStress.Should().Be(expectedFinal);
        result.Succeeded.Should().Be(successes > 0);
    }
}
```

### 10.3 StressApplicationResultTests

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressApplicationResultTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.ValueObjects;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

[TestFixture]
public class StressApplicationResultTests
{
    [Test]
    [TestCase(35, 65, true)]   // Uneasy → Panicked
    [TestCase(35, 38, false)]  // Uneasy → Uneasy (same tier)
    [TestCase(0, 15, false)]   // Calm → Calm
    [TestCase(75, 100, true)]  // Panicked → Trauma
    public void Create_DetectsThresholdCrossedCorrectly(
        int previous, int newStress, bool expectedCrossed)
    {
        // Arrange & Act
        var result = StressApplicationResult.Create(
            previous, newStress, StressSource.Combat);

        // Assert
        result.ThresholdCrossed.Should().Be(expectedCrossed);
        result.TraumaCheckTriggered.Should().Be(newStress >= 100);
    }
}
```

### 10.4 StressRecoveryResultTests

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressRecoveryResultTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.ValueObjects;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

[TestFixture]
public class StressRecoveryResultTests
{
    [Test]
    [TestCase(85, 35, true)]   // Breaking → Uneasy
    [TestCase(85, 82, false)]  // Breaking → Breaking (same tier)
    [TestCase(50, 0, true)]    // Anxious → Calm
    public void Create_DetectsThresholdDroppedCorrectly(
        int previous, int newStress, bool expectedDropped)
    {
        // Arrange & Act
        var result = StressRecoveryResult.Create(
            previous, newStress, RestType.Long);

        // Assert
        result.ThresholdDropped.Should().Be(expectedDropped);
        result.AmountRecovered.Should().Be(previous - newStress);
    }
}
```

---

## 11. Use Cases

### UC-001: Process Resistance Check

**Actor:** StressService
**Flow:** Roll WILL dice → Count successes → Create StressCheckResult → Calculate reduced stress
**Precondition:** Stress source with DC
**Postcondition:** Final stress amount determined

### UC-002: Apply Combat Stress

**Actor:** CombatService
**Flow:** Determine base stress → Optional resistance → Create StressApplicationResult → Update character → Check for trauma
**Precondition:** Combat stress event occurs
**Postcondition:** Character stress updated, UI notified

### UC-003: Process Rest Recovery

**Actor:** RestService
**Flow:** Calculate recovery → Apply to character → Create StressRecoveryResult → Display feedback
**Precondition:** Character takes rest
**Postcondition:** Stress reduced, threshold improvement detected

---

## 12. Deliverable Checklist

### Domain Layer — Value Objects

- [x] `src/Core/RuneAndRust.Domain/ValueObjects/StressCheckResult.cs`
- [x] `src/Core/RuneAndRust.Domain/ValueObjects/StressApplicationResult.cs`
- [x] `src/Core/RuneAndRust.Domain/ValueObjects/StressRecoveryResult.cs`

### Unit Tests

- [x] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressCheckResultTests.cs`
- [x] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressApplicationResultTests.cs`
- [x] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressRecoveryResultTests.cs`

### Documentation

- [x] XML documentation on all public members
- [x] Code examples in remarks sections
- [x] Update scope breakdown to mark v0.18.0b complete

---

## 13. Acceptance Criteria

### Functional Criteria

- [x] `StressCheckResult.ReductionPercent` returns 0.00m for 0 successes
- [x] `StressCheckResult.ReductionPercent` returns 0.50m for 1 success
- [x] `StressCheckResult.ReductionPercent` returns 0.75m for 2-3 successes
- [x] `StressCheckResult.ReductionPercent` returns 1.00m for 4+ successes
- [x] `StressCheckResult.FinalStress` correctly applies reduction to base stress
- [x] `StressApplicationResult.ThresholdCrossed` is true when NewThreshold > PreviousThreshold
- [x] `StressApplicationResult.TraumaCheckTriggered` is true when NewStress >= 100
- [x] `StressRecoveryResult.ThresholdDropped` is true when NewThreshold < PreviousThreshold
- [x] `StressRecoveryResult.AmountRecovered` equals PreviousStress - NewStress

### Quality Criteria

- [x] Build succeeds with 0 errors
- [x] Build succeeds with 0 warnings
- [x] All ~3 unit tests pass
- [x] XML documentation complete on all public types and members
- [x] Code follows project conventions

---

## 14. Dependencies

### Required from v0.18.0a

| Type                        | Usage                      |
| --------------------------- | -------------------------- |
| `StressThreshold`           | Threshold tier in results  |
| `StressSource`              | Source categorization      |
| `RestType`                  | Recovery source type       |
| `StressState`               | Min/Max constants          |
| `StressThresholdExtensions` | `FromStressValue()` method |

### Provides to v0.18.0c

| Type                      | Usage                              |
| ------------------------- | ---------------------------------- |
| `StressCheckResult`       | Return type for `RollResistance()` |
| `StressApplicationResult` | Return type for `ApplyStress()`    |
| `StressRecoveryResult`    | Return type for `RecoverStress()`  |

---

## 15. Future Considerations

### Deferred to v0.18.0c

- `IStressService` interface using these result types

### Deferred to v0.18.0d

- `StressService` implementation creating these results

### Out of Scope

- Trauma check result object (v0.18.3)
- Corruption-related stress events (v0.18.5)

---

_Document Version: 1.0_
_Last Updated: 2026-01-27_
