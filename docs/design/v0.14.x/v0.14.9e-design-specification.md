# v0.14.9e Design Specification: Capture Template Schema

**Version:** 0.14.9e
**Parent:** v0.14.9 (Advanced Descriptor Configuration Schemas)
**Prerequisites:** v0.14.8 Complete (Dice Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Schema Root Definition](#4-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [Category Structure](#42-category-structure)
   - 4.3 [Keyword Inheritance](#43-keyword-inheritance)
5. [CaptureTemplate Definition](#5-capturetemplate-definition)
   - 5.1 [Core Properties](#51-core-properties)
   - 5.2 [Content Constraints](#52-content-constraints)
   - 5.3 [Keyword Matching](#53-keyword-matching)
6. [CaptureType Classification](#6-capturetype-classification)
   - 6.1 [Type Definitions](#61-type-definitions)
   - 6.2 [Voice Style Guidelines](#62-voice-style-guidelines)
   - 6.3 [Source Context Patterns](#63-source-context-patterns)
7. [Quality and Reward System](#7-quality-and-reward-system)
   - 7.1 [Quality Values](#71-quality-values)
   - 7.2 [Legend Progression](#72-legend-progression)
   - 7.3 [Default Values](#73-default-values)
8. [Tag Metadata System](#8-tag-metadata-system)
   - 8.1 [Tag Properties](#81-tag-properties)
   - 8.2 [Tag Conventions](#82-tag-conventions)
   - 8.3 [Filtering Patterns](#83-filtering-patterns)
9. [Domain 4 Compliance](#9-domain-4-compliance)
   - 9.1 [Compliance Requirements](#91-compliance-requirements)
   - 9.2 [Forbidden Patterns](#92-forbidden-patterns)
   - 9.3 [Correction Examples](#93-correction-examples)
10. [AAM-VOICE Layer 2 Guidelines](#10-aam-voice-layer-2-guidelines)
11. [Configuration Schema](#11-configuration-schema)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)
19. [Appendix: Schema Validation Examples](#19-appendix-schema-validation-examples)
20. [Appendix: Existing Content Reference](#20-appendix-existing-content-reference)

---

## 1. Executive Summary

Version 0.14.9e introduces the **Capture Template Schema** (`capture-templates.schema.json`), which provides a comprehensive JSON Schema Draft-07 specification for validating lore capture templates. This schema enables full customization of discoverable content fragments, Codex keyword matching, quality/reward values, and capture type classification for the Field Guide system—all without code changes.

The Capture Template Schema converts the existing Draft-2020-12 schema from `docs/design/descriptors/capture-templates/schema/capture-template.schema.json` into JSON Schema Draft-07 format for consistency with the v0.14.x schema infrastructure. This system supports the core knowledge discovery mechanics of Rune & Rust, where players collect Data Captures that unlock Codex entries and contribute to Legend progression.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `capture-templates.schema.json` (JSON Schema Draft-07 conversion) |
| **Schema Definitions** | `CaptureTemplateCollection`, `CaptureTemplate`, `CaptureType` |
| **Configuration Updates** | Update 6 existing capture template files with schema reference |
| **Tests** | ~6 new unit tests |

### Architectural Significance

This version provides:
- **Capture template structure** - ID, type, content, source, keywords, quality, tags
- **Capture type classification** - 6 types (TextFragment, EchoRecording, VisualRecord, Specimen, OralHistory, RunicTrace)
- **Codex keyword matching** - Category-level defaults with per-template overrides
- **Quality/reward values** - 1-100 range affecting Legend progression
- **Domain 4 compliance** - No precision measurements (POST-Glitch societies are archaeologists, not engineers)
- **AAM-VOICE Layer 2** - Medieval-flavored vocabulary for technical concepts
- **Tag metadata** - Filtering and categorization without in-game display

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│               v0.14.9 ADVANCED DESCRIPTOR CONFIGURATION SCHEMAS              │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.9a: dialogue.schema.json (dialogue trees)                        │
  │  v0.14.9b: ability-descriptors.schema.json (Galdr, weapon arts)        │
  │  v0.14.9c: npc-descriptors.schema.json (NPC flavor)                    │
  │  v0.14.9d: psychological-descriptors.schema.json (mental states)       │
  │  v0.14.9e: capture-templates.schema.json ◀── THIS VERSION              │
  └─────────────────────────────────────────────────────────────────────────┘

  Source Material:
  └── docs/design/descriptors/capture-templates/
      ├── schema/capture-template.schema.json (Draft-2020-12 source)
      ├── categories/rusted-servitor.json
      ├── categories/blighted-creature.json
      ├── categories/ancient-ruin.json
      ├── categories/industrial-site.json
      ├── categories/generic-container.json
      └── categories/field-guide-triggers.json

  Related Systems:
  • Field Guide system (capture collection UI)
  • Codex system (keyword matching, entry unlocking)
  • Legend system (quality-based progression)
  • Data Capture acquisition (gameplay triggers)
```

---

## 2. Feature Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CAPTURE TEMPLATE SCHEMA FEATURE TREE                      │
└─────────────────────────────────────────────────────────────────────────────┘

capture-templates.schema.json
├── Root Configuration
│   ├── $schema reference
│   ├── category identifier (kebab-case)
│   ├── version identifier (semver)
│   ├── description (author notes)
│   ├── matchKeywords (category defaults)
│   └── templates (array)
│
├── Capture Template Structure
│   ├── id (globally unique, kebab-case)
│   ├── type (CaptureType enum)
│   ├── fragmentContent (20-1000 chars)
│   ├── source (5-100 chars)
│   ├── matchKeywords (optional override)
│   ├── quality (1-100, default 15)
│   ├── tags (metadata array)
│   └── domain4Notes (author documentation)
│
├── CaptureType Classification
│   ├── TextFragment (written records)
│   ├── EchoRecording (audio logs)
│   ├── VisualRecord (diagrams, images)
│   ├── Specimen (biological samples)
│   ├── OralHistory (verbal accounts)
│   └── RunicTrace (magical analysis)
│
├── Keyword Matching System
│   ├── Category-level defaults
│   ├── Per-template overrides
│   └── Codex entry correlation
│
├── Quality/Reward System
│   ├── Quality range (1-100)
│   ├── Legend progression
│   └── Default value (15)
│
├── Tag Metadata
│   ├── Author categorization
│   ├── Filtering support
│   └── Not displayed in-game
│
└── Compliance Systems
    ├── Domain 4 (no precision measurements)
    └── AAM-VOICE Layer 2 (medieval vocabulary)
```

---

## 3. Architecture Diagrams

### 3.1 Capture Template Collection Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                CAPTURE TEMPLATE COLLECTION ARCHITECTURE                      │
└─────────────────────────────────────────────────────────────────────────────┘

              rusted-servitor.json
          ┌───────────────────────────────────────┐
          │  {                                    │
          │    "$schema": "...",                  │
          │    "category": "rusted-servitor",    │
          │    "version": "1.0.0",                │
          │    "matchKeywords": [                 │
          │      "servitor", "automaton",         │
          │      "machine", "mechanical"          │
          │    ],                                 │
          │    "templates": [...]                 │
          │  }                                    │
          └─────────────────┬─────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         CAPTURE TEMPLATE                                     │
│─────────────────────────────────────────────────────────────────────────────│
│  {                                                                           │
│    "id": "servitor-fungal-infection",                                       │
│    "type": "Specimen",                                                       │
│    "fragmentContent": "The servo-motor shows signs of organic fungal        │
│                        infiltration. Mycelial threads have woven through    │
│                        the mechanical joints, creating an unsettling        │
│                        fusion of rust and growth.",                         │
│    "source": "Servitor examination",                                         │
│    "quality": 15,                                                            │
│    "tags": ["servitor", "fungal", "blight-adjacent"]                         │
│  }                                                                           │
│                                                                              │
│  Keywords: Inherits ["servitor", "automaton", "machine", "mechanical"]       │
│  Quality: 15 → Standard Legend reward                                        │
│  Type: Specimen → Analytical, clinical voice style                           │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Keyword Inheritance Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       KEYWORD INHERITANCE FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

                    Category File: rusted-servitor.json
                   ┌───────────────────────────────────┐
                   │  "matchKeywords": [               │
                   │    "servitor",                    │
                   │    "automaton",                   │
                   │    "machine",                     │
                   │    "mechanical"                   │
                   │  ]                                │
                   └─────────────────┬─────────────────┘
                                     │
                                     │ DEFAULT
                                     ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │                              TEMPLATES                                    │
   └─────────────────────────────────────────────────────────────────────────┘
           │                    │                    │
           ▼                    ▼                    ▼
   ┌───────────────┐    ┌───────────────┐    ┌───────────────┐
   │ servitor-     │    │ servitor-     │    │ servitor-     │
   │ fungal-       │    │ maintenance-  │    │ aetheric-     │
   │ infection     │    │ log           │    │ resonance     │
   │               │    │               │    │               │
   │ matchKeywords:│    │ matchKeywords:│    │ matchKeywords:│
   │ (inherited)   │    │ OVERRIDE:     │    │ OVERRIDE:     │
   │ [servitor,    │    │ [servitor,    │    │ [servitor,    │
   │  automaton,   │    │  automaton,   │    │  aesir, rune, │
   │  machine,     │    │  aesir]       │    │  aetheric]    │
   │  mechanical]  │    │               │    │               │
   └───────────────┘    └───────────────┘    └───────────────┘
           │                    │                    │
           └────────────┬───────┴───────────────────┘
                        │
                        ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │                         CODEX MATCHING                                    │
   │─────────────────────────────────────────────────────────────────────────│
   │  When capture acquired:                                                   │
   │  1. Get template's effective keywords                                     │
   │  2. Search Codex entries for matching keywords                            │
   │  3. Award Legend progress to matched entries                              │
   │  4. Quality value determines progress amount                              │
   └─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Data Capture Acquisition Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     DATA CAPTURE ACQUISITION FLOW                            │
└─────────────────────────────────────────────────────────────────────────────┘

              Player Action Triggers Capture
                        │
        ┌───────────────┼───────────────┐
        ▼               ▼               ▼
   ┌─────────┐    ┌─────────┐    ┌─────────┐
   │ Examine │    │ Search  │    │ Defeat  │
   │ Object  │    │Container│    │ Enemy   │
   └────┬────┘    └────┬────┘    └────┬────┘
        │              │              │
        └──────┬───────┴──────────────┘
               │
               ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │  1. IDENTIFY CATEGORY                                                     │
   │  Based on context: rusted-servitor, blighted-creature, ancient-ruin, etc. │
   └─────────────────────────────────────────────────────────────────────────┘
               │
               ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │  2. SELECT TEMPLATE                                                       │
   │  Random or weighted selection from category templates                     │
   └─────────────────────────────────────────────────────────────────────────┘
               │
               ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │  3. CREATE DATA CAPTURE                                                   │
   │  Instantiate capture with:                                                │
   │  • ID reference                                                           │
   │  • Fragment content                                                       │
   │  • Source context                                                         │
   │  • Effective keywords (template or category default)                      │
   │  • Quality value                                                          │
   └─────────────────────────────────────────────────────────────────────────┘
               │
               ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │  4. DISPLAY TO PLAYER                                                     │
   │                                                                           │
   │  ┌─────────────────────────────────────────────────────────────────┐     │
   │  │  DATA CAPTURE ACQUIRED                                          │     │
   │  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │     │
   │  │  Type: [Specimen]                                               │     │
   │  │  Source: Servitor examination                                   │     │
   │  │  ──────────────────────────────────────────────────────────────│     │
   │  │  "The servo-motor shows signs of organic fungal infiltration.  │     │
   │  │   Mycelial threads have woven through the mechanical joints,   │     │
   │  │   creating an unsettling fusion of rust and growth."           │     │
   │  │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │     │
   │  │  [Added to Field Guide]                                         │     │
   │  └─────────────────────────────────────────────────────────────────┘     │
   └─────────────────────────────────────────────────────────────────────────┘
               │
               ▼
   ┌─────────────────────────────────────────────────────────────────────────┐
   │  5. PROCESS CODEX MATCHING                                                │
   │  Keywords ["servitor", "automaton", "machine", "mechanical"]              │
   │  Match against Codex entries → Award Legend progress                      │
   │  Quality 15 → Standard contribution                                       │
   └─────────────────────────────────────────────────────────────────────────┘
```

### 3.4 CaptureType Selection Matrix

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      CAPTURETYPE SELECTION MATRIX                            │
└─────────────────────────────────────────────────────────────────────────────┘

  Context                    Recommended Type      Voice Style
  ─────────────────────────────────────────────────────────────────────────────
  Written records            TextFragment          Scholarly, formal, historical
  Notes, letters                                   "Recovered maintenance logs..."

  Audio logs                 EchoRecording         Personal, urgent, corrupted
  Memory recordings                                "...Unit 7-Alpha reporting..."

  Diagrams, images           VisualRecord          Descriptive, observational
  Schematics                                       "Crystalline growths cluster..."

  Biological samples         Specimen              Analytical, clinical, scientific
  Tissue analysis                                  "Tissue samples reveal..."

  NPC dialogue               OralHistory           Conversational, dialectal
  Rumors, traditions                               "The veterans speak of..."

  Magical traces             RunicTrace            Mystical, precise, layered
  Rune analysis                                    "Faint Aetheric resonance..."
  ─────────────────────────────────────────────────────────────────────────────

  Category → Type Tendencies:
  ════════════════════════════
  rusted-servitor:     Specimen, VisualRecord, RunicTrace, TextFragment
  blighted-creature:   Specimen, VisualRecord, RunicTrace
  ancient-ruin:        TextFragment, OralHistory, VisualRecord
  industrial-site:     EchoRecording, VisualRecord, TextFragment
  generic-container:   TextFragment, OralHistory
  field-guide-triggers: OralHistory, TextFragment
```

### 3.5 Quality-to-Legend Mapping

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       QUALITY-TO-LEGEND MAPPING                              │
└─────────────────────────────────────────────────────────────────────────────┘

        Quality Value: 1                                          100
        ├───────────┼───────────┼───────────┼───────────┼───────────┤
               1-10      11-25      26-50      51-75      76-100
              Minor    Standard   Notable   Significant Exceptional
                │          │          │          │          │
                ▼          ▼          ▼          ▼          ▼
         ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
         │ Low     │ │ Normal  │ │ Enhanced│ │ High    │ │ Maximum │
         │ Legend  │ │ Legend  │ │ Legend  │ │ Legend  │ │ Legend  │
         │ reward  │ │ reward  │ │ reward  │ │ reward  │ │ reward  │
         └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘
              │          │          │          │          │
              ▼          ▼          ▼          ▼          ▼
         Common     Regular    Important    Major      Critical
         background discoveries revelations  story      plot
         lore                              pieces     elements

  Default Quality: 15 (Standard reward level)

  Quality Assignment Guidelines:
  ═════════════════════════════
  1-10:   Ambient flavor text, common observations
  11-25:  Normal discoveries (DEFAULT = 15)
  26-50:  Reveals meaningful connections or history
  51-75:  Major narrative revelations
  76-100: Critical plot points, rare discoveries

  Legend Contribution Formula (runtime):
  ══════════════════════════════════════
  LegendProgress = BaseProgress × (Quality / 100)

  Example:
  • Quality 15 capture → 15% of max Legend contribution
  • Quality 50 capture → 50% of max Legend contribution
  • Quality 100 capture → 100% of max Legend contribution
```

### 3.6 Category Organization

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        CATEGORY ORGANIZATION                                 │
└─────────────────────────────────────────────────────────────────────────────┘

  capture-templates/
  │
  ├── schema/
  │   └── capture-template.schema.json     (This schema)
  │
  └── categories/
      │
      ├── rusted-servitor.json ─────────┐
      │   4 templates                   │
      │   Keywords: servitor, automaton │
      │   Focus: Mechanical encounters  │
      │                                 │
      ├── blighted-creature.json ───────┤
      │   3 templates                   │
      │   Keywords: blight, corrupted   │
      │   Focus: Corruption creatures   │
      │                                 │
      ├── ancient-ruin.json ────────────┤
      │   3 templates                   │
      │   Keywords: ruin, ancient       │
      │   Focus: Pre-Glitch discoveries │
      │                                 │
      ├── industrial-site.json ─────────┤  Organized by
      │   3 templates                   │  encounter
      │   Keywords: industrial, forge   │  context
      │   Focus: Factory locations      │
      │                                 │
      ├── generic-container.json ───────┤
      │   3 templates                   │
      │   Keywords: container, chest    │
      │   Focus: General container loot │
      │                                 │
      └── field-guide-triggers.json ────┘
          3 templates
          Keywords: guide, manual
          Focus: Gameplay tutorials

  Total: 6 category files, 19 templates
```

### 3.7 Schema Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           SCHEMA LAYER DIAGRAM                               │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              PRESENTATION                                    │
│                                                                              │
│  Field Guide UI displays captured content                                    │
│  • Data Capture acquisition popup                                            │
│  • Field Guide collection browser                                            │
│  • Codex entry progress indicators                                           │
│  • Legend contribution notifications                                         │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              APPLICATION                                     │
│                                                                              │
│  CaptureTemplateService manages template selection and instantiation         │
│  • GetTemplatesByCategory(category) → template list                          │
│  • SelectTemplate(category) → weighted random selection                      │
│  • GetEffectiveKeywords(template) → resolves inheritance                     │
│  • CreateCapture(template, context) → instantiates capture                   │
│  • CalculateLegendContribution(quality) → Legend points                      │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             DOMAIN LAYER                                     │
│                                                                              │
│  Capture template definitions and types                                      │
│  • CaptureTemplateCollection (category container)                            │
│  • CaptureTemplate (individual template definition)                          │
│  • CaptureType enum (6 types)                                                │
│  • DataCapture entity (runtime instance)                                     │
│  • CodexEntry reference (keyword matching target)                            │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           INFRASTRUCTURE                                     │
│                                                                              │
│  CaptureTemplateProvider loads from JSON with schema validation              │
│  • LoadCategories() → reads capture-templates/categories/*.json              │
│  • Validates against config/schemas/capture-templates.schema.json            │
│  • Builds category lookup                                                    │
│  • Caches templates for performance                                          │
│  • Logs warnings for missing required fields                                 │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIGURATION                                     │
│                                                                              │
│  config/schemas/capture-templates.schema.json (Draft-07)                     │
│  docs/design/descriptors/capture-templates/categories/*.json                 │
│                                                                              │
│  Related Systems:                                                            │
│  • Field Guide system (SPEC-CODEX-001)                                       │
│  • Codex system (keyword matching)                                           │
│  • Legend system (quality-based progression)                                 │
│  • CaptureType.cs enum (source of truth)                                     │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Schema Root Definition

### 4.1 Root Configuration Properties

The capture template schema defines a category-organized collection of templates.

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `$schema` | string | No | - | JSON Schema reference |
| `category` | string | **Yes** | - | Category identifier (kebab-case) |
| `version` | string | **Yes** | - | Schema version (semver format) |
| `description` | string | No | - | Human-readable category description |
| `matchKeywords` | array | No | [] | Default keywords for all templates |
| `templates` | array | **Yes** | - | Array of capture templates |

### 4.2 Category Structure

Categories organize templates by encounter context:

| Category | Description | Typical Types |
|----------|-------------|---------------|
| `rusted-servitor` | Servitor/automaton encounters | Specimen, VisualRecord, RunicTrace |
| `blighted-creature` | Blight-corrupted creatures | Specimen, VisualRecord, RunicTrace |
| `ancient-ruin` | Pre-Glitch ruins and tombs | TextFragment, OralHistory, VisualRecord |
| `industrial-site` | Factory/forge locations | EchoRecording, VisualRecord, TextFragment |
| `generic-container` | General container loot | TextFragment, OralHistory |
| `field-guide-triggers` | Gameplay event triggers | OralHistory, TextFragment |

### 4.3 Keyword Inheritance

Keywords determine Codex matching. Templates can inherit or override:

```
Category matchKeywords (default)
         │
         ├──► Template without matchKeywords → Uses category keywords
         │
         └──► Template with matchKeywords → Overrides category keywords
```

**Inheritance Rules:**
1. If template has `matchKeywords`, use template's keywords (complete override)
2. If template lacks `matchKeywords`, use category's `matchKeywords`
3. If both are missing, no Codex matching occurs

---

## 5. CaptureTemplate Definition

### 5.1 Core Properties

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `id` | string | **Yes** | - | Globally unique template identifier (kebab-case) |
| `type` | string | **Yes** | - | CaptureType classification (enum) |
| `fragmentContent` | string | **Yes** | - | Lore text content (20-1000 chars) |
| `source` | string | **Yes** | - | Discovery context for UI (5-100 chars) |
| `matchKeywords` | array | No | inherited | Keywords for Codex matching |
| `quality` | integer | No | 15 | Quality value affecting Legend (1-100) |
| `tags` | array | No | [] | Metadata tags for filtering |
| `domain4Notes` | string | No | null | Author notes on Domain 4 compliance |

### 5.2 Content Constraints

| Constraint | Field | Requirement |
|------------|-------|-------------|
| Length | `fragmentContent` | 20-1000 characters |
| Length | `source` | 5-100 characters |
| Pattern | `id` | `^[a-z][a-z0-9-]*$` (lowercase kebab-case) |
| Pattern | `category` | `^[a-z][a-z0-9-]*$` (lowercase kebab-case) |
| Pattern | `version` | `^\d+\.\d+\.\d+$` (semver) |
| Range | `quality` | 1-100 |
| Compliance | `fragmentContent` | Domain 4 compliant (no precision measurements) |

### 5.3 Keyword Matching

Keywords connect captures to Codex entries:

| Property | Purpose | Example |
|----------|---------|---------|
| Category `matchKeywords` | Default for all templates | `["servitor", "automaton", "machine"]` |
| Template `matchKeywords` | Override category default | `["servitor", "aesir", "rune"]` |

**Keyword Guidelines:**
- Keywords should be lowercase
- Minimum 2 characters per keyword
- At least 1 keyword when specified
- Match Codex entry keywords for auto-assignment

---

## 6. CaptureType Classification

### 6.1 Type Definitions

| Type | Description | Content Nature |
|------|-------------|----------------|
| `TextFragment` | Written records, notes, torn pages | Textual, literary |
| `EchoRecording` | Audio logs, transcribed recordings | Transcribed audio |
| `VisualRecord` | Schematics, diagrams, images | Visual observations |
| `Specimen` | Biological samples, tissue analysis | Scientific analysis |
| `OralHistory` | Dialogue fragments, rumors, traditions | Verbal accounts |
| `RunicTrace` | Magical/technological trace analysis | Mystical analysis |

### 6.2 Voice Style Guidelines

| Type | Voice Style | Tone | Example Opening |
|------|-------------|------|-----------------|
| `TextFragment` | Scholarly, formal | Historical | "Recovered maintenance logs, partially corrupted..." |
| `EchoRecording` | Personal, urgent | Corrupted, glitchy | "A damaged echo-stone preserves a fragment..." |
| `VisualRecord` | Descriptive, technical | Observational | "Crystalline growths cluster around..." |
| `Specimen` | Analytical, clinical | Scientific | "Tissue samples reveal extensive cellular mutation..." |
| `OralHistory` | Conversational, dialectal | Personal | "The veterans speak of Psychic Stress in hushed tones..." |
| `RunicTrace` | Mystical, precise | Layered | "Faint Aetheric resonance detected..." |

### 6.3 Source Context Patterns

| Type | Typical Sources |
|------|-----------------|
| `TextFragment` | "Found in container", "Wall inscription", "Warning placard" |
| `EchoRecording` | "Echo-stone playback", "Recovered from terminal" |
| `VisualRecord` | "Visual inspection", "Technical schematic", "Artistic record" |
| `Specimen` | "Servitor examination", "Biological analysis", "Creature remains" |
| `OralHistory` | "Local knowledge", "Historical correlation", "Veteran's warning" |
| `RunicTrace` | "Runic analysis", "Aetheric analysis", "Runic examination" |

---

## 7. Quality and Reward System

### 7.1 Quality Values

| Range | Level | Description | Typical Use |
|-------|-------|-------------|-------------|
| 1-10 | Minor | Low Legend contribution | Common background flavor |
| 11-25 | Standard | Normal Legend contribution | Regular discoveries (default = 15) |
| 26-50 | Notable | Enhanced Legend contribution | Important revelations |
| 51-75 | Significant | High Legend contribution | Major story pieces |
| 76-100 | Exceptional | Maximum Legend contribution | Critical plot elements |

### 7.2 Legend Progression

Quality directly affects Codex entry Legend progression:

```
Legend Contribution = BaseContribution × (Quality / 100)

Example calculations:
• Quality 15 (default):  BaseContribution × 0.15
• Quality 50:            BaseContribution × 0.50
• Quality 100:           BaseContribution × 1.00
```

### 7.3 Default Values

| Property | Default | Rationale |
|----------|---------|-----------|
| `quality` | 15 | Standard reward for typical discoveries |
| `matchKeywords` | Category default | Simplifies template authoring |
| `tags` | [] | Optional metadata |

---

## 8. Tag Metadata System

### 8.1 Tag Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `tags` | array | No | String array of metadata tags |

### 8.2 Tag Conventions

| Convention | Example Tags | Purpose |
|------------|--------------|---------|
| Faction | `"aesir"`, `"dvergr"`, `"clans"` | Faction association |
| Era | `"pre-glitch"`, `"post-glitch"` | Time period |
| Theme | `"blight"`, `"corruption"`, `"decay"` | Thematic elements |
| Subject | `"servitor"`, `"creature"`, `"ruin"` | Content subject |
| Tone | `"warning"`, `"log"`, `"wisdom"` | Content tone |

### 8.3 Filtering Patterns

Tags enable content filtering and analytics:

```
Use Cases:
═════════
• Filter by faction: Get all "aesir" related captures
• Filter by era: Get all "pre-glitch" historical content
• Analytics: Count captures by theme
• Content authoring: Find gaps in coverage

Important: Tags are NOT displayed in-game (internal use only)
```

---

## 9. Domain 4 Compliance

### 9.1 Compliance Requirements

**Domain 4 Principle:** POST-Glitch societies are archaeologists, not engineers.

All `fragmentContent` must follow Domain 4 constraints—no precision measurements, exact percentages, or technical specifications that imply pre-Glitch engineering knowledge.

### 9.2 Forbidden Patterns

| Forbidden | Reason | Example |
|-----------|--------|---------|
| Exact percentages | Too precise | "95% casualties" |
| Decimal precision | Engineering precision | "18.5C temperature" |
| Metric measurements | Modern units | "800 meters away" |
| Population counts | Exact numbers | "10,000 residents" |
| Technical specs | Engineering knowledge | "H2S 6-12 ppm" |
| Pressure readings | Scientific units | "2.5 atmospheres" |
| Frequency measurements | Technical precision | "440 Hz tone" |

### 9.3 Correction Examples

| Forbidden | Correction |
|-----------|------------|
| "95% casualties" | "nearly all perished" |
| "18.5C temperature" | "uncomfortably warm" |
| "800 meters away" | "beyond bowshot" |
| "10,000 residents" | "a thriving settlement" |
| "H2S 6-12 ppm" | "air thick with sulfurous stench" |
| "2.5 atmospheres" | "crushing pressure" |
| "Emergency bypass terminal" | "the humming altar" |
| "Power core" | "the heart-stone" |
| "Database" | "the memory-well" |
| "Robot" | "automaton" or "iron-walker" |
| "Computer" | "oracle-box" or "rune-mirror" |

---

## 10. AAM-VOICE Layer 2 Guidelines

### Vocabulary Transformation Table

| Don't Write | Write Instead |
|-------------|---------------|
| "Emergency bypass terminal" | "The humming altar" |
| "Power core" | "The heart-stone" |
| "Database" | "The memory-well" |
| "Robot" | "Automaton" or "iron-walker" |
| "Computer" | "Oracle-box" or "rune-mirror" |
| "Terminal" | "Rune-slate" or "speaking-stone" |
| "Sensor" | "Watcher-eye" |
| "Power grid" | "Life-web" |
| "Circuit" | "Rune-path" |
| "Diagnostic" | "Divination" |
| "Error message" | "Warning glyph" |
| "System failure" | "The silence" |
| "Reboot" | "Awakening" |

### Voice Layer Reference

| Layer | Application | Description |
|-------|-------------|-------------|
| Layer 1 | Player UI | Modern gaming terms acceptable |
| Layer 2 | Data Captures | Medieval-flavored vocabulary (THIS LAYER) |
| Layer 3 | NPC Dialogue | Full in-world immersion |

---

## 11. Configuration Schema

### Complete `capture-templates.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://rune-game.com/schemas/capture-templates.schema.json",
  "title": "Capture Template Collection",
  "description": "Schema for Data Capture template files in Rune & Rust. All content must follow AAM-VOICE Layer 2 (Diagnostic) constraints and Domain 4 compliance (no precision measurements).",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file"
    },
    "category": {
      "type": "string",
      "description": "Category identifier matching the filename (kebab-case)",
      "pattern": "^[a-z][a-z0-9-]*$",
      "examples": ["rusted-servitor", "blighted-creature", "ancient-ruin"]
    },
    "version": {
      "type": "string",
      "description": "Schema version for migration tracking (semver format)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "description": {
      "type": "string",
      "description": "Human-readable description of this category for content authors"
    },
    "matchKeywords": {
      "type": "array",
      "description": "Default keywords for all templates in this category (can be overridden per-template)",
      "items": {
        "type": "string",
        "minLength": 2
      },
      "minItems": 1
    },
    "templates": {
      "type": "array",
      "description": "Array of capture templates in this category",
      "items": {
        "$ref": "#/definitions/CaptureTemplate"
      },
      "minItems": 1
    }
  },
  "required": ["category", "version", "templates"],
  "additionalProperties": false,
  "definitions": {
    "CaptureTemplate": {
      "type": "object",
      "description": "A single Data Capture template definition",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique template identifier (kebab-case, globally unique across all files)",
          "pattern": "^[a-z][a-z0-9-]*$",
          "examples": ["servitor-fungal-infection", "container-note-fragment"]
        },
        "type": {
          "$ref": "#/definitions/CaptureType",
          "description": "Capture type classification"
        },
        "fragmentContent": {
          "type": "string",
          "description": "The lore text content of this fragment. Must follow Domain 4 constraints (no precision measurements like percentages, exact distances, or technical specifications).",
          "minLength": 20,
          "maxLength": 1000
        },
        "source": {
          "type": "string",
          "description": "Description of where/how the fragment was discovered (displayed in UI)",
          "minLength": 5,
          "maxLength": 100,
          "examples": ["Servitor examination", "Found in container", "Wall inscription"]
        },
        "matchKeywords": {
          "type": "array",
          "description": "Keywords for Codex auto-assignment. If provided, overrides category-level matchKeywords.",
          "items": {
            "type": "string",
            "minLength": 2
          },
          "minItems": 1
        },
        "quality": {
          "type": "integer",
          "description": "Quality value affecting Legend rewards. Higher values grant more progress toward unlocking Codex entries.",
          "minimum": 1,
          "maximum": 100,
          "default": 15
        },
        "tags": {
          "type": "array",
          "description": "Optional metadata tags for filtering and categorization (not displayed in-game)",
          "items": {
            "type": "string"
          },
          "examples": [["aesir", "pre-glitch"], ["blight", "creature"]]
        },
        "domain4Notes": {
          "type": "string",
          "description": "Author notes on Domain 4 compliance. For internal documentation only, not displayed in-game."
        }
      },
      "required": ["id", "type", "fragmentContent", "source"],
      "additionalProperties": false
    },
    "CaptureType": {
      "type": "string",
      "description": "Capture type classification from CaptureType enum",
      "enum": [
        "TextFragment",
        "EchoRecording",
        "VisualRecord",
        "Specimen",
        "OralHistory",
        "RunicTrace"
      ]
    }
  }
}
```

---

## 12. Logging Specifications

### Schema Validation Logging

| Event | Level | Message Format |
|-------|-------|----------------|
| Schema loaded | INFO | `Capture template schema loaded from {path}` |
| Category loaded | DEBUG | `Loaded category '{category}' ({count} templates)` |
| Validation success | DEBUG | `Capture templates validated ({categoryCount} categories, {templateCount} templates)` |
| Validation failure | ERROR | `Capture template validation failed: {errors}` |
| Invalid category pattern | ERROR | `Category '{category}' does not match pattern ^[a-z][a-z0-9-]*$` |
| Invalid template ID | ERROR | `Template ID '{id}' does not match pattern ^[a-z][a-z0-9-]*$` |
| Invalid capture type | ERROR | `CaptureType '{type}' not in valid enum` |
| Content too short | ERROR | `fragmentContent for '{id}' is below minimum length (20 chars)` |
| Content too long | ERROR | `fragmentContent for '{id}' exceeds maximum length (1000 chars)` |
| Source too short | ERROR | `source for '{id}' is below minimum length (5 chars)` |
| Quality out of range | ERROR | `quality for '{id}' must be between 1 and 100` |
| Empty templates array | ERROR | `Category '{category}' has no templates` |

### Runtime Logging

| Event | Level | Message Format |
|-------|-------|----------------|
| Template selected | DEBUG | `Selected template '{id}' from category '{category}'` |
| Keywords resolved | DEBUG | `Resolved keywords for '{id}': {keywords}` |
| Capture created | INFO | `Data Capture created: '{id}' (quality: {quality})` |
| Codex match | DEBUG | `Template '{id}' matched Codex entry '{entryId}'` |
| Legend awarded | INFO | `Legend progress awarded: {amount} to entry '{entryId}'` |
| Missing category | WARN | `Category '{category}' not found, using fallback` |
| Duplicate ID | WARN | `Duplicate template ID '{id}' found in categories '{cat1}' and '{cat2}'` |

---

## 13. Unit Testing Requirements

### Test Summary

| Test ID | Test Name | Description |
|---------|-----------|-------------|
| CAP-001 | ValidCaptureTemplateConfiguration | Validates complete configuration file |
| CAP-002 | CaptureTemplateValidation | Validates template structure |
| CAP-003 | CaptureTypeEnumValidation | Validates capture type enum values |
| CAP-004 | ContentLengthValidation | Validates content length constraints |
| CAP-005 | QualityRangeValidation | Validates quality value range |
| CAP-006 | KeywordInheritanceValidation | Validates keyword inheritance behavior |

### Test Specifications

#### CAP-001: ValidCaptureTemplateConfiguration

```
Test: Valid complete capture template configuration passes validation
Given: A capture template JSON file with category and templates
When: Schema validation is performed
Then: Validation passes with no errors
And: Category matches kebab-case pattern
And: Version matches semver pattern
And: Templates array has at least one template
```

#### CAP-002: CaptureTemplateValidation

```
Test: Capture template structure validates correctly
Given: Capture templates with various configurations
When: Schema validation is performed:
  - { "id": "test-id", "type": "TextFragment", "fragmentContent": "...", "source": "Test source" } → passes (minimal)
  - { "id": "test-id", "type": "TextFragment", "fragmentContent": "...", "source": "Test source", "quality": 50 } → passes
  - { "type": "TextFragment", "fragmentContent": "...", "source": "Test source" } → fails (missing id)
  - { "id": "test-id", "fragmentContent": "...", "source": "Test source" } → fails (missing type)
  - { "id": "Test-Id", "type": "TextFragment", "fragmentContent": "...", "source": "Test source" } → fails (uppercase in ID)
Then: Required fields enforced, patterns validated
```

#### CAP-003: CaptureTypeEnumValidation

```
Test: CaptureType enum validates correctly
Given: Templates with various type values
When: Schema validation is performed:
  - "type": "TextFragment" → passes
  - "type": "EchoRecording" → passes
  - "type": "VisualRecord" → passes
  - "type": "Specimen" → passes
  - "type": "OralHistory" → passes
  - "type": "RunicTrace" → passes
  - "type": "InvalidType" → fails
  - "type": "textfragment" → fails (case-sensitive)
Then: Only valid enum values accepted
```

#### CAP-004: ContentLengthValidation

```
Test: Content length constraints validated
Given: Templates with various content lengths
When: Schema validation is performed:
  - fragmentContent: 20 chars → passes (minimum)
  - fragmentContent: 500 chars → passes (normal)
  - fragmentContent: 1000 chars → passes (maximum)
  - fragmentContent: 19 chars → fails (below minimum)
  - fragmentContent: 1001 chars → fails (above maximum)
  - source: 5 chars → passes (minimum)
  - source: 100 chars → passes (maximum)
  - source: 4 chars → fails (below minimum)
  - source: 101 chars → fails (above maximum)
Then: Length constraints enforced
```

#### CAP-005: QualityRangeValidation

```
Test: Quality value range validated
Given: Templates with various quality values
When: Schema validation is performed:
  - "quality": 1 → passes (minimum)
  - "quality": 15 → passes (default)
  - "quality": 100 → passes (maximum)
  - "quality": 0 → fails (below minimum)
  - "quality": 101 → fails (above maximum)
  - "quality": -1 → fails (negative)
  - "quality": 15.5 → fails (not integer)
  - (no quality) → passes (uses default)
Then: Quality range 1-100 enforced, default applied
```

#### CAP-006: KeywordInheritanceValidation

```
Test: Keyword inheritance behavior validated
Given: Category with matchKeywords and templates with/without matchKeywords
When: Effective keywords are resolved:
  - Category: ["a", "b"], Template: none → ["a", "b"] (inherited)
  - Category: ["a", "b"], Template: ["c", "d"] → ["c", "d"] (override)
  - Category: none, Template: ["c", "d"] → ["c", "d"] (template only)
  - Category: none, Template: none → [] (no keywords)
Then: Keyword inheritance follows override rules
```

---

## 14. Use Cases

### UC-001: Load Capture Templates

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-001: Load Capture Templates                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Game initialization                                                 │
│ Preconditions: Template files exist                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. System loads capture-templates.schema.json                                │
│ 2. System reads capture-templates/categories/*.json                          │
│ 3. Validate each category file against schema                                │
│ 4. Build category lookup by category name                                    │
│ 5. Validate global uniqueness of template IDs                                │
│ 6. Cache templates for performance                                           │
│ 7. Log category statistics                                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Templates loaded and cached                                  │
│ Exceptions: Invalid JSON → log error, skip category                          │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-002: Acquire Data Capture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-002: Acquire Data Capture                                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Player, Game System                                                  │
│ Trigger: Player examines object, searches container, or defeats enemy        │
│ Preconditions: Templates loaded, valid capture context                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Determine category from context (e.g., "rusted-servitor")                 │
│ 2. Retrieve category templates                                               │
│ 3. Select template (random or weighted)                                      │
│ 4. Resolve effective keywords (inheritance)                                  │
│ 5. Create DataCapture instance                                               │
│ 6. Display acquisition UI to player                                          │
│ 7. Add to player's Field Guide                                               │
│ 8. Process Codex matching                                                    │
│ 9. Award Legend progress                                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Capture added to Field Guide, Legend progress awarded        │
│ Exceptions: Unknown category → use generic-container fallback                │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-003: Match Keywords to Codex

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-003: Match Keywords to Codex                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Codex System                                                         │
│ Trigger: Data Capture acquired                                               │
│ Preconditions: Capture has effective keywords                                │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Get capture's effective keywords                                          │
│ 2. For each Codex entry:                                                     │
│    a. Compare entry keywords with capture keywords                           │
│    b. If match found, calculate Legend contribution                          │
│    c. Add Legend progress to entry                                           │
│ 3. Check if any entries unlocked                                             │
│ 4. Notify player of progress/unlocks                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Codex entries updated, unlocks triggered                     │
│ Exceptions: No matching entries → no Legend awarded                          │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-004: Display Field Guide Entry

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-004: Display Field Guide Entry                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Player, UI System                                                    │
│ Trigger: Player opens Field Guide                                            │
│ Preconditions: Player has collected captures                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Player opens Field Guide UI                                               │
│ 2. Display collected captures by type or category                            │
│ 3. Player selects a capture                                                  │
│ 4. Display capture details:                                                  │
│    a. Type icon (TextFragment, Specimen, etc.)                               │
│    b. Source context                                                         │
│    c. Fragment content                                                       │
│ 5. Show linked Codex entries (if any)                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Player views capture details                                 │
│ Exceptions: Empty Field Guide → show "No captures yet" message               │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-005: Validate Template Content

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-005: Validate Template Content                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Content Author, Validation Script                                    │
│ Trigger: Author runs validation script                                       │
│ Preconditions: Template files exist                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Load capture-templates.schema.json                                        │
│ 2. For each category file:                                                   │
│    a. Validate against schema                                                │
│    b. Check for duplicate template IDs                                       │
│    c. Verify content length constraints                                      │
│    d. Verify quality ranges                                                  │
│ 3. Report validation results:                                                │
│    a. Total categories validated                                             │
│    b. Total templates validated                                              │
│    c. Errors found (with details)                                            │
│    d. Warnings (duplicate IDs, missing keywords)                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Validation report generated                                  │
│ Exceptions: Schema not found → report error                                  │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 15. Deliverable Checklist

### Configuration Files

| Status | File | Description |
|--------|------|-------------|
| ☐ | `config/schemas/capture-templates.schema.json` | JSON Schema Draft-07 for validation |
| ☑ | `docs/design/descriptors/capture-templates/categories/rusted-servitor.json` | Update schema reference |
| ☑ | `docs/design/descriptors/capture-templates/categories/blighted-creature.json` | Update schema reference |
| ☑ | `docs/design/descriptors/capture-templates/categories/ancient-ruin.json` | Update schema reference |
| ☑ | `docs/design/descriptors/capture-templates/categories/industrial-site.json` | Update schema reference |
| ☑ | `docs/design/descriptors/capture-templates/categories/generic-container.json` | Update schema reference |
| ☑ | `docs/design/descriptors/capture-templates/categories/field-guide-triggers.json` | Update schema reference |

### Unit Tests

| Status | Test | Description |
|--------|------|-------------|
| ☐ | CAP-001 | Valid complete configuration |
| ☐ | CAP-002 | Template structure validation |
| ☐ | CAP-003 | CaptureType enum validation |
| ☐ | CAP-004 | Content length validation |
| ☐ | CAP-005 | Quality range validation |
| ☐ | CAP-006 | Keyword inheritance validation |

### Documentation

| Status | Document | Description |
|--------|----------|-------------|
| ☑ | Design Specification | This document |
| ☐ | Schema Documentation | Inline in schema file |
| ☑ | Capture Template Authoring Guide | Existing guide update |

---

## 16. Acceptance Criteria

### Functional Criteria

- [ ] `capture-templates.schema.json` created in `config/schemas/`
- [ ] Schema validates existing capture template files
- [ ] Category pattern validated (kebab-case)
- [ ] Template ID pattern validated (kebab-case, globally unique)
- [ ] Capture types validated (6 types)
- [ ] Fragment content length validated (20-1000 chars)
- [ ] Source length validated (5-100 chars)
- [ ] Quality range validated (1-100)
- [ ] Version pattern validated (semver)
- [ ] Category-level matchKeywords inheritance works
- [ ] Per-template matchKeywords override works
- [ ] ~6 unit tests pass

### Quality Criteria

- [ ] Schema follows JSON Schema Draft-07 specification
- [ ] All properties include descriptive comments
- [ ] Default values documented for optional fields
- [ ] Pattern constraints clearly specified
- [ ] Enum values match existing CaptureType.cs

### Integration Criteria

- [ ] Schema follows patterns from v0.14.9d (psychological descriptor schema)
- [ ] Compatible with existing Draft-2020-12 content
- [ ] ID patterns use kebab-case (lowercase)
- [ ] Property names use camelCase within templates
- [ ] CaptureType names use PascalCase

---

## 17. Dependencies

### Required From

| Version | Dependency | Usage |
|---------|------------|-------|
| v0.14.8 | Dice Configuration Schemas | Schema infrastructure patterns |
| v0.14.9a | Dialogue Schema | Schema pattern reference |
| v0.14.9b | Ability Descriptor Schema | Schema pattern reference |
| v0.14.9c | NPC Descriptor Schema | Schema pattern reference |
| v0.14.9d | Psychological Descriptor Schema | Schema pattern reference |
| Existing | `capture-template.schema.json` (Draft-2020-12) | Source structure |
| Existing | `CaptureType.cs` | Enum source of truth |

### Provides To

| Version | Consumer | Usage |
|---------|----------|-------|
| Future | CaptureTemplateService | Template loading and selection |
| Future | FieldGuideSystem | Capture display |
| Future | CodexSystem | Keyword matching |
| Future | LegendSystem | Quality-based progression |

---

## 18. Future Considerations

### Deferred to Later Versions

| Feature | Rationale |
|---------|-----------|
| Template execution logic | Runtime concern |
| Codex matching algorithms | Runtime concern |
| Legend calculation formulas | Runtime concern |
| Audio cue integration | Future audio version |
| Localization support | Future i18n version |

### Potential Enhancements

| Enhancement | Description |
|-------------|-------------|
| Weighted template selection | Templates could have weights like descriptors |
| Prerequisite captures | Some captures unlock only after others |
| Capture chains | Related captures form narrative arcs |
| Rarity tiers | Beyond quality, explicit rarity classification |
| Biome-specific templates | Templates only available in certain biomes |
| Time-sensitive captures | Templates available only at certain times |
| Context conditions | Templates require specific conditions to appear |
| Variable substitution | {Variable} placeholders like descriptors |

---

## 19. Appendix: Schema Validation Examples

### Valid Category File (Minimal)

```json
{
  "$schema": "../schema/capture-template.schema.json",
  "category": "test-category",
  "version": "1.0.0",
  "templates": [
    {
      "id": "test-capture",
      "type": "TextFragment",
      "fragmentContent": "This is test content that is at least twenty characters long.",
      "source": "Test source"
    }
  ]
}
```

### Valid Category File (Complete)

```json
{
  "$schema": "../schema/capture-template.schema.json",
  "category": "rusted-servitor",
  "version": "1.0.0",
  "description": "Templates for Rusted Servitor encounters and automaton examinations.",
  "matchKeywords": ["servitor", "automaton", "machine", "mechanical"],
  "templates": [
    {
      "id": "servitor-fungal-infection",
      "type": "Specimen",
      "fragmentContent": "The servo-motor shows signs of organic fungal infiltration. Mycelial threads have woven through the mechanical joints, creating an unsettling fusion of rust and growth.",
      "source": "Servitor examination",
      "quality": 15,
      "tags": ["servitor", "fungal", "blight-adjacent"]
    },
    {
      "id": "servitor-maintenance-log",
      "type": "TextFragment",
      "fragmentContent": "Recovered maintenance logs, partially corrupted: '...Unit 7-Alpha reporting nominal function. Awaiting directives from Central. Note: Unusual signal interference detected in lower sectors...'",
      "source": "Recovered data-slate",
      "matchKeywords": ["servitor", "automaton", "aesir"],
      "quality": 15,
      "tags": ["aesir", "pre-glitch", "log"],
      "domain4Notes": "Avoided exact unit numbers and signal frequencies"
    }
  ]
}
```

### Valid Template (All CaptureTypes)

```json
{
  "id": "text-example",
  "type": "TextFragment",
  "fragmentContent": "Written records found in the ruins speak of a great calamity...",
  "source": "Wall inscription"
}

{
  "id": "echo-example",
  "type": "EchoRecording",
  "fragmentContent": "A damaged echo-stone preserves a fragment: '...the alarms are sounding...'",
  "source": "Echo-stone playback"
}

{
  "id": "visual-example",
  "type": "VisualRecord",
  "fragmentContent": "Schematics etched into a metal plate show complex patterns...",
  "source": "Technical schematic"
}

{
  "id": "specimen-example",
  "type": "Specimen",
  "fragmentContent": "Tissue samples reveal extensive cellular mutation in the subject...",
  "source": "Biological analysis"
}

{
  "id": "oral-example",
  "type": "OralHistory",
  "fragmentContent": "The veterans speak of the old times in hushed tones...",
  "source": "Veteran's tale"
}

{
  "id": "runic-example",
  "type": "RunicTrace",
  "fragmentContent": "Faint Aetheric resonance lingers here, patterns suggesting ancient craft...",
  "source": "Runic analysis"
}
```

### Invalid Examples

```json
// Invalid: Missing required 'id'
{
  "type": "TextFragment",
  "fragmentContent": "...",
  "source": "Test"
}
// Error: Missing required property 'id'

// Invalid: Invalid capture type
{
  "id": "test",
  "type": "AudioLog",
  "fragmentContent": "...",
  "source": "Test"
}
// Error: 'type' must be one of: TextFragment, EchoRecording, VisualRecord, Specimen, OralHistory, RunicTrace

// Invalid: Content too short
{
  "id": "test",
  "type": "TextFragment",
  "fragmentContent": "Too short",
  "source": "Test"
}
// Error: 'fragmentContent' must be at least 20 characters

// Invalid: Source too short
{
  "id": "test",
  "type": "TextFragment",
  "fragmentContent": "This is test content that is at least twenty characters long.",
  "source": "Test"
}
// Error: 'source' must be at least 5 characters

// Invalid: Quality out of range
{
  "id": "test",
  "type": "TextFragment",
  "fragmentContent": "This is test content that is at least twenty characters long.",
  "source": "Test source",
  "quality": 150
}
// Error: 'quality' must be <= 100

// Invalid: ID with uppercase
{
  "id": "Test-Capture",
  "type": "TextFragment",
  "fragmentContent": "...",
  "source": "Test source"
}
// Error: 'id' must match pattern ^[a-z][a-z0-9-]*$

// Invalid: Category with underscore
{
  "category": "test_category",
  "version": "1.0.0",
  "templates": [...]
}
// Error: 'category' must match pattern ^[a-z][a-z0-9-]*$

// Invalid: Empty templates array
{
  "category": "test-category",
  "version": "1.0.0",
  "templates": []
}
// Error: 'templates' must contain at least 1 item
```

---

## 20. Appendix: Existing Content Reference

### Category Summary

| Category | Templates | Types Used | Default Keywords |
|----------|-----------|------------|------------------|
| rusted-servitor | 4 | Specimen, TextFragment, VisualRecord, RunicTrace | servitor, automaton, machine, mechanical |
| blighted-creature | 3 | Specimen, VisualRecord, RunicTrace | blight, corrupted, infected, creature |
| ancient-ruin | 3 | TextFragment, OralHistory, VisualRecord | ruin, ancient, collapsed, abandoned |
| industrial-site | 3 | EchoRecording, VisualRecord, TextFragment | industrial, forge, foundry, factory |
| generic-container | 3 | TextFragment, OralHistory | container, chest, crate, box |
| field-guide-triggers | 3 | OralHistory, TextFragment | guide, manual, wisdom |

### Existing Templates by Category

#### rusted-servitor.json (4 templates)

| ID | Type | Quality | Keywords |
|----|------|---------|----------|
| servitor-fungal-infection | Specimen | 15 | (inherited) |
| servitor-maintenance-log | TextFragment | 15 | servitor, automaton, aesir |
| servitor-crystal-growth | VisualRecord | 15 | servitor, automaton, crystal |
| servitor-aetheric-resonance | RunicTrace | 15 | servitor, aesir, rune, aetheric |

#### blighted-creature.json (3 templates)

| ID | Type | Quality | Keywords |
|----|------|---------|----------|
| blight-tissue-mutation | Specimen | 15 | (inherited) |
| blight-awareness-retained | VisualRecord | 15 | blight, creature, beast, monster |
| blight-deliberate-exposure | RunicTrace | 15 | blight, aetheric, corruption |

#### ancient-ruin.json (3 templates)

| ID | Type | Quality | Keywords |
|----|------|---------|----------|
| ruin-wall-inscription | TextFragment | 15 | ruin, ancient, inscription, tomb |
| ruin-wanderers-tales | OralHistory | 15 | ruin, ancient, tower, aesir |
| ruin-defaced-murals | VisualRecord | 15 | ruin, mural, art, ancient |

#### industrial-site.json (3 templates)

| ID | Type | Quality | Keywords |
|----|------|---------|----------|
| industrial-echo-stone | EchoRecording | 15 | (inherited) |
| industrial-schematics | VisualRecord | 15 | machine, device, mechanism, technical |
| industrial-safety-notice | TextFragment | 15 | industrial, aesir, facility |

#### generic-container.json (3 templates)

| ID | Type | Quality | Keywords |
|----|------|---------|----------|
| container-eastern-tunnels | TextFragment | 15 | (inherited) |
| container-old-tormund | OralHistory | 15 | container, cache, storage |
| container-inventory-records | TextFragment | 15 | container, crate, supply |

#### field-guide-triggers.json (3 templates)

| ID | Type | Quality | Keywords |
|----|------|---------|----------|
| guide-psychic-stress | OralHistory | 15 | psychic, stress, mental |
| guide-combat-training | TextFragment | 15 | combat, fighting, battle |
| guide-encumbrance | OralHistory | 15 | burden, weight, carrying, inventory |

### Total Content Statistics

| Metric | Value |
|--------|-------|
| Total Categories | 6 |
| Total Templates | 19 |
| CaptureTypes Used | 5 of 6 (no EchoRecording in ancient-ruin) |
| Average Templates per Category | 3.2 |
| Default Quality Value | 15 |
| Templates with Override Keywords | 11 |
| Templates with Inherited Keywords | 8 |

---

*End of v0.14.9e Design Specification*
