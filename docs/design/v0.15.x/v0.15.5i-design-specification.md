# v0.15.5i Design Specification: Exploration Synergies

**Version:** 0.15.5i
**Theme:** Exploration Synergies
**Author:** Claude
**Created:** 2026-01-18
**Status:** Draft
**Prerequisites:** v0.15.5a Complete (Extended Tracking System), v0.15.5b Complete (Counter-Tracking System), v0.15.5c Complete (Foraging System), v0.15.5d Complete (Navigation System), v0.15.5e Complete (Hazard Detection System), v0.15.5f Complete (Scavenger Sign Reading), v0.15.5g Complete (Scout Action), v0.15.5h Complete (Specialization Integration)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
   - 3.1 [Combined Check Flow Diagram](#31-combined-check-flow-diagram)
   - 3.2 [Skill Synergy Resolution Flow](#32-skill-synergy-resolution-flow)
   - 3.3 [Service Interaction Diagram](#33-service-interaction-diagram)
   - 3.4 [Layer Architecture](#34-layer-architecture)
4. [Combined Skill Check System](#4-combined-skill-check-system)
5. [Find Hidden Path Synergy](#5-find-hidden-path-synergy)
6. [Track to Lair Synergy](#6-track-to-lair-synergy)
7. [Avoid Patrol Synergy](#7-avoid-patrol-synergy)
8. [Find and Loot Synergy](#8-find-and-loot-synergy)
9. [ICombinedCheckService Interface](#9-icombinedcheckservice-interface)
10. [CombinedCheckService Implementation](#10-combinedcheckservice-implementation)
11. [Data Model Changes](#11-data-model-changes)
12. [Configuration Files](#12-configuration-files)
    - 12.1 [combined-checks.json](#121-combined-checksjson)
    - 12.2 [combined-checks.schema.json](#122-combined-checksschemajson)
    - 12.3 [Configuration Schema Summary](#123-configuration-schema-summary)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Use Cases](#15-use-cases)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies](#18-dependencies)
19. [Future Considerations](#19-future-considerations)
20. [Document Metadata](#20-document-metadata)

---

## 1. Executive Summary

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.5i, the Exploration Synergies system. This phase implements combined skill checks that link Wasteland Survival checks with other skill systems, creating meaningful multi-step exploration sequences.

Exploration in Aethelgard is rarely a single-skill activity. Finding a hidden path requires navigation to locate it, then acrobatics to traverse the difficult terrain. Tracking prey to its lair requires Wasteland Survival to follow the trail, then System Bypass to enter the secured den. These combined checks create richer exploration gameplay where different character builds can contribute at different stages.

The combined check system establishes a **primary-secondary pattern** where the primary skill (typically Wasteland Survival) gates access to a situation, and a secondary skill determines how well the player can exploit or navigate that situation. This creates natural party cooperation opportunities and rewards versatile characters.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Value Objects** | `CombinedCheckContext`, `CombinedCheckResult`, `SkillSynergyDefinition` |
| **Enums** | `SynergyType`, `SecondaryCheckTiming` |
| **Interfaces** | `ICombinedCheckService` |
| **Services** | `CombinedCheckService` |
| **Configuration** | `combined-checks.json` |
| **Tests** | ~2 new unit tests |

### 1.3 Architectural Significance

This version establishes the **combined check pattern** that enables multi-skill exploration:

- **Primary-secondary sequencing**: Primary skill gates access, secondary skill determines outcome quality
- **Conditional secondary checks**: Secondary check only triggers on primary success
- **Cross-skill synergies**: Wasteland Survival integrates with Acrobatics, System Bypass
- **Party cooperation hooks**: Different party members can contribute different skills

---

## 2. Feature Overview

```
v0.15.5i Exploration Synergies
├── Combined Skill Check System
│   ├── CombinedCheckContext - Context for multi-skill checks
│   ├── CombinedCheckResult - Result containing both check outcomes
│   └── SkillSynergyDefinition - Definition of skill pairings
├── Defined Synergies
│   ├── Find Hidden Path: Navigation → Acrobatics (traverse)
│   ├── Track to Lair: Tracking → System Bypass (enter)
│   ├── Avoid Patrol: Hazard Detection → Acrobatics (Stealth)
│   └── Find and Loot: Foraging → System Bypass (locked)
└── Unit Tests (~2)
    ├── Combined checks use correct skills
    └── Secondary check follows primary success
```

---

## 3. Architecture Diagrams

### 3.1 Combined Check Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    COMBINED CHECK FLOW DIAGRAM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    Player initiates exploration action                                       │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    IDENTIFY SYNERGY TYPE                            │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  Match action to defined synergy:                                   │  │
│    │  ├── "find hidden path" → Navigation + Acrobatics                  │  │
│    │  ├── "track to lair" → Tracking + System Bypass                    │  │
│    │  ├── "avoid patrol" → Hazard Detection + Acrobatics                │  │
│    │  └── "find and loot" → Foraging + System Bypass                    │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    EXECUTE PRIMARY CHECK                            │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  1. Build context for primary skill (Wasteland Survival)           │  │
│    │  2. Apply specialization bonuses (v0.15.5h)                        │  │
│    │  3. Execute skill check                                             │  │
│    │  4. Determine success/failure                                       │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    PRIMARY CHECK RESULT                             │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │                                                                      │  │
│    │           ┌──────────────────┬──────────────────┐                   │  │
│    │           │                  │                  │                   │  │
│    │           ▼                  ▼                  ▼                   │  │
│    │       SUCCESS            FAILURE            FUMBLE                  │  │
│    │           │                  │                  │                   │  │
│    │           │                  │                  │                   │  │
│    │           ▼                  ▼                  ▼                   │  │
│    │    Continue to         Return failure      Return fumble            │  │
│    │    secondary check     (no secondary)      consequence              │  │
│    │           │                                                         │  │
│    └───────────┼─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    EXECUTE SECONDARY CHECK                          │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  1. Build context for secondary skill                               │  │
│    │  2. Apply any bonuses from primary success (degree-based)          │  │
│    │  3. Execute secondary skill check                                   │  │
│    │  4. Determine combined outcome                                      │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    RETURN COMBINED RESULT                           │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  CombinedCheckResult containing:                                    │  │
│    │  ├── PrimaryResult (Navigation/Tracking/Detection/Foraging)        │  │
│    │  ├── SecondaryResult (Acrobatics/System Bypass)                    │  │
│    │  ├── OverallSuccess (both succeeded)                               │  │
│    │  └── Narrative description                                          │  │
│    └─────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Skill Synergy Resolution Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SKILL SYNERGY RESOLUTION FLOW                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    SYNERGY: Find Hidden Path                                                 │
│    ─────────────────────────────────────────────────────────────────────    │
│                                                                              │
│    ┌───────────────────┐         ┌───────────────────┐                      │
│    │  PRIMARY CHECK    │         │  SECONDARY CHECK  │                      │
│    │  Navigation       │────────▶│  Acrobatics       │                      │
│    ├───────────────────┤  gates  ├───────────────────┤                      │
│    │ DC: Terrain-based │         │ DC: Path-based    │                      │
│    │ Skill: WS-Nav     │         │ Skill: Acrobatics │                      │
│    │ Output: Path found│         │ Output: Traversal │                      │
│    └───────────────────┘         └───────────────────┘                      │
│                                                                              │
│    SYNERGY: Track to Lair                                                    │
│    ─────────────────────────────────────────────────────────────────────    │
│                                                                              │
│    ┌───────────────────┐         ┌───────────────────┐                      │
│    │  PRIMARY CHECK    │         │  SECONDARY CHECK  │                      │
│    │  Tracking         │────────▶│  System Bypass    │                      │
│    ├───────────────────┤  gates  ├───────────────────┤                      │
│    │ DC: Trail age     │         │ DC: Lock/barrier  │                      │
│    │ Skill: WS-Track   │         │ Skill: SysBypass  │                      │
│    │ Output: Lair found│         │ Output: Entry     │                      │
│    └───────────────────┘         └───────────────────┘                      │
│                                                                              │
│    SYNERGY: Avoid Patrol                                                     │
│    ─────────────────────────────────────────────────────────────────────    │
│                                                                              │
│    ┌───────────────────┐         ┌───────────────────┐                      │
│    │  PRIMARY CHECK    │         │  SECONDARY CHECK  │                      │
│    │  Hazard Detection │────────▶│  Acrobatics       │                      │
│    ├───────────────────┤  gates  ├───────────────────┤                      │
│    │ DC: Ambush DC     │         │ DC: Stealth DC    │                      │
│    │ Skill: WS-Hazard  │         │ Skill: Acro-Stlth │                      │
│    │ Output: Spotted   │         │ Output: Evaded    │                      │
│    └───────────────────┘         └───────────────────┘                      │
│                                                                              │
│    SYNERGY: Find and Loot                                                    │
│    ─────────────────────────────────────────────────────────────────────    │
│                                                                              │
│    ┌───────────────────┐         ┌───────────────────┐                      │
│    │  PRIMARY CHECK    │         │  SECONDARY CHECK  │                      │
│    │  Foraging         │────────▶│  System Bypass    │                      │
│    ├───────────────────┤  gates  ├───────────────────┤                      │
│    │ DC: Search DC     │         │ DC: Lock DC       │                      │
│    │ Skill: WS-Forage  │         │ Skill: SysBypass  │                      │
│    │ Output: Cache     │         │ Output: Opened    │                      │
│    └───────────────────┘         └───────────────────┘                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Interaction Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SERVICE INTERACTION DIAGRAM                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                   EXPLORATION COMMAND HANDLER                       │   │
│   │                      (e.g., "explore", "track")                     │   │
│   └─────────────────────────────┬───────────────────────────────────────┘   │
│                                 │                                            │
│                       requests combined check                                │
│                                 │                                            │
│                                 ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                   COMBINED CHECK SERVICE                            │   │
│   │                    (ICombinedCheckService)                          │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  + ExecuteCombinedCheck(player, synergyType, context)               │   │
│   │  + GetSynergyDefinition(synergyType)                                │   │
│   │  + GetPrimarySkill(synergyType)                                     │   │
│   │  + GetSecondarySkill(synergyType)                                   │   │
│   │  + ShouldExecuteSecondary(primaryResult)                            │   │
│   └──────────┬──────────────────────────┬───────────────────────────────┘   │
│              │                          │                                    │
│    primary check                  secondary check                            │
│              │                          │                                    │
│              ▼                          ▼                                    │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │  WASTELAND SURVIVAL     │  │  SECONDARY SKILL        │                  │
│   │  SERVICES               │  │  SERVICES               │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ INavigationService      │  │ IAcrobaticsService      │                  │
│   │ ITrackingService        │  │ ISystemBypassService    │                  │
│   │ IHazardDetectionService │  │                         │                  │
│   │ IForagingService        │  │                         │                  │
│   └─────────────────────────┘  └─────────────────────────┘                  │
│              │                          │                                    │
│              └──────────┬───────────────┘                                   │
│                         │                                                    │
│              loads synergy definitions                                       │
│                         │                                                    │
│                         ▼                                                    │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                   CONFIGURATION LOADER                              │   │
│   │                    (IConfigurationLoader)                           │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  + LoadCombinedChecks()                                             │   │
│   │  + GetSynergyDefinitions()                                          │   │
│   └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│   Data Flow:                                                                │
│   ─────────────────────────────────────────────────────────────────────    │
│   1. Command handler receives exploration action                            │
│   2. CombinedCheckService identifies applicable synergy                     │
│   3. Execute primary skill check (Wasteland Survival subsystem)            │
│   4. If primary succeeds, execute secondary skill check                     │
│   5. Combine results and return to command handler                          │
│   6. Command handler presents narrative outcome to player                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Enums/                                                              │    │
│  │  ├── SynergyType.cs                                                 │    │
│  │  │   └── FindHiddenPath, TrackToLair, AvoidPatrol, FindAndLoot     │    │
│  │  │                                                                   │    │
│  │  └── SecondaryCheckTiming.cs                                        │    │
│  │      └── OnPrimarySuccess, OnPrimaryCritical, Always               │    │
│  │                                                                      │    │
│  │  ValueObjects/                                                       │    │
│  │  ├── CombinedCheckContext.cs                                        │    │
│  │  │   └── PlayerId, SynergyType, PrimaryContext, SecondaryContext   │    │
│  │  │                                                                   │    │
│  │  ├── CombinedCheckResult.cs                                         │    │
│  │  │   └── PrimaryResult, SecondaryResult, OverallSuccess,           │    │
│  │  │       NarrativeDescription                                       │    │
│  │  │                                                                   │    │
│  │  └── SkillSynergyDefinition.cs                                      │    │
│  │      └── SynergyType, PrimarySkill, SecondarySkill,                │    │
│  │          SecondaryTiming, Description                               │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                         │    │
│  │  └── ICombinedCheckService.cs                                       │    │
│  │      ├── ExecuteCombinedCheck(player, synergyType, context)         │    │
│  │      ├── GetSynergyDefinition(synergyType)                          │    │
│  │      ├── GetAvailableSynergies(context)                             │    │
│  │      └── ShouldExecuteSecondary(primaryResult)                      │    │
│  │                                                                      │    │
│  │  Services/                                                           │    │
│  │  └── CombinedCheckService.cs                                        │    │
│  │      └── Implements ICombinedCheckService                           │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   INFRASTRUCTURE LAYER                               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  config/                                                             │    │
│  │  ├── combined-checks.json                                           │    │
│  │  │   └── Synergy definitions, skill pairings                        │    │
│  │  │                                                                   │    │
│  │  └── schemas/                                                        │    │
│  │      └── combined-checks.schema.json                                │    │
│  │          └── JSON Schema validation                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Combined Skill Check System

### 4.1 Purpose

The combined skill check system enables multi-step exploration actions where success in one skill (typically Wasteland Survival) gates access to a secondary skill check. This creates richer exploration gameplay and rewards versatile characters or cooperative parties.

### 4.2 Synergy Categories

| Synergy Type | Primary Skill | Secondary Skill | Situation |
|--------------|---------------|-----------------|-----------|
| **Find Hidden Path** | Navigation | Acrobatics (traverse) | Locate secret route, then traverse it |
| **Track to Lair** | Tracking | System Bypass (enter) | Follow trail to den, then gain entry |
| **Avoid Patrol** | Hazard Detection | Acrobatics (Stealth) | Spot patrol, then evade undetected |
| **Find and Loot** | Foraging | System Bypass (locked) | Discover cache, then open it |

### 4.3 CombinedCheckContext Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/CombinedCheckContext.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Context for executing a combined skill check.
/// </summary>
/// <remarks>
/// CombinedCheckContext provides all information needed to execute a multi-skill
/// exploration action:
/// - Identifies the synergy type being attempted
/// - Contains context for both primary and secondary checks
/// - Tracks the player initiating the action
/// </remarks>
/// <param name="PlayerId">Identifier for the player making the check.</param>
/// <param name="SynergyType">The type of skill synergy being executed.</param>
/// <param name="PrimaryContext">Context for the primary skill check.</param>
/// <param name="SecondaryContext">Context for the secondary skill check.</param>
public readonly record struct CombinedCheckContext(
    string PlayerId,
    SynergyType SynergyType,
    object PrimaryContext,
    object SecondaryContext)
{
    /// <summary>
    /// Gets the primary context as NavigationContext.
    /// </summary>
    public NavigationContext? AsNavigationContext =>
        PrimaryContext as NavigationContext?;

    /// <summary>
    /// Gets the primary context as TrackingContext.
    /// </summary>
    public TrackingContext? AsTrackingContext =>
        PrimaryContext as TrackingContext?;

    /// <summary>
    /// Gets the primary context as HazardDetectionContext.
    /// </summary>
    public HazardDetectionContext? AsHazardDetectionContext =>
        PrimaryContext as HazardDetectionContext?;

    /// <summary>
    /// Gets the primary context as ForagingContext.
    /// </summary>
    public ForagingContext? AsForagingContext =>
        PrimaryContext as ForagingContext?;

    /// <summary>
    /// Creates a display string for this context.
    /// </summary>
    public string ToDisplayString() =>
        $"Combined Check: {SynergyType} for player {PlayerId}";
}
```

### 4.4 CombinedCheckResult Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/CombinedCheckResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Result of executing a combined skill check.
/// </summary>
/// <remarks>
/// CombinedCheckResult captures the outcome of both the primary and secondary
/// skill checks, along with narrative description and overall success determination.
/// </remarks>
/// <param name="SynergyType">The synergy type that was executed.</param>
/// <param name="PrimaryResult">Result of the primary skill check.</param>
/// <param name="SecondaryResult">Result of the secondary skill check (null if not executed).</param>
/// <param name="OverallSuccess">Whether both checks succeeded.</param>
/// <param name="NarrativeDescription">Player-facing description of the outcome.</param>
public readonly record struct CombinedCheckResult(
    SynergyType SynergyType,
    SkillCheckResult PrimaryResult,
    SkillCheckResult? SecondaryResult,
    bool OverallSuccess,
    string NarrativeDescription)
{
    /// <summary>
    /// Gets whether the primary check succeeded.
    /// </summary>
    public bool PrimarySucceeded => PrimaryResult.Succeeded;

    /// <summary>
    /// Gets whether the secondary check was executed.
    /// </summary>
    public bool SecondaryExecuted => SecondaryResult.HasValue;

    /// <summary>
    /// Gets whether the secondary check succeeded (false if not executed).
    /// </summary>
    public bool SecondarySucceeded => SecondaryResult?.Succeeded ?? false;

    /// <summary>
    /// Gets whether the primary check was a fumble.
    /// </summary>
    public bool PrimaryFumbled => PrimaryResult.IsFumble;

    /// <summary>
    /// Gets whether the secondary check was a fumble.
    /// </summary>
    public bool SecondaryFumbled => SecondaryResult?.IsFumble ?? false;

    /// <summary>
    /// Creates a result for primary failure (no secondary executed).
    /// </summary>
    public static CombinedCheckResult PrimaryFailed(
        SynergyType synergyType,
        SkillCheckResult primaryResult,
        string narrative) =>
        new(synergyType, primaryResult, null, false, narrative);

    /// <summary>
    /// Creates a result for complete success (both checks passed).
    /// </summary>
    public static CombinedCheckResult FullSuccess(
        SynergyType synergyType,
        SkillCheckResult primaryResult,
        SkillCheckResult secondaryResult,
        string narrative) =>
        new(synergyType, primaryResult, secondaryResult, true, narrative);

    /// <summary>
    /// Creates a result for partial success (primary passed, secondary failed).
    /// </summary>
    public static CombinedCheckResult PartialSuccess(
        SynergyType synergyType,
        SkillCheckResult primaryResult,
        SkillCheckResult secondaryResult,
        string narrative) =>
        new(synergyType, primaryResult, secondaryResult, false, narrative);

    /// <summary>
    /// Creates a display string for this result.
    /// </summary>
    public string ToDisplayString()
    {
        var status = OverallSuccess ? "SUCCESS" :
                     PrimarySucceeded ? "PARTIAL" : "FAILED";

        return $"[{status}] {SynergyType}: {NarrativeDescription}";
    }
}
```

### 4.5 SkillSynergyDefinition Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SkillSynergyDefinition.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines a skill synergy pairing for combined checks.
/// </summary>
/// <remarks>
/// SkillSynergyDefinition captures the relationship between primary and secondary
/// skills in a combined check:
/// - Which skills are involved
/// - When the secondary check triggers
/// - Narrative framing for the synergy
/// </remarks>
/// <param name="SynergyType">Identifier for this synergy.</param>
/// <param name="PrimarySkill">The gating skill (Wasteland Survival subsystem).</param>
/// <param name="SecondarySkill">The follow-up skill.</param>
/// <param name="SecondaryTiming">When the secondary check executes.</param>
/// <param name="Description">Player-facing description of this synergy.</param>
public readonly record struct SkillSynergyDefinition(
    SynergyType SynergyType,
    WastelandSurvivalCheckType PrimarySkill,
    SkillType SecondarySkill,
    SecondaryCheckTiming SecondaryTiming,
    string Description)
{
    /// <summary>
    /// Gets whether the secondary check always executes.
    /// </summary>
    public bool SecondaryAlwaysExecutes =>
        SecondaryTiming == SecondaryCheckTiming.Always;

    /// <summary>
    /// Gets whether the secondary check requires primary success.
    /// </summary>
    public bool RequiresPrimarySuccess =>
        SecondaryTiming == SecondaryCheckTiming.OnPrimarySuccess ||
        SecondaryTiming == SecondaryCheckTiming.OnPrimaryCritical;

    /// <summary>
    /// Gets whether the secondary check requires primary critical success.
    /// </summary>
    public bool RequiresPrimaryCritical =>
        SecondaryTiming == SecondaryCheckTiming.OnPrimaryCritical;

    /// <summary>
    /// Creates the Find Hidden Path synergy definition.
    /// </summary>
    public static SkillSynergyDefinition FindHiddenPath() =>
        new(
            SynergyType.FindHiddenPath,
            WastelandSurvivalCheckType.Navigation,
            SkillType.Acrobatics,
            SecondaryCheckTiming.OnPrimarySuccess,
            "Navigate to find a hidden path, then traverse the difficult terrain.");

    /// <summary>
    /// Creates the Track to Lair synergy definition.
    /// </summary>
    public static SkillSynergyDefinition TrackToLair() =>
        new(
            SynergyType.TrackToLair,
            WastelandSurvivalCheckType.Tracking,
            SkillType.SystemBypass,
            SecondaryCheckTiming.OnPrimarySuccess,
            "Track prey to its lair, then bypass the entrance security.");

    /// <summary>
    /// Creates the Avoid Patrol synergy definition.
    /// </summary>
    public static SkillSynergyDefinition AvoidPatrol() =>
        new(
            SynergyType.AvoidPatrol,
            WastelandSurvivalCheckType.HazardDetection,
            SkillType.Acrobatics,
            SecondaryCheckTiming.OnPrimarySuccess,
            "Detect an approaching patrol, then use stealth to evade them.");

    /// <summary>
    /// Creates the Find and Loot synergy definition.
    /// </summary>
    public static SkillSynergyDefinition FindAndLoot() =>
        new(
            SynergyType.FindAndLoot,
            WastelandSurvivalCheckType.Foraging,
            SkillType.SystemBypass,
            SecondaryCheckTiming.OnPrimarySuccess,
            "Discover a locked cache while foraging, then bypass the lock.");
}
```

---

## 5. Find Hidden Path Synergy

### 5.1 Overview

The Find Hidden Path synergy combines Navigation (Wasteland Survival) with Acrobatics to locate and traverse secret or difficult passages.

### 5.2 Primary Check: Navigation

**Skill:** Wasteland Survival - Navigation
**DC:** Terrain-based (see v0.15.5d)
**Success:** Hidden path discovered, location revealed
**Failure:** No path found, may retry after backtracking

```csharp
/// <summary>
/// Executes the primary navigation check for Find Hidden Path.
/// </summary>
public SkillCheckResult ExecuteFindPathNavigation(
    Player player,
    NavigationContext context)
{
    var baseDc = GetTerrainDc(context.TerrainType);
    var modifiedDc = baseDc + 4; // Hidden paths are harder to find

    return _navigationService.PerformNavigationCheck(player, context, modifiedDc);
}
```

### 5.3 Secondary Check: Acrobatics (Traverse)

**Skill:** Acrobatics
**DC:** Path difficulty (DC 10-18 based on path type)
**Success:** Path traversed safely
**Failure:** Stuck, may need to find alternate route
**Fumble:** Fall or injury during traversal

| Path Type | Acrobatics DC | Description |
|-----------|---------------|-------------|
| Narrow ledge | 10 | Simple balance required |
| Collapsed tunnel | 14 | Climbing and squeezing |
| Vertical shaft | 16 | Significant climb |
| Crumbling facade | 18 | Dangerous, unstable surfaces |

```csharp
/// <summary>
/// Executes the secondary acrobatics check for traversing the found path.
/// </summary>
public SkillCheckResult ExecutePathTraversal(
    Player player,
    PathTraversalContext context)
{
    var dc = GetPathDc(context.PathType);

    return _acrobaticsService.PerformTraversalCheck(player, context, dc);
}
```

### 5.4 Combined Outcome

| Primary | Secondary | Outcome |
|---------|-----------|---------|
| Success | Success | Path found and traversed, reach destination |
| Success | Failure | Path found but cannot traverse, stuck |
| Success | Fumble | Path found, fall/injury during traversal |
| Failure | — | No path found |
| Fumble | — | Get lost, navigation fumble consequence |

---

## 6. Track to Lair Synergy

### 6.1 Overview

The Track to Lair synergy combines Tracking (Wasteland Survival) with System Bypass to follow prey to its den and gain entry.

### 6.2 Primary Check: Tracking

**Skill:** Wasteland Survival - Tracking
**DC:** Trail age-based (see v0.15.5a)
**Success:** Lair location discovered
**Failure:** Trail lost, must recover

```csharp
/// <summary>
/// Executes the primary tracking check for Track to Lair.
/// </summary>
public SkillCheckResult ExecuteTrackToLair(
    Player player,
    TrackingContext context)
{
    // Uses standard tracking with ClosingIn phase bonus
    return _trackingService.PerformTrackingCheck(player, context);
}
```

### 6.3 Secondary Check: System Bypass (Enter)

**Skill:** System Bypass
**DC:** Lair security (DC 10-20 based on creature type)
**Success:** Entry gained silently
**Failure:** Entry blocked, alert creature
**Fumble:** Trap triggered or creature alerted

| Lair Type | System Bypass DC | Description |
|-----------|------------------|-------------|
| Simple den | 10 | Blocked entrance, no lock |
| Burrow | 12 | Dug-out collapse risk |
| Fortified nest | 16 | Constructed defenses |
| Secured cave | 20 | Mechanical or trapped entrance |

```csharp
/// <summary>
/// Executes the secondary system bypass check for entering the lair.
/// </summary>
public SkillCheckResult ExecuteLairEntry(
    Player player,
    LairEntryContext context)
{
    var dc = GetLairSecurityDc(context.LairType);

    return _systemBypassService.PerformBypassCheck(player, context, dc);
}
```

### 6.4 Combined Outcome

| Primary | Secondary | Outcome |
|---------|-----------|---------|
| Success | Success | Lair found and entered silently |
| Success | Failure | Lair found but entry blocked, creature alert |
| Success | Fumble | Lair found, trap sprung or ambushed |
| Failure | — | Trail lost, lair not found |
| Fumble | — | Trail lost, tracking fumble consequence |

---

## 7. Avoid Patrol Synergy

### 7.1 Overview

The Avoid Patrol synergy combines Hazard Detection (Wasteland Survival) with Acrobatics (Stealth) to spot and evade enemy patrols.

### 7.2 Primary Check: Hazard Detection

**Skill:** Wasteland Survival - Hazard Detection
**DC:** Ambush site DC (16, see v0.15.5e)
**Success:** Patrol spotted before detection
**Failure:** Patrol not spotted, encounter begins

```csharp
/// <summary>
/// Executes the primary hazard detection check for spotting patrol.
/// </summary>
public SkillCheckResult ExecuteSpotPatrol(
    Player player,
    HazardDetectionContext context)
{
    // Ambush site DC applies
    return _hazardDetectionService.PerformDetectionCheck(
        player,
        context,
        HazardType.AmbushSite);
}
```

### 7.3 Secondary Check: Acrobatics (Stealth)

**Skill:** Acrobatics (Stealth mode)
**DC:** Patrol perception (contested or DC 14-18)
**Success:** Evade patrol undetected
**Failure:** Spotted, pursuit begins
**Fumble:** Spotted and surrounded

| Patrol Type | Stealth DC | Description |
|-------------|------------|-------------|
| Inattentive guards | 14 | Bored, distracted |
| Alert patrol | 16 | Active scanning |
| Elite hunters | 18 | Professional trackers |
| Contested | Varies | Patrol's Perception roll |

```csharp
/// <summary>
/// Executes the secondary acrobatics (stealth) check for evading patrol.
/// </summary>
public SkillCheckResult ExecuteEvadePatrol(
    Player player,
    StealthContext context)
{
    var dc = GetPatrolPerceptionDc(context.PatrolType);

    return _acrobaticsService.PerformStealthCheck(player, context, dc);
}
```

### 7.4 Combined Outcome

| Primary | Secondary | Outcome |
|---------|-----------|---------|
| Success | Success | Patrol spotted and evaded |
| Success | Failure | Patrol spotted but detected, chase begins |
| Success | Fumble | Patrol spotted, surrounded during evasion |
| Failure | — | Patrol not spotted, surprise encounter |
| Fumble | — | Walk directly into ambush |

---

## 8. Find and Loot Synergy

### 8.1 Overview

The Find and Loot synergy combines Foraging (Wasteland Survival) with System Bypass to discover and open locked caches.

### 8.2 Primary Check: Foraging

**Skill:** Wasteland Survival - Foraging
**DC:** Hidden cache DC (22, see v0.15.5c)
**Success:** Locked cache discovered
**Failure:** No cache found (normal foraging results)

```csharp
/// <summary>
/// Executes the primary foraging check for finding a cache.
/// </summary>
public SkillCheckResult ExecuteFindCache(
    Player player,
    ForagingContext context)
{
    // Cache discovery check (DC 22)
    return _foragingService.PerformCacheDiscoveryCheck(player, context);
}
```

### 8.3 Secondary Check: System Bypass (Unlock)

**Skill:** System Bypass
**DC:** Lock complexity (DC 12-20)
**Success:** Cache opened, contents acquired
**Failure:** Lock intact, cache found but sealed
**Fumble:** Lock jammed, contents potentially damaged

| Lock Type | System Bypass DC | Description |
|-----------|------------------|-------------|
| Simple latch | 12 | Basic mechanical lock |
| Combination lock | 14 | Multi-tumbler mechanism |
| Electronic lock | 16 | Keypad or card reader |
| Secured vault | 20 | Multiple security layers |

```csharp
/// <summary>
/// Executes the secondary system bypass check for opening the cache.
/// </summary>
public SkillCheckResult ExecuteOpenCache(
    Player player,
    LockBypassContext context)
{
    var dc = GetLockDc(context.LockType);

    return _systemBypassService.PerformLockpickCheck(player, context, dc);
}
```

### 8.4 Combined Outcome

| Primary | Secondary | Outcome |
|---------|-----------|---------|
| Success | Success | Cache found and opened, full loot |
| Success | Failure | Cache found but locked, can retry bypass |
| Success | Fumble | Cache found, lock jammed permanently |
| Failure | — | No cache found, standard foraging only |
| Fumble | — | Foraging fumble consequence |

---

## 9. ICombinedCheckService Interface

### 9.1 Purpose

The `ICombinedCheckService` interface defines the contract for executing combined skill checks that link Wasteland Survival with other skills.

### 9.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Interfaces/ICombinedCheckService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service interface for combined skill checks in the Exploration Synergies system.
/// </summary>
public interface ICombinedCheckService
{
    /// <summary>
    /// Executes a combined skill check with primary and secondary components.
    /// </summary>
    /// <param name="player">The player making the check.</param>
    /// <param name="synergyType">The type of synergy being executed.</param>
    /// <param name="context">Context for both checks.</param>
    /// <returns>Combined result of both checks.</returns>
    CombinedCheckResult ExecuteCombinedCheck(
        Player player,
        SynergyType synergyType,
        CombinedCheckContext context);

    /// <summary>
    /// Gets the definition for a skill synergy.
    /// </summary>
    /// <param name="synergyType">The synergy type to look up.</param>
    /// <returns>The synergy definition.</returns>
    SkillSynergyDefinition GetSynergyDefinition(SynergyType synergyType);

    /// <summary>
    /// Gets all synergies available in the current context.
    /// </summary>
    /// <param name="context">The current exploration context.</param>
    /// <returns>List of available synergies.</returns>
    IReadOnlyList<SynergyType> GetAvailableSynergies(ExplorationContext context);

    /// <summary>
    /// Determines if the secondary check should execute based on primary result.
    /// </summary>
    /// <param name="synergyType">The synergy being executed.</param>
    /// <param name="primaryResult">The result of the primary check.</param>
    /// <returns>True if secondary check should execute.</returns>
    bool ShouldExecuteSecondary(SynergyType synergyType, SkillCheckResult primaryResult);

    /// <summary>
    /// Gets the primary skill for a synergy.
    /// </summary>
    /// <param name="synergyType">The synergy type.</param>
    /// <returns>The primary Wasteland Survival check type.</returns>
    WastelandSurvivalCheckType GetPrimarySkill(SynergyType synergyType);

    /// <summary>
    /// Gets the secondary skill for a synergy.
    /// </summary>
    /// <param name="synergyType">The synergy type.</param>
    /// <returns>The secondary skill type.</returns>
    SkillType GetSecondarySkill(SynergyType synergyType);

    /// <summary>
    /// Generates narrative description for a combined check result.
    /// </summary>
    /// <param name="synergyType">The synergy type.</param>
    /// <param name="primaryResult">The primary check result.</param>
    /// <param name="secondaryResult">The secondary check result (if executed).</param>
    /// <returns>Player-facing narrative description.</returns>
    string GenerateNarrative(
        SynergyType synergyType,
        SkillCheckResult primaryResult,
        SkillCheckResult? secondaryResult);
}
```

---

## 10. CombinedCheckService Implementation

### 10.1 Purpose

The `CombinedCheckService` implements the combined skill check system, coordinating between Wasteland Survival subsystems and secondary skills.

### 10.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Services/CombinedCheckService.cs`

```csharp
namespace RuneAndRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Implements combined skill checks for the Exploration Synergies system.
/// </summary>
/// <remarks>
/// The CombinedCheckService handles multi-skill exploration actions:
///
/// Find Hidden Path: Navigation → Acrobatics (traverse)
/// Track to Lair: Tracking → System Bypass (enter)
/// Avoid Patrol: Hazard Detection → Acrobatics (Stealth)
/// Find and Loot: Foraging → System Bypass (locked)
///
/// Each synergy follows the pattern:
/// 1. Execute primary Wasteland Survival check
/// 2. If primary succeeds, execute secondary skill check
/// 3. Combine results with appropriate narrative
/// </remarks>
public class CombinedCheckService : ICombinedCheckService
{
    private readonly INavigationService _navigationService;
    private readonly ITrackingService _trackingService;
    private readonly IHazardDetectionService _hazardDetectionService;
    private readonly IForagingService _foragingService;
    private readonly IAcrobaticsService _acrobaticsService;
    private readonly ISystemBypassService _systemBypassService;
    private readonly IConfigurationLoader _configLoader;
    private readonly ILogger<CombinedCheckService> _logger;

    private readonly Dictionary<SynergyType, SkillSynergyDefinition> _synergies;

    public CombinedCheckService(
        INavigationService navigationService,
        ITrackingService trackingService,
        IHazardDetectionService hazardDetectionService,
        IForagingService foragingService,
        IAcrobaticsService acrobaticsService,
        ISystemBypassService systemBypassService,
        IConfigurationLoader configLoader,
        ILogger<CombinedCheckService> logger)
    {
        _navigationService = navigationService;
        _trackingService = trackingService;
        _hazardDetectionService = hazardDetectionService;
        _foragingService = foragingService;
        _acrobaticsService = acrobaticsService;
        _systemBypassService = systemBypassService;
        _configLoader = configLoader;
        _logger = logger;

        _synergies = InitializeSynergies();
    }

    private static Dictionary<SynergyType, SkillSynergyDefinition> InitializeSynergies()
    {
        return new Dictionary<SynergyType, SkillSynergyDefinition>
        {
            [SynergyType.FindHiddenPath] = SkillSynergyDefinition.FindHiddenPath(),
            [SynergyType.TrackToLair] = SkillSynergyDefinition.TrackToLair(),
            [SynergyType.AvoidPatrol] = SkillSynergyDefinition.AvoidPatrol(),
            [SynergyType.FindAndLoot] = SkillSynergyDefinition.FindAndLoot()
        };
    }

    /// <inheritdoc />
    public CombinedCheckResult ExecuteCombinedCheck(
        Player player,
        SynergyType synergyType,
        CombinedCheckContext context)
    {
        _logger.LogInformation(
            "Executing combined check {SynergyType} for player {PlayerId}",
            synergyType, player.Id);

        var definition = GetSynergyDefinition(synergyType);

        // Execute primary check
        var primaryResult = ExecutePrimaryCheck(player, synergyType, context);

        _logger.LogDebug(
            "Primary check result: Succeeded={Succeeded}, Fumble={Fumble}",
            primaryResult.Succeeded, primaryResult.IsFumble);

        // Determine if secondary should execute
        if (!ShouldExecuteSecondary(synergyType, primaryResult))
        {
            var narrative = GenerateNarrative(synergyType, primaryResult, null);
            return CombinedCheckResult.PrimaryFailed(synergyType, primaryResult, narrative);
        }

        // Execute secondary check
        var secondaryResult = ExecuteSecondaryCheck(player, synergyType, context);

        _logger.LogDebug(
            "Secondary check result: Succeeded={Succeeded}, Fumble={Fumble}",
            secondaryResult.Succeeded, secondaryResult.IsFumble);

        // Build combined result
        var combinedNarrative = GenerateNarrative(synergyType, primaryResult, secondaryResult);

        if (secondaryResult.Succeeded)
        {
            return CombinedCheckResult.FullSuccess(
                synergyType, primaryResult, secondaryResult, combinedNarrative);
        }
        else
        {
            return CombinedCheckResult.PartialSuccess(
                synergyType, primaryResult, secondaryResult, combinedNarrative);
        }
    }

    private SkillCheckResult ExecutePrimaryCheck(
        Player player,
        SynergyType synergyType,
        CombinedCheckContext context)
    {
        return synergyType switch
        {
            SynergyType.FindHiddenPath =>
                _navigationService.PerformNavigationCheck(
                    player,
                    context.AsNavigationContext!.Value),

            SynergyType.TrackToLair =>
                _trackingService.PerformTrackingCheck(
                    player,
                    context.AsTrackingContext!.Value),

            SynergyType.AvoidPatrol =>
                _hazardDetectionService.PerformDetectionCheck(
                    player,
                    context.AsHazardDetectionContext!.Value),

            SynergyType.FindAndLoot =>
                _foragingService.PerformForagingCheck(
                    player,
                    context.AsForagingContext!.Value),

            _ => throw new ArgumentException($"Unknown synergy type: {synergyType}")
        };
    }

    private SkillCheckResult ExecuteSecondaryCheck(
        Player player,
        SynergyType synergyType,
        CombinedCheckContext context)
    {
        return synergyType switch
        {
            SynergyType.FindHiddenPath =>
                _acrobaticsService.PerformTraversalCheck(player, context.SecondaryContext),

            SynergyType.TrackToLair =>
                _systemBypassService.PerformBypassCheck(player, context.SecondaryContext),

            SynergyType.AvoidPatrol =>
                _acrobaticsService.PerformStealthCheck(player, context.SecondaryContext),

            SynergyType.FindAndLoot =>
                _systemBypassService.PerformLockpickCheck(player, context.SecondaryContext),

            _ => throw new ArgumentException($"Unknown synergy type: {synergyType}")
        };
    }

    /// <inheritdoc />
    public SkillSynergyDefinition GetSynergyDefinition(SynergyType synergyType)
    {
        if (_synergies.TryGetValue(synergyType, out var definition))
        {
            return definition;
        }

        throw new ArgumentException($"Unknown synergy type: {synergyType}");
    }

    /// <inheritdoc />
    public IReadOnlyList<SynergyType> GetAvailableSynergies(ExplorationContext context)
    {
        var available = new List<SynergyType>();

        // FindHiddenPath available when navigating
        if (context.AllowsNavigation)
        {
            available.Add(SynergyType.FindHiddenPath);
        }

        // TrackToLair available when tracking
        if (context.HasActiveTracking)
        {
            available.Add(SynergyType.TrackToLair);
        }

        // AvoidPatrol available when patrols present
        if (context.HasPatrols)
        {
            available.Add(SynergyType.AvoidPatrol);
        }

        // FindAndLoot available when foraging
        if (context.AllowsForaging)
        {
            available.Add(SynergyType.FindAndLoot);
        }

        return available;
    }

    /// <inheritdoc />
    public bool ShouldExecuteSecondary(SynergyType synergyType, SkillCheckResult primaryResult)
    {
        var definition = GetSynergyDefinition(synergyType);

        return definition.SecondaryTiming switch
        {
            SecondaryCheckTiming.Always => true,
            SecondaryCheckTiming.OnPrimarySuccess => primaryResult.Succeeded,
            SecondaryCheckTiming.OnPrimaryCritical => primaryResult.IsCritical,
            _ => false
        };
    }

    /// <inheritdoc />
    public WastelandSurvivalCheckType GetPrimarySkill(SynergyType synergyType)
    {
        return GetSynergyDefinition(synergyType).PrimarySkill;
    }

    /// <inheritdoc />
    public SkillType GetSecondarySkill(SynergyType synergyType)
    {
        return GetSynergyDefinition(synergyType).SecondarySkill;
    }

    /// <inheritdoc />
    public string GenerateNarrative(
        SynergyType synergyType,
        SkillCheckResult primaryResult,
        SkillCheckResult? secondaryResult)
    {
        return synergyType switch
        {
            SynergyType.FindHiddenPath =>
                GenerateFindPathNarrative(primaryResult, secondaryResult),

            SynergyType.TrackToLair =>
                GenerateTrackToLairNarrative(primaryResult, secondaryResult),

            SynergyType.AvoidPatrol =>
                GenerateAvoidPatrolNarrative(primaryResult, secondaryResult),

            SynergyType.FindAndLoot =>
                GenerateFindAndLootNarrative(primaryResult, secondaryResult),

            _ => "The exploration attempt concludes."
        };
    }

    private static string GenerateFindPathNarrative(
        SkillCheckResult primary,
        SkillCheckResult? secondary)
    {
        if (!primary.Succeeded)
        {
            return primary.IsFumble
                ? "You become hopelessly lost searching for a hidden path."
                : "You search thoroughly but find no hidden passages.";
        }

        if (secondary == null)
        {
            return "You spot a hidden path but cannot reach it.";
        }

        if (secondary.Value.Succeeded)
        {
            return "You discover a hidden path and traverse it successfully, " +
                   "reaching your destination unseen.";
        }

        return secondary.Value.IsFumble
            ? "You find the hidden path but slip during traversal, taking damage."
            : "You find the hidden path but cannot navigate the difficult terrain.";
    }

    private static string GenerateTrackToLairNarrative(
        SkillCheckResult primary,
        SkillCheckResult? secondary)
    {
        if (!primary.Succeeded)
        {
            return primary.IsFumble
                ? "The trail leads you into a dead end—you've been misled."
                : "The trail goes cold. You'll need to find it again.";
        }

        if (secondary == null)
        {
            return "You track the creature to its lair but the entrance is sealed.";
        }

        if (secondary.Value.Succeeded)
        {
            return "You follow the trail to the creature's lair and slip " +
                   "inside undetected.";
        }

        return secondary.Value.IsFumble
            ? "You find the lair but trigger its defenses while entering!"
            : "You find the lair but cannot bypass its entrance. The creature stirs within.";
    }

    private static string GenerateAvoidPatrolNarrative(
        SkillCheckResult primary,
        SkillCheckResult? secondary)
    {
        if (!primary.Succeeded)
        {
            return primary.IsFumble
                ? "You walk directly into the patrol's path!"
                : "You don't notice the patrol until it's too late.";
        }

        if (secondary == null)
        {
            return "You spot the patrol but have nowhere to hide.";
        }

        if (secondary.Value.Succeeded)
        {
            return "You spot the patrol and slip into the shadows, " +
                   "evading them completely.";
        }

        return secondary.Value.IsFumble
            ? "You spot the patrol but knock something over while hiding—they surround you!"
            : "You spot the patrol but they catch a glimpse of you—the chase is on!";
    }

    private static string GenerateFindAndLootNarrative(
        SkillCheckResult primary,
        SkillCheckResult? secondary)
    {
        if (!primary.Succeeded)
        {
            return primary.IsFumble
                ? "Your search disturbs something dangerous."
                : "You find nothing of particular value.";
        }

        if (secondary == null)
        {
            return "You discover a locked cache but lack the tools to open it.";
        }

        if (secondary.Value.Succeeded)
        {
            return "You discover a locked cache and deftly bypass its " +
                   "mechanism, claiming its contents.";
        }

        return secondary.Value.IsFumble
            ? "You find a cache but jam the lock permanently while attempting to open it."
            : "You find a cache but cannot bypass its lock. It remains sealed.";
    }
}
```

---

## 11. Data Model Changes

### 11.1 New Enums

| Enum | Layer | Description |
|------|-------|-------------|
| `SynergyType` | Domain | Types of skill synergies |
| `SecondaryCheckTiming` | Domain | When secondary check executes |

### 11.2 New Value Objects

| Value Object | Layer | Description |
|--------------|-------|-------------|
| `CombinedCheckContext` | Domain | Context for combined checks |
| `CombinedCheckResult` | Domain | Result of combined checks |
| `SkillSynergyDefinition` | Domain | Definition of skill pairings |

### 11.3 New Interfaces

| Interface | Layer | Description |
|-----------|-------|-------------|
| `ICombinedCheckService` | Application | Combined check service contract |

### 11.4 New Services

| Service | Layer | Description |
|---------|-------|-------------|
| `CombinedCheckService` | Application | Combined check implementation |

### 11.5 SynergyType Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/SynergyType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Types of skill synergies for combined exploration checks.
/// </summary>
public enum SynergyType
{
    /// <summary>Navigation + Acrobatics: Find and traverse hidden path.</summary>
    FindHiddenPath = 0,

    /// <summary>Tracking + System Bypass: Follow trail and enter lair.</summary>
    TrackToLair = 1,

    /// <summary>Hazard Detection + Acrobatics: Spot and evade patrol.</summary>
    AvoidPatrol = 2,

    /// <summary>Foraging + System Bypass: Find and open locked cache.</summary>
    FindAndLoot = 3
}
```

### 11.6 SecondaryCheckTiming Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/SecondaryCheckTiming.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// When the secondary check in a combined check should execute.
/// </summary>
public enum SecondaryCheckTiming
{
    /// <summary>Secondary check executes only on primary success.</summary>
    OnPrimarySuccess = 0,

    /// <summary>Secondary check executes only on primary critical success.</summary>
    OnPrimaryCritical = 1,

    /// <summary>Secondary check always executes regardless of primary result.</summary>
    Always = 2
}
```

---

## 12. Configuration Files

### 12.1 combined-checks.json

**File:** `config/combined-checks.json`

```json
{
    "$schema": "./schemas/combined-checks.schema.json",
    "synergies": [
        {
            "id": "find-hidden-path",
            "displayName": "Find Hidden Path",
            "primarySkill": "navigation",
            "secondarySkill": "acrobatics",
            "secondaryMode": "traverse",
            "timing": "on-primary-success",
            "description": "Navigate to find a hidden path, then traverse the difficult terrain.",
            "narratives": {
                "fullSuccess": "You discover a hidden path and traverse it successfully.",
                "partialSuccess": "You find the hidden path but cannot navigate the terrain.",
                "primaryFailure": "You search thoroughly but find no hidden passages.",
                "primaryFumble": "You become hopelessly lost searching for a hidden path."
            }
        },
        {
            "id": "track-to-lair",
            "displayName": "Track to Lair",
            "primarySkill": "tracking",
            "secondarySkill": "system-bypass",
            "secondaryMode": "enter",
            "timing": "on-primary-success",
            "description": "Track prey to its lair, then bypass the entrance security.",
            "narratives": {
                "fullSuccess": "You follow the trail to the lair and slip inside undetected.",
                "partialSuccess": "You find the lair but cannot bypass its entrance.",
                "primaryFailure": "The trail goes cold. You'll need to find it again.",
                "primaryFumble": "The trail leads you into a dead end—you've been misled."
            }
        },
        {
            "id": "avoid-patrol",
            "displayName": "Avoid Patrol",
            "primarySkill": "hazard-detection",
            "secondarySkill": "acrobatics",
            "secondaryMode": "stealth",
            "timing": "on-primary-success",
            "description": "Detect an approaching patrol, then use stealth to evade them.",
            "narratives": {
                "fullSuccess": "You spot the patrol and slip into the shadows, evading them.",
                "partialSuccess": "You spot the patrol but they catch a glimpse of you.",
                "primaryFailure": "You don't notice the patrol until it's too late.",
                "primaryFumble": "You walk directly into the patrol's path!"
            }
        },
        {
            "id": "find-and-loot",
            "displayName": "Find and Loot",
            "primarySkill": "foraging",
            "secondarySkill": "system-bypass",
            "secondaryMode": "lockpick",
            "timing": "on-primary-success",
            "description": "Discover a locked cache while foraging, then bypass the lock.",
            "narratives": {
                "fullSuccess": "You discover a locked cache and deftly bypass its mechanism.",
                "partialSuccess": "You find a cache but cannot bypass its lock.",
                "primaryFailure": "You find nothing of particular value.",
                "primaryFumble": "Your search disturbs something dangerous."
            }
        }
    ],
    "secondaryDCs": {
        "find-hidden-path": {
            "narrow-ledge": 10,
            "collapsed-tunnel": 14,
            "vertical-shaft": 16,
            "crumbling-facade": 18
        },
        "track-to-lair": {
            "simple-den": 10,
            "burrow": 12,
            "fortified-nest": 16,
            "secured-cave": 20
        },
        "avoid-patrol": {
            "inattentive": 14,
            "alert": 16,
            "elite": 18
        },
        "find-and-loot": {
            "simple-latch": 12,
            "combination": 14,
            "electronic": 16,
            "secured-vault": 20
        }
    }
}
```

### 12.2 combined-checks.schema.json

**File:** `config/schemas/combined-checks.schema.json`

```json
{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runeandrust.game/schemas/combined-checks.schema.json",
    "title": "Combined Checks Configuration",
    "description": "Configuration schema for combined skill checks in Exploration Synergies",
    "type": "object",
    "required": ["synergies"],
    "properties": {
        "synergies": {
            "type": "array",
            "description": "Array of synergy definitions",
            "items": {
                "type": "object",
                "required": ["id", "displayName", "primarySkill", "secondarySkill", "timing"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the synergy"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Human-readable name"
                    },
                    "primarySkill": {
                        "type": "string",
                        "enum": ["navigation", "tracking", "hazard-detection", "foraging"],
                        "description": "Primary Wasteland Survival skill"
                    },
                    "secondarySkill": {
                        "type": "string",
                        "enum": ["acrobatics", "system-bypass"],
                        "description": "Secondary skill"
                    },
                    "secondaryMode": {
                        "type": "string",
                        "description": "Specific mode of secondary skill"
                    },
                    "timing": {
                        "type": "string",
                        "enum": ["on-primary-success", "on-primary-critical", "always"],
                        "description": "When secondary check executes"
                    },
                    "description": {
                        "type": "string",
                        "description": "Player-facing description"
                    },
                    "narratives": {
                        "type": "object",
                        "properties": {
                            "fullSuccess": { "type": "string" },
                            "partialSuccess": { "type": "string" },
                            "primaryFailure": { "type": "string" },
                            "primaryFumble": { "type": "string" }
                        }
                    }
                }
            }
        },
        "secondaryDCs": {
            "type": "object",
            "description": "DC tables for secondary checks by synergy and situation",
            "additionalProperties": {
                "type": "object",
                "additionalProperties": {
                    "type": "integer",
                    "minimum": 8,
                    "maximum": 24
                }
            }
        }
    }
}
```

### 12.3 Configuration Schema Summary

| Config File | Schema File | Purpose |
|-------------|-------------|---------|
| `combined-checks.json` | `combined-checks.schema.json` | Synergy definitions, DCs, narratives |

---

## 13. Logging Specifications

### 13.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `CombinedCheckService` | Information | Combined check execution, synergy identified |
| `CombinedCheckService` | Debug | Primary/secondary check results, timing decisions |
| `CombinedCheckService` | Warning | Unknown synergy type, missing context |
| `CombinedCheckService` | Error | Service dependency failures |

### 13.2 Log Message Examples

```
[Information] Executing combined check {SynergyType} for player {PlayerId}
[Debug] Primary check result: Succeeded={Succeeded}, Fumble={Fumble}
[Debug] Secondary check result: Succeeded={Succeeded}, Fumble={Fumble}
[Debug] Secondary check skipped: primary did not meet timing requirement
[Warning] Unknown synergy type requested: {SynergyType}
[Error] Failed to execute combined check: {ErrorMessage}
```

---

## 14. Unit Testing Requirements

### 14.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Combined checks use correct skills | 1 |
| Secondary check follows primary success | 1 |
| **Total** | **~2** |

### 14.2 Test Specifications

**File:** `tests/RuneAndRust.Tests/Services/CombinedCheckServiceTests.cs`

```csharp
[TestFixture]
public class CombinedCheckServiceTests
{
    [Test]
    [TestCase(SynergyType.FindHiddenPath, WastelandSurvivalCheckType.Navigation, SkillType.Acrobatics)]
    [TestCase(SynergyType.TrackToLair, WastelandSurvivalCheckType.Tracking, SkillType.SystemBypass)]
    [TestCase(SynergyType.AvoidPatrol, WastelandSurvivalCheckType.HazardDetection, SkillType.Acrobatics)]
    [TestCase(SynergyType.FindAndLoot, WastelandSurvivalCheckType.Foraging, SkillType.SystemBypass)]
    public void GetSynergyDefinition_AllSynergies_ReturnsCorrectSkills(
        SynergyType synergyType,
        WastelandSurvivalCheckType expectedPrimary,
        SkillType expectedSecondary)
    {
        // Arrange
        var service = CreateService();

        // Act
        var definition = service.GetSynergyDefinition(synergyType);

        // Assert
        Assert.That(definition.PrimarySkill, Is.EqualTo(expectedPrimary));
        Assert.That(definition.SecondarySkill, Is.EqualTo(expectedSecondary));
    }

    [Test]
    public void ExecuteCombinedCheck_PrimarySucceeds_ExecutesSecondaryCheck()
    {
        // Arrange
        var player = CreatePlayer();
        var service = CreateServiceWithMockedDependencies(
            primarySucceeds: true,
            secondarySucceeds: true);
        var context = CreateCombinedCheckContext(SynergyType.FindHiddenPath);

        // Act
        var result = service.ExecuteCombinedCheck(
            player,
            SynergyType.FindHiddenPath,
            context);

        // Assert
        Assert.That(result.PrimarySucceeded, Is.True);
        Assert.That(result.SecondaryExecuted, Is.True);
        Assert.That(result.SecondarySucceeded, Is.True);
        Assert.That(result.OverallSuccess, Is.True);
    }

    [Test]
    public void ExecuteCombinedCheck_PrimaryFails_DoesNotExecuteSecondary()
    {
        // Arrange
        var player = CreatePlayer();
        var service = CreateServiceWithMockedDependencies(
            primarySucceeds: false,
            secondarySucceeds: true);
        var context = CreateCombinedCheckContext(SynergyType.FindHiddenPath);

        // Act
        var result = service.ExecuteCombinedCheck(
            player,
            SynergyType.FindHiddenPath,
            context);

        // Assert
        Assert.That(result.PrimarySucceeded, Is.False);
        Assert.That(result.SecondaryExecuted, Is.False);
        Assert.That(result.OverallSuccess, Is.False);
    }
}
```

### 14.3 Test Case Details

**Test 1: Combined checks use correct skills**
- Tests all four synergy types
- Verifies primary skill is correct Wasteland Survival subsystem
- Verifies secondary skill is correct (Acrobatics or System Bypass)

**Test 2: Secondary check follows primary success**
- Tests that secondary check only executes when primary succeeds
- Tests that secondary check is skipped when primary fails
- Verifies overall success requires both checks to pass

---

## 15. Use Cases

### UC-001: Find Hidden Path

**Actor:** Player (Explorer)
**Flow:** Player searches for hidden path → Navigation check (DC terrain-based + 4) → Success: path found → Acrobatics check (DC path-based) → Success: path traversed → Reach hidden destination

### UC-002: Track to Lair

**Actor:** Player (Hunter)
**Flow:** Player tracks creature → Tracking check (DC trail age-based) → Success: lair found → System Bypass check (DC security-based) → Success: entry gained → Inside lair undetected

### UC-003: Avoid Patrol

**Actor:** Player (Scout)
**Flow:** Player in patrol area → Hazard Detection check (DC 16 ambush) → Success: patrol spotted → Acrobatics/Stealth check (DC perception-based) → Success: patrol evaded → Continue exploration

### UC-004: Find and Loot

**Actor:** Player (Scavenger)
**Flow:** Player forages → Foraging check (DC 22 cache) → Success: locked cache found → System Bypass check (DC lock-based) → Success: cache opened → Claim valuable contents

---

## 16. Deliverable Checklist

### 16.1 Domain Layer

- [ ] `SynergyType.cs` enum created in `Enums/`
- [ ] `SecondaryCheckTiming.cs` enum created in `Enums/`
- [ ] `CombinedCheckContext.cs` value object created in `ValueObjects/`
- [ ] `CombinedCheckResult.cs` value object created in `ValueObjects/`
- [ ] `SkillSynergyDefinition.cs` value object created in `ValueObjects/`

### 16.2 Application Layer

- [ ] `ICombinedCheckService.cs` interface created in `Interfaces/`
- [ ] `CombinedCheckService.cs` created in `Services/`
- [ ] Service registered in dependency injection

### 16.3 Configuration

- [ ] `config/combined-checks.json` created
- [ ] `config/schemas/combined-checks.schema.json` created
- [ ] Configuration files validate against schemas

### 16.4 Testing

- [ ] `CombinedCheckServiceTests.cs` created (~2 tests)
- [ ] All tests passing

### 16.5 Documentation

- [ ] XML documentation complete on all public members
- [ ] Design specification finalized

---

## 17. Acceptance Criteria

### 17.1 Functional

- [ ] Find Hidden Path synergy uses Navigation + Acrobatics correctly
- [ ] Track to Lair synergy uses Tracking + System Bypass correctly
- [ ] Avoid Patrol synergy uses Hazard Detection + Acrobatics correctly
- [ ] Find and Loot synergy uses Foraging + System Bypass correctly
- [ ] Secondary check only executes when primary check succeeds
- [ ] Combined result reflects both check outcomes
- [ ] Narrative descriptions generated for all outcome combinations

### 17.2 Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~2 tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete

---

## 18. Dependencies

### 18.1 Required from Previous Versions

| Type | Version | Usage |
|------|---------|-------|
| `INavigationService` | v0.15.5d | Primary check for FindHiddenPath |
| `ITrackingService` | v0.15.5a | Primary check for TrackToLair |
| `IHazardDetectionService` | v0.15.5e | Primary check for AvoidPatrol |
| `IForagingService` | v0.15.5c | Primary check for FindAndLoot |
| `IAcrobaticsService` | v0.15.2 | Secondary check for traverse/stealth |
| `ISystemBypassService` | v0.15.4 | Secondary check for enter/lockpick |
| `SkillCheckResult` | v0.15.0 | Check result handling |
| `WastelandSurvivalCheckType` | v0.15.5h | Primary skill categorization |

### 18.2 Provides to Future Versions

| Type | Usage |
|------|-------|
| `ICombinedCheckService` | Multi-skill exploration sequences |
| `CombinedCheckResult` | Integration with quest objectives |
| `SynergyType` | Extensible synergy system for future skill expansions |

---

## 19. Future Considerations

### 19.1 Deferred to v0.15.6 (Advanced Perception)

- **Perception-triggered synergies**: Passive perception enabling exploration synergies
- **Three-layer examination synergies**: Examination revealing hidden paths/caches

### 19.2 Deferred to Future Versions

- **Party cooperation synergies**: Different party members contributing different skills
- **Synergy chaining**: Three or more skills in sequence
- **Specialization synergy bonuses**: Archetypes gaining bonuses to specific synergies

### 19.3 Out of Scope

- **New synergy types**: Only the four defined in scope breakdown
- **Synergy modification**: Dynamic synergy creation or customization
- **Combat synergies**: Synergies involving combat skills

---

## 20. Document Metadata

---

*Document Version: 1.0*
*Last Updated: 2026-01-18*
*Author: Claude*

---

### Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-18 | Claude | Initial design specification |

---

*This design specification provides the detailed blueprint for implementing v0.15.5i Exploration Synergies. This completes the v0.15.5 Wasteland Survival Skill Expansion by establishing combined skill check patterns that integrate Wasteland Survival with other skill systems.*
