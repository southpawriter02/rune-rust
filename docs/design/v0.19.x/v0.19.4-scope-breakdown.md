# v0.19.4 Jötunheim & Vanaheim Implementation - Scope Breakdown

**Version:** 0.19.4
**Theme:** Jötunheim & Vanaheim (Giant Scale & Bio-Engineering)
**Prerequisites:** v0.19.3 (Muspelheim & Niflheim)
**Total Estimated Tests:** ~44 new tests
**Lore References:** jotunheim.md, vanaheim.md

---

## Executive Summary

v0.19.4 implements two realms with unique mechanics: Jötunheim (giant-scale industrial graveyard with GiantScale mechanics) and Vanaheim (bio-engineered overgrowth with unique **vertical stratification** where zones are Z-level based rather than geographic). Vanaheim is the ONLY realm where zones are defined by altitude—you cannot reach the Under-growth without passing through the Gloom-Veil.

| Phase | Name | Focus | Est. Tests |
|-------|------|-------|------------|
| v0.19.4a | Jötunheim Core | Realm definition, GiantScale mechanics | ~16 |
| v0.19.4b | Vanaheim Core | Realm definition, vertical stratification | ~18 |
| v0.19.4c | Content & Integration | Enemies, hazards, room templates | ~10 |

---

## Feature Analysis & Categorization

| Feature | Complexity | Dependencies | Assigned Phase | Lore Ref |
|---------|------------|--------------|----------------|----------|
| Jötunheim BiomeDefinition | Medium | BiomeDefinition entity | **v0.19.4a** | jotunheim.md §1 |
| Jötunheim Zones (3) | Medium | BiomeZone entity | **v0.19.4a** | jotunheim.md §6 |
| GiantScale Mechanics | High | EnvironmentalCondition | **v0.19.4a** | jotunheim.md §4 |
| Vanaheim BiomeDefinition | Medium | BiomeDefinition entity | **v0.19.4b** | vanaheim.md §1 |
| Vanaheim Vertical Zones (3) | High | IVerticalStratificationService | **v0.19.4b** | vanaheim.md §6, §13 |
| MutagenicSpores (Golden Plague) | High | EnvironmentalCondition | **v0.19.4b** | vanaheim.md §4 |
| IVerticalStratificationService | High | Z-level system | **v0.19.4b** | vanaheim.md §13 |
| Enemy Spawn Pools | Medium | Faction system | **v0.19.4c** | both §8 |
| Zone-Specific Hazards | Medium | Hazard registry | **v0.19.4c** | both §5, §10 |
| Room Templates | Medium | Room template system | **v0.19.4c** | both §7 |

---

## Phase Definitions

## v0.19.4a: Jötunheim Core Implementation

### Scope

**In Scope:**
- Jötunheim `BiomeDefinition` (Deck 07 — Heavy Industry)
- Three canonical zones from lore (jotunheim.md §6):
  - **The Bone Yards** — Giant skeletal remains, entry zone
  - **Utgard's Shadow** — Ruined giant city infrastructure
  - **The Grinding Hall** — Active machinery, boss encounter
- GiantScale environmental condition (jotunheim.md §4)
- Scale factor mechanics (3.0x human scale)
- Fall damage scaling by ScaleFactor
- Navigation checks in giant-scale environments

**Out of Scope:**
- Vanaheim implementation (v0.19.4b)
- Enemy implementations (v0.19.4c)
- Climbing/traversal skill integration

### Jötunheim Realm Specification

| Property | Value | Lore Ref |
|----------|-------|----------|
| Designation | Deck 07 — Heavy Industrial Manufactory | jotunheim.md §1 |
| Temperature | 10°C (Cold industrial) | jotunheim.md §1 |
| Aetheric Intensity | 0.2 (Low) | jotunheim.md §1 |
| Humidity | 40% | jotunheim.md §1 |
| Light Level | 0.5 (Dim, artificial) | jotunheim.md §1 |
| Scale Factor | 3.0 (Giant scale) | jotunheim.md §4 |
| Corrosion Rate | 0.5 (Moderate decay) | jotunheim.md §10 |
| Primary Condition | GiantScale | jotunheim.md §4 |
| Vertical Range | Z: -1 to +3 | jotunheim.md §13 |
| Thematic Modifier | "Titanic" | jotunheim.md §12.1 |

### Jötunheim Zone Configuration

```json
{
  "jotunheim": {
    "zones": [
      {
        "id": "jotunheim-boneyards",
        "name": "The Bone Yards",
        "loreSection": "§6.1",
        "baseCondition": "GiantScale",
        "baseDc": 10,
        "verticalRange": { "min": 0, "max": 1 },
        "description": "Giant skeletal remains and rusted machinery",
        "entryZone": true
      },
      {
        "id": "jotunheim-utgard",
        "name": "Utgard's Shadow",
        "loreSection": "§6.2",
        "baseCondition": "GiantScale",
        "baseDc": 12,
        "verticalRange": { "min": 1, "max": 2 },
        "description": "Ruined giant city infrastructure",
        "additionalConditions": ["TotalDarkness"]
      },
      {
        "id": "jotunheim-grinding",
        "name": "The Grinding Hall",
        "loreSection": "§6.3",
        "baseCondition": "GiantScale",
        "baseDc": 16,
        "verticalRange": { "min": 2, "max": 3 },
        "description": "Active industrial machinery at giant scale",
        "hasBossEncounter": true,
        "bossId": "loom-overseer"
      }
    ]
  }
}
```

### GiantScale Mechanics (jotunheim.md §4)

```csharp
public class GiantScaleCondition : EnvironmentalCondition
{
    public float ScaleFactor { get; } = 3.0f;
    public override int BaseDc => 12;
    public override TriggerFrequency Frequency => TriggerFrequency.PerMovement;

    public override ConditionEffect[] Effects => new[]
    {
        new ConditionEffect("FallDamageMultiplier", ScaleFactor),
        new ConditionEffect("NavigationCheckRequired", true),
        new ConditionEffect("CoverMechanicsAltered", true),
        new ConditionEffect("AttacksFromAbove", true)
    };

    public override string[] Mitigations => new[]
    {
        "Climbing gear",
        "Flight capability",
        "Giant-kin ancestry"
    };
}
```

### Fall Damage by Scale

| Scale Factor | Base Fall | Modified Fall | Example |
|--------------|-----------|---------------|---------|
| 1.0 (human) | 1d6 per 10ft | 1d6 per 10ft | 30ft = 3d6 |
| 2.0 (large) | 1d6 per 10ft | 2d6 per 10ft | 30ft = 6d6 |
| 3.0 (giant) | 1d6 per 10ft | 3d6 per 10ft | 30ft = 9d6 |

### v0.19.4a Acceptance Criteria

- [ ] Jötunheim BiomeDefinition loads with ScaleFactor = 3.0
- [ ] Three zones configured with correct DCs (10, 12, 16)
- [ ] GiantScale condition triggers on movement
- [ ] Fall damage correctly multiplied by ScaleFactor
- [ ] Navigation check required in all zones
- [ ] Vertical range Z: -1 to +3 enforced
- [ ] Thematic modifier "Titanic" applied to descriptors
- [ ] ~16 unit tests pass

---

## v0.19.4b: Vanaheim Core Implementation

### Scope

**In Scope:**
- Vanaheim `BiomeDefinition` (Deck 03 — Bio-Engineering)
- **UNIQUE VERTICAL STRATIFICATION**: Three zones defined by Z-level (vanaheim.md §6, §13):
  - **The Canopy Sea** — Z=+2 (High Boughs), Green contamination, livable
  - **The Gloom-Veil** — Z=+1 to Z=0 (Mid-Fall), Amber contamination
  - **The Under-growth** — Z=0 to Z=-1 (Marrow-Mire), Red contamination
- `IVerticalStratificationService` interface and implementation
- MutagenicSpores (Golden Plague) environmental condition
- Gilded Lung contamination staging system
- Contamination threshold monitoring

**Out of Scope:**
- Jötunheim implementation (v0.19.4a)
- Bio-theurgy healing mechanics (requires Ljósálfar faction)
- Full Bloom Cycle event system

### Vanaheim Realm Specification

| Property | Value | Lore Ref |
|----------|-------|----------|
| Designation | Deck 03 — Primary Bio-Engineering Preserve | vanaheim.md §1 |
| Temperature | 28°C (Humid subtropical) | vanaheim.md §1 |
| Aetheric Intensity | 0.5 (Moderate) | vanaheim.md §1 |
| Humidity | 85% (High) | vanaheim.md §1 |
| Light Level | 0.6 (Filtered) | vanaheim.md §1 |
| Scale Factor | 1.0 (Human scale) | — |
| Corrosion Rate | 0.4 (Bio-decay) | vanaheim.md §10 |
| Primary Condition | MutagenicSpores | vanaheim.md §4 |
| Vertical Range | Z: -1 to +2 | vanaheim.md §13 |
| Thematic Modifier | "Verdant" | vanaheim.md §12.1 |

> [!CRITICAL]
> **VANAHEIM IS UNIQUE**: Unlike all other realms, zones in Vanaheim are strictly vertical. You cannot reach the Under-growth without passing through the Gloom-Veil. **Elevation = Survival**. This is the ONLY realm with this mechanic.

### Vertical Stratification System (vanaheim.md §13)

```csharp
public interface IVerticalStratificationService
{
    BiomeZone GetZoneForElevation(RealmId realm, int zLevel);
    ContaminationLevel GetContaminationForElevation(RealmId realm, int zLevel);
    bool IsVerticallyStratified(RealmId realm);
    int[] GetValidElevationRange(BiomeZone zone);
    IReadOnlyList<BiomeZone> GetZonesInOrder(RealmId realm);
}

public enum ContaminationLevel
{
    Green,   // < 280 particles/m³ — Safe operations
    Amber,   // 280-600 particles/m³ — Stage 1 onset risk
    Red      // > 600 particles/m³ — Immediate evacuation
}
```

### Vanaheim Zone Configuration

```json
{
  "vanaheim": {
    "verticallyStratified": true,
    "zones": [
      {
        "id": "vanaheim-canopy",
        "name": "The Canopy Sea",
        "loreSection": "§6.1",
        "zRange": { "min": 2, "max": 2 },
        "contamination": "Green",
        "baseCondition": "MutagenicSpores",
        "baseDc": 10,
        "corruptionMultiplier": 1.0,
        "description": "Continent-spanning rooftop of interlocking branches",
        "livable": true,
        "settlements": true,
        "entryZone": true
      },
      {
        "id": "vanaheim-gloom",
        "name": "The Gloom-Veil",
        "loreSection": "§6.2",
        "zRange": { "min": 0, "max": 1 },
        "contamination": "Amber",
        "baseCondition": "MutagenicSpores",
        "baseDc": 14,
        "corruptionMultiplier": 1.5,
        "description": "Purgatory of hanging vines and immense tree trunks",
        "visibility": "10-50m",
        "additionalConditions": ["DataWraithInterference"]
      },
      {
        "id": "vanaheim-undergrowth",
        "name": "The Under-growth",
        "loreSection": "§6.3",
        "zRange": { "min": -1, "max": 0 },
        "contamination": "Red",
        "baseCondition": "MutagenicSpores",
        "baseDc": 18,
        "corruptionMultiplier": 2.0,
        "description": "Hyper-aggressive, lightless biomass swamp",
        "hasBossEncounter": true,
        "bossId": "un-womb-spawn",
        "territorialSovereignty": "The Unraveled"
      }
    ]
  }
}
```

### MutagenicSpores (Golden Plague) Mechanics (vanaheim.md §4)

```csharp
public class MutagenicSporesCondition : EnvironmentalCondition
{
    public override int BaseDc => 12;
    public override TriggerFrequency Frequency => TriggerFrequency.PerHour;
    public override DamageType DamageType => DamageType.Corruption;

    // Gilded Lung Staging (vanaheim.md §4.3)
    public GildedLungStage GetStageForMineralization(float percentage) => percentage switch
    {
        < 40 => GildedLungStage.Stage1,   // Reversible within 12 hours
        < 70 => GildedLungStage.Stage2,   // Partial reversal only
        _ => GildedLungStage.Stage3       // Terminal in 48-72 hours
    };

    public override ConditionEffect[] Effects => new[]
    {
        new ConditionEffect("CorruptionAccumulation", 1),
        new ConditionEffect("MutationRiskAtThreshold", true),
        new ConditionEffect("EnhancedNaturalHealingInVanaheim", true)
    };

    public override string[] Mitigations => new[]
    {
        "Filtration mask",
        "Corruption resistance",
        "Vanir ancestry",
        "Ljósálfar bio-theurgy (Stage 1 reversal)"
    };
}

public enum GildedLungStage
{
    Stage1,  // 0-40% mineralization — Reversible
    Stage2,  // 40-70% mineralization — Partial reversal
    Stage3   // 70%+ mineralization — Terminal
}
```

### Contamination Thresholds (vanaheim.md §4.2)

| Level | Particles/m³ | Zone | Status | Protocol |
|-------|-------------|------|--------|----------|
| **Green** | < 280 | Canopy Sea | Safe operations | Standard precautions |
| **Amber** | 280-600 | Gloom-Veil | Stage 1 onset risk | Mask required |
| **Red** | > 600 | Under-growth | Immediate evacuation | Emergency egress |

### v0.19.4b Acceptance Criteria

- [ ] Vanaheim BiomeDefinition loads with MutagenicSpores condition
- [ ] Three zones configured with correct contamination levels
- [ ] IVerticalStratificationService returns correct zone for Z-level
- [ ] Canopy Sea (Z=+2) returns Green contamination, DC 10
- [ ] Gloom-Veil (Z=0-1) returns Amber contamination, DC 14
- [ ] Under-growth (Z=-1-0) returns Red contamination, DC 18
- [ ] Corruption multiplier scales correctly (1.0, 1.5, 2.0)
- [ ] Zone traversal enforces vertical progression
- [ ] Gilded Lung staging correctly calculated
- [ ] Thematic modifier "Verdant" applied to descriptors
- [ ] ~18 unit tests pass

---

## v0.19.4c: Content & Integration

### Scope

**In Scope:**
- Enemy spawn pools for both realms
- Zone-specific hazards
- Room templates from lore
- Resource definitions
- Fire/Bio adjacency incompatibility enforcement

### Enemy Spawn Pools

#### Jötunheim Enemies (jotunheim.md §8)

| Enemy | Type | Tier | Zone | Special |
|-------|------|------|------|---------|
| Rust-Thrall | Corrupted Construct | 2 | Bone Yards | Corroded machinery animation |
| Loom-Weaver | Corrupted Construct | 2 | Utgard/Grinding | Web-like cable attacks |
| Collapsed Giant | Giant Undead | 3 | All zones | Massive skeletal remains |
| Gear-Horror | Blighted Machine | 3 | Grinding Hall | Industrial hazard |
| Loom Overseer | Boss | 4 | Grinding Hall | Controls machinery |

**Spawn Distribution:**

| Zone | Primary (60%) | Secondary (30%) | Rare (10%) |
|------|---------------|-----------------|------------|
| Bone Yards | Rust-Thralls | Collapsed Giants | Gear-Horrors |
| Utgard's Shadow | Loom-Weavers | Rust-Thralls | Collapsed Giants |
| Grinding Hall | Gear-Horrors | Loom-Weavers | Loom Overseer |

#### Vanaheim Enemies (vanaheim.md §8)

| Enemy | Type | Tier | Zone | Special |
|-------|------|------|------|---------|
| Mind-Maw Flower | Weaponized Flora | 2 | All zones | Psychoactive seduction |
| Blight-Root Entangler | Weaponized Flora | 2 | All zones | Plant-machine parasite |
| Siren-Bloom Cluster | Weaponized Flora | 3 | Gloom-Veil/Under-growth | Bio-acoustic mimicry |
| Root-Viper | Blighted Beast | 2 | Under-growth | Petrification venom |
| Blighted Rune-Bear | Blighted Beast | 3 | All zones | Territorial |
| Giant Feral Wolf | Blighted Beast | 2 | Canopy/Gloom-Veil | Pack predator |
| Data-Wraith | The Forlorn | 3 | Gloom-Veil | Psychic interference |
| Grove-Warden (Hostile) | Humanoid | 2 | Canopy Sea | Hostile if carrying Glitched items |
| The Unraveled | Post-Human | 3 | Under-growth | Sentient, territorial |
| Un-Womb Spawn | Boss | 4 | Under-growth | Novel Blight-Spawn |

**Spawn Distribution:**

| Zone | Primary (60%) | Secondary (30%) | Rare (10%) |
|------|---------------|-----------------|------------|
| Canopy Sea | Blighted Beasts | Weaponized Flora | Hostile Wardens |
| Gloom-Veil | Weaponized Flora | Data-Wraiths | Blighted Beasts |
| Under-growth | The Unraveled | Weaponized Flora | Un-Womb Spawn |

### Enemy Resistances & Vulnerabilities

| Enemy | Resist | Vuln | Notes |
|-------|--------|------|-------|
| Mind-Maw Flower | Psychic 50% | Fire | vanaheim.md §8.2 |
| Blight-Root Entangler | Physical 25% | Fire, Acid | vanaheim.md §8.2 |
| Siren-Bloom Cluster | Physical 50% | Fire | vanaheim.md §8.2 |
| Root-Viper | Poison Immune | Cold, Fire | vanaheim.md §8.2 |
| Blighted Rune-Bear | Physical 25% | Fire | vanaheim.md §8.2 |
| Giant Feral Wolf | — | Fire | vanaheim.md §8.2 |
| Data-Wraith | Physical Immune | Psychic, Energy | vanaheim.md §8.2 |
| The Unraveled | Poison 50%, Physical 25% | Fire, Psychic | vanaheim.md §8.2 |
| Un-Womb Spawn | Variable | Fire (consistent) | vanaheim.md §8.2 |

> [!IMPORTANT]
> **FIRE VULNERABILITY**: All Vanaheim enemies are vulnerable to Fire damage. This is a consistent weakness that rewards preparation (vanaheim.md §19.1).

### Zone-Specific Hazards

#### Jötunheim Hazards (jotunheim.md §5)

| Hazard | Zone | Trigger | Effect | DC |
|--------|------|---------|--------|-----|
| Falling Debris | All | Movement | 2d6 bludgeoning (scaled) | 14 |
| Unstable Platforms | Utgard/Grinding | Standing | Platform collapse, fall | 12 |
| Active Machinery | Grinding Hall | Proximity | 3d6 crushing | 16 |
| Rust Clouds | Bone Yards | Contact | Equipment degradation | 10 |
| Giant-Scale Gaps | All | Movement | Fall risk (3x damage) | 12 |

#### Vanaheim Hazards (vanaheim.md §5, §10)

| Hazard | Zone | Trigger | Effect | DC |
|--------|------|---------|--------|-----|
| Golden Plague Exposure | All | Breathing | Gilded Lung staging | 12-18 |
| Gene-Storm Bloom | All | 32-48h cycle | Vegetation doubles; route closure | — |
| Mind-Maw Seduction | All | Proximity | Compulsion to approach | 14 |
| Siren-Bloom Call | Gloom/Under | Proximity | False distress signal | 12 |
| Data-Wraith Interference | Gloom-Veil | Proximity | Psychic disruption | 16 |
| Root-Viper Ambush | Under-growth | Movement | Petrification venom | 14 |
| Unraveled Territory | Under-growth | Boundary cross | Territorial response | — |

### Room Templates

#### Jötunheim Templates (jotunheim.md §7)

| Template | Size | Zone | Description |
|----------|------|------|-------------|
| Collapsed Corridor | Medium | Bone Yards | Rusted industrial passage |
| Giant Workshop | Large | Bone Yards/Utgard | Abandoned tools at massive scale |
| Machinery Graveyard | Large | Bone Yards | Skeletal machinery remains |
| Utgard Street | Medium | Utgard's Shadow | Giant-scale urban ruins |
| Loom Platform | Large | Utgard/Grinding | Industrial work platform |
| Active Forge | Large | Grinding Hall | Functional giant machinery |
| Gear Chamber | XLarge | Grinding Hall | Massive rotating mechanisms |
| Overseer Throne | Huge | Grinding Hall | Boss encounter location |

#### Vanaheim Templates (vanaheim.md §7)

| Template | Size | Zone | Description |
|----------|------|------|-------------|
| Canopy Platform | Medium | Canopy Sea | Stable branch intersection |
| Sky Looms Station | Large | Canopy Sea | Ferry anchor point |
| Mother Tree Chamber | Large | Canopy/Gloom | Hollow trunk interior |
| Vine Curtain Passage | Small | Gloom-Veil | Limited visibility |
| Bioluminescent Grove | Medium | Gloom-Veil | Navigation landmark |
| Emergency Shelter | Small | Gloom-Veil | Fortified platform |
| Data-Wraith Haunt | Medium | Gloom-Veil | High cognitive hazard |
| Biomass Shallows | Medium | Under-growth | Navigable swamp |
| Unraveled Territory | Large | Under-growth | Post-human domain |
| Un-Womb Approach | XLarge | Under-growth | Boss encounter |
| Idunn Vault Ruins | Huge | Under-growth (deep) | Archive access (theoretical) |

### Resources

#### Jötunheim Resources (jotunheim.md §11)

| Resource | Tier | Drop Rate | Source |
|----------|------|-----------|--------|
| Rusted Scrap | 1 | 40% | Debris salvage |
| Giant Bone Fragment | 2 | 25% | Skeletal remains |
| Functional Gear | 3 | 15% | Machinery salvage |
| Loom-Weaver Silk | 3 | 12% | Loom-Weaver drop |
| Overseer Core | 5 | Boss drop | Loom Overseer |

#### Vanaheim Resources (vanaheim.md §11)

| Resource | Tier | Drop Rate | Source |
|----------|------|-----------|--------|
| Canopy Fiber | 1 | 40% | Vine harvesting |
| Bioluminescent Sap | 2 | 25% | Flora harvesting |
| Heartwood Extract | 3 | 10% | Mother Tree tapping |
| Mind-Maw Pollen | 3 | 15% | Mind-Maw Flower drop |
| Siren-Bloom Vocal Organ | 3 | 10% | Siren-Bloom drop |
| Root-Viper Venom Gland | 3 | 12% | Root-Viper drop |
| Unraveled Tissue Sample | 4 | 5% | Ethical acquisition only |
| Pristine Genetic Template | 5 | 1% | Project Idunn cache |
| Genesis Engine Fragment | 5 | Boss drop | Un-Womb Spawn |

### v0.19.4c Acceptance Criteria

- [ ] Enemy spawn pools configured for all zones
- [ ] Fire vulnerability enforced for Vanaheim enemies
- [ ] Zone-specific hazards trigger correctly
- [ ] Room templates load for both realms
- [ ] Resources drop from appropriate sources
- [ ] Muspelheim ↔ Vanaheim adjacency blocked (Fire/Bio incompatible)
- [ ] ~10 unit tests pass

---

## Dependencies & Prerequisites

```
v0.19.3 (Muspelheim & Niflheim) - REQUIRED
    │
    └── Environmental condition pattern
            │
            ▼
v0.19.0 (Core Infrastructure) - REQUIRED
    │
    ├── RealmId.Jotunheim, RealmId.Vanaheim
    ├── EnvironmentalConditionType.GiantScale
    ├── EnvironmentalConditionType.MutagenicSpores
    ├── VerticalZone enum
    ├── ContaminationLevel enum
    └── BiomeDefinition, BiomeZone entities
            │
            ▼
v0.19.4a (Jötunheim)
    │
    ├── GiantScaleCondition implementation
    └── Fall damage scaling
            │
            ▼
v0.19.4b (Vanaheim)
    │
    ├── IVerticalStratificationService
    ├── MutagenicSporesCondition
    └── ContaminationLevel system
            │
            ▼
v0.19.4c (Content & Integration)
    │
    ├── Enemy spawn pools
    ├── Zone hazards
    └── Room templates
```

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Scale factor complexity | Medium | Medium | Simple multiplier for fall damage |
| Vertical stratification edge cases | High | Medium | Explicit Z-level validation |
| Corruption system integration | Medium | Low | Defer to Status Effect system |
| Zone boundary enforcement | Medium | Medium | IVerticalStratificationService validates |

---

## Design Decisions (Confirmed)

| Decision | Value | Notes | Lore Ref |
|----------|-------|-------|----------|
| Jötunheim scale factor | 3.0 | Triple human scale | jotunheim.md §4 |
| Vanaheim vertical range | Z: -1 to +2 | Full stratification | vanaheim.md §13 |
| Zone traversal | Vertical only | Cannot skip Gloom-Veil | vanaheim.md §13 |
| Spore Corruption rate | 1 point per failed check | Simple accumulation | vanaheim.md §4 |
| Fall damage scaling | ScaleFactor multiplier | 3x in Jötunheim | jotunheim.md §4 |
| Muspelheim ↔ Vanaheim | Incompatible | Fire kills plant life | biomes-overview.md |
| Gilded Lung treatment | Ljósálfar only | Stage 1 within 12 hours | vanaheim.md §4.3 |

---

## Unit Testing Requirements (~44 tests)

### v0.19.4a Tests (~16)

**Jötunheim BiomeDefinition Tests (8):**
- GetBiome returns valid definition
- ScaleFactor = 3.0
- Temperature = 10°C
- Three zones returned (Bone Yards, Utgard's Shadow, Grinding Hall)
- Bone Yards has GiantScale DC 10
- Grinding Hall has GiantScale DC 16
- Vertical range Z: -1 to +3
- Thematic modifier "Titanic" returned

**GiantScale Mechanics Tests (8):**
- GiantScale base DC = 12
- Fall damage scaled by ScaleFactor
- 30ft fall at 3.0 scale = 9d6
- Navigation check required per movement
- Climbing gear provides mitigation
- Flight bypasses navigation check
- Cover mechanics altered flag set
- Attacks from above enabled

### v0.19.4b Tests (~18)

**Vanaheim BiomeDefinition Tests (8):**
- GetBiome returns valid definition
- Temperature = 28°C, Humidity = 85%
- Three zones returned (Canopy Sea, Gloom-Veil, Under-growth)
- IsVerticallyStratified returns true
- Canopy Sea at Z=+2 only
- Gloom-Veil at Z=0 to Z=+1
- Under-growth at Z=-1 to Z=0
- Thematic modifier "Verdant" returned

**Vertical Stratification Tests (6):**
- GetZoneForElevation(Vanaheim, 2) returns Canopy Sea
- GetZoneForElevation(Vanaheim, 1) returns Gloom-Veil
- GetZoneForElevation(Vanaheim, -1) returns Under-growth
- Zone order enforced (cannot skip Gloom-Veil)
- GetContaminationForElevation returns Green/Amber/Red correctly
- GetZonesInOrder returns [Canopy, Gloom, Under]

**MutagenicSpores Tests (4):**
- MutagenicSpores base DC = 12
- Contamination level affects DC (10, 14, 18)
- Gilded Lung staging calculates correctly
- Filtration mask provides mitigation

### v0.19.4c Tests (~10)

**Enemy Spawn Tests (4):**
- Canopy Sea primary = Blighted Beasts
- Gloom-Veil primary = Weaponized Flora
- Under-growth primary = The Unraveled
- Fire vulnerability on all Vanaheim enemies

**Hazard Tests (3):**
- Golden Plague triggers per hour
- Gene-Storm Bloom affects route availability
- Data-Wraith Interference only in Gloom-Veil

**Integration Tests (3):**
- Muspelheim-Vanaheim transition blocked
- Room templates load correctly
- Resources have correct drop rates

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    v0.19.4 Jötunheim & Vanaheim                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────┐    ┌─────────────────────────────┐        │
│  │        JÖTUNHEIM            │    │         VANAHEIM            │        │
│  │        (Deck 07)            │    │         (Deck 03)           │        │
│  │      SCALE: 3.0x            │    │    VERTICAL ZONES           │        │
│  │                             │    │                             │        │
│  │  Z+3 ┌─────────────────┐   │    │  Z+2 ┌─────────────────┐   │        │
│  │      │  Grinding Hall  │   │    │      │  Canopy Sea     │   │        │
│  │      │  DC 16, Boss    │   │    │      │  DC 10, GREEN   │   │        │
│  │  Z+2 ├─────────────────┤   │    │  Z+1 ├─────────────────┤   │        │
│  │      │  Utgard's       │   │    │      │  Gloom-Veil     │   │        │
│  │      │  Shadow DC 12   │   │    │      │  DC 14, AMBER   │   │        │
│  │  Z+1 ├─────────────────┤   │    │  Z 0 ├─────────────────┤   │        │
│  │      │                 │   │    │      │                 │   │        │
│  │  Z 0 ├─────────────────┤   │    │  Z-1 ├─────────────────┤   │        │
│  │      │  Bone Yards     │   │    │      │  Under-growth   │   │        │
│  │      │  DC 10, Entry   │   │    │      │  DC 18, RED     │   │        │
│  │  Z-1 └─────────────────┘   │    │      │  Boss: Un-Womb  │   │        │
│  │                             │    │      └─────────────────┘   │        │
│  │  Effect: Fall × 3           │    │                             │        │
│  │  Thematic: "Titanic"        │    │  Effect: Gilded Lung        │        │
│  └─────────────────────────────┘    │  Thematic: "Verdant"        │        │
│                                      │                             │        │
│                                      │  NOTE: Zones are VERTICAL!  │        │
│                                      │  Cannot skip Gloom-Veil!    │        │
│                                      └─────────────────────────────┘        │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │                    INCOMPATIBILITY MATRIX                          │    │
│  │                                                                     │    │
│  │   Muspelheim (Fire) ✗ Vanaheim (Bio) = INCOMPATIBLE               │    │
│  │   "Fire kills plant life" — No direct transition possible          │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## Deliverable Checklist

### Configuration

- [ ] `jotunheim.json` complete with all zones
- [ ] `vanaheim.json` complete with vertical stratification
- [ ] GiantScale condition configured
- [ ] MutagenicSpores condition configured
- [ ] Contamination thresholds defined
- [ ] Fire/Bio incompatibility enforced
- [ ] JSON validates against biomes.schema.json

### Application Layer

- [ ] `GiantScaleCondition` class
- [ ] `MutagenicSporesCondition` class
- [ ] `IVerticalStratificationService` interface
- [ ] `VerticalStratificationService` implementation
- [ ] `GildedLungStage` enum
- [ ] `ContaminationLevel` enum

### Tests

- [ ] v0.19.4a: Jötunheim tests (~16)
- [ ] v0.19.4b: Vanaheim tests (~18)
- [ ] v0.19.4c: Content tests (~10)

---

## Lore Cross-Reference Index

| Topic | Jötunheim Ref | Vanaheim Ref |
|-------|---------------|--------------|
| Overview | §1 | §1 |
| Pre-Glitch Function | §2 | §2 |
| Cataclysm | §3 | §3 |
| Core Mechanics | §4 | §4 |
| Primary Hazards | §5 | §5 |
| Zones | §6 | §6 |
| Room Templates | §7 | §7 |
| Enemies | §8 | §8 |
| Inhabitants | §9 | §9 |
| Environmental Features | §10 | §10 |
| Resources | §11 | §11 |
| Descriptors | §12 | §12 |
| Verticality | §13 | §13 |
| Navigation | §14 | §14 |

---

_This scope breakdown provides comprehensive implementation guidance for v0.19.4 Jötunheim & Vanaheim with full lore compliance, emphasizing Vanaheim's unique vertical stratification system._
