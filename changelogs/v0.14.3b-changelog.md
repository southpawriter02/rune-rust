# v0.14.3b Changelog - Trait Schema

## Summary

Implemented `traits.schema.json` with comprehensive validation for monster trait definitions, including 11 effect types, 7 trait tags, stat modifiers (flat and percentage bonuses), resistance/immunity grants, and visual modifiers. This schema enables full customization of monster traits without code changes, supporting modding scenarios for unique abilities, passive bonuses, triggered effects, and visual distinctions.

## Added

### Schema Files
- **[config/schemas/traits.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/traits.schema.json)** - JSON Schema Draft-07 for trait configuration
  - `TraitDefinition` - Complete trait with effect, stats, tags, color, and optional modifiers
  - `StatModifiers` - Flat and percentage bonuses to health, attack, defense, speed, initiative
  - `ResistanceModifiers` - Resistance grants and immunity arrays for damage types

### Effect Type Enumeration (11 Types)
| Effect | Category | Value Meaning |
|--------|----------|---------------|
| `Regeneration` | Passive | HP healed per turn |
| `Flying` | Passive | Defense bonus vs melee |
| `Venomous` | Triggered | Poison damage on hit |
| `Armored` | Passive | Flat defense bonus |
| `Berserker` | Triggered | Damage bonus % when low HP |
| `SpellResistant` | Passive | Magic damage reduction % |
| `Undying` | Triggered | HP % on revive |
| `Splitting` | Triggered | Spawn count on death |
| `Burrowing` | Active | Turns of invulnerability |
| `Invisible` | Passive | Attack miss chance % |
| `Teleporting` | Active | Max teleport distance (tiles) |

### Trait Tag Enumeration (7 Types)
| Tag | Description |
|-----|-------------|
| `passive` | Always active, no trigger needed |
| `triggered` | Activates on specific conditions |
| `offensive` | Increases damage output |
| `defensive` | Increases survivability |
| `mobility` | Affects movement capabilities |
| `healing` | Restores or preserves HP |
| `poison` | Deals or involves poison |

### Validation Rules
| Property | Constraint | Description |
|----------|------------|-------------|
| `id` | `^[a-z][a-z0-9_]*$` | Lowercase with underscores |
| `effect` | Enum | 11 effect types |
| `tags` | Enum array (minItems: 1) | At least one tag from 7 options |
| `triggerThreshold` | 0-100 | Optional HP percentage trigger |
| `sortOrder` | >= 0 | Non-negative display order |
| `visualSize` | Enum | 5 size options (Tiny, Small, Medium, Large, Huge) |
| `statModifiers.*Percent` | 0.0-1.0 | Percentage bonus range |
| `resistances.*` | -100 to 100 | Weakness to immunity range |

### Configuration Updates
- **[config/traits.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/traits.json)** - Updated with `$schema` reference
  - Removed null `triggerThreshold` values (now omitted when not applicable)
  - Added `statModifiers` example to armored trait
  - Existing 5 traits validate successfully:
    - `regenerating` - Passive healing with Regeneration effect
    - `flying` - Mobility/defensive with Flying effect
    - `venomous` - Offensive poison with Venomous effect
    - `armored` - Passive defense with Armored effect and stat modifiers
    - `berserker` - Triggered offensive with Berserker effect at 30% HP threshold

### Unit Tests
- **[TraitsSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/TraitsSchemaTests.cs)** - 7 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (3 definitions)
  - `ExistingTraitsJson_ValidatesAgainstSchema` - Backwards compatibility (5 traits)
  - `Effect_InvalidEnumValue_FailsValidation` - Effect enum validation (11 options)
  - `Tags_InvalidEnumValue_FailsValidation` - Tags enum validation (7 options)
  - `StatModifiers_PercentageOutOfRange_FailsValidation` - Percentage range validation
  - `ResistanceModifiers_OutOfRange_FailsValidation` - Resistance range validation
  - `VisualSize_InvalidEnumValue_FailsValidation` - Visual size enum validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/traits.schema.json` | Added |
| `config/traits.json` | Modified (schema ref, removed nulls, added statModifiers) |
| `tests/.../Schemas/TraitsSchemaTests.cs` | Added |
| `changelogs/v0.14.3b-changelog.md` | Added |

## Test Results

```
Test summary: total: 7, failed: 0, succeeded: 7, skipped: 0
Build succeeded with 0 errors
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Add new trait types by adding entries to `traits.json`
- Define custom effect types from 11 categories
- Configure stat bonuses with flat and percentage modifiers
- Grant resistances and immunities to damage types
- Associate abilities with traits via `grantedAbilityIds`
- Customize visual appearance with size modifiers and name descriptors
- Set trigger conditions for conditional effects

---

*Part of v0.14.3 Monster Configuration Schemas series. See also: v0.14.3a (Monster Schema), v0.14.3c (Tier Schema), v0.14.3d (Boss Schema).*
