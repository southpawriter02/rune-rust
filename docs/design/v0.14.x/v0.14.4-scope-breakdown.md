# v0.14.4 Environment Configuration Schemas - Scope Breakdown

**Version:** 0.14.4
**Theme:** Environment Configuration Schemas
**Prerequisites:** v0.14.3 Complete (Monster Configuration Schemas)
**Total Estimated Tests:** ~20 new tests

---

## Executive Summary

The Environment Configuration Schemas version creates comprehensive JSON schemas for all environment-related configuration files, enabling full customization of biomes, room types, terrain, and interactive objects without code changes. This supports modding scenarios like sci-fi space stations, underwater environments, haunted mansions, or procedurally generated wilderness.

The work is divided into **four sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.14.4a | Biome Schema | biomes.schema.json with spawn tables, terrain distributions, descriptors | 8 ✓ |
| v0.14.4b | Room Type Schema | room-types.schema.json with templates, features, connections, lighting | 9 ✓ |
| v0.14.4c | Terrain Schema Expansion | Expand terrain.schema.json with cover, hazards, visibility | 10 ✓ |
| v0.14.4d | Interactive Object Schema | interactive-objects.schema.json with interactions, skill checks, states | 12 ✓ |

---

## Feature Analysis & Categorization

### From v0.14.x-overview.md - Environment Configuration Schemas

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| biomes.schema.json | Medium | monsters, terrain | **v0.14.4a** |
| Monster spawn tables | Medium | biomes.schema.json | **v0.14.4a** |
| Terrain distributions | Low | biomes.schema.json | **v0.14.4a** |
| Hazard frequencies | Low | biomes.schema.json | **v0.14.4a** |
| Ambient descriptors | Low | biomes.schema.json | **v0.14.4a** |
| Music theme associations | Low | biomes.schema.json | **v0.14.4a** |
| room-types.schema.json | Medium | None | **v0.14.4b** |
| Room template references | Low | room-types.schema.json | **v0.14.4b** |
| Feature spawn rules | Medium | room-types.schema.json | **v0.14.4b** |
| Connection rules | Low | room-types.schema.json | **v0.14.4b** |
| Lighting conditions | Low | room-types.schema.json | **v0.14.4b** |
| terrain.schema.json expansion | Low | Existing schema | **v0.14.4c** |
| Movement cost validation | Low | terrain.schema.json | **v0.14.4c** |
| Cover associations | Low | terrain.schema.json | **v0.14.4c** |
| Hazard associations | Low | terrain.schema.json | **v0.14.4c** |
| Visibility modifiers | Low | terrain.schema.json | **v0.14.4c** |
| interactive-objects.schema.json | Medium | skills | **v0.14.4d** |
| Interaction types | Low | interactive-objects.schema.json | **v0.14.4d** |
| Skill check requirements | Medium | interactive-objects.schema.json | **v0.14.4d** |
| Reward definitions | Low | interactive-objects.schema.json | **v0.14.4d** |
| State transitions | Medium | interactive-objects.schema.json | **v0.14.4d** |

---

## Existing Infrastructure

### Current Configuration Files

| File | Current State | Schema Exists |
|------|---------------|---------------|
| `config/biomes.json` | 8 biomes (cave, dungeon, volcanic, frozen, swamp, ruins, forest, desert) | No |
| `config/room-types.json` | 6 room types (standard, treasure, trap, boss, safe, shrine) | No |
| `config/room-templates.json` | 4 templates with slots for descriptors, monsters, hazards | Partial ($schema reference) |
| `config/terrain.json` | 10 terrain types (floor, rubble, water, etc.) | Yes (terrain.schema.json) |
| `config/interactive-objects.json` | 12 objects (doors, chests, levers, etc.) | Partial ($schema reference) |

### Current Biome Structure

```json
{
  "id": "volcanic",
  "name": "Volcanic",
  "description": "Areas of active or dormant volcanic activity",
  "defaultCategoryValues": {
    "climate": "scorching",
    "lighting": "dim"
  },
  "impliedTags": ["volcanic", "heat", "danger", "fire"],
  "descriptorPoolOverrides": {
    "environmental.lighting": "environmental.lighting.volcanic",
    "environmental.temperature": "environmental.temperature.volcanic"
  },
  "emphasizedTerms": ["lava", "sulfur", "heat", "glow", "magma"],
  "excludedTerms": ["cold", "ice", "frost", "chill", "freezing"]
}
```

### Current Room Type Structure

```json
{
  "id": "treasure",
  "name": "Treasure Room",
  "entryDescription": "Glittering objects catch your eye among the shadows.",
  "indicator": "[Treasure Room]",
  "monsterSpawnMultiplier": 0.5,
  "lootMultiplier": 2.0,
  "allowsRest": false,
  "descriptionPool": [
    "Gold coins are scattered across the floor.",
    "An ornate chest sits in the corner."
  ]
}
```

### Current Interactive Object Structure

```json
{
  "id": "iron-door-basic",
  "name": "Heavy Iron Door",
  "description": "A massive iron door with ancient hinges.",
  "objectType": "Door",
  "defaultState": "Closed",
  "allowedInteractions": ["Open", "Close", "Examine"],
  "blocksPassage": true,
  "keywords": ["door", "iron door", "heavy door"]
}
```

### Existing Terrain Schema

The existing `terrain.schema.json` already defines:
- TerrainDefinition with id, name, type (Normal, Difficult, Impassable, Hazardous)
- movementCostMultiplier, damageOnEntry, damageType, blocksLOS, displayChar

### Key Schema Conventions

- JSON Schema Draft-07 format
- ID pattern: `^[a-z][a-z0-9-]*$` (lowercase kebab-case)
- Definitions section for reusable types
- Required fields explicitly listed
- Descriptions on all properties

---

## Phase Definitions

---

## v0.14.4a: Biome Schema

[v0.14.4a Design Specification](v0.14.4a-design-specification.md)

### Overview

Create a comprehensive JSON schema for biome definitions that validates monster spawn tables, terrain distributions, hazard frequencies, ambient descriptors, and music associations.

### Scope

**In Scope:**
- `biomes.schema.json` - Full schema for biome definitions
- Default category values (climate, lighting, era, condition)
- Implied tag arrays for descriptor filtering
- Descriptor pool overrides (mapping category to pool ID)
- Emphasized and excluded term arrays
- Monster spawn table (weighted monster references)
- Terrain distribution percentages
- Hazard frequency configuration
- Music theme association

**Out of Scope:**
- Room type schema (v0.14.4b)
- Terrain schema expansion (v0.14.4c)
- Interactive object schema (v0.14.4d)
- Biome generation logic (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `biomes.schema.json` |
| Schema Definitions | 4 | `BiomeDefinition`, `SpawnTable`, `TerrainDistribution`, `HazardFrequency` |
| Configuration Updates | 1 | Update `biomes.json` to reference new schema |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
biomes.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Biome Configuration"
|-- description: "Schema for biome definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- biomes: object (map of biome id -> BiomeDefinition)
|-- required: ["biomes"]
+-- definitions:
    |-- BiomeDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9-]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- defaultCategoryValues: DefaultCategories
    |   |-- impliedTags: array of string
    |   |-- descriptorPoolOverrides: object (category -> pool id)
    |   |-- emphasizedTerms: array of string
    |   |-- excludedTerms: array of string
    |   |-- monsterSpawnTable: SpawnTable (optional)
    |   |-- terrainDistribution: TerrainDistribution (optional)
    |   |-- hazardFrequency: HazardFrequency (optional)
    |   |-- musicThemeId: string (optional)
    |   |-- ambientSoundId: string (optional)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- DefaultCategories
    |   |-- climate: string (enum: freezing, cold, temperate, warm, hot, scorching)
    |   |-- lighting: string (enum: dark, dim, normal, bright)
    |   |-- era: string (enum: ancient, medieval, modern, futuristic, optional)
    |   +-- condition: string (enum: pristine, weathered, ruined, collapsed, flooded, overgrown, optional)
    |-- SpawnTable
    |   |-- entries: array of SpawnEntry
    |   +-- levelModifier: integer (optional, adds to spawn level)
    |-- SpawnEntry
    |   |-- monsterId: string (references monsters.json)
    |   |-- weight: integer (minimum: 1, default: 100)
    |   |-- minDepth: integer (optional, floor depth requirement)
    |   +-- maxDepth: integer (optional, floor depth cap)
    |-- TerrainDistribution
    |   |-- entries: array of TerrainEntry
    |-- TerrainEntry
    |   |-- terrainId: string (references terrain.json)
    |   +-- percentage: number (minimum: 0, maximum: 100)
    +-- HazardFrequency
        |-- baseChance: number (minimum: 0, maximum: 1, default: 0.1)
        |-- hazardTypes: array of string (hazard terrain ids)
        +-- depthScaling: number (optional, multiplier per depth)
```

### Climate Types

| Climate | Description | Temperature Effect |
|---------|-------------|-------------------|
| `freezing` | Extreme cold | Cold damage over time |
| `cold` | Chilly environment | Minor stamina drain |
| `temperate` | Comfortable temperature | No effect |
| `warm` | Heated environment | Minor stamina drain |
| `hot` | Very warm | Increased stamina drain |
| `scorching` | Extreme heat | Fire damage over time |

### Lighting Types

| Lighting | Description | Visibility Effect |
|----------|-------------|-------------------|
| `dark` | No natural light | Severely reduced sight |
| `dim` | Minimal light | Reduced sight range |
| `normal` | Standard lighting | Normal visibility |
| `bright` | Ample light | Extended sight range |

### Acceptance Criteria

- [x] `biomes.schema.json` created in `config/schemas/`
- [x] Schema validates existing `biomes.json` without errors
- [x] Default category values validated with enums
- [x] Implied tags validated as string array
- [x] Descriptor pool overrides validated as string-to-string map
- [x] Emphasized/excluded terms validated as string arrays
- [x] Monster spawn table validated with weights
- [x] Terrain distribution percentages validated (0-100)
- [x] Hazard frequency validated (0-1 base chance)
- [x] ~5 unit tests pass (7 implemented)

---

## v0.14.4b: Room Type Schema

[v0.14.4b Design Specification](v0.14.4b-design-specification.md)

### Overview

Create a comprehensive JSON schema for room type definitions that validates spawn multipliers, loot multipliers, description pools, rest allowance, and room-specific features.

### Scope

**In Scope:**
- `room-types.schema.json` - Full schema for room type definitions
- Entry description text
- Indicator text (UI display)
- Monster spawn multiplier
- Loot multiplier
- Rest allowance flag
- Description pool arrays
- Connection rules (door types, corridor styles)
- Lighting condition overrides
- Feature spawn rules (objects, NPCs)

**Out of Scope:**
- Biome schema (v0.14.4a)
- Terrain schema (v0.14.4c)
- Interactive object schema (v0.14.4d)
- Room generation logic (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `room-types.schema.json` |
| Schema Definitions | 3 | `RoomTypeDefinition`, `ConnectionRules`, `FeatureSpawnRule` |
| Configuration Updates | 1 | Update `room-types.json` to reference new schema |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
room-types.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Room Type Configuration"
|-- description: "Schema for room type definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- roomTypes: object (map of room type id -> RoomTypeDefinition)
|-- required: ["roomTypes"]
+-- definitions:
    |-- RoomTypeDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9-]*$)
    |   |-- name: string (minLength: 1)
    |   |-- entryDescription: string (shown on entry, optional)
    |   |-- indicator: string (UI display tag, optional)
    |   |-- monsterSpawnMultiplier: number (minimum: 0, default: 1.0)
    |   |-- lootMultiplier: number (minimum: 0, default: 1.0)
    |   |-- experienceMultiplier: number (minimum: 0, default: 1.0)
    |   |-- allowsRest: boolean (default: false)
    |   |-- descriptionPool: array of string
    |   |-- connectionRules: ConnectionRules (optional)
    |   |-- lightingOverride: string (enum: dark, dim, normal, bright, optional)
    |   |-- featureSpawnRules: array of FeatureSpawnRule (optional)
    |   |-- requiredFeatures: array of string (optional, always spawn)
    |   |-- forbiddenFeatures: array of string (optional, never spawn)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- ConnectionRules
    |   |-- allowedDoorTypes: array of string (door object type ids)
    |   |-- secretPassageChance: number (minimum: 0, maximum: 1, default: 0)
    |   |-- minConnections: integer (minimum: 1, default: 1)
    |   +-- maxConnections: integer (minimum: 1, default: 4)
    +-- FeatureSpawnRule
        |-- featureId: string (interactive object or NPC id)
        |-- spawnChance: number (minimum: 0, maximum: 1)
        |-- minQuantity: integer (minimum: 0, default: 0)
        |-- maxQuantity: integer (minimum: 0, default: 1)
        +-- conditions: SpawnConditions (optional)
```

### Room Type Examples

| Room Type | Monsters | Loot | Rest | Special |
|-----------|----------|------|------|---------|
| `standard` | 1.0x | 1.0x | No | None |
| `treasure` | 0.5x | 2.0x | No | Guaranteed chest |
| `trap` | 1.2x | 1.0x | No | Trap features |
| `boss` | 1.0x | 3.0x | No | Boss spawn point |
| `safe` | 0.0x | 0.5x | Yes | No monsters |
| `shrine` | 0.2x | 1.5x | No | Altar interaction |

### Connection Rules

| Setting | Description | Default |
|---------|-------------|---------|
| `allowedDoorTypes` | Door objects that can spawn | All doors |
| `secretPassageChance` | Chance of hidden exit | 0% |
| `minConnections` | Minimum exits | 1 |
| `maxConnections` | Maximum exits | 4 |

### Acceptance Criteria

- [x] `room-types.schema.json` created in `config/schemas/`
- [x] Schema validates existing `room-types.json` without errors
- [x] Entry description validated as optional string
- [x] Indicator validated as optional string
- [x] Monster spawn multiplier validated (>= 0)
- [x] Loot multiplier validated (>= 0)
- [x] Allows rest validated as boolean
- [x] Description pool validated as string array
- [x] Connection rules validated with door types
- [x] Feature spawn rules validated
- [x] ~5 unit tests pass (9 implemented)

---

## v0.14.4c: Terrain Schema Expansion

[v0.14.4c Design Specification](v0.14.4c-design-specification.md)

### Overview

Expand the existing terrain schema to add cover associations, visibility modifiers, hazard triggers, and enhanced movement cost validation.

### Scope

**In Scope:**
- Expand `terrain.schema.json` with new fields
- Cover level enumeration (None, Half, ThreeQuarters, Full)
- Visibility modifier (blocks LOS partially)
- Hazard trigger conditions (on entry, per turn, on exit)
- Status effect application (burning, freezing, etc.)
- Enhanced movement cost validation (minimum, maximum)
- Terrain tags for filtering

**Out of Scope:**
- Biome schema (v0.14.4a)
- Room type schema (v0.14.4b)
- Interactive object schema (v0.14.4d)
- Movement cost calculation logic (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | Update `terrain.schema.json` |
| Schema Definitions | 2 | Expand `TerrainDefinition`, add `HazardEffect` |
| Configuration Updates | 1 | Update `terrain.json` with new fields (optional) |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure (Additions)

```
terrain.schema.json (EXPANDED)
+-- definitions:
    +-- TerrainDefinition (EXPANDED)
        |-- (existing fields...)
        |-- coverLevel: string (enum: None, Half, ThreeQuarters, Full, default: None)
        |-- visibilityModifier: number (minimum: 0, maximum: 1, default: 1.0)
        |-- providesConcealment: boolean (default: false)
        |-- hazardEffect: HazardEffect (optional)
        |-- appliesStatusEffect: string (status effect id, optional)
        |-- statusEffectChance: number (minimum: 0, maximum: 1, default: 1.0)
        |-- tags: array of string (optional)
        +-- biomeAssociations: array of string (biome ids, optional)
    +-- HazardEffect (NEW)
        |-- triggerType: string (enum: OnEntry, PerTurn, OnExit)
        |-- damage: string (dice expression)
        |-- damageType: string (damage type id)
        |-- savingThrow: SavingThrow (optional)
        +-- description: string (optional)
    +-- SavingThrow
        |-- attribute: string (enum: might, fortitude, will, wits, finesse)
        |-- dc: integer (minimum: 1)
        +-- halfOnSuccess: boolean (default: true)
```

### Cover Levels

| Cover Level | Defense Bonus | Description |
|-------------|---------------|-------------|
| `None` | +0 | No cover provided |
| `Half` | +2 | Partial cover (low walls, crates) |
| `ThreeQuarters` | +4 | Significant cover (pillars, corners) |
| `Full` | +6 | Full cover (solid walls, doors) |

### Hazard Trigger Types

| Trigger | When Applied | Examples |
|---------|--------------|----------|
| `OnEntry` | When stepping onto tile | Spike trap, fire |
| `PerTurn` | Each turn while on tile | Lava, acid pool |
| `OnExit` | When leaving tile | Sticky web, tar pit |

### Visibility Modifiers

| Modifier | Effect | Examples |
|----------|--------|----------|
| `1.0` | Full visibility | Open floor |
| `0.5` | 50% visibility | Mist, smoke |
| `0.0` | Blocks line of sight | Walls |

### Acceptance Criteria

- [x] `terrain.schema.json` expanded in `config/schemas/`
- [x] Schema validates existing `terrain.json` without errors
- [x] Cover level enum validated (None, Half, ThreeQuarters, Full)
- [x] Visibility modifier validated (0.0 to 1.0)
- [x] Hazard effect validated with trigger types
- [x] Damage dice expression validated
- [x] Saving throw validated with attribute enum
- [x] Status effect reference validated as string
- [x] Tags validated as string array
- [x] Backward compatible with existing terrain definitions
- [x] ~5 unit tests pass (10 implemented)

---

## v0.14.4d: Interactive Object Schema

[v0.14.4d Design Specification](v0.14.4d-design-specification.md)

### Overview

Create a comprehensive JSON schema for interactive object definitions that validates interaction types, skill check requirements, state transitions, rewards, and keywords.

### Scope

**In Scope:**
- `interactive-objects.schema.json` - Full schema for interactive objects
- Object type enumeration (Door, Chest, Lever, Altar, etc.)
- State enumeration (Closed, Open, Locked, Broken, etc.)
- Allowed interaction types (Open, Close, Examine, Search, Activate, Break, Unlock)
- Skill check requirements (skill id, DC)
- Reward definitions (items, gold, information)
- State transitions (from state -> to state via interaction)
- Passage blocking flag
- Keywords for natural language parsing

**Out of Scope:**
- Biome schema (v0.14.4a)
- Room type schema (v0.14.4b)
- Terrain schema (v0.14.4c)
- Interaction execution logic (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `interactive-objects.schema.json` |
| Schema Definitions | 5 | `InteractiveObjectDefinition`, `SkillCheck`, `Reward`, `StateTransition`, `InteractionResult` |
| Configuration Updates | 1 | Update `interactive-objects.json` to reference new schema |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
interactive-objects.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Interactive Object Configuration"
|-- description: "Schema for interactive object definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- interactiveObjects: array of InteractiveObjectDefinition
|-- required: ["interactiveObjects"]
+-- definitions:
    |-- InteractiveObjectDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9-]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- objectType: string (enum: Door, Chest, Lever, Altar, Barrel, Crate, Web, Statue, LightSource, Inscription, Trap, Switch, Bookshelf, Fountain)
    |   |-- defaultState: string (enum: Closed, Open, Locked, Broken, Lit, Unlit, Active, Inactive, Normal, Triggered, Down, Up)
    |   |-- allowedInteractions: array of string (enum: Open, Close, Examine, Search, Activate, Break, Unlock, Lock, Read, Use, Push, Pull)
    |   |-- blocksPassage: boolean (default: false)
    |   |-- blocksLOS: boolean (default: false)
    |   |-- keywords: array of string
    |   |-- skillChecks: object (interaction -> SkillCheck, optional)
    |   |-- stateTransitions: array of StateTransition (optional)
    |   |-- rewards: object (state -> Reward, optional)
    |   |-- trapEffect: TrapEffect (optional, for trap objects)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- SkillCheck
    |   |-- skillId: string (references skills.json)
    |   |-- dc: integer (minimum: 1)
    |   |-- alternateSkillId: string (optional, secondary skill option)
    |   +-- alternateDc: integer (optional)
    |-- StateTransition
    |   |-- fromState: string (state enum value)
    |   |-- toState: string (state enum value)
    |   |-- viaInteraction: string (interaction enum value)
    |   |-- requiresSkillCheck: boolean (default: false)
    |   +-- message: string (optional, feedback text)
    |-- Reward
    |   |-- lootTableId: string (optional, references loot-tables.json)
    |   |-- fixedItems: array of ItemReward (optional)
    |   |-- goldRange: QuantityRange (optional)
    |   |-- experienceReward: integer (optional)
    |   +-- informationText: string (optional, clue or lore)
    |-- ItemReward
    |   |-- itemId: string
    |   |-- quantity: integer (minimum: 1, default: 1)
    |   +-- chance: number (minimum: 0, maximum: 1, default: 1.0)
    +-- TrapEffect
        |-- damage: string (dice expression)
        |-- damageType: string (damage type id)
        |-- statusEffect: string (optional)
        |-- savingThrow: SavingThrow (optional)
        |-- triggerChance: number (minimum: 0, maximum: 1, default: 1.0)
        +-- disarmDc: integer (optional)
```

### Object Types

| Type | Description | Typical Interactions |
|------|-------------|----------------------|
| `Door` | Passage blockers | Open, Close, Unlock, Break |
| `Chest` | Item containers | Open, Close, Search, Unlock |
| `Lever` | Mechanism triggers | Activate, Examine |
| `Altar` | Shrine interactables | Activate, Examine |
| `Barrel` | Storage containers | Open, Search, Break |
| `Crate` | Breakable containers | Open, Break, Search |
| `Web` | Passage blockers | Break, Examine |
| `Statue` | Decorative/interactive | Examine, Activate |
| `LightSource` | Torches, lamps | Examine |
| `Inscription` | Readable text | Examine, Read |
| `Trap` | Harmful triggers | Examine, Disarm |
| `Switch` | Mechanism triggers | Activate, Push |
| `Bookshelf` | Information source | Search, Read |
| `Fountain` | Healing/resource | Use, Examine |

### Interaction Types

| Interaction | Description | Typical Objects |
|-------------|-------------|-----------------|
| `Open` | Open a closed object | Door, Chest, Crate |
| `Close` | Close an open object | Door, Chest |
| `Examine` | Get detailed description | All objects |
| `Search` | Look for hidden items | Chest, Barrel, Bookshelf |
| `Activate` | Trigger mechanism | Lever, Altar, Switch |
| `Break` | Destroy object | Crate, Web, Door |
| `Unlock` | Remove lock | Door, Chest |
| `Lock` | Add lock | Door, Chest |
| `Read` | Read text content | Inscription, Bookshelf |
| `Use` | Consume/interact | Fountain, Altar |
| `Push` | Push mechanism | Switch, Statue |
| `Pull` | Pull mechanism | Lever, Switch |

### State Transitions

| From State | Via | To State | Example |
|------------|-----|----------|---------|
| `Closed` | Open | `Open` | Opening a door |
| `Open` | Close | `Closed` | Closing a chest |
| `Locked` | Unlock | `Closed` | Unlocking a door |
| `Closed` | Lock | `Locked` | Locking a chest |
| `Normal` | Break | `Broken` | Breaking a web |
| `Inactive` | Activate | `Active` | Activating altar |
| `Down` | Activate | `Up` | Pulling a lever |

### Acceptance Criteria

- [x] `interactive-objects.schema.json` created in `config/schemas/`
- [x] Schema validates existing `interactive-objects.json` without errors
- [x] Object type enum validated (14 types)
- [x] State enum validated (12 states)
- [x] Interaction enum validated (12 interactions)
- [x] Skill check validated with skill reference and DC
- [x] State transitions validated with from/to/via
- [x] Rewards validated with items, gold, experience
- [x] Trap effect validated with damage and saving throw
- [x] Keywords validated as string array
- [x] ~5 unit tests pass (12 implemented)

---

## Dependencies & Prerequisites

```
v0.14.3 (Monster Configuration Schemas) - REQUIRED
    |
    +-- monsters.schema.json available ────────────────────────────────────┐
                                                                           |
                                       v
v0.14.4 (Environment Configuration Schemas)
    |
    |-- v0.14.4a: Biome Schema ───────────────────────────────────────────┐
    |       Dependencies: monsters.schema.json (spawn tables)              |
    |       Provides: biomes.schema.json                                   |
    |                                                                      |
    |-- v0.14.4b: Room Type Schema ───────────────────────────────────────┤
    |       Dependencies: None                                             |
    |       Provides: room-types.schema.json                               |
    |                                                                      |
    |-- v0.14.4c: Terrain Schema Expansion ───────────────────────────────┤
    |       Dependencies: Existing terrain.schema.json                     |
    |       Provides: Expanded terrain.schema.json                         |
    |                                                                      |
    +-- v0.14.4d: Interactive Object Schema ──────────────────────────────┘
            Dependencies: skills.schema.json, loot-tables.schema.json
            Provides: interactive-objects.schema.json

Note: v0.14.4a, v0.14.4b, v0.14.4c, v0.14.4d can be implemented in parallel.
      All build on existing v0.14.0-v0.14.3 foundations.
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.14.4a | 1 | 1 | ~5 | Medium |
| v0.14.4b | 1 | 1 | ~5 | Medium |
| v0.14.4c | 0 | 2 | ~5 | Low |
| v0.14.4d | 1 | 1 | ~5 | Medium |
| **Total** | **3** | **5** | **~20** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Biomes.json structure differs significantly | Medium | Low | Review existing structure before schema |
| Room types use object map not array | Low | Medium | Support object map in schema |
| Terrain schema backward compatibility | Medium | Low | Make new fields optional |
| Interactive object state complexity | Low | Low | Start with existing states, expand later |

---

## Design Decisions (Confirmed)

### Schema Standards

| Decision | Value | Notes |
|----------|-------|-------|
| **JSON Schema Version** | Draft-07 | Consistent with v0.14.0-v0.14.3 |
| **ID Pattern** | `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| **Schema Location** | `config/schemas/` | Centralized schema storage |

### Biome Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Biomes Structure** | Object map | Keyed by biome id (existing pattern) |
| **Climate Enum** | 6 values | freezing through scorching |
| **Lighting Enum** | 4 values | dark through bright |
| **Spawn Tables** | Optional | Not all biomes need custom spawns |

### Room Type Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Room Types Structure** | Object map | Keyed by room type id (existing pattern) |
| **Multipliers** | Non-negative | 0 means "none" (e.g., no monsters) |
| **Description Pool** | Array | Multiple descriptions for variety |

### Terrain Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Cover Levels** | 4 values | None, Half, ThreeQuarters, Full |
| **Visibility Range** | 0.0-1.0 | Percentage of normal visibility |
| **Hazard Triggers** | 3 types | OnEntry, PerTurn, OnExit |

### Interactive Object Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Object Types** | 14 types | Covers common dungeon interactables |
| **States** | 12 values | Covers open/closed, locked, broken, etc. |
| **Interactions** | 12 types | Common verbs for interaction |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.14.4b Design Spec** - Create room type schema (simplest, no dependencies)
3. **v0.14.4b Implementation** - Build room-types.schema.json
4. **v0.14.4c Design Spec** - Create terrain schema expansion
5. **v0.14.4c Implementation** - Expand terrain.schema.json
6. **v0.14.4a Design Spec** - Create biome schema
7. **v0.14.4a Implementation** - Build biomes.schema.json
8. **v0.14.4d Design Spec** - Create interactive object schema
9. **v0.14.4d Implementation** - Build interactive-objects.schema.json

---

*This scope breakdown provides a structured approach to implementing v0.14.4 Environment Configuration Schemas. Each sub-part creates or expands JSON schemas for environment-related configuration files. The recommended implementation order is v0.14.4b (room types), v0.14.4c (terrain expansion), v0.14.4a (biomes), and finally v0.14.4d (interactive objects), ensuring dependencies are satisfied and enabling full environment customization without code changes.*
