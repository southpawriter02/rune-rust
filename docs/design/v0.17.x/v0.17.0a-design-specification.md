# v0.17.0a Design Specification: Lineage Enum & Definition

**Version:** 0.17.0a  
**Phase Name:** Lineage Enum & Definition  
**Parent Version:** v0.17.0 (Lineage System)  
**Prerequisites:** v0.16.x Complete (Advanced Loot & Proficiency System)  
**Estimated Tests:** ~8 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Lineage Enum](#4-lineage-enum)
5. [LineageDefinition Entity](#5-lineagedefinition-entity)
6. [LineageAttributeModifiers Value Object](#6-lineageattributemodifiers-value-object)
7. [Data Model Changes](#7-data-model-changes)
8. [Configuration File Schemas](#8-configuration-file-schemas)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [User Stories](#12-user-stories)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the Lineage enumeration and LineageDefinition entity that form the foundation of the v0.17.x Character Creation System. Lineage represents a character's bloodline heritage from before the Great Silence and is the first permanent choice in character creation.

The four lineages reflect how ancestors were affected by the Runic Blight:

- **Clan-Born** — The Stable Code: Baseline humanity with flexible attribute bonus
- **Rune-Marked** — The Tainted Aether: Mystic affinity with permanent Corruption
- **Iron-Blooded** — The Corrupted Earth: Physical resilience with mental vulnerability
- **Vargr-Kin** — The Uncorrupted Echo: Primal connection with balanced bonuses

This phase establishes the enum, definition entity, and attribute modifier structure that all subsequent v0.17.0x phases depend upon.

### 1.2 Key Deliverables

| Category          | Items                                             |
| ----------------- | ------------------------------------------------- |
| **Enums**         | `Lineage`                                         |
| **Entities**      | `LineageDefinition`                               |
| **Value Objects** | `LineageAttributeModifiers`                       |
| **Configuration** | `lineages.json` (partial), `lineages.schema.json` |
| **Tests**         | ~8 unit tests                                     |

### 1.3 Architectural Significance

This version establishes the **Lineage Pattern** used throughout character creation:

- **Enum-Based Lineage Identification**: All characters reference a `Lineage` value
- **Definition Entity Pattern**: `LineageDefinition` holds all lineage data
- **Flexible Bonus System**: Clan-Born's +1 to any attribute sets pattern for future flexibility
- **Attribute Modifier Structure**: Foundation for lineage effects on character stats
- **Configuration-Driven**: Lineage properties loaded from JSON for customization

---

## 2. Feature Overview

```
v0.17.0a Lineage Enum & Definition
├── Lineage Enum
│   ├── ClanBorn (0) — The Stable Code
│   ├── RuneMarked (1) — The Tainted Aether
│   ├── IronBlooded (2) — The Corrupted Earth
│   └── VargrKin (3) — The Uncorrupted Echo
├── LineageDefinition Entity
│   ├── Id: Guid
│   ├── LineageId: Lineage enum
│   ├── DisplayName: string
│   ├── Description: string
│   ├── SelectionText: string
│   ├── AttributeModifiers: LineageAttributeModifiers
│   ├── AppearanceNotes: string
│   └── SocialRole: string
└── LineageAttributeModifiers Value Object
    ├── MightModifier: int
    ├── FinesseModifier: int
    ├── WitsModifier: int
    ├── WillModifier: int
    ├── SturdinessModifier: int
    ├── HasFlexibleBonus: bool
    └── FlexibleBonusAmount: int
```

### 2.1 Scope Alignment

**In Scope:**

- `Lineage` enum with four lineage values (0-3)
- `LineageDefinition` entity with core properties
- `LineageAttributeModifiers` value object
- Attribute modifier table per lineage
- Clan-Born flexible bonus mechanism
- Partial `lineages.json` configuration (attribute section)
- `lineages.schema.json` validation schema
- Norse-inspired lineage naming and lore

**Out of Scope:**

- Passive bonuses (HP, AP, Soak, Movement, Skills) → v0.17.0b
- Unique traits → v0.17.0c
- Trauma baselines (Corruption, Stress) → v0.17.0d
- LineageProvider service → v0.17.0e
- LineageApplicationService → v0.17.0f

---

## 3. Architecture Diagrams

### 3.1 Lineage System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                    LINEAGE SYSTEM OVERVIEW                           │
└─────────────────────────────────────────────────────────────────────┘

    Character Creation UI
           │
           │  Player selects lineage
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                          Lineage Enum                                │
├─────────────────────────────────────────────────────────────────────┤
│  ClanBorn (0)   │  RuneMarked (1)  │  IronBlooded (2)  │ VargrKin(3)│
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Get definition for display/application
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      LineageDefinition Entity                        │
├─────────────────────────────────────────────────────────────────────┤
│  - LineageId: Lineage                                               │
│  - DisplayName: string           (e.g., "Clan-Born")                │
│  - Description: string           (flavor text)                       │
│  - SelectionText: string         (UI selection description)          │
│  - AttributeModifiers: LineageAttributeModifiers                     │
│  - AppearanceNotes: string       (physical characteristics)          │
│  - SocialRole: string            (society position)                  │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Contains attribute modifiers
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   LineageAttributeModifiers                          │
├─────────────────────────────────────────────────────────────────────┤
│  - MightModifier: int            (e.g., +1 for Vargr-Kin)           │
│  - FinesseModifier: int          (e.g., +1 for Vargr-Kin)           │
│  - WitsModifier: int                                                 │
│  - WillModifier: int             (e.g., +2 for Rune-Marked)         │
│  - SturdinessModifier: int       (e.g., +2 for Iron-Blooded)        │
│  - HasFlexibleBonus: bool        (true for Clan-Born)               │
│  - FlexibleBonusAmount: int      (e.g., 1 for Clan-Born)            │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  CharacterCreationView (v0.17.5)                                     │
│  └── Uses LineageDefinition.DisplayName, SelectionText               │
│                                                                      │
│  LineageSelectionPanel (v0.17.5)                                     │
│  └── Uses LineageDefinition for UI rendering                         │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │               ILineageProvider (v0.17.0e)                     │  │
│  │                 (interface for lineage access)                │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  + GetAllLineages(): IReadOnlyList<LineageDefinition>         │  │
│  │  + GetLineage(Lineage): LineageDefinition?                    │  │
│  │  + GetAttributeModifiers(Lineage): LineageAttributeModifiers  │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ILineageApplicationService (v0.17.0f)                               │
│  └── Uses Lineage enum and LineageAttributeModifiers                 │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌────────────────────────────────────┐   │
│  │      Lineage        │  │       LineageDefinition            │   │
│  │       (Enum)        │  │          (Entity)                  │   │
│  ├─────────────────────┤  ├────────────────────────────────────┤   │
│  │ ClanBorn = 0        │  │ Id: Guid                           │   │
│  │ RuneMarked = 1      │  │ LineageId: Lineage                 │   │
│  │ IronBlooded = 2     │  │ DisplayName: string                │   │
│  │ VargrKin = 3        │  │ Description: string                │   │
│  └─────────────────────┘  │ SelectionText: string              │   │
│                           │ AttributeModifiers: ...            │   │
│  ┌────────────────────────┴────────────────────────────────┐   │   │
│  │         LineageAttributeModifiers (Value Object)        │   │   │
│  ├─────────────────────────────────────────────────────────┤   │   │
│  │ MightModifier: int       SturdinessModifier: int        │   │   │
│  │ FinesseModifier: int     HasFlexibleBonus: bool         │   │   │
│  │ WitsModifier: int        FlexibleBonusAmount: int       │   │   │
│  │ WillModifier: int                                       │   │   │
│  └─────────────────────────────────────────────────────────┘   │   │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.3 Attribute Modifier Application Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                 ATTRIBUTE MODIFIER APPLICATION FLOW                  │
└─────────────────────────────────────────────────────────────────────┘

    Player selects Lineage.VargrKin
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    GET LINEAGE DEFINITION                            │
├─────────────────────────────────────────────────────────────────────┤
│  LineageDefinition for VargrKin:                                     │
│    DisplayName: "Vargr-Kin"                                          │
│    AttributeModifiers:                                               │
│      MightModifier: +1                                               │
│      FinesseModifier: +1                                             │
│      WitsModifier: 0                                                 │
│      WillModifier: -1                                                │
│      SturdinessModifier: 0                                           │
│      HasFlexibleBonus: false                                         │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    APPLY TO BASE ATTRIBUTES                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Base Attributes (after point-buy):                                  │
│    MIGHT: 3      FINESSE: 3      WITS: 3      WILL: 3    STURD: 3   │
│                                                                      │
│  + Lineage Modifiers:                                                │
│    MIGHT: +1     FINESSE: +1     WITS: +0     WILL: -1   STURD: +0  │
│                                                                      │
│  = Final Attributes:                                                 │
│    MIGHT: 4      FINESSE: 4      WITS: 3      WILL: 2    STURD: 3   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.4 Clan-Born Flexible Bonus Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│               CLAN-BORN FLEXIBLE BONUS DECISION TREE                 │
└─────────────────────────────────────────────────────────────────────┘

    Player selects Lineage.ClanBorn
           │
           ▼
    ┌──────────────────┐
    │ HasFlexibleBonus │
    │      = true      │
    └────────┬─────────┘
             │
             ▼
    ┌──────────────────────────────────────┐
    │  UI Prompt: "Choose attribute for   │
    │  +1 bonus: MIGHT, FINESSE, WITS,    │
    │  WILL, or STURDINESS"               │
    └────────────────┬─────────────────────┘
                     │
                     ▼
         ┌───────────────────────┐
         │ Player selects WITS   │
         └───────────┬───────────┘
                     │
                     ▼
    ┌──────────────────────────────────────┐
    │  ValidateFlexibleBonus(              │
    │    Lineage.ClanBorn,                 │
    │    CoreAttribute.Wits)               │
    │                                       │
    │  → Returns true                       │
    └────────────────┬─────────────────────┘
                     │
                     ▼
    ┌──────────────────────────────────────┐
    │  Apply FlexibleBonusAmount (+1)      │
    │  to selected attribute (WITS)        │
    │                                       │
    │  Result: WITS +1 (in addition to     │
    │  any other modifiers)                │
    └──────────────────────────────────────┘
```

---

## 4. Lineage Enum

### 4.1 Purpose

The `Lineage` enum defines the four bloodline heritage options available during character creation. This enum is the foundation for all lineage-related mechanics including attribute modifiers, passive bonuses, unique traits, and Trauma Economy interactions.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/Lineage.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the bloodline heritage of a character from before the Great Silence.
/// </summary>
/// <remarks>
/// <para>
/// Lineage represents how a character's ancestors were affected by the Runic Blight.
/// It is the first permanent choice in character creation and determines attribute
/// modifiers, passive bonuses, unique traits, and Trauma Economy baselines.
/// </para>
/// <para>
/// The four lineages each offer distinct gameplay advantages:
/// - Clan-Born: Flexible and adaptable baseline humans
/// - Rune-Marked: Mystic affinity at the cost of Corruption vulnerability
/// - Iron-Blooded: Physical resilience with mental vulnerability
/// - Vargr-Kin: Primal connection with balanced attribute bonuses
/// </para>
/// <para>
/// Lineage values are explicitly assigned (0-3) to ensure stable serialization
/// and database storage. New lineages should be added at the end if needed.
/// </para>
/// </remarks>
public enum Lineage
{
    /// <summary>
    /// The Stable Code - Descendants of survivors with untainted bloodlines.
    /// </summary>
    /// <remarks>
    /// Clan-Born represent baseline humanity. Their ancestors survived the
    /// Great Silence through luck, preparation, or isolation rather than
    /// mutation. They gain a flexible +1 bonus to any attribute of the
    /// player's choice, representing their adaptable nature.
    /// </remarks>
    ClanBorn = 0,

    /// <summary>
    /// The Tainted Aether - Those whose blood carries the All-Rune's echo.
    /// </summary>
    /// <remarks>
    /// Rune-Marked ancestors were exposed to concentrated Aether during
    /// the Blight. They gain +2 WILL and enhanced Aether Pool but suffer
    /// -1 STURDINESS and start with 5 permanent Corruption, reflecting
    /// their mystical taint.
    /// </remarks>
    RuneMarked = 1,

    /// <summary>
    /// The Corrupted Earth - Bloodlines hardened by proximity to Blight-metal.
    /// </summary>
    /// <remarks>
    /// Iron-Blooded ancestors worked the corrupted mines and forges during
    /// the Blight era. They gain +2 STURDINESS and enhanced Soak but suffer
    /// -1 WILL and are more vulnerable to Psychic Stress, their minds less
    /// fortified than their bodies.
    /// </remarks>
    IronBlooded = 2,

    /// <summary>
    /// The Uncorrupted Echo - Those who carry the wolf-spirit's blessing.
    /// </summary>
    /// <remarks>
    /// Vargr-Kin trace their lineage to the Varangian shamans who communed
    /// with primal spirits. They gain +1 MIGHT, +1 FINESSE, -1 WILL, and
    /// enhanced movement. Their Primal Clarity trait reduces Psychic Stress
    /// taken, compensating for their Will penalty.
    /// </remarks>
    VargrKin = 3
}
```

### 4.3 Design Decisions

#### 4.3.1 Explicit Enum Values

**Decision:** Explicitly assign integer values (0-3) to enum members.

**Rationale:**

- Ensures stable serialization to JSON and database storage
- Prevents accidental value changes if enum order is modified
- Matches existing game patterns for enums (e.g., `QualityTier`)
- Supports future addition of lineages at higher values

#### 4.3.2 Four-Lineage System

**Decision:** Use exactly four lineages as defined in the scope breakdown.

**Rationale:**

- Matches the design specification in v0.17.0-scope-breakdown.md
- Each lineage offers distinct mechanical and thematic identity
- Four options provide meaningful choice without overwhelming players
- Aligns with Aethelgard lore (Great Silence, Runic Blight)

#### 4.3.3 Naming Conventions

**Decision:** Use PascalCase names based on Norse-inspired thematic terms.

**Rationale:**

- `ClanBorn`: References the clan-based society of survivors
- `RuneMarked`: Evokes the Runic Blight and Aether taint
- `IronBlooded`: References the Dvergr-influenced mining culture
- `VargrKin`: Norse "vargr" (wolf) connects to primal shamanism

### 4.4 Lineage Reference Table

| Enum Value    | Integer | Display Name | Thematic Title       |
| ------------- | ------- | ------------ | -------------------- |
| `ClanBorn`    | 0       | Clan-Born    | The Stable Code      |
| `RuneMarked`  | 1       | Rune-Marked  | The Tainted Aether   |
| `IronBlooded` | 2       | Iron-Blooded | The Corrupted Earth  |
| `VargrKin`    | 3       | Vargr-Kin    | The Uncorrupted Echo |

---

## 5. LineageDefinition Entity

### 5.1 Purpose

The `LineageDefinition` entity encapsulates all data for a single lineage, including display properties, attribute modifiers, and descriptive text. This entity is loaded from configuration and serves as the source of truth for lineage mechanics.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Entities/LineageDefinition.cs`

```csharp
namespace RuneAndRust.Domain.Entities;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.Interfaces;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a complete lineage definition including all properties and modifiers.
/// </summary>
/// <remarks>
/// <para>
/// LineageDefinition is an immutable entity loaded from configuration. It contains
/// all data needed to present lineage options during character creation and to
/// apply lineage effects to a new character.
/// </para>
/// <para>
/// This entity is extended by subsequent phases:
/// - v0.17.0b adds PassiveBonuses (HP, AP, Soak, Movement, Skills)
/// - v0.17.0c adds UniqueTrait
/// - v0.17.0d adds TraumaBaseline
/// </para>
/// </remarks>
public class LineageDefinition : IEntity
{
    /// <summary>
    /// Gets the unique identifier for this lineage definition.
    /// </summary>
    public Guid Id { get; private set; }

    /// <summary>
    /// Gets the lineage enum value this definition describes.
    /// </summary>
    public Lineage LineageId { get; private set; }

    /// <summary>
    /// Gets the display name shown in UI (e.g., "Clan-Born").
    /// </summary>
    public string DisplayName { get; private set; }

    /// <summary>
    /// Gets the full description of the lineage for detail views.
    /// </summary>
    public string Description { get; private set; }

    /// <summary>
    /// Gets the flavor text shown during lineage selection in character creation.
    /// </summary>
    public string SelectionText { get; private set; }

    /// <summary>
    /// Gets the attribute modifiers applied by this lineage.
    /// </summary>
    public LineageAttributeModifiers AttributeModifiers { get; private set; }

    /// <summary>
    /// Gets notes about typical physical appearance of this lineage.
    /// </summary>
    public string AppearanceNotes { get; private set; }

    /// <summary>
    /// Gets the typical social role or position of this lineage in society.
    /// </summary>
    public string SocialRole { get; private set; }

    /// <summary>
    /// Private constructor for EF Core.
    /// </summary>
    private LineageDefinition()
    {
        DisplayName = null!;
        Description = null!;
        SelectionText = null!;
        AppearanceNotes = null!;
        SocialRole = null!;
    }

    /// <summary>
    /// Creates a new LineageDefinition with the specified properties.
    /// </summary>
    /// <param name="lineageId">The lineage enum value.</param>
    /// <param name="displayName">The display name for UI.</param>
    /// <param name="description">The full description.</param>
    /// <param name="selectionText">The selection screen flavor text.</param>
    /// <param name="attributeModifiers">The attribute modifiers.</param>
    /// <param name="appearanceNotes">Physical appearance notes.</param>
    /// <param name="socialRole">Typical social role.</param>
    /// <returns>A new LineageDefinition instance.</returns>
    /// <exception cref="ArgumentException">
    /// Thrown when string parameters are null or whitespace.
    /// </exception>
    public static LineageDefinition Create(
        Lineage lineageId,
        string displayName,
        string description,
        string selectionText,
        LineageAttributeModifiers attributeModifiers,
        string appearanceNotes,
        string socialRole)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);
        ArgumentException.ThrowIfNullOrWhiteSpace(selectionText);
        ArgumentException.ThrowIfNullOrWhiteSpace(appearanceNotes);
        ArgumentException.ThrowIfNullOrWhiteSpace(socialRole);

        return new LineageDefinition
        {
            Id = Guid.NewGuid(),
            LineageId = lineageId,
            DisplayName = displayName,
            Description = description,
            SelectionText = selectionText,
            AttributeModifiers = attributeModifiers,
            AppearanceNotes = appearanceNotes,
            SocialRole = socialRole
        };
    }

    /// <summary>
    /// Gets the total attribute modifier sum (excluding flexible bonus).
    /// </summary>
    /// <returns>The sum of all fixed attribute modifiers.</returns>
    public int GetTotalFixedModifiers()
    {
        return AttributeModifiers.MightModifier +
               AttributeModifiers.FinesseModifier +
               AttributeModifiers.WitsModifier +
               AttributeModifiers.WillModifier +
               AttributeModifiers.SturdinessModifier;
    }

    /// <summary>
    /// Gets whether this lineage allows the player to choose a bonus attribute.
    /// </summary>
    /// <returns>True if player can select an attribute for bonus.</returns>
    public bool RequiresFlexibleBonusSelection()
    {
        return AttributeModifiers.HasFlexibleBonus;
    }

    /// <inheritdoc />
    public override string ToString() =>
        $"{DisplayName} ({LineageId})";
}
```

### 5.3 Lineage Definitions Table

| Lineage     | Display Name | Selection Text Summary                            |
| ----------- | ------------ | ------------------------------------------------- |
| ClanBorn    | Clan-Born    | "Your ancestors were the survivors..."            |
| RuneMarked  | Rune-Marked  | "The All-Rune's echo runs through your veins..."  |
| IronBlooded | Iron-Blooded | "Your blood carries the strength of the earth..." |
| VargrKin    | Vargr-Kin    | "The wolf-spirit's blessing flows through you..." |

---

## 6. LineageAttributeModifiers Value Object

### 6.1 Purpose

The `LineageAttributeModifiers` value object encapsulates all attribute modifications granted by a lineage, including fixed modifiers and the flexible bonus system for Clan-Born.

### 6.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/LineageAttributeModifiers.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Contains attribute modifiers applied by a lineage during character creation.
/// </summary>
/// <remarks>
/// <para>
/// LineageAttributeModifiers defines both fixed modifiers (applied automatically)
/// and flexible bonuses (player chooses which attribute). Only Clan-Born has
/// a flexible bonus; other lineages have fixed distributions.
/// </para>
/// <para>
/// Modifiers can be positive or negative. The net sum of all modifiers varies
/// by lineage, reflecting their distinct advantages and disadvantages.
/// </para>
/// </remarks>
/// <param name="MightModifier">Modifier to MIGHT attribute.</param>
/// <param name="FinesseModifier">Modifier to FINESSE attribute.</param>
/// <param name="WitsModifier">Modifier to WITS attribute.</param>
/// <param name="WillModifier">Modifier to WILL attribute.</param>
/// <param name="SturdinessModifier">Modifier to STURDINESS attribute.</param>
/// <param name="HasFlexibleBonus">Whether this lineage grants a player-chosen bonus.</param>
/// <param name="FlexibleBonusAmount">The amount of the flexible bonus (if any).</param>
public readonly record struct LineageAttributeModifiers(
    int MightModifier,
    int FinesseModifier,
    int WitsModifier,
    int WillModifier,
    int SturdinessModifier,
    bool HasFlexibleBonus,
    int FlexibleBonusAmount)
{
    /// <summary>
    /// Gets the total of all fixed modifiers (excluding flexible bonus).
    /// </summary>
    public int TotalFixedModifiers =>
        MightModifier + FinesseModifier + WitsModifier +
        WillModifier + SturdinessModifier;

    /// <summary>
    /// Gets the modifier for a specific attribute.
    /// </summary>
    /// <param name="attribute">The attribute to get the modifier for.</param>
    /// <returns>The modifier value for the specified attribute.</returns>
    public int GetModifier(CoreAttribute attribute) => attribute switch
    {
        CoreAttribute.Might => MightModifier,
        CoreAttribute.Finesse => FinesseModifier,
        CoreAttribute.Wits => WitsModifier,
        CoreAttribute.Will => WillModifier,
        CoreAttribute.Sturdiness => SturdinessModifier,
        _ => 0
    };

    /// <summary>
    /// Calculates the effective modifier for an attribute including flexible bonus.
    /// </summary>
    /// <param name="attribute">The attribute to calculate.</param>
    /// <param name="flexibleBonusTarget">The attribute receiving the flexible bonus (if applicable).</param>
    /// <returns>The total modifier including any flexible bonus.</returns>
    public int GetEffectiveModifier(CoreAttribute attribute, CoreAttribute? flexibleBonusTarget)
    {
        var baseModifier = GetModifier(attribute);

        if (HasFlexibleBonus && flexibleBonusTarget == attribute)
        {
            return baseModifier + FlexibleBonusAmount;
        }

        return baseModifier;
    }

    /// <summary>
    /// Creates the standard modifiers for Clan-Born lineage.
    /// </summary>
    public static LineageAttributeModifiers ClanBorn => new(
        MightModifier: 0,
        FinesseModifier: 0,
        WitsModifier: 0,
        WillModifier: 0,
        SturdinessModifier: 0,
        HasFlexibleBonus: true,
        FlexibleBonusAmount: 1);

    /// <summary>
    /// Creates the standard modifiers for Rune-Marked lineage.
    /// </summary>
    public static LineageAttributeModifiers RuneMarked => new(
        MightModifier: 0,
        FinesseModifier: 0,
        WitsModifier: 0,
        WillModifier: 2,
        SturdinessModifier: -1,
        HasFlexibleBonus: false,
        FlexibleBonusAmount: 0);

    /// <summary>
    /// Creates the standard modifiers for Iron-Blooded lineage.
    /// </summary>
    public static LineageAttributeModifiers IronBlooded => new(
        MightModifier: 0,
        FinesseModifier: 0,
        WitsModifier: 0,
        WillModifier: -1,
        SturdinessModifier: 2,
        HasFlexibleBonus: false,
        FlexibleBonusAmount: 0);

    /// <summary>
    /// Creates the standard modifiers for Vargr-Kin lineage.
    /// </summary>
    public static LineageAttributeModifiers VargrKin => new(
        MightModifier: 1,
        FinesseModifier: 1,
        WitsModifier: 0,
        WillModifier: -1,
        SturdinessModifier: 0,
        HasFlexibleBonus: false,
        FlexibleBonusAmount: 0);

    /// <inheritdoc />
    public override string ToString()
    {
        var parts = new List<string>();
        if (MightModifier != 0) parts.Add($"MIGHT {MightModifier:+#;-#;0}");
        if (FinesseModifier != 0) parts.Add($"FINESSE {FinesseModifier:+#;-#;0}");
        if (WitsModifier != 0) parts.Add($"WITS {WitsModifier:+#;-#;0}");
        if (WillModifier != 0) parts.Add($"WILL {WillModifier:+#;-#;0}");
        if (SturdinessModifier != 0) parts.Add($"STURDINESS {SturdinessModifier:+#;-#;0}");
        if (HasFlexibleBonus) parts.Add($"+{FlexibleBonusAmount} to any");

        return parts.Count > 0 ? string.Join(", ", parts) : "No modifiers";
    }
}
```

### 6.3 Attribute Modifier Reference Table

| Lineage      | MIGHT | FINESSE | WITS | WILL | STURDINESS | Flexible  | Net Total |
| ------------ | ----- | ------- | ---- | ---- | ---------- | --------- | --------- |
| Clan-Born    | 0     | 0       | 0    | 0    | 0          | +1 to any | +1        |
| Rune-Marked  | 0     | 0       | 0    | +2   | -1         | —         | +1        |
| Iron-Blooded | 0     | 0       | 0    | -1   | +2         | —         | +1        |
| Vargr-Kin    | +1    | +1      | 0    | -1   | 0          | —         | +1        |

---

## 7. Data Model Changes

### 7.1 New Types Summary

| Type                        | Layer  | Category     | Description                          |
| --------------------------- | ------ | ------------ | ------------------------------------ |
| `Lineage`                   | Domain | Enum         | Four bloodline heritage options      |
| `LineageDefinition`         | Domain | Entity       | Complete lineage data and properties |
| `LineageAttributeModifiers` | Domain | Value Object | Attribute modifiers for a lineage    |

### 7.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── Enums/
│   └── Lineage.cs                           ← NEW
├── Entities/
│   └── LineageDefinition.cs                 ← NEW
└── ValueObjects/
    └── LineageAttributeModifiers.cs         ← NEW

config/
├── lineages.json                            ← NEW (partial)
└── schemas/
    └── lineages.schema.json                 ← NEW
```

### 7.3 Entity Relationships

```
┌─────────────────┐         ┌─────────────────────┐
│     Lineage     │◄────────│  LineageDefinition  │
│     (Enum)      │  1:1    │      (Entity)       │
└─────────────────┘         └──────────┬──────────┘
                                       │
                                       │ contains
                                       ▼
                            ┌──────────────────────────┐
                            │ LineageAttributeModifiers│
                            │     (Value Object)       │
                            └──────────────────────────┘
```

---

## 8. Configuration File Schemas

### 8.1 lineages.json (Partial - Attribute Section)

**File:** `config/lineages.json`

```json
{
    "$schema": "./schemas/lineages.schema.json",
    "lineages": [
        {
            "lineageId": "ClanBorn",
            "displayName": "Clan-Born",
            "description": "The Stable Code - Descendants of survivors whose bloodlines remained untainted by the Runic Blight. Your ancestors endured through wisdom, preparation, or simple fortune.",
            "selectionText": "Your ancestors were the survivors. While others were twisted by the Blight or driven mad by the Echoes, your people endured. You are the stable foundation upon which new clans will rise.",
            "attributeModifiers": {
                "mightModifier": 0,
                "finesseModifier": 0,
                "witsModifier": 0,
                "willModifier": 0,
                "sturdinessModifier": 0,
                "hasFlexibleBonus": true,
                "flexibleBonusAmount": 1
            },
            "appearanceNotes": "Diverse and varied, reflecting the broad spectrum of humanity. No distinguishing physical markers.",
            "socialRole": "Most common lineage, often in leadership and governance positions"
        },
        {
            "lineageId": "RuneMarked",
            "displayName": "Rune-Marked",
            "description": "The Tainted Aether - Those whose blood carries the All-Rune's echo. Your ancestors were exposed to concentrated Aether during the Blight, leaving an indelible mark.",
            "selectionText": "The All-Rune's echo runs through your veins. Your ancestors breathed the corrupted Aether when the sky burned, and their children's children still bear the mark. Power flows easily to you, but at a price.",
            "attributeModifiers": {
                "mightModifier": 0,
                "finesseModifier": 0,
                "witsModifier": 0,
                "willModifier": 2,
                "sturdinessModifier": -1,
                "hasFlexibleBonus": false,
                "flexibleBonusAmount": 0
            },
            "appearanceNotes": "Often pale with luminous eyes. Faint runic patterns may appear on skin during Aether channeling.",
            "socialRole": "Valued for mystical abilities but viewed with suspicion due to Corruption"
        },
        {
            "lineageId": "IronBlooded",
            "displayName": "Iron-Blooded",
            "description": "The Corrupted Earth - Bloodlines hardened by proximity to Blight-metal. Your ancestors worked the corrupted mines and forges, their bodies adapting to the poison.",
            "selectionText": "Your blood carries the strength of the earth itself. Your ancestors worked the Dvergr forges when the metals turned foul, and their suffering became your inheritance. You are hard to break.",
            "attributeModifiers": {
                "mightModifier": 0,
                "finesseModifier": 0,
                "witsModifier": 0,
                "willModifier": -1,
                "sturdinessModifier": 2,
                "hasFlexibleBonus": false,
                "flexibleBonusAmount": 0
            },
            "appearanceNotes": "Stocky builds with slightly metallic-tinged skin. Hair often dark with iron-grey streaks.",
            "socialRole": "Valued as laborers and warriors, but seen as mentally dull by some"
        },
        {
            "lineageId": "VargrKin",
            "displayName": "Vargr-Kin",
            "description": "The Uncorrupted Echo - Those who carry the wolf-spirit's blessing. Your ancestors were Varangian shamans who bonded with primal spirits for protection.",
            "selectionText": "The wolf-spirit's blessing flows through you. Your ancestors ran with the pack when the world burned, their primal bonds shielding them from the worst of the Blight. You carry their ferocity.",
            "attributeModifiers": {
                "mightModifier": 1,
                "finesseModifier": 1,
                "witsModifier": 0,
                "willModifier": -1,
                "sturdinessModifier": 0,
                "hasFlexibleBonus": false,
                "flexibleBonusAmount": 0
            },
            "appearanceNotes": "Athletic builds with keen eyes. Hair often wild, and canine teeth slightly pronounced.",
            "socialRole": "Rangers, scouts, and hunters. Respected but considered uncivilized by settled clans"
        }
    ]
}
```

### 8.2 lineages.schema.json

**File:** `config/schemas/lineages.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "lineages.schema.json",
    "title": "Lineages Configuration",
    "description": "Defines lineage data for the character creation system",
    "type": "object",
    "required": ["lineages"],
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON schema reference"
        },
        "lineages": {
            "type": "array",
            "description": "Array of lineage definitions",
            "minItems": 4,
            "maxItems": 4,
            "items": {
                "$ref": "#/$defs/lineageDefinition"
            }
        }
    },
    "$defs": {
        "lineageDefinition": {
            "type": "object",
            "description": "Definition of a single lineage",
            "required": [
                "lineageId",
                "displayName",
                "description",
                "selectionText",
                "attributeModifiers",
                "appearanceNotes",
                "socialRole"
            ],
            "properties": {
                "lineageId": {
                    "type": "string",
                    "description": "The enum name for this lineage",
                    "enum": [
                        "ClanBorn",
                        "RuneMarked",
                        "IronBlooded",
                        "VargrKin"
                    ]
                },
                "displayName": {
                    "type": "string",
                    "description": "Display name shown in UI",
                    "minLength": 1,
                    "maxLength": 50
                },
                "description": {
                    "type": "string",
                    "description": "Full description of the lineage",
                    "minLength": 10,
                    "maxLength": 500
                },
                "selectionText": {
                    "type": "string",
                    "description": "Flavor text for character creation selection",
                    "minLength": 10,
                    "maxLength": 500
                },
                "attributeModifiers": {
                    "$ref": "#/$defs/attributeModifiers"
                },
                "appearanceNotes": {
                    "type": "string",
                    "description": "Typical physical appearance notes",
                    "minLength": 1,
                    "maxLength": 300
                },
                "socialRole": {
                    "type": "string",
                    "description": "Typical social position in society",
                    "minLength": 1,
                    "maxLength": 200
                }
            },
            "additionalProperties": false
        },
        "attributeModifiers": {
            "type": "object",
            "description": "Attribute modifiers for this lineage",
            "required": [
                "mightModifier",
                "finesseModifier",
                "witsModifier",
                "willModifier",
                "sturdinessModifier",
                "hasFlexibleBonus",
                "flexibleBonusAmount"
            ],
            "properties": {
                "mightModifier": {
                    "type": "integer",
                    "description": "Modifier to MIGHT attribute",
                    "minimum": -5,
                    "maximum": 5
                },
                "finesseModifier": {
                    "type": "integer",
                    "description": "Modifier to FINESSE attribute",
                    "minimum": -5,
                    "maximum": 5
                },
                "witsModifier": {
                    "type": "integer",
                    "description": "Modifier to WITS attribute",
                    "minimum": -5,
                    "maximum": 5
                },
                "willModifier": {
                    "type": "integer",
                    "description": "Modifier to WILL attribute",
                    "minimum": -5,
                    "maximum": 5
                },
                "sturdinessModifier": {
                    "type": "integer",
                    "description": "Modifier to STURDINESS attribute",
                    "minimum": -5,
                    "maximum": 5
                },
                "hasFlexibleBonus": {
                    "type": "boolean",
                    "description": "Whether this lineage grants a player-chosen bonus"
                },
                "flexibleBonusAmount": {
                    "type": "integer",
                    "description": "Amount of flexible bonus",
                    "minimum": 0,
                    "maximum": 5
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component           | Level       | Events                                       |
| ------------------- | ----------- | -------------------------------------------- |
| `LineageDefinition` | Debug       | Definition created, modifiers calculated     |
| `LineageProvider`   | Information | Configuration loaded, validation complete    |
| `LineageProvider`   | Debug       | Individual lineage loaded, cache access      |
| `LineageProvider`   | Warning     | Missing lineage in config, using fallback    |
| `LineageProvider`   | Error       | Configuration file not found, invalid format |

### 9.2 Structured Logging Templates

```csharp
// Debug - Definition created
_logger.LogDebug(
    "LineageDefinition created. LineageId={LineageId}, DisplayName={DisplayName}",
    lineageId,
    displayName);

// Debug - Modifier calculation
_logger.LogDebug(
    "Calculating effective modifier. Attribute={Attribute}, BaseModifier={Base}, FlexibleTarget={Target}, Result={Result}",
    attribute,
    baseModifier,
    flexibleTarget,
    result);

// Information - Flexible bonus applied
_logger.LogInformation(
    "Flexible bonus applied. Lineage={Lineage}, TargetAttribute={Attribute}, BonusAmount={Amount}",
    lineage,
    targetAttribute,
    bonusAmount);
```

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature                             | Test Count |
| ----------------------------------- | ---------- |
| Lineage enum                        | ~2         |
| LineageDefinition entity            | ~3         |
| LineageAttributeModifiers value obj | ~3         |
| **Total**                           | **~8**     |

### 10.2 Test Specifications

#### LineageTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/Enums/LineageTests.cs`

```csharp
[TestFixture]
public class LineageTests
{
    [Test]
    public void Lineage_HasFourValues_CountEquals4();

    [Test]
    public void Lineage_AllValuesHaveExpectedIntegers_ValuesMatchSpecification();

    [Test]
    public void Lineage_CanCastToInt_ReturnsCorrectValues();
}
```

#### LineageDefinitionTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/Entities/LineageDefinitionTests.cs`

```csharp
[TestFixture]
public class LineageDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_CreatesDefinition();

    [Test]
    public void Create_WithNullDisplayName_ThrowsArgumentException();

    [Test]
    public void Create_WithEmptyDescription_ThrowsArgumentException();

    [Test]
    public void RequiresFlexibleBonusSelection_ForClanBorn_ReturnsTrue();

    [Test]
    public void RequiresFlexibleBonusSelection_ForOtherLineages_ReturnsFalse();

    [Test]
    public void GetTotalFixedModifiers_ReturnsCorrectSum();
}
```

#### LineageAttributeModifiersTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/LineageAttributeModifiersTests.cs`

```csharp
[TestFixture]
public class LineageAttributeModifiersTests
{
    [Test]
    public void ClanBorn_HasFlexibleBonus_ReturnsTrue();

    [Test]
    public void RuneMarked_WillModifier_ReturnsPositiveTwo();

    [Test]
    public void IronBlooded_SturdinessModifier_ReturnsPositiveTwo();

    [Test]
    public void VargrKin_MightAndFinesseModifiers_ReturnPositiveOne();

    [Test]
    public void GetModifier_ForEachAttribute_ReturnsCorrectValue();

    [Test]
    public void GetEffectiveModifier_WithFlexibleBonus_IncludesBonus();

    [Test]
    public void GetEffectiveModifier_WithoutFlexibleBonus_ReturnsBase();

    [Test]
    public void TotalFixedModifiers_CalculatesCorrectSum();
}
```

---

## 11. Use Cases

### UC-001: Display Lineage Options

**Actor:** Character Creation UI  
**Flow:** Request all lineages → Get definitions → Display names and selection text → Show attribute modifiers

### UC-002: Get Attribute Modifiers for Lineage

**Actor:** Character Creation Service  
**Flow:** Player selects lineage → Get definition → Extract attribute modifiers → Display to player

### UC-003: Apply Clan-Born Flexible Bonus

**Actor:** Character Creation Service  
**Flow:** Player selects Clan-Born → Prompt for attribute choice → Validate selection → Apply bonus

### UC-004: Calculate Effective Attribute Modifier

**Actor:** Attribute Allocation Service  
**Flow:** Get lineage modifiers → Add base modifier → Add flexible bonus if applicable → Return total

---

## 12. User Stories

### US-001: View Lineage Selection

**As a** player creating a new character  
**I want to** see all available lineages with their descriptions  
**So that** I can make an informed choice about my character's heritage

**Acceptance Criteria:**

- All 4 lineages displayed with display name
- Selection text shown for each lineage
- Attribute modifiers clearly visible

### US-002: Understand Attribute Effects

**As a** player selecting a lineage  
**I want to** see exactly how each lineage affects my attributes  
**So that** I can choose a lineage that fits my desired playstyle

**Acceptance Criteria:**

- Positive modifiers shown in green/positive format
- Negative modifiers shown in red/negative format
- Net total modifier displayed

### US-003: Select Flexible Bonus Attribute

**As a** player who selected Clan-Born  
**I want to** choose which attribute receives my +1 bonus  
**So that** I can customize my character's strengths

**Acceptance Criteria:**

- All 5 attributes shown as options
- Only one attribute can be selected
- Confirmation required before applying

---

## 13. Deliverable Checklist

### Domain Layer

- [ ] `Lineage.cs` enum created in `src/Core/RuneAndRust.Domain/Enums/`
- [ ] `LineageDefinition.cs` entity created in `src/Core/RuneAndRust.Domain/Entities/`
- [ ] `LineageAttributeModifiers.cs` value object created in `src/Core/RuneAndRust.Domain/ValueObjects/`
- [ ] All types have complete XML documentation

### Configuration Files

- [ ] `config/lineages.json` created with all 4 lineages (partial - attributes only)
- [ ] `config/schemas/lineages.schema.json` created
- [ ] Configuration validates against schema

### Testing

- [ ] `LineageTests.cs` created
- [ ] `LineageDefinitionTests.cs` created
- [ ] `LineageAttributeModifiersTests.cs` created
- [ ] ~8 unit tests passing

### Documentation

- [ ] `v0.17.0a-changelog.md` created
- [ ] Inline code comments complete

---

## 14. Acceptance Criteria

### Functional

- [ ] `Lineage` enum defines exactly 4 lineages with values 0-3
- [ ] `LineageDefinition.Create()` validates all string parameters
- [ ] `LineageDefinition.RequiresFlexibleBonusSelection()` returns true for Clan-Born
- [ ] `LineageAttributeModifiers.GetModifier()` returns correct value per attribute
- [ ] `LineageAttributeModifiers.GetEffectiveModifier()` includes flexible bonus when applicable
- [ ] Clan-Born has `HasFlexibleBonus = true` with `FlexibleBonusAmount = 1`
- [ ] Rune-Marked has WILL +2, STURDINESS -1
- [ ] Iron-Blooded has STURDINESS +2, WILL -1
- [ ] Vargr-Kin has MIGHT +1, FINESSE +1, WILL -1

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~8 unit tests pass
- [ ] Configuration validates against JSON schema
- [ ] All public types have XML documentation

---

## 15. Dependencies

### Required from Prior Versions

| Type            | Location                         | Usage                     |
| --------------- | -------------------------------- | ------------------------- |
| `IEntity`       | `RuneAndRust.Domain/Interfaces/` | Base interface for entity |
| `CoreAttribute` | `RuneAndRust.Domain/Enums/`      | Attribute enum reference  |
| Config pattern  | Various                          | JSON loading approach     |

### Provides to v0.17.0b

| Type                        | Usage                         |
| --------------------------- | ----------------------------- |
| `Lineage`                   | Referenced by passive bonuses |
| `LineageDefinition`         | Extended with PassiveBonuses  |
| `LineageAttributeModifiers` | Used in modifier calculations |

### Provides to v0.17.0e-f

| Type                        | Usage                    |
| --------------------------- | ------------------------ |
| `Lineage`                   | Key for provider lookups |
| `LineageDefinition`         | Returned by provider     |
| `LineageAttributeModifiers` | Accessed via provider    |

---

## 16. Future Considerations

### Deferred to v0.17.0b

- **LineagePassiveBonuses Value Object**: HP, AP, Soak, Movement, Skill bonuses
- **SkillBonus Value Object**: Individual skill bonuses

### Deferred to v0.17.0c

- **LineageTrait Value Object**: Unique trait properties
- **LineageTraitEffectType Enum**: Trait effect categories

### Deferred to v0.17.0d

- **LineageTraumaBaseline Value Object**: Starting Corruption/Stress values
- **Resistance modifier integration**: Trauma Economy hooks

### Deferred to v0.17.0e-f

- **ILineageProvider Interface**: Access pattern for lineage data
- **LineageProvider Implementation**: Configuration loading
- **ILineageApplicationService**: Application of lineage effects
- **Character integration**: Applying to PlayerCharacter entity

### Out of Scope

- **Fifth+ Lineage Expansion**: Four lineages are sufficient for initial release
- **Lineage Combination**: No mixed-lineage characters planned
- **Lineage Changes Post-Creation**: Lineage is permanent

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_  
_Author: AI Assistant_
