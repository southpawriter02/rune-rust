## v0.17.1 - Background System

**Focus:** Background definitions, starting skills, starting equipment grants, and pre-Silence profession flavor

**Source Specification:** [character-creation.md](../../aethelgard/design/01-core/character-creation.md)

### Overview

This version implements the Background system that represents what the character did before the Great Silence. Background provides starting skills, starting equipment, and narrative flavor that connects the character to the pre-catastrophe world. Unlike Lineage (inherited traits) or Archetype (combat role), Background represents learned skills and accumulated possessions.

---

### Deliverables Summary

| Category | Items | Estimated Tests |
|----------|-------|-----------------|
| Enums | 1 | 2 |
| Value Objects | 3 | 4 |
| Entities | 1 | 2 |
| Services | 2 | 4 |
| **Total** | **7** | **~12** |

---

### v0.17.1a - Background Enum & Definition

#### Background Enum
```
Background
├── VillageSmith - Craft and physical tools
├── TravelingHealer - Medicine and healing supplies
├── RuinDelver - Exploration and dungeoneering gear
├── ClanGuard - Combat and defensive equipment
├── WanderingSkald - Performance and lore items
├── OutcastScavenger - Survival and wilderness gear
```

#### BackgroundDefinition Entity
```
BackgroundDefinition
├── BackgroundId: Background enum
├── DisplayName: string
├── Description: string
├── SelectionText: string (flavor text for creation UI)
├── ProfessionBefore: string (what they did pre-Silence)
├── SkillGrants: List<BackgroundSkillGrant>
├── EquipmentGrants: List<BackgroundEquipmentGrant>
├── NarrativeHooks: List<string> (potential quest hooks)
├── SocialStanding: string (how others view this background)
```

**Background Descriptions:**
| Background | Profession Before | Social Standing |
|------------|-------------------|-----------------|
| Village Smith | Blacksmith, metalworker | Respected craftsperson |
| Traveling Healer | Itinerant medicine practitioner | Welcomed but distrusted |
| Ruin Delver | Scavenger, explorer | Useful but looked down upon |
| Clan Guard | Warrior, protector | Honored defender |
| Wandering Skald | Storyteller, historian | Entertainer, keeper of lore |
| Outcast Scavenger | Exile, lone survivor | Pariah, self-reliant |

**Configuration (`backgrounds.json` - Definition Section):**
```json
{
  "backgrounds": [
    {
      "backgroundId": "VillageSmith",
      "displayName": "Village Smith",
      "description": "You worked the forge, shaping metal into tools of war and peace",
      "selectionText": "The ring of hammer on anvil was your morning song. You knew the secrets of metal, the temperatures that forge and those that destroy.",
      "professionBefore": "Blacksmith and metalworker",
      "socialStanding": "Respected craftsperson, essential to any settlement"
    },
    {
      "backgroundId": "OutcastScavenger",
      "displayName": "Outcast Scavenger",
      "description": "Cast out from your clan, you survived alone in the wastes",
      "selectionText": "They called you unclean. You called yourself alive. The wastes taught you what the clans never could—how to survive on nothing.",
      "professionBefore": "Exile and lone survivor",
      "socialStanding": "Pariah, viewed with suspicion but grudging respect for survival skills"
    }
  ]
}
```

**Unit Tests (~2):**
- [ ] Background enum has 6 values
- [ ] BackgroundDefinition loads from configuration

---

### v0.17.1b - Skill Grants

#### BackgroundSkillGrant Value Object
```
BackgroundSkillGrant
├── SkillId: string
├── BonusAmount: int
├── GrantType: SkillGrantType enum
```

#### SkillGrantType Enum
```
SkillGrantType
├── Permanent - Added to base skill value
├── StartingBonus - Applied at creation only
├── Proficiency - Unlocks skill use without penalty
```

**Skill Grants by Background:**
| Background | Primary Skill (+2) | Secondary Skill (+1) |
|------------|-------------------|---------------------|
| Village Smith | Craft | Might |
| Traveling Healer | Medicine | Herbalism |
| Ruin Delver | Exploration | Traps |
| Clan Guard | Combat | Vigilance |
| Wandering Skald | Performance | Lore |
| Outcast Scavenger | Survival | Stealth |

**Skill Grant Logic:**
```
On Background Selection:
  1. Get skill grants from BackgroundDefinition
  2. For each grant:
     a. If GrantType == Permanent:
        - Add BonusAmount to character.Skills[SkillId]
     b. If GrantType == Proficiency:
        - Add SkillId to character.ProficientSkills
  3. Log skill grants for creation summary
```

**Configuration (`backgrounds.json` - Skills Section):**
```json
{
  "backgrounds": [
    {
      "backgroundId": "VillageSmith",
      "skillGrants": [
        { "skillId": "craft", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "might", "bonusAmount": 1, "grantType": "Permanent" }
      ]
    },
    {
      "backgroundId": "RuinDelver",
      "skillGrants": [
        { "skillId": "exploration", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "traps", "bonusAmount": 1, "grantType": "Permanent" }
      ]
    }
  ]
}
```

**Unit Tests (~2):**
- [ ] Village Smith grants Craft +2, Might +1
- [ ] Skill grants apply to character correctly

---

### v0.17.1c - Equipment Grants

#### BackgroundEquipmentGrant Value Object
```
BackgroundEquipmentGrant
├── ItemId: string
├── Quantity: int
├── IsEquipped: bool (auto-equip on creation)
├── Slot: EquipmentSlot? (if auto-equipped)
```

**Equipment Grants by Background:**
| Background | Item 1 | Item 2 |
|------------|--------|--------|
| Village Smith | Smith's Hammer | Leather Apron |
| Traveling Healer | Healer's Kit | Bandages ×5 |
| Ruin Delver | Lantern | Rope, Lockpicks |
| Clan Guard | Shield | Spear |
| Wandering Skald | Instrument | Journal |
| Outcast Scavenger | Rations ×3 | Cloak |

**Equipment Grant Logic:**
```
On Background Selection:
  1. Get equipment grants from BackgroundDefinition
  2. For each grant:
     a. Create item instance with Quantity
     b. Add to character inventory
     c. If IsEquipped and Slot provided:
        - Equip item to slot
  3. Log equipment grants for creation summary
```

**Configuration (`backgrounds.json` - Equipment Section):**
```json
{
  "backgrounds": [
    {
      "backgroundId": "VillageSmith",
      "equipmentGrants": [
        { "itemId": "smiths_hammer", "quantity": 1, "isEquipped": true, "slot": "MainHand" },
        { "itemId": "leather_apron", "quantity": 1, "isEquipped": true, "slot": "Chest" }
      ]
    },
    {
      "backgroundId": "TravelingHealer",
      "equipmentGrants": [
        { "itemId": "healers_kit", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "bandages", "quantity": 5, "isEquipped": false, "slot": null }
      ]
    },
    {
      "backgroundId": "RuinDelver",
      "equipmentGrants": [
        { "itemId": "lantern", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "rope", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "lockpicks", "quantity": 1, "isEquipped": false, "slot": null }
      ]
    }
  ]
}
```

**Unit Tests (~2):**
- [ ] Clan Guard starts with Shield and Spear
- [ ] Equipment grants add items to inventory

---

### v0.17.1d - Background Provider Service

#### IBackgroundProvider Interface
```csharp
public interface IBackgroundProvider
{
    /// <summary>
    /// Gets all available background definitions.
    /// </summary>
    IReadOnlyList<BackgroundDefinition> GetAllBackgrounds();

    /// <summary>
    /// Gets a specific background by ID.
    /// </summary>
    BackgroundDefinition? GetBackground(Background backgroundId);

    /// <summary>
    /// Gets the display text for background selection UI.
    /// </summary>
    string GetSelectionText(Background backgroundId);

    /// <summary>
    /// Gets skill grants for a background.
    /// </summary>
    IReadOnlyList<BackgroundSkillGrant> GetSkillGrants(Background backgroundId);

    /// <summary>
    /// Gets equipment grants for a background.
    /// </summary>
    IReadOnlyList<BackgroundEquipmentGrant> GetEquipmentGrants(Background backgroundId);
}
```

**Provider Implementation:**
```csharp
public class BackgroundProvider : IBackgroundProvider
{
    private readonly Dictionary<Background, BackgroundDefinition> _backgrounds;

    public BackgroundProvider(IConfiguration configuration)
    {
        _backgrounds = LoadFromConfiguration(configuration);
    }

    public IReadOnlyList<BackgroundDefinition> GetAllBackgrounds()
        => _backgrounds.Values.ToList();

    public BackgroundDefinition? GetBackground(Background backgroundId)
        => _backgrounds.TryGetValue(backgroundId, out var def) ? def : null;
}
```

**Unit Tests (~2):**
- [ ] GetAllBackgrounds returns 6 backgrounds
- [ ] GetBackground returns correct definition

---

### v0.17.1e - Background Application Service

#### IBackgroundApplicationService Interface
```csharp
public interface IBackgroundApplicationService
{
    /// <summary>
    /// Applies background grants to a character during creation.
    /// </summary>
    BackgroundApplicationResult ApplyBackgroundToCharacter(
        PlayerCharacter character,
        Background background);

    /// <summary>
    /// Gets a preview of what the background will grant.
    /// </summary>
    BackgroundPreview GetBackgroundPreview(Background background);

    /// <summary>
    /// Validates that a background can be applied.
    /// </summary>
    bool CanApplyBackground(Background background);
}
```

#### BackgroundApplicationResult Value Object
```
BackgroundApplicationResult
├── Success: bool
├── SkillsGranted: List<(string SkillId, int Amount)>
├── EquipmentGranted: List<(string ItemId, int Quantity)>
├── Messages: List<string>
```

#### BackgroundPreview Value Object
```
BackgroundPreview
├── DisplayName: string
├── Description: string
├── SkillSummary: string (e.g., "Craft +2, Might +1")
├── EquipmentSummary: string (e.g., "Smith's Hammer, Leather Apron")
```

**Application Logic:**
```
ApplyBackgroundToCharacter(character, background):
  1. Get background definition
  2. Apply skill grants:
     For each skillGrant in definition.SkillGrants:
       - character.AddSkillBonus(skillGrant.SkillId, skillGrant.BonusAmount)
  3. Apply equipment grants:
     For each equipmentGrant in definition.EquipmentGrants:
       - item = itemService.CreateItem(equipmentGrant.ItemId, equipmentGrant.Quantity)
       - character.Inventory.Add(item)
       - If equipmentGrant.IsEquipped:
         - character.EquipItem(item, equipmentGrant.Slot)
  4. Return result with summaries
```

**Unit Tests (~2):**
- [ ] ApplyBackgroundToCharacter grants skills correctly
- [ ] ApplyBackgroundToCharacter grants equipment correctly

---

### Configuration Files

| File | Purpose |
|------|---------|
| `backgrounds.json` | Complete background definitions |

**Complete Configuration Example:**
```json
{
  "backgrounds": [
    {
      "backgroundId": "VillageSmith",
      "displayName": "Village Smith",
      "description": "You worked the forge, shaping metal into tools of war and peace",
      "selectionText": "The ring of hammer on anvil was your morning song. You knew the secrets of metal, the temperatures that forge and those that destroy.",
      "professionBefore": "Blacksmith and metalworker",
      "socialStanding": "Respected craftsperson, essential to any settlement",
      "skillGrants": [
        { "skillId": "craft", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "might", "bonusAmount": 1, "grantType": "Permanent" }
      ],
      "equipmentGrants": [
        { "itemId": "smiths_hammer", "quantity": 1, "isEquipped": true, "slot": "MainHand" },
        { "itemId": "leather_apron", "quantity": 1, "isEquipped": true, "slot": "Chest" }
      ],
      "narrativeHooks": [
        "Recognize craftsmanship in ruins",
        "Repair broken equipment more easily",
        "Clan smiths may offer discounts or quests"
      ]
    },
    {
      "backgroundId": "TravelingHealer",
      "displayName": "Traveling Healer",
      "description": "You walked between settlements, bringing medicine and hope",
      "selectionText": "You learned the old ways—which herbs heal, which kill, and which do both. The sick blessed you; the superstitious cursed you.",
      "professionBefore": "Itinerant medicine practitioner",
      "socialStanding": "Welcomed but sometimes distrusted",
      "skillGrants": [
        { "skillId": "medicine", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "herbalism", "bonusAmount": 1, "grantType": "Permanent" }
      ],
      "equipmentGrants": [
        { "itemId": "healers_kit", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "bandages", "quantity": 5, "isEquipped": false, "slot": null }
      ],
      "narrativeHooks": [
        "Recognize diseases and their cures",
        "Bone-Setters may share knowledge",
        "Some view you with superstitious fear"
      ]
    },
    {
      "backgroundId": "RuinDelver",
      "displayName": "Ruin Delver",
      "description": "The old places called to you, their secrets waiting to be found",
      "selectionText": "While others feared the dark places, you saw opportunity. Every ruin is a puzzle, every trap a challenge.",
      "professionBefore": "Scavenger and explorer",
      "socialStanding": "Useful but looked down upon",
      "skillGrants": [
        { "skillId": "exploration", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "traps", "bonusAmount": 1, "grantType": "Permanent" }
      ],
      "equipmentGrants": [
        { "itemId": "lantern", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "rope", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "lockpicks", "quantity": 1, "isEquipped": false, "slot": null }
      ],
      "narrativeHooks": [
        "Know ruin layouts and hazards",
        "Scrap-Tinkers respect your finds",
        "May have enemies among rival delvers"
      ]
    },
    {
      "backgroundId": "ClanGuard",
      "displayName": "Clan Guard",
      "description": "You stood on the walls, shield in hand, protecting your people",
      "selectionText": "The weight of the shield, the length of the spear—these were your teachers. You learned that walls mean nothing without warriors to defend them.",
      "professionBefore": "Warrior and protector",
      "socialStanding": "Honored defender, trusted by clan leadership",
      "skillGrants": [
        { "skillId": "combat", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "vigilance", "bonusAmount": 1, "grantType": "Permanent" }
      ],
      "equipmentGrants": [
        { "itemId": "shield", "quantity": 1, "isEquipped": true, "slot": "OffHand" },
        { "itemId": "spear", "quantity": 1, "isEquipped": true, "slot": "MainHand" }
      ],
      "narrativeHooks": [
        "Recognize military formations and tactics",
        "Other guards trust you more quickly",
        "May have oaths to uphold or avenge"
      ]
    },
    {
      "backgroundId": "WanderingSkald",
      "displayName": "Wandering Skald",
      "description": "You carried the stories, the songs, the memories of what was",
      "selectionText": "In a world that has forgotten so much, you remember. The sagas live in your voice, and through you, the old heroes never truly die.",
      "professionBefore": "Storyteller and historian",
      "socialStanding": "Entertainer, keeper of lore, welcome at most hearths",
      "skillGrants": [
        { "skillId": "performance", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "lore", "bonusAmount": 1, "grantType": "Permanent" }
      ],
      "equipmentGrants": [
        { "itemId": "instrument", "quantity": 1, "isEquipped": false, "slot": null },
        { "itemId": "journal", "quantity": 1, "isEquipped": false, "slot": null }
      ],
      "narrativeHooks": [
        "Know old legends that hold clues",
        "Earn room and board through performance",
        "Jötun-Readers value your historical knowledge"
      ]
    },
    {
      "backgroundId": "OutcastScavenger",
      "displayName": "Outcast Scavenger",
      "description": "Cast out and alone, you learned to survive where others would perish",
      "selectionText": "They called you unclean. You called yourself alive. The wastes taught you what the clans never could—how to survive on nothing.",
      "professionBefore": "Exile and lone survivor",
      "socialStanding": "Pariah, viewed with suspicion but grudging respect",
      "skillGrants": [
        { "skillId": "survival", "bonusAmount": 2, "grantType": "Permanent" },
        { "skillId": "stealth", "bonusAmount": 1, "grantType": "Permanent" }
      ],
      "equipmentGrants": [
        { "itemId": "rations", "quantity": 3, "isEquipped": false, "slot": null },
        { "itemId": "cloak", "quantity": 1, "isEquipped": true, "slot": "Back" }
      ],
      "narrativeHooks": [
        "Know the wasteland's secrets and dangers",
        "Other outcasts may offer aid",
        "Clans may remember why you were cast out"
      ]
    }
  ]
}
```

---

### Dependencies

**Requires:**
- v0.4.x-v0.5.x: Item/equipment system (for equipment grants)
- Skill system (for skill grants)
- Inventory system (for adding items)

**Provides to:**
- v0.17.5: Background selection step in workflow
- Character sheet: Starting skills and equipment
- Narrative system: Quest hooks and dialogue options

---

### Acceptance Criteria

- [ ] Background enum has 6 values
- [ ] Each background has skill grants (primary +2, secondary +1)
- [ ] Each background has equipment grants
- [ ] Village Smith grants Craft +2, Might +1, Smith's Hammer, Leather Apron
- [ ] Traveling Healer grants Medicine +2, Herbalism +1, Healer's Kit, Bandages ×5
- [ ] Ruin Delver grants Exploration +2, Traps +1, Lantern, Rope, Lockpicks
- [ ] Clan Guard grants Combat +2, Vigilance +1, Shield, Spear
- [ ] Wandering Skald grants Performance +2, Lore +1, Instrument, Journal
- [ ] Outcast Scavenger grants Survival +2, Stealth +1, Rations ×3, Cloak
- [ ] Skills apply to character correctly
- [ ] Equipment added to inventory correctly
- [ ] Auto-equipped items are equipped correctly
- [ ] ~12 unit tests pass
