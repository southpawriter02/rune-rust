# v0.0.7b Changelog - Weapon System

**Date:** 2026-01-08

## Added

### Domain Layer - Enums
- `WeaponType` enum: Sword, Axe, Dagger, Staff
  - Full XML documentation with weapon type characteristics

### Domain Layer - Value Objects
- `WeaponBonuses` record struct for weapon-specific stat bonuses
  - Properties: Might, Fortitude, Will, Wits, Finesse, AttackModifier
  - `HasBonuses` computed property
  - Factory methods: `None`, `ForFinesse()`, `ForWill()`, `ForAttack()`
  - `ToString()` for formatted bonus display

### Domain Layer - Entities (Modified)
- `Item` entity enhancements:
  - `DamageDice` property (string notation, e.g., "1d8")
  - `WeaponType?` property (nullable for non-weapon items)
  - `WeaponBonuses` property with default `None`
  - `IsWeapon` computed property
  - `GetDamageDicePool()` method for combat calculations
  - Updated constructor with weapon parameters
  - Updated `CreateSword()` factory with damage dice and weapon type
  - New factories: `CreateIronSword()`, `CreateBattleAxe()`, `CreateSteelDagger()`, `CreateOakStaff()`

### Domain Layer - Services (Modified)
- `CombatService` enhancements:
  - `UnarmedDamageDice` static field (1d4)
  - `DefaultWeaponDice` static field (1d6 fallback)
  - `GetPlayerDamageDice(Player)` method - returns weapon dice or unarmed
  - `GetPlayerWeaponName(Player)` method - returns weapon name or "fists"
  - `GetWeaponAttackModifier(Player)` method - returns attack modifier from weapon
  - `GetWeaponBonuses(Player)` method - returns weapon stat bonuses
  - `GetPlayerDamagePool()` now uses equipped weapon's damage dice
  - `ResolvePlayerAttack()` now includes weapon attack modifier and bonuses

### Application Layer - DTOs
- `WeaponDto` for displaying weapon information
  - Properties: Name, WeaponType, DamageDice, Description, Bonuses
  - Factory method: `FromItem()` - returns null for non-weapons

### Configuration
- `config/weapons.json` with 9 weapon definitions:
  - Rusty Sword, Iron Sword, Steel Sword (Sword type)
  - Battle Axe, Great Axe (Axe type with attack penalties)
  - Steel Dagger, Assassin's Blade (Dagger type with Finesse bonus)
  - Oak Staff, Arcane Staff (Staff type with Will bonus)

## Tests Added

| Test File | Count |
|-----------|-------|
| `WeaponTypeTests.cs` | 3 |
| `WeaponBonusesTests.cs` | 8 |
| `ItemWeaponTests.cs` | 8 |
| `CombatServiceWeaponTests.cs` | 11 |
| **Total New** | 30 |

## Test Results

```
Domain Tests:      316 passed (+38)
Application Tests: 117 passed
Architecture Tests:  8 passed
Total:             441 passed
```

## Combat System Changes

### Weapon-Based Damage
- Equipped weapons now use their damage dice in combat
- Unarmed combat uses 1d4 damage (incentivizes weapons)
- Critical hits double the weapon's damage dice

### Weapon Bonuses
- Weapons can provide stat bonuses when equipped:
  - Daggers: +Finesse for hit rolls
  - Staffs: +Will for magic
  - Axes: -Attack modifier (harder to hit, more damage)
- Weapon bonuses are added to effective stats during combat

### Attack Roll Formula (Updated)
```
Attack Total = 1d10 + Finesse + Weapon Finesse Bonus + Weapon Attack Modifier
```

### Damage Roll Formula (Updated)
```
Damage = Weapon Dice + Might + Weapon Might Bonus - (Monster Defense / 2)
```

## v0.0.7b Complete

This establishes the weapon system:
- 4 weapon types with distinct characteristics
- Weapons have damage dice parsed via DicePool.Parse()
- Combat uses equipped weapon's damage dice
- Unarmed combat supported with reduced damage
- Weapon bonuses affect combat calculations
- Ready for v0.0.7c: Armor & Stat Modifiers
