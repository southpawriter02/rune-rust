> **Archived** - This plan has been consolidated. See the complete version at [v0.3.17](../v0.3.x/v0.3.17.md).

Here is the comprehensive implementation plan for **v0.3.17b: The Toolbox (Cheat Commands)**.

This sub-version implements the logic engine for developer cheats. While v0.3.17a provided the UI to type commands, this version connects those strings to actual game state mutations, allowing for rapid testing and debugging of gameplay systems.

\--------------------------------------------------------------------------------

**v0.3.17b: The Toolbox (Cheat Commands)**

**Goal:** Implement `CheatService` and `DebugCommandParser` to interpret and execute slash-commands that bypass standard gameplay rules (healing, teleporting, spawning items, and invincibility).

\--------------------------------------------------------------------------------

**1\. Architecture & Data Flow**

**The Cheat Pipeline**

1. **Input:** User types `/command args` in the Debug Console (v0.3.17a).

2. **Routing:** `DebugConsoleService` detects the slash prefix and passes the string to `DebugCommandParser`.

3. **Parsing:** The parser identifies the verb (e.g., `spawn`) and arguments (e.g., `iron-sword`, `5`).

4. **Execution:** The parser calls the specific method in `CheatService`.

5. **State Mutation:** `CheatService` directly modifies `GameState` or calls other services (like `InventoryService`) with bypassed validation.

6. **Feedback:** Success/Failure messages are written back to the Debug Console log.

\--------------------------------------------------------------------------------

**2\. Logic Decision Trees**

**A. Command Parsing Logic** *Input: Raw String (e.g., "/tp room\_05")*

1. **Sanitize:** Trim whitespace, remove `/` prefix.

2. **Tokenize:** Split by space. `[verb, arg1, arg2...]`.

3. **Route:** Switch on `verb`:

    ◦ `god` -\> Toggle God Mode.

    ◦ `heal` -\> Restore Stats & Clear Status.

    ◦ `tp` -\> Validate Room ID -\> Move.

    ◦ `spawn` -\> Validate Item ID -\> Add to Inventory.

    ◦ `reveal` -\> Add all Room IDs to Visited List.

    ◦ *Default:* Return "Unknown Command".

**B. Teleportation Logic (****/tp****)** *Input: Room ID String*

1. **Search:** Does `RoomRepository` contain a room with this ID (fuzzy or exact match)?

    ◦ *No:* Return Error "Room not found".

2. **Update State:** Set `GameState.CurrentRoomId` = Target ID.

3. **Refresh:** Clear current UI context. Call `NavigationService.LookAsync()` to render new location.

4. **Log:** "Teleported to {RoomName}".

\--------------------------------------------------------------------------------

**3\. Deliverable Checklist**

• **Core:**

    ◦ \[ \] Add `bool IsGodMode` to `GameState`.

    ◦ \[ \] Define `ICheatService` interface.

• **Engine:**

    ◦ \[ \] Implement `CheatService` (The logic provider).

    ◦ \[ \] Implement `DebugCommandParser` (The text interpreter).

    ◦ \[ \] Update `AttackResolutionService` to check `IsGodMode` (prevent damage).

    ◦ \[ \] Update `TraumaService` to check `IsGodMode` (prevent stress/corruption).

• **Terminal:**

    ◦ \[ \] Wire `DebugConsoleService` to use `DebugCommandParser`.

\--------------------------------------------------------------------------------

**4\. Code Implementation**

**A. The Cheat Service (****RuneAndRust.Engine/Services/CheatService.cs****)**

    public class CheatService : ICheatService
    {
        private readonly GameState _state;
        private readonly IInventoryService _inventory;
        private readonly IRoomRepository _roomRepo;
        private readonly IStatusEffectService _statusEffects;

        public void ToggleGodMode()
        {
            _state.IsGodMode = !_state.IsGodMode;
        }

        public void FullHeal()
        {
            if (_state.CurrentCharacter == null) return;

            var char = _state.CurrentCharacter;
            char.CurrentHP = char.MaxHP;
            char.CurrentStamina = char.MaxStamina;
            char.CurrentAp = char.MaxAp;
            char.PsychicStress = 0;

            // Remove all negative status effects
            _statusEffects.ClearAllEffects(Combatant.FromCharacter(char));
        }

        public async Task<bool> TeleportAsync(string roomId)
        {
            var room = await _roomRepo.GetByIdAsync(Guid.Parse(roomId)); // Simplified lookup
            if (room == null) return false;

            _state.CurrentRoomId = room.Id;
            _state.TurnCount++; // Teleport takes a "turn" to refresh state
            return true;
        }
    }


**B. The Parser (****RuneAndRust.Engine/Services/DebugCommandParser.cs****)**

    public class DebugCommandParser
    {
        private readonly ICheatService _cheats;
        private readonly IDebugConsoleService _console;

        public async Task ExecuteAsync(string input)
        {
            var args = input.TrimStart('/').Split(' ');
            var command = args.ToLower();

            try
            {
                switch (command)
                {
                    case "heal":
                        _cheats.FullHeal();
                        _console.WriteLog("Character fully restored.", "Cheat");
                        break;
                    case "god":
                        _cheats.ToggleGodMode();
                        _console.WriteLog("God Mode toggled.", "Cheat");
                        break;
                    case "tp":
                        if (args.Length < 2) throw new ArgumentException("Missing Room ID");
                        var success = await _cheats.TeleportAsync(args[1]);
                        _console.WriteLog(success ? $"Teleported to {args[1]}" : "Room not found.", "Cheat");
                        break;
                    default:
                        _console.WriteLog($"Unknown command: {command}", "Error");
                        break;
                }
            }
            catch (Exception ex)
            {
                _console.WriteLog($"Execution failed: {ex.Message}", "Error");
            }
        }
    }


\--------------------------------------------------------------------------------

**5\. Logging Requirements**

These logs are internal to the Debug Console but should also be mirrored to Serilog for session diagnostics (to identify runs where cheats were used).

System

Event

Level

Message Template

Properties

**Cheat**

Execute

Warning

"\[Cheat\] Command executed: {Input}"

Input

**Cheat**

GodMode

Warning

"\[Cheat\] God Mode set to: {State}"

State

**Cheat**

Spawn

Warning

"\[Cheat\] Spawned {Quantity}x {ItemId}"

Quantity, ItemId

\--------------------------------------------------------------------------------

**6\. Testing Strategy**

**Unit Tests (****CheatServiceTests.cs****):**

• **Heal\_RestoresAllStats:** Damage character -\> Call `FullHeal` -\> Assert HP == MaxHP.

• **GodMode\_Toggles:** Assert `false` -\> Toggle -\> `true` -\> Toggle -\> `false`.

**Integration Tests (****CheatIntegrationTests.cs****):**

• **Attack\_GodMode\_NoDamage:**

    ◦ Enable God Mode.

    ◦ Simulate enemy attack (10 dmg).

    ◦ Assert Player HP unchanged.

• **Teleport\_UpdatesLocation:**

    ◦ Call `/tp [RoomID]`.

    ◦ Assert `GameState.CurrentRoomId` equals \[RoomID\].

\--------------------------------------------------------------------------------

**7\. Draft Changelog (v0.3.17b)**

    # v0.3.17b Changelog: The Toolbox
    **Release Date:** 2026-03-08

    ## Summary
    This release implements the functional logic for the Developer Debug Tools. "The Toolbox" provides a suite of commands to manipulate game state, essential for testing late-game content, verifying room layouts, and debugging combat math.

    ## New Features
    *   **God Mode:** `/god` toggles invulnerability to Damage, Stress, and Corruption.
    *   **Full Heal:** `/heal` restores HP/Stamina/AP to max and cures all negative status effects.
    *   **Teleportation:** `/tp [RoomId]` allows instant travel to any valid room GUID.
    *   **Item Spawning:** `/spawn [ItemId] [Qty]` injects items directly into inventory.
    *   **Map Reveal:** `/reveal` clears the Fog of War for the current level (or all levels).

    ## Technical Changes
    *   Added `ICheatService` and `CheatService`.
    *   Integrated `DebugCommandParser` with the Console Overlay.
    *   Updated `AttackResolutionService` to respect `GameState.IsGodMode`.
