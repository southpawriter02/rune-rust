> **Archived** - This changelog has been consolidated. See the complete version at [v0.3.4](../v0.3.x/v0.3.4.md).

# Changelog: v0.3.4a - The Facade (Visuals & Menu)

**Release Date:** 2025-12-21

## Summary

This release implements the title screen and main menu system for Rune & Rust. The TitleScreenService displays an animated ASCII title logo with Elder Futhark rune glitch effects using Spectre.Console's `AnsiConsole.Live()` for smooth real-time animation. The main menu offers four options: New Game, Load Game, Options, and Quit. New Game triggers the CharacterCreationController, Load Game retrieves the most recent save via SaveManager.LoadGameAsync(), Options displays a placeholder message, and Quit exits the application. The TitleScreenResult model encapsulates menu selection with factory methods for each option. MainMenuOption enum provides strongly-typed menu choices. Program.cs has been refactored to display the title screen before entering the game loop, with proper routing based on user selection. This release includes 14 unit tests validating the TitleScreenResult factory methods and MainMenuOption enum values.

---

## New Files Created

### Core Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/MainMenuOption.cs` | Enum for main menu choices: NewGame, LoadGame, Options, Quit |
| `RuneAndRust.Core/Models/TitleScreenResult.cs` | Result model encapsulating menu selection with factory methods |
| `RuneAndRust.Core/Interfaces/ITitleScreenService.cs` | Interface defining ShowAsync() for title screen display |

### Terminal Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Terminal/Services/TitleScreenService.cs` | Animated title screen with Elder Futhark glitch effects and menu |

### Test Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Tests/Terminal/TitleScreenServiceTests.cs` | 14 unit tests for TitleScreenResult and MainMenuOption |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Terminal/Program.cs` | Added ITitleScreenService registration, title screen display before game loop, menu routing for NewGame/LoadGame/Quit, updated version to v0.3.4a |

---

## Code Implementation Details

### MainMenuOption Enum

```csharp
namespace RuneAndRust.Core.Enums;

public enum MainMenuOption
{
    NewGame = 0,
    LoadGame = 1,
    Options = 2,
    Quit = 3
}
```

### TitleScreenResult Model

**Factory Methods:**
```csharp
public static TitleScreenResult CreateNewGame() =>
    new() { SelectedOption = MainMenuOption.NewGame };

public static TitleScreenResult LoadGame(int slotNumber) =>
    new() { SelectedOption = MainMenuOption.LoadGame, SaveSlotNumber = slotNumber };

public static TitleScreenResult Quit() =>
    new() { SelectedOption = MainMenuOption.Quit };
```

**Usage:**
- Private constructor ensures creation only through factory methods
- SaveSlotNumber is nullable, only set for LoadGame selections
- Immutable after creation (private init properties)

### TitleScreenService Animation

**Glitch Effect Characters:**
```csharp
private static readonly char[] GlitchChars = { 'ᚠ', 'ᚢ', 'ᚦ', 'ᚨ', 'ᚱ', 'ᚾ', 'ᛖ', '▓', '░', '▒' };
```

**Animation Parameters:**
- 15 glitch iterations
- 80ms delay between frames
- 3% probability of character replacement per non-whitespace character

**Live Animation:**
```csharp
await AnsiConsole.Live(new Markup(""))
    .StartAsync(async ctx =>
    {
        for (int i = 0; i < GlitchIterations; i++)
        {
            var glitched = ApplyGlitchEffect(lines);
            var panel = new Panel(new Markup($"[red]{Markup.Escape(glitched)}[/]"))
                .Border(BoxBorder.None);
            ctx.UpdateTarget(panel);
            await Task.Delay(GlitchDelayMs);
        }
    });
```

### Program.cs Menu Routing

```csharp
switch (menuResult.SelectedOption)
{
    case MainMenuOption.Quit:
        AnsiConsole.MarkupLine("[grey]Farewell, Traveler...[/]");
        return;

    case MainMenuOption.NewGame:
        using (var scope = host.Services.CreateScope())
        {
            var creation = scope.ServiceProvider.GetRequiredService<CharacterCreationController>();
            creation.RunCreationWizardAsync().GetAwaiter().GetResult();
        }
        break;

    case MainMenuOption.LoadGame:
        if (menuResult.SaveSlotNumber.HasValue)
        {
            using (var scope = host.Services.CreateScope())
            {
                var saveManager = scope.ServiceProvider.GetRequiredService<SaveManager>();
                var gameState = scope.ServiceProvider.GetRequiredService<GameState>();
                var loadedState = saveManager.LoadGameAsync(menuResult.SaveSlotNumber.Value).GetAwaiter().GetResult();
                if (loadedState != null)
                {
                    gameState.CurrentCharacter = loadedState.CurrentCharacter;
                    gameState.CurrentRoomId = loadedState.CurrentRoomId;
                    gameState.Phase = loadedState.Phase;
                    gameState.TurnCount = loadedState.TurnCount;
                }
            }
        }
        break;
}
```

---

## ASCII Title Art

```
╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║   ██████╗ ██╗   ██╗███╗   ██╗███████╗                             ║
║   ██╔══██╗██║   ██║████╗  ██║██╔════╝                             ║
║   ██████╔╝██║   ██║██╔██╗ ██║█████╗                               ║
║   ██╔══██╗██║   ██║██║╚██╗██║██╔══╝                               ║
║   ██║  ██║╚██████╔╝██║ ╚████║███████╗                             ║
║   ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚══════╝                             ║
║                           ▲                                       ║
║                          ╱ ╲                                      ║
║   ██████╗ ██╗   ██╗███████╗████████╗                              ║
║   ██╔══██╗██║   ██║██╔════╝╚══██╔══╝                              ║
║   ██████╔╝██║   ██║███████╗   ██║                                 ║
║   ██╔══██╗██║   ██║╚════██║   ██║                                 ║
║   ██║  ██║╚██████╔╝███████║   ██║                                 ║
║   ╚═╝  ╚═╝ ╚═════╝ ╚══════╝   ╚═╝                                 ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝
```

---

## Test Coverage

### TitleScreenServiceTests (14 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateNewGame_ReturnsNewGameOption` | Verifies CreateNewGame returns NewGame option |
| `CreateNewGame_HasNoSaveSlotNumber` | Verifies CreateNewGame has null SaveSlotNumber |
| `LoadGame_ReturnsLoadGameOption` | Verifies LoadGame returns LoadGame option |
| `LoadGame_ContainsSaveSlotNumber` | Verifies LoadGame stores provided slot number |
| `Quit_ReturnsQuitOption` | Verifies Quit returns Quit option |
| `Quit_HasNoSaveSlotNumber` | Verifies Quit has null SaveSlotNumber |
| `MainMenuOption_HasFourValues` | Verifies enum has exactly 4 values |
| `MainMenuOption_HasCorrectValues` | Theory test validating each enum value |
| `MainMenuOption_AllValuesAreDistinct` | Verifies no duplicate enum values |
| `TitleScreenResult_LoadGame_PreservesSlotNumber` | Verifies slot number immutability |
| `TitleScreenResult_MultipleCalls_ReturnIndependentInstances` | Verifies factory creates new instances |

---

## Logging Matrix

| Context | Level | Template |
|---------|-------|----------|
| Title Screen Display | Info | `"[TitleScreen] Displaying title screen"` |
| New Game Selected | Info | `"[TitleScreen] User selected New Game"` |
| Load Game Selected | Info | `"[TitleScreen] User selected Load Game: Slot {SlotNumber}"` |
| Quit Selected | Info | `"[TitleScreen] User selected Quit"` |

---

## Dependencies

- `Spectre.Console` - AnsiConsole.Live() for animation, SelectionPrompt for menu
- `Microsoft.Extensions.Logging` - Structured logging
- `RuneAndRust.Core.Interfaces.ISaveGameRepository` - Save game lookup

---

## Notes

- Options menu is stubbed (displays message, returns to menu) - full implementation planned for v0.3.4c
- Load Game automatically selects most recent save by LastPlayed timestamp - save selection UI deferred
- Elder Futhark runes provide thematic "corrupted data" visual effect during animation
- Version string updated to v0.3.4a in boot message and title screen
