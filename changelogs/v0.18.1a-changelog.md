# Changelog: v0.18.1a - Corruption Enums & State

**Release Date:** 2026-01-31
**Phase:** Runic Blight Corruption (1/5)
**Status:** Complete

---

## Overview

Implements the foundational domain types for the Runic Blight Corruption system — the enum and value object that track a character's physical and spiritual contamination from exposure to corrupted runic energies. This is the first phase of v0.18.1 (Runic Blight Corruption), establishing the **Corruption State Pattern** that parallels the Stress State Pattern from v0.18.0a.

One enum defines corruption stage classification (`CorruptionStage`) with six progressive tiers from Uncorrupted to Consumed. One value object (`CorruptionState`) encapsulates the corruption value with computed properties including stage determination, percentage to consumption, mutation risk flags, and mutation check triggers.

Unlike Psychic Stress (mental strain that is recoverable through rest), Corruption represents near-permanent physical/spiritual contamination — the second pillar of the Trauma Economy.

---

## Added

### Domain Layer — Enums

- **`CorruptionStage`** (`Domain/Enums/CorruptionStage.cs`)
    - 6-stage enum: Uncorrupted (0-19), Tainted (20-39), Infected (40-59), Blighted (60-79), Corrupted (80-99), Consumed (100)
    - Explicit integer values (0-5) for stable serialization
    - Comprehensive XML documentation per value with corruption ranges, mechanical effects, and narrative descriptions
    - Internal `═══` section separator following StressThreshold pattern

### Domain Layer — Value Objects

- **`CorruptionState`** (`Domain/ValueObjects/CorruptionState.cs`)
    - `readonly record struct` with private constructor enforcing factory pattern
    - Constants: `MinCorruption = 0`, `MaxCorruption = 100`, `TaintedThreshold = 20`, `InfectedThreshold = 40`, `BlightedThreshold = 60`, `CorruptedThreshold = 80`, `ConsumedThreshold = 100`
    - Stored property: `CurrentCorruption` (clamped 0-100)
    - Computed in constructor: `Stage`, `PercentageToConsumption`, `RequiresMutationCheck`, `HasMutationRisk`
    - Arrow-expression properties: `IsUncorrupted`, `IsConsumed`
    - Factory: `Create(int)`, static `Uncorrupted`
    - Static method: `DetermineStage(int)` — public for external callers
    - `ToString()`: `"Corruption: {CurrentCorruption}/{MaxCorruption} [{Stage}]"` with optional `[MUTATION CHECK REQUIRED]` or `[Mutation Risk]` suffixes

### Unit Tests

- **`CorruptionStageTests`** (`Enums/CorruptionStageTests.cs`) — 2 test methods
    - `CorruptionStage_HasExpectedValues` — verifies all 6 integer assignments (0-5)
    - `CorruptionStage_HasCorrectCount` — verifies exactly 6 enum values exist

- **`CorruptionStateTests`** (`ValueObjects/CorruptionStateTests.cs`) — 19 test methods
    - Factory — Create: `Create_StoresValidValue`, `Create_ClampsNegativeToZero`, `Create_ClampsAbove100`
    - Factory — Create boundary: `Create_WithValidCorruption_ReturnsCorrectStage` — 11 boundary cases (0,19,20,39,40,59,60,79,80,99,100)
    - Factory — Create clamping: `Create_WithOutOfRangeCorruption_ClampsToValidRange` — 4 cases (-10→0, -1→0, 101→100, 150→100)
    - Factory — Uncorrupted: `Uncorrupted_ReturnsZeroCorruptionState`
    - Computed — PercentageToConsumption: 3 cases (0→0.0, 50→0.5, 100→1.0) + 4 threshold boundary cases (20→0.2, 40→0.4, 60→0.6, 80→0.8)
    - Computed — HasMutationRisk: 4 cases (79→false, 80→true, 99→true, 100→true)
    - Computed — RequiresMutationCheck: 3 cases (99→false, 100→true, 150→true)
    - Arrow — IsUncorrupted: 4 cases (0→true, 19→true, 20→false, 50→false)
    - Arrow — IsConsumed: 4 cases (0→false, 50→false, 99→false, 100→true)
    - Static — DetermineStage: 11 boundary cases matching Create boundary tests
    - ToString: 4 tests (normal, consumed/mutation check, mutation risk, zero corruption)

### Glossary

- **`config/glossary.json`** — Added 2 glossary entries (sortOrder 90-91)
    - `corruption-stage`: Enum defining six corruption stages from Uncorrupted to Consumed with mutation risk thresholds
    - `corruption-state`: Immutable value object tracking corruption level with mutation risk flags and stage determination

---

## Changed

### Documentation

- **`docs/design/v0.18.x/v0.18.1-scope-breakdown.md`** — Checked off v0.18.1a acceptance criteria
- **`docs/design/v0.18.x/v0.18.1a-design-specification.md`** — Checked off deliverable and acceptance criteria items

---

## Design Decisions

### Private Constructor Pattern Instead of Private Init

The design specification uses `{ get; private init; }` with an inline object initializer in `Create()`. The actual `StressState` pattern uses `{ get; }` (read-only) properties set in a private constructor with `Math.Clamp`. The private constructor pattern was followed for consistency with the established codebase convention.

### Section Separators Instead of #region Directives

The design specification uses `#region` / `#endregion` blocks. The codebase convention (established in `StressState.cs` and all other v0.18.0 files) uses `═══` comment line separators with ALL-CAPS section headers. Codebase convention was followed.

### Arrow-Expression Properties Added

The design specification defines `IsUncorrupted` and `IsConsumed` as arrow-expression properties, but does not include them in the value object code listing. They were added following the `StressState` pattern which has `IsCalm` and `IsBreaking` as arrow properties — `IsUncorrupted` parallels `IsCalm` and `IsConsumed` parallels `IsBreaking`.

### No Mutation Methods

Unlike `StressState` which includes `WithStress()`, `WithStressAdded()`, and `WithStressReduced()` mutation methods, `CorruptionState` does not include mutation methods. This is intentional — the design specification does not define them, and corruption mutation logic belongs to the service layer (v0.18.1d) due to the near-permanent nature of corruption.

### DetermineStage as Public Static Method

The design specification explicitly includes `DetermineStage` as a public static method on `CorruptionState`. In `StressState`, the equivalent logic lives in `StressThresholdExtensions.FromStressValue()`. Since v0.18.1a has no extensions file, `DetermineStage` remains on the value object as specified, providing a useful public API for external callers.

### Test Count Expansion

The design specification estimated ~4 tests (one for the enum, three for the value object). The implementation includes 21 test methods across 2 test files (58 individual test case executions), consistent with v0.18.0a's pattern where ~4 estimated tests became 66 actual test methods. The expanded coverage includes all 11 threshold boundary conditions, clamping edge cases, all computed property variations, arrow property boundary tests, static method verification, and ToString formatting.

---

## Dependencies

### Prerequisites

| Type | Phase | Usage |
| --- | --- | --- |
| `StressThreshold` | v0.18.0a | Pattern reference for CorruptionStage enum structure |
| `StressState` | v0.18.0a | Pattern reference for CorruptionState value object structure |

### Provides to Future Phases

| Type | Phase | Usage |
| --- | --- | --- |
| `CorruptionStage` | v0.18.1b | Used by CorruptionApplicationResult, CorruptionCheckResult |
| `CorruptionState` | v0.18.1c | Return type for ICorruptionService.GetCorruptionState |
| `CorruptionState` | v0.18.1d | Before/after state in CorruptionService operations |
| `DetermineStage` | v0.18.1d | Stage resolution in service implementation |
| Threshold constants | v0.18.1d | Threshold crossing detection in service logic |

---

## Logging Strategy

No runtime logging in v0.18.1a — all types are an enum and a value object with no side effects. Logging specifications shown in the design specification (section 7) are for future service implementations (v0.18.1d) which will log corruption state changes, stage transitions, and mutation risk warnings.

---

## Files Created

| Path | Description |
|------|-------------|
| `src/Core/RuneAndRust.Domain/Enums/CorruptionStage.cs` | Corruption stage enum (6 stages) |
| `src/Core/RuneAndRust.Domain/ValueObjects/CorruptionState.cs` | Corruption state value object |
| `tests/RuneAndRust.Domain.UnitTests/Enums/CorruptionStageTests.cs` | CorruptionStage tests (2 tests) |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CorruptionStateTests.cs` | CorruptionState tests (19 tests) |
| `changelogs/v0.18.1a-changelog.md` | This changelog |

## Files Modified

| Path | Description |
|------|-------------|
| `config/glossary.json` | Added 2 glossary entries (sortOrder 90-91) |
| `docs/design/v0.18.x/v0.18.1-scope-breakdown.md` | Checked off v0.18.1a acceptance criteria |
| `docs/design/v0.18.x/v0.18.1a-design-specification.md` | Checked off deliverable and acceptance criteria |

---

## Notes

- Total unit tests for v0.18.1a: 21 test methods across 2 test files (58 individual test case executions, exceeding the ~4 estimate)
- All 58 new test executions pass; all existing tests unaffected (0 regressions)
- Build succeeds with 0 errors, 0 warnings
- All new files follow established codebase patterns: `═══════` box comment headers and section separators, file-scoped namespaces, comprehensive XML documentation with `<summary>`, `<remarks>`, `<para>`, `<list>`, `<example>`, `<seealso>`, and `<value>` tags
- The Corruption State Pattern established here (enum + value object with computed properties) parallels the Stress State Pattern from v0.18.0a and will be reused for CPS stages (v0.18.2) and specialization resources (v0.18.4)
- Pre-existing glossary schema validation failure at term #88 remains (unrelated to v0.18.1a changes)
