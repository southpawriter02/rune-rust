# v0.0.9a Changelog - Monster Definitions

**Date:** 2026-01-08

## Summary

Transforms the hardcoded monster factory methods into a data-driven system using JSON configuration. Monsters are now defined in `config/monsters.json` with customizable stats, behaviors, tags, spawn weights, and descriptions.

## Added

### Domain Layer - Definitions (New)

- `MonsterDefinition` class:
  - Properties: Id, Name, Description, BaseHealth, BaseAttack, BaseDefense, ExperienceValue, Behavior, Tags, CanHeal, HealAmount, SpawnWeight, InitiativeModifier
  - `Create()` factory method with validation
  - `CreateMonster()` instance method to spawn Monster from definition
  - `HasTag()`, `HasAllTags()`, `HasAnyTag()` for tag-based filtering

### Domain Layer - Interfaces (New)

- `IMonsterService` interface:
  - `SpawnMonster(string definitionId)` - spawn by ID
  - `SpawnRandomMonster()` - weighted random selection
  - `SpawnRandomMonster(IEnumerable<string> requiredTags)` - tag-filtered spawn
  - `GetAllDefinitions()` - get all monster definitions
  - `GetDefinition(string id)` - get specific definition

### Domain Layer - Services (New)

- `MonsterService` class:
  - Implements `IMonsterService`
  - Weighted random selection based on `SpawnWeight`
  - Tag-based filtering for area/dungeon variety
  - Fallback to goblin when no definitions available

### Application Layer - Interfaces (Modified)

- `IGameConfigurationProvider` interface:
  - Added `GetMonsters()` method
  - Added `GetMonsterById(string monsterId)` method

### Infrastructure Layer - Configuration (Modified)

- `JsonConfigurationProvider` enhancements:
  - Added `_monsters` caching field
  - Added `GetMonsters()` implementation
  - Added `GetMonsterById()` implementation
  - Added `ToMonsterDefinition()` mapping method
  - Added `MonstersJsonConfig` and `MonsterDefinitionJsonConfig` internal classes
  - Added `GetDefaultMonsters()` fallback

### Infrastructure Layer - DI (Modified)

- `DependencyInjection` enhancements:
  - Registered `IMonsterService` with `MonsterService` as scoped service

### Configuration (New)

- `config/monsters.json`:
  - 5 default monster definitions
  - Full customization support

### Domain Layer - Entities (Modified)

- `Monster` entity:
  - Factory methods marked with `[Obsolete]` attribute
  - `CreateGoblin()`, `CreateSkeleton()`, `CreateOrc()`, `CreateGoblinShaman()`, `CreateSlime()` deprecated

## Tests Added

| Test File | Count |
|-----------|-------|
| `MonsterDefinitionTests.cs` | 25 |
| `MonsterServiceTests.cs` | 22 |
| **Total New** | 47 |

## Test Results

```
Domain Tests:      541 passed (+47)
Application Tests: 117 passed
Architecture Tests:  8 passed
Total:             666 passed
```

## Monster Definition System

### JSON Structure

```json
{
  "monsters": [
    {
      "id": "goblin",
      "name": "Goblin",
      "description": "A small, green creature...",
      "baseHealth": 30,
      "baseAttack": 8,
      "baseDefense": 2,
      "experienceValue": 25,
      "behavior": "Cowardly",
      "tags": ["humanoid"],
      "canHeal": false,
      "spawnWeight": 100,
      "initiativeModifier": 1
    }
  ]
}
```

### Default Monster Definitions

| ID | Name | HP | ATK | DEF | XP | Behavior | Tags | Weight |
|----|------|-----|-----|-----|-----|----------|------|--------|
| goblin | Goblin | 30 | 8 | 2 | 25 | Cowardly | humanoid | 100 |
| skeleton | Skeleton | 25 | 6 | 3 | 20 | Aggressive | undead | 80 |
| orc | Orc | 45 | 12 | 4 | 40 | Aggressive | humanoid | 50 |
| goblin_shaman | Goblin Shaman | 25 | 6 | 1 | 30 | Support | humanoid, magic | 30 |
| slime | Slime | 40 | 5 | 5 | 15 | Chaotic | ooze | 90 |

### Spawn Weight System

Higher weights increase spawn probability. With the default weights:
- Goblin (100) - Most common
- Slime (90) - Common
- Skeleton (80) - Common
- Orc (50) - Uncommon
- Goblin Shaman (30) - Rare

### Tag-Based Spawning

Filter monsters by tags for area-specific encounters:
```csharp
// Spawn any humanoid
var monster = monsterService.SpawnRandomMonster(["humanoid"]);

// Spawn undead
var undead = monsterService.SpawnRandomMonster(["undead"]);

// Spawn magic user
var caster = monsterService.SpawnRandomMonster(["magic"]);
```

## Files Summary

### New Files (6)
| File | Purpose |
|------|---------|
| `Domain/Definitions/MonsterDefinition.cs` | Monster definition entity |
| `Domain/Interfaces/IMonsterService.cs` | Service interface |
| `Domain/Services/MonsterService.cs` | Service implementation |
| `config/monsters.json` | Default monster definitions |
| `Domain.UnitTests/Definitions/MonsterDefinitionTests.cs` | Definition tests |
| `Domain.UnitTests/Services/MonsterServiceTests.cs` | Service tests |

### Modified Files (5)
| File | Changes |
|------|---------|
| `Domain/Entities/Monster.cs` | Deprecated factory methods |
| `Application/Interfaces/IGameConfigurationProvider.cs` | Added monster methods |
| `Infrastructure/Configuration/JsonConfigurationProvider.cs` | Load monsters.json |
| `Infrastructure/DependencyInjection.cs` | Register MonsterService |
| Test project files | Allow obsolete usage during transition |

## Migration Guide

### Before (Deprecated)
```csharp
var monster = Monster.CreateGoblin();
```

### After (Recommended)
```csharp
var monsterService = serviceProvider.GetRequiredService<IMonsterService>();
var monster = monsterService.SpawnMonster("goblin");
// or
var randomMonster = monsterService.SpawnRandomMonster();
```

## v0.0.9a Complete

This completes the Monster Definitions system:
- Data-driven monster configuration via JSON
- Weighted random spawning for encounter variety
- Tag-based filtering for area-specific monsters
- Full backward compatibility with deprecated factory methods
- Ready for v0.0.9b: Loot Tables & Drops
