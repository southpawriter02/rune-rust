# Changelog: v0.17.0d - Trauma Economy Baseline

**Release Date:** 2026-01-29  
**Phase:** Lineage System (4/6)  
**Status:** Complete

---

## Overview

Implements the Trauma Economy baseline for lineages, completing the `LineageDefinition` entity with starting Corruption/Stress values and resistance modifiers. This creates the foundation for integrating lineages with the Trauma Economy system.

---

## Added

### Domain Layer

#### Value Objects

- **`LineageTraumaBaseline`** (`ValueObjects/LineageTraumaBaseline.cs`)
    - Immutable `record struct` for Trauma Economy baseline values
    - Properties: `StartingCorruption`, `StartingStress`, `CorruptionResistanceModifier`, `StressResistanceModifier`
    - Helper properties: `HasPermanentCorruption`, `HasCorruptionVulnerability`, `HasStressVulnerability`, `HasAnyVulnerability`, `PermanentCorruptionFloor`
    - Factory method `Create()` with validation for non-negative starting values
    - Static properties for lineages: `ClanBorn`, `RuneMarked`, `IronBlooded`, `VargrKin`, `None`
    - `CalculateCorruptionAfterCleanse()` method respecting permanent floor
    - `ToString()` override for debugging

### Unit Tests

- **`LineageTraumaBaselineTests`** (~16 tests)
    - Factory method validation tests
    - Static lineage baseline property tests
    - Helper property classification tests
    - `CalculateCorruptionAfterCleanse` floor enforcement tests
    - `ToString` formatting tests

---

## Changed

### Domain Layer

#### Entities

- **`LineageDefinition`** (`Entities/LineageDefinition.cs`)
    - Added `TraumaBaseline` property of type `LineageTraumaBaseline`
    - Updated `Create()` factory method to accept `traumaBaseline` parameter
    - Added helper methods:
        - `GetPermanentCorruptionFloor()` - returns minimum Corruption after cleansing
        - `HasTraumaVulnerabilities()` - checks for resistance penalties
        - `GetStartingCorruption()` - returns starting Corruption
        - `GetCorruptionResistanceModifier()` - returns Corruption resistance modifier
        - `GetStressResistanceModifier()` - returns Stress resistance modifier
    - Updated logging to include trauma baseline values
    - Updated `ToString()` to include trauma information
    - Version updated to 0.17.0d

### Configuration Files

#### `config/lineages.json`

- Added `traumaBaseline` section to all four lineages:
    - **Clan-Born:** `(0, 0, 0, 0)` - baseline humans
    - **Rune-Marked:** `(5, 0, -1, 0)` - 5 permanent Corruption, -1 Corruption resistance
    - **Iron-Blooded:** `(0, 0, 0, -1)` - -1 Stress resistance
    - **Vargr-Kin:** `(0, 0, 0, 0)` - baseline values

#### `config/schemas/lineages.schema.json`

- Added `traumaBaseline` definition with schema validation
- Added `traumaBaseline` to required properties
- Added property reference in `lineageDefinition`

---

## Design Decisions

### Permanent Corruption Floor

- `StartingCorruption` is explicitly **permanent** and cannot be cleansed below this value
- Represents the indelible mark of the Runic Blight on certain bloodlines
- `CalculateCorruptionAfterCleanse()` enforces this floor

### Resistance Modifiers

- Negative modifiers **increase** vulnerability (make character more susceptible)
- Positive modifiers **decrease** vulnerability (make character more resistant)
- Example: Rune-Marked's -1 Corruption resistance makes Corruption checks harder

### Lineage-Specific Baselines

| Lineage      | Starting Corruption | Starting Stress | Corruption Resist | Stress Resist |
| ------------ | ------------------- | --------------- | ----------------- | ------------- |
| Clan-Born    | 0                   | 0               | 0                 | 0             |
| Rune-Marked  | 5                   | 0               | -1                | 0             |
| Iron-Blooded | 0                   | 0               | 0                 | -1            |
| Vargr-Kin    | 0                   | 0               | 0                 | 0             |

- **Clan-Born:** Baseline humans with no trauma vulnerability
- **Rune-Marked:** Aether taint manifests as permanent Corruption and increased susceptibility
- **Iron-Blooded:** Physical focus weakens mental fortitude against psychic assault
- **Vargr-Kin:** Primal Clarity trait handles Stress reduction separately

---

## Dependencies

### Prerequisites

- v0.17.0c (Unique Traits) - Complete

### Future Integration Points

- v0.17.0e: `ILineageProvider` will load trauma baselines from configuration
- v0.17.0f: `CharacterFactory` will apply starting trauma during creation
- Trauma Economy System: Will use modifiers for resistance checks

---

## Breaking Changes

- `LineageDefinition.Create()` now requires a `traumaBaseline` parameter
    - Existing code must be updated to provide this parameter
    - Use `LineageTraumaBaseline.None` for default/neutral values
