# Changelog: v0.17.2a - Core Attribute Enum & Description

**Release Date:** 2026-01-30
**Phase:** Attribute System (1/7)
**Status:** Complete

---

## Overview

Implements the foundational types for the v0.17.2 Attribute System: the `CoreAttribute` enum and `AttributeDescription` value object. These types define the five core character attributes (Might, Finesse, Wits, Will, Sturdiness) and their display properties, relationship mappings to derived stats, and associated skills.

This phase establishes the attribute identification and description layer that all subsequent v0.17.2x phases depend upon for point-buy allocation, derived stat calculation, and character creation UI. The `CoreAttribute` enum was originally introduced in v0.17.0a; this version updates it with cross-references to the new `AttributeDescription` value object.

The configuration file (`attributes.json`) has been replaced with a description-focused format aligned with the v0.17.2 design specification, removing the legacy point-buy rules and Fortitude-era structure.

---

## Added

### Domain Layer

#### Value Objects

- **`AttributeDescription`** (`ValueObjects/AttributeDescription.cs`)
    - `readonly record struct` encapsulating display and relationship data for a core attribute
    - Properties: `Attribute`, `DisplayName`, `ShortDescription`, `DetailedDescription`, `AffectedStats`, `AffectedSkills`
    - Computed properties: `HasAffectedStats`, `HasAffectedSkills`, `AffectedStatCount`, `AffectedSkillCount`
    - Factory method: `Create()` with parameter validation, uppercase normalization, and optional logger
    - Helper methods: `GetAffectedStatsSummary()`, `GetAffectedSkillsSummary()`, `AffectsStat()`, `AffectsSkill()`, `GetTooltipText()`
    - Follows `BackgroundSkillGrant` pattern: static `ILogger<T>?` field, section separators, comprehensive XML docs
    - Debug logging during validation, Information logging on successful creation

### Configuration Files

- **`config/schemas/attributes.schema.json`** — New JSON Schema (Draft 7) for validating attributes.json
    - Enforces exactly 5 attribute definitions
    - Validates `displayName` pattern (uppercase only), string length constraints, and required fields
    - Uses `definitions` for reusable `attributeDefinition` type
    - `additionalProperties: false` at all levels

### Unit Tests

- **`AttributeDescriptionTests`** (`ValueObjects/AttributeDescriptionTests.cs`) — 13 tests
    - `Create_WithValidParameters_CreatesDescription`: Validates all properties assigned correctly
    - `Create_WithNullDisplayName_ThrowsArgumentException`: Rejects null display name
    - `Create_WithNullShortDescription_ThrowsArgumentException`: Rejects null short description
    - `Create_WithNullDetailedDescription_ThrowsArgumentException`: Rejects null detailed description
    - `Create_NormalizesDisplayNameToUppercase`: Verifies uppercase normalization
    - `Create_WithNullLists_DefaultsToEmptyCollections`: Verifies null-to-empty list handling
    - `AffectsStat_WithMatchingStat_ReturnsTrue`: Case-insensitive stat lookup
    - `AffectsSkill_WithMatchingSkill_ReturnsTrue`: Case-insensitive skill lookup
    - `GetAffectedStatsSummary_ReturnsFormattedString`: Comma-separated output
    - `GetAffectedStatsSummary_WithNoStats_ReturnsNone`: "None" for empty lists
    - `GetAffectedSkillsSummary_ReturnsFormattedString`: Comma-separated output
    - `GetTooltipText_ReturnsFormattedTooltip`: Multi-line tooltip format
    - `ToString_ReturnsDisplayNameAndShortDescription`: Debug string format

### Glossary

- **`config/glossary.json`** — Added missing attribute glossary entries
    - `wits`: Mental acuity, perception, knowledge (sortOrder: 4)
    - `sturdiness`: Physical toughness, endurance, HP (sortOrder: 5)

---

## Changed

### Domain Layer

#### Enums

- **`CoreAttribute`** (`Enums/CoreAttribute.cs`)
    - Updated version header from 0.17.0a to 0.17.2a
    - Added `<seealso cref="ValueObjects.AttributeDescription"/>` cross-reference
    - All 5 values and existing documentation preserved (Might=0, Finesse=1, Wits=2, Will=3, Sturdiness=4)

### Configuration Files

- **`config/attributes.json`** — Replaced with v0.17.2a description-focused format
    - Removed legacy fields: `version`, `pointBuyRules`, `id`, `abbreviation`, `color`, `sortOrder`, `primaryEffects`
    - Removed legacy "Fortitude" attribute (replaced by "Sturdiness" in v0.17.0a)
    - New structure: `attribute`, `displayName`, `shortDescription`, `detailedDescription`, `affectedStats`, `affectedSkills`
    - Point-buy rules will be re-introduced in v0.17.2c with the updated cost scaling system

### Unit Tests

- **`CoreAttributeTests`** (`Enums/CoreAttributeTests.cs`)
    - Updated version header to 0.17.2a
    - Added file header block with `═══` borders
    - Added section separators for test categories
    - Added `CoreAttribute_HasFiveValues` test (separate count verification)
    - Refactored integer value test to use `[TestCase]` parameterized pattern
    - Enhanced XML documentation with `<remarks>`, `<list>`, and `<seealso>` tags

---

## Design Decisions

### Replacing attributes.json Entirely

The existing `attributes.json` used a legacy format with "Fortitude" (renamed to "Sturdiness" in v0.17.0a), a point-buy rules section with different cost scaling (base 8, range 6-15), and UI-oriented fields (`color`, `abbreviation`, `sortOrder`). The v0.17.2a design spec defines a clean description-focused format. Point-buy configuration will return in v0.17.2c with the correct cost scaling (base 1, range 1-10, premium at 9-10).

### JSON Schema Draft 7

The design specification used Draft 2020-12 with `$defs`, but all existing schemas in the codebase use Draft 7 with `definitions`. Draft 7 was chosen for consistency with `backgrounds.schema.json`, `lineages.schema.json`, and other established schemas.

### Optional Logger Parameter on Create()

The design specification's `AttributeDescription.Create()` does not include a logger parameter, but the established codebase pattern (`BackgroundSkillGrant.Create()`) includes an optional `ILogger<T>?` parameter for diagnostic output. The codebase pattern was followed for consistency.

---

## Dependencies

### Prerequisites

- v0.17.0a (CoreAttribute enum) — Extended with seealso reference
- v0.17.1e (Background System) — Complete, provides pattern references

### Provides to Future Phases

| Type | Phase | Usage |
| ---- | ----- | ----- |
| `CoreAttribute` | v0.17.2b | `AttributeAllocationMode` references attributes |
| `CoreAttribute` | v0.17.2c | Point-buy costs keyed by attribute |
| `CoreAttribute` | v0.17.2d | Derived stat formulas reference attributes |
| `AttributeDescription` | v0.17.2e | Provider returns descriptions |
| `CoreAttribute` | v0.17.5 | Character creation step 3 allocation |
