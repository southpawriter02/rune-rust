# v0.4.2c Changelog: Riddles & Advanced

**Version:** 0.4.2c  
**Date:** 2026-01-13  
**Phase:** Riddles & Advanced

---

## Summary

Completed the v0.4.2 Puzzles & Riddles system with riddle NPCs, the hint system, multi-part puzzles, and enhanced reward support. This release builds on the core puzzle infrastructure (v0.4.2a) and type-specific puzzles (v0.4.2b).

---

## Added

### Domain Layer

| File | Description |
|------|-------------|
| `ValueObjects/PuzzleHint.cs` | Hints with optional dice checks for revelation |
| `Definitions/RiddleDefinition.cs` | Riddle configuration with question and accepted answers |
| `Entities/RiddleNpc.cs` | NPCs that pose riddles and block passage |
| `Enums/RiddleConsequence.cs` | Failure consequences: hostile, disappear, penalty, reset |
| `ValueObjects/MultiPartPuzzle.cs` | Cross-room puzzle tracking with order requirements |

### Application Layer

| File | Description |
|------|-------------|
| `IPuzzleService.cs` | 3 new methods: `ValidateRiddleAnswer`, `GetNextHint`, `RecordMultiPartComponent` |
| `IPuzzleService.cs` | `RiddleAnswerResult` struct for riddle validation results |
| `PuzzleService.cs` | Implementation of v0.4.2c methods with logging |

### Room Entity

- `RiddleNpcs` collection
- `AddRiddleNpc()`, `RemoveRiddleNpc()`
- `GetRiddleNpcByKeyword()`, `IsDirectionBlockedByNpc()`, `GetBlockingNpc()`
- `HasRiddleNpcs`, `HasUnsolvedRiddleNpcs` properties

---

## Test Results

| Project | Passed | Added |
|---------|--------|-------|
| Domain | ~1130 | +26 |
| Application | 454 | — |
| Architecture | 8 | — |
| **Total** | ~1592 | +26 |

### New Test Files

- `PuzzleHintTests.cs` (4 tests)
- `RiddleDefinitionTests.cs` (5 tests)
- `RiddleNpcTests.cs` (6 tests)
- `MultiPartPuzzleTests.cs` (6 tests)
- `RoomRiddleNpcTests.cs` (5 tests)

---

## Logging Strategy

| Operation | Level | Template |
|-----------|-------|----------|
| Riddle answered | Information | `"Player {PlayerId} attempted riddle for NPC {NpcName}"` |
| Max failures | Information | `"Max failures reached for NPC {NpcId}, consequence={Consequence}"` |
| Hint revealed | Debug | `"Free hint {Order} revealed for puzzle {PuzzleId}"` |
| Multi-part complete | Information | `"Multi-part puzzle {MasterPuzzleId} COMPLETE!"` |

---

## Next Steps

The v0.4.2 Puzzles & Riddles system is now **complete**. Future enhancements may include:
- Presentation layer commands (`talk`, `answer`, `hint`)
- Integration with `LootService` for reward distribution
- Configuration loading (`riddles.json`)
