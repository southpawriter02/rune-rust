# v0.15.3e Design Specification: Negotiation System

**Version:** 0.15.3e
**Theme:** Negotiation System
**Author:** Claude
**Created:** 2026-01-17
**Status:** Draft
**Prerequisites:** v0.15.3a Complete (Social Interaction Framework), v0.15.3b Complete (Persuasion System), v0.15.3c Complete (Deception System), v0.15.3d Complete (Intimidation System)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [NegotiationStatus Enum](#4-negotiationstatus-enum)
5. [NegotiationTactic Enum](#5-negotiationtactic-enum)
6. [RequestComplexity Enum](#6-requestcomplexity-enum)
7. [NegotiationPositionTrack Entity](#7-negotiationpositiontrack-entity)
8. [NegotiationRound Value Object](#8-negotiationround-value-object)
9. [NegotiationContext Value Object](#9-negotiationcontext-value-object)
10. [NegotiationResult Value Object](#10-negotiationresult-value-object)
11. [Concession Value Object](#11-concession-value-object)
12. [INegotiationService Interface](#12-inegotiationservice-interface)
13. [NegotiationService Implementation](#13-negotiationservice-implementation)
14. [NegotiationCollapsed Fumble Consequence](#14-negotiationcollapsed-fumble-consequence)
15. [Configuration](#15-configuration)
16. [Commands](#16-commands)
17. [User-Facing Changes](#17-user-facing-changes)
18. [Logging Specifications](#18-logging-specifications)
19. [Unit Testing Requirements](#19-unit-testing-requirements)
20. [Use Cases](#20-use-cases)
21. [Deliverable Checklist](#21-deliverable-checklist)
22. [Acceptance Criteria](#22-acceptance-criteria)
23. [Future Considerations](#23-future-considerations)
24. [Implementation Notes](#24-implementation-notes)
25. [Document Metadata](#25-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.3e, the Negotiation System phase. This subsystem implements multi-round deal-brokering mechanics where players and NPCs have positions on a track and attempt to reach compromise through various tactics. Unlike single-check social interactions, negotiation is an extended skill challenge that unfolds over multiple rounds. The key components are:

1. **NegotiationPositionTrack Entity**: Tracks both PC and NPC positions on a 0-8 scale from Maximum Demand to Walk Away, calculating the gap between positions and managing round progression.

2. **NegotiationStatus Enum**: Represents the current phase of negotiation from Opening through Bargaining to Finalization, DealReached, or Collapsed.

3. **NegotiationTactic Enum**: The four approaches available each round: Persuade (honest appeal), Deceive (misleading), Pressure (intimidating), and Concede (voluntary concession for future bonus).

4. **RequestComplexity Enum**: Categorizes what the player is asking for from Fair Trade (DC 10) to One-Sided Deal (DC 26), affecting the difficulty of moving the NPC's position.

5. **NegotiationRound Value Object**: Records the outcome of each round including tactic used, check result, and position movement.

6. **Concession Value Object**: Tracks voluntary concessions made by the player, providing DC reductions and bonus dice for subsequent checks.

7. **NegotiationService**: Orchestrates the multi-round negotiation process, managing position movement, tactic resolution, and deal finalization.

This subsystem creates strategic social gameplay where players must balance aggression with compromise, choose appropriate tactics based on the situation, and manage the risk of negotiation collapse.

### 1.2 Current vs. Target Implementation

| Aspect | Current Implementation | Target Implementation |
|--------|------------------------|----------------------|
| **Position Tracking** | Not implemented | 0-8 scale position track for both parties |
| **Multi-Round** | Single check | Extended skill challenge with multiple rounds |
| **Tactics** | Fixed approach | Choose Persuade, Deceive, Pressure, or Concede |
| **Position Movement** | Not tracked | Success moves opponent, failure moves self |
| **Concessions** | Not implemented | Voluntary concessions grant +2d10 next check |
| **Request Complexity** | Generic DC | 5 tiers from Fair Trade (DC 10) to One-Sided (DC 26) |
| **Deal Resolution** | Not implemented | Positions must overlap at Compromise |
| **Negotiation Phases** | Not tracked | Opening, Bargaining, CrisisManagement, Finalization |
| **Round History** | Not tracked | Complete history of all rounds and outcomes |
| **Collapse Consequence** | Generic failure | Negotiation Collapsed - relationship damaged |

### 1.3 Scope

**In Scope:**
- Define `NegotiationStatus` enum with 6 phases
- Define `NegotiationTactic` enum with 4 tactics
- Define `RequestComplexity` enum with 5 complexity tiers
- Define `NegotiationPositionTrack` entity with position management
- Define `NegotiationRound` value object for round tracking
- Define `NegotiationContext` value object for negotiation state
- Define `NegotiationResult` value object for outcomes
- Define `Concession` value object for concession tracking
- Create `INegotiationService` interface for negotiation operations
- Implement `NegotiationService` with multi-round logic
- Implement [Negotiation Collapsed] fumble consequence
- Configuration file `negotiation-config.json`
- Unit tests for negotiation mechanics (~4 tests)

**Out of Scope:**
- Interrogation system - v0.15.3f
- Cultural protocols - v0.15.3g
- Extended influence - v0.15.3h
- Specialization integration (Kupmaðr abilities) - v0.15.3i

### 1.4 Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Enums | 3 | `NegotiationStatus`, `NegotiationTactic`, `RequestComplexity` |
| Entities | 1 | `NegotiationPositionTrack` |
| Value Objects | 4 | `NegotiationRound`, `NegotiationContext`, `NegotiationResult`, `Concession` |
| Interfaces | 1 | `INegotiationService` |
| Services | 1 | `NegotiationService` |
| Fumble Types | 1 | `NegotiationCollapsed` (extension of `FumbleType`) |
| Configuration | 1 | `negotiation-config.json` |
| Unit Tests | ~4 | Position track gap, success moves opponent, failure moves self, concession bonus |

---

## 2. Dependencies

### 2.1 Required from v0.15.3a (Social Interaction Framework)

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| `SocialInteractionType` | `Domain/Enums/SocialInteractionType.cs` | Set to `Negotiation` for context |
| `NpcDisposition` | `Domain/Enums/NpcDisposition.cs` | Initial position affected by disposition |
| `DispositionLevel` | `Domain/ValueObjects/DispositionLevel.cs` | Tracks disposition changes |
| `SocialContext` | `Domain/ValueObjects/SocialContext.cs` | Base context pattern |
| `SocialResult` | `Domain/ValueObjects/SocialResult.cs` | Base result pattern |
| `SocialModifier` | `Domain/ValueObjects/SocialModifier.cs` | Concession modifiers |
| `SocialContextBuilder` | `Application/Services/SocialContextBuilder.cs` | Builds negotiation contexts |

### 2.2 Required from v0.15.3b (Persuasion System)

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| `PersuasionContext` | `Domain/ValueObjects/PersuasionContext.cs` | Persuade tactic uses persuasion logic |
| `IPersuasionService` | `Application/Interfaces/IPersuasionService.cs` | Delegated Persuade tactic checks |
| `ArgumentAlignment` | `Domain/ValueObjects/ArgumentAlignment.cs` | Value alignment for Persuade tactic |

### 2.3 Required from v0.15.3c (Deception System)

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| `DeceptionContext` | `Domain/ValueObjects/DeceptionContext.cs` | Deceive tactic uses deception logic |
| `IDeceptionService` | `Application/Interfaces/IDeceptionService.cs` | Delegated Deceive tactic checks |
| `LiarsBurden` | `Domain/ValueObjects/LiarsBurden.cs` | Stress cost for Deceive tactic |

### 2.4 Required from v0.15.3d (Intimidation System)

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| `IntimidationContext` | `Domain/ValueObjects/IntimidationContext.cs` | Pressure tactic uses intimidation logic |
| `IIntimidationService` | `Application/Interfaces/IIntimidationService.cs` | Delegated Pressure tactic checks |
| `CostOfFear` | `Domain/ValueObjects/CostOfFear.cs` | Reputation cost for Pressure tactic |

### 2.5 Required from v0.15.0 (Dice Pool Refactor)

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| `DiceRollResult` | `Domain/ValueObjects/DiceRollResult.cs` | Provides `NetSuccesses`, `IsFumble` |
| `IDiceRollerService` | `Application/Interfaces/IDiceRollerService.cs` | Performs negotiation dice rolls |
| `SkillOutcome` | `Domain/Enums/SkillOutcome.cs` | Outcome classification per round |

### 2.6 Required from v0.15.1b (Outcome Classification)

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| `OutcomeDetails` | `Domain/ValueObjects/OutcomeDetails.cs` | Enhanced outcome metadata |
| `FumbleType` | `Domain/Enums/FumbleType.cs` | Extended with `NegotiationCollapsed` |
| `FumbleConsequence` | `Domain/Entities/FumbleConsequence.cs` | Tracks negotiation failure |
| `IFumbleConsequenceService` | `Application/Interfaces/IFumbleConsequenceService.cs` | Creates fumble consequences |

### 2.7 Required from Game State

| Component | Location | Usage in v0.15.3e |
|-----------|----------|-------------------|
| NPC Negotiation Data | `Domain/Entities/NpcNegotiationProfile.cs` | NPC's starting position and flexibility |
| Faction Reputation | `Domain/Services/FactionService.cs` | Affects initial gap assessment |
| Quest State | `Application/Services/QuestService.cs` | Quest outcomes from negotiation |
| Inventory | `Application/Services/InventoryService.cs` | Items for concession offers |

### 2.8 Provides to Future Versions

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.3f | Interrogation System | May use negotiation tactics |
| v0.15.3g | Cultural Protocols | Cultural negotiation style modifiers |
| v0.15.3i | Specialization Integration | Kupmaðr [Silver Tongue] auto-success |

---

## 3. Architecture Diagrams

### 3.1 Negotiation Position Track

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        NEGOTIATION POSITION TRACK                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  POSITION SCALE (0-8):                                                      │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                                                                        │  │
│  │   [Maximum     [Strong]    [Favorable] [Compromise] [Unfavorable]     │  │
│  │    Demand]                                                             │  │
│  │       0           2            4            5            6            │  │
│  │       │           │            │            │            │            │  │
│  │       ▼           ▼            ▼            ▼            ▼            │  │
│  │   ┌───────┬───────┬───────┬───────┬───────┬───────┬───────┬───────┐  │  │
│  │   │   0   │   1   │   2   │   3   │   4   │   5   │   6   │   7   │  │  │
│  │   └───────┴───────┴───────┴───────┴───────┴───────┴───────┴───────┘  │  │
│  │       │                                                     │         │  │
│  │       │           PC wants to be here ──────▶              │         │  │
│  │       │           ◀────── NPC wants to be here             │         │  │
│  │       │                                                     │         │  │
│  │       ▼                                                     ▼         │  │
│  │   PLAYER                                                [Walk        │  │
│  │   FAVORABLE                                              Away]       │  │
│  │                                                             8         │  │
│  │                                                                        │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  POSITION MEANINGS:                                                         │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  Position │ Name            │ Description                          │    │
│  ├───────────┼─────────────────┼──────────────────────────────────────┤    │
│  │     0     │ Maximum Demand  │ Everything goes to one party         │    │
│  │     1     │ Strong+         │ Heavily favored deal                 │    │
│  │     2     │ Strong          │ Clearly advantageous                 │    │
│  │     3     │ Favorable+      │ Noticeable advantage                 │    │
│  │     4     │ Favorable       │ Slight advantage                     │    │
│  │     5     │ Compromise      │ Fair deal for both sides             │    │
│  │     6     │ Unfavorable     │ Slight disadvantage                  │    │
│  │     7     │ Weak            │ Clearly disadvantageous              │    │
│  │     8     │ Walk Away       │ No deal possible                     │    │
│  └───────────┴─────────────────┴──────────────────────────────────────┘    │
│                                                                              │
│  DEAL RESOLUTION:                                                           │
│  • Deal is reached when BOTH positions reach 5 (Compromise)                 │
│  • OR when positions overlap (gap = 0)                                      │
│  • Final deal terms favor whoever has the lower position number             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Negotiation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           NEGOTIATION FLOW                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  INITIATION                                                                  │
│  Player: "I want to negotiate for the merchant's cargo route rights"        │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    ASSESS REQUEST COMPLEXITY                         │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Request: Exclusive access to cargo route                           │    │
│  │  Classification: Noticeable Advantage (DC 18)                       │    │
│  │                                                                      │    │
│  │  RequestComplexity Tiers:                                           │    │
│  │  ├── FairTrade (DC 10)        - Equal exchange                      │    │
│  │  ├── SlightAdvantage (DC 14)  - Minor edge                          │    │
│  │  ├── NoticeableAdvantage (DC 18) - Clear benefit ← SELECTED         │    │
│  │  ├── MajorAdvantage (DC 22)   - Significant gain                    │    │
│  │  └── OneSidedDeal (DC 26)     - All in player's favor               │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    INITIALIZE POSITION TRACK                         │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  NegotiationPositionTrack                                           │    │
│  │  ├── NegotiationId: "nego_001"                                      │    │
│  │  ├── PcPosition: 2 (Strong - player wants advantage)                │    │
│  │  ├── NpcPosition: 6 (Unfavorable - NPC resists)                     │    │
│  │  ├── Gap: 4 (Moderate distance)                                     │    │
│  │  ├── RoundNumber: 0                                                 │    │
│  │  ├── RoundsRemaining: 5 (complexity-based)                          │    │
│  │  └── Status: Opening                                                │    │
│  │                                                                      │    │
│  │  Initial Gap Assessment:                                            │    │
│  │  ├── Close (0-2): Quick negotiation possible                        │    │
│  │  ├── Moderate (3-4): Standard negotiation ← CURRENT                 │    │
│  │  └── Far (5+): Difficult, may require concessions                   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         ROUND 1: OPENING                             │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Status: Opening                                                    │    │
│  │  Current Positions: PC at 2, NPC at 6 (Gap: 4)                      │    │
│  │                                                                      │    │
│  │  TACTIC SELECTION:                                                  │    │
│  │  ┌─────────────────────────────────────────────────────────────┐    │    │
│  │  │  [Persuade]  - Honest appeal (uses Persuasion system)       │    │    │
│  │  │  [Deceive]   - Misleading claims (uses Deception system)    │    │    │
│  │  │  [Pressure]  - Intimidating (uses Intimidation, costs rep)  │    │    │
│  │  │  [Concede]   - Give ground (+2d10 next check)               │    │    │
│  │  └─────────────────────────────────────────────────────────────┘    │    │
│  │                                                                      │    │
│  │  Player selects: [Persuade]                                         │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    RESOLVE ROUND 1 CHECK                             │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Persuade Check: WILL (4) + Rhetoric (3) = 7d10 vs DC 18            │    │
│  │                                                                      │    │
│  │  Roll: [9, 8, 3, 10, 5, 8, 7]                                       │    │
│  │  Successes: 4 (9, 8, 10, 8)                                         │    │
│  │  Required: 18 / 4 = 5 (rounded up)                                  │    │
│  │                                                                      │    │
│  │  Outcome: FAILURE (4 successes < 5 required)                        │    │
│  │                                                                      │    │
│  │  Position Movement:                                                 │    │
│  │  ├── Failure: Move SELF 1 step toward opponent                      │    │
│  │  ├── PC moves from 2 → 3 (toward compromise)                        │    │
│  │  └── New Gap: 6 - 3 = 3                                             │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         ROUND 2: BARGAINING                          │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Status: Bargaining                                                 │    │
│  │  Current Positions: PC at 3, NPC at 6 (Gap: 3)                      │    │
│  │  Rounds Remaining: 4                                                │    │
│  │                                                                      │    │
│  │  Player selects: [Concede] - Offer valuable item                    │    │
│  │                                                                      │    │
│  │  Concession Applied:                                                │    │
│  │  ├── Type: "Offer item of value"                                    │    │
│  │  ├── DC Reduction: -2 on next check                                 │    │
│  │  ├── Bonus Dice: +2d10 on next check                                │    │
│  │  └── Position: PC moves from 3 → 4 (voluntary)                      │    │
│  │                                                                      │    │
│  │  New Gap: 6 - 4 = 2                                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         ROUND 3: BARGAINING                          │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Status: Bargaining                                                 │    │
│  │  Current Positions: PC at 4, NPC at 6 (Gap: 2)                      │    │
│  │  Rounds Remaining: 3                                                │    │
│  │  Active Concession Bonus: +2d10, -2 DC                              │    │
│  │                                                                      │    │
│  │  Player selects: [Persuade]                                         │    │
│  │                                                                      │    │
│  │  Check: WILL (4) + Rhetoric (3) + Concession (2) = 9d10             │    │
│  │  vs DC 18 - 2 (concession) = DC 16                                  │    │
│  │                                                                      │    │
│  │  Roll: [10, 9, 8, 4, 9, 8, 10, 3, 8]                                │    │
│  │  Successes: 7 (10, 9, 8, 9, 8, 10, 8)                               │    │
│  │  Required: 16 / 4 = 4                                               │    │
│  │                                                                      │    │
│  │  Outcome: CRITICAL SUCCESS (7 - 4 = 3 excess successes)             │    │
│  │                                                                      │    │
│  │  Position Movement:                                                 │    │
│  │  ├── Critical Success: Move OPPONENT 2 steps toward compromise      │    │
│  │  ├── NPC moves from 6 → 4 (toward compromise)                       │    │
│  │  └── New Gap: 4 - 4 = 0 (POSITIONS OVERLAP!)                        │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                        DEAL REACHED                                  │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Status: DealReached                                                │    │
│  │  Final Positions: PC at 4, NPC at 4 (Gap: 0)                        │    │
│  │                                                                      │    │
│  │  Deal Terms:                                                        │    │
│  │  ├── Position 4 = "Favorable" for both                              │    │
│  │  ├── Player gets cargo route access                                 │    │
│  │  ├── NPC gets offered valuable item + future consideration          │    │
│  │  └── Both parties satisfied with arrangement                        │    │
│  │                                                                      │    │
│  │  NegotiationResult:                                                 │    │
│  │  ├── Outcome: Success                                               │    │
│  │  ├── FinalDeal: "Favorable trade agreement"                         │    │
│  │  ├── RoundsUsed: 3                                                  │    │
│  │  ├── DispositionChange: +5 (successful negotiation)                 │    │
│  │  └── UnlockedOptions: ["Cargo route access", "Merchant alliance"]   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  OUTPUT: "After tense negotiations, you and the merchant reach an           │
│           agreement. Your concession of the Dvergr compass seals the        │
│           deal, and you gain exclusive access to the northern route."       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Position Movement Rules

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       POSITION MOVEMENT RULES                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  MOVEMENT BY OUTCOME:                                                       │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  OUTCOME              │ MOVEMENT                                    │    │
│  ├───────────────────────┼─────────────────────────────────────────────┤    │
│  │  Critical Success     │ Move OPPONENT 2 steps toward Compromise    │    │
│  │  (3+ excess)          │ (NPC position +2, toward 5)                │    │
│  │                       │                                            │    │
│  │  Success              │ Move OPPONENT 1 step toward Compromise     │    │
│  │                       │ (NPC position +1, toward 5)                │    │
│  │                       │                                            │    │
│  │  Failure              │ Move SELF 1 step toward opponent          │    │
│  │                       │ (PC position +1, toward NPC)               │    │
│  │                       │                                            │    │
│  │  Critical Failure     │ Move SELF 2 steps toward opponent         │    │
│  │  (Fumble)             │ (PC position +2, may trigger Collapse)     │    │
│  │                       │                                            │    │
│  │  Concede              │ Move SELF 1 step toward opponent          │    │
│  │  (Voluntary)          │ Gain +2d10 on next check                   │    │
│  └───────────────────────┴─────────────────────────────────────────────┘    │
│                                                                              │
│  POSITION LIMITS:                                                           │
│  • Positions are clamped to 0-8 range                                       │
│  • Position 8 (Walk Away) triggers negotiation collapse                     │
│  • Positions cannot move past 0 (Maximum Demand) for PC                     │
│  • NPC reaching 0 means total surrender (rare)                              │
│                                                                              │
│  EXAMPLE MOVEMENTS:                                                         │
│                                                                              │
│  Starting: PC at 2, NPC at 6                                               │
│  ─────────────────────────────────────────────────────                      │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  0   │   1   │   2   │   3   │   4   │   5   │   6   │   7   │   8  │    │
│  │      │       │  PC   │       │       │       │  NPC  │       │      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  Gap: 4                                                                     │
│                                                                              │
│  After SUCCESS (NPC moves 1 toward 5):                                      │
│  ─────────────────────────────────────────────────────                      │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  0   │   1   │   2   │   3   │   4   │   5   │   6   │   7   │   8  │    │
│  │      │       │  PC   │       │       │  NPC  │       │       │      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  Gap: 3                                                                     │
│                                                                              │
│  After FAILURE (PC moves 1 toward NPC):                                     │
│  ─────────────────────────────────────────────────────                      │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  0   │   1   │   2   │   3   │   4   │   5   │   6   │   7   │   8  │    │
│  │      │       │       │  PC   │       │  NPC  │       │       │      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  Gap: 2                                                                     │
│                                                                              │
│  After CRITICAL SUCCESS (NPC moves 2 toward 5):                            │
│  ─────────────────────────────────────────────────────                      │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  0   │   1   │   2   │   3   │   4   │   5   │   6   │   7   │   8  │    │
│  │      │       │       │ PC+NPC│       │       │       │       │      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  Gap: 0 - DEAL REACHED!                                                     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Negotiation Tactics Matrix

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        NEGOTIATION TACTICS MATRIX                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  TACTIC COMPARISON:                                                         │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  TACTIC    │ SYSTEM USED   │ ATTRIBUTE │ SIDE EFFECTS              │    │
│  ├────────────┼───────────────┼───────────┼───────────────────────────┤    │
│  │  Persuade  │ Persuasion    │ WILL      │ None - honest approach    │    │
│  │            │ Service       │           │ Fumble: Trust Shattered   │    │
│  │            │               │           │                           │    │
│  │  Deceive   │ Deception     │ WILL      │ Liar's Burden stress      │    │
│  │            │ Service       │           │ Fumble: Lie Exposed       │    │
│  │            │               │           │ +Negotiation Collapse     │    │
│  │            │               │           │                           │    │
│  │  Pressure  │ Intimidation  │ MIGHT/WILL│ Cost of Fear (-rep)       │    │
│  │            │ Service       │           │ Fumble: Challenge Accepted│    │
│  │            │               │           │ +Negotiation Collapse     │    │
│  │            │               │           │                           │    │
│  │  Concede   │ None          │ N/A       │ Move position 1 step      │    │
│  │            │ (Automatic)   │           │ Gain +2d10 next check     │    │
│  │            │               │           │ DC -2 on next check       │    │
│  └────────────┴───────────────┴───────────┴───────────────────────────┘    │
│                                                                              │
│  TACTIC SELECTION STRATEGY:                                                 │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  SITUATION                        │ RECOMMENDED TACTIC             │    │
│  ├───────────────────────────────────┼────────────────────────────────┤    │
│  │  NPC is [Friendly], small gap     │ Persuade - low risk, reliable │    │
│  │  NPC is suspicious, need edge     │ Deceive - risky but effective │    │
│  │  Player is stronger, NPC weak     │ Pressure - fast but costs rep │    │
│  │  Low chance of success this round │ Concede - invest for next try │    │
│  │  Critical round, need guaranteed  │ Concede then Persuade combo   │    │
│  │  Final round, desperate           │ Pressure if stakes justify    │    │
│  └───────────────────────────────────┴────────────────────────────────┘    │
│                                                                              │
│  CONCESSION TYPES AND EFFECTS:                                              │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  CONCESSION TYPE                  │ DC REDUCTION │ NOTES           │    │
│  ├───────────────────────────────────┼──────────────┼─────────────────┤    │
│  │  Offer item of value              │ -2           │ Item consumed   │    │
│  │  Promise future favor             │ -2           │ Creates debt    │    │
│  │  Information trade                │ -4           │ Reveals secrets │    │
│  │  Take personal risk               │ -4           │ May have cost   │    │
│  │  Faction reputation on line       │ -6           │ Rep at stake    │    │
│  └───────────────────────────────────┴──────────────┴─────────────────┘    │
│                                                                              │
│  All concessions also grant +2d10 on the next check.                        │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Negotiation Status Phases

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       NEGOTIATION STATUS PHASES                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  PHASE FLOW:                                                                │
│                                                                              │
│       ┌──────────┐                                                          │
│       │ Opening  │  ◄─── Initial positions established                      │
│       └────┬─────┘       Gap assessed, stakes clarified                     │
│            │                                                                 │
│            ▼                                                                 │
│       ┌──────────────┐                                                      │
│       │  Bargaining  │  ◄─── Main negotiation phase                         │
│       └───┬─────┬────┘       Tactics used, positions shift                  │
│           │     │                                                            │
│           │     │  Gap widens or                                            │
│           │     │  multiple failures                                        │
│           │     ▼                                                            │
│           │    ┌───────────────────┐                                        │
│           │    │ CrisisManagement  │  ◄─── Negotiation at risk              │
│           │    └────┬─────────┬────┘       Both parties reassess            │
│           │         │         │                                              │
│           │         │         │  Recovery                                   │
│           │         │         │  succeeds                                   │
│           │         ▼         │                                              │
│           │   ┌───────────┐   │                                              │
│           │   │ Collapsed │   │  ◄─── Negotiation failed                    │
│           │   └───────────┘   │       Relationship damaged                  │
│           │                   │                                              │
│           │  ◄────────────────┘                                             │
│           │                                                                  │
│           │  Gap closes                                                     │
│           ▼                                                                  │
│       ┌──────────────┐                                                      │
│       │ Finalization │  ◄─── Positions overlapping                          │
│       └──────┬───────┘       Final terms being agreed                       │
│              │                                                               │
│              ▼                                                               │
│       ┌─────────────┐                                                       │
│       │ DealReached │  ◄─── Successful negotiation                          │
│       └─────────────┘       Terms finalized, effects applied                │
│                                                                              │
│  PHASE TRIGGERS:                                                            │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  PHASE             │ TRIGGER CONDITION                              │    │
│  ├────────────────────┼────────────────────────────────────────────────┤    │
│  │  Opening           │ Negotiation starts                             │    │
│  │  Bargaining        │ After first round                              │    │
│  │  CrisisManagement  │ Gap ≥ 5 OR 2+ consecutive failures             │    │
│  │  Finalization      │ Gap ≤ 1                                        │    │
│  │  DealReached       │ Gap = 0 (positions overlap)                    │    │
│  │  Collapsed         │ Position reaches 8 OR fumble in Crisis         │    │
│  └────────────────────┴────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 Component Relationships

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       COMPONENT RELATIONSHIPS                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ENUM HIERARCHY:                                                            │
│                                                                              │
│  NegotiationStatus ───────────────────────────────────────────────────────  │
│  │ (Negotiation phase tracking)                                             │
│  ├── Opening        → Initial phase, positions established                 │
│  ├── Bargaining     → Active negotiation, tactics used                     │
│  ├── CrisisManagement → At risk of collapse                                │
│  ├── Finalization   → Positions close, finalizing terms                    │
│  ├── DealReached    → Success, deal concluded                              │
│  └── Collapsed      → Failure, negotiation ended badly                     │
│                                                                              │
│  NegotiationTactic ───────────────────────────────────────────────────────  │
│  │ (Available actions per round)                                            │
│  ├── Persuade → Uses PersuasionService, honest appeal                      │
│  ├── Deceive  → Uses DeceptionService, misleading (stress cost)            │
│  ├── Pressure → Uses IntimidationService (reputation cost)                 │
│  └── Concede  → Voluntary position movement, grants bonus                  │
│                                                                              │
│  RequestComplexity ───────────────────────────────────────────────────────  │
│  │ (What player is asking for)                                              │
│  ├── FairTrade (DC 10)           → Equal exchange                          │
│  ├── SlightAdvantage (DC 14)     → Minor edge                              │
│  ├── NoticeableAdvantage (DC 18) → Clear benefit                           │
│  ├── MajorAdvantage (DC 22)      → Significant gain                        │
│  └── OneSidedDeal (DC 26)        → All in player's favor                   │
│                                                                              │
│  ENTITY/VALUE OBJECT RELATIONSHIPS:                                        │
│                                                                              │
│  ┌─────────────────────────┐                                               │
│  │ NegotiationPositionTrack│  ◄─── Main state entity                       │
│  ├─────────────────────────┤                                               │
│  │ NegotiationId           │                                               │
│  │ PcPosition (0-8)        │───┐                                           │
│  │ NpcPosition (0-8)       │   │                                           │
│  │ Gap (calculated)        │◄──┘ Gap = |NpcPosition - PcPosition|          │
│  │ RoundNumber             │                                               │
│  │ RoundsRemaining         │                                               │
│  │ Status                  │───▶ NegotiationStatus enum                    │
│  │ History                 │───▶ List<NegotiationRound>                    │
│  └─────────────────────────┘                                               │
│           │                                                                 │
│           │ Contains                                                        │
│           ▼                                                                 │
│  ┌─────────────────────────┐                                               │
│  │   NegotiationRound      │  ◄─── One round's data                        │
│  ├─────────────────────────┤                                               │
│  │ RoundNumber             │                                               │
│  │ TacticUsed              │───▶ NegotiationTactic enum                    │
│  │ CheckResult             │───▶ SkillOutcome enum                         │
│  │ PositionMovement        │ (who moved, by how much)                      │
│  │ ActiveConcession        │───▶ Concession (if any)                       │
│  └─────────────────────────┘                                               │
│                                                                              │
│  ┌─────────────────────────┐                                               │
│  │   NegotiationContext    │  ◄─── Round input                             │
│  ├─────────────────────────┤                                               │
│  │ BaseContext             │───▶ SocialContext                             │
│  │ RequestComplexity       │───▶ RequestComplexity enum                    │
│  │ PositionTrack           │───▶ NegotiationPositionTrack                  │
│  │ SelectedTactic          │───▶ NegotiationTactic enum                    │
│  │ ActiveConcession        │───▶ Concession (if any)                       │
│  │ NpcFlexibility          │ (how far NPC will move)                       │
│  └─────────────────────────┘                                               │
│                                                                              │
│  ┌─────────────────────────┐                                               │
│  │   NegotiationResult     │  ◄─── Final outcome                           │
│  ├─────────────────────────┤                                               │
│  │ Outcome                 │───▶ SkillOutcome enum                         │
│  │ FinalStatus             │───▶ NegotiationStatus enum                    │
│  │ FinalDealTerms          │ (description of agreement)                    │
│  │ RoundsUsed              │                                               │
│  │ DispositionChange       │                                               │
│  │ ReputationChange        │                                               │
│  │ UnlockedOptions         │                                               │
│  │ History                 │───▶ List<NegotiationRound>                    │
│  └─────────────────────────┘                                               │
│                                                                              │
│  ┌─────────────────────────┐                                               │
│  │       Concession        │  ◄─── Voluntary sacrifice                     │
│  ├─────────────────────────┤                                               │
│  │ ConcessionType          │ (item, favor, info, risk, rep)                │
│  │ Description             │ (what was offered)                            │
│  │ DcReduction             │ (-2, -4, or -6)                               │
│  │ BonusDice               │ (+2d10)                                       │
│  │ Cost                    │ (item consumed, debt created, etc.)           │
│  └─────────────────────────┘                                               │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. NegotiationStatus Enum

### 4.1 Definition

```csharp
// Location: src/Domain/Enums/NegotiationStatus.cs

namespace RuneRust.Domain.Enums;

/// <summary>
/// Represents the current phase of a multi-round negotiation.
/// Negotiations progress through phases based on position gap
/// and round outcomes.
/// </summary>
public enum NegotiationStatus
{
    /// <summary>
    /// Initial phase where positions are established and stakes clarified.
    /// Transitions to Bargaining after the first round.
    /// </summary>
    Opening = 0,

    /// <summary>
    /// Main negotiation phase where tactics are used and positions shift.
    /// The bulk of negotiation happens here.
    /// </summary>
    Bargaining = 1,

    /// <summary>
    /// Negotiation is at risk of collapse. Triggered when gap widens
    /// to 5+ or after 2+ consecutive failures. Requires careful play
    /// to recover.
    /// </summary>
    CrisisManagement = 2,

    /// <summary>
    /// Positions are overlapping or very close (gap <= 1).
    /// Final terms are being agreed upon.
    /// </summary>
    Finalization = 3,

    /// <summary>
    /// Negotiation succeeded. Deal has been reached and terms finalized.
    /// Terminal state.
    /// </summary>
    DealReached = 4,

    /// <summary>
    /// Negotiation failed. Either a party reached Walk Away (position 8),
    /// or a fumble occurred during CrisisManagement.
    /// Terminal state with negative consequences.
    /// </summary>
    Collapsed = 5
}
```

### 4.2 Extension Methods

```csharp
// Location: src/Domain/Extensions/NegotiationStatusExtensions.cs

namespace RuneRust.Domain.Extensions;

using RuneRust.Domain.Enums;

/// <summary>
/// Extension methods for the NegotiationStatus enum.
/// </summary>
public static class NegotiationStatusExtensions
{
    /// <summary>
    /// Gets whether this is a terminal state (negotiation is over).
    /// </summary>
    public static bool IsTerminal(this NegotiationStatus status)
    {
        return status == NegotiationStatus.DealReached ||
               status == NegotiationStatus.Collapsed;
    }

    /// <summary>
    /// Gets whether this status represents a successful negotiation.
    /// </summary>
    public static bool IsSuccess(this NegotiationStatus status)
    {
        return status == NegotiationStatus.DealReached;
    }

    /// <summary>
    /// Gets whether this status represents a failed negotiation.
    /// </summary>
    public static bool IsFailure(this NegotiationStatus status)
    {
        return status == NegotiationStatus.Collapsed;
    }

    /// <summary>
    /// Gets the display name for UI presentation.
    /// </summary>
    public static string GetDisplayName(this NegotiationStatus status)
    {
        return status switch
        {
            NegotiationStatus.Opening => "Opening",
            NegotiationStatus.Bargaining => "Bargaining",
            NegotiationStatus.CrisisManagement => "Crisis Management",
            NegotiationStatus.Finalization => "Finalization",
            NegotiationStatus.DealReached => "Deal Reached",
            NegotiationStatus.Collapsed => "Collapsed",
            _ => throw new ArgumentOutOfRangeException(nameof(status))
        };
    }

    /// <summary>
    /// Gets a narrative description of the current phase.
    /// </summary>
    public static string GetDescription(this NegotiationStatus status)
    {
        return status switch
        {
            NegotiationStatus.Opening => "Both parties are sizing each other up, establishing initial positions.",
            NegotiationStatus.Bargaining => "Active negotiation in progress. Each side pushes for advantage.",
            NegotiationStatus.CrisisManagement => "The negotiation is on the verge of collapse. Careful moves required.",
            NegotiationStatus.Finalization => "Positions are close. Final terms are being hammered out.",
            NegotiationStatus.DealReached => "A deal has been struck. Both parties have agreed to terms.",
            NegotiationStatus.Collapsed => "The negotiation has failed completely. No deal is possible.",
            _ => throw new ArgumentOutOfRangeException(nameof(status))
        };
    }
}
```

---

## 5. NegotiationTactic Enum

### 5.1 Definition

```csharp
// Location: src/Domain/Enums/NegotiationTactic.cs

namespace RuneRust.Domain.Enums;

/// <summary>
/// The four tactical approaches available during each negotiation round.
/// Each tactic uses a different underlying system and has different
/// costs and risks.
/// </summary>
public enum NegotiationTactic
{
    /// <summary>
    /// Honest appeal using the Persuasion system.
    /// Uses WILL + Rhetoric. No side effects on success.
    /// Fumble triggers [Trust Shattered].
    /// </summary>
    Persuade = 0,

    /// <summary>
    /// Misleading claims using the Deception system.
    /// Uses WILL + Rhetoric vs NPC WITS. Incurs Liar's Burden stress.
    /// Fumble triggers [Lie Exposed] + negotiation collapse.
    /// </summary>
    Deceive = 1,

    /// <summary>
    /// Intimidating pressure using the Intimidation system.
    /// Uses MIGHT or WILL + Rhetoric. Always costs faction reputation.
    /// Fumble triggers [Challenge Accepted] + negotiation collapse.
    /// </summary>
    Pressure = 2,

    /// <summary>
    /// Voluntary concession - give ground to gain advantage.
    /// No check required. Moves own position 1 step toward opponent.
    /// Grants +2d10 and -2 DC on the next check.
    /// </summary>
    Concede = 3
}
```

### 5.2 Extension Methods

```csharp
// Location: src/Domain/Extensions/NegotiationTacticExtensions.cs

namespace RuneRust.Domain.Extensions;

using RuneRust.Domain.Enums;

/// <summary>
/// Extension methods for the NegotiationTactic enum.
/// </summary>
public static class NegotiationTacticExtensions
{
    /// <summary>
    /// Gets whether this tactic requires a skill check.
    /// </summary>
    public static bool RequiresCheck(this NegotiationTactic tactic)
    {
        return tactic != NegotiationTactic.Concede;
    }

    /// <summary>
    /// Gets the underlying social system used by this tactic.
    /// </summary>
    public static SocialInteractionType? GetUnderlyingSystem(this NegotiationTactic tactic)
    {
        return tactic switch
        {
            NegotiationTactic.Persuade => SocialInteractionType.Persuasion,
            NegotiationTactic.Deceive => SocialInteractionType.Deception,
            NegotiationTactic.Pressure => SocialInteractionType.Intimidation,
            NegotiationTactic.Concede => null, // No underlying system
            _ => throw new ArgumentOutOfRangeException(nameof(tactic))
        };
    }

    /// <summary>
    /// Gets the display name for UI presentation.
    /// </summary>
    public static string GetDisplayName(this NegotiationTactic tactic)
    {
        return tactic switch
        {
            NegotiationTactic.Persuade => "Persuade",
            NegotiationTactic.Deceive => "Deceive",
            NegotiationTactic.Pressure => "Pressure",
            NegotiationTactic.Concede => "Concede",
            _ => throw new ArgumentOutOfRangeException(nameof(tactic))
        };
    }

    /// <summary>
    /// Gets a description of the tactic for player guidance.
    /// </summary>
    public static string GetDescription(this NegotiationTactic tactic)
    {
        return tactic switch
        {
            NegotiationTactic.Persuade => "Make an honest appeal to move the NPC's position. Safe but straightforward.",
            NegotiationTactic.Deceive => "Use misleading claims to gain advantage. Risky - incurs stress and may backfire.",
            NegotiationTactic.Pressure => "Apply intimidating pressure. Effective but always costs faction reputation.",
            NegotiationTactic.Concede => "Give ground voluntarily to gain +2d10 and -2 DC on your next check.",
            _ => throw new ArgumentOutOfRangeException(nameof(tactic))
        };
    }

    /// <summary>
    /// Gets the side effects warning for this tactic.
    /// </summary>
    public static string GetSideEffectWarning(this NegotiationTactic tactic)
    {
        return tactic switch
        {
            NegotiationTactic.Persuade => "Fumble: [Trust Shattered] - All persuasion locked with this NPC.",
            NegotiationTactic.Deceive => "Always: Liar's Burden stress. Fumble: [Lie Exposed] + Negotiation Collapse.",
            NegotiationTactic.Pressure => "Always: Reputation cost. Fumble: [Challenge Accepted] + Combat + Collapse.",
            NegotiationTactic.Concede => "Your position moves 1 step toward the NPC's position.",
            _ => throw new ArgumentOutOfRangeException(nameof(tactic))
        };
    }
}
```

---

## 6. RequestComplexity Enum

### 6.1 Definition

```csharp
// Location: src/Domain/Enums/RequestComplexity.cs

namespace RuneRust.Domain.Enums;

/// <summary>
/// Categorizes what the player is asking for in a negotiation,
/// determining the base DC and initial position gap.
/// </summary>
public enum RequestComplexity
{
    /// <summary>
    /// Equal exchange where both parties benefit equally.
    /// DC 10. Starting gap: 2.
    /// </summary>
    FairTrade = 0,

    /// <summary>
    /// Player seeks a minor edge in the deal.
    /// DC 14. Starting gap: 3.
    /// </summary>
    SlightAdvantage = 1,

    /// <summary>
    /// Player seeks a clear benefit over the NPC.
    /// DC 18. Starting gap: 4.
    /// </summary>
    NoticeableAdvantage = 2,

    /// <summary>
    /// Player seeks a significant gain at NPC's expense.
    /// DC 22. Starting gap: 5.
    /// </summary>
    MajorAdvantage = 3,

    /// <summary>
    /// Player wants everything in their favor.
    /// DC 26. Starting gap: 6.
    /// </summary>
    OneSidedDeal = 4
}
```

### 6.2 Extension Methods

```csharp
// Location: src/Domain/Extensions/RequestComplexityExtensions.cs

namespace RuneRust.Domain.Extensions;

using RuneRust.Domain.Enums;

/// <summary>
/// Extension methods for the RequestComplexity enum.
/// </summary>
public static class RequestComplexityExtensions
{
    /// <summary>
    /// Gets the base DC for checks during this negotiation.
    /// </summary>
    public static int GetBaseDc(this RequestComplexity complexity)
    {
        return complexity switch
        {
            RequestComplexity.FairTrade => 10,
            RequestComplexity.SlightAdvantage => 14,
            RequestComplexity.NoticeableAdvantage => 18,
            RequestComplexity.MajorAdvantage => 22,
            RequestComplexity.OneSidedDeal => 26,
            _ => throw new ArgumentOutOfRangeException(nameof(complexity))
        };
    }

    /// <summary>
    /// Gets the initial gap between positions based on request complexity.
    /// </summary>
    public static int GetInitialGap(this RequestComplexity complexity)
    {
        return complexity switch
        {
            RequestComplexity.FairTrade => 2,
            RequestComplexity.SlightAdvantage => 3,
            RequestComplexity.NoticeableAdvantage => 4,
            RequestComplexity.MajorAdvantage => 5,
            RequestComplexity.OneSidedDeal => 6,
            _ => throw new ArgumentOutOfRangeException(nameof(complexity))
        };
    }

    /// <summary>
    /// Gets the default number of rounds allowed for this complexity.
    /// </summary>
    public static int GetDefaultRounds(this RequestComplexity complexity)
    {
        return complexity switch
        {
            RequestComplexity.FairTrade => 3,
            RequestComplexity.SlightAdvantage => 4,
            RequestComplexity.NoticeableAdvantage => 5,
            RequestComplexity.MajorAdvantage => 6,
            RequestComplexity.OneSidedDeal => 7,
            _ => throw new ArgumentOutOfRangeException(nameof(complexity))
        };
    }

    /// <summary>
    /// Gets the display name for UI presentation.
    /// </summary>
    public static string GetDisplayName(this RequestComplexity complexity)
    {
        return complexity switch
        {
            RequestComplexity.FairTrade => "Fair Trade",
            RequestComplexity.SlightAdvantage => "Slight Advantage",
            RequestComplexity.NoticeableAdvantage => "Noticeable Advantage",
            RequestComplexity.MajorAdvantage => "Major Advantage",
            RequestComplexity.OneSidedDeal => "One-Sided Deal",
            _ => throw new ArgumentOutOfRangeException(nameof(complexity))
        };
    }

    /// <summary>
    /// Gets a description of what this complexity means.
    /// </summary>
    public static string GetDescription(this RequestComplexity complexity)
    {
        return complexity switch
        {
            RequestComplexity.FairTrade => "An equal exchange where both parties benefit.",
            RequestComplexity.SlightAdvantage => "You're asking for a minor edge in the deal.",
            RequestComplexity.NoticeableAdvantage => "You're seeking a clear benefit over them.",
            RequestComplexity.MajorAdvantage => "You want a significant gain at their expense.",
            RequestComplexity.OneSidedDeal => "You want everything in your favor.",
            _ => throw new ArgumentOutOfRangeException(nameof(complexity))
        };
    }
}
```

---

## 7. NegotiationPositionTrack Entity

### 7.1 Definition

```csharp
// Location: src/Domain/Entities/NegotiationPositionTrack.cs

namespace RuneRust.Domain.Entities;

using RuneRust.Domain.Enums;
using RuneRust.Domain.ValueObjects;

/// <summary>
/// Tracks the state of a multi-round negotiation including both party
/// positions, round history, and current status.
/// </summary>
public sealed class NegotiationPositionTrack
{
    private readonly List<NegotiationRound> _history = new();

    /// <summary>
    /// Unique identifier for this negotiation.
    /// </summary>
    public required string NegotiationId { get; init; }

    /// <summary>
    /// The player character's current position (0-8).
    /// Lower = more favorable to PC.
    /// </summary>
    public int PcPosition { get; private set; }

    /// <summary>
    /// The NPC's current position (0-8).
    /// Lower = more favorable to NPC (less favorable to PC).
    /// </summary>
    public int NpcPosition { get; private set; }

    /// <summary>
    /// The calculated gap between positions.
    /// Deal is reached when gap = 0.
    /// </summary>
    public int Gap => Math.Abs(NpcPosition - PcPosition);

    /// <summary>
    /// The current round number (1-based).
    /// </summary>
    public int RoundNumber { get; private set; }

    /// <summary>
    /// Number of rounds remaining before negotiation times out.
    /// </summary>
    public int RoundsRemaining { get; private set; }

    /// <summary>
    /// The current negotiation phase.
    /// </summary>
    public NegotiationStatus Status { get; private set; }

    /// <summary>
    /// The complexity of what the player is asking for.
    /// </summary>
    public required RequestComplexity RequestComplexity { get; init; }

    /// <summary>
    /// The NPC being negotiated with.
    /// </summary>
    public required string NpcId { get; init; }

    /// <summary>
    /// Count of consecutive failures (for crisis detection).
    /// </summary>
    public int ConsecutiveFailures { get; private set; }

    /// <summary>
    /// Read-only access to the round history.
    /// </summary>
    public IReadOnlyList<NegotiationRound> History => _history.AsReadOnly();

    /// <summary>
    /// Active concession bonus from previous round (if any).
    /// </summary>
    public Concession? ActiveConcession { get; private set; }

    /// <summary>
    /// Initializes the position track with starting positions.
    /// </summary>
    public void Initialize(int pcStartPosition, int npcStartPosition, int totalRounds)
    {
        PcPosition = Math.Clamp(pcStartPosition, 0, 8);
        NpcPosition = Math.Clamp(npcStartPosition, 0, 8);
        RoundsRemaining = totalRounds;
        RoundNumber = 0;
        Status = NegotiationStatus.Opening;
        ConsecutiveFailures = 0;
    }

    /// <summary>
    /// Moves the PC position toward the opponent.
    /// </summary>
    public void MovePcPosition(int steps)
    {
        int direction = NpcPosition > PcPosition ? 1 : -1;
        PcPosition = Math.Clamp(PcPosition + (steps * direction), 0, 8);
        CheckForCollapse();
    }

    /// <summary>
    /// Moves the NPC position toward compromise.
    /// </summary>
    public void MoveNpcPosition(int steps)
    {
        // NPC moves toward 5 (Compromise)
        int direction = NpcPosition > 5 ? -1 : (NpcPosition < 5 ? 1 : 0);
        if (NpcPosition > PcPosition)
        {
            direction = -1; // Move toward PC's position
        }
        NpcPosition = Math.Clamp(NpcPosition + (steps * direction), 0, 8);
    }

    /// <summary>
    /// Records a round and updates state.
    /// </summary>
    public void RecordRound(NegotiationRound round)
    {
        _history.Add(round);
        RoundNumber++;
        RoundsRemaining--;

        // Track consecutive failures
        if (round.CheckResult == SkillOutcome.Failure ||
            round.CheckResult == SkillOutcome.Fumble)
        {
            ConsecutiveFailures++;
        }
        else
        {
            ConsecutiveFailures = 0;
        }

        // Clear concession after it's used
        if (ActiveConcession != null && round.TacticUsed != NegotiationTactic.Concede)
        {
            ActiveConcession = null;
        }

        UpdateStatus();
    }

    /// <summary>
    /// Sets a concession bonus for the next round.
    /// </summary>
    public void SetConcessionBonus(Concession concession)
    {
        ActiveConcession = concession;
    }

    /// <summary>
    /// Clears the active concession bonus.
    /// </summary>
    public void ClearConcessionBonus()
    {
        ActiveConcession = null;
    }

    /// <summary>
    /// Updates the negotiation status based on current state.
    /// </summary>
    private void UpdateStatus()
    {
        if (Status.IsTerminal())
        {
            return;
        }

        // Check for deal reached
        if (Gap == 0)
        {
            Status = NegotiationStatus.DealReached;
            return;
        }

        // Check for finalization
        if (Gap <= 1)
        {
            Status = NegotiationStatus.Finalization;
            return;
        }

        // Check for crisis
        if (Gap >= 5 || ConsecutiveFailures >= 2)
        {
            Status = NegotiationStatus.CrisisManagement;
            return;
        }

        // Check for timeout
        if (RoundsRemaining <= 0)
        {
            Status = NegotiationStatus.Collapsed;
            return;
        }

        // Default to bargaining after opening
        if (RoundNumber > 0 && Status == NegotiationStatus.Opening)
        {
            Status = NegotiationStatus.Bargaining;
        }
    }

    /// <summary>
    /// Checks if a position has reached Walk Away (8).
    /// </summary>
    private void CheckForCollapse()
    {
        if (PcPosition >= 8 || NpcPosition >= 8)
        {
            Status = NegotiationStatus.Collapsed;
        }
    }

    /// <summary>
    /// Forces the negotiation to collapse (e.g., from fumble).
    /// </summary>
    public void ForceCollapse()
    {
        Status = NegotiationStatus.Collapsed;
    }

    /// <summary>
    /// Gets the current gap assessment category.
    /// </summary>
    public string GetGapAssessment()
    {
        return Gap switch
        {
            0 => "Positions overlap - deal possible",
            1 => "Very close - finalization imminent",
            <= 2 => "Close - quick resolution possible",
            <= 4 => "Moderate - standard negotiation",
            <= 6 => "Far apart - will require effort",
            _ => "Very far - significant concessions needed"
        };
    }
}
```

---

## 8. NegotiationRound Value Object

### 8.1 Definition

```csharp
// Location: src/Domain/ValueObjects/NegotiationRound.cs

namespace RuneRust.Domain.ValueObjects;

using RuneRust.Domain.Enums;

/// <summary>
/// Records the outcome of a single negotiation round.
/// </summary>
public sealed record NegotiationRound
{
    /// <summary>
    /// Which round number this was (1-based).
    /// </summary>
    public required int RoundNumber { get; init; }

    /// <summary>
    /// The tactic used this round.
    /// </summary>
    public required NegotiationTactic TacticUsed { get; init; }

    /// <summary>
    /// The outcome of the skill check (if any).
    /// Null for Concede tactic.
    /// </summary>
    public SkillOutcome? CheckResult { get; init; }

    /// <summary>
    /// Description of position movement this round.
    /// </summary>
    public required string PositionMovement { get; init; }

    /// <summary>
    /// PC position after this round.
    /// </summary>
    public required int PcPositionAfter { get; init; }

    /// <summary>
    /// NPC position after this round.
    /// </summary>
    public required int NpcPositionAfter { get; init; }

    /// <summary>
    /// Gap after this round.
    /// </summary>
    public required int GapAfter { get; init; }

    /// <summary>
    /// The concession made this round (if any).
    /// </summary>
    public Concession? ConcessionMade { get; init; }

    /// <summary>
    /// Stress incurred this round (if Deceive tactic used).
    /// </summary>
    public int StressCost { get; init; }

    /// <summary>
    /// Reputation cost this round (if Pressure tactic used).
    /// </summary>
    public int ReputationCost { get; init; }

    /// <summary>
    /// Narrative description of what happened.
    /// </summary>
    public required string NarrativeDescription { get; init; }

    /// <summary>
    /// Gets a summary of this round for display.
    /// </summary>
    public string GetSummary()
    {
        string outcome = CheckResult?.ToString() ?? "N/A";
        return $"Round {RoundNumber}: {TacticUsed.GetDisplayName()} - {outcome}. {PositionMovement}";
    }
}
```

---

## 9. NegotiationContext Value Object

### 9.1 Definition

```csharp
// Location: src/Domain/ValueObjects/NegotiationContext.cs

namespace RuneRust.Domain.ValueObjects;

using RuneRust.Domain.Enums;
using RuneRust.Domain.Entities;

/// <summary>
/// Contains all context needed for a negotiation round.
/// </summary>
public sealed record NegotiationContext
{
    /// <summary>
    /// The base social context.
    /// </summary>
    public required SocialContext BaseContext { get; init; }

    /// <summary>
    /// The complexity of what the player is asking for.
    /// </summary>
    public required RequestComplexity RequestComplexity { get; init; }

    /// <summary>
    /// The current position track state.
    /// </summary>
    public required NegotiationPositionTrack PositionTrack { get; init; }

    /// <summary>
    /// The tactic selected for this round.
    /// </summary>
    public required NegotiationTactic SelectedTactic { get; init; }

    /// <summary>
    /// Active concession bonus from previous round (if any).
    /// </summary>
    public Concession? ActiveConcession { get; init; }

    /// <summary>
    /// How flexible the NPC is (affects position movement).
    /// Range 1-3 where 3 is most flexible.
    /// </summary>
    public required int NpcFlexibility { get; init; }

    /// <summary>
    /// The concession being offered this round (if Concede tactic).
    /// </summary>
    public Concession? ConcessionOffer { get; init; }

    /// <summary>
    /// Gets the base DC for this negotiation.
    /// </summary>
    public int GetBaseDc()
    {
        return RequestComplexity.GetBaseDc();
    }

    /// <summary>
    /// Gets the effective DC after applying concession reduction.
    /// </summary>
    public int GetEffectiveDc()
    {
        int baseDc = GetBaseDc();
        if (ActiveConcession != null)
        {
            baseDc -= ActiveConcession.DcReduction;
        }
        return Math.Max(baseDc, 4); // Minimum DC of 4
    }

    /// <summary>
    /// Gets bonus dice from active concession.
    /// </summary>
    public int GetConcessionBonusDice()
    {
        return ActiveConcession?.BonusDice ?? 0;
    }
}
```

---

## 10. NegotiationResult Value Object

### 10.1 Definition

```csharp
// Location: src/Domain/ValueObjects/NegotiationResult.cs

namespace RuneRust.Domain.ValueObjects;

using RuneRust.Domain.Enums;
using RuneRust.Domain.Entities;

/// <summary>
/// Represents the complete outcome of a negotiation,
/// either after completion or after a single round.
/// </summary>
public sealed record NegotiationResult
{
    /// <summary>
    /// The base social result.
    /// </summary>
    public required SocialResult BaseResult { get; init; }

    /// <summary>
    /// The overall outcome of the negotiation.
    /// </summary>
    public required SkillOutcome Outcome { get; init; }

    /// <summary>
    /// The final negotiation status.
    /// </summary>
    public required NegotiationStatus FinalStatus { get; init; }

    /// <summary>
    /// Description of the final deal terms (if successful).
    /// </summary>
    public string? FinalDealTerms { get; init; }

    /// <summary>
    /// Final PC position on the track.
    /// </summary>
    public required int FinalPcPosition { get; init; }

    /// <summary>
    /// Final NPC position on the track.
    /// </summary>
    public required int FinalNpcPosition { get; init; }

    /// <summary>
    /// Number of rounds used.
    /// </summary>
    public required int RoundsUsed { get; init; }

    /// <summary>
    /// Total disposition change over the negotiation.
    /// </summary>
    public required int DispositionChange { get; init; }

    /// <summary>
    /// Total reputation change over the negotiation.
    /// </summary>
    public required int ReputationChange { get; init; }

    /// <summary>
    /// Total stress incurred during negotiation.
    /// </summary>
    public required int TotalStressCost { get; init; }

    /// <summary>
    /// Dialogue options unlocked by successful negotiation.
    /// </summary>
    public required IReadOnlyList<string> UnlockedOptions { get; init; }

    /// <summary>
    /// Complete history of all negotiation rounds.
    /// </summary>
    public required IReadOnlyList<NegotiationRound> History { get; init; }

    /// <summary>
    /// Fumble consequence if negotiation collapsed from fumble.
    /// </summary>
    public FumbleConsequence? FumbleConsequence { get; init; }

    /// <summary>
    /// Gets whether the negotiation was successful.
    /// </summary>
    public bool IsSuccess => FinalStatus == NegotiationStatus.DealReached;

    /// <summary>
    /// Gets whether the negotiation failed.
    /// </summary>
    public bool IsFailure => FinalStatus == NegotiationStatus.Collapsed;

    /// <summary>
    /// Gets a narrative summary of the negotiation.
    /// </summary>
    public string GetNarrativeSummary()
    {
        if (IsSuccess)
        {
            return $"After {RoundsUsed} rounds of negotiation, a deal was reached. {FinalDealTerms}";
        }
        else if (IsFailure)
        {
            return $"After {RoundsUsed} rounds, the negotiation collapsed. No deal was possible.";
        }
        else
        {
            return $"Negotiation in progress. Round {RoundsUsed} complete. Gap: {Math.Abs(FinalNpcPosition - FinalPcPosition)}";
        }
    }
}
```

---

## 11. Concession Value Object

### 11.1 Definition

```csharp
// Location: src/Domain/ValueObjects/Concession.cs

namespace RuneRust.Domain.ValueObjects;

/// <summary>
/// Represents a voluntary concession made during negotiation.
/// Concessions provide DC reduction and bonus dice on the next check.
/// </summary>
public sealed record Concession
{
    /// <summary>
    /// The type of concession being offered.
    /// </summary>
    public required ConcessionType Type { get; init; }

    /// <summary>
    /// Description of what was conceded.
    /// </summary>
    public required string Description { get; init; }

    /// <summary>
    /// DC reduction provided for the next check.
    /// </summary>
    public required int DcReduction { get; init; }

    /// <summary>
    /// Bonus dice provided for the next check.
    /// </summary>
    public int BonusDice { get; init; } = 2;

    /// <summary>
    /// The cost or consequence of this concession.
    /// </summary>
    public required string Cost { get; init; }

    /// <summary>
    /// Item ID consumed (if offering an item).
    /// </summary>
    public string? ConsumedItemId { get; init; }

    /// <summary>
    /// Debt or obligation created (if promising a favor).
    /// </summary>
    public string? DebtCreated { get; init; }

    /// <summary>
    /// Information revealed (if trading information).
    /// </summary>
    public string? InformationRevealed { get; init; }

    /// <summary>
    /// Creates a concession for offering an item of value.
    /// </summary>
    public static Concession OfferItem(string itemId, string itemDescription)
    {
        return new Concession
        {
            Type = ConcessionType.OfferItem,
            Description = $"Offering {itemDescription} as part of the deal",
            DcReduction = 2,
            BonusDice = 2,
            Cost = $"Item '{itemDescription}' will be consumed",
            ConsumedItemId = itemId
        };
    }

    /// <summary>
    /// Creates a concession for promising a future favor.
    /// </summary>
    public static Concession PromiseFavor(string favorDescription)
    {
        return new Concession
        {
            Type = ConcessionType.PromiseFavor,
            Description = $"Promising: {favorDescription}",
            DcReduction = 2,
            BonusDice = 2,
            Cost = "Creates a debt that must be repaid",
            DebtCreated = favorDescription
        };
    }

    /// <summary>
    /// Creates a concession for trading information.
    /// </summary>
    public static Concession TradeInformation(string informationDescription)
    {
        return new Concession
        {
            Type = ConcessionType.TradeInformation,
            Description = $"Revealing: {informationDescription}",
            DcReduction = 4,
            BonusDice = 2,
            Cost = "Information is now known to the NPC",
            InformationRevealed = informationDescription
        };
    }

    /// <summary>
    /// Creates a concession for taking personal risk.
    /// </summary>
    public static Concession TakeRisk(string riskDescription)
    {
        return new Concession
        {
            Type = ConcessionType.TakeRisk,
            Description = $"Accepting risk: {riskDescription}",
            DcReduction = 4,
            BonusDice = 2,
            Cost = riskDescription
        };
    }

    /// <summary>
    /// Creates a concession for putting faction reputation on the line.
    /// </summary>
    public static Concession StakeReputation(string factionId, string stakeDescription)
    {
        return new Concession
        {
            Type = ConcessionType.StakeReputation,
            Description = $"Staking reputation: {stakeDescription}",
            DcReduction = 6,
            BonusDice = 2,
            Cost = "Failure will damage faction reputation significantly"
        };
    }
}

/// <summary>
/// Types of concessions that can be made during negotiation.
/// </summary>
public enum ConcessionType
{
    /// <summary>
    /// Offering a valuable item. DC -2.
    /// </summary>
    OfferItem = 0,

    /// <summary>
    /// Promising a future favor. DC -2.
    /// </summary>
    PromiseFavor = 1,

    /// <summary>
    /// Trading valuable information. DC -4.
    /// </summary>
    TradeInformation = 2,

    /// <summary>
    /// Taking on personal risk. DC -4.
    /// </summary>
    TakeRisk = 3,

    /// <summary>
    /// Putting faction reputation on the line. DC -6.
    /// </summary>
    StakeReputation = 4
}
```

---

## 12. INegotiationService Interface

### 12.1 Definition

```csharp
// Location: src/Application/Interfaces/INegotiationService.cs

namespace RuneRust.Application.Interfaces;

using RuneRust.Domain.Enums;
using RuneRust.Domain.Entities;
using RuneRust.Domain.ValueObjects;

/// <summary>
/// Service interface for managing multi-round negotiations.
/// </summary>
public interface INegotiationService
{
    /// <summary>
    /// Initiates a new negotiation with an NPC.
    /// </summary>
    /// <param name="npcId">The NPC to negotiate with.</param>
    /// <param name="requestComplexity">What the player is asking for.</param>
    /// <returns>The initialized position track.</returns>
    Task<NegotiationPositionTrack> InitiateNegotiationAsync(
        string npcId,
        RequestComplexity requestComplexity);

    /// <summary>
    /// Executes a single round of negotiation.
    /// </summary>
    /// <param name="context">The negotiation context for this round.</param>
    /// <returns>The result of this round.</returns>
    Task<NegotiationRound> ExecuteRoundAsync(NegotiationContext context);

    /// <summary>
    /// Applies a concession and moves the player's position.
    /// </summary>
    /// <param name="positionTrack">The current position track.</param>
    /// <param name="concession">The concession being offered.</param>
    /// <returns>The updated position track.</returns>
    Task<NegotiationPositionTrack> ApplyConcessionAsync(
        NegotiationPositionTrack positionTrack,
        Concession concession);

    /// <summary>
    /// Checks if the negotiation has reached a terminal state.
    /// </summary>
    /// <param name="positionTrack">The position track to check.</param>
    /// <returns>True if negotiation is complete.</returns>
    bool IsNegotiationComplete(NegotiationPositionTrack positionTrack);

    /// <summary>
    /// Finalizes a completed negotiation and returns the result.
    /// </summary>
    /// <param name="positionTrack">The final position track.</param>
    /// <returns>The complete negotiation result.</returns>
    Task<NegotiationResult> FinalizeNegotiationAsync(NegotiationPositionTrack positionTrack);

    /// <summary>
    /// Gets available concession options for the player.
    /// </summary>
    /// <returns>List of available concession types with descriptions.</returns>
    Task<IReadOnlyList<Concession>> GetAvailableConcessionsAsync();

    /// <summary>
    /// Calculates the initial NPC position based on disposition and request.
    /// </summary>
    /// <param name="npcId">The NPC ID.</param>
    /// <param name="requestComplexity">The request complexity.</param>
    /// <returns>The NPC's starting position (0-8).</returns>
    Task<int> CalculateNpcStartPositionAsync(string npcId, RequestComplexity requestComplexity);

    /// <summary>
    /// Gets the NPC's flexibility level (1-3).
    /// </summary>
    /// <param name="npcId">The NPC ID.</param>
    /// <returns>Flexibility level.</returns>
    Task<int> GetNpcFlexibilityAsync(string npcId);
}
```

---

## 13. NegotiationService Implementation

### 13.1 Definition

```csharp
// Location: src/Application/Services/NegotiationService.cs

namespace RuneRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneRust.Application.Interfaces;
using RuneRust.Domain.Enums;
using RuneRust.Domain.Entities;
using RuneRust.Domain.ValueObjects;
using RuneRust.Domain.Extensions;

/// <summary>
/// Service for managing multi-round negotiations.
/// Orchestrates position tracking, tactic execution, and deal resolution.
/// </summary>
public sealed class NegotiationService : INegotiationService
{
    private readonly IPersuasionService _persuasionService;
    private readonly IDeceptionService _deceptionService;
    private readonly IIntimidationService _intimidationService;
    private readonly IDiceRollerService _diceRollerService;
    private readonly IFumbleConsequenceService _fumbleConsequenceService;
    private readonly INpcService _npcService;
    private readonly IInventoryService _inventoryService;
    private readonly IFactionService _factionService;
    private readonly ISocialContextBuilder _socialContextBuilder;
    private readonly ILogger<NegotiationService> _logger;

    public NegotiationService(
        IPersuasionService persuasionService,
        IDeceptionService deceptionService,
        IIntimidationService intimidationService,
        IDiceRollerService diceRollerService,
        IFumbleConsequenceService fumbleConsequenceService,
        INpcService npcService,
        IInventoryService inventoryService,
        IFactionService factionService,
        ISocialContextBuilder socialContextBuilder,
        ILogger<NegotiationService> logger)
    {
        _persuasionService = persuasionService;
        _deceptionService = deceptionService;
        _intimidationService = intimidationService;
        _diceRollerService = diceRollerService;
        _fumbleConsequenceService = fumbleConsequenceService;
        _npcService = npcService;
        _inventoryService = inventoryService;
        _factionService = factionService;
        _socialContextBuilder = socialContextBuilder;
        _logger = logger;
    }

    /// <inheritdoc />
    public async Task<NegotiationPositionTrack> InitiateNegotiationAsync(
        string npcId,
        RequestComplexity requestComplexity)
    {
        _logger.LogInformation(
            "Initiating negotiation with {NpcId}. Request complexity: {Complexity}",
            npcId, requestComplexity);

        int npcStartPosition = await CalculateNpcStartPositionAsync(npcId, requestComplexity);
        int pcStartPosition = CalculatePcStartPosition(requestComplexity);
        int totalRounds = requestComplexity.GetDefaultRounds();

        var track = new NegotiationPositionTrack
        {
            NegotiationId = Guid.NewGuid().ToString(),
            NpcId = npcId,
            RequestComplexity = requestComplexity
        };

        track.Initialize(pcStartPosition, npcStartPosition, totalRounds);

        _logger.LogInformation(
            "Negotiation initialized. PC at {PcPos}, NPC at {NpcPos}, Gap: {Gap}, Rounds: {Rounds}",
            track.PcPosition, track.NpcPosition, track.Gap, totalRounds);

        return track;
    }

    /// <inheritdoc />
    public async Task<NegotiationRound> ExecuteRoundAsync(NegotiationContext context)
    {
        _logger.LogInformation(
            "Executing negotiation round {Round}. Tactic: {Tactic}, Status: {Status}",
            context.PositionTrack.RoundNumber + 1,
            context.SelectedTactic,
            context.PositionTrack.Status);

        // Handle concession tactic separately
        if (context.SelectedTactic == NegotiationTactic.Concede)
        {
            return await ExecuteConcessionRoundAsync(context);
        }

        // Execute the appropriate tactic
        SkillOutcome outcome = await ExecuteTacticCheckAsync(context);

        // Calculate position movement
        var (positionMovement, description) = CalculatePositionMovement(
            context.PositionTrack,
            outcome);

        // Apply position changes
        ApplyPositionMovement(context.PositionTrack, outcome);

        // Calculate costs
        int stressCost = 0;
        int reputationCost = 0;

        if (context.SelectedTactic == NegotiationTactic.Deceive)
        {
            stressCost = outcome switch
            {
                SkillOutcome.Success => 1,
                SkillOutcome.CriticalSuccess => 1,
                SkillOutcome.Failure => 3,
                SkillOutcome.Fumble => 8,
                _ => 0
            };
        }
        else if (context.SelectedTactic == NegotiationTactic.Pressure)
        {
            reputationCost = outcome switch
            {
                SkillOutcome.CriticalSuccess => -3,
                SkillOutcome.Success => -5,
                _ => -10
            };
        }

        // Handle fumble with collapse
        if (outcome == SkillOutcome.Fumble &&
            (context.SelectedTactic == NegotiationTactic.Deceive ||
             context.SelectedTactic == NegotiationTactic.Pressure))
        {
            context.PositionTrack.ForceCollapse();
            _logger.LogWarning(
                "Negotiation collapsed due to fumble on {Tactic} tactic",
                context.SelectedTactic);
        }

        // Clear used concession bonus
        context.PositionTrack.ClearConcessionBonus();

        var round = new NegotiationRound
        {
            RoundNumber = context.PositionTrack.RoundNumber + 1,
            TacticUsed = context.SelectedTactic,
            CheckResult = outcome,
            PositionMovement = description,
            PcPositionAfter = context.PositionTrack.PcPosition,
            NpcPositionAfter = context.PositionTrack.NpcPosition,
            GapAfter = context.PositionTrack.Gap,
            StressCost = stressCost,
            ReputationCost = reputationCost,
            NarrativeDescription = GenerateRoundNarrative(context, outcome)
        };

        context.PositionTrack.RecordRound(round);

        _logger.LogInformation(
            "Round complete. Outcome: {Outcome}, New positions: PC {Pc}, NPC {Npc}, Gap: {Gap}",
            outcome, round.PcPositionAfter, round.NpcPositionAfter, round.GapAfter);

        return round;
    }

    private async Task<NegotiationRound> ExecuteConcessionRoundAsync(NegotiationContext context)
    {
        if (context.ConcessionOffer == null)
        {
            throw new InvalidOperationException("Concede tactic requires a concession offer");
        }

        // Apply concession
        await ApplyConcessionAsync(context.PositionTrack, context.ConcessionOffer);

        var round = new NegotiationRound
        {
            RoundNumber = context.PositionTrack.RoundNumber + 1,
            TacticUsed = NegotiationTactic.Concede,
            CheckResult = null,
            PositionMovement = "PC moved 1 step toward NPC (voluntary concession)",
            PcPositionAfter = context.PositionTrack.PcPosition,
            NpcPositionAfter = context.PositionTrack.NpcPosition,
            GapAfter = context.PositionTrack.Gap,
            ConcessionMade = context.ConcessionOffer,
            StressCost = 0,
            ReputationCost = 0,
            NarrativeDescription = $"You offer a concession: {context.ConcessionOffer.Description}. " +
                                  $"This grants +{context.ConcessionOffer.BonusDice}d10 and " +
                                  $"-{context.ConcessionOffer.DcReduction} DC on your next check."
        };

        context.PositionTrack.RecordRound(round);
        return round;
    }

    private async Task<SkillOutcome> ExecuteTacticCheckAsync(NegotiationContext context)
    {
        int effectiveDc = context.GetEffectiveDc();
        int bonusDice = context.GetConcessionBonusDice();

        return context.SelectedTactic switch
        {
            NegotiationTactic.Persuade => await ExecutePersuadeCheckAsync(context, effectiveDc, bonusDice),
            NegotiationTactic.Deceive => await ExecuteDeceiveCheckAsync(context, effectiveDc, bonusDice),
            NegotiationTactic.Pressure => await ExecutePressureCheckAsync(context, effectiveDc, bonusDice),
            _ => throw new ArgumentException($"Unexpected tactic: {context.SelectedTactic}")
        };
    }

    private async Task<SkillOutcome> ExecutePersuadeCheckAsync(
        NegotiationContext context,
        int effectiveDc,
        int bonusDice)
    {
        // Delegate to persuasion service with negotiation modifiers
        var persuasionResult = await _persuasionService.PersuadeAsync(
            new PersuasionContext
            {
                BaseContext = context.BaseContext,
                RequestType = PersuasionRequest.Moderate, // Mapped from negotiation
                BonusDice = bonusDice,
                EffectiveDcOverride = effectiveDc
            });

        return persuasionResult.Outcome;
    }

    private async Task<SkillOutcome> ExecuteDeceiveCheckAsync(
        NegotiationContext context,
        int effectiveDc,
        int bonusDice)
    {
        var deceptionResult = await _deceptionService.DeceiveAsync(
            new DeceptionContext
            {
                BaseContext = context.BaseContext,
                LieComplexity = LieComplexity.Plausible,
                BonusDice = bonusDice,
                EffectiveDcOverride = effectiveDc
            });

        return deceptionResult.Outcome;
    }

    private async Task<SkillOutcome> ExecutePressureCheckAsync(
        NegotiationContext context,
        int effectiveDc,
        int bonusDice)
    {
        var intimidationResult = await _intimidationService.IntimidateAsync(
            new IntimidationContext
            {
                BaseContext = context.BaseContext,
                TargetType = IntimidationTarget.Common,
                Approach = IntimidationApproach.Mental,
                BonusDice = bonusDice,
                EffectiveDcOverride = effectiveDc
            });

        return intimidationResult.Outcome;
    }

    private (string movement, string description) CalculatePositionMovement(
        NegotiationPositionTrack track,
        SkillOutcome outcome)
    {
        return outcome switch
        {
            SkillOutcome.CriticalSuccess => ("NPC -2", "NPC moved 2 steps toward compromise (critical success)"),
            SkillOutcome.Success => ("NPC -1", "NPC moved 1 step toward compromise (success)"),
            SkillOutcome.Failure => ("PC +1", "PC moved 1 step toward NPC (failure)"),
            SkillOutcome.Fumble => ("PC +2", "PC moved 2 steps toward NPC (fumble)"),
            _ => ("None", "No movement")
        };
    }

    private void ApplyPositionMovement(NegotiationPositionTrack track, SkillOutcome outcome)
    {
        switch (outcome)
        {
            case SkillOutcome.CriticalSuccess:
                track.MoveNpcPosition(2);
                break;
            case SkillOutcome.Success:
                track.MoveNpcPosition(1);
                break;
            case SkillOutcome.Failure:
                track.MovePcPosition(1);
                break;
            case SkillOutcome.Fumble:
                track.MovePcPosition(2);
                break;
        }
    }

    /// <inheritdoc />
    public async Task<NegotiationPositionTrack> ApplyConcessionAsync(
        NegotiationPositionTrack positionTrack,
        Concession concession)
    {
        _logger.LogInformation(
            "Applying concession: {Type}, DC reduction: {Dc}",
            concession.Type, concession.DcReduction);

        // Move PC position 1 step toward NPC
        positionTrack.MovePcPosition(1);

        // Set concession bonus for next round
        positionTrack.SetConcessionBonus(concession);

        // Handle concession costs
        if (concession.ConsumedItemId != null)
        {
            await _inventoryService.RemoveItemAsync(concession.ConsumedItemId);
        }

        return positionTrack;
    }

    /// <inheritdoc />
    public bool IsNegotiationComplete(NegotiationPositionTrack positionTrack)
    {
        return positionTrack.Status.IsTerminal();
    }

    /// <inheritdoc />
    public async Task<NegotiationResult> FinalizeNegotiationAsync(NegotiationPositionTrack positionTrack)
    {
        _logger.LogInformation(
            "Finalizing negotiation. Status: {Status}, Final gap: {Gap}",
            positionTrack.Status, positionTrack.Gap);

        // Calculate totals from history
        int totalStress = positionTrack.History.Sum(r => r.StressCost);
        int totalReputation = positionTrack.History.Sum(r => r.ReputationCost);
        int dispositionChange = CalculateDispositionChange(positionTrack);

        // Determine unlocked options
        var unlockedOptions = await DetermineUnlockedOptionsAsync(positionTrack);

        // Generate deal terms if successful
        string? dealTerms = null;
        if (positionTrack.Status == NegotiationStatus.DealReached)
        {
            dealTerms = GenerateDealTerms(positionTrack);
        }

        FumbleConsequence? fumble = null;
        if (positionTrack.Status == NegotiationStatus.Collapsed &&
            positionTrack.History.Any(r => r.CheckResult == SkillOutcome.Fumble))
        {
            fumble = await _fumbleConsequenceService.CreateConsequenceAsync(
                FumbleType.NegotiationCollapsed,
                new Dictionary<string, object>
                {
                    ["NpcId"] = positionTrack.NpcId,
                    ["RoundsUsed"] = positionTrack.RoundNumber
                });
        }

        var baseResult = new SocialResult
        {
            InteractionType = SocialInteractionType.Negotiation,
            TargetId = positionTrack.NpcId,
            Outcome = positionTrack.Status.IsSuccess() ? SkillOutcome.Success : SkillOutcome.Failure,
            DispositionChange = dispositionChange
        };

        return new NegotiationResult
        {
            BaseResult = baseResult,
            Outcome = positionTrack.Status.IsSuccess() ? SkillOutcome.Success : SkillOutcome.Failure,
            FinalStatus = positionTrack.Status,
            FinalDealTerms = dealTerms,
            FinalPcPosition = positionTrack.PcPosition,
            FinalNpcPosition = positionTrack.NpcPosition,
            RoundsUsed = positionTrack.RoundNumber,
            DispositionChange = dispositionChange,
            ReputationChange = totalReputation,
            TotalStressCost = totalStress,
            UnlockedOptions = unlockedOptions,
            History = positionTrack.History,
            FumbleConsequence = fumble
        };
    }

    /// <inheritdoc />
    public async Task<IReadOnlyList<Concession>> GetAvailableConcessionsAsync()
    {
        var concessions = new List<Concession>();

        // Check inventory for valuable items
        var valuableItems = await _inventoryService.GetValuableItemsAsync();
        foreach (var item in valuableItems.Take(3))
        {
            concessions.Add(Concession.OfferItem(item.Id, item.Name));
        }

        // Always available options
        concessions.Add(Concession.PromiseFavor("A future favor to be named later"));
        concessions.Add(Concession.TradeInformation("Valuable information you possess"));
        concessions.Add(Concession.TakeRisk("Accept a personal risk in the arrangement"));
        concessions.Add(Concession.StakeReputation("faction", "Your faction's reputation backs this deal"));

        return concessions;
    }

    /// <inheritdoc />
    public async Task<int> CalculateNpcStartPositionAsync(string npcId, RequestComplexity requestComplexity)
    {
        var npc = await _npcService.GetNpcAsync(npcId);
        int basePosition = 5; // Start at Compromise

        // Adjust based on request complexity
        int complexityOffset = requestComplexity.GetInitialGap() / 2;
        basePosition += complexityOffset;

        // Adjust based on disposition
        var disposition = await _npcService.GetDispositionAsync(npcId);
        basePosition += disposition switch
        {
            NpcDisposition.Ally => -2,
            NpcDisposition.Friendly => -1,
            NpcDisposition.NeutralPositive => 0,
            NpcDisposition.Neutral => 0,
            NpcDisposition.Unfriendly => 1,
            NpcDisposition.Hostile => 2,
            _ => 0
        };

        return Math.Clamp(basePosition, 3, 7);
    }

    /// <inheritdoc />
    public async Task<int> GetNpcFlexibilityAsync(string npcId)
    {
        var npc = await _npcService.GetNpcAsync(npcId);
        // Flexibility 1-3 based on NPC traits
        if (npc.HasTrait("Stubborn")) return 1;
        if (npc.HasTrait("Reasonable")) return 3;
        return 2;
    }

    private int CalculatePcStartPosition(RequestComplexity complexity)
    {
        // PC starts at a position reflecting their desired outcome
        return complexity switch
        {
            RequestComplexity.FairTrade => 4, // Favorable
            RequestComplexity.SlightAdvantage => 3,
            RequestComplexity.NoticeableAdvantage => 2,
            RequestComplexity.MajorAdvantage => 1,
            RequestComplexity.OneSidedDeal => 0, // Maximum Demand
            _ => 3
        };
    }

    private int CalculateDispositionChange(NegotiationPositionTrack track)
    {
        if (track.Status == NegotiationStatus.DealReached)
        {
            // Fair deals improve disposition, one-sided deals may not
            return track.FinalPcPosition >= 4 ? 5 : 2;
        }
        else if (track.Status == NegotiationStatus.Collapsed)
        {
            return -10;
        }
        return 0;
    }

    private async Task<IReadOnlyList<string>> DetermineUnlockedOptionsAsync(NegotiationPositionTrack track)
    {
        if (track.Status != NegotiationStatus.DealReached)
        {
            return Array.Empty<string>();
        }

        var options = new List<string>
        {
            "Deal terms in effect"
        };

        // Add position-specific unlocks
        if (track.FinalPcPosition <= 3)
        {
            options.Add("Advantageous trade terms");
        }
        if (track.FinalPcPosition <= 2)
        {
            options.Add("Additional favors");
        }

        return options;
    }

    private string GenerateDealTerms(NegotiationPositionTrack track)
    {
        int avgPosition = (track.PcPosition + track.NpcPosition) / 2;

        return avgPosition switch
        {
            <= 2 => "A deal heavily in your favor has been struck.",
            <= 4 => "A favorable arrangement has been reached.",
            5 => "A fair compromise acceptable to both parties.",
            <= 6 => "The terms lean slightly against you, but are acceptable.",
            _ => "You've had to make significant concessions."
        };
    }

    private string GenerateRoundNarrative(NegotiationContext context, SkillOutcome outcome)
    {
        string tacticDesc = context.SelectedTactic switch
        {
            NegotiationTactic.Persuade => "Your persuasive arguments",
            NegotiationTactic.Deceive => "Your carefully crafted misdirection",
            NegotiationTactic.Pressure => "Your intimidating pressure",
            _ => "Your approach"
        };

        return outcome switch
        {
            SkillOutcome.CriticalSuccess => $"{tacticDesc} lands perfectly. The NPC significantly shifts their position.",
            SkillOutcome.Success => $"{tacticDesc} has effect. The NPC moves closer to compromise.",
            SkillOutcome.Failure => $"{tacticDesc} falls flat. You find yourself giving ground.",
            SkillOutcome.Fumble => $"{tacticDesc} backfires badly. Your position weakens considerably.",
            _ => "The negotiation continues."
        };
    }
}
```

---

## 14. NegotiationCollapsed Fumble Consequence

### 14.1 FumbleType Extension

```csharp
// Location: src/Domain/Enums/FumbleType.cs (extension)

// Add to existing FumbleType enum:

/// <summary>
/// Negotiation fumble where a critical failure causes the
/// entire negotiation to collapse, damaging relationships.
/// </summary>
NegotiationCollapsed = 8,
```

### 14.2 Fumble Handler

```csharp
// Location: src/Application/Services/FumbleHandlers/NegotiationCollapsedHandler.cs

namespace RuneRust.Application.Services.FumbleHandlers;

using Microsoft.Extensions.Logging;
using RuneRust.Application.Interfaces;
using RuneRust.Domain.Enums;
using RuneRust.Domain.Entities;

/// <summary>
/// Handles the [Negotiation Collapsed] fumble consequence.
/// </summary>
public sealed class NegotiationCollapsedHandler : IFumbleHandler
{
    private readonly INpcService _npcService;
    private readonly IFactionService _factionService;
    private readonly ILogger<NegotiationCollapsedHandler> _logger;

    public NegotiationCollapsedHandler(
        INpcService npcService,
        IFactionService factionService,
        ILogger<NegotiationCollapsedHandler> logger)
    {
        _npcService = npcService;
        _factionService = factionService;
        _logger = logger;
    }

    public FumbleType HandledType => FumbleType.NegotiationCollapsed;

    public async Task<FumbleConsequence> HandleAsync(FumbleContext context)
    {
        string npcId = context.GetRequiredValue<string>("NpcId");
        int roundsUsed = context.GetValue<int>("RoundsUsed", 1);

        _logger.LogWarning(
            "[Negotiation Collapsed] Handling fumble. NPC: {NpcId}, Rounds used: {Rounds}",
            npcId, roundsUsed);

        // Apply disposition penalty
        await _npcService.ModifyDispositionAsync(npcId, -15);

        // Get NPC faction and apply reputation damage
        var npc = await _npcService.GetNpcAsync(npcId);
        if (!string.IsNullOrEmpty(npc.FactionId))
        {
            await _factionService.ModifyReputationAsync(npc.FactionId, -10);
        }

        _logger.LogInformation(
            "Applied negotiation collapse consequences: -15 disposition, -10 faction reputation");

        return new FumbleConsequence
        {
            FumbleType = FumbleType.NegotiationCollapsed,
            Severity = FumbleSeverity.Moderate,
            Description = "Your negotiation has collapsed catastrophically. " +
                         "The NPC is offended and will not negotiate with you again soon.",
            NarrativeText = $"\"We're done here,\" the {npc.Name} says coldly, turning away. " +
                           "Your fumbled approach has destroyed any chance of reaching a deal.",
            MechanicalEffects = new List<string>
            {
                $"-15 Disposition with {npc.Name}",
                $"-10 Reputation with {npc.FactionId ?? "their faction"}",
                "Cannot negotiate with this NPC for 24 hours",
                "Any items or information offered in concessions may be lost"
            },
            ResolutionOptions = new List<string>
            {
                "Find another way to achieve your goal",
                "Wait for the NPC to cool down",
                "Attempt to repair the relationship through other means"
            },
            Timestamp = DateTime.UtcNow
        };
    }
}
```

---

## 15. Configuration

### 15.1 negotiation-config.json

```json
// Location: src/Configuration/negotiation-config.json

{
  "$schema": "./schemas/negotiation-config.schema.json",
  "version": "0.15.3e",
  "description": "Configuration for multi-round negotiation system",

  "positionTrack": {
    "positions": [
      { "value": 0, "name": "Maximum Demand", "description": "Everything goes to one party" },
      { "value": 1, "name": "Strong+", "description": "Heavily favored deal" },
      { "value": 2, "name": "Strong", "description": "Clearly advantageous" },
      { "value": 3, "name": "Favorable+", "description": "Noticeable advantage" },
      { "value": 4, "name": "Favorable", "description": "Slight advantage" },
      { "value": 5, "name": "Compromise", "description": "Fair deal for both sides" },
      { "value": 6, "name": "Unfavorable", "description": "Slight disadvantage" },
      { "value": 7, "name": "Weak", "description": "Clearly disadvantageous" },
      { "value": 8, "name": "Walk Away", "description": "No deal possible" }
    ],
    "dealCondition": "Gap equals 0 (positions overlap)",
    "collapseCondition": "Either position reaches 8"
  },

  "requestComplexity": [
    {
      "id": "FairTrade",
      "baseDc": 10,
      "initialGap": 2,
      "defaultRounds": 3,
      "displayName": "Fair Trade",
      "description": "An equal exchange where both parties benefit"
    },
    {
      "id": "SlightAdvantage",
      "baseDc": 14,
      "initialGap": 3,
      "defaultRounds": 4,
      "displayName": "Slight Advantage",
      "description": "You're asking for a minor edge in the deal"
    },
    {
      "id": "NoticeableAdvantage",
      "baseDc": 18,
      "initialGap": 4,
      "defaultRounds": 5,
      "displayName": "Noticeable Advantage",
      "description": "You're seeking a clear benefit over them"
    },
    {
      "id": "MajorAdvantage",
      "baseDc": 22,
      "initialGap": 5,
      "defaultRounds": 6,
      "displayName": "Major Advantage",
      "description": "You want a significant gain at their expense"
    },
    {
      "id": "OneSidedDeal",
      "baseDc": 26,
      "initialGap": 6,
      "defaultRounds": 7,
      "displayName": "One-Sided Deal",
      "description": "You want everything in your favor"
    }
  ],

  "tactics": [
    {
      "id": "Persuade",
      "underlyingSystem": "Persuasion",
      "attribute": "WILL",
      "displayName": "Persuade",
      "description": "Make an honest appeal to move the NPC's position",
      "sideEffects": "Fumble: [Trust Shattered] - All persuasion locked with this NPC"
    },
    {
      "id": "Deceive",
      "underlyingSystem": "Deception",
      "attribute": "WILL",
      "displayName": "Deceive",
      "description": "Use misleading claims to gain advantage",
      "sideEffects": "Always: Liar's Burden stress. Fumble: [Lie Exposed] + Negotiation Collapse"
    },
    {
      "id": "Pressure",
      "underlyingSystem": "Intimidation",
      "attribute": "MIGHT/WILL",
      "displayName": "Pressure",
      "description": "Apply intimidating pressure",
      "sideEffects": "Always: Reputation cost. Fumble: [Challenge Accepted] + Combat + Collapse"
    },
    {
      "id": "Concede",
      "underlyingSystem": null,
      "attribute": null,
      "displayName": "Concede",
      "description": "Give ground voluntarily to gain advantage on next check",
      "sideEffects": "Your position moves 1 step toward the NPC's position",
      "bonus": {
        "bonusDice": 2,
        "dcReduction": "varies by concession type"
      }
    }
  ],

  "positionMovement": {
    "CriticalSuccess": { "target": "opponent", "steps": 2, "direction": "towardCompromise" },
    "Success": { "target": "opponent", "steps": 1, "direction": "towardCompromise" },
    "Failure": { "target": "self", "steps": 1, "direction": "towardOpponent" },
    "Fumble": { "target": "self", "steps": 2, "direction": "towardOpponent" },
    "Concede": { "target": "self", "steps": 1, "direction": "towardOpponent", "grantBonus": true }
  },

  "concessionTypes": [
    {
      "id": "OfferItem",
      "dcReduction": 2,
      "bonusDice": 2,
      "displayName": "Offer item of value",
      "cost": "Item is consumed"
    },
    {
      "id": "PromiseFavor",
      "dcReduction": 2,
      "bonusDice": 2,
      "displayName": "Promise future favor",
      "cost": "Creates a debt"
    },
    {
      "id": "TradeInformation",
      "dcReduction": 4,
      "bonusDice": 2,
      "displayName": "Trade information",
      "cost": "Information is revealed"
    },
    {
      "id": "TakeRisk",
      "dcReduction": 4,
      "bonusDice": 2,
      "displayName": "Take personal risk",
      "cost": "You accept a risk or obligation"
    },
    {
      "id": "StakeReputation",
      "dcReduction": 6,
      "bonusDice": 2,
      "displayName": "Stake faction reputation",
      "cost": "Failure damages faction standing significantly"
    }
  ],

  "statusPhases": {
    "Opening": {
      "trigger": "Negotiation starts",
      "description": "Both parties are sizing each other up"
    },
    "Bargaining": {
      "trigger": "After first round",
      "description": "Active negotiation in progress"
    },
    "CrisisManagement": {
      "trigger": "Gap >= 5 OR 2+ consecutive failures",
      "description": "Negotiation at risk of collapse"
    },
    "Finalization": {
      "trigger": "Gap <= 1",
      "description": "Positions close, finalizing terms"
    },
    "DealReached": {
      "trigger": "Gap = 0",
      "description": "Deal concluded successfully"
    },
    "Collapsed": {
      "trigger": "Position = 8 OR fumble in Crisis",
      "description": "Negotiation failed completely"
    }
  },

  "negotiationCollapsedFumble": {
    "id": "NegotiationCollapsed",
    "severity": "Moderate",
    "effects": [
      { "type": "DispositionChange", "amount": -15 },
      { "type": "ReputationChange", "amount": -10 },
      { "type": "NegotiationCooldown", "duration": "24 hours" }
    ]
  }
}
```

---

## 16. Commands

### 16.1 NegotiateCommand

```csharp
// Location: src/Application/Commands/NegotiateCommand.cs

namespace RuneRust.Application.Commands;

using MediatR;
using RuneRust.Domain.Enums;
using RuneRust.Domain.Entities;

/// <summary>
/// Command to initiate a negotiation with an NPC.
/// </summary>
public sealed record NegotiateCommand : IRequest<NegotiationPositionTrack>
{
    /// <summary>
    /// The NPC to negotiate with.
    /// </summary>
    public required string NpcId { get; init; }

    /// <summary>
    /// What the player is asking for.
    /// </summary>
    public required RequestComplexity RequestComplexity { get; init; }
}
```

### 16.2 NegotiationRoundCommand

```csharp
// Location: src/Application/Commands/NegotiationRoundCommand.cs

namespace RuneRust.Application.Commands;

using MediatR;
using RuneRust.Domain.Enums;
using RuneRust.Domain.ValueObjects;

/// <summary>
/// Command to execute a single round of negotiation.
/// </summary>
public sealed record NegotiationRoundCommand : IRequest<NegotiationRound>
{
    /// <summary>
    /// The ID of the active negotiation.
    /// </summary>
    public required string NegotiationId { get; init; }

    /// <summary>
    /// The tactic to use this round.
    /// </summary>
    public required NegotiationTactic Tactic { get; init; }

    /// <summary>
    /// The concession to offer (if using Concede tactic).
    /// </summary>
    public Concession? ConcessionOffer { get; init; }
}
```

---

## 17. User-Facing Changes

### 17.1 Player Experience

| Scenario | Before v0.15.3e | After v0.15.3e |
|----------|-----------------|----------------|
| **Making deals** | Single check, pass/fail | Multi-round negotiation with position tracking |
| **Tactical options** | Fixed approach | Choose Persuade, Deceive, Pressure, or Concede |
| **Progress tracking** | None | Visual position track shows gap closing |
| **Concessions** | Not available | Offer items, favors, info for bonuses |
| **Risk management** | Unknown | See current gap, rounds remaining, crisis state |
| **Deal quality** | Binary result | Final positions determine deal favorability |

### 17.2 Output Format

```
═══════════════════════════════════════════════════════════════════════════════
                           NEGOTIATION - ROUND 2
═══════════════════════════════════════════════════════════════════════════════

Negotiating with: Merchant Bjorn
Request: Exclusive cargo route access (Noticeable Advantage)
Status: Bargaining | Round 2 of 5

───────────────────────────────────────────────────────────────────────────────
                            POSITION TRACK
───────────────────────────────────────────────────────────────────────────────

  Max     Strong    Favor   Compro   Unfav    Weak    Walk
   0    1    2    3    4    5    6    7    8
   ├────┼────┼────┼────┼────┼────┼────┼────┤
   │    │    │    │ PC │    │    │NPC │    │
   └────┴────┴────┴────┴────┴────┴────┴────┘

Gap: 3 (Moderate - standard negotiation)

───────────────────────────────────────────────────────────────────────────────
                            SELECT TACTIC
───────────────────────────────────────────────────────────────────────────────

  [1] Persuade  - Make an honest appeal (WILL + Rhetoric vs DC 18)
  [2] Deceive   - Use misleading claims (WILL + Rhetoric vs NPC WITS)
                  Warning: Incurs stress, fumble collapses negotiation
  [3] Pressure  - Apply intimidating pressure (MIGHT or WILL + Rhetoric)
                  Warning: Costs reputation, fumble triggers combat
  [4] Concede   - Give ground voluntarily
                  Gain: +2d10 and -2 DC on next check
                  Cost: Your position moves 1 step toward NPC

Active Bonus: None

> 4

───────────────────────────────────────────────────────────────────────────────
                         SELECT CONCESSION
───────────────────────────────────────────────────────────────────────────────

  [1] Offer Dvergr Compass (valuable item)     -2 DC, +2d10
  [2] Promise future favor                      -2 DC, +2d10
  [3] Trade information about patrol routes     -4 DC, +2d10
  [4] Accept risk of delayed payment            -4 DC, +2d10
  [5] Stake guild reputation on the deal        -6 DC, +2d10

> 3

═══════════════════════════════════════════════════════════════════════════════
                              ROUND RESULT
═══════════════════════════════════════════════════════════════════════════════

Concession Made: Trade information about patrol routes

"Perhaps if I told you about the northern patrol schedule..." you offer.
Bjorn's eyes narrow with interest. "Now we're talking."

Your position moved from 3 to 4 (voluntary concession)
New gap: 2

ACTIVE FOR NEXT ROUND:
  • +2d10 bonus dice
  • -4 DC reduction

───────────────────────────────────────────────────────────────────────────────

  Max     Strong    Favor   Compro   Unfav    Weak    Walk
   0    1    2    3    4    5    6    7    8
   ├────┼────┼────┼────┼────┼────┼────┼────┤
   │    │    │    │    │ PC │    │NPC │    │
   └────┴────┴────┴────┴────┴────┴────┴────┘

Gap: 2 | Status: Bargaining | Rounds remaining: 3

═══════════════════════════════════════════════════════════════════════════════
```

---

## 18. Logging Specifications

### 18.1 Log Events

| Event | Level | Message Template | Parameters |
|-------|-------|------------------|------------|
| Negotiation Started | Information | `Initiating negotiation with {NpcId}. Request complexity: {Complexity}` | NpcId, Complexity |
| Position Initialized | Information | `Negotiation initialized. PC at {PcPos}, NPC at {NpcPos}, Gap: {Gap}, Rounds: {Rounds}` | PcPos, NpcPos, Gap, Rounds |
| Round Started | Information | `Executing negotiation round {Round}. Tactic: {Tactic}, Status: {Status}` | Round, Tactic, Status |
| Round Complete | Information | `Round complete. Outcome: {Outcome}, New positions: PC {Pc}, NPC {Npc}, Gap: {Gap}` | Outcome, Pc, Npc, Gap |
| Concession Applied | Information | `Applying concession: {Type}, DC reduction: {Dc}` | Type, Dc |
| Negotiation Finalized | Information | `Finalizing negotiation. Status: {Status}, Final gap: {Gap}` | Status, Gap |
| Crisis Triggered | Warning | `Negotiation entered crisis management. Gap: {Gap}, Consecutive failures: {Failures}` | Gap, Failures |
| Collapse | Warning | `Negotiation collapsed due to {Reason}` | Reason |

---

## 19. Unit Testing Requirements

### 19.1 Required Tests (~4)

#### Test 1: Position Track Calculates Gap Correctly

```csharp
[Theory]
[InlineData(2, 6, 4)]
[InlineData(4, 4, 0)]
[InlineData(0, 8, 8)]
[InlineData(5, 5, 0)]
public void PositionTrack_CalculatesGap_Correctly(int pcPos, int npcPos, int expectedGap)
{
    // Arrange
    var track = CreateTrack();
    track.Initialize(pcPos, npcPos, 5);

    // Assert
    Assert.Equal(expectedGap, track.Gap);
}
```

#### Test 2: Success Moves Opponent Position

```csharp
[Fact]
public async Task ExecuteRound_OnSuccess_MovesOpponentTowardCompromise()
{
    // Arrange
    var track = CreateTrack();
    track.Initialize(3, 6, 5);
    int initialNpcPosition = track.NpcPosition;

    SetupSuccessfulRoll();

    // Act
    await _service.ExecuteRoundAsync(CreateContext(track, NegotiationTactic.Persuade));

    // Assert
    Assert.Equal(initialNpcPosition - 1, track.NpcPosition);
}
```

#### Test 3: Failure Moves Self Position

```csharp
[Fact]
public async Task ExecuteRound_OnFailure_MovesSelfTowardOpponent()
{
    // Arrange
    var track = CreateTrack();
    track.Initialize(2, 6, 5);
    int initialPcPosition = track.PcPosition;

    SetupFailedRoll();

    // Act
    await _service.ExecuteRoundAsync(CreateContext(track, NegotiationTactic.Persuade));

    // Assert
    Assert.Equal(initialPcPosition + 1, track.PcPosition);
}
```

#### Test 4: Concession Grants Bonus on Next Check

```csharp
[Fact]
public async Task Concession_GrantsBonusOnNextCheck()
{
    // Arrange
    var track = CreateTrack();
    track.Initialize(3, 6, 5);
    var concession = Concession.TradeInformation("Patrol routes");

    // Act
    await _service.ApplyConcessionAsync(track, concession);

    // Assert
    Assert.NotNull(track.ActiveConcession);
    Assert.Equal(4, track.ActiveConcession.DcReduction);
    Assert.Equal(2, track.ActiveConcession.BonusDice);
}
```

---

## 20. Use Cases

### 20.1 Standard Negotiation Flow

**Scenario**: Player negotiates with a merchant for exclusive trade rights.

1. Player initiates negotiation (NoticeableAdvantage, DC 18)
2. Positions: PC at 2, NPC at 6 (Gap: 4)
3. Round 1: Persuade, fails - PC moves to 3 (Gap: 3)
4. Round 2: Concede (offer item) - PC moves to 4, gains bonus
5. Round 3: Persuade with bonus, critical success - NPC moves to 4 (Gap: 0)
6. Deal reached at position 4 (Favorable for PC)

### 20.2 Crisis and Recovery

**Scenario**: Negotiation enters crisis, player recovers with concession.

1. Gap widens to 5 (Crisis Management triggered)
2. Player uses Concede to gain bonus and reduce gap
3. Next round: uses bonus for successful check
4. Gap closes, exits crisis, reaches deal

### 20.3 Collapse from Fumble

**Scenario**: Deception fumble causes negotiation collapse.

1. Player uses Deceive tactic in round 3
2. Fumble occurs (0 successes, 1+ botch)
3. [Lie Exposed] triggers
4. Negotiation immediately collapses
5. -15 disposition, -10 reputation applied

---

## 21. Deliverable Checklist

| Item | File | Status |
|------|------|--------|
| `NegotiationStatus` enum | `Domain/Enums/NegotiationStatus.cs` | ☐ |
| `NegotiationStatusExtensions` | `Domain/Extensions/NegotiationStatusExtensions.cs` | ☐ |
| `NegotiationTactic` enum | `Domain/Enums/NegotiationTactic.cs` | ☐ |
| `NegotiationTacticExtensions` | `Domain/Extensions/NegotiationTacticExtensions.cs` | ☐ |
| `RequestComplexity` enum | `Domain/Enums/RequestComplexity.cs` | ☐ |
| `RequestComplexityExtensions` | `Domain/Extensions/RequestComplexityExtensions.cs` | ☐ |
| `NegotiationPositionTrack` entity | `Domain/Entities/NegotiationPositionTrack.cs` | ☐ |
| `NegotiationRound` value object | `Domain/ValueObjects/NegotiationRound.cs` | ☐ |
| `NegotiationContext` value object | `Domain/ValueObjects/NegotiationContext.cs` | ☐ |
| `NegotiationResult` value object | `Domain/ValueObjects/NegotiationResult.cs` | ☐ |
| `Concession` value object | `Domain/ValueObjects/Concession.cs` | ☐ |
| `ConcessionType` enum | `Domain/ValueObjects/Concession.cs` | ☐ |
| `INegotiationService` interface | `Application/Interfaces/INegotiationService.cs` | ☐ |
| `NegotiationService` implementation | `Application/Services/NegotiationService.cs` | ☐ |
| `FumbleType.NegotiationCollapsed` | `Domain/Enums/FumbleType.cs` | ☐ |
| `NegotiationCollapsedHandler` | `Application/Services/FumbleHandlers/NegotiationCollapsedHandler.cs` | ☐ |
| `NegotiateCommand` | `Application/Commands/NegotiateCommand.cs` | ☐ |
| `NegotiationRoundCommand` | `Application/Commands/NegotiationRoundCommand.cs` | ☐ |
| `negotiation-config.json` | `Configuration/negotiation-config.json` | ☐ |
| DI Registration | `Infrastructure/DependencyInjection.cs` | ☐ |

---

## 22. Acceptance Criteria

### 22.1 Functional Requirements

- [ ] **AC-1**: Position track correctly tracks PC and NPC positions (0-8)
- [ ] **AC-2**: Gap calculates as absolute difference between positions
- [ ] **AC-3**: `RequestComplexity` provides correct DCs (10, 14, 18, 22, 26)
- [ ] **AC-4**: Critical success moves opponent 2 steps
- [ ] **AC-5**: Success moves opponent 1 step
- [ ] **AC-6**: Failure moves self 1 step toward opponent
- [ ] **AC-7**: Fumble moves self 2 steps toward opponent
- [ ] **AC-8**: Concede moves self 1 step and grants +2d10, DC reduction
- [ ] **AC-9**: Deal reached when gap = 0
- [ ] **AC-10**: Negotiation collapses when position reaches 8
- [ ] **AC-11**: Crisis Management triggers at gap >= 5 or 2+ failures
- [ ] **AC-12**: Deceive tactic incurs Liar's Burden stress
- [ ] **AC-13**: Pressure tactic incurs reputation cost
- [ ] **AC-14**: Fumble on Deceive/Pressure causes collapse
- [ ] **AC-15**: Concession bonuses apply to next check only

### 22.2 Integration Requirements

- [ ] **AC-16**: Persuade tactic delegates to PersuasionService
- [ ] **AC-17**: Deceive tactic delegates to DeceptionService
- [ ] **AC-18**: Pressure tactic delegates to IntimidationService
- [ ] **AC-19**: Uses SocialContextBuilder from v0.15.3a
- [ ] **AC-20**: Fumble consequences use FumbleConsequenceService

### 22.3 Quality Requirements

- [ ] **AC-21**: All unit tests pass (~4 tests)
- [ ] **AC-22**: Code follows project conventions
- [ ] **AC-23**: Logging follows specifications
- [ ] **AC-24**: Configuration file validates against schema

---

## 23. Future Considerations

### 23.1 v0.15.3f Integration (Interrogation System)

Interrogation may use negotiation-like position tracking:
- Subject resistance as NPC position
- Methods as tactics
- Information as the "deal" being negotiated

### 23.2 v0.15.3g Integration (Cultural Protocols)

Cultural modifiers for negotiation:
- Dvergr prefer logical concessions (-2 DC for information trades)
- Utgard expect indirect approaches (Deceive DC -4)
- Iron-Bane respect shows of strength (Pressure less rep cost)

### 23.3 v0.15.3i Integration (Specialization)

Kupmaðr specialization abilities:
- [Silver Tongue]: Auto-succeed negotiation DC <= 12
- [Sniff Out Lies]: Detect NPC deception attempts
- [Master Haggler]: Start at +1 favorable position

---

## 24. Implementation Notes

### 24.1 Design Decisions

1. **Multi-Round Structure**: Negotiation as extended skill challenge creates strategic depth beyond single checks.

2. **Four Tactics**: Each tactic maps to an existing social system (Persuade/Deceive/Pressure) or provides strategic option (Concede).

3. **Position Track Visualization**: Visual representation helps players understand progress and plan tactics.

4. **Concession System**: Voluntary sacrifices provide meaningful player agency and risk/reward decisions.

5. **Crisis Management**: Phase system adds tension and stakes to negotiations.

### 24.2 Performance Considerations

1. **State Management**: NegotiationPositionTrack should be cached during active negotiations.

2. **Service Delegation**: Tactic execution delegates to existing services to avoid duplication.

### 24.3 Error Handling

1. **Invalid Tactic**: Validate tactic is allowed given current state.
2. **Missing Concession**: Concede tactic requires concession offer.
3. **Completed Negotiation**: Reject rounds after terminal state reached.

---

## 25. Document Metadata

| Property | Value |
|----------|-------|
| **Document ID** | DS-0.15.3e |
| **Version** | 0.15.3e |
| **Status** | Draft |
| **Author** | Claude |
| **Created** | 2026-01-17 |
| **Last Modified** | 2026-01-17 |
| **Prerequisites** | v0.15.3a, v0.15.3b, v0.15.3c, v0.15.3d |
| **Successors** | v0.15.3f (Interrogation System) |

### 25.1 Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 0.15.3e-draft | 2026-01-17 | Claude | Initial draft |

### 25.2 Related Documents

| Document | Relationship |
|----------|--------------|
| v0.15.x-overview.md | Parent overview |
| v0.15.3-scope-breakdown.md | Requirements source |
| v0.15.3a-design-specification.md | Dependency (Social Framework) |
| v0.15.3b-design-specification.md | Dependency (Persuasion - Persuade tactic) |
| v0.15.3c-design-specification.md | Dependency (Deception - Deceive tactic) |
| v0.15.3d-design-specification.md | Dependency (Intimidation - Pressure tactic) |
| v0.15.3f-design-specification.md | Successor (Interrogation) |

---

*End of v0.15.3e Design Specification*
