# v0.14.10c Changelog - Codex Schema

**Release Date:** 2026-01-22
**Version:** 0.14.10c
**Parent:** v0.14.10 (Game Systems Configuration Schemas)
**Prerequisites:** v0.14.10b (Quest Schema), v0.14.9e (Capture Template Schema) Complete

---

## Overview

This version introduces the **Codex Schema** (`codex.schema.json`), a comprehensive JSON Schema Draft-07 specification for validating codex/journal entry definitions. The schema enables progressive revelation mechanics where knowledge unlocks in stages (Fragment → Partial → Complete → Mastery) as players collect Data Captures and complete gameplay objectives.

The Codex Schema integrates with:
- **Capture Template Schema (v0.14.9e)** - Keyword matching and capture type requirements
- **Quest Schema (v0.14.10b)** - QuestComplete unlock condition type
- **Faction Schema (v0.14.10a)** - FactionReputation unlock condition type

---

## Added

### Schema File
- `config/schemas/codex.schema.json` - JSON Schema Draft-07 with 9 definitions

### Schema Definitions

| Definition | Description |
|------------|-------------|
| **CodexCategory** | Category for organizing entries with subcategories |
| **CodexSubcategory** | Subcategory within a parent category |
| **CodexEntry** | Complete entry with sections, keywords, unlock conditions, and relations |
| **EntrySection** | Progressive content section with unlock thresholds |
| **UnlockCondition** | Polymorphic unlock condition (8 types) |
| **EntryRelation** | Typed relationship to other entries (5 types) |
| **ProgressionLevel** | Revelation stage definition (4 levels) |
| **ProgressionReward** | Reward granted at progression levels (4 types) |
| **ProgressionDefaults** | Default progression configuration |

### Unlock Condition Types (8 Types)

| Type | Parameters | Description |
|------|------------|-------------|
| `CaptureCollected` | captureId, minQuality? | Data Capture obtained |
| `QuestComplete` | questId, objectiveId? | Quest or objective completed |
| `EnemyKilled` | enemyId, count?, bossOnly? | Enemy defeats |
| `LocationVisited` | locationId | Location discovered |
| `ItemObtained` | itemId, quantity? | Item acquired |
| `FactionReputation` | factionId, minReputation/standing | Faction standing |
| `LevelReached` | minLevel | Player level threshold |
| `ManualUnlock` | triggerId | Script/event trigger |

### Entry Relation Types (5 Types)

| Type | Description |
|------|-------------|
| `SeeAlso` | General related content |
| `Prerequisite` | Should read before this entry |
| `Sequel` | Continues this entry's topic |
| `Contradiction` | Contains conflicting information |
| `Expansion` | Provides additional detail |

### Progression Levels (4 Levels)

| Level | Threshold | Description |
|-------|-----------|-------------|
| `Fragment` | 0.25 | Basic outline and introduction |
| `Partial` | 0.50 | Core details and primary information |
| `Complete` | 0.75 | Full content with advanced details |
| `Mastery` | 1.00 | Expert insights and hidden lore |

### Capture Type Requirements (6 Types)

| Type | Source |
|------|--------|
| `TextFragment` | Written documents, notes, journals |
| `EchoRecording` | Audio memories, Echo Stones |
| `VisualRecord` | Images, paintings, photographs |
| `Specimen` | Physical samples, artifacts |
| `OralHistory` | NPC conversations, stories |
| `RunicTrace` | Runic patterns, magical residue |

### Standard Categories (6 Categories)

| Category | Description |
|----------|-------------|
| `lore` | Historical events, myths, and world history |
| `bestiary` | Creatures, enemies, and wildlife |
| `items` | Equipment, artifacts, and consumables |
| `locations` | Places, regions, and landmarks |
| `characters` | Notable NPCs and historical figures |
| `mechanics` | Game systems and runic crafting knowledge |

### Era Classifications (4 Eras)

| Era | Description |
|-----|-------------|
| `pre-blight` | Before the catastrophic event |
| `blight` | During the catastrophe |
| `post-blight` | After the catastrophe |
| `unknown` | Unknown or uncertain time period |

### Configuration File
- `config/codex.json` - 6 example entries demonstrating:
  - `codex-blight-001` - Lore entry with CaptureCollected unlock
  - `codex-beast-001` - Bestiary entry with EnemyKilled unlock
  - `codex-location-001` - Location entry with LocationVisited unlock
  - `codex-faction-001` - Character entry with FactionReputation unlock
  - `codex-item-001` - Item entry with ItemObtained unlock
  - `codex-mech-001` - Mechanics entry with AND condition logic

### Unit Tests
- `tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/CodexSchemaTests.cs`
- 55 unit tests covering:
  - COD-001: Schema loads and contains 9 definitions
  - COD-002: Entry identity validation (pattern, title)
  - COD-003: Category and subcategory validation
  - COD-004: All 8 unlock condition types
  - COD-005: Progression levels and section thresholds
  - COD-006: Capture requirements and relation types

---

## Technical Details

### Schema Patterns

| Pattern | Convention | Example |
|---------|------------|---------|
| Entry ID | `codex-{category}-{number}` | `codex-blight-001` |
| Category ID | lowercase kebab-case | `lore`, `bestiary` |
| Section ID | `section-{name}` | `section-overview` |
| Unlock types | PascalCase | `CaptureCollected`, `QuestComplete` |
| Relation types | PascalCase | `SeeAlso`, `Prerequisite` |
| Progression levels | PascalCase | `Fragment`, `Mastery` |

### Schema Constraints

| Field | Constraint |
|-------|------------|
| `entry.id` | Pattern: `^codex-[a-z][a-z0-9-]*-\d{3}$` |
| `entry.title` | minLength: 1, maxLength: 100 |
| `entry.summary` | maxLength: 500 |
| `entry.sections` | minItems: 1 |
| `entry.totalFragments` | 1-20, default: 4 |
| `entry.legendValue` | 1-100, default: 10 |
| `section.unlockThreshold` | 0.0-1.0 |
| `section.content` | minLength: 1 |
| `category.name` | minLength: 1, maxLength: 50 |
| `categories` | minItems: 1 |

### Integration Points

```
Capture Template Schema (v0.14.9e)
├── matchKeywords[] → captures correlate via keyword overlap
└── captureRequirement → TextFragment, EchoRecording, VisualRecord,
                          Specimen, OralHistory, RunicTrace

Quest Schema (v0.14.10b)
├── UnlockCondition.QuestComplete → questId reference
└── UnlockCondition.objectiveId → optional objective

Faction Schema (v0.14.10a)
├── UnlockCondition.FactionReputation → factionId reference
└── standing → Hostile, Unfriendly, Neutral, Friendly, Honored, Revered, Exalted
```

---

## Test Results

```
Test summary: total: 55, failed: 0, succeeded: 55, skipped: 0
Build succeeded with 0 errors
```

---

## Files Changed

| File | Change Type | Description |
|------|-------------|-------------|
| `config/schemas/codex.schema.json` | Added | Codex schema with 9 definitions |
| `config/codex.json` | Added | 6 example entries in 6 categories |
| `tests/.../Schemas/CodexSchemaTests.cs` | Added | 55 unit tests |
| `docs/design/v0.14.x/v0.14.10-scope-breakdown.md` | Updated | Mark v0.14.10c criteria |
| `docs/design/v0.14.x/v0.14.x-overview.md` | Updated | Mark codex schema complete |
| `changelogs/v0.14.10c-changelog.md` | Added | This changelog |

---

## Next Steps

- **v0.14.10d** - Commands Schema (command syntax)
- **v0.14.10e** - Glossary Schema (game terminology)
- **v0.14.10f** - Stances Schema (combat stances)

---

*End of v0.14.10c Changelog*
