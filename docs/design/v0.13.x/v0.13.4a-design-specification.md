# v0.13.4a Design Specification: Achievement Panel

**Version:** 0.13.4a
**Parent:** v0.13.4 (Achievements & Statistics UI)
**Prerequisites:** v0.13.3 Complete (Crafting UI), v0.12.x Complete (Achievements & Statistics Services)
**Status:** Design Complete
**Estimated Unit Tests:** ~8

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Achievement Panel Component](#4-achievement-panel-component)
   - 4.1 [AchievementPanel Class](#41-achievementpanel-class)
   - 4.2 [Category Filtering](#42-category-filtering)
   - 4.3 [Panel Header and Summary](#43-panel-header-and-summary)
5. [Achievement Category View](#5-achievement-category-view)
   - 5.1 [AchievementCategoryView Class](#51-achievementcategoryview-class)
   - 5.2 [Category Icons and Colors](#52-category-icons-and-colors)
6. [Achievement Card](#6-achievement-card)
   - 6.1 [AchievementCard Class](#61-achievementcard-class)
   - 6.2 [Status Indicators](#62-status-indicators)
   - 6.3 [Secret Achievement Handling](#63-secret-achievement-handling)
7. [Rarity Badge](#7-rarity-badge)
   - 7.1 [RarityBadge Class](#71-raritybadge-class)
   - 7.2 [Tier Colors and Point Values](#72-tier-colors-and-point-values)
8. [Progress Bar Renderer](#8-progress-bar-renderer)
   - 8.1 [ProgressBarRenderer Class](#81-progressbarrenderer-class)
   - 8.2 [Progress Visualization](#82-progress-visualization)
9. [Achievement Unlock Notification](#9-achievement-unlock-notification)
   - 9.1 [AchievementUnlockNotification Class](#91-achievementunlocknotification-class)
   - 9.2 [Notification Display](#92-notification-display)
10. [Achievements Command](#10-achievements-command)
11. [Data Model Changes](#11-data-model-changes)
12. [Configuration File Schemas](#12-configuration-file-schemas)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Use Cases](#15-use-cases)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies](#18-dependencies)
19. [Future Considerations](#19-future-considerations)

---

## 1. Executive Summary

This version implements the achievement panel UI component that displays all achievements organized by category, with progress bars for incremental achievements, rarity tier badges, and unlock notifications. The panel integrates with the existing `IAchievementService` from v0.12.x to retrieve achievement definitions and player progress.

### Key Deliverables

| Category | Items |
|----------|-------|
| **UI Components** | `AchievementPanel`, `AchievementCategoryView`, `AchievementCard`, `RarityBadge` |
| **Renderers** | `ProgressBarRenderer` |
| **Notifications** | `AchievementUnlockNotification` |
| **Commands** | `AchievementsCommand` |
| **DTOs** | `AchievementDisplayDto`, `AchievementProgressDisplayDto`, `AchievementCategoryDisplayDto` |
| **Configuration** | `achievement-panel.json` |
| **Tests** | ~8 unit tests |

### Architectural Significance

This version establishes the **Achievement Display Pattern** for achievement-related UI:
- Achievements organized by category with filter tabs
- Status indicators (`[x]`, `[~]`, `( )`, `[L]`) for unlock state
- Rarity badges (Bronze, Silver, Gold, Platinum) with point values
- Progress bars for incremental achievement tracking
- Secret achievement handling (hidden until unlocked)
- The pattern supports integration with achievement events and notifications

---

## 2. Feature Overview

```
v0.13.4a Features
├── AchievementPanel (UI Component)
│   ├── RenderAchievements(IEnumerable<AchievementDefinition>, IEnumerable<AchievementProgress>)
│   ├── FilterByCategory(AchievementCategory)
│   ├── ShowTotalProgress(int unlocked, int total)
│   └── ShowTotalPoints(int points)
│
├── AchievementCategoryView (UI Component)
│   ├── RenderCategory(AchievementCategory, IEnumerable<AchievementDefinition>)
│   ├── GetCategoryIcon(AchievementCategory)
│   └── GetCategoryColor(AchievementCategory)
│
├── AchievementCard (UI Component)
│   ├── RenderAchievement(AchievementDefinition, AchievementProgress)
│   ├── ShowProgress(int current, int target)
│   ├── ShowUnlockStatus(bool isUnlocked)
│   └── ShowSecretPlaceholder()
│
├── RarityBadge (UI Component)
│   ├── RenderBadge(AchievementRarity)
│   ├── GetRarityColor(AchievementRarity)
│   └── GetPointValue(AchievementRarity)
│
├── ProgressBarRenderer (Renderer)
│   ├── RenderProgressBar(int current, int target, int width)
│   ├── FormatPercentage(int current, int target)
│   └── GetProgressColor(float percentage)
│
├── AchievementUnlockNotification (Notification)
│   ├── ShowUnlock(AchievementDefinition)
│   ├── ShowPointsEarned(int points)
│   └── GetDuration()
│
├── Achievement Categories
│   ├── Combat: Battle-related achievements
│   ├── Exploration: Discovery achievements
│   ├── Progression: Leveling/advancement
│   ├── Collection: Gathering/collecting
│   └── Challenge: Special/hard achievements
│
├── Status Indicators
│   ├── [x] - Unlocked (completed)
│   ├── [~] - In progress (partially complete)
│   ├── ( ) - Not started (0% progress)
│   └── [L] - Locked (secret, unrevealed)
│
├── Rarity Tiers
│   ├── Bronze (10 points) - Common
│   ├── Silver (25 points) - Moderate
│   ├── Gold (50 points) - Challenging
│   └── Platinum (100 points) - Elite
│
└── AchievementsCommand
    ├── Parse "achievements" input
    └── Open achievement panel
```

### Scope Verification

| Feature | Source | Included |
|---------|--------|----------|
| Achievement panel with full browser | v0.13.4-scope-breakdown.md | Yes |
| Achievement categories | v0.13.4-scope-breakdown.md | Yes |
| Progress bars for incremental achievements | v0.13.4-scope-breakdown.md | Yes |
| Achievement notifications on unlock | v0.13.4-scope-breakdown.md | Yes |
| Rarity tier badges | v0.13.4-scope-breakdown.md | Yes |
| Secret achievement handling | v0.13.4-scope-breakdown.md | Yes |
| Statistics dashboard | v0.13.4-scope-breakdown.md | No (v0.13.4b) |
| Leaderboard view | v0.13.4-scope-breakdown.md | No (v0.13.4c) |
| Dice history panel | v0.13.4-scope-breakdown.md | No (v0.13.4d) |

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          PRESENTATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │    MainMenuView         │      │    AchievementPanel     │               │
│  │    (existing)           │◄────▶│    (NEW)                │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - HandleAchievements()  │      │ - RenderAchievements()  │               │
│  │ - IntegrateCommands()   │      │ - FilterByCategory()    │               │
│  │ - ShowNotifications()   │      │ - ShowTotalProgress()   │               │
│  └─────────────────────────┘      │ - ShowTotalPoints()     │               │
│                                    └───────────┬─────────────┘               │
│                                                │                             │
│  ┌─────────────────────────┐      ┌────────────┴────────────┐               │
│  │  AchievementCategoryView│◄────▶│    AchievementCard      │               │
│  │  (NEW)                  │      │    (NEW)                │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderCategory()      │      │ - RenderAchievement()   │               │
│  │ - GetCategoryIcon()     │      │ - ShowProgress()        │               │
│  │ - GetCategoryColor()    │      │ - ShowUnlockStatus()    │               │
│  └─────────────────────────┘      │ - ShowSecretPlaceholder()│               │
│                                    └───────────┬─────────────┘               │
│                                                │                             │
│  ┌─────────────────────────┐      ┌────────────┴────────────┐               │
│  │      RarityBadge        │◄────▶│   ProgressBarRenderer   │               │
│  │      (NEW)              │      │   (NEW)                 │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderBadge()         │      │ - RenderProgressBar()   │               │
│  │ - GetRarityColor()      │      │ - FormatPercentage()    │               │
│  │ - GetPointValue()       │      │ - GetProgressColor()    │               │
│  └─────────────────────────┘      └─────────────────────────┘               │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                 AchievementUnlockNotification (NEW)                      │ │
│  ├─────────────────────────────────────────────────────────────────────────┤ │
│  │ - ShowUnlock()             - ShowPointsEarned()          - GetDuration()│ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          APPLICATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    AchievementService (existing v0.12.x)            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetAllAchievements() : IReadOnlyList<AchievementDefinition>       │    │
│  │ + GetPlayerProgress(player) : IReadOnlyList<AchievementProgress>    │    │
│  │ + GetAchievementsByCategory(cat) : IReadOnlyList<AchievementDef>    │    │
│  │ + GetUnlockedCount(player) : int                                    │    │
│  │ + GetTotalPoints(player) : int                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IAchievementEventService (existing v0.12.x)      │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + OnAchievementUnlocked : Event<AchievementUnlockedEventArgs>       │    │
│  │ + OnProgressUpdated : Event<AchievementProgressEventArgs>           │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │  AchievementDefinition  │      │   AchievementProgress   │               │
│  │   (existing v0.12.x)    │      │   (existing v0.12.x)    │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + Id: string            │      │ + AchievementId: string │               │
│  │ + Name: string          │      │ + CurrentValue: int     │               │
│  │ + Description: string   │      │ + TargetValue: int      │               │
│  │ + Category: AchieveCat  │      │ + IsUnlocked: bool      │               │
│  │ + Rarity: AchieveRarity │      │ + UnlockedAt: DateTime? │               │
│  │ + TargetValue: int      │      │ + Percentage: double    │               │
│  │ + IsSecret: bool        │      └─────────────────────────┘               │
│  │ + PointValue: int       │                                                 │
│  └─────────────────────────┘                                                 │
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │   AchievementCategory   │      │   AchievementRarity     │               │
│  │   (existing v0.12.x)    │      │   (existing v0.12.x)    │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + Combat                │      │ + Bronze (10 pts)       │               │
│  │ + Exploration           │      │ + Silver (25 pts)       │               │
│  │ + Progression           │      │ + Gold (50 pts)         │               │
│  │ + Collection            │      │ + Platinum (100 pts)    │               │
│  │ + Challenge             │      └─────────────────────────┘               │
│  └─────────────────────────┘                                                 │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Achievement Panel Display Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ACHIEVEMENT PANEL DISPLAY FLOW                            │
└─────────────────────────────────────────────────────────────────────────────┘

    User enters "achievements" command
           │
           ▼
┌─────────────────────────┐
│   AchievementsCommand   │
│   Execute()             │
└───────────┬─────────────┘
            │
            │ 1. Get all achievements and player progress
            ▼
┌─────────────────────────────────────────────────────────────┐
│    AchievementService                                        │
│                                                              │
│  ┌───────────────────────┐  ┌───────────────────────┐       │
│  │ GetAllAchievements()  │  │ GetPlayerProgress()   │       │
│  └───────────┬───────────┘  └───────────┬───────────┘       │
│              │                          │                    │
│              │ Returns definitions      │ Returns progress   │
└──────────────┼──────────────────────────┼───────────────────┘
               │                          │
               │ 2. Map to display DTOs   │
               ▼                          ▼
┌─────────────────────────────────────────────────────────────┐
│    AchievementPanel                                          │
│                                                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ RenderHeader()                                         │  │
│  │ - "ACHIEVEMENTS"                                       │  │
│  │ - Total Points: ### | Unlocked: ##/## (##%)           │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                   │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ RenderFilterTabs()                                     │  │
│  │ [All] [Combat] [Exploration] [Progression] ...        │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                   │
│                          │ 3. Group by category              │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ GroupByCategory() then ApplyFilter()                   │  │
│  └───────────┬───────────────────────────────────────────┘  │
│              │                                               │
│              │ 4. Render each achievement card               │
└──────────────┼───────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│    AchievementCategoryView                                   │
│                                                              │
│  RenderCategory(category, achievements)                      │
│  - Header: "COMBAT ACHIEVEMENTS"                             │
│  - For each achievement:                                     │
│              │                                               │
│              ▼                                               │
│    ┌─────────────────────────────────────────────────────┐  │
│    │ AchievementCard                                      │  │
│    │                                                      │  │
│    │ RenderAchievement(definition, progress)             │  │
│    │ - Status indicator: [x], [~], ( ), [L]              │  │
│    │ - Name and description                               │  │
│    │ - RarityBadge (Bronze/Silver/Gold/Platinum)         │  │
│    │ - ProgressBarRenderer (progress bar)                │  │
│    └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│    RarityBadge                                               │
│                                                              │
│  RenderBadge(rarity)                                         │
│  - GetRarityColor(rarity)   → Bronze=Brown, Silver=Gray, etc│
│  - GetPointValue(rarity)    → 10, 25, 50, 100               │
│  - Format: "Bronze (10)"                                     │
└─────────────────────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│    ProgressBarRenderer                                       │
│                                                              │
│  RenderProgressBar(current, target, width)                   │
│  - FormatPercentage(current, target) → "47%"                │
│  - GetProgressColor(percentage) → Color based on completion  │
│  - Format: "[####################....................] 47%"  │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 Achievement Unlock Notification Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    ACHIEVEMENT UNLOCK NOTIFICATION FLOW                      │
└─────────────────────────────────────────────────────────────────────────────┘

    Achievement Unlocked Event Triggered
           │
           ▼
┌─────────────────────────────�
│  IAchievementEventService   │
│  OnAchievementUnlocked      │
└───────────┬─────────────────┘
            │
            │ Event args contain:
            │ - AchievementId
            │ - PlayerId
            │ - UnlockedAt
            ▼
┌─────────────────────────────────────────────────────────────┐
│    NotificationManager (or direct call)                      │
│                                                              │
│  Subscribe to OnAchievementUnlocked event                    │
│              │                                               │
│              │ Retrieve achievement definition               │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ AchievementService.GetAchievementById(achievementId)  │  │
│  └───────────────────────────────────────────────────────┘  │
└──────────────┼───────────────────────────────────────────────┘
               │
               │ Create notification
               ▼
┌─────────────────────────────────────────────────────────────┐
│    AchievementUnlockNotification                             │
│                                                              │
│  ShowUnlock(achievementDefinition)                           │
│              │                                               │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Display notification popup:                            │  │
│  │                                                        │  │
│  │ +=====================================================+│  │
│  │ |  [!]  ACHIEVEMENT UNLOCKED!                         |│  │
│  │ +=====================================================+│  │
│  │ |                                                     |│  │
│  │ |  MONSTER SLAYER                                     |│  │
│  │ |  Defeat 100 monsters                                |│  │
│  │ |                                                     |│  │
│  │ |  Silver   |   +25 Points                            |│  │
│  │ +=====================================================+│  │
│  └───────────────────────────────────────────────────────┘  │
│              │                                               │
│              │ Auto-dismiss after duration (5 seconds)       │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ GetDuration() → 5 seconds                              │  │
│  │ StartDismissTimer()                                    │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3.4 Category Filter Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CATEGORY FILTER FLOW                                      │
└─────────────────────────────────────────────────────────────────────────────┘

    User Presses Category Tab Key (1-6)
           │
           ▼
┌─────────────────────────────┐
│    AchievementPanel         │
│    HandleFilterInput()      │
└───────────┬─────────────────┘
            │
            │ Determine selected filter
            ▼
┌─────────────────────────────────────────────────────────────┐
│  Key Mapping                                                 │
│                                                              │
│  Key 1 = All (null filter)                                  │
│  Key 2 = Combat (AchievementCategory.Combat)                │
│  Key 3 = Exploration (AchievementCategory.Exploration)      │
│  Key 4 = Progression (AchievementCategory.Progression)      │
│  Key 5 = Collection (AchievementCategory.Collection)        │
│  Key 6 = Challenge (AchievementCategory.Challenge)          │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ Set active filter
            ▼
┌─────────────────────────────┐
│  FilterByCategory(category?)│
└───────────┬─────────────────┘
            │
            ├─── Filter = null ──────► Show all achievements
            │
            │ Filter != null
            ▼
┌─────────────────────────────────────────────────────────────┐
│  Filter achievements by category                             │
│                                                              │
│  filteredAchievements = achievements                        │
│      .Where(a => a.Category == filter)                      │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ Update filter tab highlighting
            ▼
┌─────────────────────────────┐
│  RenderFilterTabs()         │
│  (highlight active tab)     │
└───────────┬─────────────────┘
            │
            │ Re-render with filtered achievements
            ▼
┌─────────────────────────────┐
│  RenderAchievements()       │
│  (filtered set)             │
└─────────────────────────────┘
```

---

## 4. Achievement Panel Component

### 4.1 AchievementPanel Class

**Purpose:** Displays the full achievement browser organized by category with summary header and filter tabs.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/AchievementPanel.cs`

```csharp
using RuneAndRust.Application.DTOs;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Configuration;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays the player's achievements organized by category.
/// </summary>
/// <remarks>
/// Achievements are grouped into categories (Combat, Exploration, Progression, Collection, Challenge)
/// and displayed with status indicators, progress bars, and rarity badges.
/// Filter tabs allow viewing specific achievement categories.
/// </remarks>
public class AchievementPanel
{
    private readonly AchievementCategoryView _categoryView;
    private readonly AchievementCard _achievementCard;
    private readonly ITerminalService _terminalService;
    private readonly AchievementPanelConfig _config;
    private readonly ILogger<AchievementPanel> _logger;

    private AchievementCategory? _activeFilter;
    private IReadOnlyList<AchievementDisplayDto> _achievements = Array.Empty<AchievementDisplayDto>();
    private int _totalPoints;
    private int _unlockedCount;
    private int _totalCount;
    private (int X, int Y) _panelPosition;

    /// <summary>
    /// Gets the currently active filter category.
    /// </summary>
    public AchievementCategory? ActiveFilter => _activeFilter;

    /// <summary>
    /// Creates a new instance of the AchievementPanel component.
    /// </summary>
    /// <param name="categoryView">The category view renderer.</param>
    /// <param name="achievementCard">The achievement card renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for panel display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public AchievementPanel(
        AchievementCategoryView categoryView,
        AchievementCard achievementCard,
        ITerminalService terminalService,
        AchievementPanelConfig config,
        ILogger<AchievementPanel> logger)
    {
        _categoryView = categoryView ?? throw new ArgumentNullException(nameof(categoryView));
        _achievementCard = achievementCard ?? throw new ArgumentNullException(nameof(achievementCard));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the panel position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _panelPosition = (x, y);
    }

    /// <summary>
    /// Renders all achievements in the panel.
    /// </summary>
    /// <param name="achievements">The achievement display data.</param>
    /// <param name="totalPoints">The player's total achievement points.</param>
    /// <param name="unlockedCount">The number of unlocked achievements.</param>
    /// <param name="totalCount">The total number of achievements.</param>
    public void RenderAchievements(
        IEnumerable<AchievementDisplayDto> achievements,
        int totalPoints,
        int unlockedCount,
        int totalCount)
    {
        _achievements = achievements.ToList();
        _totalPoints = totalPoints;
        _unlockedCount = unlockedCount;
        _totalCount = totalCount;

        _logger.LogDebug(
            "Rendering achievement panel: {UnlockedCount}/{TotalCount} unlocked, {TotalPoints} points",
            unlockedCount, totalCount, totalPoints);

        // Clear panel area
        ClearPanel();

        // Render panel header
        RenderHeader();

        // Render summary line
        RenderSummary();

        // Render filter tabs
        RenderFilterTabs();

        // Apply active filter if set
        var displayedAchievements = ApplyFilter(_achievements);

        // Group and render by category
        RenderAchievementsByCategory(displayedAchievements);

        _logger.LogInformation(
            "Achievement panel rendered with {DisplayedCount} achievements displayed",
            displayedAchievements.Count);
    }

    /// <summary>
    /// Filters achievements by the specified category.
    /// </summary>
    /// <param name="category">The category to filter by, or null to show all.</param>
    public void FilterByCategory(AchievementCategory? category)
    {
        _activeFilter = category;
        _logger.LogDebug("Achievement filter changed to: {Filter}", category?.ToString() ?? "All");

        // Re-render with new filter
        RenderAchievements(_achievements, _totalPoints, _unlockedCount, _totalCount);
    }

    /// <summary>
    /// Displays the total progress summary.
    /// </summary>
    /// <param name="unlocked">The number of unlocked achievements.</param>
    /// <param name="total">The total number of achievements.</param>
    public void ShowTotalProgress(int unlocked, int total)
    {
        var percentage = total > 0 ? (unlocked * 100 / total) : 0;
        var progressText = $"Unlocked: {unlocked}/{total} ({percentage}%)";

        _terminalService.WriteAt(
            _panelPosition.X + _config.SummaryOffset,
            _panelPosition.Y + 1,
            progressText);
    }

    /// <summary>
    /// Displays the total points earned.
    /// </summary>
    /// <param name="points">The total achievement points.</param>
    public void ShowTotalPoints(int points)
    {
        var pointsText = $"Total Points: {points}";

        _terminalService.WriteAt(
            _panelPosition.X + 2,
            _panelPosition.Y + 1,
            pointsText);
    }

    /// <summary>
    /// Handles filter input from user key press.
    /// </summary>
    /// <param name="key">The pressed key (1-6).</param>
    public void HandleFilterInput(int key)
    {
        var category = key switch
        {
            1 => (AchievementCategory?)null,
            2 => AchievementCategory.Combat,
            3 => AchievementCategory.Exploration,
            4 => AchievementCategory.Progression,
            5 => AchievementCategory.Collection,
            6 => AchievementCategory.Challenge,
            _ => _activeFilter
        };

        FilterByCategory(category);
    }

    private void ClearPanel()
    {
        for (int y = 0; y < _config.PanelHeight; y++)
        {
            _terminalService.WriteAt(
                _panelPosition.X,
                _panelPosition.Y + y,
                new string(' ', _config.PanelWidth));
        }
    }

    private void RenderHeader()
    {
        var headerLine = new string('=', _config.PanelWidth - 2);
        var title = "ACHIEVEMENTS";
        var titlePadding = (_config.PanelWidth - title.Length - 2) / 2;

        _terminalService.WriteAt(_panelPosition.X, _panelPosition.Y, $"+{headerLine}+");
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 1,
            $"|{new string(' ', titlePadding)}{title}{new string(' ', _config.PanelWidth - title.Length - titlePadding - 2)}|");
        _terminalService.WriteAt(_panelPosition.X, _panelPosition.Y + 2, $"+{headerLine}+");
    }

    private void RenderSummary()
    {
        var percentage = _totalCount > 0 ? (_unlockedCount * 100 / _totalCount) : 0;
        var summaryText = $"  Total Points: {_totalPoints} | Unlocked: {_unlockedCount}/{_totalCount} ({percentage}%)";
        var paddedSummary = summaryText.PadRight(_config.PanelWidth - 2);

        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 3,
            $"|{paddedSummary}|");
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 4,
            $"+{new string('=', _config.PanelWidth - 2)}+");
    }

    private void RenderFilterTabs()
    {
        var tabs = new[]
        {
            ("All", (AchievementCategory?)null),
            ("Combat", (AchievementCategory?)AchievementCategory.Combat),
            ("Exploration", (AchievementCategory?)AchievementCategory.Exploration),
            ("Progression", (AchievementCategory?)AchievementCategory.Progression),
            ("Collection", (AchievementCategory?)AchievementCategory.Collection),
            ("Challenge", (AchievementCategory?)AchievementCategory.Challenge)
        };

        var tabLine = "  ";
        foreach (var (name, category) in tabs)
        {
            var isActive = _activeFilter == category;
            var tabText = isActive ? $"[{name}]" : $" {name} ";
            tabLine += tabText + " ";
        }

        var paddedTabs = tabLine.PadRight(_config.PanelWidth - 2);
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 5,
            $"|{paddedTabs}|");
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 6,
            $"+{new string('=', _config.PanelWidth - 2)}+");
    }

    private IReadOnlyList<AchievementDisplayDto> ApplyFilter(
        IReadOnlyList<AchievementDisplayDto> achievements)
    {
        if (_activeFilter is null)
        {
            return achievements;
        }

        return achievements
            .Where(a => a.Category == _activeFilter.Value)
            .ToList();
    }

    private void RenderAchievementsByCategory(IReadOnlyList<AchievementDisplayDto> achievements)
    {
        var startY = _panelPosition.Y + 7;
        var currentY = startY;

        // Group by category
        var grouped = achievements
            .GroupBy(a => a.Category)
            .OrderBy(g => (int)g.Key);

        foreach (var group in grouped)
        {
            // Render category header
            currentY = _categoryView.RenderCategory(
                group.Key,
                group.ToList(),
                _panelPosition.X,
                currentY,
                _achievementCard);

            currentY += 1; // Spacing between categories
        }
    }
}
```

### 4.2 Category Filtering

**Purpose:** Provides filtering logic for displaying achievements by category.

The filter system uses the following key mappings:

| Key | Filter | Description |
|-----|--------|-------------|
| 1 | All | Shows all achievements |
| 2 | Combat | Battle-related achievements |
| 3 | Exploration | Discovery achievements |
| 4 | Progression | Leveling/advancement |
| 5 | Collection | Gathering/collecting |
| 6 | Challenge | Special/hard achievements |

### 4.3 Panel Header and Summary

The panel header displays:
- Title: "ACHIEVEMENTS" centered
- Total Points: Player's accumulated achievement points
- Unlocked: Count and percentage of unlocked achievements

```
+=====================================================================+
|                        ACHIEVEMENTS                                  |
+=====================================================================+
|  Total Points: 485 | Unlocked: 23/75 (31%)                          |
+=====================================================================+
```

---

## 5. Achievement Category View

### 5.1 AchievementCategoryView Class

**Purpose:** Renders a category section with header and achievement cards.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/AchievementCategoryView.cs`

```csharp
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Renders achievement category sections with header and cards.
/// </summary>
/// <remarks>
/// Each category has a distinct icon and color for visual differentiation.
/// </remarks>
public class AchievementCategoryView
{
    private readonly ITerminalService _terminalService;
    private readonly ILogger<AchievementCategoryView> _logger;

    /// <summary>
    /// Creates a new instance of the AchievementCategoryView component.
    /// </summary>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public AchievementCategoryView(
        ITerminalService terminalService,
        ILogger<AchievementCategoryView> logger)
    {
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders a category section with its achievements.
    /// </summary>
    /// <param name="category">The achievement category.</param>
    /// <param name="achievements">The achievements in this category.</param>
    /// <param name="x">The X position.</param>
    /// <param name="y">The Y position.</param>
    /// <param name="achievementCard">The card renderer.</param>
    /// <returns>The Y position after rendering.</returns>
    public int RenderCategory(
        AchievementCategory category,
        IReadOnlyList<AchievementDisplayDto> achievements,
        int x,
        int y,
        AchievementCard achievementCard)
    {
        var currentY = y;
        var icon = GetCategoryIcon(category);
        var color = GetCategoryColor(category);
        var headerText = $"  {icon} {category.ToString().ToUpper()} ACHIEVEMENTS";

        _terminalService.WriteColoredAt(x + 1, currentY, headerText, color);
        currentY++;

        var underline = $"  {new string('-', headerText.Length - 2)}";
        _terminalService.WriteAt(x + 1, currentY, underline);
        currentY++;

        currentY++; // Blank line after header

        foreach (var achievement in achievements)
        {
            currentY = achievementCard.RenderAchievement(achievement, x + 2, currentY);
            currentY++; // Spacing between cards
        }

        _logger.LogDebug(
            "Rendered category {Category} with {Count} achievements",
            category, achievements.Count);

        return currentY;
    }

    /// <summary>
    /// Gets the icon for a category.
    /// </summary>
    /// <param name="category">The achievement category.</param>
    /// <returns>The category icon string.</returns>
    public string GetCategoryIcon(AchievementCategory category)
    {
        return category switch
        {
            AchievementCategory.Combat => "[C]",
            AchievementCategory.Exploration => "[E]",
            AchievementCategory.Progression => "[P]",
            AchievementCategory.Collection => "[L]",
            AchievementCategory.Challenge => "[!]",
            _ => "[?]"
        };
    }

    /// <summary>
    /// Gets the color for a category.
    /// </summary>
    /// <param name="category">The achievement category.</param>
    /// <returns>The console color for the category.</returns>
    public ConsoleColor GetCategoryColor(AchievementCategory category)
    {
        return category switch
        {
            AchievementCategory.Combat => ConsoleColor.Red,
            AchievementCategory.Exploration => ConsoleColor.Cyan,
            AchievementCategory.Progression => ConsoleColor.Green,
            AchievementCategory.Collection => ConsoleColor.Yellow,
            AchievementCategory.Challenge => ConsoleColor.Magenta,
            _ => ConsoleColor.White
        };
    }
}
```

### 5.2 Category Icons and Colors

| Category | Icon | Color | Description |
|----------|------|-------|-------------|
| Combat | `[C]` | Red | Battle-related achievements |
| Exploration | `[E]` | Cyan | Discovery achievements |
| Progression | `[P]` | Green | Leveling/advancement |
| Collection | `[L]` | Yellow | Gathering/collecting |
| Challenge | `[!]` | Magenta | Special/hard achievements |

---

## 6. Achievement Card

### 6.1 AchievementCard Class

**Purpose:** Renders individual achievement cards with status, progress, and rarity information.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/AchievementCard.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Renders individual achievement cards with status, progress, and rarity.
/// </summary>
/// <remarks>
/// Cards display status indicators, name, description, rarity badge, and progress bar.
/// Secret achievements show placeholder content until unlocked.
/// </remarks>
public class AchievementCard
{
    private readonly RarityBadge _rarityBadge;
    private readonly ProgressBarRenderer _progressRenderer;
    private readonly ITerminalService _terminalService;
    private readonly ILogger<AchievementCard> _logger;

    private const int CardWidth = 65;

    /// <summary>
    /// Creates a new instance of the AchievementCard component.
    /// </summary>
    /// <param name="rarityBadge">The rarity badge renderer.</param>
    /// <param name="progressRenderer">The progress bar renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public AchievementCard(
        RarityBadge rarityBadge,
        ProgressBarRenderer progressRenderer,
        ITerminalService terminalService,
        ILogger<AchievementCard> logger)
    {
        _rarityBadge = rarityBadge ?? throw new ArgumentNullException(nameof(rarityBadge));
        _progressRenderer = progressRenderer ?? throw new ArgumentNullException(nameof(progressRenderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders an achievement card.
    /// </summary>
    /// <param name="achievement">The achievement display data.</param>
    /// <param name="x">The X position.</param>
    /// <param name="y">The Y position.</param>
    /// <returns>The Y position after rendering.</returns>
    public int RenderAchievement(AchievementDisplayDto achievement, int x, int y)
    {
        var currentY = y;

        // Render card border (top)
        var borderLine = new string('-', CardWidth - 2);
        _terminalService.WriteAt(x, currentY, $"+{borderLine}+");
        currentY++;

        // Check if secret and not unlocked
        if (achievement.IsSecret && !achievement.IsUnlocked)
        {
            currentY = ShowSecretPlaceholder(x, currentY, achievement.Rarity);
        }
        else
        {
            currentY = RenderAchievementContent(achievement, x, currentY);
        }

        // Render card border (bottom)
        _terminalService.WriteAt(x, currentY, $"+{borderLine}+");
        currentY++;

        return currentY;
    }

    /// <summary>
    /// Shows the achievement's progress.
    /// </summary>
    /// <param name="current">Current progress value.</param>
    /// <param name="target">Target progress value.</param>
    /// <param name="x">The X position.</param>
    /// <param name="y">The Y position.</param>
    public void ShowProgress(int current, int target, int x, int y)
    {
        var progressBar = _progressRenderer.RenderProgressBar(current, target, 40);
        var percentageText = _progressRenderer.FormatPercentage(current, target);
        var progressLine = $"  {progressBar} {percentageText}";

        _terminalService.WriteAt(x + 1, y, $"|{progressLine.PadRight(CardWidth - 3)}|");
    }

    /// <summary>
    /// Shows the unlock status indicator.
    /// </summary>
    /// <param name="isUnlocked">Whether the achievement is unlocked.</param>
    /// <param name="hasProgress">Whether there is partial progress.</param>
    /// <returns>The status indicator string.</returns>
    public string ShowUnlockStatus(bool isUnlocked, bool hasProgress)
    {
        if (isUnlocked)
        {
            return "[x]";
        }

        return hasProgress ? "[~]" : "( )";
    }

    /// <summary>
    /// Renders the secret achievement placeholder.
    /// </summary>
    /// <param name="x">The X position.</param>
    /// <param name="y">The Y position.</param>
    /// <param name="rarity">The achievement rarity (for tier display).</param>
    /// <returns>The Y position after rendering.</returns>
    public int ShowSecretPlaceholder(int x, int y, AchievementRarity rarity)
    {
        var currentY = y;
        var rarityBadgeText = _rarityBadge.RenderBadge(rarity);

        // Line 1: Status and name (hidden)
        var line1 = $"| [L] ??? (Secret Achievement){new string(' ', CardWidth - 33 - rarityBadgeText.Length)}{rarityBadgeText} |";
        _terminalService.WriteAt(x, currentY, line1);
        currentY++;

        // Line 2: Description (hidden)
        var line2 = $"|   ???{new string(' ', CardWidth - 8)}|";
        _terminalService.WriteAt(x, currentY, line2);
        currentY++;

        // Line 3: Progress (locked)
        var lockedBar = $"[{new string('.', 40)}] Locked";
        var line3 = $"|   {lockedBar}{new string(' ', CardWidth - 5 - lockedBar.Length)}|";
        _terminalService.WriteAt(x, currentY, line3);
        currentY++;

        return currentY;
    }

    private int RenderAchievementContent(AchievementDisplayDto achievement, int x, int y)
    {
        var currentY = y;

        // Line 1: Status indicator, name, and rarity badge
        var statusIndicator = ShowUnlockStatus(achievement.IsUnlocked, achievement.CurrentValue > 0);
        var rarityBadgeText = _rarityBadge.RenderBadge(achievement.Rarity);
        var nameLength = CardWidth - 6 - statusIndicator.Length - rarityBadgeText.Length;
        var name = achievement.Name.Length > nameLength
            ? achievement.Name[..(nameLength - 3)] + "..."
            : achievement.Name.PadRight(nameLength);

        var line1 = $"| {statusIndicator} {name}{rarityBadgeText} |";
        _terminalService.WriteAt(x, currentY, line1);
        currentY++;

        // Line 2: Description
        var descLength = CardWidth - 6;
        var description = achievement.Description.Length > descLength
            ? achievement.Description[..(descLength - 3)] + "..."
            : achievement.Description.PadRight(descLength);

        var line2 = $"|   {description} |";
        _terminalService.WriteAt(x, currentY, line2);
        currentY++;

        // Line 3: Progress bar
        var progressBar = _progressRenderer.RenderProgressBar(
            achievement.CurrentValue,
            achievement.TargetValue,
            40);
        var progressText = achievement.IsUnlocked
            ? "100%"
            : _progressRenderer.FormatPercentage(achievement.CurrentValue, achievement.TargetValue);

        // For incremental achievements, show current/target
        var progressDetail = achievement.TargetValue > 1
            ? $"{achievement.CurrentValue}/{achievement.TargetValue} ({progressText})"
            : progressText;

        var line3Content = $"   {progressBar} {progressDetail}";
        var line3 = $"|{line3Content.PadRight(CardWidth - 3)}|";
        _terminalService.WriteAt(x, currentY, line3);
        currentY++;

        return currentY;
    }
}
```

### 6.2 Status Indicators

| Indicator | Meaning | Condition |
|-----------|---------|-----------|
| `[x]` | Unlocked | Achievement completed |
| `[~]` | In Progress | CurrentValue > 0 but not complete |
| `( )` | Not Started | CurrentValue = 0 |
| `[L]` | Locked | Secret achievement, not yet revealed |

### 6.3 Secret Achievement Handling

Secret achievements display placeholder content until unlocked:

```
+---------------------------------------------------------------+
| [L] ??? (Secret Achievement)                      Platinum    |
|   ???                                                         |
|   [........................................] Locked           |
+---------------------------------------------------------------+
```

Once unlocked, the full achievement details are revealed.

---

## 7. Rarity Badge

### 7.1 RarityBadge Class

**Purpose:** Renders rarity tier badges with appropriate colors and point values.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/RarityBadge.cs`

```csharp
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Tui.Services;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Renders rarity tier badges for achievements.
/// </summary>
/// <remarks>
/// Each rarity tier has a distinct color and point value.
/// </remarks>
public class RarityBadge
{
    private readonly ITerminalService _terminalService;

    /// <summary>
    /// Creates a new instance of the RarityBadge component.
    /// </summary>
    /// <param name="terminalService">The terminal output service.</param>
    public RarityBadge(ITerminalService terminalService)
    {
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
    }

    /// <summary>
    /// Renders the rarity badge text.
    /// </summary>
    /// <param name="rarity">The achievement rarity.</param>
    /// <returns>The formatted badge string (e.g., "Bronze (10)").</returns>
    public string RenderBadge(AchievementRarity rarity)
    {
        var tierName = GetTierName(rarity);
        var pointValue = GetPointValue(rarity);
        return $"{tierName} ({pointValue})";
    }

    /// <summary>
    /// Renders the rarity badge with color at a specific position.
    /// </summary>
    /// <param name="rarity">The achievement rarity.</param>
    /// <param name="x">The X position.</param>
    /// <param name="y">The Y position.</param>
    public void RenderBadgeAt(AchievementRarity rarity, int x, int y)
    {
        var badgeText = RenderBadge(rarity);
        var color = GetRarityColor(rarity);
        _terminalService.WriteColoredAt(x, y, badgeText, color);
    }

    /// <summary>
    /// Gets the display color for a rarity tier.
    /// </summary>
    /// <param name="rarity">The achievement rarity.</param>
    /// <returns>The console color for the rarity.</returns>
    public ConsoleColor GetRarityColor(AchievementRarity rarity)
    {
        return rarity switch
        {
            AchievementRarity.Bronze => ConsoleColor.DarkYellow,
            AchievementRarity.Silver => ConsoleColor.Gray,
            AchievementRarity.Gold => ConsoleColor.Yellow,
            AchievementRarity.Platinum => ConsoleColor.Cyan,
            _ => ConsoleColor.White
        };
    }

    /// <summary>
    /// Gets the point value for a rarity tier.
    /// </summary>
    /// <param name="rarity">The achievement rarity.</param>
    /// <returns>The point value for the rarity tier.</returns>
    public int GetPointValue(AchievementRarity rarity)
    {
        return rarity switch
        {
            AchievementRarity.Bronze => 10,
            AchievementRarity.Silver => 25,
            AchievementRarity.Gold => 50,
            AchievementRarity.Platinum => 100,
            _ => 0
        };
    }

    /// <summary>
    /// Gets the tier name for a rarity.
    /// </summary>
    /// <param name="rarity">The achievement rarity.</param>
    /// <returns>The tier name string.</returns>
    public string GetTierName(AchievementRarity rarity)
    {
        return rarity switch
        {
            AchievementRarity.Bronze => "Bronze",
            AchievementRarity.Silver => "Silver",
            AchievementRarity.Gold => "Gold",
            AchievementRarity.Platinum => "Platinum",
            _ => "Unknown"
        };
    }
}
```

### 7.2 Tier Colors and Point Values

| Tier | Color | Point Value | Difficulty |
|------|-------|-------------|------------|
| Bronze | DarkYellow (Brown) | 10 | Common |
| Silver | Gray | 25 | Moderate |
| Gold | Yellow | 50 | Challenging |
| Platinum | Cyan | 100 | Elite |

---

## 8. Progress Bar Renderer

### 8.1 ProgressBarRenderer Class

**Purpose:** Renders progress bars for incremental achievement tracking.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Renderers/ProgressBarRenderer.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.Renderers;

/// <summary>
/// Renders progress bars for achievement progress visualization.
/// </summary>
/// <remarks>
/// Progress bars use '#' for filled portions and '.' for empty portions.
/// </remarks>
public class ProgressBarRenderer
{
    private const char FilledChar = '#';
    private const char EmptyChar = '.';

    /// <summary>
    /// Renders a progress bar.
    /// </summary>
    /// <param name="current">Current progress value.</param>
    /// <param name="target">Target progress value.</param>
    /// <param name="width">The width of the bar in characters.</param>
    /// <returns>The formatted progress bar string.</returns>
    public string RenderProgressBar(int current, int target, int width)
    {
        if (target <= 0)
        {
            return $"[{new string(EmptyChar, width)}]";
        }

        var percentage = Math.Min((double)current / target, 1.0);
        var filledWidth = (int)(width * percentage);
        var emptyWidth = width - filledWidth;

        var filled = new string(FilledChar, filledWidth);
        var empty = new string(EmptyChar, emptyWidth);

        return $"[{filled}{empty}]";
    }

    /// <summary>
    /// Formats the percentage for display.
    /// </summary>
    /// <param name="current">Current progress value.</param>
    /// <param name="target">Target progress value.</param>
    /// <returns>The formatted percentage string.</returns>
    public string FormatPercentage(int current, int target)
    {
        if (target <= 0)
        {
            return "0%";
        }

        var percentage = Math.Min((current * 100) / target, 100);
        return $"{percentage}%";
    }

    /// <summary>
    /// Gets the color for a progress bar based on completion percentage.
    /// </summary>
    /// <param name="percentage">The completion percentage (0-1).</param>
    /// <returns>The console color for the progress level.</returns>
    public ConsoleColor GetProgressColor(float percentage)
    {
        return percentage switch
        {
            >= 1.0f => ConsoleColor.Green,
            >= 0.75f => ConsoleColor.Cyan,
            >= 0.5f => ConsoleColor.Yellow,
            >= 0.25f => ConsoleColor.DarkYellow,
            _ => ConsoleColor.Red
        };
    }
}
```

### 8.2 Progress Visualization

Progress bars display:
- `#` characters for completed portion
- `.` characters for remaining portion
- Percentage or current/target count

Examples:
```
[########################################] 100%
[####################....................] 47/100 (47%)
[########................................] 2/10 (20%)
[........................................] 0%
```

---

## 9. Achievement Unlock Notification

### 9.1 AchievementUnlockNotification Class

**Purpose:** Displays popup notification when an achievement is unlocked.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Notifications/AchievementUnlockNotification.cs`

```csharp
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.UI;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.Notifications;

/// <summary>
/// Displays popup notification when an achievement is unlocked.
/// </summary>
/// <remarks>
/// Notifications auto-dismiss after a configured duration (default 5 seconds).
/// </remarks>
public class AchievementUnlockNotification
{
    private readonly RarityBadge _rarityBadge;
    private readonly ITerminalService _terminalService;
    private readonly ILogger<AchievementUnlockNotification> _logger;
    private readonly TimeSpan _displayDuration;

    private const int NotificationWidth = 55;

    /// <summary>
    /// Creates a new instance of the AchievementUnlockNotification component.
    /// </summary>
    /// <param name="rarityBadge">The rarity badge renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    /// <param name="displayDuration">The duration to display the notification.</param>
    public AchievementUnlockNotification(
        RarityBadge rarityBadge,
        ITerminalService terminalService,
        ILogger<AchievementUnlockNotification> logger,
        TimeSpan? displayDuration = null)
    {
        _rarityBadge = rarityBadge ?? throw new ArgumentNullException(nameof(rarityBadge));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _displayDuration = displayDuration ?? TimeSpan.FromSeconds(5);
    }

    /// <summary>
    /// Shows the achievement unlock notification.
    /// </summary>
    /// <param name="achievement">The unlocked achievement.</param>
    /// <param name="centerX">The X position for centering.</param>
    /// <param name="topY">The Y position for the top of the notification.</param>
    public void ShowUnlock(AchievementDisplayDto achievement, int centerX, int topY)
    {
        var startX = centerX - (NotificationWidth / 2);
        var currentY = topY;

        _logger.LogInformation(
            "Showing achievement unlock notification: {AchievementName}",
            achievement.Name);

        // Top border
        var borderLine = new string('=', NotificationWidth - 2);
        _terminalService.WriteAt(startX, currentY, $"+{borderLine}+");
        currentY++;

        // Header line
        var header = "[!]  ACHIEVEMENT UNLOCKED!";
        var headerPadding = (NotificationWidth - 2 - header.Length) / 2;
        var headerLine = $"|{new string(' ', headerPadding)}{header}{new string(' ', NotificationWidth - 2 - headerPadding - header.Length)}|";
        _terminalService.WriteColoredAt(startX, currentY, headerLine, ConsoleColor.Yellow);
        currentY++;

        // Separator
        _terminalService.WriteAt(startX, currentY, $"+{borderLine}+");
        currentY++;

        // Blank line
        _terminalService.WriteAt(startX, currentY, $"|{new string(' ', NotificationWidth - 2)}|");
        currentY++;

        // Achievement name
        var nameLine = achievement.Name.Length > NotificationWidth - 4
            ? achievement.Name[..(NotificationWidth - 7)] + "..."
            : achievement.Name;
        var namePadding = (NotificationWidth - 2 - nameLine.Length) / 2;
        _terminalService.WriteAt(startX, currentY, $"|{new string(' ', namePadding)}{nameLine}{new string(' ', NotificationWidth - 2 - namePadding - nameLine.Length)}|");
        currentY++;

        // Achievement description
        var descLine = achievement.Description.Length > NotificationWidth - 4
            ? achievement.Description[..(NotificationWidth - 7)] + "..."
            : achievement.Description;
        var descPadding = (NotificationWidth - 2 - descLine.Length) / 2;
        _terminalService.WriteAt(startX, currentY, $"|{new string(' ', descPadding)}{descLine}{new string(' ', NotificationWidth - 2 - descPadding - descLine.Length)}|");
        currentY++;

        // Blank line
        _terminalService.WriteAt(startX, currentY, $"|{new string(' ', NotificationWidth - 2)}|");
        currentY++;

        // Rarity and points line
        ShowPointsEarned(achievement.Rarity, startX, currentY);
        currentY++;

        // Bottom border
        _terminalService.WriteAt(startX, currentY, $"+{borderLine}+");
    }

    /// <summary>
    /// Shows the points earned line in the notification.
    /// </summary>
    /// <param name="rarity">The achievement rarity.</param>
    /// <param name="startX">The starting X position.</param>
    /// <param name="y">The Y position.</param>
    public void ShowPointsEarned(AchievementRarity rarity, int startX, int y)
    {
        var tierName = _rarityBadge.GetTierName(rarity);
        var pointValue = _rarityBadge.GetPointValue(rarity);
        var pointsText = $"{tierName}   |   +{pointValue} Points";
        var pointsPadding = (NotificationWidth - 2 - pointsText.Length) / 2;

        var color = _rarityBadge.GetRarityColor(rarity);
        var line = $"|{new string(' ', pointsPadding)}{pointsText}{new string(' ', NotificationWidth - 2 - pointsPadding - pointsText.Length)}|";

        _terminalService.WriteColoredAt(startX, y, line, color);
    }

    /// <summary>
    /// Gets the display duration for the notification.
    /// </summary>
    /// <returns>The notification display duration.</returns>
    public TimeSpan GetDuration()
    {
        return _displayDuration;
    }
}
```

### 9.2 Notification Display

Achievement unlock notifications display in a centered popup:

```
+=====================================================+
|  [!]  ACHIEVEMENT UNLOCKED!                         |
+=====================================================+
|                                                     |
|  MONSTER SLAYER                                     |
|  Defeat 100 monsters                                |
|                                                     |
|  Silver   |   +25 Points                            |
+=====================================================+
```

- Notifications auto-dismiss after 5 seconds
- Yellow highlight for header
- Rarity-colored tier and points line

---

## 10. Achievements Command

**Purpose:** Handles the `achievements` command to open the achievement panel.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Commands/AchievementsCommand.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.UI;
using RuneAndRust.Presentation.Tui.DTOs;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.Commands;

/// <summary>
/// Handles the achievements command to display the achievement panel.
/// </summary>
public class AchievementsCommand
{
    private readonly IAchievementService _achievementService;
    private readonly AchievementPanel _achievementPanel;
    private readonly ILogger<AchievementsCommand> _logger;

    /// <summary>
    /// Creates a new instance of the AchievementsCommand.
    /// </summary>
    /// <param name="achievementService">The achievement service.</param>
    /// <param name="achievementPanel">The achievement panel UI component.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public AchievementsCommand(
        IAchievementService achievementService,
        AchievementPanel achievementPanel,
        ILogger<AchievementsCommand> logger)
    {
        _achievementService = achievementService ?? throw new ArgumentNullException(nameof(achievementService));
        _achievementPanel = achievementPanel ?? throw new ArgumentNullException(nameof(achievementPanel));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Executes the achievements command.
    /// </summary>
    /// <param name="playerId">The player ID.</param>
    public async Task ExecuteAsync(Guid playerId)
    {
        _logger.LogDebug("Executing achievements command for player {PlayerId}", playerId);

        // Get all achievements
        var achievements = await _achievementService.GetAllAchievementsAsync();

        // Get player progress
        var progress = await _achievementService.GetPlayerProgressAsync(playerId);

        // Get summary data
        var totalPoints = await _achievementService.GetTotalPointsAsync(playerId);
        var unlockedCount = await _achievementService.GetUnlockedCountAsync(playerId);
        var totalCount = achievements.Count;

        // Map to display DTOs
        var displayDtos = MapToDisplayDtos(achievements, progress);

        // Render the panel
        _achievementPanel.SetPosition(2, 2);
        _achievementPanel.RenderAchievements(displayDtos, totalPoints, unlockedCount, totalCount);

        _logger.LogInformation(
            "Achievement panel opened: {UnlockedCount}/{TotalCount} achievements, {TotalPoints} points",
            unlockedCount, totalCount, totalPoints);
    }

    private IReadOnlyList<AchievementDisplayDto> MapToDisplayDtos(
        IReadOnlyList<AchievementDefinitionDto> achievements,
        IReadOnlyList<AchievementProgressDto> progress)
    {
        var progressLookup = progress.ToDictionary(p => p.AchievementId);

        return achievements.Select(a =>
        {
            progressLookup.TryGetValue(a.Id, out var playerProgress);

            return new AchievementDisplayDto(
                Id: a.Id,
                Name: a.Name,
                Description: a.Description,
                Category: a.Category,
                Rarity: a.Rarity,
                TargetValue: a.TargetValue,
                CurrentValue: playerProgress?.CurrentValue ?? 0,
                IsUnlocked: playerProgress?.IsUnlocked ?? false,
                IsSecret: a.IsSecret,
                PointValue: a.PointValue,
                UnlockedAt: playerProgress?.UnlockedAt);
        }).ToList();
    }
}
```

**Command Registration:**

```csharp
// In ConsoleInputHandler.ParseCommand()
"achievements" or "achieve" or "ach" => new AchievementsCommand(),
```

---

## 11. Data Model Changes

### New DTOs

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/AchievementDisplayDto.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// DTO for displaying achievement information in the UI.
/// </summary>
/// <param name="Id">The achievement identifier.</param>
/// <param name="Name">The achievement name.</param>
/// <param name="Description">The achievement description.</param>
/// <param name="Category">The achievement category.</param>
/// <param name="Rarity">The achievement rarity tier.</param>
/// <param name="TargetValue">The target value for completion.</param>
/// <param name="CurrentValue">The player's current progress.</param>
/// <param name="IsUnlocked">Whether the achievement is unlocked.</param>
/// <param name="IsSecret">Whether this is a secret achievement.</param>
/// <param name="PointValue">The point value awarded.</param>
/// <param name="UnlockedAt">The unlock timestamp, if unlocked.</param>
public record AchievementDisplayDto(
    string Id,
    string Name,
    string Description,
    AchievementCategory Category,
    AchievementRarity Rarity,
    int TargetValue,
    int CurrentValue,
    bool IsUnlocked,
    bool IsSecret,
    int PointValue,
    DateTime? UnlockedAt);
```

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/AchievementProgressDisplayDto.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// DTO for displaying achievement progress information.
/// </summary>
/// <param name="AchievementId">The achievement identifier.</param>
/// <param name="CurrentValue">The current progress value.</param>
/// <param name="TargetValue">The target progress value.</param>
/// <param name="Percentage">The completion percentage.</param>
/// <param name="IsComplete">Whether the achievement is complete.</param>
public record AchievementProgressDisplayDto(
    string AchievementId,
    int CurrentValue,
    int TargetValue,
    int Percentage,
    bool IsComplete);
```

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/AchievementCategoryDisplayDto.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// DTO for displaying achievement category information.
/// </summary>
/// <param name="Category">The achievement category.</param>
/// <param name="Icon">The category icon.</param>
/// <param name="Color">The category color.</param>
/// <param name="AchievementCount">The number of achievements in this category.</param>
/// <param name="UnlockedCount">The number of unlocked achievements.</param>
public record AchievementCategoryDisplayDto(
    AchievementCategory Category,
    string Icon,
    ConsoleColor Color,
    int AchievementCount,
    int UnlockedCount);
```

### Data Model Summary

| Type | Layer | Description |
|------|-------|-------------|
| `AchievementDisplayDto` | Presentation | Combined achievement definition and progress for UI |
| `AchievementProgressDisplayDto` | Presentation | Progress-specific display data |
| `AchievementCategoryDisplayDto` | Presentation | Category summary for filter tabs |

---

## 12. Configuration File Schemas

### AchievementPanelConfig Class

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Configuration/AchievementPanelConfig.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.Configuration;

/// <summary>
/// Configuration for the achievement panel display.
/// </summary>
public class AchievementPanelConfig
{
    /// <summary>
    /// The width of the panel in characters.
    /// </summary>
    public int PanelWidth { get; set; } = 70;

    /// <summary>
    /// The height of the panel in characters.
    /// </summary>
    public int PanelHeight { get; set; } = 40;

    /// <summary>
    /// The offset for the summary text from the left edge.
    /// </summary>
    public int SummaryOffset { get; set; } = 35;

    /// <summary>
    /// The width of progress bars in characters.
    /// </summary>
    public int ProgressBarWidth { get; set; } = 40;

    /// <summary>
    /// The duration for achievement notifications in seconds.
    /// </summary>
    public int NotificationDurationSeconds { get; set; } = 5;

    /// <summary>
    /// Whether to show secret achievements as placeholders.
    /// </summary>
    public bool ShowSecretPlaceholders { get; set; } = true;
}
```

### Configuration JSON Schema

**File:** `config/achievement-panel.json`

```json
{
  "$schema": "./schemas/achievement-panel.schema.json",
  "panelWidth": 70,
  "panelHeight": 40,
  "summaryOffset": 35,
  "progressBarWidth": 40,
  "notificationDurationSeconds": 5,
  "showSecretPlaceholders": true,
  "categoryColors": {
    "combat": "Red",
    "exploration": "Cyan",
    "progression": "Green",
    "collection": "Yellow",
    "challenge": "Magenta"
  },
  "rarityColors": {
    "bronze": "DarkYellow",
    "silver": "Gray",
    "gold": "Yellow",
    "platinum": "Cyan"
  },
  "statusIndicators": {
    "unlocked": "[x]",
    "inProgress": "[~]",
    "notStarted": "( )",
    "locked": "[L]"
  }
}
```

### JSON Schema

**File:** `config/schemas/achievement-panel.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AchievementPanelConfig",
  "description": "Configuration for the achievement panel display",
  "type": "object",
  "properties": {
    "panelWidth": {
      "type": "integer",
      "description": "The width of the panel in characters",
      "minimum": 50,
      "default": 70
    },
    "panelHeight": {
      "type": "integer",
      "description": "The height of the panel in characters",
      "minimum": 20,
      "default": 40
    },
    "summaryOffset": {
      "type": "integer",
      "description": "The offset for the summary text from the left edge",
      "minimum": 0,
      "default": 35
    },
    "progressBarWidth": {
      "type": "integer",
      "description": "The width of progress bars in characters",
      "minimum": 10,
      "maximum": 60,
      "default": 40
    },
    "notificationDurationSeconds": {
      "type": "integer",
      "description": "The duration for achievement notifications in seconds",
      "minimum": 1,
      "maximum": 30,
      "default": 5
    },
    "showSecretPlaceholders": {
      "type": "boolean",
      "description": "Whether to show secret achievements as placeholders",
      "default": true
    },
    "categoryColors": {
      "type": "object",
      "description": "Colors for achievement categories",
      "additionalProperties": {
        "type": "string"
      }
    },
    "rarityColors": {
      "type": "object",
      "description": "Colors for rarity tiers",
      "additionalProperties": {
        "type": "string"
      }
    },
    "statusIndicators": {
      "type": "object",
      "description": "Status indicator strings",
      "properties": {
        "unlocked": { "type": "string" },
        "inProgress": { "type": "string" },
        "notStarted": { "type": "string" },
        "locked": { "type": "string" }
      }
    }
  },
  "required": ["panelWidth", "panelHeight"]
}
```

---

## 13. Logging Specifications

### Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `AchievementPanel` | Information | Panel rendered, filter changed |
| `AchievementPanel` | Debug | Achievement count, rendering details |
| `AchievementCategoryView` | Debug | Category rendered with count |
| `AchievementCard` | Debug | Individual card rendered |
| `AchievementUnlockNotification` | Information | Notification displayed |
| `AchievementsCommand` | Information | Command executed, panel opened |
| `AchievementsCommand` | Debug | Player progress retrieved |

### Log Message Examples

```
[INF] Achievement panel rendered with 23 achievements displayed
[DBG] Rendering achievement panel: 23/75 unlocked, 485 points
[DBG] Achievement filter changed to: Combat
[DBG] Rendered category Combat with 8 achievements
[INF] Showing achievement unlock notification: Monster Slayer
[INF] Achievement panel opened: 23/75 achievements, 485 points
```

---

## 14. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| AchievementPanel display | ~2 |
| Category filtering | ~2 |
| Progress bar rendering | ~2 |
| Achievement unlock notification | ~2 |
| **Total** | **~8** |

### Test Specifications

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/AchievementPanelTests.cs`

```csharp
[TestFixture]
public class AchievementPanelTests
{
    [Test]
    public void RenderAchievements_WithValidData_DisplaysAllAchievements();

    [Test]
    public void FilterByCategory_WithCombat_ShowsOnlyCombatAchievements();

    [Test]
    public void FilterByCategory_WithNull_ShowsAllAchievements();
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/AchievementCardTests.cs`

```csharp
[TestFixture]
public class AchievementCardTests
{
    [Test]
    public void ShowUnlockStatus_WhenUnlocked_ReturnsCheckMark();

    [Test]
    public void ShowUnlockStatus_WhenInProgress_ReturnsTilde();

    [Test]
    public void ShowUnlockStatus_WhenNotStarted_ReturnsEmptyParens();

    [Test]
    public void ShowSecretPlaceholder_WhenSecretNotUnlocked_ShowsQuestionMarks();
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/Renderers/ProgressBarRendererTests.cs`

```csharp
[TestFixture]
public class ProgressBarRendererTests
{
    [Test]
    public void RenderProgressBar_At50Percent_ShowsHalfFilled();

    [Test]
    public void FormatPercentage_At47Of100_Returns47Percent();
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/Notifications/AchievementUnlockNotificationTests.cs`

```csharp
[TestFixture]
public class AchievementUnlockNotificationTests
{
    [Test]
    public void ShowUnlock_WithValidAchievement_DisplaysNotification();

    [Test]
    public void GetDuration_ReturnsConfiguredDuration();
}
```

---

## 15. Use Cases

### UC-001: View All Achievements

**Actor:** Player
**Flow:** Player enters "achievements" command → System retrieves achievements → Panel displays all achievements organized by category → Player views progress

### UC-002: Filter Achievements by Category

**Actor:** Player
**Flow:** Player opens achievement panel → Player presses filter key (1-6) → Panel filters to selected category → Player views filtered achievements

### UC-003: Receive Achievement Unlock Notification

**Actor:** System
**Flow:** Player completes achievement criteria → Achievement service triggers unlock event → Notification displays achievement details → Notification auto-dismisses after 5 seconds

### UC-004: View Secret Achievement Placeholder

**Actor:** Player
**Flow:** Player opens achievement panel → Panel shows secret achievements as "[L] ???" → Player unlocks secret achievement → Panel reveals full achievement details

### UC-005: Track Incremental Achievement Progress

**Actor:** Player
**Flow:** Player opens achievement panel → Panel shows progress bar for incremental achievement → Player sees "47/100 (47%)" progress → Player completes more actions → Progress updates

---

## 16. Deliverable Checklist

### UI Components

- [ ] `AchievementPanel` class implemented
- [ ] `AchievementCategoryView` class implemented
- [ ] `AchievementCard` class implemented
- [ ] `RarityBadge` class implemented

### Renderers

- [ ] `ProgressBarRenderer` class implemented

### Notifications

- [ ] `AchievementUnlockNotification` class implemented

### Commands

- [ ] `AchievementsCommand` class implemented
- [ ] Command registered in `ConsoleInputHandler`

### DTOs

- [ ] `AchievementDisplayDto` record created
- [ ] `AchievementProgressDisplayDto` record created
- [ ] `AchievementCategoryDisplayDto` record created

### Configuration Files

- [ ] `config/achievement-panel.json` created
- [ ] `config/schemas/achievement-panel.schema.json` created
- [ ] `AchievementPanelConfig` class implemented

### Testing

- [ ] ~8 unit tests implemented
- [ ] All tests passing

---

## 17. Acceptance Criteria

### Functional

- [ ] Achievement panel displays all achievements
- [ ] Achievements grouped by category
- [ ] Category filter tabs work correctly
- [ ] Progress bars show correct percentages
- [ ] Unlocked achievements show `[x]` indicator
- [ ] In-progress achievements show `[~]` indicator
- [ ] Not started achievements show `( )` indicator
- [ ] Secret achievements show `[L]` and `???` until unlocked
- [ ] Rarity badges display with correct colors
- [ ] Total points and unlock count display correctly
- [ ] Achievement unlock notification displays on unlock
- [ ] Notification auto-dismisses after 5 seconds

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~8 unit tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete for all public members

---

## 18. Dependencies

### Required from v0.12.x

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `IAchievementService` | `Application/Interfaces/IAchievementService.cs` | Retrieve achievements and progress |
| `AchievementDefinition` | `Domain/Entities/AchievementDefinition.cs` | Achievement templates |
| `AchievementProgress` | `Domain/Entities/AchievementProgress.cs` | Player progress tracking |
| `AchievementCategory` | `Domain/Enums/AchievementCategory.cs` | Category enumeration |
| `AchievementRarity` | `Domain/Enums/AchievementRarity.cs` | Rarity tier enumeration |
| `IAchievementEventService` | `Application/Interfaces/IAchievementEventService.cs` | Achievement unlock events |

### Required from v0.7.x-v0.8.x

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `ITerminalService` | `Presentation.Tui/Services/ITerminalService.cs` | Terminal output |
| `MainMenuView` | `Presentation.Tui/Views/MainMenuView.cs` | Command integration |

### Provides to v0.13.4b

| Type | Usage |
|------|-------|
| `ProgressBarRenderer` | Reused for statistics dashboard charts |
| Achievement panel patterns | Consistency with statistics panel design |

---

## 19. Future Considerations

### Deferred to v0.13.5

- **Theme integration**: Category and rarity colors will be migrated to `IThemeService`
- **Accessibility**: Color blind mode alternatives for status indicators

### Out of Scope

- **Statistics dashboard**: Covered in v0.13.4b
- **Leaderboard view**: Covered in v0.13.4c
- **Dice history panel**: Covered in v0.13.4d
- **Achievement sharing**: Not in v0.13.x scope

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
*Author: Claude*
