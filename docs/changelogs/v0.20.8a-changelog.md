# v0.20.8a Changelog — Seiðkona (Seeress) Framework & Tier 1 Abilities

## Version: 0.20.8a

## Date: 2026-02-17

## Focus: Seiðkona (Seeress) Specialization — Framework & Tier 1 Abilities (Seiðr Bolt, Wyrd Sight, Aether Attunement)

---

## Added

### Domain Layer — Enums

- **`SeidkonaAbilityId`** — 9 ability identifiers across 4 tiers in the 800-808 range: SeidrBolt (800), WyrdSight (801), AetherAttunement (802), FatesThread (803), WeaveDisruption (804), ResonanceCascade (805), VolvasVision (806), AetherStorm (807), Unraveling (808). Extensive XML documentation describing the only Mystic archetype and final Heretical path, including probability-based Corruption risk scaling (0%/5%/15%/25%).
- **`SeidkonaCorruptionTrigger`** — 5 triggers for probability-based Corruption checks: SeidrBoltLowResonance (1, 5% at Res 5-7), SeidrBoltHighResonance (2, 15% at Res 8-9), SeidrBoltMaxResonance (3, 25% at Res 10), CastingAtHighResonance (4, generic for T2/T3), CapstoneActivation (5, 20% for Unraveling). Key difference from `BerserkrCorruptionTrigger`: probability-based (d100 vs percentage) rather than deterministic.

### Domain Layer — Value Objects

- **`AetherResonanceResource`** — Mutable sealed record (like `RageResource`) tracking Aether Resonance (0-10). Static factories: `Create()`, `Create(int)`, `CreateAt(int, int)`. Mutation via `Build(int, string)` returning actual gained amount. `Reset(string)` for capstone/death. Query methods: `GetCorruptionRiskPercent()` (0/5/15/25), `IsInCorruptionRange` (≥5), `IsAtMaxResonance` (=10), `GetResonanceLevel()` (Safe/Risky/Dangerous/Critical). Display: `GetStatusString()`, `GetFormattedValue()`. 7 private constants for all thresholds and percentages.
- **`AccumulatedAethericDamage`** — Immutable sealed record (like `MedicalSuppliesResource`) tracking Aetheric damage for Unraveling capstone. `TotalDamage`, `CastCount`, `LastDamageAt` properties with `init` accessors. `Create()` factory for zeroed state. `AddDamage(int)` returns new instance (negative values treated as 0, zero-damage still counts cast). `Reset()` returns zeroed instance. `CanUnravel` property, `GetAverageDamagePerCast()`, `GetFormattedValue()` display.
- **`SeidkonaCorruptionRiskResult`** — Sealed record extending `BerserkrCorruptionRiskResult` pattern with probability context: `RollResult` (d100), `RiskPercent` (threshold). Three factories: `CreateTriggered(amount, trigger, reason, rollResult, riskPercent)`, `CreateSafe(reason)`, `CreateSafeWithRoll(reason, rollResult, riskPercent)` for safe-but-checked results. `GetWarning()` and `GetDescriptionForPlayer()` include roll context.
- **`SeidrBoltResult`** — Init-only sealed record capturing Seiðr Bolt execution outcome: `DamageRoll`, `TotalDamage`, `ResonanceBefore`/`ResonanceAfter`, `CorruptionCheckPerformed`, `CorruptionTriggered`, `CorruptionRoll`, `CorruptionRiskPercent`. Display: `GetDamageBreakdown()`, `GetDescription()`, `GetResonanceChange()`.
- **`WyrdSightResult`** — Mutable sealed record tracking active Wyrd Sight effect: 3-turn duration, 10-space radius, detects invisible/magic/Corruption. `Create(Guid casterId)` factory. Mutable `TurnsRemaining` via `DecrementTurn()`. `IsActive()`, `GetDescription()`, `GetStatusString()`.

### Application Layer — Interfaces

- **`ISeidkonaResonanceService`** — Resonance resource management contract: `InitializeResonance`, `GetResonance`, `BuildResonance`, `ResetResonance`, `GetAccumulatedDamage`, `AddAccumulatedDamage`, `ResetAccumulatedDamage`. Key difference from `IBerserkrRageService`: Resonance is never spent by normal abilities (only Unraveling capstone resets it).
- **`ISeidkonaCorruptionService`** — Corruption evaluation contract: `EvaluateRisk(SeidkonaAbilityId, int)`, `ApplyCorruption(Guid, SeidkonaCorruptionRiskResult)`, `GetTriggerDescription(SeidkonaCorruptionTrigger)`. Key difference from `IBerserkrCorruptionService`: no `targetIsCoherent` parameter, no `CheckCombatEntryRisk` — Seiðkona Corruption is purely Resonance-based probability.
- **`ISeidkonaAbilityService`** — Ability execution contract: `ExecuteSeidrBolt(Player, Guid)` → `SeidrBoltResult?`, `ExecuteWyrdSight(Player)` → `WyrdSightResult?`, `GetAetherAttunementBonus(Player)` → `int`. Utility: `GetAbilityReadiness`, `CanUnlockTier2/3/Capstone`, `GetPPInvested`.

### Application Layer — Services

- **`SeidkonaResonanceService`** — Resonance management implementation:
  - `BuildResonance()`: delegates to `AetherResonanceResource.Build()`, detects threshold crossings into Corruption risk tiers (Risky/Dangerous/Critical), logs transitions at Warning level
  - `AddAccumulatedDamage()`: immutable swap pattern — `player.SetAccumulatedAethericDamage(current.AddDamage(damage))`
  - `ResetResonance()` and `ResetAccumulatedDamage()`: for Unraveling capstone and death scenarios
  - Exhaustive logging: LogInformation for success, LogWarning for failures and risk threshold crossings
- **`SeidkonaCorruptionService`** — Probability-based Corruption evaluation:
  - `internal virtual int RollD100()` for deterministic test overriding
  - `EvaluateRisk()`: switch per ability → SeidrBolt checks Resonance tier → if 0% return safe → roll d100 → compare vs threshold → return triggered or safe-with-roll
  - WyrdSight and AetherAttunement always return safe (no Aether channeled)
  - Future T2/T3 abilities routed to `EvaluateGenericCastingRisk()` with `CastingAtHighResonance` trigger
  - Private helpers: `GetSeidrBoltRiskParameters()`, `GetRiskPercent()`
  - 7 private constants for all thresholds
- **`SeidkonaAbilityService`** — Ability execution implementation:
  - Guard-clause chain: null → spec → ability unlocked → AP → **Corruption eval BEFORE spending** → spend AP → roll damage → build resonance → add accumulated damage → apply corruption → return result
  - Seiðr Bolt: 1 AP, 2d6 Aetheric damage, +1 Resonance, +damage to Accumulated tracker, Corruption check at Resonance 5+
  - Wyrd Sight: 2 AP, 3 turns, 10 spaces, detects invisible/magic/Corruption. **NO Resonance gain, NO Corruption check**
  - Aether Attunement: passive, returns 10 (+10%) if unlocked, 0 otherwise
  - `internal virtual int Roll2D6()` for deterministic test overriding
  - `private static bool IsSeidkona(Player)` helper
  - 8 constants: SeidrBoltApCost, WyrdSightApCost, AetherAttunementBonus, SeidrBoltResonanceGain, Tier2/3/CapstonePpRequirement, SeidkonaSpecId

### Entity Extensions

- **`Player.cs`** — Seiðkona section added after Veiðimaðr section:
  - `AetherResonanceResource? AetherResonance` — Nullable mutable Resonance resource
  - `AccumulatedAethericDamage? AccumulatedAethericDamage` — Nullable immutable damage tracker
  - `WyrdSightResult? WyrdSight` — Nullable active Wyrd Sight effect
  - `HashSet<SeidkonaAbilityId> _unlockedSeidkonaAbilities` — Private backing set
  - `UnlockedSeidkonaAbilities` — Read-only collection accessor
  - `InitializeAetherResonance()` — Creates both Resonance and Accumulated Damage trackers
  - `SetAetherResonance(AetherResonanceResource)` — Direct resource replacement
  - `SetAccumulatedAethericDamage(AccumulatedAethericDamage)` — Immutable swap target
  - `SetWyrdSight(WyrdSightResult?)` — Effect activation/clearing
  - `HasSeidkonaAbilityUnlocked(SeidkonaAbilityId)` — Ability check
  - `UnlockSeidkonaAbility(SeidkonaAbilityId)` — Ability unlock
  - `GetSeidkonaPPInvested()` — PP calculation: T1=0, T2=4, T3=5, Capstone=6

### Configuration

- Updated `config/specializations.json` with seidkona entry:
  - Mystic archetype, Heretical path (final)
  - Special resource: aether-resonance (max 10, start 0, casting-generated, probability-based Corruption risk scaling, not restored on rest)
  - 4 tiers: Foundation (3), Discipline (3), Mastery (2), Capstone (1) = 9 abilities total
- Updated `config/abilities.json` with 3 Tier 1 abilities:
  - `seidr-bolt`: Active damage, 1 AP, range 12 spaces, 2d6 Aetheric damage, +1 Resonance, accumulates damage
  - `wyrd-sight`: Active detection, 2 AP, 10-space radius, 3 turns, detects invisible/magic/Corruption, no Resonance
  - `aether-attunement`: Passive, +10% AP regeneration rate
- Updated `config/damage-types.json` with aetheric damage type:
  - id: "aetheric", color: "mediumorchid1", sortOrder: 7

### Unit Tests

- **`AetherResonanceResourceTests`** — 18 domain tests (parameterized): factory (default, custom max, invalid max, CreateAt standard/clamp-max/clamp-zero), build (standard, cap at max, at max returns 0, zero/negative), reset, Corruption risk (10 cases: 0%/5%/15%/25% at each level), IsInCorruptionRange (4 cases), IsAtMaxResonance (2 cases), GetResonanceLevel (7 cases: Safe/Risky/Dangerous/Critical), display (status string with risk, safe status, formatted value)
- **`AccumulatedAethericDamageTests`** — 9 domain tests: factory (zeroed), AddDamage (single, multiple accumulation, negative treated as zero, zero counts cast), reset (returns zeroed), average (no casts returns 0, multiple casts correct), display (no casts format, with casts format)
- **`SeidkonaAbilityServiceTests`** — 27 application tests: SeidrBolt (valid exec, insufficient AP, wrong spec, ability not unlocked, builds resonance via mock verify, accumulates damage via mock verify, low resonance no corruption check, mid resonance corruption triggered, mid resonance corruption safe with roll), WyrdSight (valid exec with all detection flags, insufficient AP, wrong spec, does NOT build resonance, does NOT trigger corruption), AetherAttunement (unlocked returns 10, not unlocked returns 0, wrong spec returns 0), utility (ability readiness with mixed AP, PP invested T1 returns 0, CanUnlockTier2 insufficient PP), Corruption service direct tests (below threshold safe, risky range roll-under triggers, risky range roll-over safe, dangerous range correct threshold, critical range correct threshold, WyrdSight always safe, AetherAttunement always safe)

## Design Decisions

- **Probability-based Corruption**: Unlike the Berserkr's deterministic Corruption (always triggers at 80+ Rage), the Seiðkona uses d100 probability checks (5%/15%/25%). This creates uncertainty and risk-taking gameplay — the player may cast many times at low Resonance without consequence, but each cast at high Resonance is a gamble. The `SeidkonaCorruptionRiskResult` captures both the roll and threshold for full transparency.
- **Resonance builds, not consumed**: Aether Resonance only increases through casting and never decreases from ability usage. Only the Unraveling capstone (v0.20.8c) and death reset it. This is an intentional escalation mechanic — the longer a Seiðkona fights, the more dangerous she becomes to herself and her enemies.
- **Dual tracker system**: `AetherResonanceResource` (mutable, tracks attunement) and `AccumulatedAethericDamage` (immutable, tracks total output) serve different roles. Resonance determines Corruption risk; Accumulated Damage determines Unraveling payload. They are updated by different abilities and reset independently.
- **Wyrd Sight has NO Resonance and NO Corruption**: This is an explicit design decision, not an oversight. Wyrd Sight is pure detection — the Seiðkona opens her senses without channeling destructive Aether. This gives players a safe ability option and creates tactical choices about when to cast offensively vs. gather information.
- **Corruption eval BEFORE spending**: Consistent with the Berserkr pattern (v0.20.5a), Corruption risk is evaluated using the Resonance level before any changes from the current cast. This means the first cast that brings Resonance to 5 does NOT trigger a check on that cast — only subsequent casts face the risk.
- **ID range 800-808**: Continues the established pattern of per-specialization ID ranges (Berserkr 1-9, Bone-Setter 600-608, Veiðimaðr 700-708).
- **Mutable vs Immutable VO pattern**: `AetherResonanceResource` uses mutable `private set` (like `RageResource`) for combat-frequency mutation. `AccumulatedAethericDamage` uses immutable `init` (like `MedicalSuppliesResource`) because it changes less frequently.

## Test Results

```
Seiðkona tests: 73
     Passed: 73
     Failed: 0

Breakdown:
  AetherResonanceResourceTests:          18 domain tests (parameterized)
  AccumulatedAethericDamageTests:         9 domain tests
  SeidkonaAbilityServiceTests:           27 application tests
  (includes 8 Corruption service direct tests)
```

## Files Changed

### New Files (21)
| File | Layer | Type |
|------|-------|------|
| `src/Core/RuneAndRust.Domain/Enums/SeidkonaAbilityId.cs` | Domain | Enum |
| `src/Core/RuneAndRust.Domain/Enums/SeidkonaCorruptionTrigger.cs` | Domain | Enum |
| `src/Core/RuneAndRust.Domain/ValueObjects/AetherResonanceResource.cs` | Domain | Value Object |
| `src/Core/RuneAndRust.Domain/ValueObjects/AccumulatedAethericDamage.cs` | Domain | Value Object |
| `src/Core/RuneAndRust.Domain/ValueObjects/SeidkonaCorruptionRiskResult.cs` | Domain | Value Object |
| `src/Core/RuneAndRust.Domain/ValueObjects/SeidrBoltResult.cs` | Domain | Value Object |
| `src/Core/RuneAndRust.Domain/ValueObjects/WyrdSightResult.cs` | Domain | Value Object |
| `src/Core/RuneAndRust.Application/Interfaces/ISeidkonaResonanceService.cs` | Application | Interface |
| `src/Core/RuneAndRust.Application/Interfaces/ISeidkonaCorruptionService.cs` | Application | Interface |
| `src/Core/RuneAndRust.Application/Interfaces/ISeidkonaAbilityService.cs` | Application | Interface |
| `src/Core/RuneAndRust.Application/Services/SeidkonaResonanceService.cs` | Application | Service |
| `src/Core/RuneAndRust.Application/Services/SeidkonaCorruptionService.cs` | Application | Service |
| `src/Core/RuneAndRust.Application/Services/SeidkonaAbilityService.cs` | Application | Service |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/AetherResonanceResourceTests.cs` | Tests | Domain VO |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/AccumulatedAethericDamageTests.cs` | Tests | Domain VO |
| `tests/RuneAndRust.Application.UnitTests/Services/SeidkonaAbilityServiceTests.cs` | Tests | Application |
| `docs/changelogs/v0.20.8a-changelog.md` | Docs | Changelog |

### Modified Files (4)
| File | Change |
|------|--------|
| `src/Core/RuneAndRust.Domain/Entities/Player.cs` | Added Seiðkona section (properties, backing fields, methods) |
| `config/specializations.json` | Added seidkona entry with Mystic archetype and Aether Resonance resource |
| `config/abilities.json` | Added 3 Tier 1 abilities (seidr-bolt, wyrd-sight, aether-attunement) |
| `config/damage-types.json` | Added "aetheric" damage type |
