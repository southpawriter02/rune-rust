# v0.19.1 Scope Breakdown: Midgard Implementation

## Overview

v0.19.1 implements **Midgard — The Tamed Ruin** (Deck 04), the agricultural heartland and most populous realm in Aethelgard. As the starting area and primary surface realm, Midgard serves as the baseline for all other biome implementations.

> *"The Wall is the soul of the Hold."*
> — Midgard Combine proverb

---

## In Scope

### Midgard Core Definition

| Property | Value |
|----------|-------|
| **Realm ID** | `Midgard` |
| **Deck** | 04 — Civilian Habitation |
| **Verticality** | Z=0 to Z=+1 (Surface Realm) |
| **Population** | Large (10,000+) |
| **Primary Condition** | None (temperate) |
| **Theme** | Agricultural heartland; tamed wilderness |

### Four Sub-Biomes (Zones)

| Zone | Theme | Hazard Profile |
|------|-------|----------------|
| **The Greatwood** | Feral forest; designer trees gone wild | Territorial fauna, pack predators |
| **The Asgardian Scar** | Impact crater; Blight epicenter | Permanent Blight-Storm, reality distortion |
| **The Souring Mires** | Toxic wetland; industrial runoff | Toxic runoff, seasonal flooding |
| **The Serpent Fjords** | Poisoned coast; leviathan waters | Hafgufa's Brood, coastal raiders |

### Domain Layer Components

| Component | Type | Purpose |
|-----------|------|---------|
| `MidgardZoneId` | Enum | Identifies the 4 sub-biomes |
| `MidgardDefinition` | Extension | Complete Midgard BiomeDefinition |
| `GreatwoodZone` | BiomeZone | Feral forest configuration |
| `AsgardianScarZone` | BiomeZone | Blight epicenter configuration |
| `SouringMiresZone` | BiomeZone | Toxic wetland configuration |
| `SerpentFjordsZone` | BiomeZone | Coastal zone configuration |

### Application Layer Components

| Component | Purpose |
|-----------|---------|
| `IMidgardHazardService` | Manages Midgard-specific territorial hazards |
| `MidgardSpawnProfile` | Faction spawn weights per sub-biome |

### Configuration

| File | Purpose |
|------|---------|
| `midgard.json` | Complete Midgard biome definition |
| `midgard_spawn_pools.json` | Spawn pool configurations |

---

## Out of Scope (Deferred)

- Hold settlement mechanics (v0.20.x+ Social Systems)
- Agricultural production calculations
- Combine faction reputation
- Quest content for Midgard locations
- Room template pool definitions

---

## Midgard Lore Summary

### Pre-Glitch Function

Deck 04 was an engineered paradise—a meticulously curated civilian habitat at the heart of the YGGDRASIL Network:

| System | Function |
|--------|----------|
| Climate Control | Perpetual spring maintained by environmental regulation |
| Wunjo-Frequency Broadcast | Psycho-spiritual harmony through Aetheric substrate |
| Bio-Engineered Ecology | Designer flora and fauna, curated for aesthetic and utility |
| Automated Maintenance | Self-tending gardens, no human intervention required |

### The Collapse (Ginnungagap Glitch)

| Period | Event | Effect |
|--------|-------|--------|
| Years 1-100 PG | Fimbulwinter | Century-long freeze from Surtr/Niflheim failures |
| Years 100+ PG | The Great Melt | Glacial retreat created toxic Ash-Fall Earth |
| Present (783 PG) | Age of Echoes | Semi-habitable through improvisation, not mastery |

### Current State

| Property | Description |
|----------|-------------|
| Population | Largest in Aethelgard; concentrated in fortified Holds |
| Economy | 60-70% of surface-realm grain supply |
| Governance | Midgard Combine (agricultural confederation) |
| Threat Level | Moderate (territorial fauna, Blight zones) |

---

## Zone Specifications

### The Greatwood

| Property | Value |
|----------|-------|
| **Zone ID** | `Greatwood` |
| **Theme** | Feral forest descended from curated pre-Glitch parks |
| **Character** | Dense wilderness of mutated designer trees |
| **Primary Hazard** | Territorial fauna, pack predators |
| **Navigation** | Rangers Guild waystone network, Trail-Cant markers |
| **Verticality** | Z=0 to Z=+1 |

#### Greatwood Fauna

| Entity | Description | Threat |
|--------|-------------|--------|
| Ash-Vargr | Pack predators; coordinate ambushes | Moderate |
| Járn-hjortr (Iron-Elk) | Territorial herbivores; charge intruders | Moderate |
| Rune-Bears | Solitary apex predators | High |
| Grit-Golems | Agricultural constructs; corrupted "Protect the Harvest" | High |

#### Greatwood Environmental Properties

```json
{
  "temperatureCelsius": 18,
  "aethericIntensity": 0.2,
  "humidityPercent": 65,
  "lightLevel": 0.5,
  "scaleFactor": 1.0,
  "corrosionRate": 0.15
}
```

---

### The Asgardian Scar

| Property | Value |
|----------|-------|
| **Zone ID** | `AsgardianScar` |
| **Theme** | Colossal impact crater; orbital debris |
| **Character** | Epicenter of Runic Blight in Midgard |
| **Primary Hazard** | Permanent Blight-Storm; reality distortion |
| **Navigation** | Class D expedition paths only; safe-conduct writs required |
| **Verticality** | Z=0 to Z=+1 |

#### Scar-Specific Hazards

| Hazard | Type | Effect |
|--------|------|--------|
| Blight-Storm | Ambient | Elevated CPS accumulation |
| Gravitational Anomaly (S2) | Zone | Altered gravity pockets |
| Temporal Pocket (T1) | Zone | Time dilation effects |
| Genius Loci Fragments | Entity | Fragmented O.D.I.N. consciousness |

#### Scar Environmental Properties (Override)

```json
{
  "temperatureCelsius": 15,
  "aethericIntensity": 0.8,
  "humidityPercent": 40,
  "lightLevel": 0.6,
  "scaleFactor": 1.0,
  "corrosionRate": 0.4,
  "overrideCondition": "CpsExposure",
  "conditionDcModifier": 2
}
```

---

### The Souring Mires

| Property | Value |
|----------|-------|
| **Zone ID** | `SouringMires` |
| **Theme** | Toxic wetlands draining from Helheim |
| **Character** | Industrial runoff contamination |
| **Primary Hazard** | Toxic runoff, seasonal flooding |
| **Navigation** | Ferry Guild routes with seasonal windows |
| **Verticality** | Z=0 |

#### Mires-Specific Hazards

| Hazard | Type | Effect |
|--------|------|--------|
| Toxic Water | Terrain | Contact causes Poison damage |
| Seasonal Flooding | Event | Route closures, forced evacuation |
| Skar-Horde Raiders | Faction | Hostile humanoid encounters |

#### Mires Environmental Properties (Override)

```json
{
  "temperatureCelsius": 20,
  "aethericIntensity": 0.35,
  "humidityPercent": 90,
  "lightLevel": 0.4,
  "scaleFactor": 1.0,
  "corrosionRate": 0.5,
  "overrideCondition": "ToxicAtmosphere",
  "conditionDcModifier": -4
}
```

*Note: Lower DC than Helheim proper (DC 10 instead of 14)*

---

### The Serpent Fjords

| Property | Value |
|----------|-------|
| **Zone ID** | `SerpentFjords` |
| **Theme** | Poisoned coastlines; leviathan territory |
| **Character** | Rocky coast with evacuation-ready docks |
| **Primary Hazard** | Hafgufa's Brood attacks |
| **Navigation** | Tidal schedules, leviathan patrol tracking |
| **Verticality** | Z=0 |

#### Fjords-Specific Hazards

| Hazard | Type | Effect |
|--------|------|--------|
| Hafgufa Spawn | Boss | Leviathan attacks from shallows |
| Tidal Surge | Event | Flooding, navigation hazard |
| Coastal Raiders | Faction | Hostile humanoid encounters |

#### Fjords Environmental Properties (Override)

```json
{
  "temperatureCelsius": 14,
  "aethericIntensity": 0.25,
  "humidityPercent": 80,
  "lightLevel": 0.7,
  "scaleFactor": 1.0,
  "corrosionRate": 0.35
}
```

---

## Domain Layer Specifications

### MidgardZoneId Enum

```csharp
/// <summary>
/// Identifies sub-biomes within Midgard.
/// </summary>
public enum MidgardZoneId
{
    /// <summary>Feral forest; designer trees gone wild.</summary>
    Greatwood,

    /// <summary>Impact crater; Runic Blight epicenter.</summary>
    AsgardianScar,

    /// <summary>Toxic wetlands; Helheim contamination.</summary>
    SouringMires,

    /// <summary>Poisoned coast; leviathan territory.</summary>
    SerpentFjords
}
```

### MidgardFaunaType Enum

```csharp
/// <summary>
/// Native fauna types found in Midgard.
/// </summary>
public enum MidgardFaunaType
{
    /// <summary>Pack predators; coordinate ambushes.</summary>
    AshVargr,

    /// <summary>Territorial herbivores; charge intruders.</summary>
    JarnHjortr,

    /// <summary>Solitary apex predators.</summary>
    RuneBear,

    /// <summary>Corrupted agricultural constructs.</summary>
    GritGolem,

    /// <summary>Leviathan offspring; aquatic predators.</summary>
    HafgufaSpawn
}
```

### TerritorialEncounter Value Object

```csharp
/// <summary>
/// Defines a territorial fauna encounter in Midgard.
/// </summary>
public sealed record TerritorialEncounter
{
    /// <summary>Fauna type for this encounter.</summary>
    public required MidgardFaunaType FaunaType { get; init; }

    /// <summary>Number of creatures in the encounter.</summary>
    public required int Count { get; init; }

    /// <summary>Whether this is an ambush encounter.</summary>
    public bool IsAmbush { get; init; } = false;

    /// <summary>Zone where this encounter occurs.</summary>
    public required MidgardZoneId Zone { get; init; }

    /// <summary>Base CR for encounter scaling.</summary>
    public required int BaseChallengeRating { get; init; }
}
```

### ScarAnomalyType Enum

```csharp
/// <summary>
/// Reality anomaly types found in the Asgardian Scar.
/// </summary>
public enum ScarAnomalyType
{
    /// <summary>Type-S2: Gravitational distortion pocket.</summary>
    GravitationalAnomaly,

    /// <summary>Type-T1: Temporal dilation zone.</summary>
    TemporalPocket,

    /// <summary>Fragmented O.D.I.N. AI consciousness.</summary>
    GeniusLociFragment,

    /// <summary>Concentrated Blight manifestation.</summary>
    BlightNexus
}
```

### ScarAnomaly Entity

```csharp
/// <summary>
/// Reality anomaly within the Asgardian Scar.
/// </summary>
public sealed class ScarAnomaly
{
    /// <summary>Unique anomaly identifier.</summary>
    public required Guid Id { get; init; }

    /// <summary>Anomaly classification.</summary>
    public required ScarAnomalyType Type { get; init; }

    /// <summary>Severity level (1-4).</summary>
    public required int Severity { get; init; }

    /// <summary>Radius of effect in tiles.</summary>
    public required int RadiusTiles { get; init; }

    /// <summary>Effect description for narrative.</summary>
    public required string EffectDescription { get; init; }

    /// <summary>Mechanical effects applied within radius.</summary>
    public IReadOnlyList<string> MechanicalEffects { get; init; } = [];
}
```

---

## Application Layer Specifications

### IMidgardHazardService Interface

```csharp
/// <summary>
/// Manages Midgard-specific environmental hazards.
/// </summary>
public interface IMidgardHazardService
{
    /// <summary>Generates a territorial encounter for a zone.</summary>
    TerritorialEncounter? GenerateTerritorialEncounter(
        MidgardZoneId zone,
        int partyLevel,
        Random? rng = null);

    /// <summary>Checks for Scar anomaly effects at a location.</summary>
    ScarAnomaly? GetAnomalyAtLocation(int x, int y, int z);

    /// <summary>Gets the current seasonal flooding status for the Mires.</summary>
    bool IsMiresFlooded();

    /// <summary>Gets the current tidal status for the Fjords.</summary>
    TidalStatus GetFjordsTidalStatus();

    /// <summary>Checks for Hafgufa spawn threat level.</summary>
    int GetHafgufaThreatLevel(int distanceFromShore);
}
```

### TidalStatus Enum

```csharp
/// <summary>
/// Tidal conditions in the Serpent Fjords.
/// </summary>
public enum TidalStatus
{
    /// <summary>Low tide; extended beach access.</summary>
    LowTide,

    /// <summary>Normal conditions.</summary>
    Normal,

    /// <summary>High tide; reduced beach access.</summary>
    HighTide,

    /// <summary>Tidal surge; flooding hazard.</summary>
    TidalSurge
}
```

### MidgardSpawnProfile Record

```csharp
/// <summary>
/// Spawn profile for a Midgard zone.
/// </summary>
public sealed record MidgardSpawnProfile
{
    /// <summary>Zone this profile applies to.</summary>
    public required MidgardZoneId Zone { get; init; }

    /// <summary>Primary faction (60% spawn weight).</summary>
    public required string PrimaryFaction { get; init; }

    /// <summary>Secondary faction (30% spawn weight).</summary>
    public required string SecondaryFaction { get; init; }

    /// <summary>Rare faction (10% spawn weight).</summary>
    public required string RareFaction { get; init; }

    /// <summary>Zone-specific fauna spawns.</summary>
    public IReadOnlyList<MidgardFaunaType> NativeFauna { get; init; } = [];
}
```

---

## Configuration Specifications

### midgard.json

```json
{
  "id": "Midgard",
  "name": "Midgard",
  "subtitle": "The Tamed Ruin",
  "deckNumber": 4,
  "preGlitchFunction": "Civilian Habitation & Agricultural Production",
  "postGlitchState": "Agricultural heartland; most populous realm; foundation of post-Glitch civilization",
  "baseProperties": {
    "temperatureCelsius": 18,
    "aethericIntensity": 0.3,
    "humidityPercent": 60,
    "lightLevel": 0.7,
    "scaleFactor": 1.0,
    "corrosionRate": 0.2
  },
  "primaryCondition": "None",
  "minVerticalZone": 0,
  "maxVerticalZone": 1,
  "zones": [
    {
      "id": "Greatwood",
      "name": "The Greatwood",
      "description": "Feral forest descended from curated pre-Glitch parks. Designer trees have gone wild—no longer pruned by automated systems, grown into dense, unpredictable wilderness.",
      "overrideProperties": {
        "humidityPercent": 65,
        "lightLevel": 0.5,
        "corrosionRate": 0.15
      },
      "nativeFauna": ["AshVargr", "JarnHjortr", "RuneBear", "GritGolem"],
      "navigation": {
        "method": "Rangers Guild waystone network",
        "markers": "Trail-Cant signs"
      }
    },
    {
      "id": "AsgardianScar",
      "name": "The Asgardian Scar",
      "description": "Colossal impact crater where portions of the Asgard orbital arcology crashed during the Glitch. Epicenter of Runic Blight in Midgard.",
      "overrideProperties": {
        "temperatureCelsius": 15,
        "aethericIntensity": 0.8,
        "humidityPercent": 40,
        "lightLevel": 0.6,
        "corrosionRate": 0.4
      },
      "overrideCondition": "CpsExposure",
      "conditionDcModifier": 2,
      "hazards": ["BlightStorm", "GravitationalAnomaly", "TemporalPocket", "GeniusLociFragment"],
      "navigation": {
        "method": "Class D expedition paths only",
        "requirement": "Safe-conduct writ at Perimeter Gate"
      }
    },
    {
      "id": "SouringMires",
      "name": "The Souring Mires",
      "description": "Toxic wetlands draining industrial runoff from Jötunheim and Helheim through collapsed infrastructure channels.",
      "overrideProperties": {
        "temperatureCelsius": 20,
        "aethericIntensity": 0.35,
        "humidityPercent": 90,
        "lightLevel": 0.4,
        "corrosionRate": 0.5
      },
      "overrideCondition": "ToxicAtmosphere",
      "conditionDcModifier": -4,
      "hazards": ["ToxicWater", "SeasonalFlooding"],
      "navigation": {
        "method": "Ferry Guild routes",
        "timing": "Seasonal flood windows"
      }
    },
    {
      "id": "SerpentFjords",
      "name": "The Serpent Fjords",
      "description": "Poisoned coastlines where Hafgufa's Brood—leviathan descendants of pre-Glitch aquaculture experiments—patrol the shallows.",
      "overrideProperties": {
        "temperatureCelsius": 14,
        "aethericIntensity": 0.25,
        "humidityPercent": 80,
        "lightLevel": 0.7,
        "corrosionRate": 0.35
      },
      "nativeFauna": ["HafgufaSpawn"],
      "hazards": ["HafgufaAttack", "TidalSurge"],
      "navigation": {
        "method": "Tidal schedules",
        "tracking": "Leviathan patrol patterns"
      }
    }
  ],
  "flavorQuote": "The Wall is the soul of the Hold.",
  "colorPalette": "green-brown-grey-amber"
}
```

### midgard_spawn_pools.json

```json
{
  "realm": "Midgard",
  "spawnProfiles": [
    {
      "zone": "Greatwood",
      "primaryFaction": "BlightedBeasts",
      "primaryWeight": 60,
      "secondaryFaction": "Humanoid",
      "secondaryWeight": 30,
      "rareFaction": "CorruptedMachinery",
      "rareWeight": 10,
      "nativeFauna": ["AshVargr", "JarnHjortr", "RuneBear", "GritGolem"]
    },
    {
      "zone": "AsgardianScar",
      "primaryFaction": "Forlorn",
      "primaryWeight": 50,
      "secondaryFaction": "AethericAnomalies",
      "secondaryWeight": 35,
      "rareFaction": "GeniusLociFragment",
      "rareWeight": 15,
      "nativeFauna": []
    },
    {
      "zone": "SouringMires",
      "primaryFaction": "BlightedBeasts",
      "primaryWeight": 45,
      "secondaryFaction": "Humanoid",
      "secondaryWeight": 40,
      "rareFaction": "AcidAdapted",
      "rareWeight": 15,
      "nativeFauna": []
    },
    {
      "zone": "SerpentFjords",
      "primaryFaction": "BlightedBeasts",
      "primaryWeight": 50,
      "secondaryFaction": "Humanoid",
      "secondaryWeight": 35,
      "rareFaction": "HafgufaSpawn",
      "rareWeight": 15,
      "nativeFauna": ["HafgufaSpawn"]
    }
  ]
}
```

---

## Unit Testing Requirements

### Midgard Definition Tests (~5 tests)

| Test | Description |
|------|-------------|
| `MidgardDefinition_HasCorrectDeckNumber` | Deck 04 |
| `MidgardDefinition_HasFourZones` | Greatwood, Scar, Mires, Fjords |
| `MidgardDefinition_NoPrimaryCondition` | Primary condition is None |
| `MidgardDefinition_CorrectVerticalRange` | Z=0 to Z=+1 |
| `MidgardDefinition_LoadsFromJson` | JSON parsing succeeds |

### Zone Override Tests (~6 tests)

| Test | Description |
|------|-------------|
| `AsgardianScar_HasCpsCondition` | Override condition is CpsExposure |
| `AsgardianScar_HasElevatedAethericIntensity` | 0.8 vs base 0.3 |
| `SouringMires_HasToxicCondition` | Override condition is ToxicAtmosphere |
| `SouringMires_HasReducedDc` | DC modifier is -4 |
| `Greatwood_InheritsBaseCondition` | No override, uses None |
| `SerpentFjords_HasCorrectTemperature` | 14°C coastal climate |

### MidgardHazardService Tests (~7 tests)

| Test | Description |
|------|-------------|
| `GenerateTerritorialEncounter_Greatwood_ReturnsValidEncounter` | Fauna matches zone |
| `GenerateTerritorialEncounter_AsgardianScar_ReturnsNull` | No territorial fauna in Scar |
| `GetAnomalyAtLocation_InScar_ReturnsAnomaly` | Returns anomaly within Scar |
| `GetAnomalyAtLocation_OutsideScar_ReturnsNull` | No anomalies outside Scar |
| `IsMiresFlooded_ReturnsBoolean` | Seasonal flooding check |
| `GetFjordsTidalStatus_ReturnsValidStatus` | Returns TidalStatus enum |
| `GetHafgufaThreatLevel_IncreasesNearShore` | Threat increases at shore |

**Total: ~18 tests**

---

## Acceptance Criteria

### Functional Requirements

- [ ] Midgard BiomeDefinition loads correctly from JSON
- [ ] All 4 zones defined with correct properties
- [ ] Zone property overrides apply correctly
- [ ] Asgardian Scar has CpsExposure condition
- [ ] Souring Mires has reduced-DC ToxicAtmosphere
- [ ] Territorial encounters generate for appropriate zones
- [ ] Scar anomalies generate within Scar boundaries
- [ ] Spawn pools return correct factions per zone

### Quality Requirements

- [ ] All public members have XML documentation
- [ ] Configuration validates against schema
- [ ] ~18 unit tests pass
- [ ] Zone descriptions match lore documents

---

## Dependencies

### Required From v0.19.0

| Dependency | Usage |
|------------|-------|
| `RealmId` enum | Midgard identifier |
| `BiomeDefinition` entity | Realm structure |
| `BiomeZone` entity | Zone structure |
| `EnvironmentalConditionType` | CpsExposure, ToxicAtmosphere |
| `IBiomeProvider` | Loading Midgard definition |

### Provides To Future Versions

| Provides | Consumer |
|----------|----------|
| Midgard zones | Room generation |
| Spawn profiles | Encounter spawning |
| Territorial encounters | Combat system |
| Scar anomalies | Reality distortion mechanics |

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    v0.19.1 Midgard Implementation                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Midgard Realm                         │   │
│  │                    (Deck 04, Z=0-1)                      │   │
│  ├─────────────────────────────────────────────────────────┤   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐                     │   │
│  │  │  Greatwood   │  │  Asgardian   │                     │   │
│  │  │    Zone      │  │    Scar      │                     │   │
│  │  │ (No Hazard)  │  │ (CPS Zone)   │                     │   │
│  │  │  Fauna: 4    │  │ Anomalies    │                     │   │
│  │  └──────────────┘  └──────────────┘                     │   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐                     │   │
│  │  │   Souring    │  │   Serpent    │                     │   │
│  │  │    Mires     │  │   Fjords     │                     │   │
│  │  │ (Toxic DC10) │  │ (Leviathans) │                     │   │
│  │  │  Flooding    │  │   Tides      │                     │   │
│  │  └──────────────┘  └──────────────┘                     │   │
│  │                                                          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Spawn Profiles                         │   │
│  │  ┌──────────────────────────────────────────────────┐  │   │
│  │  │ Greatwood: Beasts 60% | Humanoid 30% | Mach 10%  │  │   │
│  │  │ Scar:      Forlorn 50%| Aetheric 35% | GL 15%    │  │   │
│  │  │ Mires:     Beasts 45% | Humanoid 40% | Acid 15%  │  │   │
│  │  │ Fjords:    Beasts 50% | Humanoid 35% | Haf 15%   │  │   │
│  │  └──────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Deliverable Checklist

### Domain Layer

- [ ] `MidgardZoneId` enum (4 values)
- [ ] `MidgardFaunaType` enum (5 values)
- [ ] `ScarAnomalyType` enum (4 values)
- [ ] `TerritorialEncounter` value object
- [ ] `ScarAnomaly` entity

### Application Layer

- [ ] `IMidgardHazardService` interface
- [ ] `TidalStatus` enum
- [ ] `MidgardSpawnProfile` record

### Configuration

- [ ] `midgard.json` complete definition
- [ ] `midgard_spawn_pools.json`

### Tests

- [ ] Midgard definition tests (~5)
- [ ] Zone override tests (~6)
- [ ] MidgardHazardService tests (~7)
