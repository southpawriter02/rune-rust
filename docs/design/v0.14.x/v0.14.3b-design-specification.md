# v0.14.3b Design Specification: Trait Schema

**Version:** 0.14.3b
**Parent:** v0.14.3 (Monster Configuration Schemas)
**Prerequisites:** v0.14.2 Complete (Equipment Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Trait Schema Definition](#4-trait-schema-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [TraitDefinition Definition](#42-traitdefinition-definition)
   - 4.3 [StatModifiers Definition](#43-statmodifiers-definition)
   - 4.4 [ResistanceModifiers Definition](#44-resistancemodifiers-definition)
5. [Effect Type Configuration](#5-effect-type-configuration)
   - 5.1 [Effect Enumeration](#51-effect-enumeration)
   - 5.2 [Effect Value Semantics](#52-effect-value-semantics)
   - 5.3 [Trigger Threshold Usage](#53-trigger-threshold-usage)
6. [Trait Tag Configuration](#6-trait-tag-configuration)
   - 6.1 [Tag Definitions](#61-tag-definitions)
   - 6.2 [Tag Usage Examples](#62-tag-usage-examples)
7. [Visual Modifier Configuration](#7-visual-modifier-configuration)
   - 7.1 [Color Configuration](#71-color-configuration)
   - 7.2 [Visual Size Configuration](#72-visual-size-configuration)
   - 7.3 [Name Descriptor Configuration](#73-name-descriptor-configuration)
8. [Stat Modifier Configuration](#8-stat-modifier-configuration)
   - 8.1 [Flat Stat Bonuses](#81-flat-stat-bonuses)
   - 8.2 [Percentage Stat Bonuses](#82-percentage-stat-bonuses)
9. [Resistance Modifier Configuration](#9-resistance-modifier-configuration)
   - 9.1 [Resistance Grants](#91-resistance-grants)
   - 9.2 [Immunity Grants](#92-immunity-grants)
10. [Validation Rules](#10-validation-rules)
    - 10.1 [Enum Validation](#101-enum-validation)
    - 10.2 [Range Validation](#102-range-validation)
    - 10.3 [Required Fields](#103-required-fields)
    - 10.4 [Pattern Validation](#104-pattern-validation)
11. [Configuration Schema](#11-configuration-schema)
12. [Configuration File Updates](#12-configuration-file-updates)
13. [Data Model Changes](#13-data-model-changes)
14. [Logging Specifications](#14-logging-specifications)
15. [Unit Testing Requirements](#15-unit-testing-requirements)
16. [Use Cases](#16-use-cases)
17. [Deliverable Checklist](#17-deliverable-checklist)
18. [Acceptance Criteria](#18-acceptance-criteria)
19. [Dependencies](#19-dependencies)
20. [Future Considerations](#20-future-considerations)

---

## 1. Executive Summary

Version 0.14.3b introduces the **Trait Schema** (`traits.schema.json`), which validates monster trait definitions including effect types, stat modifiers, ability grants, resistance/immunity modifications, and visual modifiers. This schema enables full customization of monster traits without code changes, supporting modding scenarios where unique abilities, passive bonuses, triggered effects, and visual distinctions can be defined.

The Trait Schema provides comprehensive validation for the existing `traits.json` configuration while establishing patterns for trait-related data structures that are referenced by monsters (v0.14.3a) and will be used by bosses (v0.14.3d).

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `traits.schema.json` |
| **Schema Definitions** | `TraitDefinition`, `StatModifiers`, `ResistanceModifiers` |
| **Configuration Files** | Update `traits.json` to reference new schema |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version provides:
- **Effect type validation** - 11 effect types (Regeneration, Flying, Venomous, Armored, Berserker, SpellResistant, Undying, Splitting, Burrowing, Invisible, Teleporting)
- **Effect value validation** - Integer values with contextual meaning per effect type
- **Trigger threshold validation** - Conditional effect activation thresholds
- **Tag array validation** - 7 trait tags (passive, triggered, offensive, defensive, mobility, healing, poison)
- **Visual modifier fields** - Color, visual size, and name descriptors
- **Stat modifier grants** - Flat and percentage bonuses to health, attack, defense, speed, initiative
- **Ability grant references** - Links to abilities granted by traits
- **Resistance/immunity modifiers** - Damage type protections granted by traits

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    v0.14.3 MONSTER CONFIGURATION SCHEMAS                     │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.3a: monsters.schema.json                                         │
  │  v0.14.3b: traits.schema.json ◀── THIS VERSION                          │
  │  v0.14.3c: tiers.schema.json                                            │
  │  v0.14.3d: bosses.schema.json                                           │
  └─────────────────────────────────────────────────────────────────────────┘

  Cross-references:
  • monsters.json → possibleTraits references trait IDs from traits.json
  • abilities.json → grantedAbilityIds references ability IDs
  • damage-types.json → resistances and immunities reference damage type IDs

  Shared definitions:
  • ID pattern: ^[a-z][a-z0-9_]*$ (underscore convention for traits)
  • Resistance range: -100 to 100 (negative = weakness, positive = resistance)
  • Percentage range: 0.0 to 1.0 (for bonusPercent fields)
  • Schema location: config/schemas/
```

---

## 2. Feature Overview

```
v0.14.3b Trait Schema Features
├── traits.schema.json
│   ├── Root Configuration Properties
│   │   ├── $schema (string, optional)
│   │   ├── version (string, optional)
│   │   ├── description (string, optional, file-level)
│   │   └── traits (array of TraitDefinition, required)
│   └── Definitions
│       ├── TraitDefinition
│       │   ├── id (string, underscore pattern, required)
│       │   ├── name (string, minLength: 1, required)
│       │   ├── description (string, required)
│       │   ├── effect (enum, 11 effect types, required)
│       │   ├── effectValue (integer, required)
│       │   ├── triggerThreshold (integer, optional)
│       │   ├── tags (array of string, required)
│       │   ├── color (string, required)
│       │   ├── sortOrder (integer, minimum: 0, required)
│       │   ├── statModifiers (StatModifiers, optional)
│       │   ├── resistanceModifiers (ResistanceModifiers, optional)
│       │   ├── grantedAbilityIds (array of string, optional)
│       │   ├── visualSize (enum, optional)
│       │   └── nameDescriptor (string, optional)
│       ├── StatModifiers
│       │   ├── bonusHealth (integer, optional)
│       │   ├── bonusHealthPercent (number, 0-1, optional)
│       │   ├── bonusAttack (integer, optional)
│       │   ├── bonusAttackPercent (number, 0-1, optional)
│       │   ├── bonusDefense (integer, optional)
│       │   ├── bonusDefensePercent (number, 0-1, optional)
│       │   ├── bonusSpeed (integer, optional)
│       │   └── bonusInitiative (integer, optional)
│       └── ResistanceModifiers
│           ├── resistances (object, damage type -> percentage)
│           └── immunities (array of string, damage type IDs)
├── Validation Rules
│   ├── Trait ID Pattern Validation (underscore)
│   ├── Effect Enum Validation (11 options)
│   ├── Effect Value Integer Validation
│   ├── Trigger Threshold Optional Integer Validation
│   ├── Tags Enum Array Validation (7 options)
│   ├── Color String Validation
│   ├── Visual Size Enum Validation (5 options)
│   ├── Stat Modifier Range Validation
│   ├── Resistance Range Validation (-100 to 100)
│   └── Required Fields Enforced
└── Configuration Updates
    └── traits.json updated with $schema reference
```

---

## 3. Architecture Diagrams

### 3.1 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits traits.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads traits.schema.json from config/schemas/                            │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "effect must be one of: Regeneration, Flying, ..."
                           • "id must match pattern ^[a-z][a-z0-9_]*$"
                           • "tags must contain at least one item"
                           • "bonusHealthPercent must be between 0 and 1"
```

### 3.2 Trait Schema Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        traits.schema.json                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"                         │
│  title: "Monster Trait Configuration"                                        │
│  type: object                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  properties:                                                                 │
│  ┌─────────────────────────┬─────────────────────────────────────────────┐  │
│  │ $schema                 │ type: string (optional)                     │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ version                 │ type: string (optional)                     │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ description             │ type: string (optional, file-level)         │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ traits                  │ type: array, items: $ref TraitDefinition    │  │
│  └─────────────────────────┴─────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────────────────┤
│  definitions:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ TraitDefinition                                                      │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ id                    │ string, pattern: ^[a-z][a-z0-9_]*$    │   │    │
│  │ │ name                  │ string, minLength: 1                   │   │    │
│  │ │ description           │ string                                 │   │    │
│  │ │ effect                │ enum: 11 effect types                  │   │    │
│  │ │ effectValue           │ integer                                │   │    │
│  │ │ triggerThreshold      │ integer (optional)                     │   │    │
│  │ │ tags                  │ array of enum strings                  │   │    │
│  │ │ color                 │ string                                 │   │    │
│  │ │ sortOrder             │ integer, minimum: 0                    │   │    │
│  │ │ statModifiers         │ $ref StatModifiers (optional)          │   │    │
│  │ │ resistanceModifiers   │ $ref ResistanceModifiers (optional)    │   │    │
│  │ │ grantedAbilityIds     │ array of string (optional)             │   │    │
│  │ │ visualSize            │ enum: 5 size options (optional)        │   │    │
│  │ │ nameDescriptor        │ string (optional)                      │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ StatModifiers                                                        │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ bonusHealth           │ integer (optional)                     │   │    │
│  │ │ bonusHealthPercent    │ number, 0-1 (optional)                 │   │    │
│  │ │ bonusAttack           │ integer (optional)                     │   │    │
│  │ │ bonusAttackPercent    │ number, 0-1 (optional)                 │   │    │
│  │ │ bonusDefense          │ integer (optional)                     │   │    │
│  │ │ bonusDefensePercent   │ number, 0-1 (optional)                 │   │    │
│  │ │ bonusSpeed            │ integer (optional)                     │   │    │
│  │ │ bonusInitiative       │ integer (optional)                     │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ ResistanceModifiers                                                  │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ resistances           │ object (damage type -> percentage)     │   │    │
│  │ │ immunities            │ array of string (damage type IDs)      │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Trait Definition Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        TRAIT DEFINITION STRUCTURE                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      TRAIT DEFINITION                                │    │
│  │                                                                      │    │
│  │  id: "berserker"                                                     │    │
│  │  name: "Berserker"                                                   │    │
│  │  description: "Deals more damage when health drops below threshold." │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  EFFECT CONFIGURATION                                          │  │    │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │    │
│  │  │  │ effect: "Berserker"        (enum: 11 types)              │ │  │    │
│  │  │  │ effectValue: 50            (damage bonus %)              │ │  │    │
│  │  │  │ triggerThreshold: 30       (HP % to trigger)             │ │  │    │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  CLASSIFICATION                                                │  │    │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │    │
│  │  │  │ tags: ["offensive", "triggered"]                         │ │  │    │
│  │  │  │ sortOrder: 4                                             │ │  │    │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  VISUAL MODIFIERS                                              │  │    │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │    │
│  │  │  │ color: "red"                                             │ │  │    │
│  │  │  │ visualSize: "Large" (optional)                           │ │  │    │
│  │  │  │ nameDescriptor: "Raging" (optional)                      │ │  │    │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  STAT MODIFIERS (optional)                                     │  │    │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │    │
│  │  │  │ bonusHealth: 0             (flat bonus)                  │ │  │    │
│  │  │  │ bonusAttackPercent: 0.1    (10% attack boost)            │ │  │    │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  RESISTANCE MODIFIERS (optional)                               │  │    │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │    │
│  │  │  │ resistances: {}                                          │ │  │    │
│  │  │  │ immunities: []                                           │ │  │    │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  ABILITY GRANTS (optional)                                     │  │    │
│  │  │  ┌──────────────────────────────────────────────────────────┐ │  │    │
│  │  │  │ grantedAbilityIds: ["rage", "power_attack"]              │ │  │    │
│  │  │  └──────────────────────────────────────────────────────────┘ │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Effect Type System Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          EFFECT TYPE SYSTEM                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  EFFECT CATEGORIES                                                           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  PASSIVE EFFECTS (Always Active)                                      │   │
│  │  ┌────────────────┬────────────────┬──────────────────────────────┐  │   │
│  │  │ Effect         │ Value Meaning  │ Description                  │  │   │
│  │  ├────────────────┼────────────────┼──────────────────────────────┤  │   │
│  │  │ Regeneration   │ HP per turn    │ Heals HP each turn           │  │   │
│  │  │ Flying         │ Defense bonus  │ Harder to hit with melee     │  │   │
│  │  │ Armored        │ Defense bonus  │ Flat defense increase        │  │   │
│  │  │ SpellResistant │ Reduction %    │ Reduces magic damage         │  │   │
│  │  │ Invisible      │ Miss chance %  │ Attacks may miss             │  │   │
│  │  └────────────────┴────────────────┴──────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  TRIGGERED EFFECTS (Condition-Based)                                  │   │
│  │  ┌────────────────┬────────────────┬──────────────────────────────┐  │   │
│  │  │ Effect         │ Value Meaning  │ Trigger                      │  │   │
│  │  ├────────────────┼────────────────┼──────────────────────────────┤  │   │
│  │  │ Berserker      │ Damage bonus % │ HP below threshold           │  │   │
│  │  │ Undying        │ Revive HP %    │ On death                     │  │   │
│  │  │ Splitting      │ Spawn count    │ On death                     │  │   │
│  │  │ Venomous       │ Poison damage  │ On attack hit                │  │   │
│  │  └────────────────┴────────────────┴──────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  ACTIVE EFFECTS (Movement/Action-Based)                               │   │
│  │  ┌────────────────┬────────────────┬──────────────────────────────┐  │   │
│  │  │ Effect         │ Value Meaning  │ Description                  │  │   │
│  │  ├────────────────┼────────────────┼──────────────────────────────┤  │   │
│  │  │ Burrowing      │ Turns invuln.  │ Can burrow underground       │  │   │
│  │  │ Teleporting    │ Tiles distance │ Can teleport in combat       │  │   │
│  │  └────────────────┴────────────────┴──────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Stat Modifier Calculation Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STAT MODIFIER CALCULATION                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  CALCULATION ORDER                                                           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  1. Start with base stat (from monster definition)                    │   │
│  │  2. Apply flat bonuses (bonusHealth, bonusAttack, etc.)               │   │
│  │  3. Apply percentage bonuses (bonusHealthPercent, bonusAttackPercent) │   │
│  │                                                                       │   │
│  │  Example:                                                             │   │
│  │    Base Health: 100                                                   │   │
│  │    bonusHealth: 20                                                    │   │
│  │    bonusHealthPercent: 0.25 (25%)                                     │   │
│  │                                                                       │   │
│  │    Step 1: 100 (base)                                                 │   │
│  │    Step 2: 100 + 20 = 120 (after flat bonus)                          │   │
│  │    Step 3: 120 * 1.25 = 150 (after percentage bonus)                  │   │
│  │                                                                       │   │
│  │    Final Health: 150                                                  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  STAT MODIFIER FIELDS                                                        │
│                                                                              │
│  ┌────────────────────────┬─────────────────┬──────────────────────────┐    │
│  │ Field                  │ Type            │ Example                  │    │
│  ├────────────────────────┼─────────────────┼──────────────────────────┤    │
│  │ bonusHealth            │ integer         │ +20 HP                   │    │
│  │ bonusHealthPercent     │ number (0-1)    │ 0.25 = +25% HP           │    │
│  │ bonusAttack            │ integer         │ +5 Attack                │    │
│  │ bonusAttackPercent     │ number (0-1)    │ 0.10 = +10% Attack       │    │
│  │ bonusDefense           │ integer         │ +3 Defense               │    │
│  │ bonusDefensePercent    │ number (0-1)    │ 0.15 = +15% Defense      │    │
│  │ bonusSpeed             │ integer         │ +2 Speed                 │    │
│  │ bonusInitiative        │ integer         │ +1 Initiative            │    │
│  └────────────────────────┴─────────────────┴──────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── traits.json ◀───────────────────────────┐                              │
│  │   {                                        │ references                   │
│  │     "$schema": "./schemas/traits.schema.json",                            │
│  │     "description": "Monster trait definitions",                           │
│  │     "traits": [                            │                              │
│  │       {                                    │                              │
│  │         "id": "regenerating",              │                              │
│  │         "name": "Regenerating",            │                              │
│  │         "effect": "Regeneration",          │                              │
│  │         "effectValue": 5,                  │                              │
│  │         "tags": ["healing", "passive"],    │                              │
│  │         "color": "green",                  │                              │
│  │         "sortOrder": 0                     │                              │
│  │       },                                   │                              │
│  │       ...                                  │                              │
│  │     ]                                      │                              │
│  │   }                                        │                              │
│  │                                            │                              │
│  ├── monsters.json (references trait IDs)     │                              │
│  │                                            │                              │
│  └── schemas/                                 │                              │
│      └── traits.schema.json ──────────────────┘                              │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {                                                  │
│              "TraitDefinition": {...},                                       │
│              "StatModifiers": {...},                                         │
│              "ResistanceModifiers": {...}                                    │
│            }                                                                 │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Trait Schema Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/traits.schema.json`

The trait schema follows JSON Schema Draft-07 specification, providing comprehensive validation for trait configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Monster Trait Configuration",
    "description": "Schema for monster trait definitions. Defines special abilities and passive bonuses that can be applied to monsters.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "description": {
            "type": "string",
            "description": "Optional file-level description"
        },
        "traits": {
            "type": "array",
            "description": "List of trait definitions",
            "items": {
                "$ref": "#/definitions/TraitDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["traits"],
    "additionalProperties": false,
    "definitions": {
        "TraitDefinition": { ... },
        "StatModifiers": { ... },
        "ResistanceModifiers": { ... }
    }
}
```

### 4.2 TraitDefinition Definition

The `TraitDefinition` object defines a complete trait with all its properties.

```json
"TraitDefinition": {
    "type": "object",
    "description": "A trait that can be applied to monsters, providing special abilities or stat modifications",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the trait (lowercase with underscores)",
            "pattern": "^[a-z][a-z0-9_]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "Full description of the trait's effect",
            "minLength": 1
        },
        "effect": {
            "type": "string",
            "description": "The type of effect this trait provides",
            "enum": [
                "Regeneration",
                "Flying",
                "Venomous",
                "Armored",
                "Berserker",
                "SpellResistant",
                "Undying",
                "Splitting",
                "Burrowing",
                "Invisible",
                "Teleporting"
            ]
        },
        "effectValue": {
            "type": "integer",
            "description": "Numeric value for the effect (meaning varies by effect type)"
        },
        "triggerThreshold": {
            "type": "integer",
            "description": "Health percentage or other threshold that triggers the effect (for triggered effects)",
            "minimum": 0,
            "maximum": 100
        },
        "tags": {
            "type": "array",
            "description": "Category tags for trait classification",
            "items": {
                "type": "string",
                "enum": ["passive", "triggered", "offensive", "defensive", "mobility", "healing", "poison"]
            },
            "minItems": 1
        },
        "color": {
            "type": "string",
            "description": "Display color for the trait indicator",
            "minLength": 1
        },
        "sortOrder": {
            "type": "integer",
            "description": "Order for display sorting (lower values first)",
            "minimum": 0
        },
        "statModifiers": {
            "$ref": "#/definitions/StatModifiers"
        },
        "resistanceModifiers": {
            "$ref": "#/definitions/ResistanceModifiers"
        },
        "grantedAbilityIds": {
            "type": "array",
            "description": "Ability IDs granted by this trait",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9_-]*$"
            }
        },
        "visualSize": {
            "type": "string",
            "description": "Visual size modifier for monsters with this trait",
            "enum": ["Tiny", "Small", "Medium", "Large", "Huge"]
        },
        "nameDescriptor": {
            "type": "string",
            "description": "Descriptor added to monster name (e.g., 'Poisonous', 'Giant')",
            "minLength": 1,
            "maxLength": 50
        }
    },
    "required": ["id", "name", "description", "effect", "effectValue", "tags", "color", "sortOrder"],
    "additionalProperties": false
}
```

### 4.3 StatModifiers Definition

The `StatModifiers` object defines stat bonuses granted by a trait.

```json
"StatModifiers": {
    "type": "object",
    "description": "Stat modifications granted by the trait",
    "properties": {
        "bonusHealth": {
            "type": "integer",
            "description": "Flat bonus to maximum health"
        },
        "bonusHealthPercent": {
            "type": "number",
            "description": "Percentage bonus to maximum health (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1
        },
        "bonusAttack": {
            "type": "integer",
            "description": "Flat bonus to attack power"
        },
        "bonusAttackPercent": {
            "type": "number",
            "description": "Percentage bonus to attack power (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1
        },
        "bonusDefense": {
            "type": "integer",
            "description": "Flat bonus to defense"
        },
        "bonusDefensePercent": {
            "type": "number",
            "description": "Percentage bonus to defense (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1
        },
        "bonusSpeed": {
            "type": "integer",
            "description": "Flat bonus to speed (movement)"
        },
        "bonusInitiative": {
            "type": "integer",
            "description": "Flat bonus to initiative roll"
        }
    },
    "additionalProperties": false
}
```

### 4.4 ResistanceModifiers Definition

The `ResistanceModifiers` object defines resistance/immunity grants.

```json
"ResistanceModifiers": {
    "type": "object",
    "description": "Resistance and immunity modifications granted by the trait",
    "properties": {
        "resistances": {
            "type": "object",
            "description": "Damage type resistances to add (damage type ID -> percentage)",
            "additionalProperties": {
                "type": "integer",
                "minimum": -100,
                "maximum": 100
            }
        },
        "immunities": {
            "type": "array",
            "description": "Damage type IDs the monster becomes immune to",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9_-]*$"
            }
        }
    },
    "additionalProperties": false
}
```

---

## 5. Effect Type Configuration

### 5.1 Effect Enumeration

The effect enum defines the 11 trait effect types.

| Effect | Category | Description |
|--------|----------|-------------|
| `Regeneration` | Passive | Heals HP each turn |
| `Flying` | Passive | Harder to hit with melee attacks |
| `Venomous` | Triggered | Attacks have chance to poison |
| `Armored` | Passive | Flat defense bonus |
| `Berserker` | Triggered | Damage bonus when HP low |
| `SpellResistant` | Passive | Reduces magic damage |
| `Undying` | Triggered | Chance to revive on death |
| `Splitting` | Triggered | Spawns copies on death |
| `Burrowing` | Active | Can become invulnerable |
| `Invisible` | Passive | Attacks may miss |
| `Teleporting` | Active | Can teleport in combat |

### 5.2 Effect Value Semantics

The `effectValue` field has different meanings based on the effect type.

| Effect | Value Meaning | Example |
|--------|---------------|---------|
| `Regeneration` | HP healed per turn | `5` = heals 5 HP/turn |
| `Flying` | Defense bonus vs melee | `3` = +3 defense vs melee |
| `Venomous` | Poison damage on hit | `3` = 3 poison damage |
| `Armored` | Flat defense bonus | `3` = +3 defense |
| `Berserker` | Damage bonus percentage | `50` = +50% damage |
| `SpellResistant` | Magic damage reduction % | `25` = -25% magic damage |
| `Undying` | HP percentage on revive | `25` = revive at 25% HP |
| `Splitting` | Number of copies spawned | `2` = spawns 2 copies |
| `Burrowing` | Turns of invulnerability | `2` = 2 turns burrowed |
| `Invisible` | Miss chance percentage | `30` = 30% miss chance |
| `Teleporting` | Maximum teleport distance | `5` = can teleport 5 tiles |

### 5.3 Trigger Threshold Usage

The `triggerThreshold` field is used for conditional effects.

| Effect | Threshold Meaning | Example |
|--------|-------------------|---------|
| `Berserker` | HP percentage to activate | `30` = activates below 30% HP |
| `Undying` | Chance to trigger (%) | `50` = 50% chance to revive |
| `Venomous` | Poison application chance (%) | `75` = 75% chance to poison |

**Example - Berserker with threshold:**
```json
{
    "id": "berserker",
    "effect": "Berserker",
    "effectValue": 50,
    "triggerThreshold": 30,
    "description": "When health drops below 30%, deals 50% more damage"
}
```

---

## 6. Trait Tag Configuration

### 6.1 Tag Definitions

Tags classify traits for filtering and mechanical purposes.

| Tag | Description | Effect Types |
|-----|-------------|--------------|
| `passive` | Always active, no trigger needed | Regeneration, Flying, Armored, SpellResistant, Invisible |
| `triggered` | Activates on specific conditions | Berserker, Undying, Splitting, Venomous |
| `offensive` | Increases damage output | Berserker, Venomous |
| `defensive` | Increases survivability | Armored, Flying, SpellResistant, Undying, Burrowing, Invisible |
| `mobility` | Affects movement capabilities | Flying, Burrowing, Teleporting |
| `healing` | Restores or preserves HP | Regeneration, Undying |
| `poison` | Deals or involves poison | Venomous |

### 6.2 Tag Usage Examples

**Single Category:**
```json
{
    "id": "armored",
    "tags": ["defensive", "passive"]
}
```

**Multiple Categories:**
```json
{
    "id": "flying",
    "tags": ["mobility", "defensive"]
}
```

**Offensive Triggered:**
```json
{
    "id": "venomous",
    "tags": ["poison", "offensive"]
}
```

**Complex Combination:**
```json
{
    "id": "undying",
    "tags": ["defensive", "triggered", "healing"]
}
```

---

## 7. Visual Modifier Configuration

### 7.1 Color Configuration

The `color` field defines the display color for trait indicators in the UI.

**Standard Color Values:**
| Color | Usage | Traits |
|-------|-------|--------|
| `green` | Healing/Nature | Regenerating, Venomous |
| `red` | Aggression/Damage | Berserker |
| `cyan` | Mobility/Special | Flying, Teleporting |
| `grey` | Defense/Armor | Armored |
| `purple` | Magic/Spell | SpellResistant |
| `yellow` | Stealth/Warning | Invisible, Burrowing |
| `blue` | Undead/Death | Undying, Splitting |

**Example:**
```json
{
    "id": "berserker",
    "color": "red"
}
```

### 7.2 Visual Size Configuration

The optional `visualSize` field modifies the monster's visual representation.

| Size | Scale | Description |
|------|-------|-------------|
| `Tiny` | 0.5x | Half normal size |
| `Small` | 0.75x | Slightly smaller |
| `Medium` | 1.0x | Normal size (default) |
| `Large` | 1.5x | Noticeably larger |
| `Huge` | 2.0x | Double normal size |

**Example:**
```json
{
    "id": "giant",
    "visualSize": "Large",
    "nameDescriptor": "Giant"
}
```

### 7.3 Name Descriptor Configuration

The optional `nameDescriptor` field adds a prefix to the monster's display name.

**Examples:**
| Trait | Descriptor | Monster Name | Display Name |
|-------|------------|--------------|--------------|
| Venomous | "Poisonous" | Goblin | Poisonous Goblin |
| Giant (custom) | "Giant" | Orc | Giant Orc |
| Armored | "Armored" | Skeleton | Armored Skeleton |
| Invisible | "Phantom" | Slime | Phantom Slime |

**Example Configuration:**
```json
{
    "id": "venomous",
    "nameDescriptor": "Poisonous",
    "color": "green"
}
```

---

## 8. Stat Modifier Configuration

### 8.1 Flat Stat Bonuses

Flat bonuses add a fixed amount to the base stat.

**Available Flat Bonuses:**
| Field | Effect |
|-------|--------|
| `bonusHealth` | Adds to maximum HP |
| `bonusAttack` | Adds to attack power |
| `bonusDefense` | Adds to defense |
| `bonusSpeed` | Adds to movement speed |
| `bonusInitiative` | Adds to initiative roll |

**Example - Armored Trait:**
```json
{
    "id": "armored",
    "statModifiers": {
        "bonusDefense": 5
    }
}
```

**Example - Tough Trait:**
```json
{
    "id": "tough",
    "statModifiers": {
        "bonusHealth": 20,
        "bonusDefense": 2
    }
}
```

### 8.2 Percentage Stat Bonuses

Percentage bonuses multiply the stat after flat bonuses are applied.

**Available Percentage Bonuses:**
| Field | Effect | Range |
|-------|--------|-------|
| `bonusHealthPercent` | Multiplies HP | 0.0-1.0 |
| `bonusAttackPercent` | Multiplies attack | 0.0-1.0 |
| `bonusDefensePercent` | Multiplies defense | 0.0-1.0 |

**Example - Mighty Trait (25% more HP, 10% more attack):**
```json
{
    "id": "mighty",
    "statModifiers": {
        "bonusHealthPercent": 0.25,
        "bonusAttackPercent": 0.10
    }
}
```

**Example - Combined Flat and Percentage:**
```json
{
    "id": "juggernaut",
    "statModifiers": {
        "bonusHealth": 30,
        "bonusHealthPercent": 0.20,
        "bonusDefense": 5,
        "bonusDefensePercent": 0.15
    }
}
```

---

## 9. Resistance Modifier Configuration

### 9.1 Resistance Grants

The `resistances` object grants resistance percentages to damage types.

**Resistance Value Scale:**
| Value | Effect |
|-------|--------|
| `-100` | Double damage (2x) |
| `-50` | Increased damage (1.5x) |
| `0` | Normal damage |
| `50` | Reduced damage (0.5x) |
| `100` | Immune (0x) |

**Example - Fire Resistance Trait:**
```json
{
    "id": "fire_resistant",
    "resistanceModifiers": {
        "resistances": {
            "fire": 50
        }
    }
}
```

**Example - Multi-Element Resistance:**
```json
{
    "id": "elemental_ward",
    "resistanceModifiers": {
        "resistances": {
            "fire": 25,
            "ice": 25,
            "lightning": 25
        }
    }
}
```

### 9.2 Immunity Grants

The `immunities` array grants complete immunity (100% resistance) to damage types.

**Example - Poison Immunity:**
```json
{
    "id": "poison_immune",
    "resistanceModifiers": {
        "immunities": ["poison"]
    }
}
```

**Example - Multiple Immunities:**
```json
{
    "id": "elemental_immunity",
    "resistanceModifiers": {
        "immunities": ["fire", "ice"]
    }
}
```

**Example - Combined Resistance and Immunity:**
```json
{
    "id": "spell_resistant",
    "effect": "SpellResistant",
    "effectValue": 25,
    "resistanceModifiers": {
        "resistances": {
            "arcane": 50,
            "dark": 25
        },
        "immunities": ["charm"]
    }
}
```

---

## 10. Validation Rules

### 10.1 Enum Validation

| Property | Valid Values | Validation Error |
|----------|--------------|------------------|
| `effect` | `Regeneration`, `Flying`, `Venomous`, `Armored`, `Berserker`, `SpellResistant`, `Undying`, `Splitting`, `Burrowing`, `Invisible`, `Teleporting` | "effect must be one of: Regeneration, Flying, ..." |
| `tags[*]` | `passive`, `triggered`, `offensive`, `defensive`, `mobility`, `healing`, `poison` | "tag must be one of: passive, triggered, ..." |
| `visualSize` | `Tiny`, `Small`, `Medium`, `Large`, `Huge` | "visualSize must be one of: Tiny, Small, ..." |

### 10.2 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `triggerThreshold` | 0-100 | "triggerThreshold must be between 0 and 100" |
| `sortOrder` | >= 0 | "sortOrder must be >= 0" |
| `statModifiers.bonusHealthPercent` | 0-1 | "bonusHealthPercent must be between 0 and 1" |
| `statModifiers.bonusAttackPercent` | 0-1 | "bonusAttackPercent must be between 0 and 1" |
| `statModifiers.bonusDefensePercent` | 0-1 | "bonusDefensePercent must be between 0 and 1" |
| `resistanceModifiers.resistances.*` | -100 to 100 | "resistance value must be between -100 and 100" |

### 10.3 Required Fields

#### TraitDefinition Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `id` | Must be present and match pattern | "missing required property 'id'" |
| `name` | Must be present and non-empty | "missing required property 'name'" |
| `description` | Must be present | "missing required property 'description'" |
| `effect` | Must be present and valid enum | "missing required property 'effect'" |
| `effectValue` | Must be present | "missing required property 'effectValue'" |
| `tags` | Must be present with at least one tag | "missing required property 'tags'" |
| `color` | Must be present and non-empty | "missing required property 'color'" |
| `sortOrder` | Must be present and >= 0 | "missing required property 'sortOrder'" |

### 10.4 Pattern Validation

| Property | Pattern | Validation Error |
|----------|---------|------------------|
| `id` | `^[a-z][a-z0-9_]*$` | "id must match pattern ^[a-z][a-z0-9_]*$" |
| `version` | `^[0-9]+\.[0-9]+\.[0-9]+$` | "version must match pattern (e.g., '1.0.0')" |
| `grantedAbilityIds[*]` | `^[a-z][a-z0-9_-]*$` | "ability id must match pattern" |
| `resistanceModifiers.immunities[*]` | `^[a-z][a-z0-9_-]*$` | "immunity damage type must match pattern" |

---

## 11. Configuration Schema

### Complete Traits Schema File

**File:** `config/schemas/traits.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Monster Trait Configuration",
    "description": "Schema for monster trait definitions. Defines special abilities and passive bonuses that can be applied to monsters.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "description": {
            "type": "string",
            "description": "Optional file-level description"
        },
        "traits": {
            "type": "array",
            "description": "List of trait definitions",
            "items": {
                "$ref": "#/definitions/TraitDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["traits"],
    "additionalProperties": false,
    "definitions": {
        "TraitDefinition": {
            "type": "object",
            "description": "A trait that can be applied to monsters, providing special abilities or stat modifications",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the trait (lowercase with underscores)",
                    "pattern": "^[a-z][a-z0-9_]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "description": {
                    "type": "string",
                    "description": "Full description of the trait's effect",
                    "minLength": 1
                },
                "effect": {
                    "type": "string",
                    "description": "The type of effect this trait provides",
                    "enum": [
                        "Regeneration",
                        "Flying",
                        "Venomous",
                        "Armored",
                        "Berserker",
                        "SpellResistant",
                        "Undying",
                        "Splitting",
                        "Burrowing",
                        "Invisible",
                        "Teleporting"
                    ]
                },
                "effectValue": {
                    "type": "integer",
                    "description": "Numeric value for the effect (meaning varies by effect type)"
                },
                "triggerThreshold": {
                    "type": "integer",
                    "description": "Health percentage or other threshold that triggers the effect (for triggered effects)",
                    "minimum": 0,
                    "maximum": 100
                },
                "tags": {
                    "type": "array",
                    "description": "Category tags for trait classification",
                    "items": {
                        "type": "string",
                        "enum": ["passive", "triggered", "offensive", "defensive", "mobility", "healing", "poison"]
                    },
                    "minItems": 1
                },
                "color": {
                    "type": "string",
                    "description": "Display color for the trait indicator",
                    "minLength": 1
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Order for display sorting (lower values first)",
                    "minimum": 0
                },
                "statModifiers": {
                    "$ref": "#/definitions/StatModifiers"
                },
                "resistanceModifiers": {
                    "$ref": "#/definitions/ResistanceModifiers"
                },
                "grantedAbilityIds": {
                    "type": "array",
                    "description": "Ability IDs granted by this trait",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9_-]*$"
                    }
                },
                "visualSize": {
                    "type": "string",
                    "description": "Visual size modifier for monsters with this trait",
                    "enum": ["Tiny", "Small", "Medium", "Large", "Huge"]
                },
                "nameDescriptor": {
                    "type": "string",
                    "description": "Descriptor added to monster name (e.g., 'Poisonous', 'Giant')",
                    "minLength": 1,
                    "maxLength": 50
                }
            },
            "required": ["id", "name", "description", "effect", "effectValue", "tags", "color", "sortOrder"],
            "additionalProperties": false
        },
        "StatModifiers": {
            "type": "object",
            "description": "Stat modifications granted by the trait",
            "properties": {
                "bonusHealth": {
                    "type": "integer",
                    "description": "Flat bonus to maximum health"
                },
                "bonusHealthPercent": {
                    "type": "number",
                    "description": "Percentage bonus to maximum health (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1
                },
                "bonusAttack": {
                    "type": "integer",
                    "description": "Flat bonus to attack power"
                },
                "bonusAttackPercent": {
                    "type": "number",
                    "description": "Percentage bonus to attack power (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1
                },
                "bonusDefense": {
                    "type": "integer",
                    "description": "Flat bonus to defense"
                },
                "bonusDefensePercent": {
                    "type": "number",
                    "description": "Percentage bonus to defense (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1
                },
                "bonusSpeed": {
                    "type": "integer",
                    "description": "Flat bonus to speed (movement)"
                },
                "bonusInitiative": {
                    "type": "integer",
                    "description": "Flat bonus to initiative roll"
                }
            },
            "additionalProperties": false
        },
        "ResistanceModifiers": {
            "type": "object",
            "description": "Resistance and immunity modifications granted by the trait",
            "properties": {
                "resistances": {
                    "type": "object",
                    "description": "Damage type resistances to add (damage type ID -> percentage)",
                    "additionalProperties": {
                        "type": "integer",
                        "minimum": -100,
                        "maximum": 100
                    }
                },
                "immunities": {
                    "type": "array",
                    "description": "Damage type IDs the monster becomes immune to",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9_-]*$"
                    }
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 12. Configuration File Updates

### Updated traits.json

Update the existing `traits.json` to include the schema reference.

**File:** `config/traits.json`

```json
{
    "$schema": "./schemas/traits.schema.json",
    "description": "Monster trait definitions for v0.14.3b",
    "traits": [
        {
            "id": "regenerating",
            "name": "Regenerating",
            "description": "Heals a small amount of HP each turn.",
            "effect": "Regeneration",
            "effectValue": 5,
            "triggerThreshold": null,
            "tags": ["healing", "passive"],
            "color": "green",
            "sortOrder": 0
        },
        {
            "id": "flying",
            "name": "Flying",
            "description": "Harder to hit with melee attacks due to aerial mobility.",
            "effect": "Flying",
            "effectValue": 3,
            "triggerThreshold": null,
            "tags": ["mobility", "defensive"],
            "color": "cyan",
            "sortOrder": 1
        },
        {
            "id": "venomous",
            "name": "Venomous",
            "description": "Attacks have a chance to poison the target.",
            "effect": "Venomous",
            "effectValue": 3,
            "triggerThreshold": null,
            "tags": ["poison", "offensive"],
            "color": "green",
            "sortOrder": 2
        },
        {
            "id": "armored",
            "name": "Armored",
            "description": "Thick hide or plating provides extra defense.",
            "effect": "Armored",
            "effectValue": 3,
            "triggerThreshold": null,
            "tags": ["defensive", "passive"],
            "color": "grey",
            "sortOrder": 3
        },
        {
            "id": "berserker",
            "name": "Berserker",
            "description": "Deals more damage when health drops below a threshold.",
            "effect": "Berserker",
            "effectValue": 50,
            "triggerThreshold": 30,
            "tags": ["offensive", "triggered"],
            "color": "red",
            "sortOrder": 4
        }
    ]
}
```

### Example Enhanced Trait (with all optional fields)

```json
{
    "id": "spell_resistant",
    "name": "Spell Resistant",
    "description": "Has natural resistance to magical attacks and effects.",
    "effect": "SpellResistant",
    "effectValue": 25,
    "triggerThreshold": null,
    "tags": ["defensive", "passive"],
    "color": "purple",
    "sortOrder": 5,
    "statModifiers": {
        "bonusDefense": 2
    },
    "resistanceModifiers": {
        "resistances": {
            "arcane": 25,
            "fire": 15,
            "ice": 15,
            "lightning": 15
        },
        "immunities": ["charm"]
    },
    "grantedAbilityIds": ["magic_ward"],
    "visualSize": null,
    "nameDescriptor": "Warded"
}
```

---

## 13. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file and updates the configuration file reference. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file added, one config file updated with $schema reference |

### Schema as Documentation

The schema serves as:
- **Validation contract** for trait configuration
- **IDE documentation** via description fields
- **Modding reference** for custom trait systems
- **Design specification** for trait mechanics

---

## 14. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 15. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Effect Enum Validation | ~1 |
| Tags Enum Array Validation | ~1 |
| Stat Modifiers Validation | ~1 |
| Configuration File Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### TraitsSchemaTests.cs

```csharp
[TestFixture]
public class TraitsSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the traits.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void TraitsJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies effect must be a valid enum value.
    /// </summary>
    [Test]
    public void Effect_InvalidEnumValue_FailsValidation();

    /// <summary>
    /// Verifies tags must contain valid enum values.
    /// </summary>
    [Test]
    public void Tags_InvalidEnumValue_FailsValidation();

    /// <summary>
    /// Verifies stat modifier percentages must be between 0 and 1.
    /// </summary>
    [Test]
    public void StatModifiers_PercentageOutOfRange_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 16. Use Cases

### UC-001: Load Trait Configuration

**Actor:** Game System
**Flow:** System starts -> Loads `traits.json` -> Schema validates content -> Traits available for monster spawning

### UC-002: Edit Traits in IDE

**Actor:** Developer/Modder
**Flow:** Opens `traits.json` in VS Code -> IDE loads schema -> Autocomplete suggests properties -> Validation errors shown inline

### UC-003: Add New Trait Type

**Actor:** Modder
**Flow:** Adds new trait to `traits` array -> Sets id, name, description -> Selects effect type -> Sets effectValue and optional triggerThreshold -> Adds tags -> Sets color and sortOrder -> IDE validates structure

### UC-004: Configure Stat Modifiers

**Actor:** Modder
**Flow:** Adds statModifiers object to trait -> Sets bonusHealth, bonusAttack, etc. -> Sets percentage bonuses -> IDE validates ranges (0-1)

### UC-005: Invalid Effect Type

**Actor:** Modder
**Flow:** Sets effect to "CustomEffect" (invalid) -> IDE shows error "effect must be one of: Regeneration, Flying, ..." -> Modder selects valid option

### UC-006: Configure Resistance Modifiers

**Actor:** Modder
**Flow:** Adds resistanceModifiers object -> Adds resistances with damage type keys -> Adds immunities array -> IDE validates structure

---

## 17. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/traits.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all defined properties
- [ ] Schema includes definitions section (TraitDefinition, StatModifiers, ResistanceModifiers)

### Validation Rules
- [ ] Trait ID pattern validation: `^[a-z][a-z0-9_]*$`
- [ ] Effect enum validation (11 options)
- [ ] Effect value integer validation
- [ ] Trigger threshold range validation (0-100)
- [ ] Tags enum array validation (7 options)
- [ ] Color string validation (minLength: 1)
- [ ] Sort order validation (>= 0)
- [ ] Visual size enum validation (5 options)
- [ ] Stat modifier percentage validation (0-1)
- [ ] Resistance map validation (-100 to 100)
- [ ] Ability ID pattern validation
- [ ] Required fields enforced
- [ ] Optional fields have appropriate defaults

### Configuration Files
- [ ] `traits.json` updated with $schema reference
- [ ] Existing traits validate against schema
- [ ] All 5 traits pass validation

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 18. Acceptance Criteria

### Functional
- [ ] `traits.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `traits.json` without errors
- [ ] Effect enum validated (11 effect types)
- [ ] Effect value validated as integer
- [ ] Trigger threshold validated as optional integer (0-100)
- [ ] Tags validated as enum array (7 options)
- [ ] Color validated as non-empty string
- [ ] Sort order validated as non-negative integer
- [ ] Stat modifiers validated with percentage ranges (0-1)
- [ ] Resistance modifiers validated (-100 to 100)
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 19. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| Schema patterns | `config/schemas/*.schema.json` | Reference for schema structure |
| ID patterns | Prior schemas | Consistent ID patterns |
| damage-types.json | `config/damage-types.json` | Resistance and immunity references |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `traits.schema.json` | Validates trait configuration |
| TraitDefinition pattern | Referenced by monster possibleTraits |
| Trait IDs | Referenced by monsters.json possibleTraits array |
| StatModifiers pattern | May be reused by tier schema (v0.14.3c) |

### Implementation Order Note

**v0.14.3b can be implemented in parallel with v0.14.3a and v0.14.3c** as they have no internal dependencies.

v0.14.3d (Bosses) should be implemented last as it may reference trait patterns.

---

## 20. Future Considerations

### Deferred to Future Versions

- **Cross-reference validation**: Validating ability IDs exist in abilities.json
- **Damage type validation**: Validating resistance/immunity damage types exist
- **Trait effect execution**: Runtime trait behavior logic
- **Trait combination rules**: Synergy or conflict between traits
- **Dynamic trait application**: Runtime trait assignment/removal

### Out of Scope

- **Monster schema** (v0.14.3a) - Monster definitions that reference traits
- **Tier schema** (v0.14.3c) - Difficulty tiers that may also modify stats
- **Boss schema** (v0.14.3d) - Boss encounters with special abilities
- **Runtime trait execution**: Application-level trait effect processing
- **Trait balance tuning**: Specific effect values (design decisions)

### Potential Future Enhancements

If the trait system expands, consider adding to the schema:

**Trait Stacking Rules:**
```json
"stackingBehavior": {
    "type": "string",
    "description": "How multiple instances of this trait stack",
    "enum": ["None", "Additive", "Multiplicative", "Strongest"]
}
```

**Trait Prerequisites:**
```json
"prerequisites": {
    "type": "array",
    "description": "Trait IDs required before this trait can be applied",
    "items": { "type": "string" }
}
```

**Trait Conflicts:**
```json
"conflictsWith": {
    "type": "array",
    "description": "Trait IDs that cannot be combined with this trait",
    "items": { "type": "string" }
}
```

**Conditional Effects:**
```json
"conditionalEffects": {
    "type": "array",
    "description": "Additional effects under specific conditions",
    "items": {
        "type": "object",
        "properties": {
            "condition": { "type": "string" },
            "effect": { "type": "string" },
            "value": { "type": "integer" }
        }
    }
}
```

**Trait Tiers:**
```json
"traitTier": {
    "type": "string",
    "description": "Power tier of the trait",
    "enum": ["Minor", "Normal", "Major", "Legendary"]
}
```

**Duration Configuration:**
```json
"duration": {
    "type": "object",
    "description": "For temporary traits",
    "properties": {
        "turns": { "type": "integer" },
        "permanent": { "type": "boolean" }
    }
}
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
