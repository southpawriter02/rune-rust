# Rune-Rust v0.19.3a Design Specification
## Muspelheim & Niflheim Implementation (~24 Tests)

**Version:** 0.19.3a
**Date:** 2026-01-28
**Status:** Design Phase
**Deck Focus:** Deck 08 (Muspelheim) & Deck 05 (Niflheim)
**Estimated Tests:** ~24 (adjacency, thermal mechanics, brittleness, environmental)

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Feature Overview](#feature-overview)
3. [Detailed Scope Breakdown](#detailed-scope-breakdown)
4. [Architecture Overview](#architecture-overview)
5. [Environmental Properties System](#environmental-properties-system)
6. [Muspelheim: The Eternal Meltdown](#muspelheim-the-eternal-meltdown)
7. [Niflheim: The Frozen Tomb](#niflheim-the-frozen-tomb)
8. [Thermal Mechanics](#thermal-mechanics)
9. [Brittleness System](#brittleness-system)
10. [Adjacency & Incompatibility Rules](#adjacency--incompatibility-rules)
11. [Zone Difficulty Challenge System](#zone-difficulty-challenge-system)
12. [Equipment & Item Mechanics](#equipment--item-mechanics)
13. [Environmental Hazards](#environmental-hazards)
14. [Configuration Files](#configuration-files)
15. [User Stories](#user-stories)
16. [Decision Trees & Flow Diagrams](#decision-trees--flow-diagrams)
17. [Code Examples & Implementation Guidelines](#code-examples--implementation-guidelines)
18. [Logging & Debugging](#logging--debugging)
19. [Unit Testing Strategy](#unit-testing-strategy)
20. [Deliverables & Acceptance Criteria](#deliverables--acceptance-criteria)
21. [Dependencies & Integration Points](#dependencies--integration-points)
22. [Deferrals & Future Enhancements](#deferrals--future-enhancements)

---

## Executive Summary

This specification defines the implementation of two opposing environmental decks in the Rune-Rust system:

- **Muspelheim (Deck 08):** The Eternal Meltdown - A realm of extreme heat, fire, and destructive temperature where equipment overheats and fatigue accumulates rapidly.
- **Niflheim (Deck 05):** The Frozen Tomb - A realm of extreme cold, ice, and crystalline brittleness where equipment becomes fragile and cold effects compound.

These decks represent the first true exploration of environmental incompatibility mechanics, establishing that certain environmental realms cannot exist adjacent to one another due to fundamental physical/aetheric incompatibility. This specification covers all environmental systems, thermal mechanics, brittleness degradation, adjacency validation, and comprehensive test coverage.

**Key Innovation:** Fire/Ice Incompatibility introduces realm adjacency constraints as a core system mechanic, preventing Muspelheim and Niflheim from neighboring directly, and preventing Muspelheim and Vanaheim (bio realm) from neighboring.

---

## Feature Overview

### Muspelheim Features
- Extreme thermal environment with temperature ranging from 85°C baseline to 200°C peak
- Three distinct zones with progressive difficulty (DC 10, 14, 18)
- IntenseHeat condition system causing equipment overheating and fatigue buildup
- 3d6 fire damage at peak difficulty zones
- Equipment durability degradation under sustained heat
- Fatigue accumulation mechanics specific to heat stress

### Niflheim Features
- Extreme cold environment with temperature ranging from -40°C baseline to -80°C peak
- Three distinct zones with progressive difficulty (DC 10, 14, 18)
- ExtremeCold condition system with brittle equipment mechanics
- 3d6 cold damage at peak difficulty zones
- Brittleness mechanic: 4-level system (None, Light 10%, Moderate 25%, Severe 50%)
- Material fragility affects item break chance on impact

### Cross-System Features
- Adjacency incompatibility validation preventing Fire/Ice and Fire/Bio neighbors
- Environmental property inheritance and modification within zones
- Unified hazard application system for both thermal extremes
- Dynamic difficulty scaling based on zone location and exploration depth

---

## Detailed Scope Breakdown

### MUSPELHEIM (Deck 08 - The Eternal Meltdown)

#### Zones
1. **The Hearth Perimeter** - Entry zone, moderate heat exposure
2. **Surtr's Furnace** - Central zone, extreme heat and danger
3. **The Slag Fields** - Secondary zone, persistent heat hazards

#### Base Properties
```
Temperature:    85°C (baseline) to 200°C (peak)
Aetheric:       0.6 (moderate aetheric conductivity)
Humidity:       5% (extremely dry)
Light:          0.9 (bright from fire/lava)
Scale:          1.0 (standard scale)
Corrosion:      0.3 (moderate corrosion from heat oxidation)
```

#### Primary Condition
- **IntenseHeat:** Equipment overheating, fatigue accumulation, damage-over-time mechanic

#### Vertical Range
- Z -1 to +2 (three levels, includes cavern ceiling exploration)

#### Difficulty Challenges
- **Hearth Perimeter:** DC 10 (baseline heat hazard)
- **The Slag Fields:** DC 14 (elevated heat damage)
- **Surtr's Furnace:** DC 18 (extreme heat, 3d6 fire damage per round)

#### Key Mechanics
- Equipment Overheating: Items track heat stress; exceed threshold = damage/malfunction
- Fatigue Accumulation: Heat exposure causes fatigue that doesn't recover quickly
- Heat Wave Events: Periodic spikes in temperature cause immediate stress checks

### NIFLHEIM (Deck 05 - The Frozen Tomb)

#### Zones
1. **The Frost Marches** - Entry zone, moderate cold exposure
2. **Hvergelmir's Heart** - Central zone, extreme cold and ice hazards
3. **The Living Glacier** - Secondary zone, persistent cold and brittleness

#### Base Properties
```
Temperature:    -40°C (baseline) to -80°C (peak)
Aetheric:       0.3 (low aetheric conductivity)
Humidity:       15% (moderate moisture, forms ice)
Light:          0.5 (low ambient light, ice reflections)
Scale:          1.0 (standard scale)
Corrosion:      0.0 (no corrosion in extreme cold)
```

#### Primary Condition
- **ExtremeCold:** Brittleness progression, equipment fragility, cold damage

#### Vertical Range
- Z -2 to +1 (three levels, includes deep glacier exploration)

#### Difficulty Challenges
- **Frost Marches:** DC 10 (baseline cold hazard)
- **The Living Glacier:** DC 14 (elevated cold damage)
- **Hvergelmir's Heart:** DC 18 (extreme cold, 3d6 cold damage per round)

#### Key Mechanics
- Brittleness Progression: Equipment gains brittleness levels (0-3)
- Equipment Break Chance: Brittleness level determines break probability on impact
- Cold Stasis: Extreme cold slows recovery and movement
- Aetheric Conductivity: Low aetheric levels make magic less effective

---

## Architecture Overview

### System Layer Organization

```
┌─────────────────────────────────────────────────────┐
│           Realm Adjacency Validator                 │
│  (Fire/Ice, Fire/Bio Incompatibility Rules)         │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│         Environmental Deck System                    │
│  (Muspelheim & Niflheim Deck Controllers)           │
└─────────────────────────────────────────────────────┘
                        ↓
┌──────────────────┬────────────────────┬──────────────┐
│  Thermal Engine  │  Brittleness Sys.  │  Hazard Sys.│
│  (Heat/Cold)     │  (Equipment State) │  (Damage)    │
└──────────────────┴────────────────────┴──────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│        Environmental Property System                 │
│  (Temperature, Humidity, Aetheric, Light, etc.)     │
└─────────────────────────────────────────────────────┘
```

### Entity Relationships

```
Deck
  ├── Muspelheim (Type: Fire)
  │   ├── Zone: Hearth Perimeter
  │   ├── Zone: The Slag Fields
  │   ├── Zone: Surtr's Furnace
  │   └── EnvironmentalProperties (heat-focused)
  │
  └── Niflheim (Type: Ice)
      ├── Zone: Frost Marches
      ├── Zone: The Living Glacier
      ├── Zone: Hvergelmir's Heart
      └── EnvironmentalProperties (cold-focused)

Character/Item (within Zone)
  ├── EnvironmentalEffects (ActiveConditions)
  ├── Equipment (with Durability/Brittleness)
  └── Fatigue/Resources
```

---

## Environmental Properties System

### BaseProperties Record Structure

```csharp
public class EnvironmentalProperties
{
    public float Temperature { get; set; }          // Celsius
    public float Aetheric { get; set; }             // 0.0-1.0
    public float Humidity { get; set; }             // 0-100%
    public float Light { get; set; }                // 0.0-1.0
    public float Scale { get; set; }                // multiplier
    public float Corrosion { get; set; }            // 0.0-1.0
    public List<string> ActiveConditions { get; set; }
    public Dictionary<string, float> Modifiers { get; set; }
}
```

### Property Ranges

**Temperature:**
- Extreme Cold: < -60°C
- Cold: -60°C to -20°C
- Moderate: -20°C to +30°C
- Warm: +30°C to +60°C
- Extreme Heat: > +60°C

**Aetheric Conductivity:**
- 0.0-0.2: Magical immunity (spells fail)
- 0.2-0.5: Low conductivity (50% spell effectiveness)
- 0.5-0.7: Moderate conductivity (100% spell effectiveness)
- 0.7-1.0: High conductivity (spells enhanced 125%)

**Humidity:**
- 0-10%: Extremely dry (fire spreads faster)
- 10-30%: Dry (normal fire behavior)
- 30-70%: Moderate (balanced)
- 70-100%: Wet (fire suppressed)

**Light:**
- 0.0-0.2: Total darkness
- 0.2-0.5: Dim light, difficult vision
- 0.5-0.8: Moderate light, normal vision
- 0.8-1.0: Bright light, advantageous visibility

---

## Muspelheim: The Eternal Meltdown

### Environmental Description

Muspelheim is the realm of fire, heat, and destruction. A realm of eternal flames where the fundamental laws of thermodynamics are amplified to extremes. The air shimmers with waves of heat, rock formations glow with residual lava, and the very ground radiates intense thermal energy.

**Aesthetic:** Crimson and orange landscapes, charred vegetation, lava flows, crystalline heat formations, ash-covered terrain, and constant thermal distortion.

**Theme:** Destruction through heat, endurance testing, equipment failure under stress, fatigue accumulation.

### Zone Details

#### Zone 1: The Hearth Perimeter
**Description:** The outer ring of Muspelheim where explorers first encounter the heat. Rocky terrain with occasional lava flows visible in distance. Breathable but hot air. Temperature stabilizes around 85°C.

**Difficulty:** DC 10
**Temperature:** 85°C baseline, up to 110°C during active heat waves
**Primary Hazard:** Sustained heat exposure causing gradual fatigue
**Loot Grade:** Common to Uncommon
**Special Feature:** Natural thermal vents serve as shortcuts but risk equipment damage

**Hazard Rules:**
- Every 5 minutes of continuous exploration: Constitution save DC 10 or gain 1 level of fatigue
- Exposed skin takes 2d4 fire damage per round (mitigated by heat-resistant gear)
- Equipment heat stress: +1 heat counter per 10 minutes

#### Zone 2: The Slag Fields
**Description:** Intermediate zone of cooled and re-heating lava formations. Uneven terrain with occasional lava pockets. Temperature averages 130°C with dangerous fluctuations.

**Difficulty:** DC 14
**Temperature:** 130°C baseline, up to 160°C during eruptions
**Primary Hazard:** Unpredictable heat spikes and lava hazards
**Loot Grade:** Uncommon to Rare
**Special Feature:** Slag formations contain valuable fire-attuned materials

**Hazard Rules:**
- Every 3 minutes: Dexterity save DC 14 to avoid lava pools (+1d4 fire damage)
- Equipment heat stress: +2 heat counters per 10 minutes
- Heat wave event (1d6 on 1d20 per turn): Immediate 2d6 fire damage to all exposed equipment

#### Zone 3: Surtr's Furnace
**Description:** The core of Muspelheim - a massive cavern with active lava flows, extreme thermal radiation, and constant convection currents. The air itself seems to burn. Temperature reaches 200°C.

**Difficulty:** DC 18
**Temperature:** 200°C baseline, fluctuates 180-210°C
**Primary Hazard:** Extreme thermal damage and rapid equipment degradation
**Loot Grade:** Rare to Legendary (fire-attuned artifacts)
**Special Feature:** Presence of Surtr's Flame - unique crafting material

**Hazard Rules:**
- Every turn: Constitution save DC 18 or take 3d6 fire damage
- Equipment heat stress: +3 heat counters per turn (6 seconds)
- After 10 heat counters: Equipment requires heat mitigation or takes permanent damage
- Magical items must save against thermal warping (Arcana check DC 18)

### IntenseHeat Condition System

```csharp
public class IntenseHeatCondition : EnvironmentalCondition
{
    public int EquipmentHeatStress { get; set; }    // 0-10+
    public int FatigueAccumulation { get; set; }    // 0-6+
    public bool OverheatingTriggered { get; set; }
    public List<int> AffectedItemIds { get; set; }

    public void ApplyHeatDamage(Character character, int heatAmount)
    {
        EquipmentHeatStress += heatAmount;
        character.Fatigue += (heatAmount / 2);

        if (EquipmentHeatStress >= 10)
        {
            OverheatingTriggered = true;
            DamageEquipment(character);
        }
    }

    public void DamageEquipment(Character character)
    {
        // Reduce equipment durability
        // Mark items as overheated
        // Apply -1 penalty to equipment effectiveness
    }
}
```

### Muspelheim Mechanics Summary

| Mechanic | Hearth Perimeter | Slag Fields | Surtr's Furnace |
|----------|------------------|-------------|-----------------|
| Baseline Temp | 85°C | 130°C | 200°C |
| Difficulty | DC 10 | DC 14 | DC 18 |
| Heat/10 min | +1 counter | +2 counters | +3/round |
| Fire Damage | 2d4 (exposed) | 1d4 (lava) | 3d6 (per turn) |
| Fatigue Rate | Slow | Moderate | Fast |
| Break Threshold | 20+ counters | 15 counters | 10 counters |

---

## Niflheim: The Frozen Tomb

### Environmental Description

Niflheim is the realm of ice, cold, and crystalline stasis. A vast frozen expanse where temperatures plunge to lethal extremes and equipment becomes brittle and fragile. Glaciers tower overhead, and the very air freezes moisture into beautiful but deadly ice formations.

**Aesthetic:** Pale blues and whites, towering ice formations, crystalline structures, aurora-like light effects, frozen ruins, and ethereal cold mists.

**Theme:** Endurance in extreme cold, equipment fragility, careful movement, preservation of resources.

### Zone Details

#### Zone 1: The Frost Marches
**Description:** The outer reaches of Niflheim where cold is extreme but survivable. Rolling plains of packed snow and ice. Temperature stabilizes around -40°C.

**Difficulty:** DC 10
**Temperature:** -40°C baseline, down to -55°C during cold snaps
**Primary Hazard:** Sustained cold exposure causing brittleness progression
**Loot Grade:** Common to Uncommon
**Special Feature:** Pristine ice formations useful for crafting

**Hazard Rules:**
- Every 5 minutes of continuous exploration: Constitution save DC 10 or gain 1 brittleness level
- Exposed skin takes 2d4 cold damage per round (mitigated by cold-resistant gear)
- Equipment brittleness: +1 level per 10 minutes of exposure

#### Zone 2: The Living Glacier
**Description:** Intermediate zone of active glacier formation with crevasses and moving ice. Temperature averages -55°C with dangerous wind chill effects.

**Difficulty:** DC 14
**Temperature:** -55°C baseline, down to -70°C during cold fronts
**Primary Hazard:** Crevasse hazards and equipment fragility
**Loot Grade:** Uncommon to Rare
**Special Feature:** Glacial cores contain ancient ice-attuned materials

**Hazard Rules:**
- Every 3 minutes: Dexterity save DC 14 to avoid crevasse (-1d6 fall damage)
- Equipment brittleness: +1 level per 5 minutes of exposure
- Equipment with 2+ brittleness: -20% durability on damage
- Ice breaking event (1d6 on 1d20 per turn): 1d4 cold damage + risk of falling

#### Zone 3: Hvergelmir's Heart
**Description:** The core of Niflheim - an enormous ice cavern with the heart-spring of all cold. The temperature drops to -80°C. The very air crystallizes and breath freezes instantly.

**Difficulty:** DC 18
**Temperature:** -80°C baseline, fluctuates -75°C to -85°C
**Primary Hazard:** Extreme cold damage and rapid brittleness advancement
**Loot Grade:** Rare to Legendary (ice-attuned artifacts)
**Special Feature:** Hvergelmir's Tears - unique crafting material

**Hazard Rules:**
- Every turn: Constitution save DC 18 or take 3d6 cold damage
- Equipment brittleness: +1 level per round (6 seconds)
- After 3 brittleness levels: Equipment has 50% break chance on damage
- Magical items must save against cold crystallization (Arcana check DC 18)

### Brittleness System

The brittleness mechanic is unique to Niflheim and cold environments. Equipment becomes increasingly fragile as cold exposure accumulates.

#### Brittleness Levels

```csharp
public enum BrittlenessLevel
{
    None = 0,           // No effect
    Light = 1,          // 10% break chance on damage
    Moderate = 2,       // 25% break chance on damage
    Severe = 3          // 50% break chance on damage
}

public class BrittlenessTracker
{
    public int CurrentLevel { get; set; }
    public int BreakChancePercent { get; set; }

    public void IncrementBrittleness()
    {
        if (CurrentLevel < 3)
        {
            CurrentLevel++;
            BreakChancePercent = CurrentLevel * 10 + 5; // None=0%, Light=15%, Mod=25%, Severe=50%
        }
    }

    public bool RollForBreak()
    {
        int roll = Random.Range(1, 101);
        return roll <= BreakChancePercent;
    }
}
```

#### Break Probability Table

| Brittleness | Level Description | Break Chance | Duration |
|-------------|------------------|--------------|----------|
| 0 | None | 0% | N/A |
| 1 | Light | 10% | Fade at -5°C after 20 min |
| 2 | Moderate | 25% | Fade at -20°C after 15 min |
| 3 | Severe | 50% | Fade at normal temp after 30 min |

#### Brittleness Mitigation

- **Heat Exposure:** Moving to warmer zone reduces brittleness by 1 level per 5 minutes
- **Protective Coating:** Special oils/waxes prevent 1 brittleness accumulation
- **Inherent Material:** Ice-attuned equipment immune to brittleness
- **Magical Protection:** Abjuration spell can suppress brittleness temporarily (1 hour)

### ExtremeCold Condition System

```csharp
public class ExtremeColdCondition : EnvironmentalCondition
{
    public int EquipmentBrittleness { get; set; }   // 0-3 levels
    public int ColdExposureCounter { get; set; }    // tracks time
    public List<int> BrittleItemIds { get; set; }

    public void ApplyColdDamage(Character character, int coldAmount)
    {
        ColdExposureCounter += coldAmount;

        // Every 5 minutes of cold exposure
        if (ColdExposureCounter % 5 == 0)
        {
            IncrementBrittleness();
        }
    }

    public void IncrementBrittleness()
    {
        if (EquipmentBrittleness < 3)
        {
            EquipmentBrittleness++;
            MarkAllEquipmentBrittle();
        }
    }

    public bool CheckEquipmentBreak(Item item)
    {
        int breakChance = EquipmentBrittleness switch
        {
            1 => 10,
            2 => 25,
            3 => 50,
            _ => 0
        };

        return Random.Range(1, 101) <= breakChance;
    }
}
```

### Niflheim Mechanics Summary

| Mechanic | Frost Marches | Living Glacier | Hvergelmir's Heart |
|----------|---------------|----------------|-------------------|
| Baseline Temp | -40°C | -55°C | -80°C |
| Difficulty | DC 10 | DC 14 | DC 18 |
| Brittleness/5 min | +1 level | +1/5 min | +1/round |
| Cold Damage | 2d4 (exposed) | 1d4 (crevasse) | 3d6 (per turn) |
| Break Threshold | 3 levels | 2-3 levels | 1+ level |
| Progression Speed | Normal | Fast | Very Fast |

---

## Thermal Mechanics

### Heat Transfer Model

Equipment in Muspelheim experiences cumulative heat stress based on exposure duration and environmental intensity.

```
Heat Stress Accumulation = (BaseTemp - SafeTemp) × TimeExposed × ZoneFactor

SafeTemp = 40°C (gear designed for this)
ZoneFactor:
  - Hearth Perimeter: 0.1
  - Slag Fields: 0.2
  - Surtr's Furnace: 0.5
```

### Heat Thresholds and Effects

```csharp
public class HeatStressSystem
{
    private const int HEAT_SAFE_THRESHOLD = 5;
    private const int HEAT_WARNING_THRESHOLD = 8;
    private const int HEAT_CRITICAL_THRESHOLD = 10;

    public HeatStressEffect GetStressEffect(int heatCounter)
    {
        return heatCounter switch
        {
            0 to 4 => HeatStressEffect.None,
            5 to 7 => HeatStressEffect.WarningHeat,      // -10% equipment effectiveness
            8 to 9 => HeatStressEffect.DangerousHeat,    // -25% equipment effectiveness
            >= 10 => HeatStressEffect.CriticalOverheat,  // -50% + permanent damage risk
            _ => HeatStressEffect.None
        };
    }

    public void ApplyHeatEffect(Equipment item, HeatStressEffect effect)
    {
        switch (effect)
        {
            case HeatStressEffect.WarningHeat:
                item.EffectivenessMultiplier = 0.9f;
                break;
            case HeatStressEffect.DangerousHeat:
                item.EffectivenessMultiplier = 0.75f;
                item.TakeDamage(1);
                break;
            case HeatStressEffect.CriticalOverheat:
                item.EffectivenessMultiplier = 0.5f;
                item.TakeDamage(2);
                if (Random.Range(0, 1f) < 0.3f)
                    item.BecamePermanentlyDamaged();
                break;
        }
    }
}
```

### Fatigue Accumulation in Heat

Characters exposed to Muspelheim heat accumulate fatigue based on exposure and physical exertion.

```
Fatigue Rate = (CurrentTemp - 40°C) × 0.1 per minute

Fatigue Levels:
0-1: No effect
2-3: -5% movement speed
4-5: -10% movement speed, -5% action accuracy
6+: -15% movement speed, -10% action accuracy, require frequent rest

Recovery: 1 level per 30 minutes of rest outside Muspelheim
```

### Temperature Fluctuation Events

Muspelheim experiences random temperature spikes - sudden surges of heat that threaten all explorers.

```csharp
public class HeatWaveEvent : EnvironmentalEvent
{
    public int TriggerChance { get; set; }      // 1d20 roll threshold
    public int DamageAmount { get; set; }       // 2d6-3d6

    public void ExecuteEvent(Zone zone, List<Character> characters)
    {
        if (Random.Range(1, 21) <= TriggerChance)
        {
            foreach (var character in characters)
            {
                int damage = Random.Range(2, 7) + Random.Range(2, 7);
                character.TakeDamage(DamageType.Fire, damage);

                // All equipment gains heat stress
                foreach (var item in character.Equipment)
                {
                    item.HeatStress += 1;
                }
            }
        }
    }
}
```

---

## Brittleness System

### Cold-Induced Brittleness Mechanics

Cold exposure causes equipment to become brittle - more fragile and prone to breaking. This is distinct from heat stress and unique to Niflheim.

### Brittleness Progression Model

```
Brittleness Accumulation = (SafeTemp - CurrentTemp) / 10 × TimeExposed / 5

SafeTemp = 15°C (gear designed for this)
TimeExposed = minutes in cold zone
Result: Brittleness level increment (0-3)
```

### Break Mechanics on Impact

When equipment with brittleness receives damage, it has a chance to break:

```csharp
public class BrittleEquipmentSystem
{
    public void ProcessImpactDamage(Equipment item, int damageAmount)
    {
        if (item.BrittlenessLevel == 0)
        {
            item.Durability -= damageAmount;
            return;
        }

        // Roll for break
        int breakChance = item.BrittlenessLevel switch
        {
            1 => 10,
            2 => 25,
            3 => 50,
            _ => 0
        };

        if (Random.Range(1, 101) <= breakChance)
        {
            item.BecomesBroken();
            item.Durability = 0;
            // Equipment is now unusable - requires repair
        }
        else
        {
            // Take normal damage
            item.Durability -= damageAmount;
        }
    }
}
```

### Brittleness Decay & Thawing

Brittleness is not permanent if equipment is moved to warmer environments:

```csharp
public class BrittlenessThawSystem
{
    public void UpdateBrittleness(Equipment item, float currentTemp)
    {
        if (currentTemp > 0°C)
        {
            // Rapid thaw
            if (item.LastBrittleCheck < TimeSpan.FromMinutes(5))
                item.BrittlenessLevel--;
        }
        else if (currentTemp > -20°C)
        {
            // Slow thaw
            if (item.LastBrittleCheck < TimeSpan.FromMinutes(15))
                item.BrittlenessLevel--;
        }
        // No thaw in extreme cold
    }
}
```

---

## Adjacency & Incompatibility Rules

### Core Incompatibility Principle

Certain environmental realms are fundamentally incompatible and cannot exist adjacent to one another. This creates strategic constraints in world design.

### Incompatibility Matrix

```
             Muspelheim  Niflheim  Vanaheim  Svartalfheim  Muspel-Bio
Muspelheim       -          X          X         OK            OK
Niflheim         X          -          OK        OK            OK
Vanaheim         X          OK         -         OK            OK
Svartalfheim     OK         OK         OK        -             OK
Muspel-Bio       OK         OK         OK        OK            -

X = Cannot be adjacent (incompatible)
OK = Can be adjacent (compatible)
```

### Incompatibility Rules

#### Rule 1: Fire/Ice Incompatibility
**Constraint:** Muspelheim (Fire) cannot neighbor Niflheim (Ice)
**Reason:** Extreme thermal differential creates unstable reality distortion
**Validation:** Check all 6 adjacent deck positions (North, South, East, West, Up, Down)

```csharp
public class AdjacencyValidator
{
    public bool IsValidAdjacency(Deck sourceDeck, Deck targetDeck, Direction direction)
    {
        // Fire/Ice incompatibility
        if ((sourceDeck.Type == DeckType.Muspelheim && targetDeck.Type == DeckType.Niflheim) ||
            (sourceDeck.Type == DeckType.Niflheim && targetDeck.Type == DeckType.Muspelheim))
        {
            return false;
        }

        // Fire/Bio incompatibility
        if ((sourceDeck.Type == DeckType.Muspelheim && targetDeck.Type == DeckType.Vanaheim) ||
            (sourceDeck.Type == DeckType.Vanaheim && targetDeck.Type == DeckType.Muspelheim))
        {
            return false;
        }

        return true;
    }

    public List<Direction> GetValidAdjacentDirections(Deck currentDeck)
    {
        var validDirections = new List<Direction>();

        foreach (var direction in Enum.GetValues(typeof(Direction)))
        {
            var adjacentDeck = GetAdjacentDeck(currentDeck, (Direction)direction);
            if (adjacentDeck != null && IsValidAdjacency(currentDeck, adjacentDeck, (Direction)direction))
            {
                validDirections.Add((Direction)direction);
            }
        }

        return validDirections;
    }
}
```

#### Rule 2: Fire/Bio Incompatibility
**Constraint:** Muspelheim (Fire) cannot neighbor Vanaheim (Bio)
**Reason:** Extreme heat destroys organic structures; bio-realm repels intense thermal energy
**Validation:** Check same 6 adjacent positions

#### Rule 3: Adjacency Transitional Zones (Future)
**Deferred:** Implementation of buffer zones between incompatible realms (v0.20.x)

### Adjacency Validation on Deck Creation

```csharp
public class DeckPlacementValidator
{
    public bool CanPlaceDeck(Deck newDeck, int x, int y, int z, WorldGrid grid)
    {
        var adjacentDecks = grid.GetAdjacentDecks(x, y, z);

        foreach (var adjacentDeck in adjacentDecks)
        {
            if (!ValidateAdjacencyRules(newDeck, adjacentDeck))
            {
                LogValidationFailure($"Cannot place {newDeck.Name} adjacent to {adjacentDeck.Name}");
                return false;
            }
        }

        return true;
    }
}
```

---

## Zone Difficulty Challenge System

### Difficulty Challenge Mechanics

Each zone presents challenges with specific difficulty classes (DC). Characters must make saves or checks to overcome environmental hazards.

### Challenge Types

#### Constitution Saves (Thermal/Physical Endurance)
- **Muspelheim Heat Hazard DC 10/14/18:** Resist heat damage and fatigue
- **Niflheim Cold Hazard DC 10/14/18:** Resist cold damage and brittleness
- **Failure:** Take environmental damage, advance condition severity

#### Dexterity Saves (Environmental Navigation)
- **Muspelheim Lava Avoidance DC 14:** Dodge lava pools
- **Niflheim Crevasse Avoidance DC 14:** Avoid falling
- **Failure:** Take impact/fall damage

#### Arcana Saves (Magical Equipment Protection)
- **Magical Warping DC 18:** Prevent magical items from being damaged/warped
- **Failure:** Item takes permanent damage, loses magical properties

### Challenge Frequency and Progression

```
Hearth Perimeter/Frost Marches:
  - Constitution save every 5 minutes
  - Dexterity save every 10 minutes

Slag Fields/Living Glacier:
  - Constitution save every 3 minutes
  - Dexterity save every 5 minutes

Surtr's Furnace/Hvergelmir's Heart:
  - Constitution save every round (6 seconds)
  - Dexterity save every 5 rounds
```

---

## Equipment & Item Mechanics

### Equipment Damage Types

#### Heat Damage (Muspelheim-specific)
- Applied to all exposed equipment continuously
- Tracked via HeatStress counter
- Causes temporary effectiveness loss at thresholds
- Can cause permanent damage if critical threshold exceeded

```csharp
public class HeatDamageEffect
{
    public int HeatStressCounter { get; set; }
    public EquipmentCondition CurrentCondition { get; set; }

    public enum EquipmentCondition
    {
        Fine = 0,
        WarmingUp = 1,
        Hot = 2,
        DangerouslyHot = 3,
        Overheated = 4
    }

    public void Update(float ambientTemp)
    {
        int heatIncrease = (int)((ambientTemp - 40f) / 20f);
        HeatStressCounter += heatIncrease;

        CurrentCondition = HeatStressCounter switch
        {
            0 to 2 => EquipmentCondition.Fine,
            3 to 5 => EquipmentCondition.WarmingUp,
            6 to 8 => EquipmentCondition.Hot,
            9 to 11 => EquipmentCondition.DangerouslyHot,
            >= 12 => EquipmentCondition.Overheated
        };
    }
}
```

#### Brittleness Damage (Niflheim-specific)
- Applied through brittleness accumulation
- Increases break chance on impact
- Reversible through warming
- Tracked via BrittlenessLevel (0-3)

### Item Durability System

Items have durability that degrades with use and environmental damage:

```csharp
public class ItemDurability
{
    public int MaxDurability { get; set; }
    public int CurrentDurability { get; set; }
    public float DurabilityPercent => (float)CurrentDurability / MaxDurability;

    public void TakeDamage(int amount)
    {
        CurrentDurability = Math.Max(0, CurrentDurability - amount);
    }

    public void Repair(int amount)
    {
        CurrentDurability = Math.Min(MaxDurability, CurrentDurability + amount);
    }

    public bool IsBroken => CurrentDurability == 0;
}
```

### Fire-Attuned Items (Muspelheim)

Items specifically designed for Muspelheim:
- Immune to heat damage and overheating
- +25% effectiveness in Muspelheim zones
- Cannot be used in Niflheim (too hot, incompatible)
- Crafted from Surtr's Flame or similar materials

### Ice-Attuned Items (Niflheim)

Items specifically designed for Niflheim:
- Immune to brittleness accumulation
- +25% effectiveness in Niflheim zones
- Cannot be used in Muspelheim (too cold, incompatible)
- Crafted from Hvergelmir's Tears or similar materials

---

## Environmental Hazards

### Muspelheim Hazard Types

#### Heat Exposure Hazard
- **Trigger:** Continuous presence in zone
- **Frequency:** Every 5/3/1 minutes (zone-dependent)
- **DC:** 10/14/18 (zone-dependent)
- **Effect on Failure:** 2d4/1d4/3d6 fire damage + heat stress +1

#### Lava Pool Hazard (Slag Fields & Surtr's Furnace)
- **Trigger:** Movement across affected terrain
- **Frequency:** Every 10 minutes or on terrain roll
- **DC:** 14 Dexterity save
- **Effect on Failure:** 2d6 fire damage + knocked prone

#### Heat Wave Event
- **Trigger:** Random (1d6 on 1d20 per turn in Slag Fields/Furnace)
- **Frequency:** Unpredictable
- **DC:** 16 Constitution save (unavoidable area effect)
- **Effect:** 2d6-3d6 fire damage to all present, all equipment +1 heat stress

#### Equipment Failure Cascade
- **Trigger:** Item heat stress >= threshold
- **Effect:** Item functionality reduced, then permanent damage possible

### Niflheim Hazard Types

#### Cold Exposure Hazard
- **Trigger:** Continuous presence in zone
- **Frequency:** Every 5/3/1 minutes (zone-dependent)
- **DC:** 10/14/18 (zone-dependent)
- **Effect on Failure:** 2d4/1d4/3d6 cold damage + brittleness +1

#### Crevasse Hazard (Living Glacier & Hvergelmir's Heart)
- **Trigger:** Movement across ice terrain
- **Frequency:** Every 10 minutes or on terrain roll
- **DC:** 14 Dexterity save
- **Effect on Failure:** 1d6 fall damage + 1d6 cold damage + 15 ft fall

#### Cold Front Event
- **Trigger:** Random (1d6 on 1d20 per turn in Living Glacier/Heart)
- **Frequency:** Unpredictable
- **DC:** 16 Constitution save (unavoidable area effect)
- **Effect:** 2d6-3d6 cold damage to all present, all equipment +1 brittleness

#### Equipment Break Cascade
- **Trigger:** Item brittleness >= 2, damage received
- **Effect:** High break chance, potential permanent loss of equipment

---

## Configuration Files

### Muspelheim Configuration (muspelheim.json)

```json
{
  "deckId": "MUSPELHEIM_08",
  "deckName": "Muspelheim",
  "deckType": "FIRE",
  "subtitle": "The Eternal Meltdown",
  "description": "Realm of eternal flames, heat, and destruction",

  "baseProperties": {
    "temperature": 85,
    "temperatureMax": 200,
    "aetheric": 0.6,
    "humidity": 5,
    "light": 0.9,
    "scale": 1.0,
    "corrosion": 0.3
  },

  "primaryCondition": "INTENSE_HEAT",

  "verticalRange": {
    "zMin": -1,
    "zMax": 2
  },

  "zones": [
    {
      "zoneId": "HEARTH_PERIMETER",
      "zoneName": "The Hearth Perimeter",
      "description": "Outer ring of Muspelheim with manageable heat",
      "difficulty": 10,
      "temperature": 85,
      "temperaturePeak": 110,
      "hazardFrequency": "every_5_minutes",
      "damageRoll": "2d4",
      "heatStressPerTick": 1,
      "lootGrade": ["COMMON", "UNCOMMON"]
    },
    {
      "zoneId": "SLAG_FIELDS",
      "zoneName": "The Slag Fields",
      "description": "Intermediate zone of cooled and re-heating lava",
      "difficulty": 14,
      "temperature": 130,
      "temperaturePeak": 160,
      "hazardFrequency": "every_3_minutes",
      "damageRoll": "1d4",
      "heatStressPerTick": 2,
      "heatWaveChance": "1_in_6_per_turn",
      "lootGrade": ["UNCOMMON", "RARE"]
    },
    {
      "zoneId": "SURTRS_FURNACE",
      "zoneName": "Surtr's Furnace",
      "description": "Core of Muspelheim with extreme thermal radiation",
      "difficulty": 18,
      "temperature": 200,
      "temperaturePeakMin": 180,
      "temperaturePeakMax": 210,
      "hazardFrequency": "every_round",
      "damageRoll": "3d6",
      "heatStressPerTick": 3,
      "heatWaveChance": "1_in_6_per_turn",
      "magicalItemSaveRequired": true,
      "lootGrade": ["RARE", "LEGENDARY"]
    }
  ],

  "incompatibilities": {
    "cannotNeighbor": ["NIFLHEIM_05", "VANAHEIM_04"]
  },

  "equipmentOverheatingThreshold": 10,

  "fatigueAccumulationRate": 0.1,
  "fatigueRecoveryMinutesPerLevel": 30,

  "specialMaterials": [
    {
      "materialId": "SURTRS_FLAME",
      "zone": "SURTRS_FURNACE",
      "rarity": "LEGENDARY",
      "uses": ["fireAttuned_crafting", "artifact_enhancement"]
    }
  ]
}
```

### Niflheim Configuration (niflheim.json)

```json
{
  "deckId": "NIFLHEIM_05",
  "deckName": "Niflheim",
  "deckType": "ICE",
  "subtitle": "The Frozen Tomb",
  "description": "Realm of extreme cold, ice, and crystalline brittleness",

  "baseProperties": {
    "temperature": -40,
    "temperatureMin": -80,
    "aetheric": 0.3,
    "humidity": 15,
    "light": 0.5,
    "scale": 1.0,
    "corrosion": 0.0
  },

  "primaryCondition": "EXTREME_COLD",

  "verticalRange": {
    "zMin": -2,
    "zMax": 1
  },

  "zones": [
    {
      "zoneId": "FROST_MARCHES",
      "zoneName": "The Frost Marches",
      "description": "Outer reaches of Niflheim with survivable cold",
      "difficulty": 10,
      "temperature": -40,
      "temperatureMin": -55,
      "hazardFrequency": "every_5_minutes",
      "damageRoll": "2d4",
      "brittlenessPerTick": 1,
      "lootGrade": ["COMMON", "UNCOMMON"]
    },
    {
      "zoneId": "LIVING_GLACIER",
      "zoneName": "The Living Glacier",
      "description": "Active glacier with crevasses and moving ice",
      "difficulty": 14,
      "temperature": -55,
      "temperatureMin": -70,
      "hazardFrequency": "every_3_minutes",
      "damageRoll": "1d4",
      "brittlenessPerTick": 1,
      "brittlenessPerTickFrequency": "every_5_minutes",
      "crevasseDamage": "1d6_fall_plus_1d6_cold",
      "lootGrade": ["UNCOMMON", "RARE"]
    },
    {
      "zoneId": "HVERGELMIR_HEART",
      "zoneName": "Hvergelmir's Heart",
      "description": "Core of Niflheim with lethal cold",
      "difficulty": 18,
      "temperature": -80,
      "temperatureRange": "-75_to_-85",
      "hazardFrequency": "every_round",
      "damageRoll": "3d6",
      "brittlenessPerTick": 1,
      "coldFrontChance": "1_in_6_per_turn",
      "magicalItemSaveRequired": true,
      "lootGrade": ["RARE", "LEGENDARY"]
    }
  ],

  "brittlenessSystem": {
    "levels": [
      {
        "level": 0,
        "name": "None",
        "breakChance": 0,
        "effects": []
      },
      {
        "level": 1,
        "name": "Light",
        "breakChance": 10,
        "effects": ["minor_equipment_penalty"]
      },
      {
        "level": 2,
        "name": "Moderate",
        "breakChance": 25,
        "effects": ["moderate_equipment_penalty", "reduced_durability"]
      },
      {
        "level": 3,
        "name": "Severe",
        "breakChance": 50,
        "effects": ["severe_equipment_penalty", "high_break_risk", "damaged_appearance"]
      }
    ],
    "thawRates": {
      "warmEnvironment": "1_level_per_5_minutes",
      "moderateEnvironment": "1_level_per_15_minutes",
      "coldEnvironment": "no_thaw"
    }
  },

  "incompatibilities": {
    "cannotNeighbor": ["MUSPELHEIM_08"]
  },

  "specialMaterials": [
    {
      "materialId": "HVERGELMIR_TEARS",
      "zone": "HVERGELMIR_HEART",
      "rarity": "LEGENDARY",
      "uses": ["iceAttuned_crafting", "artifact_enhancement"]
    }
  ]
}
```

---

## User Stories

### User Story 1: Heat Management in Muspelheim
**As a** explorer in Muspelheim
**I want to** understand how heat affects my equipment and character
**So that** I can make informed decisions about exploration duration and equipment choices

**Acceptance Criteria:**
- Heat stress is visible in UI for character and equipment
- Temperature changes are logged with clear messaging
- Equipment effectiveness penalties appear before critical damage
- Players have warning before overheating occurs

### User Story 2: Brittleness Progression in Niflheim
**As a** explorer in Niflheim
**I want to** manage equipment brittleness to prevent gear loss
**So that** I can successfully complete missions without losing critical items

**Acceptance Criteria:**
- Brittleness level is clearly displayed
- Equipment break chances are visible before risky actions
- Thawing mechanics are obvious and controllable
- Equipment can be recovered/repaired after breaking

### User Story 3: Adjacency Validation
**As a** world designer
**I want to** ensure Muspelheim and Niflheim cannot be placed adjacent
**So that** the world maintains logical environmental integrity

**Acceptance Criteria:**
- System rejects placement of incompatible decks
- Clear error message explains incompatibility
- Alternative deck positions are suggested
- Validation occurs at placement time and runtime

### User Story 4: Environmental Hazard Avoidance
**As a** character in a thermal zone
**I want to** avoid environmental hazards through skill and luck
**So that** exploration has real risk/reward mechanics

**Acceptance Criteria:**
- Hazard checks are fair and consistent
- Difficulty scales with zone progression
- Success/failure outcomes are clearly communicated
- Multiple strategies exist to mitigate hazards

---

## Decision Trees & Flow Diagrams

### Character Zone Entry Flow

```
┌─────────────────────────┐
│  Enter Thermal Zone     │
└────────────┬────────────┘
             │
             ▼
    ┌────────────────────┐
    │ Identify Zone Type │
    └────────┬───────────┘
             │
        ┌────┴────┐
        │          │
        ▼          ▼
    [HEAT]    [COLD]
        │          │
        ▼          ▼
    ┌────────┐  ┌──────────┐
    │ Apply  │  │ Apply    │
    │ Heat   │  │ Brittl.  │
    │Exposure│  │Exposure  │
    └───┬────┘  └────┬─────┘
        │            │
        ▼            ▼
    ┌─────────────────────────┐
    │ Roll Environmental Save  │
    │ (CON check, DC varies)  │
    └───┬─────────────┬───────┘
        │             │
    ┌───┴─┐       ┌───┴─┐
    │PASS │       │FAIL │
    └──┬──┘       └──┬──┘
       │             │
       ▼             ▼
   No Damage    Apply Damage
   Continue    + Condition
                    │
                    ▼
               Check Threshold
                    │
                    └─→ Log Event
                        Continue
```

### Equipment Damage Decision Tree (Muspelheim)

```
┌──────────────────────────────┐
│ Equipment Receives Impact    │
└─────────────┬────────────────┘
              │
              ▼
      ┌───────────────────┐
      │ Check Heat Stress │
      └────┬──────────┬───┘
           │          │
       [LOW]          [HIGH]
           │          │
           ▼          ▼
       Normal      Apply Overheating
       Damage      Penalty (-50%)
           │          │
           ▼          ▼
       Roll for    Roll for
       Permanent   Permanent
       Damage      Damage
       (10%)       (30%)
           │          │
           └─────┬────┘
                 ▼
          Log Damage Event
          Update Equipment
```

### Brittleness Break Check (Niflheim)

```
┌───────────────────────────────┐
│ Equipment Takes Damage        │
│ (Impact/Fall/etc)             │
└────────────┬──────────────────┘
             │
             ▼
    ┌─────────────────────┐
    │ Check Brittleness   │
    │ Level (0-3)         │
    └──┬─────────┬───┬──┬─┘
       │         │   │  │
   [0] │ [1]     │   │  │[3]
  None │Light    │[2]│  │Severe
       │         │Mod│  │
       │         │   │  │
       ▼         ▼   ▼  ▼
   No    Break  Break  Break
  Break  10%    25%    50%
  Chance Chance Chance Chance
       │         │   │  │
       └─────┬───┴─┬─┴──┘
             │     │
         ┌───┴─┐ ┌─┴───┐
         │PASS │ │FAIL │
         └──┬──┘ └──┬──┘
            │       │
            ▼       ▼
        Normal   Item Breaks
        Damage   (Durability=0)
                 (Unusable)
```

---

## Code Examples & Implementation Guidelines

### Heat Stress Application

```csharp
public class MuspelheimZoneController : ZoneController
{
    private readonly IntenseHeatCondition heatCondition;

    public override void UpdateZone(float deltaTime)
    {
        foreach (var character in CharactersInZone)
        {
            ApplyHeatExposure(character, deltaTime);
        }
    }

    private void ApplyHeatExposure(Character character, float deltaTime)
    {
        // Calculate heat stress based on zone difficulty
        float heatAmount = CalculateHeatAmount(ZoneDifficulty);

        // Apply to character equipment
        foreach (var item in character.Equipment)
        {
            item.HeatStress += heatAmount;

            // Check for overheating threshold
            if (item.HeatStress >= OVERHEATING_THRESHOLD)
            {
                TriggerEquipmentOverheat(item, character);
            }
        }

        // Apply fatigue to character
        float fatigueAmount = (CurrentTemperature - 40f) * 0.1f;
        character.AddFatigue(fatigueAmount);

        LogHeatExposure(character, heatAmount, fatigueAmount);
    }

    private float CalculateHeatAmount(int zoneDC)
    {
        return zoneDC switch
        {
            10 => 0.1f,   // Hearth Perimeter: +1 per 10 min
            14 => 0.2f,   // Slag Fields: +2 per 10 min
            18 => 0.5f,   // Surtr's Furnace: +3 per 6 sec
            _ => 0f
        };
    }

    private void TriggerEquipmentOverheat(Equipment item, Character character)
    {
        item.ApplyCondition(EquipmentCondition.Overheated);
        item.EffectivenessMultiplier = 0.5f;

        // Risk of permanent damage
        if (Random.Range(0, 1f) < 0.3f)
        {
            item.TakePermanentDamage(2);
        }
    }
}
```

### Brittleness Tracking

```csharp
public class NiflheimZoneController : ZoneController
{
    private readonly ExtremeColdCondition coldCondition;
    private Dictionary<int, int> characterBrittlenessCounters;

    public override void UpdateZone(float deltaTime)
    {
        foreach (var character in CharactersInZone)
        {
            ApplyColdExposure(character, deltaTime);
        }
    }

    private void ApplyColdExposure(Character character, float deltaTime)
    {
        // Track cold exposure time
        if (!characterBrittlenessCounters.ContainsKey(character.Id))
        {
            characterBrittlenessCounters[character.Id] = 0;
        }

        characterBrittlenessCounters[character.Id] += (int)deltaTime;

        // Every 5 minutes (or zone-dependent frequency)
        int brittlenessIncrementFrequency = GetBrittlenessIncrementFrequency();

        if (characterBrittlenessCounters[character.Id] >= brittlenessIncrementFrequency)
        {
            IncrementEquipmentBrittleness(character);
            characterBrittlenessCounters[character.Id] = 0;
        }

        // Apply cold damage
        int coldDamage = RollColdDamage();
        character.TakeDamage(DamageType.Cold, coldDamage);
    }

    private void IncrementEquipmentBrittleness(Character character)
    {
        foreach (var item in character.Equipment)
        {
            if (item.BrittlenessLevel < 3)
            {
                item.BrittlenessLevel++;

                // Log brittleness increase
                Debug.Log($"Equipment {item.Name} brittleness increased to {item.BrittlenessLevel}");
            }
        }
    }
}
```

### Equipment Impact Damage with Brittleness Check

```csharp
public class Equipment
{
    public int BrittlenessLevel { get; set; }

    public void TakeDamage(int damageAmount)
    {
        // Check if equipment breaks due to brittleness
        if (CheckBrittleBreak())
        {
            Durability = 0;  // Equipment is broken
            IsBroken = true;
            OnEquipmentBroken?.Invoke(this);
            Debug.Log($"{Name} has shattered from the cold!");
            return;
        }

        // Normal damage application
        Durability -= damageAmount;
        if (Durability < 0)
            Durability = 0;
    }

    private bool CheckBrittleBreak()
    {
        if (BrittlenessLevel == 0)
            return false;

        int breakChance = BrittlenessLevel switch
        {
            1 => 10,   // Light: 10% break
            2 => 25,   // Moderate: 25% break
            3 => 50,   // Severe: 50% break
            _ => 0
        };

        return Random.Range(1, 101) <= breakChance;
    }

    public void Thaw(float currentTemperature)
    {
        if (currentTemperature > 0f && BrittlenessLevel > 0)
        {
            // Rapid thaw at warm temps
            BrittlenessLevel = Math.Max(0, BrittlenessLevel - 1);
        }
        else if (currentTemperature > -20f && BrittlenessLevel > 0)
        {
            // Slow thaw at moderate cold
            if (Random.Range(0, 1f) < 0.1f)  // 10% chance per update
                BrittlenessLevel = Math.Max(0, BrittlenessLevel - 1);
        }
    }
}
```

### Adjacency Validation

```csharp
public class RealmAdjacencyValidator
{
    private static readonly Dictionary<(DeckType, DeckType), bool> CompatibilityMatrix = new()
    {
        { (DeckType.Muspelheim, DeckType.Niflheim), false },  // Fire/Ice incompatible
        { (DeckType.Niflheim, DeckType.Muspelheim), false },  // Ice/Fire incompatible
        { (DeckType.Muspelheim, DeckType.Vanaheim), false },  // Fire/Bio incompatible
        { (DeckType.Vanaheim, DeckType.Muspelheim), false },  // Bio/Fire incompatible
        // All other combinations are compatible
    };

    public bool ValidateAdjacency(Deck sourceDeck, Deck targetDeck)
    {
        var key = (sourceDeck.Type, targetDeck.Type);

        if (CompatibilityMatrix.TryGetValue(key, out var isCompatible))
        {
            return isCompatible;
        }

        // Default to compatible if not explicitly defined
        return true;
    }

    public bool CanPlaceDeckAtPosition(Deck newDeck, Vector3Int position, DeckGrid grid)
    {
        var adjacentPositions = new Vector3Int[]
        {
            position + Vector3Int.right,     // East
            position + Vector3Int.left,      // West
            position + Vector3Int.up,        // Up
            position + Vector3Int.down,      // Down
            position + Vector3Int.forward,   // Forward
            position + Vector3Int.back       // Back
        };

        foreach (var adjacentPos in adjacentPositions)
        {
            if (grid.TryGetDeckAt(adjacentPos, out var adjacentDeck))
            {
                if (!ValidateAdjacency(newDeck, adjacentDeck))
                {
                    Debug.LogWarning($"Cannot place {newDeck.Name} adjacent to {adjacentDeck.Name}");
                    return false;
                }
            }
        }

        return true;
    }
}
```

---

## Logging & Debugging

### Log Categories

#### Environmental Events
```csharp
[EVENT] Zone: Hearth Perimeter, Event: HeatWave, Damage: 2d6, Affected: 3 characters
[EVENT] Zone: Hvergelmir's Heart, Event: ColdFront, Brittleness: +1 all equipment
```

#### Equipment Status Changes
```csharp
[EQUIPMENT] Character: Thorgrim, Item: Iron Sword, Heat: 5/10, Condition: Hot
[EQUIPMENT] Character: Sigrid, Item: Leather Armor, Brittleness: 2/3, Break: 25%
```

#### Condition Triggers
```csharp
[CONDITION] Character: Thorgrim, Condition: IntenseHeat, Severity: Dangerous, Fatigue: 4
[CONDITION] Character: Sigrid, Condition: ExtremeCold, Severity: Moderate, Equipment: Brittle
```

#### Adjacency Validation
```csharp
[ADJACENCY] Placement: VALID, Deck: Muspelheim, Adjacent: Svartalfheim (compatible)
[ADJACENCY] Placement: INVALID, Deck: Muspelheim, Adjacent: Niflheim (Fire/Ice incompatible)
```

### Debug Output Format

```
[TIMESTAMP] [LEVEL] [CATEGORY] [DETAIL]

Example:
2026-01-28T14:32:15.123Z [INFO] [EVENT] Heat Wave triggered in Surtr's Furnace
2026-01-28T14:32:15.456Z [WARNING] [EQUIPMENT] Iron Sword overheating (8/10 stress)
2026-01-28T14:32:15.789Z [ERROR] [ADJACENCY] Cannot place Deck-Niflheim adjacent to Deck-Muspelheim
```

---

## Unit Testing Strategy

### Test Categories (24 Total Tests)

#### Environmental Property Tests (4 tests)
```csharp
[TestFixture]
public class EnvironmentalPropertiesTests
{
    [Test]
    public void MuspelheimPropertiesAreCorrect()
    {
        var props = EnvironmentalProperties.Muspelheim;
        Assert.AreEqual(85f, props.Temperature);
        Assert.AreEqual(0.6f, props.Aetheric);
        Assert.AreEqual(5f, props.Humidity);
    }

    [Test]
    public void NiflheimPropertiesAreCorrect()
    {
        var props = EnvironmentalProperties.Niflheim;
        Assert.AreEqual(-40f, props.Temperature);
        Assert.AreEqual(0.3f, props.Aetheric);
        Assert.AreEqual(15f, props.Humidity);
    }

    [Test]
    public void TemperatureRangesAreEnforced()
    {
        var props = EnvironmentalProperties.Muspelheim;
        Assert.GreaterOrEqual(props.Temperature, 85f);
        Assert.LessOrEqual(props.Temperature, 200f);
    }

    [Test]
    public void AetericConductivityAffectsSpells()
    {
        var props = EnvironmentalProperties.Niflheim;
        float spellEffectiveness = props.Aetheric < 0.5f ? 0.5f : 1.0f;
        Assert.Less(spellEffectiveness, 1.0f);
    }
}
```

#### Heat Mechanics Tests (5 tests)
```csharp
[TestFixture]
public class HeatMechanicsTests
{
    [Test]
    public void EquipmentGainsHeatStressInMuspelheim()
    {
        var zone = new MuspelheimZone(ZoneDifficulty.Medium);
        var item = new Equipment { Name = "Iron Sword" };

        zone.ApplyEnvironmentalDamage(item);

        Assert.Greater(item.HeatStress, 0);
    }

    [Test]
    public void OverheatingTriggersAtThreshold()
    {
        var item = new Equipment { HeatStress = 0 };

        // Simulate heat stress accumulation
        for (int i = 0; i < 11; i++)
            item.HeatStress++;

        Assert.True(item.IsOverheated);
    }

    [Test]
    public void FatigueAccumulatesWithHeat()
    {
        var character = new Character { Fatigue = 0 };
        var zone = new MuspelheimZone(ZoneDifficulty.High);

        zone.ApplyEnvironmentalDamage(character);

        Assert.Greater(character.Fatigue, 0);
    }

    [Test]
    public void DifferentZonesProvideDifferentHeatStress()
    {
        var hearth = new MuspelheimZone(ZoneDifficulty.Low);
        var furnace = new MuspelheimZone(ZoneDifficulty.Hard);

        int hearthStress = hearth.CalculateHeatStress();
        int furnaceStress = furnace.CalculateHeatStress();

        Assert.Less(hearthStress, furnaceStress);
    }

    [Test]
    public void HeatWaveEventCausesAOEDamage()
    {
        var zone = new MuspelheimZone(ZoneDifficulty.Hard);
        var characters = new[] { new Character(), new Character() };

        zone.TriggerHeatWaveEvent(characters);

        foreach (var character in characters)
        {
            Assert.Greater(character.CurrentHealth, 0);  // All took damage but survived
        }
    }
}
```

#### Brittleness System Tests (5 tests)
```csharp
[TestFixture]
public class BrittlenessSystemTests
{
    [Test]
    public void EquipmentGainsBrittlenessInNiflheim()
    {
        var zone = new NiflheimZone(ZoneDifficulty.Medium);
        var item = new Equipment { Name = "Leather Armor" };

        zone.ApplyEnvironmentalDamage(item);

        Assert.Greater(item.BrittlenessLevel, 0);
    }

    [Test]
    public void BrittlenessIncreasesBreakChance()
    {
        var item = new Equipment { BrittlenessLevel = 0 };
        Assert.AreEqual(0, item.GetBreakChance());

        item.BrittlenessLevel = 1;
        Assert.AreEqual(10, item.GetBreakChance());

        item.BrittlenessLevel = 3;
        Assert.AreEqual(50, item.GetBreakChance());
    }

    [Test]
    public void EquipmentCanBreakDueToImpact()
    {
        var item = new Equipment { BrittlenessLevel = 3, Durability = 5 };

        // Simulate damage with high break chance
        item.TakeDamage(2);

        // Should either take normal damage or break
        Assert.True(item.IsBroken || item.Durability == 3);
    }

    [Test]
    public void BrittlenessReducesWhenWarmed()
    {
        var item = new Equipment { BrittlenessLevel = 2 };

        // Simulate warming to above freezing
        item.Thaw(currentTemperature: 10f);

        Assert.Less(item.BrittlenessLevel, 2);
    }

    [Test]
    public void BrittlenessDoesNotReduceInCold()
    {
        var item = new Equipment { BrittlenessLevel = 2 };

        // Simulate staying in extreme cold
        item.Thaw(currentTemperature: -50f);

        Assert.AreEqual(2, item.BrittlenessLevel);
    }
}
```

#### Adjacency Validation Tests (6 tests)
```csharp
[TestFixture]
public class AdjacencyValidationTests
{
    private RealmAdjacencyValidator validator;

    [SetUp]
    public void Setup()
    {
        validator = new RealmAdjacencyValidator();
    }

    [Test]
    public void MuspelheimCannotNeighborNiflheim()
    {
        var muspelheim = new Deck { Type = DeckType.Muspelheim };
        var niflheim = new Deck { Type = DeckType.Niflheim };

        Assert.False(validator.ValidateAdjacency(muspelheim, niflheim));
    }

    [Test]
    public void NiflheimCannotNeighborMuspelheim()
    {
        var niflheim = new Deck { Type = DeckType.Niflheim };
        var muspelheim = new Deck { Type = DeckType.Muspelheim };

        Assert.False(validator.ValidateAdjacency(niflheim, muspelheim));
    }

    [Test]
    public void MuspelheimCannotNeighborVanaheim()
    {
        var muspelheim = new Deck { Type = DeckType.Muspelheim };
        var vanaheim = new Deck { Type = DeckType.Vanaheim };

        Assert.False(validator.ValidateAdjacency(muspelheim, vanaheim));
    }

    [Test]
    public void MuspelheimCanNeighborSvartalfheim()
    {
        var muspelheim = new Deck { Type = DeckType.Muspelheim };
        var svartalfheim = new Deck { Type = DeckType.Svartalfheim };

        Assert.True(validator.ValidateAdjacency(muspelheim, svartalfheim));
    }

    [Test]
    public void NiflheimCanNeighborVanaheim()
    {
        var niflheim = new Deck { Type = DeckType.Niflheim };
        var vanaheim = new Deck { Type = DeckType.Vanaheim };

        Assert.True(validator.ValidateAdjacency(niflheim, vanaheim));
    }

    [Test]
    public void PlacementValidationRejectsIncompatibleNeighbors()
    {
        var grid = new DeckGrid();
        var existingNiflheim = new Deck { Type = DeckType.Niflheim };
        grid.SetDeckAt(Vector3Int.zero, existingNiflheim);

        var newMuspelheim = new Deck { Type = DeckType.Muspelheim };

        Assert.False(validator.CanPlaceDeckAtPosition(newMuspelheim, Vector3Int.right, grid));
    }
}
```

#### Zone Difficulty Tests (2 tests)
```csharp
[TestFixture]
public class ZoneDifficultyTests
{
    [Test]
    public void MuspelheimZonesHaveCorrectDifficulties()
    {
        var hearth = MuspelheimZone.HearthPerimeter;
        var slag = MuspelheimZone.SlagFields;
        var furnace = MuspelheimZone.SurtsFurnace;

        Assert.AreEqual(10, hearth.Difficulty);
        Assert.AreEqual(14, slag.Difficulty);
        Assert.AreEqual(18, furnace.Difficulty);
    }

    [Test]
    public void NiflheimZonesHaveCorrectDifficulties()
    {
        var marches = NiflheimZone.FrostMarches;
        var glacier = NiflheimZone.LivingGlacier;
        var heart = NiflheimZone.HvergelmirsHeart;

        Assert.AreEqual(10, marches.Difficulty);
        Assert.AreEqual(14, glacier.Difficulty);
        Assert.AreEqual(18, heart.Difficulty);
    }
}
```

#### Integration Tests (2 tests)
```csharp
[TestFixture]
public class ThermalIntegrationTests
{
    [Test]
    public void CharacterSurvivesHeartPerimeterButNotFurnace()
    {
        var character = new Character { Health = 50, Fatigue = 0 };

        // Survive Hearth Perimeter
        var hearth = MuspelheimZone.HearthPerimeter;
        for (int i = 0; i < 5; i++)
            hearth.ApplyEnvironmentalDamage(character);
        Assert.Greater(character.Health, 0);

        // Struggle in Furnace
        var furnace = MuspelheimZone.SurtsFurnace;
        for (int i = 0; i < 5; i++)
            furnace.ApplyEnvironmentalDamage(character);
        // Character should be significantly damaged
        Assert.Less(character.Health, 40);
    }

    [Test]
    public void EquipmentDegradationOverProgressionThroughZones()
    {
        var sword = new Equipment { Name = "Iron Sword", Durability = 20 };

        // Progress through zones
        MuspelheimZone.HearthPerimeter.ApplyEnvironmentalDamage(sword);
        int hearth Durability = sword.Durability;

        MuspelheimZone.SlagFields.ApplyEnvironmentalDamage(sword);
        int slagDurability = sword.Durability;

        MuspelheimZone.SurtsFurnace.ApplyEnvironmentalDamage(sword);
        int furnaceDurability = sword.Durability;

        // Each zone should cause more damage
        Assert.Greater(hearthDurability, slagDurability);
        Assert.Greater(slagDurability, furnaceDurability);
    }
}
```

---

## Deliverables & Acceptance Criteria

### Deliverable 1: Core Environmental System
**Description:** Muspelheim and Niflheim deck systems fully implemented
**Acceptance Criteria:**
- All 3 zones per deck functional with correct difficulty ratings
- Environmental properties correctly applied
- Base properties match specification exactly

### Deliverable 2: Thermal Mechanics
**Description:** Heat stress system for Muspelheim
**Acceptance Criteria:**
- Heat stress counter accumulates at zone-dependent rates
- Equipment effectiveness penalties applied at correct thresholds
- Overheating event system triggers appropriately
- Fatigue accumulation visible and recoverable

### Deliverable 3: Brittleness System
**Description:** Cold brittleness system for Niflheim
**Acceptance Criteria:**
- Brittleness levels progress 0-3 correctly
- Break chances calculated at 10%/25%/50%
- Thawing mechanics functional
- Equipment break properly when conditions met

### Deliverable 4: Adjacency Validation System
**Description:** Realm incompatibility enforcement
**Acceptance Criteria:**
- Muspelheim/Niflheim incompatibility enforced
- Muspelheim/Vanaheim incompatibility enforced
- Validation occurs at deck placement and runtime
- Clear error messages on placement failure

### Deliverable 5: Configuration Files
**Description:** JSON configuration for both decks
**Acceptance Criteria:**
- muspelheim.json is valid and complete
- niflheim.json is valid and complete
- All properties correctly specified
- Ready for loading by system

### Deliverable 6: Unit Tests
**Description:** Comprehensive test suite covering all mechanics
**Acceptance Criteria:**
- 24 total tests as specified
- All tests passing before release
- Coverage of environmental properties, thermal mechanics, brittleness, adjacency
- Integration tests verify cross-system functionality

### Deliverable 7: Documentation
**Description:** This design specification document
**Acceptance Criteria:**
- 600+ lines of comprehensive specification
- All sections completed
- Code examples provided
- Decision trees and flow diagrams included

---

## Dependencies & Integration Points

### Internal Dependencies
- **BaseEnvironmentalSystem:** Foundation for property inheritance
- **ConditionSystem:** IntenseHeat and ExtremeCold condition types
- **EquipmentDurabilitySystem:** Item damage tracking
- **CharacterFatigueSystem:** Fatigue accumulation mechanics
- **ZoneControllerBase:** Zone management infrastructure
- **RealmAdjacencyValidator:** Deck placement validation

### External Integration Points
- **WorldGrid:** Deck placement and adjacency checking
- **CharacterController:** Character state updates
- **UI System:** Equipment status, condition display
- **SaveSystem:** Persistence of heat stress, brittleness, fatigue
- **EventSystem:** Environmental event broadcasting
- **AudioSystem:** Heat/cold audio cues (deferred)

### Data Model Requirements
```csharp
// Required extensions to Character class
public class Character
{
    public float Fatigue { get; set; }
    public Dictionary<int, int> EquipmentHeatStress { get; set; }
    public Dictionary<int, int> EquipmentBrittleness { get; set; }
}

// Required extensions to Equipment class
public class Equipment
{
    public int HeatStress { get; set; }
    public int BrittlenessLevel { get; set; }
    public bool IsOverheated { get; set; }
    public bool IsBroken { get; set; }
    public float EffectivenessMultiplier { get; set; }
}
```

---

## Deferrals & Future Enhancements

### Deferred to v0.20.x

#### Environmental Transitions & Buffer Zones
**Description:** Transitional zones between incompatible realms that gradually shift environmental properties
**Rationale:** Adds complexity; core mechanics more important for v0.19.3a release
**Estimated Implementation:** 10-15 tests, 2-3 weeks

#### Equipment Attuning System
**Description:** Allow equipment to be fire-attuned or ice-attuned for enhanced performance and immunity
**Rationale:** Crafting system not yet ready; deferred to crafting overhaul
**Estimated Implementation:** 5-10 tests, 1-2 weeks

#### Audio Integration
**Description:** Environmental audio cues for heat, cold, equipment damage, and zone hazards
**Rationale:** Audio system in parallel development; can integrate post v0.19.3a
**Estimated Implementation:** Asset creation + 2-3 weeks integration

#### Visual Effects Enhancement
**Description:** Enhanced VFX for heat waves, brittleness effects, equipment degradation states
**Rationale:** VFX team handling separately; spec provides foundation
**Estimated Implementation:** Parallel track with art team

#### Advanced Thermal Calculations
**Description:** More sophisticated heat transfer modeling based on material properties
**Rationale:** Current approximation model sufficient; advanced model in future overhaul
**Estimated Implementation:** 5-10 tests, 2 weeks (future thermal 2.0)

### Future Enhancements (v0.21.x+)

- Multi-environmental zone hybrids (e.g., Warmth from Muspelheim bleeding into adjacent zone)
- Equipment fusion mechanics (combining fire and ice items for special properties)
- Environmental cataclysm events (realm-scale thermal fluctuations)
- Character heat/cold resistance training system
- Advanced brittleness recovery through crafting

---

## Summary

This specification defines a complete, implementable system for Muspelheim and Niflheim realms in Rune-Rust v0.19.3a. The ~24 unit tests provide comprehensive coverage of all thermal mechanics, brittleness systems, and adjacency validation. Configuration files are provided in JSON format for immediate use.

The core innovation of incompatible realm adjacency establishes a precedent for environmental systems affecting world topology, opening doors for future complex environmental interactions.

**Target Completion:** 3-4 weeks of development
**Team Size:** 2-3 engineers
**Risk Level:** Low (builds on established environmental infrastructure)
**Estimated Quality:** Production-ready with comprehensive test coverage

---

**Document Version:** 0.19.3a-SPEC-v1.0
**Last Updated:** 2026-01-28
**Next Review:** Post-implementation sprint review
