# v0.8.3 Combat Summary - Scope Breakdown

**Version:** 0.8.3
**Theme:** Combat Enhancement
**Prerequisites:** v0.8.2c Complete (Interaction Windows - Puzzle Window)
**Total Estimated Tests:** ~30 new tests

---

## Executive Summary

The Combat Enhancement sub-version refines and polishes the combat interface from v0.7.4, adding visual feedback, improved overlays, and a comprehensive end-of-combat summary. This phase brings the tactical combat UI to full feature parity and beyond, with damage pop-ups, refined range highlighting, and combat shortcuts.

Key focus areas:
- **Visual Feedback**: Damage pop-ups, attack animations, turn highlights
- **Overlay Refinement**: Improved movement/attack range visualization
- **Combat Summary**: End-of-combat rewards and statistics display

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.8.3a | Combat Visual Feedback | Damage pop-ups, attack effects, turn highlights | ~10 |
| v0.8.3b | Overlay Refinement | Enhanced range overlays, action bar polish | ~10 |
| v0.8.3c | Combat Summary | End-of-combat window, rewards, statistics | ~10 |

---

## Existing Infrastructure

### Already Implemented (from v0.7.4)

| Feature | Location | Notes |
|---------|----------|-------|
| CombatGridPanel | `Views/CombatGridPanel.axaml` | Tactical grid |
| GridCellControl | `Controls/GridCellControl.cs` | Grid cells |
| EntityTokenControl | `Controls/EntityTokenControl.cs` | Entity markers |
| GridInteractionService | `Services/GridInteractionService.cs` | Click handling |
| CombatantListPanel | `Views/CombatantListPanel.axaml` | Entity list |
| CombatActionBar | `Views/CombatActionBar.axaml` | Action buttons |

### Already Implemented (from v0.8.x)

| Feature | Location | Notes |
|---------|----------|-------|
| TooltipService | `Services/TooltipService.cs` | Hover info |
| KeyboardShortcutService | `Services/KeyboardShortcutService.cs` | Hotkeys |
| HealthBarControl | `Controls/HealthBarControl.cs` | HP bars |

### Needs Implementation (v0.8.3)

| Feature | Part | Notes |
|---------|------|-------|
| DamagePopupControl | v0.8.3a | Floating damage numbers |
| AttackAnimationService | v0.8.3a | Attack visual effects |
| TurnHighlightEffect | v0.8.3a | Active turn glow |
| EnhancedRangeOverlay | v0.8.3b | Improved highlights |
| QuickSlotBar | v0.8.3b | Ability shortcuts |
| CombatSummaryWindow | v0.8.2c | End-of-combat display |
| CombatStatistics | v0.8.2c | Combat tracking |

---

## Feature Analysis & Categorization

### Visual Feedback Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Damage pop-ups | Medium | Animation | **v0.8.3a** |
| Miss/hit indicators | Low | Animation | **v0.8.3a** |
| Critical hit effects | Low | Animation | **v0.8.3a** |
| Healing pop-ups | Low | Damage pop-ups | **v0.8.3a** |
| Turn start highlight | Medium | Entity tokens | **v0.8.3a** |
| Status effect indicators | Low | Status icons | **v0.8.3a** |

### Overlay Refinement Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Movement range gradient | Medium | Overlay rendering | **v0.8.3b** |
| Attack range pulse | Low | Animation | **v0.8.3b** |
| Ability AoE preview | Medium | Ability data | **v0.8.3b** |
| Quick-slot bar | Medium | Abilities | **v0.8.3b** |
| Action bar icons | Low | Assets | **v0.8.3b** |
| Keyboard shortcut hints | Low | KeyboardShortcutService | **v0.8.3b** |

### Combat Summary Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Victory/defeat screen | Medium | Combat result | **v0.8.2c** |
| XP/gold rewards | Low | Combat rewards | **v0.8.2c** |
| Loot display | Medium | Item drops | **v0.8.2c** |
| Combat statistics | Medium | Tracking | **v0.8.2c** |
| Level up notification | Low | Progression | **v0.8.2c** |

---

## Part Definitions

---

## v0.8.3a: Combat Visual Feedback

[v0.8.3a Design Specification](v0.8.3a-design-specification.md)

### Overview

Implement visual feedback elements for combat actions: floating damage numbers that pop up and fade, miss/critical indicators, healing effects, and turn start highlights. These enhancements make combat more visually engaging and provide clear feedback.

### Scope

**In Scope:**
- `DamagePopupControl` floating numbers
- Damage number color coding (white/red/green)
- Critical hit styling (larger, gold)
- Miss indicator ("MISS" text)
- Healing popup (green numbers)
- Float-and-fade animation
- `IAttackAnimationService` interface
- `AttackAnimationService` implementation
- Turn start glow effect on entity token
- Turn start sound cue (optional)
- Status effect applied indicator
- Status effect expired indicator
- Combat event integration

**Out of Scope:**
- Overlay refinement (v0.8.3b)
- Combat summary (v0.8.2c)
- Full spell effect visuals (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Controls | 1 | `DamagePopupControl` |
| Services | 1 | `AttackAnimationService` |
| Animations | 4 | Pop-up, fade, glow, shake |
| Styles | 1 | `CombatFeedbackStyles.axaml` |
| Unit Tests | ~10 | Animation trigger tests |

### Visual Feedback Designs

```
DAMAGE POP-UP ANIMATION:
                                              
   Frame 1        Frame 2        Frame 3        Frame 4       Frame 5
   (0ms)          (100ms)        (200ms)        (400ms)       (600ms)
                                              
                     -12            -12           -12           (fade)
      [@]             [@]           [@]           [@]           [@]
                                              
                                              
CRITICAL HIT:
                                              
   Frame 1        Frame 2        Frame 3        Frame 4
                                              
                  â˜… CRIT! â˜…       â˜…-24â˜…        (fade)
      [@]             [@]           [@]          [@]
                                              
                                              
MISS INDICATOR:
                                              
                     MISS          MISS         (fade)
      [@]             [@]           [@]          [@]
                                              

HEALING:
                     +15           +15          (fade)
      [@]             [@]           [@]          [@]
                     (green)       (green)


TURN START HIGHLIGHT:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚       1     2     3     4     5     6     7     8                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                â”‚
â”‚  A â”‚  â–‘  â”‚  â–‘  â”‚  â–ˆ  â”‚  â–ˆ  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  B â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  C â”‚  â–‘  â”‚  â–‘  â”‚ [S] â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  D â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚ â•”â•â•— â”‚ â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”‚     â”‚     â”‚     â”‚ â•‘@â•‘ â”‚     â”‚     â”‚     â”‚     â”‚  â—„â”€â”€ Glowing   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼ â•šâ•â• â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤      border    â”‚
â”‚  E â”‚  â–‘  â”‚  ~  â”‚  ~  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚      (pulse)   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                      â”‚
â”‚  â˜… YOUR TURN â˜…                                                      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DamagePopupControl

```csharp
namespace RuneAndRust.Avalonia.Controls;

/// <summary>
/// Displays floating damage/healing numbers.
/// </summary>
public class DamagePopupControl : Control
{
    public static readonly StyledProperty<int> ValueProperty =
        AvaloniaProperty.Register<DamagePopupControl, int>(nameof(Value));
    
    public static readonly StyledProperty<DamagePopupType> PopupTypeProperty =
        AvaloniaProperty.Register<DamagePopupControl, DamagePopupType>(nameof(PopupType));
    
    public static readonly StyledProperty<bool> IsCriticalProperty =
        AvaloniaProperty.Register<DamagePopupControl, bool>(nameof(IsCritical));
    
    public int Value
    {
        get => GetValue(ValueProperty);
        set => SetValue(ValueProperty, value);
    }
    
    public DamagePopupType PopupType
    {
        get => GetValue(PopupTypeProperty);
        set => SetValue(PopupTypeProperty, value);
    }
    
    public bool IsCritical
    {
        get => GetValue(IsCriticalProperty);
        set => SetValue(IsCriticalProperty, value);
    }
    
    public string DisplayText => PopupType switch
    {
        DamagePopupType.Damage => IsCritical ? $"â˜… {Value} â˜…" : $"-{Value}",
        DamagePopupType.Healing => $"+{Value}",
        DamagePopupType.Miss => "MISS",
        DamagePopupType.Block => "BLOCKED",
        _ => Value.ToString()
    };
    
    public IBrush TextColor => PopupType switch
    {
        DamagePopupType.Damage when IsCritical => Brushes.Gold,
        DamagePopupType.Damage => Brushes.White,
        DamagePopupType.Healing => Brushes.LimeGreen,
        DamagePopupType.Miss => Brushes.Gray,
        DamagePopupType.Block => Brushes.SteelBlue,
        _ => Brushes.White
    };
    
    public double FontSize => IsCritical ? 24 : 18;
}

public enum DamagePopupType
{
    Damage,
    Healing,
    Miss,
    Block
}
```

### AttackAnimationService

```csharp
namespace RuneAndRust.Avalonia.Services;

public interface IAttackAnimationService
{
    Task ShowDamagePopupAsync(GridPosition position, int damage, bool isCritical);
    Task ShowHealingPopupAsync(GridPosition position, int healing);
    Task ShowMissPopupAsync(GridPosition position);
    Task ShowBlockPopupAsync(GridPosition position);
    Task HighlightTurnStartAsync(Combatant combatant);
    Task ShowStatusAppliedAsync(GridPosition position, StatusEffect effect);
    Task ShowStatusExpiredAsync(GridPosition position, StatusEffect effect);
}

public class AttackAnimationService : IAttackAnimationService
{
    private readonly ICombatGridOverlay _overlay;
    private readonly ILogger<AttackAnimationService> _logger;
    
    private const int PopupDurationMs = 800;
    private const int HighlightDurationMs = 500;
    
    public async Task ShowDamagePopupAsync(GridPosition position, int damage, bool isCritical)
    {
        var popup = new DamagePopupControl
        {
            Value = damage,
            PopupType = DamagePopupType.Damage,
            IsCritical = isCritical
        };
        
        _overlay.AddPopup(popup, position);
        
        // Animate: rise up and fade out
        var animation = new Animation
        {
            Duration = TimeSpan.FromMilliseconds(PopupDurationMs),
            Children =
            {
                new KeyFrame { Cue = new Cue(0), Setters = { new Setter(OpacityProperty, 1.0), new Setter(Canvas.TopProperty, 0.0) } },
                new KeyFrame { Cue = new Cue(0.5), Setters = { new Setter(OpacityProperty, 1.0), new Setter(Canvas.TopProperty, -30.0) } },
                new KeyFrame { Cue = new Cue(1.0), Setters = { new Setter(OpacityProperty, 0.0), new Setter(Canvas.TopProperty, -50.0) } }
            }
        };
        
        await animation.RunAsync(popup);
        _overlay.RemovePopup(popup);
        
        _logger.LogDebug("Showed damage popup: {Damage} at {Position}", damage, position);
    }
    
    public async Task HighlightTurnStartAsync(Combatant combatant)
    {
        var token = _overlay.GetToken(combatant.Id);
        if (token is null) return;
        
        // Pulse glow animation
        var animation = new Animation
        {
            Duration = TimeSpan.FromMilliseconds(HighlightDurationMs),
            IterationCount = IterationCount.Parse("3"),
            Children =
            {
                new KeyFrame { Cue = new Cue(0), Setters = { new Setter(OpacityProperty, 1.0) } },
                new KeyFrame { Cue = new Cue(0.5), Setters = { new Setter(OpacityProperty, 0.5) } },
                new KeyFrame { Cue = new Cue(1.0), Setters = { new Setter(OpacityProperty, 1.0) } }
            }
        };
        
        token.ShowGlowEffect = true;
        await animation.RunAsync(token);
        token.ShowGlowEffect = false;
    }
}
```

### Acceptance Criteria

- [ ] Damage numbers appear on hit
- [ ] Numbers float upward and fade
- [ ] Critical hits show larger gold text
- [ ] Miss shows "MISS" in gray
- [ ] Healing shows green positive numbers
- [ ] Block shows "BLOCKED" in blue
- [ ] Turn start shows glow on entity
- [ ] Turn start glow pulses 3 times
- [ ] Status applied shows indicator
- [ ] Status expired shows indicator
- [ ] Animations don't block gameplay
- [ ] ~10 unit tests pass

---

## v0.8.3b: Overlay Refinement

[v0.8.3b Design Specification](v0.8.3b-design-specification.md)

### Overview

Enhance the combat grid overlays with improved visual clarity: gradient-based movement range, pulsing attack range, refined ability AoE previews, and a quick-slot bar for ability shortcuts. The action bar receives icon polish and keyboard hint display.

### Scope

**In Scope:**
- Movement range gradient overlay (bright center, dim edges)
- Attack range pulse animation
- Improved AoE preview (semi-transparent fill)
- Path preview for movement
- `QuickSlotBar` for abilities (1-9)
- Quick-slot assignment
- Action bar icon refinement
- Keyboard shortcut hints on buttons
- Target cycling indicator (Tab)
- Line-of-sight indicator
- Threatened squares warning

**Out of Scope:**
- Combat visual feedback (v0.8.3a)
- Combat summary (v0.8.2c)
- Advanced pathfinding display (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| User Controls | 1 | `QuickSlotBar` |
| View Models | 1 | `QuickSlotBarViewModel` |
| Overlay Renderers | 3 | Movement, attack, AoE |
| Styles | 1 | `CombatOverlayStyles.axaml` |
| Unit Tests | ~10 | Overlay, quick-slot tests |

### Enhanced Overlay Designs

```
ENHANCED MOVEMENT RANGE (gradient):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       1     2     3     4     5     6     7     8                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                â”‚
â”‚  A â”‚  â–‘  â”‚  â–‘  â”‚  â–ˆ  â”‚  â–ˆ  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  B â”‚  â–‘  â”‚  â–‘  â”‚ â–’â–’â–’ â”‚ â–’â–’â–’ â”‚ â–’â–’â–’ â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–’ = 4+ cells â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤      (dim)     â”‚
â”‚  C â”‚  â–‘  â”‚ â–’â–’â–’ â”‚ â–“â–“â–“ â”‚ â–“â–“â–“ â”‚ â–“â–“â–“ â”‚ â–’â–’â–’ â”‚  â–‘  â”‚  â–‘  â”‚  â–“ = 2-3 cellsâ”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤      (medium)  â”‚
â”‚  D â”‚  â–‘  â”‚ â–’â–’â–’ â”‚ â–“â–“â–“ â”‚ [@] â”‚ â–“â–“â–“ â”‚ â–’â–’â–’ â”‚  â–‘  â”‚  â–‘  â”‚  â–ˆ = 1 cell   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤      (bright)  â”‚
â”‚  E â”‚  â–‘  â”‚ â–’â–’â–’ â”‚ â–“â–“â–“ â”‚ â–“â–“â–“ â”‚ â–“â–“â–“ â”‚ â–’â–’â–’ â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  F â”‚  â–‘  â”‚  â–‘  â”‚ â–’â–’â–’ â”‚ â–’â–’â–’ â”‚ â–’â–’â–’ â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                      â”‚
â”‚  Movement remaining: 4                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


PATH PREVIEW:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       1     2     3     4     5     6     7     8                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                â”‚
â”‚  C â”‚  â–‘  â”‚  â–‘  â”‚ [S] â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚                â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                â”‚
â”‚  D â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â—â”€â”€â”‚â”€â”€â—â”€â”€â”‚â”€â”€â—  â”‚  â–‘  â”‚  â–‘  â”‚  â— = Path     â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤  â”‚  â”œâ”€â”€â”€â”€â”€â”¤                â”‚
â”‚  E â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚ [@] â”‚  â–‘  â”‚  â–‘  â”‚  â”‚  â”‚  â–‘  â”‚  [X] = Target  â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤  â—  â”œâ”€â”€â”€â”€â”€â”¤                â”‚
â”‚  F â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚  â–‘  â”‚ [X] â”‚  â–‘  â”‚                â”‚
â”‚    â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                      â”‚
â”‚  Move to F7: 4 cells                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ACTION BAR WITH KEYBOARD HINTS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚    âš”    â”‚ â”‚    ğŸƒ   â”‚ â”‚    âœ¨   â”‚ â”‚    ğŸ›¡   â”‚ â”‚    ğŸ“¦   â”‚        â”‚
â”‚  â”‚  Attack â”‚ â”‚   Move  â”‚ â”‚ Ability â”‚ â”‚  Defend â”‚ â”‚   Item  â”‚        â”‚
â”‚  â”‚   (A)   â”‚ â”‚   (M)   â”‚ â”‚   (B)   â”‚ â”‚   (D)   â”‚ â”‚   (I)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     [ End Turn (Space) ]                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


QUICK-SLOT BAR:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         QUICK SLOTS                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”¥  â”‚ â”‚ â„   â”‚ â”‚ âš¡  â”‚ â”‚ ğŸ§ª  â”‚ â”‚ ğŸ§ª  â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚   â”‚
â”‚  â”‚  1  â”‚ â”‚  2  â”‚ â”‚  3  â”‚ â”‚  4  â”‚ â”‚  5  â”‚ â”‚  6  â”‚ â”‚  7  â”‚ â”‚  8  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  Fire-   Ice     Light-  Health  Mana                               â”‚
â”‚  ball    Bolt    ning    Potion  Potion                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### QuickSlotBarViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class QuickSlotBarViewModel : ViewModelBase
{
    private readonly IAbilityService _abilityService;
    private readonly IInventoryService _inventoryService;
    
    [ObservableProperty]
    private ObservableCollection<QuickSlotViewModel> _slots = new();
    
    public QuickSlotBarViewModel(IAbilityService abilityService, IInventoryService inventoryService)
    {
        _abilityService = abilityService;
        _inventoryService = inventoryService;
        
        // Initialize 8 quick slots
        for (int i = 1; i <= 8; i++)
        {
            Slots.Add(new QuickSlotViewModel(i));
        }
        
        LoadAssignments();
    }
    
    [RelayCommand]
    private void UseSlot(int slotNumber)
    {
        var slot = Slots.FirstOrDefault(s => s.SlotNumber == slotNumber);
        if (slot is null || slot.IsEmpty) return;
        
        if (slot.AssignedAbility is not null)
        {
            _abilityService.UseAbility(slot.AssignedAbility.Id);
        }
        else if (slot.AssignedItem is not null)
        {
            _inventoryService.UseItem(slot.AssignedItem.Id);
        }
    }
    
    [RelayCommand]
    private void AssignToSlot(int slotNumber, object item)
    {
        var slot = Slots.FirstOrDefault(s => s.SlotNumber == slotNumber);
        if (slot is null) return;
        
        if (item is AbilityDefinition ability)
        {
            slot.AssignAbility(ability);
        }
        else if (item is Item consumable)
        {
            slot.AssignItem(consumable);
        }
        
        SaveAssignments();
    }
}

public partial class QuickSlotViewModel : ViewModelBase
{
    public int SlotNumber { get; }
    
    [ObservableProperty]
    private AbilityDefinition? _assignedAbility;
    
    [ObservableProperty]
    private Item? _assignedItem;
    
    public bool IsEmpty => AssignedAbility is null && AssignedItem is null;
    
    public string? Icon => AssignedAbility?.Icon ?? AssignedItem?.Icon;
    
    public string? Name => AssignedAbility?.Name ?? AssignedItem?.Name;
    
    public string Keybind => SlotNumber.ToString();
    
    public bool CanUse => !IsEmpty && (AssignedAbility?.IsUsable == true || AssignedItem?.IsUsable == true);
}
```

### Enhanced Overlay Renderer

```csharp
public class MovementRangeOverlay : Control
{
    public IReadOnlyList<GridPosition> ReachablePositions { get; set; }
    public GridPosition Origin { get; set; }
    public int MaxDistance { get; set; }
    
    public override void Render(DrawingContext context)
    {
        base.Render(context);
        
        foreach (var position in ReachablePositions)
        {
            var distance = CalculateDistance(Origin, position);
            var opacity = CalculateOpacity(distance, MaxDistance);
            
            var brush = new SolidColorBrush(Colors.DeepSkyBlue, opacity);
            var rect = GetCellRect(position);
            
            context.FillRectangle(brush, rect);
        }
    }
    
    private double CalculateOpacity(int distance, int maxDistance)
    {
        // Gradient: close = bright, far = dim
        // 1 cell away = 0.7, max distance = 0.2
        return 0.7 - (0.5 * distance / maxDistance);
    }
}
```

### Acceptance Criteria

- [ ] Movement range shows gradient
- [ ] Closer cells are brighter
- [ ] Path preview shows on hover
- [ ] Attack range pulses subtly
- [ ] AoE preview shows filled area
- [ ] Quick-slot bar displays abilities
- [ ] 1-8 keys activate quick slots
- [ ] Drag to assign quick slots
- [ ] Action buttons show shortcuts
- [ ] Tab cycles through targets
- [ ] Target indicator shows on cycle
- [ ] ~10 unit tests pass

---

## v0.8.2c: Combat Summary

[v0.8.2c Design Specification](v0.8.2c-design-specification.md)

### Overview

Implement an end-of-combat summary window that displays victory/defeat status, rewards earned (XP, gold, items), combat statistics, and level-up notifications. Provides a satisfying conclusion to each combat encounter.

### Scope

**In Scope:**
- `CombatSummaryWindow` modal window
- `CombatSummaryViewModel` with results data
- Victory celebration display
- Defeat screen
- XP earned display
- Level up notification (inline)
- Gold earned display
- Loot/item drops list
- Combat statistics:
  - Rounds taken
  - Damage dealt
  - Damage taken
  - Critical hits
  - Abilities used
  - Items used
- Continue button
- Auto-collect all loot option

**Out of Scope:**
- Combat visual feedback (v0.8.3a)
- Overlay refinement (v0.8.3b)
- Detailed combat replay (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Windows | 1 | `CombatSummaryWindow` |
| ViewModels | 2 | `CombatSummaryViewModel`, `LootItemViewModel` |
| Value Objects | 1 | `CombatStatistics` |
| Animations | 2 | Victory, defeat animations |
| Unit Tests | ~10 | Summary display, statistics tests |

### Combat Summary Window Designs

```
VICTORY SCREEN:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚                       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â”‚
â”‚                       â•‘                                   â•‘         â”‚
â”‚                       â•‘    âš”  VICTORY!  âš”               â•‘         â”‚
â”‚                       â•‘                                   â•‘         â”‚
â”‚                       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ENEMIES DEFEATED                                             â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚   â˜  Skeleton Warrior                                        â”‚   â”‚
â”‚  â”‚   â˜  Goblin                                                  â”‚   â”‚
â”‚  â”‚   â˜  Goblin Archer                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ REWARDS                                                      â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚   âœ¨ Experience:  +125 XP                                    â”‚   â”‚
â”‚  â”‚   ğŸ’° Gold:        +45 gold                                   â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚   ğŸ“¦ LOOT:                                                   â”‚   â”‚
â”‚  â”‚      â€¢ Iron Sword                                            â”‚   â”‚
â”‚  â”‚      â€¢ Healing Potion                                        â”‚   â”‚
â”‚  â”‚      â€¢ Bone Fragment (x3)                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ COMBAT STATISTICS                                            â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚   Rounds:       5         Damage Dealt:   67                 â”‚   â”‚
â”‚  â”‚   Criticals:    2         Damage Taken:   23                 â”‚   â”‚
â”‚  â”‚   Abilities:    3         Items Used:     1                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚         [ Collect All (C) ]              [ Continue ]               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


LEVEL UP NOTIFICATION (inline):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ REWARDS                                                      â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚   âœ¨ Experience:  +125 XP                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚   â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚   â”‚
â”‚  â”‚   â•‘  ğŸ‰ LEVEL UP! You are now Level 5!                    â•‘ â”‚   â”‚
â”‚  â”‚   â•‘                                                       â•‘ â”‚   â”‚
â”‚  â”‚   â•‘  Max Health: 45 â†’ 50 (+5)                             â•‘ â”‚   â”‚
â”‚  â”‚   â•‘  New Ability Unlocked: Shield Bash                    â•‘ â”‚   â”‚
â”‚  â”‚   â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚   ğŸ’° Gold:        +45 gold                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DEFEAT SCREEN:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚                       â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—         â”‚
â”‚                       â•‘                                   â•‘         â”‚
â”‚                       â•‘    ğŸ’€ DEFEAT ğŸ’€                   â•‘         â”‚
â”‚                       â•‘                                   â•‘         â”‚
â”‚                       â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”‚                                                                      â”‚
â”‚                   You have fallen in battle...                       â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ COMBAT STATISTICS                                            â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚   Rounds:       8         Damage Dealt:   42                 â”‚   â”‚
â”‚  â”‚   Criticals:    1         Damage Taken:   65                 â”‚   â”‚
â”‚  â”‚   Abilities:    5         Items Used:     3                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚       [ Load Last Save ]    [ Return to Menu ]    [ Retry ]         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CombatSummaryViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class CombatSummaryViewModel : ViewModelBase
{
    private readonly IGameSessionService _gameSession;
    private readonly IInventoryService _inventoryService;
    
    [ObservableProperty]
    private CombatResult _result;
    
    [ObservableProperty]
    private bool _isVictory;
    
    [ObservableProperty]
    private ObservableCollection<string> _defeatedEnemies = new();
    
    [ObservableProperty]
    private int _xpEarned;
    
    [ObservableProperty]
    private int _goldEarned;
    
    [ObservableProperty]
    private ObservableCollection<LootItemViewModel> _loot = new();
    
    [ObservableProperty]
    private CombatStatisticsViewModel _statistics;
    
    [ObservableProperty]
    private bool _didLevelUp;
    
    [ObservableProperty]
    private int _newLevel;
    
    [ObservableProperty]
    private ObservableCollection<LevelUpBonusViewModel> _levelUpBonuses = new();
    
    public CombatSummaryViewModel(CombatResult result, IGameSessionService gameSession)
    {
        _gameSession = gameSession;
        _result = result;
        
        IsVictory = result.IsVictory;
        LoadResultData(result);
    }
    
    [RelayCommand]
    private void CollectAll()
    {
        foreach (var item in Loot)
        {
            _inventoryService.AddItem(item.Item);
        }
        Loot.Clear();
    }
    
    [RelayCommand]
    private void Continue()
    {
        _gameSession.EndCombatSummary();
    }
    
    [RelayCommand]
    private void LoadLastSave()
    {
        _gameSession.LoadQuickSave();
    }
    
    [RelayCommand]
    private void ReturnToMenu()
    {
        _gameSession.ReturnToMainMenu();
    }
    
    [RelayCommand]
    private void Retry()
    {
        _gameSession.RetryCombat();
    }
    
    private void LoadResultData(CombatResult result)
    {
        foreach (var enemy in result.DefeatedEnemies)
        {
            DefeatedEnemies.Add(enemy.Name);
        }
        
        XpEarned = result.Rewards.Experience;
        GoldEarned = result.Rewards.Gold;
        
        foreach (var item in result.Rewards.Items)
        {
            Loot.Add(new LootItemViewModel(item));
        }
        
        Statistics = new CombatStatisticsViewModel(result.Statistics);
        
        if (result.LevelUp is not null)
        {
            DidLevelUp = true;
            NewLevel = result.LevelUp.NewLevel;
            foreach (var bonus in result.LevelUp.Bonuses)
            {
                LevelUpBonuses.Add(new LevelUpBonusViewModel(bonus));
            }
        }
    }
}
```

### CombatStatistics Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Tracks statistics for a single combat encounter.
/// </summary>
public record CombatStatistics
{
    public int RoundsTaken { get; init; }
    public int DamageDealt { get; init; }
    public int DamageTaken { get; init; }
    public int CriticalHits { get; init; }
    public int AbilitiesUsed { get; init; }
    public int ItemsUsed { get; init; }
    public int HealingDone { get; init; }
    public int MissCount { get; init; }
    public int BlockCount { get; init; }
    
    public static CombatStatistics Empty => new();
}
```

### Acceptance Criteria

- [ ] Victory screen shows on win
- [ ] Defeat screen shows on loss
- [ ] Defeated enemies listed
- [ ] XP earned displays correctly
- [ ] Gold earned displays correctly
- [ ] Loot items listed
- [ ] Combat statistics accurate
- [ ] Level up notification inline
- [ ] Level up bonuses displayed
- [ ] Collect All takes all loot
- [ ] Continue closes summary
- [ ] Defeat options work (Load, Menu, Retry)
- [ ] ~10 unit tests pass

---

## Dependencies & Prerequisites

```
v0.8.2c (Puzzle Window) - REQUIRED
    â”‚
    â””â”€â”€ Interaction Windows complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
v0.8.3 (Combat Enhancement)                                               â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.8.3a: Combat Visual Feedback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: CombatGridPanel, CombatService                  â”‚
    â”‚       Provides: DamagePopupControl, AttackAnimationService          â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.8.3b: Overlay Refinement â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: v0.8.3a, GridInteractionService                 â”‚
    â”‚       Provides: Enhanced overlays, QuickSlotBar                     â”‚
    â”‚                                                                     â”‚
    â””â”€â”€ v0.8.2c: Combat Summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: v0.8.3a, CombatResult
            Provides: CombatSummaryWindow, CombatStatistics
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.8.3a | ~4 | ~3 | ~10 | Medium |
| v0.8.3b | ~4 | ~3 | ~10 | Medium |
| v0.8.2c | ~4 | ~2 | ~10 | Medium |
| **Total** | **~12** | **~8** | **~30** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Animation performance | Medium | Low | Limit active animations |
| Pop-up overlap | Low | Medium | Queue or position offset |
| Statistics tracking bugs | Low | Low | Thorough testing |
| Quick-slot persistence | Low | Low | Save on change |

---

## Design Decisions (Confirmed)

### Visual Feedback

| Decision | Value | Notes |
|----------|-------|-------|
| **Pop-up Duration** | 800ms | Float and fade |
| **Critical Style** | Gold + larger | Emphasis |
| **Turn Highlight** | 3 pulses | Clear indication |

### Overlay Refinement

| Decision | Value | Notes |
|----------|-------|-------|
| **Movement Gradient** | Distance-based opacity | Closer = brighter |
| **Quick Slots** | 8 slots (1-8) | Number keys |
| **Path Preview** | On hover | Before click |

### Combat Summary

| Decision | Value | Notes |
|----------|-------|-------|
| **Victory Display** | Celebration + rewards | Satisfying conclusion |
| **Defeat Options** | Load, Menu, Retry | Player choice |
| **Statistics** | 6 key metrics | Combat insight |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.8.3a Design Spec** - Create detailed design for Combat Visual Feedback
3. **v0.8.3a Implementation** - Build damage pop-ups and animations
4. **v0.8.3b Design Spec** - Create specification for Overlay Refinement
5. **v0.8.3b Implementation** - Build enhanced overlays and quick-slots
6. **v0.8.2c Design Spec** - Create specification for Combat Summary
7. **v0.8.2c Implementation** - Build end-of-combat window

---

*This scope breakdown completes the v0.8.0 GUI Polish & Features series. Combat enhancement brings visual polish and satisfying feedback to tactical combat, delivering a complete GUI experience with full TUI feature parity.*
