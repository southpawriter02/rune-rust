# v0.15.5i - Exploration Synergies

**Release Date:** 2026-01-26

## Summary

Implements the **Exploration Synergies System**, connecting Wasteland Survival subsystems to secondary skills (Acrobatics and System Bypass). Four synergy patterns enable multi-skill exploration actions where success in a primary Wasteland Survival check gates access to a secondary skill check for enhanced outcomes.

## Exploration Synergies

| Synergy              | Primary Skill    | Secondary Skill          | Use Case                                                        |
| -------------------- | ---------------- | ------------------------ | --------------------------------------------------------------- |
| **Find Hidden Path** | Navigation       | Acrobatics (Traverse)    | Navigate to find a hidden path, then traverse difficult terrain |
| **Track to Lair**    | Tracking         | System Bypass (Entry)    | Track prey to its lair, then bypass entrance security           |
| **Avoid Patrol**     | Hazard Detection | Acrobatics (Stealth)     | Detect patrols, then use stealth to evade them                  |
| **Find and Loot**    | Foraging         | System Bypass (Lockpick) | Discover locked caches while foraging, then bypass locks        |

## Secondary Check Timing

All synergies use **OnPrimarySuccess** timing: the secondary check only executes if the primary Wasteland Survival check succeeds.

| Timing               | Behavior                                                |
| -------------------- | ------------------------------------------------------- |
| **OnPrimarySuccess** | Secondary executes only if primary succeeds             |
| OnPrimaryCritical    | Secondary executes only on primary critical success     |
| Always               | Secondary always executes regardless of primary outcome |

## Outcome States

| State               | Description                                   |
| ------------------- | --------------------------------------------- |
| **Full Success**    | Both primary and secondary checks succeeded   |
| **Partial Success** | Primary succeeded but secondary failed        |
| **Primary Failed**  | Primary check failed, secondary not attempted |

## Added

### Enums

| Enum                   | Location        | Purpose                                           |
| ---------------------- | --------------- | ------------------------------------------------- |
| `SynergyType`          | `Domain/Enums/` | Four exploration synergy types                    |
| `SecondaryCheckTiming` | `Domain/Enums/` | When secondary check executes relative to primary |

### Value Objects

| Value Object             | Location               | Purpose                                                        |
| ------------------------ | ---------------------- | -------------------------------------------------------------- |
| `SkillSynergyDefinition` | `Domain/ValueObjects/` | Definition linking primary/secondary skills with display names |
| `CombinedCheckContext`   | `Domain/ValueObjects/` | Context for executing combined checks with DC overrides        |
| `CombinedCheckResult`    | `Domain/ValueObjects/` | Complete outcome of a combined check with narrative            |
| `ExplorationContext`     | `Domain/ValueObjects/` | Context for determining available synergies                    |
| `SimpleCheckOutcome`     | `Domain/ValueObjects/` | Simplified check outcome for combined check processing         |

### Interfaces

| Interface               | Location                  | Purpose                                     |
| ----------------------- | ------------------------- | ------------------------------------------- |
| `ICombinedCheckService` | `Application/Interfaces/` | Contract for combined skill check execution |

### Services

| Service                | Location                | Purpose                                            |
| ---------------------- | ----------------------- | -------------------------------------------------- |
| `CombinedCheckService` | `Application/Services/` | Executes combined checks with narrative generation |

### Configuration

| File                          | Location          | Purpose                                           |
| ----------------------------- | ----------------- | ------------------------------------------------- |
| `combined-checks.json`        | `config/`         | Synergy definitions with narratives and DC tables |
| `combined-checks.schema.json` | `config/schemas/` | JSON schema for configuration validation          |

## Configuration Schema

```json
{
    "synergies": [
        {
            "id": "find-hidden-path",
            "displayName": "Find Hidden Path",
            "primarySkill": "navigation",
            "secondarySkill": "acrobatics",
            "timing": "on-primary-success",
            "narratives": {
                "fullSuccess": "...",
                "partialSuccess": "...",
                "primaryFailure": "...",
                "primaryFumble": "..."
            }
        }
    ],
    "secondaryDCs": {
        "find-hidden-path": {
            "narrow-ledge": 2,
            "collapsed-tunnel": 3,
            "vertical-shaft": 3,
            "crumbling-facade": 4
        }
    }
}
```

## Usage Example

```csharp
// Create exploration context
var context = ExplorationContext.Standard("wasteland-zone-1");

// Check available synergies
var synergies = combinedCheckService.GetAvailableSynergies(context);
// Returns: [FindHiddenPath, FindAndLoot]

// Execute a combined check
var checkContext = CombinedCheckContext.WithDcs(
    playerId, SynergyType.FindHiddenPath, primaryDc: 4, secondaryDc: 3);

var result = combinedCheckService.ExecuteCombinedCheck(
    player, SynergyType.FindHiddenPath, checkContext);

// Check outcome
if (result.OverallSuccess)
{
    // Both checks succeeded - path found and traversed
}
else if (result.IsPartialSuccess)
{
    // Found path but couldn't traverse
}
else
{
    // Primary failed - no path found
}
```

## Tests Added

| Test Class                  | Test Count | Coverage                                                                |
| --------------------------- | ---------- | ----------------------------------------------------------------------- |
| `CombinedCheckServiceTests` | 30         | Synergy definitions, check execution, timing, narratives, value objects |

### Test Categories

- **Synergy Definition Tests**: Verify correct skill assignments for all synergy types
- **Combined Check Execution Tests**: Primary/secondary execution flow
- **Secondary Check Timing Tests**: Timing based on primary outcomes
- **Available Synergies Tests**: Context-based synergy availability
- **Narrative Generation Tests**: Appropriate text for various outcomes
- **Skill Query Tests**: Primary and secondary skill lookups
- **Value Object Tests**: Factory methods and properties

## Design Decisions

1. **SimpleCheckOutcome**: Created a simplified check outcome wrapper to avoid coupling with the full `SkillCheckResult` domain object, enabling cleaner integration with the application-layer `ISkillService`.

2. **DC Override Support**: `CombinedCheckContext` supports optional DC overrides for both primary and secondary checks, allowing context-specific difficulty adjustments.

3. **Factory Methods**: All value objects provide static factory methods for common scenarios (e.g., `ExplorationContext.Standard()`, `CombinedCheckResult.FullSuccess()`).

4. **Immutable Results**: `CombinedCheckResult` is immutable with all outcome determination happening at construction time.

## Related Design Specification

- [v0.15.5i Design Specification](../design/v0.15.x/v0.15.5i-design-specification.md)
