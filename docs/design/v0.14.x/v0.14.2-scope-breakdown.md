# v0.14.2 Equipment Configuration Schemas - Scope Breakdown

**Version:** 0.14.2
**Theme:** Equipment Configuration Schemas
**Prerequisites:** v0.14.1 Complete (Combat Configuration Schemas)
**Total Estimated Tests:** ~20 new tests

---

## Executive Summary

The Equipment Configuration Schemas version creates comprehensive JSON schemas for all equipment-related configuration files, enabling full customization of weapons, armor, general items, and loot tables without code changes. This supports modding scenarios like sci-fi weaponry, magical artifact systems, or survival-focused item economies.

The work is divided into **four sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.14.2a | Weapon Schema | weapons.schema.json with damage dice, weapon properties, proficiency | ~5 |
| v0.14.2b | Armor Schema | armor.schema.json with defense, categories, movement penalties | ~5 |
| v0.14.2c | Item Schema | items.schema.json with consumables, equipment slots, rarity | ~5 |
| v0.14.2d | Loot Table Schema | loot-tables.schema.json with drop chances, quantity ranges, conditions | ~5 |

---

## Feature Analysis & Categorization

### From v0.14.x-overview.md - Equipment Configuration Schemas

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| weapons.schema.json | Medium | damage-types.schema.json | **v0.14.2a** |
| Damage dice expressions | Medium | weapons.schema.json | **v0.14.2a** |
| Weapon properties | Low | weapons.schema.json | **v0.14.2a** |
| Proficiency categories | Low | weapons.schema.json | **v0.14.2a** |
| Material types | Low | weapons.schema.json | **v0.14.2a** |
| Quality tiers | Low | weapons.schema.json | **v0.14.2a** |
| armor.schema.json | Medium | None | **v0.14.2b** |
| Defense calculations | Low | armor.schema.json | **v0.14.2b** |
| Armor categories | Low | armor.schema.json | **v0.14.2b** |
| Movement penalties | Low | armor.schema.json | **v0.14.2b** |
| Material types (armor) | Low | armor.schema.json | **v0.14.2b** |
| items.schema.json | Medium | None | **v0.14.2c** |
| Consumable effects | Medium | items.schema.json | **v0.14.2c** |
| Equipment slots | Low | items.schema.json | **v0.14.2c** |
| Stack limits | Low | items.schema.json | **v0.14.2c** |
| Rarity definitions | Low | items.schema.json | **v0.14.2c** |
| Vendor values | Low | items.schema.json | **v0.14.2c** |
| loot-tables.schema.json | Medium | items, weapons, armor schemas | **v0.14.2d** |
| Drop chance percentages | Low | loot-tables.schema.json | **v0.14.2d** |
| Quantity ranges | Low | loot-tables.schema.json | **v0.14.2d** |
| Conditional drops | Medium | loot-tables.schema.json | **v0.14.2d** |
| Guaranteed vs random | Low | loot-tables.schema.json | **v0.14.2d** |

---

## Existing Infrastructure

### Current Configuration Files

| File | Current State | Schema Exists |
|------|---------------|---------------|
| `config/weapons.json` | 9 weapons (swords, axes, daggers, staves) | Partial ($schema reference exists) |
| `config/armor.json` | 14 armor pieces + 4 accessories | Partial ($schema reference exists) |
| `config/cleanse-items.json` | 6 cleanse items | Yes (cleanse-items.schema.json) |
| `config/loot-tables.json` | Does not exist yet | No |

### Current Weapon Structure

```json
{
  "id": "steel_sword",
  "name": "Steel Sword",
  "description": "A finely crafted steel sword with excellent balance.",
  "weaponType": "Sword",
  "damageDice": "1d8+1",
  "attackModifier": 0,
  "statBonuses": { "finesse": 2 },
  "value": 150
}
```

### Current Armor Structure

```json
{
  "id": "plate_armor",
  "name": "Plate Armor",
  "description": "Full plate armor offering maximum protection.",
  "slot": "Armor",
  "armorType": "Heavy",
  "defenseBonus": 6,
  "initiativePenalty": -3,
  "requirements": { "minFortitude": 14, "minMight": 12 },
  "value": 500
}
```

### Current Accessory Structure

```json
{
  "id": "ring_of_strength",
  "name": "Ring of Strength",
  "description": "A silver ring that enhances physical power.",
  "slot": "Ring",
  "statBonuses": { "might": 2 },
  "value": 200
}
```

### Key Schema Conventions

- JSON Schema Draft-07 format
- ID pattern: `^[a-z][a-z0-9_]*$` (lowercase with underscores, per existing weapons/armor)
- Definitions section for reusable types
- Required fields explicitly listed
- Descriptions on all properties
- Enum validation for categorical values

---

## Phase Definitions

---

## v0.14.2a: Weapon Schema

[v0.14.2a Design Specification](v0.14.2a-design-specification.md)

### Overview

Create a comprehensive JSON schema for weapon definitions that validates damage dice expressions, weapon types, attack modifiers, stat bonuses, weapon properties, proficiency categories, material types, and quality tiers.

### Scope

**In Scope:**
- `weapons.schema.json` - Full schema for weapon definitions
- Damage dice validation (regex pattern for "1d8", "2d6+3", etc.)
- Weapon type enumeration (Sword, Axe, Dagger, Staff, Bow, Mace, etc.)
- Attack modifier validation (integer)
- Stat bonus object validation
- Weapon property definitions (finesse, versatile, reach, thrown, two-handed)
- Proficiency category enumeration (Simple, Martial, Exotic)
- Material type enumeration (Iron, Steel, Mithril, Adamantine, Wood)
- Quality tier enumeration (Common, Uncommon, Rare, Epic, Legendary)
- Range properties for ranged weapons (min, max, optimal)
- Schema validation unit tests

**Out of Scope:**
- Armor schema (v0.14.2b)
- Item schema (v0.14.2c)
- Cross-reference validation to abilities (future version)
- Weapon enchantment system (future version)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `weapons.schema.json` |
| Schema Definitions | 4 | `WeaponDefinition`, `StatBonuses`, `WeaponRange`, `DiceExpression` |
| Configuration Updates | 1 | Update `weapons.json` to reference new schema |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
weapons.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Weapon Configuration"
|-- description: "Schema for weapon definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- weapons: array of WeaponDefinition
|-- required: ["weapons"]
+-- definitions:
    |-- WeaponDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9_]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- weaponType: string (enum: Sword, Axe, Dagger, Staff, Bow, Mace, Spear, Hammer, Crossbow, Wand)
    |   |-- damageDice: string (pattern: ^\d+d\d+([+-]\d+)?$)
    |   |-- damageType: string (optional, references damage-types)
    |   |-- attackModifier: integer (default: 0)
    |   |-- statBonuses: StatBonuses (optional)
    |   |-- properties: array of string (enum values, optional)
    |   |-- proficiency: string (enum: Simple, Martial, Exotic, default: Simple)
    |   |-- material: string (enum, optional)
    |   |-- quality: string (enum: Common, Uncommon, Rare, Epic, Legendary, default: Common)
    |   |-- range: WeaponRange (optional, for ranged weapons)
    |   |-- isTwoHanded: boolean (default: false)
    |   |-- value: integer (minimum: 0)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- StatBonuses
    |   |-- might: integer (optional)
    |   |-- fortitude: integer (optional)
    |   |-- will: integer (optional)
    |   |-- wits: integer (optional)
    |   |-- finesse: integer (optional)
    |   +-- (additionalProperties: integer for custom stats)
    +-- WeaponRange
        |-- minimum: integer (minimum: 1)
        |-- optimal: integer (minimum: 1)
        +-- maximum: integer (minimum: 1)
```

### Weapon Types

| Type | Description | Typical Proficiency |
|------|-------------|---------------------|
| `Sword` | Bladed slashing weapons | Martial |
| `Axe` | Chopping weapons | Martial |
| `Dagger` | Small piercing weapons | Simple |
| `Staff` | Magical focusing staves | Simple |
| `Bow` | Ranged bows | Martial |
| `Mace` | Blunt crushing weapons | Simple |
| `Spear` | Polearm piercing weapons | Simple |
| `Hammer` | Heavy blunt weapons | Martial |
| `Crossbow` | Mechanical ranged weapons | Martial |
| `Wand` | Small magical implements | Exotic |

### Weapon Properties

| Property | Effect |
|----------|--------|
| `finesse` | Can use Finesse instead of Might for attack |
| `versatile` | Can be used one or two-handed |
| `reach` | Extended attack range (+1 tile) |
| `thrown` | Can be thrown for ranged attack |
| `two-handed` | Requires both hands |
| `light` | Favorable for dual-wielding |
| `heavy` | Penalty for small creatures |
| `loading` | Requires action to reload |

### Acceptance Criteria

- [x] `weapons.schema.json` created in `config/schemas/`
- [x] Schema validates existing `weapons.json` without errors
- [x] Damage dice pattern validated (e.g., "1d8", "2d6+3")
- [x] Weapon type enum validated
- [x] Attack modifier allows positive and negative values
- [x] Stat bonuses validated as optional object
- [x] Weapon properties validated as enum array
- [x] Proficiency category enum validated
- [x] Quality tier enum validated
- [x] Value must be non-negative
- [x] ~5 unit tests pass

---

## v0.14.2b: Armor Schema

[v0.14.2b Design Specification](v0.14.2b-design-specification.md)

### Overview

Create a comprehensive JSON schema for armor and accessory definitions that validates defense values, armor categories, equipment slots, movement penalties, stat requirements, and material types.

### Scope

**In Scope:**
- `armor.schema.json` - Full schema for armor and accessory definitions
- Equipment slot enumeration (Armor, Shield, Helmet, Boots, Ring, Amulet, Gloves, Belt, Cloak)
- Armor type enumeration (Light, Medium, Heavy, None)
- Defense bonus validation
- Initiative/movement penalty validation
- Stat requirement object (minMight, minFortitude, etc.)
- Stat bonus object validation
- Material type enumeration (Leather, Chain, Plate, Cloth, Wood, Iron, Steel, Mithril)
- Quality tier enumeration (same as weapons)

**Out of Scope:**
- Weapon schema (v0.14.2a)
- Item schema (v0.14.2c)
- Set bonus mechanics (future version)
- Armor enchantment system (future version)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `armor.schema.json` |
| Schema Definitions | 4 | `ArmorDefinition`, `AccessoryDefinition`, `StatRequirements`, `StatBonuses` |
| Configuration Updates | 1 | Update `armor.json` to reference new schema |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
armor.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Armor Configuration"
|-- description: "Schema for armor and accessory definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   |-- armor: array of ArmorDefinition
|   +-- accessories: array of AccessoryDefinition
|-- required: ["armor"]
+-- definitions:
    |-- ArmorDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9_]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- slot: string (enum: Armor, Shield, Helmet, Boots, Gloves)
    |   |-- armorType: string (enum: Light, Medium, Heavy)
    |   |-- defenseBonus: integer (minimum: 0)
    |   |-- damageReduction: integer (minimum: 0, optional)
    |   |-- initiativePenalty: integer (maximum: 0, optional)
    |   |-- movementPenalty: integer (maximum: 0, optional)
    |   |-- stealthDisadvantage: boolean (default: false)
    |   |-- requirements: StatRequirements (optional)
    |   |-- statBonuses: StatBonuses (optional)
    |   |-- material: string (enum, optional)
    |   |-- quality: string (enum: Common, Uncommon, Rare, Epic, Legendary, default: Common)
    |   |-- value: integer (minimum: 0)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- AccessoryDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9_]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- slot: string (enum: Ring, Amulet, Belt, Cloak)
    |   |-- statBonuses: StatBonuses
    |   |-- quality: string (enum, default: Common)
    |   |-- value: integer (minimum: 0)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- StatRequirements
    |   |-- minMight: integer (optional)
    |   |-- minFortitude: integer (optional)
    |   |-- minWill: integer (optional)
    |   |-- minWits: integer (optional)
    |   +-- minFinesse: integer (optional)
    +-- StatBonuses
        |-- might: integer (optional)
        |-- fortitude: integer (optional)
        |-- will: integer (optional)
        |-- wits: integer (optional)
        |-- finesse: integer (optional)
        |-- maxHealth: integer (optional)
        +-- (additionalProperties: integer for custom stats)
```

### Equipment Slots

| Slot | Category | Typical Items |
|------|----------|---------------|
| `Armor` | Body armor | Robes, Leather, Chain Mail, Plate |
| `Shield` | Off-hand defense | Buckler, Iron Shield, Tower Shield |
| `Helmet` | Head protection | Cap, Helm, Great Helm |
| `Boots` | Foot protection | Leather Boots, Iron Boots |
| `Gloves` | Hand protection | Gloves, Gauntlets |
| `Ring` | Accessory (x2) | Ring of Strength, Ring of Precision |
| `Amulet` | Accessory | Amulet of Vitality, Amulet of Wisdom |
| `Belt` | Accessory | Belt of Giant Strength |
| `Cloak` | Accessory | Cloak of Protection |

### Armor Categories

| Category | Defense | Penalties | Requirements |
|----------|---------|-----------|--------------|
| `Light` | Low (1-3) | None | None |
| `Medium` | Medium (4-5) | Initiative -1 to -2 | Fortitude 12-13 |
| `Heavy` | High (6+) | Initiative -3, Stealth | Fortitude 14+, Might 12+ |

### Acceptance Criteria

- [x] `armor.schema.json` created in `config/schemas/`
- [x] Schema validates existing `armor.json` without errors
- [x] Equipment slot enum validated (Armor, Shield, Helmet, Boots, Ring, Amulet)
- [x] Armor type enum validated (Light, Medium, Heavy)
- [x] Defense bonus validated as non-negative
- [x] Initiative penalty validated as non-positive
- [x] Stat requirements validated as optional object
- [x] Stat bonuses validated as optional object
- [x] Accessories array supported with different schema
- [x] ~5 unit tests pass (5/5)

---

## v0.14.2c: Item Schema

[v0.14.2c Design Specification](v0.14.2c-design-specification.md)

### Overview

Create a comprehensive JSON schema for general item definitions that validates consumable effects, equipment slots, stack limits, rarity tiers, and vendor values. This schema covers items that are not weapons or armor (potions, scrolls, crafting materials, quest items).

### Scope

**In Scope:**
- `items.schema.json` - Full schema for general item definitions
- Item category enumeration (Consumable, Material, QuestItem, Key, Miscellaneous)
- Consumable effect definitions (heal, restore mana, buff, cure)
- Stack limit validation (1-999)
- Rarity tier enumeration (Common, Uncommon, Rare, Epic, Legendary)
- Vendor value (buy/sell prices)
- Weight/encumbrance value
- Use requirements (level, class, etc.)
- Cleanse item integration (reference existing schema pattern)

**Out of Scope:**
- Weapon schema (v0.14.2a)
- Armor schema (v0.14.2b)
- Loot table schema (v0.14.2d)
- Crafting recipe system (v0.14.5)
- Inventory management logic (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `items.schema.json` |
| Schema Definitions | 4 | `ItemDefinition`, `ConsumableEffect`, `UseRequirement`, `VendorPrices` |
| Configuration Updates | 1 | Create `items.json` with example items |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
items.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Item Configuration"
|-- description: "Schema for general item definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- items: array of ItemDefinition
|-- required: ["items"]
+-- definitions:
    |-- ItemDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9_]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- category: string (enum: Consumable, Material, QuestItem, Key, Miscellaneous)
    |   |-- rarity: string (enum: Common, Uncommon, Rare, Epic, Legendary, default: Common)
    |   |-- stackLimit: integer (minimum: 1, maximum: 999, default: 1)
    |   |-- weight: number (minimum: 0, default: 0)
    |   |-- vendorPrices: VendorPrices (optional)
    |   |-- consumableEffect: ConsumableEffect (optional, required if category=Consumable)
    |   |-- useRequirements: UseRequirement (optional)
    |   |-- isQuestItem: boolean (default: false)
    |   |-- isSellable: boolean (default: true)
    |   |-- tags: array of string (optional)
    |   +-- sortOrder: integer (minimum: 0, optional)
    |-- ConsumableEffect
    |   |-- type: string (enum: Heal, RestoreMana, RestoreStamina, Buff, Cure, Damage, Utility)
    |   |-- value: integer (optional, for heal/restore amounts)
    |   |-- percentage: number (0-1, optional, for percentage-based effects)
    |   |-- duration: integer (optional, turns for buff effects)
    |   |-- statusEffect: string (optional, references status effect id)
    |   |-- cleanseType: string (optional, enum: Specific, AllNegative, Magical, Elemental)
    |   +-- specificEffect: string (optional, for specific cleanse targets)
    |-- UseRequirement
    |   |-- minLevel: integer (minimum: 1, optional)
    |   |-- classIds: array of string (optional)
    |   +-- statRequirements: StatRequirements (optional)
    +-- VendorPrices
        |-- buyPrice: integer (minimum: 0)
        +-- sellPrice: integer (minimum: 0)
```

### Item Categories

| Category | Description | Examples |
|----------|-------------|----------|
| `Consumable` | Used and destroyed | Health Potion, Mana Elixir, Antidote |
| `Material` | Crafting components | Iron Ore, Leather Strip, Magic Dust |
| `QuestItem` | Story-related items | Ancient Key, Royal Seal |
| `Key` | Door/chest keys | Dungeon Key, Master Key |
| `Miscellaneous` | Other items | Torch, Rope, Map |

### Rarity Tiers

| Rarity | Color | Drop Modifier | Value Modifier |
|--------|-------|---------------|----------------|
| `Common` | White | 1.0x | 1.0x |
| `Uncommon` | Green | 0.5x | 2.0x |
| `Rare` | Blue | 0.2x | 5.0x |
| `Epic` | Purple | 0.05x | 20.0x |
| `Legendary` | Orange | 0.01x | 100.0x |

### Consumable Effect Types

| Effect Type | Description | Value Field Usage |
|-------------|-------------|-------------------|
| `Heal` | Restore health | value = HP restored |
| `RestoreMana` | Restore mana | value = mana restored |
| `RestoreStamina` | Restore stamina | value = stamina restored |
| `Buff` | Apply positive status | statusEffect = buff id, duration = turns |
| `Cure` | Remove negative status | cleanseType + specificEffect |
| `Damage` | Deal damage (thrown items) | value = damage dealt |
| `Utility` | Special effect | Custom handling |

### Acceptance Criteria

- [x] `items.schema.json` created in `config/schemas/`
- [x] Schema validates with sample items
- [x] Item category enum validated
- [x] Rarity tier enum validated
- [x] Stack limit range validated (1-999)
- [x] Consumable effect structure validated when category is Consumable
- [x] Vendor prices validated as non-negative
- [x] Weight validated as non-negative
- [x] Use requirements validated as optional object
- [x] Compatible with existing cleanse-items.json pattern
- [x] ~5 unit tests pass (5/5)

---

## v0.14.2d: Loot Table Schema

[v0.14.2d Design Specification](v0.14.2d-design-specification.md)

### Overview

Create a comprehensive JSON schema for loot table definitions that validates drop chance percentages, quantity ranges, conditional drops, and guaranteed vs random pools. Loot tables define what items monsters drop, chests contain, or quests reward.

### Scope

**In Scope:**
- `loot-tables.schema.json` - Full schema for loot table definitions
- Loot table structure (id, name, entries)
- Drop chance percentage validation (0.0 to 1.0)
- Quantity range validation (min/max)
- Conditional drop requirements (level, difficulty, class)
- Guaranteed drops (always drop)
- Weighted random pools (pick from pool)
- Currency drop ranges
- Item reference validation (id strings)

**Out of Scope:**
- Loot distribution logic (runtime concern)
- Monster loot assignment (v0.14.3)
- Chest/container definitions (v0.14.4)
- Dynamic loot scaling (future version)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `loot-tables.schema.json` |
| Schema Definitions | 4 | `LootTableDefinition`, `LootEntry`, `QuantityRange`, `DropCondition` |
| Configuration Updates | 1 | Create `loot-tables.json` with example tables |
| Unit Tests | ~5 | Schema validation tests |

### Schema Structure

```
loot-tables.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Loot Table Configuration"
|-- description: "Schema for loot table definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- lootTables: array of LootTableDefinition
|-- required: ["lootTables"]
+-- definitions:
    |-- LootTableDefinition
    |   |-- id: string (pattern: ^[a-z][a-z0-9_-]*$)
    |   |-- name: string (minLength: 1)
    |   |-- description: string (optional)
    |   |-- guaranteedDrops: array of LootEntry (optional)
    |   |-- randomPool: array of LootEntry (optional)
    |   |-- poolDropCount: QuantityRange (optional, how many from pool)
    |   |-- currencyDrop: CurrencyDrop (optional)
    |   +-- conditions: DropCondition (optional, table-level conditions)
    |-- LootEntry
    |   |-- itemId: string (references item/weapon/armor id)
    |   |-- itemType: string (enum: Item, Weapon, Armor, optional)
    |   |-- dropChance: number (minimum: 0, maximum: 1, default: 1.0)
    |   |-- quantity: QuantityRange
    |   |-- conditions: DropCondition (optional, entry-level conditions)
    |   +-- weight: integer (minimum: 1, optional, for weighted random)
    |-- QuantityRange
    |   |-- min: integer (minimum: 1, default: 1)
    |   +-- max: integer (minimum: 1, default: 1)
    |-- CurrencyDrop
    |   |-- dropChance: number (minimum: 0, maximum: 1, default: 1.0)
    |   |-- amount: QuantityRange
    |   +-- currencyType: string (default: "gold")
    +-- DropCondition
        |-- minLevel: integer (minimum: 1, optional)
        |-- maxLevel: integer (minimum: 1, optional)
        |-- difficulty: string (enum: Easy, Normal, Hard, Nightmare, optional)
        |-- classIds: array of string (optional)
        +-- requiredFlags: array of string (optional, quest flags)
```

### Loot Table Structure

```
Loot Table
|-- Guaranteed Drops (always drop)
|   |-- Entry 1: item_id, quantity, dropChance (usually 1.0)
|   +-- Entry 2: item_id, quantity, dropChance
|-- Random Pool (pick from weighted pool)
|   |-- Entry 1: item_id, weight, quantity
|   |-- Entry 2: item_id, weight, quantity
|   +-- Entry 3: item_id, weight, quantity
|-- Pool Drop Count (how many items from pool)
|   |-- min: 1
|   +-- max: 3
+-- Currency Drop
    |-- dropChance: 0.8
    |-- amount: { min: 10, max: 50 }
    +-- currencyType: "gold"
```

### Example Loot Tables

| Table ID | Use Case | Guaranteed | Pool Size |
|----------|----------|------------|-----------|
| `goblin_common` | Basic goblin drops | None | 3 items |
| `goblin_shaman` | Shaman variant | 1 staff | 5 items |
| `treasure_chest_small` | Small chest | 1 gold | 2-4 items |
| `boss_dragon` | Dragon boss | 1 legendary | 5-8 items |
| `quest_reward_tier1` | Quest completion | Fixed rewards | None |

### Drop Condition Examples

| Condition Type | Example | Effect |
|----------------|---------|--------|
| Level Range | `minLevel: 5, maxLevel: 10` | Only drops for level 5-10 players |
| Difficulty | `difficulty: "Hard"` | Only drops on Hard difficulty |
| Class Filter | `classIds: ["shadow-walker"]` | Only drops for Shadow-Walkers |
| Quest Flag | `requiredFlags: ["dragon_slain"]` | Only after quest completion |

### Acceptance Criteria

- [x] `loot-tables.schema.json` created in `config/schemas/`
- [x] Schema validates with sample loot tables (8 tables)
- [x] Drop chance validated (0.0 to 1.0)
- [x] Quantity range validated (min <= max, both >= 1)
- [x] Guaranteed drops array validated
- [x] Random pool with weights validated
- [x] Pool drop count validated
- [x] Currency drop structure validated
- [x] Drop conditions validated at table and entry level
- [x] Item type enum validated (Item, Weapon, Armor)
- [x] ~5 unit tests pass (5/5)

---

## Dependencies & Prerequisites

```
v0.14.1 (Combat Configuration Schemas) - REQUIRED
    |
    +-- damage-types.schema.json available ────────────────────────────────┐
                                                                           |
                                       v
v0.14.2 (Equipment Configuration Schemas)
    |
    |-- v0.14.2a: Weapon Schema ──────────────────────────────────────────┐
    |       Dependencies: damage-types.schema.json (optional ref)          |
    |       Provides: weapons.schema.json, DiceExpression pattern          |
    |                                                                      |
    |-- v0.14.2b: Armor Schema ───────────────────────────────────────────┤
    |       Dependencies: None                                             |
    |       Provides: armor.schema.json, StatRequirements definition       |
    |                                                                      |
    |-- v0.14.2c: Item Schema ────────────────────────────────────────────┤
    |       Dependencies: None (cleanse-items pattern reference)           |
    |       Provides: items.schema.json, ConsumableEffect definition       |
    |                                                                      |
    +-- v0.14.2d: Loot Table Schema ──────────────────────────────────────┘
            Dependencies: v0.14.2a, v0.14.2b, v0.14.2c (item id references)
            Provides: loot-tables.schema.json

Note: v0.14.2d should be implemented last due to item reference dependencies
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.14.2a | 1 | 1 | ~5 | Medium |
| v0.14.2b | 1 | 1 | ~5 | Medium |
| v0.14.2c | 2 | 0 | ~5 | Medium |
| v0.14.2d | 2 | 0 | ~5 | Medium |
| **Total** | **6** | **2** | **~20** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Existing weapons/armor fail validation | Medium | Low | Review all entries before finalizing schema |
| Dice expression regex too strict | Medium | Medium | Test with edge cases (1d20+5, 2d6-1) |
| Loot table complexity overwhelming | Low | Low | Start with simple tables, add complexity incrementally |
| Cross-reference validation complexity | Medium | Medium | Defer runtime validation to provider layer |

---

## Design Decisions (Confirmed)

### Schema Standards

| Decision | Value | Notes |
|----------|-------|-------|
| **JSON Schema Version** | Draft-07 | Consistent with v0.14.0, v0.14.1 |
| **ID Pattern (weapons/armor)** | `^[a-z][a-z0-9_]*$` | Matches existing underscore convention |
| **ID Pattern (loot tables)** | `^[a-z][a-z0-9_-]*$` | Allows hyphens for readability |
| **Schema Location** | `config/schemas/` | Centralized schema storage |

### Validation Approach

| Decision | Value | Notes |
|----------|-------|-------|
| **Dice Expression Pattern** | `^\d+d\d+([+-]\d+)?$` | Supports "1d8", "2d6+3", "1d4-1" |
| **Drop Chance Range** | 0.0 to 1.0 | Percentage as decimal |
| **Quantity Minimum** | 1 | No zero-quantity drops |
| **Additional Properties** | Allowed by default | Forward compatibility |

### Equipment Conventions

| Decision | Value | Notes |
|----------|-------|-------|
| **Weapon value** | Gold pieces | Non-negative integer |
| **Defense bonus** | Non-negative | Armor always adds defense |
| **Initiative penalty** | Non-positive | Penalties are negative values |
| **Stack limit range** | 1-999 | Reasonable inventory limits |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.14.2a Design Spec** - Create detailed design for Weapon Schema
3. **v0.14.2a Implementation** - Build weapons.schema.json
4. **v0.14.2b Design Spec** - Create detailed design for Armor Schema
5. **v0.14.2b Implementation** - Build armor.schema.json
6. **v0.14.2c Design Spec** - Create detailed design for Item Schema
7. **v0.14.2c Implementation** - Build items.schema.json, items.json
8. **v0.14.2d Design Spec** - Create detailed design for Loot Table Schema
9. **v0.14.2d Implementation** - Build loot-tables.schema.json, loot-tables.json

---

*This scope breakdown provides a structured approach to implementing v0.14.2 Equipment Configuration Schemas. Each sub-part creates a complete, validated JSON schema for equipment-related configuration files. The recommended implementation order is v0.14.2a (weapons), v0.14.2b (armor), v0.14.2c (items), and finally v0.14.2d (loot tables), ensuring dependencies are satisfied and enabling full item/loot customization without code changes.*
