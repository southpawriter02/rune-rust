<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RuneAndRust.Presentation.Gui.ViewModels.Settings"
        x:Class="RuneAndRust.Presentation.Gui.Views.SettingsWindow"
        x:DataType="vm:SettingsWindowViewModel"
        Title="Settings"
        Width="700" Height="500"
        WindowStartupLocation="CenterOwner">
    
    <Design.DataContext>
        <vm:SettingsWindowViewModel />
    </Design.DataContext>
    
    <Window.DataTemplates>
        <!-- Audio Tab -->
        <DataTemplate DataType="vm:AudioSettingsTabViewModel">
            <StackPanel Spacing="16">
                <TextBlock Text="AUDIO SETTINGS" FontSize="16" FontWeight="Bold" Margin="0,0,0,16" />
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Master Volume" />
                    <Grid ColumnDefinitions="*,50">
                        <Slider Grid.Column="0" Value="{Binding MasterVolume}" Minimum="0" Maximum="100" />
                        <TextBlock Grid.Column="1" Text="{Binding MasterVolume, StringFormat={}{0}%}" 
                                   VerticalAlignment="Center" HorizontalAlignment="Right" />
                    </Grid>
                </StackPanel>
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Music Volume" />
                    <Grid ColumnDefinitions="*,50">
                        <Slider Grid.Column="0" Value="{Binding MusicVolume}" Minimum="0" Maximum="100" />
                        <TextBlock Grid.Column="1" Text="{Binding MusicVolume, StringFormat={}{0}%}" 
                                   VerticalAlignment="Center" HorizontalAlignment="Right" />
                    </Grid>
                </StackPanel>
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Sound Effects" />
                    <Grid ColumnDefinitions="*,50">
                        <Slider Grid.Column="0" Value="{Binding SfxVolume}" Minimum="0" Maximum="100" />
                        <TextBlock Grid.Column="1" Text="{Binding SfxVolume, StringFormat={}{0}%}" 
                                   VerticalAlignment="Center" HorizontalAlignment="Right" />
                    </Grid>
                </StackPanel>
                
                <CheckBox Content="Enable Sound Effects" IsChecked="{Binding EnableSoundEffects}" Margin="0,8,0,0" />
                <CheckBox Content="Mute All Audio" IsChecked="{Binding MuteAll}" />
            </StackPanel>
        </DataTemplate>
        
        <!-- Display Tab -->
        <DataTemplate DataType="vm:DisplaySettingsTabViewModel">
            <StackPanel Spacing="16">
                <TextBlock Text="DISPLAY SETTINGS" FontSize="16" FontWeight="Bold" Margin="0,0,0,16" />
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Theme" />
                    <ComboBox ItemsSource="{Binding AvailableThemes}" SelectedItem="{Binding SelectedTheme}" MinWidth="200" />
                </StackPanel>
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Font Size" />
                    <Grid ColumnDefinitions="*,50">
                        <Slider Grid.Column="0" Value="{Binding FontSizePercent}" Minimum="80" Maximum="150" />
                        <TextBlock Grid.Column="1" Text="{Binding FontSizePercent, StringFormat={}{0}%}" 
                                   VerticalAlignment="Center" HorizontalAlignment="Right" />
                    </Grid>
                </StackPanel>
                
                <CheckBox Content="Enable Combat Animations" IsChecked="{Binding EnableCombatAnimations}" Margin="0,8,0,0" />
                <CheckBox Content="Enable Room Transition Effects" IsChecked="{Binding EnableRoomTransitions}" />
                <CheckBox Content="High Contrast Mode" IsChecked="{Binding HighContrastMode}" />
            </StackPanel>
        </DataTemplate>
        
        <!-- Gameplay Tab -->
        <DataTemplate DataType="vm:GameplaySettingsTabViewModel">
            <StackPanel Spacing="16">
                <TextBlock Text="GAMEPLAY SETTINGS" FontSize="16" FontWeight="Bold" Margin="0,0,0,16" />
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Difficulty" />
                    <ComboBox ItemsSource="{Binding Difficulties}" SelectedItem="{Binding Difficulty}" MinWidth="200" />
                    <TextBlock Text="{Binding DifficultyDescription}" Foreground="#999999" FontSize="11" />
                </StackPanel>
                
                <StackPanel Spacing="4">
                    <TextBlock Text="Auto-Save Frequency" />
                    <ComboBox ItemsSource="{Binding AutoSaveOptions}" SelectedItem="{Binding AutoSaveFrequency}" MinWidth="200" />
                </StackPanel>
                
                <CheckBox Content="Show Combat Tooltips" IsChecked="{Binding ShowCombatTooltips}" Margin="0,8,0,0" />
                <CheckBox Content="Show Tutorial Hints" IsChecked="{Binding ShowTutorialHints}" />
                <CheckBox Content="Confirm Before Dangerous Actions" IsChecked="{Binding ConfirmDangerousActions}" />
            </StackPanel>
        </DataTemplate>
        
        <!-- Controls Tab -->
        <DataTemplate DataType="vm:ControlsSettingsTabViewModel">
            <Grid RowDefinitions="Auto,*,Auto">
                <TextBlock Grid.Row="0" Text="CONTROLS" FontSize="16" FontWeight="Bold" Margin="0,0,0,16" />
                
                <ScrollViewer Grid.Row="1">
                    <StackPanel Spacing="16">
                        <TextBlock Text="GLOBAL" FontWeight="SemiBold" />
                        <ItemsControl ItemsSource="{Binding GlobalBindings}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,80,80" Margin="0,4">
                                        <TextBlock Grid.Column="0" Text="{Binding ActionName}" VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentKey}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        <Button Grid.Column="2" Content="Rebind" Command="{Binding RebindCommand}" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <TextBlock Text="GAME" FontWeight="SemiBold" Margin="0,8,0,0" />
                        <ItemsControl ItemsSource="{Binding GameBindings}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="*,80,80" Margin="0,4">
                                        <TextBlock Grid.Column="0" Text="{Binding ActionName}" VerticalAlignment="Center" />
                                        <TextBlock Grid.Column="1" Text="{Binding CurrentKey}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        <Button Grid.Column="2" Content="Rebind" Command="{Binding RebindCommand}" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
                
                <Button Grid.Row="2" Content="Reset to Defaults" Command="{Binding ResetToDefaultsCommand}" 
                        HorizontalAlignment="Center" Margin="0,16,0,0" />
            </Grid>
        </DataTemplate>
    </Window.DataTemplates>
    
    <Grid RowDefinitions="*,Auto">
        
        <!-- Tab Content -->
        <Grid Grid.Row="0" ColumnDefinitions="150,*">
            
            <!-- Tab List -->
            <ListBox Grid.Column="0" SelectedIndex="{Binding SelectedTabIndex}" Background="#1E1E1E">
                <ListBoxItem Content="Audio" Padding="16,12" />
                <ListBoxItem Content="Display" Padding="16,12" />
                <ListBoxItem Content="Gameplay" Padding="16,12" />
                <ListBoxItem Content="Controls" Padding="16,12" />
            </ListBox>
            
            <!-- Tab Panel Content -->
            <Border Grid.Column="1" Background="#252526" Padding="24">
                <ContentControl Content="{Binding CurrentTab}" />
            </Border>
        </Grid>
        
        <!-- Button Row -->
        <Border Grid.Row="1" Background="#2D2D2D" BorderThickness="0,1,0,0" BorderBrush="#333333" Padding="16">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
                <Button Content="Apply" Command="{Binding ApplyCommand}" IsEnabled="{Binding HasChanges}" />
                <Button Content="Cancel" Command="{Binding CancelCommand}" />
                <Button Content="OK" Command="{Binding OkCommand}" Background="#3F51B5" />
            </StackPanel>
        </Border>
        
    </Grid>
</Window>
