# v0.14.7a Design Specification: Sensory Descriptor Schema

**Version:** 0.14.7a
**Parent:** v0.14.7 (Descriptor Configuration Schemas)
**Prerequisites:** v0.14.6 Complete (Audio Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Descriptor Schema Root Definition](#4-descriptor-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [Category and Pools Structure](#42-category-and-pools-structure)
5. [DescriptorPool Definition](#5-descriptorpool-definition)
   - 5.1 [Pool Properties](#51-pool-properties)
   - 5.2 [Pool Naming Conventions](#52-pool-naming-conventions)
6. [Descriptor Definition](#6-descriptor-definition)
   - 6.1 [Core Properties](#61-core-properties)
   - 6.2 [Weight Configuration](#62-weight-configuration)
   - 6.3 [Context Tags](#63-context-tags)
   - 6.4 [Theme Tags](#64-theme-tags)
   - 6.5 [Conditional Properties](#65-conditional-properties)
7. [Variable Substitution](#7-variable-substitution)
   - 7.1 [Variable Pattern Syntax](#71-variable-pattern-syntax)
   - 7.2 [Common Variables](#72-common-variables)
   - 7.3 [Variable Documentation](#73-variable-documentation)
8. [Weighted Selection System](#8-weighted-selection-system)
   - 8.1 [Weight Calculation](#81-weight-calculation)
   - 8.2 [Probability Distribution](#82-probability-distribution)
9. [Validation Rules](#9-validation-rules)
   - 9.1 [ID Pattern Validation](#91-id-pattern-validation)
   - 9.2 [Weight Validation](#92-weight-validation)
   - 9.3 [Percentage Range Validation](#93-percentage-range-validation)
   - 9.4 [Required Fields](#94-required-fields)
10. [Configuration Schema](#10-configuration-schema)
11. [Configuration File Examples](#11-configuration-file-examples)
12. [Data Model Changes](#12-data-model-changes)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Use Cases](#15-use-cases)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies](#18-dependencies)
19. [Future Considerations](#19-future-considerations)
20. [Appendix: Schema Validation Examples](#20-appendix-schema-validation-examples)

---

## 1. Executive Summary

Version 0.14.7a introduces the **Sensory Descriptor Schema** (`descriptors.schema.json`), which serves as the master schema for all text descriptor configuration files. This schema validates pool structure, weighted selection, context tags, theme tags, and variable substitution patterns used throughout the game's descriptive text system.

The Sensory Descriptor Schema validates 17 existing descriptor configuration files including combat-hits, combat-deaths, environmental, weather, and ambient-events. It establishes the foundational patterns that will be extended by combat-descriptors (v0.14.7b) and environment-descriptors (v0.14.7c) schemas.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `descriptors.schema.json` |
| **Schema Definitions** | `DescriptorPool`, `Descriptor`, `WeightedText`, `VariablePattern` |
| **Configuration Files** | Base schema referenced by all descriptor files |
| **Tests** | ~6 new unit tests |

### Architectural Significance

This version provides:
- **Flexible pool system** - Dynamic pool names via additionalProperties
- **Weighted selection** - Probability-based text selection via weight values
- **Context filtering** - Tags for biome, location, and situation filtering
- **Theme filtering** - Tags for genre and mood customization
- **Variable substitution** - `{placeholder}` syntax for dynamic text
- **Conditional properties** - Damage/health percentage thresholds for contextual text

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  v0.14.7 DESCRIPTOR CONFIGURATION SCHEMAS                    │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.7a: descriptors.schema.json ◀── THIS VERSION (MASTER SCHEMA)    │
  │  v0.14.7b: combat-descriptors.schema.json (extends master)             │
  │  v0.14.7c: environment-descriptors.schema.json (extends master)        │
  └─────────────────────────────────────────────────────────────────────────┘

  Configuration Files Using This Schema:
  ├── config/descriptors/combat-hits.json (11 pools)
  ├── config/descriptors/combat-deaths.json (10 pools)
  ├── config/descriptors/environmental.json (4 pools)
  ├── config/descriptors/weather.json (10 pools)
  ├── config/descriptors/ambient-events.json (15 pools)
  └── ... (12 additional descriptor files)

  Shared Definitions:
  • Category ID pattern: ^[a-z][a-z0-9-]*$ (lowercase kebab-case)
  • Pool/Descriptor ID pattern: ^[a-z][a-z0-9_]*$ (lowercase with underscores)
  • Schema location: config/schemas/
  • Weight: positive integers (default: 100)
```

---

## 2. Feature Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SENSORY DESCRIPTOR SCHEMA FEATURE TREE                    │
└─────────────────────────────────────────────────────────────────────────────┘

descriptors.schema.json
├── Root Configuration
│   ├── $schema reference
│   ├── version (optional)
│   ├── category (kebab-case identifier)
│   └── pools object
│
├── DescriptorPool
│   ├── id (lowercase with underscores)
│   ├── name (display name)
│   ├── description (optional)
│   └── descriptors[] (array of Descriptor)
│
├── Descriptor
│   ├── Core Properties
│   │   ├── id (lowercase with underscores)
│   │   ├── text (descriptor content)
│   │   └── weight (positive integer, default: 100)
│   │
│   ├── Filter Properties
│   │   ├── tags[] (context filters)
│   │   └── themes[] (genre filters)
│   │
│   ├── Conditional Properties
│   │   ├── minDamagePercent (0-1)
│   │   ├── maxDamagePercent (0-1)
│   │   ├── minHealthPercent (0-1)
│   │   └── maxHealthPercent (0-1)
│   │
│   ├── Variable Properties
│   │   ├── variables[] (documents placeholders)
│   │   └── fallbackId (alternative if conditions fail)
│   │
│   └── Variable Substitution
│       └── {placeholder} syntax in text
│
└── VariablePattern (documentation)
    ├── pattern regex
    └── description
```

---

## 3. Architecture Diagrams

### 3.1 Descriptor Configuration Structure

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      DESCRIPTOR CONFIGURATION STRUCTURE                      │
└─────────────────────────────────────────────────────────────────────────────┘

                           descriptor-file.json
                 ┌──────────────────────────────────────┐
                 │  $schema: reference                  │
                 │  version: "1.0.0" (optional)         │
                 │  category: "combat-hits"             │
                 │  pools: { ... }                      │
                 └──────────────┬───────────────────────┘
                                │
        ┌───────────────────────┴───────────────────────────┐
        │                                                   │
        ▼                                                   ▼
┌───────────────────────────┐                  ┌───────────────────────────┐
│         pools             │                  │     (future) metadata     │
│───────────────────────────│                  │───────────────────────────│
│ "hit_sword": DescriptorPool│                 │ author, version, etc.     │
│ "hit_axe": DescriptorPool  │                 │ (not in current scope)    │
│ "critical_hit": DescriptorPool│              └───────────────────────────┘
│ "miss_descriptions": ...   │
│ ... (extensible)           │
└───────────────┬────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DescriptorPool                                    │
│─────────────────────────────────────────────────────────────────────────────│
│  id: "hit_sword"                                                            │
│  name: "Sword Hit Descriptions"                                             │
│  description: "Descriptions for sword attack hits" (optional)               │
│  descriptors: [                                                             │
│    Descriptor,                                                              │
│    Descriptor,                                                              │
│    ... (at least 1)                                                         │
│  ]                                                                          │
└───────────────┬─────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Descriptor                                      │
│─────────────────────────────────────────────────────────────────────────────│
│  id: "slashes_across"                                                       │
│  text: "slashes across"                                                     │
│  weight: 25                                                                 │
│  tags: ["melee", "sword"] (optional)                                        │
│  themes: ["dark_fantasy", "action"] (optional)                              │
│  minDamagePercent: 0.25 (optional)                                          │
│  maxDamagePercent: 0.75 (optional)                                          │
│  variables: ["target"] (optional)                                           │
│  fallbackId: "generic_hit" (optional)                                       │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Descriptor Selection Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         DESCRIPTOR SELECTION FLOW                            │
└─────────────────────────────────────────────────────────────────────────────┘

                    Request Descriptor (poolId, context)
                              │
                              ▼
                  ┌───────────────────────┐
                  │ Load pool by poolId   │
                  └───────────┬───────────┘
                              │
                              ▼
                  ┌───────────────────────┐
                  │ Pool found?           │
                  └───────────┬───────────┘
                              │
              ┌───────────────┴───────────────┐
              │ No                            │ Yes
              ▼                               ▼
    ┌───────────────────┐         ┌───────────────────────┐
    │ Log warning       │         │ Filter by tags        │
    │ Return empty      │         │ (match context)       │
    └───────────────────┘         └───────────┬───────────┘
                                              │
                                              ▼
                                  ┌───────────────────────┐
                                  │ Filter by themes      │
                                  │ (match current theme) │
                                  └───────────┬───────────┘
                                              │
                                              ▼
                                  ┌───────────────────────┐
                                  │ Filter by conditions  │
                                  │ (damage%, health%)    │
                                  └───────────┬───────────┘
                                              │
                                              ▼
                                  ┌───────────────────────┐
                                  │ Calculate weights     │
                                  │ for remaining items   │
                                  └───────────┬───────────┘
                                              │
                                              ▼
                                  ┌───────────────────────┐
                                  │ Random weighted       │
                                  │ selection             │
                                  └───────────┬───────────┘
                                              │
                                              ▼
                                  ┌───────────────────────┐
                                  │ Substitute variables  │
                                  │ {player} → "John"     │
                                  └───────────┬───────────┘
                                              │
                                              ▼
                                  ┌───────────────────────┐
                                  │ Return final text     │
                                  └───────────────────────┘
```

### 3.3 Schema Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           SCHEMA LAYER DIAGRAM                               │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              PRESENTATION                                    │
│                                                                              │
│  Game renders descriptive text based on context                              │
│  • Combat hit descriptions                                                   │
│  • Death descriptions                                                        │
│  • Environmental atmosphere                                                  │
│  • Weather conditions                                                        │
│  • Ambient events                                                            │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              APPLICATION                                     │
│                                                                              │
│  DescriptorService loads and selects descriptive text                        │
│  • GetPool(category, poolId) → DescriptorPool?                               │
│  • SelectDescriptor(poolId, context) → string                                │
│  • GetAllPools(category) → IEnumerable<DescriptorPool>                       │
│  • FilterByTags(descriptors, tags) → IEnumerable<Descriptor>                 │
│  • ApplyWeightedSelection(descriptors) → Descriptor                          │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             DOMAIN LAYER                                     │
│                                                                              │
│  Descriptor definitions loaded from JSON                                     │
│  • DescriptorPool (id, name, descriptors array)                              │
│  • Descriptor (id, text, weight, tags, themes, conditions)                   │
│  • VariableContext (player, target, weapon, damage, etc.)                    │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           INFRASTRUCTURE                                     │
│                                                                              │
│  DescriptorProvider loads from JSON with schema validation                   │
│  • LoadDescriptors(category) → reads config/descriptors/{category}.json      │
│  • Validates against config/schemas/descriptors.schema.json                  │
│  • Caches loaded definitions for performance                                 │
│  • Logs warnings for invalid entries                                         │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIGURATION                                     │
│                                                                              │
│  config/schemas/descriptors.schema.json                                      │
│  config/descriptors/combat-hits.json                                         │
│  config/descriptors/combat-deaths.json                                       │
│  config/descriptors/environmental.json                                       │
│  config/descriptors/weather.json                                             │
│  config/descriptors/ambient-events.json                                      │
│  ... (17 total descriptor files)                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Category Organization

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          CATEGORY ORGANIZATION                               │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
  │   combat-hits   │    │  combat-deaths  │    │  environmental  │
  ├─────────────────┤    ├─────────────────┤    ├─────────────────┤
  │ hit_sword       │    │ death_humanoid  │    │ lighting        │
  │ hit_axe         │    │ death_undead    │    │ sounds          │
  │ hit_bow         │    │ death_beast     │    │ smells          │
  │ hit_staff       │    │ death_construct │    │ temperature     │
  │ hit_dagger      │    │ death_elemental │    └─────────────────┘
  │ hit_fist        │    │ death_demon     │
  │ hit_mace        │    │ critical_kill   │    ┌─────────────────┐
  │ hit_spear       │    │ player_death    │    │     weather     │
  │ critical_hit    │    │ near_death_warn │    ├─────────────────┤
  │ miss_descriptn  │    │ near_death_crit │    │ weather_rain_in │
  │ fumble_descrip  │    └─────────────────┘    │ weather_rain_out│
  └─────────────────┘                           │ weather_storm_in│
                                                │ weather_storm_o │
  ┌─────────────────┐                           │ weather_snow_in │
  │  ambient-events │                           │ weather_snow_out│
  ├─────────────────┤                           │ weather_fog_in  │
  │ sound           │                           │ weather_fog_out │
  │ sound_cave      │                           │ weather_wind_in │
  │ sound_dungeon   │                           │ weather_wind_out│
  │ sound_forest    │                           └─────────────────┘
  │ visual          │
  │ visual_volcanic │
  │ visual_ruins    │
  │ creature        │
  │ creature_cave   │
  │ creature_swamp  │
  │ creature_forest │
  │ environmental   │
  │ env_frozen      │
  │ env_volcanic    │
  │ env_swamp       │
  └─────────────────┘

  Note: Pool names use underscores (snake_case).
        Category names use hyphens (kebab-case).
```

---

## 4. Descriptor Schema Root Definition

### 4.1 Root Configuration Properties

The root schema defines the top-level structure of all descriptor configuration files.

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `$schema` | string | No | - | Reference to the JSON schema for validation |
| `version` | string | No | - | Configuration file version for compatibility |
| `category` | string | **Yes** | - | Category identifier (kebab-case pattern) |
| `pools` | object | **Yes** | - | Object containing descriptor pools (additionalProperties) |

### 4.2 Category and Pools Structure

The `category` property identifies the type of descriptors in the file. It must follow kebab-case naming.

```
category: "combat-hits"      // Combat attack descriptions
category: "combat-deaths"    // Death descriptions
category: "environmental"    // Sensory atmosphere
category: "weather"          // Weather conditions
category: "ambient"          // Ambient events
```

The `pools` property uses `additionalProperties` to allow flexible pool names. Each property key is the pool ID (lowercase with underscores), and the value is a `DescriptorPool` object.

```
pools: {
  "hit_sword": DescriptorPool,       // Sword attack pool
  "hit_axe": DescriptorPool,         // Axe attack pool
  "critical_hit": DescriptorPool,    // Critical hit pool
  "miss_descriptions": DescriptorPool // Miss pool
}
```

---

## 5. DescriptorPool Definition

### 5.1 Pool Properties

Each descriptor pool groups related text descriptors together.

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `id` | string | **Yes** | - | Pool identifier (lowercase with underscores) |
| `name` | string | **Yes** | - | Human-readable display name |
| `description` | string | No | - | Optional description of the pool's purpose |
| `descriptors` | array | **Yes** | - | Array of Descriptor objects (minItems: 1) |

### 5.2 Pool Naming Conventions

Pool IDs follow specific naming patterns based on their content type:

| Pattern | Example | Description |
|---------|---------|-------------|
| `hit_<weapon>` | `hit_sword`, `hit_axe` | Weapon hit descriptions |
| `death_<type>` | `death_humanoid`, `death_undead` | Death by creature type |
| `weather_<type>_<location>` | `weather_rain_indoor` | Weather by type and location |
| `<sense>_<biome>` | `sound_cave`, `visual_ruins` | Ambient by sense and biome |
| `<type>` | `lighting`, `smells` | Generic sensory pool |

---

## 6. Descriptor Definition

### 6.1 Core Properties

Each descriptor defines a single text entry with selection parameters.

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `id` | string | **Yes** | - | Descriptor identifier (lowercase with underscores) |
| `text` | string | **Yes** | - | The descriptive text content |
| `weight` | integer | No | 100 | Selection weight for probability (≥1) |

### 6.2 Weight Configuration

Weight determines the relative probability of selection compared to other descriptors in the pool.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          WEIGHT CONFIGURATION                                │
└─────────────────────────────────────────────────────────────────────────────┘

  Default Weight: 100
  ═══════════════════
  When weight is not specified, default value is 100.
  This creates equal probability baseline.

  Weight Distribution Example:
  ════════════════════════════
  Pool with 3 descriptors:
  • descriptor_a: weight 50  →  50/100 = 50% chance
  • descriptor_b: weight 30  →  30/100 = 30% chance
  • descriptor_c: weight 20  →  20/100 = 20% chance
                             ─────────
                  Total:        100%

  Typical Weight Values (from existing configs):
  ══════════════════════════════════════════════
  • 10-15:  Rare/dramatic text (used sparingly)
  • 20-25:  Common text (frequent selection)
  • 30-35:  Very common text (default choice)
  • 100:    Default equal weight
```

### 6.3 Context Tags

Tags filter descriptors based on game context. Multiple tags create AND conditions when filtering.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `tags` | array | No | Array of context filter strings |

**Tag Categories:**

| Tag Category | Example Tags | Use Case |
|--------------|--------------|----------|
| Location | `indoor`, `outdoor`, `underground` | Filter by area type |
| Biome | `cave`, `dungeon`, `forest`, `swamp`, `volcanic`, `frozen` | Filter by environment |
| Mood | `danger`, `safe`, `atmospheric`, `magical` | Filter by situation |
| Type | `creature`, `natural`, `supernatural` | Filter by source |

### 6.4 Theme Tags

Themes filter descriptors based on the game's genre/mood setting.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `themes` | array | No | Array of genre/mood filter strings |

**Theme Values:**

| Theme | Description | Typical Use |
|-------|-------------|-------------|
| `dark_fantasy` | Grim, mature tone | Default game setting |
| `high_fantasy` | Heroic, bright tone | Alternative mood |
| `horror` | Scary, unsettling | Fear-focused areas |

### 6.5 Conditional Properties

Conditional properties restrict when a descriptor can be selected based on numeric thresholds.

| Property | Type | Required | Range | Description |
|----------|------|----------|-------|-------------|
| `minDamagePercent` | number | No | 0-1 | Minimum damage percentage required |
| `maxDamagePercent` | number | No | 0-1 | Maximum damage percentage allowed |
| `minHealthPercent` | number | No | 0-1 | Minimum health percentage required |
| `maxHealthPercent` | number | No | 0-1 | Maximum health percentage allowed |
| `fallbackId` | string | No | - | Alternative descriptor if conditions not met |

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        CONDITIONAL PROPERTIES USAGE                          │
└─────────────────────────────────────────────────────────────────────────────┘

  Damage-Based Selection:
  ═══════════════════════
  • minDamagePercent: 0.5 → Only when damage ≥ 50% of max damage
  • maxDamagePercent: 0.25 → Only when damage ≤ 25% of max damage

  Example:
  ─────────
  {
    "id": "cleaves_through",
    "text": "cleaves through",
    "weight": 15,
    "minDamagePercent": 0.5    // Heavy hit text
  }

  {
    "id": "grazes",
    "text": "grazes",
    "weight": 20,
    "maxDamagePercent": 0.25   // Light hit text
  }

  Health-Based Selection:
  ═══════════════════════
  • minHealthPercent: 0.75 → Only when target health ≥ 75%
  • maxHealthPercent: 0.25 → Only when target health ≤ 25%

  Example (near death warnings):
  ───────────────────────────────
  {
    "id": "barely_standing",
    "text": "barely standing, gasping for breath",
    "weight": 30,
    "maxHealthPercent": 0.1    // Critical health text
  }
```

---

## 7. Variable Substitution

### 7.1 Variable Pattern Syntax

Variable substitution uses curly brace syntax `{variableName}` for dynamic text replacement.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       VARIABLE PATTERN SYNTAX                                │
└─────────────────────────────────────────────────────────────────────────────┘

  Pattern: \{[a-zA-Z][a-zA-Z0-9_]*\}

  Valid Examples:
  ═══════════════
  • {player}           → Player character name
  • {killer}           → Entity that caused death
  • {target}           → Target of action
  • {weapon}           → Weapon name
  • {damage}           → Damage amount

  In Text:
  ═════════
  "{player} has fallen in battle against the {killer}..."
  ↓ substitution with context {player: "John", killer: "Goblin"}
  "John has fallen in battle against the Goblin..."
```

### 7.2 Common Variables

| Variable | Context | Example Value | Description |
|----------|---------|---------------|-------------|
| `{player}` | Combat, death | "John" | Player character name |
| `{killer}` | Death | "the Goblin" | Entity that killed the target |
| `{target}` | Combat | "the Skeleton" | Target of the action |
| `{weapon}` | Combat | "Iron Sword" | Weapon used in attack |
| `{damage}` | Combat | "15" | Damage amount dealt |
| `{attacker}` | Combat | "the Orc" | Entity performing attack |
| `{ability}` | Abilities | "Fireball" | Ability name used |

### 7.3 Variable Documentation

The optional `variables` array documents which placeholders are expected in the text.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `variables` | array | No | Array of variable names used in text |

```json
{
  "id": "falls_battle",
  "text": "{player} has fallen in battle against the {killer}...",
  "weight": 25,
  "variables": ["player", "killer"]
}
```

---

## 8. Weighted Selection System

### 8.1 Weight Calculation

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          WEIGHT CALCULATION                                  │
└─────────────────────────────────────────────────────────────────────────────┘

  STEP 1: Filter descriptors by context
  ══════════════════════════════════════
  Remove descriptors that don't match:
  • Tags not matching current context
  • Themes not matching current theme
  • Damage/health conditions not met

  STEP 2: Calculate total weight
  ════════════════════════════════
  totalWeight = sum of all remaining descriptor weights

  STEP 3: Generate random value
  ════════════════════════════════
  randomValue = random(0, totalWeight)

  STEP 4: Select descriptor
  ════════════════════════════════
  runningTotal = 0
  for each descriptor:
    runningTotal += descriptor.weight
    if randomValue < runningTotal:
      return descriptor
```

### 8.2 Probability Distribution

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       PROBABILITY DISTRIBUTION                               │
└─────────────────────────────────────────────────────────────────────────────┘

  Example Pool: hit_sword
  ═══════════════════════

  ┌────────────────────┬────────┬─────────────┐
  │ Descriptor         │ Weight │ Probability │
  ├────────────────────┼────────┼─────────────┤
  │ slashes_across     │   25   │    25%      │
  │ cuts_into          │   20   │    20%      │
  │ strikes            │   30   │    30%      │
  │ cleaves_through    │   15   │    15%      │ (min 50% damage)
  │ grazes             │   10   │    10%      │ (max 25% damage)
  ├────────────────────┼────────┼─────────────┤
  │ Total              │  100   │   100%      │
  └────────────────────┴────────┴─────────────┘

  Visual Representation:
  ══════════════════════

  0%                    25%     45%           75%    90%  100%
  ├──────────────────────┼───────┼─────────────┼──────┼─────┤
  │   slashes_across     │cuts   │   strikes   │cleave│graze│
  └──────────────────────┴───────┴─────────────┴──────┴─────┘

  Note: If damage conditions filter out "cleaves_through" and "grazes",
        remaining weights are recalculated:

  ┌────────────────────┬────────┬─────────────┐
  │ Descriptor         │ Weight │ Probability │
  ├────────────────────┼────────┼─────────────┤
  │ slashes_across     │   25   │    33%      │
  │ cuts_into          │   20   │    27%      │
  │ strikes            │   30   │    40%      │
  ├────────────────────┼────────┼─────────────┤
  │ Total              │   75   │   100%      │
  └────────────────────┴────────┴─────────────┘
```

---

## 9. Validation Rules

### 9.1 ID Pattern Validation

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          ID PATTERN VALIDATION                               │
└─────────────────────────────────────────────────────────────────────────────┘

  Category ID Pattern: ^[a-z][a-z0-9-]*$
  ══════════════════════════════════════
  • Starts with lowercase letter
  • Contains lowercase letters, numbers, hyphens
  • kebab-case format

  ✓ Valid:     combat-hits, environmental, ambient-events, weather
  ✗ Invalid:   Combat-Hits, combat_hits, 1-combat, -combat

  Pool/Descriptor ID Pattern: ^[a-z][a-z0-9_]*$
  ══════════════════════════════════════════════
  • Starts with lowercase letter
  • Contains lowercase letters, numbers, underscores
  • snake_case format

  ✓ Valid:     hit_sword, death_humanoid, weather_rain_indoor, slashes_across
  ✗ Invalid:   Hit_Sword, hit-sword, 1_hit, _hit
```

### 9.2 Weight Validation

| Rule | Constraint | Notes |
|------|------------|-------|
| Type | integer | Must be whole number |
| Minimum | 1 | Cannot be zero or negative |
| Default | 100 | Applied when not specified |

### 9.3 Percentage Range Validation

| Field | Minimum | Maximum | Notes |
|-------|---------|---------|-------|
| `minDamagePercent` | 0 | 1 | Normalized percentage |
| `maxDamagePercent` | 0 | 1 | Normalized percentage |
| `minHealthPercent` | 0 | 1 | Normalized percentage |
| `maxHealthPercent` | 0 | 1 | Normalized percentage |

### 9.4 Required Fields

| Level | Required Fields |
|-------|-----------------|
| Root | `category`, `pools` |
| DescriptorPool | `id`, `name`, `descriptors` |
| Descriptor | `id`, `text` |

---

## 10. Configuration Schema

### Complete `descriptors.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://rune-game.com/schemas/descriptors.schema.json",
  "title": "Descriptor Configuration",
  "description": "Master schema for text descriptor pools with weighted selection, context tags, themes, and variable substitution",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema for validation"
    },
    "version": {
      "type": "string",
      "description": "Configuration file version for compatibility tracking"
    },
    "category": {
      "type": "string",
      "description": "Category identifier for this descriptor file (kebab-case)",
      "pattern": "^[a-z][a-z0-9-]*$",
      "minLength": 1
    },
    "pools": {
      "type": "object",
      "description": "Descriptor pools organized by pool ID",
      "additionalProperties": {
        "$ref": "#/definitions/DescriptorPool"
      },
      "minProperties": 1
    }
  },
  "required": ["category", "pools"],
  "additionalProperties": false,
  "definitions": {
    "DescriptorPool": {
      "type": "object",
      "description": "A pool of related text descriptors",
      "properties": {
        "id": {
          "type": "string",
          "description": "Pool identifier (lowercase with underscores)",
          "pattern": "^[a-z][a-z0-9_]*$",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "description": "Human-readable display name for the pool",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Optional description of the pool's purpose"
        },
        "descriptors": {
          "type": "array",
          "description": "Array of text descriptors in this pool",
          "items": {
            "$ref": "#/definitions/Descriptor"
          },
          "minItems": 1
        }
      },
      "required": ["id", "name", "descriptors"],
      "additionalProperties": false
    },
    "Descriptor": {
      "type": "object",
      "description": "A single text descriptor with selection parameters",
      "properties": {
        "id": {
          "type": "string",
          "description": "Descriptor identifier (lowercase with underscores)",
          "pattern": "^[a-z][a-z0-9_]*$",
          "minLength": 1
        },
        "text": {
          "type": "string",
          "description": "The descriptive text content (may contain {variable} placeholders)",
          "minLength": 1
        },
        "weight": {
          "type": "integer",
          "description": "Selection weight for probability (higher = more likely)",
          "minimum": 1,
          "default": 100
        },
        "tags": {
          "type": "array",
          "description": "Context filter tags (location, biome, mood, type)",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true
        },
        "themes": {
          "type": "array",
          "description": "Genre/mood filter tags (dark_fantasy, high_fantasy, horror)",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true
        },
        "minDamagePercent": {
          "type": "number",
          "description": "Minimum damage percentage required (0-1)",
          "minimum": 0,
          "maximum": 1
        },
        "maxDamagePercent": {
          "type": "number",
          "description": "Maximum damage percentage allowed (0-1)",
          "minimum": 0,
          "maximum": 1
        },
        "minHealthPercent": {
          "type": "number",
          "description": "Minimum health percentage required (0-1)",
          "minimum": 0,
          "maximum": 1
        },
        "maxHealthPercent": {
          "type": "number",
          "description": "Maximum health percentage allowed (0-1)",
          "minimum": 0,
          "maximum": 1
        },
        "variables": {
          "type": "array",
          "description": "Documents variable placeholders used in text",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true
        },
        "fallbackId": {
          "type": "string",
          "description": "Alternative descriptor ID if conditions not met",
          "pattern": "^[a-z][a-z0-9_]*$"
        }
      },
      "required": ["id", "text"],
      "additionalProperties": false
    },
    "VariablePattern": {
      "type": "object",
      "description": "Documentation for variable substitution patterns",
      "properties": {
        "pattern": {
          "type": "string",
          "description": "Regex pattern for variable syntax",
          "default": "\\{[a-zA-Z][a-zA-Z0-9_]*\\}"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the pattern"
        }
      }
    }
  }
}
```

---

## 11. Configuration File Examples

### Example: combat-hits.json Structure

```json
{
  "$schema": "./schemas/descriptors.schema.json",
  "category": "combat-hits",
  "pools": {
    "hit_sword": {
      "id": "hit_sword",
      "name": "Sword Hit Descriptions",
      "description": "Descriptions for successful sword attack hits",
      "descriptors": [
        {
          "id": "slashes_across",
          "text": "slashes across",
          "weight": 25
        },
        {
          "id": "cuts_into",
          "text": "cuts into",
          "weight": 20
        },
        {
          "id": "strikes",
          "text": "strikes",
          "weight": 30
        },
        {
          "id": "cleaves_through",
          "text": "cleaves through",
          "weight": 15,
          "minDamagePercent": 0.5
        },
        {
          "id": "grazes",
          "text": "grazes",
          "weight": 10,
          "maxDamagePercent": 0.25
        }
      ]
    },
    "critical_hit": {
      "id": "critical_hit",
      "name": "Critical Hit Descriptions",
      "descriptors": [
        {
          "id": "devastating_blow",
          "text": "lands a devastating blow on",
          "weight": 25
        },
        {
          "id": "finds_weakness",
          "text": "finds a critical weakness in",
          "weight": 25
        }
      ]
    }
  }
}
```

### Example: environmental.json Structure

```json
{
  "$schema": "./schemas/descriptors.schema.json",
  "category": "environmental",
  "pools": {
    "lighting": {
      "id": "lighting",
      "name": "Lighting Descriptions",
      "descriptors": [
        {
          "id": "dim_torch",
          "text": "dimly lit by flickering torches",
          "weight": 20,
          "tags": ["indoor", "dungeon"],
          "themes": ["dark_fantasy", "horror"]
        },
        {
          "id": "bright_daylight",
          "text": "bathed in bright sunlight",
          "weight": 25,
          "tags": ["outdoor"],
          "themes": ["high_fantasy"]
        }
      ]
    },
    "sounds": {
      "id": "sounds",
      "name": "Ambient Sound Descriptions",
      "descriptors": [
        {
          "id": "dripping_water",
          "text": "The sound of dripping water echoes",
          "weight": 20,
          "tags": ["cave", "dungeon"]
        }
      ]
    }
  }
}
```

### Example: combat-deaths.json with Variables

```json
{
  "$schema": "./schemas/descriptors.schema.json",
  "category": "combat-deaths",
  "pools": {
    "player_death": {
      "id": "player_death",
      "name": "Player Death Descriptions",
      "descriptors": [
        {
          "id": "falls_battle",
          "text": "{player} has fallen in battle against the {killer}...",
          "weight": 25,
          "variables": ["player", "killer"]
        },
        {
          "id": "overwhelmed",
          "text": "{player} was overwhelmed by {killer}'s relentless assault...",
          "weight": 20,
          "variables": ["player", "killer"]
        }
      ]
    }
  }
}
```

---

## 12. Data Model Changes

### Schema Definitions Summary

This version introduces JSON Schema definitions only—no C# domain entities. Future runtime implementation would include:

| Component | Type | Purpose |
|-----------|------|---------|
| `DescriptorPool` | Value Object | Pool containing related descriptors |
| `Descriptor` | Value Object | Single text entry with selection parameters |
| `VariableContext` | Value Object | Runtime variable values for substitution |

### No Cross-Reference Changes

The descriptor schema is self-contained. Descriptors reference other descriptors via `fallbackId` within the same file.

---

## 13. Logging Specifications

### Schema Validation Logging

| Event | Level | Message Format |
|-------|-------|----------------|
| Schema loaded | INFO | `Descriptor schema loaded from {path}` |
| Validation success | DEBUG | `Descriptor file validated ({category}: {poolCount} pools, {descriptorCount} descriptors)` |
| Validation failure | ERROR | `Descriptor configuration validation failed: {errors}` |
| Missing required | WARN | `Descriptor pool {poolId}: missing required field {field}` |
| Invalid pattern | WARN | `Descriptor {poolId}/{descriptorId}: ID does not match pattern` |
| Empty descriptors | ERROR | `Descriptor pool {poolId}: descriptors array must have at least 1 item` |
| Invalid weight | WARN | `Descriptor {poolId}/{descriptorId}: weight must be positive integer` |
| Invalid range | WARN | `Descriptor {poolId}/{descriptorId}: {field} value {value} outside valid range` |

### Runtime Logging (Future)

| Event | Level | Message Format |
|-------|-------|----------------|
| Pool loaded | DEBUG | `Loaded descriptor pool {category}/{poolId} with {count} descriptors` |
| Selection made | DEBUG | `Selected descriptor {descriptorId} from pool {poolId} (weight: {weight})` |
| Filtered empty | WARN | `Pool {poolId} has no descriptors matching context` |
| Variable missing | WARN | `Variable {varName} not provided for descriptor {descriptorId}` |
| Fallback used | DEBUG | `Descriptor {descriptorId} conditions not met, using fallback {fallbackId}` |
| Fallback failed | WARN | `Descriptor {descriptorId} fallback {fallbackId} not found` |

---

## 14. Unit Testing Requirements

### Test Summary

| Test ID | Test Name | Description |
|---------|-----------|-------------|
| DSC-001 | ValidDescriptorConfiguration | Validates a complete configuration with all fields |
| DSC-002 | PoolStructureValidation | Validates pool additionalProperties structure |
| DSC-003 | DescriptorStructureValidation | Validates descriptor required/optional fields |
| DSC-004 | WeightValidation | Validates weight as positive integer |
| DSC-005 | PercentageRangeValidation | Validates damage/health percent ranges (0-1) |
| DSC-006 | IDPatternValidation | Validates category and pool/descriptor ID patterns |

### Test Specifications

#### DSC-001: ValidDescriptorConfiguration

```
Test: Valid complete descriptor configuration passes schema validation
Given: A descriptor JSON file with all required and optional fields populated correctly
When: Schema validation is performed
Then: Validation passes with no errors
And: All pools and descriptors are accessible
```

#### DSC-002: PoolStructureValidation

```
Test: Pool structure validates correctly with additionalProperties
Given: Descriptor configuration with various pool names
When: Schema validation is performed with pools:
  - "hit_sword" with id, name, descriptors → passes
  - "death_humanoid" with id, name, descriptors → passes
  - Pool missing "id" property → fails
  - Pool missing "name" property → fails
  - Pool missing "descriptors" property → fails
  - Pool with empty "descriptors" array → fails
Then: Valid pools pass, invalid structure fails
```

#### DSC-003: DescriptorStructureValidation

```
Test: Descriptor structure validates required and optional fields correctly
Given: Descriptor definitions with various configurations
When: Schema validation is performed:
  - { "id": "test", "text": "test text" } → passes (minimal)
  - { "id": "test", "text": "text", "weight": 25, "tags": ["indoor"] } → passes
  - { "id": "test" } → fails (missing text)
  - { "text": "test" } → fails (missing id)
  - { "id": "test", "text": "text", "unknownField": true } → fails
Then: Required fields enforced, optional fields allowed, unknown fields rejected
```

#### DSC-004: WeightValidation

```
Test: Weight values validate as positive integers
Given: Descriptors with various weight configurations
When: Schema validation is performed:
  - weight: 1 → passes (minimum)
  - weight: 100 → passes (default)
  - weight: 1000 → passes
  - weight: 0 → fails (below minimum)
  - weight: -1 → fails (negative)
  - weight: 1.5 → fails (not integer)
  - weight omitted → passes (uses default)
Then: Invalid weight values produce validation errors
```

#### DSC-005: PercentageRangeValidation

```
Test: Percentage values validate within 0-1 range
Given: Descriptors with various percentage configurations
When: Schema validation is performed:
  - minDamagePercent: 0 → passes (minimum)
  - minDamagePercent: 1 → passes (maximum)
  - minDamagePercent: 0.5 → passes
  - minDamagePercent: -0.1 → fails (below minimum)
  - minDamagePercent: 1.1 → fails (above maximum)
  - maxHealthPercent: 0.25 → passes
  - maxHealthPercent: 2.0 → fails (above maximum)
Then: Range violations produce validation errors
```

#### DSC-006: IDPatternValidation

```
Test: ID patterns validate correctly for category and pool/descriptor IDs
Given: Configurations with various ID formats
When: Schema validation is performed:
  - category: "combat-hits" → passes (kebab-case)
  - category: "environmental" → passes
  - category: "Combat-Hits" → fails (uppercase)
  - category: "combat_hits" → fails (underscore in category)
  - pool id: "hit_sword" → passes (snake_case)
  - pool id: "death_humanoid" → passes
  - pool id: "Hit_Sword" → fails (uppercase)
  - pool id: "hit-sword" → fails (hyphen in pool)
  - descriptor id: "slashes_across" → passes
  - descriptor id: "Slashes_Across" → fails (uppercase)
Then: Pattern violations produce validation errors
```

---

## 15. Use Cases

### UC-001: Load Descriptor Configuration

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-001: Load Descriptor Configuration                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Game startup or configuration reload                                │
│ Preconditions: Descriptor JSON files exist in config/descriptors directory   │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. System loads descriptors.schema.json                                      │
│ 2. System scans config/descriptors/ for JSON files                           │
│ 3. For each file, validate against schema                                    │
│ 4. Parse pools and descriptors into memory                                   │
│ 5. Log successful load with pool/descriptor counts                           │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Descriptor definitions available for text selection          │
│ Exceptions: Invalid JSON → log error, skip file                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-002: Select Descriptor by Pool

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-002: Select Descriptor by Pool                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Game event requiring descriptive text (attack, death, etc.)         │
│ Preconditions: Descriptor configuration loaded                               │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. System receives category and pool ID                                      │
│ 2. System looks up pool in configuration                                     │
│ 3. Filter descriptors by tags (if context provided)                          │
│ 4. Filter descriptors by themes (if theme active)                            │
│ 5. Filter descriptors by conditions (damage%, health%)                       │
│ 6. Calculate total weight of remaining descriptors                           │
│ 7. Perform weighted random selection                                         │
│ 8. Return selected descriptor text                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Appropriate descriptor text returned                         │
│ Exceptions: Pool not found → log warning, return empty string                │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-003: Apply Variable Substitution

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-003: Apply Variable Substitution                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Descriptor text contains {variable} placeholders                    │
│ Preconditions: Descriptor selected, variable context provided                │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Scan descriptor text for {placeholder} patterns                           │
│ 2. For each placeholder found:                                               │
│    a. Extract variable name from braces                                      │
│    b. Look up value in context dictionary                                    │
│    c. Replace placeholder with value                                         │
│ 3. Return fully substituted text                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Text with all variables replaced by values                   │
│ Exceptions: Variable not in context → log warning, leave placeholder         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-004: Filter Descriptors by Context

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-004: Filter Descriptors by Context                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Descriptor selection with context tags provided                     │
│ Preconditions: Pool loaded with tagged descriptors                           │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Receive context tags (e.g., ["indoor", "dungeon", "danger"])              │
│ 2. For each descriptor in pool:                                              │
│    a. If descriptor has no tags → include (matches all contexts)             │
│    b. If descriptor has tags → check if any match context tags               │
│    c. Include if at least one tag matches                                    │
│ 3. Return filtered list of descriptors                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Only contextually appropriate descriptors remain             │
│ Exceptions: No descriptors match → return all (fallback behavior)            │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-005: Apply Conditional Thresholds

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-005: Apply Conditional Thresholds                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Descriptor selection with damage or health context                  │
│ Preconditions: Pool loaded with conditional descriptors                      │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Receive current damage/health percentages                                 │
│ 2. For each descriptor in pool:                                              │
│    a. If minDamagePercent defined → check damage >= threshold                │
│    b. If maxDamagePercent defined → check damage <= threshold                │
│    c. If minHealthPercent defined → check health >= threshold                │
│    d. If maxHealthPercent defined → check health <= threshold                │
│    e. Include only if all conditions met                                     │
│ 3. Return filtered list of descriptors                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Only condition-appropriate descriptors remain                │
│ Exceptions: No descriptors match → use fallbackId if available               │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 16. Deliverable Checklist

### Configuration Files

| Status | File | Description |
|--------|------|-------------|
| ☐ | `config/schemas/descriptors.schema.json` | Master JSON Schema for descriptor validation |

### Unit Tests

| Status | Test | Description |
|--------|------|-------------|
| ☐ | DSC-001 | Valid complete descriptor configuration |
| ☐ | DSC-002 | Pool structure validation |
| ☐ | DSC-003 | Descriptor structure validation |
| ☐ | DSC-004 | Weight validation |
| ☐ | DSC-005 | Percentage range validation |
| ☐ | DSC-006 | ID pattern validation |

### Documentation

| Status | Document | Description |
|--------|----------|-------------|
| ☑ | Design Specification | This document |
| ☐ | Schema Documentation | Inline in schema file |

---

## 17. Acceptance Criteria

### Functional Criteria

- [ ] `descriptors.schema.json` created in `config/schemas/`
- [ ] Schema validates existing descriptor files without errors
- [ ] Category validated as lowercase kebab-case
- [ ] Pool IDs validated (lowercase with underscores allowed)
- [ ] Descriptor IDs validated (lowercase with underscores allowed)
- [ ] Weight validated as positive integer (minimum: 1)
- [ ] Tags validated as string array
- [ ] Themes validated as string array
- [ ] Damage/health percent ranges validated (0-1)
- [ ] Variable placeholders documented in schema
- [ ] ~6 unit tests pass

### Quality Criteria

- [ ] Schema follows JSON Schema Draft-07 specification
- [ ] All properties include descriptive comments
- [ ] Default values documented for optional fields
- [ ] Range constraints clearly specified
- [ ] Existing descriptor files validate without modification

### Integration Criteria

- [ ] Schema follows patterns from v0.14.6 schemas
- [ ] ID patterns consistent across all definitions
- [ ] Can be extended by v0.14.7b and v0.14.7c schemas

---

## 18. Dependencies

### Required From

| Version | Dependency | Usage |
|---------|------------|-------|
| v0.14.6 | Audio Configuration Schemas | Schema infrastructure patterns |
| Existing | `config/descriptors/*.json` | Configuration files to validate |

### Provides To

| Version | Consumer | Usage |
|---------|----------|-------|
| v0.14.7b | Combat Descriptor Schema | Base schema for extension |
| v0.14.7c | Environment Descriptor Schema | Base schema for extension |
| Future | DescriptorService | Descriptor data loading |
| Future | CombatService | Hit/death text selection |
| Future | EnvironmentService | Atmosphere text selection |

---

## 19. Future Considerations

### Deferred to Later Versions

| Feature | Rationale |
|---------|-----------|
| Combat-specific schema | v0.14.7b scope |
| Environment-specific schema | v0.14.7c scope |
| Descriptor selection logic | Runtime concern |
| Localization support | Future localization version |
| Hot-reload capability | Development tooling concern |

### Potential Enhancements

| Enhancement | Description |
|-------------|-------------|
| Descriptor inheritance | Allow descriptors to extend base definitions |
| Pool references | Allow pools to include descriptors from other pools |
| Weighted tag matching | Different weights for different tag matches |
| Time-based selection | Different descriptors for different times of day |
| Descriptor versioning | Track changes to descriptor text over time |
| A/B testing support | Split descriptor selection for testing |

---

## 20. Appendix: Schema Validation Examples

### Valid Pool (Minimal)

```json
{
  "id": "test_pool",
  "name": "Test Pool",
  "descriptors": [
    {
      "id": "test_descriptor",
      "text": "test text"
    }
  ]
}
```

### Valid Pool (Complete)

```json
{
  "id": "hit_sword",
  "name": "Sword Hit Descriptions",
  "description": "Descriptions for successful sword attacks",
  "descriptors": [
    {
      "id": "slashes_across",
      "text": "slashes across",
      "weight": 25,
      "tags": ["melee", "blade"],
      "themes": ["dark_fantasy", "action"]
    },
    {
      "id": "cleaves_through",
      "text": "cleaves through",
      "weight": 15,
      "minDamagePercent": 0.5,
      "tags": ["melee", "blade"],
      "themes": ["dark_fantasy"]
    },
    {
      "id": "grazes",
      "text": "grazes",
      "weight": 10,
      "maxDamagePercent": 0.25
    }
  ]
}
```

### Valid Descriptor with Variables

```json
{
  "id": "falls_battle",
  "text": "{player} has fallen in battle against the {killer}...",
  "weight": 25,
  "variables": ["player", "killer"],
  "themes": ["dark_fantasy", "horror"]
}
```

### Invalid Examples

```json
// Invalid: Missing category
{
  "pools": {
    "test_pool": { ... }
  }
}
// Error: Missing required property 'category'

// Invalid: Empty pools
{
  "category": "combat-hits",
  "pools": {}
}
// Error: 'pools' must have at least 1 property

// Invalid: Missing pool id
{
  "category": "combat-hits",
  "pools": {
    "hit_sword": {
      "name": "Sword Hits",
      "descriptors": [...]
    }
  }
}
// Error: Missing required property 'id'

// Invalid: Empty descriptors array
{
  "category": "combat-hits",
  "pools": {
    "hit_sword": {
      "id": "hit_sword",
      "name": "Sword Hits",
      "descriptors": []
    }
  }
}
// Error: 'descriptors' must have at least 1 item

// Invalid: Weight not positive
{
  "id": "test",
  "text": "test text",
  "weight": 0
}
// Error: 'weight' must be >= 1

// Invalid: Percentage out of range
{
  "id": "test",
  "text": "test text",
  "minDamagePercent": 1.5
}
// Error: 'minDamagePercent' must be <= 1

// Invalid: Category with underscore
{
  "category": "combat_hits",
  "pools": { ... }
}
// Error: 'category' does not match pattern ^[a-z][a-z0-9-]*$

// Invalid: Pool ID with hyphen
{
  "id": "hit-sword",
  "name": "Sword Hits",
  "descriptors": [...]
}
// Error: 'id' does not match pattern ^[a-z][a-z0-9_]*$

// Invalid: Unknown property
{
  "id": "test_pool",
  "name": "Test",
  "descriptors": [...],
  "customField": "value"
}
// Error: Additional properties not allowed: 'customField'
```

---

*End of v0.14.7a Design Specification*
