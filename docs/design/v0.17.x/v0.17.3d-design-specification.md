# v0.17.3d Design Specification: Available Specializations

**Version:** 0.17.3d  
**Phase Name:** Available Specializations  
**Parent Version:** v0.17.3 (Archetype System)  
**Prerequisites:** v0.17.3c Complete (Starting Abilities)  
**Estimated Tests:** ~6 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [ArchetypeSpecializationMapping Value Object](#4-archetypespecializationmapping-value-object)
5. [Data Model Changes](#5-data-model-changes)
6. [Configuration File Schemas](#6-configuration-file-schemas)
7. [Logging Specifications](#7-logging-specifications)
8. [Unit Testing Requirements](#8-unit-testing-requirements)
9. [Use Cases](#9-use-cases)
10. [User Stories](#10-user-stories)
11. [Deliverable Checklist](#11-deliverable-checklist)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Dependencies](#13-dependencies)
14. [Future Considerations](#14-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the `ArchetypeSpecializationMapping` value object that maps archetypes to their available specializations. Each archetype has access to a subset of specializations, with one recommended as the first choice.

The available specializations per archetype are:

| Archetype  | Count | Available Specializations                                                  | Recommended First |
| ---------- | ----- | -------------------------------------------------------------------------- | ----------------- |
| Warrior    | 6     | Guardian, Berserker, Weapon Master, Vanguard, Juggernaut, Battle Commander | Guardian          |
| Skirmisher | 4     | Shadow Dancer, Duelist, Ranger, Acrobat                                    | Shadow Dancer     |
| Mystic     | 2     | Elementalist, Void Weaver                                                  | Elementalist      |
| Adept      | 5     | Alchemist, Artificer, Tactician, Herbalist, Chronicler                     | Alchemist         |

This phase establishes the archetype-to-specialization relationship that the character creation workflow (v0.17.5) will use to present valid specialization choices.

### 1.2 Key Deliverables

| Category          | Items                                                |
| ----------------- | ---------------------------------------------------- |
| **Value Objects** | `ArchetypeSpecializationMapping`                     |
| **Configuration** | `archetypes.json` (availableSpecializations section) |
| **Tests**         | ~6 unit tests                                        |

### 1.3 Architectural Significance

This version establishes the **Specialization Gating Pattern** used throughout character progression:

- **Archetype-Gated Specializations**: Not all specializations are available to all archetypes
- **Recommended First Pattern**: Each archetype suggests a starting specialization
- **String ID References**: Specializations referenced by string ID (kebab-case)
- **Foundation for v0.17.4**: Provides the mapping data the Specialization System needs
- **Count Variation**: Archetypes have different numbers of available specializations (2-6)

---

## 2. Feature Overview

```
v0.17.3d Available Specializations
├── ArchetypeSpecializationMapping Value Object
│   ├── ArchetypeId: Archetype
│   ├── AvailableSpecializations: IReadOnlyList<string>
│   ├── RecommendedFirst: string
│   ├── Count: int
│   └── Helper Methods
│       ├── IsSpecializationAvailable(id)
│       ├── GetAvailableIds()
│       └── GetDisplayList()
└── Configuration Files
    └── archetypes.json (availableSpecializations section)
```

### 2.1 Scope Alignment

**In Scope:**

- `ArchetypeSpecializationMapping` value object
- Available specializations list per archetype (string IDs)
- Recommended first specialization per archetype
- Configuration schema extension for availableSpecializations section
- Helper methods for validation and display

**Out of Scope:**

- Specialization definitions → v0.17.4 (Specialization System)
- Specialization mechanics → v0.17.4
- Specialization selection UI → v0.17.5 (Creation Workflow)
- Archetype provider service → v0.17.3e
- Archetype application service → v0.17.3f

---

## 3. Architecture Diagrams

### 3.1 Specialization Mapping Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│              SPECIALIZATION MAPPING SYSTEM OVERVIEW                  │
└─────────────────────────────────────────────────────────────────────┘

    ArchetypeDefinition (v0.17.3a)
           │
           │  has-one (composition)
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│               ArchetypeSpecializationMapping                         │
├─────────────────────────────────────────────────────────────────────┤
│  - ArchetypeId: Archetype                                           │
│  - AvailableSpecializations: IReadOnlyList<string>                  │
│  - RecommendedFirst: string                                         │
│  - Count: int (computed)                                            │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  references (by string ID)
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                 SpecializationDefinition (v0.17.4)                   │
├─────────────────────────────────────────────────────────────────────┤
│  - SpecializationId: string                                         │
│  - DisplayName: string                                               │
│  - Description: string                                               │
│  - ... (defined in v0.17.4)                                         │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Specialization Availability by Archetype

```
┌─────────────────────────────────────────────────────────────────────┐
│              SPECIALIZATION AVAILABILITY BY ARCHETYPE                │
└─────────────────────────────────────────────────────────────────────┘

    WARRIOR (6 Specializations)
    ┌─────────────────────────────────────────────────────────────────┐
    │  ★ Guardian          — Tank focus, shield mastery              │
    │    Berserker         — Offense focus, rage mechanics           │
    │    Weapon Master     — Versatile, weapon switching             │
    │    Vanguard          — Frontline, initiative bonus             │
    │    Juggernaut        — Unstoppable, damage absorption          │
    │    Battle Commander  — Leadership, party buffs                 │
    └─────────────────────────────────────────────────────────────────┘

    SKIRMISHER (4 Specializations)
    ┌─────────────────────────────────────────────────────────────────┐
    │  ★ Shadow Dancer     — Stealth, ambush attacks                 │
    │    Duelist           — One-on-one combat, ripostes             │
    │    Ranger            — Ranged, tracking, traps                 │
    │    Acrobat           — Extreme mobility, evasion               │
    └─────────────────────────────────────────────────────────────────┘

    MYSTIC (2 Specializations)
    ┌─────────────────────────────────────────────────────────────────┐
    │  ★ Elementalist      — Elemental damage, area effects          │
    │    Void Weaver       — Dark Aether, control, debuffs           │
    └─────────────────────────────────────────────────────────────────┘

    ADEPT (5 Specializations)
    ┌─────────────────────────────────────────────────────────────────┐
    │  ★ Alchemist         — Potions, consumable crafting            │
    │    Artificer         — Gadgets, mechanical devices             │
    │    Tactician         — Strategy, party coordination            │
    │    Herbalist         — Healing, natural remedies               │
    │    Chronicler        — Lore knowledge, identify abilities      │
    └─────────────────────────────────────────────────────────────────┘

    ★ = Recommended First Specialization
```

### 3.3 Specialization Selection Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                  SPECIALIZATION SELECTION FLOW                       │
└─────────────────────────────────────────────────────────────────────┘

    Player completes Step 4 (Archetype)
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ STEP 5: SPECIALIZATION SELECTION                                 │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 1. Get ArchetypeSpecializationMapping for selected archetype    │
    │    Example: Warrior → 6 available specializations               │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 2. Display available specializations                             │
    │    - Highlight RecommendedFirst (★ Guardian)                    │
    │    - Show descriptions for each option                          │
    │    - Gray out unavailable specializations (other archetypes)    │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 3. Validate selection                                            │
    │    IsSpecializationAvailable(selectedId) == true                 │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    Player selects specialization → Proceed to Step 6 (Review)
```

### 3.4 Validation Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│                    VALIDATION DECISION TREE                          │
└─────────────────────────────────────────────────────────────────────┘

    Player attempts to select specialization
           │
           ▼
    ┌──────────────────────┐
    │ Get player's         │
    │ selected archetype   │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────┐
    │ Get mapping for      │
    │ archetype            │
    └──────────┬───────────┘
               │
               ▼
    ┌──────────────────────────────────────────┐
    │ IsSpecializationAvailable(selectedId)?   │
    └──────────────────────┬───────────────────┘
               │
        ┌──────┴──────┐
       YES            NO
        │              │
        ▼              ▼
    ┌────────────┐  ┌────────────────────────────────────────────────┐
    │ Allow      │  │ Reject selection                               │
    │ selection  │  │ "This specialization is not available for     │
    │            │  │  your archetype."                              │
    └────────────┘  └────────────────────────────────────────────────┘
```

### 3.5 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  CharacterCreationView (v0.17.5)                                     │
│  └── Step 5: Specialization Selection                               │
│      └── Uses ArchetypeSpecializationMapping to show valid options  │
│                                                                      │
│  SpecializationSelectionPanel (v0.17.5)                              │
│  └── Highlights RecommendedFirst                                    │
│  └── Disables unavailable specializations                           │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │             IArchetypeProvider (v0.17.3e)                     │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  + GetSpecializationMapping(Archetype): Mapping               │  │
│  │  + GetAvailableSpecializations(Archetype): IReadOnlyList      │  │
│  │  + IsSpecializationAvailable(Archetype, specId): bool         │  │
│  └───────────────────────────────────────────────────────────────┘  │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │            ArchetypeSpecializationMapping                     │  │
│  │                    (Value Object)                             │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  ArchetypeId: Archetype                                       │  │
│  │  AvailableSpecializations: IReadOnlyList<string>              │  │
│  │  RecommendedFirst: string                                     │  │
│  │  Count: int                                                   │  │
│  │  IsSpecializationAvailable(id): bool                          │  │
│  └───────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. ArchetypeSpecializationMapping Value Object

### 4.1 Purpose

The `ArchetypeSpecializationMapping` value object defines which specializations are available for a given archetype and which one is recommended as the player's first choice.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ArchetypeSpecializationMapping.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Maps an archetype to its available specializations.
/// </summary>
/// <remarks>
/// <para>
/// ArchetypeSpecializationMapping defines which specializations a character
/// can choose based on their archetype. Not all specializations are available
/// to all archetypes—each archetype has a curated list.
/// </para>
/// <para>
/// Specialization counts vary by archetype:
/// - Warrior: 6 specializations (most versatile)
/// - Adept: 5 specializations
/// - Skirmisher: 4 specializations
/// - Mystic: 2 specializations (most focused)
/// </para>
/// <para>
/// Each archetype has a RecommendedFirst specialization that serves as
/// the suggested starting point for new players.
/// </para>
/// </remarks>
/// <param name="ArchetypeId">The archetype this mapping applies to.</param>
/// <param name="AvailableSpecializations">List of available specialization IDs.</param>
/// <param name="RecommendedFirst">The recommended first specialization ID.</param>
public readonly record struct ArchetypeSpecializationMapping(
    Archetype ArchetypeId,
    IReadOnlyList<string> AvailableSpecializations,
    string RecommendedFirst)
{
    /// <summary>
    /// Gets the number of available specializations.
    /// </summary>
    public int Count => AvailableSpecializations.Count;

    /// <summary>
    /// Gets whether the archetype has any available specializations.
    /// </summary>
    public bool HasSpecializations => Count > 0;

    /// <summary>
    /// Checks if a specialization is available for this archetype.
    /// </summary>
    /// <param name="specializationId">The specialization ID to check.</param>
    /// <returns>True if the specialization is available.</returns>
    public bool IsSpecializationAvailable(string specializationId)
    {
        if (string.IsNullOrWhiteSpace(specializationId))
            return false;

        var normalizedId = specializationId.ToLowerInvariant();
        return AvailableSpecializations.Any(s =>
            s.Equals(normalizedId, StringComparison.OrdinalIgnoreCase));
    }

    /// <summary>
    /// Gets the available specialization IDs.
    /// </summary>
    public IEnumerable<string> GetAvailableIds() => AvailableSpecializations;

    /// <summary>
    /// Gets a display-friendly list of specializations.
    /// </summary>
    /// <param name="highlightRecommended">Whether to mark the recommended option.</param>
    /// <returns>List of display strings.</returns>
    public IReadOnlyList<string> GetDisplayList(bool highlightRecommended = true)
    {
        return AvailableSpecializations
            .Select(s => highlightRecommended && s == RecommendedFirst
                ? $"★ {FormatForDisplay(s)} (Recommended)"
                : FormatForDisplay(s))
            .ToList();
    }

    /// <summary>
    /// Creates a mapping for the Warrior archetype.
    /// </summary>
    public static ArchetypeSpecializationMapping Warrior => Create(
        Archetype.Warrior,
        ["guardian", "berserker", "weapon-master", "vanguard", "juggernaut", "battle-commander"],
        "guardian");

    /// <summary>
    /// Creates a mapping for the Skirmisher archetype.
    /// </summary>
    public static ArchetypeSpecializationMapping Skirmisher => Create(
        Archetype.Skirmisher,
        ["shadow-dancer", "duelist", "ranger", "acrobat"],
        "shadow-dancer");

    /// <summary>
    /// Creates a mapping for the Mystic archetype.
    /// </summary>
    public static ArchetypeSpecializationMapping Mystic => Create(
        Archetype.Mystic,
        ["elementalist", "void-weaver"],
        "elementalist");

    /// <summary>
    /// Creates a mapping for the Adept archetype.
    /// </summary>
    public static ArchetypeSpecializationMapping Adept => Create(
        Archetype.Adept,
        ["alchemist", "artificer", "tactician", "herbalist", "chronicler"],
        "alchemist");

    /// <summary>
    /// Creates a specialization mapping with validation.
    /// </summary>
    /// <param name="archetypeId">The archetype.</param>
    /// <param name="availableSpecializations">List of available specialization IDs.</param>
    /// <param name="recommendedFirst">The recommended first specialization.</param>
    /// <returns>A new ArchetypeSpecializationMapping instance.</returns>
    /// <exception cref="ArgumentException">Thrown when validation fails.</exception>
    public static ArchetypeSpecializationMapping Create(
        Archetype archetypeId,
        IEnumerable<string> availableSpecializations,
        string recommendedFirst)
    {
        ArgumentNullException.ThrowIfNull(availableSpecializations);
        ArgumentException.ThrowIfNullOrWhiteSpace(recommendedFirst);

        var specList = availableSpecializations
            .Select(s => s.ToLowerInvariant())
            .ToList();

        if (specList.Count == 0)
            throw new ArgumentException(
                "At least one specialization must be available.",
                nameof(availableSpecializations));

        var normalizedRecommended = recommendedFirst.ToLowerInvariant();

        if (!specList.Contains(normalizedRecommended))
            throw new ArgumentException(
                $"Recommended specialization '{recommendedFirst}' must be in available list.",
                nameof(recommendedFirst));

        return new ArchetypeSpecializationMapping(
            archetypeId,
            specList.AsReadOnly(),
            normalizedRecommended);
    }

    /// <summary>
    /// Gets the mapping for a specific archetype.
    /// </summary>
    /// <param name="archetype">The archetype to get mapping for.</param>
    /// <returns>The specialization mapping.</returns>
    public static ArchetypeSpecializationMapping GetForArchetype(Archetype archetype) =>
        archetype switch
        {
            Archetype.Warrior => Warrior,
            Archetype.Skirmisher => Skirmisher,
            Archetype.Mystic => Mystic,
            Archetype.Adept => Adept,
            _ => throw new ArgumentOutOfRangeException(nameof(archetype))
        };

    private static string FormatForDisplay(string kebabCase) =>
        string.Join(" ", kebabCase.Split('-').Select(word =>
            char.ToUpperInvariant(word[0]) + word[1..]));

    /// <inheritdoc />
    public override string ToString() =>
        $"{ArchetypeId}: {Count} specializations (recommended: {RecommendedFirst})";
}
```

### 4.3 Specialization Mapping Reference Table

| Archetype  | Count | AvailableSpecializations                                                   | RecommendedFirst |
| ---------- | ----- | -------------------------------------------------------------------------- | ---------------- |
| Warrior    | 6     | guardian, berserker, weapon-master, vanguard, juggernaut, battle-commander | guardian         |
| Skirmisher | 4     | shadow-dancer, duelist, ranger, acrobat                                    | shadow-dancer    |
| Mystic     | 2     | elementalist, void-weaver                                                  | elementalist     |
| Adept      | 5     | alchemist, artificer, tactician, herbalist, chronicler                     | alchemist        |

---

## 5. Data Model Changes

### 5.1 New Types Summary

| Type                             | Layer  | Category     | Description                      |
| -------------------------------- | ------ | ------------ | -------------------------------- |
| `ArchetypeSpecializationMapping` | Domain | Value Object | Archetype to specializations map |

### 5.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── ValueObjects/
│   └── ArchetypeSpecializationMapping.cs        ← NEW

config/
└── archetypes.json                              ← UPDATED (availableSpecializations section)
```

### 5.3 Type Relationships

```
┌─────────────────────────┐
│  ArchetypeDefinition    │
│      (v0.17.3a)         │
└───────────┬─────────────┘
            │ has-one
            ▼
┌───────────────────────────────────┐
│ArchetypeSpecializationMapping    │
│        (Value Object)             │
├───────────────────────────────────┤
│ ArchetypeId: Archetype            │
│ AvailableSpecializations: List    │────▶ [string IDs]
│ RecommendedFirst: string          │
│ Count: int                        │
│ IsSpecializationAvailable(): bool │
└───────────────────────────────────┘
            │
            │ references (by string ID)
            ▼
┌───────────────────────────────────┐
│    SpecializationDefinition       │
│          (v0.17.4)                │
└───────────────────────────────────┘
```

---

## 6. Configuration File Schemas

### 6.1 archetypes.json (Available Specializations Section)

**File:** `config/archetypes.json` (updated with availableSpecializations)

```json
{
    "$schema": "./schemas/archetypes.schema.json",
    "archetypes": [
        {
            "archetypeId": "Warrior",
            "displayName": "Warrior",
            "availableSpecializations": {
                "specializations": [
                    "guardian",
                    "berserker",
                    "weapon-master",
                    "vanguard",
                    "juggernaut",
                    "battle-commander"
                ],
                "recommendedFirst": "guardian"
            }
        },
        {
            "archetypeId": "Skirmisher",
            "displayName": "Skirmisher",
            "availableSpecializations": {
                "specializations": [
                    "shadow-dancer",
                    "duelist",
                    "ranger",
                    "acrobat"
                ],
                "recommendedFirst": "shadow-dancer"
            }
        },
        {
            "archetypeId": "Mystic",
            "displayName": "Mystic",
            "availableSpecializations": {
                "specializations": ["elementalist", "void-weaver"],
                "recommendedFirst": "elementalist"
            }
        },
        {
            "archetypeId": "Adept",
            "displayName": "Adept",
            "availableSpecializations": {
                "specializations": [
                    "alchemist",
                    "artificer",
                    "tactician",
                    "herbalist",
                    "chronicler"
                ],
                "recommendedFirst": "alchemist"
            }
        }
    ]
}
```

### 6.2 Schema Extension for Available Specializations

**File:** `config/schemas/archetypes.schema.json` (availableSpecializations section)

```json
{
    "$defs": {
        "availableSpecializations": {
            "type": "object",
            "description": "Specializations available to this archetype",
            "required": ["specializations", "recommendedFirst"],
            "properties": {
                "specializations": {
                    "type": "array",
                    "description": "List of available specialization IDs",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$",
                        "minLength": 3,
                        "maxLength": 50
                    },
                    "minItems": 1,
                    "uniqueItems": true
                },
                "recommendedFirst": {
                    "type": "string",
                    "description": "The recommended first specialization ID",
                    "pattern": "^[a-z][a-z0-9-]*$"
                }
            }
        }
    }
}
```

---

## 7. Logging Specifications

### 7.1 Log Levels by Component

| Component                        | Level   | Events                            |
| -------------------------------- | ------- | --------------------------------- |
| `ArchetypeSpecializationMapping` | Debug   | Mapping lookup, validation checks |
| `ArchetypeSpecializationMapping` | Warning | Invalid specialization selection  |

### 7.2 Logging Rules

- **Debug**: Mapping creation and lookup operations
- **Information**: Specialization selection validated
- **Warning**: Attempted selection of unavailable specialization
- **Error**: Invalid mapping configuration

---

## 8. Unit Testing Requirements

### 8.1 Test Count: ~6 tests

```csharp
[TestFixture]
public class ArchetypeSpecializationMappingTests
{
    [Test]
    public void Warrior_HasSixSpecializations()
    {
        // Arrange & Act
        var mapping = ArchetypeSpecializationMapping.Warrior;

        // Assert
        mapping.Count.Should().Be(6);
        mapping.AvailableSpecializations.Should().Contain("guardian");
        mapping.AvailableSpecializations.Should().Contain("berserker");
        mapping.RecommendedFirst.Should().Be("guardian");
    }

    [Test]
    public void Mystic_HasTwoSpecializations()
    {
        // Arrange & Act
        var mapping = ArchetypeSpecializationMapping.Mystic;

        // Assert
        mapping.Count.Should().Be(2);
        mapping.AvailableSpecializations.Should().Contain("elementalist");
        mapping.AvailableSpecializations.Should().Contain("void-weaver");
    }

    [Test]
    public void IsSpecializationAvailable_WithValidSpec_ReturnsTrue()
    {
        // Arrange
        var mapping = ArchetypeSpecializationMapping.Warrior;

        // Act & Assert
        mapping.IsSpecializationAvailable("guardian").Should().BeTrue();
        mapping.IsSpecializationAvailable("berserker").Should().BeTrue();
    }

    [Test]
    public void IsSpecializationAvailable_WithInvalidSpec_ReturnsFalse()
    {
        // Arrange
        var mapping = ArchetypeSpecializationMapping.Warrior;

        // Act & Assert
        mapping.IsSpecializationAvailable("elementalist").Should().BeFalse();
        mapping.IsSpecializationAvailable("shadow-dancer").Should().BeFalse();
    }

    [Test]
    public void Create_WithRecommendedNotInList_ThrowsArgumentException()
    {
        // Arrange
        Action act = () => ArchetypeSpecializationMapping.Create(
            Archetype.Warrior,
            ["guardian", "berserker"],
            "invalid-spec");

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*must be in available list*");
    }

    [Test]
    public void GetForArchetype_ReturnsCorrectMapping()
    {
        // Arrange & Act
        var warrior = ArchetypeSpecializationMapping.GetForArchetype(Archetype.Warrior);
        var mystic = ArchetypeSpecializationMapping.GetForArchetype(Archetype.Mystic);

        // Assert
        warrior.Count.Should().Be(6);
        mystic.Count.Should().Be(2);
    }
}
```

---

## 9. Use Cases

### UC-001: Display Available Specializations

**Actor:** Player  
**Precondition:** Player has confirmed archetype (Step 4 complete)  
**Flow:** Enter Step 5 → Get mapping for archetype → Display available specializations → Highlight recommended  
**Postcondition:** Player sees only valid specialization options

### UC-002: Validate Specialization Selection

**Actor:** System  
**Precondition:** Player attempts to select a specialization  
**Flow:** Get player's archetype → Get mapping → Check IsSpecializationAvailable → Allow or reject  
**Postcondition:** Only valid selections proceed

### UC-003: Suggest First Specialization

**Actor:** System  
**Precondition:** Player is on Step 5  
**Flow:** Get mapping → Get RecommendedFirst → Pre-select or highlight option  
**Postcondition:** Recommended specialization is visually indicated

---

## 10. User Stories

**US-001:** As a Warrior, I want to see that I have 6 specialization choices so I know I have the most versatility.

**US-002:** As a new player, I want to see which specialization is recommended first so I can make an informed choice.

**US-003:** As a Mystic, I want to understand why I only have 2 specializations (focused mastery concept).

**US-004:** As a player, I want the UI to prevent me from selecting a specialization not available to my archetype.

---

## 11. Deliverable Checklist

### Value Objects

- [ ] `ArchetypeSpecializationMapping` value object
- [ ] All properties: ArchetypeId, AvailableSpecializations, RecommendedFirst, Count
- [ ] Static factory properties (Warrior, Skirmisher, Mystic, Adept)
- [ ] `Create()` factory method with validation
- [ ] `IsSpecializationAvailable()` method
- [ ] `GetForArchetype()` lookup method
- [ ] `GetDisplayList()` for UI formatting
- [ ] Full XML documentation

### Configuration Files

- [ ] `archetypes.json` updated with availableSpecializations section
- [ ] Schema extended with availableSpecializations definition
- [ ] All 4 archetypes have correct specialization lists
- [ ] RecommendedFirst is in each specialization list

### Testing

- [ ] ~6 unit tests implemented
- [ ] All tests passing
- [ ] Edge cases covered (invalid spec, recommended not in list)

---

## 12. Acceptance Criteria

### Functional

- [ ] Warrior has 6 available specializations
- [ ] Skirmisher has 4 available specializations
- [ ] Mystic has 2 available specializations
- [ ] Adept has 5 available specializations
- [ ] Warrior's recommended first is "guardian"
- [ ] Skirmisher's recommended first is "shadow-dancer"
- [ ] Mystic's recommended first is "elementalist"
- [ ] Adept's recommended first is "alchemist"
- [ ] `IsSpecializationAvailable()` returns false for wrong archetype specs
- [ ] `GetForArchetype()` returns correct mapping for each archetype

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~6 unit tests pass
- [ ] XML documentation complete for all public types

---

## 13. Dependencies

### Required from Previous Phases

| Type                  | Phase    | Usage                          |
| --------------------- | -------- | ------------------------------ |
| `Archetype`           | v0.17.3a | Archetype identification       |
| `ArchetypeDefinition` | v0.17.3a | Will compose with spec mapping |

### Provides to Future Phases

| Type                             | Phase    | Usage                                 |
| -------------------------------- | -------- | ------------------------------------- |
| `ArchetypeSpecializationMapping` | v0.17.3e | Provider returns mappings             |
| `ArchetypeSpecializationMapping` | v0.17.4  | Specialization System uses for gating |
| `ArchetypeSpecializationMapping` | v0.17.5  | Creation workflow validates selection |

---

## 14. Future Considerations

### Deferred to v0.17.3e

- Provider service integration with specialization mappings

### Deferred to v0.17.3f

- Application service for validating specialization selection

### Deferred to v0.17.4

- SpecializationDefinition entities with full details
- Specialization mechanics and bonuses
- Specialization prerequisite system

### Deferred to v0.17.5

- UI display of available specializations
- Recommended first highlighting
- Invalid selection prevention

### Out of Scope for v0.17.3

- Specialization unlocking at higher levels
- Multi-specialization characters
- Specialization switching/respec
- Specialization synergies

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_
