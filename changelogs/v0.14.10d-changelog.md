# v0.14.10d Changelog - Command Schema

**Release Date:** 2026-01-22
**Version:** 0.14.10d
**Parent:** v0.14.10 (Game Systems Configuration Schemas)
**Prerequisites:** None (Command Schema is independent)

---

## Overview

This version introduces the **Command Schema** (`commands.schema.json`), a comprehensive JSON Schema Draft-07 specification for validating text-based interface command definitions. The schema enables definition of command syntax, argument patterns, context restrictions, help text, and shorthand aliases for the game's text adventure interface.

The Command Schema supports:
- **10 Argument Types**: String, Number, Direction, Target, Item, Ability, NPC, Location, Quantity, Boolean
- **8 Command Categories**: Movement, Combat, Interaction, Inventory, Information, Social, System, Debug
- **9 Context Restrictions**: Exploration, Combat, Dialogue, Inventory, Menu, Rest, Crafting, Trading, Any
- **Global Aliases**: Single-character shortcuts (e.g., 'n' → 'north')
- **Ignored Words**: Filler words stripped during parsing (the, a, an, to, with)
- **Comprehensive Help**: Usage patterns, examples, notes, and cross-references

---

## Added

### Schema File
- `config/schemas/commands.schema.json` - JSON Schema Draft-07 with 8 definitions

### Schema Definitions

| Definition | Description |
|------------|-------------|
| **CommandCategory** | 8 categories for command organization |
| **CommandCategoryDefinition** | Category metadata with display name and ordering |
| **ArgumentType** | 10 argument types for parsing and validation |
| **CommandContext** | 9 context restrictions for command validity |
| **Command** | Complete command definition with arguments, contexts, and help |
| **CommandArgument** | Typed argument with validation rules |
| **CommandHelp** | Help documentation with usage, examples, and notes |
| **CommandExample** | Example input/description pair |

### Argument Types (10 Types)

| Type | Description | Example Values |
|------|-------------|----------------|
| `String` | Free text input | "hello world" |
| `Number` | Integer value | "5", "100" |
| `Direction` | Cardinal/relative direction | "north", "up", "in" |
| `Target` | Enemy, object, or entity | "goblin", "door" |
| `Item` | Inventory item | "sword", "potion" |
| `Ability` | Skill or spell | "fireball", "heal" |
| `NPC` | Character name | "bjorn", "merchant" |
| `Location` | Place name | "town", "forest" |
| `Quantity` | Amount | "3", "all" |
| `Boolean` | Toggle value | "on", "off", "yes" |

### Command Categories (8 Categories)

| Category | Description | Example Commands |
|----------|-------------|------------------|
| `Movement` | Navigation and travel | go, north, enter |
| `Combat` | Battle actions | attack, defend, cast |
| `Interaction` | Object/NPC interaction | look, take, talk |
| `Inventory` | Item management | inventory, equip, drop |
| `Information` | Status and info | status, help |
| `Social` | Communication | say, shout |
| `System` | Meta commands | save, quit, settings |
| `Debug` | Developer commands | teleport, spawn, godmode |

### Context Restrictions (9 Contexts)

| Context | Description |
|---------|-------------|
| `Exploration` | World navigation, dungeon exploration |
| `Combat` | Turn-based combat encounters |
| `Dialogue` | NPC conversations |
| `Inventory` | Inventory UI open |
| `Menu` | System menus (settings, save/load) |
| `Rest` | Resting/camping sequences |
| `Crafting` | Item creation interfaces |
| `Trading` | Merchant interactions |
| `Any` | Always available (universal commands) |

### Configuration File
- `config/commands.json` - 26 example commands demonstrating:
  - Movement (6): go, north, south, east, west
  - Combat (4): attack, defend, cast, flee
  - Interaction (3): look, take, talk
  - Inventory (4): drop, inventory, equip, use
  - Information (1): status
  - Social (1): say
  - System (5): help, save, load, quit, settings
  - Debug (3): teleport, spawn, godmode
  - Global aliases (12): l, x, n, s, e, w, u, d, i, a, h, q
  - Ignored words (12): the, a, an, to, at, with, on, in, from, and, my, using

### Unit Tests
- `tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/CommandSchemaTests.cs`
- 62 unit tests covering:
  - CMD-001: Schema loads and contains 8 definitions
  - CMD-002: Command identity validation (ID pattern, name, description)
  - CMD-003: All 10 argument types validated
  - CMD-004: All 9 context restrictions validated
  - CMD-005: All 8 categories and alias validation
  - CMD-006: Help structure validation (usage, examples, seeAlso)

---

## Technical Details

### Schema Patterns

| Pattern | Convention | Example |
|---------|------------|---------|
| Command ID | `[a-z][a-z0-9-]*` | `look`, `go-north` |
| Command Name | `[a-z][a-z0-9]*` | `look`, `attack` |
| Argument Name | `[a-z][a-zA-Z0-9]*` | `target`, `itemName` |
| Categories | PascalCase | `Movement`, `Combat` |
| Contexts | PascalCase | `Exploration`, `Combat` |
| Argument Types | PascalCase | `String`, `Target` |

### Schema Constraints

| Field | Constraint |
|-------|------------|
| `command.id` | Pattern: `^[a-z][a-z0-9-]*$` |
| `command.name` | Pattern: `^[a-z][a-z0-9]*$`, maxLength: 20 |
| `command.description` | minLength: 1, maxLength: 200 |
| `command.contexts` | minItems: 1 |
| `command.cooldown` | minimum: 0 |
| `commands` | minItems: 1 |
| `aliases` | uniqueItems: true |
| `validValues` | minItems: 1 |

### Usage Pattern Syntax

| Symbol | Meaning | Example |
|--------|---------|---------|
| `<arg>` | Required argument | `attack <target>` |
| `[arg]` | Optional argument | `look [direction]` |
| `[<arg>]` | Optional typed argument | `give [<quantity>] <item>` |
| `...` | Variadic (multiple values) | `say <message>...` |

### Command Flags

| Flag | Description |
|------|-------------|
| `isHidden` | Hidden from help listings (debug commands) |
| `requiresTarget` | Requires target selection if no target argument |
| `canChain` | Combinable with other commands via 'then' |
| `cooldown` | Turns between uses (combat abilities) |
| `priority` | Resolution priority when commands conflict |

---

## Test Results

```
Test summary: total: 62, failed: 0, succeeded: 62, skipped: 0
Build succeeded with 0 errors
```

---

## Files Changed

| File | Change Type | Description |
|------|-------------|-------------|
| `config/schemas/commands.schema.json` | Added | Command schema with 8 definitions |
| `config/commands.json` | Added | 26 commands, 12 aliases, 12 ignored words |
| `tests/.../Schemas/CommandSchemaTests.cs` | Added | 62 unit tests |
| `docs/design/v0.14.x/v0.14.10-scope-breakdown.md` | To Update | Mark v0.14.10d criteria |
| `docs/design/v0.14.x/v0.14.x-overview.md` | To Update | Mark command schema complete |
| `changelogs/v0.14.10d-changelog.md` | Added | This changelog |

---

## Integration Points

The Command Schema provides configuration for future runtime systems:

```
Command Schema (v0.14.10d)
├── Provides To v0.15.x:
│   ├── Command Parser - Runtime parsing and execution
│   ├── Help System - Command documentation display
│   ├── Autocomplete - Suggestion generation
│   └── Context Manager - Context restriction validation
```

---

## Next Steps

- **v0.14.10e** - Glossary Schema (game terminology definitions)
- **v0.14.10f** - Stances Schema (combat stances and modifiers)

---

*End of v0.14.10d Changelog*
