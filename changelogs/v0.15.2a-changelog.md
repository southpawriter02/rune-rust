# Changelog v0.15.2a - Climbing System

## Overview

v0.15.2a introduces the multi-stage climbing system as part of the Acrobatics skill expansion. Characters can now climb heights through sequential skill checks, with outcomes determined by surface conditions, equipment bonuses, and armor penalties.

---

## Added

### Domain Layer - Enums

- **`ClimbStatus`** - Climb lifecycle states: `InProgress`, `Completed`, `Fallen`, `Abandoned`, `SlippedToGround`
- **`SurfaceType.Glitched`** - New variant for corruption-affected surfaces (DC +2)

### Domain Layer - Extensions

- **`SurfaceTypeExtensions`** - Surface modifier methods:
  - `GetDiceModifier()` - Returns dice pool modifier (+1 to -3)
  - `GetDcModifier()` - Returns DC modifier (0 or +2 for Glitched)
  - `GetDescription()` - Human-readable surface description
  - `UsesDcModifier()` - Whether surface uses DC modification
  - `GetDisplayName()` - Short surface name

### Domain Layer - Value Objects

- **`ClimbingStage`** - Stage representation with:
  - Stage number, height reached, surface type, DC
  - Computed: StartingHeight, FallHeight, IsCompleted, IsFumble, IsCriticalSuccess
  - `WithResult()` factory for recording outcomes

- **`ClimbContext`** - Climb parameters with:
  - Total height, surface type, base DC
  - Equipment bonuses (+1 climbing gear, +2 grappling hook)
  - Armor penalties (medium: -1, heavy: -4)
  - Factory methods: `Create()`, `CreateWithEquipment()`

- **`ClimbStageResult`** - Stage outcome with:
  - Outcome, net successes, margin, new stage
  - Fall triggered flag and height
  - Factory methods: `Success()`, `Failure()`, `Fumble()`

- **`FallResult`** - Fall damage preparation with:
  - Fall height, source, damage dice calculation
  - Crash landing DC calculation
  - Factory methods: `FromHeight()`, `TheLongFall()`

- **`FallSource`** enum - Fall origins: `Climbing`, `Leaping`, `Balance`, `Pushed`, `Environmental`

### Domain Layer - Entities

- **`ClimbState`** - Ongoing climb tracking with:
  - Climb ID, character ID, context, current stage
  - Stage history, status, timestamps
  - Methods: `StartClimb()`, `RecordStageAttempt()`, `Abandon()`, `GetNextStage()`

### Application Layer - Interfaces

- **`IClimbingService`** - Climbing operations contract:
  - `StartClimb()` - Initialize climb state
  - `AttemptStage()` - Roll stage check
  - `ProcessFall()` - Generate fall result
  - `AbandonClimb()` - Safe exit from climb
  - Helper methods for stage/modifier calculations

### Application Layer - Services

- **`ClimbingService`** - Full climbing implementation:
  - Success-counting dice mechanics
  - Outcome matrix (critical/success/failure/fumble)
  - Fumble triggers [The Slip] consequence
  - Comprehensive structured logging

### Configuration Files

- **`config/climbing-surfaces.json`** - Surface and equipment definitions
- **`config/schemas/climbing-surfaces.schema.json`** - JSON Schema validation

---

## Stage Mechanics

| Height | Stages Required |
|--------|-----------------|
| 1-20ft | 1 stage |
| 21-40ft | 2 stages |
| 41+ft | 3 stages |

| Outcome | Effect |
|---------|--------|
| Critical (margin ≥ 5) | Advance 2 stages |
| Success (margin ≥ 0) | Advance 1 stage |
| Failure (margin < 0) | Slip back 1 stage |
| Fumble (0 success + botch) | Fall from current height |

---

## Testing

### New Unit Tests (11 test methods, 23 test cases)

**ClimbingServiceTests:**
- `CalculateStagesRequired_GivenHeight_ReturnsCorrectStages` - 7 cases
- `GetSurfaceDiceModifier_GivenSurfaceType_ReturnsCorrectModifier` - 6 cases
- `GetSurfaceDcModifier_GivenSurfaceType_ReturnsCorrectModifier` - 2 cases
- `AttemptStage_OnSuccess_AdvancesToNextStage`
- `AttemptStage_OnFailure_SlipsBackOneStage`
- `AttemptStage_OnFumble_TriggersFallFromCurrentHeight`
- `AttemptStage_OnCriticalSuccess_AdvancesTwoStages`
- `AttemptStage_WhenClimbComplete_SetsCompletedStatus`
- `StartClimb_WithValidParameters_CreatesInProgressState`
- `AbandonClimb_WhenInProgress_SetsAbandonedStatus`
- `ProcessFall_WhenFallen_ReturnsFallResult`

---

## Verification

```
Build succeeded.
    0 Warning(s)
    0 Error(s)

Test summary: total: 23, failed: 0, succeeded: 23, skipped: 0
```

---

## Dependencies

- Requires: v0.15.1e (Integration Points)
- Used by: v0.15.2b (Leaping System), v0.15.2c (Fall Damage System)

---

## Document Metadata

| Property | Value |
|----------|-------|
| Version | 0.15.2a |
| Theme | Climbing System |
| Date | 2026-01-22 |
| Status | Complete |
