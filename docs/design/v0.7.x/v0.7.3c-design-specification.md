# v0.7.3c Design Specification: Combat UI Components

**Version:** 0.7.3c
**Parent:** v0.7.3 (Combat Integration)
**Prerequisites:** v0.7.3b Complete (Grid Interaction)
**Status:** Design Complete
**Estimated Unit Tests:** ~7

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Combatant List Panel](#4-combatant-list-panel)
5. [Combatant List ViewModel](#5-combatant-list-viewmodel)
6. [Combatant Entry ViewModel](#6-combatant-entry-viewmodel)
7. [Combat Action Bar](#7-combat-action-bar)
8. [Combat Action Bar ViewModel](#8-combat-action-bar-viewmodel)
9. [Styles](#9-styles)
10. [Data Model Changes](#10-data-model-changes)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)

---

## 1. Overview

### Purpose

This phase implements the combat UI components that accompany the combat grid: a combatant list showing all entities in turn order with HP bars and status effects, and an action bar with combat buttons enabling the player to attack, move, use abilities, defend, use items, wait, or end their turn. These components provide the player interface for tactical combat decisions.

### Key Deliverables

| Category | Items |
|----------|-------|
| **User Controls** | `CombatantListPanel`, `CombatActionBar` |
| **ViewModels** | `CombatantListViewModel`, `CombatActionBarViewModel`, `CombatantEntryViewModel`, `StatusEffectViewModel` |
| **Commands** | Attack, Move, Ability, Defend, Item, Wait, EndTurn |
| **Styles** | `CombatUIStyles.axaml` |
| **Tests** | ~7 unit tests |

### Design Principles

1. **Turn Clarity**: Clear indication of current turn and turn order
2. **Action Availability**: Obvious enabled/disabled button states
3. **Information Density**: HP, status, and resources at a glance
4. **Quick Actions**: One-click access to common combat actions

---

## 2. Feature Overview

```
v0.7.3c Features
â”œâ”€â”€ Combatant List Panel (UserControl)
â”‚   â”œâ”€â”€ Panel header ("COMBATANTS")
â”‚   â”œâ”€â”€ Scrollable list of combatant entries
â”‚   â””â”€â”€ Sorted by initiative order
â”‚
â”œâ”€â”€ Combatant Entry
â”‚   â”œâ”€â”€ Turn indicator (â–º for current turn)
â”‚   â”œâ”€â”€ Combatant name
â”‚   â”œâ”€â”€ HP bar (using HealthBarControl from v0.7.1b)
â”‚   â”œâ”€â”€ HP text (current/max)
â”‚   â”œâ”€â”€ Status effect icons
â”‚   â””â”€â”€ Faction color coding
â”‚
â”œâ”€â”€ Combat Action Bar (UserControl)
â”‚   â”œâ”€â”€ Turn Info Section
â”‚   â”‚   â”œâ”€â”€ Round number
â”‚   â”‚   â”œâ”€â”€ Turn indicator ("YOUR TURN" / "Enemy Turn")
â”‚   â”‚   â”œâ”€â”€ Action point indicator (âœ“ available)
â”‚   â”‚   â”œâ”€â”€ Bonus action indicator (âœ“ available)
â”‚   â”‚   â””â”€â”€ Movement remaining (e.g., "Move: 4/4")
â”‚   â”‚
â”‚   â””â”€â”€ Action Buttons
â”‚       â”œâ”€â”€ Attack (âš”) - enters attack mode
â”‚       â”œâ”€â”€ Move (ğŸƒ) - enters movement mode
â”‚       â”œâ”€â”€ Ability (âœ¨) - opens ability selection
â”‚       â”œâ”€â”€ Defend (ğŸ›¡) - takes defensive stance
â”‚       â”œâ”€â”€ Item (ğŸ’) - opens consumable selection
â”‚       â”œâ”€â”€ Wait (â³) - delays turn in initiative
â”‚       â””â”€â”€ End Turn - advances to next combatant
â”‚
â””â”€â”€ Button State Management
    â”œâ”€â”€ Enable/disable based on available actions
    â”œâ”€â”€ Visual feedback for active modes
    â””â”€â”€ Disable during enemy turns
```

---

## 3. Architecture

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PRESENTATION LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  VIEWS                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     CombatantListPanel                             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ - Header ("COMBATANTS")                                           â”‚ â”‚
â”‚  â”‚ - ScrollViewer with ItemsControl                                  â”‚ â”‚
â”‚  â”‚ - CombatantEntry items with HP bars                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚ DataContext                        â”‚
â”‚                                   â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    CombatActionBar                                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ - Turn info display                                               â”‚ â”‚
â”‚  â”‚ - Action buttons (Attack, Move, Ability, Defend, Item, Wait)      â”‚ â”‚
â”‚  â”‚ - End Turn button                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚ DataContext                        â”‚
â”‚                                   â–¼                                    â”‚
â”‚  VIEWMODELS                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  CombatantListViewModel                            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ + Combatants: ObservableCollection<CombatantEntryViewModel>       â”‚ â”‚
â”‚  â”‚ + CurrentTurnEntityId: Guid                                       â”‚ â”‚
â”‚  â”‚ - RefreshCombatants(): void                                       â”‚ â”‚
â”‚  â”‚ - HandleTurnChanged(Combatant): void                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  CombatActionBarViewModel                          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ + CurrentRound: int                                               â”‚ â”‚
â”‚  â”‚ + IsPlayerTurn: bool                                              â”‚ â”‚
â”‚  â”‚ + HasAction: bool                                                 â”‚ â”‚
â”‚  â”‚ + HasBonus: bool                                                  â”‚ â”‚
â”‚  â”‚ + RemainingMovement: int                                          â”‚ â”‚
â”‚  â”‚ + MaxMovement: int                                                â”‚ â”‚
â”‚  â”‚ + CanAttack/CanMove/CanUseAbility: bool                           â”‚ â”‚
â”‚  â”‚ + AttackCommand, MoveCommand, AbilityCommand, etc.                â”‚ â”‚
â”‚  â”‚ - HandleTurnChanged(Combatant): void                              â”‚ â”‚
â”‚  â”‚ - UpdateButtonStates(): void                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APPLICATION LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                        ICombatService                              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ + AllCombatants: IReadOnlyList<Combatant>                          â”‚â”‚
â”‚  â”‚ + CurrentRound: int                                                â”‚â”‚
â”‚  â”‚ + CurrentTurn: Combatant                                           â”‚â”‚
â”‚  â”‚ + GetPlayerCombatant(): Combatant                                  â”‚â”‚
â”‚  â”‚ + ExecuteDefend(combatant): void                                   â”‚â”‚
â”‚  â”‚ + ExecuteWait(combatant): void                                     â”‚â”‚
â”‚  â”‚ + EndPlayerTurn(): void                                            â”‚â”‚
â”‚  â”‚ + OnCombatantsChanged: event Action                                â”‚â”‚
â”‚  â”‚ + OnTurnChanged: event Action<Combatant>                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                   IGridInteractionService (from v0.7.3b)           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ + EnterMovementMode(combatant): void                               â”‚â”‚
â”‚  â”‚ + EnterAttackMode(combatant, range): void                          â”‚â”‚
â”‚  â”‚ + EnterAbilityMode(combatant, ability): void                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layout Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GameWindow Layout                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                     â”‚ â”‚                            â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚    COMBATANT LIST          â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚    (RightSidebarTop)       â”‚ â”‚
â”‚  â”‚       COMBAT GRID                   â”‚ â”‚                            â”‚ â”‚
â”‚  â”‚       (MainContent)                 â”‚ â”‚    â–º Hero                  â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚      HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  65/100â”‚ â”‚
â”‚  â”‚       [Grid from v0.7.3a]           â”‚ â”‚                            â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚      Skeleton              â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚      HP: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  15/45 â”‚ â”‚
â”‚  â”‚                                     â”‚ â”‚                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚                      COMBAT ACTION BAR                               â”‚
â”‚  â”‚                      (BottomContent)                                 â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”‚  Round 3 â”‚ YOUR TURN â”‚ Action: âœ“ â”‚ Bonus: âœ“ â”‚ Move: 4/4             â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â”‚  [Attack] [Move] [Ability] [Defend] [Item] [Wait]   [End Turn]      â”‚
â”‚  â”‚                                                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Combatant List Panel

### Panel Layout

```
COMBATANT LIST:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          COMBATANTS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  â–º Hero                               â”‚  â† Current turn (yellow)
â”‚    HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  65/100       â”‚
â”‚    Status: [âš” Defensive] [ğŸ›¡ +2 AC]  â”‚
â”‚                                       â”‚
â”‚    Skeleton                           â”‚  â† Enemy (red text)
â”‚    HP: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  15/45        â”‚
â”‚    Status: [ğŸ©¸ Bleeding]              â”‚
â”‚                                       â”‚
â”‚    Goblin                             â”‚
â”‚    HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  25/25        â”‚
â”‚    Status: (none)                     â”‚
â”‚                                       â”‚
â”‚    Goblin Archer                      â”‚
â”‚    HP: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  12/20        â”‚
â”‚    Status: (none)                     â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### XAML Implementation

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/CombatantListPanel.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
             xmlns:ctrl="using:RuneAndRust.Avalonia.Controls"
             x:Class="RuneAndRust.Avalonia.Controls.CombatantListPanel"
             x:DataType="vm:CombatantListViewModel">
    
    <Design.DataContext>
        <vm:CombatantListViewModel />
    </Design.DataContext>
    
    <Border Classes="panel" Padding="8">
        <Grid RowDefinitions="Auto,*">
            
            <!-- Header -->
            <TextBlock Grid.Row="0" 
                       Text="COMBATANTS"
                       Classes="secondary"
                       FontWeight="SemiBold"
                       Margin="0,0,0,8" />
            
            <!-- Combatant List -->
            <ScrollViewer Grid.Row="1" 
                          VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Combatants}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="vm:CombatantEntryViewModel">
                            <Border Classes="combatant-entry"
                                    Classes.current-turn="{Binding IsCurrentTurn}"
                                    Margin="0,0,0,8"
                                    Padding="8">
                                <Grid RowDefinitions="Auto,Auto,Auto">
                                    
                                    <!-- Name Row -->
                                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                                        <TextBlock Text="{Binding TurnIndicator}"
                                                   Classes="turn-indicator"
                                                   Width="16"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center" />
                                        <TextBlock Text="{Binding Name}"
                                                   Classes="combatant-name"
                                                   Classes.player="{Binding IsPlayer}"
                                                   Classes.enemy="{Binding IsEnemy}"
                                                   FontWeight="SemiBold" />
                                    </StackPanel>
                                    
                                    <!-- HP Row -->
                                    <Grid Grid.Row="1" 
                                          ColumnDefinitions="*,Auto"
                                          Margin="16,4,0,0">
                                        <ctrl:HealthBarControl 
                                            Grid.Column="0"
                                            CurrentValue="{Binding CurrentHp}"
                                            MaxValue="{Binding MaxHp}"
                                            Height="8" />
                                        <TextBlock Grid.Column="1"
                                                   Margin="8,0,0,0"
                                                   FontSize="11"
                                                   Classes="muted">
                                            <Run Text="{Binding CurrentHp}" />
                                            <Run Text="/" />
                                            <Run Text="{Binding MaxHp}" />
                                        </TextBlock>
                                    </Grid>
                                    
                                    <!-- Status Effects Row -->
                                    <ItemsControl Grid.Row="2"
                                                  ItemsSource="{Binding StatusEffects}"
                                                  Margin="16,4,0,0"
                                                  IsVisible="{Binding HasStatusEffects}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate DataType="vm:StatusEffectViewModel">
                                                <Border Classes="status-effect-badge"
                                                        ToolTip.Tip="{Binding Description}"
                                                        Margin="0,0,4,0"
                                                        Padding="4,2">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="{Binding Icon}"
                                                                   FontSize="10" />
                                                        <TextBlock Text="{Binding Name}"
                                                                   FontSize="10"
                                                                   Margin="2,0,0,0" />
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                    
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
            
        </Grid>
    </Border>
</UserControl>
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/CombatantListPanel.axaml.cs`

```csharp
namespace RuneAndRust.Avalonia.Controls;

using global::Avalonia.Controls;

/// <summary>
/// Panel displaying the list of combatants in turn order.
/// </summary>
public partial class CombatantListPanel : UserControl
{
    public CombatantListPanel()
    {
        InitializeComponent();
    }
}
```

---

## 5. Combatant List ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/CombatantListViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using Serilog;
using System.Collections.ObjectModel;

/// <summary>
/// View model for the combatant list panel.
/// </summary>
public partial class CombatantListViewModel : ViewModelBase
{
    private readonly ICombatService? _combatService;

    [ObservableProperty]
    private ObservableCollection<CombatantEntryViewModel> _combatants = new();

    [ObservableProperty]
    private Guid _currentTurnEntityId;

    /// <summary>
    /// Creates a new CombatantListViewModel with services.
    /// </summary>
    public CombatantListViewModel(ICombatService combatService)
    {
        _combatService = combatService;
        _combatService.OnCombatantsChanged += RefreshCombatants;
        _combatService.OnTurnChanged += HandleTurnChanged;
    }

    /// <summary>
    /// Design-time constructor.
    /// </summary>
    public CombatantListViewModel()
    {
        // Sample data for design-time
        Combatants.Add(new CombatantEntryViewModel("Hero", 65, 100, true, true));
        Combatants.Add(new CombatantEntryViewModel("Skeleton", 15, 45, false, false));
        Combatants.Add(new CombatantEntryViewModel("Goblin", 25, 25, false, false));
    }

    private void RefreshCombatants()
    {
        if (_combatService is null)
            return;

        Combatants.Clear();

        foreach (var combatant in _combatService.AllCombatants.OrderByDescending(c => c.Initiative))
        {
            var entry = new CombatantEntryViewModel(combatant)
            {
                IsCurrentTurn = combatant.Id == CurrentTurnEntityId
            };
            Combatants.Add(entry);
        }

        Log.Debug("Combatant list refreshed: {Count} combatants", Combatants.Count);
    }

    private void HandleTurnChanged(Combatant current)
    {
        CurrentTurnEntityId = current.Id;

        foreach (var entry in Combatants)
        {
            entry.IsCurrentTurn = entry.EntityId == CurrentTurnEntityId;
        }

        Log.Debug("Turn changed to {Name}", current.Name);
    }
}
```

---

## 6. Combatant Entry ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/CombatantEntryViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using System.Collections.ObjectModel;

/// <summary>
/// View model for a single combatant entry in the list.
/// </summary>
public partial class CombatantEntryViewModel : ViewModelBase
{
    /// <summary>
    /// Gets the entity ID.
    /// </summary>
    public Guid EntityId { get; }

    /// <summary>
    /// Gets whether this is the player.
    /// </summary>
    public bool IsPlayer { get; }

    /// <summary>
    /// Gets whether this is an enemy.
    /// </summary>
    public bool IsEnemy { get; }

    [ObservableProperty]
    private string _name = string.Empty;

    [ObservableProperty]
    private int _currentHp;

    [ObservableProperty]
    private int _maxHp;

    [ObservableProperty]
    private bool _isCurrentTurn;

    [ObservableProperty]
    private ObservableCollection<StatusEffectViewModel> _statusEffects = new();

    /// <summary>
    /// Gets the turn indicator character.
    /// </summary>
    public string TurnIndicator => IsCurrentTurn ? "â–º" : " ";

    /// <summary>
    /// Gets whether there are any status effects.
    /// </summary>
    public bool HasStatusEffects => StatusEffects.Count > 0;

    /// <summary>
    /// Creates a new CombatantEntryViewModel from a combatant.
    /// </summary>
    public CombatantEntryViewModel(Combatant combatant)
    {
        EntityId = combatant.Id;
        Name = combatant.Name;
        CurrentHp = combatant.Health;
        MaxHp = combatant.MaxHealth;
        IsPlayer = combatant.IsPlayer;
        IsEnemy = combatant.Faction == Faction.Enemy;

        foreach (var effect in combatant.ActiveStatusEffects)
        {
            StatusEffects.Add(new StatusEffectViewModel(effect));
        }
    }

    /// <summary>
    /// Design-time constructor.
    /// </summary>
    public CombatantEntryViewModel(string name, int hp, int maxHp, bool isPlayer, bool isCurrentTurn)
    {
        EntityId = Guid.NewGuid();
        Name = name;
        CurrentHp = hp;
        MaxHp = maxHp;
        IsPlayer = isPlayer;
        IsEnemy = !isPlayer;
        IsCurrentTurn = isCurrentTurn;

        if (isPlayer)
        {
            StatusEffects.Add(new StatusEffectViewModel("âš”", "Defensive", "Taking defensive stance"));
        }
    }

    partial void OnIsCurrentTurnChanged(bool value)
    {
        OnPropertyChanged(nameof(TurnIndicator));
    }
}

/// <summary>
/// View model for a status effect icon.
/// </summary>
public partial class StatusEffectViewModel : ViewModelBase
{
    public string Icon { get; }
    public string Name { get; }
    public string Description { get; }

    public StatusEffectViewModel(StatusEffect effect)
    {
        Icon = GetIconForEffect(effect.Type);
        Name = effect.Name;
        Description = effect.Description;
    }

    public StatusEffectViewModel(string icon, string name, string description)
    {
        Icon = icon;
        Name = name;
        Description = description;
    }

    private static string GetIconForEffect(StatusEffectType type)
    {
        return type switch
        {
            StatusEffectType.Defensive => "âš”",
            StatusEffectType.Bleeding => "ğŸ©¸",
            StatusEffectType.Poisoned => "â˜ ",
            StatusEffectType.Burning => "ğŸ”¥",
            StatusEffectType.Frozen => "â„",
            StatusEffectType.Stunned => "ğŸ’«",
            StatusEffectType.Buffed => "âœ¨",
            StatusEffectType.ArmorBonus => "ğŸ›¡",
            _ => "â—"
        };
    }
}
```

---

## 7. Combat Action Bar

### Action Bar Layout

```
COMBAT ACTION BAR:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Round 3  â”‚  YOUR TURN  â”‚  Action: âœ“  â”‚  Bonus: âœ“  â”‚  Move: 4/4        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âš”     â”‚ â”‚  ğŸƒ    â”‚ â”‚  âœ¨    â”‚ â”‚  ğŸ›¡    â”‚ â”‚  ğŸ’    â”‚ â”‚  â³    â”‚â”‚
â”‚  â”‚ Attack  â”‚ â”‚  Move   â”‚ â”‚ Ability â”‚ â”‚ Defend  â”‚ â”‚  Item   â”‚ â”‚  Wait   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         [End Turn]                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### XAML Implementation

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/CombatActionBar.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
             x:Class="RuneAndRust.Avalonia.Controls.CombatActionBar"
             x:DataType="vm:CombatActionBarViewModel">
    
    <Design.DataContext>
        <vm:CombatActionBarViewModel />
    </Design.DataContext>
    
    <Border Classes="panel action-bar" Padding="12">
        <Grid RowDefinitions="Auto,Auto,Auto">
            
            <!-- Turn Info Row -->
            <Border Grid.Row="0" 
                    Classes="turn-info-bar"
                    Padding="8"
                    Margin="0,0,0,8">
                <StackPanel Orientation="Horizontal" Spacing="16">
                    <!-- Round -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Round " Classes="muted" />
                        <TextBlock Text="{Binding CurrentRound}" FontWeight="Bold" />
                    </StackPanel>
                    
                    <Border Width="1" Background="{StaticResource BorderBrush}" />
                    
                    <!-- Turn Indicator -->
                    <TextBlock Text="{Binding TurnText}"
                               Classes="turn-indicator-text"
                               Classes.player-turn="{Binding IsPlayerTurn}"
                               FontWeight="Bold" />
                    
                    <Border Width="1" Background="{StaticResource BorderBrush}" />
                    
                    <!-- Action Point -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Action: " Classes="muted" />
                        <TextBlock Text="{Binding ActionIndicator}"
                                   Classes.available="{Binding HasAction}"
                                   Classes.used="{Binding !HasAction}" />
                    </StackPanel>
                    
                    <Border Width="1" Background="{StaticResource BorderBrush}" />
                    
                    <!-- Bonus Action -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Bonus: " Classes="muted" />
                        <TextBlock Text="{Binding BonusIndicator}"
                                   Classes.available="{Binding HasBonus}"
                                   Classes.used="{Binding !HasBonus}" />
                    </StackPanel>
                    
                    <Border Width="1" Background="{StaticResource BorderBrush}" />
                    
                    <!-- Movement -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Move: " Classes="muted" />
                        <TextBlock FontWeight="SemiBold">
                            <Run Text="{Binding RemainingMovement}" />
                            <Run Text="/" />
                            <Run Text="{Binding MaxMovement}" />
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </Border>
            
            <!-- Action Buttons Row -->
            <UniformGrid Grid.Row="1" 
                         Columns="6" 
                         Margin="0,0,0,8">
                
                <!-- Attack -->
                <Button Command="{Binding AttackCommand}"
                        Classes="action-button"
                        IsEnabled="{Binding CanAttack}"
                        ToolTip.Tip="Attack an enemy">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="âš”" FontSize="20" HorizontalAlignment="Center" />
                        <TextBlock Text="Attack" FontSize="11" />
                    </StackPanel>
                </Button>
                
                <!-- Move -->
                <Button Command="{Binding MoveCommand}"
                        Classes="action-button"
                        IsEnabled="{Binding CanMove}"
                        ToolTip.Tip="Move to another cell">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ğŸƒ" FontSize="20" HorizontalAlignment="Center" />
                        <TextBlock Text="Move" FontSize="11" />
                    </StackPanel>
                </Button>
                
                <!-- Ability -->
                <Button Command="{Binding AbilityCommand}"
                        Classes="action-button"
                        IsEnabled="{Binding CanUseAbility}"
                        ToolTip.Tip="Use an ability">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="âœ¨" FontSize="20" HorizontalAlignment="Center" />
                        <TextBlock Text="Ability" FontSize="11" />
                    </StackPanel>
                </Button>
                
                <!-- Defend -->
                <Button Command="{Binding DefendCommand}"
                        Classes="action-button"
                        IsEnabled="{Binding HasAction}"
                        ToolTip.Tip="Take defensive stance">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ğŸ›¡" FontSize="20" HorizontalAlignment="Center" />
                        <TextBlock Text="Defend" FontSize="11" />
                    </StackPanel>
                </Button>
                
                <!-- Item -->
                <Button Command="{Binding UseItemCommand}"
                        Classes="action-button"
                        ToolTip.Tip="Use a consumable item">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="ğŸ’" FontSize="20" HorizontalAlignment="Center" />
                        <TextBlock Text="Item" FontSize="11" />
                    </StackPanel>
                </Button>
                
                <!-- Wait -->
                <Button Command="{Binding WaitCommand}"
                        Classes="action-button"
                        ToolTip.Tip="Delay your turn">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="â³" FontSize="20" HorizontalAlignment="Center" />
                        <TextBlock Text="Wait" FontSize="11" />
                    </StackPanel>
                </Button>
                
            </UniformGrid>
            
            <!-- End Turn Button -->
            <Button Grid.Row="2"
                    Command="{Binding EndTurnCommand}"
                    Classes="end-turn-button"
                    HorizontalAlignment="Stretch"
                    IsEnabled="{Binding IsPlayerTurn}">
                <TextBlock Text="End Turn" FontWeight="SemiBold" />
            </Button>
            
        </Grid>
    </Border>
</UserControl>
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/CombatActionBar.axaml.cs`

```csharp
namespace RuneAndRust.Avalonia.Controls;

using global::Avalonia.Controls;

/// <summary>
/// Action bar with combat buttons.
/// </summary>
public partial class CombatActionBar : UserControl
{
    public CombatActionBar()
    {
        InitializeComponent();
    }
}
```

---

## 8. Combat Action Bar ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/CombatActionBarViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Avalonia.Services;
using RuneAndRust.Domain.Entities;
using Serilog;

/// <summary>
/// View model for the combat action bar.
/// </summary>
public partial class CombatActionBarViewModel : ViewModelBase
{
    private readonly ICombatService? _combatService;
    private readonly IGridInteractionService? _gridInteraction;

    [ObservableProperty]
    private int _currentRound = 1;

    [ObservableProperty]
    private bool _isPlayerTurn = true;

    [ObservableProperty]
    private bool _hasAction = true;

    [ObservableProperty]
    private bool _hasBonus = true;

    [ObservableProperty]
    private int _remainingMovement = 4;

    [ObservableProperty]
    private int _maxMovement = 4;

    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(AttackCommand))]
    private bool _canAttack = true;

    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(MoveCommand))]
    private bool _canMove = true;

    [ObservableProperty]
    [NotifyCanExecuteChangedFor(nameof(AbilityCommand))]
    private bool _canUseAbility = true;

    /// <summary>
    /// Gets the turn indicator text.
    /// </summary>
    public string TurnText => IsPlayerTurn ? "YOUR TURN" : "Enemy Turn";

    /// <summary>
    /// Gets the action point indicator.
    /// </summary>
    public string ActionIndicator => HasAction ? "âœ“" : "âœ—";

    /// <summary>
    /// Gets the bonus action indicator.
    /// </summary>
    public string BonusIndicator => HasBonus ? "âœ“" : "âœ—";

    /// <summary>
    /// Creates a new CombatActionBarViewModel with services.
    /// </summary>
    public CombatActionBarViewModel(
        ICombatService combatService, 
        IGridInteractionService gridInteraction)
    {
        _combatService = combatService;
        _gridInteraction = gridInteraction;

        _combatService.OnTurnChanged += HandleTurnChanged;
        _gridInteraction.OnTargetingComplete += HandleTargetingComplete;
    }

    /// <summary>
    /// Design-time constructor.
    /// </summary>
    public CombatActionBarViewModel()
    {
    }

    [RelayCommand(CanExecute = nameof(CanAttack))]
    private void Attack()
    {
        if (_combatService is null || _gridInteraction is null)
            return;

        var player = _combatService.GetPlayerCombatant();
        _gridInteraction.EnterAttackMode(player, player.AttackRange);
        Log.Information("Entered attack targeting mode");
    }

    [RelayCommand(CanExecute = nameof(CanMove))]
    private void Move()
    {
        if (_combatService is null || _gridInteraction is null)
            return;

        var player = _combatService.GetPlayerCombatant();
        _gridInteraction.EnterMovementMode(player);
        Log.Information("Entered movement targeting mode");
    }

    [RelayCommand(CanExecute = nameof(CanUseAbility))]
    private void Ability()
    {
        // Opens ability selection panel (simplified for now)
        Log.Information("Ability selection requested");
    }

    [RelayCommand]
    private void Defend()
    {
        if (_combatService is null)
            return;

        var player = _combatService.GetPlayerCombatant();
        _combatService.ExecuteDefend(player);
        HasAction = false;
        UpdateButtonStates();
        Log.Information("Player took defensive stance");
    }

    [RelayCommand]
    private void UseItem()
    {
        // Opens item selection panel (simplified for now)
        Log.Information("Item selection requested");
    }

    [RelayCommand]
    private void Wait()
    {
        if (_combatService is null)
            return;

        var player = _combatService.GetPlayerCombatant();
        _combatService.ExecuteWait(player);
        Log.Information("Player chose to wait");
    }

    [RelayCommand]
    private void EndTurn()
    {
        if (_combatService is null)
            return;

        _combatService.EndPlayerTurn();
        Log.Information("Player ended turn");
    }

    private void HandleTurnChanged(Combatant current)
    {
        IsPlayerTurn = current.IsPlayer;
        CurrentRound = _combatService?.CurrentRound ?? 1;
        HasAction = true;
        HasBonus = true;
        RemainingMovement = current.RemainingMovement;
        MaxMovement = current.MaxMovement;

        UpdateButtonStates();

        OnPropertyChanged(nameof(TurnText));
        OnPropertyChanged(nameof(ActionIndicator));
        OnPropertyChanged(nameof(BonusIndicator));
    }

    private void HandleTargetingComplete(TargetingResult result)
    {
        if (result.Success)
        {
            switch (result.Mode)
            {
                case GridInteractionMode.Attack:
                    HasAction = false;
                    break;
                case GridInteractionMode.Movement:
                    var player = _combatService?.GetPlayerCombatant();
                    if (player is not null)
                    {
                        RemainingMovement = player.RemainingMovement;
                    }
                    break;
            }

            UpdateButtonStates();
        }
    }

    private void UpdateButtonStates()
    {
        CanAttack = IsPlayerTurn && HasAction;
        CanMove = IsPlayerTurn && RemainingMovement > 0;
        CanUseAbility = IsPlayerTurn && HasAction;
    }
}
```

---

## 9. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/CombatUIStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <!-- Combatant Entry -->
    <Style Selector="Border.combatant-entry">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="CornerRadius" Value="4" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <Style Selector="Border.combatant-entry.current-turn">
        <Setter Property="BorderBrush" Value="{StaticResource WarningBrush}" />
        <Setter Property="BorderThickness" Value="2" />
    </Style>
    
    <!-- Turn Indicator -->
    <Style Selector="TextBlock.turn-indicator">
        <Setter Property="Foreground" Value="{StaticResource WarningBrush}" />
    </Style>
    
    <!-- Combatant Names -->
    <Style Selector="TextBlock.combatant-name.player">
        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
    </Style>
    
    <Style Selector="TextBlock.combatant-name.enemy">
        <Setter Property="Foreground" Value="{StaticResource DangerBrush}" />
    </Style>
    
    <!-- Status Effect Badge -->
    <Style Selector="Border.status-effect-badge">
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
        <Setter Property="CornerRadius" Value="2" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <!-- Action Bar -->
    <Style Selector="Border.action-bar">
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    </Style>
    
    <!-- Turn Info Bar -->
    <Style Selector="Border.turn-info-bar">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="CornerRadius" Value="4" />
    </Style>
    
    <Style Selector="TextBlock.turn-indicator-text.player-turn">
        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
    </Style>
    
    <!-- Action/Bonus Indicators -->
    <Style Selector="TextBlock.available">
        <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
        <Setter Property="FontWeight" Value="Bold" />
    </Style>
    
    <Style Selector="TextBlock.used">
        <Setter Property="Foreground" Value="{StaticResource DangerBrush}" />
    </Style>
    
    <!-- Action Buttons -->
    <Style Selector="Button.action-button">
        <Setter Property="Margin" Value="4" />
        <Setter Property="Padding" Value="12,8" />
        <Setter Property="HorizontalContentAlignment" Value="Center" />
        <Setter Property="MinWidth" Value="80" />
    </Style>
    
    <Style Selector="Button.action-button:disabled">
        <Setter Property="Opacity" Value="0.5" />
    </Style>
    
    <!-- End Turn Button -->
    <Style Selector="Button.end-turn-button">
        <Setter Property="Padding" Value="16,12" />
        <Setter Property="Background" Value="{StaticResource PrimaryBrush}" />
        <Setter Property="HorizontalContentAlignment" Value="Center" />
    </Style>
    
    <Style Selector="Button.end-turn-button:pointerover">
        <Setter Property="Background" Value="{StaticResource PrimaryLightBrush}" />
    </Style>
    
</Styles>
```

---

## 10. Data Model Changes

### New Types

| Type | Layer | Description |
|------|-------|-------------|
| `CombatantListPanel` | Presentation | List UserControl |
| `CombatantListViewModel` | Presentation | List view model |
| `CombatantEntryViewModel` | Presentation | Entry view model |
| `StatusEffectViewModel` | Presentation | Status icon view model |
| `CombatActionBar` | Presentation | Action bar UserControl |
| `CombatActionBarViewModel` | Presentation | Action bar view model |

### DI Registration

**File:** `src/Presentation/RuneAndRust.Avalonia/App.axaml.cs` (additions)

```csharp
services.AddTransient<CombatantListViewModel>();
services.AddTransient<CombatActionBarViewModel>();
```

---

## 11. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `CombatantListViewModel` | Debug | List refresh, turn change |
| `CombatActionBarViewModel` | Information | Button actions (attack, move, defend, etc.) |
| `CombatActionBarViewModel` | Debug | Targeting complete, state updates |

---

## 12. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| CombatantListViewModel | ~3 |
| CombatActionBarViewModel | ~4 |
| **Total** | **~7** |

### Test Specifications

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/CombatantListViewModelTests.cs`

```csharp
[TestFixture]
public class CombatantListViewModelTests
{
    [Test]
    public void RefreshCombatants_PopulatesList();

    [Test]
    public void HandleTurnChanged_UpdatesCurrentTurnEntity();

    [Test]
    public void CombatantEntry_DisplaysCorrectTurnIndicator();
}
```

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/CombatActionBarViewModelTests.cs`

```csharp
[TestFixture]
public class CombatActionBarViewModelTests
{
    [Test]
    public void AttackCommand_EntersAttackMode();

    [Test]
    public void MoveCommand_EntersMovementMode();

    [Test]
    public void DefendCommand_ConsumesAction();

    [Test]
    public void EndTurnCommand_CallsEndPlayerTurn();
}
```

---

## 13. Use Cases

### UC-073c-001: View Combatant List
**Actor:** Player
**Flow:** Combat starts â†’ List shows all combatants â†’ Sorted by initiative

### UC-073c-002: Identify Current Turn
**Actor:** Player
**Flow:** View list â†’ Current combatant shows â–º indicator â†’ Highlighted border

### UC-073c-003: View Status Effects
**Actor:** Player
**Flow:** View combatant â†’ See status effect icons â†’ Hover for description

### UC-073c-004: Initiate Attack
**Actor:** Player
**Flow:** Click Attack button â†’ Grid enters attack mode â†’ Select target

### UC-073c-005: Initiate Movement
**Actor:** Player
**Flow:** Click Move button â†’ Grid enters movement mode â†’ Select destination

### UC-073c-006: Take Defensive Stance
**Actor:** Player
**Flow:** Click Defend button â†’ Action consumed â†’ Defensive status applied

### UC-073c-007: End Turn
**Actor:** Player
**Flow:** Click End Turn â†’ Turn advances to next combatant

### UC-073c-008: View Resources
**Actor:** Player
**Flow:** View action bar â†’ See round, action points, movement remaining

---

## 14. Deliverable Checklist

### Controls
- [ ] `Controls/CombatantListPanel.axaml` created
- [ ] `Controls/CombatantListPanel.axaml.cs` created
- [ ] `Controls/CombatActionBar.axaml` created
- [ ] `Controls/CombatActionBar.axaml.cs` created

### ViewModels
- [ ] `ViewModels/CombatantListViewModel.cs` created
- [ ] `ViewModels/CombatantEntryViewModel.cs` created
- [ ] `ViewModels/CombatActionBarViewModel.cs` created

### Styles
- [ ] `Styles/CombatUIStyles.axaml` created

### Integration
- [ ] `App.axaml` includes CombatUIStyles
- [ ] GameWindow shows CombatantListPanel in RightSidebarTop
- [ ] GameWindow shows CombatActionBar in BottomContent during combat
- [ ] DI registration for view models

### Testing
- [ ] ~7 unit tests implemented
- [ ] All tests passing

---

## 15. Acceptance Criteria

### Combatant List
- [ ] Combatant list shows all entities
- [ ] List sorted by initiative (descending)
- [ ] HP bars display for each combatant
- [ ] Current turn indicator (â–º) shows
- [ ] Player name in green, enemy names in red
- [ ] Status effects display as icons
- [ ] Hover on status shows description

### Action Bar
- [ ] Action bar shows during combat
- [ ] Turn info displays (Round, Turn indicator)
- [ ] Action/bonus/move points display correctly
- [ ] Attack button enters attack mode
- [ ] Move button enters movement mode
- [ ] Defend button consumes action
- [ ] Buttons disable when unavailable
- [ ] End Turn advances to next combatant

### Integration
- [ ] CombatantListPanel in RightSidebarTop
- [ ] CombatActionBar in BottomContent
- [ ] UI updates when combat state changes

### Quality
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] ~7 unit tests pass

---

## 16. Dependencies

### Required from v0.7.3b

| Type | Location | Usage |
|------|----------|-------|
| `IGridInteractionService` | `Services/IGridInteractionService.cs` | Mode entry, targeting events |
| `GridInteractionMode` | `Services/IGridInteractionService.cs` | Mode identification |
| `TargetingResult` | `Services/IGridInteractionService.cs` | Action completion handling |

### Required from v0.7.3a

| Type | Location | Usage |
|------|----------|-------|
| `CombatGridPanel` | `Controls/CombatGridPanel.axaml` | Grid display |

### Required from v0.7.1b

| Type | Location | Usage |
|------|----------|-------|
| `HealthBarControl` | `Controls/HealthBarControl.cs` | HP visualization |

### Required from Application Layer

| Type | Location | Usage |
|------|----------|-------|
| `ICombatService` | Application layer | Combat state, actions |
| `Combatant` | Domain layer | Entity data |
| `StatusEffect` | Domain layer | Status data |

### Provides to v0.8.0 (GUI Polish)

| Type | Usage |
|------|-------|
| Complete combat UI | Foundation for polish |
| Action patterns | Consistent button handling |

---

## 17. Future Considerations

### Deferred to v0.8.0
- **Ability selection panel**: Full ability picker with details
- **Item selection panel**: Consumable picker
- **Condition icons**: Expanded status effect icons
- **Animations**: Turn transition animations

### Deferred to v0.9.0
- **Targeting preview**: Show damage/heal preview in list
- **Kill tracking**: Death strike-through in list
- **Multi-select**: Target multiple entities

### Out of Scope
- **Persistent combat log**: Separate from message log
- **Detailed stats**: Full character sheet in combat

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: Assistant*
