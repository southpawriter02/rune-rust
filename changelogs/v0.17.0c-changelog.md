# Changelog - v0.17.0c: Unique Traits

**Release Date:** 2026-01-29

## Summary

Extends the Lineage System with unique traits for each bloodline, providing signature abilities that define lineage identity.

---

## Added

### Domain Layer - Enums

- **`LineageTraitEffectType`** - New enum defining 4 trait effect types:
    - `BonusDiceToSkill (0)` — Adds dice to skill checks
    - `PercentageModifier (1)` — Scales values by percentage
    - `BonusDiceToResolve (2)` — Adds dice to resolve checks
    - `PassiveAuraBonus (3)` — Percentage bonus to resource pools

### Domain Layer - Value Objects

- **`LineageTrait`** - New value object representing unique lineage traits:
    - Properties: TraitId, TraitName, Description, EffectType, TriggerCondition, BonusDice, PercentModifier, TargetCheck, TargetCondition
    - Helper properties: UsesBonusDice, UsesPercentModifier, HasTargetCondition, EffectiveBonusDice, EffectivePercentModifier
    - Create factory method with effect-type validation
    - Static trait properties:
        - `SurvivorsResolve` (Clan-Born) — +1d10 Rhetoric checks vs Clan-Born NPCs
        - `AetherTainted` (Rune-Marked) — +10% Maximum Aether Pool
        - `HazardAcclimation` (Iron-Blooded) — +1d10 Sturdiness Resolve vs hazards
        - `PrimalClarity` (Vargr-Kin) — -10% Psychic Stress

### Domain Layer - Entity Updates

- **`LineageDefinition`** - Extended with unique trait support:
    - New `UniqueTrait` property
    - Updated `Create()` factory method to accept trait parameter
    - New helper methods: `GetTraitName()`, `GetTraitDescription()`, `HasBonusDiceTrait()`, `HasPercentModifierTrait()`, `GetTrait()`
    - Updated ToString() to include trait name

### Configuration

- **`lineages.json`** - Added `uniqueTrait` objects for all 4 lineages (version 1.0 → 1.1)
- **`lineages.schema.json`** - Added `lineageTrait` definition with conditional validation for effect types

### Unit Tests

- **`LineageTraitEffectTypeTests.cs`** - 2 tests verifying enum values
- **`LineageTraitTests.cs`** - 8 tests covering Create validation, static properties, and helper behavior

---

## Changed

- Updated `LineageDefinitionTests.cs` to include trait parameter in all Create calls
- Version header in `LineageDefinition.cs` updated from 0.17.0b to 0.17.0c

---

## Dependencies

- **Requires:** v0.17.0a (Lineage enum, CoreAttribute), v0.17.0b (PassiveBonuses)
- **Enables:** v0.17.0d (Trauma Economy), v0.17.0e (ILineageProvider), v0.17.0f (ILineageApplicationService)

---

## Technical Notes

1. **Effect Type Validation:** The `Create` factory method validates that:
    - BonusDiceToSkill/BonusDiceToResolve effects have positive BonusDice
    - PercentageModifier/PassiveAuraBonus effects have PercentModifier

2. **Conditional Schema Validation:** The JSON schema uses `allOf` with `if/then` to enforce effect-specific property requirements

3. **Trait ID Normalization:** All trait IDs are normalized to lowercase with `ToLowerInvariant()`
