{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://runeandrust.com/schemas/lineages.schema.json",
    "title": "Lineage Definitions Schema",
    "description": "Schema for validating lineage configuration in Rune and Rust. Defines bloodline heritage options for character creation.",
    "type": "object",
    "required": ["version", "lineages"],
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to this schema file for validation."
        },
        "version": {
            "type": "string",
            "description": "Schema version for backwards compatibility.",
            "pattern": "^\\d+\\.\\d+$"
        },
        "lineages": {
            "type": "array",
            "description": "Array of lineage definitions available for character creation.",
            "minItems": 1,
            "items": {
                "$ref": "#/definitions/lineageDefinition"
            }
        }
    },
    "definitions": {
        "lineageDefinition": {
            "type": "object",
            "description": "A single lineage definition with metadata and attribute modifiers.",
            "required": [
                "id",
                "lineageType",
                "displayName",
                "description",
                "selectionText",
                "attributeModifiers",
                "passiveBonuses",
                "uniqueTrait"
            ],
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique kebab-case identifier for this lineage.",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "examples": ["clan-born", "rune-marked", "iron-blooded", "vargr-kin"]
                },
                "lineageType": {
                    "type": "string",
                    "description": "The enum value matching the Lineage enum in C# code.",
                    "enum": ["ClanBorn", "RuneMarked", "IronBlooded", "VargrKin"]
                },
                "displayName": {
                    "type": "string",
                    "description": "Human-readable name shown to players.",
                    "minLength": 1,
                    "maxLength": 50
                },
                "description": {
                    "type": "string",
                    "description": "Full lore description of the lineage.",
                    "minLength": 50,
                    "maxLength": 1000
                },
                "selectionText": {
                    "type": "string",
                    "description": "Short text displayed during character creation selection.",
                    "minLength": 10,
                    "maxLength": 200
                },
                "attributeModifiers": {
                    "$ref": "#/definitions/attributeModifiers"
                },
                "appearanceNotes": {
                    "type": "string",
                    "description": "Optional notes about typical physical appearance.",
                    "maxLength": 500
                },
                "socialRole": {
                    "type": "string",
                    "description": "Optional description of typical social role in Aethelgard.",
                    "maxLength": 500
                },
                "passiveBonuses": {
                    "$ref": "#/definitions/passiveBonuses"
                },
                "uniqueTrait": {
                    "$ref": "#/definitions/lineageTrait"
                }
            },
            "additionalProperties": false
        },
        "attributeModifiers": {
            "type": "object",
            "description": "Attribute modifiers applied by this lineage.",
            "required": [
                "might",
                "finesse",
                "wits",
                "will",
                "sturdiness",
                "hasFlexibleBonus",
                "flexibleBonusAmount"
            ],
            "properties": {
                "might": {
                    "type": "integer",
                    "description": "Modifier to MIGHT attribute.",
                    "minimum": -3,
                    "maximum": 3
                },
                "finesse": {
                    "type": "integer",
                    "description": "Modifier to FINESSE attribute.",
                    "minimum": -3,
                    "maximum": 3
                },
                "wits": {
                    "type": "integer",
                    "description": "Modifier to WITS attribute.",
                    "minimum": -3,
                    "maximum": 3
                },
                "will": {
                    "type": "integer",
                    "description": "Modifier to WILL attribute.",
                    "minimum": -3,
                    "maximum": 3
                },
                "sturdiness": {
                    "type": "integer",
                    "description": "Modifier to STURDINESS attribute.",
                    "minimum": -3,
                    "maximum": 3
                },
                "hasFlexibleBonus": {
                    "type": "boolean",
                    "description": "Whether this lineage grants a player-chosen bonus."
                },
                "flexibleBonusAmount": {
                    "type": "integer",
                    "description": "The amount of the flexible bonus (if hasFlexibleBonus is true).",
                    "minimum": 0,
                    "maximum": 3
                }
            },
            "additionalProperties": false
        },
        "passiveBonuses": {
            "type": "object",
            "description": "Passive stat and skill bonuses granted by this lineage.",
            "required": [
                "maxHpBonus",
                "maxApBonus",
                "soakBonus",
                "movementBonus",
                "skillBonuses"
            ],
            "properties": {
                "maxHpBonus": {
                    "type": "integer",
                    "description": "Bonus added to Max HP calculation.",
                    "minimum": 0,
                    "maximum": 20
                },
                "maxApBonus": {
                    "type": "integer",
                    "description": "Bonus added to Max AP (Aether Pool) calculation.",
                    "minimum": 0,
                    "maximum": 20
                },
                "soakBonus": {
                    "type": "integer",
                    "description": "Bonus added to damage reduction (Soak).",
                    "minimum": 0,
                    "maximum": 10
                },
                "movementBonus": {
                    "type": "integer",
                    "description": "Bonus added to movement range in tiles.",
                    "minimum": 0,
                    "maximum": 5
                },
                "skillBonuses": {
                    "type": "array",
                    "description": "Array of skill bonuses granted by this lineage.",
                    "items": {
                        "$ref": "#/definitions/skillBonus"
                    }
                }
            },
            "additionalProperties": false
        },
        "skillBonus": {
            "type": "object",
            "description": "A bonus to a specific skill.",
            "required": ["skillId", "bonusAmount"],
            "properties": {
                "skillId": {
                    "type": "string",
                    "description": "The kebab-case skill identifier.",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "examples": ["social", "lore", "craft", "survival"]
                },
                "bonusAmount": {
                    "type": "integer",
                    "description": "The bonus amount to apply to skill checks.",
                    "minimum": -5,
                    "maximum": 5
                }
            },
            "additionalProperties": false
        },
        "lineageTrait": {
            "type": "object",
            "description": "A unique trait granted by the lineage.",
            "required": [
                "traitId",
                "traitName",
                "description",
                "effectType"
            ],
            "properties": {
                "traitId": {
                    "type": "string",
                    "description": "Unique snake_case identifier for this trait.",
                    "pattern": "^[a-z][a-z0-9_]*$",
                    "examples": ["survivors_resolve", "aether_tainted", "hazard_acclimation", "primal_clarity"]
                },
                "traitName": {
                    "type": "string",
                    "description": "Display name with brackets for player-facing presentation.",
                    "pattern": "^\\[.+\\]$",
                    "examples": ["[Survivor's Resolve]", "[Aether-Tainted]", "[Hazard Acclimation]", "[Primal Clarity]"]
                },
                "description": {
                    "type": "string",
                    "description": "Player-facing explanation of the trait effect.",
                    "minLength": 10,
                    "maxLength": 500
                },
                "effectType": {
                    "type": "string",
                    "description": "The type of effect this trait applies.",
                    "enum": ["BonusDiceToSkill", "PercentageModifier", "BonusDiceToResolve", "PassiveAuraBonus"]
                },
                "triggerCondition": {
                    "type": "string",
                    "description": "Optional condition string for when the trait activates.",
                    "maxLength": 200
                },
                "bonusDice": {
                    "type": "integer",
                    "description": "Number of bonus dice (required for BonusDiceToSkill and BonusDiceToResolve effects).",
                    "minimum": 1,
                    "maximum": 5
                },
                "percentModifier": {
                    "type": "number",
                    "description": "Percentage modifier (required for PercentageModifier and PassiveAuraBonus effects). Positive increases, negative decreases.",
                    "minimum": -1.0,
                    "maximum": 1.0
                },
                "targetCheck": {
                    "type": "string",
                    "description": "Optional skill or resolve check type affected.",
                    "pattern": "^[a-z][a-z0-9_-]*$",
                    "examples": ["rhetoric", "sturdiness", "lore"]
                },
                "targetCondition": {
                    "type": "string",
                    "description": "Optional condition for valid targets.",
                    "maxLength": 200,
                    "examples": ["npc.lineage == ClanBorn", "source.type == environmental_hazard"]
                }
            },
            "additionalProperties": false,
            "allOf": [
                {
                    "if": {
                        "properties": { "effectType": { "enum": ["BonusDiceToSkill", "BonusDiceToResolve"] } }
                    },
                    "then": {
                        "required": ["bonusDice"]
                    }
                },
                {
                    "if": {
                        "properties": { "effectType": { "enum": ["PercentageModifier", "PassiveAuraBonus"] } }
                    },
                    "then": {
                        "required": ["percentModifier"]
                    }
                }
            ]
        }
    }
}
