# v0.16.3a Design Specification: Equipment Class Mapping

**Version:** 0.16.3a  
**Phase Name:** Equipment Class Mapping  
**Parent Version:** v0.16.3 (Smart Loot Generation)  
**Prerequisites:** v0.16.2 Complete (Armor Proficiency System)  
**Estimated Tests:** ~2 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [EquipmentClassAffinity Enum](#4-equipmentclassaffinity-enum)
5. [EquipmentClassMapping Value Object](#5-equipmentclassmapping-value-object)
6. [IEquipmentClassMappingProvider Interface](#6-iequipmentclassmappingprovider-interface)
7. [Data Model Changes](#7-data-model-changes)
8. [Configuration File Schemas](#8-configuration-file-schemas)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the equipment-to-archetype affinity mapping system. Equipment Class Mapping determines which equipment categories are "appropriate" for each archetype, enabling the smart loot system (v0.16.3b-d) to bias drops toward gear the player can effectively use.

The five class affinities are:

- **Warrior**: MIGHT-scaling weapons (Axes, Greatswords, Hammers), Heavy armor
- **Skirmisher**: FINESSE-scaling weapons (Daggers, Blades, Bows), Light/Medium armor
- **Mystic**: WILL-scaling implements (Staves, Foci, Orbs), Light armor only
- **Adept**: WITS-scaling gear (Crossbows, Arc-Cannons), Light armor only
- **Universal**: Equipment usable by all archetypes (Light armor, basic items)

This phase establishes the foundation data structures that v0.16.3b's smart loot algorithm depends upon.

### 1.2 Key Deliverables

| Category          | Items                                                                 |
| ----------------- | --------------------------------------------------------------------- |
| **Enums**         | `EquipmentClassAffinity`                                              |
| **Value Objects** | `EquipmentClassMapping`                                               |
| **Interfaces**    | `IEquipmentClassMappingProvider`                                      |
| **Configuration** | `equipment-class-mapping.json`, `equipment-class-mapping.schema.json` |
| **Tests**         | ~2 unit tests                                                         |

### 1.3 Architectural Significance

This version establishes the **Equipment Affinity Pattern**:

- **Enum-Based Class Identification**: All equipment references an `EquipmentClassAffinity` value
- **Attribute Alignment**: Each affinity maps to a primary attribute (MIGHT, FINESSE, WILL, WITS)
- **Provider Pattern**: `IEquipmentClassMappingProvider` centralizes affinity data access
- **Configuration-Driven**: All mappings loaded from JSON for easy balance adjustments

---

## 2. Feature Overview

```
v0.16.3a Equipment Class Mapping
├── EquipmentClassAffinity Enum (5 affinities)
│   ├── Warrior (0) — MIGHT-based equipment
│   ├── Skirmisher (1) — FINESSE-based equipment
│   ├── Mystic (2) — WILL-based equipment
│   ├── Adept (3) — WITS-based equipment
│   └── Universal (4) — All classes can use
├── EquipmentClassMapping Value Object
│   ├── CategoryId: string (e.g., "axes", "daggers")
│   ├── DisplayName: string
│   ├── Affinity: EquipmentClassAffinity
│   ├── PrimaryAttribute: string (e.g., "MIGHT")
│   ├── EquipmentSlot: string (e.g., "Weapon", "Armor")
│   └── ExampleItems: IReadOnlyList<string>
└── IEquipmentClassMappingProvider Interface
    ├── GetMapping(categoryId): EquipmentClassMapping
    ├── GetMappingsForAffinity(affinity): IReadOnlyList<EquipmentClassMapping>
    ├── GetAffinityForCategory(categoryId): EquipmentClassAffinity
    └── IsClassAppropriate(categoryId, archetypeId): bool
```

### 2.1 Equipment Category to Affinity Matrix

| Category     | Affinity   | Attribute | Slot      |
| ------------ | ---------- | --------- | --------- |
| Axes         | Warrior    | MIGHT     | Weapon    |
| Greatswords  | Warrior    | MIGHT     | Weapon    |
| Hammers      | Warrior    | MIGHT     | Weapon    |
| Heavy Armor  | Warrior    | MIGHT     | Armor     |
| Daggers      | Skirmisher | FINESSE   | Weapon    |
| Blades       | Skirmisher | FINESSE   | Weapon    |
| Bows         | Skirmisher | FINESSE   | Weapon    |
| Medium Armor | Skirmisher | FINESSE   | Armor     |
| Staves       | Mystic     | WILL      | Weapon    |
| Foci         | Mystic     | WILL      | Weapon    |
| Orbs         | Mystic     | WILL      | Weapon    |
| Crossbows    | Adept      | WITS      | Weapon    |
| Arc-Cannons  | Adept      | WITS      | Weapon    |
| Light Armor  | Universal  | —         | Armor     |
| Accessories  | Universal  | —         | Accessory |

### 2.2 Scope Alignment

**In Scope:**

- `EquipmentClassAffinity` enum with 5 values
- `EquipmentClassMapping` value object with category metadata
- `IEquipmentClassMappingProvider` interface for mapping access
- `equipment-class-mapping.json` configuration file
- `equipment-class-mapping.schema.json` validation schema

**Out of Scope:**

- Smart loot algorithm (v0.16.3b)
- Weighted selection (v0.16.3c)
- Loot service integration (v0.16.3d)
- Stat verification (v0.16.3e)

---

## 3. Architecture Diagrams

### 3.1 Equipment Class Mapping System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│             EQUIPMENT CLASS MAPPING SYSTEM OVERVIEW                  │
└─────────────────────────────────────────────────────────────────────┘

    Loot Generation Request
           │
           │  Check player archetype
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  IEquipmentClassMappingProvider                      │
├─────────────────────────────────────────────────────────────────────┤
│  + GetMapping(categoryId): EquipmentClassMapping                    │
│  + GetMappingsForAffinity(affinity): IReadOnlyList<Mapping>         │
│  + GetAffinityForCategory(categoryId): EquipmentClassAffinity       │
│  + IsClassAppropriate(categoryId, archetypeId): bool                │
│  + GetAllMappings(): IReadOnlyList<EquipmentClassMapping>           │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Returns mapping data
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                     EquipmentClassMapping                            │
├─────────────────────────────────────────────────────────────────────┤
│  CategoryId: string            (e.g., "axes", "daggers")            │
│  DisplayName: string           (e.g., "Axes", "Daggers")            │
│  Affinity: EquipmentClassAffinity (e.g., Warrior, Skirmisher)       │
│  PrimaryAttribute: string      (e.g., "MIGHT", "FINESSE")           │
│  EquipmentSlot: string         (e.g., "Weapon", "Armor")            │
│  ExampleItems: List<string>    (e.g., ["Hand Axe", "Bearded Axe"])  │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Uses affinity enum
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    EquipmentClassAffinity                            │
├─────────────────────────────────────────────────────────────────────┤
│  Warrior (0)    │  Skirmisher (1)  │  Mystic (2)  │  Adept (3)     │
│                               Universal (4)                         │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Affinity Lookup Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│                 AFFINITY LOOKUP DECISION TREE                        │
└─────────────────────────────────────────────────────────────────────┘

    Equipment Item Drops
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  GET CATEGORY FROM ITEM                                          │
    │  (e.g., "axes", "daggers", "staves")                            │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  LOOKUP AFFINITY FROM MAPPING                                    │
    ├──────────────────────────────────────────────────────────────────┤
    │  Category "axes"      → Warrior                                  │
    │  Category "daggers"   → Skirmisher                               │
    │  Category "staves"    → Mystic                                   │
    │  Category "crossbows" → Adept                                    │
    │  Category "light-armor" → Universal                              │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  COMPARE TO PLAYER ARCHETYPE                                     │
    ├──────────────────────────────────────────────────────────────────┤
    │  Affinity == Universal?                                          │
    │    → Class Appropriate (all archetypes)                          │
    │                                                                  │
    │  Archetype == "warrior" AND Affinity == Warrior?                 │
    │    → Class Appropriate                                           │
    │                                                                  │
    │  Archetype == "skirmisher" AND Affinity == Skirmisher?           │
    │    → Class Appropriate                                           │
    │                                                                  │
    │  Otherwise:                                                      │
    │    → NOT Class Appropriate                                       │
    └──────────────────────────────────────────────────────────────────┘
```

### 3.3 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  LootDropNotification                                                │
│  └── Shows "Class Appropriate" indicator on drops                   │
│                                                                      │
│  EquipmentTooltip                                                    │
│  └── Displays affinity and recommended class                        │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │           EquipmentClassMappingProvider                        │  │
│  │       (implements IEquipmentClassMappingProvider)              │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  + GetMapping(categoryId): EquipmentClassMapping              │  │
│  │  + GetMappingsForAffinity(affinity): List                     │  │
│  │  + GetAffinityForCategory(categoryId): EquipmentClassAffinity │  │
│  │  + IsClassAppropriate(categoryId, archetypeId): bool          │  │
│  │                                                               │  │
│  │  - _mappings: Dictionary<string, EquipmentClassMapping>       │  │
│  │  - LoadConfiguration(): void (from JSON)                      │  │
│  └───────────────────────────────────────────────────────────────┘  │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────┐  ┌────────────────────────────────┐   │
│  │ EquipmentClassAffinity  │  │   EquipmentClassMapping        │   │
│  │        (Enum)           │  │      (Value Object)            │   │
│  ├─────────────────────────┤  ├────────────────────────────────┤   │
│  │ Warrior = 0             │  │ CategoryId: string             │   │
│  │ Skirmisher = 1          │  │ DisplayName: string            │   │
│  │ Mystic = 2              │  │ Affinity: EquipmentClassAffinity│  │
│  │ Adept = 3               │  │ PrimaryAttribute: string       │   │
│  │ Universal = 4           │  │ EquipmentSlot: string          │   │
│  └─────────────────────────┘  │ ExampleItems: List<string>     │   │
│                               └────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. EquipmentClassAffinity Enum

### 4.1 Purpose

The `EquipmentClassAffinity` enum identifies which archetype an equipment category is designed for. This enables the smart loot system to filter drops appropriately.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/EquipmentClassAffinity.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Identifies which archetype an equipment category is designed for.
/// </summary>
/// <remarks>
/// <para>
/// Equipment class affinity enables smart loot generation to bias drops
/// toward gear appropriate for the player's archetype.
/// </para>
/// <para>
/// Each archetype aligns with a primary attribute:
/// - Warrior → MIGHT (heavy weapons, heavy armor)
/// - Skirmisher → FINESSE (agile weapons, medium armor)
/// - Mystic → WILL (arcane implements, light armor)
/// - Adept → WITS (technical equipment, light armor)
/// - Universal → All (light armor, basic items)
/// </para>
/// <para>
/// Values are explicitly assigned (0-4) for stable serialization.
/// </para>
/// </remarks>
public enum EquipmentClassAffinity
{
    /// <summary>
    /// Equipment designed for Warriors.
    /// </summary>
    /// <remarks>
    /// MIGHT-scaling weapons (axes, greatswords, hammers) and heavy armor.
    /// </remarks>
    Warrior = 0,

    /// <summary>
    /// Equipment designed for Skirmishers.
    /// </summary>
    /// <remarks>
    /// FINESSE-scaling weapons (daggers, blades, bows) and medium armor.
    /// </remarks>
    Skirmisher = 1,

    /// <summary>
    /// Equipment designed for Mystics.
    /// </summary>
    /// <remarks>
    /// WILL-scaling implements (staves, foci, orbs). Only light armor proficient.
    /// </remarks>
    Mystic = 2,

    /// <summary>
    /// Equipment designed for Adepts.
    /// </summary>
    /// <remarks>
    /// WITS-scaling equipment (crossbows, arc-cannons). Only light armor proficient.
    /// </remarks>
    Adept = 3,

    /// <summary>
    /// Equipment usable by all archetypes.
    /// </summary>
    /// <remarks>
    /// Light armor, basic tools, and universal accessories.
    /// </remarks>
    Universal = 4
}
```

### 4.3 Affinity Reference Table

| Enum Value   | Int | Primary Attribute | Typical Equipment        |
| ------------ | --- | ----------------- | ------------------------ |
| `Warrior`    | 0   | MIGHT             | Axes, Greatswords, Heavy |
| `Skirmisher` | 1   | FINESSE           | Daggers, Bows, Medium    |
| `Mystic`     | 2   | WILL              | Staves, Foci, Orbs       |
| `Adept`      | 3   | WITS              | Crossbows, Arc-Cannons   |
| `Universal`  | 4   | —                 | Light Armor, Accessories |

---

## 5. EquipmentClassMapping Value Object

### 5.1 Purpose

The `EquipmentClassMapping` value object associates an equipment category with its archetype affinity, primary attribute, and slot type.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/EquipmentClassMapping.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Maps an equipment category to its archetype affinity.
/// </summary>
/// <remarks>
/// <para>
/// EquipmentClassMapping is loaded from configuration and provides the
/// data needed for smart loot generation to filter drops by class.
/// </para>
/// </remarks>
/// <param name="CategoryId">Unique category identifier (e.g., "axes", "daggers").</param>
/// <param name="DisplayName">Human-readable category name.</param>
/// <param name="Affinity">The archetype this category is designed for.</param>
/// <param name="PrimaryAttribute">The attribute this category scales with.</param>
/// <param name="EquipmentSlot">The slot type (Weapon, Armor, Accessory).</param>
/// <param name="ExampleItems">Example item names for reference.</param>
public readonly record struct EquipmentClassMapping(
    string CategoryId,
    string DisplayName,
    EquipmentClassAffinity Affinity,
    string PrimaryAttribute,
    string EquipmentSlot,
    IReadOnlyList<string> ExampleItems)
{
    /// <summary>
    /// Gets whether this is universal (appropriate for all classes).
    /// </summary>
    public bool IsUniversal => Affinity == EquipmentClassAffinity.Universal;

    /// <summary>
    /// Gets whether this is a weapon category.
    /// </summary>
    public bool IsWeapon => EquipmentSlot.Equals("Weapon", StringComparison.OrdinalIgnoreCase);

    /// <summary>
    /// Gets whether this is an armor category.
    /// </summary>
    public bool IsArmor => EquipmentSlot.Equals("Armor", StringComparison.OrdinalIgnoreCase);

    /// <summary>
    /// Gets whether this is an accessory category.
    /// </summary>
    public bool IsAccessory => EquipmentSlot.Equals("Accessory", StringComparison.OrdinalIgnoreCase);

    /// <summary>
    /// Checks if this category is appropriate for an archetype.
    /// </summary>
    /// <param name="archetypeId">The archetype to check (e.g., "warrior").</param>
    /// <returns>True if appropriate for the archetype or universal.</returns>
    public bool IsAppropriateFor(string archetypeId)
    {
        if (IsUniversal) return true;

        return archetypeId.ToLowerInvariant() switch
        {
            "warrior" => Affinity == EquipmentClassAffinity.Warrior,
            "skirmisher" => Affinity == EquipmentClassAffinity.Skirmisher,
            "mystic" => Affinity == EquipmentClassAffinity.Mystic,
            "adept" => Affinity == EquipmentClassAffinity.Adept,
            _ => false
        };
    }

    /// <summary>
    /// Creates an EquipmentClassMapping with validation.
    /// </summary>
    public static EquipmentClassMapping Create(
        string categoryId,
        string displayName,
        EquipmentClassAffinity affinity,
        string primaryAttribute,
        string equipmentSlot,
        IReadOnlyList<string> exampleItems)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(categoryId);
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
        ArgumentException.ThrowIfNullOrWhiteSpace(equipmentSlot);
        ArgumentNullException.ThrowIfNull(exampleItems);

        return new EquipmentClassMapping(
            categoryId.ToLowerInvariant(),
            displayName,
            affinity,
            primaryAttribute ?? string.Empty,
            equipmentSlot,
            exampleItems);
    }

    /// <summary>
    /// Formats example items as comma-separated string.
    /// </summary>
    public string FormatExamples() => string.Join(", ", ExampleItems);

    /// <summary>
    /// Creates a display string for debug/logging.
    /// </summary>
    public override string ToString() =>
        $"{DisplayName} ({CategoryId}): {Affinity} [{PrimaryAttribute}]";
}
```

---

## 6. IEquipmentClassMappingProvider Interface

### 6.1 Purpose

The `IEquipmentClassMappingProvider` interface abstracts access to equipment-to-class mapping data.

### 6.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Interfaces/IEquipmentClassMappingProvider.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Provides access to equipment class mapping data.
/// </summary>
public interface IEquipmentClassMappingProvider
{
    /// <summary>
    /// Gets the mapping for a specific category.
    /// </summary>
    EquipmentClassMapping GetMapping(string categoryId);

    /// <summary>
    /// Gets all mappings for a specific affinity.
    /// </summary>
    IReadOnlyList<EquipmentClassMapping> GetMappingsForAffinity(EquipmentClassAffinity affinity);

    /// <summary>
    /// Gets the affinity for a category.
    /// </summary>
    EquipmentClassAffinity GetAffinityForCategory(string categoryId);

    /// <summary>
    /// Checks if a category is appropriate for an archetype.
    /// </summary>
    bool IsClassAppropriate(string categoryId, string archetypeId);

    /// <summary>
    /// Gets all configured mappings.
    /// </summary>
    IReadOnlyList<EquipmentClassMapping> GetAllMappings();

    /// <summary>
    /// Gets categories appropriate for an archetype (includes Universal).
    /// </summary>
    IReadOnlyList<EquipmentClassMapping> GetAppropriateCategories(string archetypeId);

    /// <summary>
    /// Validates configuration completeness.
    /// </summary>
    bool ValidateConfiguration();
}
```

### 6.3 Usage Examples

```csharp
// Get affinity for axes
var affinity = _provider.GetAffinityForCategory("axes");
Console.WriteLine($"Axes affinity: {affinity}");  // Warrior

// Check if daggers are appropriate for Skirmisher
var isAppropriate = _provider.IsClassAppropriate("daggers", "skirmisher");
Console.WriteLine($"Daggers for Skirmisher: {isAppropriate}");  // True

// Get all categories appropriate for Mystic
var mysticGear = _provider.GetAppropriateCategories("mystic");
// Returns: staves, foci, orbs, light-armor, accessories
```

---

## 7. Data Model Changes

### 7.1 New Types Summary

| Type                             | Layer       | Category     | Description                  |
| -------------------------------- | ----------- | ------------ | ---------------------------- |
| `EquipmentClassAffinity`         | Domain      | Enum         | 5 archetype affinities       |
| `EquipmentClassMapping`          | Domain      | Value Object | Category-to-affinity mapping |
| `IEquipmentClassMappingProvider` | Application | Interface    | Mapping data access          |

### 7.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── Enums/
│   └── EquipmentClassAffinity.cs              ← NEW
└── ValueObjects/
    └── EquipmentClassMapping.cs               ← NEW

src/Core/RuneAndRust.Application/
└── Interfaces/
    └── IEquipmentClassMappingProvider.cs      ← NEW

config/
├── equipment-class-mapping.json               ← NEW
└── schemas/
    └── equipment-class-mapping.schema.json    ← NEW
```

---

## 8. Configuration File Schemas

### 8.1 equipment-class-mapping.json

**File:** `config/equipment-class-mapping.json`

```json
{
    "$schema": "./schemas/equipment-class-mapping.schema.json",
    "mappings": [
        {
            "categoryId": "axes",
            "displayName": "Axes",
            "affinity": "Warrior",
            "primaryAttribute": "MIGHT",
            "equipmentSlot": "Weapon",
            "exampleItems": [
                "Hand Axe",
                "Bearded Axe",
                "Greataxe",
                "Throwing Axe"
            ]
        },
        {
            "categoryId": "greatswords",
            "displayName": "Greatswords",
            "affinity": "Warrior",
            "primaryAttribute": "MIGHT",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Claymore", "Zweihander", "Flamberge"]
        },
        {
            "categoryId": "hammers",
            "displayName": "Hammers",
            "affinity": "Warrior",
            "primaryAttribute": "MIGHT",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Mace", "War Hammer", "Maul", "Morning Star"]
        },
        {
            "categoryId": "daggers",
            "displayName": "Daggers",
            "affinity": "Skirmisher",
            "primaryAttribute": "FINESSE",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Knife", "Stiletto", "Dirk", "Throwing Knife"]
        },
        {
            "categoryId": "blades",
            "displayName": "Blades",
            "affinity": "Skirmisher",
            "primaryAttribute": "FINESSE",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Short Sword", "Saber", "Rapier", "Scimitar"]
        },
        {
            "categoryId": "bows",
            "displayName": "Bows",
            "affinity": "Skirmisher",
            "primaryAttribute": "FINESSE",
            "equipmentSlot": "Weapon",
            "exampleItems": [
                "Shortbow",
                "Longbow",
                "Recurve Bow",
                "Composite Bow"
            ]
        },
        {
            "categoryId": "staves",
            "displayName": "Staves",
            "affinity": "Mystic",
            "primaryAttribute": "WILL",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Quarterstaff", "Walking Stick", "Iron-Shod Staff"]
        },
        {
            "categoryId": "foci",
            "displayName": "Foci",
            "affinity": "Mystic",
            "primaryAttribute": "WILL",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Wand", "Rod", "Channeling Crystal"]
        },
        {
            "categoryId": "orbs",
            "displayName": "Orbs",
            "affinity": "Mystic",
            "primaryAttribute": "WILL",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Crystal Orb", "Spirit Sphere", "Runestone"]
        },
        {
            "categoryId": "crossbows",
            "displayName": "Crossbows",
            "affinity": "Adept",
            "primaryAttribute": "WITS",
            "equipmentSlot": "Weapon",
            "exampleItems": [
                "Light Crossbow",
                "Heavy Crossbow",
                "Repeating Crossbow"
            ]
        },
        {
            "categoryId": "arc-cannons",
            "displayName": "Arc-Cannons",
            "affinity": "Adept",
            "primaryAttribute": "WITS",
            "equipmentSlot": "Weapon",
            "exampleItems": ["Tesla Projector", "Lightning Rod", "Shock Lance"]
        },
        {
            "categoryId": "heavy-armor",
            "displayName": "Heavy Armor",
            "affinity": "Warrior",
            "primaryAttribute": "STURDINESS",
            "equipmentSlot": "Armor",
            "exampleItems": ["Half Plate", "Full Plate", "Fortress Armor"]
        },
        {
            "categoryId": "medium-armor",
            "displayName": "Medium Armor",
            "affinity": "Skirmisher",
            "primaryAttribute": "FINESSE",
            "equipmentSlot": "Armor",
            "exampleItems": ["Chain Mail", "Scale Mail", "Brigandine"]
        },
        {
            "categoryId": "light-armor",
            "displayName": "Light Armor",
            "affinity": "Universal",
            "primaryAttribute": "",
            "equipmentSlot": "Armor",
            "exampleItems": ["Cloth Armor", "Leather Armor", "Padded Armor"]
        },
        {
            "categoryId": "accessories",
            "displayName": "Accessories",
            "affinity": "Universal",
            "primaryAttribute": "",
            "equipmentSlot": "Accessory",
            "exampleItems": ["Ring", "Amulet", "Tool Belt", "Cloak"]
        }
    ]
}
```

### 8.2 equipment-class-mapping.schema.json

**File:** `config/schemas/equipment-class-mapping.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "equipment-class-mapping.schema.json",
    "title": "Equipment Class Mapping Configuration",
    "description": "Defines equipment category to archetype affinity mappings",
    "type": "object",
    "required": ["mappings"],
    "properties": {
        "$schema": { "type": "string" },
        "mappings": {
            "type": "array",
            "minItems": 1,
            "items": { "$ref": "#/$defs/equipmentMapping" }
        }
    },
    "$defs": {
        "equipmentMapping": {
            "type": "object",
            "required": [
                "categoryId",
                "displayName",
                "affinity",
                "equipmentSlot",
                "exampleItems"
            ],
            "properties": {
                "categoryId": {
                    "type": "string",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 2,
                    "maxLength": 50
                },
                "displayName": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 100
                },
                "affinity": {
                    "type": "string",
                    "enum": [
                        "Warrior",
                        "Skirmisher",
                        "Mystic",
                        "Adept",
                        "Universal"
                    ]
                },
                "primaryAttribute": {
                    "type": "string",
                    "maxLength": 20
                },
                "equipmentSlot": {
                    "type": "string",
                    "enum": ["Weapon", "Armor", "Accessory"]
                },
                "exampleItems": {
                    "type": "array",
                    "minItems": 1,
                    "items": { "type": "string" }
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component                       | Level       | Events                          |
| ------------------------------- | ----------- | ------------------------------- |
| `EquipmentClassMappingProvider` | Information | Configuration loaded            |
| `EquipmentClassMappingProvider` | Debug       | Individual mapping retrieved    |
| `EquipmentClassMappingProvider` | Warning     | Unknown category requested      |
| `EquipmentClassMappingProvider` | Error       | Configuration validation failed |

### 9.2 Log Message Templates

```csharp
// Information - Configuration loaded
_logger.LogInformation(
    "Loaded {MappingCount} equipment class mappings from configuration",
    mappings.Count);

// Debug - Mapping retrieved
_logger.LogDebug(
    "Retrieved equipment mapping for category {CategoryId}: Affinity={Affinity}",
    categoryId, mapping.Affinity);

// Warning - Unknown category
_logger.LogWarning(
    "Unknown equipment category requested: {CategoryId}, returning Universal",
    categoryId);

// Error - Validation failed
_logger.LogError(
    "Equipment class mapping configuration invalid: {ValidationErrors}",
    string.Join(", ", errors));
```

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature                | Test Count |
| ---------------------- | ---------- |
| EquipmentClassAffinity | ~1         |
| EquipmentClassMapping  | ~1         |
| **Total**              | **~2**     |

### 10.2 Test Specifications

**File:** `tests/RuneAndRust.Domain.UnitTests/Enums/EquipmentClassAffinityTests.cs`

```csharp
[TestFixture]
public class EquipmentClassAffinityTests
{
    [Test]
    public void EquipmentClassAffinity_HasFiveValues_WithCorrectIntegerAssignments()
    {
        // Arrange & Act
        var affinities = Enum.GetValues<EquipmentClassAffinity>();

        // Assert
        affinities.Should().HaveCount(5);
        ((int)EquipmentClassAffinity.Warrior).Should().Be(0);
        ((int)EquipmentClassAffinity.Skirmisher).Should().Be(1);
        ((int)EquipmentClassAffinity.Mystic).Should().Be(2);
        ((int)EquipmentClassAffinity.Adept).Should().Be(3);
        ((int)EquipmentClassAffinity.Universal).Should().Be(4);
    }
}
```

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/EquipmentClassMappingTests.cs`

```csharp
[TestFixture]
public class EquipmentClassMappingTests
{
    [Test]
    public void IsAppropriateFor_WarriorAffinityWithWarriorArchetype_ReturnsTrue()
    {
        // Arrange
        var mapping = EquipmentClassMapping.Create(
            "axes",
            "Axes",
            EquipmentClassAffinity.Warrior,
            "MIGHT",
            "Weapon",
            new[] { "Hand Axe", "Greataxe" });

        // Act
        var result = mapping.IsAppropriateFor("warrior");

        // Assert
        result.Should().BeTrue();
    }

    [Test]
    public void IsAppropriateFor_UniversalAffinity_ReturnsTrueForAllArchetypes()
    {
        // Arrange
        var mapping = EquipmentClassMapping.Create(
            "light-armor",
            "Light Armor",
            EquipmentClassAffinity.Universal,
            "",
            "Armor",
            new[] { "Leather Armor" });

        // Act & Assert
        mapping.IsAppropriateFor("warrior").Should().BeTrue();
        mapping.IsAppropriateFor("skirmisher").Should().BeTrue();
        mapping.IsAppropriateFor("mystic").Should().BeTrue();
        mapping.IsAppropriateFor("adept").Should().BeTrue();
    }
}
```

---

## 11. Use Cases

### UC-001: Lookup Category Affinity

**Actor:** Smart Loot Service  
**Flow:** Loot drop generated → Get category from item → Lookup affinity → Return affinity enum

### UC-002: Check Class Appropriateness

**Actor:** Smart Loot Service  
**Flow:** Filter loot pool → For each item, check IsClassAppropriate → Include if true

### UC-003: Get Appropriate Categories for Archetype

**Actor:** Smart Loot Service  
**Flow:** Player archetype known → Get all categories with matching affinity + Universal → Return filtered list

---

## 12. Deliverable Checklist

### Domain Layer

- [ ] `EquipmentClassAffinity` enum created
- [ ] `EquipmentClassMapping` value object created

### Application Layer

- [ ] `IEquipmentClassMappingProvider` interface created

### Configuration Files

- [ ] `config/equipment-class-mapping.json` created
- [ ] `config/schemas/equipment-class-mapping.schema.json` created

### Testing

- [ ] ~2 unit tests implemented
- [ ] All tests passing

### Documentation

- [ ] XML documentation on all public types
- [ ] Inline comments for complex logic

---

## 13. Acceptance Criteria

### Functional

- [ ] `EquipmentClassAffinity` enum has exactly 5 values (0-4)
- [ ] Axes map to Warrior affinity
- [ ] Daggers map to Skirmisher affinity
- [ ] Staves map to Mystic affinity
- [ ] Crossbows map to Adept affinity
- [ ] Light armor maps to Universal affinity
- [ ] `IsAppropriateFor()` returns true for matching archetype
- [ ] `IsAppropriateFor()` returns true for Universal with any archetype
- [ ] Configuration file validates against schema

### Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~2 tests pass
- [ ] XML documentation complete on all public members
- [ ] Code follows established patterns from v0.16.2a

---

## 14. Dependencies

### 14.1 Required from Previous Versions

| Type                | Location               | Usage in this phase        |
| ------------------- | ---------------------- | -------------------------- |
| `WeaponCategory`    | Domain/Enums           | Category reference pattern |
| `ArmorCategory`     | Domain/Enums           | Category reference pattern |
| Provider interfaces | Application/Interfaces | Interface pattern          |

### 14.2 Provides to Future Phases

| Type                             | Usage                                      |
| -------------------------------- | ------------------------------------------ |
| `EquipmentClassAffinity`         | v0.16.3b-d: Smart loot filtering           |
| `EquipmentClassMapping`          | v0.16.3b: Class-appropriate item selection |
| `IEquipmentClassMappingProvider` | v0.16.3b-d: Affinity data access           |

---

## 15. Future Considerations

### 15.1 Deferred to v0.16.3b

- **Smart Loot Algorithm**: 60% class-appropriate bias implementation

### 15.2 Deferred to v0.16.3c

- **Weighted Selection**: Item weight-based random selection

### 15.3 Deferred to v0.16.3d

- **Loot Service Integration**: Connecting smart loot to monster drops

### 15.4 Out of Scope

- **Secondary Affinities**: Some items may suit multiple classes (future consideration)
- **Specialization Overrides**: Specializations altering affinity (future consideration)

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_  
_Author: Assistant_
