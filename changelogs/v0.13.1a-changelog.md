# v0.13.1a Changelog: Boss Health Bar

**Release Date:** 2026-01-20

---

## Summary

Implemented Boss Health Bar UI component with phase markers and damage animation as part of the Boss & Monster UI version. The boss health bar provides a prominent display during boss encounters showing current health, maximum health, percentage, and visual markers indicating phase transition thresholds.

---

## Added

### DTOs

- **BossHealthDisplayDto** — Boss health state for rendering
  - `BossId`: Unique boss identifier
  - `BossName`: Display name
  - `CurrentHealth/MaxHealth/HealthPercent`: Health values
  - `CurrentPhaseNumber`: Active phase tracking

- **PhaseMarkerDto** — Phase transition threshold markers
  - `PhaseNumber`: Phase identifier (1-based)
  - `PhaseName`: Display name
  - `ThresholdPercent`: Health percentage threshold

- **DamageAnimationDto** — Damage animation data
  - `PreviousHealth/CurrentHealth`: Before/after values
  - `DamageAmount`: Damage (positive) or healing (negative)

### Configuration

- **BossHealthDisplayConfig** — Master configuration class
  - Bar dimensions (`BarWidth`, `TotalWidth`, `TotalHeight`)
  - Position settings (`StartX`, `StartY`, `TextIndent`)
  - Symbol, color, threshold, and animation sub-configurations

- **BossHealthBarSymbols** — Customizable characters
  - `FilledChar`: Health fill character (#)
  - `EmptyChar`: Empty portion character (.)
  - `BorderChar`: Bar border character (=)
  - `CornerChar`: Bar corner character (+)
  - `PhaseMarkerChar`: Phase threshold marker (|)
  - `HeaderPrefix/HeaderSuffix`: Boss name decoration (<<, >>)

- **BossHealthBarColors** — Color configuration
  - `HeaderColor`: Boss name header (Magenta)
  - `PhaseMarkerColor`: Phase markers (White)
  - `DamageFlashColor`: Damage animation (Red)
  - `DamageColor`: Damage delta text (Red)
  - `CriticalColor`: Zero health (DarkRed)
  - `HealingColor`: Healing delta text (Green)

- **HealthColorThreshold** — Health percentage color thresholds
  - >75% = Green, >50% = Yellow, >25% = DarkYellow, >0% = Red

- **DamageAnimationConfig** — Animation timing
  - `FlashDurationMs`: 100ms flash effect
  - `DeltaDisplayMs`: 500ms delta display

### Renderers

- **BossHealthBarRenderer**
  - `FormatBossNameHeader()`: Centered, decorated boss name
  - `FormatHealthText()`: "HP: X,XXX / X,XXX" format
  - `GetHealthColor()`: Threshold-based color selection
  - `FormatBarBorder()`: Bar border formatting
  - `FormatPhaseLabel()`: Phase label with percentage
  - `RenderPhaseMarker()`: Phase marker character
  - `GetDamageFlashColor()`: Damage animation color
  - `GetHealingFlashColor()`: Healing animation color
  - `FormatDamageDelta()`: "[-X]" or "[+X]" format
  - `CalculateFillWidth()`: Bar fill calculation
  - `CalculateMarkerPosition()`: Phase marker positioning

### UI Components

- **BossHealthBar**
  - `RenderBar()`: Complete health bar display
  - `ShowPhaseMarkers()`: Configure phase threshold markers
  - `AnimateDamage()`: Flash + delta animation
  - `UpdateHealth()`: Silent health update
  - `Clear()`: Remove display
  - `IsActive`: Active state check
  - `CurrentBossId`: Current boss identifier

### Interface Extensions

- **ITerminalService** (extended)
  - `WriteAt()`: Positioned text output
  - `WriteColoredAt()`: Positioned colored text output
  - `FlashDelay()`: Animation timing delay

- **TerminalService** (implementations added)

### Configuration Files

- `config/boss-health-display.json`
- `config/schemas/boss-health-display.schema.json`

### Tests

- `BossHealthBarRendererTests` (~20 tests)
  - Health text formatting
  - Color threshold selection
  - Header formatting and centering
  - Damage delta formatting
  - Fill width calculation
  - Marker position calculation
  - Phase label formatting
  - Flash color retrieval

- `BossHealthBarTests` (~12 tests)
  - Render bar with valid/null DTO
  - Phase marker storage
  - Clear state management
  - Update health functionality
  - Damage animation
  - Constructor validation

---

## Visual Examples

### Boss Health Bar Display

```
                    <<  SKELETON KING  >>
   HP: 2,847 / 5,000
   +============================================================+
   |############################|...............|...............|
   +============================================================+
                 |              |              |
              Phase 2        Phase 3        Phase 4
               (75%)          (50%)          (25%)
```

### Damage Animation

```
HP: 2,997 -> 2,847 [-150]
```

---

## Dependencies

### Required (from v0.10.4x)

- `IBossMechanicsService`: Boss state retrieval
- `BossDefinition`: Phase configuration
- `BossPhase`: Phase thresholds
- `ActiveBossState`: Runtime boss state

### Provides (for v0.13.1b)

- `BossHealthBar`: Base component for phase effects
- `BossHealthDisplayConfig`: Shared configuration patterns
- `BossHealthBarRenderer`: Reusable rendering utilities

---

## Test Results

```
Project total tests: 155
New tests added: ~32
     Passed: 155
Total time: 0.5 seconds
```
