# v0.14.2d Changelog - Loot Table Schema

## Summary

Implemented `loot-tables.schema.json` with comprehensive validation for loot table definitions, including guaranteed drops, random pools, currency drops, and conditional requirements.

## Added

### Schema Files
- **[config/schemas/loot-tables.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/loot-tables.schema.json)** - JSON Schema Draft-07 for loot table configuration
  - `LootTableDefinition` - Complete loot table with drops and conditions
  - `LootEntry` - Single item entry with itemId, itemType, dropChance, weight, quantity
  - `QuantityRange` - Min/max quantity validation
  - `CurrencyDrop` - Gold/currency drop with chance and amount range
  - `DropCondition` - Level, difficulty, class, quest flag conditions

### Configuration Files
- **[config/loot-tables.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/loot-tables.json)** - 8 example loot tables:
  - `goblin_common` - Basic goblin drops
  - `goblin_shaman` - Shaman with magical items
  - `treasure_chest_small` - Chest contents
  - `boss_dragon` - Dragon boss loot (level-gated)
  - `quest_reward_tier1` - Quest completion rewards
  - `nightmare_bonus` - Nightmare difficulty exclusive
  - `class_specific_shadow-walker` - Class-specific drops
  - `post_dragon_quest_bonus` - Quest-flag gated drops

### Validation Rules
| Property | Constraint | Description |
|----------|------------|-------------|
| `id` | `^[a-z][a-z0-9_-]*$` | Lowercase with underscores/hyphens |
| `dropChance` | 0.0-1.0 | Drop probability |
| `weight` | >= 1 | Weighted random selection |
| `quantity.min/max` | >= 1 | Quantity must be positive |
| `itemType` | Enum | Item, Weapon, Armor |
| `difficulty` | Enum | Easy, Normal, Hard, Nightmare |

### Unit Tests
- **[LootTablesSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/LootTablesSchemaTests.cs)** - 5 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation
  - `ExistingLootTablesJson_ValidatesAgainstSchema` - Backwards compatibility (8 tables)
  - `DropChance_OutOfRange_FailsValidation` - Drop chance range
  - `QuantityMin_LessThanOne_FailsValidation` - Quantity range
  - `ItemType_InvalidEnumValue_FailsValidation` - Item type enum

## Test Results

```
Test summary: total: 5, failed: 0, succeeded: 5, skipped: 0
Build succeeded with 0 errors
```
