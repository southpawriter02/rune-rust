# v0.18.0a Design Specification: Stress Enums & State

**Version:** 0.18.0a
**Parent:** v0.18.0 (Psychic Stress System)
**Prerequisites:** v0.17.5 Complete (Character Creation), v0.6.x (Dice System)
**Status:** Design Complete
**Estimated Unit Tests:** ~4

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [StressThreshold Enum](#5-stressthreshold-enum)
6. [StressSource Enum](#6-stresssource-enum)
7. [RestType Enum](#7-resttype-enum)
8. [StressState Value Object](#8-stressstate-value-object)
9. [Data Model Summary](#9-data-model-summary)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

This design specification defines the foundational domain types for the Psychic Stress system — the enums and value objects that track a character's psychological state and determine mechanical penalties.

v0.18.0a establishes the **Stress State Pattern** — a reusable approach for tracking resource state with computed threshold tiers, penalties, and trigger conditions. This pattern will be replicated in v0.18.1 (Corruption) and v0.18.4 (Specialization Resources).

### Key Deliverables

| Category                 | Items                                         |
| ------------------------ | --------------------------------------------- |
| **Domain Enums**         | `StressThreshold`, `StressSource`, `RestType` |
| **Domain Value Objects** | `StressState`                                 |
| **Tests**                | ~4 unit tests                                 |

### Architectural Significance

This version establishes the **Resource State Pattern** that will be reused throughout the Trauma Economy:

- **Threshold-based tiers** — Discrete states derived from continuous values
- **Computed penalties** — Automatic penalty calculation from resource level
- **Trigger conditions** — Boolean flags for exceptional states
- **Immutable snapshots** — Value objects capture point-in-time state

---

## 2. Feature Overview

```
v0.18.0a Features
├── StressThreshold Enum (6 tiers)
│   ├── Calm (0-19)
│   ├── Uneasy (20-39)
│   ├── Anxious (40-59)
│   ├── Panicked (60-79)
│   ├── Breaking (80-99)
│   └── Trauma (100)
│
├── StressSource Enum (6 categories)
│   ├── Combat
│   ├── Exploration
│   ├── Narrative
│   ├── Heretical
│   ├── Environmental
│   └── Corruption
│
├── RestType Enum (4 types)
│   ├── Short (WILL × 2)
│   ├── Long (WILL × 5)
│   ├── Sanctuary (Full reset)
│   └── Milestone (Fixed 25)
│
└── StressState Value Object
    ├── CurrentStress property
    ├── Threshold (computed)
    ├── DefensePenalty (computed)
    ├── HasSkillDisadvantage (computed)
    └── RequiresTraumaCheck (computed)
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ENUMS                                                                  │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │   StressThreshold      │  │     StressSource       │                │
│  ├────────────────────────┤  ├────────────────────────┤                │
│  │ Calm = 0               │  │ Combat                 │                │
│  │ Uneasy = 1             │  │ Exploration            │                │
│  │ Anxious = 2            │  │ Narrative              │                │
│  │ Panicked = 3           │  │ Heretical              │                │
│  │ Breaking = 4           │  │ Environmental          │                │
│  │ Trauma = 5             │  │ Corruption             │                │
│  └────────────────────────┘  └────────────────────────┘                │
│                                                                         │
│  ┌────────────────────────┐                                            │
│  │       RestType         │                                            │
│  ├────────────────────────┤                                            │
│  │ Short = 0              │                                            │
│  │ Long = 1               │                                            │
│  │ Sanctuary = 2          │                                            │
│  │ Milestone = 3          │                                            │
│  └────────────────────────┘                                            │
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                         StressState                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + CurrentStress: int (0-100)                                    │   │
│  │ + MaxStress: int = 100 (constant)                               │   │
│  │ + MinStress: int = 0 (constant)                                 │   │
│  │ + Threshold: StressThreshold (computed)                         │   │
│  │ + DefensePenalty: int (computed: floor(Stress/20))              │   │
│  │ + HasSkillDisadvantage: bool (computed: Stress >= 80)           │   │
│  │ + RequiresTraumaCheck: bool (computed: Stress >= 100)           │   │
│  │ + IsCalm: bool (computed: Threshold == Calm)                    │   │
│  │ + IsBreaking: bool (computed: Threshold >= Breaking)            │   │
│  │                                                                  │   │
│  │ + Create(stress): StressState                                   │   │
│  │ + WithStress(newStress): StressState                            │   │
│  │ + ToString(): string                                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Stress Threshold Visualization

```
                    STRESS SCALE (0-100)
    ╔═══════════════════════════════════════════════════════════╗
    ║                                                           ║
    ║  0        20       40       60       80       100         ║
    ║  │         │        │        │        │         │         ║
    ║  ├─────────┼────────┼────────┼────────┼─────────┤         ║
    ║  │  CALM   │ UNEASY │ANXIOUS │PANICKED│BREAKING │ TRAUMA  ║
    ║  │         │        │        │        │         │         ║
    ║  │ Def: 0  │ Def:-1 │ Def:-2 │ Def:-3 │ Def:-4  │ Def:-5  ║
    ║  │ Skill:- │ Skill:-│ Skill:-│ Skill:-│ Skill:⚠ │Skill:⚠⚠ ║
    ║  │         │        │        │        │ DisAdv  │ + Check ║
    ║  └─────────┴────────┴────────┴────────┴─────────┴─────────┘
    ║                                                           ║
    ║  Legend:                                                  ║
    ║  Def = Defense Penalty                                    ║
    ║  Skill = Skill Check Penalty                             ║
    ║  ⚠ = Disadvantage on non-combat checks                    ║
    ║  ⚠⚠ = Disadvantage on ALL checks + Trauma Check          ║
    ║                                                           ║
    ╚═══════════════════════════════════════════════════════════╝
```

### 3.3 Stress State Decision Tree

```
               ┌──────────────────────────┐
               │    Evaluate StressState   │
               └─────────────┬────────────┘
                             │
                             ▼
               ┌──────────────────────────┐
               │  CurrentStress >= 100?   │
               └─────────────┬────────────┘
                    │                │
                   YES              NO
                    │                │
                    ▼                ▼
         ┌─────────────────┐  ┌──────────────────────────┐
         │ RequiresTrauma  │  │  CurrentStress >= 80?    │
         │ Check = TRUE    │  └─────────────┬────────────┘
         │                 │       │                │
         │ Threshold =     │      YES              NO
         │   Trauma        │       │                │
         └─────────────────┘       ▼                ▼
                          ┌───────────────┐  ┌──────────────────┐
                          │HasSkillDisadv │  │ CurrentStress    │
                          │ = TRUE        │  │   >= 60?         │
                          │               │  └────────┬─────────┘
                          │ Threshold =   │      │          │
                          │  Breaking     │     YES        NO
                          └───────────────┘      │          │
                                                 ▼          ▼
                                        ┌───────────┐ ┌───────────────────┐
                                        │ Threshold │ │ Continue checking │
                                        │ = Panicked│ │ lower thresholds  │
                                        └───────────┘ └───────────────────┘
```

### 3.4 Defense Penalty Calculation Flow

```
    ┌────────────────────────────────────────────────────────────┐
    │                 DEFENSE PENALTY CALCULATION                 │
    └────────────────────────────────────────────────────────────┘

              Input: CurrentStress (0-100)
                           │
                           ▼
    ┌────────────────────────────────────────────────────────────┐
    │              DefensePenalty = floor(Stress / 20)           │
    └────────────────────────────────────────────────────────────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
    ┌──────────────┬──────────────┬──────────────┐
    │ Stress 0-19  │ Stress 20-39 │ Stress 40-59 │
    │ Penalty = 0  │ Penalty = 1  │ Penalty = 2  │
    └──────────────┴──────────────┴──────────────┘
           │               │               │
           └───────────────┼───────────────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
    ┌──────────────┬──────────────┬──────────────┐
    │ Stress 60-79 │ Stress 80-99 │ Stress 100   │
    │ Penalty = 3  │ Penalty = 4  │ Penalty = 5  │
    └──────────────┴──────────────┴──────────────┘
```

---

## 4. User Stories

### US-18a-1: Define Stress Thresholds

**As a** game developer
**I want to** classify stress levels into named thresholds
**So that** the UI and mechanics can react to stress severity consistently

**Acceptance Criteria:**

- 6 distinct threshold tiers defined
- Each threshold maps to a 20-point stress range
- Thresholds ordered from least to most severe

### US-18a-2: Categorize Stress Sources

**As a** game designer
**I want to** categorize different sources of stress
**So that** stress resistance modifiers can apply contextually

**Acceptance Criteria:**

- At least 6 stress source categories defined
- Categories cover combat, exploration, and narrative scenarios
- Categories are extensible via configuration

### US-18a-3: Define Recovery Types

**As a** game designer
**I want to** define different types of rest with varying recovery rates
**So that** players have strategic choices about when and how to recover

**Acceptance Criteria:**

- 4 rest types with distinct recovery formulas
- At least one type provides full stress reset
- Recovery formulas documented in code

### US-18a-4: Calculate Stress Penalties

**As a** combat system developer
**I want to** calculate defense penalties from stress level
**So that** high stress creates a tactical death spiral

**Acceptance Criteria:**

- Defense penalty calculated as floor(Stress/20)
- Skill disadvantage flag set at stress >= 80
- Trauma check flag set at stress == 100

---

## 5. StressThreshold Enum

### 5.1 Purpose

Classifies stress levels into discrete named tiers for UI display, mechanical effects, and logging.

### 5.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/StressThreshold.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the psychological stress threshold tiers for a character.
/// </summary>
/// <remarks>
/// <para>
/// Each threshold corresponds to a 20-point stress range and imposes
/// escalating mechanical penalties. Higher thresholds indicate greater
/// psychological distress.
/// </para>
/// <para>
/// The stress system creates a "death spiral" where high stress reduces
/// Defense, making characters more vulnerable to further stress accumulation.
/// </para>
/// </remarks>
public enum StressThreshold
{
    /// <summary>
    /// Stress 0-19: Character is calm with no penalties.
    /// </summary>
    /// <remarks>
    /// This is the baseline state. Characters at this threshold
    /// operate at full capacity with no stress-related effects.
    /// </remarks>
    Calm = 0,

    /// <summary>
    /// Stress 20-39: Character is uneasy with minor penalties.
    /// </summary>
    /// <remarks>
    /// Defense penalty: -1. This threshold indicates the character
    /// is beginning to feel the psychological pressure of Aethelgard's horrors.
    /// </remarks>
    Uneasy = 1,

    /// <summary>
    /// Stress 40-59: Character is anxious with moderate penalties.
    /// </summary>
    /// <remarks>
    /// Defense penalty: -2. The character's composure is noticeably
    /// affected, reducing their ability to evade attacks.
    /// </remarks>
    Anxious = 2,

    /// <summary>
    /// Stress 60-79: Character is panicked with significant penalties.
    /// </summary>
    /// <remarks>
    /// Defense penalty: -3. The character is approaching their
    /// psychological breaking point.
    /// </remarks>
    Panicked = 3,

    /// <summary>
    /// Stress 80-99: Character is breaking with severe penalties.
    /// </summary>
    /// <remarks>
    /// Defense penalty: -4. Additionally, the character has
    /// disadvantage on non-combat skill checks due to mental distress.
    /// </remarks>
    Breaking = 4,

    /// <summary>
    /// Stress 100: Trauma Check triggered.
    /// </summary>
    /// <remarks>
    /// Defense penalty: -5. Disadvantage on ALL checks.
    /// This state immediately triggers a Trauma Check. Based on the
    /// check result, the character either:
    /// <list type="bullet">
    /// <item>Passes: Stress resets to 75, no permanent effect</item>
    /// <item>Fails: Gains permanent Trauma, stress resets to 50</item>
    /// </list>
    /// </remarks>
    Trauma = 5
}
```

### 5.3 Extension Methods

**File:** `src/Core/RuneAndRust.Domain/Enums/StressThresholdExtensions.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Extension methods for <see cref="StressThreshold"/>.
/// </summary>
public static class StressThresholdExtensions
{
    /// <summary>
    /// Gets the minimum stress value for this threshold tier.
    /// </summary>
    /// <param name="threshold">The stress threshold.</param>
    /// <returns>The minimum stress value (inclusive) for the threshold.</returns>
    /// <example>
    /// <code>
    /// var minStress = StressThreshold.Anxious.GetMinStress(); // Returns 40
    /// </code>
    /// </example>
    public static int GetMinStress(this StressThreshold threshold) => threshold switch
    {
        StressThreshold.Calm => 0,
        StressThreshold.Uneasy => 20,
        StressThreshold.Anxious => 40,
        StressThreshold.Panicked => 60,
        StressThreshold.Breaking => 80,
        StressThreshold.Trauma => 100,
        _ => throw new ArgumentOutOfRangeException(nameof(threshold))
    };

    /// <summary>
    /// Gets the maximum stress value for this threshold tier.
    /// </summary>
    /// <param name="threshold">The stress threshold.</param>
    /// <returns>The maximum stress value (inclusive) for the threshold.</returns>
    /// <example>
    /// <code>
    /// var maxStress = StressThreshold.Calm.GetMaxStress(); // Returns 19
    /// </code>
    /// </example>
    public static int GetMaxStress(this StressThreshold threshold) => threshold switch
    {
        StressThreshold.Calm => 19,
        StressThreshold.Uneasy => 39,
        StressThreshold.Anxious => 59,
        StressThreshold.Panicked => 79,
        StressThreshold.Breaking => 99,
        StressThreshold.Trauma => 100,
        _ => throw new ArgumentOutOfRangeException(nameof(threshold))
    };

    /// <summary>
    /// Gets the defense penalty associated with this threshold.
    /// </summary>
    /// <param name="threshold">The stress threshold.</param>
    /// <returns>The defense penalty value (0 to 5).</returns>
    public static int GetDefensePenalty(this StressThreshold threshold) => (int)threshold;

    /// <summary>
    /// Determines the stress threshold for a given stress value.
    /// </summary>
    /// <param name="stress">The current stress value (0-100).</param>
    /// <returns>The corresponding <see cref="StressThreshold"/>.</returns>
    /// <exception cref="ArgumentOutOfRangeException">
    /// Thrown if stress is negative or greater than 100.
    /// </exception>
    public static StressThreshold FromStressValue(int stress)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(stress);
        ArgumentOutOfRangeException.ThrowIfGreaterThan(stress, 100);

        return stress switch
        {
            >= 100 => StressThreshold.Trauma,
            >= 80 => StressThreshold.Breaking,
            >= 60 => StressThreshold.Panicked,
            >= 40 => StressThreshold.Anxious,
            >= 20 => StressThreshold.Uneasy,
            _ => StressThreshold.Calm
        };
    }

    /// <summary>
    /// Gets a display-friendly string for the threshold.
    /// </summary>
    /// <param name="threshold">The stress threshold.</param>
    /// <returns>A display string with threshold name and stress range.</returns>
    public static string ToDisplayString(this StressThreshold threshold) =>
        $"{threshold} ({threshold.GetMinStress()}-{threshold.GetMaxStress()})";
}
```

---

## 6. StressSource Enum

### 6.1 Purpose

Categorizes the origin of stress accumulation for contextual resistance modifiers and logging.

### 6.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/StressSource.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categorizes the sources of psychic stress accumulation.
/// </summary>
/// <remarks>
/// <para>
/// Stress sources are used to:
/// <list type="bullet">
/// <item>Apply contextual resistance modifiers (e.g., gear that reduces combat stress)</item>
/// <item>Track stress history for analytics and achievements</item>
/// <item>Provide descriptive logging for debugging and playtesting</item>
/// </list>
/// </para>
/// <para>
/// Specific stress values and resistance DCs are defined in the
/// <c>stress-sources.json</c> configuration file (v0.18.0e).
/// </para>
/// </remarks>
public enum StressSource
{
    /// <summary>
    /// Stress from combat encounters.
    /// </summary>
    /// <remarks>
    /// Includes: enemy fear auras, psychic attacks, witnessing ally harm,
    /// facing Forlorn, and other combat-related psychological trauma.
    /// </remarks>
    Combat,

    /// <summary>
    /// Stress from exploration and discovery.
    /// </summary>
    /// <remarks>
    /// Includes: disturbing discoveries, corpse-filled rooms, paradox
    /// encounters, and reading forbidden texts.
    /// </remarks>
    Exploration,

    /// <summary>
    /// Stress from narrative events and story developments.
    /// </summary>
    /// <remarks>
    /// Includes: traumatic revelations, NPC betrayals, moral compromises,
    /// and other story-driven psychological impacts.
    /// </remarks>
    Narrative,

    /// <summary>
    /// Stress from heretical or forbidden activities.
    /// </summary>
    /// <remarks>
    /// Includes: using Blót-Priest abilities, invoking forbidden runes,
    /// and other actions that violate the Combine's orthodoxy.
    /// Often linked to Corruption gain.
    /// </remarks>
    Heretical,

    /// <summary>
    /// Stress from environmental hazards.
    /// </summary>
    /// <remarks>
    /// Includes: exposure to Reality Bleed zones, prolonged darkness,
    /// extreme temperatures, and other environmental dangers.
    /// </remarks>
    Environmental,

    /// <summary>
    /// Stress resulting from Corruption accumulation.
    /// </summary>
    /// <remarks>
    /// Failing Corruption resistance checks causes stress as the
    /// character's mind struggles against the Runic Blight infection.
    /// </remarks>
    Corruption
}
```

### 6.3 Extension Methods

**File:** `src/Core/RuneAndRust.Domain/Enums/StressSourceExtensions.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Extension methods for <see cref="StressSource"/>.
/// </summary>
public static class StressSourceExtensions
{
    /// <summary>
    /// Gets a display-friendly description of the stress source.
    /// </summary>
    /// <param name="source">The stress source.</param>
    /// <returns>A human-readable description.</returns>
    public static string GetDescription(this StressSource source) => source switch
    {
        StressSource.Combat => "Combat-related psychological trauma",
        StressSource.Exploration => "Discovery and exploration stress",
        StressSource.Narrative => "Story-driven psychological impact",
        StressSource.Heretical => "Forbidden knowledge or actions",
        StressSource.Environmental => "Environmental hazard exposure",
        StressSource.Corruption => "Runic Blight corruption stress",
        _ => "Unknown stress source"
    };

    /// <summary>
    /// Indicates if resistance checks typically apply for this source.
    /// </summary>
    /// <param name="source">The stress source.</param>
    /// <returns>True if resistance checks are typically used.</returns>
    public static bool TypicallyResistable(this StressSource source) => source switch
    {
        StressSource.Combat => true,
        StressSource.Exploration => true,
        StressSource.Narrative => false, // Usually unavoidable story beats
        StressSource.Heretical => true,
        StressSource.Environmental => true,
        StressSource.Corruption => false, // Corruption failure = automatic stress
        _ => true
    };
}
```

---

## 7. RestType Enum

### 7.1 Purpose

Defines the types of rest available for stress recovery, each with specific formulas and conditions.

### 7.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/RestType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the types of rest that allow stress recovery.
/// </summary>
/// <remarks>
/// <para>
/// Each rest type has an associated recovery formula:
/// <list type="bullet">
/// <item><see cref="Short"/>: WILL × 2 stress recovered</item>
/// <item><see cref="Long"/>: WILL × 5 stress recovered</item>
/// <item><see cref="Sanctuary"/>: Full stress reset to 0</item>
/// <item><see cref="Milestone"/>: Fixed 25 stress recovered</item>
/// </list>
/// </para>
/// <para>
/// The availability and limitations of each rest type are controlled
/// by game rules (e.g., Short Rest once per day, Sanctuary requires
/// specific safe locations).
/// </para>
/// </remarks>
public enum RestType
{
    /// <summary>
    /// A brief rest (10-30 minutes in-game).
    /// </summary>
    /// <remarks>
    /// Recovery formula: WILL × 2 stress reduced.
    /// Typically limited to once per day in expeditions.
    /// </remarks>
    Short = 0,

    /// <summary>
    /// An extended rest (6-8 hours in-game).
    /// </summary>
    /// <remarks>
    /// Recovery formula: WILL × 5 stress reduced.
    /// Provides significant recovery but not complete restoration.
    /// Requires a safe location.
    /// </remarks>
    Long = 1,

    /// <summary>
    /// Rest in a designated Sanctuary location.
    /// </summary>
    /// <remarks>
    /// Recovery formula: Full stress reset to 0.
    /// Sanctuary locations are rare safe havens in Aethelgard
    /// where characters can fully decompress.
    /// </remarks>
    Sanctuary = 2,

    /// <summary>
    /// Rest granted upon completing a major milestone.
    /// </summary>
    /// <remarks>
    /// Recovery formula: Fixed 25 stress reduced.
    /// Awarded for completing quest objectives, defeating bosses,
    /// or other significant achievements.
    /// </remarks>
    Milestone = 3
}
```

### 7.3 Extension Methods

**File:** `src/Core/RuneAndRust.Domain/Enums/RestTypeExtensions.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Extension methods for <see cref="RestType"/>.
/// </summary>
public static class RestTypeExtensions
{
    /// <summary>
    /// Calculates the stress recovery amount for this rest type.
    /// </summary>
    /// <param name="restType">The type of rest.</param>
    /// <param name="willAttribute">
    /// The character's WILL attribute value (used for Short and Long rest).
    /// </param>
    /// <returns>The amount of stress recovered.</returns>
    /// <exception cref="ArgumentOutOfRangeException">
    /// Thrown if willAttribute is negative.
    /// </exception>
    /// <example>
    /// <code>
    /// // Character with WILL 4 takes a Short Rest
    /// var recovery = RestType.Short.CalculateRecovery(4); // Returns 8
    ///
    /// // Sanctuary always fully recovers
    /// var fullRecovery = RestType.Sanctuary.CalculateRecovery(4); // Returns int.MaxValue
    /// </code>
    /// </example>
    public static int CalculateRecovery(this RestType restType, int willAttribute = 0)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(willAttribute);

        return restType switch
        {
            RestType.Short => willAttribute * 2,
            RestType.Long => willAttribute * 5,
            RestType.Sanctuary => int.MaxValue, // Full reset handled by caller
            RestType.Milestone => 25,
            _ => 0
        };
    }

    /// <summary>
    /// Gets the display name and formula for logging/UI.
    /// </summary>
    /// <param name="restType">The rest type.</param>
    /// <returns>A formatted string with name and formula.</returns>
    public static string GetFormulaDescription(this RestType restType) => restType switch
    {
        RestType.Short => "Short Rest (WILL × 2)",
        RestType.Long => "Long Rest (WILL × 5)",
        RestType.Sanctuary => "Sanctuary (Full Reset)",
        RestType.Milestone => "Milestone (+25)",
        _ => "Unknown"
    };

    /// <summary>
    /// Indicates whether this rest type provides full stress recovery.
    /// </summary>
    /// <param name="restType">The rest type.</param>
    /// <returns>True if this rest type fully resets stress to 0.</returns>
    public static bool IsFullRecovery(this RestType restType) =>
        restType == RestType.Sanctuary;
}
```

---

## 8. StressState Value Object

### 8.1 Purpose

Encapsulates the current stress state of a character, including computed properties for thresholds, penalties, and trigger conditions.

### 8.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/StressState.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents a snapshot of a character's current psychic stress state.
/// </summary>
/// <remarks>
/// <para>
/// This immutable value object encapsulates stress tracking and provides
/// computed properties for mechanical effects:
/// <list type="bullet">
/// <item>Defense penalty (0-5 based on threshold)</item>
/// <item>Skill check disadvantage (at stress >= 80)</item>
/// <item>Trauma Check trigger (at stress == 100)</item>
/// </list>
/// </para>
/// <para>
/// StressState is used to pass stress information between layers without
/// exposing mutable state. To modify stress, create a new instance via
/// <see cref="WithStress"/> or re-read from the character entity.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// // Create initial calm state
/// var calm = StressState.Create(0);
/// Console.WriteLine(calm.Threshold); // Calm
/// Console.WriteLine(calm.DefensePenalty); // 0
///
/// // Create breaking state
/// var breaking = StressState.Create(85);
/// Console.WriteLine(breaking.Threshold); // Breaking
/// Console.WriteLine(breaking.DefensePenalty); // 4
/// Console.WriteLine(breaking.HasSkillDisadvantage); // True
///
/// // Create modified state
/// var increased = calm.WithStress(45);
/// Console.WriteLine(increased.Threshold); // Anxious
/// </code>
/// </example>
public readonly record struct StressState
{
    /// <summary>
    /// The minimum possible stress value.
    /// </summary>
    public const int MinStress = 0;

    /// <summary>
    /// The maximum possible stress value (triggers Trauma Check).
    /// </summary>
    public const int MaxStress = 100;

    /// <summary>
    /// Gets the current stress value (0-100).
    /// </summary>
    public int CurrentStress { get; }

    /// <summary>
    /// Gets the current stress threshold tier.
    /// </summary>
    /// <remarks>
    /// Computed from <see cref="CurrentStress"/> using 20-point increments.
    /// </remarks>
    public StressThreshold Threshold { get; }

    /// <summary>
    /// Gets the defense penalty from current stress level.
    /// </summary>
    /// <remarks>
    /// Calculated as floor(CurrentStress / 20), ranging from 0 to 5.
    /// This penalty is subtracted from the character's effective Defense.
    /// </remarks>
    public int DefensePenalty { get; }

    /// <summary>
    /// Gets whether the character has disadvantage on skill checks.
    /// </summary>
    /// <remarks>
    /// True when stress >= 80 (Breaking or Trauma threshold).
    /// At Breaking (80-99): disadvantage on non-combat checks only.
    /// At Trauma (100): disadvantage on ALL checks.
    /// </remarks>
    public bool HasSkillDisadvantage { get; }

    /// <summary>
    /// Gets whether a Trauma Check is required.
    /// </summary>
    /// <remarks>
    /// True only when stress is exactly 100. This triggers the
    /// Trauma Check mechanic which may result in permanent trauma.
    /// </remarks>
    public bool RequiresTraumaCheck { get; }

    /// <summary>
    /// Gets whether the character is at the Calm threshold (no penalties).
    /// </summary>
    public bool IsCalm => Threshold == StressThreshold.Calm;

    /// <summary>
    /// Gets whether the character is at or above Breaking threshold.
    /// </summary>
    /// <remarks>
    /// At Breaking or above, the character suffers skill disadvantage.
    /// </remarks>
    public bool IsBreaking => Threshold >= StressThreshold.Breaking;

    /// <summary>
    /// Gets the stress percentage (0-100).
    /// </summary>
    public int StressPercentage => CurrentStress;

    /// <summary>
    /// Private constructor to enforce factory pattern.
    /// </summary>
    private StressState(int currentStress)
    {
        CurrentStress = Math.Clamp(currentStress, MinStress, MaxStress);
        Threshold = StressThresholdExtensions.FromStressValue(CurrentStress);
        DefensePenalty = CurrentStress / 20;
        HasSkillDisadvantage = CurrentStress >= 80;
        RequiresTraumaCheck = CurrentStress >= MaxStress;
    }

    /// <summary>
    /// Creates a new stress state with the specified stress level.
    /// </summary>
    /// <param name="currentStress">
    /// The current stress value (will be clamped to 0-100).
    /// </param>
    /// <returns>A new <see cref="StressState"/> instance.</returns>
    /// <example>
    /// <code>
    /// var state = StressState.Create(45);
    /// Console.WriteLine(state.Threshold); // Anxious
    /// </code>
    /// </example>
    public static StressState Create(int currentStress) => new(currentStress);

    /// <summary>
    /// Gets a stress state representing zero stress (Calm).
    /// </summary>
    public static StressState Calm => Create(MinStress);

    /// <summary>
    /// Creates a new stress state with the specified stress level.
    /// </summary>
    /// <param name="newStress">
    /// The new stress value (will be clamped to 0-100).
    /// </param>
    /// <returns>A new <see cref="StressState"/> instance with the updated stress.</returns>
    /// <remarks>
    /// This method allows creating modified states without mutating the original.
    /// </remarks>
    public StressState WithStress(int newStress) => new(newStress);

    /// <summary>
    /// Creates a new stress state with stress increased by the specified amount.
    /// </summary>
    /// <param name="amount">The amount of stress to add (can be negative).</param>
    /// <returns>A new <see cref="StressState"/> with adjusted stress.</returns>
    public StressState WithStressAdded(int amount) => new(CurrentStress + amount);

    /// <summary>
    /// Creates a new stress state with stress decreased by the specified amount.
    /// </summary>
    /// <param name="amount">The amount of stress to remove (must be positive).</param>
    /// <returns>A new <see cref="StressState"/> with reduced stress.</returns>
    /// <exception cref="ArgumentOutOfRangeException">
    /// Thrown if amount is negative.
    /// </exception>
    public StressState WithStressReduced(int amount)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(amount);
        return new(CurrentStress - amount);
    }

    /// <summary>
    /// Returns a string representation of the stress state.
    /// </summary>
    /// <returns>A formatted string showing stress value and threshold.</returns>
    public override string ToString() =>
        $"Stress: {CurrentStress}/{MaxStress} [{Threshold}] (Def: -{DefensePenalty})";
}
```

---

## 9. Data Model Summary

### 9.1 New Domain Types

| Type                        | Kind         | Layer  | File Path                            |
| --------------------------- | ------------ | ------ | ------------------------------------ |
| `StressThreshold`           | Enum         | Domain | `Enums/StressThreshold.cs`           |
| `StressThresholdExtensions` | Static Class | Domain | `Enums/StressThresholdExtensions.cs` |
| `StressSource`              | Enum         | Domain | `Enums/StressSource.cs`              |
| `StressSourceExtensions`    | Static Class | Domain | `Enums/StressSourceExtensions.cs`    |
| `RestType`                  | Enum         | Domain | `Enums/RestType.cs`                  |
| `RestTypeExtensions`        | Static Class | Domain | `Enums/RestTypeExtensions.cs`        |
| `StressState`               | Value Object | Domain | `ValueObjects/StressState.cs`        |

### 9.2 Type Relationships

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          TYPE RELATIONSHIPS                             │
└─────────────────────────────────────────────────────────────────────────┘

    StressState
        │
        ├─────────────────────────────────────────────────┐
        │  Uses                                           │
        ▼                                                 ▼
    StressThreshold                               StressThresholdExtensions
        │                                                 │
        │  Provides                                       │ Contains
        │  • Threshold tier                               │ • FromStressValue()
        │  • Defense penalty                              │ • GetMinStress()
        │  • Skill disadvantage flag                      │ • GetMaxStress()
        │  • Trauma check flag                            │
        │                                                 │
        └─────────────────────────────────────────────────┘

    StressSource                                  StressSourceExtensions
        │                                                 │
        │  Categorizes                                    │ Contains
        │  • Combat sources                               │ • GetDescription()
        │  • Exploration sources                          │ • TypicallyResistable()
        │  • Narrative sources                            │
        │                                                 │
        │  (Used by v0.18.0b StressApplicationResult)     │
        └─────────────────────────────────────────────────┘

    RestType                                      RestTypeExtensions
        │                                                 │
        │  Defines                                        │ Contains
        │  • Recovery formulas                            │ • CalculateRecovery()
        │  • Rest constraints                             │ • GetFormulaDescription()
        │                                                 │ • IsFullRecovery()
        │  (Used by v0.18.0b StressRecoveryResult)        │
        └─────────────────────────────────────────────────┘
```

### 9.3 Property Summary

#### StressThreshold Enum Values

| Value    | Int | Min Stress | Max Stress | Defense Penalty |
| -------- | --- | ---------- | ---------- | --------------- |
| Calm     | 0   | 0          | 19         | 0               |
| Uneasy   | 1   | 20         | 39         | -1              |
| Anxious  | 2   | 40         | 59         | -2              |
| Panicked | 3   | 60         | 79         | -3              |
| Breaking | 4   | 80         | 99         | -4              |
| Trauma   | 5   | 100        | 100        | -5              |

#### StressState Computed Properties

| Property               | Type              | Formula              | Description         |
| ---------------------- | ----------------- | -------------------- | ------------------- |
| `Threshold`            | `StressThreshold` | Derived from range   | Current tier        |
| `DefensePenalty`       | `int`             | `floor(Stress / 20)` | 0 to 5              |
| `HasSkillDisadvantage` | `bool`            | `Stress >= 80`       | Skill check penalty |
| `RequiresTraumaCheck`  | `bool`            | `Stress >= 100`      | Trauma trigger      |

---

## 10. Logging Specifications

### 10.1 Log Levels by Component

| Component                   | Level | Events                                 |
| --------------------------- | ----- | -------------------------------------- |
| `StressState`               | Debug | State creation, threshold calculations |
| `StressThresholdExtensions` | Debug | Threshold conversion                   |
| `RestTypeExtensions`        | Debug | Recovery calculations                  |

### 10.2 Log Event Templates

| Event                   | Level       | Template                                                                                | Properties                                |
| ----------------------- | ----------- | --------------------------------------------------------------------------------------- | ----------------------------------------- |
| State Created           | Debug       | `"StressState created: {CurrentStress}/{MaxStress} [{Threshold}]"`                      | CurrentStress, MaxStress, Threshold       |
| Threshold Crossed       | Information | `"Stress threshold changed: {OldThreshold} → {NewThreshold} (Stress: {CurrentStress})"` | OldThreshold, NewThreshold, CurrentStress |
| Defense Penalty Applied | Debug       | `"Defense penalty calculated: -{DefensePenalty} (Stress: {CurrentStress})"`             | DefensePenalty, CurrentStress             |
| Skill Disadvantage      | Information | `"Skill disadvantage active: Stress at {CurrentStress}"`                                | CurrentStress                             |
| Trauma Check Required   | Warning     | `"TRAUMA CHECK REQUIRED: Stress at maximum ({CurrentStress})"`                          | CurrentStress                             |

### 10.3 Example Log Output

```
[2026-01-28 10:30:15 DBG] StressState created: 0/100 [Calm]
[2026-01-28 10:31:22 INF] Stress threshold changed: Calm → Uneasy (Stress: 25)
[2026-01-28 10:31:22 DBG] Defense penalty calculated: -1 (Stress: 25)
[2026-01-28 10:33:45 INF] Stress threshold changed: Uneasy → Breaking (Stress: 85)
[2026-01-28 10:33:45 INF] Skill disadvantage active: Stress at 85
[2026-01-28 10:33:45 DBG] Defense penalty calculated: -4 (Stress: 85)
[2026-01-28 10:35:12 WRN] TRAUMA CHECK REQUIRED: Stress at maximum (100)
```

---

## 11. Unit Testing Requirements

### 11.1 Test Count by Feature

| Feature                           | Test Count |
| --------------------------------- | ---------- |
| StressThreshold Enum & Extensions | ~1         |
| StressState Value Object          | ~3         |
| **Total**                         | **~4**     |

### 11.2 StressThresholdTests

**File:** `tests/RuneAndRust.Domain.UnitTests/Enums/StressThresholdTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.Enums;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;

[TestFixture]
public class StressThresholdTests
{
    [Test]
    [TestCase(0, StressThreshold.Calm)]
    [TestCase(19, StressThreshold.Calm)]
    [TestCase(20, StressThreshold.Uneasy)]
    [TestCase(39, StressThreshold.Uneasy)]
    [TestCase(40, StressThreshold.Anxious)]
    [TestCase(59, StressThreshold.Anxious)]
    [TestCase(60, StressThreshold.Panicked)]
    [TestCase(79, StressThreshold.Panicked)]
    [TestCase(80, StressThreshold.Breaking)]
    [TestCase(99, StressThreshold.Breaking)]
    [TestCase(100, StressThreshold.Trauma)]
    public void FromStressValue_ReturnsCorrectThreshold(int stress, StressThreshold expected)
    {
        // Act
        var result = StressThresholdExtensions.FromStressValue(stress);

        // Assert
        result.Should().Be(expected);
    }
}
```

### 11.3 StressStateTests

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressStateTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.ValueObjects;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

[TestFixture]
public class StressStateTests
{
    [Test]
    [TestCase(0, 0)]
    [TestCase(19, 0)]
    [TestCase(20, 1)]
    [TestCase(40, 2)]
    [TestCase(60, 3)]
    [TestCase(80, 4)]
    [TestCase(100, 5)]
    public void DefensePenalty_CalculatedCorrectly(int stress, int expectedPenalty)
    {
        // Arrange & Act
        var state = StressState.Create(stress);

        // Assert
        state.DefensePenalty.Should().Be(expectedPenalty);
    }

    [Test]
    [TestCase(79, false)]
    [TestCase(80, true)]
    [TestCase(99, true)]
    [TestCase(100, true)]
    public void HasSkillDisadvantage_SetCorrectly(int stress, bool expectedDisadvantage)
    {
        // Arrange & Act
        var state = StressState.Create(stress);

        // Assert
        state.HasSkillDisadvantage.Should().Be(expectedDisadvantage);
    }

    [Test]
    [TestCase(99, false)]
    [TestCase(100, true)]
    [TestCase(150, true)] // Clamped to 100
    public void RequiresTraumaCheck_TrueOnlyAt100OrAbove(int stress, bool expected)
    {
        // Arrange & Act
        var state = StressState.Create(stress);

        // Assert
        state.RequiresTraumaCheck.Should().Be(expected);
        state.CurrentStress.Should().BeLessOrEqualTo(100); // Verify clamping
    }
}
```

---

## 12. Use Cases

### UC-001: Evaluate Stress State

**Actor:** Combat System
**Flow:** Retrieve character stress → Create StressState → Check penalties → Apply to combat calculations
**Precondition:** Character has stress value
**Postcondition:** Defense penalty and disadvantage flags computed

### UC-002: Determine Threshold Change

**Actor:** Stress Service (v0.18.0d)
**Flow:** Compare previous StressState → Apply stress delta → Create new StressState → Detect threshold change
**Precondition:** Previous and new stress values known
**Postcondition:** Threshold transition detected for UI notification

### UC-003: Check Trauma Trigger

**Actor:** Game Loop
**Flow:** Read StressState → Check RequiresTraumaCheck → If true, initiate Trauma Check
**Precondition:** Stress applied to character
**Postcondition:** Trauma Check triggered if stress >= 100

### UC-004: Calculate Recovery Amount

**Actor:** Rest System (v0.18.0d)
**Flow:** Determine RestType → Get WILL attribute → Calculate recovery via extension method
**Precondition:** Character takes rest
**Postcondition:** Recovery amount determined

---

## 13. Deliverable Checklist

### Domain Layer — Enums

- [ ] `src/Core/RuneAndRust.Domain/Enums/StressThreshold.cs`
- [ ] `src/Core/RuneAndRust.Domain/Enums/StressThresholdExtensions.cs`
- [ ] `src/Core/RuneAndRust.Domain/Enums/StressSource.cs`
- [ ] `src/Core/RuneAndRust.Domain/Enums/StressSourceExtensions.cs`
- [ ] `src/Core/RuneAndRust.Domain/Enums/RestType.cs`
- [ ] `src/Core/RuneAndRust.Domain/Enums/RestTypeExtensions.cs`

### Domain Layer — Value Objects

- [ ] `src/Core/RuneAndRust.Domain/ValueObjects/StressState.cs`

### Unit Tests

- [ ] `tests/RuneAndRust.Domain.UnitTests/Enums/StressThresholdTests.cs`
- [ ] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/StressStateTests.cs`

### Documentation

- [ ] XML documentation on all public members
- [ ] Code examples in remarks where applicable
- [ ] Update scope breakdown to mark v0.18.0a complete

---

## 14. Acceptance Criteria

### Functional Criteria

- [ ] `StressThreshold` enum has exactly 6 values (Calm through Trauma)
- [ ] `StressThresholdExtensions.FromStressValue()` correctly maps all stress values 0-100
- [ ] `StressSource` enum has exactly 6 categories
- [ ] `RestType` enum has exactly 4 types
- [ ] `RestTypeExtensions.CalculateRecovery()` returns correct values for all rest types
- [ ] `StressState.Create()` clamps stress values to 0-100 range
- [ ] `StressState.DefensePenalty` equals `floor(CurrentStress / 20)`
- [ ] `StressState.HasSkillDisadvantage` is true when stress >= 80
- [ ] `StressState.RequiresTraumaCheck` is true when stress >= 100
- [ ] `StressState.WithStress()` returns new instance without mutating original

### Quality Criteria

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~4 unit tests pass
- [ ] XML documentation complete on all public types and members
- [ ] All enum values have XML summary documentation
- [ ] Code follows project conventions (file-scoped namespaces, primary constructors where appropriate)

### Code Style Criteria

- [ ] 4-space indentation in C# files
- [ ] File-scoped namespaces used
- [ ] Null-forgiving assignments in private constructors where needed
- [ ] ArgumentException helpers used for validation

---

## 15. Dependencies

### Required from Previous Versions

| Type | Version | Usage                                                           |
| ---- | ------- | --------------------------------------------------------------- |
| None | —       | This is foundational domain layer with no external dependencies |

### Provides to v0.18.0b

| Type              | Usage                                                         |
| ----------------- | ------------------------------------------------------------- |
| `StressThreshold` | Used by `StressCheckResult`, `StressApplicationResult`        |
| `StressSource`    | Used by `StressApplicationResult` to categorize stress events |
| `RestType`        | Used by `StressRecoveryResult` to track recovery source       |
| `StressState`     | Used by result objects to represent before/after states       |

### Provides to v0.18.0c

| Type              | Usage                                             |
| ----------------- | ------------------------------------------------- |
| `StressState`     | Return type for `IStressService.GetStressState()` |
| `StressThreshold` | Used in service interface parameter types         |
| `StressSource`    | Parameter in `ApplyStress()` method signature     |
| `RestType`        | Parameter in `RecoverStress()` method signature   |

### Provides to v0.18.0d

| Type              | Usage                                      |
| ----------------- | ------------------------------------------ |
| All types         | Consumed by `StressService` implementation |
| `StressState`     | Created and returned by service methods    |
| Extension methods | Used for calculations within service       |

---

## 16. Future Considerations

### Deferred to v0.18.0b

- **StressCheckResult** — Result object for resistance checks
- **StressApplicationResult** — Result object for stress application
- **StressRecoveryResult** — Result object for stress recovery

### Deferred to v0.18.0d

- **Recovery calculation integration** — Actual service implementing recovery formulas
- **Threshold change detection** — Event emission on threshold transitions
- **Logging integration** — Serilog structured logging for all stress operations

### Deferred to v0.18.0e

- **Configuration loading** — Stress source definitions from JSON
- **Configurable thresholds** — Allow threshold ranges to be data-driven

### Out of Scope

- **UI components** — Visual representation of stress (future TUI/GUI version)
- **Sound effects** — Audio feedback for stress changes
- **Trauma mechanics** — Permanent trauma system (v0.18.3)
- **Corruption integration** — Stress from corruption (v0.18.5)

---

_Document Version: 1.0_
_Last Updated: 2026-01-27_
_Author: AI Assistant (following wf-doc-design-specification workflow)_

---

## Appendix A: Stress Threshold Quick Reference

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    STRESS THRESHOLD QUICK REFERENCE                     │
├──────────────┬────────────┬───────────┬───────────────┬────────────────┤
│  Threshold   │ Stress     │ Defense   │ Skill         │ Trauma         │
│              │ Range      │ Penalty   │ Disadvantage  │ Check          │
├──────────────┼────────────┼───────────┼───────────────┼────────────────┤
│ Calm         │   0 - 19   │    0      │     No        │      No        │
│ Uneasy       │  20 - 39   │   -1      │     No        │      No        │
│ Anxious      │  40 - 59   │   -2      │     No        │      No        │
│ Panicked     │  60 - 79   │   -3      │     No        │      No        │
│ Breaking     │  80 - 99   │   -4      │ Non-combat    │      No        │
│ Trauma       │    100     │   -5      │ All checks    │     YES        │
└──────────────┴────────────┴───────────┴───────────────┴────────────────┘
```

## Appendix B: Recovery Type Quick Reference

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    RECOVERY TYPE QUICK REFERENCE                        │
├──────────────┬───────────────────┬──────────────────────────────────────┤
│  Rest Type   │ Recovery Formula  │ Example (WILL = 4)                   │
├──────────────┼───────────────────┼──────────────────────────────────────┤
│ Short        │ WILL × 2          │ 4 × 2 = 8 stress reduced             │
│ Long         │ WILL × 5          │ 4 × 5 = 20 stress reduced            │
│ Sanctuary    │ Full Reset        │ All stress restored to 0             │
│ Milestone    │ Fixed 25          │ 25 stress reduced                    │
└──────────────┴───────────────────┴──────────────────────────────────────┘
```
