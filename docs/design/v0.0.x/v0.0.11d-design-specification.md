# v0.0.11d Design Specification: Interactive Objects & Polish

**Version:** 0.0.11d
**Phase Name:** Interactive Objects & Polish
**Parent Version:** v0.0.11 (Descriptors & Ambience)
**Prerequisites:** v0.0.11a, v0.0.11b, v0.0.11c Complete
**Estimated Tests:** ~14 unit tests

---

## 1. Overview

### 1.1 Purpose

Add descriptors for interactive objects in the environment, implement an ambient event system for atmospheric occurrences, optimize descriptor performance with caching, and integrate all v0.0.11 descriptor systems into a cohesive experience. This phase polishes and unifies the descriptor framework.

### 1.2 Current State

| Area | Current State (v0.0.11c) | Target State (v0.0.11d) |
|------|--------------------------|-------------------------|
| Object descriptions | Static `Item.Description` field | Dynamic state-based descriptors |
| Object examination | Single description level | Progressive detail (glance, look, examine) |
| Interactive objects | Items only | Doors, chests, levers, statues, altars |
| Ambient events | None | Random atmospheric occurrences |
| Descriptor caching | None | Memory cache with TTL |
| System integration | Separate services | Unified descriptor orchestration |

### 1.3 Design Principles

1. **State-Driven Descriptions**: Object descriptors change based on object state (locked, open, broken)
2. **Progressive Detail**: More examination reveals more information
3. **Contextual Ambience**: Ambient events match environment context from v0.0.11a
4. **Performance First**: Caching prevents redundant descriptor loading
5. **Seamless Integration**: All v0.0.11 systems work together coherently

---

## 2. Scope

### 2.1 In Scope

- Interactive object type definitions (doors, chests, levers, statues, altars)
- Object state descriptor pools (locked, open, broken, activated, etc.)
- Object examination depth levels (glance, look, examine)
- `InteractiveObjectDescriptor` value object
- `ObjectDescriptorService` for state-based descriptions
- Ambient event definitions (sound, visual, creature, environmental)
- Ambient event triggers (exploration, time, combat)
- `AmbientEventService` for event generation
- `AmbientEvent` value object
- Descriptor caching layer with `IMemoryCache`
- `CachedDescriptorService` decorator
- Full v0.0.11 integration in room/combat rendering
- Configuration files: `objects.json`, `ambient-events.json`

### 2.2 Out of Scope (Future Versions)

- Object interaction mechanics (unlock, open, activate) - existing item system handles this
- New game mechanics based on objects
- Persistent object state across sessions
- Procedural object generation

---

## 3. Data Model

### 3.1 New: InteractiveObjectType (Enum)

**File:** `src/Core/RuneAndRust.Domain/Enums/InteractiveObjectType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Types of interactive objects that can be described in the environment.
/// </summary>
public enum InteractiveObjectType
{
    /// <summary>A door or gate.</summary>
    Door,

    /// <summary>A container that can be opened.</summary>
    Chest,

    /// <summary>A lever or switch mechanism.</summary>
    Lever,

    /// <summary>A decorative or magical statue.</summary>
    Statue,

    /// <summary>A religious or magical altar.</summary>
    Altar,

    /// <summary>A source of illumination.</summary>
    LightSource,

    /// <summary>A written message or plaque.</summary>
    Inscription,

    /// <summary>A water feature (fountain, pool, well).</summary>
    WaterFeature
}
```

### 3.2 New: ObjectState (Enum)

**File:** `src/Core/RuneAndRust.Domain/Enums/ObjectState.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Possible states of interactive objects.
/// </summary>
public enum ObjectState
{
    // General states
    /// <summary>Default state.</summary>
    Normal,

    /// <summary>Object is broken or damaged.</summary>
    Broken,

    /// <summary>Object has been destroyed.</summary>
    Destroyed,

    // Door/Chest states
    /// <summary>Closed but not locked.</summary>
    Closed,

    /// <summary>Open.</summary>
    Open,

    /// <summary>Locked and requires a key.</summary>
    Locked,

    /// <summary>Barred from the other side.</summary>
    Barred,

    // Container states
    /// <summary>Container is empty.</summary>
    Empty,

    /// <summary>Container is trapped.</summary>
    Trapped,

    // Lever states
    /// <summary>Lever is in up position.</summary>
    Up,

    /// <summary>Lever is in down position.</summary>
    Down,

    /// <summary>Mechanism is stuck.</summary>
    Stuck,

    // Altar/Statue states
    /// <summary>Active or powered.</summary>
    Active,

    /// <summary>Inactive or dormant.</summary>
    Inactive,

    /// <summary>Corrupted or desecrated.</summary>
    Desecrated,

    /// <summary>Blessed or sanctified.</summary>
    Blessed,

    /// <summary>Damaged but not destroyed.</summary>
    Damaged,

    /// <summary>Defaced or vandalized.</summary>
    Defaced,

    // Light source states
    /// <summary>Lit and providing light.</summary>
    Lit,

    /// <summary>Unlit or extinguished.</summary>
    Unlit,

    /// <summary>Flickering unreliably.</summary>
    Flickering
}
```

### 3.3 New: ExaminationDepth (Enum)

**File:** `src/Core/RuneAndRust.Domain/Enums/ExaminationDepth.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Levels of detail when examining an object.
/// </summary>
public enum ExaminationDepth
{
    /// <summary>Quick glance, minimal detail (room entry).</summary>
    Glance,

    /// <summary>Standard look command.</summary>
    Look,

    /// <summary>Detailed examination.</summary>
    Examine
}
```

### 3.4 New: InteractiveObjectDescriptor (Value Object)

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/InteractiveObjectDescriptor.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// A complete description of an interactive object based on type and state.
/// </summary>
/// <remarks>
/// Provides progressive detail based on examination depth, with each level
/// revealing more information about the object.
/// </remarks>
public readonly record struct InteractiveObjectDescriptor
{
    /// <summary>
    /// The type of interactive object.
    /// </summary>
    public InteractiveObjectType ObjectType { get; init; }

    /// <summary>
    /// The current state of the object.
    /// </summary>
    public ObjectState State { get; init; }

    /// <summary>
    /// Brief description shown on room entry (glance level).
    /// </summary>
    public string GlanceDescription { get; init; }

    /// <summary>
    /// Standard description shown with look command.
    /// </summary>
    public string LookDescription { get; init; }

    /// <summary>
    /// Detailed description shown with examine command.
    /// </summary>
    public string ExamineDescription { get; init; }

    /// <summary>
    /// Optional hint about interaction possibilities.
    /// </summary>
    public string? InteractionHint { get; init; }

    /// <summary>
    /// Gets the description appropriate for the examination depth.
    /// </summary>
    /// <param name="depth">The examination depth level.</param>
    /// <returns>The appropriate description text.</returns>
    public string GetDescription(ExaminationDepth depth)
    {
        return depth switch
        {
            ExaminationDepth.Glance => GlanceDescription,
            ExaminationDepth.Look => LookDescription,
            ExaminationDepth.Examine => BuildExamineDescription(),
            _ => LookDescription
        };
    }

    private string BuildExamineDescription()
    {
        var result = ExamineDescription;
        if (!string.IsNullOrEmpty(InteractionHint))
        {
            result += $" {InteractionHint}";
        }
        return result;
    }
}
```

### 3.5 New: AmbientEventType (Enum)

**File:** `src/Core/RuneAndRust.Domain/Enums/AmbientEventType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories of ambient events.
/// </summary>
public enum AmbientEventType
{
    /// <summary>An auditory event (distant sound, noise).</summary>
    Sound,

    /// <summary>A visual event (shadow movement, light flicker).</summary>
    Visual,

    /// <summary>A small creature event (rats, bats, insects).</summary>
    Creature,

    /// <summary>An environmental event (dust, water drip, wind).</summary>
    Environmental
}
```

### 3.6 New: AmbientEventTrigger (Enum)

**File:** `src/Core/RuneAndRust.Domain/Enums/AmbientEventTrigger.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Conditions that can trigger ambient events.
/// </summary>
public enum AmbientEventTrigger
{
    /// <summary>Random chance during exploration.</summary>
    Exploration,

    /// <summary>Time-based periodic trigger.</summary>
    Periodic,

    /// <summary>Triggered by combat starting or ending.</summary>
    Combat,

    /// <summary>Triggered by entering a new room.</summary>
    RoomEntry,

    /// <summary>Triggered by player action.</summary>
    PlayerAction
}
```

### 3.7 New: AmbientEvent (Value Object)

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/AmbientEvent.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents an ambient atmospheric event.
/// </summary>
/// <remarks>
/// Ambient events add life and atmosphere to the environment through
/// random occurrences that match the current biome and conditions.
/// </remarks>
public readonly record struct AmbientEvent
{
    /// <summary>
    /// The category of this event.
    /// </summary>
    public AmbientEventType EventType { get; init; }

    /// <summary>
    /// The event description text.
    /// </summary>
    public string Description { get; init; }

    /// <summary>
    /// The intensity level (0.0 to 1.0) for UI emphasis.
    /// </summary>
    /// <remarks>
    /// 0.0 = subtle, background event
    /// 0.5 = noticeable event
    /// 1.0 = attention-grabbing event
    /// </remarks>
    public float Intensity { get; init; }

    /// <summary>
    /// Whether this event should interrupt the current action display.
    /// </summary>
    public bool IsInterruptive { get; init; }

    /// <summary>
    /// Creates an empty/no event result.
    /// </summary>
    public static AmbientEvent None => new()
    {
        EventType = AmbientEventType.Environmental,
        Description = string.Empty,
        Intensity = 0f,
        IsInterruptive = false
    };

    /// <summary>
    /// Returns true if this represents an actual event.
    /// </summary>
    public bool HasEvent => !string.IsNullOrEmpty(Description);
}
```

### 3.8 New: ObjectDescriptorContext (Value Object)

**File:** `src/Core/RuneAndRust.Application/Services/ObjectDescriptorContext.cs`

```csharp
namespace RuneAndRust.Application.Services;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Context for generating object descriptions.
/// </summary>
public record ObjectDescriptorContext
{
    /// <summary>
    /// The type of object to describe.
    /// </summary>
    public InteractiveObjectType ObjectType { get; init; }

    /// <summary>
    /// The current state of the object.
    /// </summary>
    public ObjectState State { get; init; }

    /// <summary>
    /// The level of examination detail.
    /// </summary>
    public ExaminationDepth Depth { get; init; } = ExaminationDepth.Look;

    /// <summary>
    /// The environment context for coherent descriptors.
    /// </summary>
    public EnvironmentContext? Environment { get; init; }

    /// <summary>
    /// Optional material/composition (wood, iron, stone).
    /// </summary>
    public string? Material { get; init; }

    /// <summary>
    /// Optional age/condition modifier (ancient, new, worn).
    /// </summary>
    public string? Age { get; init; }

    /// <summary>
    /// Additional tags for filtering.
    /// </summary>
    public IReadOnlyList<string> Tags { get; init; } = [];
}
```

### 3.9 New: AmbientEventContext (Value Object)

**File:** `src/Core/RuneAndRust.Application/Services/AmbientEventContext.cs`

```csharp
namespace RuneAndRust.Application.Services;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Context for generating ambient events.
/// </summary>
public record AmbientEventContext
{
    /// <summary>
    /// The environment context from v0.0.11a.
    /// </summary>
    public EnvironmentContext Environment { get; init; }

    /// <summary>
    /// The sensory context from v0.0.11c.
    /// </summary>
    public SensoryContext? Sensory { get; init; }

    /// <summary>
    /// The trigger condition for this event check.
    /// </summary>
    public AmbientEventTrigger Trigger { get; init; }

    /// <summary>
    /// Whether combat is currently active.
    /// </summary>
    public bool InCombat { get; init; }

    /// <summary>
    /// Time since last ambient event (for cooldown).
    /// </summary>
    public TimeSpan TimeSinceLastEvent { get; init; }

    /// <summary>
    /// Number of turns/actions since entering this room.
    /// </summary>
    public int TurnsInRoom { get; init; }
}
```

---

## 4. Services

### 4.1 ObjectDescriptorService

**File:** `src/Core/RuneAndRust.Application/Services/ObjectDescriptorService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Generates state-based descriptions for interactive objects.
/// </summary>
/// <remarks>
/// This service provides progressive detail descriptions for interactive objects
/// based on their type, state, and the depth of examination. It integrates with
/// the environment context from v0.0.11a for coherent descriptions.
/// </remarks>
public class ObjectDescriptorService
{
    private readonly DescriptorService _descriptorService;
    private readonly ObjectDescriptorConfiguration _config;
    private readonly ILogger<ObjectDescriptorService> _logger;

    public ObjectDescriptorService(
        DescriptorService descriptorService,
        ObjectDescriptorConfiguration config,
        ILogger<ObjectDescriptorService> logger)
    {
        _descriptorService = descriptorService ?? throw new ArgumentNullException(nameof(descriptorService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));

        _logger.LogDebug(
            "ObjectDescriptorService initialized with {ObjectTypes} object types",
            _config.ObjectTypes.Count);
    }

    /// <summary>
    /// Generates a complete descriptor for an interactive object.
    /// </summary>
    /// <param name="context">The object descriptor context.</param>
    /// <returns>A complete interactive object descriptor.</returns>
    public InteractiveObjectDescriptor GenerateDescriptor(ObjectDescriptorContext context)
    {
        _logger.LogDebug(
            "Generating descriptor for {ObjectType} in state {State} at depth {Depth}",
            context.ObjectType, context.State, context.Depth);

        var tags = BuildTags(context);
        var objectTypeName = context.ObjectType.ToString().ToLowerInvariant();
        var stateName = context.State.ToString().ToLowerInvariant();

        return new InteractiveObjectDescriptor
        {
            ObjectType = context.ObjectType,
            State = context.State,
            GlanceDescription = GetGlanceDescription(objectTypeName, stateName, tags),
            LookDescription = GetLookDescription(objectTypeName, stateName, tags),
            ExamineDescription = GetExamineDescription(objectTypeName, stateName, context, tags),
            InteractionHint = GetInteractionHint(context.ObjectType, context.State)
        };
    }

    /// <summary>
    /// Gets a brief glance description for room entry.
    /// </summary>
    public string GetGlanceDescription(
        InteractiveObjectType objectType,
        ObjectState state)
    {
        var objectTypeName = objectType.ToString().ToLowerInvariant();
        var stateName = state.ToString().ToLowerInvariant();
        return GetGlanceDescription(objectTypeName, stateName, []);
    }

    /// <summary>
    /// Gets a description appropriate for the examination depth.
    /// </summary>
    public string GetDescription(ObjectDescriptorContext context)
    {
        var descriptor = GenerateDescriptor(context);
        return descriptor.GetDescription(context.Depth);
    }

    private string GetGlanceDescription(string objectType, string state, List<string> tags)
    {
        // Pool path: objects.{type}_{state}_glance or objects.{type}_glance
        var poolPath = $"objects.{objectType}_{state}_glance";
        var description = _descriptorService.GetDescriptor(poolPath, tags);

        if (string.IsNullOrEmpty(description))
        {
            poolPath = $"objects.{objectType}_glance";
            description = _descriptorService.GetDescriptor(poolPath, tags);
        }

        return description ?? GetDefaultGlance(objectType, state);
    }

    private string GetLookDescription(string objectType, string state, List<string> tags)
    {
        // Pool path: objects.{type}_{state}_look or objects.{type}_look
        var poolPath = $"objects.{objectType}_{state}_look";
        var description = _descriptorService.GetDescriptor(poolPath, tags);

        if (string.IsNullOrEmpty(description))
        {
            poolPath = $"objects.{objectType}_look";
            description = _descriptorService.GetDescriptor(poolPath, tags);
        }

        return description ?? GetDefaultLook(objectType, state);
    }

    private string GetExamineDescription(
        string objectType,
        string state,
        ObjectDescriptorContext context,
        List<string> tags)
    {
        // Pool path: objects.{type}_{state}_examine or objects.{type}_examine
        var poolPath = $"objects.{objectType}_{state}_examine";
        var description = _descriptorService.GetDescriptor(poolPath, tags);

        if (string.IsNullOrEmpty(description))
        {
            poolPath = $"objects.{objectType}_examine";
            description = _descriptorService.GetDescriptor(poolPath, tags);
        }

        // Add material/age details if present
        if (!string.IsNullOrEmpty(context.Material))
        {
            description = AddMaterialDetail(description, context.Material);
        }

        if (!string.IsNullOrEmpty(context.Age))
        {
            description = AddAgeDetail(description, context.Age);
        }

        return description ?? GetDefaultExamine(objectType, state);
    }

    private string? GetInteractionHint(InteractiveObjectType objectType, ObjectState state)
    {
        return (objectType, state) switch
        {
            (InteractiveObjectType.Door, ObjectState.Locked) => "It might be opened with the right key.",
            (InteractiveObjectType.Door, ObjectState.Closed) => "It could be opened.",
            (InteractiveObjectType.Chest, ObjectState.Locked) => "A key might reveal its contents.",
            (InteractiveObjectType.Chest, ObjectState.Closed) => "It awaits opening.",
            (InteractiveObjectType.Lever, ObjectState.Up) or
            (InteractiveObjectType.Lever, ObjectState.Down) => "It could be pulled.",
            (InteractiveObjectType.Lever, ObjectState.Stuck) => "It seems jammed.",
            (InteractiveObjectType.Altar, ObjectState.Active) => "It radiates power.",
            (InteractiveObjectType.Altar, ObjectState.Inactive) => "It might be activated.",
            _ => null
        };
    }

    private List<string> BuildTags(ObjectDescriptorContext context)
    {
        var tags = new List<string>(context.Tags);

        if (context.Environment != null)
        {
            if (!string.IsNullOrEmpty(context.Environment.Biome))
                tags.Add(context.Environment.Biome);
            if (!string.IsNullOrEmpty(context.Environment.Era))
                tags.Add(context.Environment.Era);
        }

        if (!string.IsNullOrEmpty(context.Material))
            tags.Add(context.Material);

        if (!string.IsNullOrEmpty(context.Age))
            tags.Add(context.Age);

        return tags;
    }

    private static string AddMaterialDetail(string? description, string material)
    {
        if (string.IsNullOrEmpty(description)) return $"It is made of {material}.";
        return $"{description} It is crafted from {material}.";
    }

    private static string AddAgeDetail(string? description, string age)
    {
        if (string.IsNullOrEmpty(description)) return $"It appears {age}.";
        return $"{description} It appears {age}.";
    }

    private static string GetDefaultGlance(string objectType, string state)
        => $"A {state} {objectType} is here.";

    private static string GetDefaultLook(string objectType, string state)
        => $"You see a {objectType}. It is {state}.";

    private static string GetDefaultExamine(string objectType, string state)
        => $"Upon closer examination, you see a {objectType} that is {state}.";
}
```

### 4.2 AmbientEventService

**File:** `src/Core/RuneAndRust.Application/Services/AmbientEventService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Generates ambient atmospheric events based on context.
/// </summary>
/// <remarks>
/// This service creates random atmospheric occurrences that add life
/// to the environment. Events are filtered by biome, trigger type,
/// and cooldown to prevent spam while maintaining immersion.
/// </remarks>
public class AmbientEventService
{
    private readonly DescriptorService _descriptorService;
    private readonly AmbientEventConfiguration _config;
    private readonly ILogger<AmbientEventService> _logger;
    private readonly Random _random = new();

    /// <summary>
    /// Minimum time between ambient events.
    /// </summary>
    private static readonly TimeSpan MinEventCooldown = TimeSpan.FromSeconds(30);

    /// <summary>
    /// Base chance for an ambient event to trigger (0.0 to 1.0).
    /// </summary>
    private const float BaseEventChance = 0.15f;

    public AmbientEventService(
        DescriptorService descriptorService,
        AmbientEventConfiguration config,
        ILogger<AmbientEventService> logger)
    {
        _descriptorService = descriptorService ?? throw new ArgumentNullException(nameof(descriptorService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));

        _logger.LogDebug(
            "AmbientEventService initialized with {EventPools} event pools",
            _config.EventPools.Count);
    }

    /// <summary>
    /// Attempts to generate an ambient event based on context.
    /// </summary>
    /// <param name="context">The ambient event context.</param>
    /// <returns>An ambient event if triggered, otherwise AmbientEvent.None.</returns>
    public AmbientEvent TryGenerateEvent(AmbientEventContext context)
    {
        // Check cooldown
        if (context.TimeSinceLastEvent < MinEventCooldown)
        {
            _logger.LogDebug("Event on cooldown, skipping");
            return AmbientEvent.None;
        }

        // Suppress events during combat (except combat trigger type)
        if (context.InCombat && context.Trigger != AmbientEventTrigger.Combat)
        {
            _logger.LogDebug("In combat, suppressing non-combat events");
            return AmbientEvent.None;
        }

        // Calculate event chance based on trigger and context
        var chance = CalculateEventChance(context);

        if (_random.NextDouble() > chance)
        {
            _logger.LogDebug("Event roll failed (chance: {Chance})", chance);
            return AmbientEvent.None;
        }

        // Generate the event
        return GenerateEvent(context);
    }

    /// <summary>
    /// Forces generation of an ambient event (bypasses chance roll).
    /// </summary>
    /// <param name="context">The ambient event context.</param>
    /// <returns>An ambient event.</returns>
    public AmbientEvent ForceGenerateEvent(AmbientEventContext context)
    {
        return GenerateEvent(context);
    }

    /// <summary>
    /// Gets an event of a specific type.
    /// </summary>
    /// <param name="eventType">The type of event to generate.</param>
    /// <param name="context">The ambient event context.</param>
    /// <returns>An ambient event of the specified type.</returns>
    public AmbientEvent GetEventOfType(AmbientEventType eventType, AmbientEventContext context)
    {
        var tags = BuildEventTags(context);
        var biome = context.Environment.Biome ?? "dungeon";

        // Try biome-specific pool first
        var poolPath = $"ambient.{eventType.ToString().ToLowerInvariant()}_{biome}";
        var description = _descriptorService.GetDescriptor(poolPath, tags);

        // Fall back to generic pool
        if (string.IsNullOrEmpty(description))
        {
            poolPath = $"ambient.{eventType.ToString().ToLowerInvariant()}";
            description = _descriptorService.GetDescriptor(poolPath, tags);
        }

        if (string.IsNullOrEmpty(description))
        {
            return AmbientEvent.None;
        }

        return new AmbientEvent
        {
            EventType = eventType,
            Description = description,
            Intensity = DetermineIntensity(eventType, context),
            IsInterruptive = ShouldInterrupt(eventType, context)
        };
    }

    private AmbientEvent GenerateEvent(AmbientEventContext context)
    {
        // Select event type based on context
        var eventType = SelectEventType(context);

        _logger.LogDebug(
            "Generating {EventType} event for biome {Biome}",
            eventType, context.Environment.Biome);

        return GetEventOfType(eventType, context);
    }

    private AmbientEventType SelectEventType(AmbientEventContext context)
    {
        var weights = new Dictionary<AmbientEventType, float>
        {
            { AmbientEventType.Sound, 35f },
            { AmbientEventType.Environmental, 30f },
            { AmbientEventType.Visual, 20f },
            { AmbientEventType.Creature, 15f }
        };

        // Adjust weights based on biome
        var biome = context.Environment.Biome;
        if (biome == "cave" || biome == "dungeon")
        {
            weights[AmbientEventType.Sound] += 10f;
            weights[AmbientEventType.Creature] += 5f;
        }
        else if (biome == "forest")
        {
            weights[AmbientEventType.Creature] += 15f;
            weights[AmbientEventType.Environmental] += 5f;
        }
        else if (biome == "volcanic")
        {
            weights[AmbientEventType.Environmental] += 15f;
            weights[AmbientEventType.Visual] += 10f;
        }

        // Adjust based on trigger
        if (context.Trigger == AmbientEventTrigger.Combat)
        {
            weights[AmbientEventType.Sound] += 20f;
        }

        return SelectWeighted(weights);
    }

    private float CalculateEventChance(AmbientEventContext context)
    {
        var chance = BaseEventChance;

        // Increase chance based on time in room
        chance += context.TurnsInRoom * 0.02f;

        // Trigger-specific modifiers
        chance *= context.Trigger switch
        {
            AmbientEventTrigger.RoomEntry => 0.5f,  // Less likely on entry
            AmbientEventTrigger.Exploration => 1.0f,
            AmbientEventTrigger.Periodic => 1.2f,
            AmbientEventTrigger.Combat => 0.3f,     // Rare during combat
            _ => 1.0f
        };

        // Cap at 50%
        return Math.Min(chance, 0.5f);
    }

    private float DetermineIntensity(AmbientEventType eventType, AmbientEventContext context)
    {
        // Base intensity by type
        var intensity = eventType switch
        {
            AmbientEventType.Sound => 0.4f,
            AmbientEventType.Visual => 0.5f,
            AmbientEventType.Creature => 0.6f,
            AmbientEventType.Environmental => 0.3f,
            _ => 0.5f
        };

        // Combat increases intensity
        if (context.InCombat)
        {
            intensity += 0.2f;
        }

        return Math.Clamp(intensity, 0f, 1f);
    }

    private bool ShouldInterrupt(AmbientEventType eventType, AmbientEventContext context)
    {
        // Only high-intensity events during exploration interrupt
        if (context.InCombat) return false;

        return eventType == AmbientEventType.Creature &&
               _random.NextDouble() > 0.7;
    }

    private List<string> BuildEventTags(AmbientEventContext context)
    {
        var tags = new List<string>();

        if (!string.IsNullOrEmpty(context.Environment.Biome))
            tags.Add(context.Environment.Biome);

        if (!string.IsNullOrEmpty(context.Environment.Climate))
            tags.Add(context.Environment.Climate);

        if (!string.IsNullOrEmpty(context.Environment.Lighting))
            tags.Add(context.Environment.Lighting);

        if (context.InCombat)
            tags.Add("combat");

        return tags;
    }

    private T SelectWeighted<T>(Dictionary<T, float> weights) where T : notnull
    {
        var total = weights.Values.Sum();
        var roll = _random.NextDouble() * total;

        foreach (var (item, weight) in weights)
        {
            roll -= weight;
            if (roll <= 0)
                return item;
        }

        return weights.Keys.First();
    }
}
```

### 4.3 CachedDescriptorService (Decorator)

**File:** `src/Core/RuneAndRust.Application/Services/CachedDescriptorService.cs`

```csharp
using Microsoft.Extensions.Caching.Memory;
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;

namespace RuneAndRust.Application.Services;

/// <summary>
/// A caching decorator for DescriptorService that improves performance.
/// </summary>
/// <remarks>
/// This decorator wraps the base DescriptorService and caches descriptor pool
/// lookups to avoid redundant file I/O and parsing. The cache uses a sliding
/// expiration to balance memory usage with performance.
/// </remarks>
public class CachedDescriptorService : DescriptorService
{
    private readonly IMemoryCache _cache;
    private readonly ILogger<CachedDescriptorService> _cachedLogger;

    /// <summary>
    /// Default cache entry expiration time.
    /// </summary>
    private static readonly TimeSpan DefaultExpiration = TimeSpan.FromMinutes(5);

    /// <summary>
    /// Cache key prefix for descriptor entries.
    /// </summary>
    private const string CacheKeyPrefix = "descriptor_";

    public CachedDescriptorService(
        IReadOnlyDictionary<string, DescriptorPool> pools,
        ThemeConfiguration theme,
        ILogger<DescriptorService> baseLogger,
        IMemoryCache cache,
        ILogger<CachedDescriptorService> cachedLogger)
        : base(pools, theme, baseLogger)
    {
        _cache = cache ?? throw new ArgumentNullException(nameof(cache));
        _cachedLogger = cachedLogger ?? throw new ArgumentNullException(nameof(cachedLogger));

        _cachedLogger.LogDebug("CachedDescriptorService initialized with {Expiration} expiration",
            DefaultExpiration);
    }

    /// <summary>
    /// Gets a cached descriptor or generates and caches a new one.
    /// </summary>
    /// <param name="poolPath">The pool path.</param>
    /// <param name="tags">Optional tags for filtering.</param>
    /// <param name="context">Optional context.</param>
    /// <param name="cacheResult">Whether to cache the result (default true).</param>
    /// <returns>The descriptor text.</returns>
    public string GetDescriptorCached(
        string poolPath,
        IEnumerable<string>? tags = null,
        DescriptorContext? context = null,
        bool cacheResult = true)
    {
        // For context-sensitive requests, skip caching
        if (context != null || !cacheResult)
        {
            return base.GetDescriptor(poolPath, tags, context);
        }

        var tagKey = tags != null ? string.Join(",", tags.OrderBy(t => t)) : "";
        var cacheKey = $"{CacheKeyPrefix}{poolPath}_{tagKey}";

        if (_cache.TryGetValue(cacheKey, out string? cached) && cached != null)
        {
            _cachedLogger.LogDebug("Cache hit for {PoolPath}", poolPath);
            return cached;
        }

        var result = base.GetDescriptor(poolPath, tags, context);

        if (!string.IsNullOrEmpty(result))
        {
            var cacheOptions = new MemoryCacheEntryOptions()
                .SetSlidingExpiration(DefaultExpiration)
                .SetPriority(CacheItemPriority.Normal);

            _cache.Set(cacheKey, result, cacheOptions);
            _cachedLogger.LogDebug("Cached descriptor for {PoolPath}", poolPath);
        }

        return result;
    }

    /// <summary>
    /// Invalidates all cached descriptors for a pool.
    /// </summary>
    /// <param name="poolPath">The pool path to invalidate.</param>
    public void InvalidatePool(string poolPath)
    {
        // Since IMemoryCache doesn't support key enumeration,
        // we would need a separate tracking mechanism for full invalidation.
        // For now, rely on expiration.
        _cachedLogger.LogDebug("Pool invalidation requested for {PoolPath}", poolPath);
    }

    /// <summary>
    /// Clears the entire descriptor cache.
    /// </summary>
    public void ClearCache()
    {
        // IMemoryCache doesn't support full clear without disposing.
        // This would require a custom cache implementation or tracking.
        _cachedLogger.LogInformation("Cache clear requested - entries will expire naturally");
    }
}
```

### 4.4 Service Integration Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    v0.0.11 INTEGRATION FLOW                     │
└─────────────────────────────────────────────────────────────────┘

    Room.Enter() or Look Command
           │
           ▼
    ┌──────────────────────────────────────────┐
    │        GameSessionService                │
    │  BuildRoomDescription(room)              │
    └──────────────────────────────────────────┘
           │
           ├──────────────────────────────────────────────────────┐
           │                                                      │
           ▼                                                      ▼
    ┌──────────────────────┐                      ┌──────────────────────┐
    │  EnvironmentContext  │◄─────────────────────│  Room Properties     │
    │  (from v0.0.11a)     │   Build context      │  Biome, Era, etc.    │
    └──────────────────────┘                      └──────────────────────┘
           │
           ├──────────────────────────────────────────────────────┐
           │                                                      │
           ▼                                                      ▼
    ┌──────────────────────┐                      ┌──────────────────────┐
    │  SensoryDescriptor   │                      │  ObjectDescriptor    │
    │  Service (v0.0.11c)  │                      │  Service (v0.0.11d)  │
    │                      │                      │                      │
    │  • Lighting          │                      │  • Doors             │
    │  • Sounds            │                      │  • Chests            │
    │  • Smells            │                      │  • Levers            │
    │  • Temperature       │                      │  • Statues           │
    │  • Weather           │                      │  • Altars            │
    └──────────────────────┘                      └──────────────────────┘
           │                                              │
           └──────────────────┬───────────────────────────┘
                              │
                              ▼
                   ┌──────────────────────┐
                   │  CombatDescriptor    │  (if in combat)
                   │  Service (v0.0.11b)  │
                   │                      │
                   │  • Hit descriptions  │
                   │  • Death descriptions│
                   │  • Ability effects   │
                   └──────────────────────┘
                              │
                              ▼
                   ┌──────────────────────┐
                   │  AmbientEventService │  (random trigger)
                   │  (v0.0.11d)          │
                   │                      │
                   │  • Sound events      │
                   │  • Visual events     │
                   │  • Creature events   │
                   │  • Environmental     │
                   └──────────────────────┘
                              │
                              ▼
                   ┌──────────────────────┐
                   │  Composed Output     │
                   │                      │
                   │  Room description +  │
                   │  Sensory atmosphere +│
                   │  Object descriptions+│
                   │  Ambient event       │
                   └──────────────────────┘

All services use:
┌──────────────────────────────────────────────────────────────────┐
│  CachedDescriptorService (decorator)                             │
│    └── DescriptorService (base)                                  │
│          └── Descriptor pools from JSON configuration            │
└──────────────────────────────────────────────────────────────────┘
```

---

## 5. Command Changes

### 5.1 Enhanced Examine Command

The existing `examine` command will use `ObjectDescriptorService` for detailed object descriptions:

```csharp
// In ExamineCommandHandler or GameView:
public async Task HandleExamineAsync(string target)
{
    // Check for interactive objects first
    var interactiveObject = _room.GetInteractiveObject(target);
    if (interactiveObject != null)
    {
        var context = new ObjectDescriptorContext
        {
            ObjectType = interactiveObject.Type,
            State = interactiveObject.State,
            Depth = ExaminationDepth.Examine,
            Environment = _currentEnvironmentContext,
            Material = interactiveObject.Material,
            Age = interactiveObject.Age
        };

        var description = _objectDescriptorService.GetDescription(context);
        await _renderer.RenderExaminationAsync(description);
        return;
    }

    // Fall back to existing item examination
    await HandleExamineItemAsync(target);
}
```

### 5.2 Look Command Enhancement

The `look` command uses `ExaminationDepth.Look` for object descriptions:

```csharp
public async Task HandleLookAsync()
{
    var room = _gameSession.CurrentRoom;

    // Build room description with sensory atmosphere (v0.0.11c)
    var sensoryContext = BuildSensoryContext(room);
    var atmosphere = _sensoryService.GenerateBriefAtmosphere(sensoryContext);

    // Get object descriptions at Look depth
    var objectDescriptions = room.InteractiveObjects
        .Select(obj => _objectDescriptorService.GetGlanceDescription(obj.Type, obj.State))
        .ToList();

    // Check for ambient event
    var eventContext = BuildAmbientContext(room);
    var ambientEvent = _ambientEventService.TryGenerateEvent(eventContext);

    await _renderer.RenderRoomDescriptionAsync(
        room.Description,
        atmosphere,
        objectDescriptions,
        ambientEvent.HasEvent ? ambientEvent.Description : null);
}
```

---

## 6. Rendering Changes

### 6.1 Room Description with Objects

**Standard look:**
```
The Dungeon Corridor

A narrow stone passage stretches before you, its walls glistening with moisture.
Flickering torchlight casts dancing shadows across the walls. Water drips steadily
from the ceiling. A damp chill clings to your skin.

A heavy iron door bars the way to the north.
An old wooden chest sits in the corner.
A rusted lever protrudes from the wall.

Exits: north, south
```

### 6.2 Detailed Examination

**examine door:**
```
You examine the iron door more closely.

The door is a heavy slab of blackened iron, riveted with thick bolts that have
rusted to a deep orange. The metal is cold to the touch, and you can see faint
scratches around the lock mechanism - someone has tried to pick it before.
A sturdy lock secures the door. It might be opened with the right key.
```

### 6.3 Ambient Event Display

**During exploration:**
```
> look

[Normal room description...]

*Something skitters in the shadows just beyond your torchlight.*
```

**Subtle event (low intensity):**
```
> north

You move north into the next chamber.

[Room description...]

A distant rumbling echoes through the stone.
```

### 6.4 Object State Examples

**Door states:**
```
Closed:  "A heavy wooden door bars the passage."
Open:    "A wooden door stands open, revealing the way forward."
Locked:  "A sturdy door blocks your path. It rattles but won't budge."
Barred:  "The door is barred from the other side."
Broken:  "A splintered door hangs askew on its hinges."
```

**Chest states:**
```
Closed:  "An old chest sits against the wall."
Open:    "An opened chest reveals its emptied interior."
Locked:  "An iron-banded chest gleams dully. A large lock secures the lid."
Empty:   "An empty chest lies open, its treasures long gone."
Trapped: "A chest sits here. Something about it feels... wrong."
```

**Lever states:**
```
Up:      "A lever in the up position protrudes from the wall."
Down:    "A lever has been pulled to the down position."
Stuck:   "A rusted lever appears frozen in place."
Broken:  "A snapped lever stump juts from the wall."
```

---

## 7. Configuration

### 7.1 objects.json

**File:** `config/descriptors/objects.json`

```json
{
  "category": "objects",
  "pools": {
    "door_closed_glance": {
      "id": "door_closed_glance",
      "name": "Door (Closed) - Glance",
      "descriptors": [
        { "id": "heavy_door", "text": "A heavy door bars the passage", "weight": 25 },
        { "id": "wooden_door", "text": "A wooden door blocks the way", "weight": 25 },
        { "id": "iron_door", "text": "An iron-bound door stands before you", "weight": 20, "tags": ["dungeon"] },
        { "id": "stone_door", "text": "A massive stone door blocks the corridor", "weight": 15, "tags": ["ancient", "ruins"] },
        { "id": "simple_door", "text": "A door leads onward", "weight": 15 }
      ]
    },
    "door_locked_glance": {
      "id": "door_locked_glance",
      "name": "Door (Locked) - Glance",
      "descriptors": [
        { "id": "locked_door", "text": "A locked door bars your path", "weight": 30 },
        { "id": "secured_door", "text": "A securely locked door blocks the way", "weight": 25 },
        { "id": "reinforced_door", "text": "A reinforced door refuses to budge", "weight": 25 },
        { "id": "sealed_door", "text": "A sealed door prevents passage", "weight": 20 }
      ]
    },
    "door_examine": {
      "id": "door_examine",
      "name": "Door - Examine",
      "descriptors": [
        {
          "id": "iron_riveted",
          "text": "The door is a heavy slab of blackened iron, riveted with thick bolts that have rusted to a deep orange. The metal is cold to the touch",
          "weight": 20,
          "tags": ["dungeon", "iron"]
        },
        {
          "id": "oak_ancient",
          "text": "Ancient oak panels form this door, darkened by centuries of torch smoke. Iron bands reinforce the wood, though they show signs of rust",
          "weight": 20,
          "tags": ["ancient", "wooden"]
        },
        {
          "id": "stone_carved",
          "text": "This stone door is carved with weathered reliefs that have been worn smooth by time. The edges are precisely cut despite their age",
          "weight": 15,
          "tags": ["ruins", "stone"]
        },
        {
          "id": "simple_wooden",
          "text": "A simple wooden door of rough-hewn planks. The wood is warped from moisture, and the iron hinges are spotted with rust",
          "weight": 25,
          "tags": ["wooden"]
        },
        {
          "id": "ornate_carved",
          "text": "Ornate carvings decorate this door, depicting scenes now difficult to discern. The craftsmanship suggests this was once a place of importance",
          "weight": 20,
          "tags": ["ancient", "ornate"]
        }
      ]
    },
    "chest_closed_glance": {
      "id": "chest_closed_glance",
      "name": "Chest (Closed) - Glance",
      "descriptors": [
        { "id": "old_chest", "text": "An old chest sits against the wall", "weight": 25 },
        { "id": "wooden_chest", "text": "A wooden chest rests in the corner", "weight": 25 },
        { "id": "iron_chest", "text": "An iron-banded chest gleams dully", "weight": 20 },
        { "id": "ornate_chest", "text": "An ornately carved chest catches your eye", "weight": 15 },
        { "id": "small_chest", "text": "A small chest sits here", "weight": 15 }
      ]
    },
    "chest_locked_glance": {
      "id": "chest_locked_glance",
      "name": "Chest (Locked) - Glance",
      "descriptors": [
        { "id": "locked_chest", "text": "A locked chest sits against the wall", "weight": 30 },
        { "id": "secured_chest", "text": "A securely locked chest awaits", "weight": 25 },
        { "id": "padlocked_chest", "text": "A heavy padlock secures this chest", "weight": 25 },
        { "id": "sealed_chest", "text": "A sealed chest defies casual opening", "weight": 20 }
      ]
    },
    "chest_examine": {
      "id": "chest_examine",
      "name": "Chest - Examine",
      "descriptors": [
        {
          "id": "iron_banded",
          "text": "This sturdy chest is reinforced with iron bands that have begun to rust. The wood beneath is solid oak, darkened with age. The hinges are well-oiled despite the rust elsewhere",
          "weight": 25
        },
        {
          "id": "simple_wooden",
          "text": "A simple wooden chest of pine planks. The corners are worn smooth, and the lid shows scratches from countless openings",
          "weight": 25
        },
        {
          "id": "ornate_carved",
          "text": "Intricate carvings adorn every surface of this chest. The motifs suggest it once belonged to someone of considerable means. Gold leaf still clings to some of the deeper grooves",
          "weight": 20,
          "tags": ["ornate", "treasure"]
        },
        {
          "id": "ancient_sealed",
          "text": "This ancient chest is sealed with wax and bound with silver chains tarnished black. Whatever lies within has been locked away for a very long time",
          "weight": 15,
          "tags": ["ancient", "magical"]
        },
        {
          "id": "travel_worn",
          "text": "A travel-worn chest bears the scars of a long journey. Shipping labels in unknown languages are plastered across its sides",
          "weight": 15
        }
      ]
    },
    "lever_glance": {
      "id": "lever_glance",
      "name": "Lever - Glance",
      "descriptors": [
        { "id": "iron_lever", "text": "An iron lever protrudes from the wall", "weight": 30 },
        { "id": "rusted_lever", "text": "A rusted lever juts from the stone", "weight": 25 },
        { "id": "brass_lever", "text": "A brass lever gleams in the dim light", "weight": 20 },
        { "id": "hidden_lever", "text": "A lever is partially concealed in an alcove", "weight": 15 },
        { "id": "ornate_lever", "text": "An ornately crafted lever awaits pulling", "weight": 10 }
      ]
    },
    "lever_examine": {
      "id": "lever_examine",
      "name": "Lever - Examine",
      "descriptors": [
        {
          "id": "mechanism_visible",
          "text": "The lever connects to a complex mechanism hidden within the wall. Chains and gears are visible through gaps in the stonework",
          "weight": 25
        },
        {
          "id": "simple_switch",
          "text": "A simple lever mechanism. The pivot point shows wear from regular use, and the handle is smooth from many hands",
          "weight": 30
        },
        {
          "id": "mysterious_device",
          "text": "The lever's purpose is unclear. Strange symbols are carved around its base, and faint traces of magical residue cling to the metal",
          "weight": 20,
          "tags": ["magical"]
        },
        {
          "id": "ancient_mechanism",
          "text": "This ancient lever mechanism has somehow survived the ages. The engineering is remarkable - counterweights and pulleys in perfect balance despite the rust",
          "weight": 25,
          "tags": ["ancient"]
        }
      ]
    },
    "statue_glance": {
      "id": "statue_glance",
      "name": "Statue - Glance",
      "descriptors": [
        { "id": "stone_statue", "text": "A stone statue stands in silent vigil", "weight": 25 },
        { "id": "worn_statue", "text": "A weathered statue watches over the room", "weight": 25 },
        { "id": "armored_statue", "text": "A statue of an armored figure looms nearby", "weight": 20 },
        { "id": "robed_statue", "text": "A robed figure immortalized in stone stands here", "weight": 20 },
        { "id": "creature_statue", "text": "A statue of some strange creature crouches in the corner", "weight": 10 }
      ]
    },
    "statue_examine": {
      "id": "statue_examine",
      "name": "Statue - Examine",
      "descriptors": [
        {
          "id": "warrior_detail",
          "text": "The statue depicts a warrior in full battle dress. Every scale of armor, every link of chain is rendered in exacting detail. The face shows a stern determination",
          "weight": 25
        },
        {
          "id": "deity_figure",
          "text": "This statue represents a deity or powerful figure. The pose suggests benevolence, but the eyes seem to follow you. An inscription at the base has worn away",
          "weight": 20
        },
        {
          "id": "damaged_statue",
          "text": "Time and vandals have not been kind to this statue. The face has been deliberately defaced, and one arm lies shattered on the floor",
          "weight": 20,
          "tags": ["damaged", "defaced"]
        },
        {
          "id": "magical_statue",
          "text": "A faint glow emanates from within the stone. The statue's eyes seem almost alive, and you could swear it shifts slightly when you're not looking directly at it",
          "weight": 15,
          "tags": ["magical", "active"]
        },
        {
          "id": "ancient_figure",
          "text": "The statue's style is unfamiliar - perhaps from a civilization long forgotten. Despite its age, the stone remains unmarred, as if protected by some unseen force",
          "weight": 20,
          "tags": ["ancient"]
        }
      ]
    },
    "altar_glance": {
      "id": "altar_glance",
      "name": "Altar - Glance",
      "descriptors": [
        { "id": "stone_altar", "text": "A stone altar dominates the center of the room", "weight": 25 },
        { "id": "dark_altar", "text": "A dark altar emanates an unsettling presence", "weight": 20, "tags": ["evil", "desecrated"] },
        { "id": "blessed_altar", "text": "A holy altar radiates peaceful warmth", "weight": 20, "tags": ["blessed"] },
        { "id": "ruined_altar", "text": "The remains of an altar lie scattered here", "weight": 20, "tags": ["destroyed"] },
        { "id": "ancient_altar", "text": "An ancient altar stands undisturbed", "weight": 15, "tags": ["ancient"] }
      ]
    },
    "altar_examine": {
      "id": "altar_examine",
      "name": "Altar - Examine",
      "descriptors": [
        {
          "id": "sacrificial",
          "text": "Dark stains mar the surface of this altar. Channels carved into the stone lead to a central basin. Whatever rituals were performed here, they were not pleasant",
          "weight": 20,
          "tags": ["evil", "desecrated"]
        },
        {
          "id": "holy_shrine",
          "text": "This altar is a place of worship. Candles (some still lit) surround offerings of flowers and coins. The air here feels cleaner, purer",
          "weight": 25,
          "tags": ["blessed"]
        },
        {
          "id": "forgotten_god",
          "text": "The symbols on this altar belong to no known deity. Perhaps the god it honored has been forgotten, or perhaps it was never meant to be remembered",
          "weight": 20,
          "tags": ["ancient"]
        },
        {
          "id": "active_power",
          "text": "Power thrums through this altar. The stone itself seems alive with energy, and touching it sends tingles up your arm. Something here awaits activation",
          "weight": 20,
          "tags": ["magical", "active"]
        },
        {
          "id": "simple_shrine",
          "text": "A simple altar of rough-hewn stone. Recent offerings suggest it still sees use. A peaceful atmosphere surrounds it",
          "weight": 15
        }
      ]
    }
  }
}
```

### 7.2 ambient-events.json

**File:** `config/descriptors/ambient-events.json`

```json
{
  "category": "ambient",
  "pools": {
    "sound": {
      "id": "sound",
      "name": "Sound Events (Generic)",
      "descriptors": [
        { "id": "distant_scream", "text": "A distant scream echoes through the corridors, then falls silent", "weight": 15 },
        { "id": "heavy_fall", "text": "Something heavy falls with a crash somewhere nearby", "weight": 20 },
        { "id": "whisper", "text": "You could swear you hear whispering, but there's no one there", "weight": 15 },
        { "id": "footsteps", "text": "Footsteps echo from somewhere you can't quite place", "weight": 20 },
        { "id": "grinding", "text": "A grinding sound of stone on stone reverberates through the walls", "weight": 15 },
        { "id": "metallic_clang", "text": "A metallic clang rings out in the distance", "weight": 15 }
      ]
    },
    "sound_cave": {
      "id": "sound_cave",
      "name": "Sound Events (Cave)",
      "descriptors": [
        { "id": "drip_echo", "text": "A single drop of water falls, its echo multiplying into a chorus", "weight": 25 },
        { "id": "rock_fall", "text": "Loose stones clatter down from somewhere in the darkness above", "weight": 20 },
        { "id": "bat_screech", "text": "A bat's screech pierces the silence, then fluttering wings fade into the distance", "weight": 20 },
        { "id": "rumble", "text": "A deep rumble vibrates through the stone - the mountain settling, perhaps", "weight": 20 },
        { "id": "wind_moan", "text": "Wind moans through unseen passages, carrying with it the smell of deep places", "weight": 15 }
      ]
    },
    "sound_dungeon": {
      "id": "sound_dungeon",
      "name": "Sound Events (Dungeon)",
      "descriptors": [
        { "id": "chain_rattle", "text": "Chains rattle somewhere in the darkness", "weight": 25 },
        { "id": "door_creak", "text": "A door creaks open or closed in a distant corridor", "weight": 20 },
        { "id": "dripping", "text": "Water drips with maddening regularity from the ceiling", "weight": 20 },
        { "id": "scratching", "text": "Something scratches at the other side of a nearby wall", "weight": 20 },
        { "id": "muffled_cry", "text": "A muffled cry reaches you from deep within the dungeon", "weight": 15 }
      ]
    },
    "visual": {
      "id": "visual",
      "name": "Visual Events (Generic)",
      "descriptors": [
        { "id": "shadow_move", "text": "Shadows shift at the corner of your vision, but nothing's there when you look", "weight": 25 },
        { "id": "light_flicker", "text": "The light flickers and dims for a moment before returning to normal", "weight": 25 },
        { "id": "dust_fall", "text": "Dust drifts down from above, glittering in the dim light", "weight": 20 },
        { "id": "brief_glow", "text": "A faint glow pulses briefly from somewhere you can't quite identify", "weight": 15, "tags": ["magical"] },
        { "id": "movement_glimpse", "text": "You glimpse movement in the distance, but it's gone before you can focus", "weight": 15 }
      ]
    },
    "visual_volcanic": {
      "id": "visual_volcanic",
      "name": "Visual Events (Volcanic)",
      "descriptors": [
        { "id": "lava_bubble", "text": "A bubble of lava surfaces and pops, sending sparks into the air", "weight": 25 },
        { "id": "steam_vent", "text": "A jet of steam hisses from a crack in the rock", "weight": 25 },
        { "id": "ember_float", "text": "Glowing embers drift lazily through the superheated air", "weight": 20 },
        { "id": "rock_glow", "text": "Cracks in the stone briefly glow brighter as magma surges below", "weight": 20 },
        { "id": "ash_fall", "text": "Fine volcanic ash drifts down like gray snow", "weight": 10 }
      ]
    },
    "creature": {
      "id": "creature",
      "name": "Creature Events (Generic)",
      "descriptors": [
        { "id": "rat_scatter", "text": "Rats scatter as you approach, disappearing into cracks in the walls", "weight": 25 },
        { "id": "spider_web", "text": "You brush through an invisible spider web - something small scurries away", "weight": 20 },
        { "id": "bat_flutter", "text": "A bat flutters past your head, startling you momentarily", "weight": 20 },
        { "id": "insect_buzz", "text": "An insect buzzes past your ear with an angry drone", "weight": 20 },
        { "id": "eyes_darkness", "text": "Tiny eyes reflect your light from the darkness, then blink out", "weight": 15 }
      ]
    },
    "creature_swamp": {
      "id": "creature_swamp",
      "name": "Creature Events (Swamp)",
      "descriptors": [
        { "id": "frog_leap", "text": "A large frog leaps from a log and splashes into the murky water", "weight": 25 },
        { "id": "snake_slither", "text": "A snake slithers away through the undergrowth as you approach", "weight": 20 },
        { "id": "insect_swarm", "text": "A cloud of biting insects descends upon you briefly before dispersing", "weight": 20 },
        { "id": "bird_screech", "text": "A bird screeches an alarm call before taking flight", "weight": 20 },
        { "id": "ripple_water", "text": "Something large moves beneath the water's surface, creating ripples", "weight": 15 }
      ]
    },
    "environmental": {
      "id": "environmental",
      "name": "Environmental Events (Generic)",
      "descriptors": [
        { "id": "dust_settle", "text": "Ancient dust settles around you, disturbed by your passage", "weight": 25 },
        { "id": "cold_draft", "text": "A cold draft washes over you from an unseen source", "weight": 25 },
        { "id": "stone_crack", "text": "A stone cracks underfoot, louder than expected", "weight": 20 },
        { "id": "musty_air", "text": "A pocket of stale, musty air assaults your senses", "weight": 15 },
        { "id": "floor_creak", "text": "The floor creaks ominously beneath your weight", "weight": 15 }
      ]
    },
    "environmental_frozen": {
      "id": "environmental_frozen",
      "name": "Environmental Events (Frozen)",
      "descriptors": [
        { "id": "ice_crack", "text": "Ice cracks somewhere nearby with a sound like breaking glass", "weight": 25 },
        { "id": "frost_form", "text": "Frost crystallizes before your eyes on a nearby surface", "weight": 25 },
        { "id": "breath_fog", "text": "Your breath fogs heavily in the frigid air", "weight": 20 },
        { "id": "icicle_fall", "text": "An icicle breaks free and shatters on the frozen ground", "weight": 15 },
        { "id": "wind_howl", "text": "A freezing wind howls through the passage, cutting to the bone", "weight": 15 }
      ]
    }
  }
}
```

### 7.3 Configuration Classes

**File:** `src/Core/RuneAndRust.Application/Configuration/ObjectDescriptorConfiguration.cs`

```csharp
namespace RuneAndRust.Application.Configuration;

/// <summary>
/// Configuration for interactive object descriptor pools.
/// </summary>
public class ObjectDescriptorConfiguration
{
    /// <summary>
    /// Defined object types with their valid states.
    /// </summary>
    public IReadOnlyDictionary<string, ObjectTypeDefinition> ObjectTypes { get; init; } =
        new Dictionary<string, ObjectTypeDefinition>();
}

/// <summary>
/// Defines an interactive object type and its properties.
/// </summary>
public class ObjectTypeDefinition
{
    /// <summary>
    /// Object type identifier.
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Valid states for this object type.
    /// </summary>
    public IReadOnlyList<string> ValidStates { get; init; } = [];

    /// <summary>
    /// Default state for new instances.
    /// </summary>
    public string DefaultState { get; init; } = "normal";

    /// <summary>
    /// Whether this object can be interacted with.
    /// </summary>
    public bool IsInteractable { get; init; } = true;
}
```

**File:** `src/Core/RuneAndRust.Application/Configuration/AmbientEventConfiguration.cs`

```csharp
namespace RuneAndRust.Application.Configuration;

/// <summary>
/// Configuration for ambient event pools.
/// </summary>
public class AmbientEventConfiguration
{
    /// <summary>
    /// Available event pools keyed by pool ID.
    /// </summary>
    public IReadOnlyDictionary<string, AmbientEventPool> EventPools { get; init; } =
        new Dictionary<string, AmbientEventPool>();

    /// <summary>
    /// Base probability for events to trigger (0.0 to 1.0).
    /// </summary>
    public float BaseProbability { get; init; } = 0.15f;

    /// <summary>
    /// Minimum seconds between events.
    /// </summary>
    public int CooldownSeconds { get; init; } = 30;
}

/// <summary>
/// A pool of ambient events.
/// </summary>
public class AmbientEventPool
{
    /// <summary>
    /// Pool identifier.
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Biomes where this pool is valid.
    /// </summary>
    public IReadOnlyList<string> ValidBiomes { get; init; } = [];

    /// <summary>
    /// Trigger types that can activate this pool.
    /// </summary>
    public IReadOnlyList<string> ValidTriggers { get; init; } = [];
}
```

### 7.4 Configuration Schema Summary

| Configuration | Properties | Description |
|---------------|------------|-------------|
| ObjectTypeDefinition | Id, Name, ValidStates, DefaultState, IsInteractable | Interactive object types |
| AmbientEventPool | Id, Name, ValidBiomes, ValidTriggers | Ambient event pools |
| AmbientEventConfiguration | EventPools, BaseProbability, CooldownSeconds | Event system settings |

---

## 8. Acceptance Criteria

### 8.1 Interactive Objects

- [ ] Interactive object types defined (door, chest, lever, statue, altar, etc.)
- [ ] Object states implemented (closed, open, locked, broken, etc.)
- [ ] Glance descriptions shown on room entry
- [ ] Look descriptions shown with look command
- [ ] Examine descriptions show detailed information
- [ ] Interaction hints provided where appropriate
- [ ] Object descriptors integrate with environment context

### 8.2 Ambient Events

- [ ] Ambient event types implemented (sound, visual, creature, environmental)
- [ ] Event triggers work (exploration, periodic, combat, room entry)
- [ ] Biome-specific event pools
- [ ] Event cooldown prevents spam
- [ ] Event intensity levels affect display
- [ ] Events suppressed during combat (except combat triggers)

### 8.3 Descriptor Caching

- [ ] CachedDescriptorService caches pool lookups
- [ ] Cache uses sliding expiration
- [ ] Context-sensitive requests bypass cache
- [ ] Cache improves descriptor retrieval performance

### 8.4 Integration

- [ ] All v0.0.11 systems work together
- [ ] Room descriptions include sensory + object descriptions
- [ ] Combat uses enhanced descriptors from v0.0.11b
- [ ] Environment context flows through all services

### 8.5 General

- [ ] ~14 unit tests pass
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings

---

## 9. Test Specifications

### 9.1 Unit Tests (~14 tests)

#### ObjectDescriptorServiceTests.cs

```csharp
[TestFixture]
public class ObjectDescriptorServiceTests
{
    [Test]
    public void GenerateDescriptor_ReturnsAllDepthLevels();

    [Test]
    public void GetDescription_AtGlanceDepth_ReturnsBriefText();

    [Test]
    public void GetDescription_AtExamineDepth_IncludesInteractionHint();

    [Test]
    public void GenerateDescriptor_UsesStateSpecificPool();

    [Test]
    public void GenerateDescriptor_IncludesMaterialDetails();

    [Test]
    public void GenerateDescriptor_IncludesAgeDetails();
}
```

#### AmbientEventServiceTests.cs

```csharp
[TestFixture]
public class AmbientEventServiceTests
{
    [Test]
    public void TryGenerateEvent_RespectsCooldow();

    [Test]
    public void TryGenerateEvent_SuppressesDuringCombat();

    [Test]
    public void GetEventOfType_UsesBiomeSpecificPool();

    [Test]
    public void SelectEventType_WeightsAdjustByBiome();

    [Test]
    public void ForceGenerateEvent_BypassesChanceRoll();
}
```

#### CachedDescriptorServiceTests.cs

```csharp
[TestFixture]
public class CachedDescriptorServiceTests
{
    [Test]
    public void GetDescriptorCached_ReturnsCachedValue();

    [Test]
    public void GetDescriptorCached_BypassesCacheForContext();

    [Test]
    public void GetDescriptorCached_CachesNewDescriptors();
}
```

---

## 10. Dependencies

### 10.1 Required from v0.0.11a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `EnvironmentContext` | `Domain/ValueObjects/EnvironmentContext.cs` | Context for object/event descriptors |
| `EnvironmentCoherenceService` | `Application/Services/EnvironmentCoherenceService.cs` | Environment validation |
| `BiomeDefinition` | `Application/Configuration/BiomeConfiguration.cs` | Biome-specific filtering |

### 10.2 Required from v0.0.11b

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `CombatDescriptorService` | `Application/Services/CombatDescriptorService.cs` | Integration |

### 10.3 Required from v0.0.11c

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `SensoryDescriptorService` | `Application/Services/SensoryDescriptorService.cs` | Integration |
| `SensoryContext` | `Application/Services/SensoryContext.cs` | Ambient event context |

### 10.4 Provides to Future Versions

| Type | Usage |
|------|-------|
| `ObjectDescriptorService` | Rich object descriptions |
| `AmbientEventService` | Atmospheric events |
| `CachedDescriptorService` | Performance optimization |
| Complete v0.0.11 integration | Foundation for future descriptor expansions |

---

## 11. Files Summary

### 11.1 New Files

| File | Purpose |
|------|---------|
| `src/Core/RuneAndRust.Domain/Enums/InteractiveObjectType.cs` | Object type enum |
| `src/Core/RuneAndRust.Domain/Enums/ObjectState.cs` | Object state enum |
| `src/Core/RuneAndRust.Domain/Enums/ExaminationDepth.cs` | Examination depth enum |
| `src/Core/RuneAndRust.Domain/Enums/AmbientEventType.cs` | Event type enum |
| `src/Core/RuneAndRust.Domain/Enums/AmbientEventTrigger.cs` | Event trigger enum |
| `src/Core/RuneAndRust.Domain/ValueObjects/InteractiveObjectDescriptor.cs` | Object descriptor value object |
| `src/Core/RuneAndRust.Domain/ValueObjects/AmbientEvent.cs` | Ambient event value object |
| `src/Core/RuneAndRust.Application/Services/ObjectDescriptorContext.cs` | Object context |
| `src/Core/RuneAndRust.Application/Services/AmbientEventContext.cs` | Event context |
| `src/Core/RuneAndRust.Application/Services/ObjectDescriptorService.cs` | Object descriptions |
| `src/Core/RuneAndRust.Application/Services/AmbientEventService.cs` | Ambient events |
| `src/Core/RuneAndRust.Application/Services/CachedDescriptorService.cs` | Caching decorator |
| `src/Core/RuneAndRust.Application/Configuration/ObjectDescriptorConfiguration.cs` | Object config |
| `src/Core/RuneAndRust.Application/Configuration/AmbientEventConfiguration.cs` | Event config |
| `config/descriptors/objects.json` | Object descriptor pools |
| `config/descriptors/ambient-events.json` | Ambient event pools |
| `tests/RuneAndRust.Application.UnitTests/Services/ObjectDescriptorServiceTests.cs` | Object tests |
| `tests/RuneAndRust.Application.UnitTests/Services/AmbientEventServiceTests.cs` | Event tests |
| `tests/RuneAndRust.Application.UnitTests/Services/CachedDescriptorServiceTests.cs` | Cache tests |

### 11.2 Modified Files

| File | Changes |
|------|---------|
| `src/Core/RuneAndRust.Domain/Entities/Room.cs` | Add InteractiveObjects collection |
| `src/Presentation/RuneAndRust.Presentation.Tui/Views/GameView.cs` | Integrate object descriptions, ambient events |
| `src/Core/RuneAndRust.Application/Services/GameSessionService.cs` | Trigger ambient events, use object descriptors |
| `src/Infrastructure/RuneAndRust.Infrastructure/DependencyInjection.cs` | Register new services |

---

## 12. v0.0.11 Complete Integration Summary

With v0.0.11d complete, the full descriptor system provides:

| Phase | Contribution |
|-------|--------------|
| **v0.0.11a** | Environment categories, coherence validation, biome system |
| **v0.0.11b** | Combat hit/death descriptors, ability effects, damage tiers |
| **v0.0.11c** | Sensory layers (lighting, sound, smell, temperature, weather) |
| **v0.0.11d** | Interactive objects, ambient events, caching, integration |

### Final Metrics (Post v0.0.11)

| Metric | Before v0.0.11 | After v0.0.11 |
|--------|----------------|---------------|
| Descriptor pools | ~10 | ~60+ |
| Descriptor entries | ~100 | ~500+ |
| Environment categories | 0 | 5 |
| Biome definitions | 0 | 8+ |
| Coherence rules | 0 | ~10 |
| Sensory layers | 1 | 5 |
| Interactive object types | 0 | 8 |
| Ambient event types | 0 | 4 |
| Unit tests (descriptor) | ~5 | ~65 |

---

*This design specification completes the v0.0.11 Descriptors & Ambience version by adding interactive object descriptions, ambient atmospheric events, performance caching, and full system integration. The combined system provides rich, coherent, and varied text descriptions that bring the game world to life.*
