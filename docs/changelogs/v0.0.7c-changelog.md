# v0.0.7c Changelog - Armor & Requirements

**Date:** 2026-01-08

## Added

### Domain Layer - Enums
- `ArmorType` enum: Light, Medium, Heavy
  - Full XML documentation with armor type characteristics

### Domain Layer - Value Objects
- `EquipmentRequirements` record struct for equipment restrictions
  - Properties: MinMight, MinFortitude, MinWill, MinWits, MinFinesse, RequiredClassIds
  - `HasRequirements` computed property
  - `MeetsRequirements(Player)` method
  - `GetUnmetRequirements(Player)` method returning descriptive list
  - Factory methods: `None`, `ForFortitude()`, `ForMight()`, `ForClasses()`
  - `ToString()` for formatted requirements display

### Domain Layer - Value Objects (Modified)
- `StatModifiers` enhancements:
  - Added `HasModifiers` computed property for checking non-zero values

### Domain Layer - Entities (Modified)
- `Item` entity enhancements:
  - `ArmorType?` property (nullable for non-armor items)
  - `DefenseBonus` property for defense contributions
  - `StatModifiers` property for general stat bonuses
  - `InitiativePenalty` property for combat speed reduction
  - `Requirements` property for equip restrictions
  - `IsArmor` computed property
  - `HasRequirements` computed property
  - Updated constructor with armor parameters
  - Updated `CreateLeatherArmor()` factory with armor type and defense bonus
  - New factories: `CreateChainMail()`, `CreatePlateArmor()`, `CreateRingOfStrength()`, `CreateAmuletOfVitality()`
  - Updated `CreateWoodenShield()`, `CreateIronHelmet()` with armor properties

- `Player` entity enhancements:
  - `GetEffectiveStats()` method - base stats + equipment bonuses
  - `GetEffectiveAttributes()` method - base attributes + equipment modifiers
  - `GetTotalInitiativePenalty()` method - sum of all equipment penalties
  - `GetTotalDefenseBonus()` method - sum of all defense contributions

### Domain Layer - Services (Modified)
- `EquipmentService` enhancements:
  - `CanEquip(Player, Item)` method - returns (bool, IReadOnlyList<string>)
  - Updated `TryEquip()` to check requirements before equipping
  - Returns `RequirementsNotMet` result if player doesn't meet requirements

### Domain Layer - Value Objects (Modified)
- `EquipResult` enhancements:
  - `RequirementsNotMet(Item, IReadOnlyList<string>)` factory method

### Application Layer - DTOs
- `ArmorDto` for displaying armor information
  - Properties: Name, ArmorType, DefenseBonus, InitiativePenalty, Description, StatBonuses?, Requirements?
  - Factory method: `FromItem()` - returns null for non-armor
- `EquipmentDisplayDto` for equipment summary with stats
  - Properties: Slots, BaseDefense, TotalDefense, InitiativePenalty, AttributeBonuses?
  - Factory method: `FromPlayer()` - calculates all bonuses

### Configuration
- `config/armor.json` with 18 equipment definitions:
  - Body Armor (6): Cloth Robes, Leather Armor, Studded Leather, Chain Mail, Scale Mail, Plate Armor
  - Shields (3): Wooden Shield, Iron Shield, Tower Shield
  - Helmets (3): Leather Cap, Iron Helmet, Great Helm
  - Boots (2): Leather Boots, Iron Boots
  - Accessories (4): Ring of Strength, Ring of Precision, Amulet of Vitality, Amulet of Wisdom

## Tests Added

| Test File | Count |
|-----------|-------|
| `ArmorTypeTests.cs` | 2 |
| `StatModifiersTests.cs` | 4 (new) |
| `EquipmentRequirementsTests.cs` | 9 |
| `ItemArmorTests.cs` | 10 |
| `PlayerEffectiveStatsTests.cs` | 8 |
| `EquipmentServiceRequirementsTests.cs` | 5 |
| **Total New** | 38 |

## Test Results

```
Domain Tests:      357 passed (+41)
Application Tests: 117 passed
Architecture Tests:  8 passed
Total:             482 passed
```

## Equipment System Changes

### Armor-Based Defense
- Equipped armor adds to player's base defense
- Multiple armor pieces stack (body, helmet, shield, boots)
- Heavy armor provides more defense but has initiative penalties

### Equipment Requirements
- Items can require minimum attribute values to equip
- Items can require specific class IDs to equip
- Unmet requirements prevent equipping with clear error messages
- Requirements use base attributes (not effective) to prevent circular dependencies

### Stat Modifiers
- Equipment can provide attribute bonuses (Might, Fortitude, Will, Wits, Finesse)
- Equipment can provide combat stat bonuses (MaxHealth, Attack, Defense)
- All bonuses from multiple items stack additively
- Effective stats/attributes combine base values with all equipment bonuses

### Initiative Penalties
- Heavy armor and shields may impose initiative penalties
- Penalties are summed across all equipped items
- Affects combat turn order (lower initiative = acts later)

## Defense Formula (Updated)
```
Effective Defense = Base Defense + Sum(Equipment.DefenseBonus) + Sum(Equipment.StatModifiers.Defense)
```

## Effective Attributes Formula (Updated)
```
Effective Attribute = Base Attribute + Sum(Equipment.StatModifiers.Attribute) + WeaponBonuses.Attribute
```

## v0.0.7c Complete

This completes the equipment system:
- 3 armor types with distinct characteristics
- Equipment requirements based on attributes and class
- Defense bonuses from armor pieces
- Stat modifiers from accessories
- Initiative penalties for heavy equipment
- Effective stats/attributes calculated from equipment
- Ready for v0.0.7d: Equipment System Polish
