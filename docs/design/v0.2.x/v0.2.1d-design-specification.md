# v0.2.1d Design Specification: Codex UI Enhancements

## Overview

**Version:** 0.2.1d
**Status:** Planning
**Focus:** Implement enhanced TUI and GUI interfaces for the Codex system
**Prerequisites:** v0.2.1c (Codex Hints)
**Estimated Unit Tests:** ~18

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Data Models](#5-data-models)
6. [Configuration Schemas](#6-configuration-schemas)
7. [Service Specifications](#7-service-specifications)
8. [UI Component Flow](#8-ui-component-flow)
9. [User-Facing Changes](#9-user-facing-changes)
10. [Logging Requirements](#10-logging-requirements)
11. [Unit Test Specifications](#11-unit-test-specifications)
12. [Use Cases](#12-use-cases)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

This version implements enhanced user interfaces for the Codex system, providing both a navigable text-based interface (TUI) and a visual interface (GUI). The TUI enables keyboard navigation through categories, entries, and search results with formatted text display. The GUI adds visual elements including icons, formatted text panels, and interactive navigation controls.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Value Objects** | CodexViewState, CodexNavigationContext |
| **Enums** | CodexViewMode, CodexPanelType |
| **Components** | CodexTuiRenderer, CodexGuiRenderer, CodexNavigationController |
| **DTOs** | CodexViewDto, CodexCategoryViewDto, CodexEntryViewDto |
| **Services** | CodexUIService (ICodexUIService) |
| **Configuration** | codex-ui.json, codex-ui.schema.json |
| **Tests** | ~18 new unit tests |

### Architectural Significance

This version completes the v0.2.1 Codex & Lore Discovery feature set:
- Provides the user-facing presentation layer for all Codex features
- Integrates with hints (v0.2.1c), fragments (v0.2.1b), and core entries (v0.2.1a)
- Establishes reusable UI patterns for future encyclopedia-style features
- Supports both TUI and GUI rendering through abstraction

---

## 2. Feature Overview

```
v0.2.1d Features
├── TUI Codex Interface
│   ├── Category navigation (arrow keys, enter)
│   ├── Entry list with filtering
│   ├── Entry detail view with sections
│   ├── Search interface with results
│   ├── Progress bars and completion indicators
│   └── Hint display formatting
├── GUI Codex Interface
│   ├── Visual category icons
│   ├── Entry panels with formatted text
│   ├── Interactive navigation buttons
│   ├── Search box with autocomplete hints
│   ├── Progress visualization
│   └── Fragment collection display
├── Navigation System
│   ├── CodexViewState tracking
│   ├── Navigation history (back/forward)
│   ├── Breadcrumb display
│   └── Keyboard shortcuts
├── View Modes
│   ├── Categories overview
│   ├── Category listing
│   ├── Entry detail
│   ├── Search results
│   └── Fragment collection
└── Service Layer
    ├── CodexUIService (view state management)
    ├── ICodexUIService interface
    └── Integration with CodexService, LoreFragmentService, CodexHintService
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRESENTATION LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    CodexTuiRenderer                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + RenderCategoriesView(dto) : void                              │   │
│  │ + RenderCategoryListView(dto) : void                            │   │
│  │ + RenderEntryDetailView(dto) : void                             │   │
│  │ + RenderSearchView(dto) : void                                  │   │
│  │ + RenderFragmentCollectionView(dto) : void                      │   │
│  │ + RenderProgressBar(percent, width) : string                    │   │
│  │ + RenderHintSection(hints) : void                               │   │
│  │ + RenderBreadcrumbs(context) : void                             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    CodexGuiRenderer                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + RenderCategoriesPanel(dto) : void                             │   │
│  │ + RenderEntryPanel(dto) : void                                  │   │
│  │ + RenderSearchPanel(dto) : void                                 │   │
│  │ + RenderNavigationBar(context) : void                           │   │
│  │ + RenderCategoryIcon(category) : void                           │   │
│  │ + RenderProgressVisualization(progress) : void                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                 CodexNavigationController                        │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + HandleInput(key) : CodexNavigationResult                      │   │
│  │ + NavigateToCategory(category) : void                           │   │
│  │ + NavigateToEntry(entryId) : void                               │   │
│  │ + NavigateBack() : void                                         │   │
│  │ + NavigateForward() : void                                      │   │
│  │ + OpenSearch() : void                                           │   │
│  │ + GetCurrentContext() : CodexNavigationContext                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────┐  ┌─────────────────────┐                      │
│  │   CodexHandler      │  │   InputHandler      │                      │
│  │   (updated)         │  │   (updated)         │                      │
│  │                     │  │                     │                      │
│  │ + HandleNavigation()│  │ + ParseCodexNav()   │                      │
│  │ + HandleKeyPress()  │  │                     │                      │
│  └─────────────────────┘  └─────────────────────┘                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      CodexUIService                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + GetCategoriesView(playerId) : CodexViewDto                    │   │
│  │ + GetCategoryListView(playerId, cat) : CodexCategoryViewDto     │   │
│  │ + GetEntryDetailView(playerId, entryId) : CodexEntryViewDto     │   │
│  │ + GetSearchResultsView(playerId, term) : CodexSearchViewDto     │   │
│  │ + GetFragmentCollectionView(playerId, entryId) : ...            │   │
│  │ + GetViewState(playerId) : CodexViewState                       │   │
│  │ + SetViewState(playerId, state) : void                          │   │
│  │ + PushNavigationHistory(playerId, context) : void               │   │
│  │ + PopNavigationHistory(playerId) : CodexNavigationContext?      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Integrated Services:                                                   │
│  ├── ICodexService (entry data)                                        │
│  ├── ILoreFragmentService (fragment data)                              │
│  └── ICodexHintService (hint data)                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │                       CodexViewState                            │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │ + PlayerId: Guid                                                │    │
│  │ + CurrentMode: CodexViewMode                                    │    │
│  │ + SelectedCategory: CodexCategory?                              │    │
│  │ + SelectedEntryId: string?                                      │    │
│  │ + SearchTerm: string?                                           │    │
│  │ + ScrollPosition: int                                           │    │
│  │ + SelectedIndex: int                                            │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │                   CodexNavigationContext                        │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │ + ViewMode: CodexViewMode                                       │    │
│  │ + Category: CodexCategory?                                      │    │
│  │ + EntryId: string?                                              │    │
│  │ + SearchTerm: string?                                           │    │
│  │ + Breadcrumbs: IReadOnlyList<string>                            │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ENUMS                                                                  │
│  ┌────────────────────────────────┐  ┌────────────────────────────┐   │
│  │        CodexViewMode           │  │      CodexPanelType        │   │
│  ├────────────────────────────────┤  ├────────────────────────────┤   │
│  │ Categories                     │  │ CategoryList               │   │
│  │ CategoryList                   │  │ EntryDetail                │   │
│  │ EntryDetail                    │  │ SearchResults              │   │
│  │ Search                         │  │ FragmentCollection         │   │
│  │ FragmentCollection             │  │ NavigationBar              │   │
│  └────────────────────────────────┘  └────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Configuration Files:                                                   │
│  ├── config/codex-ui.json (UI settings, icons, colors)                 │
│  └── config/schemas/codex-ui.schema.json                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 TUI Navigation Flow

```
┌───────────────────────────────────────────────────────────────┐
│                    CODEX TUI INTERFACE                         │
├───────────────────────────────────────────────────────────────┤
│                                                                 │
│                      ┌─────────────┐                           │
│                      │  Categories │                           │
│                      │    View     │                           │
│                      └──────┬──────┘                           │
│                             │                                  │
│           ┌─────────────────┼─────────────────┐               │
│           │                 │                 │               │
│           ▼                 ▼                 ▼               │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐         │
│  │  Category   │   │   Search    │   │  Fragments  │         │
│  │   Listing   │   │   Results   │   │   Overview  │         │
│  └──────┬──────┘   └──────┬──────┘   └──────┬──────┘         │
│         │                 │                 │                 │
│         ▼                 ▼                 ▼                 │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐         │
│  │   Entry     │   │   Entry     │   │  Fragment   │         │
│  │   Detail    │   │   Detail    │   │  Collection │         │
│  └─────────────┘   └─────────────┘   │   Detail    │         │
│                                      └─────────────┘         │
│                                                                 │
│  Navigation: [↑↓] Move  [Enter] Select  [Esc] Back  [/] Search │
│                                                                 │
└───────────────────────────────────────────────────────────────┘
```

### 3.3 View State Management Flow

```
┌───────────────────┐
│   User Action     │
│ (keypress, click) │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ CodexNavigation   │
│ Controller.       │
│ HandleInput(key)  │
└─────────┬─────────┘
          │
          ▼
┌───────────────────────────────────────────────────────────────┐
│                   NAVIGATION PROCESSING                        │
├───────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────┐                                         │
│  │ Determine action  │                                         │
│  │ from input        │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────────────────────────────────────────────┐│
│  │                    ACTION TYPE                             ││
│  ├────────┬────────┬────────┬────────┬────────┬─────────────┤│
│  │ Select │ Back   │ Search │ Scroll │ Expand │ Close       ││
│  │ Item   │        │        │        │ Section│             ││
│  └───┬────┴───┬────┴───┬────┴───┬────┴───┬────┴──────┬──────┘│
│      │        │        │        │        │           │        │
│      ▼        ▼        ▼        ▼        ▼           ▼        │
│ ┌─────────┐┌────────┐┌───────┐┌───────┐┌─────────┐┌────────┐ │
│ │Navigate ││Pop hist││Open   ││Update ││Toggle   ││Exit    │ │
│ │to entry ││stack   ││search ││scroll ││section  ││codex   │ │
│ │or cat   ││        ││mode   ││pos    ││expand   ││        │ │
│ └─────────┘└────────┘└───────┘└───────┘└─────────┘└────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
          │
          ▼
┌───────────────────┐
│ CodexUIService    │
│ SetViewState()    │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ Push to nav       │
│ history stack     │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ Render updated    │
│ view              │
└───────────────────┘
```

---

## 4. User Stories

### US-2.1d-1: Navigate Codex Categories
**As a** player using the codex
**I want to** navigate between categories using keyboard or mouse
**So that** I can browse my discovered knowledge efficiently

**Acceptance Criteria:**
- Arrow keys move selection in TUI
- Enter key selects highlighted category
- Categories show entry counts
- Current selection is visually highlighted
- Escape returns to previous view

### US-2.1d-2: View Entry with Formatted Sections
**As a** player reading a codex entry
**I want to** see the content with clear formatting and section headers
**So that** the information is easy to read and navigate

**Acceptance Criteria:**
- Entry title prominently displayed
- Sections have clear headers
- Content is wrapped appropriately for display width
- Progress bar shows completion percentage
- Hidden sections indicated (not shown in detail)

### US-2.1d-3: Search with Navigation
**As a** player searching the codex
**I want to** see results and navigate directly to entries
**So that** I can find information quickly

**Acceptance Criteria:**
- Search field accepts text input
- Results update as user types (or on enter)
- Results show title, category, and match preview
- Arrow keys navigate results
- Enter opens selected result

### US-2.1d-4: View Fragment Collection Progress
**As a** player collecting lore fragments
**I want to** see my collection progress visually
**So that** I understand how close I am to completion

**Acceptance Criteria:**
- Visual progress bar for collection
- Found fragments shown with content preview
- Missing fragments show placeholder and hint
- Fragment order clearly indicated (Fragment I, II, etc.)
- Completion message when all collected

### US-2.1d-5: Navigation History
**As a** player browsing the codex
**I want to** go back to previous views
**So that** I can retrace my browsing path

**Acceptance Criteria:**
- Back action returns to previous view
- Navigation history tracks view changes
- Breadcrumbs show current location
- History cleared when exiting codex
- Forward navigation after going back

### US-2.1d-6: GUI Category Icons
**As a** player using the GUI
**I want to** see visual icons for each category
**So that** categories are quickly identifiable

**Acceptance Criteria:**
- Each category has a distinct icon
- Icons displayed in category list
- Icons shown in entry headers
- Icons configurable via JSON
- Fallback text if icon unavailable

---

## 5. Data Models

### 5.1 CodexViewMode Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Modes for the Codex UI display.
/// </summary>
/// <remarks>
/// Used to determine which view to render and what
/// navigation options are available.
/// </remarks>
public enum CodexViewMode
{
    /// <summary>
    /// Overview of all categories with progress.
    /// </summary>
    Categories,

    /// <summary>
    /// List of entries within a specific category.
    /// </summary>
    CategoryList,

    /// <summary>
    /// Detailed view of a single entry.
    /// </summary>
    EntryDetail,

    /// <summary>
    /// Search interface with results.
    /// </summary>
    Search,

    /// <summary>
    /// Fragment collection view for a fragmented entry.
    /// </summary>
    FragmentCollection
}
```

### 5.2 CodexPanelType Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Types of panels in the Codex GUI.
/// </summary>
/// <remarks>
/// Used for rendering and layout in GUI mode.
/// </remarks>
public enum CodexPanelType
{
    /// <summary>
    /// Panel showing category list.
    /// </summary>
    CategoryList,

    /// <summary>
    /// Panel showing entry details.
    /// </summary>
    EntryDetail,

    /// <summary>
    /// Panel showing search results.
    /// </summary>
    SearchResults,

    /// <summary>
    /// Panel showing fragment collection.
    /// </summary>
    FragmentCollection,

    /// <summary>
    /// Navigation bar with breadcrumbs and controls.
    /// </summary>
    NavigationBar
}
```

### 5.3 CodexViewState Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Tracks the current state of a player's Codex UI.
/// </summary>
/// <remarks>
/// Used to persist view state between interactions and
/// enable proper rendering of the current view.
/// </remarks>
public readonly record struct CodexViewState
{
    /// <summary>
    /// Gets the player's ID.
    /// </summary>
    public Guid PlayerId { get; init; }

    /// <summary>
    /// Gets the current view mode.
    /// </summary>
    public CodexViewMode CurrentMode { get; init; }

    /// <summary>
    /// Gets the currently selected category, if any.
    /// </summary>
    public CodexCategory? SelectedCategory { get; init; }

    /// <summary>
    /// Gets the currently selected entry ID, if any.
    /// </summary>
    public string? SelectedEntryId { get; init; }

    /// <summary>
    /// Gets the current search term, if any.
    /// </summary>
    public string? SearchTerm { get; init; }

    /// <summary>
    /// Gets the current scroll position in the list.
    /// </summary>
    public int ScrollPosition { get; init; }

    /// <summary>
    /// Gets the currently selected index in a list.
    /// </summary>
    public int SelectedIndex { get; init; }

    /// <summary>
    /// Gets whether the codex is currently open.
    /// </summary>
    public bool IsOpen { get; init; }

    /// <summary>
    /// Creates an initial view state for a player.
    /// </summary>
    public static CodexViewState CreateInitial(Guid playerId)
    {
        return new CodexViewState
        {
            PlayerId = playerId,
            CurrentMode = CodexViewMode.Categories,
            SelectedCategory = null,
            SelectedEntryId = null,
            SearchTerm = null,
            ScrollPosition = 0,
            SelectedIndex = 0,
            IsOpen = true
        };
    }

    /// <summary>
    /// Creates a state for viewing a specific category.
    /// </summary>
    public static CodexViewState ForCategory(Guid playerId, CodexCategory category)
    {
        return new CodexViewState
        {
            PlayerId = playerId,
            CurrentMode = CodexViewMode.CategoryList,
            SelectedCategory = category,
            SelectedEntryId = null,
            SearchTerm = null,
            ScrollPosition = 0,
            SelectedIndex = 0,
            IsOpen = true
        };
    }

    /// <summary>
    /// Creates a state for viewing a specific entry.
    /// </summary>
    public static CodexViewState ForEntry(
        Guid playerId,
        CodexCategory category,
        string entryId)
    {
        return new CodexViewState
        {
            PlayerId = playerId,
            CurrentMode = CodexViewMode.EntryDetail,
            SelectedCategory = category,
            SelectedEntryId = entryId,
            SearchTerm = null,
            ScrollPosition = 0,
            SelectedIndex = 0,
            IsOpen = true
        };
    }

    /// <summary>
    /// Creates a state for search results.
    /// </summary>
    public static CodexViewState ForSearch(Guid playerId, string searchTerm)
    {
        return new CodexViewState
        {
            PlayerId = playerId,
            CurrentMode = CodexViewMode.Search,
            SelectedCategory = null,
            SelectedEntryId = null,
            SearchTerm = searchTerm,
            ScrollPosition = 0,
            SelectedIndex = 0,
            IsOpen = true
        };
    }

    /// <summary>
    /// Creates a state for viewing fragment collection.
    /// </summary>
    public static CodexViewState ForFragmentCollection(Guid playerId, string entryId)
    {
        return new CodexViewState
        {
            PlayerId = playerId,
            CurrentMode = CodexViewMode.FragmentCollection,
            SelectedCategory = CodexCategory.Legends,
            SelectedEntryId = entryId,
            SearchTerm = null,
            ScrollPosition = 0,
            SelectedIndex = 0,
            IsOpen = true
        };
    }

    /// <summary>
    /// Creates a closed state.
    /// </summary>
    public static CodexViewState Closed(Guid playerId)
    {
        return new CodexViewState
        {
            PlayerId = playerId,
            CurrentMode = CodexViewMode.Categories,
            IsOpen = false
        };
    }

    /// <summary>
    /// Returns a new state with updated scroll position.
    /// </summary>
    public CodexViewState WithScroll(int position, int selectedIndex)
    {
        return this with
        {
            ScrollPosition = position,
            SelectedIndex = selectedIndex
        };
    }
}
```

### 5.4 CodexNavigationContext Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Provides context for navigation within the Codex UI.
/// </summary>
/// <remarks>
/// Used to track navigation history and render breadcrumbs.
/// </remarks>
public readonly record struct CodexNavigationContext
{
    /// <summary>
    /// Gets the current view mode.
    /// </summary>
    public CodexViewMode ViewMode { get; init; }

    /// <summary>
    /// Gets the current category, if applicable.
    /// </summary>
    public CodexCategory? Category { get; init; }

    /// <summary>
    /// Gets the current entry ID, if applicable.
    /// </summary>
    public string? EntryId { get; init; }

    /// <summary>
    /// Gets the entry title for display, if applicable.
    /// </summary>
    public string? EntryTitle { get; init; }

    /// <summary>
    /// Gets the search term, if in search mode.
    /// </summary>
    public string? SearchTerm { get; init; }

    /// <summary>
    /// Gets the breadcrumbs for the current location.
    /// </summary>
    public IReadOnlyList<string> Breadcrumbs { get; init; }

    /// <summary>
    /// Gets a display label for this context.
    /// </summary>
    public string DisplayLabel => ViewMode switch
    {
        CodexViewMode.Categories => "Codex",
        CodexViewMode.CategoryList => Category?.ToString() ?? "Category",
        CodexViewMode.EntryDetail => EntryTitle ?? "Entry",
        CodexViewMode.Search => $"Search: {SearchTerm}",
        CodexViewMode.FragmentCollection => $"Fragments: {EntryTitle}",
        _ => "Codex"
    };

    /// <summary>
    /// Creates context for the categories view.
    /// </summary>
    public static CodexNavigationContext ForCategories()
    {
        return new CodexNavigationContext
        {
            ViewMode = CodexViewMode.Categories,
            Breadcrumbs = new[] { "Codex" }
        };
    }

    /// <summary>
    /// Creates context for a category list.
    /// </summary>
    public static CodexNavigationContext ForCategoryList(CodexCategory category)
    {
        return new CodexNavigationContext
        {
            ViewMode = CodexViewMode.CategoryList,
            Category = category,
            Breadcrumbs = new[] { "Codex", category.ToString() }
        };
    }

    /// <summary>
    /// Creates context for an entry detail view.
    /// </summary>
    public static CodexNavigationContext ForEntry(
        CodexCategory category,
        string entryId,
        string entryTitle)
    {
        return new CodexNavigationContext
        {
            ViewMode = CodexViewMode.EntryDetail,
            Category = category,
            EntryId = entryId,
            EntryTitle = entryTitle,
            Breadcrumbs = new[] { "Codex", category.ToString(), entryTitle }
        };
    }

    /// <summary>
    /// Creates context for search results.
    /// </summary>
    public static CodexNavigationContext ForSearch(string searchTerm)
    {
        return new CodexNavigationContext
        {
            ViewMode = CodexViewMode.Search,
            SearchTerm = searchTerm,
            Breadcrumbs = new[] { "Codex", $"Search: {searchTerm}" }
        };
    }

    /// <summary>
    /// Creates context for a fragment collection.
    /// </summary>
    public static CodexNavigationContext ForFragmentCollection(
        string entryId,
        string entryTitle)
    {
        return new CodexNavigationContext
        {
            ViewMode = CodexViewMode.FragmentCollection,
            Category = CodexCategory.Legends,
            EntryId = entryId,
            EntryTitle = entryTitle,
            Breadcrumbs = new[] { "Codex", "Fragments", entryTitle }
        };
    }
}
```

### 5.5 CodexViewDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for the Codex categories overview.
/// </summary>
public class CodexViewDto
{
    /// <summary>
    /// Gets the list of category summaries.
    /// </summary>
    public IReadOnlyList<CodexCategorySummaryDto> Categories { get; init; } = [];

    /// <summary>
    /// Gets the overall progress statistics.
    /// </summary>
    public CodexProgressDto Progress { get; init; } = new();

    /// <summary>
    /// Gets incomplete fragment collections.
    /// </summary>
    public IReadOnlyList<FragmentCollectionSummaryDto> IncompleteFragments { get; init; } = [];

    /// <summary>
    /// Gets the navigation context.
    /// </summary>
    public CodexNavigationContext NavigationContext { get; init; }
}

/// <summary>
/// Summary of a single codex category.
/// </summary>
public class CodexCategorySummaryDto
{
    /// <summary>
    /// Gets the category.
    /// </summary>
    public CodexCategory Category { get; init; }

    /// <summary>
    /// Gets the display name.
    /// </summary>
    public string DisplayName { get; init; } = string.Empty;

    /// <summary>
    /// Gets the category icon identifier.
    /// </summary>
    public string IconId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the number of discovered entries.
    /// </summary>
    public int DiscoveredCount { get; init; }

    /// <summary>
    /// Gets the total number of entries.
    /// </summary>
    public int TotalCount { get; init; }

    /// <summary>
    /// Gets the completion percentage.
    /// </summary>
    public int CompletionPercent => TotalCount > 0
        ? (DiscoveredCount * 100) / TotalCount
        : 0;
}

/// <summary>
/// Overall codex progress statistics.
/// </summary>
public class CodexProgressDto
{
    /// <summary>
    /// Gets the total discovered entries.
    /// </summary>
    public int TotalDiscovered { get; init; }

    /// <summary>
    /// Gets the total available entries.
    /// </summary>
    public int TotalAvailable { get; init; }

    /// <summary>
    /// Gets the number of complete entries.
    /// </summary>
    public int CompleteCount { get; init; }

    /// <summary>
    /// Gets the overall completion percentage.
    /// </summary>
    public int OverallPercent => TotalAvailable > 0
        ? (TotalDiscovered * 100) / TotalAvailable
        : 0;
}

/// <summary>
/// Summary of an incomplete fragment collection.
/// </summary>
public class FragmentCollectionSummaryDto
{
    /// <summary>
    /// Gets the entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets fragments found count.
    /// </summary>
    public int FoundCount { get; init; }

    /// <summary>
    /// Gets total fragments count.
    /// </summary>
    public int TotalCount { get; init; }

    /// <summary>
    /// Gets the completion percentage.
    /// </summary>
    public int CompletionPercent => TotalCount > 0
        ? (FoundCount * 100) / TotalCount
        : 0;
}
```

### 5.6 CodexCategoryViewDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for viewing a category's entry list.
/// </summary>
public class CodexCategoryViewDto
{
    /// <summary>
    /// Gets the category.
    /// </summary>
    public CodexCategory Category { get; init; }

    /// <summary>
    /// Gets the category display name.
    /// </summary>
    public string DisplayName { get; init; } = string.Empty;

    /// <summary>
    /// Gets the category icon identifier.
    /// </summary>
    public string IconId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the list of entries in this category.
    /// </summary>
    public IReadOnlyList<CodexEntryListItemDto> Entries { get; init; } = [];

    /// <summary>
    /// Gets the number of discovered entries.
    /// </summary>
    public int DiscoveredCount { get; init; }

    /// <summary>
    /// Gets the total entries in category.
    /// </summary>
    public int TotalCount { get; init; }

    /// <summary>
    /// Gets the navigation context.
    /// </summary>
    public CodexNavigationContext NavigationContext { get; init; }
}

/// <summary>
/// List item for an entry in category view.
/// </summary>
public class CodexEntryListItemDto
{
    /// <summary>
    /// Gets the entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets whether the entry is complete.
    /// </summary>
    public bool IsComplete { get; init; }

    /// <summary>
    /// Gets the completion percentage.
    /// </summary>
    public int CompletionPercent { get; init; }

    /// <summary>
    /// Gets whether this is a fragment-based entry.
    /// </summary>
    public bool IsFragmented { get; init; }

    /// <summary>
    /// Gets a brief preview of the entry content.
    /// </summary>
    public string Preview { get; init; } = string.Empty;
}
```

### 5.7 CodexEntryViewDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for viewing a single codex entry.
/// </summary>
public class CodexEntryViewDto
{
    /// <summary>
    /// Gets the entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets the category.
    /// </summary>
    public CodexCategory Category { get; init; }

    /// <summary>
    /// Gets the category icon identifier.
    /// </summary>
    public string CategoryIconId { get; init; } = string.Empty;

    /// <summary>
    /// Gets whether the entry is complete.
    /// </summary>
    public bool IsComplete { get; init; }

    /// <summary>
    /// Gets the completion percentage.
    /// </summary>
    public int CompletionPercent { get; init; }

    /// <summary>
    /// Gets the visible sections.
    /// </summary>
    public IReadOnlyList<CodexSectionViewDto> Sections { get; init; } = [];

    /// <summary>
    /// Gets the number of hidden sections.
    /// </summary>
    public int HiddenSectionCount { get; init; }

    /// <summary>
    /// Gets the reveal hints for hidden sections.
    /// </summary>
    public IReadOnlyList<CodexHint> RevealHints { get; init; } = [];

    /// <summary>
    /// Gets discovered related entries.
    /// </summary>
    public IReadOnlyList<RelatedEntryDto> RelatedEntries { get; init; } = [];

    /// <summary>
    /// Gets hints for undiscovered related entries.
    /// </summary>
    public IReadOnlyList<CodexHint> RelatedHints { get; init; } = [];

    /// <summary>
    /// Gets the navigation context.
    /// </summary>
    public CodexNavigationContext NavigationContext { get; init; }

    /// <summary>
    /// Gets whether this was assembled from fragments.
    /// </summary>
    public bool IsFromFragments { get; init; }

    /// <summary>
    /// Gets the entry tags.
    /// </summary>
    public IReadOnlyList<string> Tags { get; init; } = [];
}

/// <summary>
/// View DTO for a section within an entry.
/// </summary>
public class CodexSectionViewDto
{
    /// <summary>
    /// Gets the section title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets the section content.
    /// </summary>
    public string Content { get; init; } = string.Empty;

    /// <summary>
    /// Gets the section order.
    /// </summary>
    public int Order { get; init; }

    /// <summary>
    /// Gets whether this section is expanded in UI.
    /// </summary>
    public bool IsExpanded { get; init; } = true;
}
```

### 5.8 CodexSearchViewDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for search results view.
/// </summary>
public class CodexSearchViewDto
{
    /// <summary>
    /// Gets the search term used.
    /// </summary>
    public string SearchTerm { get; init; } = string.Empty;

    /// <summary>
    /// Gets the search results.
    /// </summary>
    public IReadOnlyList<CodexSearchResultDto> Results { get; init; } = [];

    /// <summary>
    /// Gets the total result count.
    /// </summary>
    public int TotalResults { get; init; }

    /// <summary>
    /// Gets the navigation context.
    /// </summary>
    public CodexNavigationContext NavigationContext { get; init; }
}

/// <summary>
/// A single search result.
/// </summary>
public class CodexSearchResultDto
{
    /// <summary>
    /// Gets the entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets the category.
    /// </summary>
    public CodexCategory Category { get; init; }

    /// <summary>
    /// Gets a preview snippet showing the match context.
    /// </summary>
    public string MatchPreview { get; init; } = string.Empty;

    /// <summary>
    /// Gets whether the entry is complete.
    /// </summary>
    public bool IsComplete { get; init; }
}
```

### 5.9 FragmentCollectionViewDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for viewing a fragment collection.
/// </summary>
public class FragmentCollectionViewDto
{
    /// <summary>
    /// Gets the fragmented entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets the category (usually Legends or History).
    /// </summary>
    public CodexCategory Category { get; init; }

    /// <summary>
    /// Gets whether the collection is complete.
    /// </summary>
    public bool IsComplete { get; init; }

    /// <summary>
    /// Gets the completion percentage.
    /// </summary>
    public int CompletionPercent { get; init; }

    /// <summary>
    /// Gets the fragments found count.
    /// </summary>
    public int FoundCount { get; init; }

    /// <summary>
    /// Gets the total fragments count.
    /// </summary>
    public int TotalCount { get; init; }

    /// <summary>
    /// Gets the individual fragment views.
    /// </summary>
    public IReadOnlyList<FragmentViewDto> Fragments { get; init; } = [];

    /// <summary>
    /// Gets the navigation context.
    /// </summary>
    public CodexNavigationContext NavigationContext { get; init; }

    /// <summary>
    /// Gets the completion summary (shown when complete).
    /// </summary>
    public string? CompletionSummary { get; init; }
}

/// <summary>
/// View DTO for a single fragment.
/// </summary>
public class FragmentViewDto
{
    /// <summary>
    /// Gets the fragment index (1-based).
    /// </summary>
    public int Index { get; init; }

    /// <summary>
    /// Gets the fragment title (if discovered).
    /// </summary>
    public string? Title { get; init; }

    /// <summary>
    /// Gets the fragment content (if discovered).
    /// </summary>
    public string? Content { get; init; }

    /// <summary>
    /// Gets whether this fragment has been discovered.
    /// </summary>
    public bool IsDiscovered { get; init; }

    /// <summary>
    /// Gets the hint for finding this fragment (if not discovered).
    /// </summary>
    public CodexHint? LocationHint { get; init; }
}
```

---

## 6. Configuration Schemas

### 6.1 codex-ui.json

```json
{
  "$schema": "../schemas/codex-ui.schema.json",
  "categoryIcons": {
    "Bestiary": {
      "id": "bestiary-icon",
      "ascii": "[B]",
      "unicode": "\ud83d\udc32",
      "color": "#FF6B6B"
    },
    "Locations": {
      "id": "locations-icon",
      "ascii": "[L]",
      "unicode": "\ud83c\udfdb\ufe0f",
      "color": "#4ECDC4"
    },
    "ItemsAndArtifacts": {
      "id": "items-icon",
      "ascii": "[I]",
      "unicode": "\u2728",
      "color": "#FFE66D"
    },
    "Characters": {
      "id": "characters-icon",
      "ascii": "[C]",
      "unicode": "\ud83d\udc64",
      "color": "#95E1D3"
    },
    "Factions": {
      "id": "factions-icon",
      "ascii": "[F]",
      "unicode": "\u2694\ufe0f",
      "color": "#F38181"
    },
    "History": {
      "id": "history-icon",
      "ascii": "[H]",
      "unicode": "\ud83d\udcdc",
      "color": "#AA96DA"
    },
    "Legends": {
      "id": "legends-icon",
      "ascii": "[*]",
      "unicode": "\u2b50",
      "color": "#FCBAD3"
    },
    "CraftingKnowledge": {
      "id": "crafting-icon",
      "ascii": "[K]",
      "unicode": "\ud83d\udd28",
      "color": "#A8D8EA"
    }
  },
  "categoryDisplayNames": {
    "Bestiary": "Bestiary",
    "Locations": "Locations",
    "ItemsAndArtifacts": "Items & Artifacts",
    "Characters": "Characters",
    "Factions": "Factions",
    "History": "History",
    "Legends": "Legends",
    "CraftingKnowledge": "Crafting Knowledge"
  },
  "tuiSettings": {
    "maxWidth": 80,
    "progressBarWidth": 20,
    "previewLength": 60,
    "borderStyle": "double",
    "showBreadcrumbs": true,
    "showKeyboardHints": true
  },
  "guiSettings": {
    "panelWidth": 600,
    "panelHeight": 400,
    "showIcons": true,
    "animateTransitions": true,
    "fontSize": 14
  },
  "keyboardShortcuts": {
    "back": ["Escape", "Backspace"],
    "search": ["/", "Ctrl+F"],
    "select": ["Enter", "Space"],
    "up": ["ArrowUp", "k"],
    "down": ["ArrowDown", "j"],
    "pageUp": ["PageUp"],
    "pageDown": ["PageDown"],
    "home": ["Home"],
    "end": ["End"],
    "close": ["q", "Escape"]
  }
}
```

### 6.2 codex-ui.schema.json

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Codex UI Configuration",
  "description": "UI settings for the Codex interface",
  "type": "object",
  "required": ["categoryIcons", "categoryDisplayNames"],
  "properties": {
    "categoryIcons": {
      "type": "object",
      "description": "Icon configuration for each category",
      "additionalProperties": {
        "$ref": "#/definitions/categoryIcon"
      }
    },
    "categoryDisplayNames": {
      "type": "object",
      "description": "Display names for each category",
      "additionalProperties": {
        "type": "string"
      }
    },
    "tuiSettings": {
      "$ref": "#/definitions/tuiSettings"
    },
    "guiSettings": {
      "$ref": "#/definitions/guiSettings"
    },
    "keyboardShortcuts": {
      "$ref": "#/definitions/keyboardShortcuts"
    }
  },
  "definitions": {
    "categoryIcon": {
      "type": "object",
      "required": ["id", "ascii"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the icon"
        },
        "ascii": {
          "type": "string",
          "maxLength": 5,
          "description": "ASCII representation for TUI"
        },
        "unicode": {
          "type": "string",
          "description": "Unicode character/emoji for GUI"
        },
        "color": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "Hex color for GUI display"
        }
      }
    },
    "tuiSettings": {
      "type": "object",
      "properties": {
        "maxWidth": {
          "type": "integer",
          "minimum": 40,
          "maximum": 200,
          "default": 80
        },
        "progressBarWidth": {
          "type": "integer",
          "minimum": 10,
          "maximum": 50,
          "default": 20
        },
        "previewLength": {
          "type": "integer",
          "minimum": 20,
          "maximum": 100,
          "default": 60
        },
        "borderStyle": {
          "type": "string",
          "enum": ["single", "double", "rounded", "none"],
          "default": "double"
        },
        "showBreadcrumbs": {
          "type": "boolean",
          "default": true
        },
        "showKeyboardHints": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "guiSettings": {
      "type": "object",
      "properties": {
        "panelWidth": {
          "type": "integer",
          "minimum": 300,
          "maximum": 1200,
          "default": 600
        },
        "panelHeight": {
          "type": "integer",
          "minimum": 200,
          "maximum": 800,
          "default": 400
        },
        "showIcons": {
          "type": "boolean",
          "default": true
        },
        "animateTransitions": {
          "type": "boolean",
          "default": true
        },
        "fontSize": {
          "type": "integer",
          "minimum": 10,
          "maximum": 24,
          "default": 14
        }
      }
    },
    "keyboardShortcuts": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": {
          "type": "string"
        }
      }
    }
  }
}
```

---

## 7. Service Specifications

### 7.1 ICodexUIService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Provides operations for the Codex UI.
/// </summary>
public interface ICodexUIService
{
    /// <summary>
    /// Gets the categories overview view.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <returns>The categories view DTO.</returns>
    CodexViewDto GetCategoriesView(Guid playerId);

    /// <summary>
    /// Gets a category list view.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="category">The category to view.</param>
    /// <returns>The category view DTO.</returns>
    CodexCategoryViewDto GetCategoryListView(Guid playerId, CodexCategory category);

    /// <summary>
    /// Gets an entry detail view.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="entryId">The entry ID.</param>
    /// <returns>The entry view DTO, or null if not found.</returns>
    CodexEntryViewDto? GetEntryDetailView(Guid playerId, string entryId);

    /// <summary>
    /// Gets search results view.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="searchTerm">The search term.</param>
    /// <returns>The search results view DTO.</returns>
    CodexSearchViewDto GetSearchResultsView(Guid playerId, string searchTerm);

    /// <summary>
    /// Gets a fragment collection view.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="entryId">The fragmented entry ID.</param>
    /// <returns>The fragment collection view DTO, or null if not found.</returns>
    FragmentCollectionViewDto? GetFragmentCollectionView(Guid playerId, string entryId);

    /// <summary>
    /// Gets the current view state for a player.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <returns>The current view state.</returns>
    CodexViewState GetViewState(Guid playerId);

    /// <summary>
    /// Sets the view state for a player.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="state">The new view state.</param>
    void SetViewState(Guid playerId, CodexViewState state);

    /// <summary>
    /// Pushes a navigation context to the history stack.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="context">The navigation context to push.</param>
    void PushNavigationHistory(Guid playerId, CodexNavigationContext context);

    /// <summary>
    /// Pops the most recent navigation context from the history stack.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <returns>The previous context, or null if at root.</returns>
    CodexNavigationContext? PopNavigationHistory(Guid playerId);

    /// <summary>
    /// Clears the navigation history for a player.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    void ClearNavigationHistory(Guid playerId);

    /// <summary>
    /// Gets the category display name.
    /// </summary>
    /// <param name="category">The category.</param>
    /// <returns>The display name.</returns>
    string GetCategoryDisplayName(CodexCategory category);

    /// <summary>
    /// Gets the category icon identifier.
    /// </summary>
    /// <param name="category">The category.</param>
    /// <returns>The icon ID.</returns>
    string GetCategoryIconId(CodexCategory category);
}
```

### 7.2 CodexUIService Implementation

```csharp
namespace RuneAndRust.Application.Services;

/// <summary>
/// Manages Codex UI view state and data retrieval.
/// </summary>
public class CodexUIService : ICodexUIService
{
    private readonly ICodexService _codexService;
    private readonly ILoreFragmentService _fragmentService;
    private readonly ICodexHintService _hintService;
    private readonly IConfigurationProvider _configProvider;
    private readonly ILogger<CodexUIService> _logger;

    private readonly Dictionary<Guid, CodexViewState> _viewStates = new();
    private readonly Dictionary<Guid, Stack<CodexNavigationContext>> _navigationHistory = new();
    private readonly Dictionary<CodexCategory, string> _categoryDisplayNames;
    private readonly Dictionary<CodexCategory, string> _categoryIconIds;

    /// <summary>
    /// Initializes a new instance of CodexUIService.
    /// </summary>
    public CodexUIService(
        ICodexService codexService,
        ILoreFragmentService fragmentService,
        ICodexHintService hintService,
        IConfigurationProvider configProvider,
        ILogger<CodexUIService> logger)
    {
        _codexService = codexService;
        _fragmentService = fragmentService;
        _hintService = hintService;
        _configProvider = configProvider;
        _logger = logger;

        var uiConfig = configProvider.LoadCodexUIConfiguration();
        _categoryDisplayNames = uiConfig.CategoryDisplayNames;
        _categoryIconIds = uiConfig.CategoryIcons
            .ToDictionary(kvp => kvp.Key, kvp => kvp.Value.Id);

        _logger.LogInformation("CodexUIService initialized");
    }

    /// <inheritdoc />
    public CodexViewDto GetCategoriesView(Guid playerId)
    {
        _logger.LogDebug("GetCategoriesView called for player: {PlayerId}", playerId);

        var categories = Enum.GetValues<CodexCategory>()
            .Select(cat =>
            {
                var (discovered, total) = _codexService.GetCategoryProgress(playerId, cat);
                return new CodexCategorySummaryDto
                {
                    Category = cat,
                    DisplayName = GetCategoryDisplayName(cat),
                    IconId = GetCategoryIconId(cat),
                    DiscoveredCount = discovered,
                    TotalCount = total
                };
            })
            .ToList();

        var progress = _codexService.GetProgress(playerId);
        var incompleteFragments = _fragmentService.GetIncompleteCollections(playerId)
            .Select(f => new FragmentCollectionSummaryDto
            {
                EntryId = f.EntryId,
                Title = f.EntryTitle,
                FoundCount = f.FoundFragments,
                TotalCount = f.TotalFragments
            })
            .ToList();

        return new CodexViewDto
        {
            Categories = categories,
            Progress = new CodexProgressDto
            {
                TotalDiscovered = progress.DiscoveredCount,
                TotalAvailable = progress.TotalEntries,
                CompleteCount = progress.CompleteCount
            },
            IncompleteFragments = incompleteFragments,
            NavigationContext = CodexNavigationContext.ForCategories()
        };
    }

    /// <inheritdoc />
    public CodexCategoryViewDto GetCategoryListView(Guid playerId, CodexCategory category)
    {
        _logger.LogDebug(
            "GetCategoryListView called for player: {PlayerId}, category: {Category}",
            playerId, category);

        var entries = _codexService.GetEntriesByCategory(playerId, category)
            .Select(entry =>
            {
                var definition = _codexService.GetCodexEntryDefinition(entry.DefinitionId);
                var preview = definition?.Sections.FirstOrDefault()?.Content ?? "";
                if (preview.Length > 60)
                {
                    preview = preview[..57] + "...";
                }

                return new CodexEntryListItemDto
                {
                    EntryId = entry.DefinitionId,
                    Title = entry.Title,
                    IsComplete = entry.IsComplete,
                    CompletionPercent = entry.GetCompletionPercent(),
                    IsFragmented = entry.IsFromFragments,
                    Preview = preview
                };
            })
            .ToList();

        var (discovered, total) = _codexService.GetCategoryProgress(playerId, category);

        return new CodexCategoryViewDto
        {
            Category = category,
            DisplayName = GetCategoryDisplayName(category),
            IconId = GetCategoryIconId(category),
            Entries = entries,
            DiscoveredCount = discovered,
            TotalCount = total,
            NavigationContext = CodexNavigationContext.ForCategoryList(category)
        };
    }

    /// <inheritdoc />
    public CodexEntryViewDto? GetEntryDetailView(Guid playerId, string entryId)
    {
        _logger.LogDebug(
            "GetEntryDetailView called for player: {PlayerId}, entry: {EntryId}",
            playerId, entryId);

        var entryWithHints = _codexService.GetEntryWithHints(playerId, entryId);
        if (entryWithHints is null)
        {
            return null;
        }

        var definition = _codexService.GetCodexEntryDefinition(entryId);

        return new CodexEntryViewDto
        {
            EntryId = entryWithHints.EntryId,
            Title = entryWithHints.Title,
            Category = entryWithHints.Category,
            CategoryIconId = GetCategoryIconId(entryWithHints.Category),
            IsComplete = entryWithHints.IsComplete,
            CompletionPercent = entryWithHints.CompletionPercent,
            Sections = entryWithHints.Sections.Select((s, i) => new CodexSectionViewDto
            {
                Title = s.Title,
                Content = s.Content,
                Order = i + 1,
                IsExpanded = true
            }).ToList(),
            HiddenSectionCount = (definition?.Sections.Count ?? 0) - entryWithHints.Sections.Count,
            RevealHints = entryWithHints.RevealHints,
            RelatedEntries = entryWithHints.DiscoveredRelated,
            RelatedHints = entryWithHints.RelatedHints,
            NavigationContext = CodexNavigationContext.ForEntry(
                entryWithHints.Category,
                entryId,
                entryWithHints.Title),
            IsFromFragments = entryWithHints.IsFromFragments,
            Tags = definition?.Tags ?? []
        };
    }

    /// <inheritdoc />
    public CodexSearchViewDto GetSearchResultsView(Guid playerId, string searchTerm)
    {
        _logger.LogDebug(
            "GetSearchResultsView called for player: {PlayerId}, term: {SearchTerm}",
            playerId, searchTerm);

        var results = _codexService.SearchEntries(playerId, searchTerm)
            .Select(entry =>
            {
                var definition = _codexService.GetCodexEntryDefinition(entry.DefinitionId);
                var matchPreview = FindMatchPreview(definition, searchTerm);

                return new CodexSearchResultDto
                {
                    EntryId = entry.DefinitionId,
                    Title = entry.Title,
                    Category = entry.Category,
                    MatchPreview = matchPreview,
                    IsComplete = entry.IsComplete
                };
            })
            .ToList();

        return new CodexSearchViewDto
        {
            SearchTerm = searchTerm,
            Results = results,
            TotalResults = results.Count,
            NavigationContext = CodexNavigationContext.ForSearch(searchTerm)
        };
    }

    /// <inheritdoc />
    public FragmentCollectionViewDto? GetFragmentCollectionView(Guid playerId, string entryId)
    {
        _logger.LogDebug(
            "GetFragmentCollectionView called for player: {PlayerId}, entry: {EntryId}",
            playerId, entryId);

        var entryDef = _fragmentService.GetFragmentedEntryDefinition(entryId);
        if (entryDef is null)
        {
            return null;
        }

        var progress = _fragmentService.GetCollectionProgress(playerId, entryId);
        if (progress is null)
        {
            return null;
        }

        var discoveredFragments = _fragmentService.GetFragmentsForEntry(playerId, entryId);
        var fragmentHints = _hintService.GetHintsForFragments(playerId, entryId);

        var fragments = new List<FragmentViewDto>();
        for (var i = 1; i <= entryDef.TotalFragments; i++)
        {
            var discovered = discoveredFragments.FirstOrDefault(f => f.FragmentIndex == i);
            var hint = fragmentHints.FirstOrDefault(h => h.Context.FragmentIndex == i);

            fragments.Add(new FragmentViewDto
            {
                Index = i,
                Title = discovered?.Title,
                Content = discovered?.Content,
                IsDiscovered = discovered is not null,
                LocationHint = discovered is null ? hint : null
            });
        }

        return new FragmentCollectionViewDto
        {
            EntryId = entryId,
            Title = entryDef.Title,
            Category = entryDef.Category,
            IsComplete = progress.Value.IsComplete,
            CompletionPercent = progress.Value.PercentComplete,
            FoundCount = progress.Value.FoundFragments,
            TotalCount = progress.Value.TotalFragments,
            Fragments = fragments,
            NavigationContext = CodexNavigationContext.ForFragmentCollection(
                entryId,
                entryDef.Title),
            CompletionSummary = progress.Value.IsComplete ? entryDef.CompletionSummary : null
        };
    }

    /// <inheritdoc />
    public CodexViewState GetViewState(Guid playerId)
    {
        if (!_viewStates.TryGetValue(playerId, out var state))
        {
            state = CodexViewState.CreateInitial(playerId);
            _viewStates[playerId] = state;
        }
        return state;
    }

    /// <inheritdoc />
    public void SetViewState(Guid playerId, CodexViewState state)
    {
        _viewStates[playerId] = state;
        _logger.LogDebug(
            "View state updated for player {PlayerId}: Mode={Mode}",
            playerId, state.CurrentMode);
    }

    /// <inheritdoc />
    public void PushNavigationHistory(Guid playerId, CodexNavigationContext context)
    {
        if (!_navigationHistory.TryGetValue(playerId, out var stack))
        {
            stack = new Stack<CodexNavigationContext>();
            _navigationHistory[playerId] = stack;
        }
        stack.Push(context);
        _logger.LogDebug(
            "Navigation history pushed for player {PlayerId}: {Label}",
            playerId, context.DisplayLabel);
    }

    /// <inheritdoc />
    public CodexNavigationContext? PopNavigationHistory(Guid playerId)
    {
        if (!_navigationHistory.TryGetValue(playerId, out var stack) || stack.Count == 0)
        {
            return null;
        }

        var context = stack.Pop();
        _logger.LogDebug(
            "Navigation history popped for player {PlayerId}: {Label}",
            playerId, context.DisplayLabel);
        return context;
    }

    /// <inheritdoc />
    public void ClearNavigationHistory(Guid playerId)
    {
        if (_navigationHistory.TryGetValue(playerId, out var stack))
        {
            stack.Clear();
        }
        _logger.LogDebug("Navigation history cleared for player {PlayerId}", playerId);
    }

    /// <inheritdoc />
    public string GetCategoryDisplayName(CodexCategory category)
    {
        return _categoryDisplayNames.TryGetValue(category, out var name)
            ? name
            : category.ToString();
    }

    /// <inheritdoc />
    public string GetCategoryIconId(CodexCategory category)
    {
        return _categoryIconIds.TryGetValue(category, out var iconId)
            ? iconId
            : "default-icon";
    }

    /// <summary>
    /// Finds a preview snippet containing the search term.
    /// </summary>
    private string FindMatchPreview(CodexEntryDefinition? definition, string searchTerm)
    {
        if (definition is null)
        {
            return string.Empty;
        }

        // Check title first
        if (definition.Title.Contains(searchTerm, StringComparison.OrdinalIgnoreCase))
        {
            return $"Title match: {definition.Title}";
        }

        // Check sections
        foreach (var section in definition.Sections)
        {
            var index = section.Content.IndexOf(
                searchTerm,
                StringComparison.OrdinalIgnoreCase);

            if (index >= 0)
            {
                var start = Math.Max(0, index - 20);
                var length = Math.Min(60, section.Content.Length - start);
                var snippet = section.Content.Substring(start, length);

                if (start > 0) snippet = "..." + snippet;
                if (start + length < section.Content.Length) snippet += "...";

                return snippet;
            }
        }

        return string.Empty;
    }
}
```

---

## 8. UI Component Flow

### 8.1 TUI Rendering Flow

```
┌───────────────────┐
│ CodexUIService    │
│ GetXxxView()      │
│ returns DTO       │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ CodexTuiRenderer  │
│ RenderXxxView()   │
└─────────┬─────────┘
          │
          ▼
┌───────────────────────────────────────────────────────────────┐
│                    RENDER COMPONENTS                           │
├───────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────┐                                         │
│  │ RenderBreadcrumbs │  "Codex > Bestiary > Goblin"           │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ RenderHeader      │  "═══ GOBLIN [Bestiary] ═══"           │
│  │ (title, category) │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ RenderProgressBar │  "▓▓▓▓▓▓▓░░░░░░░ 50%"                  │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ RenderContent     │  Section headers + content              │
│  │ (sections)        │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ RenderHintSection │  Hints for hidden content               │
│  │ (if incomplete)   │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ RenderSeeAlso     │  Related entries + hints                │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ RenderKeyboardHints│  "[↑↓] Navigate [Enter] Select..."     │
│  └───────────────────┘                                         │
│                                                                 │
└───────────────────────────────────────────────────────────────┘
```

---

## 9. User-Facing Changes

### 9.1 TUI Categories View

```
╔═══════════════════════════════════════════════════════════════╗
║                           CODEX                               ║
║                    Discovery Progress: 45%                    ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  ▓▓▓▓▓▓▓▓▓░░░░░░░░░░ 45% Complete (27/60 entries)           ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  > [B] Bestiary .................... 8/15  ▓▓▓▓▓▓▓░░░ 53%   ║
║    [L] Locations ................... 5/12  ▓▓▓▓░░░░░░ 42%   ║
║    [I] Items & Artifacts ........... 6/10  ▓▓▓▓▓▓░░░░ 60%   ║
║    [C] Characters .................. 3/8   ▓▓▓░░░░░░░ 38%   ║
║    [F] Factions .................... 2/5   ▓▓▓▓░░░░░░ 40%   ║
║    [H] History ..................... 1/4   ▓▓░░░░░░░░ 25%   ║
║    [*] Legends ..................... 1/3   ▓▓▓░░░░░░░ 33%   ║
║    [K] Crafting Knowledge .......... 1/3   ▓▓▓░░░░░░░ 33%   ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  Incomplete Fragment Collections:                             ║
║    [*] The Prophecy of Darkness .... 2/4  ▓▓▓▓▓░░░░░ 50%    ║
║    [H] The Fall of Karthum ......... 1/3  ▓▓▓░░░░░░░ 33%    ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  [↑↓] Navigate  [Enter] Select  [/] Search  [q] Close        ║
╚═══════════════════════════════════════════════════════════════╝
```

### 9.2 TUI Category List View

```
╔═══════════════════════════════════════════════════════════════╗
║  Codex > Bestiary                                             ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  [B] BESTIARY                         8/15 discovered         ║
║                                                               ║
║  ▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░ 53% Complete                          ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  > Goblin ..................... ▓▓▓▓▓▓░░░░ 67% Complete     ║
║      Small cunning creatures that infest...                   ║
║                                                               ║
║    Goblin Chief ............... ▓▓▓▓▓▓▓▓▓▓ Complete         ║
║      Leaders of goblin war parties...                         ║
║                                                               ║
║    Skeleton ................... ▓▓▓▓▓░░░░░ 50%              ║
║      Animated remains of the dead...                          ║
║                                                               ║
║    Giant Rat .................. ▓▓▓▓▓▓▓▓▓▓ Complete         ║
║      Oversized rodents found in dungeons...                   ║
║                                                               ║
║    Slime ...................... ▓▓▓░░░░░░░ 33%              ║
║      Amorphous creatures that dissolve...                     ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  [↑↓] Navigate  [Enter] View  [Esc] Back  [/] Search         ║
╚═══════════════════════════════════════════════════════════════╝
```

### 9.3 TUI Entry Detail View

```
╔═══════════════════════════════════════════════════════════════╗
║  Codex > Bestiary > Goblin                                    ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║                    [B] GOBLIN                                 ║
║                                                               ║
║  ▓▓▓▓▓▓▓▓▓▓▓▓░░░░░░░░ 67% Complete                          ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  ─── Overview ───────────────────────────────────────────────║
║                                                               ║
║  Goblins are small, cunning creatures that infest the upper  ║
║  levels of dungeons. They are cowardly when alone but        ║
║  dangerous in groups, using their numbers and crude traps    ║
║  to overwhelm unwary adventurers.                            ║
║                                                               ║
║  ─── Combat Tactics ─────────────────────────────────────────║
║                                                               ║
║  Goblins prefer ambush tactics, attacking from hiding and    ║
║  retreating when outmatched. They coordinate with crude      ║
║  signals and will attempt to flank isolated targets.         ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  HINTS (1 hidden section)                                     ║
║  ─────────────────────────────────────────────────────────── ║
║  [Combat] Engage these creatures in combat to learn their    ║
║           vulnerabilities.                                    ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  SEE ALSO                                                     ║
║  ─────────────────────────────────────────────────────────── ║
║  Discovered: Goblin Chief [Bestiary]                         ║
║  To Discover: [?] Connected places remain unexplored.        ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  Tags: monster, goblinoid, common                             ║
╠═══════════════════════════════════════════════════════════════╣
║  [↑↓] Scroll  [Esc] Back  [r] Related Entry  [/] Search      ║
╚═══════════════════════════════════════════════════════════════╝
```

### 9.4 TUI Fragment Collection View

```
╔═══════════════════════════════════════════════════════════════╗
║  Codex > Fragments > The Prophecy of Darkness                 ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║            [*] THE PROPHECY OF DARKNESS                       ║
║                     [Legends]                                 ║
║                                                               ║
║  ▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░ 50% Complete (2/4 fragments)          ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  ─── Fragment I: The First Verse ─────────────── [FOUND] ───║
║                                                               ║
║  When shadows grow long and the sun turns cold,              ║
║  When heroes fall silent and tales go untold,                ║
║  Then shall arise from the depths below,                     ║
║  A darkness eternal, the world's final woe.                  ║
║                                                               ║
║  ─── Fragment II: The Warning ───────────────── [FOUND] ────║
║                                                               ║
║  The stars shall weep tears of crimson flame,                ║
║  And those who seek power shall shoulder the blame,          ║
║  For in their ambition, they opened the gate,                ║
║  And sealed forever the world's bitter fate.                 ║
║                                                               ║
║  ─── Fragment III: ??? ───────────────── [NOT DISCOVERED] ──║
║                                                               ║
║  [NPC] Spoken by one who remembers the old ways.             ║
║                                                               ║
║  ─── Fragment IV: ??? ────────────────── [NOT DISCOVERED] ──║
║                                                               ║
║  [Item] Hidden within an artifact of the old kingdom.        ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  [↑↓] Scroll  [Esc] Back  [/] Search                         ║
╚═══════════════════════════════════════════════════════════════╝
```

### 9.5 TUI Search Results View

```
╔═══════════════════════════════════════════════════════════════╗
║  Codex > Search: "goblin"                                     ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  Search results for "goblin": 3 entries found                 ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  > [B] Goblin ............................ 67% Complete      ║
║      "...cunning creatures that infest the upper levels..."   ║
║                                                               ║
║    [B] Goblin Chief ...................... Complete          ║
║      "...Leaders of goblin war parties..."                    ║
║                                                               ║
║    [L] Goblin Warren ..................... 50%               ║
║      "...network of tunnels where goblins make their..."      ║
║                                                               ║
╠═══════════════════════════════════════════════════════════════╣
║  [↑↓] Navigate  [Enter] View  [Esc] Back  [/] New Search     ║
╚═══════════════════════════════════════════════════════════════╝
```

---

## 10. Logging Requirements

### 10.1 Debug Logs

```
[DEBUG] GetCategoriesView called for player: {PlayerId}
[DEBUG] GetCategoryListView called for player: {PlayerId}, category: {Category}
[DEBUG] GetEntryDetailView called for player: {PlayerId}, entry: {EntryId}
[DEBUG] GetSearchResultsView called for player: {PlayerId}, term: {SearchTerm}
[DEBUG] View state updated for player {PlayerId}: Mode={Mode}
[DEBUG] Navigation history pushed for player {PlayerId}: {Label}
[DEBUG] Navigation history popped for player {PlayerId}: {Label}
```

### 10.2 Info Logs

```
[INFO] CodexUIService initialized
[INFO] Codex UI opened for player: {PlayerId}
[INFO] Codex UI closed for player: {PlayerId}
```

### 10.3 Warning Logs

```
[WARN] Entry not found for view: {EntryId}
[WARN] Fragment collection not found for view: {EntryId}
[WARN] Category icon not found: {Category}
```

---

## 11. Unit Test Specifications

### 11.1 Test Files

| File | Tests | Coverage |
|------|-------|----------|
| `CodexViewStateTests.cs` | ~4 | Value object creation, factory methods |
| `CodexNavigationContextTests.cs` | ~4 | Context creation, breadcrumbs |
| `CodexUIServiceTests.cs` | ~8 | View retrieval, state management |
| `CodexTuiRendererTests.cs` | ~2 | Progress bar rendering, formatting |

### 11.2 CodexViewStateTests.cs

```csharp
[TestFixture]
public class CodexViewStateTests
{
    [Test]
    public void CreateInitial_SetsCorrectDefaults()

    [Test]
    public void ForCategory_SetsCorrectMode()

    [Test]
    public void ForEntry_SetsEntryIdAndCategory()

    [Test]
    public void WithScroll_UpdatesPositionAndIndex()
}
```

### 11.3 CodexNavigationContextTests.cs

```csharp
[TestFixture]
public class CodexNavigationContextTests
{
    [Test]
    public void ForCategories_SetsBreadcrumbsToCodex()

    [Test]
    public void ForCategoryList_IncludesCategoryInBreadcrumbs()

    [Test]
    public void ForEntry_IncludesFullPath()

    [Test]
    public void DisplayLabel_ReturnsCorrectLabel()
}
```

### 11.4 CodexUIServiceTests.cs

```csharp
[TestFixture]
public class CodexUIServiceTests
{
    [Test]
    public void GetCategoriesView_ReturnsAllCategories()

    [Test]
    public void GetCategoryListView_ReturnsEntriesInCategory()

    [Test]
    public void GetEntryDetailView_ReturnsEntryWithHints()

    [Test]
    public void GetEntryDetailView_NotDiscovered_ReturnsNull()

    [Test]
    public void GetSearchResultsView_ReturnsMatchingEntries()

    [Test]
    public void GetViewState_CreatesInitialIfNotExists()

    [Test]
    public void PushNavigationHistory_AddsToStack()

    [Test]
    public void PopNavigationHistory_ReturnsLastPushed()
}
```

### 11.5 CodexTuiRendererTests.cs

```csharp
[TestFixture]
public class CodexTuiRendererTests
{
    [Test]
    public void RenderProgressBar_GeneratesCorrectLength()

    [Test]
    public void RenderProgressBar_HandlesZeroPercent()
}
```

---

## 12. Use Cases

### UC-2.1d-1: Browse Codex Categories

**Preconditions:**
- Player has discovered some codex entries
- Player opens codex with `codex` command

**Flow:**
1. CodexUIService.GetCategoriesView called
2. Categories with progress retrieved
3. TUI renderer displays categories with progress bars
4. Player uses arrow keys to navigate
5. Player presses Enter to select category

**Postconditions:**
- View state updated to selected category
- Category list view displayed

### UC-2.1d-2: Navigate Back Through History

**Preconditions:**
- Player is viewing an entry detail
- Navigation history contains previous views

**Flow:**
1. Player presses Escape
2. CodexNavigationController.NavigateBack called
3. CodexUIService.PopNavigationHistory returns previous context
4. View state updated to previous view
5. Previous view rendered

**Postconditions:**
- Player sees previous view
- Navigation history updated

### UC-2.1d-3: Search and Navigate to Result

**Preconditions:**
- Player has discovered entries containing search term
- Player opens search with `/` key

**Flow:**
1. Search input mode activated
2. Player types search term
3. CodexUIService.GetSearchResultsView called
4. Results displayed with match previews
5. Player navigates to and selects result
6. Entry detail view displayed

**Postconditions:**
- Search term recorded in navigation history
- Entry detail displayed

---

## 13. Acceptance Criteria

### AC-2.1d-1: Categories View
- [ ] All 8 categories displayed
- [ ] Each category shows discovered/total count
- [ ] Progress bars display correctly
- [ ] Incomplete fragment collections shown
- [ ] Keyboard navigation works

### AC-2.1d-2: Category List View
- [ ] Entries listed with completion status
- [ ] Preview text shown for each entry
- [ ] Selection highlighting works
- [ ] Scroll works for long lists
- [ ] Back navigation returns to categories

### AC-2.1d-3: Entry Detail View
- [ ] Title and category displayed
- [ ] Progress bar shows completion
- [ ] Visible sections rendered with headers
- [ ] Hints displayed for hidden sections
- [ ] Related entries and hints shown
- [ ] Tags displayed

### AC-2.1d-4: Fragment Collection View
- [ ] Collection title and progress shown
- [ ] Found fragments display content
- [ ] Missing fragments show hints
- [ ] Fragment order indicated (I, II, etc.)
- [ ] Completion summary shown when complete

### AC-2.1d-5: Search Interface
- [ ] Search input accepts text
- [ ] Results show title, category, preview
- [ ] Match context displayed in preview
- [ ] Results navigable with arrow keys
- [ ] Enter opens selected result

### AC-2.1d-6: Navigation System
- [ ] Navigation history tracks views
- [ ] Back navigation works correctly
- [ ] Breadcrumbs display current path
- [ ] History cleared on close
- [ ] State persists during session

### AC-2.1d-7: Configuration
- [ ] Category icons configurable
- [ ] Display names configurable
- [ ] TUI settings respected
- [ ] Keyboard shortcuts configurable

### AC-2.1d-8: Unit Tests
- [ ] ~18 unit tests implemented
- [ ] All tests pass
- [ ] Value object, service, and renderer tests included

---

## 14. Deliverable Checklist

### Domain Layer
- [ ] ValueObjects/CodexViewState.cs
- [ ] ValueObjects/CodexNavigationContext.cs
- [ ] Enums/CodexViewMode.cs
- [ ] Enums/CodexPanelType.cs

### Application Layer
- [ ] Interfaces/ICodexUIService.cs
- [ ] Services/CodexUIService.cs
- [ ] DTOs/CodexViewDto.cs
- [ ] DTOs/CodexCategoryViewDto.cs
- [ ] DTOs/CodexEntryViewDto.cs
- [ ] DTOs/CodexSearchViewDto.cs
- [ ] DTOs/FragmentCollectionViewDto.cs

### Infrastructure Layer
- [ ] config/codex-ui.json
- [ ] config/schemas/codex-ui.schema.json
- [ ] Update IConfigurationProvider (add LoadCodexUIConfiguration)

### Presentation Layer
- [ ] Renderers/CodexTuiRenderer.cs
- [ ] Renderers/CodexGuiRenderer.cs
- [ ] Controllers/CodexNavigationController.cs
- [ ] Update CodexHandler (integrate navigation)
- [ ] Update InputHandler (codex navigation keys)

### Tests
- [ ] Tests/Domain/ValueObjects/CodexViewStateTests.cs
- [ ] Tests/Domain/ValueObjects/CodexNavigationContextTests.cs
- [ ] Tests/Application/Services/CodexUIServiceTests.cs
- [ ] Tests/Presentation/Renderers/CodexTuiRendererTests.cs

### Documentation
- [ ] XML documentation on all public members

---

## 15. Dependencies

### From v0.2.1a (Codex Foundation)
| Component | Purpose for v0.2.1d |
|-----------|---------------------|
| `CodexEntry` | Entry data for display |
| `CodexCategory` | Category organization |
| `CodexProgress` | Progress statistics |
| `ICodexService` | Entry retrieval, search |

### From v0.2.1b (Lore Fragments)
| Component | Purpose for v0.2.1d |
|-----------|---------------------|
| `LoreFragment` | Fragment display data |
| `FragmentCollectionProgress` | Collection progress |
| `ILoreFragmentService` | Fragment retrieval |

### From v0.2.1c (Codex Hints)
| Component | Purpose for v0.2.1d |
|-----------|---------------------|
| `CodexHint` | Hint display |
| `CodexEntryWithHintsDto` | Entry with hints |
| `ICodexHintService` | Hint retrieval |

---

## 16. Future Considerations

### v0.2.2: Codex Enhancements
- Bookmarks/favorites system
- Reading history tracking
- Export/share functionality
- Codex achievements

### GUI Improvements
- Animated transitions
- Image support for entries
- Custom fonts and themes
- Resizable panels

### Accessibility
- Screen reader support
- High contrast mode
- Font size scaling
- Keyboard-only navigation

---

*This design specification completes the v0.2.1 Codex & Lore Discovery feature set, providing the user-facing presentation layer that ties together entry discovery, fragment collection, and hint guidance into a cohesive, navigable interface.*
