# v0.4.0c Changelog: Activation & Destruction

**Release Date:** 2026-01-12  
**Parent:** v0.4.0 Interactive Objects Foundation  
**Prerequisites:** v0.4.0b (Containers & Locks)

---

## Summary

v0.4.0c introduces activation mechanisms (levers, buttons) that trigger linked effects on other objects, and adds destructible object support allowing players to break barriers, crates, and other objects through combat.

---

## New Features

### EffectType Enum
New enum defining the types of effects that can be triggered:
- `OpenTarget` - Opens the target object
- `CloseTarget` - Closes the target object  
- `UnlockTarget` - Unlocks the target object
- `LockTarget` - Locks the target object
- `ToggleTarget` - Toggles between states
- `ActivateTarget` - Activates the target
- `DeactivateTarget` - Deactivates the target
- `DestroyTarget` - Destroys the target
- `RevealTarget` - Reveals a hidden object
- `Message` - Displays a message only

### ObjectEffect Value Object
Defines linked effects between objects with:
- Factory methods for all effect types
- State triggers (`TriggerOnState`)
- Delayed effects support (`DelayTurns`)
- Custom effect messages

### DestructibleProperties Value Object
Properties for objects that can be destroyed:
- HP system (`MaxHP`, `CurrentHP`)
- Defense reduction
- Damage type modifiers:
  - Vulnerabilities (2x damage)
  - Resistances (0.5x damage)
  - Immunities (0 damage)
- Condition descriptions (pristine â†’ destroyed)
- Factory methods: `Weak()`, `Sturdy()`, `Armored()`

### EffectTriggerResult & ObjectDamageResult
Result objects for effect resolution and damage outcomes with comprehensive factory methods.

### InteractiveObject Enhancements

**New Properties:**
- `Effects` - List of linked effects
- `HasEffects` - Whether object has effects
- `Destructible` - Destructible properties
- `IsDestructible` / `IsDestroyed`
- `IsButton` / `ResetDelay` / `TurnsUntilReset`
- `HasPendingReset`

**New Methods:**
- `AddEffect()` / `SetEffects()` - Configure effects
- `SetDestructible()` - Configure destruction
- `SetAsButton()` - Configure button behavior
- `GetTriggeredEffects()` - Get effects for state
- `Activate()` / `Deactivate()` / `Toggle()`
- `ProcessTurnTick()` - Handle button reset
- `TakeDamage()` / `Destroy()`

### InteractionService Enhancements

**New Methods:**
- `Activate(obj, room)` - Activate with effect resolution
- `Deactivate(obj, room)` - Deactivate with effect resolution
- `AttackObject(obj, damage, damageType, room)` - Deal damage
- `ProcessRoomTurnTick(room)` - Handle button resets
- `GetPendingEffects(obj, state)` - Get triggered effects
- `ResolveEffect(effect, room)` - Apply effect to target

---

## Modified Files

### Domain Layer
- `src/Core/RuneAndRust.Domain/Enums/EffectType.cs` [NEW]
- `src/Core/RuneAndRust.Domain/ValueObjects/ObjectEffect.cs` [NEW]
- `src/Core/RuneAndRust.Domain/ValueObjects/DestructibleProperties.cs` [NEW]
- `src/Core/RuneAndRust.Domain/ValueObjects/EffectTriggerResult.cs` [NEW]
- `src/Core/RuneAndRust.Domain/ValueObjects/ObjectDamageResult.cs` [NEW]
- `src/Core/RuneAndRust.Domain/Entities/InteractiveObject.cs` [MODIFIED]
- `src/Core/RuneAndRust.Domain/Definitions/InteractiveObjectDefinition.cs` [MODIFIED]

### Application Layer
- `src/Core/RuneAndRust.Application/Interfaces/IInteractionService.cs` [MODIFIED]
- `src/Core/RuneAndRust.Application/Services/InteractionService.cs` [MODIFIED]

### Tests
- `tests/RuneAndRust.Domain.UnitTests/ValueObjects/ObjectEffectTests.cs` [NEW]
- `tests/RuneAndRust.Domain.UnitTests/ValueObjects/DestructiblePropertiesTests.cs` [NEW]
- `tests/RuneAndRust.Domain.UnitTests/Entities/InteractiveObjectActivationTests.cs` [NEW]
- `tests/RuneAndRust.Domain.UnitTests/Entities/InteractiveObjectDestructionTests.cs` [NEW]

---

## Test Results

```
Passed! - Failed: 0, Passed: 1001, Skipped: 0 - RuneAndRust.Domain.UnitTests.dll
Passed! - Failed: 0, Passed:  454, Skipped: 0 - RuneAndRust.Application.UnitTests.dll
Passed! - Failed: 0, Passed:    8, Skipped: 0 - RuneAndRust.Architecture.Tests.dll

Total: 1463 tests passed
New tests added: 87
```

---

## Usage Examples

### Lever Unlocking a Door
```csharp
var lever = InteractiveObject.Create("rusty-lever", "Rusty Lever", "An old lever",
    InteractiveObjectType.Lever, ObjectState.Inactive);

// Add effect: when activated, unlock the iron gate
lever.AddEffect(ObjectEffect.UnlockTarget("iron-gate", ObjectState.Active,
    "You hear a loud clunk as the iron gate unlocks."));

// Activate lever in room context
var result = interactionService.Activate(lever, room);
// Result includes: "You pull the Rusty Lever..." + effect messages
```

### Button with Auto-Reset
```csharp
var button = InteractiveObject.Create("stone-button", "Stone Button", "A pressure plate",
    InteractiveObjectType.Button, ObjectState.Inactive);

button.SetAsButton(resetDelay: 3); // Reset after 3 turns
button.AddEffect(ObjectEffect.OpenTarget("secret-door", ObjectState.Active));

button.Activate(); // Door opens, timer starts
button.TurnsUntilReset; // 3

button.ProcessTurnTick(); // 2 turns remaining
button.ProcessTurnTick(); // 1 turn remaining
button.ProcessTurnTick(); // 0 - pending
button.ProcessTurnTick(); // Button resets to Inactive
```

### Destructible Crate
```csharp
var crate = InteractiveObject.Create("wooden-crate", "Wooden Crate", "A fragile crate",
    InteractiveObjectType.Crate, ObjectState.Closed);

crate.SetDestructible(DestructibleProperties.Create(
    maxHP: 10,
    defense: 0,
    vulnerabilities: new[] { "fire", "slashing" },
    resistances: new[] { "piercing" },
    immunities: new[] { "poison" }));

var result = interactionService.AttackObject(crate, damage: 5, "fire", room);
// Result: "The Wooden Crate is vulnerable to fire! (10 damage)"
// (5 * 2 for vulnerability)
```

---

## Breaking Changes

None. All changes are additive and backward compatible.

---

## Future Work

- v0.4.0d: Delayed effects queue processing
- Configuration: JSON examples for levers/buttons/destructibles
- Integration: Connect destruction to combat system damage
