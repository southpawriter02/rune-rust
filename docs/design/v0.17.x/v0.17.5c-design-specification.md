# v0.17.5c Design Specification: Name Validation

**Version:** 0.17.5c
**Theme:** Name Validation
**Author:** Claude
**Created:** 2026-01-28
**Status:** Draft
**Prerequisites:** v0.17.5a Complete (Creation Step Enum & State), v0.17.5b Complete (Creation ViewModel)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [NameValidator Service](#4-namevalidator-service)
5. [NameValidationResult Value Object](#5-namevalidationresult-value-object)
6. [Validation Rules](#6-validation-rules)
7. [Configuration](#7-configuration)
8. [User-Facing Changes](#8-user-facing-changes)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Future Considerations](#14-future-considerations)
15. [Implementation Notes](#15-implementation-notes)
16. [Document Metadata](#16-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.17.5c, the Name Validation phase. This phase implements robust character name validation used in Step 6 (Summary) of the character creation wizard.

Key components:

1. **INameValidator Interface**: Contract for name validation service with configurable rules.

2. **NameValidator Service**: Validates character names against length, character pattern, boundary, and profanity rules.

3. **NameValidationResult Value Object**: Immutable result containing validation status, error message, and optional suggested name.

4. **Configuration Extension**: Extends `creation-workflow.json` with `nameValidation` section for configurable validation parameters.

This infrastructure ensures character names meet quality standards before persistence.

### 1.2 Current vs. Target Implementation

| Aspect                  | Current Implementation | Target Implementation                           |
| ----------------------- | ---------------------- | ----------------------------------------------- |
| **Name Validation**     | Not implemented        | `NameValidator` service with configurable rules |
| **Validation Result**   | Not implemented        | `NameValidationResult` value object             |
| **Error Messages**      | Not implemented        | Context-specific, user-friendly messages        |
| **Profanity Filtering** | Not implemented        | Configurable block list                         |

### 1.3 Scope

**In Scope:**

- Define `INameValidator` interface
- Implement `NameValidator` service
- Define `NameValidationResult` value object
- Define `NameValidationConfig` for loading from JSON
- Add profanity filter configuration
- Unit tests (~5 tests)

**Out of Scope:**

- Real-time validation feedback (TUI) - v0.17.5f
- Controller integration - v0.17.5d
- Database uniqueness checks - v0.17.5g
- Localized error messages - Future version

### 1.4 Key Deliverables

| Type          | Count | Details                                        |
| ------------- | ----- | ---------------------------------------------- |
| Interfaces    | 1     | `INameValidator`                               |
| Services      | 1     | `NameValidator`                                |
| Value Objects | 2     | `NameValidationResult`, `NameValidationConfig` |
| Unit Tests    | ~5    | Length, pattern, boundary, profanity tests     |

---

## 2. Dependencies

### 2.1 Required from v0.17.5a (Creation Step Enum & State)

| Component                | Location                                    | Usage in v0.17.5c                |
| ------------------------ | ------------------------------------------- | -------------------------------- |
| `creation-workflow.json` | `config/creation-workflow.json`             | Source of validation parameters  |
| `CharacterCreationState` | `Domain/Entities/CharacterCreationState.cs` | State's `CharacterName` property |

### 2.2 Required from Infrastructure

| Component | Usage                                   |
| --------- | --------------------------------------- |
| Regex     | Pattern matching for allowed characters |
| JSON      | Configuration loading                   |
| Logging   | Validation event logging                |

### 2.3 Provides to Future Versions

| Version  | Component              | Usage                             |
| -------- | ---------------------- | --------------------------------- |
| v0.17.5d | `INameValidator`       | Controller calls during Step 6    |
| v0.17.5d | `NameValidationResult` | Controller processes result       |
| v0.17.5f | `NameValidationResult` | TUI displays validation feedback  |
| v0.17.5e | `INameValidator`       | Factory validates before creation |

---

## 3. Architecture Diagrams

### 3.1 Name Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         NAME VALIDATION FLOW                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  User Input: "Björn the Swift"                                              │
│         │                                                                    │
│         ▼                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      NameValidator.Validate()                        │   │
│  │                                                                      │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │ Rule 1: Length Check (2-20 characters)                         │ │   │
│  │  │   "Björn the Swift".Length = 15 ✓ PASS                        │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                              │                                       │   │
│  │                              ▼                                       │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │ Rule 2: Character Pattern (a-z, A-Z, space, hyphen)            │ │   │
│  │  │   "Björn the Swift" contains 'ö' ✗ FAIL                       │ │   │
│  │  │   Error: "Name can only contain letters, spaces, and hyphens" │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                              │                                       │   │
│  │                              ▼                                       │   │
│  │  ┌────────────────────────────────────────────────────────────────┐ │   │
│  │  │ Return: NameValidationResult                                   │ │   │
│  │  │   IsValid: false                                               │ │   │
│  │  │   ErrorMessage: "Name can only contain letters..."            │ │   │
│  │  │   SuggestedName: "Bjorn the Swift"                            │ │   │
│  │  └────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Validation Rule Decision Tree

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     VALIDATION RULE DECISION TREE                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  INPUT: Character Name                                                       │
│         │                                                                    │
│         ▼                                                                    │
│  ┌─────────────────────────────┐                                            │
│  │ Is name null or whitespace? │                                            │
│  └─────────────────────────────┘                                            │
│         │                                                                    │
│    YES ─┴─ NO                                                               │
│         │   │                                                                │
│         │   ▼                                                                │
│         │ ┌───────────────────────────┐                                     │
│         │ │ Is length < 2 characters? │                                     │
│         │ └───────────────────────────┘                                     │
│         │         │                                                          │
│         │    YES ─┴─ NO                                                     │
│         │         │   │                                                      │
│         │ ────────┘   ▼                                                     │
│         │           ┌───────────────────────────┐                           │
│         │           │ Is length > 20 characters?│                           │
│         │           └───────────────────────────┘                           │
│         │                   │                                                │
│         │              YES ─┴─ NO                                           │
│         │                   │   │                                            │
│         │ ──────────────────┘   ▼                                           │
│         │                     ┌───────────────────────────────────┐         │
│         │                     │ Does name start with a letter?    │         │
│         │                     └───────────────────────────────────┘         │
│         │                             │                                      │
│         │                        YES ─┴─ NO                                 │
│         │                             │   │                                  │
│         │ ────────────────────────────┘   ▼                                 │
│         │                               ERROR: "Name must start and end     │
│         │                                       with a letter"              │
│         │                             │                                      │
│         │                             ▼                                      │
│         │                     ┌───────────────────────────────────┐         │
│         │                     │ Does name end with a letter?      │         │
│         │                     └───────────────────────────────────┘         │
│         │                             │                                      │
│         │                        YES ─┴─ NO ────▶ ERROR (same)              │
│         │                             │                                      │
│         │                             ▼                                      │
│         │                     ┌───────────────────────────────────┐         │
│         │                     │ Contains only allowed characters?│          │
│         │                     │ (a-z, A-Z, space, hyphen)        │          │
│         │                     └───────────────────────────────────┘         │
│         │                             │                                      │
│         │                        YES ─┴─ NO                                 │
│         │                             │   │                                  │
│         │ ────────────────────────────┘   ▼                                 │
│         │                               ERROR: "Name can only contain       │
│         │                                      letters, spaces, hyphens"   │
│         │                             │                                      │
│         ▼                             ▼                                      │
│  ┌───────────────┐            ┌───────────────────────────────────┐         │
│  │ ERROR:        │            │ Is name in profanity filter?      │         │
│  │ "Name is      │            └───────────────────────────────────┘         │
│  │  required"    │                    │                                      │
│  └───────────────┘               YES ─┴─ NO                                 │
│                                       │   │                                  │
│                                       ▼   ▼                                  │
│                              ERROR:  ┌──────────────┐                       │
│                              "Please │   SUCCESS    │                       │
│                              choose  │   IsValid:   │                       │
│                              a       │   true       │                       │
│                              different└──────────────┘                      │
│                              name"                                           │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          LAYER ARCHITECTURE                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │                     APPLICATION LAYER                               │     │
│  │                                                                     │     │
│  │  ┌───────────────────────────────────────────────────────────────┐ │     │
│  │  │                    INameValidator                              │ │     │
│  │  │                                                                │ │     │
│  │  │  NameValidationResult Validate(string? name)                  │ │     │
│  │  │  string Sanitize(string name)                                 │ │     │
│  │  │  bool IsValid(string? name)                                   │ │     │
│  │  │                                                                │ │     │
│  │  └───────────────────────────────────────────────────────────────┘ │     │
│  │                              │                                      │     │
│  │                              ▼                                      │     │
│  │  ┌───────────────────────────────────────────────────────────────┐ │     │
│  │  │                     NameValidator                              │ │     │
│  │  │                                                                │ │     │
│  │  │  Dependencies:                                                 │ │     │
│  │  │  • NameValidationConfig (from JSON)                           │ │     │
│  │  │  • ILogger<NameValidator>                                     │ │     │
│  │  │                                                                │ │     │
│  │  │  Validation Rules:                                            │ │     │
│  │  │  • Length (2-20 characters)                                   │ │     │
│  │  │  • Pattern (ASCII letters, spaces, hyphens)                   │ │     │
│  │  │  • Boundary (starts/ends with letter)                         │ │     │
│  │  │  • Profanity (filtered words)                                 │ │     │
│  │  │                                                                │ │     │
│  │  └───────────────────────────────────────────────────────────────┘ │     │
│  │                                                                     │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │                       DOMAIN LAYER                                  │     │
│  │                                                                     │     │
│  │  ┌──────────────────────────┐  ┌──────────────────────────┐       │     │
│  │  │ NameValidationResult     │  │ NameValidationConfig     │       │     │
│  │  │ (Value Object)           │  │ (Value Object)           │       │     │
│  │  │                          │  │                          │       │     │
│  │  │ • IsValid                │  │ • MinLength              │       │     │
│  │  │ • ErrorMessage           │  │ • MaxLength              │       │     │
│  │  │ • SuggestedName          │  │ • AllowedPattern         │       │     │
│  │  │                          │  │ • ProfanityFilter        │       │     │
│  │  └──────────────────────────┘  └──────────────────────────┘       │     │
│  │                                                                     │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐     │
│  │                     INFRASTRUCTURE LAYER                            │     │
│  │                                                                     │     │
│  │  ┌────────────────────────────────────────────────────────────┐   │     │
│  │  │              creation-workflow.json (Extension)             │   │     │
│  │  │                                                             │   │     │
│  │  │  "nameValidation": {                                       │   │     │
│  │  │    "minLength": 2,                                         │   │     │
│  │  │    "maxLength": 20,                                        │   │     │
│  │  │    "allowedPattern": "^[a-zA-Z][a-zA-Z\\s\\-]*[a-zA-Z]$",  │   │     │
│  │  │    "profanityFilter": ["word1", "word2"]                   │   │     │
│  │  │  }                                                          │   │     │
│  │  │                                                             │   │     │
│  │  └────────────────────────────────────────────────────────────┘   │     │
│  │                                                                     │     │
│  └────────────────────────────────────────────────────────────────────┘     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. NameValidator Service

### 4.1 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/INameValidator.cs`

```csharp
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Validates character names against configurable rules including length,
/// allowed characters, boundaries, and profanity filtering.
/// </summary>
public interface INameValidator
{
    /// <summary>
    /// Validates the provided character name against all configured rules.
    /// </summary>
    /// <param name="name">The character name to validate. May be null or empty.</param>
    /// <returns>
    /// A <see cref="NameValidationResult"/> containing the validation status,
    /// error message (if invalid), and optional suggested correction.
    /// </returns>
    NameValidationResult Validate(string? name);

    /// <summary>
    /// Checks if the provided name is valid without returning detailed errors.
    /// Useful for quick validation in UI scenarios.
    /// </summary>
    /// <param name="name">The character name to check.</param>
    /// <returns>True if valid; false otherwise.</returns>
    bool IsValid(string? name);

    /// <summary>
    /// Attempts to sanitize an invalid name by replacing or removing
    /// invalid characters while preserving the intended name.
    /// </summary>
    /// <param name="name">The name to sanitize.</param>
    /// <returns>A sanitized version of the name that passes validation, or null if sanitization is not possible.</returns>
    string? Sanitize(string name);
}
```

### 4.2 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/NameValidator.cs`

```csharp
using System.Text;
using System.Text.RegularExpressions;
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Validates character names against configurable rules.
/// Rules are loaded from the creation-workflow.json configuration.
/// </summary>
public partial class NameValidator : INameValidator
{
    private readonly NameValidationConfig _config;
    private readonly ILogger<NameValidator> _logger;
    private readonly Regex _allowedPatternRegex;
    private readonly HashSet<string> _profanitySet;

    // ═══════════════════════════════════════════════════════════════════════
    // Error Messages
    // ═══════════════════════════════════════════════════════════════════════

    private const string ErrorNameRequired = "Name is required.";
    private const string ErrorNameTooShort = "Name must be at least {0} characters.";
    private const string ErrorNameTooLong = "Name must be at most {0} characters.";
    private const string ErrorInvalidCharacters = "Name can only contain letters, spaces, and hyphens.";
    private const string ErrorMustStartEndWithLetter = "Name must start and end with a letter.";
    private const string ErrorProfanity = "Please choose a different name.";

    /// <summary>
    /// Initializes a new instance of the <see cref="NameValidator"/> class.
    /// </summary>
    /// <param name="config">The name validation configuration.</param>
    /// <param name="logger">Logger for validation events.</param>
    public NameValidator(
        NameValidationConfig config,
        ILogger<NameValidator> logger)
    {
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));

        // Compile regex for performance
        _allowedPatternRegex = new Regex(
            _config.AllowedPattern,
            RegexOptions.Compiled,
            TimeSpan.FromMilliseconds(100));

        // Build case-insensitive profanity set
        _profanitySet = new HashSet<string>(
            _config.ProfanityFilter ?? [],
            StringComparer.OrdinalIgnoreCase);

        _logger.LogDebug(
            "NameValidator initialized. MinLength={Min}, MaxLength={Max}, ProfanityCount={Count}",
            _config.MinLength, _config.MaxLength, _profanitySet.Count);
    }

    /// <inheritdoc />
    public NameValidationResult Validate(string? name)
    {
        _logger.LogDebug("Validating name: '{Name}'", name ?? "(null)");

        // Rule 1: Required check
        if (string.IsNullOrWhiteSpace(name))
        {
            _logger.LogDebug("Validation failed: Name is required");
            return NameValidationResult.Invalid(ErrorNameRequired);
        }

        var trimmedName = name.Trim();

        // Rule 2: Minimum length check
        if (trimmedName.Length < _config.MinLength)
        {
            var message = string.Format(ErrorNameTooShort, _config.MinLength);
            _logger.LogDebug("Validation failed: Name too short ({Length} < {Min})",
                trimmedName.Length, _config.MinLength);
            return NameValidationResult.Invalid(message);
        }

        // Rule 3: Maximum length check
        if (trimmedName.Length > _config.MaxLength)
        {
            var message = string.Format(ErrorNameTooLong, _config.MaxLength);
            var suggested = trimmedName[.._config.MaxLength].TrimEnd();
            _logger.LogDebug("Validation failed: Name too long ({Length} > {Max})",
                trimmedName.Length, _config.MaxLength);
            return NameValidationResult.Invalid(message, suggested);
        }

        // Rule 4: Boundary check (starts/ends with letter)
        if (!char.IsLetter(trimmedName[0]) || !char.IsLetter(trimmedName[^1]))
        {
            _logger.LogDebug("Validation failed: Name must start and end with letter");
            var suggested = Sanitize(trimmedName);
            return NameValidationResult.Invalid(ErrorMustStartEndWithLetter, suggested);
        }

        // Rule 5: Allowed characters check
        if (!IsOnlyAllowedCharacters(trimmedName))
        {
            _logger.LogDebug("Validation failed: Invalid characters in name");
            var suggested = Sanitize(trimmedName);
            return NameValidationResult.Invalid(ErrorInvalidCharacters, suggested);
        }

        // Rule 6: Profanity check (case-insensitive, includes word parts)
        if (ContainsProfanity(trimmedName))
        {
            _logger.LogDebug("Validation failed: Name contains filtered word");
            return NameValidationResult.Invalid(ErrorProfanity);
        }

        _logger.LogInformation("Name validation passed: '{Name}'", trimmedName);
        return NameValidationResult.Valid();
    }

    /// <inheritdoc />
    public bool IsValid(string? name) => Validate(name).IsValid;

    /// <inheritdoc />
    public string? Sanitize(string name)
    {
        if (string.IsNullOrWhiteSpace(name))
            return null;

        var sanitized = new StringBuilder();
        var previousWasSpace = false;

        foreach (var c in name)
        {
            // Convert to ASCII equivalent if possible
            var normalized = NormalizeCharacter(c);

            if (char.IsLetter(normalized))
            {
                sanitized.Append(normalized);
                previousWasSpace = false;
            }
            else if ((normalized == ' ' || normalized == '-') && !previousWasSpace && sanitized.Length > 0)
            {
                sanitized.Append(normalized);
                previousWasSpace = normalized == ' ';
            }
        }

        // Trim non-letter characters from end
        var result = sanitized.ToString().TrimEnd(' ', '-');

        // Ensure minimum length
        if (result.Length < _config.MinLength)
            return null;

        // Truncate to max length
        if (result.Length > _config.MaxLength)
            result = result[.._config.MaxLength].TrimEnd(' ', '-');

        // Final validation of start/end
        if (result.Length < _config.MinLength ||
            !char.IsLetter(result[0]) ||
            !char.IsLetter(result[^1]))
            return null;

        return result;
    }

    // ═══════════════════════════════════════════════════════════════════════
    // Private Methods
    // ═══════════════════════════════════════════════════════════════════════

    /// <summary>
    /// Checks if the name contains only allowed characters (letters, space, hyphen).
    /// </summary>
    private bool IsOnlyAllowedCharacters(string name)
    {
        foreach (var c in name)
        {
            if (!char.IsLetter(c) && c != ' ' && c != '-')
                return false;

            // Only allow ASCII letters (a-z, A-Z)
            if (char.IsLetter(c) && c > 127)
                return false;
        }
        return true;
    }

    /// <summary>
    /// Checks if the name contains any words from the profanity filter.
    /// Performs case-insensitive matching on whole words and substrings.
    /// </summary>
    private bool ContainsProfanity(string name)
    {
        var lowerName = name.ToLowerInvariant();

        // Check each profanity term
        foreach (var term in _profanitySet)
        {
            if (lowerName.Contains(term, StringComparison.OrdinalIgnoreCase))
                return true;
        }

        // Also check individual words
        var words = lowerName.Split([' ', '-'], StringSplitOptions.RemoveEmptyEntries);
        return words.Any(word => _profanitySet.Contains(word));
    }

    /// <summary>
    /// Attempts to normalize non-ASCII characters to ASCII equivalents.
    /// </summary>
    private static char NormalizeCharacter(char c) => c switch
    {
        'á' or 'à' or 'â' or 'ä' or 'ã' or 'å' => 'a',
        'Á' or 'À' or 'Â' or 'Ä' or 'Ã' or 'Å' => 'A',
        'é' or 'è' or 'ê' or 'ë' => 'e',
        'É' or 'È' or 'Ê' or 'Ë' => 'E',
        'í' or 'ì' or 'î' or 'ï' => 'i',
        'Í' or 'Ì' or 'Î' or 'Ï' => 'I',
        'ó' or 'ò' or 'ô' or 'ö' or 'õ' or 'ø' => 'o',
        'Ó' or 'Ò' or 'Ô' or 'Ö' or 'Õ' or 'Ø' => 'O',
        'ú' or 'ù' or 'û' or 'ü' => 'u',
        'Ú' or 'Ù' or 'Û' or 'Ü' => 'U',
        'ý' or 'ÿ' => 'y',
        'Ý' or 'Ÿ' => 'Y',
        'ñ' => 'n',
        'Ñ' => 'N',
        'ç' => 'c',
        'Ç' => 'C',
        'ß' => 's',
        'æ' => 'a',
        'Æ' => 'A',
        'œ' => 'o',
        'Œ' => 'O',
        'ð' => 'd',
        'Ð' => 'D',
        'þ' => 't',
        'Þ' => 'T',
        _ => c
    };
}
```

---

## 5. NameValidationResult Value Object

### 5.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/NameValidationResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the result of a character name validation operation.
/// Contains validation status, error message, and optional suggested correction.
/// </summary>
public readonly record struct NameValidationResult
{
    /// <summary>
    /// Gets a value indicating whether the name passed all validation rules.
    /// </summary>
    public bool IsValid { get; init; }

    /// <summary>
    /// Gets the error message describing why validation failed.
    /// Null when <see cref="IsValid"/> is true.
    /// </summary>
    public string? ErrorMessage { get; init; }

    /// <summary>
    /// Gets a suggested valid name based on sanitizing the invalid input.
    /// Null when no suggestion is available or name is valid.
    /// </summary>
    /// <remarks>
    /// Suggestions are provided when the name can be corrected automatically,
    /// such as truncating an over-length name or replacing invalid characters.
    /// </remarks>
    public string? SuggestedName { get; init; }

    // ═══════════════════════════════════════════════════════════════════════
    // Factory Methods
    // ═══════════════════════════════════════════════════════════════════════

    /// <summary>
    /// Creates a successful validation result.
    /// </summary>
    /// <returns>A result indicating the name is valid.</returns>
    public static NameValidationResult Valid() => new()
    {
        IsValid = true,
        ErrorMessage = null,
        SuggestedName = null
    };

    /// <summary>
    /// Creates a failed validation result with an error message.
    /// </summary>
    /// <param name="errorMessage">The user-friendly error message.</param>
    /// <param name="suggestedName">Optional suggested correction.</param>
    /// <returns>A result indicating the name is invalid.</returns>
    public static NameValidationResult Invalid(string errorMessage, string? suggestedName = null) => new()
    {
        IsValid = false,
        ErrorMessage = errorMessage,
        SuggestedName = suggestedName
    };

    /// <summary>
    /// Returns a string representation for debugging.
    /// </summary>
    public override string ToString() =>
        IsValid
            ? "Valid"
            : $"Invalid: {ErrorMessage}" + (SuggestedName != null ? $" (Suggested: {SuggestedName})" : "");
}
```

### 5.2 NameValidationConfig Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/NameValidationConfig.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Configuration for character name validation rules.
/// Loaded from the creation-workflow.json configuration file.
/// </summary>
public readonly record struct NameValidationConfig
{
    /// <summary>
    /// Gets the minimum allowed name length.
    /// Default: 2 characters.
    /// </summary>
    public int MinLength { get; init; }

    /// <summary>
    /// Gets the maximum allowed name length.
    /// Default: 20 characters.
    /// </summary>
    public int MaxLength { get; init; }

    /// <summary>
    /// Gets the regex pattern for allowed characters.
    /// Default: ASCII letters, spaces, and hyphens; must start and end with letter.
    /// </summary>
    public string AllowedPattern { get; init; }

    /// <summary>
    /// Gets the list of words to filter from names.
    /// Matching is case-insensitive.
    /// </summary>
    public IReadOnlyList<string> ProfanityFilter { get; init; }

    /// <summary>
    /// Creates the default configuration.
    /// </summary>
    public static NameValidationConfig Default => new()
    {
        MinLength = 2,
        MaxLength = 20,
        AllowedPattern = @"^[a-zA-Z][a-zA-Z\s\-]*[a-zA-Z]$|^[a-zA-Z]{2}$",
        ProfanityFilter = Array.Empty<string>()
    };
}
```

---

## 6. Validation Rules

### 6.1 Rule Summary Table

| Rule # | Rule Name           | Requirement                  | Error Message                                         | Priority |
| ------ | ------------------- | ---------------------------- | ----------------------------------------------------- | -------- |
| 1      | Required            | Name not null/whitespace     | "Name is required."                                   | 1        |
| 2      | Minimum Length      | Length >= 2                  | "Name must be at least 2 characters."                 | 2        |
| 3      | Maximum Length      | Length <= 20                 | "Name must be at most 20 characters."                 | 3        |
| 4      | Boundary Characters | Starts and ends with letter  | "Name must start and end with a letter."              | 4        |
| 5      | Allowed Characters  | Only a-z, A-Z, space, hyphen | "Name can only contain letters, spaces, and hyphens." | 5        |
| 6      | Profanity Filter    | Not in blocked list          | "Please choose a different name."                     | 6        |

### 6.2 Valid Name Examples

| Name                 | Length | Valid | Notes                       |
| -------------------- | ------ | ----- | --------------------------- |
| `"Björk"`            | 5      | ❌    | Contains non-ASCII 'ö'      |
| `"Bjorn"`            | 5      | ✅    | All ASCII letters           |
| `"Björn the Swift"`  | 15     | ❌    | Contains non-ASCII 'ö'      |
| `"Bjorn the Swift"`  | 15     | ✅    | ASCII letters, space        |
| `"Al"`               | 2      | ✅    | Minimum valid length        |
| `"A"`                | 1      | ❌    | Too short                   |
| `"Dark-Blade"`       | 10     | ✅    | Letters and hyphen          |
| `"-Blade"`           | 6      | ❌    | Starts with hyphen          |
| `"Blade-"`           | 6      | ❌    | Ends with hyphen            |
| `"Test Name Here!!"` | 17     | ❌    | Contains special characters |
| `"Jo"`               | 2      | ✅    | Minimum valid (2 letters)   |

### 6.3 Sanitization Examples

| Input             | Sanitized Output  | Notes                  |
| ----------------- | ----------------- | ---------------------- |
| `"Björn"`         | `"Bjorn"`         | 'ö' → 'o'              |
| `"Test!!Name"`    | `"TestName"`      | Removed '!'            |
| `"  Spaced  "`    | `"Spaced"`        | Trimmed spaces         |
| `"-BadStart"`     | `"BadStart"`      | Removed leading hyphen |
| `"123Numbers"`    | `null`            | Cannot preserve intent |
| `"Tøō Løng Ñàmé"` | `"Too Long Name"` | Normalized diacritics  |

---

## 7. Configuration

### 7.1 Configuration Extension

The name validation configuration is part of `creation-workflow.json` (defined in v0.17.5a):

**File:** `config/creation-workflow.json` (Extension)

```json
{
    "$schema": "./schemas/creation-workflow.schema.json",
    "workflow": { ... },
    "nameValidation": {
        "minLength": 2,
        "maxLength": 20,
        "allowedPattern": "^[a-zA-Z][a-zA-Z\\s\\-]*[a-zA-Z]$|^[a-zA-Z]{2}$",
        "profanityFilter": [
            "admin",
            "moderator",
            "system"
        ]
    },
    "initialization": { ... }
}
```

### 7.2 Schema Definition

The schema is part of `creation-workflow.schema.json` (v0.17.5a). The relevant section:

```json
{
    "definitions": {
        "NameValidation": {
            "type": "object",
            "required": ["minLength", "maxLength", "allowedPattern"],
            "properties": {
                "minLength": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 10,
                    "description": "Minimum character name length"
                },
                "maxLength": {
                    "type": "integer",
                    "minimum": 10,
                    "maximum": 50,
                    "description": "Maximum character name length"
                },
                "allowedPattern": {
                    "type": "string",
                    "description": "Regex pattern for allowed characters"
                },
                "profanityFilter": {
                    "type": "array",
                    "items": { "type": "string" },
                    "description": "Words to block from character names"
                }
            }
        }
    }
}
```

---

## 8. User-Facing Changes

### 8.1 Summary Step Validation Display

When a user enters an invalid name in Step 6, they will see:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         CONFIRM YOUR SURVIVOR                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Enter your character's name:                                               │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Björn the Swift_                                                    │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ⚠ Name can only contain letters, spaces, and hyphens.                     │
│    Suggested: "Bjorn the Swift"                                             │
│                                                                              │
│  [Tab] Use Suggestion    [Enter] Confirm    [Esc] Go Back                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component     | Level       | Events                                  |
| ------------- | ----------- | --------------------------------------- |
| NameValidator | Debug       | Validation start, each rule check       |
| NameValidator | Debug       | Validation failure details              |
| NameValidator | Information | Successful validation                   |
| NameValidator | Warning     | Profanity filter match (no name logged) |
| NameValidator | Error       | Configuration loading failure           |

### 9.2 Log Message Examples

```csharp
// Initialization
_logger.LogDebug(
    "NameValidator initialized. MinLength={Min}, MaxLength={Max}, ProfanityCount={Count}",
    _config.MinLength, _config.MaxLength, _profanitySet.Count);

// Validation start
_logger.LogDebug("Validating name: '{Name}'", name ?? "(null)");

// Validation failure
_logger.LogDebug("Validation failed: Name too short ({Length} < {Min})",
    trimmedName.Length, _config.MinLength);

// Profanity match (do NOT log the actual name)
_logger.LogDebug("Validation failed: Name contains filtered word");

// Validation success
_logger.LogInformation("Name validation passed: '{Name}'", trimmedName);
```

---

## 10. Unit Testing Requirements

### 10.1 Test Coverage Summary

| Test Category           | Test Count | Priority |
| ----------------------- | ---------- | -------- |
| Valid Name Tests        | 3          | Critical |
| Length Boundary Tests   | 3          | Critical |
| Character Pattern Tests | 3          | High     |
| Profanity Filter Tests  | 2          | High     |
| Sanitization Tests      | 3          | Medium   |
| Edge Case Tests         | 2          | Medium   |
| **Total**               | **~16**    |          |

### 10.2 NameValidator Tests

**File:** `tests/RuneAndRust.Application.UnitTests/Services/NameValidatorTests.cs`

```csharp
using FluentAssertions;
using Microsoft.Extensions.Logging;
using Moq;
using NUnit.Framework;
using RuneAndRust.Application.Services;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.UnitTests.Services;

[TestFixture]
public class NameValidatorTests
{
    private Mock<ILogger<NameValidator>> _loggerMock = null!;
    private NameValidationConfig _defaultConfig = null!;

    [SetUp]
    public void SetUp()
    {
        _loggerMock = new Mock<ILogger<NameValidator>>();
        _defaultConfig = NameValidationConfig.Default;
    }

    private NameValidator CreateValidator(NameValidationConfig? config = null) =>
        new(config ?? _defaultConfig, _loggerMock.Object);

    // ═══════════════════════════════════════════════════════════════════════
    // Valid Name Tests
    // ═══════════════════════════════════════════════════════════════════════

    [TestCase("Bjorn")]
    [TestCase("Dark-Blade")]
    [TestCase("Bjorn the Swift")]
    [TestCase("Al")]
    [TestCase("Jo")]
    public void Validate_WithValidName_ReturnsValid(string name)
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate(name);

        // Assert
        result.IsValid.Should().BeTrue();
        result.ErrorMessage.Should().BeNull();
    }

    [Test]
    public void Validate_WithMaxLengthName_ReturnsValid()
    {
        // Arrange
        var validator = CreateValidator();
        var name = new string('a', 20); // Exactly 20 characters

        // Act
        var result = validator.Validate(name);

        // Assert
        result.IsValid.Should().BeTrue();
    }

    // ═══════════════════════════════════════════════════════════════════════
    // Length Boundary Tests
    // ═══════════════════════════════════════════════════════════════════════

    [Test]
    public void Validate_WithNullName_ReturnsInvalid()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate(null);

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("required");
    }

    [Test]
    public void Validate_WithEmptyName_ReturnsInvalid()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate("");

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("required");
    }

    [Test]
    public void Validate_WithSingleCharacter_ReturnsInvalid()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate("A");

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("at least 2");
    }

    [Test]
    public void Validate_WithExcessiveLength_ReturnsInvalidWithSuggestion()
    {
        // Arrange
        var validator = CreateValidator();
        var name = new string('a', 25); // Over 20 characters

        // Act
        var result = validator.Validate(name);

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("at most 20");
        result.SuggestedName.Should().NotBeNull();
        result.SuggestedName!.Length.Should().Be(20);
    }

    // ═══════════════════════════════════════════════════════════════════════
    // Character Pattern Tests
    // ═══════════════════════════════════════════════════════════════════════

    [TestCase("Test123")]
    [TestCase("Test@Name")]
    [TestCase("Test!Name")]
    [TestCase("Test_Name")]
    public void Validate_WithSpecialCharacters_ReturnsInvalid(string name)
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate(name);

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("letters, spaces, and hyphens");
    }

    [Test]
    public void Validate_WithNonAsciiLetters_ReturnsInvalidWithSuggestion()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate("Björn");

        // Assert
        result.IsValid.Should().BeFalse();
        result.SuggestedName.Should().Be("Bjorn");
    }

    [Test]
    public void Validate_WithLeadingHyphen_ReturnsInvalid()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate("-Blade");

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("start and end with a letter");
    }

    [Test]
    public void Validate_WithTrailingHyphen_ReturnsInvalid()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Validate("Blade-");

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("start and end with a letter");
    }

    // ═══════════════════════════════════════════════════════════════════════
    // Profanity Filter Tests
    // ═══════════════════════════════════════════════════════════════════════

    [Test]
    public void Validate_WithProfanity_ReturnsInvalid()
    {
        // Arrange
        var config = _defaultConfig with
        {
            ProfanityFilter = new[] { "badword" }
        };
        var validator = CreateValidator(config);

        // Act
        var result = validator.Validate("badword");

        // Assert
        result.IsValid.Should().BeFalse();
        result.ErrorMessage.Should().Contain("different name");
        result.SuggestedName.Should().BeNull(); // No suggestion for profanity
    }

    [Test]
    public void Validate_WithProfanitySubstring_ReturnsInvalid()
    {
        // Arrange
        var config = _defaultConfig with
        {
            ProfanityFilter = new[] { "bad" }
        };
        var validator = CreateValidator(config);

        // Act
        var result = validator.Validate("MyBadName");

        // Assert
        result.IsValid.Should().BeFalse();
    }

    // ═══════════════════════════════════════════════════════════════════════
    // Sanitization Tests
    // ═══════════════════════════════════════════════════════════════════════

    [Test]
    public void Sanitize_WithDiacritics_ReturnsNormalized()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Sanitize("Björn");

        // Assert
        result.Should().Be("Bjorn");
    }

    [Test]
    public void Sanitize_WithSpecialCharacters_RemovesThem()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Sanitize("Test!!Name");

        // Assert
        result.Should().Be("TestName");
    }

    [Test]
    public void Sanitize_WithOnlyInvalidCharacters_ReturnsNull()
    {
        // Arrange
        var validator = CreateValidator();

        // Act
        var result = validator.Sanitize("12345");

        // Assert
        result.Should().BeNull();
    }

    // ═══════════════════════════════════════════════════════════════════════
    // IsValid Tests
    // ═══════════════════════════════════════════════════════════════════════

    [Test]
    public void IsValid_WithValidName_ReturnsTrue()
    {
        // Arrange
        var validator = CreateValidator();

        // Act & Assert
        validator.IsValid("ValidName").Should().BeTrue();
    }

    [Test]
    public void IsValid_WithInvalidName_ReturnsFalse()
    {
        // Arrange
        var validator = CreateValidator();

        // Act & Assert
        validator.IsValid("").Should().BeFalse();
    }
}
```

---

## 11. Use Cases

### 11.1 UC-001: Validate Character Name

**Actor:** Player (via Controller)
**Preconditions:** Player is on Step 6 (Summary)
**Flow:**

1. Player enters name in text field
2. Controller calls `INameValidator.Validate(name)`
3. Validator runs all rules in sequence
4. Validator returns `NameValidationResult`
5. If invalid, TUI displays error message
6. If valid, "Confirm" button is enabled

**Postconditions:** Player sees validation feedback

### 11.2 UC-002: Apply Name Suggestion

**Actor:** Player
**Preconditions:** Validation returned with suggestion
**Flow:**

1. Player sees invalid name with suggestion
2. Player presses Tab to apply suggestion
3. Controller sets name to suggested value
4. Controller re-validates (should pass)
5. TUI updates name field

**Postconditions:** Name field contains valid suggestion

### 11.3 UC-003: Real-Time Validation

**Actor:** Player
**Preconditions:** Player is typing in name field
**Flow:**

1. Player types character
2. TUI calls `INameValidator.IsValid(currentText)`
3. If invalid, TUI shows visual indicator (red border)
4. If valid, TUI shows valid indicator (green check)

**Postconditions:** Visual feedback updates with each keystroke

---

## 12. Deliverable Checklist

### 12.1 Interfaces

- [ ] `src/Core/RuneAndRust.Application/Interfaces/INameValidator.cs`

### 12.2 Services

- [ ] `src/Core/RuneAndRust.Application/Services/NameValidator.cs`

### 12.3 Value Objects

- [ ] `src/Core/RuneAndRust.Domain/ValueObjects/NameValidationResult.cs`
- [ ] `src/Core/RuneAndRust.Domain/ValueObjects/NameValidationConfig.cs`

### 12.4 Testing

- [ ] `tests/RuneAndRust.Application.UnitTests/Services/NameValidatorTests.cs`
- [ ] ~16 unit tests implemented
- [ ] All tests passing

### 12.5 Documentation

- [ ] `docs/design/v0.17.x/v0.17.5c-changelog.md`
- [ ] Update `docs/design/v0.17.x/v0.17.5-scope-breakdown.md` (mark items complete)

---

## 13. Acceptance Criteria

### 13.1 Functional

- [ ] Names with 2-20 characters pass length validation
- [ ] Names with 1 character fail with "at least 2 characters" error
- [ ] Names over 20 characters fail with "at most 20 characters" error
- [ ] Names with only ASCII letters (a-z, A-Z) pass
- [ ] Names with spaces pass (e.g., "Bjorn the Swift")
- [ ] Names with hyphens pass (e.g., "Dark-Blade")
- [ ] Names starting with hyphen/space fail
- [ ] Names ending with hyphen/space fail
- [ ] Names with numbers fail
- [ ] Names with special characters (!, @, #, etc.) fail
- [ ] Names with non-ASCII letters fail with suggestion
- [ ] Profanity filter blocks configured words (case-insensitive)
- [ ] Sanitize() converts diacritics to ASCII equivalents
- [ ] Sanitize() removes invalid characters
- [ ] Sanitize() returns null when name cannot be salvaged

### 13.2 Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~16 unit tests pass
- [ ] XML documentation complete on all public members
- [ ] Configuration loads from `creation-workflow.json`
- [ ] Profanity matches are NOT logged with the actual name

---

## 14. Future Considerations

### 14.1 Deferred to v0.17.5f

- **Real-Time Visual Feedback**: Border color changes during typing
- **Suggestion Auto-Apply**: Tab key applies suggestion

### 14.2 Deferred to v0.17.5g

- **Database Uniqueness**: Check if name already exists (per-account)

### 14.3 Out of Scope

- **Unicode Support**: Full Unicode letter support (e.g., Cyrillic, CJK)
- **Localized Error Messages**: Currently English-only
- **Machine Learning Profanity Detection**: Beyond simple list matching

---

## 15. Implementation Notes

### 15.1 Regex Pattern Explanation

The pattern `^[a-zA-Z][a-zA-Z\s\-]*[a-zA-Z]$|^[a-zA-Z]{2}$`:

- `^[a-zA-Z]` - Must start with a letter
- `[a-zA-Z\s\-]*` - Zero or more letters, spaces, or hyphens in the middle
- `[a-zA-Z]$` - Must end with a letter
- `|^[a-zA-Z]{2}$` - OR exactly 2 letters (handles edge case of 2-char names)

### 15.2 Profanity Filter Strategy

The profanity filter uses:

1. **Substring matching**: Blocks "MyBadName" if "Bad" is in the filter
2. **Word matching**: Splits on spaces/hyphens and checks each word
3. **Case-insensitive**: "BADWORD" matches "badword"

This prevents simple evasion while avoiding false positives.

### 15.3 Character Normalization

The sanitizer converts accented characters to their ASCII equivalents:

- `ö` → `o`, `é` → `e`, `ñ` → `n`, etc.
- This allows players using non-ASCII keyboards to get suggestions

---

## 16. Document Metadata

| Property         | Value                                                              |
| ---------------- | ------------------------------------------------------------------ |
| **Document ID**  | v0.17.5c-design-specification                                      |
| **Version**      | 1.0                                                                |
| **Status**       | Draft                                                              |
| **Created**      | 2026-01-28                                                         |
| **Last Updated** | 2026-01-28                                                         |
| **Author**       | Claude                                                             |
| **Reviewer**     | [Pending]                                                          |
| **Related Docs** | v0.17.5a-design-specification.md, v0.17.5b-design-specification.md |
