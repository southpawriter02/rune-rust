# v0.16.5a Changelog — Unique Item Definition

**Version:** 0.16.5a  
**Date:** 2026-01-29  
**Phase:** Unique Items & Myth-Forged System

---

## Summary

Implements the foundational data structures for Myth-Forged (unique) items - legendary equipment with fixed stats, special effects, and rich lore. This establishes the core entity, value objects, and configuration schema for the unique item system.

---

## Added

### Domain Layer - Enum

- **`DropSourceType`** enum — Defines source categories for unique item drops:
    - `Monster` (0) — Standard enemy drops
    - `Container` (1) — Chest and container loot
    - `Boss` (2) — Boss-specific high-rate drops
    - `Vendor` (3) — Purchasable items
    - `Quest` (4) — Quest reward items
    - Full XML documentation with remarks for each value

---

### Domain Layer - Value Objects

- **`ItemStats`** value object — Immutable stat bonus representation:
    - 8 stat properties (Might, Agility, Will, Fortitude, Arcana, BonusHealth, BonusDamage, BonusDefense)
    - `Create()` factory method with named defaults
    - `Empty` static property for no-bonus items
    - `IsEmpty` and `NonZeroStatCount` computed properties
    - `ToString()` for debugging
    - Supports negative stats for cursed items

- **`DropSource`** value object — Immutable drop source specification:
    - `SourceType` (DropSourceType enum)
    - `SourceId` (normalized to lowercase)
    - `DropChance` (0-100 decimal with validation)
    - `Create()` factory with argument validation
    - `IsGuaranteed` property for 100% drops

---

### Domain Layer - Entity

- **`UniqueItem`** entity — Core Myth-Forged item representation:
    - Identity: `Id` (Guid), `ItemId` (normalized string)
    - Display: `Name`, `Description`, `FlavorText`
    - Category: Uses `EquipmentCategory` enum (Weapon, Armor, Accessory, Tool)
    - Quality: `QualityTier` (always MythForged/Legendary)
    - Stats: `ItemStats` value object
    - Drop info: `IReadOnlyList<DropSource>`
    - Class restrictions: `ClassAffinities` with `HasAffinityFor()` method
    - Level requirement: `RequiredLevel` (minimum 1)
    - Future hooks: `SpecialEffectIds`, `SetId`
    - Methods: `GetDropSourcesByType()`, `CanDropFrom()`
    - Helper properties: `DropSourceCount`, `HasSpecialEffects`, `IsPartOfSet`

---

### Configuration

- **`config/unique-items.json`** — 3 example unique items:
    - Shadowfang Blade (weapon, warrior/rogue affinity)
    - Phoenixheart Amulet (accessory, no class restriction)
    - Dread Knight's Plate (armor, set piece)

- **`config/schemas/unique-items.schema.json`** — JSON Schema with:
    - `uniqueItem` definition with all properties
    - `itemStats` definition for stat bonuses
    - `dropSource` definition with type, ID, and chance
    - kebab-case ID pattern validation
    - Category enum matching EquipmentCategory

---

### Unit Tests

- **`DropSourceTypeTests`** — 2 tests:
    - `DropSourceType_ContainsAllExpectedValues`
    - `DropSourceType_HasExplicitIntValues`

- **`ItemStatsTests`** — 7 tests:
    - `Create_WithDefaults_ReturnsEmptyStats`
    - `Create_WithAllStats_SetsAllValues`
    - `Create_WithNegativeStats_AllowsCursedItems`
    - `Empty_ReturnsAllZeroStats`
    - `ToString_FormatsCorrectly`
    - `Equality_WithSameValues_AreEqual`
    - `NonZeroStatCount_ReturnsCorrectCount`

- **`DropSourceTests`** — 9 tests:
    - `Create_WithValidData_CreatesDropSource`
    - `Create_NormalizesSourceId`
    - `Create_WithNullSourceId_ThrowsArgumentException`
    - `Create_WithEmptySourceId_ThrowsArgumentException`
    - `Create_WithNegativeDropChance_ThrowsArgumentOutOfRangeException`
    - `Create_WithDropChanceOver100_ThrowsArgumentOutOfRangeException`
    - `IsGuaranteed_WithFullDropChance_ReturnsTrue`
    - `IsGuaranteed_WithPartialDropChance_ReturnsFalse`
    - `ToString_FormatsCorrectly`

- **`UniqueItemTests`** — 12 tests:
    - `Create_WithValidData_CreatesUniqueItem`
    - `Create_AlwaysSetsLegendaryQuality`
    - `Create_WithEmptyDropSources_ThrowsArgumentException`
    - `HasAffinityFor_WithNoRestrictions_ReturnsTrue`
    - `HasAffinityFor_WithRestrictions_ChecksCorrectly`
    - `CanDropFrom_WithMatchingSource_ReturnsTrue`
    - `Create_NormalizesAllIds`
    - `GetDropSourcesByType_ReturnsMatchingSourcesOnly`
    - `HelperProperties_ReturnCorrectValues`
    - `HelperProperties_WithNoOptionalData_ReturnCorrectValues`
    - `Create_WithEmptyItemId_ThrowsArgumentException`
    - `Create_WithRequiredLevelZero_ThrowsArgumentOutOfRangeException`

---

## Design Decisions

| Decision                                           | Rationale                                                                             |
| -------------------------------------------------- | ------------------------------------------------------------------------------------- |
| Used `EquipmentCategory` instead of `ItemCategory` | Design spec's `ItemCategory` doesn't exist; `EquipmentCategory` has all needed values |
| `readonly record struct` for value objects         | Immutability and built-in equality for value semantics                                |
| All IDs normalized to lowercase                    | Ensures consistent matching across config and runtime                                 |
| `MythForged` quality tier hardcoded                | Unique items are always legendary by definition                                       |
| Empty class affinities = all classes               | Simplifies universal item configuration                                               |
| Negative stats allowed                             | Enables cursed item design patterns                                                   |

---

## Dependencies

| Dependency | Description                         | Status      |
| ---------- | ----------------------------------- | ----------- |
| v0.16.0    | `QualityTier.MythForged` enum value | ✅ Complete |
| Existing   | `EquipmentCategory` enum            | ✅ Complete |
| Existing   | `IEntity` interface                 | ✅ Complete |

---

## Provides To

| Consumer | Description                                |
| -------- | ------------------------------------------ |
| v0.16.5b | Special effect processing for unique items |
| v0.16.5c | Duplicate prevention registry              |
| v0.16.5d | Loot generation integration                |
| v0.16.5e | Visual presentation layer                  |

---

## File Summary

| File                       | Type          | Lines |
| -------------------------- | ------------- | ----- |
| `DropSourceType.cs`        | Enum          | ~65   |
| `ItemStats.cs`             | Value Object  | ~175  |
| `DropSource.cs`            | Value Object  | ~105  |
| `UniqueItem.cs`            | Entity        | ~270  |
| `unique-items.json`        | Configuration | ~85   |
| `unique-items.schema.json` | JSON Schema   | ~145  |
| `DropSourceTypeTests.cs`   | Unit Tests    | ~50   |
| `ItemStatsTests.cs`        | Unit Tests    | ~125  |
| `DropSourceTests.cs`       | Unit Tests    | ~115  |
| `UniqueItemTests.cs`       | Unit Tests    | ~250  |

---

## Verification

- **Build:** 0 errors, 0 warnings
- **Unit Tests:** 30/30 passed (2 + 7 + 9 + 12)
- **Test Coverage:** All factory methods, validation, and business logic methods
