# v0.14.5c Changelog - Crafting Recipe Schema

## Summary

Introduced the comprehensive **Crafting Recipe Schema** (`recipes.schema.json`) which validates crafting recipe definitions including material requirements, skill checks, output items with quality variance, station requirements, and discovery conditions. This schema enables full customization of crafting systems without code changes, supporting modding scenarios such as alchemical brewing, blacksmithing progression, magical enchanting, or survival-style cooking. The schema includes 9 example recipes covering all 9 crafting categories. This is the third schema in the v0.14.5 Economy Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/recipes.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/recipes.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (8 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `RecipeDefinition` | Core recipe with materials, skills, and output | id, name, description, category, materials, output |
| `MaterialRequirement` | Required ingredient with consumption flag | itemId |
| `SkillRequirement` | Skill gate or check for crafting | skillId |
| `OutputDefinition` | Produced item with quantity and quality | itemId, quantity |
| `QuantityRange` | Min/max output quantity | (all optional, defaults 1) |
| `QualityVariance` | Quality tier upgrade mechanics | baseQuality |
| `BonusOutput` | Chance-based extra drops | itemId, quantity, chance |
| `DiscoveryCondition` | How recipe is learned | type |

### Category Enumeration (9 values)

| Category | Description | Typical Station |
|----------|-------------|-----------------|
| `Alchemy` | Potions, elixirs, oils | Alchemy Table |
| `Smithing` | Weapons, armor, tools | Forge/Anvil |
| `Enchanting` | Magical enhancements | Enchanting Table |
| `Cooking` | Food, drinks, buffs | Campfire/Kitchen |
| `Leatherworking` | Leather armor, bags | Tanning Rack |
| `Tailoring` | Cloth armor, cloaks | Loom |
| `Jewelcrafting` | Rings, amulets, gems | Jeweler's Bench |
| `Engineering` | Gadgets, traps, devices | Workbench |
| `Inscription` | Scrolls, glyphs, tomes | Scribe's Desk |

### Quality Tier Enumeration (5 values)

| Tier | Color | Stat Bonus |
|------|-------|------------|
| `Common` | White | +0% |
| `Uncommon` | Green | +10% |
| `Rare` | Blue | +25% |
| `Epic` | Purple | +50% |
| `Legendary` | Orange | +100% |

### Discovery Type Enumeration (6 values)

| Type | Required Field | Description |
|------|----------------|-------------|
| `Default` | None | Known from start (use isKnownByDefault) |
| `Quest` | questId | Learned on quest completion |
| `Level` | requiredLevel | Learned at character level |
| `Teacher` | teacherNpcId | Purchased from NPC trainer |
| `Item` | itemId | Learned from recipe scroll |
| `Exploration` | locationId | Discovered at location |

### Configuration File
- **[config/recipes.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/recipes.json)** - 9 example recipes covering all categories

### Example Recipes Included

| Recipe | Category | Features Demonstrated |
|--------|----------|----------------------|
| `health-potion-basic` | Alchemy | Quality variance, known by default |
| `iron-sword` | Smithing | Failure chance, failure output, crafting time |
| `grilled-meat` | Cooking | Simple recipe, known by default |
| `leather-armor` | Leatherworking | Teacher discovery |
| `enchant-fire-1` | Enchanting | Quest discovery, skill DC check |
| `silver-ring` | Jewelcrafting | Level discovery, bonus outputs |
| `mage-robes` | Tailoring | Item discovery, critical upgrade |
| `mechanical-trap` | Engineering | Exploration discovery, failure output |
| `scroll-fireball` | Inscription | Teacher discovery, skill requirements |

### Unit Tests
- **[RecipesSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/RecipesSchemaTests.cs)** - 12 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (8 definitions)
  - `RecipesJson_ValidatesAgainstSchema` - Backwards compatibility (9 recipes)
  - `Category_InvalidEnum_FailsValidation` - Category enum (9 values)
  - `Materials_EmptyArray_FailsValidation` - Materials minItems: 1
  - `QualityVariance_InvalidBaseQuality_FailsValidation` - Quality tier enum (5 values)
  - `DiscoveryCondition_InvalidType_FailsValidation` - Discovery type enum (6 values)
  - `FailureChance_OutOfRange_FailsValidation` - Failure chance 0-1
  - `RecipeId_InvalidPattern_FailsValidation` - Kebab-case pattern
  - `RequiredFields_Missing_FailsValidation` - Required fields check
  - `MaterialQuantity_LessThanOne_FailsValidation` - Material quantity >= 1
  - `BonusOutputChance_OutOfRange_FailsValidation` - Bonus chance 0-1
  - `SkillRequirementDc_LessThanOne_FailsValidation` - DC >= 1
  - `QuantityRangeMin_LessThanOne_FailsValidation` - Quantity min >= 1

## Changed

### Schema Replacement
- **[config/schemas/recipes.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/recipes.schema.json)** - Replaced previous recipe schema with v0.14.5c design specification schema

### Configuration File Update
- **[config/recipes.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/recipes.json)** - Replaced with new structure matching v0.14.5c schema

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/recipes.schema.json` | Replaced |
| `config/recipes.json` | Replaced |
| `tests/.../Schemas/RecipesSchemaTests.cs` | Added |
| `changelogs/v0.14.5c-changelog.md` | Added |

## Test Results

```
Test summary: total: 12, failed: 0, succeeded: 12, skipped: 0
Build succeeded with 0 errors
```

## Recipe Definition Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  RECIPE DEFINITION                                              │
├─────────────────────────────────────────────────────────────────┤
│  id: "health-potion-basic"                                      │
│  name: "Basic Health Potion"                                    │
│  description: "A simple restorative elixir..."                  │
│  category: "Alchemy"                                            │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  MATERIALS (required, minItems: 1)                         │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ { itemId: "herb-bloodmoss", quantity: 2, consumed: true }│ │
│  │  │ { itemId: "vial-empty", quantity: 1, consumed: true }  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  SKILL REQUIREMENTS (optional)                             │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ { skillId: "alchemy", minimumLevel: 1 }              │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  OUTPUT (required)                                         │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ itemId: "potion-health-basic"                        │  │  │
│  │  │ quantity: { min: 1, max: 1 }                         │  │  │
│  │  │ qualityVariance: {                                   │  │  │
│  │  │   baseQuality: "Common",                             │  │  │
│  │  │   upgradeChance: 0.1                                 │  │  │
│  │  │ }                                                    │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  stationRequired: "alchemy-table"                               │
│  isKnownByDefault: true                                         │
│  experienceReward: 10                                           │
│  sortOrder: 0                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Quality Variance System

```
┌─────────────────────────────────────────────────────────────────┐
│  QUALITY UPGRADE FLOW                                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Craft Attempt                                                  │
│        │                                                        │
│        ▼                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Roll for Critical Upgrade (criticalUpgradeChance)      │   │
│  └─────────────────────────────────────────────────────────┘   │
│        │                                                        │
│        ├── Success ──▶ Upgrade quality by 2 tiers (max Legendary)│
│        │                                                        │
│        └── Failure                                              │
│              │                                                  │
│              ▼                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Roll for Standard Upgrade (upgradeChance)              │   │
│  └─────────────────────────────────────────────────────────┘   │
│              │                                                  │
│              ├── Success ──▶ Upgrade quality by 1 tier          │
│              │                                                  │
│              └── Failure ──▶ Base quality                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Define new crafting recipes with custom materials and outputs
- Configure skill requirements (gates or DC checks)
- Set up quality variance with upgrade chances
- Add bonus outputs with drop chances
- Configure discovery conditions (quest, level, teacher, item, exploration)
- Set crafting time and failure mechanics
- Assign recipes to crafting stations
- Support patterns: alchemy, smithing, enchanting, cooking, leatherworking, tailoring, jewelcrafting, engineering, inscription

---

*Third entry in v0.14.5 Economy Configuration Schemas series. See also: v0.14.5a (Currency Schema), v0.14.5b (Resource Schema), v0.14.5d (Vendor Schema).*
