# v0.0.11c Implementation Plan: Environmental & Sensory Descriptors

**Version:** 0.0.11c
**Parent:** v0.0.11 (Descriptors & Ambience)
**Prerequisites:** v0.0.11a Complete (Descriptor Framework Expansion)
**Design Specification:** [v0.0.11c-design-specification.md](v0.0.11c-design-specification.md)
**Status:** Ready for Implementation
**Target Tests:** ~18 unit tests

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Current System Analysis](#current-system-analysis)
3. [Detailed Implementation](#detailed-implementation)
4. [Testing Strategy](#testing-strategy)
5. [Implementation Checklist](#implementation-checklist)
6. [Acceptance Criteria](#acceptance-criteria)
7. [File Summary](#file-summary)

---

## Executive Summary

### Purpose

Create a rich sensory layer system with detailed lighting, ambient sounds, smells, temperature sensations, and weather effects. Each sense provides distinct, coherent descriptors based on the environment context from v0.0.11a, creating immersive atmospheric descriptions that engage multiple senses.

### Scope

- **In Scope:**
  - Light source type definitions (torch, crystal, bioluminescence, sunlight, magical, moonlight, lava)
  - Darkness level descriptors (pitch black, dim, shadowy, normal, bright, blinding)
  - Layered ambient sound system (distant, nearby, immediate layers)
  - Biome-specific sound, smell, and temperature pools
  - Smell intensity levels (faint, noticeable, strong, overwhelming)
  - Weather condition descriptors (rain, wind, storm, snow, fog) with indoor/outdoor variants
  - Time-of-day effects (dawn, day, dusk, night)
  - `SensoryDescriptorService` for multi-sense generation
  - `SensoryDescription` value object for combined output

- **Out of Scope:**
  - Interactive objects (v0.0.11d)
  - Ambient events (v0.0.11d)
  - Game mechanics based on senses (visibility checks - future)
  - Dynamic weather changes during gameplay (future)

### Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Sound Layers** | 3 layers (distant, nearby, immediate) | Depth and immersion |
| **Smell Intensity** | 4 levels | Scalable atmosphere |
| **Weather** | Indoor/outdoor variants | Context-appropriate descriptions |
| **Time of Day** | Outdoor-only effects | Indoor areas unaffected by time |

---

## Current System Analysis

### Existing Descriptor System (v0.0.11a)

| Component | Current Capability |
|-----------|-------------------|
| `EnvironmentContext` | Biome, climate, lighting, era, condition |
| `EnvironmentCoherenceService` | Validates environment, creates from biome |
| `DescriptorService` | Tag-based filtering, environment-aware |
| Sensory pools | Single pools for lighting, sounds, smells, temperature |

### Target Enhancements (v0.0.11c)

| Component | Enhancement |
|-----------|-------------|
| Lighting | Light source types + darkness levels |
| Sounds | Layered system (distant, nearby, immediate) |
| Smells | Biome-specific pools + intensity levels |
| Temperature | Climate-integrated descriptors |
| Weather | Indoor/outdoor conditions |
| Time of Day | Dawn, day, dusk, night effects |

### New Components

| Component | Purpose |
|-----------|---------|
| `SensoryDescription` | Combined multi-sense value object |
| `LightingDescription` | Light source + darkness level |
| `SoundDescription` | Layered sound (distant/nearby/immediate) |
| `SmellDescription` | Smell with intensity level |
| `SmellIntensity` | Enum for smell intensity (4 levels) |
| `SensoryContext` | Context for sensory generation |
| `SensoryConfiguration` | Light sources, weather, time definitions |
| `SensoryDescriptorService` | Multi-sense generation service |

---

## Detailed Implementation

### Layer Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Configuration Layer                         â”‚
â”‚  lighting.json, sounds.json, smells.json, weather.json       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Application Layer                           â”‚
â”‚  SensoryDescriptorService                                    â”‚
â”‚  - GenerateSensoryDescription()                              â”‚
â”‚  - GetLightingDescription(), GetSoundDescription()           â”‚
â”‚  - GetSmellDescription(), GetTemperatureDescription()        â”‚
â”‚  - GetWeatherDescription(), GetTimeOfDayDescription()        â”‚
â”‚  - GenerateBriefAtmosphere(), GenerateDetailedAtmosphere()   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Domain Layer                              â”‚
â”‚  SensoryDescription (value object)                           â”‚
â”‚  - LightingDescription, SoundDescription, SmellDescription   â”‚
â”‚  - ToNarrative(maxSenses)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sensory Description Generation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SENSORY DESCRIPTION GENERATION FLOW            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Room.Enter() or Look command
           â”‚
           â–¼
    SensoryDescriptorService.GenerateSensoryDescription(context)
           â”‚
           â”œâ”€â”€ GetLightingDescription()
           â”‚   â”œâ”€â”€ Infer light source from biome
           â”‚   â”œâ”€â”€ Get source-specific pool OR level-specific pool
           â”‚   â””â”€â”€ Return LightingDescription
           â”‚
           â”œâ”€â”€ GetSoundDescription()
           â”‚   â”œâ”€â”€ Get distant sounds (biome-specific â†’ generic)
           â”‚   â”œâ”€â”€ Get nearby sounds (biome-specific â†’ generic)
           â”‚   â”œâ”€â”€ Get immediate sounds (if in combat)
           â”‚   â””â”€â”€ Return SoundDescription
           â”‚
           â”œâ”€â”€ GetSmellDescription()
           â”‚   â”œâ”€â”€ Determine intensity from biome
           â”‚   â”œâ”€â”€ Get biome-specific smell â†’ generic
           â”‚   â”œâ”€â”€ Format with intensity template
           â”‚   â””â”€â”€ Return SmellDescription
           â”‚
           â”œâ”€â”€ GetTemperatureDescription()
           â”‚   â”œâ”€â”€ Get climate-specific pool
           â”‚   â””â”€â”€ Return temperature string
           â”‚
           â”œâ”€â”€ GetWeatherDescription() [if weather set]
           â”‚   â”œâ”€â”€ Validate weather for climate
           â”‚   â”œâ”€â”€ Get indoor or outdoor pool
           â”‚   â””â”€â”€ Return weather string
           â”‚
           â””â”€â”€ GetTimeOfDayDescription() [if outdoor]
                   â”‚
                   â–¼
           Return SensoryDescription
                   â”‚
                   â–¼
           ToNarrative(maxSenses) â†’ Combined text output
```

---

## Testing Strategy

### Unit Tests (~18 tests)

#### SensoryDescriptorServiceTests.cs (~13 tests)

| Test | Description |
|------|-------------|
| `GetLightingDescription_WithLightSource_UsesSourcePool` | Source-specific pool |
| `GetLightingDescription_WithoutSource_InfersFromBiome` | Biome inference |
| `GetSoundDescription_ReturnsLayeredSounds` | Multi-layer sounds |
| `GetSoundDescription_WithCombat_IncludesImmediateSounds` | Combat sounds |
| `GetSmellDescription_UsesBiomeSpecificPool` | Biome-specific smells |
| `GetSmellDescription_AppliesIntensityBasedOnBiome` | Intensity mapping |
| `GetTemperatureDescription_UsesClimateSpecificPool` | Climate temperature |
| `GetWeatherDescription_ValidatesClimate` | Weather/climate coherence |
| `GetWeatherDescription_UsesIndoorOrOutdoorPool` | Indoor vs outdoor |
| `GetTimeOfDayDescription_ReturnsNullForIndoor` | Indoor filtering |
| `GenerateSensoryDescription_CombinesAllSenses` | Full combination |
| `GenerateBriefAtmosphere_LimitsToThreeSenses` | Brief output |
| `GenerateDetailedAtmosphere_IncludesAllSoundLayers` | Detailed output |

#### SensoryDescriptionTests.cs (~5 tests)

| Test | Description |
|------|-------------|
| `ToNarrative_CombinesSensesInOrder` | Ordered combination |
| `ToNarrative_RespectsMaxSensesLimit` | Limit enforcement |
| `SoundDescription_Primary_ReturnsFirstNonNull` | Primary sound |
| `SoundDescription_ToFullDescription_CombinesAllLayers` | Full sound |
| `HasDescriptions_ReturnsTrueWhenAnyPresent` | Presence check |

---

## Implementation Checklist

> **Legend:** ğŸŸ¢ No dependencies | ğŸŸ¡ Has dependencies | ğŸ”´ Critical path
> **Complexity:** â­ Simple | â­â­ Moderate | â­â­â­ Complex

---

### Phase 1: Domain Value Objects

#### 1.1 Create SmellIntensity Enum ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs`

- [ ] Create `SmellIntensity` enum
  - `Faint` (barely noticeable)
  - `Noticeable` (clearly present)
  - `Strong` (dominant odor)
  - `Overwhelming` (nearly unbearable)

**Acceptance:** Enum defined with XML documentation.

---

#### 1.2 Create LightingDescription Record ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs`

- [ ] Create `LightingDescription` readonly record struct
  - `Description` (string)
  - `LightSource` (nullable string)
  - `DarknessLevel` (nullable string)

**Acceptance:** Record captures lighting characteristics.

---

#### 1.3 Create SoundDescription Record ğŸŸ¢ â­â­

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs`

- [ ] Create `SoundDescription` readonly record struct
  - `Distant` (nullable string)
  - `Nearby` (nullable string)
  - `Immediate` (nullable string)
- [ ] Add `Primary` property (first non-null layer)
- [ ] Add `HasSounds` property
- [ ] Add `ToFullDescription()` method (combines all layers)

**Acceptance:** Record supports layered sounds.

---

#### 1.4 Create SmellDescription Record ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs`

- [ ] Create `SmellDescription` readonly record struct
  - `Description` (string)
  - `Intensity` (SmellIntensity)
  - `SmellType` (nullable string)

**Acceptance:** Record captures smell with intensity.

---

#### 1.5 Create SensoryDescription Record ğŸŸ¡ â­â­ ğŸ”´

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs`

- [ ] Create `SensoryDescription` readonly record struct
  - `Lighting` (LightingDescription)
  - `Sounds` (SoundDescription)
  - `Smell` (SmellDescription)
  - `Temperature` (string)
  - `Weather` (nullable string)
  - `TimeOfDay` (nullable string)
- [ ] Add `HasDescriptions` property
- [ ] Add `ToNarrative(int maxSenses = 4)` method

**Acceptance:** Record combines all senses with narrative output.

---

### Phase 2: Configuration Classes

#### 2.1 Create SensoryConfiguration ğŸŸ¢ â­â­

**File:** `src/Core/RuneAndRust.Application/Configuration/SensoryConfiguration.cs`

- [ ] Create `SensoryConfiguration` class
  - `LightSources` dictionary
  - `DarknessLevels` dictionary
  - `WeatherConditions` dictionary
  - `TimesOfDay` dictionary
- [ ] Create `LightSourceDefinition` class
  - `Id`, `Name`, `LightQuality`
  - `DescriptorPool`, `Atmosphere`
  - `CommonBiomes`, `IsFlickering`
- [ ] Create `DarknessLevelDefinition` class
  - `Id`, `Name`, `VisibilityLevel`
  - `DescriptorPool`, `ImpliedTags`
- [ ] Create `WeatherDefinition` class
  - `Id`, `Name`
  - `IndoorPool`, `OutdoorPool`
  - `ValidClimates`
  - `AffectsVisibility`, `AffectsSound`
- [ ] Create `TimeOfDayDefinition` class
  - `Id`, `Name`, `OutdoorPool`
  - `LightQuality`, `DefaultDarknessLevel`
  - `ImpliedTags`

**Acceptance:** Configuration classes deserialize from JSON.

---

#### 2.2 Create SensoryContext ğŸŸ¡ â­â­

**File:** `src/Core/RuneAndRust.Application/Services/SensoryDescriptorService.cs`

- [ ] Create `SensoryContext` record
  - `Environment` (EnvironmentContext)
  - `LightSource` (nullable string)
  - `Weather` (nullable string)
  - `TimeOfDay` (nullable string)
  - `IsIndoor` (bool, default true)
  - `InCombat` (bool)
  - `AdditionalTags` (IReadOnlyList<string>)
- [ ] Add `GetAllTags()` method (combines environment + additional tags)

**Acceptance:** Context captures all sensory generation inputs.

---

### Phase 3: Configuration Files

#### 3.1 Create lighting.json ğŸŸ¢ â­â­

**File:** `config/descriptors/lighting.json`

- [ ] Create `lighting_torch` pool (5+ descriptors)
- [ ] Create `lighting_crystal` pool (4+ descriptors)
- [ ] Create `lighting_bioluminescence` pool (4+ descriptors)
- [ ] Create `lighting_magical` pool (4+ descriptors)
- [ ] Create `lighting_sunlight` pool (4+ descriptors)
- [ ] Create `lighting_moonlight` pool (4+ descriptors)
- [ ] Create `lighting_lava_glow` pool (4+ descriptors)
- [ ] Create `lighting_pitch_black` pool (4+ descriptors)
- [ ] Create `lighting_dim` pool (4+ descriptors)
- [ ] Create `lighting_bright` pool (4+ descriptors)

**Acceptance:** 10 lighting pools with appropriate descriptors.

---

#### 3.2 Create sounds.json ğŸŸ¢ â­â­

**File:** `config/descriptors/sounds.json`

- [ ] Create `sounds_distant` pool (generic, 5+ descriptors)
- [ ] Create `sounds_distant_cave` pool (4+ descriptors)
- [ ] Create `sounds_distant_volcanic` pool (4+ descriptors)
- [ ] Create `sounds_nearby` pool (generic, 5+ descriptors)
- [ ] Create `sounds_nearby_forest` pool (5+ descriptors)
- [ ] Create `sounds_nearby_swamp` pool (5+ descriptors)
- [ ] Create `sounds_immediate_combat` pool (4+ descriptors)

**Acceptance:** 7+ sound pools with biome-specific variants.

---

#### 3.3 Create smells.json ğŸŸ¢ â­â­

**File:** `config/descriptors/smells.json`

- [ ] Create `smells_cave` pool (4+ descriptors)
- [ ] Create `smells_dungeon` pool (5+ descriptors)
- [ ] Create `smells_volcanic` pool (4+ descriptors)
- [ ] Create `smells_frozen` pool (4+ descriptors)
- [ ] Create `smells_swamp` pool (4+ descriptors)
- [ ] Create `smells_forest` pool (5+ descriptors)
- [ ] Create `smells_ruins` pool (4+ descriptors)

**Acceptance:** 7 smell pools with biome-appropriate descriptors.

---

#### 3.4 Create weather.json ğŸŸ¢ â­â­

**File:** `config/descriptors/weather.json`

- [ ] Create `weather_rain_indoor` pool (4+ descriptors)
- [ ] Create `weather_rain_outdoor` pool (4+ descriptors)
- [ ] Create `weather_storm_indoor` pool (4+ descriptors)
- [ ] Create `weather_storm_outdoor` pool (4+ descriptors)
- [ ] Create `weather_snow_indoor` pool (4+ descriptors)
- [ ] Create `weather_snow_outdoor` pool (4+ descriptors)
- [ ] Create `weather_fog_indoor` pool (3+ descriptors)
- [ ] Create `weather_fog_outdoor` pool (4+ descriptors)
- [ ] Create `weather_wind_indoor` pool (3+ descriptors)
- [ ] Create `weather_wind_outdoor` pool (4+ descriptors)

**Acceptance:** 10 weather pools with indoor/outdoor variants.

---

### Phase 4: Application Service

#### 4.1 Create SensoryDescriptorService ğŸŸ¡ â­â­â­ ğŸ”´

**File:** `src/Core/RuneAndRust.Application/Services/SensoryDescriptorService.cs`

- [ ] Create `SensoryDescriptorService` class
- [ ] Inject `DescriptorService`, `EnvironmentCoherenceService`, `SensoryConfiguration`, `ILogger`
- [ ] Implement `GenerateSensoryDescription(SensoryContext context)`
  - Orchestrate all sense generation
- [ ] Implement `GetLightingDescription(SensoryContext context)`
  - Infer light source from biome
  - Get source-specific or level-specific pool
  - Fall back to generic lighting
- [ ] Implement `GetSoundDescription(SensoryContext context)`
  - Get distant, nearby, immediate layers
  - Use biome-specific pools with fallback
  - Add combat immediate sounds
- [ ] Implement `GetSmellDescription(SensoryContext context)`
  - Determine intensity from biome
  - Get biome-specific smell
  - Format with intensity template
- [ ] Implement `GetTemperatureDescription(SensoryContext context)`
  - Get climate-specific pool
- [ ] Implement `GetWeatherDescription(SensoryContext context)`
  - Validate weather for climate
  - Use indoor or outdoor pool
- [ ] Implement `GetTimeOfDayDescription(SensoryContext context)`
  - Outdoor-only, return null for indoor
- [ ] Implement `GenerateBriefAtmosphere(SensoryContext context)`
  - Call ToNarrative(3)
- [ ] Implement `GenerateDetailedAtmosphere(SensoryContext context)`
  - Include all sound layers
- [ ] Implement private helpers:
  - `InferLightSource(context)`
  - `GetSoundLayer(layer, biome, tags)`
  - `DetermineSmellIntensity(context)`
  - `FormatSmellWithIntensity(smellType, intensity)`
  - `ExtractSmellType(description)`

**Acceptance:** Service generates complete multi-sensory descriptions.

---

### Phase 5: Infrastructure Integration

#### 5.1 Extend IGameConfigurationProvider ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Interfaces/IGameConfigurationProvider.cs`

- [ ] Add `GetSensoryConfiguration()` method

**Acceptance:** Interface supports sensory configuration.

---

#### 5.2 Extend JsonConfigurationProvider ğŸŸ¡ â­â­

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`

- [ ] Load `lighting.json`, `sounds.json`, `smells.json`, `weather.json`
- [ ] Implement `GetSensoryConfiguration()` method

**Acceptance:** Provider loads all sensory configuration files.

---

#### 5.3 Register SensoryDescriptorService ğŸŸ¡ â­

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/DependencyInjection.cs`

- [ ] Register `SensoryConfiguration` from provider
- [ ] Register `SensoryDescriptorService`

**Acceptance:** Service available via dependency injection.

---

### Phase 6: Presentation Integration

#### 6.1 Enhance Look Command ğŸŸ¡ â­â­

**File:** Various presentation files (GameView, LookCommandHandler)

- [ ] Build `SensoryContext` from current room
- [ ] Generate sensory atmosphere
- [ ] Combine with room description
- [ ] Render enhanced room description

**Acceptance:** Look command uses sensory descriptions.

---

### Phase 7: Unit Tests

#### 7.1 SensoryDescriptionTests.cs ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/SensoryDescriptionTests.cs`

- [ ] Implement 5 tests per specification

**Acceptance:** All value object tests pass.

---

#### 7.2 SensoryDescriptorServiceTests.cs ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Application.UnitTests/Services/SensoryDescriptorServiceTests.cs`

- [ ] Implement 13 tests per specification

**Acceptance:** All service tests pass.

---

### Implementation Order Summary

```
Phase 1: Domain Value Objects
  1.1 SmellIntensity enum â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  1.2 LightingDescription record â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  1.3 SoundDescription record â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  1.4 SmellDescription record â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  1.5 SensoryDescription record â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                              â†“
Phase 2: Configuration Classes
  2.1 SensoryConfiguration
  2.2 SensoryContext
                                                              â†“
Phase 3: Configuration Files (Parallel)
  3.1 lighting.json
  3.2 sounds.json
  3.3 smells.json
  3.4 weather.json
                                                              â†“
Phase 4: Application Service
  4.1 SensoryDescriptorService â† CRITICAL
                                                              â†“
Phase 5: Infrastructure Integration
  5.1 IGameConfigurationProvider extension
  5.2 JsonConfigurationProvider implementation
  5.3 DI registration
                                                              â†“
Phase 6: Presentation Integration
  6.1 Look command enhancement
                                                              â†“
Phase 7: Unit Tests
  7.1 SensoryDescriptionTests
  7.2 SensoryDescriptorServiceTests
```

### Estimated Effort

| Phase | Tasks | Complexity | Est. Time |
|-------|-------|------------|-----------|
| Domain Value Objects | 5 records | â­-â­â­ | 1.5 hours |
| Configuration Classes | 2 items | â­â­ | 1.5 hours |
| Configuration Files | 4 files | â­â­ | 2.5 hours |
| Application Service | 1 service | â­â­â­ | 3 hours |
| Infrastructure | 3 items | â­-â­â­ | 1.5 hours |
| Presentation | 1 item | â­â­ | 1 hour |
| Unit Tests | 18 tests | â­â­ | 2 hours |
| **Total** | | | **~13 hours** |

---

## Acceptance Criteria

### Lighting System

- [ ] Light source types defined (torch, crystal, bioluminescence, magical, sunlight, moonlight, lava)
- [ ] Darkness level pools implemented (pitch black, dim, normal, bright, blinding)
- [ ] Light sources inferred from biome when not specified
- [ ] Lighting descriptions integrate with environment context

### Sound System

- [ ] Layered sound system implemented (distant, nearby, immediate)
- [ ] Biome-specific sound pools (cave, dungeon, forest, volcanic, swamp)
- [ ] Combat-specific immediate sounds
- [ ] Sound layers combinable for detailed descriptions

### Smell System

- [ ] Biome-specific smell pools implemented
- [ ] Smell intensity levels work (faint, noticeable, strong, overwhelming)
- [ ] Intensity determined by biome characteristics
- [ ] Smell descriptions formatted with intensity templates

### Temperature System

- [ ] Climate-specific temperature pools
- [ ] Temperature integrates with climate from EnvironmentContext

### Weather System

- [ ] Weather conditions defined (rain, storm, snow, fog, wind)
- [ ] Indoor vs outdoor variants
- [ ] Weather validated against climate

### Time of Day

- [ ] Time periods defined (dawn, day, dusk, night)
- [ ] Outdoor-only effects
- [ ] Light quality changes by time

### Integration

- [ ] SensoryDescriptorService generates complete SensoryDescription
- [ ] ToNarrative() combines senses coherently
- [ ] Look command uses sensory descriptions

### Tests

- [ ] ~18 unit tests pass
- [ ] Build completes with 0 errors

---

## File Summary

### New Files (9)

| File | Purpose |
|------|---------|
| `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs` | Sensory value objects |
| `src/Core/RuneAndRust.Application/Configuration/SensoryConfiguration.cs` | Sensory config classes |
| `src/Core/RuneAndRust.Application/Services/SensoryDescriptorService.cs` | Multi-sense generation |
| `config/descriptors/lighting.json` | Light source and darkness pools |
| `config/descriptors/sounds.json` | Layered sound pools |
| `config/descriptors/smells.json` | Biome smell pools |
| `config/descriptors/weather.json` | Weather condition pools |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/SensoryDescriptionTests.cs` | Value object tests |
| `tests/RuneAndRust.Application.UnitTests/Services/SensoryDescriptorServiceTests.cs` | Service tests |

### Modified Files (4)

| File | Changes |
|------|---------|
| `config/descriptors/environmental.json` | Restructured into new files |
| `IGameConfigurationProvider.cs` | Add sensory config method |
| `JsonConfigurationProvider.cs` | Load sensory configuration |
| `DependencyInjection.cs` | Register SensoryDescriptorService |

---

## Example Output

### Cave Biome (Brief Atmosphere)

```
Eerie phosphorescent fungi cast a pale green glow across the cavern.
Water drips steadily from stalactites overhead. The sharp scent of
minerals and wet stone fills your nostrils.
```

### Volcanic Biome (Detailed Atmosphere)

```
A dim orange glow emanates from fissures in the rock, casting everything
in hellish light. The constant rumble of flowing lava vibrates through
your feet. Steam vents hiss and roar in the distance. Sulfurous fumes
sting your eyes and throat. Oppressive heat radiates from every surface.
```

### Frozen Biome (With Weather)

```
Crystalline ice formations refract pale blue light throughout the
chamber. An eerie silence hangs in the frigid air. The crisp, clean
scent of snow reaches you. A bone-chilling cold seeps into your very
bones. Snow swirls around you in dancing flurries.
```

---

## Provides to Future Phases

### To v0.0.11d (Ambient Events)

| Type | Usage |
|------|-------|
| `SensoryDescriptorService` | Integrated into room descriptions |
| `SensoryDescription` | Used by ambient event system |
| `SensoryContext` | Passed through for object descriptions |

### To Future Versions

| Type | Usage |
|------|-------|
| Sensory system | Foundation for visibility/hearing mechanics |
| Weather | Foundation for dynamic weather system |

---

*This implementation plan establishes a comprehensive multi-sensory system that creates immersive atmospheric descriptions. By layering lighting, sounds, smells, temperature, weather, and time effects, the system engages multiple senses while maintaining coherence with the biome and climate context from v0.0.11a.*
