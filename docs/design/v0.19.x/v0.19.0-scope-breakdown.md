# v0.19.0 Scope Breakdown: Core Biome Infrastructure

## Overview

v0.19.0 establishes the foundational infrastructure for the Nine Realms biome system. This version defines the core entities, enumerations, and provider interfaces that all subsequent realm implementations will utilize.

---

## In Scope

### Domain Layer

#### Enumerations

| Enum | Purpose | Values |
|------|---------|--------|
| `RealmId` | Identifies the 9 canonical realms | `Midgard`, `Asgard`, `Alfheim`, `Vanaheim`, `Niflheim`, `Svartalfheim`, `Jotunheim`, `Muspelheim`, `Helheim` |
| `BiomeCompatibility` | Adjacency classification | `Compatible`, `RequiresTransition`, `Incompatible` |
| `EnvironmentalConditionType` | Ambient hazard types | `None`, `IntenseHeat`, `ExtremeCold`, `ToxicAtmosphere`, `MutagenicSpores`, `RealityFlux`, `CpsExposure`, `TotalDarkness`, `GiantScale` |
| `VerticalZone` | Z-level classification | `DeepRoots` (-3), `LowerRoots` (-2), `UpperRoots` (-1), `GroundLevel` (0), `LowerTrunk` (+1), `UpperTrunk` (+2), `Canopy` (+3), `Orbital` (+4) |

#### Value Objects

| Value Object | Purpose |
|--------------|---------|
| `BiomeProperties` | Environmental baseline properties (temperature, aetheric intensity, humidity, light level) |
| `AdjacencyRule` | Single adjacency relationship between two realms |
| `TransitionTheme` | Descriptive text and room count for biome transitions |

#### Entities

| Entity | Purpose |
|--------|---------|
| `BiomeDefinition` | Core realm definition with all properties and zones |
| `BiomeZone` | Sub-biome within a realm (e.g., Greatwood within Midgard) |
| `EnvironmentalCondition` | Active environmental hazard with DC and damage |

### Application Layer

#### Interfaces

| Interface | Purpose |
|-----------|---------|
| `IBiomeProvider` | Loads and retrieves biome definitions |
| `IBiomeAdjacencyService` | Validates biome adjacency and generates transitions |
| `IEnvironmentalConditionService` | Applies environmental effects to characters |

#### Implementations

| Implementation | Purpose |
|----------------|---------|
| `BiomeProvider` | JSON-based biome definition loading |
| `BiomeAdjacencyService` | Adjacency matrix queries and transition generation |

### Infrastructure Layer

#### Configuration

| File | Purpose |
|------|---------|
| `biomes.json` | Master biome definitions (placeholder structure) |
| `biomes.schema.json` | JSON Schema for validation |
| `adjacency_matrix.json` | Pre-computed adjacency relationships |

---

## Out of Scope (Deferred to v0.19.1+)

- Individual realm implementations (Midgard, Muspelheim, etc.)
- Realm-specific environmental conditions
- Faction spawn pool integration
- Room template filtering by biome
- Travel time calculations
- Dungeon sector biome assignment

---

## Domain Layer Specifications

### RealmId Enum

```csharp
/// <summary>
/// Identifies the nine canonical realms of Aethelgard.
/// Each realm corresponds to a Deck of the YGGDRASIL Network.
/// </summary>
public enum RealmId
{
    /// <summary>Deck 01 — Primary Administration. The Shattered Spire.</summary>
    Asgard = 1,

    /// <summary>Deck 02 — Aetheric Research. The Glimmering Wound.</summary>
    Alfheim = 2,

    /// <summary>Deck 03 — Bio-Engineering. The Overgrown Laboratory.</summary>
    Vanaheim = 3,

    /// <summary>Deck 04 — Civilian Habitation. The Tamed Ruin.</summary>
    Midgard = 4,

    /// <summary>Deck 05 — Cryogenic Preservation. The Frozen Tomb.</summary>
    Niflheim = 5,

    /// <summary>Deck 06 — Manufacturing. The Dvergr Forges.</summary>
    Svartalfheim = 6,

    /// <summary>Deck 07 — Heavy Industry. The Industrial Graveyard.</summary>
    Jotunheim = 7,

    /// <summary>Deck 08 — Power Generation. The Eternal Meltdown.</summary>
    Muspelheim = 8,

    /// <summary>Deck 08 — Waste Reclamation. The Gangrenous Gut.</summary>
    Helheim = 9
}
```

### BiomeCompatibility Enum

```csharp
/// <summary>
/// Defines adjacency compatibility between biomes.
/// </summary>
public enum BiomeCompatibility
{
    /// <summary>Biomes can directly neighbor without transition.</summary>
    Compatible,

    /// <summary>Biomes require 1-3 transition rooms when neighboring.</summary>
    RequiresTransition,

    /// <summary>Biomes cannot neighbor directly; requires NeutralZone buffer.</summary>
    Incompatible
}
```

### EnvironmentalConditionType Enum

```csharp
/// <summary>
/// Types of ambient environmental hazards applied per realm.
/// </summary>
public enum EnvironmentalConditionType
{
    /// <summary>No ambient hazard (temperate realms like Midgard).</summary>
    None,

    /// <summary>Extreme heat requiring STURDINESS checks (Muspelheim).</summary>
    IntenseHeat,

    /// <summary>Extreme cold requiring STURDINESS checks (Niflheim).</summary>
    ExtremeCold,

    /// <summary>Toxic atmosphere requiring environmental seal (Helheim).</summary>
    ToxicAtmosphere,

    /// <summary>Mutagenic spores causing Corruption accumulation (Vanaheim).</summary>
    MutagenicSpores,

    /// <summary>Reality distortion causing Stress and navigation hazards (Alfheim).</summary>
    RealityFlux,

    /// <summary>Cognitive paradox exposure causing CPS accumulation (Asgard).</summary>
    CpsExposure,

    /// <summary>Absolute darkness requiring light sources (Svartalfheim Black Veins).</summary>
    TotalDarkness,

    /// <summary>Giant-scale terrain with increased fall damage (Jötunheim).</summary>
    GiantScale
}
```

### VerticalZone Enum

```csharp
/// <summary>
/// Vertical layer classification for biome placement.
/// </summary>
public enum VerticalZone
{
    /// <summary>Z = -3. Deepest dungeon layers.</summary>
    DeepRoots = -3,

    /// <summary>Z = -2. Lower subterranean layers.</summary>
    LowerRoots = -2,

    /// <summary>Z = -1. Upper subterranean layers.</summary>
    UpperRoots = -1,

    /// <summary>Z = 0. Ground/entry level.</summary>
    GroundLevel = 0,

    /// <summary>Z = +1. Lower surface structures.</summary>
    LowerTrunk = 1,

    /// <summary>Z = +2. Upper surface structures.</summary>
    UpperTrunk = 2,

    /// <summary>Z = +3. Highest surface exposure.</summary>
    Canopy = 3,

    /// <summary>Z = +4 and above. Orbital structures (Asgard only).</summary>
    Orbital = 4
}
```

### BiomeProperties Value Object

```csharp
/// <summary>
/// Environmental baseline properties for a biome.
/// </summary>
public sealed record BiomeProperties
{
    /// <summary>Base temperature in Celsius.</summary>
    public required int TemperatureCelsius { get; init; }

    /// <summary>Aetheric intensity (0.0-1.0). Higher = more magic/paradox.</summary>
    public required float AethericIntensity { get; init; }

    /// <summary>Humidity percentage (0-100).</summary>
    public required int HumidityPercent { get; init; }

    /// <summary>Ambient light level (0.0-1.0). 0 = dark, 1 = bright.</summary>
    public required float LightLevel { get; init; }

    /// <summary>Scale factor for architecture. 1.0 = human, 3.0 = giant.</summary>
    public required float ScaleFactor { get; init; }

    /// <summary>Equipment corrosion rate (0.0-1.0).</summary>
    public required float CorrosionRate { get; init; }
}
```

### AdjacencyRule Value Object

```csharp
/// <summary>
/// Defines adjacency relationship between two realms.
/// </summary>
public sealed record AdjacencyRule
{
    /// <summary>First realm in the relationship.</summary>
    public required RealmId RealmA { get; init; }

    /// <summary>Second realm in the relationship.</summary>
    public required RealmId RealmB { get; init; }

    /// <summary>Compatibility classification.</summary>
    public required BiomeCompatibility Compatibility { get; init; }

    /// <summary>Minimum transition rooms if RequiresTransition.</summary>
    public int MinTransitionRooms { get; init; } = 0;

    /// <summary>Maximum transition rooms if RequiresTransition.</summary>
    public int MaxTransitionRooms { get; init; } = 3;

    /// <summary>Descriptive theme for transition zone.</summary>
    public string? TransitionTheme { get; init; }
}
```

### BiomeDefinition Entity

```csharp
/// <summary>
/// Core definition for a realm/biome in Aethelgard.
/// </summary>
public sealed class BiomeDefinition
{
    /// <summary>Unique realm identifier.</summary>
    public required RealmId Id { get; init; }

    /// <summary>Display name (e.g., "Midgard").</summary>
    public required string Name { get; init; }

    /// <summary>Thematic subtitle (e.g., "The Tamed Ruin").</summary>
    public required string Subtitle { get; init; }

    /// <summary>Deck designation in YGGDRASIL Network.</summary>
    public required int DeckNumber { get; init; }

    /// <summary>Pre-Glitch function description.</summary>
    public required string PreGlitchFunction { get; init; }

    /// <summary>Post-Glitch state description.</summary>
    public required string PostGlitchState { get; init; }

    /// <summary>Environmental baseline properties.</summary>
    public required BiomeProperties BaseProperties { get; init; }

    /// <summary>Primary environmental hazard type.</summary>
    public required EnvironmentalConditionType PrimaryCondition { get; init; }

    /// <summary>Vertical zone range (minimum Z-level).</summary>
    public required VerticalZone MinVerticalZone { get; init; }

    /// <summary>Vertical zone range (maximum Z-level).</summary>
    public required VerticalZone MaxVerticalZone { get; init; }

    /// <summary>Sub-biome zones within this realm.</summary>
    public IReadOnlyList<BiomeZone> Zones { get; init; } = [];

    /// <summary>Flavor quote for thematic display.</summary>
    public string? FlavorQuote { get; init; }

    /// <summary>Thematic color palette (CSS-style).</summary>
    public string? ColorPalette { get; init; }
}
```

### BiomeZone Entity

```csharp
/// <summary>
/// Sub-biome zone within a realm (e.g., Greatwood within Midgard).
/// </summary>
public sealed class BiomeZone
{
    /// <summary>Unique zone identifier within the realm.</summary>
    public required string Id { get; init; }

    /// <summary>Display name (e.g., "The Greatwood").</summary>
    public required string Name { get; init; }

    /// <summary>Parent realm.</summary>
    public required RealmId ParentRealm { get; init; }

    /// <summary>Override properties for this zone (null = use parent).</summary>
    public BiomeProperties? OverrideProperties { get; init; }

    /// <summary>Zone-specific environmental condition override.</summary>
    public EnvironmentalConditionType? OverrideCondition { get; init; }

    /// <summary>DC modifier for environmental checks.</summary>
    public int ConditionDcModifier { get; init; } = 0;

    /// <summary>Damage modifier for environmental effects.</summary>
    public string? DamageOverride { get; init; }

    /// <summary>Vertical zone range (minimum).</summary>
    public VerticalZone? MinVerticalZone { get; init; }

    /// <summary>Vertical zone range (maximum).</summary>
    public VerticalZone? MaxVerticalZone { get; init; }
}
```

### EnvironmentalCondition Entity

```csharp
/// <summary>
/// Active environmental hazard applied to characters.
/// </summary>
public sealed class EnvironmentalCondition
{
    /// <summary>Condition type.</summary>
    public required EnvironmentalConditionType Type { get; init; }

    /// <summary>Display name for UI.</summary>
    public required string DisplayName { get; init; }

    /// <summary>Attribute used for resistance check.</summary>
    public required string CheckAttribute { get; init; }

    /// <summary>Base DC for resistance check.</summary>
    public required int BaseDc { get; init; }

    /// <summary>Damage dice on failed check (e.g., "2d6").</summary>
    public required string DamageDice { get; init; }

    /// <summary>Damage type (e.g., "Fire", "Cold", "Poison").</summary>
    public required string DamageType { get; init; }

    /// <summary>Check frequency (e.g., "Per Turn", "Per Hour").</summary>
    public required string Frequency { get; init; }

    /// <summary>Description for environmental storytelling.</summary>
    public required string Description { get; init; }

    /// <summary>Mitigation methods (equipment, abilities).</summary>
    public IReadOnlyList<string> Mitigations { get; init; } = [];
}
```

---

## Application Layer Specifications

### IBiomeProvider Interface

```csharp
/// <summary>
/// Provides access to biome definitions.
/// </summary>
public interface IBiomeProvider
{
    /// <summary>Gets all biome definitions.</summary>
    IReadOnlyList<BiomeDefinition> GetAllBiomes();

    /// <summary>Gets a specific biome by realm ID.</summary>
    BiomeDefinition? GetBiome(RealmId realmId);

    /// <summary>Gets all zones for a specific realm.</summary>
    IReadOnlyList<BiomeZone> GetZonesForRealm(RealmId realmId);

    /// <summary>Gets a specific zone by ID.</summary>
    BiomeZone? GetZone(RealmId realmId, string zoneId);

    /// <summary>Gets the environmental condition definition for a type.</summary>
    EnvironmentalCondition? GetEnvironmentalCondition(EnvironmentalConditionType type);
}
```

### IBiomeAdjacencyService Interface

```csharp
/// <summary>
/// Validates and queries biome adjacency relationships.
/// </summary>
public interface IBiomeAdjacencyService
{
    /// <summary>Checks if two realms can be adjacent.</summary>
    bool CanBiomesNeighbor(RealmId realmA, RealmId realmB);

    /// <summary>Gets the compatibility classification for two realms.</summary>
    BiomeCompatibility GetCompatibility(RealmId realmA, RealmId realmB);

    /// <summary>Gets required transition room count for two realms.</summary>
    (int Min, int Max) GetTransitionRoomCount(RealmId realmA, RealmId realmB);

    /// <summary>Gets the transition theme description for two realms.</summary>
    string? GetTransitionTheme(RealmId fromRealm, RealmId toRealm);

    /// <summary>Gets all realms adjacent to the specified realm.</summary>
    IReadOnlyList<RealmId> GetAdjacentRealms(RealmId realmId);

    /// <summary>Validates that a realm configuration doesn't violate adjacency rules.</summary>
    bool ValidateRealmConfiguration(IEnumerable<(RealmId, RealmId)> adjacentPairs);
}
```

### IEnvironmentalConditionService Interface

```csharp
/// <summary>
/// Applies environmental effects to characters.
/// </summary>
public interface IEnvironmentalConditionService
{
    /// <summary>Gets the active environmental condition for a biome zone.</summary>
    EnvironmentalCondition? GetActiveCondition(RealmId realm, string? zoneId = null);

    /// <summary>Calculates the effective DC for a condition in a zone.</summary>
    int CalculateEffectiveDc(EnvironmentalCondition condition, BiomeZone? zone);

    /// <summary>Applies environmental damage to a character.</summary>
    EnvironmentalDamageResult ApplyEnvironmentalDamage(
        Guid characterId,
        EnvironmentalCondition condition,
        int dcModifier = 0);

    /// <summary>Checks if a character has mitigation for a condition.</summary>
    bool HasMitigation(Guid characterId, EnvironmentalCondition condition);
}
```

### EnvironmentalDamageResult Record

```csharp
/// <summary>
/// Result of applying environmental damage to a character.
/// </summary>
public sealed record EnvironmentalDamageResult
{
    /// <summary>Target character ID.</summary>
    public required Guid CharacterId { get; init; }

    /// <summary>Condition that triggered the damage.</summary>
    public required EnvironmentalConditionType ConditionType { get; init; }

    /// <summary>Whether the resistance check succeeded.</summary>
    public required bool CheckPassed { get; init; }

    /// <summary>Resistance check roll value.</summary>
    public required int CheckRoll { get; init; }

    /// <summary>Resistance check DC.</summary>
    public required int CheckDc { get; init; }

    /// <summary>Damage dealt (0 if check passed).</summary>
    public required int DamageDealt { get; init; }

    /// <summary>Damage type applied.</summary>
    public required string DamageType { get; init; }

    /// <summary>Whether mitigation was applied.</summary>
    public required bool MitigationApplied { get; init; }
}
```

---

## Configuration Schema

### biomes.schema.json

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "biomes.schema.json",
  "title": "Biome Definitions Schema",
  "type": "object",
  "properties": {
    "biomes": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "enum": ["Asgard", "Alfheim", "Vanaheim", "Midgard", "Niflheim", "Svartalfheim", "Jotunheim", "Muspelheim", "Helheim"]
          },
          "name": { "type": "string" },
          "subtitle": { "type": "string" },
          "deckNumber": { "type": "integer", "minimum": 1, "maximum": 9 },
          "preGlitchFunction": { "type": "string" },
          "postGlitchState": { "type": "string" },
          "baseProperties": {
            "type": "object",
            "properties": {
              "temperatureCelsius": { "type": "integer" },
              "aethericIntensity": { "type": "number", "minimum": 0, "maximum": 1 },
              "humidityPercent": { "type": "integer", "minimum": 0, "maximum": 100 },
              "lightLevel": { "type": "number", "minimum": 0, "maximum": 1 },
              "scaleFactor": { "type": "number", "minimum": 0.5, "maximum": 3.0 },
              "corrosionRate": { "type": "number", "minimum": 0, "maximum": 1 }
            },
            "required": ["temperatureCelsius", "aethericIntensity", "humidityPercent", "lightLevel", "scaleFactor", "corrosionRate"]
          },
          "primaryCondition": {
            "type": "string",
            "enum": ["None", "IntenseHeat", "ExtremeCold", "ToxicAtmosphere", "MutagenicSpores", "RealityFlux", "CpsExposure", "TotalDarkness", "GiantScale"]
          },
          "minVerticalZone": { "type": "integer", "minimum": -3, "maximum": 4 },
          "maxVerticalZone": { "type": "integer", "minimum": -3, "maximum": 4 },
          "zones": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": { "type": "string" },
                "name": { "type": "string" },
                "conditionDcModifier": { "type": "integer" },
                "damageOverride": { "type": "string" }
              },
              "required": ["id", "name"]
            }
          },
          "flavorQuote": { "type": "string" },
          "colorPalette": { "type": "string" }
        },
        "required": ["id", "name", "subtitle", "deckNumber", "preGlitchFunction", "postGlitchState", "baseProperties", "primaryCondition", "minVerticalZone", "maxVerticalZone"]
      }
    },
    "environmentalConditions": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "type": { "type": "string" },
          "displayName": { "type": "string" },
          "checkAttribute": { "type": "string" },
          "baseDc": { "type": "integer" },
          "damageDice": { "type": "string" },
          "damageType": { "type": "string" },
          "frequency": { "type": "string" },
          "description": { "type": "string" },
          "mitigations": { "type": "array", "items": { "type": "string" } }
        },
        "required": ["type", "displayName", "checkAttribute", "baseDc", "damageDice", "damageType", "frequency", "description"]
      }
    },
    "adjacencyRules": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "realmA": { "type": "string" },
          "realmB": { "type": "string" },
          "compatibility": { "type": "string", "enum": ["Compatible", "RequiresTransition", "Incompatible"] },
          "minTransitionRooms": { "type": "integer" },
          "maxTransitionRooms": { "type": "integer" },
          "transitionTheme": { "type": "string" }
        },
        "required": ["realmA", "realmB", "compatibility"]
      }
    }
  },
  "required": ["biomes", "environmentalConditions", "adjacencyRules"]
}
```

### biomes.json (Starter Template)

```json
{
  "biomes": [
    {
      "id": "Midgard",
      "name": "Midgard",
      "subtitle": "The Tamed Ruin",
      "deckNumber": 4,
      "preGlitchFunction": "Civilian Habitation & Agricultural Production",
      "postGlitchState": "Agricultural heartland; most populous realm; foundation of post-Glitch civilization",
      "baseProperties": {
        "temperatureCelsius": 18,
        "aethericIntensity": 0.3,
        "humidityPercent": 60,
        "lightLevel": 0.7,
        "scaleFactor": 1.0,
        "corrosionRate": 0.2
      },
      "primaryCondition": "None",
      "minVerticalZone": 0,
      "maxVerticalZone": 1,
      "zones": [],
      "flavorQuote": "The Wall is the soul of the Hold.",
      "colorPalette": "green-brown-grey-amber"
    }
  ],
  "environmentalConditions": [
    {
      "type": "IntenseHeat",
      "displayName": "Intense Heat",
      "checkAttribute": "STURDINESS",
      "baseDc": 12,
      "damageDice": "2d6",
      "damageType": "Fire",
      "frequency": "Per Turn",
      "description": "The ambient temperature is dangerously high, causing heat exhaustion and burns.",
      "mitigations": ["Fire Resistance", "Cooling equipment", "Hearth shelter", "Dvergr thermal suits"]
    },
    {
      "type": "ExtremeCold",
      "displayName": "Extreme Cold",
      "checkAttribute": "STURDINESS",
      "baseDc": 12,
      "damageDice": "2d6",
      "damageType": "Cold",
      "frequency": "Per Turn",
      "description": "The ambient temperature is dangerously low, causing hypothermia and frostbite.",
      "mitigations": ["Cold Resistance", "Thermal gear", "Ice-Marrow consumption", "Hearth proximity"]
    },
    {
      "type": "ToxicAtmosphere",
      "displayName": "Toxic Atmosphere",
      "checkAttribute": "STURDINESS",
      "baseDc": 14,
      "damageDice": "2d8",
      "damageType": "Poison",
      "frequency": "Per Turn",
      "description": "The air is saturated with corrosive vapors and hallucinogenic compounds.",
      "mitigations": ["Environmental seal", "Filtration mask", "Poison Resistance", "Garm's Watch shelter"]
    }
  ],
  "adjacencyRules": [
    {
      "realmA": "Muspelheim",
      "realmB": "Niflheim",
      "compatibility": "Incompatible"
    },
    {
      "realmA": "Muspelheim",
      "realmB": "Vanaheim",
      "compatibility": "Incompatible"
    },
    {
      "realmA": "Midgard",
      "realmB": "Vanaheim",
      "compatibility": "Compatible",
      "transitionTheme": "Up-river ferries... canopy shadows deepen... golden spores drift on the wind"
    },
    {
      "realmA": "Svartalfheim",
      "realmB": "Muspelheim",
      "compatibility": "Compatible",
      "transitionTheme": "Volcanic heat fades into geothermal stability... Dvergr trade routes begin"
    },
    {
      "realmA": "Svartalfheim",
      "realmB": "Helheim",
      "compatibility": "Compatible",
      "transitionTheme": "The elevator descends... decontamination airlocks seal... Garm's Watch looms"
    }
  ]
}
```

---

## Unit Testing Requirements

### BiomeProvider Tests (~6 tests)

| Test | Description |
|------|-------------|
| `GetAllBiomes_ReturnsNineRealms` | Verifies all 9 realms are loaded |
| `GetBiome_ValidId_ReturnsBiome` | Retrieves specific biome by RealmId |
| `GetBiome_InvalidId_ReturnsNull` | Returns null for invalid realm |
| `GetZonesForRealm_ValidRealm_ReturnsZones` | Retrieves zones for a realm |
| `GetEnvironmentalCondition_ValidType_ReturnsCondition` | Retrieves condition definition |
| `LoadBiomes_InvalidJson_ThrowsValidationException` | Validates JSON schema |

### BiomeAdjacencyService Tests (~8 tests)

| Test | Description |
|------|-------------|
| `CanBiomesNeighbor_Compatible_ReturnsTrue` | Midgard + Vanaheim = true |
| `CanBiomesNeighbor_RequiresTransition_ReturnsTrue` | Midgard + Alfheim = true |
| `CanBiomesNeighbor_Incompatible_ReturnsFalse` | Muspelheim + Niflheim = false |
| `GetCompatibility_MuspelheimNiflheim_ReturnsIncompatible` | Fire/Ice incompatibility |
| `GetCompatibility_MuspelheimVanaheim_ReturnsIncompatible` | Fire/Bio incompatibility |
| `GetTransitionRoomCount_RequiresTransition_ReturnsRange` | Returns (min, max) tuple |
| `GetAdjacentRealms_Midgard_ReturnsExpectedList` | Lists all Midgard neighbors |
| `ValidateRealmConfiguration_ValidPairs_ReturnsTrue` | Validates sector layout |

### EnvironmentalConditionService Tests (~6 tests)

| Test | Description |
|------|-------------|
| `GetActiveCondition_Muspelheim_ReturnsIntenseHeat` | Returns realm's primary condition |
| `GetActiveCondition_ZoneOverride_ReturnsOverride` | Zone-specific conditions override realm |
| `CalculateEffectiveDc_BaseZone_ReturnsBaseDc` | DC 12 for standard zone |
| `CalculateEffectiveDc_ModifiedZone_AppliesModifier` | DC 12 + 4 = 16 for Forge Core |
| `ApplyEnvironmentalDamage_CheckFailed_ReturnsDamage` | Applies damage on failed check |
| `ApplyEnvironmentalDamage_HasMitigation_ReducesDamage` | Mitigation reduces effects |

**Total: ~20 tests**

---

## Acceptance Criteria

### Functional Requirements

- [ ] All 9 RealmId enum values are defined with correct deck numbers
- [ ] BiomeDefinition can store all required properties from design docs
- [ ] BiomeZone supports property overrides and DC modifiers
- [ ] EnvironmentalCondition defines all hazard types with mechanics
- [ ] IBiomeProvider loads and retrieves biome definitions
- [ ] IBiomeAdjacencyService validates adjacency rules correctly
- [ ] Fire/Ice (Muspelheim/Niflheim) adjacency returns Incompatible
- [ ] Fire/Bio (Muspelheim/Vanaheim) adjacency returns Incompatible
- [ ] JSON schema validates biome configuration files

### Quality Requirements

- [ ] All public members have XML documentation
- [ ] All enums have descriptive summaries for each value
- [ ] Configuration files validate against schema
- [ ] ~20 unit tests pass
- [ ] No placeholder data in core infrastructure

---

## Dependencies

### Required From Previous Versions

| Dependency | Source | Usage |
|------------|--------|-------|
| DamageService | v0.6.x | Environmental damage application |
| CharacterState | v0.5.x | Character health/resistance checks |

### Provides To Subsequent Versions

| Provides | Consumer |
|----------|----------|
| RealmId enum | All v0.19.x realm implementations |
| BiomeDefinition entity | Room generation, spawning |
| IBiomeProvider | Configuration loading |
| IBiomeAdjacencyService | Sector layout validation |
| IEnvironmentalConditionService | Combat hazards |

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                     v0.19.0 Core Infrastructure                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Domain Layer                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │   RealmId    │  │   Biome      │  │ Environment  │  │   │
│  │  │    Enum      │  │ Compatibility│  │  Condition   │  │   │
│  │  │  (9 realms)  │  │    Enum      │  │   Type Enum  │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │   Biome      │  │   Biome      │  │ Environment  │  │   │
│  │  │ Definition   │  │    Zone      │  │  Condition   │  │   │
│  │  │   Entity     │  │   Entity     │  │   Entity     │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐                     │   │
│  │  │   Biome      │  │  Adjacency   │                     │   │
│  │  │ Properties   │  │    Rule      │                     │   │
│  │  │ Value Object │  │ Value Object │                     │   │
│  │  └──────────────┘  └──────────────┘                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  Application Layer                       │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │   IBiome     │  │   IBiome     │  │ IEnvironment │  │   │
│  │  │  Provider    │  │  Adjacency   │  │  Condition   │  │   │
│  │  │  Interface   │  │   Service    │  │   Service    │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │         │                  │                  │         │   │
│  │         ▼                  ▼                  ▼         │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │   Biome      │  │   Biome      │  │ Environment  │  │   │
│  │  │  Provider    │  │  Adjacency   │  │  Condition   │  │   │
│  │  │    Impl      │  │ Service Impl │  │ Service Impl │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 Infrastructure Layer                     │   │
│  │  ┌──────────────┐  ┌──────────────┐                     │   │
│  │  │ biomes.json  │  │  biomes.     │                     │   │
│  │  │   Config     │  │ schema.json  │                     │   │
│  │  └──────────────┘  └──────────────┘                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Deliverable Checklist

### Domain Layer

- [ ] `RealmId` enum (9 values)
- [ ] `BiomeCompatibility` enum (3 values)
- [ ] `EnvironmentalConditionType` enum (9 values)
- [ ] `VerticalZone` enum (8 values)
- [ ] `BiomeProperties` value object
- [ ] `AdjacencyRule` value object
- [ ] `BiomeDefinition` entity
- [ ] `BiomeZone` entity
- [ ] `EnvironmentalCondition` entity

### Application Layer

- [ ] `IBiomeProvider` interface
- [ ] `IBiomeAdjacencyService` interface
- [ ] `IEnvironmentalConditionService` interface
- [ ] `BiomeProvider` implementation
- [ ] `BiomeAdjacencyService` implementation
- [ ] `EnvironmentalDamageResult` record

### Infrastructure Layer

- [ ] `biomes.schema.json`
- [ ] `biomes.json` (starter template)

### Tests

- [ ] BiomeProvider tests (~6)
- [ ] BiomeAdjacencyService tests (~8)
- [ ] EnvironmentalConditionService tests (~6)
