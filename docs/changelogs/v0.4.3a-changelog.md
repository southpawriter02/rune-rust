# v0.4.3a Changelog: Light Core

**Version:** 0.4.3a  
**Date:** 2026-01-13  
**Phase:** Light Core

---

## Summary

Established the foundational light level system with room illumination tracking and gameplay penalties for darkness. This creates the core lighting mechanics that light sources (v0.4.3b) and vision types (v0.4.3b) will build upon.

---

## Added

### Domain Layer

| File | Description |
|------|-------------|
| `Enums/LightLevel.cs` | Four-tier illumination: Bright, Dim, Dark, MagicalDarkness |
| `Constants/LightPenalties.cs` | Penalty constants + helper methods (accuracy, perception DC) |

### Room Entity Updates

| Property/Method | Description |
|-----------------|-------------|
| `BaseLightLevel` | Configured illumination (default: Dim) |
| `CurrentLightLevel` | Computed effective light (returns Base for v0.4.3a) |
| `IsOutdoor` | Placeholder for day/night cycle (v0.4.3d) |
| `HasActiveLightSources` | Placeholder for v0.4.3b (returns false) |
| `SetBaseLightLevel()` | Set room's base illumination |
| `SetIsOutdoor()` | Mark room as outdoor |
| `CalculateCurrentLightLevel()` | Compute effective light level |

### CombatService Updates

| Method | Description |
|--------|-------------|
| `GetLightPenalty(Room)` | Get accuracy penalty for room light |
| `GetLightPenalty(Room, Player)` | Placeholder for vision types (v0.4.3b) |
| `GetLightPenalty(Room, Monster)` | Placeholder for monster vision |

---

## Light Level Penalties

| Level | Accuracy | Perception DC | Notes |
|-------|----------|---------------|-------|
| Bright | 0 | +0 | No penalties |
| Dim | -1 | +2 | Minor penalties |
| Dark | -3 | +5 | Significant penalties |
| MagicalDarkness | -5 | +10 | Maximum penalties |

---

## Test Results

| Project | Passed | Added |
|---------|--------|-------|
| Domain | 1,160 | +30 |
| Application | 454 | — |
| Architecture | 8 | — |
| **Total** | ~1,622 | +30 |

### New Test Files

- `LightLevelTests.cs` (4 tests)
- `LightPenaltiesTests.cs` (12 tests)
- `RoomLightingTests.cs` (8 tests)
- `CombatServiceLightTests.cs` (6 tests)

---

## Logging Strategy

| Component | Level | Template |
|-----------|-------|----------|
| CombatService | Debug | `"Light penalty of {Penalty} for {LightLevel} conditions in room {Room}"` |

---

## Next Steps

v0.4.3b will add:
- Light source items (torches, lanterns)
- Vision types (Normal, DarkVision, TrueSight)
- Light commands (`light`, `extinguish`, `refuel`)
