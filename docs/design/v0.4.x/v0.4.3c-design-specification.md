# v0.4.3c Design Specification: Skills Foundation

**Version:** 0.4.3c
**Phase Name:** Skills Foundation
**Parent Version:** v0.4.3 (Light & Environment Systems)
**Prerequisites:** v0.4.3b Complete (Light Sources & Vision)
**Estimated Tests:** ~25 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [SkillProficiency Enum](#4-skillproficiency-enum)
5. [SkillDefinition](#5-skilldefinition)
6. [PlayerSkill Entity](#6-playerskill-entity)
7. [Player Modifications](#7-player-modifications)
8. [SkillService](#8-skillservice)
9. [User-Facing Commands](#9-user-facing-commands)
10. [Data Model Changes](#10-data-model-changes)
11. [Configuration File Schemas](#11-configuration-file-schemas)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification establishes the player skills system with skill definitions, proficiency tracking, and progression mechanics. v0.4.3c creates the foundation for skill-based gameplay that specific skill implementations (v0.4.3d) will build upon.

Skills represent trainable player abilities that improve with use. Each skill has proficiency levels that grant bonuses to related checks, and players gain experience through successful and failed skill usage.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Domain Entities** | `PlayerSkill` |
| **Domain Enums** | `SkillProficiency` |
| **Domain Definitions** | `SkillDefinition` |
| **Player Updates** | `Skills` collection, skill accessor methods |
| **Application Services** | `SkillService`, `ISkillService` |
| **Result Types** | `SkillCheckResult`, `SkillExperienceResult`, `PlayerSkillInfo` |
| **Commands** | `skills` |
| **Configuration** | `skills.json` |
| **Tests** | ~25 unit tests |

### 1.3 Architectural Significance

This version establishes the **Skill System Pattern**:

- **Six-Tier Proficiency**: Untrained → Novice → Apprentice → Journeyman → Expert → Master
- **Experience-Based Progression**: Skills improve through usage with configurable thresholds
- **Attribute Association**: Each skill links to a primary attribute for bonus calculations
- **Category Organization**: Skills grouped by Physical, Mental, Technical, Social
- **Configurable Restrictions**: Some skills require training before use

---

## 2. Feature Overview

```
v0.4.3c Skills Foundation
├── SkillProficiency Enum
│   ├── Untrained (0)
│   ├── Novice (1)
│   ├── Apprentice (2)
│   ├── Journeyman (3)
│   ├── Expert (4)
│   └── Master (5)
├── SkillDefinition
│   ├── Id, Name, Description
│   ├── PrimaryAttribute
│   ├── Category
│   ├── AllowUntrained
│   ├── BonusPerLevel
│   ├── ExperienceThresholds
│   ├── GetProficiencyBonus()
│   └── GetProficiencyForExperience()
├── PlayerSkill Entity
│   ├── SkillId, PlayerId
│   ├── Proficiency
│   ├── Experience
│   ├── TimesUsed, SuccessfulChecks
│   ├── AddExperience()
│   ├── RecordUsage()
│   └── SetProficiency()
├── Player Modifications
│   ├── _skills collection
│   ├── Skills property
│   ├── GetSkill()
│   ├── AddSkill()
│   ├── HasSkill()
│   └── GetSkillProficiency()
├── SkillService
│   ├── PerformSkillCheck()
│   ├── GetSkillBonus()
│   ├── AwardSkillExperience()
│   ├── GetPlayerSkills()
│   ├── GetAllSkillDefinitions()
│   └── InitializePlayerSkills()
└── Commands
    └── skills [skill]
```

### 2.1 Scope Alignment

**In Scope:**
- `SkillProficiency` enum (Untrained through Master)
- `SkillDefinition` for skill configuration
- `PlayerSkill` entity for tracking player progress
- `Player.Skills` collection
- `SkillService` and `ISkillService`
- Skill check integration with DiceService
- Experience-based progression
- `skills` command for viewing skills
- Skill-based DC modifiers

**Out of Scope:**
- Specific skill implementations (Perception, Stealth, etc.) (v0.4.3d)
- Day/night cycle (v0.4.3d)
- Weather effects (v0.4.3d)

---

## 3. Architecture Diagrams

### 3.1 Skill Check Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                         SKILL CHECK FLOW                             │
└─────────────────────────────────────────────────────────────────────┘

    Player              SkillService           DiceService         PlayerSkill
       │                     │                      │                   │
       │  Skill Action       │                      │                   │
       ├────────────────────▶│                      │                   │
       │                     │                      │                   │
       │                     │  Get PlayerSkill     │                   │
       │                     ├──────────────────────┼──────────────────▶│
       │                     │                      │                   │
       │                     │  ◀── Proficiency, Experience ───────────│
       │                     │                      │                   │
       │                     │  Calculate Bonus     │                   │
       │                     │  (Proficiency × BonusPerLevel)           │
       │                     │                      │                   │
       │                     │  Roll(2d6)           │                   │
       │                     ├─────────────────────▶│                   │
       │                     │                      │                   │
       │                     │  ◀── Roll Result ────│                   │
       │                     │                      │                   │
       │                     │  Total = Roll + Bonus│                   │
       │                     │  Success = Total ≥ DC│                   │
       │                     │                      │                   │
       │                     │  RecordUsage()       │                   │
       │                     ├──────────────────────┼──────────────────▶│
       │                     │                      │                   │
       │                     │  AddExperience()     │                   │
       │                     ├──────────────────────┼──────────────────▶│
       │                     │                      │                   │
       │  ◀── SkillCheckResult                     │                   │
       ▼                     ▼                      ▼                   ▼
```

### 3.2 Experience and Progression

```
┌─────────────────────────────────────────────────────────────────────┐
│                    EXPERIENCE PROGRESSION                            │
└─────────────────────────────────────────────────────────────────────┘

    Experience:  0        50       150       350       700
                 │         │         │         │         │
    Proficiency: │Untrained│ Novice  │Apprentice│Journeyman│Expert   │Master
                 ├─────────┼─────────┼─────────┼─────────┼─────────┤
    Bonus:       │   0     │   +1    │   +2    │   +3    │   +4    │  +5
                 └─────────┴─────────┴─────────┴─────────┴─────────┘

    Level Up Flow:
    ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
    │ Add Exp     │────▶│ Check       │────▶│ Update      │
    │             │     │ Threshold   │     │ Proficiency │
    └─────────────┘     └──────┬──────┘     └──────┬──────┘
                               │                   │
                               │ [Threshold Met]   │
                               └───────────────────┘
                               │
                               ▼
                        ┌─────────────┐
                        │ Notify      │
                        │ Level Up    │
                        └─────────────┘
```

### 3.3 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  SkillsCommand                                                       │
│  "skills [skill]"                                                    │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ISkillService / SkillService                                        │
│  ├── PerformSkillCheck(player, skillId, dc): SkillCheckResult       │
│  ├── GetSkillBonus(player, skillId): int                            │
│  ├── AwardSkillExperience(player, skillId, amount): SkillExpResult  │
│  ├── GetPlayerSkills(player): IEnumerable<PlayerSkillInfo>          │
│  ├── GetAllSkillDefinitions(): IEnumerable<SkillDefinition>         │
│  └── InitializePlayerSkills(player): void                           │
├─────────────────────────────────────────────────────────────────────┤
│  Result Types                                                        │
│  ├── SkillCheckResult { SkillId, Success, Roll, Bonus, DC, Margin } │
│  ├── SkillExperienceResult { SkillId, ExpGained, LeveledUp, Prof }  │
│  └── PlayerSkillInfo { SkillId, Name, Prof, Exp, Bonus, Stats }     │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌────────────────────────────────────────┐  │
│  │ SkillProficiency │  │           SkillDefinition              │  │
│  │      (Enum)      │  │          (Definition)                  │  │
│  ├──────────────────┤  ├────────────────────────────────────────┤  │
│  │ Untrained = 0    │  │ Id, Name, Description                  │  │
│  │ Novice = 1       │  │ PrimaryAttribute, Category             │  │
│  │ Apprentice = 2   │  │ AllowUntrained, BonusPerLevel          │  │
│  │ Journeyman = 3   │  │ ExperienceThresholds                   │  │
│  │ Expert = 4       │  │ GetProficiencyBonus(prof): int         │  │
│  │ Master = 5       │  │ GetProficiencyForExperience(exp): Prof │  │
│  └──────────────────┘  └────────────────────────────────────────┘  │
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │                        PlayerSkill                              ││
│  │                         (Entity)                                ││
│  ├─────────────────────────────────────────────────────────────────┤│
│  │  + Id: Guid                                                     ││
│  │  + SkillId: string                                              ││
│  │  + PlayerId: Guid                                               ││
│  │  + Proficiency: SkillProficiency                                ││
│  │  + Experience: int                                              ││
│  │  + TimesUsed: int                                               ││
│  │  + SuccessfulChecks: int                                        ││
│  │                                                                 ││
│  │  + AddExperience(amount, definition): bool                      ││
│  │  + RecordUsage(success): void                                   ││
│  │  + GetSuccessRate(): int                                        ││
│  │  + SetProficiency(proficiency, definition): void                ││
│  └─────────────────────────────────────────────────────────────────┘│
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │ Player (Modified)                                               ││
│  ├─────────────────────────────────────────────────────────────────┤│
│  │ - _skills: Dictionary<string, PlayerSkill>                      ││
│  │ + Skills: IReadOnlyDictionary<string, PlayerSkill>              ││
│  │ + GetSkill(skillId): PlayerSkill?                               ││
│  │ + AddSkill(skill): void                                         ││
│  │ + HasSkill(skillId): bool                                       ││
│  │ + GetSkillProficiency(skillId): SkillProficiency                ││
│  └─────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. SkillProficiency Enum

### 4.1 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/SkillProficiency.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Proficiency levels for player skills.
/// </summary>
public enum SkillProficiency
{
    /// <summary>No training - may not be able to attempt skill checks.</summary>
    Untrained = 0,

    /// <summary>Basic training - can attempt simple checks.</summary>
    Novice = 1,

    /// <summary>Developing skill - moderate bonus.</summary>
    Apprentice = 2,

    /// <summary>Competent practitioner - good bonus.</summary>
    Journeyman = 3,

    /// <summary>Highly skilled - excellent bonus.</summary>
    Expert = 4,

    /// <summary>Mastery achieved - maximum bonus.</summary>
    Master = 5
}
```

### 4.2 Proficiency Table

| Level | Enum Value | Default Bonus | Exp Threshold | Display |
|-------|------------|---------------|---------------|---------|
| Untrained | 0 | +0 | — | ░░░░░░░░░░ |
| Novice | 1 | +1 | 0 | ██░░░░░░░░ |
| Apprentice | 2 | +2 | 50 | ████░░░░░░ |
| Journeyman | 3 | +3 | 150 | ██████░░░░ |
| Expert | 4 | +4 | 350 | ████████░░ |
| Master | 5 | +5 | 700 | ██████████ |

---

## 5. SkillDefinition

### 5.1 Implementation

**File:** `src/Core/RuneAndRust.Domain/Definitions/SkillDefinition.cs`

```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Configuration for a trainable player skill.
/// </summary>
public class SkillDefinition
{
    public string Id { get; private set; } = string.Empty;
    public string Name { get; private set; } = string.Empty;
    public string Description { get; private set; } = string.Empty;
    public string PrimaryAttribute { get; private set; } = string.Empty;
    public string Category { get; private set; } = string.Empty;
    public bool AllowUntrained { get; private set; }
    public int BonusPerLevel { get; private set; } = 1;
    public IReadOnlyDictionary<SkillProficiency, int> ExperienceThresholds { get; private set; }
        = new Dictionary<SkillProficiency, int>();

    private SkillDefinition() { }

    public static SkillDefinition Create(
        string id, string name, string description,
        string primaryAttribute, string category,
        bool allowUntrained = true, int bonusPerLevel = 1,
        IDictionary<SkillProficiency, int>? expThresholds = null)
    {
        return new SkillDefinition
        {
            Id = id,
            Name = name,
            Description = description,
            PrimaryAttribute = primaryAttribute,
            Category = category,
            AllowUntrained = allowUntrained,
            BonusPerLevel = bonusPerLevel,
            ExperienceThresholds = expThresholds?.ToDictionary(k => k.Key, k => k.Value)
                ?? GetDefaultThresholds()
        };
    }

    private static Dictionary<SkillProficiency, int> GetDefaultThresholds() => new()
    {
        { SkillProficiency.Novice, 0 },
        { SkillProficiency.Apprentice, 50 },
        { SkillProficiency.Journeyman, 150 },
        { SkillProficiency.Expert, 350 },
        { SkillProficiency.Master, 700 }
    };

    public int GetProficiencyBonus(SkillProficiency proficiency) =>
        (int)proficiency * BonusPerLevel;

    public SkillProficiency GetProficiencyForExperience(int experience)
    {
        var result = SkillProficiency.Untrained;
        foreach (var kvp in ExperienceThresholds.OrderBy(k => k.Value))
        {
            if (experience >= kvp.Value)
                result = kvp.Key;
            else
                break;
        }
        return result;
    }
}
```

---

## 6. PlayerSkill Entity

### 6.1 Implementation

**File:** `src/Core/RuneAndRust.Domain/Entities/PlayerSkill.cs`

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a player's proficiency in a specific skill.
/// </summary>
public class PlayerSkill : IEntity
{
    public Guid Id { get; private set; }
    public string SkillId { get; private set; } = string.Empty;
    public Guid PlayerId { get; private set; }
    public SkillProficiency Proficiency { get; private set; } = SkillProficiency.Untrained;
    public int Experience { get; private set; }
    public int TimesUsed { get; private set; }
    public int SuccessfulChecks { get; private set; }

    private PlayerSkill() { }

    public static PlayerSkill Create(
        string skillId, Guid playerId,
        SkillProficiency startingProficiency = SkillProficiency.Untrained,
        int startingExp = 0)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(skillId);
        return new PlayerSkill
        {
            Id = Guid.NewGuid(),
            SkillId = skillId,
            PlayerId = playerId,
            Proficiency = startingProficiency,
            Experience = startingExp
        };
    }

    public bool AddExperience(int amount, SkillDefinition definition)
    {
        if (amount <= 0) return false;
        var oldProficiency = Proficiency;
        Experience += amount;
        Proficiency = definition.GetProficiencyForExperience(Experience);
        return Proficiency > oldProficiency;
    }

    public void RecordUsage(bool success)
    {
        TimesUsed++;
        if (success) SuccessfulChecks++;
    }

    public int GetSuccessRate() =>
        TimesUsed == 0 ? 0 : (int)((SuccessfulChecks / (float)TimesUsed) * 100);

    public void SetProficiency(SkillProficiency proficiency, SkillDefinition definition)
    {
        Proficiency = proficiency;
        if (definition.ExperienceThresholds.TryGetValue(proficiency, out var exp))
            Experience = Math.Max(Experience, exp);
    }
}
```

---

## 7. Player Modifications

**File:** `src/Core/RuneAndRust.Domain/Entities/Player.cs`

```csharp
// Add to Player entity:

#region Skills

private readonly Dictionary<string, PlayerSkill> _skills = new();

public IReadOnlyDictionary<string, PlayerSkill> Skills => _skills;

public PlayerSkill? GetSkill(string skillId)
{
    return _skills.TryGetValue(skillId, out var skill) ? skill : null;
}

public void AddSkill(PlayerSkill skill)
{
    ArgumentNullException.ThrowIfNull(skill);
    _skills[skill.SkillId] = skill;
}

public bool HasSkill(string skillId) => _skills.ContainsKey(skillId);

public SkillProficiency GetSkillProficiency(string skillId)
{
    return _skills.TryGetValue(skillId, out var skill)
        ? skill.Proficiency
        : SkillProficiency.Untrained;
}

#endregion
```

---

## 8. SkillService

### 8.1 Interface

**File:** `src/Core/RuneAndRust.Application/Interfaces/ISkillService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

public interface ISkillService
{
    SkillCheckResult PerformSkillCheck(Player player, string skillId, int dc);
    int GetSkillBonus(Player player, string skillId);
    SkillExperienceResult AwardSkillExperience(Player player, string skillId, int amount);
    IEnumerable<PlayerSkillInfo> GetPlayerSkills(Player player);
    IEnumerable<SkillDefinition> GetAllSkillDefinitions();
    void InitializePlayerSkills(Player player);
}

public readonly record struct SkillCheckResult(
    string SkillId, bool Success, int Roll, int SkillBonus,
    int Total, int DC, int Margin, string Message);

public readonly record struct SkillExperienceResult(
    string SkillId, int ExperienceGained, int TotalExperience,
    bool LeveledUp, SkillProficiency NewProficiency, string Message);

public readonly record struct PlayerSkillInfo(
    string SkillId, string Name, SkillProficiency Proficiency,
    int Experience, int ExperienceToNext, int Bonus,
    int TimesUsed, int SuccessRate);
```

### 8.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Services/SkillService.cs`

```csharp
namespace RuneAndRust.Application.Services;

public class SkillService : ISkillService
{
    private readonly IGameConfigurationProvider _config;
    private readonly IDiceService _diceService;
    private readonly ILogger<SkillService> _logger;

    public SkillService(
        IGameConfigurationProvider config,
        IDiceService diceService,
        ILogger<SkillService> logger)
    {
        _config = config;
        _diceService = diceService;
        _logger = logger;
    }

    public SkillCheckResult PerformSkillCheck(Player player, string skillId, int dc)
    {
        var definition = _config.GetSkillDefinition(skillId);
        if (definition == null)
            return new SkillCheckResult(skillId, false, 0, 0, 0, dc, -dc, "Unknown skill.");

        var playerSkill = player.GetSkill(skillId);
        
        // Check if untrained use is allowed
        if (playerSkill == null || playerSkill.Proficiency == SkillProficiency.Untrained)
        {
            if (!definition.AllowUntrained)
                return new SkillCheckResult(skillId, false, 0, 0, 0, dc, -dc,
                    $"You need training in {definition.Name} to attempt this.");
        }

        var bonus = GetSkillBonus(player, skillId);
        var roll = _diceService.Roll("2d6").Total;
        var total = roll + bonus;
        var success = total >= dc;
        var margin = total - dc;

        // Record usage
        playerSkill?.RecordUsage(success);

        _logger.LogInformation(
            "Skill check: {Skill} - Roll {Roll} + {Bonus} = {Total} vs DC {DC} = {Result}",
            skillId, roll, bonus, total, dc, success ? "Success" : "Failure");

        var message = success
            ? $"Success! ({total} vs DC {dc})"
            : $"Failed. ({total} vs DC {dc})";

        return new SkillCheckResult(skillId, success, roll, bonus, total, dc, margin, message);
    }

    public int GetSkillBonus(Player player, string skillId)
    {
        var definition = _config.GetSkillDefinition(skillId);
        if (definition == null) return 0;

        var playerSkill = player.GetSkill(skillId);
        if (playerSkill == null) return 0;

        return definition.GetProficiencyBonus(playerSkill.Proficiency);
    }

    public SkillExperienceResult AwardSkillExperience(Player player, string skillId, int amount)
    {
        var definition = _config.GetSkillDefinition(skillId);
        if (definition == null)
            return new SkillExperienceResult(skillId, 0, 0, false,
                SkillProficiency.Untrained, "Unknown skill.");

        var playerSkill = player.GetSkill(skillId);
        if (playerSkill == null)
        {
            playerSkill = PlayerSkill.Create(skillId, player.Id);
            player.AddSkill(playerSkill);
        }

        var leveledUp = playerSkill.AddExperience(amount, definition);

        _logger.LogInformation(
            "Skill experience: {Skill} +{Exp} (Total: {Total}, Level: {Level})",
            skillId, amount, playerSkill.Experience, playerSkill.Proficiency);

        var message = leveledUp
            ? $"{definition.Name} improved to {playerSkill.Proficiency}!"
            : $"+{amount} {definition.Name} experience";

        return new SkillExperienceResult(
            skillId, amount, playerSkill.Experience,
            leveledUp, playerSkill.Proficiency, message);
    }

    public IEnumerable<PlayerSkillInfo> GetPlayerSkills(Player player)
    {
        foreach (var definition in _config.GetAllSkillDefinitions())
        {
            var playerSkill = player.GetSkill(definition.Id);
            var proficiency = playerSkill?.Proficiency ?? SkillProficiency.Untrained;
            var experience = playerSkill?.Experience ?? 0;
            var bonus = definition.GetProficiencyBonus(proficiency);

            var expToNext = GetExperienceToNextLevel(definition, experience);

            yield return new PlayerSkillInfo(
                definition.Id, definition.Name, proficiency,
                experience, expToNext, bonus,
                playerSkill?.TimesUsed ?? 0,
                playerSkill?.GetSuccessRate() ?? 0);
        }
    }

    public IEnumerable<SkillDefinition> GetAllSkillDefinitions() =>
        _config.GetAllSkillDefinitions();

    public void InitializePlayerSkills(Player player)
    {
        foreach (var definition in _config.GetAllSkillDefinitions())
        {
            if (!player.HasSkill(definition.Id))
            {
                var skill = PlayerSkill.Create(definition.Id, player.Id,
                    SkillProficiency.Untrained, 0);
                player.AddSkill(skill);
            }
        }
    }

    private int GetExperienceToNextLevel(SkillDefinition definition, int currentExp)
    {
        var thresholds = definition.ExperienceThresholds.Values.OrderBy(v => v).ToList();
        foreach (var threshold in thresholds)
        {
            if (currentExp < threshold)
                return threshold - currentExp;
        }
        return 0; // Already at max
    }
}
```

---

## 9. User-Facing Commands

### 9.1 Skills List

```
> skills

Your Skills
===========

PHYSICAL
  Acrobatics      [Novice]     ████░░░░░░ +1    (32/50 to Apprentice)
  Stealth         [Apprentice] ██████░░░░ +2    (89/150 to Journeyman)

MENTAL
  Perception      [Journeyman] ████████░░ +3    (245/350 to Expert)
  Field Medicine  [Novice]     ██░░░░░░░░ +1    (15/50 to Apprentice)

TECHNICAL
  Lockpicking     [Untrained]  ░░░░░░░░░░ --    (Cannot use)

SOCIAL
  Rhetoric        [Novice]     ███░░░░░░░ +1    (28/50 to Apprentice)
```

### 9.2 Skill Detail

```
> skills perception

Perception                           [Journeyman]
===============================================
The ability to notice details, spot hidden objects,
and detect traps and ambushes.

Primary Attribute: Wits
Category: Mental

Proficiency: ★★★☆☆ Journeyman (+3 bonus)
Experience: 245 / 350 (70% to Expert)

Statistics:
  Times Used: 47
  Successful: 31 (66% success rate)

Progression:
  Untrained  →  Novice     (0 exp)
  Novice     →  Apprentice (50 exp)    ✓
  Apprentice →  Journeyman (150 exp)   ✓
  Journeyman →  Expert     (350 exp)
  Expert     →  Master     (700 exp)
```

### 9.3 Skill Check Display

```
> search

You carefully examine the room...

[Skill Check: Perception]
Roll: 2d6 = [4, 5] = 9
Skill Bonus: +3 (Journeyman)
Total: 12 vs DC 14

You don't notice anything unusual.
[+5 Perception experience]
```

### 9.4 Level Up Display

```
=== SKILL IMPROVED ===

Your Perception skill has improved!
Journeyman → Expert

[Perception bonus: +3 → +4]

Your keen senses are now finely honed.
```

---

## 10. Data Model Changes

| Type | Layer | Description |
|------|-------|-------------|
| `SkillProficiency` | Domain/Enums | Six-tier proficiency levels |
| `SkillDefinition` | Domain/Definitions | Skill configuration |
| `PlayerSkill` | Domain/Entities | Player skill tracking |
| `Player` | Domain/Entities | Add Skills collection |
| `ISkillService` | Application/Interfaces | Skill service interface |
| `SkillService` | Application/Services | Skill service implementation |

---

## 11. Configuration File Schemas

**File:** `config/skills.json`

```json
{
  "$schema": "./schemas/skills.schema.json",
  "skills": [
    {
      "id": "perception",
      "name": "Perception",
      "description": "The ability to notice details, spot hidden objects, and detect traps.",
      "primaryAttribute": "Wits",
      "category": "Mental",
      "allowUntrained": true,
      "bonusPerLevel": 1,
      "experienceThresholds": {
        "Novice": 0, "Apprentice": 50, "Journeyman": 150, "Expert": 350, "Master": 700
      }
    },
    {
      "id": "stealth",
      "name": "Stealth",
      "description": "Moving silently, hiding in shadows, and avoiding detection.",
      "primaryAttribute": "Finesse",
      "category": "Physical",
      "allowUntrained": true,
      "bonusPerLevel": 1
    },
    {
      "id": "lockpicking",
      "name": "Lockpicking",
      "description": "Opening locks without the proper key using picks and skill.",
      "primaryAttribute": "Finesse",
      "category": "Technical",
      "allowUntrained": false,
      "bonusPerLevel": 1
    },
    {
      "id": "acrobatics",
      "name": "Acrobatics",
      "description": "Jumping, climbing, balancing, and tumbling.",
      "primaryAttribute": "Finesse",
      "category": "Physical",
      "allowUntrained": true,
      "bonusPerLevel": 1
    },
    {
      "id": "field-medicine",
      "name": "Field Medicine",
      "description": "Treating wounds, curing ailments, and stabilizing the injured.",
      "primaryAttribute": "Wits",
      "category": "Mental",
      "allowUntrained": true,
      "bonusPerLevel": 1
    },
    {
      "id": "rhetoric",
      "name": "Rhetoric",
      "description": "Persuasion, intimidation, and social manipulation.",
      "primaryAttribute": "Charisma",
      "category": "Social",
      "allowUntrained": true,
      "bonusPerLevel": 1
    },
    {
      "id": "wilderness-survival",
      "name": "Wilderness Survival",
      "description": "Foraging, tracking, and navigating wild terrain.",
      "primaryAttribute": "Wits",
      "category": "Physical",
      "allowUntrained": true,
      "bonusPerLevel": 1
    }
  ]
}
```

---

## 12. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `SkillService` | Information | Skill checks, experience awards, level ups |
| `SkillService` | Debug | Bonus calculations, threshold checks |

---

## 13. Unit Testing Requirements

| Feature | Test Count |
|---------|------------|
| SkillProficiency Enum | ~2 |
| SkillDefinition | ~5 |
| PlayerSkill Entity | ~8 |
| Player Skills Collection | ~4 |
| SkillService | ~6 |
| **Total** | **~25** |

---

## 14. Use Cases

### UC-001: Perform Skill Check
**Actor:** Player
**Flow:** Action requires skill → Get bonus → Roll dice → Compare to DC → Record result → Award experience

### UC-002: Gain Experience
**Actor:** System
**Flow:** Skill used → Award exp → Check threshold → Update proficiency if leveled

### UC-003: View Skills
**Actor:** Player
**Flow:** `skills` command → Get all skills → Display grouped by category

### UC-004: Untrained Skill Blocked
**Actor:** Player
**Flow:** Attempt Lockpicking untrained → AllowUntrained=false → Reject with message

### UC-005: Level Up Notification
**Actor:** System
**Flow:** Experience crosses threshold → Update proficiency → Display level up message

---

## 15. Deliverable Checklist

### Domain Layer
- [ ] `SkillProficiency` enum
- [ ] `SkillDefinition` class
- [ ] `PlayerSkill` entity
- [ ] Player Skills collection

### Application Layer
- [ ] `ISkillService` interface
- [ ] `SkillService` implementation
- [ ] Result types

### Presentation Layer
- [ ] `skills` command
- [ ] Skill check display
- [ ] Level up display

### Configuration
- [ ] `skills.json`
- [ ] `skills.schema.json`

### Testing
- [ ] ~25 unit tests
- [ ] All tests passing

---

## 16. Acceptance Criteria

### Functional
- [ ] SkillDefinition configures all skill properties
- [ ] PlayerSkill tracks proficiency and experience
- [ ] SkillProficiency enum has all six levels
- [ ] Player.Skills collection works correctly
- [ ] SkillService performs skill checks with bonuses
- [ ] Skill experience awards on usage
- [ ] Proficiency increases at thresholds
- [ ] Untrained skills cannot be used if configured (AllowUntrained=false)
- [ ] `skills` command displays all skills grouped by category
- [ ] Skill detail view shows progression
- [ ] Level up notification displays

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] ~25 unit tests pass
- [ ] Configuration validates against schema
- [ ] XML documentation complete

---

## 17. Dependencies

### Required from v0.4.3b

| Type | Location | Usage |
|------|----------|-------|
| `LightLevel` | `Domain/Enums` | Light affects perception checks |
| `LightService` | `Application/Services` | Get effective light for skill modifiers |

### Provides to v0.4.3d
- Skill system for specific skill integrations (Perception, Stealth, etc.)
- Skill bonus calculations for service integration

---

## 18. Future Considerations

### Deferred to v0.4.3d
- Perception skill integration with trap detection
- Stealth skill integration with monster detection
- Lockpicking skill integration with locks
- Acrobatics, Field Medicine, Rhetoric implementations
- Day/night cycle for outdoor areas
- Weather effects

### Out of Scope for v0.4.3
- Training from NPCs
- Skill specializations
- Class-based skill bonuses

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: AI Assistant*
