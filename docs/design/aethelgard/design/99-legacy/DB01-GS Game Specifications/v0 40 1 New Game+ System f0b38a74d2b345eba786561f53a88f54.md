# v0.40.1: New Game+ System

Type: Feature
Description: Implement difficulty scaling and progression carryover for 5 New Game+ tiers. Delivers NG+ tier system with +50% difficulty scaling per tier, progression carryover logic (level, abilities, equipment), world state reset system, and integration with save/load.
Priority: Must-Have
Status: In Design
Target Version: Alpha
Dependencies: v0.1-v0.29 (Complete), v0.23 (Boss Encounters), v0.15 (Trauma Economy)
Implementation Difficulty: Hard
Balance Validated: No
Parent item: v0.40: Endgame Content & Replayability (v0%2040%20Endgame%20Content%20&%20Replayability%208ad34f4aa15d45478cce6aea9fda6624.md)
Proof-of-Concept Flag: No
Template Validated: No
Voice Validated: No

**Status:** Design Phase

**Prerequisites:** v0.1-v0.29 (Complete), v0.23 (Boss Encounters), v0.15 (Trauma Economy)

**Timeline:** 8-12 hours (1-2 weeks part-time)

**Goal:** Implement difficulty scaling and progression carryover for 5 New Game+ tiers

**Philosophy:** Reward mastery with escalating challenge while respecting player investment

---

## I. Executive Summary

v0.40.1 implements the **New Game+ system**, allowing players to replay the campaign with escalating difficulty tiers (NG+1 through NG+5) while carrying over character progression. This creates a bridge between first-time completion and extreme endgame challenges.

**What v0.40.1 Delivers:**

- 5 New Game+ tiers with +50% difficulty scaling per tier
- Progression carryover logic (level, abilities, equipment)
- World state reset system
- NG+ unlock requirements and gating
- Difficulty scaling formulas for enemies, bosses, and corruption
- Integration with save/load system

**Success Metric:**

Players can complete NG+1 with their campaign-winning character, feeling powerful but challenged. NG+5 completion represents mastery of game systems.

---

## II. Design Philosophy

### A. Respect Player Investment

**Principle:** New Game+ honors the 20-40 hours players invested mastering the game.

**Design Rationale:**

Many endgame systems punish success by stripping progression (Souls-like pattern) or invalidating builds (gear reset pattern). v0.40.1 takes the opposite approach: **your mastered character IS the tool for tackling harder content**.

**What Carries Over:**

- ✅ Character level and Legend accumulation
- ✅ All spent and unspent Progression Points
- ✅ Unlocked specializations and abilities
- ✅ Equipment inventory (weapons, armor, accessories)
- ✅ Crafting materials and consumables
- ✅ Currency (Scrap)
- ✅ Unlocked crafting recipes

**What Resets:**

- ❌ Quest progression (narrative resets)
- ❌ World state (sectors regenerate)
- ❌ Quest-specific items (removed)
- ❌ Active Traumas (fresh psychological slate)
- ❌ Corruption (reset to 0)
- ❌ Temporary buffs

**Why This Works:**

- Players feel the power fantasy of wielding optimized builds
- Challenge comes from enhanced enemies, not nerfed player
- Progression investment pays dividends across multiple runs
- Fair difficulty: You have the tools to overcome challenges

### B. Smooth Difficulty Curve

**Principle:** Each NG+ tier represents a meaningful but achievable step up.

**Scaling Formula:**

```
Difficulty Multiplier = 1.0 + (Tier × 0.5)

NG+0 (Normal): 1.0x (baseline)
NG+1: 1.5x enemy HP/damage
NG+2: 2.0x enemy HP/damage
NG+3: 2.5x enemy HP/damage
NG+4: 3.0x enemy HP/damage
NG+5: 3.5x enemy HP/damage (maximum)
```

**Why Linear Scaling:**

- Exponential scaling creates brick walls (NG+4 would be 16x)
- Linear scaling stays challenging but achievable
- +50% per tier feels significant without being punishing
- NG+5 at 3.5x is extreme but fair with optimized builds

**Additional Scaling:**

- Enemy levels: +2 per tier
- Boss phase triggers: -10% HP threshold per tier
- Corruption rate: +25% per tier
- Legend rewards: +15% per tier (offset difficulty increase)

### C. Clear Progression Gates

**Principle:** Each NG+ tier must be earned by completing the previous tier.

**Unlock Requirements:**

```jsx
NG+1: Complete campaign on Normal (defeat final boss)
NG+2: Complete campaign on NG+1
NG+3: Complete campaign on NG+2
NG+4: Complete campaign on NG+3
NG+5: Complete campaign on NG+4

No Skipping: Cannot jump from Normal to NG+3
No Downgrades: Cannot return to lower tiers once higher unlocked
```

**Why Gated Progression:**

- Ensures players experience difficulty curve gradually
- Prevents undergeared characters from hitting impossible walls
- Creates sense of accomplishment at each tier
- Respects that NG+5 should feel like an achievement

### D. Psychological Fresh Start

**Principle:** Trauma Economy resets provide psychological clean slate.

**Design Rationale:**

The Trauma Economy (Psychic Stress, Breaking Points, Traumas) represents mental deterioration. Carrying accumulated Traumas into NG+ would start players in a broken state—thematically inconsistent and mechanically punishing.

**Reset on NG+ Initialization:**

- Psychic Stress reset to 0
- All active Traumas removed
- Corruption reset to 0
- Breaking Point history cleared

**Why This Works:**

- Fresh start for mental state mirrors narrative reset
- Allows players to experience full Trauma progression curve again
- Prevents compounding psychological penalties
- Maintains Trauma Economy as core challenge, not inherited burden

**Corruption Scaling:**

While Corruption resets, accumulation rate increases:

```
NG+1: +25% corruption gain
NG+2: +50% corruption gain
NG+3: +75% corruption gain
NG+4: +100% corruption gain
NG+5: +125% corruption gain
```

This makes Corruption threshold (100) reached faster, challenging players to manage mental state more carefully.

### E. Finite, Completable Goal

**Principle:** New Game+ has a clear endpoint—it's not an infinite treadmill.

**Design Decision:**

NG+5 is the **maximum difficulty tier**. There is no NG+6, no NG+10, no infinite scaling.

**Why 5 Tiers:**

- Provides 5-6 full campaign playthroughs worth of content
- NG+5 at 3.5x difficulty is extreme but beatable
- Clear "I beat the game on max difficulty" achievement
- Respects player time—completion is possible

**After NG+5:**

Players can:

- Tackle Challenge Sectors (v0.40.2)
- Attempt Boss Gauntlet (v0.40.3)
- Compete in Endless Mode (v0.40.4)
- Start new character with different build

But they're not forced into NG+6, NG+7, etc. infinitely.

---

## III. Database Schema

### Table Modifications

```sql
-- =====================================================
-- ALTER EXISTING CHARACTERS TABLE
-- =====================================================

ALTER TABLE Characters ADD COLUMN current_ng_plus_tier INTEGER DEFAULT 0;
ALTER TABLE Characters ADD COLUMN highest_ng_plus_tier INTEGER DEFAULT 0;
ALTER TABLE Characters ADD COLUMN has_completed_campaign BOOLEAN DEFAULT 0;
ALTER TABLE Characters ADD COLUMN ng_plus_completions INTEGER DEFAULT 0;

CREATE INDEX idx_characters_ng_tier ON Characters(current_ng_plus_tier);
CREATE INDEX idx_characters_campaign_complete ON Characters(has_completed_campaign);

COMMENT ON COLUMN Characters.current_ng_plus_tier IS 'Active NG+ tier (0-5), 0 = first playthrough';
COMMENT ON COLUMN Characters.highest_ng_plus_tier IS 'Highest tier ever completed (0-5)';
COMMENT ON COLUMN Characters.has_completed_campaign IS 'Has defeated final boss at least once';
COMMENT ON COLUMN [Characters.ng](http://Characters.ng)_plus_completions IS 'Total number of NG+ runs completed';

-- =====================================================
-- NEW: NG+ CARRYOVER SNAPSHOTS TABLE
-- =====================================================

CREATE TABLE NG_Plus_Carryover (
    carryover_id INTEGER PRIMARY KEY AUTOINCREMENT,
    character_id INTEGER NOT NULL,
    ng_plus_tier INTEGER NOT NULL,
    snapshot_timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    
    -- Carryover data (JSON)
    character_data TEXT NOT NULL, -- Level, Legend, PP, attributes
    specialization_data TEXT, -- Unlocked specs, abilities
    equipment_data TEXT, -- Inventory snapshot
    crafting_data TEXT, -- Materials, recipes
    currency_data TEXT, -- Scrap and other currencies
    
    -- Pre-reset data for comparison
    quest_state_snapshot TEXT, -- Quest IDs and progress (for reset)
    world_state_snapshot TEXT, -- Sector completion (for reset)
    
    FOREIGN KEY (character_id) REFERENCES Characters(character_id) ON DELETE CASCADE,
    
    CHECK (ng_plus_tier >= 1 AND ng_plus_tier <= 5)
);

CREATE INDEX idx_carryover_character ON NG_Plus_Carryover(character_id);
CREATE INDEX idx_carryover_tier ON NG_Plus_Carryover(ng_plus_tier);

-- =====================================================
-- NEW: NG+ DIFFICULTY SCALING TABLE
-- =====================================================

CREATE TABLE NG_Plus_Scaling (
    tier INTEGER PRIMARY KEY,
    difficulty_multiplier REAL NOT NULL,
    enemy_level_increase INTEGER NOT NULL,
    boss_phase_threshold_reduction REAL NOT NULL,
    corruption_rate_multiplier REAL NOT NULL,
    legend_reward_multiplier REAL NOT NULL,
    description TEXT,
    
    CHECK (tier >= 1 AND tier <= 5),
    CHECK (difficulty_multiplier >= 1.0),
    CHECK (enemy_level_increase >= 0),
    CHECK (boss_phase_threshold_reduction >= 0.0 AND boss_phase_threshold_reduction <= 1.0),
    CHECK (corruption_rate_multiplier >= 1.0),
    CHECK (legend_reward_multiplier >= 1.0)
);

-- Seed initial scaling values
INSERT INTO NG_Plus_Scaling (tier, difficulty_multiplier, enemy_level_increase, boss_phase_threshold_reduction, corruption_rate_multiplier, legend_reward_multiplier, description)
VALUES
(1, 1.5, 2, 0.10, 1.25, 1.15, 'First step into higher difficulty'),
(2, 2.0, 4, 0.20, 1.50, 1.30, 'Significantly enhanced enemies'),
(3, 2.5, 6, 0.30, 1.75, 1.45, 'Extreme challenge for optimized builds'),
(4, 3.0, 8, 0.40, 2.00, 1.60, 'Near-impossible without perfect execution'),
(5, 3.5, 10, 0.50, 2.25, 1.75, 'Maximum difficulty, ultimate mastery test');

-- =====================================================
-- NEW: NG+ COMPLETION LOG
-- =====================================================

CREATE TABLE NG_Plus_Completions (
    completion_id INTEGER PRIMARY KEY AUTOINCREMENT,
    character_id INTEGER NOT NULL,
    completed_tier INTEGER NOT NULL,
    completion_timestamp DATETIME DEFAULT CURRENT_TIMESTAMP,
    total_playtime_seconds INTEGER,
    deaths_during_run INTEGER DEFAULT 0,
    bosses_defeated INTEGER DEFAULT 0,
    
    FOREIGN KEY (character_id) REFERENCES Characters(character_id) ON DELETE CASCADE,
    
    CHECK (completed_tier >= 1 AND completed_tier <= 5)
);

CREATE INDEX idx_completions_character ON NG_Plus_Completions(character_id);
CREATE INDEX idx_completions_tier ON NG_Plus_Completions(completed_tier);
CREATE INDEX idx_completions_timestamp ON NG_Plus_Completions(completion_timestamp);
```

### Example Data

```sql
-- Example: Character who completed Normal and NG+1
UPDATE Characters
SET 
    current_ng_plus_tier = 1,
    highest_ng_plus_tier = 1,
    has_completed_campaign = 1,
    ng_plus_completions = 1
WHERE character_id = 101;

-- Example: Carryover snapshot for NG+1 initialization
INSERT INTO NG_Plus_Carryover (
    character_id, ng_plus_tier, character_data, equipment_data
)
VALUES (
    101,
    1,
    '{"level": 25, "legend": 5420, "progression_points": 12, "attributes": {"MIGHT": 16, "FINESSE": 14}}',
    '{"weapons": ["rusted_longsword"], "armor": ["scavenged_plate"], "accessories": ["trauma_ward_charm"]}'
);

-- Example: NG+1 completion logged
INSERT INTO NG_Plus_Completions (
    character_id, completed_tier, total_playtime_seconds, deaths_during_run, bosses_defeated
)
VALUES (
    101, 1, 14400, 3, 8
);
```

---

## IV. Service Implementation

### NewGamePlusService

```csharp
public interface INewGamePlusService
{
    Task<Result<NewGamePlusInfo>> GetAvailableTiersAsync(int characterId);
    Task<Result> InitializeNewGamePlusAsync(int characterId, int targetTier);
    Task<Result> CompleteNewGamePlusTierAsync(int characterId);
    Task<NGPlusScaling> GetScalingForTierAsync(int tier);
    bool CanAccessTier(int characterId, int tier);
}

public class NewGamePlusService : INewGamePlusService
{
    private readonly ILogger<NewGamePlusService> _logger;
    private readonly ICharacterRepository _characterRepo;
    private readonly ICarryoverService _carryoverService;
    private readonly IWorldStateRepository _worldStateRepo;
    private readonly IQuestRepository _questRepo;
    
    public async Task<Result<NewGamePlusInfo>> GetAvailableTiersAsync(int characterId)
    {
        using var operation = _logger.BeginTimedOperation(
            "Getting available NG+ tiers for character {CharacterId}",
            characterId);
        
        var character = await _characterRepo.GetByIdAsync(characterId);
        if (character == null)
        {
            return Result.Failure<NewGamePlusInfo>("Character not found");
        }
        
        var info = new NewGamePlusInfo
        {
            CurrentTier = character.CurrentNGPlusTier,
            HighestTierCompleted = character.HighestNGPlusTier,
            HasCompletedCampaign = character.HasCompletedCampaign,
            AvailableTiers = GetUnlockedTiers(character),
            NextTierRequirement = GetNextTierRequirement(character)
        };
        
        _logger.Information(
            "Character {CharacterId} NG+ status: Current={Current}, Highest={Highest}, CanAccess={Available}",
            characterId, info.CurrentTier, info.HighestTierCompleted, info.AvailableTiers.Count);
        
        return Result.Success(info);
    }
    
    public async Task<Result> InitializeNewGamePlusAsync(int characterId, int targetTier)
    {
        using var operation = _logger.BeginTimedOperation(
            "Initializing NG+{Tier} for character {CharacterId}",
            targetTier, characterId);
        
        // Validation: Character exists and has completed campaign
        var character = await _characterRepo.GetByIdAsync(characterId);
        if (character == null)
        {
            return Result.Failure("Character not found");
        }
        
        if (!character.HasCompletedCampaign)
        {
            _logger.Warning(
                "Character {CharacterId} attempted NG+ without campaign completion",
                characterId);
            return Result.Failure("Must complete campaign before New Game+");
        }
        
        // Validation: Tier progression (no skipping)
        if (targetTier > character.HighestNGPlusTier + 1)
        {
            _logger.Warning(
                "Character {CharacterId} attempted to skip to NG+{Target} from NG+{Current}",
                characterId, targetTier, character.HighestNGPlusTier);
            return Result.Failure(
                $"Must complete NG+{character.HighestNGPlusTier} before attempting NG+{targetTier}");
        }
        
        // Validation: Tier bounds
        if (targetTier < 1 || targetTier > 5)
        {
            return Result.Failure("NG+ tier must be between 1 and 5");
        }
        
        try
        {
            // STEP 1: Create carryover snapshot
            _logger.Information(
                "Creating carryover snapshot for character {CharacterId}",
                characterId);
            
            var carryoverSnapshot = await _carryoverService.CreateSnapshotAsync(
                characterId, targetTier);
            
            // STEP 2: Reset world state
            _logger.Information(
                "Resetting world state for character {CharacterId}",
                characterId);
            
            await _worldStateRepo.ResetForNewGamePlusAsync(characterId);
            
            // STEP 3: Reset quest progression
            _logger.Information(
                "Resetting quest progression for character {CharacterId}",
                characterId);
            
            await _questRepo.ResetAllQuestsAsync(characterId);
            
            // STEP 4: Reset Trauma Economy
            _logger.Information(
                "Resetting Trauma Economy for character {CharacterId}",
                characterId);
            
            await ResetTraumaEconomyAsync(characterId);
            
            // STEP 5: Apply carryover data
            _logger.Information(
                "Applying carryover data for character {CharacterId}",
                characterId);
            
            await _carryoverService.ApplySnapshotAsync(characterId, carryoverSnapshot);
            
            // STEP 6: Set NG+ tier
            character.CurrentNGPlusTier = targetTier;
            await _characterRepo.UpdateAsync(character);
            
            _logger.Information(
                "NG+{Tier} initialization complete for character {CharacterId}",
                targetTier, characterId);
            
            return Result.Success();
        }
        catch (Exception ex)
        {
            _logger.Error(ex,
                "Failed to initialize NG+{Tier} for character {CharacterId}: {Error}",
                targetTier, characterId, ex.Message);
            return Result.Failure($"NG+ initialization failed: {ex.Message}");
        }
    }
    
    public async Task<Result> CompleteNewGamePlusTierAsync(int characterId)
    {
        using var operation = _logger.BeginTimedOperation(
            "Completing NG+ tier for character {CharacterId}",
            characterId);
        
        var character = await _characterRepo.GetByIdAsync(characterId);
        if (character == null)
        {
            return Result.Failure("Character not found");
        }
        
        var completedTier = character.CurrentNGPlusTier;
        
        // Update highest tier if this is a new record
        if (completedTier > character.HighestNGPlusTier)
        {
            character.HighestNGPlusTier = completedTier;
            _logger.Information(
                "Character {CharacterId} achieved new highest NG+ tier: {Tier}",
                characterId, completedTier);
        }
        
        // Increment completion counter
        character.NGPlusCompletions++;
        
        await _characterRepo.UpdateAsync(character);
        
        // Log completion
        await LogCompletionAsync(characterId, completedTier);
        
        _logger.Information(
            "Character {CharacterId} completed NG+{Tier}",
            characterId, completedTier);
        
        return Result.Success();
    }
    
    public async Task<NGPlusScaling> GetScalingForTierAsync(int tier)
    {
        // Query from NG_Plus_Scaling table
        var scaling = await _db.QueryFirstOrDefaultAsync<NGPlusScaling>(
            "SELECT * FROM NG_Plus_Scaling WHERE tier = @Tier",
            new { Tier = tier });
        
        return scaling ?? new NGPlusScaling { Tier = 0, DifficultyMultiplier = 1.0f };
    }
    
    public bool CanAccessTier(int characterId, int tier)
    {
        var character = _characterRepo.GetById(characterId);
        
        if (character == null || !character.HasCompletedCampaign)
            return false;
        
        if (tier < 1 || tier > 5)
            return false;
        
        // Must complete previous tier first
        return tier <= character.HighestNGPlusTier + 1;
    }
    
    private async Task ResetTraumaEconomyAsync(int characterId)
    {
        await _db.ExecuteAsync(
            @"UPDATE Characters 
              SET psychic_stress = 0, 
                  corruption = 0 
              WHERE character_id = @CharacterId",
            new { CharacterId = characterId });
        
        await _db.ExecuteAsync(
            @"DELETE FROM Character_Traumas 
              WHERE character_id = @CharacterId",
            new { CharacterId = characterId });
    }
    
    private async Task LogCompletionAsync(int characterId, int tier)
    {
        await _db.ExecuteAsync(
            @"INSERT INTO NG_Plus_Completions 
              (character_id, completed_tier, total_playtime_seconds) 
              VALUES (@CharacterId, @Tier, @Playtime)",
            new 
            { 
                CharacterId = characterId,
                Tier = tier,
                Playtime = await GetCurrentPlaytimeAsync(characterId)
            });
    }
}
```

### DifficultyScalingService

```csharp
public interface IDifficultyScalingService
{
    Task<ScaledEnemy> ApplyNGPlusScalingAsync(Enemy baseEnemy, int ngPlusTier);
    Task<ScaledBoss> ApplyBossScalingAsync(Boss baseBoss, int ngPlusTier);
    float GetCorruptionRateMultiplier(int ngPlusTier);
    float GetLegendRewardMultiplier(int ngPlusTier);
}

public class DifficultyScalingService : IDifficultyScalingService
{
    private readonly ILogger<DifficultyScalingService> _logger;
    private readonly INewGamePlusService _ngPlusService;
    
    public async Task<ScaledEnemy> ApplyNGPlusScalingAsync(Enemy baseEnemy, int ngPlusTier)
    {
        if (ngPlusTier == 0)
        {
            return new ScaledEnemy(baseEnemy); // No scaling on Normal
        }
        
        var scaling = await _ngPlusService.GetScalingForTierAsync(ngPlusTier);
        
        var scaledEnemy = new ScaledEnemy(baseEnemy)
        {
            MaxHP = (int)(baseEnemy.MaxHP * scaling.DifficultyMultiplier),
            CurrentHP = (int)(baseEnemy.MaxHP * scaling.DifficultyMultiplier),
            Level = baseEnemy.Level + scaling.EnemyLevelIncrease,
            BaseDamage = (int)(baseEnemy.BaseDamage * scaling.DifficultyMultiplier),
            NGPlusTier = ngPlusTier
        };
        
        _logger.Debug(
            "Scaled enemy {EnemyId} for NG+{Tier}: HP {BaseHP} → {ScaledHP}, Damage {BaseDmg} → {ScaledDmg}",
            baseEnemy.EnemyId, ngPlusTier, baseEnemy.MaxHP, scaledEnemy.MaxHP, 
            baseEnemy.BaseDamage, scaledEnemy.BaseDamage);
        
        return scaledEnemy;
    }
    
    public async Task<ScaledBoss> ApplyBossScalingAsync(Boss baseBoss, int ngPlusTier)
    {
        if (ngPlusTier == 0)
        {
            return new ScaledBoss(baseBoss);
        }
        
        var scaling = await _ngPlusService.GetScalingForTierAsync(ngPlusTier);
        
        var scaledBoss = new ScaledBoss(baseBoss)
        {
            MaxHP = (int)(baseBoss.MaxHP * scaling.DifficultyMultiplier),
            CurrentHP = (int)(baseBoss.MaxHP * scaling.DifficultyMultiplier),
            Level = baseBoss.Level + scaling.EnemyLevelIncrease,
            BaseDamage = (int)(baseBoss.BaseDamage * scaling.DifficultyMultiplier),
            NGPlusTier = ngPlusTier
        };
        
        // Adjust phase thresholds
        foreach (var phase in scaledBoss.Phases)
        {
            phase.HPThreshold -= scaling.BossPhaseThresholdReduction;
            phase.HPThreshold = Math.Max(0.1f, phase.HPThreshold); // Minimum 10% HP
        }
        
        _logger.Information(
            "Scaled boss {BossId} for NG+{Tier}: HP {BaseHP} → {ScaledHP}, Phase triggers reduced by {Reduction}%",
            baseBoss.BossId, ngPlusTier, baseBoss.MaxHP, scaledBoss.MaxHP,
            scaling.BossPhaseThresholdReduction * 100);
        
        return scaledBoss;
    }
    
    public float GetCorruptionRateMultiplier(int ngPlusTier)
    {
        if (ngPlusTier == 0) return 1.0f;
        
        var scaling = _ngPlusService.GetScalingForTierAsync(ngPlusTier).Result;
        return scaling.CorruptionRateMultiplier;
    }
    
    public float GetLegendRewardMultiplier(int ngPlusTier)
    {
        if (ngPlusTier == 0) return 1.0f;
        
        var scaling = _ngPlusService.GetScalingForTierAsync(ngPlusTier).Result;
        return scaling.LegendRewardMultiplier;
    }
}
```

### CarryoverService

```csharp
public interface ICarryoverService
{
    Task<CarryoverSnapshot> CreateSnapshotAsync(int characterId, int ngPlusTier);
    Task ApplySnapshotAsync(int characterId, CarryoverSnapshot snapshot);
    Task<bool> ValidateSnapshotIntegrityAsync(CarryoverSnapshot snapshot);
}

public class CarryoverService : ICarryoverService
{
    private readonly ILogger<CarryoverService> _logger;
    private readonly ICharacterRepository _characterRepo;
    private readonly IEquipmentRepository _equipmentRepo;
    private readonly ICraftingRepository _craftingRepo;
    
    public async Task<CarryoverSnapshot> CreateSnapshotAsync(int characterId, int ngPlusTier)
    {
        using var operation = _logger.BeginTimedOperation(
            "Creating carryover snapshot for character {CharacterId}",
            characterId);
        
        var character = await _characterRepo.GetByIdAsync(characterId);
        var equipment = await _equipmentRepo.GetAllForCharacterAsync(characterId);
        var materials = await _craftingRepo.GetMaterialsAsync(characterId);
        var recipes = await _craftingRepo.GetUnlockedRecipesAsync(characterId);
        
        var snapshot = new CarryoverSnapshot
        {
            CharacterId = characterId,
            NGPlusTier = ngPlusTier,
            TimestampUtc = DateTime.UtcNow,
            
            // Character progression
            CharacterLevel = character.Level,
            LegendPoints = character.LegendPoints,
            ProgressionPoints = character.ProgressionPoints,
            UnspentProgressionPoints = character.UnspentProgressionPoints,
            
            // Attributes
            Attributes = new Dictionary<string, int>
            {
                { "MIGHT", character.MIGHT },
                { "FINESSE", character.FINESSE },
                { "WITS", character.WITS },
                { "WILL", character.WILL },
                { "STURDINESS", character.STURDINESS }
            },
            
            // Specializations and abilities
            UnlockedSpecializations = await GetUnlockedSpecializationsAsync(characterId),
            LearnedAbilities = await GetLearnedAbilitiesAsync(characterId),
            
            // Equipment
            EquippedItems = equipment.Where(e => e.IsEquipped).ToList(),
            InventoryItems = equipment.Where(e => !e.IsEquipped).ToList(),
            
            // Crafting
            CraftingMaterials = materials,
            UnlockedRecipes = recipes,
            
            // Currency
            Scrap = character.Scrap
        };
        
        // Serialize and save to database
        await SaveSnapshotToDatabase(snapshot);
        
        _logger.Information(
            "Carryover snapshot created for character {CharacterId}: Level {Level}, PP {PP}, Equipment {EquipCount}",
            characterId, snapshot.CharacterLevel, snapshot.ProgressionPoints, 
            snapshot.EquippedItems.Count + snapshot.InventoryItems.Count);
        
        return snapshot;
    }
    
    public async Task ApplySnapshotAsync(int characterId, CarryoverSnapshot snapshot)
    {
        using var operation = _logger.BeginTimedOperation(
            "Applying carryover snapshot for character {CharacterId}",
            characterId);
        
        // Validate snapshot integrity
        if (!await ValidateSnapshotIntegrityAsync(snapshot))
        {
            throw new InvalidOperationException("Snapshot failed integrity validation");
        }
        
        var character = await _characterRepo.GetByIdAsync(characterId);
        
        // Apply character progression
        character.Level = snapshot.CharacterLevel;
        character.LegendPoints = snapshot.LegendPoints;
        character.ProgressionPoints = snapshot.ProgressionPoints;
        character.UnspentProgressionPoints = snapshot.UnspentProgressionPoints;
        
        // Apply attributes
        character.MIGHT = snapshot.Attributes["MIGHT"];
        character.FINESSE = snapshot.Attributes["FINESSE"];
        character.WITS = snapshot.Attributes["WITS"];
        character.WILL = snapshot.Attributes["WILL"];
        character.STURDINESS = snapshot.Attributes["STURDINESS"];
        
        // Apply currency
        character.Scrap = snapshot.Scrap;
        
        await _characterRepo.UpdateAsync(character);
        
        // Restore specializations and abilities
        await RestoreSpecializationsAsync(characterId, snapshot.UnlockedSpecializations);
        await RestoreAbilitiesAsync(characterId, snapshot.LearnedAbilities);
        
        // Restore equipment
        await RestoreEquipmentAsync(characterId, snapshot.EquippedItems, snapshot.InventoryItems);
        
        // Restore crafting
        await RestoreCraftingAsync(characterId, snapshot.CraftingMaterials, snapshot.UnlockedRecipes);
        
        _logger.Information(
            "Carryover snapshot applied successfully for character {CharacterId}",
            characterId);
    }
    
    public async Task<bool> ValidateSnapshotIntegrityAsync(CarryoverSnapshot snapshot)
    {
        // Check for impossible stat values
        if (snapshot.CharacterLevel < 1 || snapshot.CharacterLevel > 50)
        {
            _logger.Warning("Invalid character level in snapshot: {Level}", snapshot.CharacterLevel);
            return false;
        }
        
        // Check for negative progression points
        if (snapshot.ProgressionPoints < 0 || snapshot.UnspentProgressionPoints < 0)
        {
            _logger.Warning("Negative PP in snapshot");
            return false;
        }
        
        // Check for impossible attribute values
        foreach (var attr in snapshot.Attributes)
        {
            if (attr.Value < 8 || attr.Value > 30)
            {
                _logger.Warning("Invalid attribute value: {Attr} = {Value}", attr.Key, attr.Value);
                return false;
            }
        }
        
        return true;
    }
}
```

---

## V. Integration Points

### Combat System Integration

```csharp
// In CombatService.cs

public class CombatEncounter
{
    public async Task InitializeEncounterAsync(List<Enemy> enemies, int characterNGPlusTier)
    {
        if (characterNGPlusTier > 0)
        {
            _logger.Information(
                "Applying NG+{Tier} scaling to {EnemyCount} enemies",
                characterNGPlusTier, enemies.Count);
            
            var scaledEnemies = new List<Enemy>();
            foreach (var enemy in enemies)
            {
                var scaled = await _difficultyScalingService.ApplyNGPlusScalingAsync(
                    enemy, characterNGPlusTier);
                scaledEnemies.Add(scaled);
            }
            
            enemies = scaledEnemies;
        }
        
        // Continue with encounter initialization
    }
}
```

### Boss Encounter Integration

```csharp
// In BossEncounterService.cs

public class BossEncounter
{
    public async Task<Boss> SpawnBossAsync(string bossId, int characterNGPlusTier)
    {
        var baseBoss = await _bossRepo.GetByIdAsync(bossId);
        
        if (characterNGPlusTier > 0)
        {
            _logger.Information(
                "Applying NG+{Tier} scaling to boss {BossId}",
                characterNGPlusTier, bossId);
            
            baseBoss = await _difficultyScalingService.ApplyBossScalingAsync(
                baseBoss, characterNGPlusTier);
        }
        
        return baseBoss;
    }
}
```

### Trauma Economy Integration

```csharp
// In TraumaEconomyService.cs

public async Task ApplyCorruptionAsync(int characterId, int baseCorruptionGain)
{
    var character = await _characterRepo.GetByIdAsync(characterId);
    
    // Apply NG+ corruption rate multiplier
    float multiplier = _difficultyScalingService.GetCorruptionRateMultiplier(
        character.CurrentNGPlusTier);
    
    int scaledCorruption = (int)(baseCorruptionGain * multiplier);
    
    _logger.Debug(
        "Applying corruption with NG+{Tier} multiplier: {Base} × {Mult} = {Scaled}",
        character.CurrentNGPlusTier, baseCorruptionGain, multiplier, scaledCorruption);
    
    character.Corruption += scaledCorruption;
    
    await _characterRepo.UpdateAsync(character);
}
```

### Legend System Integration

```csharp
// In LegendService.cs

public async Task AwardLegendAsync(int characterId, int baseLegendReward)
{
    var character = await _characterRepo.GetByIdAsync(characterId);
    
    // Apply NG+ legend reward multiplier
    float multiplier = _difficultyScalingService.GetLegendRewardMultiplier(
        character.CurrentNGPlusTier);
    
    int scaledLegend = (int)(baseLegendReward * multiplier);
    
    _logger.Information(
        "Awarding legend with NG+{Tier} bonus: {Base} × {Mult} = {Scaled}",
        character.CurrentNGPlusTier, baseLegendReward, multiplier, scaledLegend);
    
    character.LegendPoints += scaledLegend;
    
    await _characterRepo.UpdateAsync(character);
}
```

---

## VI. Testing Requirements

### Unit Tests (Target: 85%+ Coverage)

```csharp
[TestClass]
public class NewGamePlusServiceTests
{
    [TestMethod]
    public async Task InitializeNewGamePlus_ValidTier_Success()
    {
        // Arrange
        var characterId = 101;
        var mockCharacter = new Character
        {
            CharacterId = characterId,
            HasCompletedCampaign = true,
            HighestNGPlusTier = 0,
            CurrentNGPlusTier = 0
        };
        
        var mockRepo = new Mock<ICharacterRepository>();
        mockRepo.Setup(r => r.GetByIdAsync(characterId))
            .ReturnsAsync(mockCharacter);
        
        var service = new NewGamePlusService(
            Mock.Of<ILogger<NewGamePlusService>>(),
            mockRepo.Object,
            Mock.Of<ICarryoverService>(),
            Mock.Of<IWorldStateRepository>(),
            Mock.Of<IQuestRepository>());
        
        // Act
        var result = await service.InitializeNewGamePlusAsync(characterId, targetTier: 1);
        
        // Assert
        Assert.IsTrue(result.IsSuccess);
        Assert.AreEqual(1, mockCharacter.CurrentNGPlusTier);
    }
    
    [TestMethod]
    public async Task InitializeNewGamePlus_CampaignNotComplete_Failure()
    {
        // Arrange
        var characterId = 102;
        var mockCharacter = new Character
        {
            CharacterId = characterId,
            HasCompletedCampaign = false
        };
        
        var mockRepo = new Mock<ICharacterRepository>();
        mockRepo.Setup(r => r.GetByIdAsync(characterId))
            .ReturnsAsync(mockCharacter);
        
        var service = new NewGamePlusService(
            Mock.Of<ILogger<NewGamePlusService>>(),
            mockRepo.Object,
            Mock.Of<ICarryoverService>(),
            Mock.Of<IWorldStateRepository>(),
            Mock.Of<IQuestRepository>());
        
        // Act
        var result = await service.InitializeNewGamePlusAsync(characterId, targetTier: 1);
        
        // Assert
        Assert.IsFalse(result.IsSuccess);
        Assert.IsTrue(result.Error.Contains("campaign"));
    }
    
    [TestMethod]
    public async Task InitializeNewGamePlus_SkippingTiers_Failure()
    {
        // Arrange
        var characterId = 103;
        var mockCharacter = new Character
        {
            CharacterId = characterId,
            HasCompletedCampaign = true,
            HighestNGPlusTier = 1
        };
        
        var mockRepo = new Mock<ICharacterRepository>();
        mockRepo.Setup(r => r.GetByIdAsync(characterId))
            .ReturnsAsync(mockCharacter);
        
        var service = new NewGamePlusService(
            Mock.Of<ILogger<NewGamePlusService>>(),
            mockRepo.Object,
            Mock.Of<ICarryoverService>(),
            Mock.Of<IWorldStateRepository>(),
            Mock.Of<IQuestRepository>());
        
        // Act: Try to jump from NG+1 to NG+3
        var result = await service.InitializeNewGamePlusAsync(characterId, targetTier: 3);
        
        // Assert
        Assert.IsFalse(result.IsSuccess);
        Assert.IsTrue(result.Error.Contains("NG+1"));
    }
    
    [TestMethod]
    public async Task CompleteNewGamePlusTier_FirstCompletion_UnlocksNextTier()
    {
        // Arrange
        var characterId = 104;
        var mockCharacter = new Character
        {
            CharacterId = characterId,
            CurrentNGPlusTier = 1,
            HighestNGPlusTier = 0,
            NGPlusCompletions = 0
        };
        
        var mockRepo = new Mock<ICharacterRepository>();
        mockRepo.Setup(r => r.GetByIdAsync(characterId))
            .ReturnsAsync(mockCharacter);
        
        var service = new NewGamePlusService(
            Mock.Of<ILogger<NewGamePlusService>>(),
            mockRepo.Object,
            Mock.Of<ICarryoverService>(),
            Mock.Of<IWorldStateRepository>(),
            Mock.Of<IQuestRepository>());
        
        // Act
        var result = await service.CompleteNewGamePlusTierAsync(characterId);
        
        // Assert
        Assert.IsTrue(result.IsSuccess);
        Assert.AreEqual(1, mockCharacter.HighestNGPlusTier);
        Assert.AreEqual(1, mockCharacter.NGPlusCompletions);
    }
}

[TestClass]
public class DifficultyScalingServiceTests
{
    [TestMethod]
    public async Task ApplyNGPlusScaling_Tier1_150PercentScaling()
    {
        // Arrange
        var baseEnemy = new Enemy
        {
            EnemyId = "test_enemy",
            MaxHP = 100,
            BaseDamage = 20,
            Level = 10
        };
        
        var mockNGService = new Mock<INewGamePlusService>();
        mockNGService.Setup(s => s.GetScalingForTierAsync(1))
            .ReturnsAsync(new NGPlusScaling
            {
                Tier = 1,
                DifficultyMultiplier = 1.5f,
                EnemyLevelIncrease = 2
            });
        
        var service = new DifficultyScalingService(
            Mock.Of<ILogger<DifficultyScalingService>>(),
            mockNGService.Object);
        
        // Act
        var scaled = await service.ApplyNGPlusScalingAsync(baseEnemy, ngPlusTier: 1);
        
        // Assert
        Assert.AreEqual(150, scaled.MaxHP); // 100 × 1.5
        Assert.AreEqual(30, scaled.BaseDamage); // 20 × 1.5
        Assert.AreEqual(12, scaled.Level); // 10 + 2
    }
    
    [TestMethod]
    public async Task ApplyBossScaling_Tier3_PhaseThresholdsReduced()
    {
        // Arrange
        var baseBoss = new Boss
        {
            BossId = "test_boss",
            MaxHP = 500,
            Phases = new List<BossPhase>
            {
                new BossPhase { PhaseNumber = 1, HPThreshold = 1.0f },
                new BossPhase { PhaseNumber = 2, HPThreshold = 0.66f },
                new BossPhase { PhaseNumber = 3, HPThreshold = 0.33f }
            }
        };
        
        var mockNGService = new Mock<INewGamePlusService>();
        mockNGService.Setup(s => s.GetScalingForTierAsync(3))
            .ReturnsAsync(new NGPlusScaling
            {
                Tier = 3,
                DifficultyMultiplier = 2.5f,
                BossPhaseThresholdReduction = 0.30f
            });
        
        var service = new DifficultyScalingService(
            Mock.Of<ILogger<DifficultyScalingService>>(),
            mockNGService.Object);
        
        // Act
        var scaled = await service.ApplyBossScalingAsync(baseBoss, ngPlusTier: 3);
        
        // Assert
        Assert.AreEqual(1250, scaled.MaxHP); // 500 × 2.5
        Assert.AreEqual(0.70f, scaled.Phases[0].HPThreshold, 0.01f); // 1.0 - 0.3
        Assert.AreEqual(0.36f, scaled.Phases[1].HPThreshold, 0.01f); // 0.66 - 0.3
        Assert.AreEqual(0.10f, scaled.Phases[2].HPThreshold, 0.01f); // 0.33 - 0.3, capped at 0.1
    }
}

[TestClass]
public class CarryoverServiceTests
{
    [TestMethod]
    public async Task CreateSnapshot_ValidCharacter_CapturesAllData()
    {
        // Arrange
        var characterId = 201;
        var mockCharacter = new Character
        {
            CharacterId = characterId,
            Level = 25,
            LegendPoints = 5420,
            ProgressionPoints = 42,
            UnspentProgressionPoints = 3,
            MIGHT = 16,
            FINESSE = 14,
            WITS = 12,
            WILL = 15,
            STURDINESS = 13,
            Scrap = 850
        };
        
        var mockCharRepo = new Mock<ICharacterRepository>();
        mockCharRepo.Setup(r => r.GetByIdAsync(characterId))
            .ReturnsAsync(mockCharacter);
        
        var service = new CarryoverService(
            Mock.Of<ILogger<CarryoverService>>(),
            mockCharRepo.Object,
            Mock.Of<IEquipmentRepository>(),
            Mock.Of<ICraftingRepository>());
        
        // Act
        var snapshot = await service.CreateSnapshotAsync(characterId, ngPlusTier: 2);
        
        // Assert
        Assert.IsNotNull(snapshot);
        Assert.AreEqual(25, snapshot.CharacterLevel);
        Assert.AreEqual(5420, snapshot.LegendPoints);
        Assert.AreEqual(42, snapshot.ProgressionPoints);
        Assert.AreEqual(3, snapshot.UnspentProgressionPoints);
        Assert.AreEqual(16, snapshot.Attributes["MIGHT"]);
        Assert.AreEqual(850, snapshot.Scrap);
    }
    
    [TestMethod]
    public async Task ValidateSnapshotIntegrity_InvalidLevel_ReturnsFalse()
    {
        // Arrange
        var snapshot = new CarryoverSnapshot
        {
            CharacterLevel = 99, // Invalid: max is 50
            ProgressionPoints = 50,
            Attributes = new Dictionary<string, int>
            {
                { "MIGHT", 15 },
                { "FINESSE", 15 },
                { "WITS", 15 },
                { "WILL", 15 },
                { "STURDINESS", 15 }
            }
        };
        
        var service = new CarryoverService(
            Mock.Of<ILogger<CarryoverService>>(),
            Mock.Of<ICharacterRepository>(),
            Mock.Of<IEquipmentRepository>(),
            Mock.Of<ICraftingRepository>());
        
        // Act
        var isValid = await service.ValidateSnapshotIntegrityAsync(snapshot);
        
        // Assert
        Assert.IsFalse(isValid);
    }
    
    [TestMethod]
    public async Task ValidateSnapshotIntegrity_NegativePP_ReturnsFalse()
    {
        // Arrange
        var snapshot = new CarryoverSnapshot
        {
            CharacterLevel = 20,
            ProgressionPoints = -5, // Invalid
            Attributes = new Dictionary<string, int>
            {
                { "MIGHT", 15 },
                { "FINESSE", 15 },
                { "WITS", 15 },
                { "WILL", 15 },
                { "STURDINESS", 15 }
            }
        };
        
        var service = new CarryoverService(
            Mock.Of<ILogger<CarryoverService>>(),
            Mock.Of<ICharacterRepository>(),
            Mock.Of<IEquipmentRepository>(),
            Mock.Of<ICraftingRepository>());
        
        // Act
        var isValid = await service.ValidateSnapshotIntegrityAsync(snapshot);
        
        // Assert
        Assert.IsFalse(isValid);
    }
}
```

### Integration Tests

```csharp
[TestClass]
public class NewGamePlusIntegrationTests
{
    [TestMethod]
    public async Task FullNGPlusWorkflow_CompleteNG1ThenStartNG2_Success()
    {
        // Arrange
        var testDb = CreateTestDatabase();
        var characterId = await CreateTestCharacterAsync(testDb);
        
        // Mark campaign as complete
        await testDb.ExecuteAsync(
            "UPDATE Characters SET has_completed_campaign = 1 WHERE character_id = @Id",
            new { Id = characterId });
        
        var ngPlusService = CreateNewGamePlusService(testDb);
        
        // Act 1: Initialize NG+1
        var initResult = await ngPlusService.InitializeNewGamePlusAsync(characterId, targetTier: 1);
        Assert.IsTrue(initResult.IsSuccess);
        
        // Act 2: Complete NG+1
        var completeResult = await ngPlusService.CompleteNewGamePlusTierAsync(characterId);
        Assert.IsTrue(completeResult.IsSuccess);
        
        // Act 3: Initialize NG+2
        var init2Result = await ngPlusService.InitializeNewGamePlusAsync(characterId, targetTier: 2);
        Assert.IsTrue(init2Result.IsSuccess);
        
        // Assert
        var character = await testDb.QueryFirstAsync<Character>(
            "SELECT * FROM Characters WHERE character_id = @Id",
            new { Id = characterId });
        
        Assert.AreEqual(2, character.CurrentNGPlusTier);
        Assert.AreEqual(1, character.HighestNGPlusTier); // Will be 2 after completing NG+2
        Assert.AreEqual(1, character.NGPlusCompletions);
    }
    
    [TestMethod]
    public async Task ScaledCombat_NG3_EnemiesProperlyScaled()
    {
        // Arrange
        var testDb = CreateTestDatabase();
        var characterId = await CreateTestCharacterAsync(testDb);
        
        await testDb.ExecuteAsync(
            "UPDATE Characters SET current_ng_plus_tier = 3 WHERE character_id = @Id",
            new { Id = characterId });
        
        var baseEnemy = new Enemy { EnemyId = "test_mob", MaxHP = 100, BaseDamage = 15, Level = 8 };
        var scalingService = CreateDifficultyScalingService(testDb);
        
        // Act
        var scaled = await scalingService.ApplyNGPlusScalingAsync(baseEnemy, ngPlusTier: 3);
        
        // Assert
        Assert.AreEqual(250, scaled.MaxHP); // 100 × 2.5 (NG+3)
        Assert.AreEqual(37, scaled.BaseDamage, 1); // 15 × 2.5
        Assert.AreEqual(14, scaled.Level); // 8 + 6
    }
}
```

---

## VII. Success Criteria

**v0.40.1 is DONE when:**

- [ ]  **NG+ Tier System:**
    - [ ]  5 tiers defined in database (NG+1 through NG+5)
    - [ ]  Scaling formulas implemented (+50% per tier)
    - [ ]  Enemy level increases work (+2 per tier)
    - [ ]  Boss phase thresholds adjusted (-10% per tier)
    - [ ]  Corruption rate scaling functional (+25% per tier)
    - [ ]  Legend reward scaling functional (+15% per tier)
- [ ]  **Progression Carryover:**
    - [ ]  Carryover snapshot system creates JSON snapshots
    - [ ]  Character level, Legend, PP preserved
    - [ ]  Specializations and abilities preserved
    - [ ]  Equipment inventory preserved
    - [ ]  Crafting materials and recipes preserved
    - [ ]  Currency preserved
    - [ ]  Quest-specific items removed
- [ ]  **World State Reset:**
    - [ ]  Quest progression reset
    - [ ]  World state regenerated
    - [ ]  Traumas cleared
    - [ ]  Corruption reset to 0
    - [ ]  Psychic Stress reset to 0
    - [ ]  Temporary buffs removed
- [ ]  **Unlock Gating:**
    - [ ]  Campaign completion required for NG+1
    - [ ]  Each tier requires previous tier completion
    - [ ]  Cannot skip tiers
    - [ ]  NG+5 is maximum (no higher tiers)
- [ ]  **Database Schema:**
    - [ ]  Characters table columns added
    - [ ]  NG_Plus_Carryover table created
    - [ ]  NG_Plus_Scaling table created and seeded
    - [ ]  NG_Plus_Completions table created
    - [ ]  All indexes created
- [ ]  **Service Layer:**
    - [ ]  NewGamePlusService operational
    - [ ]  DifficultyScalingService operational
    - [ ]  CarryoverService operational
    - [ ]  All interfaces documented
- [ ]  **Integration:**
    - [ ]  Combat system applies NG+ scaling
    - [ ]  Boss encounters apply NG+ scaling
    - [ ]  Trauma Economy applies corruption multiplier
    - [ ]  Legend System applies reward multiplier
    - [ ]  Save/load system handles NG+ data
- [ ]  **Testing:**
    - [ ]  85%+ unit test coverage
    - [ ]  15+ unit tests passing
    - [ ]  3+ integration tests passing
    - [ ]  Performance: Carryover snapshot creation <500ms
    - [ ]  Performance: NG+ initialization <2 seconds
- [ ]  **Logging:**
    - [ ]  Serilog structured logging throughout
    - [ ]  NG+ initialization logged
    - [ ]  Carryover operations logged
    - [ ]  Scaling application logged
    - [ ]  Tier completion logged
- [ ]  **Documentation:**
    - [ ]  Complete service architecture documented
    - [ ]  Database schema documented
    - [ ]  Scaling formulas documented
    - [ ]  Integration points documented

---

## VIII. Timeline

**Week 1: Core NG+ System** — 4-6 hours

- Database schema implementation
- NewGamePlusService basic structure
- Tier unlock logic
- Campaign completion tracking

**Week 2: Difficulty Scaling** — 4-6 hours

- DifficultyScalingService implementation
- Enemy scaling formulas
- Boss scaling formulas
- Corruption/Legend multipliers
- Integration with combat systems

**Week 3: Carryover System** — 3-5 hours

- CarryoverService implementation
- Snapshot creation and validation
- Snapshot application
- World state reset

**Week 4: Testing & Validation** — 2-3 hours

- Unit tests (15+)
- Integration tests (3+)
- Performance validation
- Edge case handling

**Total: 8-12 hours (1-2 weeks part-time)**

---

**Ready to reward mastery with escalating challenge.**