# v0.12.0 Statistics System - Scope Breakdown

**Version:** 0.12.0
**Theme:** Statistics System
**Prerequisites:** v0.11.2c Complete (Crafting System - Quality System)
**Total Estimated Tests:** ~35 new tests

---

## Executive Summary

The Statistics System sub-version implements comprehensive statistics tracking including combat stats, exploration stats, crafting stats, playtime, and dice roll history. Statistics persist across sessions and can be viewed in a dedicated statistics screen. The dice roll history provides insight into luck streaks, adding a fun meta-game layer.

Key focus areas:
- **Core Statistics**: Combat, exploration, and progression stat tracking
- **Dice History**: Roll tracking with streak detection
- **Statistics View**: Comprehensive stats display

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.12.0a | Core Statistics | PlayerStatistics, categories, event handlers | ~12 |
| v0.12.0b | Dice Roll History | DiceRollHistory, streak detection, luck rating | ~11 |
| v0.12.0c | Statistics View | Stats UI, tabs, formatting, persistence | ~12 |

---

## Existing Infrastructure

### Already Implemented (from prior versions)

| Feature | Location | Notes |
|---------|----------|-------|
| Player | `Domain/Entities/Player.cs` | Player entity |
| DiceService | `Application/Services/DiceService.cs` | Dice rolling |
| CombatService | `Application/Services/CombatService.cs` | Combat events |
| EventBus | `Application/Services/EventBus.cs` | Event system |
| GameSessionService | `Application/Services/GameSessionService.cs` | Game state |
| SaveService | `Application/Services/SaveService.cs` | Save/load |

### Needs Implementation (v0.12.0)

| Feature | Part | Notes |
|---------|------|-------|
| PlayerStatistics | v0.12.0a | Stats entity |
| StatisticCategory | v0.12.0a | Category enum |
| IStatisticsService | v0.12.0a | Statistics interface |
| StatisticsService | v0.12.0a | Stat tracking |
| StatisticsEventHandler | v0.12.0a | Event processing |
| DiceRollHistory | v0.12.0b | Roll tracking |
| DiceRollRecord | v0.12.0b | Individual roll |
| StreakDetector | v0.12.0b | Streak analysis |
| StatisticsView | v0.12.0c | Stats UI |
| StatsCommand | v0.12.0c | View command |

---

## Feature Analysis & Categorization

### Core Statistics Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| PlayerStatistics entity | High | Domain | **v0.12.0a** |
| StatisticCategory enum | Low | Domain | **v0.12.0a** |
| Combat statistics | Medium | Events | **v0.12.0a** |
| Exploration statistics | Medium | Events | **v0.12.0a** |
| Progression statistics | Medium | Events | **v0.12.0a** |
| IStatisticsService interface | Medium | Application | **v0.12.0a** |
| StatisticsService impl | High | Service | **v0.12.0a** |
| StatisticsEventHandler | Medium | Events | **v0.12.0a** |
| Playtime tracking | Low | Session | **v0.12.0a** |

### Dice History Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| DiceRollHistory entity | Medium | Domain | **v0.12.0b** |
| DiceRollRecord record | Low | Domain | **v0.12.0b** |
| Roll recording | Medium | DiceService | **v0.12.0b** |
| Natural 20/1 tracking | Low | Rolls | **v0.12.0b** |
| Average calculation | Low | Math | **v0.12.0b** |
| Streak detection | Medium | Algorithm | **v0.12.0b** |
| Luck rating calculation | Medium | Math | **v0.12.0b** |
| Recent rolls buffer | Low | Collection | **v0.12.0b** |

### Statistics View Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| StatisticsView screen | High | UI | **v0.12.0c** |
| Category tabs | Medium | UI | **v0.12.0c** |
| Combat stats display | Medium | Formatting | **v0.12.0c** |
| Exploration stats display | Medium | Formatting | **v0.12.0c** |
| Progression stats display | Medium | Formatting | **v0.12.0c** |
| Dice stats display | Medium | Formatting | **v0.12.0c** |
| Time stats display | Low | Formatting | **v0.12.0c** |
| StatsCommand | Low | Commands | **v0.12.0c** |
| Statistics persistence | Medium | Save system | **v0.12.0c** |

---

## Part Definitions

---

## v0.12.0a: Core Statistics

[v0.12.0a Design Specification](v0.12.0a-design-specification.md)

### Overview

Implement the core statistics tracking infrastructure including the PlayerStatistics entity, statistics categories, and event-driven stat updates. Statistics are tracked across combat, exploration, and progression categories.

### Scope

**In Scope:**
- `PlayerStatistics` entity
- `StatisticCategory` enum
- Combat statistics:
  - Monsters killed (total and by type)
  - Damage dealt / received
  - Critical hits / misses
  - Abilities used
  - Death count
- Exploration statistics:
  - Rooms discovered
  - Secrets found
  - Traps triggered / avoided
  - Doors opened
- Progression statistics:
  - XP earned
  - Levels gained
  - Items found / crafted
  - Gold earned / spent
  - Quests completed
  - Puzzles solved
- Playtime tracking (session and total)
- `IStatisticsService` interface
- `StatisticsService` implementation
- `StatisticsEventHandler` for event processing
- Configuration in `statistics.json`

**Out of Scope:**
- Dice roll history (v0.12.0b)
- Statistics UI (v0.12.0c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 1 | `PlayerStatistics` |
| Domain Enums | 1 | `StatisticCategory` |
| Interfaces | 1 | `IStatisticsService` |
| Services | 1 | `StatisticsService` |
| Event Handlers | 1 | `StatisticsEventHandler` |
| Configuration | 1 | `statistics.json` |
| Unit Tests | ~12 | Tracking, event tests |

### Core Statistics Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CORE STATISTICS ARCHITECTURE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Game Events                       Event Handler
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

     [MonsterKilledEvent] â”€â”€â”€â”€â”€â”€â”€â”
     [DamageDealtEvent]   â”€â”€â”€â”€â”€â”€â”€â”¤     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     [ItemPickedUpEvent]  â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â–¶â”‚ StatisticsEventHandler    â”‚
     [RoomDiscoveredEvent]â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     [QuestCompletedEvent]â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚ + Handle(MonsterKilled)   â”‚
     [CraftedItemEvent]   â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ + Handle(DamageDealt)     â”‚
                                       â”‚ + Handle(ItemPickedUp)    â”‚
                                       â”‚ + Handle(RoomDiscovered)  â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚ updates
                                                       â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚    IStatisticsService     â”‚
                      â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚                â”‚ + IncrementStat(name, amt)â”‚
                      â”‚                â”‚ + GetStatistic(name)      â”‚
                      â”‚                â”‚ + GetCategory(cat)        â”‚
                      â”‚                â”‚ + RecordPlaytime(time)    â”‚
                      â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                                â”‚ persists
                      â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚                â–¼                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Player      â”‚   â”‚ PlayerStatisticsâ”‚   â”‚ Save File       â”‚
              â”‚ + Stats: PS â”‚â”€â”€â–¶â”‚                 â”‚â”€â”€â–¶â”‚ statistics.json â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STATISTIC CATEGORIES
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    COMBAT              EXPLORATION          PROGRESSION
    â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ âš”ï¸ Combat   â”‚    â”‚ ğŸ—ºï¸ Explore â”‚      â”‚ ğŸ“ˆ Progress â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Kills: 127  â”‚    â”‚ Rooms: 42   â”‚      â”‚ XP: 15,340  â”‚
    â”‚ Damage: 4532â”‚    â”‚ Secrets: 8  â”‚      â”‚ Levels: 8   â”‚
    â”‚ Crits: 47   â”‚    â”‚ Traps: 12   â”‚      â”‚ Items: 156  â”‚
    â”‚ Misses: 89  â”‚    â”‚ Doors: 28   â”‚      â”‚ Gold: 2,430 â”‚
    â”‚ Deaths: 3   â”‚    â”‚             â”‚      â”‚ Quests: 12  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PlayerStatistics Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Tracks comprehensive game statistics for a player.
/// </summary>
public class PlayerStatistics : IEntity
{
    public Guid Id { get; private set; }
    public Guid PlayerId { get; private set; }
    
    // Combat Statistics
    public int MonstersKilled { get; private set; }
    private readonly Dictionary<string, int> _monstersByType = new();
    public IReadOnlyDictionary<string, int> MonstersByType => _monstersByType;
    public long TotalDamageDealt { get; private set; }
    public long TotalDamageReceived { get; private set; }
    public int CriticalHits { get; private set; }
    public int AttacksMissed { get; private set; }
    public int AbilitiesUsed { get; private set; }
    public int DeathCount { get; private set; }
    public int BossesKilled { get; private set; }
    
    // Exploration Statistics
    public int RoomsDiscovered { get; private set; }
    public int SecretsFound { get; private set; }
    public int TrapsTriggered { get; private set; }
    public int TrapsAvoided { get; private set; }
    public int DoorsOpened { get; private set; }
    public int ChestsOpened { get; private set; }
    
    // Progression Statistics
    public long TotalXPEarned { get; private set; }
    public int LevelsGained { get; private set; }
    public int ItemsFound { get; private set; }
    public int ItemsCrafted { get; private set; }
    public long GoldEarned { get; private set; }
    public long GoldSpent { get; private set; }
    public int QuestsCompleted { get; private set; }
    public int PuzzlesSolved { get; private set; }
    public int ResourcesGathered { get; private set; }
    
    // Time Statistics
    public TimeSpan TotalPlaytime { get; private set; }
    public DateTime FirstPlayed { get; private set; }
    public DateTime LastPlayed { get; private set; }
    public int SessionCount { get; private set; }
    
    private PlayerStatistics() { }
    
    public static PlayerStatistics Create(Guid playerId)
    {
        return new PlayerStatistics
        {
            Id = Guid.NewGuid(),
            PlayerId = playerId,
            FirstPlayed = DateTime.UtcNow,
            LastPlayed = DateTime.UtcNow,
            SessionCount = 1
        };
    }
    
    /// <summary>Increments a named statistic.</summary>
    public void IncrementStat(string statName, int amount = 1)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(amount);
        
        switch (statName.ToLowerInvariant())
        {
            case "monsterskilled": MonstersKilled += amount; break;
            case "damagedelt": TotalDamageDealt += amount; break;
            case "damagereceived": TotalDamageReceived += amount; break;
            case "criticalhits": CriticalHits += amount; break;
            case "attacksmissed": AttacksMissed += amount; break;
            case "abilitiesused": AbilitiesUsed += amount; break;
            case "deathcount": DeathCount += amount; break;
            case "bosseskilled": BossesKilled += amount; break;
            case "roomsdiscovered": RoomsDiscovered += amount; break;
            case "secretsfound": SecretsFound += amount; break;
            case "trapstriggered": TrapsTriggered += amount; break;
            case "trapsavoided": TrapsAvoided += amount; break;
            case "doorsopened": DoorsOpened += amount; break;
            case "chestsopened": ChestsOpened += amount; break;
            case "xpearned": TotalXPEarned += amount; break;
            case "levelsgained": LevelsGained += amount; break;
            case "itemsfound": ItemsFound += amount; break;
            case "itemscrafted": ItemsCrafted += amount; break;
            case "goldearned": GoldEarned += amount; break;
            case "goldspent": GoldSpent += amount; break;
            case "questscompleted": QuestsCompleted += amount; break;
            case "puzzlessolved": PuzzlesSolved += amount; break;
            case "resourcesgathered": ResourcesGathered += amount; break;
            default:
                throw new ArgumentException($"Unknown statistic: {statName}");
        }
    }
    
    /// <summary>Records a monster kill by type.</summary>
    public void RecordMonsterKill(string monsterType)
    {
        MonstersKilled++;
        var normalizedType = monsterType.ToLowerInvariant();
        _monstersByType.TryGetValue(normalizedType, out var count);
        _monstersByType[normalizedType] = count + 1;
    }
    
    /// <summary>Records session playtime.</summary>
    public void RecordPlaytime(TimeSpan sessionTime)
    {
        TotalPlaytime += sessionTime;
        LastPlayed = DateTime.UtcNow;
    }
    
    /// <summary>Starts a new session.</summary>
    public void StartNewSession()
    {
        SessionCount++;
        LastPlayed = DateTime.UtcNow;
    }
    
    /// <summary>Gets a statistic value by name.</summary>
    public long GetStatistic(string statName)
    {
        return statName.ToLowerInvariant() switch
        {
            "monsterskilled" => MonstersKilled,
            "damagedelt" => TotalDamageDealt,
            "damagereceived" => TotalDamageReceived,
            "criticalhits" => CriticalHits,
            "attacksmissed" => AttacksMissed,
            "abilitiesused" => AbilitiesUsed,
            "deathcount" => DeathCount,
            "bosseskilled" => BossesKilled,
            "roomsdiscovered" => RoomsDiscovered,
            "secretsfound" => SecretsFound,
            "trapstriggered" => TrapsTriggered,
            "trapsavoided" => TrapsAvoided,
            "doorsopened" => DoorsOpened,
            "chestsopened" => ChestsOpened,
            "xpearned" => TotalXPEarned,
            "levelsgained" => LevelsGained,
            "itemsfound" => ItemsFound,
            "itemscrafted" => ItemsCrafted,
            "goldearned" => GoldEarned,
            "goldspent" => GoldSpent,
            "questscompleted" => QuestsCompleted,
            "puzzlessolved" => PuzzlesSolved,
            "resourcesgathered" => ResourcesGathered,
            "playtimeseconds" => (long)TotalPlaytime.TotalSeconds,
            "sessioncount" => SessionCount,
            _ => 0
        };
    }
}
```

### StatisticCategory Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories of tracked statistics.
/// </summary>
public enum StatisticCategory
{
    Combat,
    Exploration,
    Progression,
    Time,
    Dice
}
```

### IStatisticsService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Service for tracking and querying player statistics.
/// </summary>
public interface IStatisticsService
{
    /// <summary>Increments a statistic.</summary>
    void IncrementStat(Player player, string statName, int amount = 1);
    
    /// <summary>Records a monster kill.</summary>
    void RecordMonsterKill(Player player, string monsterType, bool isBoss = false);
    
    /// <summary>Records damage dealt.</summary>
    void RecordDamageDealt(Player player, int amount, bool wasCritical);
    
    /// <summary>Records damage received.</summary>
    void RecordDamageReceived(Player player, int amount);
    
    /// <summary>Records room discovery.</summary>
    void RecordRoomDiscovered(Player player);
    
    /// <summary>Records playtime.</summary>
    void RecordPlaytime(Player player, TimeSpan sessionTime);
    
    /// <summary>Gets a specific statistic.</summary>
    long GetStatistic(Player player, string statName);
    
    /// <summary>Gets all statistics for a category.</summary>
    IReadOnlyDictionary<string, long> GetCategoryStatistics(
        Player player, StatisticCategory category);
    
    /// <summary>Gets the player's statistics entity.</summary>
    PlayerStatistics GetPlayerStatistics(Player player);
    
    /// <summary>Gets calculated metrics (averages, rates).</summary>
    StatisticsMetrics GetMetrics(Player player);
}
```

### StatisticsEventHandler

```csharp
namespace RuneAndRust.Application.EventHandlers;

/// <summary>
/// Handles game events to update statistics.
/// </summary>
public class StatisticsEventHandler : 
    IEventHandler<MonsterKilledEvent>,
    IEventHandler<DamageDealtEvent>,
    IEventHandler<DamageReceivedEvent>,
    IEventHandler<RoomDiscoveredEvent>,
    IEventHandler<ItemPickedUpEvent>,
    IEventHandler<ItemCraftedEvent>,
    IEventHandler<QuestCompletedEvent>,
    IEventHandler<AbilityUsedEvent>,
    IEventHandler<PlayerDeathEvent>,
    IEventHandler<ResourceGatheredEvent>
{
    private readonly IStatisticsService _statisticsService;
    private readonly IPlayerRepository _playerRepository;
    private readonly ILogger<StatisticsEventHandler> _logger;
    
    public StatisticsEventHandler(
        IStatisticsService statisticsService,
        IPlayerRepository playerRepository,
        ILogger<StatisticsEventHandler> logger)
    {
        _statisticsService = statisticsService;
        _playerRepository = playerRepository;
        _logger = logger;
    }
    
    public Task Handle(MonsterKilledEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.RecordMonsterKill(player, @event.MonsterType, @event.IsBoss);
        _statisticsService.IncrementStat(player, "xpEarned", @event.XPAwarded);
        
        _logger.LogDebug("Recorded monster kill: {Type} for {Player}",
            @event.MonsterType, player.Name);
        
        return Task.CompletedTask;
    }
    
    public Task Handle(DamageDealtEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.RecordDamageDealt(player, @event.Amount, @event.WasCritical);
        
        return Task.CompletedTask;
    }
    
    public Task Handle(DamageReceivedEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.RecordDamageReceived(player, @event.Amount);
        
        return Task.CompletedTask;
    }
    
    public Task Handle(RoomDiscoveredEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.RecordRoomDiscovered(player);
        
        if (@event.HasSecret)
            _statisticsService.IncrementStat(player, "secretsFound");
        
        return Task.CompletedTask;
    }
    
    public Task Handle(ItemPickedUpEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.IncrementStat(player, "itemsFound");
        
        if (@event.ItemType == "gold")
            _statisticsService.IncrementStat(player, "goldEarned", @event.Amount);
        
        return Task.CompletedTask;
    }
    
    public Task Handle(ItemCraftedEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.IncrementStat(player, "itemsCrafted");
        
        return Task.CompletedTask;
    }
    
    public Task Handle(QuestCompletedEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.IncrementStat(player, "questsCompleted");
        
        return Task.CompletedTask;
    }
    
    public Task Handle(AbilityUsedEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.IncrementStat(player, "abilitiesUsed");
        
        return Task.CompletedTask;
    }
    
    public Task Handle(PlayerDeathEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.IncrementStat(player, "deathCount");
        
        return Task.CompletedTask;
    }
    
    public Task Handle(ResourceGatheredEvent @event, CancellationToken ct)
    {
        var player = _playerRepository.GetById(@event.PlayerId);
        if (player is null) return Task.CompletedTask;
        
        _statisticsService.IncrementStat(player, "resourcesGathered", @event.Quantity);
        
        return Task.CompletedTask;
    }
}
```

### StatisticsMetrics Record

```csharp
namespace RuneAndRust.Application.Models;

/// <summary>
/// Calculated statistics metrics.
/// </summary>
public record StatisticsMetrics(
    double AverageDamagePerHit,
    double AverageDamageReceived,
    double CriticalHitRate,
    double MissRate,
    double TrapAvoidanceRate,
    double GoldBalance,
    TimeSpan AverageSessionLength,
    CombatRating CombatRating
);

public enum CombatRating
{
    Novice,      // Low kills, high deaths
    Apprentice,  // Learning
    Journeyman,  // Average
    Skilled,     // Good K/D
    Veteran,     // High kills
    Master,      // Excellent stats
    Legend       // Near-perfect
}
```

### Acceptance Criteria

- [ ] PlayerStatistics tracks all stats
- [ ] IncrementStat updates correctly
- [ ] RecordMonsterKill tracks by type
- [ ] Combat stats update on combat events
- [ ] Exploration stats update on discovery
- [ ] Progression stats update on level/items
- [ ] Playtime accumulates correctly
- [ ] Session count increments
- [ ] Event handlers process all events
- [ ] GetCategoryStatistics groups correctly
- [ ] GetMetrics calculates averages/rates
- [ ] ~12 unit tests pass

---

## v0.12.0b: Dice Roll History

[v0.12.0b Design Specification](v0.12.0b-design-specification.md)

### Overview

Implement dice roll history tracking including individual roll records, natural 20/1 counts, average calculation, and streak detection. The luck rating provides a fun meta-game element.

### Scope

**In Scope:**
- `DiceRollHistory` entity
- `DiceRollRecord` record
- Roll recording integration with DiceService
- Natural 20 / Natural 1 tracking
- Average roll calculation
- Streak detection algorithm
- Lucky/unlucky streak tracking
- Longest streak records
- Current streak tracking
- Recent rolls buffer (last 20)
- Luck rating calculation
- `IDiceHistoryService` interface

**Out of Scope:**
- Core statistics (v0.12.0a)
- Statistics UI (v0.12.0c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 1 | `DiceRollHistory` |
| Domain Records | 1 | `DiceRollRecord` |
| Interfaces | 1 | `IDiceHistoryService` |
| Services | 1 | `DiceHistoryService` |
| DiceService Updates | 1 | History integration |
| Unit Tests | ~11 | Roll tracking, streak tests |

### Dice History Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DICE HISTORY ARCHITECTURE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     DiceService                        DiceHistoryService
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

     Roll("1d20") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                       â”‚      â”‚   IDiceHistoryService     â”‚
         â–¼                       â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     Result: 18  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â–¶â”‚ + RecordRoll(record)      â”‚
                                 â”‚      â”‚ + GetHistory(player)      â”‚
                                 â”‚      â”‚ + GetLuckRating(player)   â”‚
                                 â”‚      â”‚ + GetCurrentStreak(plyr)  â”‚
                                 â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚                      â”‚ updates
                                 â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                 â”‚      â–¼                           â”‚
                                 â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                                 â”‚ â”‚   DiceRollHistory   â”‚          â”‚
                                 â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
                                 â”‚ â”‚ TotalRolls: 523     â”‚          â”‚
                                 â”‚ â”‚ Natural20s: 47      â”‚          â”‚
                                 â”‚ â”‚ Natural1s: 31       â”‚          â”‚
                                 â”‚ â”‚ AverageRoll: 11.2   â”‚          â”‚
                                 â”‚ â”‚ CurrentStreak: +3   â”‚          â”‚
                                 â”‚ â”‚ LongestLucky: +7    â”‚          â”‚
                                 â”‚ â”‚ LongestUnlucky: -5  â”‚          â”‚
                                 â”‚ â”‚ RecentRolls: [...]  â”‚          â”‚
                                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                 â”‚                                   â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STREAK DETECTION
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Expected d20 average: 10.5

    Roll Sequence: 18, 14, 12, 3, 20, 8, 15, 11, 19, 7

    Above Average (â‰¥11):    âœ“   âœ“   âœ“           âœ“   âœ“        âœ“
    Below Average (<11):                 âœ“       âœ“        âœ“       âœ“

    Streak Tracking:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Roll â”‚ 18 â”‚ 14 â”‚ 12 â”‚  3 â”‚ 20 â”‚  8 â”‚ 15 â”‚ 11 â”‚ 19 â”‚  7 â”‚    â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”‚    â”‚
    â”‚Streakâ”‚ +1 â”‚ +2 â”‚ +3 â”‚ -1 â”‚ +1 â”‚ -1 â”‚ +1 â”‚ +2 â”‚ +3 â”‚ -1 â”‚    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    LUCK RATING CALCULATION
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Luck % = ((ActualAverage - ExpectedAverage) / ExpectedAverage) * 100

    Example:
    - Actual Average: 11.2
    - Expected (d20): 10.5
    - Luck %: ((11.2 - 10.5) / 10.5) * 100 = +6.7%

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Luck Rating        â”‚ Range              â”‚ Display              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Very Unlucky       â”‚ < -10%             â”‚ ğŸ˜¢ CURSED            â”‚
    â”‚ Unlucky            â”‚ -10% to -5%        â”‚ ğŸ˜Ÿ Unlucky           â”‚
    â”‚ Neutral            â”‚ -5% to +5%         â”‚ ğŸ˜ Average           â”‚
    â”‚ Lucky              â”‚ +5% to +10%        â”‚ ğŸ€ Lucky             â”‚
    â”‚ Very Lucky         â”‚ > +10%             â”‚ ğŸŒŸ BLESSED           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DiceRollHistory Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Tracks dice roll history and statistics.
/// </summary>
public class DiceRollHistory : IEntity
{
    public Guid Id { get; private set; }
    public Guid PlayerId { get; private set; }
    
    // Roll Counts
    public int TotalRolls { get; private set; }
    public int TotalNaturalTwenties { get; private set; }
    public int TotalNaturalOnes { get; private set; }
    public int D20RollCount { get; private set; }
    public long D20RollSum { get; private set; }
    
    // Streak Tracking
    public int CurrentStreak { get; private set; }  // + for lucky, - for unlucky
    public int LongestLuckyStreak { get; private set; }
    public int LongestUnluckyStreak { get; private set; }
    public int LongestNat20Streak { get; private set; }
    
    // Recent Rolls
    private readonly Queue<DiceRollRecord> _recentRolls = new();
    public IReadOnlyList<DiceRollRecord> RecentRolls => _recentRolls.ToList();
    
    private const int MaxRecentRolls = 20;
    private const double D20ExpectedAverage = 10.5;
    
    private DiceRollHistory() { }
    
    public static DiceRollHistory Create(Guid playerId)
    {
        return new DiceRollHistory
        {
            Id = Guid.NewGuid(),
            PlayerId = playerId
        };
    }
    
    /// <summary>Records a dice roll.</summary>
    public void RecordRoll(DiceRollRecord roll)
    {
        TotalRolls++;
        
        // Track d20 specifically for averages
        if (roll.DiceExpression.StartsWith("1d20"))
        {
            D20RollCount++;
            D20RollSum += roll.Result;
            
            // Natural 20/1 tracking
            if (roll.IndividualRolls.Any(r => r == 20))
            {
                TotalNaturalTwenties++;
            }
            if (roll.IndividualRolls.Any(r => r == 1))
            {
                TotalNaturalOnes++;
            }
            
            // Streak tracking (based on above/below average)
            UpdateStreak(roll.Result >= 11);
        }
        
        // Maintain recent rolls buffer
        _recentRolls.Enqueue(roll);
        while (_recentRolls.Count > MaxRecentRolls)
        {
            _recentRolls.Dequeue();
        }
    }
    
    private void UpdateStreak(bool wasAboveAverage)
    {
        if (wasAboveAverage)
        {
            CurrentStreak = CurrentStreak >= 0 ? CurrentStreak + 1 : 1;
            LongestLuckyStreak = Math.Max(LongestLuckyStreak, CurrentStreak);
        }
        else
        {
            CurrentStreak = CurrentStreak <= 0 ? CurrentStreak - 1 : -1;
            LongestUnluckyStreak = Math.Max(LongestUnluckyStreak, Math.Abs(CurrentStreak));
        }
    }
    
    /// <summary>Gets the average d20 roll.</summary>
    public double GetAverageD20Roll()
    {
        return D20RollCount > 0 ? (double)D20RollSum / D20RollCount : D20ExpectedAverage;
    }
    
    /// <summary>Gets the natural 20 rate.</summary>
    public double GetNat20Rate()
    {
        return D20RollCount > 0 ? (double)TotalNaturalTwenties / D20RollCount : 0.05;
    }
    
    /// <summary>Gets the natural 1 rate.</summary>
    public double GetNat1Rate()
    {
        return D20RollCount > 0 ? (double)TotalNaturalOnes / D20RollCount : 0.05;
    }
    
    /// <summary>Gets the luck percentage.</summary>
    public double GetLuckPercentage()
    {
        var average = GetAverageD20Roll();
        return ((average - D20ExpectedAverage) / D20ExpectedAverage) * 100;
    }
}
```

### DiceRollRecord

```csharp
namespace RuneAndRust.Domain.Records;

/// <summary>
/// Records a single dice roll.
/// </summary>
public record DiceRollRecord(
    string DiceExpression,    // "1d20", "2d6+3"
    int Result,               // Final result
    int[] IndividualRolls,    // Each die result
    bool WasCritical,         // Natural 20 or 1
    string Context,           // "attack", "skill check", etc.
    DateTime RolledAt
)
{
    public static DiceRollRecord Create(
        string expression,
        int result,
        int[] rolls,
        string context)
    {
        var wasCritical = rolls.Any(r => r == 20 || r == 1);
        return new DiceRollRecord(expression, result, rolls, wasCritical, context, DateTime.UtcNow);
    }
}
```

### IDiceHistoryService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Service for tracking dice roll history.
/// </summary>
public interface IDiceHistoryService
{
    /// <summary>Records a dice roll.</summary>
    void RecordRoll(Player player, DiceRollRecord roll);
    
    /// <summary>Gets the player's roll history.</summary>
    DiceRollHistory GetHistory(Player player);
    
    /// <summary>Gets the player's luck rating.</summary>
    LuckRating GetLuckRating(Player player);
    
    /// <summary>Gets the current streak.</summary>
    int GetCurrentStreak(Player player);
    
    /// <summary>Gets recent rolls.</summary>
    IReadOnlyList<DiceRollRecord> GetRecentRolls(Player player, int count = 10);
    
    /// <summary>Gets dice statistics summary.</summary>
    DiceStatistics GetStatistics(Player player);
}
```

### LuckRating and DiceStatistics

```csharp
namespace RuneAndRust.Application.Models;

public enum LuckRating
{
    Cursed,    // < -10%
    Unlucky,   // -10% to -5%
    Average,   // -5% to +5%
    Lucky,     // +5% to +10%
    Blessed    // > +10%
}

public record DiceStatistics(
    int TotalRolls,
    int TotalNat20s,
    int TotalNat1s,
    double AverageD20,
    double ExpectedD20,
    double Nat20Rate,
    double ExpectedNat20Rate,
    double LuckPercentage,
    LuckRating Rating,
    int CurrentStreak,
    int LongestLuckyStreak,
    int LongestUnluckyStreak
);
```

### Acceptance Criteria

- [ ] DiceRollHistory tracks all rolls
- [ ] Natural 20/1 counts accurate
- [ ] Average calculation correct
- [ ] Streak detection works
- [ ] Current streak updates properly
- [ ] Longest streaks recorded
- [ ] Recent rolls buffer (20)
- [ ] Luck percentage calculates
- [ ] LuckRating thresholds work
- [ ] DiceService integration works
- [ ] ~11 unit tests pass

---

## v0.12.0c: Statistics View

[v0.12.0c Design Specification](v0.12.0c-design-specification.md)

### Overview

Implement the statistics view UI with tabbed categories, formatted stat displays, calculated metrics, and persistence across sessions. The view provides comprehensive insight into player performance.

### Scope

**In Scope:**
- `StatisticsView` screen
- Category tabs (Combat, Exploration, Progression, Dice, Time)
- Combat stats display with breakdown
- Exploration stats display
- Progression stats display
- Dice stats display with luck rating
- Time stats display
- Combat rating calculation
- Stat formatting (numbers, percentages)
- `StatsCommand` for TUI
- Statistics persistence integration
- Save file integration

**Out of Scope:**
- Core statistics (v0.12.0a)
- Dice history (v0.12.0b)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Screens | 1 | `StatisticsView` |
| Commands | 1 | `StatsCommand` |
| Formatters | 1 | `StatisticsFormatter` |
| Save Integration | 1 | Statistics persistence |
| Unit Tests | ~12 | UI, formatting, persistence tests |

### Statistics View Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATISTICS VIEW ARCHITECTURE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Command                           StatisticsView
     â”€â”€â”€â”€â”€â”€â”€                           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

     > stats                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     > stats combat          â”‚           STATISTICS VIEW              â”‚
     > stats dice            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                             â”‚ [Combat] [Explore] [Progress] [Dice]   â”‚
                             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                             â”‚                                        â”‚
                             â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                             â”‚ â”‚     StatisticsFormatter            â”‚ â”‚
                             â”‚ â”‚ + FormatNumber(4532) â†’ "4,532"     â”‚ â”‚
                             â”‚ â”‚ + FormatPercent(0.092) â†’ "9.2%"    â”‚ â”‚
                             â”‚ â”‚ + FormatDuration(TimeSpan) â†’ ...   â”‚ â”‚
                             â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                             â”‚                                        â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    STATISTICS TABS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         STATISTICS                                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ [Combat] [Exploration] [Progression] [Dice] [Time]                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                      â”‚
    â”‚                         COMBAT STATISTICS                            â”‚
    â”‚                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
    â”‚                                                                      â”‚
    â”‚   Monsters Killed          127          Goblins: 45, Skeletons: 32  â”‚
    â”‚   Bosses Killed              3          Skeleton King, Dragon, Lich â”‚
    â”‚   Total Damage Dealt     4,532          Average: 12.3 per hit       â”‚
    â”‚   Total Damage Taken     1,876          Average: 8.7 per hit        â”‚
    â”‚   Critical Hits             47          Rate: 9.2%                  â”‚
    â”‚   Attacks Missed            89          Miss Rate: 17.4%            â”‚
    â”‚   Abilities Used           234                                       â”‚
    â”‚   Times Defeated             3                                       â”‚
    â”‚                                                                      â”‚
    â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
    â”‚   COMBAT RATING: â˜…â˜…â˜…â˜…â˜† (Skilled Warrior)                           â”‚
    â”‚                                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        DICE STATISTICS                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                      â”‚
    â”‚   Total d20 Rolls          523                                       â”‚
    â”‚   Natural 20s               47          Rate: 9.0% (expected: 5.0%) â”‚
    â”‚   Natural 1s                31          Rate: 5.9% (expected: 5.0%) â”‚
    â”‚   Average d20 Roll        11.2          (expected: 10.5)            â”‚
    â”‚                                                                      â”‚
    â”‚   LUCK RATING: ğŸ€ LUCKY (+6.7% above average)                       â”‚
    â”‚                                                                      â”‚
    â”‚   Current Streak: +3 (3 above-average rolls in a row)               â”‚
    â”‚   Longest Lucky Streak: +7                                          â”‚
    â”‚   Longest Unlucky Streak: -5                                        â”‚
    â”‚                                                                      â”‚
    â”‚   Recent Rolls (d20): 18, 14, 12, 3, 20!, 8, 15, 11, 19, 7         â”‚
    â”‚                                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                        TIME STATISTICS                               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                      â”‚
    â”‚   Total Playtime        12h 34m 56s                                 â”‚
    â”‚   Sessions                    15                                     â”‚
    â”‚   Average Session          50m 20s                                   â”‚
    â”‚   First Played          2026-01-01                                   â”‚
    â”‚   Last Played           2026-01-10                                   â”‚
    â”‚                                                                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### StatisticsView

```csharp
namespace RuneAndRust.Presentation.Views;

/// <summary>
/// View for displaying player statistics.
/// </summary>
public class StatisticsView
{
    private readonly IStatisticsService _statisticsService;
    private readonly IDiceHistoryService _diceHistoryService;
    private readonly StatisticsFormatter _formatter;
    
    public StatisticsView(
        IStatisticsService statisticsService,
        IDiceHistoryService diceHistoryService)
    {
        _statisticsService = statisticsService;
        _diceHistoryService = diceHistoryService;
        _formatter = new StatisticsFormatter();
    }
    
    public void Render(Player player, StatisticCategory? category = null)
    {
        var stats = _statisticsService.GetPlayerStatistics(player);
        var metrics = _statisticsService.GetMetrics(player);
        var diceStats = _diceHistoryService.GetStatistics(player);
        
        RenderHeader();
        RenderTabs(category);
        
        switch (category ?? StatisticCategory.Combat)
        {
            case StatisticCategory.Combat:
                RenderCombatStats(stats, metrics);
                break;
            case StatisticCategory.Exploration:
                RenderExplorationStats(stats);
                break;
            case StatisticCategory.Progression:
                RenderProgressionStats(stats);
                break;
            case StatisticCategory.Dice:
                RenderDiceStats(diceStats);
                break;
            case StatisticCategory.Time:
                RenderTimeStats(stats);
                break;
        }
    }
    
    private void RenderCombatStats(PlayerStatistics stats, StatisticsMetrics metrics)
    {
        Console.WriteLine("                     COMBAT STATISTICS");
        Console.WriteLine("                     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        Console.WriteLine();
        
        RenderStatLine("Monsters Killed", stats.MonstersKilled, 
            FormatTopMonsters(stats.MonstersByType));
        RenderStatLine("Bosses Killed", stats.BossesKilled);
        RenderStatLine("Total Damage Dealt", _formatter.FormatNumber(stats.TotalDamageDealt),
            $"Average: {metrics.AverageDamagePerHit:F1} per hit");
        RenderStatLine("Total Damage Taken", _formatter.FormatNumber(stats.TotalDamageReceived),
            $"Average: {metrics.AverageDamageReceived:F1} per hit");
        RenderStatLine("Critical Hits", stats.CriticalHits,
            $"Rate: {metrics.CriticalHitRate:P1}");
        RenderStatLine("Attacks Missed", stats.AttacksMissed,
            $"Miss Rate: {metrics.MissRate:P1}");
        RenderStatLine("Abilities Used", stats.AbilitiesUsed);
        RenderStatLine("Times Defeated", stats.DeathCount);
        
        Console.WriteLine();
        RenderCombatRating(metrics.CombatRating);
    }
    
    private void RenderDiceStats(DiceStatistics diceStats)
    {
        Console.WriteLine("                      DICE STATISTICS");
        Console.WriteLine("                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        Console.WriteLine();
        
        RenderStatLine("Total d20 Rolls", diceStats.TotalRolls);
        RenderStatLine("Natural 20s", diceStats.TotalNat20s,
            $"Rate: {diceStats.Nat20Rate:P1} (expected: {diceStats.ExpectedNat20Rate:P1})");
        RenderStatLine("Natural 1s", diceStats.TotalNat1s,
            $"Rate: {diceStats.Nat1Rate:P1} (expected: {diceStats.ExpectedNat1Rate:P1})");
        RenderStatLine("Average d20 Roll", $"{diceStats.AverageD20:F1}",
            $"(expected: {diceStats.ExpectedD20:F1})");
        
        Console.WriteLine();
        RenderLuckRating(diceStats.Rating, diceStats.LuckPercentage);
        
        Console.WriteLine();
        RenderStreakInfo(diceStats);
    }
    
    private void RenderLuckRating(LuckRating rating, double percentage)
    {
        var (emoji, label) = rating switch
        {
            LuckRating.Cursed => ("ğŸ˜¢", "CURSED"),
            LuckRating.Unlucky => ("ğŸ˜Ÿ", "Unlucky"),
            LuckRating.Average => ("ğŸ˜", "Average"),
            LuckRating.Lucky => ("ğŸ€", "Lucky"),
            LuckRating.Blessed => ("ğŸŒŸ", "BLESSED"),
            _ => ("", "Unknown")
        };
        
        var sign = percentage >= 0 ? "+" : "";
        Console.WriteLine($"   LUCK RATING: {emoji} {label} ({sign}{percentage:F1}% average)");
    }
    
    private void RenderCombatRating(CombatRating rating)
    {
        var stars = rating switch
        {
            CombatRating.Novice => "â˜…â˜†â˜†â˜†â˜†",
            CombatRating.Apprentice => "â˜…â˜…â˜†â˜†â˜†",
            CombatRating.Journeyman => "â˜…â˜…â˜…â˜†â˜†",
            CombatRating.Skilled => "â˜…â˜…â˜…â˜…â˜†",
            CombatRating.Veteran => "â˜…â˜…â˜…â˜…â˜…",
            CombatRating.Master => "â˜…â˜…â˜…â˜…â˜…+",
            CombatRating.Legend => "ğŸ† LEGEND",
            _ => "â˜†â˜†â˜†â˜†â˜†"
        };
        
        Console.WriteLine($"   COMBAT RATING: {stars} ({rating})");
    }
}
```

### StatisticsFormatter

```csharp
namespace RuneAndRust.Presentation.Formatters;

/// <summary>
/// Formats statistics values for display.
/// </summary>
public class StatisticsFormatter
{
    /// <summary>Formats a number with thousands separators.</summary>
    public string FormatNumber(long value)
    {
        return value.ToString("N0");
    }
    
    /// <summary>Formats a percentage.</summary>
    public string FormatPercent(double value)
    {
        return value.ToString("P1");
    }
    
    /// <summary>Formats a duration.</summary>
    public string FormatDuration(TimeSpan duration)
    {
        if (duration.TotalDays >= 1)
        {
            return $"{(int)duration.TotalDays}d {duration.Hours}h {duration.Minutes}m";
        }
        if (duration.TotalHours >= 1)
        {
            return $"{(int)duration.TotalHours}h {duration.Minutes}m {duration.Seconds}s";
        }
        return $"{duration.Minutes}m {duration.Seconds}s";
    }
    
    /// <summary>Formats a date.</summary>
    public string FormatDate(DateTime date)
    {
        return date.ToString("yyyy-MM-dd");
    }
    
    /// <summary>Formats recent rolls with critical highlights.</summary>
    public string FormatRecentRolls(IReadOnlyList<DiceRollRecord> rolls)
    {
        return string.Join(", ", rolls.Select(r =>
            r.IndividualRolls.Any(v => v == 20) ? $"{r.Result}!" :
            r.IndividualRolls.Any(v => v == 1) ? $"({r.Result})" :
            r.Result.ToString()));
    }
}
```

### StatsCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to view statistics.
/// </summary>
public class StatsCommand : IGameCommand
{
    private readonly StatisticsView _view;
    
    public string Name => "stats";
    public string Description => "View your game statistics";
    public string Usage => "stats [combat|exploration|progression|dice|time]";
    
    public StatsCommand(StatisticsView view)
    {
        _view = view;
    }
    
    public CommandResult Execute(Player player, string[] args)
    {
        StatisticCategory? category = null;
        
        if (args.Length > 0)
        {
            category = args[0].ToLowerInvariant() switch
            {
                "combat" => StatisticCategory.Combat,
                "exploration" or "explore" => StatisticCategory.Exploration,
                "progression" or "progress" => StatisticCategory.Progression,
                "dice" => StatisticCategory.Dice,
                "time" => StatisticCategory.Time,
                _ => null
            };
        }
        
        _view.Render(player, category);
        
        return CommandResult.Success();
    }
}
```

### Acceptance Criteria

- [ ] StatisticsView renders all categories
- [ ] Tabs switch between categories
- [ ] Combat stats show kills, damage, rates
- [ ] Exploration stats show discovery
- [ ] Progression stats show levels, items
- [ ] Dice stats show rolls, luck
- [ ] Time stats show playtime
- [ ] Combat rating calculates
- [ ] Luck rating displays correctly
- [ ] Formatting handles large numbers
- [ ] Stats command works
- [ ] Statistics persist across sessions
- [ ] ~12 unit tests pass

---

## Dependencies & Prerequisites

```
v0.11.2c (Quality System) - REQUIRED
    â”‚
    â””â”€â”€ Crafting System complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
v0.12.0 (Statistics System)                                               â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.12.0a: Core Statistics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: Event system, Domain                            â”‚
    â”‚       Provides: PlayerStatistics, IStatisticsService                â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.12.0b: Dice Roll History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: v0.12.0a, DiceService                           â”‚
    â”‚       Provides: DiceRollHistory, streak detection                   â”‚
    â”‚                                                                     â”‚
    â””â”€â”€ v0.12.0c: Statistics View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: v0.12.0a, v0.12.0b, UI system
            Provides: StatisticsView, StatsCommand
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.12.0a | ~5 | ~3 | ~12 | High |
| v0.12.0b | ~3 | ~2 | ~11 | Medium |
| v0.12.0c | ~3 | ~2 | ~12 | Medium |
| **Total** | **~11** | **~7** | **~35** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Performance with events | Medium | Low | Efficient handlers |
| Statistics overflow | Low | Very Low | Use long integers |
| Streak edge cases | Low | Low | Thorough testing |
| UI layout complexity | Low | Medium | Flexible formatting |

---

## Design Decisions (Confirmed)

### Core Statistics

| Decision | Value | Notes |
|----------|-------|-------|
| **Persistence** | Per-save file | Stats tied to character |
| **Categories** | 5 | Combat, Explore, Progress, Dice, Time |
| **Event-driven** | Yes | Automatic updates |

### Dice History

| Decision | Value | Notes |
|----------|-------|-------|
| **Buffer Size** | 20 rolls | Recent rolls display |
| **Streak Threshold** | â‰¥11 = above avg | Simple d20 division |
| **Luck Thresholds** | Â±5%, Â±10% | Clear categories |

### Statistics View

| Decision | Value | Notes |
|----------|-------|-------|
| **Tab Layout** | 5 categories | Organized display |
| **Combat Rating** | 7 tiers | Fun progression |
| **Number Format** | Thousands sep | Readability |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.12.0a Design Spec** - Create detailed design for Core Statistics
3. **v0.12.0a Implementation** - Build statistics tracking
4. **v0.12.0b Design Spec** - Create specification for Dice History
5. **v0.12.0b Implementation** - Build roll tracking
6. **v0.12.0c Design Spec** - Create specification for Statistics View
7. **v0.12.0c Implementation** - Build statistics UI

---

*This scope breakdown provides a structured approach to implementing v0.12.0 Statistics System. The statistics infrastructure provides the foundation for achievements in v0.12.1.*
