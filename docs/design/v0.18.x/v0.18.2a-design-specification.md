# v0.18.2a Design Specification: CPS Enums & State

**Version:** 0.18.2a
**Parent:** v0.18.2 (Cognitive Paradox Syndrome)
**Prerequisites:** v0.18.0 (Psychic Stress System), v0.6.x (Dice System)
**Status:** Design Complete
**Estimated Unit Tests:** ~5

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [CpsStage Enum](#5-cpsstage-enum)
6. [PanicEffect Enum](#6-paniceffect-enum)
7. [CpsState Value Object](#7-cpsstate-value-object)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Deliverable Checklist](#10-deliverable-checklist)
11. [Acceptance Criteria](#11-acceptance-criteria)
12. [Dependencies](#12-dependencies)
13. [Future Considerations](#13-future-considerations)

---

## 1. Executive Summary

This design specification defines the foundational enums and value object for the **Cognitive Paradox Syndrome (CPS)** system — the mental deterioration from processing reality-bending paradoxes.

v0.18.2a establishes the **Domain Layer Foundation** for CPS by defining:

- `CpsStage` enum — 5 progressive stages of cognitive deterioration
- `PanicEffect` enum — 10 possible Panic Table outcomes
- `CpsState` value object — immutable snapshot of CPS status

### Key Deliverables

| Category          | Items                     |
| ----------------- | ------------------------- |
| **Domain Enums**  | `CpsStage`, `PanicEffect` |
| **Value Objects** | `CpsState`                |
| **Tests**         | ~5 unit tests             |

### CPS Stage Overview

| Stage           | Stress Range | Key Effect                     |
| --------------- | ------------ | ------------------------------ |
| None            | 0-19         | No symptoms                    |
| WeightOfKnowing | 20-39        | Perception distortion          |
| GlimmerMadness  | 40-59        | Reality flickers               |
| RuinMadness     | 60-79        | Panic Table triggers           |
| HollowShell     | 80+          | Terminal state (check or loss) |

---

## 2. Feature Overview

```
v0.18.2a Features
└── CPS Foundation (Domain Layer)
    │
    ├── CpsStage Enum
    │   ├── None (0-19 stress)
    │   ├── WeightOfKnowing (20-39 stress)
    │   ├── GlimmerMadness (40-59 stress)
    │   ├── RuinMadness (60-79 stress)
    │   └── HollowShell (80+ stress)
    │
    ├── PanicEffect Enum
    │   ├── None — No panic
    │   ├── Frozen — Cannot act for 1 round
    │   ├── Scream — Alerts enemies
    │   ├── Flee — Must flee combat
    │   ├── Fetal — Prone + disadvantage
    │   ├── Blackout — Unconscious 1d4 rounds
    │   ├── Denial — Cannot perceive threat
    │   ├── Violence — Attack nearest creature
    │   ├── Catatonia — Stunned until hit
    │   └── Dissociation — Random action
    │
    └── CpsState Value Object
        ├── CurrentStress (0-100)
        ├── Stage (computed)
        ├── RequiresPanicCheck (Stage >= RuinMadness)
        ├── IsTerminal (Stage == HollowShell)
        └── PercentageToHollowShell (computed)
```

### Comparison: Corruption vs CPS

| Aspect          | CorruptionState (v0.18.1a) | CpsState (v0.18.2a)          |
| --------------- | -------------------------- | ---------------------------- |
| Source Resource | Corruption (0-100)         | Psychic Stress (0-100)       |
| Stage Count     | 6 stages                   | 5 stages                     |
| Terminal State  | Consumed → Mutation        | HollowShell → Character Loss |
| Random Trigger  | Threshold effects          | Panic Table at RuinMadness   |
| Recovery        | Near-impossible            | Rest-based (via Stress)      |

---

## 3. Architecture Diagrams

### 3.1 Domain Layer Structure

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          DOMAIN LAYER                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                          ENUMS                                   │    │
│  ├──────────────────────────────┬──────────────────────────────────┤    │
│  │         CpsStage             │         PanicEffect              │    │
│  ├──────────────────────────────┼──────────────────────────────────┤    │
│  │ None            = 0          │ None           = 0               │    │
│  │ WeightOfKnowing = 1          │ Frozen         = 1               │    │
│  │ GlimmerMadness  = 2          │ Scream         = 2               │    │
│  │ RuinMadness     = 3          │ Flee           = 3               │    │
│  │ HollowShell     = 4          │ Fetal          = 4               │    │
│  │                              │ Blackout       = 5               │    │
│  │                              │ Denial         = 6               │    │
│  │                              │ Violence       = 7               │    │
│  │                              │ Catatonia      = 8               │    │
│  │                              │ Dissociation   = 9               │    │
│  └──────────────────────────────┴──────────────────────────────────┘    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    CpsState (Value Object)                       │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │  Properties:                                                     │    │
│  │  + CurrentStress: int (0-100)                                   │    │
│  │  + Stage: CpsStage (computed from stress)                       │    │
│  │  + RequiresPanicCheck: bool (Stage >= RuinMadness)              │    │
│  │  + IsTerminal: bool (Stage == HollowShell)                      │    │
│  │  + PercentageToHollowShell: double (stress / 80.0)              │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │  Constants:                                                      │    │
│  │  + MinStress = 0                                                 │    │
│  │  + MaxStress = 100                                               │    │
│  │  + WeightOfKnowingThreshold = 20                                │    │
│  │  + GlimmerMadnessThreshold = 40                                 │    │
│  │  + RuinMadnessThreshold = 60                                    │    │
│  │  + HollowShellThreshold = 80                                    │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │  Factory:                                                        │    │
│  │  + Create(int stress): CpsState                                 │    │
│  │  + DetermineStage(int stress): CpsStage                         │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 CPS Stage Determination Flowchart

```
                    ┌────────────────────────┐
                    │   Current Stress Value │
                    └───────────┬────────────┘
                                │
           ┌────────────────────┼────────────────────┐
           │                    │                    │
           ▼                    ▼                    ▼
    ┌─────────────┐     ┌─────────────┐      ┌─────────────┐
    │ stress < 20 │     │ 20 ≤ s < 40 │      │ 40 ≤ s < 60 │
    │             │     │             │      │             │
    │   = None    │     │   = Weight  │      │  = Glimmer  │
    │             │     │  OfKnowing  │      │   Madness   │
    └─────────────┘     └─────────────┘      └─────────────┘
           │                    │                    │
           │                    │                    │
           │                    ▼                    │
           │            ┌─────────────┐              │
           │            │ 60 ≤ s < 80 │              │
           │            │             │              │
           │            │   = Ruin    │              │
           │            │   Madness   │◄─────────────┘
           │            │ (PANIC!)    │
           │            └─────────────┘
           │                    │
           │                    ▼
           │            ┌─────────────┐
           │            │  stress ≥ 80│
           │            │             │
           └───────────►│  = Hollow   │
                        │    Shell    │
                        │ (TERMINAL!) │
                        └─────────────┘
```

### 3.3 Panic Effect Decision Tree

```
           ┌────────────────────────────────────┐
           │   Combat/Horror Event Triggered    │
           │   (While in RuinMadness Stage)     │
           └────────────────┬───────────────────┘
                            │
                            ▼
           ┌────────────────────────────────────┐
           │       Roll d10 on Panic Table      │
           └────────────────┬───────────────────┘
                            │
     ┌──────┬──────┬──────┬─┴──┬──────┬──────┬──────┬──────┬──────┐
     │      │      │      │    │      │      │      │      │      │
     ▼      ▼      ▼      ▼    ▼      ▼      ▼      ▼      ▼      ▼
   ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐
   │ 1 │ │ 2 │ │ 3 │ │ 4 │ │ 5 │ │ 6 │ │ 7 │ │ 8 │ │ 9 │ │10 │
   └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘ └─┬─┘
     │     │     │     │     │     │     │     │     │     │
     ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼     ▼
  Frozen Scream Flee Fetal Black Denial Viol Cata Disso None
                            out               ence tonia ciat
```

---

## 4. User Stories

### US-18.2a-1: Determine CPS Stage from Stress

**As a** stress system developer
**I want to** determine CPS stage from current psychic stress
**So that** stage-appropriate effects can be applied

**Acceptance Criteria:**

- Stage correctly determined for all stress ranges
- Boundary values handled correctly (e.g., 19 → None, 20 → WeightOfKnowing)
- Stress clamped to 0-100 range

### US-18.2a-2: Identify Terminal State

**As a** game master system
**I want to** identify when a character reaches HollowShell
**So that** character loss procedures can be initiated

**Acceptance Criteria:**

- `IsTerminal` true when stress ≥ 80
- `Stage` returns `HollowShell` at threshold

### US-18.2a-3: Identify Panic Check Requirement

**As a** combat system developer
**I want to** know when Panic Table checks are required
**So that** appropriate random effects can be triggered

**Acceptance Criteria:**

- `RequiresPanicCheck` true for RuinMadness and HollowShell
- False for None, WeightOfKnowing, GlimmerMadness

### US-18.2a-4: Track Progress to Terminal

**As a** UI component
**I want to** display progress toward HollowShell
**So that** players understand their mental state risk

**Acceptance Criteria:**

- `PercentageToHollowShell` calculated as stress/80
- Capped at 1.0 (100%) when stress ≥ 80

---

## 5. CpsStage Enum

### 5.1 Purpose

Defines the five progressive stages of Cognitive Paradox Syndrome, representing mental deterioration from processing reality-bending paradoxes.

### 5.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/CpsStage.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the stages of Cognitive Paradox Syndrome (CPS).
/// </summary>
/// <remarks>
/// <para>
/// CPS is the mental deterioration from processing reality-bending paradoxes.
/// Unlike corruption (physical taint), CPS represents the mind's inability
/// to reconcile impossible experiences with normal cognition.
/// </para>
/// <para>
/// Stage Thresholds (based on Psychic Stress):
/// <list type="bullet">
/// <item>None: 0-19 stress — Clear-minded, no symptoms</item>
/// <item>WeightOfKnowing: 20-39 stress — Reality feels "off"</item>
/// <item>GlimmerMadness: 40-59 stress — Reality flickers and distorts</item>
/// <item>RuinMadness: 60-79 stress — Panic Table triggers on stress events</item>
/// <item>HollowShell: 80+ stress — Terminal state, survival check required</item>
/// </list>
/// </para>
/// <para>
/// Unlike corruption stages, CPS is directly derived from Psychic Stress
/// and can recover when stress is reduced through rest or abilities.
/// </para>
/// </remarks>
public enum CpsStage
{
    /// <summary>
    /// No cognitive impairment (0-19 stress).
    /// </summary>
    /// <remarks>
    /// The character's mind is clear and unaffected by paradox exposure.
    /// No mechanical penalties or special behaviors.
    /// </remarks>
    None = 0,

    /// <summary>
    /// Initial stage of cognitive strain (20-39 stress).
    /// </summary>
    /// <remarks>
    /// <para>
    /// "The Weight of Knowing" — reality feels subtly wrong.
    /// The character perceives minor distortions at the edge of vision.
    /// </para>
    /// <para>
    /// UI Effects: Occasional text flickers, subtle color shifts.
    /// </para>
    /// </remarks>
    WeightOfKnowing = 1,

    /// <summary>
    /// Moderate cognitive deterioration (40-59 stress).
    /// </summary>
    /// <remarks>
    /// <para>
    /// "Glimmer Madness" — reality actively flickers.
    /// Objects and entities may appear duplicated or distorted.
    /// </para>
    /// <para>
    /// UI Effects: More frequent distortions, unreliable perception hints.
    /// </para>
    /// </remarks>
    GlimmerMadness = 2,

    /// <summary>
    /// Severe cognitive impairment (60-79 stress).
    /// </summary>
    /// <remarks>
    /// <para>
    /// "Ruin Madness" — the mind fractures under paradox weight.
    /// Panic Table rolls triggered on stress-inducing events.
    /// </para>
    /// <para>
    /// UI Effects: Major distortions, unreliable information.
    /// Combat Effects: d10 Panic Table on combat/horror triggers.
    /// </para>
    /// </remarks>
    RuinMadness = 3,

    /// <summary>
    /// Terminal cognitive collapse (80+ stress).
    /// </summary>
    /// <remarks>
    /// <para>
    /// "Hollow Shell" — the mind has shattered.
    /// Character must pass survival check or be lost permanently.
    /// </para>
    /// <para>
    /// Terminal State: WILL check vs DC 4 to survive.
    /// Failure: Character becomes unplayable NPC.
    /// Success: Stress reduced to 79, character survives but scarred.
    /// </para>
    /// </remarks>
    HollowShell = 4
}
```

---

## 6. PanicEffect Enum

### 6.1 Purpose

Defines the possible outcomes of Panic Table rolls triggered during RuinMadness stage.

### 6.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/PanicEffect.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the possible effects from a Panic Table roll.
/// </summary>
/// <remarks>
/// <para>
/// The Panic Table is triggered when a character in RuinMadness stage
/// experiences a stress-inducing event (combat start, horror encounter).
/// Roll d10 to determine the effect.
/// </para>
/// <para>
/// Panic Table (d10):
/// <list type="bullet">
/// <item>1: Frozen — Cannot act for 1 round</item>
/// <item>2: Scream — Involuntary scream alerts enemies</item>
/// <item>3: Flee — Must attempt to flee combat</item>
/// <item>4: Fetal — Drop prone, disadvantage until recovered</item>
/// <item>5: Blackout — Fall unconscious for 1d4 rounds</item>
/// <item>6: Denial — Cannot perceive the threatening entity</item>
/// <item>7: Violence — Attack nearest creature (friend or foe)</item>
/// <item>8: Catatonia — Stunned until taking damage</item>
/// <item>9: Dissociation — Take random action</item>
/// <item>10: None — Lucky break, no panic effect</item>
/// </list>
/// </para>
/// </remarks>
public enum PanicEffect
{
    /// <summary>
    /// No panic effect (rolled 10 on Panic Table).
    /// </summary>
    None = 0,

    /// <summary>
    /// Character freezes and cannot act for 1 round.
    /// </summary>
    /// <remarks>
    /// The character's mind locks up. They lose their next turn
    /// but can still be moved by allies.
    /// </remarks>
    Frozen = 1,

    /// <summary>
    /// Character screams involuntarily, alerting nearby enemies.
    /// </summary>
    /// <remarks>
    /// Any unaware enemies within hearing range become alerted.
    /// May trigger additional encounters in exploration mode.
    /// </remarks>
    Scream = 2,

    /// <summary>
    /// Character must attempt to flee combat immediately.
    /// </summary>
    /// <remarks>
    /// The character must use their action to Disengage and move
    /// away from all threats. Lasts until they leave combat or
    /// pass a WILL check (DC 2) at start of their turn.
    /// </remarks>
    Flee = 3,

    /// <summary>
    /// Character drops prone and has disadvantage until recovered.
    /// </summary>
    /// <remarks>
    /// The character curls into fetal position. They are Prone
    /// and have disadvantage on all checks until they use an
    /// action to stand and compose themselves.
    /// </remarks>
    Fetal = 4,

    /// <summary>
    /// Character falls unconscious for 1d4 rounds.
    /// </summary>
    /// <remarks>
    /// The mind shuts down temporarily. Character is unconscious
    /// and cannot be woken by normal means during this duration.
    /// </remarks>
    Blackout = 5,

    /// <summary>
    /// Character cannot perceive the threatening entity.
    /// </summary>
    /// <remarks>
    /// The mind refuses to acknowledge the threat. Character cannot
    /// target or react to the triggering entity for 1d4 rounds.
    /// They may still be harmed by it.
    /// </remarks>
    Denial = 6,

    /// <summary>
    /// Character attacks the nearest creature regardless of allegiance.
    /// </summary>
    /// <remarks>
    /// Panic-induced violence. On their next turn, the character must
    /// attack the nearest creature (friend or foe) with their best
    /// available attack.
    /// </remarks>
    Violence = 7,

    /// <summary>
    /// Character is stunned until they take damage.
    /// </summary>
    /// <remarks>
    /// Complete mental shutdown. Character is Stunned and remains
    /// so until they take any amount of damage (waking them up).
    /// </remarks>
    Catatonia = 8,

    /// <summary>
    /// Character takes a random action determined by GM/system.
    /// </summary>
    /// <remarks>
    /// Mind and body disconnect. On their turn, the character takes
    /// a random action (move in random direction, use random ability,
    /// speak nonsense). Duration: 1 round.
    /// </remarks>
    Dissociation = 9
}
```

---

## 7. CpsState Value Object

### 7.1 Purpose

Immutable value object representing a snapshot of a character's CPS status, derived from their current Psychic Stress level.

### 7.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/CpsState.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents an immutable snapshot of a character's Cognitive Paradox Syndrome state.
/// </summary>
/// <remarks>
/// <para>
/// CpsState is derived from Psychic Stress and represents the mind's deterioration
/// from processing reality-bending paradoxes. Unlike CorruptionState, CPS can
/// improve when stress is reduced through rest or abilities.
/// </para>
/// <para>
/// Stage Thresholds:
/// <list type="bullet">
/// <item>None: 0-19 stress</item>
/// <item>WeightOfKnowing: 20-39 stress</item>
/// <item>GlimmerMadness: 40-59 stress</item>
/// <item>RuinMadness: 60-79 stress (Panic Table active)</item>
/// <item>HollowShell: 80+ stress (Terminal — survival check required)</item>
/// </list>
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var cpsState = CpsState.Create(stress: 65);
/// // cpsState.Stage == CpsStage.RuinMadness
/// // cpsState.RequiresPanicCheck == true
/// // cpsState.IsTerminal == false
/// // cpsState.PercentageToHollowShell == 0.8125
/// </code>
/// </example>
public readonly record struct CpsState
{
    #region Constants

    /// <summary>Minimum stress value.</summary>
    public const int MinStress = 0;

    /// <summary>Maximum stress value.</summary>
    public const int MaxStress = 100;

    /// <summary>Stress threshold for WeightOfKnowing stage.</summary>
    public const int WeightOfKnowingThreshold = 20;

    /// <summary>Stress threshold for GlimmerMadness stage.</summary>
    public const int GlimmerMadnessThreshold = 40;

    /// <summary>Stress threshold for RuinMadness stage (Panic Table active).</summary>
    public const int RuinMadnessThreshold = 60;

    /// <summary>Stress threshold for HollowShell stage (Terminal).</summary>
    public const int HollowShellThreshold = 80;

    #endregion

    #region Properties

    /// <summary>
    /// Gets the current psychic stress level (0-100).
    /// </summary>
    public int CurrentStress { get; private init; }

    /// <summary>
    /// Gets the current CPS stage based on stress level.
    /// </summary>
    public CpsStage Stage { get; private init; }

    /// <summary>
    /// Gets whether the character requires Panic Table checks.
    /// </summary>
    /// <remarks>
    /// True when Stage is RuinMadness or higher.
    /// Panic checks are triggered by combat/horror events.
    /// </remarks>
    public bool RequiresPanicCheck { get; private init; }

    /// <summary>
    /// Gets whether the character is in terminal CPS state.
    /// </summary>
    /// <remarks>
    /// True when Stage is HollowShell. Character must pass
    /// survival check or become unplayable.
    /// </remarks>
    public bool IsTerminal { get; private init; }

    /// <summary>
    /// Gets the percentage progress toward HollowShell threshold.
    /// </summary>
    /// <remarks>
    /// Calculated as CurrentStress / HollowShellThreshold.
    /// Capped at 1.0 (100%) when stress >= 80.
    /// </remarks>
    public double PercentageToHollowShell { get; private init; }

    #endregion

    #region Factory Methods

    /// <summary>
    /// Creates a new CpsState from the given stress value.
    /// </summary>
    /// <param name="stress">The current psychic stress (0-100).</param>
    /// <returns>An immutable CpsState snapshot.</returns>
    /// <example>
    /// <code>
    /// var state = CpsState.Create(45);
    /// // state.Stage == CpsStage.GlimmerMadness
    /// </code>
    /// </example>
    public static CpsState Create(int stress)
    {
        var clampedStress = Math.Clamp(stress, MinStress, MaxStress);
        var stage = DetermineStage(clampedStress);

        return new CpsState
        {
            CurrentStress = clampedStress,
            Stage = stage,
            RequiresPanicCheck = stage >= CpsStage.RuinMadness,
            IsTerminal = stage == CpsStage.HollowShell,
            PercentageToHollowShell = Math.Min(1.0, clampedStress / (double)HollowShellThreshold)
        };
    }

    /// <summary>
    /// Determines the CPS stage for a given stress value.
    /// </summary>
    /// <param name="stress">The psychic stress value.</param>
    /// <returns>The corresponding CpsStage.</returns>
    public static CpsStage DetermineStage(int stress) =>
        stress switch
        {
            >= HollowShellThreshold => CpsStage.HollowShell,
            >= RuinMadnessThreshold => CpsStage.RuinMadness,
            >= GlimmerMadnessThreshold => CpsStage.GlimmerMadness,
            >= WeightOfKnowingThreshold => CpsStage.WeightOfKnowing,
            _ => CpsStage.None
        };

    #endregion

    #region Display

    /// <inheritdoc/>
    public override string ToString() =>
        $"CPS[{Stage}]: Stress={CurrentStress}" +
        (RequiresPanicCheck ? " [PANIC CHECK]" : "") +
        (IsTerminal ? " [TERMINAL!]" : "");

    #endregion
}
```

---

## 8. Logging Specifications

### 8.1 Domain Layer Logging

> **Note:** Enums and value objects do not log directly.
> All logging occurs in Application Layer services (v0.18.2d).

### 8.2 Expected Log Events (Future Implementation)

| Event                  | Level       | Template                                                     |
| ---------------------- | ----------- | ------------------------------------------------------------ |
| CPS Stage Changed      | Information | `"CPS stage changed: {CharacterId} {OldStage} → {NewStage}"` |
| Panic Check Required   | Warning     | `"Panic check required for {CharacterId}: Stage={Stage}"`    |
| Terminal State Reached | Error       | `"HOLLOW SHELL: {CharacterId} reached terminal CPS state"`   |

---

## 9. Unit Testing Requirements

### 9.1 Test File Location

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CpsStateTests.cs`

### 9.2 Required Tests

| Test Name                                           | Description                                                         |
| --------------------------------------------------- | ------------------------------------------------------------------- |
| `Create_WithZeroStress_ReturnsNoneStage`            | Verify None stage at 0 stress                                       |
| `Create_AtBoundaryValues_ReturnsCorrectStages`      | Verify all threshold boundaries (19→None, 20→WeightOfKnowing, etc.) |
| `Create_WithMaxStress_ReturnsTerminalState`         | Verify HollowShell and IsTerminal at 100 stress                     |
| `RequiresPanicCheck_TrueOnlyForRuinMadnessAndAbove` | Verify panic check flag logic                                       |
| `PercentageToHollowShell_CalculatesCorrectly`       | Verify percentage calculation and capping                           |

### 9.3 Example Test

```csharp
[TestFixture]
public class CpsStateTests
{
    [Test]
    public void Create_WithZeroStress_ReturnsNoneStage()
    {
        // Arrange & Act
        var state = CpsState.Create(0);

        // Assert
        state.Stage.Should().Be(CpsStage.None);
        state.CurrentStress.Should().Be(0);
        state.RequiresPanicCheck.Should().BeFalse();
        state.IsTerminal.Should().BeFalse();
        state.PercentageToHollowShell.Should().Be(0);
    }

    [TestCase(19, CpsStage.None)]
    [TestCase(20, CpsStage.WeightOfKnowing)]
    [TestCase(39, CpsStage.WeightOfKnowing)]
    [TestCase(40, CpsStage.GlimmerMadness)]
    [TestCase(59, CpsStage.GlimmerMadness)]
    [TestCase(60, CpsStage.RuinMadness)]
    [TestCase(79, CpsStage.RuinMadness)]
    [TestCase(80, CpsStage.HollowShell)]
    [TestCase(100, CpsStage.HollowShell)]
    public void Create_AtBoundaryValues_ReturnsCorrectStages(int stress, CpsStage expected)
    {
        // Arrange & Act
        var state = CpsState.Create(stress);

        // Assert
        state.Stage.Should().Be(expected);
    }

    [Test]
    public void Create_WithMaxStress_ReturnsTerminalState()
    {
        // Arrange & Act
        var state = CpsState.Create(100);

        // Assert
        state.Stage.Should().Be(CpsStage.HollowShell);
        state.IsTerminal.Should().BeTrue();
        state.RequiresPanicCheck.Should().BeTrue();
        state.PercentageToHollowShell.Should().Be(1.0);
    }

    [TestCase(0, false)]
    [TestCase(19, false)]
    [TestCase(40, false)]
    [TestCase(59, false)]
    [TestCase(60, true)]
    [TestCase(79, true)]
    [TestCase(80, true)]
    public void RequiresPanicCheck_TrueOnlyForRuinMadnessAndAbove(int stress, bool expected)
    {
        // Arrange & Act
        var state = CpsState.Create(stress);

        // Assert
        state.RequiresPanicCheck.Should().Be(expected);
    }

    [TestCase(0, 0.0)]
    [TestCase(40, 0.5)]
    [TestCase(80, 1.0)]
    [TestCase(100, 1.0)]
    public void PercentageToHollowShell_CalculatesCorrectly(int stress, double expected)
    {
        // Arrange & Act
        var state = CpsState.Create(stress);

        // Assert
        state.PercentageToHollowShell.Should().BeApproximately(expected, 0.001);
    }
}
```

---

## 10. Deliverable Checklist

### 10.1 Domain Layer

- [ ] `src/Core/RuneAndRust.Domain/Enums/CpsStage.cs`
- [ ] `src/Core/RuneAndRust.Domain/Enums/PanicEffect.cs`
- [ ] `src/Core/RuneAndRust.Domain/ValueObjects/CpsState.cs`

### 10.2 Tests

- [ ] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CpsStateTests.cs`

### 10.3 Documentation

- [ ] Update `docs/design/v0.18.x/v0.18.2-scope-breakdown.md` (mark v0.18.2a complete)
- [ ] Create `docs/changelogs/v0.18.2a-changelog.md`

---

## 11. Acceptance Criteria

### 11.1 Build Verification

- [ ] Solution builds without errors
- [ ] Solution builds without warnings in new code

### 11.2 Test Verification

- [ ] All new unit tests pass
- [ ] All existing unit tests continue to pass

### 11.3 Functional Verification

- [ ] `CpsStage` enum contains all 5 stages
- [ ] `PanicEffect` enum contains all 10 effects
- [ ] `CpsState.Create()` correctly determines stage from stress
- [ ] `CpsState.DetermineStage()` handles all boundary values
- [ ] `RequiresPanicCheck` true only for RuinMadness and HollowShell
- [ ] `IsTerminal` true only for HollowShell
- [ ] `PercentageToHollowShell` capped at 1.0

---

## 12. Dependencies

### 12.1 Required Prerequisites

| Dependency            | Version | Status   | Notes                            |
| --------------------- | ------- | -------- | -------------------------------- |
| Psychic Stress System | v0.18.0 | Required | CPS derives from stress values   |
| Dice System           | v0.6.x  | Required | For Panic Table rolls (v0.18.2d) |
| Status Effects        | v0.10.x | Required | For panic effect application     |

### 12.2 Deferred to Later Phases

| Item                       | Deferred To | Reason                              |
| -------------------------- | ----------- | ----------------------------------- |
| `ICpsService` interface    | v0.18.2c    | Service contract defined separately |
| Panic Table implementation | v0.18.2d    | Requires `IDiceService` integration |
| UI distortion effects      | v0.18.2d    | Presentation layer concern          |

---

## 13. Future Considerations

### 13.1 v0.18.2b (Panic & Result Objects)

- `PanicResult` value object for tracking panic outcomes
- `CpsStageChangeResult` for stage transition tracking
- `CpsUiEffects` for visual distortion configuration
- `CpsRecoveryProtocol` for recovery procedure definitions

### 13.2 v0.18.2c (ICpsService Interface)

- Service contract for CPS operations
- Integration with `IStressService`
- Panic Table roll triggering

### 13.3 v0.18.2d (CpsService Implementation)

- Full service implementation
- Configuration loading from JSON
- Integration with combat and exploration systems
