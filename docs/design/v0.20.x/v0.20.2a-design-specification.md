# Design Specification: v0.20.2a - Framework & Tier 1 Abilities (Rúnasmiðr)

**Version:** v0.20.2a
**Status:** Design Phase
**Last Updated:** 2026-01-28
**Target Tests:** ~10 unit and integration tests
**Specialization:** Rúnasmiðr (Runesmith)
**Theme:** Inscriber of Power

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Domain Layer Specifications](#5-domain-layer-specifications)
6. [Application Layer Specifications](#6-application-layer-specifications)
7. [Infrastructure Layer Specifications](#7-infrastructure-layer-specifications)
8. [Rune Charges Resource](#8-rune-charges-resource)
9. [Inscribe Rune Ability](#9-inscribe-rune-ability)
10. [Read the Marks Ability](#10-read-the-marks-ability)
11. [Runestone Ward Ability](#11-runestone-ward-ability)
12. [Decision Trees and Flow Diagrams](#12-decision-trees-and-flow-diagrams)
13. [Configuration Files](#13-configuration-files)
14. [Code Examples](#14-code-examples)
15. [Logging Specifications](#15-logging-specifications)
16. [Unit Testing Requirements](#16-unit-testing-requirements)
17. [Deliverable Checklist](#17-deliverable-checklist)
18. [Acceptance Criteria](#18-acceptance-criteria)
19. [Dependencies](#19-dependencies)
20. [Deferrals and Future Considerations](#20-deferrals-and-future-considerations)

---

## 1. Executive Summary

Version 0.20.2a implements the **Rúnasmiðr (Runesmith)** specialization framework for the Adept archetype. This phase establishes the foundational architecture including the Rune Charges special resource system and implements the three Tier 1 abilities that define the core inscription identity.

### Key Deliverables

| Category | Count | Details |
|----------|-------|---------|
| **Domain Value Objects** | 3 | RuneChargeResource, InscribedRune, RunestoneWard |
| **Domain Enums** | 2 | RunasmidrAbilityId, RuneType |
| **Application Services** | 2 | RuneChargeService, RunasmidrAbilityService |
| **Ability Implementations** | 3 | Inscribe Rune, Read the Marks, Runestone Ward |
| **Configuration Files** | 2 | specializations.json updates, abilities.json updates |
| **Unit Tests** | ~10 | Comprehensive test coverage |

### Rúnasmiðr Identity

| Attribute | Value |
|-----------|-------|
| **Display Name** | Rúnasmiðr |
| **Pronunciation** | ROO-nah-smithr |
| **Translation** | Runesmith |
| **Archetype** | Adept |
| **Path Type** | Coherent |
| **Special Resource** | Rune Charges (Max 5) |
| **Tagline** | "Inscriber of Power" |

---

## 2. Feature Overview

### 2.1 Rune Charges Resource

**Purpose:** Special resource that powers inscription abilities. Generated through crafting activities and restored during rest periods.

**Key Characteristics:**
- Maximum capacity: 5 charges
- Starting value: 5 charges
- Generation: 1 charge per standard craft, 2 charges per complex craft
- Restoration: Full restoration on long rest
- Consumption: Spent by active abilities (1-4 charges per ability)

### 2.2 Tier 1 Abilities

#### Inscribe Rune (Active)
**AP Cost:** 3 | **Resource Cost:** 1 Rune Charge | **Duration:** 10 turns

Temporarily enhance weapon or armor with inscribed runes:
- Weapon: +2 damage for 10 turns
- Armor: +1 Defense for 10 turns
- Only one rune per item at a time
- Visual indicator shows inscribed items

#### Read the Marks (Passive)
**Effect:** Automatic Jötun technology identification

Bypass normal Perception/Lore checks for Jötun items:
- Automatically identify Jötun technology when examining
- Reveals function, origin, and potential uses
- Provides lore text snippets for identified items
- Synergizes with v0.15.6 Perception system

#### Runestone Ward (Active)
**AP Cost:** 2 | **Resource Cost:** 1 Rune Charge | **Duration:** Until destroyed

Create defensive ward that absorbs incoming damage:
- Absorbs up to 10 damage before HP
- Destroyed when absorption depleted
- Can be refreshed by casting again
- Maximum 1 active ward per character

---

## 3. Architecture Diagrams

### 3.1 Domain Layer Architecture

```
┌──────────────────────────────────────────────────────────────┐
│         v0.20.2a Rúnasmiðr Domain Layer                      │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────────┐  ┌──────────────────┐                  │
│  │ RuneChargeRes.   │  │  RuneType Enum   │                  │
│  ├──────────────────┤  ├──────────────────┤                  │
│  │ -CurrentCharges  │  │ • Enhancement    │                  │
│  │ -MaxCharges      │  │ • Protection     │                  │
│  │ -LastGeneratedAt │  │ • Elemental      │                  │
│  │ +Spend()         │  │ • Ward           │                  │
│  │ +Generate()      │  │ • Trap           │                  │
│  │ +GenFromCraft()  │  └──────────────────┘                  │
│  └──────────────────┘                                         │
│                                                               │
│  ┌──────────────────────┐  ┌──────────────────────┐          │
│  │ InscribedRune        │  │ RunestoneWard        │          │
│  ├──────────────────────┤  ├──────────────────────┤          │
│  │ -RuneId              │  │ -WardId              │          │
│  │ -RuneType            │  │ -OwnerId             │          │
│  │ -TargetItemId        │  │ -DamageAbsorption    │          │
│  │ -EnhancementBonus    │  │ -RemainingAbsorption │          │
│  │ -ElementalType       │  │ -CreatedAt           │          │
│  │ -Duration            │  │ +AbsorbDamage()      │          │
│  │ +Tick()              │  │ +IsDestroyed()       │          │
│  │ +IsExpired()         │  │ +GetRemaining()      │          │
│  │ +GetEffectDesc()     │  └──────────────────────┘          │
│  └──────────────────────┘                                     │
│                                                               │
│  ┌────────────────────────────────────────────────┐          │
│  │ RunasmidrAbilityId Enum                        │          │
│  ├────────────────────────────────────────────────┤          │
│  │ • InscribeRune                                 │          │
│  │ • ReadTheMarks                                 │          │
│  │ • RunestoneWard                                │          │
│  │ • EmpoweredInscription (v0.20.2b)              │          │
│  │ • RunicTrap (v0.20.2b)                         │          │
│  │ • DvergrTechniques (v0.20.2b)                  │          │
│  │ • MasterScrivener (v0.20.2c)                   │          │
│  │ • LivingRunes (v0.20.2c)                       │          │
│  │ • WordOfUnmaking (v0.20.2c)                    │          │
│  └────────────────────────────────────────────────┘          │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

### 3.2 Application Layer Architecture

```
┌──────────────────────────────────────────────────────────────┐
│         v0.20.2a Application Services Layer                  │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌────────────────────────┐  ┌──────────────────────────┐    │
│  │ IRuneChargeService     │  │ IRúnasmiðrAbilityService │    │
│  ├────────────────────────┤  ├──────────────────────────┤    │
│  │ +Spend(int)            │  │ +InscribeRune()          │    │
│  │ +Generate(int)         │  │ +GetRuneCharges()        │    │
│  │ +GenerateFromCraft()   │  │ +CanCastAbility()        │    │
│  │ +GetCurrentCharges()   │  │ +ExecuteAbility()        │    │
│  │ +GetMaxCharges()       │  │ +CalculateCost()         │    │
│  │ +GetLastGenerated()    │  │ +GetAbilityById()        │    │
│  │ +RestoreAllCharges()   │  └──────────────────────────┘    │
│  └────────────────────────┘                                  │
│           │                                                   │
│           └───────────────────────┬────────────────────────   │
│                                   │                           │
│  ┌────────────────────────────────▼──────────────────────┐   │
│  │ RuneChargeServiceImpl / RunasmidrAbilityServiceImpl     │   │
│  ├───────────────────────────────────────────────────────┤   │
│  │ - Character Validation                                │   │
│  │ - Charge Balance Checking                             │   │
│  │ - Ability Execution Logic                             │   │
│  │ - Duration and Effect Tracking                        │   │
│  └───────────────────────────────────────────────────────┘   │
│                                                               │
└──────────────────────────────────────────────────────────────┘

Resource Usage Flow:
┌──────────────────┐   Crafting    ┌──────────────────┐
│ Crafting System  │ ──────────────▶ Rune Charges     │
│ (v0.17.x)        │   Generate     │ Service         │
└──────────────────┘  1-2 charges   └──────────────────┘
                                            │
                              ┌─────────────┼──────────────┐
                              │             │              │
                              ▼             ▼              ▼
                      ┌──────────────┐ ┌─────────────┐ ┌──────────────┐
                      │ Inscribe     │ │ Runestone   │ │ Other Tier 2 │
                      │ Rune (1 ch)  │ │ Ward (1 ch) │ │ Abilities    │
                      └──────────────┘ └─────────────┘ └──────────────┘
```

### 3.3 Infrastructure Layer

```
┌──────────────────────────────────────────────────────────────┐
│         v0.20.2a Configuration Layer                         │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────────────────────────────────────────────┐    │
│  │ specializations.json                                 │    │
│  ├──────────────────────────────────────────────────────┤    │
│  │ {                                                    │    │
│  │   "specializations": [                               │    │
│  │     {                                                │    │
│  │       "specializationId": "Runasmidr",               │    │
│  │       "displayName": "Rúnasmiðr",                    │    │
│  │       "specialResource": {                           │    │
│  │         "resourceId": "rune-charges",                │    │
│  │         "maxValue": 5                                │    │
│  │       },                                             │    │
│  │       "abilityTiers": [...]                          │    │
│  │     }                                                │    │
│  │   ]                                                  │    │
│  │ }                                                    │    │
│  └──────────────────────────────────────────────────────┘    │
│                                                               │
│  ┌──────────────────────────────────────────────────────┐    │
│  │ abilities.json (Rúnasmiðr Section)                   │    │
│  ├──────────────────────────────────────────────────────┤    │
│  │ {                                                    │    │
│  │   "abilities": [                                     │    │
│  │     {                                                │    │
│  │       "abilityId": "inscribe-rune",                  │    │
│  │       "displayName": "Inscribe Rune",                │    │
│  │       "tier": 1,                                     │    │
│  │       "apCost": 3,                                   │    │
│  │       "resourceCost": { ... }                        │    │
│  │     },                                               │    │
│  │     ...                                              │    │
│  │   ]                                                  │    │
│  │ }                                                    │    │
│  └──────────────────────────────────────────────────────┘    │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

---

## 4. User Stories

### User Story 1: Runesmith Enhances Weapon Before Combat

**As a** Rúnasmiðr character preparing for battle
**I want to** inscribe runes on my weapon to boost damage
**So that** I have an edge in combat

**Acceptance Criteria:**
- Character has at least 1 Rune Charge available
- Inscribe Rune costs 3 AP and 1 Rune Charge
- Weapon gains +2 damage for 10 turns
- Only one rune per item at a time (no stacking)
- UI shows inscribed item with visual indicator
- Rune expires automatically after 10 turns

### User Story 2: Runesmith Identifies Jötun Technology

**As a** Rúnasmiðr character examining ancient artifacts
**I want to** automatically identify Jötun technology without difficulty checks
**So that** I can quickly understand the artifact's purpose and potential

**Acceptance Criteria:**
- Read the Marks activates automatically on Jötun item examination
- No Perception or Lore check required
- Identification reveals function, origin, and uses
- Lore text snippets provided automatically
- Works with all Jötun technology items (weapons, armor, crafting materials, traps)
- Can be triggered in exploration or combat scenarios

### User Story 3: Runesmith Creates Protective Ward

**As a** Rúnasmiðr character in danger
**I want to** create a defensive ward to absorb incoming damage
**So that** I can survive additional hits in combat

**Acceptance Criteria:**
- Runestone Ward costs 2 AP and 1 Rune Charge
- Ward absorbs up to 10 damage before hitting HP
- Only one ward active per character at a time
- Ward is destroyed when absorption depleted
- Can refresh ward by casting again (replaces old ward)
- UI shows remaining ward absorption capacity
- Ward persists until destroyed or replaced

### User Story 4: Runesmith Generates Charges Through Crafting

**As a** Rúnasmiðr character engaging in crafting activities
**I want to** generate Rune Charges when I complete crafting projects
**So that** I have resources available for inscription abilities

**Acceptance Criteria:**
- Standard crafting generates 1 Rune Charge
- Complex/multi-step crafting generates 2 Rune Charges
- Charges cannot exceed 5 maximum
- Long rest restores all Rune Charges to 5
- Short rest generates 1 Rune Charge (up to max)
- Charge generation notifications appear in combat/exploration log

---

## 5. Domain Layer Specifications

### 5.1 RuneChargeResource Value Object

**Purpose:** Represents the renewable resource pool for Rúnasmiðr abilities.

**Properties:**
- `CurrentCharges: int` - Current number of charges (0-5)
- `MaxCharges: int` - Maximum charges (default 5)
- `LastGeneratedAt: DateTime?` - Timestamp of last generation

**Methods:**

```csharp
/// <summary>
/// Spends the specified number of Rune Charges.
/// </summary>
/// <param name="amount">Number of charges to spend</param>
/// <returns>True if charges were available and spent</returns>
public bool Spend(int amount)
{
    if (amount <= 0 || CurrentCharges < amount)
        return false;

    CurrentCharges -= amount;
    return true;
}

/// <summary>
/// Generates the specified number of Rune Charges.
/// Respects maximum charge capacity.
/// </summary>
/// <param name="amount">Number of charges to generate</param>
public void Generate(int amount)
{
    if (amount <= 0)
        throw new ArgumentException("Generation amount must be positive", nameof(amount));

    CurrentCharges = Math.Min(CurrentCharges + amount, MaxCharges);
    LastGeneratedAt = DateTime.UtcNow;
}

/// <summary>
/// Generates Rune Charges from a crafting activity.
/// Standard crafting generates 1 charge, complex crafting generates 2.
/// </summary>
/// <param name="isComplexCraft">Whether this was a complex crafting task</param>
public void GenerateFromCrafting(bool isComplexCraft = false)
{
    var amount = isComplexCraft ? 2 : 1;
    Generate(amount);
}

/// <summary>
/// Restores all Rune Charges to maximum (long rest).
/// </summary>
public void RestoreAll()
{
    CurrentCharges = MaxCharges;
    LastGeneratedAt = DateTime.UtcNow;
}

/// <summary>
/// Checks if character can afford the specified charge cost.
/// </summary>
public bool CanAfford(int cost) => CurrentCharges >= cost;

/// <summary>
/// Gets the percentage of current charges relative to max.
/// </summary>
public decimal GetChargePercentage() => (decimal)CurrentCharges / MaxCharges;
```

### 5.2 InscribedRune Value Object

**Purpose:** Represents a rune inscription applied to equipment with time-based effects.

**Properties:**
- `RuneId: Guid` - Unique identifier for this inscription
- `RuneType: RuneType` - Type of rune (Enhancement, Protection, etc.)
- `TargetItemId: Guid` - ID of the equipped item receiving the rune
- `EnhancementBonus: int` - Numerical bonus from the inscription
- `ElementalType: DamageType?` - Optional elemental damage type (v0.20.2b+)
- `Duration: int` - Remaining turns until expiration
- `CreatedAt: DateTime` - When the rune was inscribed
- `OriginalDuration: int` - Base duration (for display purposes)

**Methods:**

```csharp
/// <summary>
/// Advances the rune's countdown by one turn.
/// </summary>
public void Tick()
{
    if (Duration > 0)
        Duration--;
}

/// <summary>
/// Determines if the rune has expired.
/// </summary>
public bool IsExpired() => Duration <= 0;

/// <summary>
/// Gets a human-readable description of the rune's effects.
/// </summary>
public string GetEffectDescription() => RuneType switch
{
    RuneType.Enhancement => $"+{EnhancementBonus} damage",
    RuneType.Protection => $"+{EnhancementBonus} Defense",
    RuneType.Elemental => $"+{EnhancementBonus} {ElementalType?.DisplayName ?? "unknown"} damage",
    RuneType.Ward => "Defensive ward active",
    RuneType.Trap => "Trap ready",
    _ => "Unknown rune effect"
};

/// <summary>
/// Returns the remaining duration in a formatted string (e.g., "8 turns").
/// </summary>
public string GetDurationDisplay() => $"{Duration} turn{(Duration != 1 ? "s" : "")}";
```

### 5.3 RunestoneWard Value Object

**Purpose:** Represents a protective ward that absorbs damage.

**Properties:**
- `WardId: Guid` - Unique identifier for this ward
- `OwnerId: Guid` - Character ID of the ward owner
- `DamageAbsorption: int` - Total absorption capacity (usually 10)
- `RemainingAbsorption: int` - Current absorption remaining
- `CreatedAt: DateTime` - When the ward was created

**Methods:**

```csharp
/// <summary>
/// Applies damage to the ward, reducing its remaining absorption.
/// </summary>
/// <param name="damage">Incoming damage amount</param>
/// <returns>Actual damage absorbed by the ward</returns>
public int AbsorbDamage(int damage)
{
    if (damage <= 0 || IsDestroyed())
        return 0;

    int absorbed = Math.Min(damage, RemainingAbsorption);
    RemainingAbsorption -= absorbed;
    return absorbed;
}

/// <summary>
/// Checks if the ward has been completely destroyed.
/// </summary>
public bool IsDestroyed() => RemainingAbsorption <= 0;

/// <summary>
/// Gets remaining absorption capacity as percentage.
/// </summary>
public decimal GetRemainCapacityPercent() => (decimal)RemainingAbsorption / DamageAbsorption;

/// <summary>
/// Gets a visual representation of remaining capacity (e.g., "███░░░░░░").
/// </summary>
public string GetVisualBar(int width = 10)
{
    int filled = (int)Math.Ceiling((double)RemainingAbsorption / DamageAbsorption * width);
    return new string('█', filled) + new string('░', width - filled);
}

/// <summary>
/// Gets remaining time before natural expiration (if applicable).
/// </summary>
public int GetAbsorptionDisplay() => $"{RemainingAbsorption}/{DamageAbsorption}";
```

### 5.4 RuneType Enum

```csharp
/// <summary>
/// Categorizes different types of runes and their effects.
/// </summary>
public enum RuneType
{
    /// <summary>Weapon damage bonus (Tier 1: +2 damage)</summary>
    Enhancement = 1,

    /// <summary>Armor defense bonus (Tier 1: +1 Defense)</summary>
    Protection = 2,

    /// <summary>Elemental damage bonus (Tier 2: +1d6 elemental)</summary>
    Elemental = 3,

    /// <summary>Defensive ward (Tier 1: absorbs damage)</summary>
    Ward = 4,

    /// <summary>Triggered trap (Tier 2: 3d6 damage on trigger)</summary>
    Trap = 5
}
```

### 5.5 RunasmidrAbilityId Enum

```csharp
/// <summary>
/// Identifies all Rúnasmiðr specialization abilities across all tiers.
/// </summary>
public enum RunasmidrAbilityId
{
    // Tier 1
    InscribeRune = 1,
    ReadTheMarks = 2,
    RunestoneWard = 3,

    // Tier 2 (v0.20.2b)
    EmpoweredInscription = 4,
    RunicTrap = 5,
    DvergrTechniques = 6,

    // Tier 3 (v0.20.2c)
    MasterScrivener = 7,
    LivingRunes = 8,

    // Capstone (v0.20.2c)
    WordOfUnmaking = 9
}
```

---

## 6. Application Layer Specifications

### 6.1 IRuneChargeService Interface

**Purpose:** Manages Rune Charge resource pool operations.

```csharp
/// <summary>
/// Service for managing Rune Charges for Rúnasmiðr specialization.
/// </summary>
public interface IRuneChargeService
{
    /// <summary>Spends charges if available.</summary>
    bool TrySpend(Guid characterId, int amount);

    /// <summary>Generates charges from crafting (1 or 2 depending on complexity).</summary>
    void GenerateFromCraft(Guid characterId, bool isComplexCraft = false);

    /// <summary>Gets current charges for a character.</summary>
    int GetCurrentCharges(Guid characterId);

    /// <summary>Gets maximum charges (always 5).</summary>
    int GetMaxCharges(Guid characterId);

    /// <summary>Checks if character has sufficient charges.</summary>
    bool CanAfford(Guid characterId, int cost);

    /// <summary>Restores all charges (long rest).</summary>
    void RestoreAllCharges(Guid characterId);

    /// <summary>Gets timestamp of last generation.</summary>
    DateTime? GetLastGeneratedAt(Guid characterId);
}
```

### 6.2 IRúnasmiðrAbilityService Interface

**Purpose:** Handles ability execution and validation.

```csharp
/// <summary>
/// Service for executing Rúnasmiðr abilities.
/// </summary>
public interface IRúnasmiðrAbilityService
{
    /// <summary>Checks if ability can be cast given current state.</summary>
    (bool canCast, string reason) CanCastAbility(Guid characterId, RunasmidrAbilityId abilityId);

    /// <summary>Executes Inscribe Rune on specified target item.</summary>
    AbilityExecutionResult ExecuteInscribeRune(Guid characterId, Guid targetItemId);

    /// <summary>Executes Runestone Ward, creating protective shield.</summary>
    AbilityExecutionResult ExecuteRunestoneWard(Guid characterId);

    /// <summary>Gets active inscribed runes on character's items.</summary>
    IReadOnlyList<InscribedRune> GetActiveRunes(Guid characterId);

    /// <summary>Gets active ward on character.</summary>
    RunestoneWard? GetActiveWard(Guid characterId);

    /// <summary>Calculates AP and resource costs for ability.</summary>
    (int apCost, int runeCost) GetAbilityCost(RunasmidrAbilityId abilityId);
}
```

### 6.3 RuneChargeServiceImpl Implementation

```csharp
/// <summary>
/// Implementation of Rune Charge service with persistence.
/// </summary>
public class RuneChargeServiceImpl : IRuneChargeService
{
    private readonly ICharacterRepository _characterRepository;
    private readonly ILogger _logger;

    public RuneChargeServiceImpl(
        ICharacterRepository characterRepository,
        ILogger logger)
    {
        _characterRepository = characterRepository ?? throw new ArgumentNullException(nameof(characterRepository));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public bool TrySpend(Guid characterId, int amount)
    {
        var character = _characterRepository.GetById(characterId);
        if (character?.RuneCharges == null)
            return false;

        if (!character.RuneCharges.Spend(amount))
        {
            _logger.LogWarning($"Character {characterId} insufficient rune charges. " +
                $"Needed: {amount}, Have: {character.RuneCharges.CurrentCharges}");
            return false;
        }

        _characterRepository.Update(character);
        _logger.LogInfo($"Character {characterId} spent {amount} rune charge(s). " +
            $"Remaining: {character.RuneCharges.CurrentCharges}/{character.RuneCharges.MaxCharges}");

        return true;
    }

    public void GenerateFromCraft(Guid characterId, bool isComplexCraft = false)
    {
        var character = _characterRepository.GetById(characterId);
        if (character?.RuneCharges == null)
            throw new InvalidOperationException($"Character {characterId} is not a Rúnasmiðr");

        var previousCharges = character.RuneCharges.CurrentCharges;
        character.RuneCharges.GenerateFromCrafting(isComplexCraft);

        _characterRepository.Update(character);

        var craftType = isComplexCraft ? "complex" : "standard";
        var generated = character.RuneCharges.CurrentCharges - previousCharges;

        _logger.LogInfo($"Character {characterId} generated {generated} rune charge(s) from {craftType} craft. " +
            $"Total: {character.RuneCharges.CurrentCharges}/{character.RuneCharges.MaxCharges}");
    }

    public int GetCurrentCharges(Guid characterId)
    {
        var character = _characterRepository.GetById(characterId);
        return character?.RuneCharges?.CurrentCharges ?? 0;
    }

    public int GetMaxCharges(Guid characterId) => 5; // Always 5 for Rúnasmiðr

    public bool CanAfford(Guid characterId, int cost)
    {
        return GetCurrentCharges(characterId) >= cost;
    }

    public void RestoreAllCharges(Guid characterId)
    {
        var character = _characterRepository.GetById(characterId);
        if (character?.RuneCharges == null)
            throw new InvalidOperationException($"Character {characterId} is not a Rúnasmiðr");

        character.RuneCharges.RestoreAll();
        _characterRepository.Update(character);

        _logger.LogInfo($"Character {characterId} restored all rune charges during rest. Total: 5/5");
    }

    public DateTime? GetLastGeneratedAt(Guid characterId)
    {
        var character = _characterRepository.GetById(characterId);
        return character?.RuneCharges?.LastGeneratedAt;
    }
}
```

---

## 7. Infrastructure Layer Specifications

### 7.1 Configuration Structure

**File:** `specializations.json`

Key entry for Rúnasmiðr:
```json
{
    "specializationId": "Runasmidr",
    "displayName": "Rúnasmiðr",
    "tagline": "Inscriber of Power",
    "description": "The Rúnasmiðr carries forward the sacred craft of the Dvergr, inscribing power into mundane objects and calling upon ancient runic traditions to enhance, protect, and destroy.",
    "parentArchetype": "Adept",
    "pathType": "Coherent",
    "specialResource": {
        "resourceId": "rune-charges",
        "resourceName": "Rune Charges",
        "maxValue": 5,
        "startingValue": 5
    },
    "abilityTiers": [
        {
            "tier": 1,
            "ppRequirement": 0,
            "abilityCost": 0,
            "abilities": ["inscribe-rune", "read-the-marks", "runestone-ward"]
        }
    ]
}
```

---

## 8. Rune Charges Resource

### Resource Generation & Consumption Table

| Action | Effect | Notes |
|--------|--------|-------|
| Complete standard craft | Generate 1 Rune Charge | Basic action |
| Complete complex craft | Generate 2 Rune Charges | Multi-step crafting |
| Rest (short, 1 hour) | Generate 1 Rune Charge | Up to maximum |
| Rest (long, 8 hours) | Restore all to 5 | Full restoration |
| Inscribe Rune (Tier 1) | Spend 1 Rune Charge | Active ability |
| Runestone Ward (Tier 1) | Spend 1 Rune Charge | Active ability |

---

## 9. Inscribe Rune Ability

### 9.1 Ability Specification

| Property | Value |
|----------|-------|
| **ID** | `inscribe-rune` |
| **Display Name** | Inscribe Rune |
| **Type** | Active |
| **Tier** | 1 |
| **AP Cost** | 3 AP |
| **Rune Charge Cost** | 1 |
| **Duration** | 10 turns |
| **Target** | Weapon or Armor item |
| **Effect Type** | Conditional bonus |

### 9.2 Mechanics

**Weapon Inscription:**
- Adds +2 damage to all attack rolls using the weapon
- Lasts for 10 turns (approximately one combat encounter)
- Stacks with weapon base damage and other bonuses

**Armor Inscription:**
- Adds +1 Defense (reduces incoming damage by 1)
- Lasts for 10 turns
- Does not stack with multiple armor pieces

**Restrictions:**
- Only one rune per item at a time (no stacking)
- Rune overwrites previous rune on same item if reapplied
- Cannot inscribe items you do not own or have equipped
- Cannot inscribe non-item objects

### 9.3 Duration and Expiration

- Rune duration decrements by 1 each turn during combat
- On reaching 0 duration, rune expires and effect is removed
- Expired rune can be reapplied to same or different item
- UI shows remaining turns for inscribed items

---

## 10. Read the Marks Ability

### 10.1 Ability Specification

| Property | Value |
|----------|-------|
| **ID** | `read-the-marks` |
| **Display Name** | Read the Marks |
| **Type** | Passive |
| **Tier** | 1 |
| **Effect Type** | Auto-identification |
| **Trigger** | Examining Jötun technology |

### 10.2 Mechanics

**Auto-Identification:**
- When Rúnasmiðr character examines Jötun technology, identification is automatic
- No Perception or Lore check required
- Happens in both exploration and combat scenarios

**Information Revealed:**
- Function/purpose of the artifact
- Origin (Jötun technology indicator)
- Potential uses and applications
- Lore snippets and historical context
- Technical specifications

**Affected Items:**
- Jötun weapons and armor
- Jötun crafting materials
- Jötun traps and mechanisms
- Jötun machinery and devices
- Any item tagged with "Jötun" type in inventory

**Integration:**
- Works with v0.15.6 Perception system
- Auto-passes identification checks
- Provides "auto-succeed" layer for Jötun items
- Synergizes with Lore/History knowledge

---

## 11. Runestone Ward Ability

### 11.1 Ability Specification

| Property | Value |
|----------|-------|
| **ID** | `runestone-ward` |
| **Display Name** | Runestone Ward |
| **Type** | Active |
| **Tier** | 1 |
| **AP Cost** | 2 AP |
| **Rune Charge Cost** | 1 |
| **Duration** | Until destroyed |
| **Max Active** | 1 per character |
| **Effect Type** | Damage absorption |

### 11.2 Mechanics

**Ward Creation:**
- Creates a protective ward with 10 damage absorption
- Ward persists until fully depleted
- Only one active ward per character at a time
- Can refresh by casting again (replaces previous ward)

**Damage Absorption:**
- Incoming damage is absorbed by ward first
- Once ward absorption reaches 0, damage affects HP normally
- Visual bar shows remaining absorption (e.g., "████░░░░░░")
- Detailed display shows "X/10" absorption

**Ward Destruction:**
- Ward is destroyed when remaining absorption reaches 0
- Character receives notification of ward destruction
- Must reapply ability to recreate ward

**Refreshing Ward:**
- Casting again while ward is active replaces it
- New ward starts at full 10 absorption
- Old ward is immediately destroyed
- No waste if previous ward had remaining absorption

---

## 12. Decision Trees and Flow Diagrams

### 12.1 Inscribe Rune Execution Flow

```
┌─────────────────────────┐
│ Cast Inscribe Rune      │
└───────────┬─────────────┘
            │
            ▼
┌─────────────────────────────────────────┐
│ Check: Player has 1+ Rune Charges       │
└───────────┬────────────────┬────────────┘
    YES     │                │     NO
            │                │
            ▼                ▼
    ┌──────────────┐  ┌──────────────┐
    │ Deduct 1     │  │ Ability Fails │
    │ Rune Charge  │  │ Return Error  │
    └───────┬──────┘  └──────────────┘
            │
            ▼
┌─────────────────────────────────────┐
│ Check: Valid target (Weapon/Armor)  │
└───────────┬────────────────┬────────┘
    YES     │                │     NO
            │                │
            ▼                ▼
    ┌──────────────┐  ┌──────────────┐
    │ Create Rune  │  │ Ability Fails │
    │ object       │  │ Return Error  │
    └───────┬──────┘  └──────────────┘
            │
            ▼
┌─────────────────────────────────┐
│ Check: Only 1 rune per item     │
└───────────┬────────────────┬────┘
    OK      │                │   CONFLICT
            │                │
            ▼                ▼
    ┌──────────────┐  ┌────────────────┐
    │ Apply Rune   │  │ Remove Old     │
    │ Set Duration │  │ Apply New Rune │
    │ (10 turns)   │  │ Set Duration   │
    └───────┬──────┘  └────────┬───────┘
            │                  │
            └──────┬───────────┘
                   │
                   ▼
         ┌──────────────────┐
         │ Log Action       │
         │ Update Character │
         │ Display Result   │
         └──────────────────┘
```

### 12.2 Runestone Ward Creation Flow

```
┌──────────────────────┐
│ Cast Runestone Ward  │
└──────────┬───────────┘
           │
           ▼
┌─────────────────────────────────────┐
│ Check: Player has 1+ Rune Charges   │
└──────────┬────────────────┬─────────┘
    YES    │                │     NO
           │                │
           ▼                ▼
   ┌──────────────┐  ┌──────────────┐
   │ Deduct 1     │  │ Ability Fails │
   │ Rune Charge  │  │ Return Error  │
   └──────┬───────┘  └──────────────┘
           │
           ▼
┌─────────────────────────┐
│ Check: Active ward?     │
└──────────┬──────────┬───┘
    NO     │          │    YES
           │          │
           ▼          ▼
   ┌──────────────┐  ┌────────────────┐
   │ Create new   │  │ Destroy old    │
   │ ward (10/10) │  │ Create new     │
   │              │  │ ward (10/10)   │
   └──────┬───────┘  └────────┬───────┘
           │                  │
           └──────┬───────────┘
                  │
                  ▼
        ┌──────────────────┐
        │ Log Action       │
        │ Update Character │
        │ Display Result   │
        └──────────────────┘
```

---

## 13. Configuration Files

### 13.1 specializations.json Update

```json
{
    "specializations": [
        {
            "specializationId": "Runasmidr",
            "displayName": "Rúnasmiðr",
            "pronunciation": "ROO-nah-smithr",
            "translation": "Runesmith",
            "tagline": "Inscriber of Power",
            "description": "The Rúnasmiðr carries forward the sacred craft of the Dvergr, inscribing power into mundane objects and calling upon ancient runic traditions to enhance, protect, and destroy.",
            "selectionText": "Every mark tells a truth. Every truth holds power. Let me teach you to write reality itself.",
            "parentArchetype": "Adept",
            "pathType": "Coherent",
            "unlockCost": 0,
            "specialResource": {
                "resourceId": "rune-charges",
                "resourceName": "Rune Charges",
                "resourceType": "renewable",
                "description": "Power for inscription abilities. Generated through crafting activities and restored during rest.",
                "maxValue": 5,
                "startingValue": 5,
                "generationMethod": "Generate 1 on standard craft, 2 on complex craft, 1 on short rest, restore all on long rest",
                "consumptionMethod": "Spent by inscription and runic abilities"
            },
            "abilityTiers": [
                {
                    "tier": 1,
                    "ppRequirement": 0,
                    "abilityCost": 0,
                    "unlocked": true,
                    "abilities": [
                        "inscribe-rune",
                        "read-the-marks",
                        "runestone-ward"
                    ]
                },
                {
                    "tier": 2,
                    "ppRequirement": 8,
                    "abilityCost": 4,
                    "unlocked": false,
                    "abilities": []
                },
                {
                    "tier": 3,
                    "ppRequirement": 16,
                    "abilityCost": 5,
                    "unlocked": false,
                    "abilities": []
                },
                {
                    "tier": "capstone",
                    "ppRequirement": 24,
                    "abilityCost": 6,
                    "unlocked": false,
                    "abilities": []
                }
            ]
        }
    ]
}
```

### 13.2 abilities.json Update (Tier 1 Abilities)

```json
{
    "abilities": [
        {
            "abilityId": "inscribe-rune",
            "displayName": "Inscribe Rune",
            "specializationId": "Runasmidr",
            "tier": 1,
            "type": "Active",
            "apCost": 3,
            "resourceCost": {
                "resourceId": "rune-charges",
                "amount": 1
            },
            "duration": 10,
            "durationUnit": "Turns",
            "description": "Apply a temporary enhancement rune to a weapon (+2 damage) or armor (+1 Defense) for 10 turns. Only one rune per item at a time.",
            "requirements": {
                "targetType": ["Weapon", "Armor"],
                "specialization": "Runasmidr",
                "resourceAvailable": "rune-charges:1"
            },
            "effects": [
                {
                    "type": "ConditionalModifier",
                    "condition": "TargetIsWeapon",
                    "modifierType": "DamageBonus",
                    "value": 2,
                    "duration": 10,
                    "stackable": false
                },
                {
                    "type": "ConditionalModifier",
                    "condition": "TargetIsArmor",
                    "modifierType": "DefenseBonus",
                    "value": 1,
                    "duration": 10,
                    "stackable": false
                }
            ],
            "cooldown": {
                "type": "None",
                "value": 0
            },
            "tags": ["rune", "enhancement", "inscription", "crafting-focus"]
        },
        {
            "abilityId": "read-the-marks",
            "displayName": "Read the Marks",
            "specializationId": "Runasmidr",
            "tier": 1,
            "type": "Passive",
            "apCost": 0,
            "resourceCost": null,
            "description": "Automatically identify Jötun technology without requiring Perception or Lore checks. Reveals function, origin, and potential uses.",
            "requirements": {
                "targetType": ["JotunTechnology"],
                "specialization": "Runasmidr"
            },
            "effects": [
                {
                    "type": "AutoIdentify",
                    "targetCategory": "JotunTechnology",
                    "information": ["function", "origin", "uses", "loreSnippets"]
                }
            ],
            "tags": ["passive", "identification", "jotun", "knowledge"]
        },
        {
            "abilityId": "runestone-ward",
            "displayName": "Runestone Ward",
            "specializationId": "Runasmidr",
            "tier": 1,
            "type": "Active",
            "apCost": 2,
            "resourceCost": {
                "resourceId": "rune-charges",
                "amount": 1
            },
            "duration": -1,
            "durationUnit": "UntilDestroyed",
            "description": "Create a defensive ward that absorbs up to 10 damage. Only one ward active at a time. Refreshing replaces the old ward.",
            "requirements": {
                "specialization": "Runasmidr",
                "resourceAvailable": "rune-charges:1",
                "maxActiveWards": 1
            },
            "effects": [
                {
                    "type": "CreateWard",
                    "absorption": 10,
                    "maxActive": 1,
                    "destructible": true,
                    "refreshable": true
                }
            ],
            "cooldown": {
                "type": "None",
                "value": 0
            },
            "tags": ["ward", "defense", "protection", "inscription"]
        }
    ]
}
```

---

## 14. Code Examples

### 14.1 Inscribe Rune Implementation

```csharp
/// <summary>
/// Handler for Inscribe Rune ability execution.
/// </summary>
public class InscribeRuneHandler : IAbilityHandler
{
    private readonly ICharacterRepository _characterRepository;
    private readonly IRuneChargeService _runeChargeService;
    private readonly IEquipmentRepository _equipmentRepository;
    private readonly ILogger _logger;

    public InscribeRuneHandler(
        ICharacterRepository characterRepository,
        IRuneChargeService runeChargeService,
        IEquipmentRepository equipmentRepository,
        ILogger logger)
    {
        _characterRepository = characterRepository;
        _runeChargeService = runeChargeService;
        _equipmentRepository = equipmentRepository;
        _logger = logger;
    }

    /// <summary>
    /// Executes Inscribe Rune ability.
    /// </summary>
    /// <remarks>
    /// XML Documentation for Inscribe Rune:
    /// - Checks character has 1+ Rune Charges
    /// - Validates target item (weapon or armor)
    /// - Removes existing rune if present
    /// - Creates new InscribedRune with 10 turn duration
    /// - Logs action with duration/effect details
    /// </remarks>
    public AbilityExecutionResult Execute(AbilityExecutionContext context)
    {
        // Validate context
        if (context == null)
            throw new ArgumentNullException(nameof(context));

        var character = _characterRepository.GetById(context.CharacterId);
        if (character == null)
            return new AbilityExecutionResult(
                success: false,
                message: "Character not found");

        // Check Rune Charges
        if (!_runeChargeService.CanAfford(context.CharacterId, 1))
        {
            _logger.LogWarning($"Character {context.CharacterId} lacks rune charges for Inscribe Rune");
            return new AbilityExecutionResult(
                success: false,
                message: "Insufficient Rune Charges (need 1)");
        }

        // Validate target
        if (!context.Parameters.TryGetValue("targetItemId", out var targetIdObj))
        {
            return new AbilityExecutionResult(
                success: false,
                message: "Target item not specified");
        }

        var targetItemId = (Guid)targetIdObj;
        var targetItem = _equipmentRepository.GetById(targetItemId);

        if (targetItem == null)
        {
            return new AbilityExecutionResult(
                success: false,
                message: "Target item not found");
        }

        // Check item type
        if (!IsValidRuneTarget(targetItem))
        {
            return new AbilityExecutionResult(
                success: false,
                message: "Target must be weapon or armor");
        }

        // Spend Rune Charge
        if (!_runeChargeService.TrySpend(context.CharacterId, 1))
        {
            return new AbilityExecutionResult(
                success: false,
                message: "Failed to spend Rune Charge");
        }

        // Create inscribed rune
        var runeType = targetItem.ItemType == ItemType.Weapon
            ? RuneType.Enhancement
            : RuneType.Protection;

        var bonus = runeType == RuneType.Enhancement ? 2 : 1;

        var inscribedRune = new InscribedRune(
            runeId: Guid.NewGuid(),
            runeType: runeType,
            targetItemId: targetItemId,
            enhancementBonus: bonus,
            duration: 10,
            createdAt: DateTime.UtcNow);

        // Remove existing rune if present
        var existingRune = character.ActiveRunes
            .FirstOrDefault(r => r.TargetItemId == targetItemId);

        if (existingRune != null)
        {
            character.ActiveRunes.Remove(existingRune);
            _logger.LogInfo($"Replaced existing rune on {targetItem.ItemName}");
        }

        // Add new rune
        character.ActiveRunes.Add(inscribedRune);
        _characterRepository.Update(character);

        // Log
        var effectDesc = runeType == RuneType.Enhancement
            ? "+2 damage for 10 turns"
            : "+1 Defense for 10 turns";

        _logger.LogInfo(
            $"Character {context.CharacterId} inscribed rune on {targetItem.ItemName}. " +
            $"Effect: {effectDesc}");

        return new AbilityExecutionResult(
            success: true,
            message: $"Inscribed {targetItem.ItemName} with {runeType} rune. Effect: {effectDesc}",
            resourcesSpent: new Dictionary<string, int> { { "rune-charges", 1 } });
    }

    private bool IsValidRuneTarget(Equipment item)
    {
        return item.ItemType == ItemType.Weapon ||
               item.ItemType == ItemType.Armor;
    }
}
```

### 14.2 Runestone Ward Implementation

```csharp
/// <summary>
/// Handler for Runestone Ward ability execution.
/// </summary>
public class RunestoneWardHandler : IAbilityHandler
{
    private readonly ICharacterRepository _characterRepository;
    private readonly IRuneChargeService _runeChargeService;
    private readonly ILogger _logger;

    public RunestoneWardHandler(
        ICharacterRepository characterRepository,
        IRuneChargeService runeChargeService,
        ILogger logger)
    {
        _characterRepository = characterRepository;
        _runeChargeService = runeChargeService;
        _logger = logger;
    }

    /// <summary>
    /// Executes Runestone Ward ability.
    /// </summary>
    /// <remarks>
    /// XML Documentation for Runestone Ward:
    /// - Checks character has 1+ Rune Charges
    /// - Removes existing ward if present
    /// - Creates new RunestoneWard with 10 absorption
    /// - Ward persists until destroyed
    /// - Only one ward per character
    /// - Logs ward creation with remaining absorption display
    /// </remarks>
    public AbilityExecutionResult Execute(AbilityExecutionContext context)
    {
        if (context == null)
            throw new ArgumentNullException(nameof(context));

        var character = _characterRepository.GetById(context.CharacterId);
        if (character == null)
        {
            return new AbilityExecutionResult(
                success: false,
                message: "Character not found");
        }

        // Check Rune Charges
        if (!_runeChargeService.CanAfford(context.CharacterId, 1))
        {
            _logger.LogWarning($"Character {context.CharacterId} lacks rune charges for Runestone Ward");
            return new AbilityExecutionResult(
                success: false,
                message: "Insufficient Rune Charges (need 1)");
        }

        // Spend Rune Charge
        if (!_runeChargeService.TrySpend(context.CharacterId, 1))
        {
            return new AbilityExecutionResult(
                success: false,
                message: "Failed to spend Rune Charge");
        }

        // Remove existing ward if present
        if (character.ActiveWards.Count > 0)
        {
            var oldWard = character.ActiveWards[0];
            character.ActiveWards.Remove(oldWard);
            _logger.LogInfo($"Replaced existing ward (had {oldWard.RemainingAbsorption} absorption remaining)");
        }

        // Create new ward
        var newWard = new RunestoneWard(
            wardId: Guid.NewGuid(),
            ownerId: context.CharacterId,
            damageAbsorption: 10,
            createdAt: DateTime.UtcNow);

        character.ActiveWards.Add(newWard);
        _characterRepository.Update(character);

        // Log
        _logger.LogInfo(
            $"Character {context.CharacterId} created Runestone Ward. " +
            $"Absorption: {newWard.RemainingAbsorption}/{newWard.DamageAbsorption}");

        var visualBar = newWard.GetVisualBar();

        return new AbilityExecutionResult(
            success: true,
            message: $"Created Runestone Ward {visualBar} (10/10 absorption)",
            resourcesSpent: new Dictionary<string, int> { { "rune-charges", 1 } });
    }
}
```

### 14.3 Read the Marks Integration

```csharp
/// <summary>
/// Passive integration for Read the Marks ability.
/// </summary>
public class ReadTheMarksIntegration : IPassiveAbilityIntegration
{
    private readonly IExaminationService _examinationService;
    private readonly ILogger _logger;

    public ReadTheMarksIntegration(
        IExaminationService examinationService,
        ILogger logger)
    {
        _examinationService = examinationService;
        _logger = logger;
    }

    /// <summary>
    /// Intercepts item examination to provide auto-identification for Jötun technology.
    /// </summary>
    /// <remarks>
    /// XML Documentation for Read the Marks integration:
    /// - Triggers on any Jötun technology examination
    /// - Bypasses normal Perception/Lore checks
    /// - Provides complete identification information
    /// - Returns function, origin, uses, and lore snippets
    /// - Does not consume AP or resources
    /// </remarks>
    public void OnItemExamined(ItemExaminedContext context)
    {
        // Check if character is Rúnasmiðr
        if (!IsRunesmith(context.Character))
            return;

        // Check if item is Jötun technology
        if (!IsJotunTechnology(context.Item))
            return;

        // Auto-identify
        var identification = new ItemIdentification
        {
            Function = GetItemFunction(context.Item),
            Origin = "Jötun Technology",
            PotentialUses = GetItemUses(context.Item),
            LoreSnippets = GetLoreSnippets(context.Item),
            AutoIdentified = true,
            Source = "Read the Marks"
        };

        context.SetIdentification(identification);

        _logger.LogInfo(
            $"Character {context.Character.Id} auto-identified Jötun item {context.Item.ItemName} " +
            $"via Read the Marks");
    }

    private bool IsRunesmith(Character character)
    {
        return character.Specialization?.SpecializationId == SpecializationId.Runasmidr;
    }

    private bool IsJotunTechnology(Item item)
    {
        return item.Tags.Contains("jotun-technology") ||
               item.Origin == ItemOrigin.Jotun;
    }

    private string GetItemFunction(Item item)
    {
        return item.Properties.GetValueOrDefault("function", "Unknown Jötun device");
    }

    private List<string> GetItemUses(Item item)
    {
        var uses = new List<string>();
        if (item.Properties.TryGetValue("uses", out var usesObj))
        {
            uses.AddRange((List<string>)usesObj);
        }
        return uses;
    }

    private List<string> GetLoreSnippets(Item item)
    {
        var lore = new List<string>();
        if (item.Properties.TryGetValue("lore", out var loreObj))
        {
            lore.AddRange((List<string>)loreObj);
        }
        return lore;
    }
}
```

---

## 15. Logging Specifications

### 15.1 Log Events

**Rune Charge Generation:**
```
[INFO] Character {characterId} generated {count} rune charge(s) from {craftType} craft.
       Total: {current}/{max}
```

**Rune Charge Spending:**
```
[INFO] Character {characterId} spent {count} rune charge(s). Remaining: {current}/{max}
```

**Inscribe Rune Applied:**
```
[INFO] Character {characterId} inscribed rune on {itemName}. Effect: {effect}.
       Duration: 10 turns
```

**Runestone Ward Created:**
```
[INFO] Character {characterId} created Runestone Ward. Absorption: {remaining}/{max}
```

**Ward Destroyed:**
```
[INFO] Character {characterId} Runestone Ward destroyed. No absorption remaining.
```

**Read the Marks Triggered:**
```
[INFO] Character {characterId} auto-identified Jötun item {itemName} via Read the Marks
```

### 15.2 Warning/Error Events

**Insufficient Charges:**
```
[WARN] Character {characterId} insufficient rune charges. Needed: {required}, Have: {current}
```

**Invalid Target:**
```
[WARN] Character {characterId} attempted to inscribe invalid target. Type: {targetType}
```

---

## 16. Unit Testing Requirements

### 16.1 RuneChargeResourceTests

**Test Count:** 5 tests

```csharp
[TestFixture]
public class RuneChargeResourceTests
{
    [Test]
    public void Create_InitializesWithMaxCharges()
    {
        // Arrange
        var resource = new RuneChargeResource();

        // Assert
        Assert.AreEqual(5, resource.MaxCharges);
        Assert.AreEqual(5, resource.CurrentCharges);
    }

    [Test]
    public void Spend_SufficientCharges_DeductsAndReturnsTrue()
    {
        // Arrange
        var resource = new RuneChargeResource();

        // Act
        var result = resource.Spend(2);

        // Assert
        Assert.IsTrue(result);
        Assert.AreEqual(3, resource.CurrentCharges);
    }

    [Test]
    public void Spend_InsufficientCharges_ReturnsFalse()
    {
        // Arrange
        var resource = new RuneChargeResource();
        resource.Spend(5);

        // Act
        var result = resource.Spend(1);

        // Assert
        Assert.IsFalse(result);
        Assert.AreEqual(0, resource.CurrentCharges);
    }

    [Test]
    public void GenerateFromCrafting_StandardCraft_AddsOneCharge()
    {
        // Arrange
        var resource = new RuneChargeResource();
        resource.Spend(3);

        // Act
        resource.GenerateFromCrafting(isComplexCraft: false);

        // Assert
        Assert.AreEqual(3, resource.CurrentCharges);
    }

    [Test]
    public void GenerateFromCrafting_ComplexCraft_AddsTwoCharges()
    {
        // Arrange
        var resource = new RuneChargeResource();
        resource.Spend(3);

        // Act
        resource.GenerateFromCrafting(isComplexCraft: true);

        // Assert
        Assert.AreEqual(4, resource.CurrentCharges);
    }
}
```

### 16.2 RunasmidrAbilityServiceTests

**Test Count:** 5 tests

```csharp
[TestFixture]
public class RunasmidrAbilityServiceTests
{
    private RunasmidrAbilityServiceImpl _service;
    private ICharacterRepository _characterRepository;
    private IEquipmentRepository _equipmentRepository;
    private IRuneChargeService _runeChargeService;

    [SetUp]
    public void Setup()
    {
        _characterRepository = Substitute.For<ICharacterRepository>();
        _equipmentRepository = Substitute.For<IEquipmentRepository>();
        _runeChargeService = Substitute.For<IRuneChargeService>();

        _service = new RunasmidrAbilityServiceImpl(
            _characterRepository,
            _equipmentRepository,
            _runeChargeService);
    }

    [Test]
    public void InscribeRune_OnWeapon_AddsDamageBonus()
    {
        // Arrange
        var characterId = Guid.NewGuid();
        var itemId = Guid.NewGuid();

        var character = new Character { Id = characterId, RuneCharges = new RuneChargeResource() };
        var weapon = new Equipment { Id = itemId, ItemType = ItemType.Weapon, ItemName = "Sword" };

        _characterRepository.GetById(characterId).Returns(character);
        _equipmentRepository.GetById(itemId).Returns(weapon);
        _runeChargeService.CanAfford(characterId, 1).Returns(true);

        // Act
        var result = _service.ExecuteInscribeRune(characterId, itemId);

        // Assert
        Assert.IsTrue(result.Success);
        Assert.AreEqual(1, character.ActiveRunes.Count);
        Assert.AreEqual(RuneType.Enhancement, character.ActiveRunes[0].RuneType);
        Assert.AreEqual(2, character.ActiveRunes[0].EnhancementBonus);
    }

    [Test]
    public void InscribeRune_OnArmor_AddsDefenseBonus()
    {
        // Similar test structure as above
    }

    [Test]
    public void RunestoneWard_AbsorbsDamage()
    {
        // Similar test structure
    }

    [Test]
    public void RunestoneWard_DestroyedWhenDepleted()
    {
        // Similar test structure
    }

    [Test]
    public void ReadTheMarks_JotunTech_AutoIdentifies()
    {
        // Similar test structure
    }
}
```

---

## 17. Deliverable Checklist

### Domain Layer
- [ ] `RuneChargeResource` value object with Spend/Generate/GenerateFromCrafting methods
- [ ] `InscribedRune` value object with Tick/IsExpired/GetEffectDescription methods
- [ ] `RunestoneWard` value object with AbsorbDamage/IsDestroyed/GetRemaining methods
- [ ] `RuneType` enum (Enhancement, Protection, Elemental, Ward, Trap)
- [ ] `RunasmidrAbilityId` enum with all 9 ability IDs

### Application Layer
- [ ] `IRuneChargeService` interface
- [ ] `RuneChargeServiceImpl` implementation
- [ ] `IRúnasmiðrAbilityService` interface
- [ ] `RunasmidrAbilityServiceImpl` implementation
- [ ] `InscribeRuneHandler` ability handler
- [ ] `RunestoneWardHandler` ability handler
- [ ] `ReadTheMarksIntegration` passive integration

### Infrastructure Layer
- [ ] `specializations.json` entry for Rúnasmiðr
- [ ] `abilities.json` entries for 3 Tier 1 abilities
- [ ] Configuration validation tests

### Tests
- [ ] `RuneChargeResourceTests.cs` (5 tests)
- [ ] `RunasmidrAbilityServiceTests.cs` (5 tests)
- [ ] All tests passing with >95% code coverage

---

## 18. Acceptance Criteria

### Core Functionality
- [ ] Rúnasmiðr specialization registers with v0.17.4 framework
- [ ] Rune Charges initialize to 5/5 on character creation
- [ ] Rune Charges generate correctly from crafting (1 standard, 2 complex)
- [ ] Rune Charges restore to 5/5 on long rest
- [ ] Inscribe Rune applies +2 damage to weapons for 10 turns
- [ ] Inscribe Rune applies +1 Defense to armor for 10 turns
- [ ] Only one rune per item (overwrites existing)
- [ ] Runestone Ward creates 10 damage absorption barrier
- [ ] Runestone Ward is destroyed when absorption reaches 0
- [ ] Read the Marks auto-identifies all Jötun technology

### User Interface
- [ ] Status screen shows Rune Charges: X/5
- [ ] Inscribed items show visual indicator and effect duration
- [ ] Ward shows absorption bar: ██░░░░░░░░
- [ ] Auto-identification text displays for Jötun items
- [ ] Ability cooldown/resource indicators display correctly

### Integration
- [ ] Works with v0.17.4 specialization framework
- [ ] Integrates with v0.15.6 Perception system
- [ ] Crafting system correctly triggers charge generation
- [ ] Rest mechanics correctly trigger charge restoration
- [ ] No conflicts with other specializations

---

## 19. Dependencies

### Hard Dependencies
- **v0.17.3** - Archetype System (Adept archetype foundation)
- **v0.17.4** - Specialization Framework (SpecializationDefinition, tier mechanics)
- **v0.20.0** - Legacy Class Removal (IAbilitySlotService, prerequisite system)
- **v0.20.1** - Skjaldmær Specialization (establishes ability patterns)

### Soft Dependencies
- **v0.15.6** - Perception System (auto-identification integration)
- **v0.17.x** - Crafting System (charge generation hooks)

### Dependency Injection
```
ICharacterRepository
  ├── Character entity persistence
  ├── RuneCharges access
  └── ActiveRunes/ActiveWards tracking

IEquipmentRepository
  ├── Item entity persistence
  ├── Equipment validation
  └── Item type determination

IRuneChargeService
  ├── Charge spending
  ├── Charge generation
  └── Balance validation

IExaminationService (v0.15.6)
  ├── Item examination interception
  └── Identification integration
```

---

## 20. Deferrals and Future Considerations

### v0.20.2b Dependencies
- Tier 2 abilities depend on v0.20.2a framework
- EmpoweredInscription uses InscribedRune base (v0.20.2a)
- Runic Trap uses RuneType enum (v0.20.2a)
- Dvergr Techniques modifies crafting costs (hooks from v0.20.2a)

### v0.20.2c Dependencies
- Tier 3 abilities depend on both v0.20.2a and v0.20.2b
- Master Scrivener modifies rune durations (v0.20.2a runes)
- Living Runes creates summoned entities (new behavior)
- Word of Unmaking dispels all effects (combat system integration)

### Future Enhancement Possibilities
- **Runic Chains** - Link multiple runes for compound effects
- **Glyphic Mastery** - Combine rune types for custom effects
- **Rune Storage** - Store runes for later application
- **Elemental Specialization** - Focus on specific elements
- **Shared Runes** - Apply same rune to multiple party members

---

_This design specification provides comprehensive documentation for v0.20.2a implementation of the Rúnasmiðr specialization framework and Tier 1 abilities. Each section builds upon the established v0.20.1 patterns while introducing new resource and ability mechanics specific to the Runesmith archetype._
