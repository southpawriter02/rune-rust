# v0.14.9 Advanced Descriptor Configuration Schemas - Scope Breakdown

**Version:** 0.14.9
**Theme:** Advanced Descriptor Configuration Schemas
**Prerequisites:** v0.14.8 Complete (Dice Configuration Schemas)
**Total Estimated Tests:** ~30 new tests

---

## Executive Summary

The Advanced Descriptor Configuration Schemas version creates comprehensive JSON schemas for dialogue trees, ability/Galdr flavor text, NPC descriptors, psychological state descriptors, and lore capture templates. This enables full customization of narrative content including NPC conversations, magic casting descriptions, character mental states, and discoverable lore fragments—all without code changes.

The work is divided into **five sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.14.9a | Dialogue Schema | dialogue.schema.json with nodes, options, skill checks, outcomes | ~6 |
| v0.14.9b | Ability Descriptor Schema | ability-descriptors.schema.json with Galdr, weapon arts, skill usage | ~6 |
| v0.14.9c | NPC Descriptor Schema | npc-descriptors.schema.json with appearance, barks, reactions | ~6 |
| v0.14.9d | Psychological Descriptor Schema | psychological-descriptors.schema.json with stress, trauma, corruption | ~6 |
| v0.14.9e | Capture Template Schema | capture-templates.schema.json for lore fragments and codex entries | ~6 |

---

## Feature Analysis & Categorization

### Dialogue Configuration

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| dialogue.schema.json | High | descriptors.schema.json | **v0.14.9a** |
| Dialogue node definitions | Medium | dialogue.schema.json | **v0.14.9a** |
| Dialogue options | Medium | dialogue.schema.json | **v0.14.9a** |
| Skill check integration | Medium | dialogue.schema.json | **v0.14.9a** |
| Outcome definitions | Medium | dialogue.schema.json | **v0.14.9a** |
| Faction reputation effects | Low | dialogue.schema.json | **v0.14.9a** |

### Ability/Galdr Descriptor Configuration

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| ability-descriptors.schema.json | High | descriptors.schema.json | **v0.14.9b** |
| Galdr action descriptors | Medium | ability-descriptors.schema.json | **v0.14.9b** |
| Galdr manifestation descriptors | Medium | ability-descriptors.schema.json | **v0.14.9b** |
| Galdr outcome descriptors | Medium | ability-descriptors.schema.json | **v0.14.9b** |
| Galdr miscast descriptors | Medium | ability-descriptors.schema.json | **v0.14.9b** |
| Weapon art descriptors | Low | ability-descriptors.schema.json | **v0.14.9b** |
| Skill usage descriptors | Low | ability-descriptors.schema.json | **v0.14.9b** |

### NPC Descriptor Configuration

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| npc-descriptors.schema.json | High | descriptors.schema.json | **v0.14.9c** |
| Physical appearance descriptors | Medium | npc-descriptors.schema.json | **v0.14.9c** |
| Ambient bark descriptors | Medium | npc-descriptors.schema.json | **v0.14.9c** |
| Reaction descriptors | Medium | npc-descriptors.schema.json | **v0.14.9c** |
| NPC archetype classification | Low | npc-descriptors.schema.json | **v0.14.9c** |

### Psychological Descriptor Configuration

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| psychological-descriptors.schema.json | High | descriptors.schema.json | **v0.14.9d** |
| Stress threshold descriptors | Medium | psychological-descriptors.schema.json | **v0.14.9d** |
| Trauma type descriptors | Medium | psychological-descriptors.schema.json | **v0.14.9d** |
| Corruption progression descriptors | Medium | psychological-descriptors.schema.json | **v0.14.9d** |
| Biome pressure descriptors | Low | psychological-descriptors.schema.json | **v0.14.9d** |
| Recovery descriptors | Low | psychological-descriptors.schema.json | **v0.14.9d** |

### Capture Template Configuration

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| capture-templates.schema.json | Medium | None | **v0.14.9e** |
| Lore fragment definitions | Medium | capture-templates.schema.json | **v0.14.9e** |
| Capture type classification | Low | capture-templates.schema.json | **v0.14.9e** |
| Codex keyword matching | Low | capture-templates.schema.json | **v0.14.9e** |
| Quality/reward values | Low | capture-templates.schema.json | **v0.14.9e** |

---

## Existing Infrastructure

### Source Material Location

All source material for these schemas exists in `docs/design/descriptors/`:

| Directory | Contents | File Count |
|-----------|----------|------------|
| `dialogues/` | NPC dialogue trees (JSON) | 8 files |
| `templates/` | Room templates (JSON) | 20 files |
| `schemas/` | SQL schema definitions | 20 files |
| `descriptors/` | SQL content data | 19 files |
| `capture-templates/` | Lore capture templates | 6+ files |
| `biomes/` | Biome definitions | 1+ files |
| `locales/` | Localization | 1 file |

### Current Dialogue Structure (from dialogues/*.json)

```json
[
  {
    "Id": "npc_greeting",
    "Text": "This is MY territory. Leave your supplies and go, or things get bloody.",
    "Options": [
      {
        "Text": "I'm not giving you anything. [Fight]",
        "NextNodeId": null,
        "Outcome": {
          "Type": "InitiateCombat",
          "Data": "enemy_id",
          "ReputationChange": 0,
          "AffectedFaction": null
        }
      },
      {
        "Text": "[WILL 4] Stand down. We don't have to do this.",
        "SkillCheck": {
          "Attribute": "will",
          "TargetValue": 4,
          "Skill": null,
          "SkillRanks": 0
        },
        "NextNodeId": "npc_stand_down",
        "Outcome": {
          "Type": "ReputationChange",
          "Data": "Successfully negotiated",
          "ReputationChange": 10,
          "AffectedFaction": "RustClans"
        }
      }
    ],
    "EndsConversation": false
  }
]
```

### Current Galdr Descriptor Structure (from schemas/galdr_flavor_text_schema.sql)

```sql
-- Galdr_Action_Descriptors table structure
category TEXT NOT NULL,           -- GaldrCasting, AbilityActivation, WeaponArt
action_type TEXT,                 -- Invocation, Chant, Manifestation, Discharge
rune_school TEXT,                 -- Fehu, Thurisaz, Ansuz, Raido, etc.
ability_name TEXT,                -- FlameBolt, FrostLance, HealingChant
success_level TEXT,               -- MinorSuccess, SolidSuccess, ExceptionalSuccess, Miscast
descriptor_text TEXT NOT NULL,    -- Template with {Variable} placeholders
weight REAL DEFAULT 1.0,
tags TEXT                         -- JSON array
```

### Current NPC Descriptor Structure (from schemas/npc_descriptors_barks_schema.sql)

```sql
-- NPC_Physical_Descriptors table structure
npc_archetype TEXT NOT NULL,      -- Dvergr, Seidkona, Bandit, Merchant, etc.
npc_subtype TEXT NOT NULL,        -- Tinkerer, Runecaster, Scout, Veteran, etc.
descriptor_type TEXT NOT NULL,    -- FullBody, Face, Clothing, Equipment, Bearing
condition TEXT,                   -- Healthy, Wounded, Exhausted, etc.
descriptor_text TEXT NOT NULL,    -- Template with {Variable} placeholders
weight REAL DEFAULT 1.0,
tags TEXT                         -- JSON array
```

### Current Psychological Descriptor Structure (from schemas/psychological_descriptor_schema.sql)

```sql
-- Psychological_Stress_Descriptors table structure
threshold TEXT NOT NULL,          -- Minimal, Mounting, Critical, Breaking, Broken
manifestation TEXT NOT NULL,      -- Physical, Mental, Behavioral
descriptor_text TEXT NOT NULL,
weight REAL DEFAULT 1.0,
intensity TEXT,                   -- Subtle, Moderate, Oppressive
tags TEXT                         -- JSON array
```

### Current Capture Template Structure (from capture-templates/schema/capture-template.schema.json)

```json
{
  "id": "servitor-fungal-infection",
  "type": "TextFragment",
  "fragmentContent": "The lore text content...",
  "source": "Servitor examination",
  "matchKeywords": ["servitor", "blight"],
  "quality": 15,
  "tags": ["blight", "creature"]
}
```

### Key Schema Conventions

- JSON Schema Draft-07 format
- ID pattern: `^[a-z][a-z0-9-]*$` (lowercase kebab-case)
- Underscore variant for pool IDs: `^[a-z][a-z0-9_]*$`
- Definitions section for reusable types
- Required fields explicitly listed
- Descriptions on all properties
- Variable placeholders: `{VariableName}` syntax

---

## Phase Definitions

---

## v0.14.9a: Dialogue Schema

[v0.14.9a Design Specification](v0.14.9a-design-specification.md)

### Overview

Create a comprehensive JSON schema for NPC dialogue trees that validates dialogue nodes, response options, skill checks, and outcomes including reputation changes and combat initiation.

### Scope

**In Scope:**
- `dialogue.schema.json` - Schema for dialogue tree definitions
- Dialogue node structure (ID, text, options, ends conversation)
- Dialogue option structure (text, next node, outcome)
- Skill check integration (attribute, target value, skill, ranks)
- Outcome types (ReputationChange, InitiateCombat, Information, EndConversation, ItemGiven, QuestUpdate)
- Faction reputation effects
- Conditional options (requires item, requires reputation, requires quest state)

**Out of Scope:**
- Ability descriptor schema (v0.14.9b)
- NPC descriptor schema (v0.14.9c)
- Dialogue execution logic (runtime concern)
- Voice acting/audio integration (future feature)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `dialogue.schema.json` |
| Schema Definitions | 6 | `DialogueTree`, `DialogueNode`, `DialogueOption`, `SkillCheck`, `Outcome`, `Condition` |
| Configuration Updates | 8 | Update existing dialogue JSON files with schema reference |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure

```
dialogue.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Dialogue Tree Configuration"
|-- description: "Schema for NPC dialogue trees"
|-- type: array
|-- items: DialogueNode
+-- definitions:
    |-- DialogueNode
    |   |-- Id: string (pattern: ^[a-z][a-z0-9_]*$)
    |   |-- Text: string (minLength: 1)
    |   |-- Options: array of DialogueOption (minItems: 1)
    |   |-- EndsConversation: boolean (default: false)
    |   +-- Conditions: array of Condition (optional, for node visibility)
    |-- DialogueOption
    |   |-- Text: string (minLength: 1)
    |   |-- NextNodeId: string | null (null = ends conversation)
    |   |-- SkillCheck: SkillCheck | null (optional)
    |   |-- Outcome: Outcome | null (optional)
    |   +-- Conditions: array of Condition (optional, for option visibility)
    |-- SkillCheck
    |   |-- Attribute: string (enum: might, finesse, will, intellect)
    |   |-- TargetValue: integer (minimum: 1)
    |   |-- Skill: string | null (optional skill name)
    |   +-- SkillRanks: integer (minimum: 0, default: 0)
    |-- Outcome
    |   |-- Type: string (enum: ReputationChange, InitiateCombat, Information, EndConversation, ItemGiven, ItemTaken, QuestUpdate, FlagSet)
    |   |-- Data: string (context-dependent data)
    |   |-- ReputationChange: integer (default: 0)
    |   +-- AffectedFaction: string | null (faction ID)
    +-- Condition
        |-- Type: string (enum: HasItem, HasReputation, HasQuestState, HasFlag, SkillLevel)
        |-- Target: string (item ID, faction ID, quest ID, flag name, skill name)
        |-- Value: string | integer (required value)
        +-- Operator: string (enum: equals, greaterThan, lessThan, notEquals)
```

### Outcome Types

| Type | Data Field | Effect |
|------|------------|--------|
| `ReputationChange` | Description text | Modify faction reputation |
| `InitiateCombat` | Enemy ID | Start combat encounter |
| `Information` | Info description | Reveal information/lore |
| `EndConversation` | Empty | Close dialogue |
| `ItemGiven` | Item ID | Give item to player |
| `ItemTaken` | Item ID | Remove item from player |
| `QuestUpdate` | Quest state | Update quest progress |
| `FlagSet` | Flag name | Set world state flag |

### Attribute Types for Skill Checks

| Attribute | Description | Example Use |
|-----------|-------------|-------------|
| `might` | Physical strength | Intimidation, breaking objects |
| `finesse` | Dexterity/agility | Sleight of hand, quick reactions |
| `will` | Mental fortitude | Persuasion, resist manipulation |
| `intellect` | Knowledge/reasoning | Recall lore, solve puzzles |

### Acceptance Criteria

- [x] `dialogue.schema.json` created in `config/schemas/`
- [x] Schema validates existing dialogue files without errors
- [x] Dialogue node ID pattern validated
- [x] Options array requires at least one option
- [x] Skill check attributes validated (might, finesse, will, wits)
- [x] Outcome types validated
- [x] Faction references validated
- [x] Conditional options validated
- [x] ~6 unit tests pass (76 tests implemented)

---

## v0.14.9b: Ability Descriptor Schema

[v0.14.9b Design Specification](v0.14.9b-design-specification.md)

### Overview

Create a comprehensive JSON schema for ability and Galdr (magic) flavor text descriptors that validates casting sequences, manifestation descriptions, outcome narratives, miscast effects, and weapon art descriptions.

### Scope

**In Scope:**
- `ability-descriptors.schema.json` - Schema for ability flavor text
- Galdr action descriptors (invocation, chant, manifestation, discharge)
- Galdr manifestation descriptors (visual, auditory, tactile, supernatural)
- Galdr outcome descriptors (hit, miss, critical, partial effect)
- Galdr miscast descriptors (blight corruption, paradox, backlash, fizzle)
- Weapon art descriptors (melee, ranged, defensive)
- Skill usage descriptors (success, failure, critical success)
- Rune school classification (12 rune schools)
- Success level classification
- Variable placeholder documentation

**Out of Scope:**
- Dialogue schema (v0.14.9a)
- NPC descriptor schema (v0.14.9c)
- Ability execution logic (runtime concern)
- Damage calculation (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `ability-descriptors.schema.json` |
| Schema Definitions | 8 | `GaldrActionDescriptor`, `GaldrManifestationDescriptor`, `GaldrOutcomeDescriptor`, `GaldrMiscastDescriptor`, `WeaponArtDescriptor`, `SkillUsageDescriptor`, `RuneSchool`, `SuccessLevel` |
| Configuration Files | 1 | `ability-descriptors.json` with example content |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure

```
ability-descriptors.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Ability Descriptor Configuration"
|-- description: "Schema for ability and Galdr flavor text"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string
|   |-- category: string (enum: galdr-actions, galdr-manifestations, galdr-outcomes, galdr-miscasts, weapon-arts, skill-usage)
|   +-- pools: object (additionalProperties: AbilityDescriptorPool)
|-- required: ["category", "pools"]
+-- definitions:
    |-- GaldrActionDescriptor
    |   |-- id: string
    |   |-- text: string (with {Variable} placeholders)
    |   |-- weight: integer (minimum: 1)
    |   |-- actionType: string (enum: Invocation, Chant, RuneManifestation, Discharge, Aftermath)
    |   |-- runeSchool: RuneSchool | null
    |   |-- abilityName: string | null
    |   |-- successLevel: SuccessLevel | null
    |   |-- biome: string | null
    |   +-- tags: array of string
    |-- GaldrManifestationDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- manifestationType: string (enum: Visual, Auditory, Tactile, Supernatural, RunicGlyph)
    |   |-- runeSchool: RuneSchool
    |   |-- element: string | null (Fire, Ice, Lightning, etc.)
    |   |-- powerLevel: string (enum: Weak, Moderate, Strong, Devastating)
    |   +-- tags: array of string
    |-- GaldrOutcomeDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- outcomeType: string (enum: Hit, Miss, CriticalHit, PartialEffect, FullEffect, Resisted, Immune)
    |   |-- abilityName: string
    |   |-- targetType: string (enum: Enemy, Self, Ally, Area, Environment)
    |   |-- effectCategory: string (enum: Damage, Healing, Buff, Debuff, Control, Utility)
    |   +-- tags: array of string
    |-- GaldrMiscastDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- miscastType: string (enum: BlightCorruption, Paradox, Backlash, Fizzle, WildMagic, RunicInversion)
    |   |-- severity: string (enum: Minor, Moderate, Severe, Catastrophic)
    |   |-- runeSchool: RuneSchool | null
    |   |-- corruptionSource: string | null
    |   +-- mechanicalEffect: object | null (JSON effect data)
    |-- WeaponArtDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- abilityCategory: string (enum: WeaponArt, TacticalAbility, DefensiveAbility)
    |   |-- abilityName: string
    |   |-- weaponType: string | null (TwoHanded, OneHanded, Bow, etc.)
    |   |-- successLevel: SuccessLevel
    |   +-- tags: array of string
    |-- SkillUsageDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- skillName: string
    |   |-- successLevel: SuccessLevel
    |   |-- difficulty: string | null (trivial, easy, moderate, hard, etc.)
    |   +-- tags: array of string
    |-- RuneSchool (enum)
    |   +-- Fehu, Uruz, Thurisaz, Ansuz, Raido, Kenaz, Gebo, Wunjo,
    |       Hagalaz, Naudiz, Isa, Jera, Eihwaz, Perthro, Algiz, Sowilo,
    |       Tiwaz, Berkanan, Ehwaz, Mannaz, Laguz, Ingwaz, Dagaz, Othala
    +-- SuccessLevel (enum)
        +-- MinorSuccess, SolidSuccess, ExceptionalSuccess, Failure, CriticalFailure
```

### Rune Schools

| Rune | Name | Element/Domain | Example Ability |
|------|------|----------------|-----------------|
| ᚠ Fehu | Wealth | Fire | FlameBolt |
| ᚢ Uruz | Strength | Physical | BullRush |
| ᚦ Thurisaz | Giant | Lightning | ThunderStrike |
| ᚨ Ansuz | God | Divine | Prophecy |
| ᚱ Raido | Journey | Movement | Haste |
| ᚲ Kenaz | Torch | Fire/Light | Illuminate |
| ᚷ Gebo | Gift | Support | Blessing |
| ᚹ Wunjo | Joy | Healing | Restoration |
| ᚺ Hagalaz | Hail | Ice | FrostLance |
| ᚾ Naudiz | Need | Binding | Constraint |
| ᛁ Isa | Ice | Ice | Freeze |
| ᛃ Jera | Year | Time | Haste |
| ᛇ Eihwaz | Yew | Death | LifeDrain |
| ᛈ Perthro | Mystery | Fate | FortuneTurn |
| ᛉ Algiz | Elk | Protection | Shield |
| ᛊ Sowilo | Sun | Light | Radiance |
| ᛏ Tiwaz | Tyr | War | BattleFury |
| ᛒ Berkanan | Birch | Growth | Regeneration |
| ᛖ Ehwaz | Horse | Movement | Swiftness |
| ᛗ Mannaz | Man | Mind | Clarity |
| ᛚ Laguz | Water | Water | Torrent |
| ᛝ Ingwaz | Ing | Fertility | Nurture |
| ᛞ Dagaz | Day | Light | Dawn |
| ᛟ Othala | Heritage | Ancestry | AncestralMemory |

### Variable Placeholders

| Variable | Context | Example |
|----------|---------|---------|
| `{Caster}` | Caster name | "Bjorn Ironwill" / "You" |
| `{Target}` | Target name | "the Corrupted Servitor" |
| `{Ability}` | Ability name | "Flame Bolt" |
| `{Rune}` | Rune name | "Fehu" |
| `{RuneSymbol}` | Rune glyph | "ᚠ" |
| `{Element}` | Element type | "Fire" |
| `{Damage}` | Damage amount | "15" |
| `{SuccessCount}` | Successes rolled | "3" |
| `{Weapon}` | Weapon name | "Iron Sword" |
| `{Biome}` | Current biome | "Muspelheim" |

### Acceptance Criteria

- [x] `ability-descriptors.schema.json` created in `config/schemas/`
- [x] Schema validates all rune schools (24 runes)
- [x] Action types validated (Invocation, Chant, etc.)
- [x] Manifestation types validated (Visual, Auditory, etc.)
- [x] Outcome types validated (Hit, Miss, CriticalHit, etc.)
- [x] Miscast types validated (BlightCorruption, Paradox, etc.)
- [x] Success levels validated
- [x] Variable placeholders documented
- [x] ~6 unit tests pass (136 tests implemented)

---

## v0.14.9c: NPC Descriptor Schema

[v0.14.9c Design Specification](v0.14.9c-design-specification.md)

### Overview

Create a comprehensive JSON schema for NPC flavor text descriptors that validates physical appearance descriptions, ambient dialogue barks, and emotional reaction descriptors organized by archetype and context.

### Scope

**In Scope:**
- `npc-descriptors.schema.json` - Schema for NPC flavor text
- Physical appearance descriptors (full body, face, clothing, equipment, bearing)
- Ambient bark descriptors (at work, idle, warning, greeting, threat)
- Reaction descriptors (surprised, angry, fearful, grateful, etc.)
- NPC archetype classification (Dvergr, Seidkona, Bandit, Merchant, etc.)
- NPC subtype classification (Tinkerer, Scout, Veteran, etc.)
- Condition modifiers (healthy, wounded, exhausted, etc.)
- Disposition context (hostile, neutral, friendly, allied)
- Biome context filtering

**Out of Scope:**
- Dialogue schema (v0.14.9a)
- Ability descriptor schema (v0.14.9b)
- NPC AI behavior (runtime concern)
- NPC generation logic (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `npc-descriptors.schema.json` |
| Schema Definitions | 6 | `NPCPhysicalDescriptor`, `NPCAmbientBark`, `NPCReactionDescriptor`, `NPCArchetype`, `NPCCondition`, `Disposition` |
| Configuration Files | 1 | `npc-descriptors.json` with example content |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure

```
npc-descriptors.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "NPC Descriptor Configuration"
|-- description: "Schema for NPC flavor text descriptors"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string
|   |-- category: string (enum: npc-physical, npc-barks, npc-reactions)
|   +-- pools: object (additionalProperties: NPCDescriptorPool)
|-- required: ["category", "pools"]
+-- definitions:
    |-- NPCPhysicalDescriptor
    |   |-- id: string
    |   |-- text: string (with {Variable} placeholders)
    |   |-- weight: integer (minimum: 1)
    |   |-- archetype: NPCArchetype
    |   |-- subtype: string
    |   |-- descriptorType: string (enum: FullBody, Face, Clothing, Equipment, Bearing, Distinguishing)
    |   |-- condition: NPCCondition | null
    |   |-- biome: string | null
    |   |-- ageCategory: string | null (Young, MiddleAged, Elderly, Ageless)
    |   +-- tags: array of string
    |-- NPCAmbientBark
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- archetype: NPCArchetype
    |   |-- subtype: string
    |   |-- barkType: string (enum: AtWork, IdleConversation, Observation, Warning, Celebration, Concern, Suspicion, Encouragement, Complaint, Teaching, Threat, Insult, Wounded, Fleeing, BattleCry, Greeting)
    |   |-- activityContext: string | null (Working, Idle, Trading, Guarding, etc.)
    |   |-- disposition: Disposition | null
    |   |-- triggerCondition: string | null (PlayerNearby, EnemyNear, etc.)
    |   +-- tags: array of string
    |-- NPCReactionDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- archetype: NPCArchetype
    |   |-- subtype: string
    |   |-- reactionType: string (enum: Surprised, Angry, Fearful, Relieved, Suspicious, Joyful, Pained, Confused, Impressed, Disgusted, Grateful, Betrayed, Proud, Curious, Resigned)
    |   |-- triggerEvent: string (PlayerApproaches, PlayerAttacks, AllyKilled, etc.)
    |   |-- intensity: string | null (Mild, Moderate, Strong, Extreme)
    |   |-- priorDisposition: Disposition | null
    |   |-- actionTendency: string | null (Approach, Flee, Attack, Assist, etc.)
    |   +-- tags: array of string
    |-- NPCArchetype (enum)
    |   +-- Dvergr, Seidkona, Bandit, Raider, Merchant, Guard, Citizen, Forlorn
    |-- NPCCondition (enum)
    |   +-- Healthy, Wounded, Exhausted, Affluent, Impoverished, BattleReady
    +-- Disposition (enum)
        +-- Hostile, Unfriendly, Neutral, Friendly, Allied
```

### NPC Archetypes

| Archetype | Description | Example Subtypes |
|-----------|-------------|------------------|
| `Dvergr` | Dwarven craftsmen/engineers | Tinkerer, Runecaster, Merchant |
| `Seidkona` | Norse magic practitioners | WanderingSeidkona, YoungAcolyte, Seidmadr |
| `Bandit` | Outlaws and raiders | Scout, Leader, DesperateOutcast |
| `Raider` | Aggressive warriors | Veteran, Brute, Scavenger |
| `Merchant` | Traders and shopkeepers | Prosperous, Struggling, Shrewd |
| `Guard` | Protectors and enforcers | Veteran, Rookie, Captain |
| `Citizen` | Common folk | Laborer, Artisan, Elder |
| `Forlorn` | Corrupted NPCs | Fresh, Deteriorated, Ancient |

### Bark Types

| Type | Trigger | Example |
|------|---------|---------|
| `AtWork` | NPC performing task | "Pass me that wrench..." |
| `IdleConversation` | NPC idle | "Weather's been strange lately..." |
| `Observation` | Noticing environment | "Did you hear that?" |
| `Warning` | Danger detected | "Stay back!" |
| `Greeting` | Player approaches | "Well met, traveler." |
| `Threat` | Hostile disposition | "Leave now or face consequences." |
| `BattleCry` | Combat initiated | "For the Combine!" |

### Reaction Types

| Type | Trigger Events | Action Tendency |
|------|----------------|-----------------|
| `Surprised` | Unexpected event | Investigate |
| `Angry` | Attack, theft | Attack |
| `Fearful` | Danger, threat | Flee |
| `Grateful` | Help received | Assist |
| `Suspicious` | Strange behavior | Guard |

### Acceptance Criteria

- [ ] `npc-descriptors.schema.json` created in `config/schemas/`
- [ ] NPC archetypes validated (8 types)
- [ ] Descriptor types validated (FullBody, Face, etc.)
- [ ] Bark types validated (16 types)
- [ ] Reaction types validated (15 types)
- [ ] Conditions validated
- [ ] Dispositions validated
- [ ] Variable placeholders documented
- [ ] ~6 unit tests pass

---

## v0.14.9d: Psychological Descriptor Schema

[v0.14.9d Design Specification](v0.14.9d-design-specification.md)

### Overview

Create a comprehensive JSON schema for psychological state descriptors that validates stress manifestations, trauma effects, corruption progression, biome-specific pressure, and recovery narratives.

### Scope

**In Scope:**
- `psychological-descriptors.schema.json` - Schema for psychological flavor text
- Stress threshold descriptors (Minimal, Mounting, Critical, Breaking, Broken)
- Trauma type descriptors (Flashback, Panic, Dissociation, Hypervigilance, Avoidance)
- Corruption progression descriptors (Clean → Touched → Tainted → Corrupted → Lost → Forlorn)
- Biome psychological pressure (isolation, heat, cold, darkness)
- Recovery descriptors (rest, social, grounding, support, acceptance)
- Manifestation types (Physical, Mental, Behavioral)
- Intensity levels (Subtle, Moderate, Oppressive)

**Out of Scope:**
- Dialogue schema (v0.14.9a)
- Ability descriptor schema (v0.14.9b)
- NPC descriptor schema (v0.14.9c)
- Psychological state tracking (runtime concern)
- Mental health mechanics (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `psychological-descriptors.schema.json` |
| Schema Definitions | 6 | `StressDescriptor`, `TraumaDescriptor`, `CorruptionDescriptor`, `BiomePressureDescriptor`, `RecoveryDescriptor`, `PsychologicalThreshold` |
| Configuration Files | 1 | `psychological-descriptors.json` with content from SQL |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure

```
psychological-descriptors.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Psychological Descriptor Configuration"
|-- description: "Schema for psychological state flavor text"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string
|   |-- category: string (enum: stress, trauma, corruption, biome-pressure, recovery)
|   +-- pools: object (additionalProperties: PsychologicalDescriptorPool)
|-- required: ["category", "pools"]
+-- definitions:
    |-- StressDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer (minimum: 1)
    |   |-- threshold: StressThreshold
    |   |-- manifestation: string (enum: Physical, Mental, Behavioral)
    |   |-- intensity: string (enum: Subtle, Moderate, Oppressive)
    |   +-- tags: array of string
    |-- TraumaDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- traumaType: string (enum: Flashback, Panic, Dissociation, Hypervigilance, Avoidance)
    |   |-- intensity: string (enum: Mild, Moderate, Severe)
    |   |-- triggerContext: string | null (Combat, Darkness, Fire, etc.)
    |   +-- tags: array of string
    |-- CorruptionDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- threshold: CorruptionThreshold
    |   |-- manifestation: string (enum: Physical, Mental, Social, Urgent, Final)
    |   +-- tags: array of string
    |-- BiomePressureDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- biome: string (enum: The_Roots, Muspelheim, Niflheim, Svartalfheim, Vanaheim, Jotunheim)
    |   |-- pressureType: string (Isolation, Heat, Cold, Darkness, Growth, Scale, etc.)
    |   |-- intensity: string (enum: Subtle, Moderate, Oppressive)
    |   +-- tags: array of string
    |-- RecoveryDescriptor
    |   |-- id: string
    |   |-- text: string
    |   |-- weight: integer
    |   |-- recoveryType: string (enum: Rest, Social, Grounding, Support, Milestone, Acceptance)
    |   +-- tags: array of string
    |-- StressThreshold (enum)
    |   +-- Minimal (0-25), Mounting (26-50), Critical (51-75), Breaking (76-99), Broken (100)
    +-- CorruptionThreshold (enum)
        +-- Clean (0-10), Touched (11-30), Tainted (31-50), Corrupted (51-75), Lost (76-99), Forlorn (100)
```

### Stress Thresholds

| Threshold | Range | Description | Example Manifestations |
|-----------|-------|-------------|------------------------|
| `Minimal` | 0-25 | Manageable tension | Tight grip, slight headache |
| `Mounting` | 26-50 | Growing pressure | Jaw clenching, flinching at sounds |
| `Critical` | 51-75 | Significant distress | Racing heart, shaking hands |
| `Breaking` | 76-99 | Near collapse | Trembling, tunnel vision |
| `Broken` | 100 | Complete breakdown | Loss of control, dissociation |

### Trauma Types

| Type | Description | Example |
|------|-------------|---------|
| `Flashback` | Reliving past trauma | "You are there again. Not here. THERE." |
| `Panic` | Overwhelming fear response | "You cannot breathe. You cannot think." |
| `Dissociation` | Detachment from reality | "Watching yourself from outside." |
| `Hypervigilance` | Constant threat scanning | "Everyone is a threat. Everything is a trap." |
| `Avoidance` | Avoiding trauma triggers | "You cannot go there. Not again." |

### Corruption Progression

| Threshold | Range | Description |
|-----------|-------|-------------|
| `Clean` | 0-10 | Uncorrupted |
| `Touched` | 11-30 | First signs of taint |
| `Tainted` | 31-50 | Visible corruption |
| `Corrupted` | 51-75 | Significant transformation |
| `Lost` | 76-99 | Nearly consumed |
| `Forlorn` | 100 | Fully transformed |

### Biome Pressure Types

| Biome | Pressure Types | Flavor |
|-------|----------------|--------|
| `The_Roots` | Isolation, Claustrophobia, Dread | Industrial decay, loneliness |
| `Muspelheim` | Heat, Thirst, Fury | Volcanic rage, dehydration |
| `Niflheim` | Cold, Despair, Stillness | Frozen hopelessness |
| `Svartalfheim` | Darkness, Paranoia, Madness | Oppressive shadow |
| `Vanaheim` | Consumption, Infection, Alienation | Predatory growth |
| `Jotunheim` | Scale, Insignificance, Exposure | Giant-realm terror |

### Acceptance Criteria

- [ ] `psychological-descriptors.schema.json` created in `config/schemas/`
- [ ] Stress thresholds validated (5 levels)
- [ ] Trauma types validated (5 types)
- [ ] Corruption thresholds validated (6 levels)
- [ ] Biome pressure validated (6 biomes)
- [ ] Recovery types validated (6 types)
- [ ] Manifestation types validated
- [ ] Intensity levels validated
- [ ] ~6 unit tests pass

---

## v0.14.9e: Capture Template Schema

[v0.14.9e Design Specification](v0.14.9e-design-specification.md)

### Overview

Create a comprehensive JSON schema for lore capture templates that validates discoverable content fragments, codex entry matching, quality values, and capture type classification for the Field Guide system.

### Scope

**In Scope:**
- `capture-templates.schema.json` - Schema for lore fragment definitions
- Capture template structure (ID, type, content, source)
- Capture type classification (TextFragment, EchoRecording, VisualRecord, etc.)
- Codex keyword matching (matchKeywords array)
- Quality/reward values (affects Legend progression)
- Category-level defaults (inherited matchKeywords)
- Tag metadata for filtering

**Out of Scope:**
- Dialogue schema (v0.14.9a)
- Ability descriptor schema (v0.14.9b)
- Codex entry definitions (separate system)
- Field Guide UI (runtime concern)
- Legend calculation (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `capture-templates.schema.json` (JSON Schema Draft-07 conversion) |
| Schema Definitions | 3 | `CaptureTemplateCollection`, `CaptureTemplate`, `CaptureType` |
| Configuration Updates | 6 | Update existing capture template files with schema reference |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure

```
capture-templates.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Capture Template Collection"
|-- description: "Schema for lore fragment capture templates"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- category: string (pattern: ^[a-z][a-z0-9-]*$)
|   |-- version: string (pattern: ^\d+\.\d+\.\d+$)
|   |-- description: string (optional, for content authors)
|   |-- matchKeywords: array of string (category-level defaults)
|   +-- templates: array of CaptureTemplate (minItems: 1)
|-- required: ["category", "version", "templates"]
+-- definitions:
    |-- CaptureTemplate
    |   |-- id: string (pattern: ^[a-z][a-z0-9-]*$, globally unique)
    |   |-- type: CaptureType
    |   |-- fragmentContent: string (minLength: 20, maxLength: 1000)
    |   |-- source: string (minLength: 5, maxLength: 100)
    |   |-- matchKeywords: array of string (optional, overrides category)
    |   |-- quality: integer (minimum: 1, maximum: 100, default: 15)
    |   |-- tags: array of string (optional metadata)
    |   +-- domain4Notes: string (optional, internal documentation)
    +-- CaptureType (enum)
        +-- TextFragment, EchoRecording, VisualRecord, Specimen, OralHistory, RunicTrace
```

### Capture Types

| Type | Description | Example Source |
|------|-------------|----------------|
| `TextFragment` | Written text, notes, inscriptions | "Found in container" |
| `EchoRecording` | Audio recording or memory | "Recovered from terminal" |
| `VisualRecord` | Image, diagram, or visual data | "Wall mural" |
| `Specimen` | Physical sample or artifact | "Creature remains" |
| `OralHistory` | Verbal account from NPC | "Told by Dvergr elder" |
| `RunicTrace` | Magical residue or rune analysis | "Runic examination" |

### Quality Values

| Quality Range | Reward Level | Typical Use |
|---------------|--------------|-------------|
| 1-10 | Minor | Common background lore |
| 11-25 | Standard | Regular discoveries |
| 26-50 | Notable | Important revelations |
| 51-75 | Significant | Major story pieces |
| 76-100 | Exceptional | Critical plot elements |

### Example Categories

| Category | Description | Example Templates |
|----------|-------------|-------------------|
| `rusted-servitor` | Servitor-related lore | servitor-fungal-infection, servitor-core-fragment |
| `blighted-creature` | Blight creature lore | blight-origin-theory, corruption-spread-pattern |
| `ancient-ruin` | Ruin exploration lore | aesir-inscription, pre-glitch-record |
| `industrial-site` | Industrial area lore | maintenance-log, worker-terminal |
| `generic-container` | General container loot | supply-manifest, personal-note |

### Acceptance Criteria

- [ ] `capture-templates.schema.json` created in `config/schemas/`
- [ ] Schema validates existing capture template files
- [ ] Category pattern validated (kebab-case)
- [ ] Template ID pattern validated (globally unique)
- [ ] Capture types validated (6 types)
- [ ] Fragment content length validated (20-1000 chars)
- [ ] Source length validated (5-100 chars)
- [ ] Quality range validated (1-100)
- [ ] Category-level matchKeywords inheritance works
- [ ] ~6 unit tests pass

---

## Dependencies & Prerequisites

```
v0.14.8 (Dice Configuration Schemas) - REQUIRED
    |
    +-- All dice schemas available ─────────────────────────────────────────────┐
                                                                                |
                                        v
v0.14.7 (Descriptor Configuration Schemas) - REQUIRED
    |
    +-- descriptors.schema.json (master schema) ────────────────────────────────┐
                                                                                |
                                        v
v0.14.9 (Advanced Descriptor Configuration Schemas)
    |
    |-- v0.14.9a: Dialogue Schema ──────────────────────────────────────────────┐
    |       Dependencies: None (standalone)                                      |
    |       Provides: dialogue.schema.json                                       |
    |                                                                            |
    |-- v0.14.9b: Ability Descriptor Schema ────────────────────────────────────┤
    |       Dependencies: descriptors.schema.json (extends)                      |
    |       Provides: ability-descriptors.schema.json                            |
    |                                                                            |
    |-- v0.14.9c: NPC Descriptor Schema ────────────────────────────────────────┤
    |       Dependencies: descriptors.schema.json (extends)                      |
    |       Provides: npc-descriptors.schema.json                                |
    |                                                                            |
    |-- v0.14.9d: Psychological Descriptor Schema ──────────────────────────────┤
    |       Dependencies: descriptors.schema.json (extends)                      |
    |       Provides: psychological-descriptors.schema.json                      |
    |                                                                            |
    +-- v0.14.9e: Capture Template Schema ──────────────────────────────────────┘
            Dependencies: None (standalone, already has Draft-2020-12 schema)
            Provides: capture-templates.schema.json (Draft-07 conversion)

Note: v0.14.9a and v0.14.9e are standalone schemas.
      v0.14.9b, v0.14.9c, v0.14.9d extend the master descriptors.schema.json from v0.14.7a.
      All parts can be implemented in parallel after v0.14.7a is complete.
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.14.9a | 1 | 8 | ~6 | High |
| v0.14.9b | 2 | 0 | ~6 | High |
| v0.14.9c | 2 | 0 | ~6 | High |
| v0.14.9d | 2 | 0 | ~6 | Medium |
| v0.14.9e | 1 | 6 | ~6 | Medium |
| **Total** | **8** | **14** | **~30** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| SQL to JSON conversion errors | Medium | Medium | Careful manual review of converted content |
| Variable placeholder inconsistency | Low | Medium | Document all placeholders, validate patterns |
| Schema inheritance complexity | Medium | Low | Use allOf for clean extension |
| Large content volume | Low | High | Batch processing, incremental validation |
| Rune school enumeration | Low | Low | Reference authoritative Norse rune lists |

---

## Design Decisions (Confirmed)

### Schema Standards

| Decision | Value | Notes |
|----------|-------|-------|
| **JSON Schema Version** | Draft-07 | Consistent with v0.14.0-v0.14.8 |
| **ID Pattern** | `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| **Underscore Variant** | `^[a-z][a-z0-9_]*$` | For pool IDs and dialogue nodes |
| **Schema Location** | `config/schemas/` | Centralized schema storage |

### Dialogue Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Node ID Pattern** | Underscore allowed | Match existing dialogue files |
| **Skill Check Attributes** | 4 attributes | might, finesse, will, intellect |
| **Outcome Types** | 8 types | Comprehensive action coverage |
| **Conditions** | 5 types | Support complex branching |

### Ability Descriptor Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Rune Schools** | 24 schools | Complete Elder Futhark |
| **Success Levels** | 5 levels | Match dice system |
| **Action Types** | 7 types | Full casting sequence |
| **Miscast Types** | 7 types | Varied failure modes |

### NPC Descriptor Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Archetypes** | 8 types | Cover all NPC categories |
| **Bark Types** | 16 types | Comprehensive ambient dialogue |
| **Reaction Types** | 15 types | Full emotional range |
| **Dispositions** | 5 levels | Match faction system |

### Psychological Descriptor Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Stress Thresholds** | 5 levels | 0-25, 26-50, 51-75, 76-99, 100 |
| **Trauma Types** | 5 types | Clinical categories |
| **Corruption Thresholds** | 6 levels | Match Forlorn transformation |
| **Biomes** | 6 biomes | All game biomes |

### Capture Template Design

| Decision | Value | Notes |
|----------|-------|-------|
| **Capture Types** | 6 types | Various discovery methods |
| **Quality Range** | 1-100 | Granular reward scaling |
| **Content Length** | 20-1000 | Prevent empty/excessive text |
| **Source Length** | 5-100 | Brief discovery context |

---

## Migration Notes

### SQL to JSON Conversion

The existing SQL schema and content files in `docs/design/descriptors/` need to be converted to JSON format:

1. **Schema Files** (`schemas/*.sql`) → JSON Schema definitions
2. **Content Files** (`descriptors/*.sql`) → JSON configuration files

### Conversion Strategy

```
SQL Table                          JSON Schema Definition
─────────────────────────────────  ─────────────────────────────────
Galdr_Action_Descriptors      →    GaldrActionDescriptor
Galdr_Manifestation_Descriptors →  GaldrManifestationDescriptor
NPC_Physical_Descriptors      →    NPCPhysicalDescriptor
Psychological_Stress_Descriptors → StressDescriptor
```

### Existing JSON Files

Some content already exists as JSON and needs schema references added:

| File Location | Schema to Reference |
|---------------|---------------------|
| `docs/design/descriptors/dialogues/*.json` | `dialogue.schema.json` |
| `docs/design/descriptors/capture-templates/categories/*.json` | `capture-templates.schema.json` |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.14.9a Design Spec** - Create dialogue schema
3. **v0.14.9a Implementation** - Build dialogue.schema.json
4. **v0.14.9b Design Spec** - Create ability descriptor schema
5. **v0.14.9b Implementation** - Build ability-descriptors.schema.json
6. **v0.14.9c Design Spec** - Create NPC descriptor schema
7. **v0.14.9c Implementation** - Build npc-descriptors.schema.json
8. **v0.14.9d Design Spec** - Create psychological descriptor schema
9. **v0.14.9d Implementation** - Build psychological-descriptors.schema.json
10. **v0.14.9e Design Spec** - Create capture template schema
11. **v0.14.9e Implementation** - Build capture-templates.schema.json
12. **Update v0.14.x-overview.md** - Add v0.14.9 section

---

*This scope breakdown provides a structured approach to implementing v0.14.9 Advanced Descriptor Configuration Schemas. The schemas enable full customization of dialogue trees, ability flavor text, NPC descriptions, psychological states, and discoverable lore—all configurable without code changes. This completes the descriptor configuration infrastructure started in v0.14.7.*
