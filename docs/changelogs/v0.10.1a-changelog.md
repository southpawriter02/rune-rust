# v0.10.1a Changelog: Defense Actions

**Version:** 0.10.1a
**Phase:** Defense Actions (Block, Dodge, Parry)
**Date:** 2026-01-18
**Status:** ✅ Complete

---

## Summary

Implements defensive combat actions allowing combatants to react to incoming attacks with Block, Dodge, and Parry mechanics.

---

## Added

### Domain Layer - Enums

| Enum | Values | Description |
|------|--------|-------------|
| `DefenseActionType` | Block, Dodge, Parry | Types of defensive reactions available in combat |

### Domain Layer - Entity Updates

| Entity | Changes |
|--------|---------|
| `Combatant` | Added `HasReaction` property, `UseReaction()` method, `ResetReaction()` method |

### Application Layer - DTOs

| DTO | Description |
|-----|-------------|
| `BlockResult` | Result of block action with FinalDamage, DamagePrevented, ShieldBonus |
| `DodgeResult` | Result of dodge action with DodgeRoll, AttackRoll, AvoidedAttack |
| `ParryResult` | Result of parry action with ParryRoll, DC, CounterAttack result |
| `CounterAttackResult` | Result of parry counter-attack with AttackRoll, Damage, IsCritical |

### Application Layer - Events

| Event | Description |
|-------|-------------|
| `BlockedEvent` | Raised when damage is blocked with shield |
| `DodgeAttemptedEvent` | Raised when dodge is attempted (success or failure) |
| `ParrySuccessEvent` | Raised when parry succeeds with counter-attack |
| `ParryFailedEvent` | Raised when parry fails to deflect |
| `ReactionUsedEvent` | Raised when a reaction is consumed |
| `ReactionResetEvent` | Raised when reaction is restored |

### Application Layer - Interface

| Interface | Methods |
|-----------|---------|
| `IDefenseActionService` | CanBlock, CanDodge, CanParry, UseBlock, UseDodge, UseParry, HasReaction, ResetReaction, GetAvailableDefenses |

### Application Layer - Service

| Service | Description |
|---------|-------------|
| `DefenseActionService` | Full implementation of defense actions with dice rolling, equipment checks, counter-attacks |

### Configuration

| File | Description |
|------|-------------|
| `config/defense-actions.json` | Defense action configuration (reduction values, requirements, DC bonuses) |
| `config/schemas/defense-actions.schema.json` | JSON schema for defense action configuration |

---

## Defense Mechanics

### Block
- **Requirement:** Shield equipped
- **Reaction Cost:** None
- **Effect:** Reduces incoming damage by 50% + shield's defense bonus
- **Minimum Damage:** 0

### Dodge
- **Requirements:** Reaction available, not wearing heavy armor
- **Reaction Cost:** Consumes reaction
- **Roll:** 1d10 + (Finesse / 2) vs Attack Roll
- **Effect:** On success, attack misses entirely

### Parry
- **Requirements:** Reaction available, melee weapon equipped
- **Reaction Cost:** Consumes reaction
- **Roll:** 1d10 + (Finesse / 2) vs (Attack Roll + 2)
- **Effect:** On success, deflects attack and triggers counter-attack

---

## Unit Tests

**15 tests** covering:
- Block eligibility (with/without shield)
- Block damage reduction and shield bonus
- Dodge eligibility (reaction, heavy armor restrictions)
- Dodge roll success and failure
- Dodge reaction consumption
- Parry eligibility (melee weapon requirement)
- Parry counter-attack on success
- Parry higher DC than dodge
- Parry reaction consumption
- Reaction reset functionality

---

## Files Changed

| Path | Change |
|------|--------|
| `src/.../Domain/Enums/DefenseActionType.cs` | NEW |
| `src/.../Domain/Entities/Combatant.cs` | MODIFIED - Added reaction tracking |
| `src/.../Application/DTOs/DefenseActionResults.cs` | NEW |
| `src/.../Application/Events/DefenseActionEvents.cs` | NEW |
| `src/.../Application/Interfaces/IDefenseActionService.cs` | NEW |
| `src/.../Application/Services/DefenseActionService.cs` | NEW |
| `config/defense-actions.json` | NEW |
| `config/schemas/defense-actions.schema.json` | NEW |
| `tests/.../Services/DefenseActionServiceTests.cs` | NEW |

---

## v0.10.1 Progress

| Version | Feature | Status |
|---------|---------|--------|
| v0.10.1a | Defense Actions | ✅ Complete |
| v0.10.1b | Combat UI Integration | Next |
| v0.10.1c | AI Defense Behavior | Planned |

---

## Dependencies

| Dependency | Purpose |
|------------|---------|
| `IDiceService` | Dice rolling for dodge/parry |
| `IGameEventLogger` | Event logging for combat |
| `EquipmentSlot` enum | Shield, Weapon, Armor slot checks |
| `ArmorType` enum | Heavy armor detection |
