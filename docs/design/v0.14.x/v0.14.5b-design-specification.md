# v0.14.5b Design Specification: Resource Schema

**Version:** 0.14.5b
**Parent:** v0.14.5 (Economy Configuration Schemas)
**Prerequisites:** v0.14.4 Complete (Environment Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Resource Schema Root Definition](#4-resource-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [ResourceDefinition Schema](#42-resourcedefinition-schema)
5. [Display Configuration](#5-display-configuration)
   - 5.1 [Display Name and Abbreviation](#51-display-name-and-abbreviation)
   - 5.2 [Color Configuration](#52-color-configuration)
   - 5.3 [Icon Configuration](#53-icon-configuration)
6. [Resource Mechanics Configuration](#6-resource-mechanics-configuration)
   - 6.1 [Default Maximum Value](#61-default-maximum-value)
   - 6.2 [MaxCalculation Definition](#62-maxcalculation-definition)
   - 6.3 [AttributeScaling Definition](#63-attributescaling-definition)
7. [Regeneration and Decay Configuration](#7-regeneration-and-decay-configuration)
   - 7.1 [Regeneration Per Turn](#71-regeneration-per-turn)
   - 7.2 [Decay Per Turn](#72-decay-per-turn)
   - 7.3 [Combat Context Flags](#73-combat-context-flags)
8. [Build-On Trigger Configuration](#8-build-on-trigger-configuration)
   - 8.1 [Build-On Damage Dealt](#81-build-on-damage-dealt)
   - 8.2 [Build-On Damage Taken](#82-build-on-damage-taken)
   - 8.3 [Build-On Heal](#83-build-on-heal)
   - 8.4 [Build-On Kill](#84-build-on-kill)
   - 8.5 [Build-On Critical](#85-build-on-critical)
9. [Resource Flags Configuration](#9-resource-flags-configuration)
   - 9.1 [Universal Resource Flag](#91-universal-resource-flag)
   - 9.2 [Starts At Zero Flag](#92-starts-at-zero-flag)
10. [Depletion Effect Configuration](#10-depletion-effect-configuration)
    - 10.1 [DepletionEffect Definition](#101-depletioneffect-definition)
    - 10.2 [Depletion Behaviors](#102-depletion-behaviors)
11. [Validation Rules](#11-validation-rules)
    - 11.1 [ID Pattern Validation](#111-id-pattern-validation)
    - 11.2 [Range Validation](#112-range-validation)
    - 11.3 [Required Fields](#113-required-fields)
    - 11.4 [Enum Validation](#114-enum-validation)
12. [Configuration Schema](#12-configuration-schema)
13. [Configuration File Updates](#13-configuration-file-updates)
14. [Data Model Changes](#14-data-model-changes)
15. [Logging Specifications](#15-logging-specifications)
16. [Unit Testing Requirements](#16-unit-testing-requirements)
17. [Use Cases](#17-use-cases)
18. [Deliverable Checklist](#18-deliverable-checklist)
19. [Acceptance Criteria](#19-acceptance-criteria)
20. [Dependencies](#20-dependencies)
21. [Future Considerations](#21-future-considerations)

---

## 1. Executive Summary

Version 0.14.5b introduces the **Resource Schema** (`resources.schema.json`), which validates resource definitions including regeneration rules, maximum calculations, depletion effects, and visual representations for class resources like mana, rage, and energy. This schema enables full customization of class resource mechanics without code changes, supporting modding scenarios such as alternative magic systems, stamina-based combat, combo-building mechanics, or faith-based divine powers.

The Resource Schema validates the existing `resources.json` configuration file which currently defines 6 resources (health, mana, rage, energy, faith, focus). The schema establishes patterns for resource-related configurations that complement currencies (v0.14.5a) and support future ability cost systems.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `resources.schema.json` |
| **Schema Definitions** | `ResourceDefinition`, `MaxCalculation`, `AttributeScaling`, `DepletionEffect` |
| **Configuration Files** | Update `resources.json` to reference new schema |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version provides:
- **Regeneration rule validation** - Per-turn regeneration with combat context
- **Decay mechanic validation** - Per-turn decay with out-of-combat restrictions
- **Build-on trigger validation** - Resource generation from combat actions
- **Maximum calculation formulas** - Attribute scaling and class overrides
- **Depletion effect references** - Status effects at zero resource
- **Visual configuration** - Color and abbreviation for UI bars

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  v0.14.5 ECONOMY CONFIGURATION SCHEMAS                       │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.5a: currency.schema.json                                         │
  │  v0.14.5b: resources.schema.json ◀── THIS VERSION                       │
  │  v0.14.5c: recipes.schema.json                                          │
  │  v0.14.5d: vendors.schema.json                                          │
  └─────────────────────────────────────────────────────────────────────────┘

  Cross-references:
  • resources.json → depletionEffect.statusEffectId references status-effects.json
  • abilities.json → resourceCost references resource IDs (future)
  • classes.json → primaryResource references resource IDs (future)

  Shared definitions:
  • ID pattern: ^[a-z][a-z0-9-]*$ (lowercase kebab-case)
  • Schema location: config/schemas/
  • Resource types array: Array of resource definitions
```

---

## 2. Feature Overview

```
v0.14.5b Resource Schema Features
├── resources.schema.json
│   ├── Root Configuration Properties
│   │   ├── $schema (string, optional)
│   │   ├── version (string, optional)
│   │   └── resourceTypes (array of ResourceDefinition, required)
│   └── Definitions
│       ├── ResourceDefinition
│       │   ├── id (string, kebab-case pattern, required)
│       │   ├── displayName (string, minLength: 1, required)
│       │   ├── abbreviation (string, 1-4 characters, required)
│       │   ├── description (string, required)
│       │   ├── color (string, hex color, required)
│       │   ├── defaultMax (integer, minimum: 1, required)
│       │   ├── maxCalculation (MaxCalculation, optional)
│       │   ├── regenPerTurn (integer, minimum: 0, default: 0)
│       │   ├── regenOutOfCombatOnly (boolean, default: false)
│       │   ├── decayPerTurn (integer, minimum: 0, default: 0)
│       │   ├── decayOnlyOutOfCombat (boolean, default: false)
│       │   ├── buildOnDamageDealt (integer, optional)
│       │   ├── buildOnDamageTaken (integer, optional)
│       │   ├── buildOnHeal (integer, optional)
│       │   ├── buildOnKill (integer, optional)
│       │   ├── buildOnCritical (integer, optional)
│       │   ├── isUniversal (boolean, default: false)
│       │   ├── startsAtZero (boolean, default: false)
│       │   ├── depletionEffect (DepletionEffect, optional)
│       │   ├── iconId (string, optional)
│       │   └── sortOrder (integer, minimum: 0, required)
│       ├── MaxCalculation
│       │   ├── baseValue (integer, minimum: 1, required)
│       │   ├── perLevelBonus (integer, optional)
│       │   ├── attributeScaling (AttributeScaling, optional)
│       │   └── classOverrides (object, optional)
│       ├── AttributeScaling
│       │   ├── attribute (enum: might/fortitude/will/wits/finesse, required)
│       │   └── multiplier (number, minimum: 0, required)
│       └── DepletionEffect
│           ├── statusEffectId (string, optional)
│           ├── preventActions (boolean, default: false)
│           └── message (string, optional)
├── Validation Rules
│   ├── Resource ID Pattern Validation (kebab-case)
│   ├── Abbreviation Length Validation (1-4 characters)
│   ├── Color Hex Validation (#RRGGBB format)
│   ├── Default Max Range Validation (>= 1)
│   ├── Regen/Decay Range Validation (>= 0)
│   ├── Build-On Trigger Validation (optional integers)
│   ├── Attribute Enum Validation (5 values)
│   └── Required Fields Enforced
└── Configuration Updates
    └── resources.json updated with $schema reference
```

---

## 3. Architecture Diagrams

### 3.1 Resource Definition Structure Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       RESOURCE DEFINITION STRUCTURE                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      RESOURCE DEFINITION                             │    │
│  │                                                                      │    │
│  │  id: "rage"                                                          │    │
│  │  displayName: "Fury"                                                 │    │
│  │  abbreviation: "RG"                                                  │    │
│  │  description: "Battle fury that builds from combat..."               │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  DISPLAY CONFIGURATION                                         │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ color: "#FF6600"       (hex color for UI bar)           │  │  │    │
│  │  │  │ iconId: "icon-rage"    (optional icon reference)        │  │  │    │
│  │  │  │ sortOrder: 2           (display order in UI)            │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  MAXIMUM CONFIGURATION                                         │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ defaultMax: 100        (base maximum value)             │  │  │    │
│  │  │  │ maxCalculation: {      (optional formula)               │  │  │    │
│  │  │  │   baseValue: 50,                                        │  │  │    │
│  │  │  │   perLevelBonus: 5,                                     │  │  │    │
│  │  │  │   attributeScaling: { attribute: "might", mult: 2.0 }   │  │  │    │
│  │  │  │ }                                                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  REGENERATION / DECAY                                          │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ regenPerTurn: 0        (amount regenerated per turn)    │  │  │    │
│  │  │  │ regenOutOfCombatOnly: false                             │  │  │    │
│  │  │  │ decayPerTurn: 10       (amount lost per turn)           │  │  │    │
│  │  │  │ decayOnlyOutOfCombat: true (only decay when not fighting)│  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  BUILD-ON TRIGGERS                                             │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ buildOnDamageDealt: 10  (gain when dealing damage)      │  │  │    │
│  │  │  │ buildOnDamageTaken: 15  (gain when taking damage)       │  │  │    │
│  │  │  │ buildOnHeal: null       (not used for rage)             │  │  │    │
│  │  │  │ buildOnKill: null       (not used for rage)             │  │  │    │
│  │  │  │ buildOnCritical: null   (not used for rage)             │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  FLAGS                                                         │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ isUniversal: false      (not all classes have this)     │  │  │    │
│  │  │  │ startsAtZero: true      (starts empty, builds up)       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  DEPLETION EFFECT (optional)                                   │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ statusEffectId: null    (no status at zero rage)        │  │  │    │
│  │  │  │ preventActions: false   (can still act at zero)         │  │  │    │
│  │  │  │ message: null           (no special message)            │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits resources.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads resources.schema.json from config/schemas/                         │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "abbreviation must be 1-4 characters"
                           • "color must match hex pattern #RRGGBB"
                           • "defaultMax must be >= 1"
                           • "attribute must be one of: might, fortitude, will, wits, finesse"
```

### 3.3 Resource Behavior Patterns

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       RESOURCE BEHAVIOR PATTERNS                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  PATTERN A: TRADITIONAL MANA (Regenerating Pool)                             │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  ████████████████████░░░░░░░░░░  80/100 MP                             │ │
│  │                                                                        │ │
│  │  • Starts at maximum                                                   │ │
│  │  • Regenerates each turn (+10)                                         │ │
│  │  • Spent on abilities                                                  │ │
│  │  • No decay                                                            │ │
│  │                                                                        │ │
│  │  Config: startsAtZero: false, regenPerTurn: 10, decayPerTurn: 0        │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  PATTERN B: RAGE (Combat Builder)                                            │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  ██████████░░░░░░░░░░░░░░░░░░░░  35/100 RG                             │ │
│  │                                                                        │ │
│  │  • Starts at zero                                                      │ │
│  │  • Builds when dealing/taking damage                                   │ │
│  │  • Decays out of combat (-10/turn)                                     │ │
│  │  • Spent on powerful abilities                                         │ │
│  │                                                                        │ │
│  │  Config: startsAtZero: true, buildOnDamageDealt: 10,                   │ │
│  │          buildOnDamageTaken: 15, decayPerTurn: 10,                     │ │
│  │          decayOnlyOutOfCombat: true                                    │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  PATTERN C: ENERGY (Fast Regeneration)                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  ██████████████████████████████  100/100 EN                            │ │
│  │                                                                        │ │
│  │  • Starts at maximum                                                   │ │
│  │  • Rapid regeneration (+20/turn)                                       │ │
│  │  • Used for quick actions                                              │ │
│  │  • No decay                                                            │ │
│  │                                                                        │ │
│  │  Config: startsAtZero: false, regenPerTurn: 20, decayPerTurn: 0        │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  PATTERN D: FAITH (Hybrid Builder/Regen)                                     │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  ████████████████████████░░░░░░  75/100 FTH                            │ │
│  │                                                                        │ │
│  │  • Starts at maximum                                                   │ │
│  │  • Slow passive regeneration (+5/turn)                                 │ │
│  │  • Also builds from healing (+15 per heal)                             │ │
│  │  • No decay                                                            │ │
│  │                                                                        │ │
│  │  Config: startsAtZero: false, regenPerTurn: 5, buildOnHeal: 15         │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  PATTERN E: HEALTH (Universal, No Regen)                                     │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  ████████████████░░░░░░░░░░░░░░  55/100 HP                             │ │
│  │                                                                        │ │
│  │  • Starts at maximum                                                   │ │
│  │  • No natural regeneration                                             │ │
│  │  • All classes have this (isUniversal: true)                           │ │
│  │  • Depletion = defeat                                                  │ │
│  │                                                                        │ │
│  │  Config: isUniversal: true, regenPerTurn: 0, startsAtZero: false,      │ │
│  │          depletionEffect: { preventActions: true, message: "..." }     │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Maximum Calculation System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      MAXIMUM CALCULATION SYSTEM                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  TWO APPROACHES TO MAXIMUM VALUE                                             │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  APPROACH 1: Simple defaultMax                                         │ │
│  │  ──────────────────────────────                                        │ │
│  │                                                                        │ │
│  │  "defaultMax": 100                                                     │ │
│  │                                                                        │ │
│  │  Result: All characters have 100 max (static value)                    │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  APPROACH 2: maxCalculation Formula                                    │ │
│  │  ──────────────────────────────────                                    │ │
│  │                                                                        │ │
│  │  "maxCalculation": {                                                   │ │
│  │      "baseValue": 50,                                                  │ │
│  │      "perLevelBonus": 5,                                               │ │
│  │      "attributeScaling": {                                             │ │
│  │          "attribute": "will",                                          │ │
│  │          "multiplier": 3.0                                             │ │
│  │      },                                                                │ │
│  │      "classOverrides": {                                               │ │
│  │          "galdr-caster": 120                                           │ │
│  │      }                                                                 │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  │  Formula: base + (level × perLevelBonus) + (attribute × multiplier)    │ │
│  │                                                                        │ │
│  │  Example (Level 5 Galdr-Caster with 18 Will):                          │ │
│  │  • Base override for galdr-caster: 120                                 │ │
│  │  • + Level bonus: 5 × 5 = 25                                           │ │
│  │  • + Attribute scaling: 18 × 3.0 = 54                                  │ │
│  │  • Total: 120 + 25 + 54 = 199 max mana                                 │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ATTRIBUTE SCALING OPTIONS                                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Attribute    │ Typical Resources         │ Example Multiplier         │ │
│  │  ─────────────┼───────────────────────────┼─────────────────────────── │ │
│  │  might        │ Health, Rage              │ 2.0 (HP), 1.5 (Rage)       │ │
│  │  fortitude    │ Health, Stamina           │ 3.0 (HP), 2.0 (Stamina)    │ │
│  │  will         │ Mana, Faith               │ 3.0 (Mana), 2.5 (Faith)    │ │
│  │  wits         │ Focus, Energy             │ 2.0 (Focus), 1.5 (Energy)  │ │
│  │  finesse      │ Energy, Combo Points      │ 1.0 (Combo)                │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  CLASS OVERRIDES                                                             │ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  "classOverrides": {                                                   │ │
│  │      "galdr-caster": 120,    // Mage class gets more mana base         │ │
│  │      "shieldmaiden": 80,     // Warrior class gets less mana           │ │
│  │      "blood-priest": 100     // Hybrid gets standard                   │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  │  If class not in overrides, uses baseValue                             │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Build-On Trigger System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        BUILD-ON TRIGGER SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  TRIGGER EVENTS AND RESOURCE GAINS                                           │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  buildOnDamageDealt                                                    │ │
│  │  ──────────────────────                                                │ │
│  │  Event: Character deals damage to enemy                                │ │
│  │  Gain: Fixed amount per damage instance (not per damage point)         │ │
│  │                                                                        │ │
│  │  Example: Warrior hits enemy for 25 damage                             │ │
│  │           buildOnDamageDealt: 10 → Gain 10 Rage                        │ │
│  │                                                                        │ │
│  │  ┌────────────────┐      ┌────────────────┐      ┌────────────────┐   │ │
│  │  │  Warrior hits  │ ──▶  │  25 damage     │ ──▶  │  +10 Rage      │   │ │
│  │  │    enemy       │      │   dealt        │      │   gained       │   │ │
│  │  └────────────────┘      └────────────────┘      └────────────────┘   │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  buildOnDamageTaken                                                    │ │
│  │  ──────────────────────                                                │ │
│  │  Event: Character takes damage from any source                         │ │
│  │  Gain: Fixed amount per damage instance                                │ │
│  │                                                                        │ │
│  │  Example: Warrior takes 15 damage                                      │ │
│  │           buildOnDamageTaken: 15 → Gain 15 Rage                        │ │
│  │                                                                        │ │
│  │  ┌────────────────┐      ┌────────────────┐      ┌────────────────┐   │ │
│  │  │  Warrior takes │ ──▶  │  15 damage     │ ──▶  │  +15 Rage      │   │ │
│  │  │    damage      │      │   received     │      │   gained       │   │ │
│  │  └────────────────┘      └────────────────┘      └────────────────┘   │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  buildOnHeal                                                           │ │
│  │  ─────────────────                                                     │ │
│  │  Event: Character heals any target (self or ally)                      │ │
│  │  Gain: Fixed amount per heal instance                                  │ │
│  │                                                                        │ │
│  │  Example: Priest heals ally for 30 HP                                  │ │
│  │           buildOnHeal: 15 → Gain 15 Faith                              │ │
│  │                                                                        │ │
│  │  ┌────────────────┐      ┌────────────────┐      ┌────────────────┐   │ │
│  │  │  Priest heals  │ ──▶  │  30 HP         │ ──▶  │  +15 Faith     │   │ │
│  │  │    ally        │      │   restored     │      │   gained       │   │ │
│  │  └────────────────┘      └────────────────┘      └────────────────┘   │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  buildOnKill                                                           │ │
│  │  ─────────────────                                                     │ │
│  │  Event: Character delivers killing blow to enemy                       │ │
│  │  Gain: Fixed amount per kill                                           │ │
│  │                                                                        │ │
│  │  Example: Rogue kills goblin                                           │ │
│  │           buildOnKill: 25 → Gain 25 Energy                             │ │
│  │                                                                        │ │
│  │  ┌────────────────┐      ┌────────────────┐      ┌────────────────┐   │ │
│  │  │  Rogue kills   │ ──▶  │  Enemy         │ ──▶  │  +25 Energy    │   │ │
│  │  │    enemy       │      │   defeated     │      │   gained       │   │ │
│  │  └────────────────┘      └────────────────┘      └────────────────┘   │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  buildOnCritical                                                       │ │
│  │  ─────────────────────                                                 │ │
│  │  Event: Character lands a critical hit                                 │ │
│  │  Gain: Fixed amount per critical                                       │ │
│  │                                                                        │ │
│  │  Example: Tinker crits with gadget                                     │ │
│  │           buildOnCritical: 10 → Gain 10 Focus                          │ │
│  │                                                                        │ │
│  │  ┌────────────────┐      ┌────────────────┐      ┌────────────────┐   │ │
│  │  │  Tinker crits  │ ──▶  │  Critical      │ ──▶  │  +10 Focus     │   │ │
│  │  │    enemy       │      │   hit landed   │      │   gained       │   │ │
│  │  └────────────────┘      └────────────────┘      └────────────────┘   │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 Depletion Effect System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        DEPLETION EFFECT SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  WHAT HAPPENS WHEN A RESOURCE REACHES ZERO                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  NO DEPLETION EFFECT (Most Resources)                                  │ │
│  │  ───────────────────────────────────────                               │ │
│  │                                                                        │ │
│  │  Resource: Mana, Rage, Energy, Faith, Focus                            │ │
│  │  At Zero: Character cannot use abilities requiring that resource       │ │
│  │  Actions: Still allowed (basic attacks, movement, items)               │ │
│  │                                                                        │ │
│  │  depletionEffect: (not set or null)                                    │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  DEPLETION WITH STATUS EFFECT                                          │ │
│  │  ───────────────────────────────────                                   │ │
│  │                                                                        │ │
│  │  Resource: Custom "Stamina" resource                                   │ │
│  │  At Zero: Apply "Exhausted" status effect                              │ │
│  │                                                                        │ │
│  │  depletionEffect: {                                                    │ │
│  │      statusEffectId: "exhausted",                                      │ │
│  │      preventActions: false,                                            │ │
│  │      message: "You are exhausted and moving sluggishly."               │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  0/100 STAMINA                         │ │
│  │                  │                                                     │ │
│  │                  ▼                                                     │ │
│  │  ┌────────────────────────────────────────────────────────┐            │ │
│  │  │  Status Applied: EXHAUSTED                             │            │ │
│  │  │  Effects: -20% movement speed, -10% attack speed       │            │ │
│  │  │  Duration: Until stamina > 0                           │            │ │
│  │  └────────────────────────────────────────────────────────┘            │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  DEPLETION WITH PREVENT ACTIONS (Health)                               │ │
│  │  ──────────────────────────────────────────                            │ │
│  │                                                                        │ │
│  │  Resource: Health                                                      │ │
│  │  At Zero: Character is incapacitated/defeated                          │ │
│  │                                                                        │ │
│  │  depletionEffect: {                                                    │ │
│  │      statusEffectId: "defeated",                                       │ │
│  │      preventActions: true,                                             │ │
│  │      message: "You have been defeated!"                                │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  │  ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  0/100 HP                              │ │
│  │                  │                                                     │ │
│  │                  ▼                                                     │ │
│  │  ┌────────────────────────────────────────────────────────┐            │ │
│  │  │  CHARACTER DEFEATED                                    │            │ │
│  │  │  • Cannot take any actions                             │            │ │
│  │  │  • Cannot move                                         │            │ │
│  │  │  • Must be revived or rest                             │            │ │
│  │  └────────────────────────────────────────────────────────┘            │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  DEPLETION WITH MESSAGE ONLY                                           │ │
│  │  ────────────────────────────────                                      │ │
│  │                                                                        │ │
│  │  Resource: Custom "Morale" resource                                    │ │
│  │  At Zero: Show warning message, no mechanical effect                   │ │
│  │                                                                        │ │
│  │  depletionEffect: {                                                    │ │
│  │      message: "Your morale has broken. Consider retreating."           │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.7 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── resources.json ◀────────────────────────────┐                          │
│  │   {                                            │ references               │
│  │     "$schema": "./schemas/resources.schema.json",                         │
│  │     "resourceTypes": [                         │                          │
│  │       {                                        │                          │
│  │         "id": "health",                        │                          │
│  │         "displayName": "Vitality",             │                          │
│  │         "abbreviation": "HP",                  │                          │
│  │         "description": "...",                  │                          │
│  │         "color": "#FF0000",                    │                          │
│  │         "defaultMax": 100,                     │                          │
│  │         "regenPerTurn": 0,                     │                          │
│  │         "decayPerTurn": 0,                     │                          │
│  │         "isUniversal": true,                   │                          │
│  │         "startsAtZero": false,                 │                          │
│  │         "depletionEffect": {                   │                          │
│  │           "statusEffectId": "defeated",        │ → status-effects.json    │
│  │           "preventActions": true,              │                          │
│  │           "message": "..."                     │                          │
│  │         },                                     │                          │
│  │         "sortOrder": 0                         │                          │
│  │       },                                       │                          │
│  │       ...                                      │                          │
│  │     ]                                          │                          │
│  │   }                                            │                          │
│  │                                                │                          │
│  ├── abilities.json (references resource IDs for costs, future)             │
│  ├── classes.json (references primary resource IDs, future)                 │
│  │                                                │                          │
│  └── schemas/                                     │                          │
│      └── resources.schema.json ──────────────────┘                          │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {                                                  │
│              "ResourceDefinition": {...},                                    │
│              "MaxCalculation": {...},                                        │
│              "AttributeScaling": {...},                                      │
│              "DepletionEffect": {...}                                        │
│            }                                                                 │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Resource Schema Root Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/resources.schema.json`

The resource schema follows JSON Schema Draft-07 specification, providing comprehensive validation for resource configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Resource Configuration",
    "description": "Schema for class resource definitions including regeneration rules, maximum calculations, depletion effects, and visual representation.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "resourceTypes": {
            "type": "array",
            "description": "List of resource type definitions",
            "items": {
                "$ref": "#/definitions/ResourceDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["resourceTypes"],
    "additionalProperties": false,
    "definitions": {
        "ResourceDefinition": { ... },
        "MaxCalculation": { ... },
        "AttributeScaling": { ... },
        "DepletionEffect": { ... }
    }
}
```

### 4.2 ResourceDefinition Schema

The `ResourceDefinition` object defines a complete resource with all its mechanics and display properties.

```json
"ResourceDefinition": {
    "type": "object",
    "description": "A resource definition with regeneration, decay, build triggers, and display properties",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the resource (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "displayName": {
            "type": "string",
            "description": "Display name for the resource shown in UI",
            "minLength": 1,
            "maxLength": 50
        },
        "abbreviation": {
            "type": "string",
            "description": "Short abbreviation for compact UI display (1-4 characters)",
            "minLength": 1,
            "maxLength": 4
        },
        "description": {
            "type": "string",
            "description": "Flavor text describing the resource"
        },
        "color": {
            "type": "string",
            "description": "Hex color code for UI resource bar",
            "pattern": "^#[0-9A-Fa-f]{6}$"
        },
        "defaultMax": {
            "type": "integer",
            "description": "Default maximum value for this resource",
            "minimum": 1
        },
        "maxCalculation": {
            "$ref": "#/definitions/MaxCalculation",
            "description": "Optional formula for calculating maximum based on level and attributes"
        },
        "regenPerTurn": {
            "type": "integer",
            "description": "Amount regenerated each turn",
            "minimum": 0,
            "default": 0
        },
        "regenOutOfCombatOnly": {
            "type": "boolean",
            "description": "If true, regeneration only occurs outside of combat",
            "default": false
        },
        "decayPerTurn": {
            "type": "integer",
            "description": "Amount lost each turn (decay)",
            "minimum": 0,
            "default": 0
        },
        "decayOnlyOutOfCombat": {
            "type": "boolean",
            "description": "If true, decay only occurs outside of combat",
            "default": false
        },
        "buildOnDamageDealt": {
            "type": "integer",
            "description": "Amount gained when dealing damage",
            "minimum": 1
        },
        "buildOnDamageTaken": {
            "type": "integer",
            "description": "Amount gained when taking damage",
            "minimum": 1
        },
        "buildOnHeal": {
            "type": "integer",
            "description": "Amount gained when healing any target",
            "minimum": 1
        },
        "buildOnKill": {
            "type": "integer",
            "description": "Amount gained on killing blow",
            "minimum": 1
        },
        "buildOnCritical": {
            "type": "integer",
            "description": "Amount gained on critical hit",
            "minimum": 1
        },
        "isUniversal": {
            "type": "boolean",
            "description": "If true, all classes have this resource",
            "default": false
        },
        "startsAtZero": {
            "type": "boolean",
            "description": "If true, resource starts at 0 instead of maximum",
            "default": false
        },
        "depletionEffect": {
            "$ref": "#/definitions/DepletionEffect",
            "description": "Optional effects when resource reaches zero"
        },
        "iconId": {
            "type": "string",
            "description": "Optional reference to icon asset for UI display",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "sortOrder": {
            "type": "integer",
            "description": "Order for display sorting (lower values first)",
            "minimum": 0
        }
    },
    "required": ["id", "displayName", "abbreviation", "description", "color", "defaultMax", "sortOrder"],
    "additionalProperties": false
}
```

---

## 5. Display Configuration

### 5.1 Display Name and Abbreviation

The resource display configuration provides both full names and compact abbreviations for different UI contexts.

**Display Name:**
```json
"displayName": {
    "type": "string",
    "description": "Display name for the resource shown in UI",
    "minLength": 1,
    "maxLength": 50
}
```

**Abbreviation:**
```json
"abbreviation": {
    "type": "string",
    "description": "Short abbreviation for compact UI display (1-4 characters)",
    "minLength": 1,
    "maxLength": 4
}
```

**Current Resources:**

| Resource | Display Name | Abbreviation | Usage |
|----------|--------------|--------------|-------|
| health | Vitality | HP | Full bar: "Vitality: 55/100", Compact: "HP: 55" |
| mana | Arcane Power | MP | Full bar: "Arcane Power: 80/100", Compact: "MP: 80" |
| rage | Fury | RG | Full bar: "Fury: 35/100", Compact: "RG: 35" |
| energy | Stamina | EN | Full bar: "Stamina: 100/100", Compact: "EN: 100" |
| faith | Divine Favor | FTH | Full bar: "Divine Favor: 75/100", Compact: "FTH: 75" |
| focus | Concentration | FOC | Full bar: "Concentration: 88/100", Compact: "FOC: 88" |

### 5.2 Color Configuration

The `color` field defines the hex color for UI resource bars.

```json
"color": {
    "type": "string",
    "description": "Hex color code for UI resource bar",
    "pattern": "^#[0-9A-Fa-f]{6}$"
}
```

**Color Pattern:** Must be a valid 6-digit hex color code prefixed with `#`.

**Current Resource Colors:**

| Resource | Color Hex | Color Name | Visual |
|----------|-----------|------------|--------|
| health | `#FF0000` | Red | ████ |
| mana | `#0066FF` | Blue | ████ |
| rage | `#FF6600` | Orange | ████ |
| energy | `#FFCC00` | Yellow | ████ |
| faith | `#FFDD88` | Gold | ████ |
| focus | `#00CCAA` | Teal | ████ |

### 5.3 Icon Configuration

The optional `iconId` field references an icon asset for UI display.

```json
"iconId": {
    "type": "string",
    "description": "Optional reference to icon asset for UI display",
    "pattern": "^[a-z][a-z0-9-]*$"
}
```

**Example Usage:**
- `"iconId": "icon-health-heart"` - Heart icon for health
- `"iconId": "icon-mana-crystal"` - Crystal icon for mana
- `"iconId": "icon-rage-flame"` - Flame icon for rage

---

## 6. Resource Mechanics Configuration

### 6.1 Default Maximum Value

The `defaultMax` field defines the base maximum value for the resource.

```json
"defaultMax": {
    "type": "integer",
    "description": "Default maximum value for this resource",
    "minimum": 1
}
```

**Current Values:**

| Resource | Default Max | Notes |
|----------|-------------|-------|
| health | 100 | Base health for all characters |
| mana | 100 | Base mana for caster classes |
| rage | 100 | Maximum fury for warrior classes |
| energy | 100 | Maximum stamina for agile classes |
| faith | 100 | Maximum divine favor for priests |
| focus | 100 | Maximum concentration for tinkers |

### 6.2 MaxCalculation Definition

The optional `MaxCalculation` object provides a formula for calculating the maximum value based on character level and attributes.

```json
"MaxCalculation": {
    "type": "object",
    "description": "Formula for calculating resource maximum based on level and attributes",
    "properties": {
        "baseValue": {
            "type": "integer",
            "description": "Base maximum value before modifiers",
            "minimum": 1
        },
        "perLevelBonus": {
            "type": "integer",
            "description": "Additional maximum per character level",
            "minimum": 0
        },
        "attributeScaling": {
            "$ref": "#/definitions/AttributeScaling",
            "description": "Attribute-based scaling for maximum"
        },
        "classOverrides": {
            "type": "object",
            "description": "Class-specific base value overrides (classId: baseValue)",
            "additionalProperties": {
                "type": "integer",
                "minimum": 1
            }
        }
    },
    "required": ["baseValue"],
    "additionalProperties": false
}
```

**Calculation Formula:**
```
Max = (classOverrides[classId] || baseValue) + (level × perLevelBonus) + (attribute × multiplier)
```

**Example Configuration:**
```json
"maxCalculation": {
    "baseValue": 50,
    "perLevelBonus": 5,
    "attributeScaling": {
        "attribute": "will",
        "multiplier": 3.0
    },
    "classOverrides": {
        "galdr-caster": 80
    }
}
```

### 6.3 AttributeScaling Definition

The `AttributeScaling` object defines how an attribute affects the resource maximum.

```json
"AttributeScaling": {
    "type": "object",
    "description": "Attribute-based scaling configuration",
    "properties": {
        "attribute": {
            "type": "string",
            "description": "The attribute that scales this resource",
            "enum": ["might", "fortitude", "will", "wits", "finesse"]
        },
        "multiplier": {
            "type": "number",
            "description": "Multiplier applied to the attribute value",
            "minimum": 0
        }
    },
    "required": ["attribute", "multiplier"],
    "additionalProperties": false
}
```

**Attribute Associations:**

| Attribute | Primary Resources | Typical Multiplier |
|-----------|-------------------|-------------------|
| might | Health, Rage | 2.0-3.0 |
| fortitude | Health, Stamina | 2.5-4.0 |
| will | Mana, Faith | 2.5-4.0 |
| wits | Focus, Energy | 1.5-2.5 |
| finesse | Energy, Combo | 1.0-2.0 |

---

## 7. Regeneration and Decay Configuration

### 7.1 Regeneration Per Turn

The `regenPerTurn` field defines how much resource is restored each turn.

```json
"regenPerTurn": {
    "type": "integer",
    "description": "Amount regenerated each turn",
    "minimum": 0,
    "default": 0
}
```

**Current Values:**

| Resource | Regen/Turn | Rate Description |
|----------|------------|------------------|
| health | 0 | No natural regen (healing required) |
| mana | 10 | 10% per turn |
| rage | 0 | No regen (builds from combat) |
| energy | 20 | 20% per turn (fast recovery) |
| faith | 5 | 5% per turn (slow steady) |
| focus | 8 | 8% per turn (moderate) |

### 7.2 Decay Per Turn

The `decayPerTurn` field defines how much resource is lost each turn.

```json
"decayPerTurn": {
    "type": "integer",
    "description": "Amount lost each turn (decay)",
    "minimum": 0,
    "default": 0
}
```

**Current Values:**

| Resource | Decay/Turn | Rate Description |
|----------|------------|------------------|
| health | 0 | No decay |
| mana | 0 | No decay |
| rage | 10 | 10% per turn (out of combat) |
| energy | 0 | No decay |
| faith | 0 | No decay |
| focus | 0 | No decay |

### 7.3 Combat Context Flags

Two boolean flags control whether regeneration and decay occur based on combat state.

**Regeneration Out of Combat Only:**
```json
"regenOutOfCombatOnly": {
    "type": "boolean",
    "description": "If true, regeneration only occurs outside of combat",
    "default": false
}
```

**Decay Only Out of Combat:**
```json
"decayOnlyOutOfCombat": {
    "type": "boolean",
    "description": "If true, decay only occurs outside of combat",
    "default": false
}
```

**Combat Context Matrix:**

| Flag Combination | In Combat | Out of Combat |
|------------------|-----------|---------------|
| regen: any, decay: any | Regen + Decay | Regen + Decay |
| regenOutOfCombatOnly: true | No Regen | Regen |
| decayOnlyOutOfCombat: true | No Decay | Decay |
| Both flags true | Neither | Both |

**Current Resource Combat Behavior:**

| Resource | Regen In Combat | Regen Out of Combat | Decay In Combat | Decay Out of Combat |
|----------|-----------------|---------------------|-----------------|---------------------|
| health | No | No | No | No |
| mana | Yes (10) | Yes (10) | No | No |
| rage | No | No | No | Yes (10) |
| energy | Yes (20) | Yes (20) | No | No |
| faith | Yes (5) | Yes (5) | No | No |
| focus | Yes (8) | Yes (8) | No | No |

---

## 8. Build-On Trigger Configuration

### 8.1 Build-On Damage Dealt

Gain resource when dealing damage to enemies.

```json
"buildOnDamageDealt": {
    "type": "integer",
    "description": "Amount gained when dealing damage",
    "minimum": 1
}
```

**Current Usage:** Rage (+10 per damage instance)

### 8.2 Build-On Damage Taken

Gain resource when taking damage from any source.

```json
"buildOnDamageTaken": {
    "type": "integer",
    "description": "Amount gained when taking damage",
    "minimum": 1
}
```

**Current Usage:** Rage (+15 per damage instance)

### 8.3 Build-On Heal

Gain resource when healing any target (self or ally).

```json
"buildOnHeal": {
    "type": "integer",
    "description": "Amount gained when healing any target",
    "minimum": 1
}
```

**Current Usage:** Faith (+15 per heal)

### 8.4 Build-On Kill

Gain resource when delivering a killing blow.

```json
"buildOnKill": {
    "type": "integer",
    "description": "Amount gained on killing blow",
    "minimum": 1
}
```

**Current Usage:** Not currently used (available for custom resources)

### 8.5 Build-On Critical

Gain resource when landing a critical hit.

```json
"buildOnCritical": {
    "type": "integer",
    "description": "Amount gained on critical hit",
    "minimum": 1
}
```

**Current Usage:** Not currently used (available for custom resources)

**Build-On Trigger Summary:**

| Resource | Damage Dealt | Damage Taken | Heal | Kill | Critical |
|----------|--------------|--------------|------|------|----------|
| health | - | - | - | - | - |
| mana | - | - | - | - | - |
| rage | +10 | +15 | - | - | - |
| energy | - | - | - | - | - |
| faith | - | - | +15 | - | - |
| focus | - | - | - | - | - |

---

## 9. Resource Flags Configuration

### 9.1 Universal Resource Flag

The `isUniversal` flag indicates whether all classes have this resource.

```json
"isUniversal": {
    "type": "boolean",
    "description": "If true, all classes have this resource",
    "default": false
}
```

**Universal vs Class-Specific:**

| isUniversal | Behavior |
|-------------|----------|
| `true` | All characters have this resource regardless of class |
| `false` | Only specific classes have this resource |

**Current Values:**

| Resource | isUniversal | Classes |
|----------|-------------|---------|
| health | `true` | All classes |
| mana | `false` | Galdr-Caster |
| rage | `false` | Shieldmaiden |
| energy | `false` | Shadow-Walker |
| faith | `false` | Blood-Priest |
| focus | `false` | Scrap-Tinker |

### 9.2 Starts At Zero Flag

The `startsAtZero` flag controls the initial value when a resource is first assigned.

```json
"startsAtZero": {
    "type": "boolean",
    "description": "If true, resource starts at 0 instead of maximum",
    "default": false
}
```

**Starting Value Behavior:**

| startsAtZero | Initial Value |
|--------------|---------------|
| `false` | Starts at maximum (e.g., 100/100) |
| `true` | Starts at zero (e.g., 0/100) |

**Current Values:**

| Resource | startsAtZero | Initial State | Rationale |
|----------|--------------|---------------|-----------|
| health | `false` | 100/100 | Start healthy |
| mana | `false` | 100/100 | Start with full power |
| rage | `true` | 0/100 | Build through combat |
| energy | `false` | 100/100 | Start fully rested |
| faith | `false` | 100/100 | Start with divine blessing |
| focus | `false` | 100/100 | Start concentrated |

---

## 10. Depletion Effect Configuration

### 10.1 DepletionEffect Definition

The optional `DepletionEffect` object defines what happens when a resource reaches zero.

```json
"DepletionEffect": {
    "type": "object",
    "description": "Effects applied when resource reaches zero",
    "properties": {
        "statusEffectId": {
            "type": "string",
            "description": "Status effect to apply when depleted (references status-effects.json)",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "preventActions": {
            "type": "boolean",
            "description": "If true, character cannot take actions while resource is at zero",
            "default": false
        },
        "message": {
            "type": "string",
            "description": "Message displayed when resource is depleted"
        }
    },
    "additionalProperties": false
}
```

### 10.2 Depletion Behaviors

**No Depletion Effect (Default):**
Most resources have no special effect at zero - the character simply cannot use abilities that require that resource.

**Status Effect Application:**
Apply a status effect when depleted. Useful for fatigue, exhaustion, or debuff mechanics.

```json
"depletionEffect": {
    "statusEffectId": "exhausted",
    "message": "You are completely exhausted."
}
```

**Action Prevention:**
Prevent the character from taking any actions. Used for critical resources like health.

```json
"depletionEffect": {
    "statusEffectId": "defeated",
    "preventActions": true,
    "message": "You have been defeated!"
}
```

**Message Only:**
Display a warning without mechanical effects.

```json
"depletionEffect": {
    "message": "Your concentration has broken."
}
```

**Current Depletion Effects:**

| Resource | Status Effect | Prevent Actions | Message |
|----------|---------------|-----------------|---------|
| health | (optional: defeated) | (optional: true) | "You have been defeated!" |
| mana | - | - | - |
| rage | - | - | - |
| energy | - | - | - |
| faith | - | - | - |
| focus | - | - | - |

---

## 11. Validation Rules

### 11.1 ID Pattern Validation

| Property | Pattern | Description |
|----------|---------|-------------|
| `ResourceDefinition.id` | `^[a-z][a-z0-9-]*$` | Lowercase letters, numbers, hyphens |
| `DepletionEffect.statusEffectId` | `^[a-z][a-z0-9-]*$` | Must reference valid status effect |
| `iconId` | `^[a-z][a-z0-9-]*$` | Must reference valid icon asset |

**Valid IDs:**
- `health`
- `mana`
- `rage`
- `divine-power`
- `combo-points`

**Invalid IDs:**
- `Health` (uppercase)
- `123mana` (starts with number)
- `mana_pool` (underscore not allowed)
- `my mana` (space not allowed)

### 11.2 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `abbreviation` | 1-4 chars | "abbreviation must be 1-4 characters" |
| `color` | #RRGGBB | "color must match hex pattern #RRGGBB" |
| `defaultMax` | >= 1 | "defaultMax must be >= 1" |
| `regenPerTurn` | >= 0 | "regenPerTurn must be >= 0" |
| `decayPerTurn` | >= 0 | "decayPerTurn must be >= 0" |
| `buildOn*` | >= 1 | "buildOn* triggers must be >= 1" |
| `sortOrder` | >= 0 | "sortOrder must be >= 0" |
| `maxCalculation.baseValue` | >= 1 | "baseValue must be >= 1" |
| `maxCalculation.perLevelBonus` | >= 0 | "perLevelBonus must be >= 0" |
| `attributeScaling.multiplier` | >= 0 | "multiplier must be >= 0" |

### 11.3 Required Fields

| Definition | Required Fields |
|------------|-----------------|
| `ResourceDefinition` | id, displayName, abbreviation, description, color, defaultMax, sortOrder |
| `MaxCalculation` | baseValue |
| `AttributeScaling` | attribute, multiplier |
| `DepletionEffect` | (none - all optional) |

### 11.4 Enum Validation

| Enum | Values |
|------|--------|
| `AttributeScaling.attribute` | might, fortitude, will, wits, finesse |

---

## 12. Configuration Schema

### Complete Resource Schema File

**File:** `config/schemas/resources.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Resource Configuration",
    "description": "Schema for class resource definitions including regeneration rules, maximum calculations, depletion effects, and visual representation.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "resourceTypes": {
            "type": "array",
            "description": "List of resource type definitions",
            "items": {
                "$ref": "#/definitions/ResourceDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["resourceTypes"],
    "additionalProperties": false,
    "definitions": {
        "ResourceDefinition": {
            "type": "object",
            "description": "A resource definition with regeneration, decay, build triggers, and display properties",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the resource (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "displayName": {
                    "type": "string",
                    "description": "Display name for the resource shown in UI",
                    "minLength": 1,
                    "maxLength": 50
                },
                "abbreviation": {
                    "type": "string",
                    "description": "Short abbreviation for compact UI display (1-4 characters)",
                    "minLength": 1,
                    "maxLength": 4
                },
                "description": {
                    "type": "string",
                    "description": "Flavor text describing the resource"
                },
                "color": {
                    "type": "string",
                    "description": "Hex color code for UI resource bar",
                    "pattern": "^#[0-9A-Fa-f]{6}$"
                },
                "defaultMax": {
                    "type": "integer",
                    "description": "Default maximum value for this resource",
                    "minimum": 1
                },
                "maxCalculation": {
                    "$ref": "#/definitions/MaxCalculation",
                    "description": "Optional formula for calculating maximum based on level and attributes"
                },
                "regenPerTurn": {
                    "type": "integer",
                    "description": "Amount regenerated each turn",
                    "minimum": 0,
                    "default": 0
                },
                "regenOutOfCombatOnly": {
                    "type": "boolean",
                    "description": "If true, regeneration only occurs outside of combat",
                    "default": false
                },
                "decayPerTurn": {
                    "type": "integer",
                    "description": "Amount lost each turn (decay)",
                    "minimum": 0,
                    "default": 0
                },
                "decayOnlyOutOfCombat": {
                    "type": "boolean",
                    "description": "If true, decay only occurs outside of combat",
                    "default": false
                },
                "buildOnDamageDealt": {
                    "type": "integer",
                    "description": "Amount gained when dealing damage",
                    "minimum": 1
                },
                "buildOnDamageTaken": {
                    "type": "integer",
                    "description": "Amount gained when taking damage",
                    "minimum": 1
                },
                "buildOnHeal": {
                    "type": "integer",
                    "description": "Amount gained when healing any target",
                    "minimum": 1
                },
                "buildOnKill": {
                    "type": "integer",
                    "description": "Amount gained on killing blow",
                    "minimum": 1
                },
                "buildOnCritical": {
                    "type": "integer",
                    "description": "Amount gained on critical hit",
                    "minimum": 1
                },
                "isUniversal": {
                    "type": "boolean",
                    "description": "If true, all classes have this resource",
                    "default": false
                },
                "startsAtZero": {
                    "type": "boolean",
                    "description": "If true, resource starts at 0 instead of maximum",
                    "default": false
                },
                "depletionEffect": {
                    "$ref": "#/definitions/DepletionEffect",
                    "description": "Optional effects when resource reaches zero"
                },
                "iconId": {
                    "type": "string",
                    "description": "Optional reference to icon asset for UI display",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Order for display sorting (lower values first)",
                    "minimum": 0
                }
            },
            "required": ["id", "displayName", "abbreviation", "description", "color", "defaultMax", "sortOrder"],
            "additionalProperties": false
        },
        "MaxCalculation": {
            "type": "object",
            "description": "Formula for calculating resource maximum based on level and attributes",
            "properties": {
                "baseValue": {
                    "type": "integer",
                    "description": "Base maximum value before modifiers",
                    "minimum": 1
                },
                "perLevelBonus": {
                    "type": "integer",
                    "description": "Additional maximum per character level",
                    "minimum": 0
                },
                "attributeScaling": {
                    "$ref": "#/definitions/AttributeScaling",
                    "description": "Attribute-based scaling for maximum"
                },
                "classOverrides": {
                    "type": "object",
                    "description": "Class-specific base value overrides (classId: baseValue)",
                    "additionalProperties": {
                        "type": "integer",
                        "minimum": 1
                    }
                }
            },
            "required": ["baseValue"],
            "additionalProperties": false
        },
        "AttributeScaling": {
            "type": "object",
            "description": "Attribute-based scaling configuration",
            "properties": {
                "attribute": {
                    "type": "string",
                    "description": "The attribute that scales this resource",
                    "enum": ["might", "fortitude", "will", "wits", "finesse"]
                },
                "multiplier": {
                    "type": "number",
                    "description": "Multiplier applied to the attribute value",
                    "minimum": 0
                }
            },
            "required": ["attribute", "multiplier"],
            "additionalProperties": false
        },
        "DepletionEffect": {
            "type": "object",
            "description": "Effects applied when resource reaches zero",
            "properties": {
                "statusEffectId": {
                    "type": "string",
                    "description": "Status effect to apply when depleted (references status-effects.json)",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "preventActions": {
                    "type": "boolean",
                    "description": "If true, character cannot take actions while resource is at zero",
                    "default": false
                },
                "message": {
                    "type": "string",
                    "description": "Message displayed when resource is depleted"
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 13. Configuration File Updates

### Updated resources.json

Update the existing `resources.json` to include the schema reference.

**File:** `config/resources.json`

```json
{
    "$schema": "./schemas/resources.schema.json",
    "resourceTypes": [
        {
            "id": "health",
            "displayName": "Vitality",
            "abbreviation": "HP",
            "description": "Your life force. When it reaches zero, you are defeated.",
            "color": "#FF0000",
            "defaultMax": 100,
            "regenPerTurn": 0,
            "decayPerTurn": 0,
            "isUniversal": true,
            "startsAtZero": false,
            "sortOrder": 0
        },
        {
            "id": "mana",
            "displayName": "Arcane Power",
            "abbreviation": "MP",
            "description": "Magical energy used to cast spells. Regenerates naturally over time.",
            "color": "#0066FF",
            "defaultMax": 100,
            "regenPerTurn": 10,
            "decayPerTurn": 0,
            "isUniversal": false,
            "startsAtZero": false,
            "sortOrder": 1
        },
        {
            "id": "rage",
            "displayName": "Fury",
            "abbreviation": "RG",
            "description": "Battle fury that builds from combat. Decays when not fighting.",
            "color": "#FF6600",
            "defaultMax": 100,
            "regenPerTurn": 0,
            "decayPerTurn": 10,
            "decayOnlyOutOfCombat": true,
            "buildOnDamageDealt": 10,
            "buildOnDamageTaken": 15,
            "isUniversal": false,
            "startsAtZero": true,
            "sortOrder": 2
        },
        {
            "id": "energy",
            "displayName": "Stamina",
            "abbreviation": "EN",
            "description": "Physical energy for quick actions. Regenerates rapidly.",
            "color": "#FFCC00",
            "defaultMax": 100,
            "regenPerTurn": 20,
            "decayPerTurn": 0,
            "isUniversal": false,
            "startsAtZero": false,
            "sortOrder": 3
        },
        {
            "id": "faith",
            "displayName": "Divine Favor",
            "abbreviation": "FTH",
            "description": "Spiritual power that builds through acts of devotion and healing.",
            "color": "#FFDD88",
            "defaultMax": 100,
            "regenPerTurn": 5,
            "decayPerTurn": 0,
            "buildOnHeal": 15,
            "isUniversal": false,
            "startsAtZero": false,
            "sortOrder": 4
        },
        {
            "id": "focus",
            "displayName": "Concentration",
            "abbreviation": "FOC",
            "description": "Mental focus used to power gadgets and devices. Steady regeneration.",
            "color": "#00CCAA",
            "defaultMax": 100,
            "regenPerTurn": 8,
            "decayPerTurn": 0,
            "isUniversal": false,
            "startsAtZero": false,
            "sortOrder": 5
        }
    ]
}
```

### Backward Compatibility

The existing `resources.json` structure is preserved. All new properties are optional, ensuring the current six-resource configuration remains valid:

| Property | Existing | New Schema | Backward Compatible |
|----------|----------|------------|---------------------|
| `id` | ✅ Required | ✅ Required | ✅ Yes |
| `displayName` | ✅ Required | ✅ Required | ✅ Yes |
| `abbreviation` | ✅ Required | ✅ Required | ✅ Yes |
| `description` | ✅ Required | ✅ Required | ✅ Yes |
| `color` | ✅ Required | ✅ Required | ✅ Yes |
| `defaultMax` | ✅ Required | ✅ Required | ✅ Yes |
| `regenPerTurn` | ✅ Present | Optional | ✅ Yes (default: 0) |
| `decayPerTurn` | ✅ Present | Optional | ✅ Yes (default: 0) |
| `decayOnlyOutOfCombat` | ✅ Present | Optional | ✅ Yes (default: false) |
| `buildOnDamageDealt` | ✅ Present | Optional | ✅ Yes |
| `buildOnDamageTaken` | ✅ Present | Optional | ✅ Yes |
| `buildOnHeal` | ✅ Present | Optional | ✅ Yes |
| `isUniversal` | ✅ Present | Optional | ✅ Yes (default: false) |
| `startsAtZero` | ✅ Present | Optional | ✅ Yes (default: false) |
| `sortOrder` | ✅ Required | ✅ Required | ✅ Yes |
| `maxCalculation` | ❌ New | Optional | ✅ Yes |
| `regenOutOfCombatOnly` | ❌ New | Optional | ✅ Yes (default: false) |
| `buildOnKill` | ❌ New | Optional | ✅ Yes |
| `buildOnCritical` | ❌ New | Optional | ✅ Yes |
| `depletionEffect` | ❌ New | Optional | ✅ Yes |
| `iconId` | ❌ New | Optional | ✅ Yes |

---

## 14. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file and updates the configuration file reference. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file added, one config file updated with $schema reference |

### Schema as Documentation

The schema serves as:
- **Validation contract** for resource configuration
- **IDE documentation** via description fields
- **Modding reference** for custom resource creation
- **Design specification** for resource mechanics

---

## 15. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 16. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Abbreviation Validation | ~1 |
| Color Hex Validation | ~1 |
| Configuration File Validation | ~1 |
| Attribute Enum Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### ResourceSchemaTests.cs

```csharp
[TestFixture]
public class ResourceSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the resources.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void ResourcesJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies abbreviation must be 1-4 characters.
    /// </summary>
    [Test]
    public void Abbreviation_TooLong_FailsValidation();

    /// <summary>
    /// Verifies color must be valid hex format (#RRGGBB).
    /// </summary>
    [Test]
    public void Color_InvalidHexFormat_FailsValidation();

    /// <summary>
    /// Verifies attribute scaling enum validation (might, fortitude, will, wits, finesse).
    /// </summary>
    [Test]
    public void AttributeScaling_InvalidAttribute_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 17. Use Cases

### UC-001: Load Resource Configuration

**Actor:** Game System
**Flow:** System starts → Loads `resources.json` → Schema validates content → Resources available for character system

### UC-002: Edit Resources in IDE

**Actor:** Developer/Modder
**Flow:** Opens `resources.json` in VS Code → IDE loads schema → Autocomplete suggests properties → Validation errors shown inline

### UC-003: Add New Resource Type

**Actor:** Modder
**Flow:** Adds new resource object to `resourceTypes` array → Sets id, displayName, abbreviation, description, color, defaultMax, sortOrder → Optionally configures regen/decay/build triggers → IDE validates structure

### UC-004: Configure Combo Point Resource

**Actor:** Modder
**Flow:** Creates "combo-points" resource → Sets startsAtZero: true → Adds buildOnDamageDealt: 1 and buildOnCritical: 2 → Sets maxCalculation with finesse scaling → IDE validates structure

### UC-005: Configure Resource with Depletion Effect

**Actor:** Modder
**Flow:** Creates "stamina" resource → Adds depletionEffect with statusEffectId: "exhausted" → Sets message for depletion → IDE validates structure

---

## 18. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/resources.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all 4 definitions (ResourceDefinition, MaxCalculation, AttributeScaling, DepletionEffect)

### Validation Rules
- [ ] Resource ID pattern validation: `^[a-z][a-z0-9-]*$`
- [ ] Abbreviation length validation (1-4 characters)
- [ ] Color hex validation (`^#[0-9A-Fa-f]{6}$`)
- [ ] Default max validation (>= 1)
- [ ] Regen/decay validation (>= 0)
- [ ] Build-on trigger validation (>= 1, optional)
- [ ] Attribute enum validation (5 values)
- [ ] Required fields enforced for all definitions

### Configuration Files
- [ ] `resources.json` updated with $schema reference
- [ ] All 6 existing resources validate against schema

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 19. Acceptance Criteria

### Functional
- [ ] `resources.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `resources.json` without errors
- [ ] ID pattern validated (lowercase kebab-case)
- [ ] Abbreviation validated (1-4 characters)
- [ ] Color validated as hex color string (#RRGGBB)
- [ ] Default max validated as positive integer (>= 1)
- [ ] Regen/decay validated as non-negative integers
- [ ] Build-on triggers validated as optional positive integers
- [ ] Universal and starts-at-zero flags validated as booleans
- [ ] Depletion effect validated with optional status reference
- [ ] MaxCalculation validated with attribute enum
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 20. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| None | N/A | Resource schema is independent |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `resources.schema.json` | Validates resource configuration |
| Resource IDs | Referenced by abilities.json (resource costs) |
| Resource IDs | Referenced by classes.json (primary resource) |
| Status effect pattern | Depletion effects reference status-effects.json |

### Implementation Order Note

**v0.14.5b can be implemented in parallel with v0.14.5a** as they have no internal dependencies. The resource schema may be referenced by future ability and class configurations.

---

## 21. Future Considerations

### Deferred to Future Versions

- **Cross-reference validation**: Validating statusEffectId exists in status-effects.json
- **Class resource assignment**: Linking resources to classes in classes.json
- **Ability resource costs**: Resources referenced in abilities.json
- **Resource calculation runtime**: Application-level max calculation logic

### Out of Scope

- **Currency schema** (v0.14.5a) - Gold, silver, copper
- **Recipe schema** (v0.14.5c) - Crafting material costs
- **Vendor schema** (v0.14.5d) - Shop pricing
- **Runtime resource operations**: Application-level resource management (domain logic)
- **Resource balance tuning**: Specific regen/decay values (design decisions)

### Potential Future Enhancements

If the resource system expands, consider adding to the schema:

**Resource Categories:**
```json
"category": {
    "type": "string",
    "description": "Category grouping for related resources",
    "enum": ["Primary", "Secondary", "Special", "Hidden"]
}
```

**Percentage-Based Regeneration:**
```json
"regenPercentPerTurn": {
    "type": "number",
    "description": "Percentage of maximum regenerated each turn (0.0 to 1.0)",
    "minimum": 0,
    "maximum": 1
}
```

**Resource Interactions:**
```json
"conversionTo": {
    "type": "object",
    "description": "Convert this resource to another",
    "properties": {
        "targetResourceId": { "type": "string" },
        "conversionRate": { "type": "number" }
    }
}
```

**Overflow Behavior:**
```json
"overflowBehavior": {
    "type": "string",
    "description": "What happens when resource exceeds maximum",
    "enum": ["Cap", "Overflow", "Damage", "Convert"]
}
```

**Visibility Rules:**
```json
"visibleTo": {
    "type": "string",
    "description": "Who can see this resource",
    "enum": ["Self", "Party", "All", "None"]
}
```

**Localization Keys:**
```json
"localizationKey": {
    "type": "string",
    "description": "Key for localized resource names",
    "pattern": "^[A-Z][A-Z0-9_]*$"
}
```

**Resource Bar Styles:**
```json
"barStyle": {
    "type": "string",
    "description": "Visual style for the resource bar",
    "enum": ["Standard", "Segmented", "Circular", "Hidden"]
}
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
