# Changelog: v0.3.14 - The Experience (Theme & Transitions)

**Versions:** v0.3.14a through v0.3.14b
**Release Dates:** 2025-12-24 (both parts)

## Table of Contents

- [Overview](#overview)
- [Key Metrics](#key-metrics)
- [Part A: The Palette (Theme Standardization)](#part-a-the-palette-theme-standardization)
  - [Summary](#summary)
  - [New Semantic Keys](#new-semantic-keys)
  - [Files Modified](#files-modified)
  - [Themed Overload Pattern](#themed-overload-pattern)
  - [Colorblind Accessibility Matrix](#colorblind-accessibility-matrix)
  - [Test Coverage](#test-coverage)
- [Part B: The Flow (Screen Transitions)](#part-b-the-flow-screen-transitions)
  - [Summary](#summary-1)
  - [New Files Created](#new-files-created)
  - [Files Modified](#files-modified-1)
  - [TransitionType Reference](#transitiontype-reference)
  - [Animation Frame Specifications](#animation-frame-specifications)
  - [Phase Transition State Machine](#phase-transition-state-machine)
  - [Test Coverage](#test-coverage-1)
- [Breaking Changes](#breaking-changes)
- [Migration Notes](#migration-notes)
- [Related Specifications](#related-specifications)
- [Documentation Additions](#documentation-additions)

---

## Overview

The **v0.3.14 Experience Update** is a two-phase implementation focusing on **visual consistency and flow** through theme standardization and screen transitions.

**Architecture Established:**
- **Semantic Color Keys** - 12 new keys (4 biome + 8 UI structural) for 100% theme coverage
- **Themed Overload Pattern** - Backward-compatible method variants with `IThemeService` parameter
- **Screen Transition Animations** - ASCII-based visual effects for phase changes
- **Accessibility Compliance** - ReduceMotion guard skips all animations instantly

**Layers Touched:**
- **Core Layer:** `TransitionType` enum, `IScreenTransitionService` interface
- **Terminal Layer:** `ThemeService` expansion, `ScreenTransitionService` implementation, themed renderer overloads
- **Engine Layer:** `GameService` phase transition integration, `RoomViewHelper` themed methods
- **Test Layer:** 23 new tests (10 ThemeService + 13 ScreenTransitionService)

---

## Key Metrics

| Metric | Value |
|--------|-------|
| New Semantic Color Keys | 12 |
| New Files Created | 4 |
| Files Modified | 10 |
| Total New Tests | 23 |
| Test Pass Rate | 100% |
| ThemeService Tests | 32/32 |
| Terminal Tests | 411/411 |
| Transition Effects | 3 |
| Regressions | 0 |

---

## Part A: The Palette (Theme Standardization)

**Release Date:** 2025-12-24
**Theme:** Visual consistency through semantic color roles

### Summary

Version 0.3.14a introduces **Theme Standardization** across all Terminal renderers, eliminating hardcoded ANSI/Spectre colors and replacing them with semantic lookups via `IThemeService`. This ensures High Contrast and Colorblind accessibility themes apply to 100% of the UI.

**Patterns Introduced:**
- **Themed Overload Pattern:** Every render method gains an `IThemeService` parameter variant while preserving legacy methods for backward compatibility
- **Semantic Key Resolution Pattern:** Color roles resolve through cascading fallback: Current Theme → Standard Theme → Grey
- **Colorblind-Safe Palette Pattern:** Red-green palettes use blue/orange/cyan; blue-yellow palette uses magenta/cyan

**Key Metrics:**
- 12 new semantic keys added (60 new dictionary entries across 5 themes)
- 8 files modified
- 10 new unit tests
- 0 regressions (382 Terminal tests passing)

### New Semantic Keys

#### Biome Colors (4 keys)

Used by `RoomRenderer` and `RoomViewHelper` for room header coloring based on biome type.

| Key | Standard | HighContrast | Protanopia | Deuteranopia | Tritanopia |
|-----|----------|--------------|------------|--------------|------------|
| `BiomeRuin` | grey | white | grey | grey | grey |
| `BiomeIndustrial` | orange1 | bold yellow | orange1 | orange1 | orange1 |
| `BiomeOrganic` | green | bold green | cyan | cyan | green |
| `BiomeVoid` | purple | bold purple | blue | blue | magenta1 |

#### UI Structural Colors (8 keys)

Used by all renderers for consistent UI element styling.

| Key | Standard | HighContrast | Purpose |
|-----|----------|--------------|---------|
| `DimColor` | grey | grey | Secondary/muted text, empty states |
| `SeparatorColor` | grey | white | Rule lines between sections |
| `LabelColor` | grey | white | Form labels, descriptive text |
| `InputColor` | cyan | bold cyan | User input, interactive elements |
| `BorderActive` | yellow | bold yellow | Focused panel borders |
| `BorderInactive` | grey | grey | Unfocused panel borders |
| `NarrativeColor` | grey | white | Story/prologue text, descriptions |
| `TabActive` | gold1 | bold gold1 | Active tab highlight |

### Files Modified

#### Terminal Layer (7 files)

| File | Changes |
|------|---------|
| `ThemeService.cs` | Added 12 new semantic keys to all 5 palettes (60 new entries) |
| `RoomRenderer.cs` | Added themed overloads for `Render()`, `BuildDescription()`, `BuildEntitySection()`, `BuildExitsSection()` |
| `InventoryViewHelper.cs` | Verified complete themed support |
| `CraftingViewHelper.cs` | Added themed overloads for trade/availability colors |
| `JournalViewHelper.cs` | Added themed overloads for tab/category colors |
| `InventoryScreenRenderer.cs` | Integrated `IThemeService` injection |
| `VictoryScreenRenderer.cs` | Integrated `IThemeService` injection; themed `GetQualityColor()` |

#### Engine Layer (1 file)

| File | Changes |
|------|---------|
| `RoomViewHelper.cs` | Added themed overloads for `GetBiomeColor()`, `FormatObjectName()`, `FormatEnemyName()` |

### Themed Overload Pattern

All render helpers now follow a consistent dual-method pattern:

```csharp
// LEGACY METHOD (backward compatible)
public static string GetSomeColor(SomeEnum value)
{
    return value switch
    {
        SomeEnum.A => "red",
        SomeEnum.B => "green",
        _ => "grey"
    };
}

// THEMED METHOD (v0.3.14a)
public static string GetSomeColor(SomeEnum value, IThemeService theme)
{
    var colorKey = value switch
    {
        SomeEnum.A => "SemanticKeyA",
        SomeEnum.B => "SemanticKeyB",
        _ => "DefaultKey"
    };
    return theme.GetColor(colorKey);
}
```

### Colorblind Accessibility Matrix

| Theme | Avoid | Replacement Strategy |
|-------|-------|---------------------|
| Protanopia | Red/Green | Blue/Orange/Cyan spectrum |
| Deuteranopia | Green/Red | Blue/Orange/Cyan spectrum |
| Tritanopia | Blue/Yellow | Magenta/Cyan/Green spectrum |
| HighContrast | N/A | Bold prefixes for emphasis |

### Test Coverage

- **New Tests:** 10 (biome keys, UI structural keys, theme validation)
- **Total ThemeServiceTests:** 32/32 passing
- **Terminal Tests:** 382/382 passing

---

## Part B: The Flow (Screen Transitions)

**Release Date:** 2025-12-24
**Theme:** Visual feedback through animated phase transitions

### Summary

Version 0.3.14b implements **Screen Transition Animations** for game phase changes, adding visual "juice" to the Terminal UI. The `ScreenTransitionService` uses `Spectre.Console.Live` to render frame-based ASCII effects during Exploration ↔ Combat transitions, while fully respecting `GameSettings.ReduceMotion` for accessibility compliance.

**Patterns Introduced:**
- **Accessibility Guard Pattern:** All animations check `GameSettings.ReduceMotion` first and exit immediately if enabled
- **Phase Transition Detection Pattern:** Game loop tracks `_previousPhase` and triggers transitions on state change
- **Semantic Color Animation Pattern:** Transition effects use themed colors from `IThemeService`

**Key Metrics:**
- 3 new files created (enum, interface, service)
- 2 files modified (GameService, Program.cs)
- 1 test file created with 13 tests
- 3 distinct animation effects
- 500-700ms animation duration (skipped instantly with ReduceMotion)

### New Files Created

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/TransitionType.cs` | Enum defining screen transition animation types |
| `RuneAndRust.Core/Interfaces/IScreenTransitionService.cs` | Service interface for playing transition animations |
| `RuneAndRust.Terminal/Services/ScreenTransitionService.cs` | ASCII animation service using Spectre.Console.Live |
| `RuneAndRust.Tests/Terminal/ScreenTransitionServiceTests.cs` | Unit tests (13 tests) |

### Files Modified

| File | Change |
|------|--------|
| `GameService.cs` | Added `IScreenTransitionService` injection, phase transition detection, `HandlePhaseTransitionAsync()` |
| `Program.cs` | Registered `IScreenTransitionService` as singleton |

### TransitionType Reference

| Value | Int | Trigger | Effect | Theme Color |
|-------|-----|---------|--------|-------------|
| `None` | 0 | Default/Other | Instant screen clear | N/A |
| `Shatter` | 1 | Exploration → Combat | Red noise fills screen | `EnemyColor` |
| `Dissolve` | 2 | Combat → Exploration | Green dots fade out | `SuccessColor` |
| `GlitchDecay` | 3 | Combat → Quit | Text decays to garbage | `StressHigh` |

### Animation Frame Specifications

#### Shatter Effect (Combat Start)
- **Duration:** 500ms (10 frames × 50ms)
- **Density:** 10% → 100% over frames
- **Characters:** `/ \ # X % & █ ▓ ▒`
- **Color:** `EnemyColor` semantic key

#### Dissolve Effect (Combat Victory)
- **Duration:** 500ms (10 frames × 50ms)
- **Density:** 100% → 10% over frames
- **Characters:** `·` (dot)
- **Color:** `SuccessColor` semantic key

#### GlitchDecay Effect (Game Over)
- **Duration:** 700ms (10 frames × 70ms)
- **Frames 1-7:** Glitch characters at 60% density
- **Frames 8-10:** Fade to black
- **Characters:** `░ ▒ ▓ █ ▀ ▄ ▌ ▐`
- **Color:** `StressHigh` semantic key

### Phase Transition State Machine

```
                    +-------------+
                    |  MainMenu   |
                    +------+------+
                           |
                           | (No transition)
                           v
                    +-------------+
              +---->| Exploration |<----+
              |     +------+------+     |
              |            |            |
              |            | SHATTER    | DISSOLVE
              |            | (red noise)| (green fade)
              |            v            |
              |     +-------------+     |
              +-----+   Combat    +-----+
                    +------+------+
                           |
                           | GLITCH_DECAY
                           | (on quit after death)
                           v
                    +-------------+
                    |    Quit     |
                    +-------------+
```

### Test Coverage

- **ReduceMotion Tests:** 3 (skip animation for all types)
- **TransitionType Handling Tests:** 5 (Theory + instant completion)
- **Theme Integration Tests:** 4 (Constructor + color key mapping)
- **Logging Tests:** 1 (Debug log on skip)
- **Total:** 13/13 passing

---

## Breaking Changes

### None

Both v0.3.14a and v0.3.14b maintain full backward compatibility:
- Themed overloads are additive (legacy methods preserved)
- `IScreenTransitionService` injection is optional (nullable parameter)

---

## Migration Notes

### For Existing Installations

**Automatic:** No migration required. All changes are backward compatible.

### For Developers

**Gradual Migration to Themed Methods:**
```csharp
// BEFORE (hardcoded)
var color = GetQualityColor(item.Quality);

// AFTER (themed)
var color = GetQualityColor(item.Quality, _theme);
```

**Testing Transitions:**
1. Launch application
2. Enter combat → Observe Shatter effect
3. Win combat → Observe Dissolve effect
4. Die and quit → Observe GlitchDecay effect
5. Enable ReduceMotion → Verify instant transitions

---

## Related Specifications

- **SPEC-TRANSITION-001:** Screen Transition System (created 2025-12-25)
- **SPEC-THEME-001:** Theme System (semantic color keys documented)
- **SPEC-GAME-001:** Game Orchestration (phase transition integration)
- **SPEC-UI-001:** UI Framework (rendering pipeline)

---

## Documentation Additions

**Date:** 2025-12-25

The following documentation was created or updated to support v0.3.14:

### New Documentation Created

| File | Description |
|------|-------------|
| `docs/specs/ui/SPEC-TRANSITION-001.md` | Screen Transition System specification |
| `docs/changelogs/v0.3.x/v0.3.14.md` | Consolidated changelog (this file) |

### Files Updated

| File | Changes |
|------|---------|
| `docs/specs/ui/SPEC-THEME-001.md` | Added v0.3.14a semantic color keys section |
| `docs/specs/README.md` | Added SPEC-TRANSITION-001 to UI section; updated spec count (45 → 46) |

---

## Version History

| Version | Codename | Focus |
|---------|----------|-------|
| v0.3.14a | The Palette | Theme standardization, 12 semantic keys, themed overloads |
| v0.3.14b | The Flow | Screen transitions, 3 animation effects, ReduceMotion accessibility |

---

**Release Signature:**
```
Version: v0.3.14 - The Experience (Theme & Transitions)
Date: 2025-12-24
Architect: The Chronicle-Smith (Claude Opus 4.5)
Tests: 411 Terminal + 32 ThemeService + 13 ScreenTransition (100%)
Build: Success
Coverage: All features tested
Regressions: 0
```

---

**For detailed implementation notes, see individual part changelogs in archive:**
- `archive/v0.3.14a.md`
- `archive/v0.3.14b.md`
