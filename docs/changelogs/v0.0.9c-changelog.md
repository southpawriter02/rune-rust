# v0.0.9c Changelog - Monster Tiers & Traits

**Date:** 2026-01-08

## Summary

Implements the Monster Tiers & Traits system for difficulty scaling and special abilities. Monsters can now spawn as different tiers (Common, Named, Elite, Boss) with stat multipliers, and can have traits (Regenerating, Flying, Venomous, Armored, Berserker) that provide mechanical effects. Named tier monsters get procedurally generated unique names like "Grok the Orc".

## Added

### Domain Layer - Enums (New)

- `TraitEffect` enum:
  - Values: None, Regeneration, Flying, Venomous, Armored, Berserker, Summoner, ElementalImmunity, ElementalAttack
  - Defines mechanical effect types for monster traits

### Domain Layer - Value Objects (New)

- `NameGeneratorConfig` readonly record struct:
  - Properties: Prefixes, Suffixes, TitleFormat
  - `GenerateName()` method for procedural name generation
  - Static `Default` property with 10 prefixes/suffixes
  - Handles edge cases (empty lists, null format)

### Domain Layer - Definitions (New)

- `TierDefinition` class:
  - Properties: Id, Name, NamePrefix, HealthMultiplier, AttackMultiplier, DefenseMultiplier, ExperienceMultiplier, LootMultiplier, Color, SpawnWeight, GeneratesUniqueName, SortOrder
  - Factory `Create()` method with validation
  - Static `Common` property for default tier

- `MonsterTrait` class:
  - Properties: Id, Name, Description, Effect, EffectValue, TriggerThreshold, Tags, Color, SortOrder
  - Factory `Create()` method with validation
  - `HasTag()` method for tag checking

### Application Layer - Interfaces (New)

- `ITierService` interface:
  - `GetTier()` - get tier by ID
  - `GetAllTiers()` - get all tiers
  - `SelectRandomTier()` - weighted random tier selection
  - `GetDefaultTier()` - get common tier

- `ITraitService` interface:
  - `GetTrait()` - get trait by ID
  - `GetAllTraits()` - get all traits
  - `GetTraits()` - get multiple traits by IDs
  - `SelectRandomTraits()` - tier-based trait selection

### Application Layer - Services (New)

- `TierService` class:
  - Implements `ITierService`
  - Weighted random selection using SpawnWeight
  - Internal constructor with explicit Random for testing

- `TraitService` class:
  - Implements `ITraitService`
  - Trait count by tier: Common=0, Named=1, Elite=2, Boss=3
  - Internal constructor with explicit Random for testing

### Configuration (New)

- `config/tiers.json`:
  - 4 tiers: common, named, elite, boss
  - Each with stat/XP/loot multipliers and colors

- `config/traits.json`:
  - 5 traits: regenerating, flying, venomous, armored, berserker
  - Each with effect type, value, and optional trigger threshold

## Modified

### Domain Layer - Definitions

- `MonsterDefinition` class:
  - Added `PossibleTiers` property (IReadOnlyList<string>)
  - Added `PossibleTraits` property (IReadOnlyList<string>)
  - Added `NameGenerator` property (NameGeneratorConfig?)
  - Updated `Create()` factory with new parameters

### Domain Layer - Entities

- `Monster` entity:
  - Added `TierId` property (string)
  - Added `TraitIds` property (IReadOnlyList<string>)
  - Added `DisplayName` property (string)
  - Added `IsNamed` property (bool)
  - Added `DisplayColor` property (string)
  - Added `LootMultiplier` property (float)
  - Added `SetTierInfo()` internal method
  - Added `SetTraits()` internal method
  - Added `ApplyDefenseBonus()` internal method

### Domain Layer - Services

- `MonsterService` class:
  - Added tier/trait service dependencies via Func delegates
  - Added new constructor for full tier/trait support
  - Added `SpawnMonster(definitionId, tierId)` overload
  - Added `CreateMonsterWithTier()` private method
  - Added `GenerateDisplayName()` private method
  - Applies tier stat multipliers
  - Applies Armored trait defense bonus
  - Generates unique names for Named tier

### Domain Layer - Interfaces

- `IMonsterService` interface:
  - Added `SpawnMonster(string definitionId, string? tierId)` overload

### Application Layer - Interfaces

- `IGameConfigurationProvider` interface:
  - Added `GetTiers()` method
  - Added `GetTierById()` method
  - Added `GetTraits()` method
  - Added `GetTraitById()` method

### Infrastructure Layer - Configuration

- `JsonConfigurationProvider` class:
  - Added `_tiers` and `_traits` caching fields
  - Added tier/trait loading methods
  - Added `ToTierDefinition()` and `ToMonsterTrait()` mappers
  - Added `GetDefaultTiers()` and `GetDefaultTraits()` fallbacks
  - Added JSON config classes for tiers and traits
  - Updated monster DTO for tier/trait fields

### Infrastructure Layer - DI

- `DependencyInjection` class:
  - Registered `ITierService` -> `TierService`
  - Registered `ITraitService` -> `TraitService`
  - Updated `IMonsterService` registration with tier/trait dependencies

### Configuration

- `config/monsters.json`:
  - Added `possibleTiers` to all monsters
  - Added `possibleTraits` to all monsters
  - Added `nameGenerator` with custom prefixes/suffixes per monster type

## Tests Added

| Test File | Count |
|-----------|-------|
| `TierDefinitionTests.cs` | 4 |
| `MonsterTraitTests.cs` | 5 |
| `NameGeneratorConfigTests.cs` | 5 |
| `TierServiceTests.cs` | 8 |
| `TraitServiceTests.cs` | 10 |
| **Total New** | 32 |

## Test Results

```
Domain Tests:      578 passed (+14)
Application Tests: 148 passed (+18)
Architecture Tests:  8 passed
Total:             734 passed (+32)
```

## Tier System

### Tier Definitions

| Tier | HP | ATK | DEF | XP | Loot | Color | Weight | Unique Name |
|------|-----|-----|-----|-----|------|-------|--------|-------------|
| common | 1.0x | 1.0x | 1.0x | 1.0x | 1.0x | white | 70 | No |
| named | 1.5x | 1.3x | 1.2x | 2.0x | 2.0x | yellow | 20 | Yes |
| elite | 2.0x | 1.5x | 1.5x | 3.0x | 3.0x | orange3 | 8 | No |
| boss | 5.0x | 2.0x | 2.0x | 10.0x | 5.0x | red | 2 | No |

### Display Names

- **Common**: "Goblin"
- **Named**: "Grok the Goblin" (procedurally generated)
- **Elite**: "Elite Goblin"
- **Boss**: "Boss Goblin"

## Trait System

### Trait Definitions

| Trait | Effect | Value | Threshold | Tags |
|-------|--------|-------|-----------|------|
| regenerating | Regeneration | 5 HP/turn | - | healing, passive |
| flying | Flying | +3 DEF | - | mobility, defensive |
| venomous | Venomous | 3 poison dmg | - | poison, offensive |
| armored | Armored | +3 DEF | - | defensive, passive |
| berserker | Berserker | +50% dmg | 30% HP | offensive, triggered |

### Trait Count by Tier

| Tier | Traits |
|------|--------|
| Common | 0 |
| Named | 1 |
| Elite | 2 |
| Boss | 3 |

## Files Summary

### New Files (10)
| File | Purpose |
|------|---------|
| `Domain/Enums/TraitEffect.cs` | Trait effect types enum |
| `Domain/ValueObjects/NameGeneratorConfig.cs` | Name generation config |
| `Domain/Definitions/TierDefinition.cs` | Tier definition class |
| `Domain/Definitions/MonsterTrait.cs` | Monster trait class |
| `Application/Interfaces/ITierService.cs` | Tier service interface |
| `Application/Interfaces/ITraitService.cs` | Trait service interface |
| `Application/Services/TierService.cs` | Tier service implementation |
| `Application/Services/TraitService.cs` | Trait service implementation |
| `config/tiers.json` | Tier definitions |
| `config/traits.json` | Trait definitions |

### Modified Files (7)
| File | Changes |
|------|---------|
| `Domain/Definitions/MonsterDefinition.cs` | +PossibleTiers, +PossibleTraits, +NameGenerator |
| `Domain/Entities/Monster.cs` | +tier/trait properties, +SetTierInfo, +SetTraits |
| `Domain/Services/MonsterService.cs` | +tier/trait integration, +SpawnMonster overload |
| `Domain/Interfaces/IMonsterService.cs` | +SpawnMonster(id, tierId) |
| `Application/Interfaces/IConfigurationProvider.cs` | +tier/trait methods |
| `Infrastructure/Configuration/JsonConfigurationProvider.cs` | +tier/trait loading |
| `Infrastructure/DependencyInjection.cs` | +service registrations |
| `config/monsters.json` | +tier/trait fields per monster |

### Test Files (5)
| File | Tests |
|------|-------|
| `Domain.UnitTests/Definitions/TierDefinitionTests.cs` | 4 |
| `Domain.UnitTests/Definitions/MonsterTraitTests.cs` | 5 |
| `Domain.UnitTests/ValueObjects/NameGeneratorConfigTests.cs` | 5 |
| `Application.UnitTests/Services/TierServiceTests.cs` | 8 |
| `Application.UnitTests/Services/TraitServiceTests.cs` | 10 |

## Usage Example

```csharp
// Spawn a random-tier monster
var monster = monsterService.SpawnMonster("orc", null);
// Could be: "Orc", "Grok the Orc", "Elite Orc", or "Boss Orc"

// Spawn a specific tier
var eliteOrc = monsterService.SpawnMonster("orc", "elite");
// Result: "Elite Orc" with 2x HP, 1.5x ATK/DEF, 3x XP, 2 traits

// Check monster properties
Console.WriteLine($"Name: {monster.DisplayName}");
Console.WriteLine($"Tier: {monster.TierId}");
Console.WriteLine($"Traits: {string.Join(", ", monster.TraitIds)}");
Console.WriteLine($"Color: {monster.DisplayColor}");
Console.WriteLine($"Is Named: {monster.IsNamed}");
```

## v0.0.9c Complete

This completes the Monster Tiers & Traits system:
- Data-driven tier configuration via JSON
- Data-driven trait configuration via JSON
- Weighted random tier selection
- Tier-based trait count allocation
- Stat multipliers for all tiers
- Armored trait defense bonus integration
- Procedural name generation for Named tier
- Ready for v0.0.9d: Loot Tables & Drops
