# v0.4.0c Feature Specification: Activation & Destruction

**Version:** 0.4.0c  
**Implemented:** 2026-01-12  
**Status:** Complete

---

## Table of Contents
1. [Overview](#1-overview)
2. [Effect System](#2-effect-system)
3. [Destructible Objects](#3-destructible-objects)
4. [Button System](#4-button-system)
5. [Activation Mechanics](#5-activation-mechanics)
6. [InteractiveObject Integration](#6-interactiveobject-integration)
7. [InteractionService Operations](#7-interactionservice-operations)
8. [User Stories](#8-user-stories)
9. [Use Cases](#9-use-cases)
10. [Error Conditions](#10-error-conditions)
11. [Limitations](#11-limitations)
12. [Configuration](#12-configuration)
13. [Logging](#13-logging)
14. [Testing Coverage](#14-testing-coverage)

---

## 1. Overview

### 1.1 Purpose
Enable interactive objects (levers, buttons) to trigger effects on other objects, and allow objects to be destroyed through damage.

### 1.2 Feature Summary
- **Linked Effects**: Activation triggers state changes on target objects
- **Button Reset**: Buttons auto-reset to inactive after a configurable delay
- **Destructible Objects**: Objects with HP, defense, and damage type modifiers
- **Damage Types**: Vulnerabilities (2x), resistances (0.5x), and immunities (0x)

### 1.3 Dependencies
- v0.4.0a Interactive Object Core (InteractiveObject, ObjectState, InteractionType)
- v0.4.0b Containers & Locks (Container, Lock integration)

---

## 2. Effect System

### 2.1 EffectType Enum

**Location:** `Domain/Enums/EffectType.cs`

| Value | Description | Target State Effect |
|-------|-------------|---------------------|
| `OpenTarget` | Opens target object | → Open |
| `CloseTarget` | Closes target object | → Closed |
| `UnlockTarget` | Unlocks target lock | Locked → Closed |
| `LockTarget` | Locks target object | Closed → Locked |
| `ToggleTarget` | Toggles between states | Active ↔ Inactive, Open ↔ Closed |
| `ActivateTarget` | Activates target | → Active |
| `DeactivateTarget` | Deactivates target | → Inactive |
| `DestroyTarget` | Destroys target | → Destroyed |
| `RevealTarget` | Makes hidden object visible | IsVisible = true |
| `Message` | Displays message only | None |

### 2.2 ObjectEffect Value Object

**Location:** `Domain/ValueObjects/ObjectEffect.cs`

#### Properties

| Property | Type | Description |
|----------|------|-------------|
| `Type` | `EffectType` | Effect to apply to target |
| `TargetObjectId` | `string` | Target object's DefinitionId (normalized lowercase) |
| `TriggerOnState` | `ObjectState` | State that triggers this effect |
| `DelayTurns` | `int` | Turns before effect activates (0 = immediate) |
| `EffectMessage` | `string?` | Custom message, or null for default |

#### Computed Properties

| Property | Type | Returns |
|----------|------|---------|
| `IsImmediate` | `bool` | `DelayTurns == 0` |
| `HasTarget` | `bool` | `!string.IsNullOrEmpty(TargetObjectId)` |

#### Factory Methods

| Method | Parameters | Creates |
|--------|------------|---------|
| `OpenTarget` | targetId, triggerOn, message? | Opens target on state |
| `CloseTarget` | targetId, triggerOn, message? | Closes target on state |
| `UnlockTarget` | targetId, triggerOn, message? | Unlocks target on state |
| `LockTarget` | targetId, triggerOn, message? | Locks target on state |
| `ToggleTarget` | targetId, triggerOn, message? | Toggles target on state |
| `ActivateTarget` | targetId, triggerOn, message? | Activates target on state |
| `DeactivateTarget` | targetId, triggerOn, message? | Deactivates target on state |
| `DestroyTarget` | targetId, triggerOn, message? | Destroys target on state |
| `RevealTarget` | targetId, triggerOn, message? | Reveals hidden target |
| `MessageOnly` | message, triggerOn | Message with no target |
| `Delayed` | baseEffect, delayTurns | Adds delay to effect |

### 2.3 Expected Behaviors

| Scenario | Expected Behavior | Actual Behavior |
|----------|-------------------|-----------------|
| Create OpenTarget effect | Type=OpenTarget, HasTarget=true | ✅ Matches |
| TargetId normalization | "My-Door" → "my-door" | ✅ Matches |
| MessageOnly effect | HasTarget=false, empty TargetObjectId | ✅ Matches |
| Delayed with 0 | IsImmediate=true | ✅ Matches |
| Delayed with negative | Throws ArgumentOutOfRangeException | ✅ Matches |

### 2.4 EffectTriggerResult Value Object

**Location:** `Domain/ValueObjects/EffectTriggerResult.cs`

| Property | Type | Description |
|----------|------|-------------|
| `Success` | `bool` | Whether effect was applied |
| `Effect` | `ObjectEffect` | The effect that was triggered |
| `TargetObjectId` | `string?` | Target that was affected |
| `Message` | `string?` | Message to display |
| `NewTargetState` | `ObjectState?` | State after effect |

#### Factory Methods

| Method | When Used |
|--------|-----------|
| `Succeeded(effect, message, newState)` | Effect applied successfully |
| `Failed(effect, message)` | Effect could not be applied |
| `TargetNotFound(effect)` | Target object not in room |
| `MessageDisplayed(effect)` | Message-only effect |

---

## 3. Destructible Objects

### 3.1 DestructibleProperties Value Object

**Location:** `Domain/ValueObjects/DestructibleProperties.cs`

#### Properties

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `MaxHP` | `int` | - | Maximum hit points |
| `CurrentHP` | `int` | MaxHP | Current hit points |
| `Defense` | `int` | 0 | Damage reduction |
| `Vulnerabilities` | `IReadOnlyList<string>` | [] | 2x damage types |
| `Resistances` | `IReadOnlyList<string>` | [] | 0.5x damage types |
| `Immunities` | `IReadOnlyList<string>` | [] | 0 damage types |
| `LootTableId` | `string?` | null | Loot table on destruction |

#### Computed Properties

| Property | Type | Returns |
|----------|------|---------|
| `IsDestroyed` | `bool` | `CurrentHP <= 0` |
| `HealthPercentage` | `double` | `CurrentHP / MaxHP * 100` |

#### Factory Methods

| Method | MaxHP | Defense | Use Case |
|--------|-------|---------|----------|
| `Create(maxHP, ...)` | user-defined | user-defined | Custom objects |
| `Weak(maxHP?)` | 10 | 0 | Crates, webs |
| `Sturdy(maxHP?, defense?)` | 25 | 2 | Barricades, furniture |
| `Armored(maxHP?, defense?)` | 50 | 5 | Stone barriers, metal doors |

### 3.2 Damage Calculation

**Order of Operations:**
1. Check immunity → return 0 if immune
2. Check vulnerability → damage × 2
3. Check resistance → damage ÷ 2 (if not vulnerable)
4. Apply defense → damage - defense
5. Apply minimum → max(1, damage) if original > 0 and not immune

```csharp
// Example: 5 fire damage vs. fire-vulnerable object with 3 defense
// Step 1: Not immune
// Step 2: 5 × 2 = 10 (vulnerable)
// Step 3: Skipped (not resistant)
// Step 4: 10 - 3 = 7
// Step 5: 7 ≥ 1, no change
// Final: 7 damage dealt
```

### 3.3 Expected Behaviors

| Scenario | Expected | Actual |
|----------|----------|--------|
| Normal damage | Reduces HP | ✅ Matches |
| Damage with defense | `damage - defense` dealt | ✅ Matches |
| Defense > damage | Minimum 1 dealt | ✅ Matches |
| Vulnerable to type | 2x damage | ✅ Matches |
| Resistant to type | 0.5x damage (rounded down) | ✅ Matches |
| Immune to type | 0 damage | ✅ Matches |
| HP reaches 0 | IsDestroyed = true | ✅ Matches |
| Damage when destroyed | Returns 0 | ✅ Matches |

### 3.4 Condition Descriptions

| HP % | Description |
|------|-------------|
| ≥ 90% | "pristine" |
| ≥ 75% | "slightly damaged" |
| ≥ 50% | "damaged" |
| ≥ 25% | "heavily damaged" |
| > 0% | "nearly destroyed" |
| 0% | "destroyed" |

### 3.5 ObjectDamageResult Value Object

**Location:** `Domain/ValueObjects/ObjectDamageResult.cs`

| Property | Type | Description |
|----------|------|-------------|
| `Success` | `bool` | Whether damage was dealt |
| `Message` | `string` | Feedback message |
| `DamageDealt` | `int` | Actual damage dealt |
| `WasDestroyed` | `bool` | Object destroyed this hit |
| `DroppedItems` | `IReadOnlyList<Item>` | Items dropped on destruction |
| `PassageCleared` | `bool` | Blocking object destroyed |
| `WasImmune` | `bool` | Attack was immunity-blocked |

#### Factory Methods

| Method | When Used |
|--------|-----------|
| `Hit(message, damage)` | Normal damage dealt |
| `Destroyed(name, damage, items, passageCleared)` | Object destroyed |
| `Immune(name, damageType)` | Immune to damage type |
| `NotDestructible(name)` | Object cannot be damaged |
| `AlreadyDestroyed(name)` | Object already destroyed |
| `Resisted(name, damage, damageType)` | Resistance applied |
| `Vulnerable(name, damage, damageType, ...)` | Vulnerability applied |

---

## 4. Button System

### 4.1 Button Behavior

Buttons differ from levers:
- **Activation**: Both can be activated
- **Deactivation**: Levers can be manually deactivated; buttons cannot
- **Auto-reset**: Buttons reset to Inactive after `ResetDelay` turns
- **Toggle**: Levers can toggle; active buttons cannot

### 4.2 Reset Timer

**Properties:**
- `IsButton`: Whether object behaves as button
- `ResetDelay`: Turns until reset (default 3)
- `_turnsUntilReset`: Internal countdown (-1 when not active)
- `HasPendingReset`: `_turnsUntilReset >= 0`
- `TurnsUntilReset`: Current countdown value

**ProcessTurnTick Behavior:**
1. If not a button with pending reset → return false
2. Decrement `_turnsUntilReset`
3. If timer reaches 0:
   - Set state to Inactive
   - Clear timer (`_turnsUntilReset = -1`)
   - Return true (reset occurred)
4. Otherwise return false

### 4.3 Expected Behaviors

| Scenario | Expected | Actual |
|----------|----------|--------|
| Activate button | State=Active, timer starts | ✅ Matches |
| Deactivate button manually | Returns false, stays Active | ✅ Matches |
| ProcessTurnTick on button | Decrements timer | ✅ Matches |
| Timer expires | State=Inactive, returns true | ✅ Matches |
| ProcessTurnTick on lever | Returns false | ✅ Matches |
| Toggle active button | Returns null, stays Active | ✅ Matches |

---

## 5. Activation Mechanics

### 5.1 Activate Method

**Behavior:**
1. Check not already Active → return false
2. Check not Destroyed → return false
3. Set state to Active
4. If button: start reset timer
5. Return true

### 5.2 Deactivate Method

**Behavior:**
1. Check currently Active → return false if not
2. Check not a button → return false if button (buttons auto-reset)
3. Set state to Inactive
4. Return true

### 5.3 Toggle Method

**Behavior:**
1. If Active:
   - If button: return null (cannot toggle active button)
   - Otherwise: set to Inactive, return Inactive
2. If Inactive:
   - Set to Active
   - If button: start timer
   - Return Active
3. If neither: return null

### 5.4 Activation Messages

| Object Type | Activate Message |
|-------------|------------------|
| Lever | "You pull the {name}. It locks into position with a heavy click." |
| Button | "You press the {name}. It depresses with a satisfying click." |
| Other | "You activate the {name}." |

| Object Type | Deactivate Message |
|-------------|-------------------|
| Lever | "You push the {name} back. It returns to its original position." |
| Other | "You deactivate the {name}." |

---

## 6. InteractiveObject Integration

### 6.1 New Properties (v0.4.0c)

| Property | Type | Description |
|----------|------|-------------|
| `Effects` | `IReadOnlyList<ObjectEffect>` | Linked effects |
| `HasEffects` | `bool` | `Effects.Count > 0` |
| `Destructible` | `DestructibleProperties?` | HP/damage system |
| `IsDestructible` | `bool` | `Destructible != null` |
| `IsButton` | `bool` | Auto-reset behavior |
| `ResetDelay` | `int` | Turns until reset |
| `HasPendingReset` | `bool` | Timer is running |
| `TurnsUntilReset` | `int` | Current timer value |

### 6.2 New Methods (v0.4.0c)

| Method | Returns | Description |
|--------|---------|-------------|
| `AddEffect(effect)` | void | Adds effect to list |
| `SetEffects(effects)` | void | Replaces effect list |
| `GetTriggeredEffects(state)` | `IEnumerable<ObjectEffect>` | Effects for state |
| `SetDestructible(props)` | void | Sets destructible properties |
| `TakeDamage(amount, type?)` | int | Deals damage, returns actual |
| `Destroy()` | void | Sets state to Destroyed |
| `SetAsButton(delay)` | void | Configures button behavior |
| `Activate()` | bool | Activates object |
| `Deactivate()` | bool | Deactivates object |
| `Toggle()` | `ObjectState?` | Toggles state |
| `ProcessTurnTick()` | bool | Handles button reset |

### 6.3 Updated IsDestroyed Property

Now checks multiple conditions:
```csharp
public bool IsDestroyed =>
    State == ObjectState.Destroyed ||
    State == ObjectState.Broken ||
    (Destructible?.IsDestroyed ?? false);
```

### 6.4 Updated IsCurrentlyBlocking

Now returns false when destroyed:
```csharp
public bool IsCurrentlyBlocking =>
    BlocksPassage && !IsDestroyed && /* ...other checks */;
```

### 6.5 FromDefinition Updates

When creating from definition:
1. Creates base object
2. Sets up container if applicable (v0.4.0b)
3. Sets up lock if applicable (v0.4.0b)
4. **NEW**: Sets up effects if `Effects` is not empty
5. **NEW**: Sets up destructible if `Destructible` is not null
6. **NEW**: Configures button if `IsButton = true`

---

## 7. InteractionService Operations

### 7.1 Activate (Room-aware)

**Signature:** `InteractionResult Activate(InteractiveObject obj, Room room)`

**Algorithm:**
1. Validate arguments
2. Log attempt
3. Call `ActivateInternal(obj)`
4. If successful: resolve triggered effects via `ResolveEffectsForState`
5. Combine activation message with effect messages
6. Return result

### 7.2 Deactivate (Room-aware)

**Signature:** `InteractionResult Deactivate(InteractiveObject obj, Room room)`

**Algorithm:**
1. Validate arguments
2. Log attempt
3. Check button → fail with "will reset automatically"
4. Call `DeactivateInternal(obj)`
5. If successful: resolve triggered effects
6. Return result

### 7.3 AttackObject

**Signature:** `ObjectDamageResult AttackObject(InteractiveObject obj, int damage, string? damageType, Room room)`

**Algorithm:**
1. Validate arguments
2. Check destructible → `NotDestructible` if false
3. Check already destroyed → `AlreadyDestroyed`
4. Check immunity → `Immune` if immune
5. Track blocking state before damage
6. Apply damage via `obj.TakeDamage()`
7. Log damage dealt
8. If destroyed:
   - Drop container contents
   - Check if passage cleared
   - Return with vulnerability/destruction info
9. Otherwise: return Hit/Resisted/Vulnerable result

### 7.4 ProcessRoomTurnTick

**Signature:** `IEnumerable<string> ProcessRoomTurnTick(Room room)`

**Algorithm:**
1. For each object in room:
2. Call `obj.ProcessTurnTick()`
3. If returned true (object reset):
   - Add reset message
   - Resolve effects for Inactive state
4. Return all messages

### 7.5 GetPendingEffects

**Signature:** `IEnumerable<ObjectEffect> GetPendingEffects(InteractiveObject obj, ObjectState newState)`

Delegates to `obj.GetTriggeredEffects(newState)`.

### 7.6 ResolveEffect

**Signature:** `EffectTriggerResult ResolveEffect(ObjectEffect effect, Room room)`

**Algorithm:**
1. Log effect resolution
2. If Message type: return `MessageDisplayed`
3. Find target by DefinitionId (case-insensitive)
4. If not found: return `TargetNotFound`
5. Get message (custom or default)
6. Apply effect via `ApplyEffect` switch
7. Return success/failure result

### 7.7 Effect Application

| Effect Type | Application Method |
|-------------|-------------------|
| `OpenTarget` | `target.TrySetState(Open)` |
| `CloseTarget` | `target.TrySetState(Closed)` |
| `UnlockTarget` | `target.Unlock()` |
| `LockTarget` | `target.TryLock()` |
| `ToggleTarget` | `target.Toggle()` |
| `ActivateTarget` | `target.Activate()` |
| `DeactivateTarget` | `target.Deactivate()` |
| `DestroyTarget` | `target.Destroy()` |
| `RevealTarget` | `target.SetVisibility(true)` |

---

## 8. User Stories

### 8.1 Activation Stories

| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| A1 | Player | Pull a lever | I can trigger effects |
| A2 | Player | Press a button | I can activate mechanisms |
| A3 | Player | See linked effects | I understand what happened |
| A4 | Designer | Create complex puzzles | Players solve multi-step challenges |

### 8.2 Button Stories

| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| B1 | Player | See button reset | I know timing matters |
| B2 | Designer | Configure reset delay | I can balance puzzles |
| B3 | Player | Know button can't be deactivated | I don't waste turns trying |

### 8.3 Destruction Stories

| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| D1 | Player | Break crates | I can access contents |
| D2 | Player | Clear barricades | I can pass through |
| D3 | Player | See damage feedback | I know my attack's effectiveness |
| D4 | Designer | Create vulnerable objects | Players use appropriate damage |
| D5 | Designer | Create immune objects | Players must find alternatives |

---

## 9. Use Cases

### UC1: Lever Unlocks Door

**Preconditions:**
- Lever in room with effect: `UnlockTarget("iron-gate", Active)`
- Iron gate in same room, locked

**Steps:**
1. Player: `pull lever`
2. System: Activates lever, state → Active
3. System: Gets triggered effects for Active state
4. System: Finds iron gate by DefinitionId
5. System: Calls `gate.Unlock()`
6. System: Returns "You pull the Lever... The Iron Gate unlocks with a click."

### UC2: Button Opens Then Closes Door

**Preconditions:**
- Button with `ResetDelay = 2`
- Effects: `OpenTarget("door", Active)`, `CloseTarget("door", Inactive)`
- Door in room, closed

**Steps:**
1. Player: `press button`
2. System: Door opens, timer = 2
3. Turn passes: timer = 1
4. Turn passes: timer = 0, pending
5. Turn tick: Button resets → Inactive
6. System: Door closes

### UC3: Break Wooden Crate

**Preconditions:**
- Crate with HP=10, vulnerable to "fire"
- Contains Health Potion

**Steps:**
1. Player: `attack crate with fire` (5 damage)
2. System: Vulnerability → 10 damage
3. System: HP: 10 → 0
4. System: State → Destroyed
5. System: Drops Health Potion
6. System: Returns "The Wooden Crate is destroyed! You find: Health Potion"

### UC4: Attack Immune Object

**Preconditions:**
- Stone statue with immunity to "piercing"

**Steps:**
1. Player: `attack statue` (10 piercing damage)
2. System: Checks immunity
3. System: Returns "The Stone Statue is immune to piercing damage."
4. System: No damage dealt

---

## 10. Error Conditions

### 10.1 Activation Errors

| Error | Condition | Message |
|-------|-----------|---------|
| AlreadyActive | State = Active | "The {name} is already active." |
| CannotActivate | State transition failed | "The {name} cannot be activated." |
| ButtonNoDeactivate | IsButton = true | "The {name} will reset automatically." |
| NotActive | State ≠ Active for deactivate | "The {name} is not active." |

### 10.2 Destruction Errors

| Error | Condition | Message |
|-------|-----------|---------|
| NotDestructible | Destructible = null | "The {name} cannot be damaged." |
| AlreadyDestroyed | IsDestroyed = true | "The {name} has already been destroyed." |
| Immune | Damage type in immunities | "The {name} is immune to {type} damage." |

### 10.3 Effect Errors

| Error | Condition | Result |
|-------|-----------|--------|
| TargetNotFound | No object with DefinitionId | `EffectTriggerResult.TargetNotFound` |
| EffectFailed | State transition failed | `EffectTriggerResult.Failed` |

---

## 11. Limitations

### 11.1 Current Limitations

| Limitation | Impact | Future Resolution |
|------------|--------|-------------------|
| Delayed effects not queued | DelayTurns > 0 effects skipped | v0.4.0d: Effect queue system |
| No loot table processing | LootTableId unused | Future: Loot generation |
| Items dropped but not placed | DroppedItems returned, not added to room | Future: Room floor items |
| No object respawn | Destroyed objects stay destroyed | Designer prerogative |
| Single room effects | Effects only find targets in same room | By design |

### 11.2 Known Edge Cases

| Edge Case | Current Behavior |
|-----------|------------------|
| Effect on locked object | OpenTarget fails, LockTarget succeeds |
| Destroy already destroyed | No effect, returns AlreadyDestroyed |
| Button activated while pending reset | Timer resets |
| Resistance and vulnerability conflict | Impossible (checked in order) |
| Zero MaxHP | ArgumentException thrown |

---

## 12. Configuration

### 12.1 InteractiveObjectDefinition Properties (v0.4.0c)

```json
{
  "id": "rusty-lever",
  "name": "Rusty Lever",
  "objectType": "Lever",
  "defaultState": "Inactive",
  "effects": [
    {
      "type": "UnlockTarget",
      "targetObjectId": "iron-gate",
      "triggerOnState": "Active",
      "delayTurns": 0,
      "effectMessage": "You hear a loud clunk from the gate."
    }
  ]
}
```

### 12.2 Destructible Configuration

```json
{
  "id": "wooden-crate",
  "name": "Wooden Crate",
  "objectType": "Crate",
  "destructible": {
    "maxHP": 10,
    "defense": 0,
    "vulnerabilities": ["fire", "slashing"],
    "resistances": ["piercing"],
    "immunities": ["poison"],
    "lootTableId": "crate-loot"
  }
}
```

### 12.3 Button Configuration

```json
{
  "id": "stone-button",
  "name": "Stone Button",
  "objectType": "Button",
  "isButton": true,
  "resetDelay": 3,
  "effects": [
    {
      "type": "OpenTarget",
      "targetObjectId": "secret-door",
      "triggerOnState": "Active"
    },
    {
      "type": "CloseTarget",
      "targetObjectId": "secret-door",
      "triggerOnState": "Inactive"
    }
  ]
}
```

---

## 13. Logging

### 13.1 Log Levels

| Level | Used For |
|-------|----------|
| `LogInformation` | Successful operations, damage dealt |
| `LogDebug` | Attempt starts, validation failures |

### 13.2 Log Messages

| Operation | Level | Template |
|-----------|-------|----------|
| Activate start | Debug | `"Activating {Object} in room {Room}"` |
| Activate success | Info | `"Activated {Object}, IsButton={IsButton}"` |
| Deactivate success | Info | `"Deactivated {Object}"` |
| Attack start | Debug | `"Attacking {Object} with {Damage} {DamageType} damage"` |
| Attack success | Info | `"Dealt {ActualDamage} damage to {Object}, destroyed={Destroyed}"` |
| Immunity | Debug | `"{Object} is immune to {DamageType}"` |
| Items dropped | Info | `"Dropped {Count} items from destroyed {Object}"` |
| Button reset | Debug | `"{Object} reset to inactive"` |
| Effect resolution | Debug | `"Resolving effect {EffectType} on target {Target}"` |
| Effect success | Info | `"Effect {EffectType} applied to {Target}, new state: {NewState}"` |
| Effect fail | Debug | `"Effect {EffectType} failed on {Target}"` |
| Target not found | Debug | `"Effect target not found: {Target}"` |

---

## 14. Testing Coverage

### 14.1 ObjectEffect Tests (20 tests)

| Category | Tests |
|----------|-------|
| Factory Methods | OpenTarget, CloseTarget, UnlockTarget, LockTarget, ToggleTarget |
| Factory Methods | ActivateTarget, DeactivateTarget, DestroyTarget, RevealTarget |
| MessageOnly | Creates correct effect |
| Delayed | Creates delayed effect, zero delay, negative throws |
| Properties | HasTarget true/false, ToString formats |
| Normalization | TargetId lowercase |

### 14.2 DestructibleProperties Tests (40 tests)

| Category | Tests |
|----------|-------|
| Create | Valid HP, zero throws, negative throws |
| Factories | Weak, Sturdy, Armored defaults |
| Damage Modifiers | Vulnerabilities, Resistances, Immunities stored normalized |
| TakeDamage | Normal, with defense, defense > damage, vulnerability, resistance |
| TakeDamage | Immunity, case-insensitive, when destroyed, zero/negative damage |
| IsDestroyed | When HP=0, when damage exceeds HP |
| Helpers | IsImmuneTo, IsResistantTo, IsVulnerableTo |
| Repair | Resets HP to max |
| HealthPercentage | Returns correct value |
| GetConditionDescription | All tiers from pristine to destroyed |
| ToString | Descriptive output |

### 14.3 InteractiveObject Activation Tests (20 tests)

| Category | Tests |
|----------|-------|
| Effects | AddEffect, SetEffects, GetTriggeredEffects |
| Activate | Normal, already active, when destroyed |
| Deactivate | Normal, not active |
| Toggle | Inactive→Active, Active→Inactive |
| Button Setup | SetAsButton configures correctly |
| Button Activate | Starts reset timer |
| Button Deactivate | Returns false |
| Button Toggle | Returns null when active |
| ProcessTurnTick | Decrements, resets when expired, no-op on lever |

### 14.4 InteractiveObject Destruction Tests (22 tests)

| Category | Tests |
|----------|-------|
| SetDestructible | Configures correctly, null throws |
| IsDestructible | When set, when not set |
| TakeDamage | Reduces HP, not destructible returns 0, when destroyed returns 0 |
| TakeDamage | Sets Destroyed state, vulnerability, immunity |
| IsDestroyed | State-based, HP-based |
| Destroy | Sets state, bypasses HP |
| CanInteract | False when destroyed |
| IsCurrentlyBlocking | False when destroyed |

### 14.5 Test Results

```
Domain:      1001 passed (914 baseline + 87 new)
Application:  454 passed
Architecture:   8 passed
─────────────────────────────
Total:       1463 passed, 0 failed
```

---

## Appendix: Related Files

| File | Purpose |
|------|---------|
| `Domain/Enums/EffectType.cs` | Effect type enumeration |
| `Domain/ValueObjects/ObjectEffect.cs` | Linked effect definition |
| `Domain/ValueObjects/DestructibleProperties.cs` | HP and damage system |
| `Domain/ValueObjects/EffectTriggerResult.cs` | Effect resolution result |
| `Domain/ValueObjects/ObjectDamageResult.cs` | Attack result |
| `Domain/Entities/InteractiveObject.cs` | Entity integration |
| `Domain/Definitions/InteractiveObjectDefinition.cs` | JSON configuration |
| `Application/Interfaces/IInteractionService.cs` | Service interface |
| `Application/Services/InteractionService.cs` | Service implementation |
