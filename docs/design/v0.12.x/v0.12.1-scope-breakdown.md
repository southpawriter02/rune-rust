# v0.12.1 Achievements & Leaderboards - Scope Breakdown

**Version:** 0.12.1
**Theme:** Achievements & Leaderboards
**Prerequisites:** v0.12.0c Complete (Statistics System - Statistics View)
**Total Estimated Tests:** ~35 new tests

---

## Executive Summary

The Achievements & Leaderboards sub-version implements the achievement system with data-driven definitions, unlock conditions based on statistics, pop-up notifications, and a local leaderboard system for high scores.

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.12.1a | Achievement Definitions | AchievementDefinition, conditions, tiers, config | ~12 |
| v0.12.1b | Achievement Service | Unlock detection, notifications, tracking | ~12 |
| v0.12.1c | Leaderboards | Score tracking, categories, leaderboard view | ~11 |

---

## Existing Infrastructure

### From v0.12.1

| Feature | Location | Notes |
|---------|----------|-------|
| PlayerStatistics | `Domain/Entities/PlayerStatistics.cs` | Stat tracking |
| IStatisticsService | `Application/Interfaces/IStatisticsService.cs` | Stats queries |
| DiceRollHistory | `Domain/Entities/DiceRollHistory.cs` | Roll tracking |

### Needs Implementation (v0.12.1)

| Feature | Part | Notes |
|---------|------|-------|
| AchievementDefinition | v0.12.1a | Achievement templates |
| AchievementCondition | v0.12.1a | Unlock conditions |
| AchievementTier | v0.12.1a | Bronze/Silver/Gold/Platinum |
| IAchievementService | v0.12.1b | Achievement interface |
| AchievementService | v0.12.1b | Unlock detection |
| AchievementNotification | v0.12.1b | Pop-up UI |
| LeaderboardEntry | v0.12.0c | Score record |
| ILeaderboardService | v0.12.0c | Leaderboard interface |
| LeaderboardService | v0.12.0c | Score management |

---

## Part Definitions

---

## v0.12.1a: Achievement Definitions

### Overview

Define achievement data model including definitions, conditions, categories, and tiers. Achievements are loaded from JSON configuration.

### Scope

**In Scope:**
- `AchievementDefinition` entity
- `AchievementCondition` record
- `AchievementCategory` enum (Combat, Exploration, Progression, Collection, Challenge, Secret)
- `AchievementTier` enum (Bronze 10pts, Silver 25pts, Gold 50pts, Platinum 100pts)
- `ComparisonOperator` enum (>=, <=, ==)
- Secret achievements (hidden until unlocked)
- `IAchievementProvider` interface
- `achievements.json` configuration

**Out of Scope:**
- Achievement tracking (v0.12.1b)
- Leaderboards (v0.12.0c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 1 | `AchievementDefinition` |
| Domain Records | 1 | `AchievementCondition` |
| Domain Enums | 3 | Category, Tier, Operator |
| Interfaces | 1 | `IAchievementProvider` |
| Configuration | 1 | `achievements.json` |
| Unit Tests | ~12 | Definition loading, validation |

### AchievementDefinition Entity

```csharp
public class AchievementDefinition : IEntity
{
    public Guid Id { get; private set; }
    public string AchievementId { get; private set; } = null!;
    public string Name { get; private set; } = null!;
    public string Description { get; private set; } = null!;
    public AchievementCategory Category { get; private set; }
    public AchievementTier Tier { get; private set; }
    public int Points { get; private set; }
    public IReadOnlyList<AchievementCondition> Conditions { get; private set; } = [];
    public bool IsSecret { get; private set; }
    public string? IconPath { get; private set; }
}

public record AchievementCondition(
    string StatisticName,
    ComparisonOperator Operator,
    long Value);

public enum AchievementTier { Bronze = 10, Silver = 25, Gold = 50, Platinum = 100 }
public enum AchievementCategory { Combat, Exploration, Progression, Collection, Challenge, Secret }
public enum ComparisonOperator { GreaterThanOrEqual, LessThanOrEqual, Equals }
```

### Achievement Configuration

```json
{
  "achievements": [
    {
      "id": "first-blood",
      "name": "First Blood",
      "description": "Defeat your first monster",
      "category": "Combat",
      "tier": "Bronze",
      "conditions": [{ "stat": "monstersKilled", "operator": ">=", "value": 1 }]
    },
    {
      "id": "monster-slayer",
      "name": "Monster Slayer",
      "description": "Defeat 100 monsters",
      "category": "Combat",
      "tier": "Silver",
      "conditions": [{ "stat": "monstersKilled", "operator": ">=", "value": 100 }]
    },
    {
      "id": "lucky-streak",
      "name": "Lady Luck's Favorite",
      "description": "Roll a natural 20 five times in a row",
      "category": "Challenge",
      "tier": "Platinum",
      "conditions": [{ "stat": "longestNat20Streak", "operator": ">=", "value": 5 }],
      "isSecret": true
    }
  ]
}
```

### Acceptance Criteria

- [ ] AchievementDefinition loads from JSON
- [ ] Conditions with stat thresholds
- [ ] 6 categories supported
- [ ] 4 tiers with point values
- [ ] Secret achievements supported
- [ ] ~12 unit tests pass

---

## v0.12.1b: Achievement Service

### Overview

Implement achievement unlock detection, player achievement tracking, pop-up notifications, and achievement sound effects.

### Scope

**In Scope:**
- `PlayerAchievement` entity (unlocked achievements)
- `IAchievementService` interface
- `AchievementService` implementation
- Condition evaluation against statistics
- Automatic unlock detection on stat changes
- Player.Achievements collection
- `AchievementNotification` UI component
- Achievement unlock sound
- `AchievementsCommand` for viewing
- Achievement progress tracking

**Out of Scope:**
- Achievement definitions (v0.12.1a)
- Leaderboards (v0.12.0c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 1 | `PlayerAchievement` |
| Interfaces | 1 | `IAchievementService` |
| Services | 1 | `AchievementService` |
| UI Components | 1 | `AchievementNotification` |
| Commands | 1 | `AchievementsCommand` |
| Unit Tests | ~12 | Unlock detection tests |

### IAchievementService Interface

```csharp
public interface IAchievementService
{
    void CheckAchievements(Player player);
    IReadOnlyList<PlayerAchievement> GetUnlockedAchievements(Player player);
    IReadOnlyList<AchievementProgress> GetProgress(Player player);
    int GetTotalPoints(Player player);
    bool IsUnlocked(Player player, string achievementId);
}
```

### AchievementService

```csharp
public class AchievementService : IAchievementService
{
    public void CheckAchievements(Player player)
    {
        var stats = _statisticsService.GetPlayerStatistics(player);
        
        foreach (var achievement in _achievementProvider.GetAllAchievements())
        {
            if (player.HasAchievement(achievement.AchievementId))
                continue;
            
            if (EvaluateConditions(achievement.Conditions, stats))
            {
                UnlockAchievement(player, achievement);
            }
        }
    }
    
    private void UnlockAchievement(Player player, AchievementDefinition achievement)
    {
        player.AddAchievement(achievement.AchievementId);
        _eventBus.Publish(new AchievementUnlockedEvent(player.Id, achievement));
        _notificationService.ShowAchievementUnlock(achievement);
    }
}
```

### Achievement Notification

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ†  ACHIEVEMENT UNLOCKED!                        â•‘
â•‘                                                   â•‘
â•‘  MONSTER SLAYER                                   â•‘
â•‘  Defeat 100 monsters                              â•‘
â•‘                                                   â•‘
â•‘  ğŸ¥ˆ Silver   |   +25 Points                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Acceptance Criteria

- [ ] Achievements unlock when conditions met
- [ ] Secret achievements hidden until unlocked
- [ ] Notification pops up on unlock
- [ ] Points accumulate correctly
- [ ] Progress tracked for locked achievements
- [ ] ~12 unit tests pass

---

## v0.12.0c: Leaderboards

### Overview

Implement local leaderboard system with multiple score categories, entry management, and leaderboard display.

### Scope

**In Scope:**
- `LeaderboardEntry` entity
- `LeaderboardCategory` enum (HighScore, Speedrun, NoDeath, AchievementPoints, BossSlayer)
- `ILeaderboardService` interface
- `LeaderboardService` implementation
- Score calculation
- Entry persistence (local JSON)
- Max 100 entries per category
- Current run highlighting
- `LeaderboardCommand` for viewing
- Leaderboard view UI

**Out of Scope:**
- Achievement definitions (v0.12.1a)
- Achievement service (v0.12.1b)
- Online leaderboards (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 1 | `LeaderboardEntry` |
| Domain Enums | 1 | `LeaderboardCategory` |
| Interfaces | 1 | `ILeaderboardService` |
| Services | 1 | `LeaderboardService` |
| Commands | 1 | `LeaderboardCommand` |
| Persistence | 1 | `leaderboard.json` |
| Unit Tests | ~11 | Score, ranking tests |

### LeaderboardEntry Entity

```csharp
public class LeaderboardEntry : IEntity
{
    public Guid Id { get; private set; }
    public string PlayerName { get; private set; } = null!;
    public string ClassName { get; private set; } = null!;
    public int Level { get; private set; }
    public long Score { get; private set; }
    public LeaderboardCategory Category { get; private set; }
    public DateTime AchievedAt { get; private set; }
    public TimeSpan? CompletionTime { get; private set; }  // For speedrun
}

public enum LeaderboardCategory
{
    HighScore,        // Total score
    Speedrun,         // Fastest completion
    NoDeath,          // Highest level without dying
    AchievementPoints,// Most achievement points
    BossSlayer        // Most bosses defeated
}
```

### ILeaderboardService Interface

```csharp
public interface ILeaderboardService
{
    void SubmitScore(Player player, LeaderboardCategory category);
    IReadOnlyList<LeaderboardEntry> GetLeaderboard(LeaderboardCategory category, int count = 10);
    int GetPlayerRank(Player player, LeaderboardCategory category);
    LeaderboardEntry? GetPlayerBest(Player player, LeaderboardCategory category);
    long CalculateScore(Player player);
}
```

### Leaderboard View

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        LEADERBOARDS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [High Score] [Speedrun] [No Death] [Achievement Points]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚   HIGH SCORE LEADERBOARD                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                      â”‚
â”‚   Rank    Name           Class      Level    Score      Date        â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚   ğŸ¥‡ 1    Thorin        Warrior      15     125,430    2026-01-05   â”‚
â”‚   ğŸ¥ˆ 2    Elara         Mage         12      98,750    2026-01-03   â”‚
â”‚   ğŸ¥‰ 3    Shadow        Rogue        14      87,320    2026-01-08   â”‚
â”‚      4    Grok          Warrior      10      65,100    2026-01-01   â”‚
â”‚   â–º  5    Hero (You)    Paladin       8      52,340    2026-01-10   â”‚
â”‚                                                                      â”‚
â”‚   Your Best: 52,340 (Rank #5)                                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Acceptance Criteria

- [ ] Score calculation works
- [ ] Entries persist locally
- [ ] 5 categories supported
- [ ] Max 100 entries enforced
- [ ] Ranking correct
- [ ] Current player highlighted
- [ ] ~11 unit tests pass

---

## Dependencies & Prerequisites

```
v0.12.0c (Statistics View) - REQUIRED
    â”‚
    â””â”€â”€ Statistics System complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
v0.12.1 (Achievements & Leaderboards)                                     â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.12.1a: Achievement Definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: Domain                                          â”‚
    â”‚       Provides: AchievementDefinition, conditions                   â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.12.1b: Achievement Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: v0.12.1a, Statistics                            â”‚
    â”‚       Provides: IAchievementService, notifications                  â”‚
    â”‚                                                                     â”‚
    â””â”€â”€ v0.12.0c: Leaderboards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: Statistics, Player data
            Provides: ILeaderboardService, score tracking
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.12.1a | ~4 | ~1 | ~12 | Medium |
| v0.12.1b | ~4 | ~2 | ~12 | Medium-High |
| v0.12.0c | ~4 | ~1 | ~11 | Medium |
| **Total** | **~12** | **~4** | **~35** | |

---

## Design Decisions (Confirmed)

| Decision | Value | Notes |
|----------|-------|-------|
| **Point Values** | 10/25/50/100 | By tier |
| **Secret Achievements** | Hidden until unlock | Surprise element |
| **Notification Duration** | 5 seconds | Visible but not intrusive |
| **Leaderboard Storage** | Local JSON | No server needed |
| **Max Entries** | 100 per category | Reasonable limit |
| **Categories** | 5 initial | Expandable |

---

*This scope breakdown completes the v0.12.0 Achievements & Statistics series, providing meta-progression through achievements and competitive elements via leaderboards.*
