# v0.7.0c Design Specification: Game Window Layout

**Version:** 0.7.0c
**Parent:** v0.7.0 (Application Shell)
**Prerequisites:** v0.7.0b Complete (Main Menu Window)
**Status:** Design Complete
**Estimated Unit Tests:** ~7

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Game Window](#4-game-window)
5. [Game Window ViewModel](#5-game-window-viewmodel)
6. [Navigation Service](#6-navigation-service)
7. [Window Layout Service](#7-window-layout-service)
8. [Menu Bar](#8-menu-bar)
9. [Data Model Changes](#9-data-model-changes)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Overview

### Purpose

This phase implements the main game window that hosts all game panels. It establishes the window layout structure with defined regions for different panels, provides navigation services for switching between windows, and manages window state and panel visibility.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Windows** | `GameWindow` |
| **ViewModels** | `GameWindowViewModel` |
| **Services** | `NavigationService`, `WindowLayoutService` |
| **Interfaces** | `INavigationService`, `IWindowLayoutService` |
| **Enums** | `PanelRegion` |
| **Tests** | ~7 unit tests |

### Design Principles

1. **Region-Based Layout**: Defined areas for content, sidebar, input
2. **Panel Flexibility**: Regions can show/hide panels dynamically
3. **Menu Consistency**: Standard File/Game/Help menu structure
4. **State Awareness**: Combat mode toggles overlay visibility

---

## 2. Feature Overview

```
v0.7.0c Features
├── Game Window
│   ├── DockPanel-based layout
│   ├── Menu bar (File, Game, Help)
│   ├── Main content region
│   ├── Bottom content region
│   ├── Right sidebar region (top/bottom)
│   ├── Input region
│   └── Combat overlay region
├── Game Window ViewModel
│   ├── IsInCombat state
│   ├── WindowTitle property
│   ├── ReturnToMainMenuCommand
│   ├── SaveGameCommand
│   └── LoadGameCommand
├── Navigation Service
│   ├── INavigationService interface
│   ├── NavigateTo<TWindow>()
│   ├── ShowDialog<TWindow>()
│   ├── ShowLoadDialogAsync()
│   ├── ShowSaveDialogAsync()
│   └── ReturnToMainMenu()
└── Window Layout Service
    ├── IWindowLayoutService interface
    ├── PanelRegion enum
    ├── RegisterPanel()
    ├── UnregisterPanel()
    ├── GetPanel()
    └── SetPanelVisible()
```

---

## 3. Architecture

### Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       PRESENTATION LAYER                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  VIEWS                                                                  │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                         GameWindow                                 │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │ - Menu bar (File, Game, Help)                                     │ │
│  │ - MainContentRegion (placeholder)                                 │ │
│  │ - BottomContentRegion (placeholder)                               │ │
│  │ - RightSidebarTopRegion (placeholder)                             │ │
│  │ - RightSidebarBottomRegion (placeholder)                          │ │
│  │ - InputRegion (placeholder)                                       │ │
│  │ - CombatOverlayRegion (hidden by default)                         │ │
│  └────────────────────────────────┬──────────────────────────────────┘ │
│                                   │ DataContext                        │
│                                   ▼                                    │
│  VIEWMODELS                                                             │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │                    GameWindowViewModel                             │ │
│  ├───────────────────────────────────────────────────────────────────┤ │
│  │ + WindowTitle: string                                             │ │
│  │ + IsInCombat: bool                                                │ │
│  │ + ReturnToMainMenuCommand                                         │ │
│  │ + SaveGameCommand                                                 │ │
│  │ + LoadGameCommand                                                 │ │
│  └───────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│  SERVICES                                                               │
│  ┌─────────────────────────────┐  ┌─────────────────────────────────┐ │
│  │    INavigationService       │  │    IWindowLayoutService         │ │
│  ├─────────────────────────────┤  ├─────────────────────────────────┤ │
│  │ + CurrentWindow             │  │ + RegisterPanel()               │ │
│  │ + NavigateTo<T>()           │  │ + UnregisterPanel()             │ │
│  │ + ShowDialog<T>()           │  │ + GetPanel()                    │ │
│  │ + ShowLoadDialogAsync()     │  │ + SetPanelVisible()             │ │
│  │ + ShowSaveDialogAsync()     │  │ + OnLayoutChanged event         │ │
│  │ + ReturnToMainMenu()        │  │                                 │ │
│  └─────────────────────────────┘  └─────────────────────────────────┘ │
│              ▲                                 ▲                       │
│              │                                 │                       │
│  ┌───────────┴─────────────┐  ┌───────────────┴─────────────────────┐ │
│  │   NavigationService     │  │      WindowLayoutService            │ │
│  └─────────────────────────┘  └─────────────────────────────────────┘ │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Navigation Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      WINDOW NAVIGATION FLOW                             │
└─────────────────────────────────────────────────────────────────────────┘

     MainMenuWindow                                    GameWindow
    ┌──────────────────┐                           ┌──────────────────┐
    │                  │    NavigateTo<GameWindow> │                  │
    │   [New Game]  ───┼──────────────────────────►│  Game Session    │
    │                  │                           │                  │
    │   [Load Game] ───┼───► File Picker ─────────►│  Loaded Game     │
    │                  │                           │                  │
    └──────────────────┘                           │  File > Return   │
                                                   │      to Menu  ───┼───┐
                                                   │                  │   │
                                                   └──────────────────┘   │
                                                                          │
                              ReturnToMainMenu()                          │
    ┌──────────────────┐◄─────────────────────────────────────────────────┘
    │  MainMenuWindow  │
    └──────────────────┘
```

---

## 4. Game Window

### Window Layout

```
┌─────────────────────────────────────────────────────────────────────────┐
│  File   Game   Help                                      [_]  [□]  [X]  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────┐  ┌───────────────────────────┐ │
│  │                                     │  │                           │ │
│  │           MAIN CONTENT              │  │      RIGHT SIDEBAR        │ │
│  │             REGION                  │  │       TOP REGION          │ │
│  │                                     │  │                           │ │
│  │        (Room Display Panel)         │  │    (Player Status Panel)  │ │
│  │             v0.7.1                  │  │          v0.7.1           │ │
│  │                                     │  │                           │ │
│  │                                     │  │                           │ │
│  ├─────────────────────────────────────┤  ├───────────────────────────┤ │
│  │                                     │  │                           │ │
│  │       BOTTOM CONTENT REGION         │  │    RIGHT SIDEBAR          │ │
│  │                                     │  │     BOTTOM REGION         │ │
│  │       (Message Log Panel)           │  │    (Inventory Panel)      │ │
│  │             v0.7.1                  │  │          v0.7.2           │ │
│  │                                     │  │                           │ │
│  └─────────────────────────────────────┘  └───────────────────────────┘ │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                      INPUT REGION (v0.7.2)                        │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### XAML Implementation

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/GameWindow.axaml`

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
        x:Class="RuneAndRust.Avalonia.Views.GameWindow"
        x:DataType="vm:GameWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="1280" Height="720"
        MinWidth="1024" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}">
    
    <Design.DataContext>
        <vm:GameWindowViewModel />
    </Design.DataContext>
    
    <DockPanel>
        <!-- Menu Bar -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File">
                <MenuItem Header="_New Game" Command="{Binding NewGameCommand}" />
                <MenuItem Header="_Load Game..." Command="{Binding LoadGameCommand}" />
                <MenuItem Header="_Save Game..." Command="{Binding SaveGameCommand}" />
                <Separator />
                <MenuItem Header="_Settings" Command="{Binding OpenSettingsCommand}" />
                <Separator />
                <MenuItem Header="_Return to Menu" Command="{Binding ReturnToMainMenuCommand}" />
                <MenuItem Header="E_xit" Command="{Binding QuitCommand}" />
            </MenuItem>
            <MenuItem Header="_Game">
                <MenuItem Header="_Character" IsEnabled="False" />
                <MenuItem Header="_Map" IsEnabled="False" />
                <MenuItem Header="_Quest Log" IsEnabled="False" />
                <Separator />
                <MenuItem Header="_Pause" IsEnabled="False" />
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_How to Play" IsEnabled="False" />
                <MenuItem Header="_Controls" IsEnabled="False" />
                <Separator />
                <MenuItem Header="_About" Command="{Binding ShowAboutCommand}" />
            </MenuItem>
        </Menu>
        
        <!-- Main Layout Grid -->
        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="400" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="280" MinWidth="200" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            
            <!-- Left Column: Main + Bottom Content -->
            <Grid Grid.Column="0" Grid.Row="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="2*" MinHeight="200" />
                    <RowDefinition Height="8" />
                    <RowDefinition Height="*" MinHeight="100" />
                </Grid.RowDefinitions>
                
                <!-- Main Content Region -->
                <Border Grid.Row="0" Classes="panel" Name="MainContentRegion">
                    <TextBlock Text="Main Content Region (v0.7.1)"
                               Classes="muted"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                </Border>
                
                <!-- Bottom Content Region -->
                <Border Grid.Row="2" Classes="panel" Name="BottomContentRegion">
                    <TextBlock Text="Bottom Content Region (v0.7.1)"
                               Classes="muted"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                </Border>
            </Grid>
            
            <!-- Right Sidebar -->
            <Grid Grid.Column="2" Grid.Row="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="8" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                
                <!-- Right Sidebar Top (Player Status) -->
                <Border Grid.Row="0" Classes="panel" Name="RightSidebarTopRegion">
                    <TextBlock Text="Player Status (v0.7.1)"
                               Classes="muted"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                </Border>
                
                <!-- Right Sidebar Bottom (Inventory) -->
                <Border Grid.Row="2" Classes="panel" Name="RightSidebarBottomRegion">
                    <TextBlock Text="Inventory (v0.7.2)"
                               Classes="muted"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                </Border>
            </Grid>
            
            <!-- Input Region -->
            <Border Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="1"
                    Classes="panel" Name="InputRegion" Margin="0,8,0,0">
                <TextBlock Text="Input Region (v0.7.2)"
                           Classes="muted"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Margin="8" />
            </Border>
            
            <!-- Combat Overlay (hidden by default) -->
            <Border Grid.Column="0" Grid.Row="0"
                    Classes="card" Name="CombatOverlayRegion"
                    IsVisible="{Binding IsInCombat}"
                    Background="#CC1E1E1E">
                <TextBlock Text="Combat Overlay (v0.7.3)"
                           Classes="heading"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center" />
            </Border>
        </Grid>
    </DockPanel>
</Window>
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/GameWindow.axaml.cs`

```csharp
namespace RuneAndRust.Avalonia.Views;

using global::Avalonia.Controls;

/// <summary>
/// Main game window containing all panel regions.
/// </summary>
public partial class GameWindow : Window
{
    public GameWindow()
    {
        InitializeComponent();
    }
}
```

---

## 5. Game Window ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/GameWindowViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using RuneAndRust.Avalonia.Services;
using Serilog;

/// <summary>
/// View model for the main game window.
/// </summary>
public partial class GameWindowViewModel : ViewModelBase
{
    private readonly INavigationService _navigation;
    private readonly IWindowLayoutService _layout;

    [ObservableProperty]
    private string _windowTitle = "Rune and Rust";

    [ObservableProperty]
    private bool _isInCombat;

    public GameWindowViewModel(
        INavigationService navigation,
        IWindowLayoutService layout)
    {
        _navigation = navigation;
        _layout = layout;
    }

    /// <summary>
    /// Design-time constructor.
    /// </summary>
    public GameWindowViewModel()
    {
        _navigation = null!;
        _layout = null!;
    }

    [RelayCommand]
    private void NewGame()
    {
        Log.Information("Starting new game from game window");
        // Will reset game state in future versions
    }

    [RelayCommand]
    private async Task LoadGameAsync()
    {
        Log.Information("Loading game from game window");
        var path = await _navigation.ShowLoadDialogAsync();
        if (path is not null)
        {
            Log.Information("Loading save: {Path}", path);
        }
    }

    [RelayCommand]
    private async Task SaveGameAsync()
    {
        Log.Information("Saving game");
        var path = await _navigation.ShowSaveDialogAsync();
        if (path is not null)
        {
            Log.Information("Saving to: {Path}", path);
        }
    }

    [RelayCommand]
    private void OpenSettings()
    {
        Log.Information("Opening settings from game window");
        _navigation.ShowDialog<Views.SettingsWindow>();
    }

    [RelayCommand]
    private void ReturnToMainMenu()
    {
        Log.Information("Returning to main menu");
        _navigation.ReturnToMainMenu();
    }

    [RelayCommand]
    private void Quit()
    {
        Log.Information("Quitting from game window");
        _navigation.Quit();
    }

    [RelayCommand]
    private void ShowAbout()
    {
        Log.Information("Showing about dialog");
        // Simple about info - full dialog in future version
    }

    /// <summary>
    /// Toggles combat mode for testing.
    /// </summary>
    public void SetCombatMode(bool inCombat)
    {
        IsInCombat = inCombat;
        _layout?.SetPanelVisible(PanelRegion.CombatOverlay, inCombat);
        Log.Debug("Combat mode: {InCombat}", inCombat);
    }
}
```

---

## 6. Navigation Service

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/INavigationService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

using global::Avalonia.Controls;

/// <summary>
/// Handles navigation between windows.
/// </summary>
public interface INavigationService
{
    /// <summary>
    /// Gets the currently active window.
    /// </summary>
    Window? CurrentWindow { get; }

    /// <summary>
    /// Navigates to a window, replacing the current window.
    /// </summary>
    void NavigateTo<TWindow>() where TWindow : Window, new();

    /// <summary>
    /// Shows a modal dialog window.
    /// </summary>
    void ShowDialog<TWindow>() where TWindow : Window, new();

    /// <summary>
    /// Shows a file open dialog for loading saves.
    /// </summary>
    Task<string?> ShowLoadDialogAsync();

    /// <summary>
    /// Shows a file save dialog for saving games.
    /// </summary>
    Task<string?> ShowSaveDialogAsync();

    /// <summary>
    /// Returns to the main menu, closing the current window.
    /// </summary>
    void ReturnToMainMenu();

    /// <summary>
    /// Quits the application.
    /// </summary>
    void Quit();
}
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/NavigationService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

using global::Avalonia;
using global::Avalonia.Controls;
using global::Avalonia.Controls.ApplicationLifetimes;
using global::Avalonia.Platform.Storage;
using RuneAndRust.Avalonia.Views;
using Serilog;

/// <summary>
/// Implementation of window navigation service.
/// </summary>
public class NavigationService : INavigationService
{
    public Window? CurrentWindow
    {
        get
        {
            if (Application.Current?.ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
            {
                return desktop.MainWindow;
            }
            return null;
        }
    }

    public void NavigateTo<TWindow>() where TWindow : Window, new()
    {
        if (Application.Current?.ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            var oldWindow = desktop.MainWindow;
            var newWindow = new TWindow();
            
            desktop.MainWindow = newWindow;
            newWindow.Show();
            oldWindow?.Close();
            
            Log.Information("Navigated to {WindowType}", typeof(TWindow).Name);
        }
    }

    public async void ShowDialog<TWindow>() where TWindow : Window, new()
    {
        if (CurrentWindow is not null)
        {
            var dialog = new TWindow();
            await dialog.ShowDialog(CurrentWindow);
            Log.Debug("Showed dialog {WindowType}", typeof(TWindow).Name);
        }
    }

    public async Task<string?> ShowLoadDialogAsync()
    {
        if (CurrentWindow is null) return null;

        var files = await CurrentWindow.StorageProvider.OpenFilePickerAsync(new FilePickerOpenOptions
        {
            Title = "Load Game",
            AllowMultiple = false,
            FileTypeFilter = new[]
            {
                new FilePickerFileType("Save Files") { Patterns = new[] { "*.json" } },
                new FilePickerFileType("All Files") { Patterns = new[] { "*" } }
            }
        });

        return files.Count > 0 ? files[0].Path.LocalPath : null;
    }

    public async Task<string?> ShowSaveDialogAsync()
    {
        if (CurrentWindow is null) return null;

        var file = await CurrentWindow.StorageProvider.SaveFilePickerAsync(new FilePickerSaveOptions
        {
            Title = "Save Game",
            DefaultExtension = "json",
            FileTypeChoices = new[]
            {
                new FilePickerFileType("Save Files") { Patterns = new[] { "*.json" } }
            }
        });

        return file?.Path.LocalPath;
    }

    public void ReturnToMainMenu()
    {
        NavigateTo<MainMenuWindow>();
    }

    public void Quit()
    {
        if (Application.Current?.ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
        {
            desktop.Shutdown();
        }
    }
}
```

---

## 7. Window Layout Service

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/PanelRegion.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

/// <summary>
/// Defines the regions available in the game window layout.
/// </summary>
public enum PanelRegion
{
    /// <summary>Main content area (room display).</summary>
    MainContent,
    
    /// <summary>Bottom content area (message log).</summary>
    BottomContent,
    
    /// <summary>Right sidebar top area (player status).</summary>
    RightSidebarTop,
    
    /// <summary>Right sidebar bottom area (inventory).</summary>
    RightSidebarBottom,
    
    /// <summary>Input area at bottom of window.</summary>
    Input,
    
    /// <summary>Combat overlay (appears during combat).</summary>
    CombatOverlay
}
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/IWindowLayoutService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

using global::Avalonia.Controls;

/// <summary>
/// Manages panel regions in the game window.
/// </summary>
public interface IWindowLayoutService
{
    /// <summary>
    /// Registers a panel control in a region.
    /// </summary>
    void RegisterPanel(PanelRegion region, Control panel);

    /// <summary>
    /// Unregisters a panel from a region.
    /// </summary>
    void UnregisterPanel(PanelRegion region);

    /// <summary>
    /// Gets the panel registered in a region.
    /// </summary>
    Control? GetPanel(PanelRegion region);

    /// <summary>
    /// Sets whether a panel region is visible.
    /// </summary>
    void SetPanelVisible(PanelRegion region, bool visible);

    /// <summary>
    /// Event raised when layout changes.
    /// </summary>
    event Action<PanelRegion>? OnLayoutChanged;
}
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/WindowLayoutService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

using global::Avalonia.Controls;
using Serilog;

/// <summary>
/// Implementation of window layout management.
/// </summary>
public class WindowLayoutService : IWindowLayoutService
{
    private readonly Dictionary<PanelRegion, Control> _panels = new();

    public event Action<PanelRegion>? OnLayoutChanged;

    public void RegisterPanel(PanelRegion region, Control panel)
    {
        _panels[region] = panel;
        Log.Debug("Registered panel in region {Region}", region);
        OnLayoutChanged?.Invoke(region);
    }

    public void UnregisterPanel(PanelRegion region)
    {
        if (_panels.Remove(region))
        {
            Log.Debug("Unregistered panel from region {Region}", region);
            OnLayoutChanged?.Invoke(region);
        }
    }

    public Control? GetPanel(PanelRegion region)
    {
        return _panels.TryGetValue(region, out var panel) ? panel : null;
    }

    public void SetPanelVisible(PanelRegion region, bool visible)
    {
        if (_panels.TryGetValue(region, out var panel))
        {
            panel.IsVisible = visible;
            Log.Debug("Set panel {Region} visibility to {Visible}", region, visible);
        }
    }
}
```

---

## 8. Menu Bar

### Menu Structure

```
File Menu:
┌─────────────────┐
│ New Game        │
│ Load Game...    │
│ Save Game...    │
├─────────────────┤
│ Settings        │
├─────────────────┤
│ Return to Menu  │
│ Exit            │
└─────────────────┘

Game Menu:
┌─────────────────┐
│ Character       │  (disabled - v0.8.0)
│ Map             │  (disabled - v0.8.0)
│ Quest Log       │  (disabled - v0.8.0)
├─────────────────┤
│ Pause           │  (disabled - v0.8.0)
└─────────────────┘

Help Menu:
┌─────────────────┐
│ How to Play     │  (disabled - v0.8.0)
│ Controls        │  (disabled - v0.8.0)
├─────────────────┤
│ About           │
└─────────────────┘
```

---

## 9. Data Model Changes

### New Types

| Type | Layer | Description |
|------|-------|-------------|
| `GameWindowViewModel` | Presentation | Game window state and commands |
| `GameWindow` | Presentation | Main game window view |
| `INavigationService` | Presentation | Window navigation interface |
| `NavigationService` | Presentation | Navigation implementation |
| `IWindowLayoutService` | Presentation | Layout management interface |
| `WindowLayoutService` | Presentation | Layout implementation |
| `PanelRegion` | Presentation | Enum for layout regions |

No domain or application layer changes required.

---

## 10. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `GameWindowViewModel` | Information | Save, load, return to menu, quit |
| `GameWindowViewModel` | Debug | Combat mode changes |
| `NavigationService` | Information | Window navigation |
| `NavigationService` | Debug | Dialog display |
| `WindowLayoutService` | Debug | Panel registration, visibility |

---

## 11. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| NavigationService | ~3 |
| WindowLayoutService | ~2 |
| GameWindowViewModel | ~2 |
| **Total** | **~7** |

### Test Specifications

**File:** `tests/RuneAndRust.Avalonia.UnitTests/Services/NavigationServiceTests.cs`

```csharp
[TestFixture]
public class NavigationServiceTests
{
    [Test]
    public void CurrentWindow_WhenNoApplication_ReturnsNull();

    [Test]
    public void ShowLoadDialogAsync_WhenNoWindow_ReturnsNull();

    [Test]
    public void ShowSaveDialogAsync_WhenNoWindow_ReturnsNull();
}
```

**File:** `tests/RuneAndRust.Avalonia.UnitTests/Services/WindowLayoutServiceTests.cs`

```csharp
[TestFixture]
public class WindowLayoutServiceTests
{
    [Test]
    public void RegisterPanel_AddsPanel_GetPanelReturnsIt();

    [Test]
    public void UnregisterPanel_RemovesPanel_GetPanelReturnsNull();
}
```

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/GameWindowViewModelTests.cs`

```csharp
[TestFixture]
public class GameWindowViewModelTests
{
    [Test]
    public void WindowTitle_DefaultValue_IsRuneAndRust();

    [Test]
    public void SetCombatMode_SetsIsInCombat();
}
```

---

## 12. Use Cases

### UC-070c-001: Enter Game Window
**Actor:** Player
**Flow:** Click "New Game" in MainMenu → NavigationService.NavigateTo<GameWindow>() → GameWindow displays

### UC-070c-002: Save Game
**Actor:** Player
**Flow:** File > Save Game → SaveFilePickerAsync opens → Select location → Log save path

### UC-070c-003: Load Game in Game
**Actor:** Player
**Flow:** File > Load Game → OpenFilePickerAsync opens → Select file → Log load path

### UC-070c-004: Return to Main Menu
**Actor:** Player
**Flow:** File > Return to Menu → NavigateTo<MainMenuWindow>() → MainMenu displays

### UC-070c-005: Toggle Combat Overlay
**Actor:** System
**Flow:** Combat starts → SetCombatMode(true) → CombatOverlayRegion becomes visible

---

## 13. Deliverable Checklist

### Views
- [ ] `Views/GameWindow.axaml` created
- [ ] `Views/GameWindow.axaml.cs` created

### ViewModels
- [ ] `ViewModels/GameWindowViewModel.cs` created

### Services
- [ ] `Services/INavigationService.cs` created
- [ ] `Services/NavigationService.cs` created
- [ ] `Services/IWindowLayoutService.cs` created
- [ ] `Services/WindowLayoutService.cs` created
- [ ] `Services/PanelRegion.cs` created

### Application Updates
- [ ] `App.axaml.cs` updated to register services
- [ ] `MainMenuViewModel` updated to use NavigationService

### Testing
- [ ] ~7 unit tests implemented
- [ ] All tests passing

---

## 14. Acceptance Criteria

### Game Window
- [ ] Game window opens from main menu "New Game"
- [ ] Game window opens from main menu "Load Game"
- [ ] Window has defined panel regions with placeholders
- [ ] Window can be resized (min 1024x600)
- [ ] Panel regions adjust with window resize

### Menu Bar
- [ ] File menu displays with all items
- [ ] Save Game opens save dialog
- [ ] Load Game opens load dialog
- [ ] Return to Menu navigates to MainMenuWindow
- [ ] Exit closes application
- [ ] Game menu items are disabled (future)
- [ ] Help > About is functional

### Navigation
- [ ] NavigationService replaces windows correctly
- [ ] ReturnToMainMenu works from game window
- [ ] File dialogs filter for .json files

### Layout
- [ ] Panel regions can register controls
- [ ] SetPanelVisible shows/hides regions
- [ ] Combat overlay hidden by default
- [ ] Combat overlay shows when IsInCombat is true

### Quality
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] ~7 unit tests pass

---

## 15. Dependencies

### Required from v0.7.0a

| Type | Location | Usage |
|------|----------|-------|
| Color resources | `Themes/Colors.axaml` | Panel backgrounds |
| Panel styles | `Styles/PanelStyles.axaml` | `.panel`, `.card` |
| TextBlock styles | `Styles/TextBlockStyles.axaml` | Placeholder text |

### Required from v0.7.0b

| Type | Location | Usage |
|------|----------|-------|
| `MainMenuWindow` | `Views/MainMenuWindow.axaml` | Return navigation target |
| `SettingsWindow` | `Views/SettingsWindow.axaml` | Settings dialog |
| `ViewModelBase` | `ViewModels/ViewModelBase.cs` | ViewModel base class |

### Provides to v0.7.1

| Type | Usage |
|------|-------|
| `GameWindow` | Host for panel content |
| `IWindowLayoutService` | Panel registration |
| `PanelRegion` | Region identification |
| `INavigationService` | Window navigation |

---

## 16. Future Considerations

### Deferred to v0.7.1
- **Room Display Panel**: MainContent region content
- **Message Log Panel**: BottomContent region content
- **Player Status Panel**: RightSidebarTop region content

### Deferred to v0.7.2
- **Inventory Panel**: RightSidebarBottom region content
- **Input Panel**: Command input region content

### Deferred to v0.7.3
- **Combat Grid**: CombatOverlay region content

### Out of Scope
- **Panel resizing**: Fixed proportions for now
- **Dockable panels**: Fixed layout in v0.7.x

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: Assistant*
