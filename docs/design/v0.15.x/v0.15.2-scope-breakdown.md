## v0.15.2 - Acrobatics Skill Expansion

**Focus:** Multi-stage climbing, leaping mechanics, stealth movement, fall damage, and chase sequences

**Source Specification:** [acrobatics.md](../../aethelgard/design/01-core/skills/acrobatics.md)

### Overview

This version transforms Acrobatics from a simple skill check into a rich traversal system. Characters can climb multi-stage heights, leap across gaps with distance-based DCs, move stealthily through noisy terrain, and engage in cinematic chase sequences.

---

### Deliverables Summary

| Category | Items | Estimated Tests |
|----------|-------|-----------------|
| Enums | 4 | 4 |
| Value Objects | 6 | 10 |
| Entities | 2 | 6 |
| Services | 5 | 10 |
| **Total** | **17** | **~30** |

---

### v0.15.2a - Climbing System ✓

#### ClimbingStage Value Object ✓
**Purpose:** Represents one stage of a multi-stage climb

```
ClimbingStage
├── StageNumber: int
├── HeightReached: int (feet)
├── SurfaceType: SurfaceType enum
├── StageDc: int
├── StageResult: SkillOutcome?
└── FallHeight: int (if failed)
```

#### SurfaceType Enum ✓
```
SurfaceType
├── Stable (+1d10)
├── Normal (+0)
├── Wet (-1d10)
├── Compromised (-2d10)
├── Collapsing (-3d10)
└── Glitched (+2 DC)
```

#### ClimbContext Value Object ✓
- [x] `TotalHeight` - Total height to climb (feet)
- [x] `StagesRequired` - Calculated from height (10-20ft=1, 30-40ft=2, 50+ft=3)
- [x] `SurfaceType` - Current surface classification
- [x] `BaseDc` - DC based on surface type
- [x] `EquipmentModifiers` - Climbing gear, grappling hook
- [x] `ArmorPenalty` - Heavy armor penalty

#### ClimbState Entity ✓
- [x] `ClimbId` - Unique identifier
- [x] `CharacterId` - Who is climbing
- [x] `Context` - ClimbContext
- [x] `CurrentStage` - Progress (0 = ground)
- [x] `StageHistory` - List of completed stages
- [x] `Status` - InProgress, Completed, Fallen

#### IClimbingService Interface ✓
```csharp
public interface IClimbingService
{
    ClimbState StartClimb(string characterId, ClimbContext context);
    ClimbStageResult AttemptStage(string climbId, SkillContext? modifiers = null);
    FallResult ProcessFall(string climbId, int fromStage);
}
```

**Climbing Logic:** ✓
- [x] 10-20ft = 1 stage
- [x] 30-40ft = 2 stages
- [x] 50+ft = 3 stages
- [x] Success = advance stage
- [x] Failure = slip back one stage
- [x] Fumble (0 successes + botch) = [The Slip] - fall from current height
- [x] Critical Success (net ≥ 5) = advance 2 stages or reach top

**Equipment Modifiers:** ✓
| Equipment | Modifier |
|-----------|----------|
| Climbing Gear | +1d10 |
| Grappling Hook | +2d10 (vertical surfaces) |
| Light/No Armor | +0 |
| Medium Armor | -1d10 |
| Heavy Armor | -4d10 |

**Unit Tests (~6):** ✓
- [x] Height correctly calculates stages required
- [x] Surface type applies correct modifier
- [x] Success advances to next stage
- [x] Failure slips back one stage
- [x] Fumble triggers fall from current height
- [x] Critical success advances two stages

---

### v0.15.2b - Leaping System ✅

#### LeapDistance Enum
```
LeapDistance
├── Short (5ft, DC 1)
├── Medium (10ft, DC 2)
├── Long (15ft, DC 3)
├── Extreme (20ft, DC 4)
└── Heroic (25ft, DC 5, Master only)
```

#### LeapContext Value Object
- [x] `DistanceFeet` - Gap to cross (feet)
- [x] `HasRunningStart` - -1 DC with 10ft run-up
- [x] `LandingType` - Normal, Precision (+1), Glitched (+2), PrecisionGlitched (+3), Downward (-1)
- [x] `IsEncumbered` - +1 DC when over capacity
- [x] `HasLowGravity` - -1 DC in [Low Gravity] zones
- [x] `IsStandingJump` - +1 DC with no run-up space
- [x] `FallDepth` - Depth of fall on failure

#### LeapResult Value Object
- [x] `Outcome` - SkillOutcome
- [x] `Landed` - True if reached other side
- [x] `FallTriggered` - True if failed and fell
- [x] `FallResult` - Fall details (if applicable)
- [x] `StaminaCost` - Movement cost (modified by outcome)
- [x] `IsFumble` / `BonusDamage` / `StressGained` / `StatusApplied` - Fumble effects

**Leaping Logic:**
- [x] Distance determines base DC (Short=1 to Heroic=5)
- [x] Running start: -1 DC
- [x] Precision landing: +1 DC
- [x] [Glitched] landing: +2 DC
- [x] Encumbered: +1 DC
- [x] [Low Gravity]: -1 DC
- [x] Success = land safely
- [x] Failure = fall into gap
- [x] Critical Success = perfect landing, halved stamina cost
- [x] Fumble = [The Long Fall] - +1d10 bonus damage + 2 stress + [Disoriented] 2 rounds

**Unit Tests (32 test cases):**
- [x] Distance correctly maps to DC (5 categories)
- [x] Running start reduces DC by 1
- [x] Precision/Glitched/Downward landing modifiers
- [x] Encumbered and Low Gravity modifiers
- [x] Minimum DC is always 1
- [x] Success returns landed result
- [x] Failure triggers fall
- [x] Fumble triggers [The Long Fall] with bonus damage, stress, and status
- [x] Critical success halves stamina cost
- [x] Marginal success adds +1 stamina
- [x] Stamina costs by distance category
- [x] Master rank requirement for Heroic distances

---

### v0.15.2c - Fall Damage System

#### FallDamage Value Object
- [x] `FallHeight` - Height fallen (feet)
- [x] `DamageDice` - Calculated (1d10 per 10ft, max 10d10)
- [x] `DamageType` - Bludgeoning
- [x] `CanCrashLand` - If character can attempt save

#### CrashLandingResult Value Object
- [x] `CrashDc` - 2 + (height/10) successes needed
- [x] `Successes` - Roll result
- [x] `DiceReduced` - Successes above DC
- [x] `FinalDamage` - After reduction

#### FallDamageResult Value Object
- [x] `FallDamage` - Calculated damage parameters
- [x] `CrashLanding` - Crash Landing attempt result
- [x] `DamageRolled` - Final damage taken
- [x] `CharacterId` - Character who fell

#### IFallDamageService Interface
- [x] `CalculateFallDamage()` - Height-based calculation
- [x] `AttemptCrashLanding()` - Acrobatics damage reduction
- [x] `RollDamage()` - Sum damage dice
- [x] `ProcessFall()` - Complete workflow

#### FallDamageService Implementation
- [x] Height-to-dice conversion (1d10 per 10ft)
- [x] 10d10 damage cap enforcement
- [x] Crash Landing DC calculation
- [x] Margin-based damage reduction
- [x] Skill outcome determination
- [x] Integration with IDiceService
- [x] Exhaustive structured logging

**Fall Damage Logic:**
- [x] Damage = (Height / 10) × 1d10
- [x] Maximum = 10d10 (100+ feet)
- [x] Crash Landing DC = 2 + (Height / 10) successes
- [x] Each success above DC reduces damage by 1d10

| Fall Height | Damage Dice | Crash Landing DC |
|-------------|-------------|------------------|
| 10 ft | 1d10 | 3 |
| 20 ft | 2d10 | 4 |
| 30 ft | 3d10 | 5 |
| 50 ft | 5d10 | 7 |
| 100+ ft | 10d10 | 12 |

**Configuration:**
- [x] `config/fall-damage.json` - Damage parameters
- [x] `config/schemas/fall-damage.schema.json` - Schema validation

**Unit Tests (48 test cases):**
- [x] Fall height correctly calculates damage dice
- [x] Damage caps at 10d10 for 100+ feet
- [x] Falls below 10ft cause no damage
- [x] Crash landing DC scales with height
- [x] Crash landing reduces damage on success
- [x] Margin above DC reduces dice by margin
- [x] Failed Crash Landing applies full damage
- [x] ProcessFall integrates all steps

---

### v0.15.2d - Stealth Movement ✅ COMPLETE

#### StealthSurface Enum
```
StealthSurface (success-counting DCs)
├── Silent (DC 2) - carpet, moss
├── Normal (DC 3) - concrete, dirt
├── Noisy (DC 4) - loose rubble
├── VeryNoisy (DC 5) - scrap metal
```

#### HiddenStatus Entity
**Purpose:** Track [Hidden] state for characters

- [x] `CharacterId` - Who is hidden
- [x] `IsHidden` - Current state
- [x] `HiddenSince` - When they entered hidden
- [x] `BreakConditions` - What will reveal them
- [x] `DetectionModifier` - Difficulty for enemies to spot

**[Hidden] Status Effects:**
- [x] Cannot be directly targeted by single-target attacks
- [x] Can still be hit by AoE abilities
- [x] Broken by: attacking, loud action, enemy critical Perception
- [x] Re-enters: `hide` command or specialization ability

#### PartyStealthResult Value Object
**Purpose:** Weakest link party stealth

- [x] `ParticipantIds` - Party members
- [x] `WeakestMemberId` - Who made the check
- [x] `WeakestPool` - Their dice pool
- [x] `Outcome` - Result of check
- [x] `DetectedBy` - Which enemies noticed

**Stealth Logic:**
- [x] Surface determines DC
- [x] Dim Light / Obscuring Terrain: -1 DC
- [x] Illuminated: +2 DC
- [x] Enemy Alerted / Combat: +1 DC
- [x] [Psychic Resonance] zone: -2 DC
- [x] Party uses lowest pool member's roll
- [x] Fumble = [System-Wide Alert] - all adjacent rooms alerted

**Unit Tests (30 tests):**
- [x] Surface type sets correct DC
- [x] [Hidden] status tracking
- [x] Party stealth uses weakest member
- [x] Fumble triggers system-wide alert

---

### v0.15.2e - Chase Sequences ✅ COMPLETE

#### ChaseState Entity
**Purpose:** Track chase encounter state

```
ChaseState
├── ChaseId: string
├── FleeingId: string (character trying to escape)
├── PursuerId: string (character chasing)
├── Distance: int (0-6 track position)
├── ObstacleHistory: List<ChaseObstacle>
├── RoundNumber: int
├── Status: ChaseStatus enum
└── MaxRounds: int?
```

#### ChaseStatus Enum
```
ChaseStatus
├── InProgress
├── Caught (distance ≤ 0)
├── Escaped (distance ≥ 6)
├── Abandoned
└── TimedOut
```

#### ChaseObstacle Value Object
```
ChaseObstacle
├── ObstacleType: ObstacleType enum
├── SkillRequired: string
├── Dc: int
├── SuccessEffect: string
├── FailureEffect: string
```

#### ObstacleType Enum
```
ObstacleType
├── Gap - Leap check
├── Climb - Climb check
├── Debris - Balance check
├── Crowd - Dodge check
├── Hazard - Avoid check
```

#### IChaseService Interface
```csharp
public interface IChaseService
{
    ChaseState StartChase(string fleeingId, string pursuerId, int startDistance = 3);
    ChaseObstacle GenerateObstacle(ChaseState state);
    ChaseRoundResult ProcessRound(string chaseId, bool fleeingAttempts, bool pursuerAttempts);
    void AbandonChase(string chaseId, string byCharacterId);
}
```

**Chase Distance Track:**
| Position | Status |
|----------|--------|
| 0-1 (Close) | Can attempt capture |
| 2-3 (Near) | Within striking distance |
| 4-5 (Far) | Safe for now |
| 6+ (Lost) | Escaped pursuit |

**Chase Logic:**
- [x] Each round: obstacle generated
- [x] Both characters attempt obstacle check
- [x] Success = +1 position (for that character)
- [x] Failure = -1 position
- [x] Critical = +2 position
- [x] Distance 0 = caught
- [x] Distance 6+ = escaped

**Unit Tests (31 tests):**
- [x] Chase starts at specified distance
- [x] Success moves position correctly
- [x] Distance 0 triggers caught status
- [x] Distance 6+ triggers escaped status

---

### v0.15.2f - Balance Checks ✅ COMPLETE

#### BalanceSurface Value Object
- [x] `Width` - Surface width (BalanceWidth enum: Wide/Narrow/Cable/RazorEdge)
- [x] `Stability` - Stable, Unstable, Swaying (SurfaceStability enum)
- [x] `Length` - Distance to cross
- [x] `BaseDc` - From width

| Surface Width | DC (Success-Counting) |
|---------------|----------------------|
| Wide (2+ ft) | 2 successes |
| Narrow (1 ft) | 3 successes |
| Cable/Pipe (6 in) | 4 successes |
| Razor Edge (< 6 in) | 5 successes |

**Balance Logic:**
- [x] Width determines base DC
- [x] Unstable surface: +1 DC
- [x] Swaying surface: +2 DC
- [x] Strong wind: +1 DC, Severe: +2 DC
- [x] Failure = fall (height-dependent)

**Unit Tests (39 tests):**
- [x] Width correctly sets DC
- [x] Failure triggers fall

---

### v0.15.2g - Specialization Integration ✅ COMPLETE

#### Gantry-Runner Abilities
- [x] `[Roof-Runner]` - Reduce climbing stages by 1
- [x] `[Death-Defying Leap]` - +10 ft to maximum leap distance
- [x] `[Wall-Run]` - Run vertically (combat action)
- [x] `[Double Jump]` - Once per day, correct failed leap mid-air
- [x] `[Featherfall]` - Auto-succeed Crash Landing DC ≤ 3

#### Myrk-gengr Abilities
- [x] `[Slip into Shadow]` - Enter [Hidden] without action
- [x] `[Ghostly Form]` - Stay [Hidden] after attacking (once per encounter)
- [x] `[Cloak the Party]` - Grant party +2d10 on Passive Stealth
- [x] `[One with the Static]` - Auto-enter [Hidden] in [Psychic Resonance] zones

**Unit Tests (31 tests):**
- [x] Gantry-Runner reduces climbing stages
- [x] Myrk-gengr can enter [Hidden] without action

---

### Configuration Files

| File | Purpose |
|------|---------|
| `climbing-surfaces.json` | Surface type definitions and modifiers |
| `leap-distances.json` | Distance-to-DC mapping |
| `stealth-surfaces.json` | Surface noise classifications |
| `chase-obstacles.json` | Obstacle type definitions |
| `acrobatics-descriptors.json` | Voice guidance text |

---

### Dependencies

**Requires:**
- v0.15.0: Dice pool refactor (success-counting, fumble/critical detection)
- v0.15.1: Skill infrastructure (SkillContext, SkillOutcome, FumbleConsequence)
- v0.10.x: Status effects ([Hidden])
- v0.11.x: Combat system (for chase integration)

**Provides to:**
- Combat movement actions
- Environmental traversal
- Escape mechanics

---

### Acceptance Criteria

- [ ] Multi-stage climbing works with proper stage progression
- [ ] Climbing fumbles trigger falls from correct height
- [ ] Leaping uses distance-based DCs
- [ ] Running start provides correct bonus
- [ ] Fall damage calculates correctly
- [ ] Crash landing reduces damage appropriately
- [ ] [Hidden] status prevents targeting
- [ ] Party stealth uses weakest member
- [ ] Chase sequences track distance correctly
- [ ] Chase ends on caught/escaped conditions
- [ ] Balance checks use width-based DCs
- [ ] Specialization abilities function
- [ ] ~30 unit tests pass
