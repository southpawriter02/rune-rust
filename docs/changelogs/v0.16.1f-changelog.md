# v0.16.1f Changelog: Combat Integration

**Version:** 0.16.1f
**Date:** 2026-01-28
**Status:** Implemented

---

## Summary

Implements combat integration for the Weapon Proficiency System, providing centralized proficiency-based combat modifiers and automatic experience recording.

---

## Added

### Domain Layer

- **CombatProficiencyModifiers** value object (`RuneAndRust.Domain.ValueObjects`)
    - Encapsulates attack modifiers, damage modifiers, special property access, and technique levels
    - Static factory properties: `NonProficient`, `Proficient`, `Expert`, `Master`
    - `FromEffect` factory method for creating modifiers from `ProficiencyEffect`
    - Convenience properties: `IsNonProficient`, `HasPenalty`, `HasBonus`, `IsExpertOrHigher`, `IsMaster`
    - `Description` property for formatted display output

### Application Layer

- **IProficiencyCheckService** interface (`RuneAndRust.Application.Interfaces`)
    - `GetCombatModifiers`: Primary combat integration method
    - `GetAttackModifier`, `GetDamageModifier`: Individual modifier accessors
    - `CanUseSpecialProperties`, `CanUseTechnique`: Capability checks
    - `RecordCombatUsageAsync`: Delegates to `IProficiencyAcquisitionService`
    - `GetProficiencyDescription`: Display text generation

- **ProficiencyCheckService** implementation (`RuneAndRust.Application.Services`)
    - Injects `IProficiencyEffectProvider` and `IProficiencyAcquisitionService`
    - Structured logging at Debug level for calculations
    - Information-level logging for proficiency advancements

### Unit Tests

- **CombatProficiencyModifiersTests** (22 tests)
    - Static factory property tests
    - Convenience property tests
    - `FromEffect` factory method tests
    - Description formatting tests

- **ProficiencyCheckServiceTests** (12 tests)
    - Constructor validation tests
    - `GetCombatModifiers` tests for NonProficient and Master levels
    - `CanUseSpecialProperties` tests
    - `CanUseTechnique` tests for various technique levels
    - `RecordCombatUsageAsync` delegation test
    - `GetProficiencyDescription` test

---

## Dependencies

- v0.16.1a: `WeaponProficiencyLevel`, `TechniqueAccess`, `ProficiencyEffect`, `IProficiencyEffectProvider`
- v0.16.1b: `WeaponCategory`
- v0.16.1d: `CharacterProficiencies`
- v0.16.1e: `IProficiencyAcquisitionService`, `ProficiencyGainResult`

---

## Combat Integration Pattern

```csharp
// During attack resolution
var modifiers = _proficiencyCheckService.GetCombatModifiers(
    character.Proficiencies, weapon.Category);

// Apply modifiers
var attackBonus = baseAttack + modifiers.AttackModifier;
var damageBonus = baseDamage + modifiers.DamageModifier;

// Check special properties
if (weapon.HasSpecialProperty && modifiers.CanUseSpecialProperties)
{
    ApplySpecialProperty(weapon);
}

// Record combat usage
await _proficiencyCheckService.RecordCombatUsageAsync(
    character.Proficiencies, weapon.Category);
```
