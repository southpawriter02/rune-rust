# v0.14.4d Changelog - Interactive Object Schema

## Summary

Introduced the comprehensive **Interactive Object Schema** (`interactive-objects.schema.json`) which validates interactive object definitions including object types, states, allowed interactions, skill check requirements, state transitions, rewards, trap effects, and keywords. This schema enables full customization of dungeon interactables without code changes, supporting modding scenarios such as custom puzzle rooms, trap-filled corridors, or treasure vaults with unique containers. The schema validates the existing 12 interactive object definitions. This is the fourth and final schema in the v0.14.4 Environment Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/interactive-objects.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/interactive-objects.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (8 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `InteractiveObjectDefinition` | Core object definition | id, name, description, objectType, defaultState, allowedInteractions, keywords |
| `SkillCheck` | Skill check requirements | skillId, dc |
| `StateTransition` | State change rules | fromState, toState, viaInteraction |
| `Reward` | Interaction rewards | (all optional) |
| `ItemReward` | Specific item rewards | itemId |
| `QuantityRange` | Min/max ranges | min, max |
| `TrapEffect` | Trap configurations | damage, damageType |
| `SavingThrow` | Saving throw mechanics | attribute, dc |

### Object Type Enumeration (14 values)
| Category | Object Types |
|----------|--------------|
| Passage Blockers | `Door`, `Web` |
| Containers | `Chest`, `Barrel`, `Crate` |
| Mechanisms | `Lever`, `Switch`, `Trap` |
| Decorative | `Statue`, `Inscription`, `LightSource` |
| Interactive Features | `Altar`, `Fountain`, `Bookshelf` |

### State Enumeration (12 values)
| State | Typical Objects |
|-------|-----------------|
| `Closed` | Door, Chest, Crate, Barrel |
| `Open` | Door, Chest |
| `Locked` | Door, Chest |
| `Broken` | Any breakable |
| `Lit` / `Unlit` | LightSource |
| `Active` / `Inactive` | Altar, Switch |
| `Normal` / `Triggered` | Web, Trap, Statue |
| `Down` / `Up` | Lever |

### Interaction Enumeration (12 values)
| Interaction | Description |
|-------------|-------------|
| `Open` | Open a closed object |
| `Close` | Close an open object |
| `Examine` | Get detailed description |
| `Search` | Look for hidden items |
| `Activate` | Trigger a mechanism |
| `Break` | Destroy the object |
| `Unlock` / `Lock` | Remove/add a lock |
| `Read` | Read text content |
| `Use` | Consume or interact specially |
| `Push` / `Pull` | Push/pull a mechanism |

### Unit Tests
- **[InteractiveObjectsSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/InteractiveObjectsSchemaTests.cs)** - 12 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (8 definitions)
  - `InteractiveObjectsJson_ValidatesAgainstSchema` - Backwards compatibility (12 objects)
  - `ObjectType_InvalidEnum_FailsValidation` - Object type enum (14 values)
  - `DefaultState_InvalidEnum_FailsValidation` - State enum (12 values)
  - `AllowedInteractions_InvalidEnum_FailsValidation` - Interaction enum (12 values)
  - `SkillCheckDC_LessThanOne_FailsValidation` - DC >= 1 validation
  - `TriggerChance_OutOfRange_FailsValidation` - Probability 0-1 range
  - `ItemRewardChance_OutOfRange_FailsValidation` - Probability 0-1 range
  - `ObjectId_InvalidPattern_FailsValidation` - Kebab-case pattern
  - `TrapDamage_InvalidDicePattern_FailsValidation` - Dice expression pattern
  - `TrapSavingThrowAttribute_InvalidEnum_FailsValidation` - Attribute enum (5 values)
  - `StateTransitionViaInteraction_InvalidEnum_FailsValidation` - Interaction enum in transitions

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/interactive-objects.schema.json` | Added |
| `tests/.../Schemas/InteractiveObjectsSchemaTests.cs` | Added |
| `changelogs/v0.14.4d-changelog.md` | Added |

## Test Results

```
Test summary: total: 12, failed: 0, succeeded: 12, skipped: 0
Build succeeded with 0 errors
```

## Backward Compatibility

The schema validates all 12 existing interactive objects without modification:
- `iron-door-basic` - Heavy Iron Door (Door, Closed)
- `wooden-door-basic` - Wooden Door (Door, Closed)
- `wooden-chest-basic` - Weathered Wooden Chest (Chest, Closed)
- `iron-chest-basic` - Iron-Bound Chest (Chest, Closed)
- `rusty-lever-basic` - Rusty Lever (Lever, Down)
- `wooden-crate-basic` - Wooden Crate (Crate, Closed)
- `storage-barrel-basic` - Storage Barrel (Barrel, Closed)
- `spider-web-basic` - Giant Spider Web (Web, Normal)
- `stone-statue-basic` - Stone Statue (Statue, Normal)
- `ancient-altar-basic` - Ancient Altar (Altar, Inactive)
- `wall-torch-basic` - Wall Torch (LightSource, Lit)
- `stone-inscription-basic` - Stone Inscription (Inscription, Normal)

## Example Enhanced Object

```json
{
    "id": "iron-chest-locked",
    "name": "Locked Iron Chest",
    "description": "A heavy iron chest secured with a complex lock.",
    "objectType": "Chest",
    "defaultState": "Locked",
    "allowedInteractions": ["Unlock", "Open", "Close", "Examine", "Search", "Break"],
    "blocksPassage": false,
    "keywords": ["chest", "iron chest", "locked chest"],
    "skillChecks": {
        "Unlock": {
            "skillId": "lockpicking",
            "dc": 15,
            "alternateSkillId": "perception",
            "alternateDc": 20
        },
        "Break": {
            "skillId": "strength",
            "dc": 18
        }
    },
    "stateTransitions": [
        {
            "fromState": "Locked",
            "toState": "Closed",
            "viaInteraction": "Unlock",
            "requiresSkillCheck": true,
            "message": "You hear a click as the lock opens."
        },
        {
            "fromState": "Closed",
            "toState": "Open",
            "viaInteraction": "Open",
            "message": "The chest lid creaks open."
        },
        {
            "fromState": "Open",
            "toState": "Closed",
            "viaInteraction": "Close"
        },
        {
            "fromState": "Locked",
            "toState": "Broken",
            "viaInteraction": "Break",
            "requiresSkillCheck": true,
            "message": "The chest splinters from the blow!"
        }
    ],
    "rewards": {
        "Open": {
            "lootTableId": "treasure-chest-rare",
            "goldRange": { "min": 50, "max": 150 },
            "experienceReward": 25
        },
        "Search": {
            "informationText": "You find a hidden note with a cryptic message..."
        }
    }
}
```

## State Transition System

```
┌───────────────────────────────────────────────────────────────────┐
│  CHEST STATE MACHINE                                              │
│                                                                   │
│    LOCKED ──Unlock──▶ CLOSED ◀──Close──▶ OPEN                    │
│       │                  │                  │                     │
│       │                  │                  │                     │
│       └──────── Break ───┴──────────────────┘                    │
│                    │                                              │
│                    ▼                                              │
│                 BROKEN                                            │
└───────────────────────────────────────────────────────────────────┘
```

## Skill Check System

```
┌───────────────────────────────────────────────────────────────────┐
│  SKILL CHECK CONFIGURATION                                        │
│                                                                   │
│  skillChecks: {                                                   │
│    "Unlock": {                                                    │
│      "skillId": "lockpicking",    // Primary skill                │
│      "dc": 15,                    // Difficulty class             │
│      "alternateSkillId": "perception",  // Secondary option       │
│      "alternateDc": 20            // Higher DC for alternate      │
│    }                                                              │
│  }                                                                │
└───────────────────────────────────────────────────────────────────┘
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Define new object types with custom interactions
- Configure state machines for complex object behaviors
- Set up skill checks with alternate approaches
- Create rewards with loot tables, fixed items, gold, XP
- Design traps with damage, saving throws, and status effects
- Add keywords for natural language parsing

## v0.14.4 Complete

With v0.14.4d complete, the entire v0.14.4 Environment Configuration Schemas series is finished:

| Version | Schema | Status |
|---------|--------|--------|
| v0.14.4a | biomes.schema.json | ✓ Complete |
| v0.14.4b | room-types.schema.json | ✓ Complete |
| v0.14.4c | terrain.schema.json (expansion) | ✓ Complete |
| v0.14.4d | interactive-objects.schema.json | ✓ Complete |

---

*Final entry in v0.14.4 Environment Configuration Schemas series. See also: v0.14.4a (Biome Schema), v0.14.4b (Room Type Schema), v0.14.4c (Terrain Schema Expansion).*
