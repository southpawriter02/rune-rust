# v0.15.3f Changelog - Interrogation System

## Summary

Implements the **Interrogation System** subsystem of the Rhetoric skill. Enables multi-round information extraction mechanics where interrogators attempt to break down a subject's resistance using five methods: GoodCop (empathetic, DC 14, 95% reliability), BadCop (aggressive, DC 12, 80% reliability), Deception (trickery, DC 16, 70% reliability), Bribery (incentives, DC 10, 90% reliability), and Torture (extreme, DC = WILL × 2, 50% reliability). Features WILL-based resistance levels (Minimal to Extreme), reliability tracking that caps at 60% if Torture is used at any point, cumulative disposition/reputation/resource costs, and the `SubjectBroken` fumble type for catastrophic Torture failures.

## Added

### Domain Layer - Enums (3 files)

| File | Description |
|------|-------------|
| `InterrogationMethod.cs` | 5-method enum: GoodCop (empathetic rapport), BadCop (aggressive pressure), Deception (trickery/misdirection), Bribery (material incentives), Torture (extreme physical/psychological coercion) |
| `InterrogationStatus.cs` | 5-status enum: NotStarted, InProgress, SubjectBroken (success), SubjectResisting (failure), Abandoned |
| `SubjectResistance.cs` | 5-tier enum: Minimal (1-2 checks), Low (3-4 checks), Moderate (5-6 checks), High (7-8 checks), Extreme (9-10 checks) |

### Domain Layer - Extensions (3 files)

| File | Description |
|------|-------------|
| `InterrogationMethodExtensions.cs` | `GetBaseDc()`, `GetReliabilityPercent()`, `GetDispositionChange()`, `GetReputationCost()`, `GetRoundDurationMinutes()`, `RequiresResources()`, `UsesAttribute()`, `GetAttribute()`, `CanUseAlternateAttribute()`, `GetDisplayName()`, `GetDescription()`, `GetExampleActions()`, `GetWarnings()` |
| `InterrogationStatusExtensions.cs` | `IsTerminal()`, `IsSuccess()`, `IsFailure()`, `GetDisplayName()`, `GetDescription()`, `GetStatusIndicator()`, `GetNextValidStatuses()`, `CanTransitionTo()` |
| `SubjectResistanceExtensions.cs` | `GetBaseResistance()`, `GetResistanceRange()`, `GetMaxRounds()`, `GetBaseBriberyCost()`, `GetDisplayName()`, `GetDescription()`, `GetDifficultyAssessment()`, `FromWillAttribute()` |

### Domain Layer - Value Objects (4 files)

| File | Description |
|------|-------------|
| `InformationGained.cs` | Tracks extracted information: InformationId, Description, Reliability, Category, IsVerified, ExtractedRound, MethodUsed. Methods: `GetSummary()`, `GetReliabilityAssessment()`. Factory methods: `Create()`, `CreateWithCategory()` |
| `InterrogationRound.cs` | Records single round outcome: RoundNumber, MethodUsed, DcUsed, RollResult, Outcome, ResistanceChange, DispositionChange, ResourceCost, TimeElapsedMinutes, NarrativeDescription, IsFumble. Methods: `GetOutcomeSummary()`, `ToShortDisplay()`. Factory methods: `Success()`, `Failure()`, `Fumble()` |
| `InterrogationContext.cs` | Contains all context for a round: BaseContext, InterrogationState, SelectedMethod, InterrogatorAttribute, InterrogatorRhetoric, SubjectWits, AvailableGold, BonusDice, DcModifier, UseMight. Methods: `CalculateEffectiveDc()`, `CalculateDicePool()`, `CanAffordBribery()`, `ToModifierBreakdown()`. Factory method: `CreateMinimal()` |
| `InterrogationResult.cs` | Complete interrogation outcome: Outcome, FinalStatus, RoundsUsed, TotalTimeMinutes, PrimaryMethod, InformationReliability, InformationGained, TotalDispositionChange, TotalReputationCost, TotalResourceCost, TortureWasUsed, SubjectTraumatized, History, NarrativeSummary. Computed properties: `IsSuccess`, `IsFailure`, `SubjectBroken`, `HasInformation`, `HasSignificantCosts`. Methods: `GetDisplaySummary()`, `ToShortDisplay()`. Factory methods: `Success()`, `Failure()` |

### Domain Layer - Entities (1 file)

| File | Description |
|------|-------------|
| `InterrogationState.cs` | Tracks complete interrogation session: InterrogationId, InterrogatorId, SubjectId, SubjectWill, ResistanceRemaining, InitialResistance, ResistanceLevel, RoundNumber, Status, TotalDispositionChange, TotalReputationCost, TotalResourceCost, TortureUsed, MethodsUsed, History, InformationGained. Methods: `Initialize()`, `RecordRound()`, `AddInformation()`, `Abandon()`, `MarkSubjectResisting()`, `MarkSubjectBrokenBeyondRecovery()`, `GetPrimaryMethod()`, `CalculateReliability()`, `GetStateSummary()`, `ToProgressDisplay()`, `CanBreakSubject()` |

### Application Layer (2 files)

| File | Description |
|------|-------------|
| `IInterrogationService.cs` | Interface: `InitializeInterrogation`, `AssessResistance`, `ConductRound`, `CalculateBriberyCost`, `CalculateTortureDc`, `ExtractInformation`, `CompleteInterrogation`, `AbandonInterrogation`, `GetAvailableMethods`, `BuildContext`, `HandleSubjectBrokenFumbleAsync`, `GetActiveInterrogation`, `GetSessionSummary` |
| `InterrogationService.cs` | Full implementation with comprehensive logging, in-memory active interrogation tracking, dice pool simulation (successes on 8+, botches on 1), method-specific handling, reliability calculation with Torture cap, narrative generation for success/failure/fumble outcomes |

### Domain Layer - Modified (1 file)

| File | Change |
|------|--------|
| `FumbleType.cs` | Added `SubjectBroken = 10` enum value with documentation. Updated extension methods: `BlocksAllTargets()`, `IsInstant()`, `GetAssociatedSkillId()`, `GetDisplayName()`, `GetDescription()`, `TriggersCombat()`, `IsPermanent()` |

### Configuration (1 file)

| File | Description |
|------|-------------|
| `config/social/interrogation-config.json` | Method definitions (DC, reliability, disposition, reputation costs, duration), resistance level tiers (base resistance, max rounds, bribery costs), modifier tables, Torture consequences (reputation -30, reliability cap 60%, trauma inflicted), fumble consequences, narrative templates |

### Unit Tests (1 test file, 40+ tests)

| File | Tests |
|------|-------|
| `InterrogationSystemTests.cs` | Subject WILL sets resistance correctly, InterrogationMethod DC/reliability/disposition/reputation mapping, InterrogationStatus terminal states, InterrogationState entity behavior, InterrogationRound factory methods, InterrogationContext DC/dice pool calculation, InterrogationResult factory methods, InformationGained reliability assessment, FumbleType.SubjectBroken properties |

## Key Features

### Interrogation Methods

| Method | Base DC | Reliability | Disposition | Duration | Attribute | Notes |
|--------|:-------:|:-----------:|:-----------:|:--------:|:---------:|-------|
| GoodCop | 14 | 95% | 0 | 30 min | WILL | Build rapport, highest reliability |
| BadCop | 12 | 80% | -5 | 20 min | WILL/MIGHT | Aggressive, moderate damage |
| Deception | 16 | 70% | -10 | 25 min | WITS | Opposed by Subject WITS |
| Bribery | 10 | 90% | 0 | 15 min | WILL | Requires gold, easiest DC |
| Torture | WILL × 2 | 50% | -20 | 60 min | WILL/MIGHT | Severe consequences |

### Subject Resistance Levels (Based on WILL)

| WILL | Resistance | Base Checks | Max Rounds | Bribery Cost | Difficulty |
|:----:|------------|:-----------:|:----------:|:------------:|------------|
| 1-2 | Minimal | 1-2 | 3 | 50 gold | Easy |
| 3-4 | Low | 3-4 | 6 | 100 gold | Moderate |
| 5-6 | Moderate | 5-6 | 10 | 200 gold | Challenging |
| 7-8 | High | 7-8 | 15 | 400 gold | Difficult |
| 9-10 | Extreme | 9-10 | 20 | 800 gold | Extremely Difficult |

### Dice Pool Calculation

| Method | Formula |
|--------|---------|
| GoodCop | WILL + Rhetoric + Bonus |
| BadCop | WILL (or MIGHT) + Rhetoric + Bonus |
| Deception | WITS + Rhetoric + Bonus |
| Bribery | WILL + Rhetoric + Bonus |
| Torture | WILL (or MIGHT) only (no Rhetoric) |

### Information Reliability

| Scenario | Reliability |
|----------|:-----------:|
| GoodCop primary, no Torture | 95% |
| Bribery primary, no Torture | 90% |
| BadCop primary, no Torture | 80% |
| Deception primary, no Torture | 70% |
| Torture primary | 50% |
| **Any method with Torture used at ANY point** | **≤60% (capped)** |

### Torture Consequences

| Consequence | Effect |
|-------------|--------|
| Reputation Cost | -30 per session (permanent) |
| Information Reliability | Capped at 50% (or 60% if other methods also used) |
| Subject Traumatized | Permanent [Traumatized] condition |
| Fumble: Subject Broken | Subject dies/catatonic, -20 additional reputation, no information extracted |

### SubjectBroken Fumble Consequences

- **Trigger:** Fumble during Torture method
- **Subject permanently incapacitated** - dead, insane, or catatonic
- **-20 additional reputation cost** (on top of -30 base Torture cost)
- **No information can be extracted** - interrogation fails completely
- **Narrative:** "You pushed too far. The subject has been broken beyond recovery - dead, catatonic, or driven insane. No information can be extracted, and your reputation suffers for this atrocity."

## Files Changed

| File | Change |
|------|--------|
| `src/Core/RuneAndRust.Domain/Enums/InterrogationMethod.cs` | Added |
| `src/Core/RuneAndRust.Domain/Enums/InterrogationStatus.cs` | Added |
| `src/Core/RuneAndRust.Domain/Enums/SubjectResistance.cs` | Added |
| `src/Core/RuneAndRust.Domain/Enums/FumbleType.cs` | Modified (added SubjectBroken = 10) |
| `src/Core/RuneAndRust.Domain/Extensions/InterrogationMethodExtensions.cs` | Added |
| `src/Core/RuneAndRust.Domain/Extensions/InterrogationStatusExtensions.cs` | Added |
| `src/Core/RuneAndRust.Domain/Extensions/SubjectResistanceExtensions.cs` | Added |
| `src/Core/RuneAndRust.Domain/ValueObjects/InformationGained.cs` | Added |
| `src/Core/RuneAndRust.Domain/ValueObjects/InterrogationRound.cs` | Added |
| `src/Core/RuneAndRust.Domain/ValueObjects/InterrogationContext.cs` | Added |
| `src/Core/RuneAndRust.Domain/ValueObjects/InterrogationResult.cs` | Added |
| `src/Core/RuneAndRust.Domain/Entities/InterrogationState.cs` | Added |
| `src/Core/RuneAndRust.Application/Interfaces/IInterrogationService.cs` | Added |
| `src/Core/RuneAndRust.Application/Services/InterrogationService.cs` | Added |
| `config/social/interrogation-config.json` | Added |
| `tests/RuneAndRust.Domain.UnitTests/Services/InterrogationSystemTests.cs` | Added |
| `changelogs/v0.15.3f-changelog.md` | Added |

## Test Results

```
Total tests: 40+
     Passed: TBD (run `dotnet test` to verify)
Build succeeded with 0 errors
```

## Dependencies

- **v0.15.3e:** `NegotiationService` patterns for multi-round mechanics
- **v0.15.3d:** `IntimidationContext`, `IntimidationResult`, `CostOfFear` (BadCop delegation)
- **v0.15.3c:** `DeceptionContext`, `DeceptionResult`, `LiarsBurden` (Deception delegation)
- **v0.15.3b:** `PersuasionContext`, `PersuasionResult` (GoodCop delegation)
- **v0.15.3a:** `NpcDisposition`, `DispositionLevel`, `SocialContext`, `SocialContextBuilder`
- **v0.15.1b:** `FumbleType`, `FumbleConsequence`, `SkillOutcome`
- **v0.15.0:** `DiceRollResult`, `IDiceRollerService`

## Integration Points

### Previous Subsystems (v0.15.3a-e)
- Interrogation methods delegate to specialized services:
  - **GoodCop** → PersuasionService (empathetic approach)
  - **BadCop** → IntimidationService (incurs Cost of Fear reputation)
  - **Deception** → DeceptionService (incurs Liar's Burden stress, opposed by WITS)

### v0.15.3g (Cultural Protocol System)
- Cultural factors affect interrogation effectiveness
- Some cultures may have different attitudes toward interrogation methods

### v0.15.3h (Extended Influence)
- Long-term effects of interrogation on NPC relationships
- Traumatized subjects have permanently altered dispositions

### v0.15.3i (Specialization Abilities)
- Kupmaðr specialization bonuses to interrogation
- Enhanced information extraction abilities

## Notes

- Resistance is determined by Subject WILL using `SubjectResistanceExtensions.FromWillAttribute()`
- Each successful check reduces resistance by 1; subject breaks when resistance reaches 0
- Torture DC calculation is `WILL × 2` (not a fixed DC like other methods)
- Deception DC is `16 + Subject WITS` (opposed check)
- Torture reliability cap (60%) applies if Torture was used at ANY point, even if not the primary method
- Service uses in-memory tracking for active interrogations; production requires persistence
- Max rounds by resistance level: Minimal (3), Low (6), Moderate (10), High (15), Extreme (20)
- `FumbleType.SubjectBroken` is instant effect, permanent consequence, single-target only
- All disposition changes are cumulative across rounds
- Bribery cost is based on resistance level, not a flat amount
