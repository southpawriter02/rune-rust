# v0.0.4c Changelog: Ability System

**Release Date:** 2026-01-06
**Version:** 0.0.4c

## Overview

Implements data-driven abilities with resource costs, cooldowns, and various effect types. Each class has 3 unique abilities unlocked at different levels.

---

## Features

### Abilities Per Class (15 Total)

| Class | Ability | Cost | Cooldown | Target | Effect |
|-------|---------|------|----------|--------|--------|
| **Shieldmaiden** | Shield Bash | 15 Rage | 2 | Enemy | Damage + stun chance |
| | Taunt | 10 Rage | 3 | Enemy | Force target |
| | Fortify | 20 Rage | 5 | Self | +5 Defense (3 turns) |
| **Shadow-Walker** | Backstab | 25 Energy | 3 | Enemy | High damage |
| | Shadowstep | 15 Energy | 2 | Enemy | Position buff |
| | Poison Blade | 20 Energy | 4 | Enemy | Damage + poison DoT |
| **Galdr-Caster** | Flame Bolt | 15 Mana | 0 | Enemy | Fire damage |
| | Frost Nova | 25 Mana | 4 | All Enemies | AoE + slow |
| | Arcane Shield | 20 Mana | 5 | Self | Absorb shield |
| **Blood-Priest** | Healing Word | 20 Faith | 2 | Self | Restore HP |
| | Smite | 15 Faith | 1 | Enemy | Holy damage |
| | Sanctuary | 30 Faith | 6 | Self | 50% damage reduction |
| **Scrap-Tinker** | Deploy Turret | 25 Focus | 5 | None | Summon turret |
| | Repair Kit | 15 Focus | 3 | Self | Heal over time |
| | Smoke Bomb | 20 Focus | 4 | All Enemies | Blind/escape |

### Effect Types
- **Damage** - Direct damage with optional stat scaling
- **Heal** - Restore health with optional stat scaling
- **DamageOverTime** - Poison, burn, bleed over multiple turns
- **HealOverTime** - Regeneration effects
- **Buff** - Positive stat modifiers (defense, damage, etc.)
- **Debuff** - Negative effects on enemies (slow, blind)
- **Shield** - Absorb damage barrier
- **Stun** - Prevent action with chance-based application
- **Taunt** - Force enemy to target you
- **Summon** - Create temporary entities (turrets)

### Mechanics
- **Resource Costs** - Each ability costs a specific resource type
- **Cooldowns** - Turn-based cooldown after use (0 = no cooldown)
- **Target Types** - Self, SingleEnemy, AllEnemies, None
- **Stat Scaling** - Damage/heal can scale with attack or will stats
- **Unlock Levels** - Abilities unlock at class levels 1, 2, or 3

---

## Technical Changes

### Domain Layer (4 new files, 1 modified)
| File | Type |
|------|------|
| `AbilityDefinition.cs` | NEW - Data model loaded from JSON |
| `AbilityCost.cs` | NEW - Resource type + amount value object |
| `AbilityEffect.cs` | NEW - Effect definition value object |
| `PlayerAbility.cs` | NEW - Player's ability instance with cooldown |
| `Player.cs` | MODIFY - Abilities dictionary, AddAbility(), GetAbility() |

### Application Layer (2 new, 2 modified)
| File | Type |
|------|------|
| `AbilityService.cs` | NEW - Ability management and usage |
| `AbilityDtos.cs` | NEW - DTOs for ability data transfer |
| `IGameConfigurationProvider.cs` | MODIFY - GetAbilities(), GetAbilityById() |
| `GameSessionService.cs` | MODIFY - GetPlayerAbilities(), TryUseAbility() |

### Infrastructure Layer (2 new, 1 modified)
| File | Type |
|------|------|
| `config/abilities.json` | NEW - 15 ability definitions |
| `config/abilities.schema.json` | NEW - JSON schema for validation |
| `JsonConfigurationProvider.cs` | MODIFY - Load and parse abilities |

### Presentation Layer (3 modified)
| File | Type |
|------|------|
| `IGameRenderer.cs` | MODIFY - RenderAbilitiesAsync() |
| `SpectreGameRenderer.cs` | MODIFY - Abilities table display |
| `GameView.cs` | MODIFY - HandleAbilitiesAsync(), HandleUseAbilityAsync() |
| `ConsoleInputHandler.cs` | MODIFY - Parse "abilities", "cast", "spells" commands |

---

## New DTOs

```csharp
public record PlayerAbilityDto(
    string AbilityId, string Name, string Description,
    int CurrentCooldown, int MaxCooldown,
    string CostResource, int CostAmount,
    string TargetType, bool IsUnlocked, bool IsReady,
    IReadOnlyList<string> Tags);

public record AbilityDefinitionDto(
    string Id, string Name, string Description,
    IReadOnlyList<string> ClassIds, int CostAmount,
    string CostResource, int Cooldown, string TargetType,
    int UnlockLevel, IReadOnlyList<string> Tags,
    IReadOnlyList<AbilityEffectDto> Effects);

public record AbilityEffectDto(
    string Type, int Value, int Duration,
    string? ScalingStat, float? ScalingMultiplier,
    string? StatusEffect, float? Chance,
    string? Description);

public record AbilityUseResult(
    bool Success, string Message,
    int? DamageDealt, int? HealingDone,
    bool TargetDefeated);
```

---

## Testing

### New Test Files
| Test File | Count |
|-----------|-------|
| `AbilityDefinitionTests.cs` | 8 |
| `PlayerAbilityTests.cs` | 6 |
| `AbilityCostTests.cs` | 4 |
| `AbilityEffectTests.cs` | 6 |
| `PlayerAbilityMethodsTests.cs` | 4 |
| `AbilityServiceTests.cs` | 12 |
| **v0.0.4c Total** | **40** |

### Test Coverage
- AbilityDefinition creation and validation
- AbilityCost resource type and amount validation
- AbilityEffect type creation (Damage, Heal, Buff, etc.)
- PlayerAbility cooldown tracking and reset
- AbilityService ability lookup, usage, and cost checking

### Test Summary at v0.0.4c
| Suite | Count | Status |
|-------|-------|--------|
| Domain | 118 | Pass |
| Application | 56 | Pass |
| Architecture | 8 | Pass |
| **Total** | **182** | **Pass** |

---

## Commands

| Command | Aliases | Description |
|---------|---------|-------------|
| `abilities` | `ab`, `spells`, `skills` | Show available abilities |
| `cast <ability>` | `ability <ability>`, `use <ability>` | Use an ability |

---

## Configuration Example

```json
{
  "id": "flame-bolt",
  "name": "Flame Bolt",
  "description": "Hurl a bolt of fire at your enemy.",
  "classIds": ["galdr-caster"],
  "costResource": "mana",
  "costAmount": 15,
  "cooldown": 0,
  "targetType": "SingleEnemy",
  "unlockLevel": 1,
  "tags": ["damage", "ranged", "fire", "magic"],
  "effects": [
    {
      "type": "Damage",
      "value": 20,
      "scalingStat": "will",
      "scalingMultiplier": 0.6
    }
  ]
}
```
