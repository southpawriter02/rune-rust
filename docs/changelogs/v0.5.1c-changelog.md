# v0.5.1c Changelog: Line of Sight

**Version:** 0.5.1c  
**Phase:** Line of Sight  
**Date:** 2026-01-14  
**Status:** ✅ Complete

---

## Summary

Implements line of sight calculations using Bresenham's algorithm. Walls block ranged attacks, adjacent cells always have LOS, melee/reach attacks bypass LOS checks.

---

## Added

### Domain Layer - GridCell

| Property | Description |
|----------|-------------|
| `BlocksLOS` | Explicit LOS blocking flag |
| `EffectivelyBlocksLOS` | BlocksLOS OR !IsPassable |
| `SetBlocksLOS()` | Set blocking state |

### Application Layer - ILineOfSightService

| Method | Description |
|--------|-------------|
| `HasLineOfSight(entityId, entityId)` | Entity-to-entity LOS check |
| `HasLineOfSight(pos, pos)` | Position-to-position LOS check |
| `GetLineCells()` | Bresenham's algorithm path |
| `GetFirstBlockingCell()` | Find blocking obstacle |
| `GetVisiblePositions()` | All visible cells in range |

### Application Layer - RangeService Integration

- `ILineOfSightService` optional dependency
- Ranged attacks now check LOS
- `RangeCheckResult.BlockedBy` property

---

## LOS Rules

| Cell Type | Blocks LOS? |
|-----------|-------------|
| Empty cell | No |
| Occupied by entity | No |
| Wall (!IsPassable) | Yes |
| Pillar (BlocksLOS) | Yes |
| Start/End positions | Skipped |

---

## Test Results

| Category | Tests |
|----------|-------|
| Domain (GridCell) | 6 new |
| LineOfSightService | 14 new |
| RangeService LOS | 4 new |
| **Total new** | **24** |

---

## Next Steps

- **v0.5.2** — Cover System
