# v0.18.3a Design Specification: Trauma Enums & Definitions

**Version:** 0.18.3a
**Parent:** v0.18.3 (Trauma System)
**Prerequisites:** v0.18.0 (Psychic Stress System), v0.6.x (Dice System)
**Status:** Design Complete
**Estimated Unit Tests:** ~4

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [TraumaType Enum](#5-traumatype-enum)
6. [TraumaDefinition Entity](#6-traumadefinition-entity)
7. [TraumaEffect Value Object](#7-traumaeffect-value-object)
8. [TraumaTrigger Value Object](#8-traumatrigger-value-object)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Deliverable Checklist](#11-deliverable-checklist)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Dependencies](#13-dependencies)
14. [Future Considerations](#14-future-considerations)

---

## 1. Executive Summary

This design specification defines the foundational enums, entities, and value objects for the **Trauma System** — the permanent psychological and physical consequences that represent irreversible character changes.

v0.18.3a establishes the **Domain Layer Foundation** for Trauma by defining:

- `TraumaType` enum — 6 trauma categories
- `TraumaDefinition` entity — data-driven trauma catalog
- `TraumaEffect` value object — mechanical consequences
- `TraumaTrigger` value object — acquisition conditions

### Key Deliverables

| Category          | Items                     |
| ----------------- | ------------------------- |
| **Domain Enums**  | `TraumaType`              |
| **Domain Entities** | `TraumaDefinition`       |
| **Value Objects** | `TraumaEffect`, `TraumaTrigger` |
| **Tests**         | ~4 unit tests             |

### Trauma Categories Overview

| Type        | Focus                    | Examples                |
| ----------- | ------------------------ | ----------------------- |
| Cognitive   | Mental processing issues | Combat Flashbacks, Paranoia |
| Emotional   | Affective regulation     | Survivor's Guilt, Night Terrors |
| Physical    | Somatic manifestations   | Chronic Pain            |
| Social      | Interpersonal difficulty | Touch Aversion          |
| Existential | Reality/identity crisis  | Reality Doubt           |
| Corruption  | Blight-related traumas   | Machine Affinity, Hollow Resonance |

---

## 2. Feature Overview

```
v0.18.3a Features
└── Trauma Foundation (Domain Layer)
    │
    ├── TraumaType Enum
    │   ├── Cognitive
    │   ├── Emotional
    │   ├── Physical
    │   ├── Social
    │   ├── Existential
    │   └── Corruption
    │
    ├── TraumaDefinition Entity
    │   ├── Id: Guid
    │   ├── TraumaId: string
    │   ├── Name: string
    │   ├── Type: TraumaType
    │   ├── Description: string
    │   ├── FlavorText: string
    │   ├── Triggers: IReadOnlyList<TraumaTrigger>
    │   ├── Effects: IReadOnlyList<TraumaEffect>
    │   ├── IsRetirementTrauma: bool
    │   ├── RetirementCondition: string?
    │   ├── AcquisitionSources: IReadOnlyList<string>
    │   └── IsStackable: bool
    │
    ├── TraumaEffect Value Object
    │   ├── EffectType: string
    │   ├── Target: string
    │   ├── Value: int?
    │   ├── Condition: string?
    │   └── Description: string
    │
    └── TraumaTrigger Value Object
        ├── TriggerType: string
        ├── Condition: string?
        ├── CheckRequired: bool
        └── CheckDifficulty: int?
```

---

## 3. Architecture Diagrams

### 3.1 Domain Layer Structure

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          DOMAIN LAYER                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                      TraumaType ENUM                            │    │
│  ├──────────────────────────────────────────────────────────────────┤    │
│  │ Cognitive    = 0 — Mental processing disorders                 │    │
│  │ Emotional    = 1 — Affective regulation issues                 │    │
│  │ Physical     = 2 — Somatic manifestations                      │    │
│  │ Social       = 3 — Interpersonal difficulties                  │    │
│  │ Existential  = 4 — Reality/identity crises                     │    │
│  │ Corruption   = 5 — Blight-related traumas                      │    │
│  └──────────────────────────────────────────────────────────────────┤    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │              TraumaDefinition (Entity/Aggregate)                │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │  Properties:                                                     │    │
│  │  + Id: Guid                                                      │    │
│  │  + TraumaId: string (e.g., "survivors-guilt")                   │    │
│  │  + Name: string                                                  │    │
│  │  + Type: TraumaType                                              │    │
│  │  + Description: string                                           │    │
│  │  + FlavorText: string                                            │    │
│  │  + Triggers: IReadOnlyList<TraumaTrigger>                       │    │
│  │  + Effects: IReadOnlyList<TraumaEffect>                         │    │
│  │  + IsRetirementTrauma: bool                                      │    │
│  │  + RetirementCondition: string?                                 │    │
│  │  + AcquisitionSources: IReadOnlyList<string>                    │    │
│  │  + IsStackable: bool                                             │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │           TraumaEffect (Value Object)                            │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │ + EffectType: string                                             │    │
│  │ + Target: string                                                 │    │
│  │ + Value: int?                                                    │    │
│  │ + Condition: string?                                             │    │
│  │ + Description: string                                            │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │           TraumaTrigger (Value Object)                           │    │
│  ├─────────────────────────────────────────────────────────────────┤    │
│  │ + TriggerType: string                                            │    │
│  │ + Condition: string?                                             │    │
│  │ + CheckRequired: bool                                            │    │
│  │ + CheckDifficulty: int?                                          │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 TraumaType Categorization Decision Tree

```
             ┌────────────────────────────────┐
             │   Trauma Event or Condition    │
             └────────────┬───────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
    ┌────────┐      ┌─────────┐      ┌──────────┐
    │ Mental │      │Emotional│      │ Physical │
    │ Issues │      │ Distress│      │  Damage  │
    └────┬───┘      └────┬────┘      └────┬─────┘
         │               │                │
         ▼               ▼                ▼
    Cognitive        Emotional        Physical

        ┌─────────────────┬─────────────────┐
        │                 │                 │
        ▼                 ▼                 ▼
    ┌────────┐      ┌──────────┐      ┌──────────────┐
    │ Social │      │Existential│     │ Corruption   │
    │Damage  │      │  Crisis   │     │ (Blight)     │
    └────────┘      └───────────┘     └──────────────┘
        │                 │                 │
        ▼                 ▼                 ▼
    Social          Existential        Corruption
```

### 3.3 TraumaDefinition Dependency Flow

```
┌────────────────────────────────────────────────────────────────┐
│         TraumaDefinition Load & Validation Flow                │
└───────────────────────────┬──────────────────────────────────┘
                            │
                            ▼
            ┌───────────────────────────────┐
            │   JSON Configuration Load     │
            │   (from traumas.json)         │
            └────────────┬──────────────────┘
                         │
                         ▼
            ┌───────────────────────────────┐
            │  Parse TraumaType Enum        │
            └────────────┬──────────────────┘
                         │
                         ▼
            ┌───────────────────────────────┐
            │  Create TraumaEffect Objects  │
            │  (from effects array)         │
            └────────────┬──────────────────┘
                         │
                         ▼
            ┌───────────────────────────────┐
            │  Create TraumaTrigger Objects │
            │  (from triggers array)        │
            └────────────┬──────────────────┘
                         │
                         ▼
            ┌───────────────────────────────┐
            │  Instantiate TraumaDefinition │
            └────────────┬──────────────────┘
                         │
                         ▼
            ┌───────────────────────────────┐
            │  Validate Retirement Condition│
            └────────────┬──────────────────┘
                         │
                         ▼
            ┌───────────────────────────────┐
            │  Add to TraumaDefinition Cache│
            │  (keyed by TraumaId)          │
            └────────────────────────────────┘
```

---

## 4. User Stories

### US-18.3a-1: Define Trauma Categories

**As a** game designer
**I want to** categorize traumas into 6 psychological/physical types
**So that** trauma effects and mechanics can be tailored by category

**Acceptance Criteria:**

- TraumaType enum contains exactly 6 values
- Each type has clear narrative meaning
- Corruption type exists for blight-related effects

### US-18.3a-2: Create Data-Driven Trauma Definitions

**As a** content developer
**I want to** define traumas in JSON configuration files
**So that** new traumas can be added without code changes

**Acceptance Criteria:**

- TraumaDefinition loads from JSON files
- TraumaId uniquely identifies each trauma
- Retirement triggers are configurable
- Stackability is configurable per trauma

### US-18.3a-3: Model Trauma Mechanical Effects

**As a** mechanics designer
**I want to** specify what mechanical effects a trauma causes
**So that** trauma mechanics are data-driven and flexible

**Acceptance Criteria:**

- TraumaEffect describes mechanical consequences
- Multiple effect types (SkillPenalty, Disadvantage, StressIncrease)
- Effects can have conditions

### US-18.3a-4: Model Trauma Acquisition Triggers

**As a** event system developer
**I want to** specify conditions that trigger trauma acquisition
**So that** traumas only activate under appropriate circumstances

**Acceptance Criteria:**

- TraumaTrigger specifies trigger type
- Check requirements are optional
- Check difficulty is configurable

---

## 5. TraumaType Enum

### 5.1 Purpose

Defines the six trauma categories, representing different aspects of psychological and physical harm.

### 5.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/TraumaType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the six categories of permanent trauma.
/// </summary>
/// <remarks>
/// <para>
/// Traumas are permanent consequences representing irreversible character changes.
/// Each type represents a different aspect of psychological or physical harm.
/// </para>
/// <para>
/// Trauma Categories:
/// <list type="bullet">
/// <item>Cognitive: Mental processing disorders (flashbacks, paranoia)</item>
/// <item>Emotional: Affective regulation issues (guilt, terror)</item>
/// <item>Physical: Somatic manifestations (pain, injury)</item>
/// <item>Social: Interpersonal difficulties (touch aversion, isolation)</item>
/// <item>Existential: Reality/identity crises (doubt, dissociation)</item>
/// <item>Corruption: Blight-related traumas (machine affinity, corruption)</item>
/// </list>
/// </para>
/// </remarks>
public enum TraumaType
{
    /// <summary>
    /// Mental processing disorders and cognitive dysfunction.
    /// </summary>
    /// <remarks>
    /// Examples: Combat Flashbacks, Paranoid Ideation
    /// Manifestation: Intrusive thoughts, perception distortion, memory issues
    /// </remarks>
    Cognitive = 0,

    /// <summary>
    /// Affective regulation and emotional control issues.
    /// </summary>
    /// <remarks>
    /// Examples: Survivor's Guilt, Night Terrors
    /// Manifestation: Inappropriate emotional responses, mood instability
    /// </remarks>
    Emotional = 1,

    /// <summary>
    /// Somatic manifestations and physical dysfunction.
    /// </summary>
    /// <remarks>
    /// Examples: Chronic Pain, Tremors
    /// Manifestation: Persistent pain, reduced physical capability, fatigue
    /// </remarks>
    Physical = 2,

    /// <summary>
    /// Interpersonal difficulties and social dysfunction.
    /// </summary>
    /// <remarks>
    /// Examples: Touch Aversion, Social Withdrawal
    /// Manifestation: Difficulty with relationships, avoidance behaviors
    /// </remarks>
    Social = 3,

    /// <summary>
    /// Reality/identity crises and existential issues.
    /// </summary>
    /// <remarks>
    /// Examples: Reality Doubt, Dissociation
    /// Manifestation: Questioning reality, identity fragmentation
    /// </remarks>
    Existential = 4,

    /// <summary>
    /// Blight-related traumas from corruption exposure.
    /// </summary>
    /// <remarks>
    /// Examples: Machine Affinity, Hollow Resonance
    /// Manifestation: Affinity for infected entities, reality warping
    /// Terminal traumas that often force retirement
    /// </remarks>
    Corruption = 5
}
```

---

## 6. TraumaDefinition Entity

### 6.1 Purpose

Data-driven entity representing a specific trauma type with all its mechanical properties, effects, and acquisition conditions.

### 6.2 Definition

**File:** `src/Core/RuneAndRust.Domain/Entities/TraumaDefinition.cs`

```csharp
namespace RuneAndRust.Domain.Entities;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a specific trauma definition with all mechanical properties.
/// </summary>
/// <remarks>
/// <para>
/// TraumaDefinition is loaded from JSON configuration (traumas.json) and provides
/// the blueprint for creating character traumas. Each trauma is uniquely identified
/// by TraumaId and contains all mechanical rules and effects.
/// </para>
/// <para>
/// Traumas are permanent once acquired and can optionally force character retirement
/// if severe enough. Some traumas stack (acquiring them multiple times) while others
/// are singularities (acquired once, StackCount tracks intensity).
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var trauma = TraumaDefinition.Create(
///     traumaId: "survivors-guilt",
///     name: "Survivor's Guilt",
///     type: TraumaType.Emotional,
///     description: "You carry the weight of those who didn't make it.",
///     flavorText: "Why them? Why not me?",
///     isRetirementTrauma: true,
///     retirementCondition: "On acquisition",
///     isStackable: false,
///     acquisitionSources: new[] { "AllyDeath", "PartyWipe" },
///     triggers: new[] { /* triggers */ },
///     effects: new[] { /* effects */ }
/// );
/// </code>
/// </example>
public class TraumaDefinition
{
    /// <summary>
    /// Gets the unique identifier for this TraumaDefinition.
    /// </summary>
    public Guid Id { get; private init; }

    /// <summary>
    /// Gets the string identifier for this trauma (e.g., "survivors-guilt").
    /// </summary>
    /// <remarks>
    /// Used as the key for JSON configuration and database lookups.
    /// Must be unique across all trauma definitions.
    /// </remarks>
    public string TraumaId { get; private init; }

    /// <summary>
    /// Gets the display name of this trauma.
    /// </summary>
    /// <remarks>
    /// Human-readable name shown to players. May include narrative elements
    /// (e.g., "[MACHINE AFFINITY]" for corrupted traumas).
    /// </remarks>
    public string Name { get; private init; }

    /// <summary>
    /// Gets the type category of this trauma.
    /// </summary>
    /// <remarks>
    /// Determines which trauma check categories can result in this trauma.
    /// Affects mechanics and narrative presentation.
    /// </remarks>
    public TraumaType Type { get; private init; }

    /// <summary>
    /// Gets the mechanical description of this trauma's effects.
    /// </summary>
    /// <remarks>
    /// Clear, factual description of what this trauma does mechanically.
    /// Used for UI tooltips and help text.
    /// </remarks>
    public string Description { get; private init; }

    /// <summary>
    /// Gets the narrative flavor text for this trauma.
    /// </summary>
    /// <remarks>
    /// In-character description showing the subjective experience of this trauma.
    /// Often poetic or disturbing to emphasize psychological impact.
    /// </remarks>
    public string FlavorText { get; private init; }

    /// <summary>
    /// Gets the set of triggers that activate this trauma's effects.
    /// </summary>
    /// <remarks>
    /// Empty list if trauma has no special activation triggers.
    /// Used by event systems to determine when to apply effects.
    /// </remarks>
    public IReadOnlyList<TraumaTrigger> Triggers { get; private init; }

    /// <summary>
    /// Gets the mechanical effects this trauma applies.
    /// </summary>
    /// <remarks>
    /// List of effects that activate immediately upon acquisition.
    /// Can include skill penalties, disadvantages, stress increases, etc.
    /// </remarks>
    public IReadOnlyList<TraumaEffect> Effects { get; private init; }

    /// <summary>
    /// Gets whether this trauma forces character retirement if acquired.
    /// </summary>
    /// <remarks>
    /// Terminal traumas (corruption-related, severe psychological breaks)
    /// trigger mandatory or conditional retirement checks.
    /// </remarks>
    public bool IsRetirementTrauma { get; private init; }

    /// <summary>
    /// Gets the condition under which this trauma triggers retirement.
    /// </summary>
    /// <remarks>
    /// Examples:
    /// - "On acquisition" (immediate retirement check)
    /// - "5+ instances" (after 5 stack counts)
    /// - "With 3+ other moderate traumas" (accumulation condition)
    /// Null if IsRetirementTrauma is false.
    /// </remarks>
    public string? RetirementCondition { get; private init; }

    /// <summary>
    /// Gets the list of acquisition sources/triggers for this trauma.
    /// </summary>
    /// <remarks>
    /// Examples: "AllyDeath", "CorruptionThreshold75", "ForlornContact"
    /// Used by trauma check system to determine which traumas can result.
    /// </remarks>
    public IReadOnlyList<string> AcquisitionSources { get; private init; }

    /// <summary>
    /// Gets whether this trauma can be acquired multiple times.
    /// </summary>
    /// <remarks>
    /// Stackable: Can have StackCount > 1 (e.g., Reality Doubt can occur 5+ times)
    /// Non-stackable: Acquired once, but StackCount may track event intensity
    /// </remarks>
    public bool IsStackable { get; private init; }

    // Private constructor for EF Core
    private TraumaDefinition() { }

    /// <summary>
    /// Creates a new TraumaDefinition with the specified properties.
    /// </summary>
    /// <param name="traumaId">String identifier (e.g., "survivors-guilt")</param>
    /// <param name="name">Display name</param>
    /// <param name="type">Trauma category</param>
    /// <param name="description">Mechanical description</param>
    /// <param name="flavorText">Narrative flavor text</param>
    /// <param name="isRetirementTrauma">Whether this trauma forces retirement</param>
    /// <param name="retirementCondition">Retirement condition description</param>
    /// <param name="isStackable">Whether this trauma can stack</param>
    /// <param name="acquisitionSources">List of acquisition trigger types</param>
    /// <param name="triggers">List of TraumaTriggers</param>
    /// <param name="effects">List of TraumaEffects</param>
    /// <returns>A new TraumaDefinition instance</returns>
    /// <exception cref="ArgumentException">If traumaId or name is empty</exception>
    public static TraumaDefinition Create(
        string traumaId,
        string name,
        TraumaType type,
        string description,
        string flavorText,
        bool isRetirementTrauma,
        string? retirementCondition,
        bool isStackable,
        IReadOnlyList<string> acquisitionSources,
        IReadOnlyList<TraumaTrigger> triggers,
        IReadOnlyList<TraumaEffect> effects)
    {
        if (string.IsNullOrWhiteSpace(traumaId))
            throw new ArgumentException("TraumaId cannot be empty", nameof(traumaId));
        if (string.IsNullOrWhiteSpace(name))
            throw new ArgumentException("Name cannot be empty", nameof(name));
        if (isRetirementTrauma && string.IsNullOrWhiteSpace(retirementCondition))
            throw new ArgumentException(
                "RetirementCondition must be specified for retirement traumas",
                nameof(retirementCondition));

        return new TraumaDefinition
        {
            Id = Guid.NewGuid(),
            TraumaId = traumaId,
            Name = name,
            Type = type,
            Description = description,
            FlavorText = flavorText,
            IsRetirementTrauma = isRetirementTrauma,
            RetirementCondition = retirementCondition,
            IsStackable = isStackable,
            AcquisitionSources = acquisitionSources ?? new List<string>(),
            Triggers = triggers ?? new List<TraumaTrigger>(),
            Effects = effects ?? new List<TraumaEffect>()
        };
    }

    /// <summary>
    /// Gets the display string for this trauma definition.
    /// </summary>
    public override string ToString() =>
        $"{Name} ({Type}) [ID: {TraumaId}]" +
        (IsRetirementTrauma ? " [RETIREMENT]" : "") +
        (IsStackable ? " [STACKABLE]" : "");
}
```

---

## 7. TraumaEffect Value Object

### 7.1 Purpose

Immutable value object representing a single mechanical effect caused by a trauma.

### 7.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TraumaEffect.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a single mechanical effect of a trauma.
/// </summary>
/// <remarks>
/// <para>
/// Traumas can have multiple effects that apply mechanically to character capabilities.
/// Each effect specifies what type of effect it is (penalty, bonus, disadvantage)
/// and what it targets (skill, check, attribute).
/// </para>
/// <para>
/// Effect Types:
/// <list type="bullet">
/// <item>Penalty: Numeric penalty to specified target</item>
/// <item>Bonus: Numeric bonus to specified target</item>
/// <item>Disadvantage: Disadvantage on checks of specified type</item>
/// <item>StressIncrease: Increases stress when condition met</item>
/// <item>Custom: Special effect handled by game logic</item>
/// </list>
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var effect = TraumaEffect.Create(
///     effectType: "Penalty",
///     target: "social-skills",
///     value: -3,
///     condition: null,
///     description: "-3 penalty to Social checks"
/// );
/// </code>
/// </example>
public readonly record struct TraumaEffect
{
    /// <summary>
    /// Gets the type of effect (e.g., "Penalty", "Disadvantage").
    /// </summary>
    /// <remarks>
    /// Standard types: Penalty, Bonus, Disadvantage, StressIncrease, Custom
    /// </remarks>
    public string EffectType { get; init; }

    /// <summary>
    /// Gets the target of the effect (e.g., "social-skills", "morale-checks").
    /// </summary>
    /// <remarks>
    /// Can be skill name, check type, or custom target identifier.
    /// </remarks>
    public string Target { get; init; }

    /// <summary>
    /// Gets the numeric value of the effect (if applicable).
    /// </summary>
    /// <remarks>
    /// Null for non-numeric effects like Disadvantage.
    /// Positive for bonuses, negative for penalties.
    /// </remarks>
    public int? Value { get; init; }

    /// <summary>
    /// Gets the condition under which this effect applies.
    /// </summary>
    /// <remarks>
    /// Examples: "OnRest", "OnAllyTakeCriticalHit", "InCombat"
    /// Null means effect is always active.
    /// </remarks>
    public string? Condition { get; init; }

    /// <summary>
    /// Gets the human-readable description of this effect.
    /// </summary>
    /// <remarks>
    /// Shown in UI tooltips and help text.
    /// </remarks>
    public string Description { get; init; }

    /// <summary>
    /// Creates a new TraumaEffect with the specified properties.
    /// </summary>
    /// <param name="effectType">Type of effect</param>
    /// <param name="target">What the effect targets</param>
    /// <param name="value">Numeric value (if applicable)</param>
    /// <param name="condition">Activation condition (if any)</param>
    /// <param name="description">Human-readable description</param>
    /// <returns>A new TraumaEffect instance</returns>
    /// <exception cref="ArgumentException">If effectType or target is empty</exception>
    public static TraumaEffect Create(
        string effectType,
        string target,
        int? value = null,
        string? condition = null,
        string? description = null)
    {
        if (string.IsNullOrWhiteSpace(effectType))
            throw new ArgumentException("EffectType cannot be empty", nameof(effectType));
        if (string.IsNullOrWhiteSpace(target))
            throw new ArgumentException("Target cannot be empty", nameof(target));

        return new TraumaEffect
        {
            EffectType = effectType,
            Target = target,
            Value = value,
            Condition = condition,
            Description = description ?? $"{effectType} to {target}"
        };
    }

    /// <summary>
    /// Gets the display string for this effect.
    /// </summary>
    public override string ToString() =>
        $"{EffectType}: {Description}" +
        (Condition != null ? $" [{Condition}]" : "");
}
```

---

## 8. TraumaTrigger Value Object

### 8.1 Purpose

Immutable value object representing a condition that can trigger or activate a trauma's effects.

### 8.2 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TraumaTrigger.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a trigger condition for trauma effect activation.
/// </summary>
/// <remarks>
/// <para>
/// Trauma triggers define when a trauma's special effects activate or when
/// a trauma check is required. A trauma can have multiple triggers for
/// different circumstances.
/// </para>
/// <para>
/// Trigger Types:
/// <list type="bullet">
/// <item>OnRest: Activates during rest period</item>
/// <item>OnAllyDeath: Activates when party member dies</item>
/// <item>NearForlorn: Activates in proximity to corrupted entities</item>
/// <item>InCombat: Activates during combat</item>
/// <item>Custom: Game logic decides activation</item>
/// </list>
/// </para>
/// </remarks>
/// <example>
/// <code>
/// var trigger = TraumaTrigger.Create(
///     triggerType: "OnRest",
///     condition: null,
///     checkRequired: true,
///     checkDifficulty: 2
/// );
/// </code>
/// </example>
public readonly record struct TraumaTrigger
{
    /// <summary>
    /// Gets the type of trigger (e.g., "OnAllyDeath", "OnRest").
    /// </summary>
    /// <remarks>
    /// Determines what event activates this trigger.
    /// </remarks>
    public string TriggerType { get; init; }

    /// <summary>
    /// Gets the specific condition for this trigger.
    /// </summary>
    /// <remarks>
    /// Null means trigger activates on any occurrence of TriggerType.
    /// Examples: "AllyHasDied", "WhileInStress", "OncePerSession"
    /// </remarks>
    public string? Condition { get; init; }

    /// <summary>
    /// Gets whether a check is required to resist this trigger's effect.
    /// </summary>
    /// <remarks>
    /// If true, character must pass a check (CheckDifficulty)
    /// to avoid the effect. If false, effect applies automatically.
    /// </remarks>
    public bool CheckRequired { get; init; }

    /// <summary>
    /// Gets the difficulty of the check (if CheckRequired is true).
    /// </summary>
    /// <remarks>
    /// Typical values: 1-4
    /// Null if CheckRequired is false.
    /// </remarks>
    public int? CheckDifficulty { get; init; }

    /// <summary>
    /// Creates a new TraumaTrigger with the specified properties.
    /// </summary>
    /// <param name="triggerType">Type of trigger</param>
    /// <param name="condition">Specific condition (if any)</param>
    /// <param name="checkRequired">Whether a check is required</param>
    /// <param name="checkDifficulty">Difficulty if check required</param>
    /// <returns>A new TraumaTrigger instance</returns>
    /// <exception cref="ArgumentException">If triggerType is empty</exception>
    /// <exception cref="InvalidOperationException">If check required but difficulty not specified</exception>
    public static TraumaTrigger Create(
        string triggerType,
        string? condition = null,
        bool checkRequired = false,
        int? checkDifficulty = null)
    {
        if (string.IsNullOrWhiteSpace(triggerType))
            throw new ArgumentException("TriggerType cannot be empty", nameof(triggerType));
        if (checkRequired && !checkDifficulty.HasValue)
            throw new InvalidOperationException(
                "CheckDifficulty must be specified when CheckRequired is true");

        return new TraumaTrigger
        {
            TriggerType = triggerType,
            Condition = condition,
            CheckRequired = checkRequired,
            CheckDifficulty = checkDifficulty
        };
    }

    /// <summary>
    /// Gets the display string for this trigger.
    /// </summary>
    public override string ToString() =>
        $"{TriggerType}" +
        (Condition != null ? $"[{Condition}]" : "") +
        (CheckRequired ? $" [DC {CheckDifficulty}]" : "");
}
```

---

## 9. Logging Specifications

### 9.1 Domain Layer Logging

> **Note:** Enums and value objects do not log directly.
> Entities may log factory operations in service layer (v0.18.3e).

### 9.2 Expected Log Events (Future Implementation)

| Event                    | Level       | Template                                                       |
| ------------------------ | ----------- | -------------------------------------------------------------- |
| Trauma Definition Loaded  | Information | `"Trauma loaded: {TraumaId} ({Type})"`                         |
| Invalid Trauma ID         | Warning     | `"Unknown trauma ID requested: {TraumaId}"`                    |
| Retirement Trauma Created | Warning     | `"Retirement trauma created: {TraumaId} [Condition: {Condition}]"` |

---

## 10. Unit Testing Requirements

### 10.1 Test File Locations

**Files:**
- `tests/RuneAndRust.Domain.UnitTests/Enums/TraumaTypeTests.cs`
- `tests/RuneAndRust.Domain.UnitTests/Entities/TraumaDefinitionTests.cs`
- `tests/RuneAndRust.Domain.UnitTests/ValueObjects/TraumaEffectTests.cs`
- `tests/RuneAndRust.Domain.UnitTests/ValueObjects/TraumaTriggerTests.cs`

### 10.2 Required Tests

| Test Name | Description |
| --- | --- |
| `Create_WithValidParameters_CreatesTraumaDefinition` | Verify entity creation with all valid inputs |
| `Create_WithEmptyTraumaId_ThrowsArgumentException` | Verify validation of TraumaId |
| `Create_RetirementTraumaWithoutCondition_ThrowsArgumentException` | Verify retirement trauma requires condition |
| `TraumaEffect_Create_WithValidParameters_CreatesEffect` | Verify effect creation |
| `TraumaTrigger_Create_CheckRequiredWithoutDifficulty_ThrowsException` | Verify trigger validation |

### 10.3 Example Test

```csharp
[TestFixture]
public class TraumaDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_CreatesTraumaDefinition()
    {
        // Arrange
        var traumaId = "survivors-guilt";
        var name = "Survivor's Guilt";
        var type = TraumaType.Emotional;
        var description = "You carry the weight of those who didn't make it.";
        var flavorText = "Why them? Why not me?";

        // Act
        var trauma = TraumaDefinition.Create(
            traumaId: traumaId,
            name: name,
            type: type,
            description: description,
            flavorText: flavorText,
            isRetirementTrauma: true,
            retirementCondition: "On acquisition",
            isStackable: false,
            acquisitionSources: new[] { "AllyDeath" },
            triggers: new List<TraumaTrigger>(),
            effects: new List<TraumaEffect>()
        );

        // Assert
        trauma.TraumaId.Should().Be(traumaId);
        trauma.Name.Should().Be(name);
        trauma.Type.Should().Be(TraumaType.Emotional);
        trauma.IsRetirementTrauma.Should().BeTrue();
        trauma.IsStackable.Should().BeFalse();
    }

    [Test]
    public void Create_WithEmptyTraumaId_ThrowsArgumentException()
    {
        // Arrange & Act & Assert
        var ex = Assert.Throws<ArgumentException>(() =>
            TraumaDefinition.Create(
                traumaId: "",
                name: "Test",
                type: TraumaType.Cognitive,
                description: "Test",
                flavorText: "Test",
                isRetirementTrauma: false,
                retirementCondition: null,
                isStackable: false,
                acquisitionSources: new List<string>(),
                triggers: new List<TraumaTrigger>(),
                effects: new List<TraumaEffect>()
            )
        );
        ex.ParamName.Should().Be("traumaId");
    }

    [Test]
    public void Create_RetirementTraumaWithoutCondition_ThrowsArgumentException()
    {
        // Arrange & Act & Assert
        var ex = Assert.Throws<ArgumentException>(() =>
            TraumaDefinition.Create(
                traumaId: "test",
                name: "Test Trauma",
                type: TraumaType.Corruption,
                description: "Test",
                flavorText: "Test",
                isRetirementTrauma: true,
                retirementCondition: null, // INVALID
                isStackable: false,
                acquisitionSources: new List<string>(),
                triggers: new List<TraumaTrigger>(),
                effects: new List<TraumaEffect>()
            )
        );
        ex.ParamName.Should().Be("retirementCondition");
    }
}

[TestFixture]
public class TraumaEffectTests
{
    [Test]
    public void Create_WithValidParameters_CreatesEffect()
    {
        // Arrange & Act
        var effect = TraumaEffect.Create(
            effectType: "Penalty",
            target: "social-skills",
            value: -3,
            description: "-3 penalty to Social checks"
        );

        // Assert
        effect.EffectType.Should().Be("Penalty");
        effect.Target.Should().Be("social-skills");
        effect.Value.Should().Be(-3);
        effect.Description.Should().Be("-3 penalty to Social checks");
    }
}

[TestFixture]
public class TraumaTriggerTests
{
    [Test]
    public void Create_CheckRequiredWithoutDifficulty_ThrowsException()
    {
        // Arrange & Act & Assert
        var ex = Assert.Throws<InvalidOperationException>(() =>
            TraumaTrigger.Create(
                triggerType: "OnRest",
                condition: null,
                checkRequired: true,
                checkDifficulty: null // INVALID
            )
        );
    }
}
```

---

## 11. Deliverable Checklist

### 11.1 Domain Layer

- [ ] `src/Core/RuneAndRust.Domain/Enums/TraumaType.cs`
- [ ] `src/Core/RuneAndRust.Domain/Entities/TraumaDefinition.cs`
- [ ] `src/Core/RuneAndRust.Domain/ValueObjects/TraumaEffect.cs`
- [ ] `src/Core/RuneAndRust.Domain/ValueObjects/TraumaTrigger.cs`

### 11.2 Tests

- [ ] `tests/RuneAndRust.Domain.UnitTests/Enums/TraumaTypeTests.cs`
- [ ] `tests/RuneAndRust.Domain.UnitTests/Entities/TraumaDefinitionTests.cs`
- [ ] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/TraumaEffectTests.cs`
- [ ] `tests/RuneAndRust.Domain.UnitTests/ValueObjects/TraumaTriggerTests.cs`

### 11.3 Documentation

- [ ] Update `docs/design/v0.18.x/v0.18.3-scope-breakdown.md` (mark v0.18.3a complete)
- [ ] Create `docs/changelogs/v0.18.3a-changelog.md`

---

## 12. Acceptance Criteria

### 12.1 Build Verification

- [ ] Solution builds without errors
- [ ] Solution builds without warnings in new code

### 12.2 Test Verification

- [ ] All new unit tests pass
- [ ] All existing unit tests continue to pass

### 12.3 Functional Verification

- [ ] `TraumaType` enum contains all 6 categories
- [ ] `TraumaDefinition.Create()` validates TraumaId and Name
- [ ] `TraumaDefinition.Create()` requires RetirementCondition for retirement traumas
- [ ] `TraumaEffect.Create()` validates EffectType and Target
- [ ] `TraumaTrigger.Create()` validates CheckDifficulty when CheckRequired is true
- [ ] All entities serialize/deserialize correctly for JSON loading (v0.18.3e)

---

## 13. Dependencies

### 13.1 Required Prerequisites

| Dependency            | Version | Status   | Notes                            |
| --------------------- | ------- | -------- | -------------------------------- |
| Psychic Stress System | v0.18.0 | Required | Stress values drive trauma checks |
| Dice System           | v0.6.x  | Required | For trauma check rolls (v0.18.3c) |

### 13.2 Provides to v0.18.3b

| Type | Usage |
| --- | --- |
| `TraumaType` | Categorizes character traumas |
| `TraumaDefinition` | Referenced by CharacterTrauma |
| `TraumaEffect` | Applied to characters with traumas |
| `TraumaTrigger` | Conditions for trauma activation |

### 13.3 Deferred to Later Phases

| Item | Deferred To | Reason |
| --- | --- | --- |
| Per-character trauma tracking | v0.18.3b | CharacterTrauma entity |
| Trauma check mechanics | v0.18.3c | ITraumaCheckService |
| Service layer | v0.18.3d-e | Application layer |

---

## 14. Future Considerations

### 14.1 v0.18.3b (CharacterTrauma Entity)

- `CharacterTrauma` per-character trauma tracking
- Stack count mechanics for stackable traumas
- Acquisition history and timestamps

### 14.2 v0.18.3c (Trauma Check System)

- `ITraumaCheckService` for rolling trauma checks
- `TraumaCheckResult` for check outcomes
- `TraumaCheckTrigger` enum for event types

### 14.3 v0.18.3d-e (Service Layer & Config)

- `ITraumaService` interface for trauma management
- `TraumaService` implementation with database persistence
- `traumas.json` configuration file with all 10 base traumas
- Database schema for character_traumas table

### 14.4 v0.18.5 (Trauma Integration)

- Integration with combat events for trauma checks
- Integration with rest mechanics for trauma triggers
- NPC trauma effects and AI behavior changes
- Trauma interaction matrix (conflicting/synergistic traumas)

---

*This design specification provides the detailed blueprint for implementing v0.18.3a. The Trauma Enums & Definitions layer forms the foundation for all subsequent trauma system components.*

---

## Changelog

| Version | Date       | Changes                        |
| ------- | ---------- | ------------------------------ |
| 1.0     | 2026-01-28 | Initial design specification   |
