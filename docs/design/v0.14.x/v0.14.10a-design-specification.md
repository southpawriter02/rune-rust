# v0.14.10a Design Specification: Faction Schema

**Version:** 0.14.10a
**Parent:** v0.14.10 (Game Systems Configuration Schemas)
**Prerequisites:** v0.14.9 Complete (Advanced Descriptor Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Schema Root Definition](#4-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [Default Threshold Configuration](#42-default-threshold-configuration)
   - 4.3 [Schema Version Control](#43-schema-version-control)
5. [Faction Definition](#5-faction-definition)
   - 5.1 [Core Properties](#51-core-properties)
   - 5.2 [Identity Properties](#52-identity-properties)
   - 5.3 [Display Properties](#53-display-properties)
6. [ReputationThresholds Definition](#6-reputationthresholds-definition)
   - 6.1 [Threshold Structure](#61-threshold-structure)
   - 6.2 [Threshold Ranges](#62-threshold-ranges)
   - 6.3 [Override Behavior](#63-override-behavior)
7. [FactionRelationship Definition](#7-factionrelationship-definition)
   - 7.1 [Relationship Types](#71-relationship-types)
   - 7.2 [Reputation Propagation](#72-reputation-propagation)
   - 7.3 [Relationship Examples](#73-relationship-examples)
8. [ReputationModifier Definition](#8-reputationmodifier-definition)
   - 8.1 [Action Types](#81-action-types)
   - 8.2 [Modifier Structure](#82-modifier-structure)
   - 8.3 [Conditional Modifiers](#83-conditional-modifiers)
9. [FactionPerk Definition](#9-factionperk-definition)
   - 9.1 [Perk Structure](#91-perk-structure)
   - 9.2 [Effect Types](#92-effect-types)
   - 9.3 [Threshold Requirements](#93-threshold-requirements)
10. [VendorAccess Definition](#10-vendoraccess-definition)
    - 10.1 [Vendor Structure](#101-vendor-structure)
    - 10.2 [Price Modifiers](#102-price-modifiers)
    - 10.3 [Exclusive Items](#103-exclusive-items)
11. [Configuration Schema](#11-configuration-schema)
12. [Example Configuration File](#12-example-configuration-file)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Use Cases](#15-use-cases)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies](#18-dependencies)
19. [Future Considerations](#19-future-considerations)
20. [Appendix: Known Factions Reference](#20-appendix-known-factions-reference)

---

## 1. Executive Summary

Version 0.14.10a introduces the **Faction Schema** (`factions.schema.json`), which provides a comprehensive JSON Schema Draft-07 specification for validating faction definitions. This schema enables full customization of faction identities, reputation thresholds, inter-faction relationships, reputation change rules, faction-specific perks, and vendor access—all without code changes.

The Faction Schema integrates with dialogue outcomes (v0.14.9a) through `AffectedFaction` references and provides the foundation for quest rewards (v0.14.10b) that modify faction reputation. This schema supports the core social systems of Rune & Rust, where player actions have consequences through faction standing and territorial control.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `factions.schema.json` (JSON Schema Draft-07) |
| **Schema Definitions** | `Faction`, `ReputationThresholds`, `FactionRelationship`, `ReputationModifier`, `FactionPerk`, `VendorAccess` |
| **Configuration Files** | `factions.json` with known factions |
| **Tests** | ~6 new unit tests |

### Architectural Significance

This version provides:
- **Faction identity** - ID, name, description, iconId, color, tags
- **Reputation thresholds** - 6 levels (hostile, unfriendly, neutral, friendly, allied, exalted)
- **Reputation value ranges** - -1000 to 10000 with configurable thresholds
- **Inter-faction relationships** - 6 relationship types with reputation propagation
- **Reputation modifiers** - 8 action types with conditional triggers
- **Faction perks** - Unlockable benefits at reputation levels
- **Vendor access** - Faction-specific vendors with price modifiers
- **Hidden factions** - Secret factions not displayed until discovered

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│              v0.14.10 GAME SYSTEMS CONFIGURATION SCHEMAS                     │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.10a: factions.schema.json ◀── THIS VERSION                       │
  │  v0.14.10b: quests.schema.json (depends on factions)                   │
  │  v0.14.10c: codex.schema.json                                          │
  │  v0.14.10d: commands.schema.json                                       │
  │  v0.14.10e: glossary.schema.json                                       │
  │  v0.14.10f: stances.schema.json                                        │
  └─────────────────────────────────────────────────────────────────────────┘

  Integration Points:
  └── v0.14.9a dialogue.schema.json
      ├── Outcome.Type = "ReputationChange"
      ├── Outcome.AffectedFaction → references faction ID
      └── Outcome.ReputationChange → integer value

  Source Material:
  └── docs/design/aethelgard/design/
      ├── 02-entities/faction-reputation.md
      └── resources/03-faction/
          ├── rust-clan.md
          ├── midgard-combine.md
          ├── faction-iron-bane.md
          ├── faction-god-sleeper.md
          ├── faction-jotun-reader.md
          └── (13 faction files total)
```

---

## 2. Feature Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        FACTION SCHEMA FEATURE TREE                           │
└─────────────────────────────────────────────────────────────────────────────┘

factions.schema.json
├── Root Configuration
│   ├── $schema reference
│   ├── version identifier (semver)
│   ├── defaultThresholds (optional global defaults)
│   └── factions (array)
│
├── Faction Definition
│   ├── id (globally unique, kebab-case)
│   ├── name (display name)
│   ├── description (lore text)
│   ├── iconId (UI icon reference)
│   ├── color (hex color for UI)
│   ├── thresholds (optional override)
│   ├── relationships (array)
│   ├── reputationModifiers (array)
│   ├── perks (array)
│   ├── vendors (array)
│   ├── headquarters (location ID)
│   ├── isHidden (secret faction flag)
│   └── tags (metadata array)
│
├── ReputationThresholds
│   ├── hostile { min: -1000, max: -501, label }
│   ├── unfriendly { min: -500, max: -1, label }
│   ├── neutral { min: 0, max: 499, label }
│   ├── friendly { min: 500, max: 2999, label }
│   ├── allied { min: 3000, max: 8999, label }
│   └── exalted { min: 9000, max: 10000, label }
│
├── FactionRelationship
│   ├── factionId (reference)
│   ├── relationship (enum: 6 types)
│   ├── reputationLink (propagation %)
│   └── description
│
├── ReputationModifier
│   ├── action (enum: 8 types)
│   ├── amount (integer)
│   ├── conditions (optional)
│   └── description
│
├── FactionPerk
│   ├── id (unique within faction)
│   ├── name, description
│   ├── requiredThreshold (enum)
│   ├── effect (object)
│   └── isPassive (boolean)
│
└── VendorAccess
    ├── vendorId (reference)
    ├── requiredThreshold (enum)
    ├── priceModifier (multiplier)
    └── exclusiveItems (array)
```

---

## 3. Architecture Diagrams

### 3.1 Faction System Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       FACTION SYSTEM ARCHITECTURE                            │
└─────────────────────────────────────────────────────────────────────────────┘

                    factions.json
          ┌───────────────────────────────────────┐
          │  {                                    │
          │    "$schema": "...",                  │
          │    "version": "1.0.0",                │
          │    "defaultThresholds": {...},        │
          │    "factions": [                      │
          │      {                                │
          │        "id": "rust-clans",            │
          │        "name": "Rust Clans",          │
          │        "thresholds": {...},           │
          │        "relationships": [...],        │
          │        "reputationModifiers": [...],  │
          │        "perks": [...],                │
          │        "vendors": [...]               │
          │      }                                │
          │    ]                                  │
          │  }                                    │
          └─────────────────┬─────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         FACTION DEFINITION                                   │
│─────────────────────────────────────────────────────────────────────────────│
│  Identity        │  Thresholds       │  Relationships    │  Modifiers       │
│  ────────────────┼───────────────────┼───────────────────┼─────────────────│
│  id: rust-clans  │  hostile: -1000   │  midgard-combine  │  KillMember: -20 │
│  name: Rust Clans│  unfriendly: -500 │    → Neutral      │  HelpMember: +10 │
│  color: #B87333  │  neutral: 0       │  iron-banes       │  CompleteQuest:  │
│  iconId: clan    │  friendly: 500    │    → Hostile      │    +25           │
│                  │  allied: 3000     │  dvergr-guild     │  Theft: -15      │
│                  │  exalted: 9000    │    → Friendly     │                  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Reputation Threshold Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      REPUTATION THRESHOLD FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

        Reputation Value: -1000                                          10000
        ├───────────┼───────────┼───────────┼───────────┼───────────┼────────┤
              -1000      -500         0         500        3000        9000
            to -501    to -1       to 499    to 2999     to 8999    to 10000
              │          │           │          │           │           │
              ▼          ▼           ▼          ▼           ▼           ▼
         ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
         │ HOSTILE │ │UNFRIEND-│ │ NEUTRAL │ │FRIENDLY │ │ ALLIED  │ │ EXALTED │
         │         │ │   LY    │ │         │ │         │ │         │ │         │
         │ Kill on │ │Distrusted│ │Standard │ │-10%     │ │-20%     │ │-30%     │
         │ sight   │ │+25%     │ │services │ │prices   │ │prices   │ │prices   │
         │+50%     │ │prices   │ │         │ │More     │ │Special  │ │Unique   │
         │prices   │ │Limited  │ │         │ │quests   │ │items    │ │rewards  │
         │No       │ │services │ │         │ │         │ │Perks    │ │All perks│
         │services │ │         │ │         │ │         │ │unlocked │ │         │
         └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘

  Default Starting Reputation: 0 (Neutral)

  Threshold Transition Events:
  ════════════════════════════
  When player reputation crosses a threshold boundary:
  1. System fires ThresholdChanged event
  2. UI displays notification
  3. NPC behaviors update
  4. Perks unlock/lock
  5. Vendor access changes
```

### 3.3 Reputation Propagation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     REPUTATION PROPAGATION FLOW                              │
└─────────────────────────────────────────────────────────────────────────────┘

          Player Action: Help Rust Clans member (+10 rep)
                              │
                              ▼
          ┌───────────────────────────────────────┐
          │         RUST CLANS                    │
          │         Reputation: +10               │
          │                                       │
          │  Relationships:                       │
          │  ┌─────────────────────────────────┐  │
          │  │ dvergr-guild: Friendly          │  │
          │  │   reputationLink: 50%           │──┼──► +5 to Dvergr Guild
          │  │                                 │  │
          │  │ iron-banes: Hostile             │  │
          │  │   reputationLink: -25%          │──┼──► -2 to Iron-Banes
          │  │                                 │  │
          │  │ midgard-combine: Neutral        │  │
          │  │   reputationLink: null          │──┼──► No change
          │  └─────────────────────────────────┘  │
          └───────────────────────────────────────┘

  Propagation Rules:
  ═══════════════════
  • Positive reputationLink: Allied factions share positive rep
  • Negative reputationLink: Hostile factions receive opposite rep
  • null reputationLink: No propagation occurs
  • Propagation is one-way (does not chain to secondary factions)

  Example Calculation:
  ════════════════════
  Action: +10 Rust Clans
  Dvergr Guild: +10 × 0.50 = +5
  Iron-Banes: +10 × -0.25 = -2 (rounded down)
  Midgard Combine: No change
```

### 3.4 Dialogue Integration Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      DIALOGUE INTEGRATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

              Dialogue Outcome (from v0.14.9a)
          ┌───────────────────────────────────────┐
          │  {                                    │
          │    "Outcome": {                       │
          │      "Type": "ReputationChange",      │
          │      "Data": "Successfully negotiated │
          │               with Bjorn",            │
          │      "ReputationChange": 10,          │
          │      "AffectedFaction": "RustClans"   │◀── References faction ID
          │    }                                  │
          │  }                                    │
          └─────────────────┬─────────────────────┘
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │         FACTION LOOKUP                 │
          │─────────────────────────────────────── │
          │  1. Parse AffectedFaction value        │
          │  2. Look up faction by ID              │
          │  3. Validate faction exists            │
          │  4. Apply ReputationChange amount      │
          │  5. Process relationship propagation   │
          │  6. Check threshold transitions        │
          │  7. Fire appropriate events            │
          └─────────────────────────────────────── ┘
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │         UI NOTIFICATION                │
          │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
          │  +10 Rust Clans Reputation             │
          │  (Neutral → Neutral)                   │
          │  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
          └───────────────────────────────────────┘
```

### 3.5 Perk Unlock System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         PERK UNLOCK SYSTEM                                   │
└─────────────────────────────────────────────────────────────────────────────┘

  Player reaches FRIENDLY with Rust Clans (500+ reputation)
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │  PERK ELIGIBILITY CHECK                │
          │─────────────────────────────────────── │
          │  For each perk in faction.perks:       │
          │    IF perk.requiredThreshold           │
          │       <= player.currentThreshold       │
          │    THEN perk is available              │
          └─────────────────────────────────────── ┘
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │  NEWLY UNLOCKED PERKS                  │
          │─────────────────────────────────────── │
          │  ✓ Scavenger's Discount (Friendly)     │
          │    Effect: -15% prices at vendors      │
          │    Type: Passive                       │
          │                                        │
          │  ✗ Clan Sigil (Allied) - LOCKED        │
          │  ✗ Heart-Hunter Training (Exalted)     │
          └───────────────────────────────────────┘

  Perk Types:
  ═══════════
  • isPassive: true → Automatically applied when threshold met
  • isPassive: false → Must be activated/claimed by player
```

### 3.6 Vendor Access System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         VENDOR ACCESS SYSTEM                                 │
└─────────────────────────────────────────────────────────────────────────────┘

  Player visits Rust Clans vendor (current rep: ALLIED)
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │  VENDOR ACCESS CHECK                   │
          │─────────────────────────────────────── │
          │  Vendor: "utgard-salvage-merchant"     │
          │  Required: NEUTRAL                     │
          │  Player: ALLIED                        │
          │  Result: ACCESS GRANTED                │
          └─────────────────────────────────────── ┘
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │  PRICE MODIFIER APPLICATION            │
          │─────────────────────────────────────── │
          │  Base priceModifier: 1.0               │
          │  Threshold modifier (Allied): -20%     │
          │  Final modifier: 0.80                  │
          │                                        │
          │  Item: Iron Heart                      │
          │  Base price: 100 Cogs                  │
          │  Final price: 80 Cogs                  │
          └─────────────────────────────────────── ┘
                            │
                            ▼
          ┌───────────────────────────────────────┐
          │  EXCLUSIVE ITEMS CHECK                 │
          │─────────────────────────────────────── │
          │  exclusiveItems at ALLIED:             │
          │  • "scavengers-kit"                    │
          │  • "rust-resistance-serum"             │
          │                                        │
          │  These items now appear in inventory   │
          └───────────────────────────────────────┘
```

### 3.7 Schema Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           SCHEMA LAYER DIAGRAM                               │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              PRESENTATION                                    │
│                                                                              │
│  Faction UI displays reputation, perks, and vendor access                    │
│  • Reputation bar with threshold indicators                                  │
│  • Faction relationship map                                                  │
│  • Perk unlock notifications                                                 │
│  • Vendor discount display                                                   │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              APPLICATION                                     │
│                                                                              │
│  FactionService manages reputation and perk logic                            │
│  • GetFactionById(id) → faction definition                                   │
│  • ModifyReputation(factionId, amount) → applies change                      │
│  • GetCurrentThreshold(factionId) → threshold enum                           │
│  • GetAvailablePerks(factionId) → perk list                                  │
│  • GetVendorPriceModifier(factionId) → decimal multiplier                    │
│  • PropagateReputation(factionId, amount) → applies to related factions      │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                             DOMAIN LAYER                                     │
│                                                                              │
│  Faction definitions and value objects                                       │
│  • Faction entity (identity, thresholds, relationships)                      │
│  • ReputationThresholds value object (6 threshold levels)                    │
│  • FactionRelationship value object (type, propagation)                      │
│  • ReputationModifier value object (action, amount)                          │
│  • FactionPerk value object (threshold, effect)                              │
│  • VendorAccess value object (threshold, modifier)                           │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           INFRASTRUCTURE                                     │
│                                                                              │
│  FactionProvider loads from JSON with schema validation                      │
│  • LoadFactions() → reads config/factions.json                               │
│  • Validates against config/schemas/factions.schema.json                     │
│  • Builds faction lookup by ID                                               │
│  • Validates inter-faction relationship references                           │
│  • Logs warnings for invalid references                                      │
└─────────────────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIGURATION                                     │
│                                                                              │
│  config/schemas/factions.schema.json (Draft-07)                              │
│  config/factions.json (faction definitions)                                  │
│                                                                              │
│  Related Schemas:                                                            │
│  • dialogue.schema.json (v0.14.9a) → AffectedFaction references              │
│  • quests.schema.json (v0.14.10b) → Reputation rewards                       │
│  • vendors.schema.json (v0.14.5) → VendorAccess references                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Schema Root Definition

### 4.1 Root Configuration Properties

The faction schema defines a collection of faction definitions with optional global defaults.

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `$schema` | string | No | - | JSON Schema reference |
| `version` | string | **Yes** | - | Schema version (semver format) |
| `defaultThresholds` | object | No | See below | Global reputation thresholds |
| `factions` | array | **Yes** | - | Array of faction definitions |

### 4.2 Default Threshold Configuration

When factions do not specify custom thresholds, the global defaults apply:

| Threshold | Min | Max | Default Label |
|-----------|-----|-----|---------------|
| `hostile` | -1000 | -501 | "Hostile" |
| `unfriendly` | -500 | -1 | "Unfriendly" |
| `neutral` | 0 | 499 | "Neutral" |
| `friendly` | 500 | 2999 | "Friendly" |
| `allied` | 3000 | 8999 | "Allied" |
| `exalted` | 9000 | 10000 | "Exalted" |

### 4.3 Schema Version Control

The `version` field enables migration support:

| Version Pattern | Description |
|-----------------|-------------|
| `1.0.0` | Initial release |
| `1.1.0` | Minor additions (backward compatible) |
| `2.0.0` | Breaking changes |

---

## 5. Faction Definition

### 5.1 Core Properties

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `id` | string | **Yes** | - | Unique faction identifier (kebab-case) |
| `name` | string | **Yes** | - | Display name for UI |
| `description` | string | **Yes** | - | Lore description |
| `thresholds` | object | No | inherited | Custom reputation thresholds |
| `relationships` | array | No | [] | Inter-faction relationships |
| `reputationModifiers` | array | No | [] | Actions that change reputation |
| `perks` | array | No | [] | Unlockable faction benefits |
| `vendors` | array | No | [] | Faction-specific vendor access |
| `headquarters` | string | No | null | Location ID for faction HQ |
| `isHidden` | boolean | No | false | Secret faction (hidden until discovered) |
| `tags` | array | No | [] | Metadata tags for filtering |

### 5.2 Identity Properties

| Property | Constraint | Example |
|----------|------------|---------|
| `id` | Pattern: `^[a-z][a-z0-9-]*$` | `"rust-clans"` |
| `name` | minLength: 1 | `"Rust Clans"` |
| `description` | minLength: 10 | `"Exile raiders and desperate scavengers..."` |

### 5.3 Display Properties

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `iconId` | string | null | Reference to UI icon asset |
| `color` | string | null | Hex color for UI (e.g., `"#B87333"`) |

---

## 6. ReputationThresholds Definition

### 6.1 Threshold Structure

Each threshold defines a reputation range:

```json
{
  "min": -1000,
  "max": -501,
  "label": "Hostile"
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `min` | integer | **Yes** | Minimum reputation value (inclusive) |
| `max` | integer | **Yes** | Maximum reputation value (inclusive) |
| `label` | string | **Yes** | Display name for threshold |

### 6.2 Threshold Ranges

The complete reputation scale spans -1000 to 10000:

| Threshold | Range | Typical Effects |
|-----------|-------|-----------------|
| `hostile` | -1000 to -501 | Kill on sight, no services, +50% prices |
| `unfriendly` | -500 to -1 | Distrusted, limited services, +25% prices |
| `neutral` | 0 to 499 | Standard interactions, basic services |
| `friendly` | 500 to 2999 | -10% prices, additional quests |
| `allied` | 3000 to 8999 | -20% prices, special items, faction perks |
| `exalted` | 9000 to 10000 | -30% prices, unique rewards, all perks |

### 6.3 Override Behavior

Factions can customize thresholds:

```
Default Thresholds (from root)
         │
         ├──► Faction without thresholds → Uses defaults
         │
         └──► Faction with thresholds → Complete override
```

**Override Rules:**
1. If faction has `thresholds`, it completely replaces defaults
2. Custom thresholds must cover the full -1000 to 10000 range
3. Threshold ranges must not overlap
4. Threshold ranges must not have gaps

---

## 7. FactionRelationship Definition

### 7.1 Relationship Types

| Relationship | Description | Typical reputationLink |
|--------------|-------------|------------------------|
| `Allied` | Close allies, shared goals | +50% to +75% |
| `Friendly` | Trading partners, mutual respect | +25% to +50% |
| `Neutral` | No strong opinion | null (no propagation) |
| `Unfriendly` | Tension, competition | null or -10% to -25% |
| `Hostile` | Active conflict, territorial disputes | -25% to -50% |
| `AtWar` | Open warfare | -50% to -75% |

### 7.2 Reputation Propagation

The `reputationLink` property determines how reputation changes propagate:

| Value | Behavior |
|-------|----------|
| `null` | No propagation |
| Positive % | Allied factions gain proportional reputation |
| Negative % | Hostile factions lose proportional reputation |

**Propagation Formula:**
```
PropagatedChange = OriginalChange × (reputationLink / 100)
```

**Example:**
- Player gains +100 reputation with Rust Clans
- Dvergr Guild relationship: `reputationLink: 50`
- Dvergr Guild gains: +100 × 0.50 = +50

### 7.3 Relationship Examples

```json
{
  "relationships": [
    {
      "factionId": "dvergr-guild",
      "relationship": "Friendly",
      "reputationLink": 50,
      "description": "Trade partners—salvage for steel"
    },
    {
      "factionId": "iron-banes",
      "relationship": "Hostile",
      "reputationLink": -25,
      "description": "Ideological enemies—heretics vs zealots"
    },
    {
      "factionId": "midgard-combine",
      "relationship": "Neutral",
      "reputationLink": null,
      "description": "Transactional—neither friend nor foe"
    }
  ]
}
```

---

## 8. ReputationModifier Definition

### 8.1 Action Types

| Action | Description | Typical Amount |
|--------|-------------|----------------|
| `KillMember` | Kill a faction member | -20 to -30 |
| `HelpMember` | Assist a faction member | +5 to +15 |
| `CompleteQuest` | Complete a faction quest | +15 to +50 |
| `FailQuest` | Fail a faction quest | -10 to -25 |
| `Theft` | Steal from faction | -10 to -20 |
| `Gift` | Give resources to faction | +5 to +15 |
| `Betrayal` | Major betrayal act | -50 to -100 |
| `Discovery` | Share valuable information | +10 to +30 |

### 8.2 Modifier Structure

```json
{
  "action": "KillMember",
  "amount": -20,
  "conditions": null,
  "description": "Killing a Rust Clan member"
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `action` | string | **Yes** | Action type (enum) |
| `amount` | integer | **Yes** | Reputation change (positive or negative) |
| `conditions` | array | No | Conditions that modify the amount |
| `description` | string | **Yes** | Human-readable description |

### 8.3 Conditional Modifiers

Conditions can modify the base amount:

```json
{
  "action": "KillMember",
  "amount": -20,
  "conditions": [
    {
      "type": "Witnessed",
      "modifier": 1.0,
      "description": "Witnessed by faction members"
    },
    {
      "type": "Unwitnessed",
      "modifier": 0.0,
      "description": "No witnesses—no reputation change"
    }
  ],
  "description": "Killing a Rust Clan member"
}
```

| Condition Type | Effect |
|----------------|--------|
| `Witnessed` | Full reputation change (100%) |
| `Unwitnessed` | No change (0%) per faction-reputation.md |
| `InTerritory` | Modifier for actions in faction territory |
| `IsLeader` | Enhanced modifier for targeting leaders |

---

## 9. FactionPerk Definition

### 9.1 Perk Structure

```json
{
  "id": "scavengers-discount",
  "name": "Scavenger's Discount",
  "description": "Rust Clan vendors offer reduced prices",
  "requiredThreshold": "friendly",
  "effect": {
    "type": "PriceModifier",
    "target": "FactionVendors",
    "value": -0.15
  },
  "isPassive": true
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `id` | string | **Yes** | Unique perk identifier within faction |
| `name` | string | **Yes** | Display name |
| `description` | string | **Yes** | Perk description |
| `requiredThreshold` | string | **Yes** | Minimum threshold to unlock (enum) |
| `effect` | object | **Yes** | Perk effect definition |
| `isPassive` | boolean | No | true = automatic, false = must activate |

### 9.2 Effect Types

| Effect Type | Description | Example |
|-------------|-------------|---------|
| `PriceModifier` | Modify vendor prices | `-0.15` (15% discount) |
| `StatBonus` | Grant stat increase | `+2 to Salvage skill` |
| `AccessGrant` | Unlock access to areas/services | `"hidden-cache-locations"` |
| `AbilityGrant` | Provide special ability | `"gutter-galdr-training"` |
| `ReputationBonus` | Bonus reputation from actions | `+25% quest rewards` |

### 9.3 Threshold Requirements

| Threshold | Typical Perks |
|-----------|---------------|
| `friendly` | Minor discounts, basic training access |
| `allied` | Special items, advanced training, hidden locations |
| `exalted` | Unique equipment, leadership access, faction secrets |

---

## 10. VendorAccess Definition

### 10.1 Vendor Structure

```json
{
  "vendorId": "utgard-salvage-merchant",
  "requiredThreshold": "neutral",
  "priceModifier": 1.0,
  "exclusiveItems": null
}
```

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `vendorId` | string | **Yes** | Reference to vendor definition |
| `requiredThreshold` | string | **Yes** | Minimum threshold for access |
| `priceModifier` | number | No | Price multiplier (default: 1.0) |
| `exclusiveItems` | array | No | Item IDs only available at this threshold |

### 10.2 Price Modifiers

Price modifiers stack with threshold-based discounts:

| Component | Example |
|-----------|---------|
| Base modifier from vendor | 1.0 |
| Threshold discount (Allied) | -0.20 |
| Final modifier | 0.80 (20% off) |

### 10.3 Exclusive Items

Items that become available at specific thresholds:

```json
{
  "vendorId": "rust-clan-artificer",
  "requiredThreshold": "allied",
  "priceModifier": 0.85,
  "exclusiveItems": [
    "scavengers-kit",
    "rust-resistance-serum",
    "gutter-galdr-primer"
  ]
}
```

---

## 11. Configuration Schema

### Complete `factions.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://rune-game.com/schemas/factions.schema.json",
  "title": "Faction Configuration",
  "description": "Schema for faction definitions and reputation systems in Rune & Rust.",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file"
    },
    "version": {
      "type": "string",
      "description": "Schema version for migration tracking (semver format)",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "defaultThresholds": {
      "$ref": "#/definitions/ReputationThresholds",
      "description": "Global default thresholds (factions can override)"
    },
    "factions": {
      "type": "array",
      "description": "Array of faction definitions",
      "items": {
        "$ref": "#/definitions/Faction"
      },
      "minItems": 1
    }
  },
  "required": ["version", "factions"],
  "additionalProperties": false,
  "definitions": {
    "Faction": {
      "type": "object",
      "description": "A single faction definition",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique faction identifier (kebab-case)",
          "pattern": "^[a-z][a-z0-9-]*$",
          "examples": ["rust-clans", "midgard-combine", "iron-banes"]
        },
        "name": {
          "type": "string",
          "description": "Display name for UI",
          "minLength": 1,
          "examples": ["Rust Clans", "Midgard Combine"]
        },
        "description": {
          "type": "string",
          "description": "Lore description of the faction",
          "minLength": 10
        },
        "iconId": {
          "type": ["string", "null"],
          "description": "Reference to UI icon asset",
          "default": null
        },
        "color": {
          "type": ["string", "null"],
          "description": "Hex color for UI elements (e.g., '#B87333')",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "default": null
        },
        "thresholds": {
          "$ref": "#/definitions/ReputationThresholds",
          "description": "Custom reputation thresholds (overrides defaults)"
        },
        "relationships": {
          "type": "array",
          "description": "Relationships with other factions",
          "items": {
            "$ref": "#/definitions/FactionRelationship"
          },
          "default": []
        },
        "reputationModifiers": {
          "type": "array",
          "description": "Actions that change reputation with this faction",
          "items": {
            "$ref": "#/definitions/ReputationModifier"
          },
          "default": []
        },
        "perks": {
          "type": "array",
          "description": "Perks unlocked at reputation thresholds",
          "items": {
            "$ref": "#/definitions/FactionPerk"
          },
          "default": []
        },
        "vendors": {
          "type": "array",
          "description": "Faction-specific vendor access",
          "items": {
            "$ref": "#/definitions/VendorAccess"
          },
          "default": []
        },
        "headquarters": {
          "type": ["string", "null"],
          "description": "Location ID for faction headquarters",
          "default": null
        },
        "isHidden": {
          "type": "boolean",
          "description": "Secret faction (hidden until discovered)",
          "default": false
        },
        "tags": {
          "type": "array",
          "description": "Metadata tags for filtering",
          "items": {
            "type": "string"
          },
          "default": []
        }
      },
      "required": ["id", "name", "description"],
      "additionalProperties": false
    },
    "ReputationThresholds": {
      "type": "object",
      "description": "Reputation threshold definitions (6 levels)",
      "properties": {
        "hostile": {
          "$ref": "#/definitions/ThresholdRange",
          "description": "Hostile threshold (-1000 to -501 default)"
        },
        "unfriendly": {
          "$ref": "#/definitions/ThresholdRange",
          "description": "Unfriendly threshold (-500 to -1 default)"
        },
        "neutral": {
          "$ref": "#/definitions/ThresholdRange",
          "description": "Neutral threshold (0 to 499 default)"
        },
        "friendly": {
          "$ref": "#/definitions/ThresholdRange",
          "description": "Friendly threshold (500 to 2999 default)"
        },
        "allied": {
          "$ref": "#/definitions/ThresholdRange",
          "description": "Allied threshold (3000 to 8999 default)"
        },
        "exalted": {
          "$ref": "#/definitions/ThresholdRange",
          "description": "Exalted threshold (9000 to 10000 default)"
        }
      },
      "required": ["hostile", "unfriendly", "neutral", "friendly", "allied", "exalted"],
      "additionalProperties": false
    },
    "ThresholdRange": {
      "type": "object",
      "description": "A single reputation threshold range",
      "properties": {
        "min": {
          "type": "integer",
          "description": "Minimum reputation value (inclusive)",
          "minimum": -1000,
          "maximum": 10000
        },
        "max": {
          "type": "integer",
          "description": "Maximum reputation value (inclusive)",
          "minimum": -1000,
          "maximum": 10000
        },
        "label": {
          "type": "string",
          "description": "Display label for this threshold",
          "minLength": 1
        }
      },
      "required": ["min", "max", "label"],
      "additionalProperties": false
    },
    "FactionRelationship": {
      "type": "object",
      "description": "Relationship between factions",
      "properties": {
        "factionId": {
          "type": "string",
          "description": "Reference to another faction",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "relationship": {
          "type": "string",
          "description": "Relationship type",
          "enum": ["Allied", "Friendly", "Neutral", "Unfriendly", "Hostile", "AtWar"]
        },
        "reputationLink": {
          "type": ["number", "null"],
          "description": "Percentage of reputation change that propagates (null = no propagation)",
          "minimum": -100,
          "maximum": 100,
          "default": null
        },
        "description": {
          "type": ["string", "null"],
          "description": "Description of the relationship",
          "default": null
        }
      },
      "required": ["factionId", "relationship"],
      "additionalProperties": false
    },
    "ReputationModifier": {
      "type": "object",
      "description": "Action that modifies faction reputation",
      "properties": {
        "action": {
          "type": "string",
          "description": "Type of action",
          "enum": ["KillMember", "HelpMember", "CompleteQuest", "FailQuest", "Theft", "Gift", "Betrayal", "Discovery"]
        },
        "amount": {
          "type": "integer",
          "description": "Base reputation change (positive or negative)"
        },
        "conditions": {
          "type": ["array", "null"],
          "description": "Conditions that modify the base amount",
          "items": {
            "$ref": "#/definitions/ModifierCondition"
          },
          "default": null
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the action",
          "minLength": 5
        }
      },
      "required": ["action", "amount", "description"],
      "additionalProperties": false
    },
    "ModifierCondition": {
      "type": "object",
      "description": "Condition that modifies reputation change",
      "properties": {
        "type": {
          "type": "string",
          "description": "Condition type",
          "enum": ["Witnessed", "Unwitnessed", "InTerritory", "IsLeader"]
        },
        "modifier": {
          "type": "number",
          "description": "Multiplier applied when condition is met",
          "minimum": 0,
          "maximum": 2
        },
        "description": {
          "type": ["string", "null"],
          "description": "Description of the condition",
          "default": null
        }
      },
      "required": ["type", "modifier"],
      "additionalProperties": false
    },
    "FactionPerk": {
      "type": "object",
      "description": "Perk unlocked at reputation threshold",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique perk identifier within faction",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "name": {
          "type": "string",
          "description": "Display name",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "description": "Perk description",
          "minLength": 10
        },
        "requiredThreshold": {
          "type": "string",
          "description": "Minimum reputation threshold to unlock",
          "enum": ["friendly", "allied", "exalted"]
        },
        "effect": {
          "type": "object",
          "description": "Perk effect definition",
          "properties": {
            "type": {
              "type": "string",
              "description": "Effect type",
              "enum": ["PriceModifier", "StatBonus", "AccessGrant", "AbilityGrant", "ReputationBonus"]
            },
            "target": {
              "type": "string",
              "description": "Target of the effect"
            },
            "value": {
              "type": ["number", "string"],
              "description": "Effect value (numeric for modifiers, string for grants)"
            }
          },
          "required": ["type", "target", "value"],
          "additionalProperties": false
        },
        "isPassive": {
          "type": "boolean",
          "description": "true = automatically applied, false = must be activated",
          "default": true
        }
      },
      "required": ["id", "name", "description", "requiredThreshold", "effect"],
      "additionalProperties": false
    },
    "VendorAccess": {
      "type": "object",
      "description": "Faction-specific vendor access",
      "properties": {
        "vendorId": {
          "type": "string",
          "description": "Reference to vendor definition",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "requiredThreshold": {
          "type": "string",
          "description": "Minimum reputation threshold for access",
          "enum": ["hostile", "unfriendly", "neutral", "friendly", "allied", "exalted"]
        },
        "priceModifier": {
          "type": "number",
          "description": "Price multiplier (1.0 = standard prices)",
          "minimum": 0.1,
          "maximum": 3.0,
          "default": 1.0
        },
        "exclusiveItems": {
          "type": ["array", "null"],
          "description": "Item IDs only available at this reputation level",
          "items": {
            "type": "string"
          },
          "default": null
        }
      },
      "required": ["vendorId", "requiredThreshold"],
      "additionalProperties": false
    }
  }
}
```

---

## 12. Example Configuration File

### Complete `factions.json`

```json
{
  "$schema": "../schemas/factions.schema.json",
  "version": "1.0.0",
  "defaultThresholds": {
    "hostile": { "min": -1000, "max": -501, "label": "Hostile" },
    "unfriendly": { "min": -500, "max": -1, "label": "Unfriendly" },
    "neutral": { "min": 0, "max": 499, "label": "Neutral" },
    "friendly": { "min": 500, "max": 2999, "label": "Friendly" },
    "allied": { "min": 3000, "max": 8999, "label": "Allied" },
    "exalted": { "min": 9000, "max": 10000, "label": "Exalted" }
  },
  "factions": [
    {
      "id": "rust-clans",
      "name": "Rust Clans",
      "description": "Exile raiders and desperate scavengers who make their home in the iron deserts of Jötunheim. The Children of the Assembly Line, they follow the Creed of the Self: radical self-reliance bound by crew loyalty.",
      "iconId": "faction-rust-clans",
      "color": "#B87333",
      "headquarters": "utgard",
      "tags": ["salvagers", "jotunheim", "creedless"],
      "relationships": [
        {
          "factionId": "dvergr-guild",
          "relationship": "Friendly",
          "reputationLink": 50,
          "description": "Trade partners—salvage for steel"
        },
        {
          "factionId": "iron-banes",
          "relationship": "Hostile",
          "reputationLink": -25,
          "description": "Ideological enemies—heretics versus zealots"
        },
        {
          "factionId": "midgard-combine",
          "relationship": "Neutral",
          "reputationLink": null,
          "description": "Transactional relationship—neither friend nor foe"
        },
        {
          "factionId": "god-sleeper-cults",
          "relationship": "Hostile",
          "reputationLink": -25,
          "description": "Theological incompatibility—salvagers versus worshippers"
        },
        {
          "factionId": "jotun-readers",
          "relationship": "Friendly",
          "reputationLink": 25,
          "description": "Frustrating cooperation—shared interest in ruins"
        }
      ],
      "reputationModifiers": [
        {
          "action": "KillMember",
          "amount": -20,
          "conditions": [
            { "type": "Witnessed", "modifier": 1.0, "description": "Full penalty when witnessed" },
            { "type": "Unwitnessed", "modifier": 0.0, "description": "No change if unwitnessed" }
          ],
          "description": "Killing a Rust Clan member"
        },
        {
          "action": "HelpMember",
          "amount": 10,
          "description": "Assisting a Rust Clan crew"
        },
        {
          "action": "CompleteQuest",
          "amount": 25,
          "description": "Completing a salvage contract"
        },
        {
          "action": "FailQuest",
          "amount": -15,
          "description": "Failing a salvage contract"
        },
        {
          "action": "Theft",
          "amount": -15,
          "description": "Stealing from Rust Clan merchants"
        },
        {
          "action": "Gift",
          "amount": 10,
          "description": "Trading valuable salvage at fair price"
        },
        {
          "action": "Betrayal",
          "amount": -50,
          "description": "Breaking a witnessed contract"
        },
        {
          "action": "Discovery",
          "amount": 15,
          "description": "Sharing location of untouched ruin"
        }
      ],
      "perks": [
        {
          "id": "scavengers-discount",
          "name": "Scavenger's Discount",
          "description": "Rust Clan merchants recognize you as a friend of the Clans and offer reduced prices.",
          "requiredThreshold": "friendly",
          "effect": {
            "type": "PriceModifier",
            "target": "FactionVendors",
            "value": -0.15
          },
          "isPassive": true
        },
        {
          "id": "scavengers-kit",
          "name": "Scavenger's Kit",
          "description": "Access to purchase the specialized salvage equipment used by Rust Clan crews.",
          "requiredThreshold": "allied",
          "effect": {
            "type": "AccessGrant",
            "target": "item-scavengers-kit",
            "value": "unlocked"
          },
          "isPassive": true
        },
        {
          "id": "clan-sigil",
          "name": "Clan Sigil",
          "description": "The Rig-Masters have granted you a Clan Sigil, revealing hidden salvage caches.",
          "requiredThreshold": "exalted",
          "effect": {
            "type": "AccessGrant",
            "target": "hidden-cache-locations",
            "value": "revealed"
          },
          "isPassive": false
        }
      ],
      "vendors": [
        {
          "vendorId": "utgard-salvage-merchant",
          "requiredThreshold": "neutral",
          "priceModifier": 1.0,
          "exclusiveItems": null
        },
        {
          "vendorId": "rust-clan-artificer",
          "requiredThreshold": "friendly",
          "priceModifier": 0.9,
          "exclusiveItems": ["iron-heart-fragment", "rust-resistance-serum"]
        }
      ]
    },
    {
      "id": "midgard-combine",
      "name": "Midgard Combine",
      "description": "The Heartland Alliance—a decentralized confederation of agricultural Holds that produces the vast majority of the world's reliable food supply. Pragmatic farmers and defenders who value the harvest and the Wall.",
      "iconId": "faction-midgard-combine",
      "color": "#8B4513",
      "headquarters": "crossroads",
      "tags": ["farmers", "midgard", "heartland"],
      "relationships": [
        {
          "factionId": "rangers-guild",
          "relationship": "Allied",
          "reputationLink": 75,
          "description": "Symbiotic infrastructure—Rangers keep the roads safe"
        },
        {
          "factionId": "dvergr-guild",
          "relationship": "Friendly",
          "reputationLink": 50,
          "description": "Critical economic partner—food for technology"
        },
        {
          "factionId": "rust-clans",
          "relationship": "Neutral",
          "reputationLink": null,
          "description": "Transactional—they pay on time"
        },
        {
          "factionId": "iron-banes",
          "relationship": "Unfriendly",
          "reputationLink": -10,
          "description": "Ideological tension—fanatics who burn useful salvage"
        },
        {
          "factionId": "scavenger-barons",
          "relationship": "Hostile",
          "reputationLink": -50,
          "description": "Hostile competition—raiders and slavers"
        }
      ],
      "reputationModifiers": [
        {
          "action": "KillMember",
          "amount": -25,
          "description": "Killing a Hold farmer or guard"
        },
        {
          "action": "HelpMember",
          "amount": 10,
          "description": "Assisting with Hold defense or harvest"
        },
        {
          "action": "CompleteQuest",
          "amount": 25,
          "description": "Completing a contract for the Combine"
        },
        {
          "action": "Gift",
          "amount": 5,
          "description": "Giving the Ghost's Share"
        },
        {
          "action": "Theft",
          "amount": -30,
          "description": "Stealing food—capital crime in the Combine"
        }
      ],
      "perks": [
        {
          "id": "harvest-wisdom",
          "name": "Harvest Wisdom",
          "description": "The elder farmers share their knowledge of crops and preservation.",
          "requiredThreshold": "friendly",
          "effect": {
            "type": "StatBonus",
            "target": "Survival",
            "value": 2
          },
          "isPassive": true
        },
        {
          "id": "hold-sanctuary",
          "name": "Hold Sanctuary",
          "description": "Allied Holds offer free rest and basic provisions.",
          "requiredThreshold": "allied",
          "effect": {
            "type": "AccessGrant",
            "target": "hold-sanctuary",
            "value": "unlocked"
          },
          "isPassive": true
        }
      ],
      "vendors": [
        {
          "vendorId": "combine-provisioner",
          "requiredThreshold": "neutral",
          "priceModifier": 1.0,
          "exclusiveItems": null
        },
        {
          "vendorId": "hold-quartermaster",
          "requiredThreshold": "allied",
          "priceModifier": 0.8,
          "exclusiveItems": ["grit-corn-seed", "preserved-rations"]
        }
      ]
    },
    {
      "id": "iron-banes",
      "name": "Iron-Bane Crusade",
      "description": "Anti-Undying zealots who believe the Jötun-Forged are corrupted demons that must be purged. Their faith drives them to cleanse what others would salvage.",
      "iconId": "faction-iron-banes",
      "color": "#8B0000",
      "headquarters": null,
      "tags": ["zealots", "crusaders", "anti-undying"],
      "relationships": [
        {
          "factionId": "rust-clans",
          "relationship": "Hostile",
          "reputationLink": -25,
          "description": "Ideological enemies—heretics who profit from taint"
        },
        {
          "factionId": "god-sleeper-cults",
          "relationship": "AtWar",
          "reputationLink": -75,
          "description": "Mortal enemies—demon-worshippers must be purged"
        },
        {
          "factionId": "midgard-combine",
          "relationship": "Unfriendly",
          "reputationLink": -10,
          "description": "Soft farmers who tolerate tainted technology"
        }
      ],
      "reputationModifiers": [
        {
          "action": "KillMember",
          "amount": -30,
          "description": "Killing a Crusader"
        },
        {
          "action": "HelpMember",
          "amount": 15,
          "description": "Assisting in a purge operation"
        },
        {
          "action": "Discovery",
          "amount": 30,
          "description": "Destroying corrupted Jötun-Forged"
        },
        {
          "action": "Betrayal",
          "amount": -100,
          "description": "Protecting Undying from purification"
        }
      ],
      "perks": [
        {
          "id": "purification-sigils",
          "name": "Purification Sigils",
          "description": "Blessed sigils that provide protection against Undying attacks.",
          "requiredThreshold": "friendly",
          "effect": {
            "type": "StatBonus",
            "target": "UndeadResistance",
            "value": 10
          },
          "isPassive": true
        },
        {
          "id": "zealots-blade",
          "name": "Zealot's Blade",
          "description": "A consecrated weapon that deals bonus damage to Undying.",
          "requiredThreshold": "exalted",
          "effect": {
            "type": "AccessGrant",
            "target": "item-zealots-blade",
            "value": "unlocked"
          },
          "isPassive": false
        }
      ],
      "vendors": []
    },
    {
      "id": "dvergr-guild",
      "name": "Dvergr Guild",
      "description": "Dwarven craftsmen and engineers from Nidavellir who maintain the technology the surface world depends upon. Their Pure Steel and clockwork are the foundation of post-Glitch economy.",
      "iconId": "faction-dvergr",
      "color": "#4A4A4A",
      "headquarters": "nidavellir",
      "tags": ["craftsmen", "engineers", "dwarves"],
      "relationships": [
        {
          "factionId": "rust-clans",
          "relationship": "Friendly",
          "reputationLink": 50,
          "description": "Valuable suppliers of rare materials"
        },
        {
          "factionId": "midgard-combine",
          "relationship": "Friendly",
          "reputationLink": 50,
          "description": "Agricultural partners—food for steel"
        },
        {
          "factionId": "jotun-readers",
          "relationship": "Neutral",
          "reputationLink": null,
          "description": "Scholars with interesting data, impractical applications"
        }
      ],
      "reputationModifiers": [
        {
          "action": "CompleteQuest",
          "amount": 30,
          "description": "Fulfilling a Dvergr contract precisely"
        },
        {
          "action": "Gift",
          "amount": 15,
          "description": "Providing rare salvage at fair price"
        },
        {
          "action": "Theft",
          "amount": -50,
          "description": "Stealing from Dvergr—contract termination and blacklisting"
        }
      ],
      "perks": [
        {
          "id": "clockwork-precision",
          "name": "Clockwork Precision",
          "description": "Access to Dvergr-crafted tools with superior reliability.",
          "requiredThreshold": "friendly",
          "effect": {
            "type": "AccessGrant",
            "target": "dvergr-tool-inventory",
            "value": "unlocked"
          },
          "isPassive": true
        },
        {
          "id": "deep-gate-passage",
          "name": "Deep Gate Passage",
          "description": "Permission to use Dvergr Deep Gates for rapid travel.",
          "requiredThreshold": "allied",
          "effect": {
            "type": "AccessGrant",
            "target": "deep-gate-network",
            "value": "unlocked"
          },
          "isPassive": true
        }
      ],
      "vendors": [
        {
          "vendorId": "dvergr-smith",
          "requiredThreshold": "neutral",
          "priceModifier": 1.1,
          "exclusiveItems": null
        },
        {
          "vendorId": "dvergr-master-smith",
          "requiredThreshold": "allied",
          "priceModifier": 1.0,
          "exclusiveItems": ["pure-steel-ingot", "clockwork-core"]
        }
      ]
    },
    {
      "id": "forlorn",
      "name": "The Forlorn",
      "description": "Corrupted beings touched by the Runic Blight. Neither living nor dead, they are hostile to all who still cling to sanity.",
      "iconId": "faction-forlorn",
      "color": "#2F4F4F",
      "isHidden": false,
      "tags": ["corrupted", "hostile", "blight"],
      "thresholds": {
        "hostile": { "min": -1000, "max": 10000, "label": "Hostile" },
        "unfriendly": { "min": 10001, "max": 10001, "label": "Unfriendly" },
        "neutral": { "min": 10002, "max": 10002, "label": "Neutral" },
        "friendly": { "min": 10003, "max": 10003, "label": "Friendly" },
        "allied": { "min": 10004, "max": 10004, "label": "Allied" },
        "exalted": { "min": 10005, "max": 10005, "label": "Exalted" }
      },
      "relationships": [],
      "reputationModifiers": [],
      "perks": [],
      "vendors": []
    }
  ]
}
```

---

## 13. Logging Specifications

### Schema Validation Logging

| Event | Level | Message Format |
|-------|-------|----------------|
| Schema loaded | INFO | `Faction schema loaded from {path}` |
| Configuration loaded | INFO | `Loaded {count} factions from configuration` |
| Validation success | DEBUG | `Faction configuration validated successfully` |
| Validation failure | ERROR | `Faction validation failed: {errors}` |
| Invalid faction ID | ERROR | `Faction ID '{id}' does not match pattern ^[a-z][a-z0-9-]*$` |
| Duplicate faction ID | ERROR | `Duplicate faction ID '{id}' found` |
| Invalid relationship reference | WARN | `Faction '{id}' references unknown faction '{refId}'` |
| Invalid threshold ranges | ERROR | `Faction '{id}' has overlapping or gapped threshold ranges` |

### Runtime Logging

| Event | Level | Message Format |
|-------|-------|----------------|
| Reputation changed | INFO | `Reputation with {faction}: {change} (Total: {newTotal})` |
| Threshold crossed | INFO | `Your standing with {faction} is now {newThreshold}` |
| Perk unlocked | INFO | `Perk unlocked: {perkName} ({faction})` |
| Reputation propagated | DEBUG | `Propagated {amount} reputation to {faction} via relationship` |
| Vendor access changed | DEBUG | `Vendor access updated for {faction}: {threshold}` |

---

## 14. Unit Testing Requirements

### Test Summary

| Test ID | Test Name | Description |
|---------|-----------|-------------|
| FAC-001 | ValidFactionConfiguration | Validates complete configuration file |
| FAC-002 | FactionIdentityValidation | Validates faction ID and name patterns |
| FAC-003 | ThresholdRangeValidation | Validates threshold ranges cover full scale |
| FAC-004 | RelationshipEnumValidation | Validates relationship type enum values |
| FAC-005 | ReputationModifierValidation | Validates action types and amounts |
| FAC-006 | FactionPerkValidation | Validates perk structure and threshold requirements |

### Test Specifications

#### FAC-001: ValidFactionConfiguration

```
Test: Valid complete faction configuration passes validation
Given: A faction JSON file with all required properties
When: Schema validation is performed
Then: Validation passes with no errors
And: Version matches semver pattern
And: Factions array has at least one faction
And: Each faction has id, name, description
```

#### FAC-002: FactionIdentityValidation

```
Test: Faction identity properties validate correctly
Given: Factions with various ID and name configurations
When: Schema validation is performed:
  - { "id": "rust-clans", "name": "Rust Clans", ... } → passes
  - { "id": "midgard-combine", ... } → passes
  - { "id": "RustClans", ... } → fails (uppercase)
  - { "id": "rust_clans", ... } → fails (underscore)
  - { "name": "", ... } → fails (empty name)
Then: ID pattern enforced, name required
```

#### FAC-003: ThresholdRangeValidation

```
Test: Threshold ranges validated correctly
Given: Factions with various threshold configurations
When: Schema validation is performed:
  - Default thresholds (-1000 to 10000 complete) → passes
  - Custom thresholds with full coverage → passes
  - Overlapping ranges → fails
  - Missing threshold level → fails
  - Gaps in range coverage → fails
Then: Complete, non-overlapping threshold coverage required
```

#### FAC-004: RelationshipEnumValidation

```
Test: Relationship types validated correctly
Given: Faction relationships with various types
When: Schema validation is performed:
  - "relationship": "Allied" → passes
  - "relationship": "Friendly" → passes
  - "relationship": "Neutral" → passes
  - "relationship": "Unfriendly" → passes
  - "relationship": "Hostile" → passes
  - "relationship": "AtWar" → passes
  - "relationship": "Enemy" → fails (invalid enum)
  - "relationship": "allied" → fails (case-sensitive)
Then: Only valid enum values accepted
```

#### FAC-005: ReputationModifierValidation

```
Test: Reputation modifier structure validated
Given: Factions with various reputation modifiers
When: Schema validation is performed:
  - { "action": "KillMember", "amount": -20, "description": "..." } → passes
  - { "action": "CompleteQuest", "amount": 25, "description": "..." } → passes
  - { "action": "InvalidAction", ... } → fails (invalid enum)
  - { "action": "KillMember" } → fails (missing amount)
  - { "action": "KillMember", "amount": -20 } → fails (missing description)
Then: Required fields enforced, action enum validated
```

#### FAC-006: FactionPerkValidation

```
Test: Faction perk structure validated
Given: Factions with various perk configurations
When: Schema validation is performed:
  - Perk with requiredThreshold: "friendly" → passes
  - Perk with requiredThreshold: "allied" → passes
  - Perk with requiredThreshold: "exalted" → passes
  - Perk with requiredThreshold: "neutral" → fails (not valid perk threshold)
  - Perk missing effect → fails
  - Perk with invalid effect.type → fails
Then: Perk thresholds restricted to friendly/allied/exalted
```

---

## 15. Use Cases

### UC-001: Load Faction Configuration

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-001: Load Faction Configuration                                           │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Game initialization                                                 │
│ Preconditions: Configuration files exist                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. System loads factions.schema.json                                         │
│ 2. System reads config/factions.json                                         │
│ 3. Validate configuration against schema                                     │
│ 4. Build faction lookup by ID                                                │
│ 5. Validate relationship references (all factionIds exist)                   │
│ 6. Initialize player reputation to 0 (neutral) for all factions              │
│ 7. Cache faction data for performance                                        │
│ 8. Log faction statistics                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Factions loaded and cached                                   │
│ Exceptions: Invalid JSON → log error, use fallback empty factions            │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-002: Modify Player Reputation

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-002: Modify Player Reputation                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Player, Game System                                                  │
│ Trigger: Player action affects faction (dialogue, quest, combat)             │
│ Preconditions: Factions loaded, valid faction ID                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Receive faction ID and reputation change amount                           │
│ 2. Look up faction by ID                                                     │
│ 3. Get current player reputation with faction                                │
│ 4. Apply reputation modifier conditions (witnessed, etc.)                    │
│ 5. Clamp new reputation to -1000/10000 bounds                                │
│ 6. Check if threshold crossed                                                │
│ 7. If crossed, fire ThresholdChanged event                                   │
│ 8. Process relationship propagation to related factions                      │
│ 9. Update perk availability                                                  │
│ 10. Display UI notification                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Reputation updated, events fired                             │
│ Exceptions: Unknown faction → log warning, no change                         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-003: Check Faction Perks

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-003: Check Faction Perks                                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Player, UI System                                                    │
│ Trigger: Player opens faction screen or reputation changes                   │
│ Preconditions: Factions loaded                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Get current player threshold with faction                                 │
│ 2. For each perk in faction.perks:                                           │
│    a. Compare perk.requiredThreshold to current threshold                    │
│    b. If current >= required, perk is available                              │
│    c. If passive, apply effect automatically                                 │
│    d. If active, add to player's available actions                           │
│ 3. Return list of available and locked perks                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Perk availability determined                                 │
│ Exceptions: No perks defined → return empty list                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-004: Calculate Vendor Prices

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-004: Calculate Vendor Prices                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Player, Vendor System                                                │
│ Trigger: Player opens vendor interface                                       │
│ Preconditions: Vendor belongs to faction, player has faction reputation      │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Identify vendor's faction                                                 │
│ 2. Get player's current threshold with faction                               │
│ 3. Check VendorAccess.requiredThreshold                                      │
│ 4. If player threshold < required, deny access                               │
│ 5. Otherwise, get VendorAccess.priceModifier                                 │
│ 6. Apply threshold-based discount:                                           │
│    - Friendly: -10%                                                          │
│    - Allied: -20%                                                            │
│    - Exalted: -30%                                                           │
│ 7. Calculate final price modifier                                            │
│ 8. Show exclusive items if threshold met                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Vendor inventory displayed with correct prices               │
│ Exceptions: Below threshold → show "Reputation required" message             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### UC-005: Propagate Reputation Changes

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ UC-005: Propagate Reputation Changes                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│ Actors: Game System                                                          │
│ Trigger: Primary faction reputation modified                                 │
│ Preconditions: Faction has relationships defined                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ Flow:                                                                        │
│ 1. Get original reputation change amount                                     │
│ 2. For each relationship in faction.relationships:                           │
│    a. Check reputationLink value                                             │
│    b. If null, skip this relationship                                        │
│    c. Calculate propagated amount: original × (link / 100)                   │
│    d. Round to integer (toward zero)                                         │
│    e. Apply to related faction (no further propagation)                      │
│ 3. Fire events for any propagated threshold changes                          │
├─────────────────────────────────────────────────────────────────────────────┤
│ Postconditions: Related factions updated                                     │
│ Exceptions: Invalid factionId in relationship → log warning, skip            │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 16. Deliverable Checklist

### Configuration Files

| Status | File | Description |
|--------|------|-------------|
| ☐ | `config/schemas/factions.schema.json` | JSON Schema Draft-07 for validation |
| ☐ | `config/factions.json` | Faction definitions |

### Unit Tests

| Status | Test | Description |
|--------|------|-------------|
| ☐ | FAC-001 | Valid complete configuration |
| ☐ | FAC-002 | Faction identity validation |
| ☐ | FAC-003 | Threshold range validation |
| ☐ | FAC-004 | Relationship enum validation |
| ☐ | FAC-005 | Reputation modifier validation |
| ☐ | FAC-006 | Faction perk validation |

### Documentation

| Status | Document | Description |
|--------|----------|-------------|
| ☑ | Design Specification | This document |
| ☐ | Schema Documentation | Inline in schema file |

---

## 17. Acceptance Criteria

### Functional Criteria

- [ ] `factions.schema.json` created in `config/schemas/`
- [ ] Faction ID pattern validated (kebab-case)
- [ ] Reputation thresholds validated (6 levels, -1000 to 10000)
- [ ] Inter-faction relationships validated (6 types)
- [ ] Relationship references validated (faction IDs exist)
- [ ] Reputation modifiers validated (8 action types)
- [ ] Faction perks validated (threshold requirements)
- [ ] Vendor access validated
- [ ] Hidden faction flag supported
- [ ] ~6 unit tests pass

### Quality Criteria

- [ ] Schema follows JSON Schema Draft-07 specification
- [ ] All properties include descriptive comments
- [ ] Default values documented for optional fields
- [ ] Pattern constraints clearly specified
- [ ] Enum values documented with descriptions

### Integration Criteria

- [ ] Schema follows patterns from v0.14.9e (capture template schema)
- [ ] ID patterns use kebab-case (lowercase)
- [ ] Property names use camelCase
- [ ] Relationship types use PascalCase
- [ ] Compatible with dialogue.schema.json AffectedFaction references

---

## 18. Dependencies

### Required From

| Version | Dependency | Usage |
|---------|------------|-------|
| v0.14.9a | Dialogue Schema | AffectedFaction references |
| v0.14.8 | Dice Configuration Schemas | Schema infrastructure patterns |
| Existing | faction-reputation.md | Reputation system design |
| Existing | Faction definition files | Known factions reference |

### Provides To

| Version | Consumer | Usage |
|---------|----------|-------|
| v0.14.10b | Quest Schema | Reputation rewards |
| Future | FactionService | Faction data loading |
| Future | VendorService | Price modifier calculation |
| Future | DialogueService | Reputation change processing |

---

## 19. Future Considerations

### Deferred to Later Versions

| Feature | Rationale |
|---------|-----------|
| Reputation calculation logic | Runtime concern |
| Threshold transition events | Runtime concern |
| Faction AI behavior | Runtime concern |
| Witness system implementation | Runtime concern |
| Territory control mechanics | Separate game system |

### Potential Enhancements

| Enhancement | Description |
|-------------|-------------|
| Reputation decay | Gradual reputation loss over time |
| Faction territory maps | Geographic boundaries for factions |
| Dynamic relationships | Relationships that change based on world events |
| Faction wars | Special events when factions reach AtWar status |
| Faction reputation achievements | Titles and rewards for maximum reputation |
| Multiple reputation tracks | Separate tracks for trade, combat, knowledge |
| Faction quest chains | Multi-part quests that build faction standing |

---

## 20. Appendix: Known Factions Reference

### Major Factions (from design documents)

| ID | Name | Primary Territory | Philosophy |
|----|------|-------------------|------------|
| `rust-clans` | Rust Clans | Jötunheim (Utgard) | Creed of the Self—radical self-reliance |
| `midgard-combine` | Midgard Combine | Midgard Deck (Crossroads) | Pragmatic cooperation—agricultural priority |
| `iron-banes` | Iron-Bane Crusade | Trunk/Roots patrols | Anti-Undying zealotry—purification |
| `god-sleeper-cults` | God-Sleeper Cults | Jötunheim temples | Jötun-Forged worship—awakening the gods |
| `jotun-readers` | Jötun-Readers | Alfheim terminals | Pre-Glitch scholarship—knowledge preservation |
| `dvergr-guild` | Dvergr Guild | Nidavellir | Craftsmanship and trade—Pure Steel economy |
| `rangers-guild` | Rangers Guild | Trade routes | Infrastructure maintenance—neutral service |
| `scavenger-barons` | Scavenger Barons | Ice stations | Dreadnought control—Ice-Debt enforcement |
| `hearth-clans` | Hearth-Clans | Muspelheim | Thermal territory—volcanic survival |
| `forsaken` | The Forsaken | Niflheim | Ice-Debt survival—desperate refugees |
| `forlorn` | The Forlorn | Blight zones | Corrupted beings—hostile to all |

### Faction Relationship Matrix

```
                    Rust   Midgard  Iron   God    Jötun  Dvergr Rangers Forlorn
                    Clans  Combine  Banes  Sleep  Read   Guild  Guild
Rust Clans          -      Neutral  Hostile Hostile Friend Friend Neutral Hostile
Midgard Combine     Neutral -       Unfriend Neutral Friend Friend Allied Hostile
Iron-Banes          Hostile Unfriend -      AtWar  Unfriend Neutral Neutral Hostile
God-Sleeper Cults   Hostile Neutral  AtWar  -      Unfriend Neutral Neutral Hostile
Jötun-Readers       Friend  Friend   Unfriend Unfriend - Friend Neutral Hostile
Dvergr Guild        Friend  Friend   Neutral Neutral Friend -     Friend Hostile
Rangers Guild       Neutral Allied   Neutral Neutral Neutral Friend - Hostile
Forlorn             Hostile Hostile  Hostile Hostile Hostile Hostile Hostile -
```

### Starting Reputation Values

All players begin at 0 (Neutral) with each faction except:
- `forlorn` - Permanently Hostile (cannot gain reputation)

---

*End of v0.14.10a Design Specification*
