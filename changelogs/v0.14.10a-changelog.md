# v0.14.10a Changelog - Faction Schema

## Summary

Introduced the comprehensive **Faction Schema** (`factions.schema.json`) which validates faction definitions, reputation thresholds, inter-faction relationships, reputation modifiers, faction perks, and vendor access. This schema enables full customization of faction systems without code changes, supporting modding scenarios such as custom factions, reputation mechanics, and faction-based rewards. The schema integrates with dialogue outcomes (v0.14.9a) through `AffectedFaction` references and provides the foundation for quest rewards (v0.14.10b) that modify faction reputation. This is the first entry in the v0.14.10 Game Systems Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/factions.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/factions.schema.json)** - Comprehensive JSON Schema Draft-07

### Configuration File
- **[config/factions.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/factions.json)** - 5 faction definitions with complete configuration

### Schema Definitions (8 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `Faction` | Complete faction definition with identity and benefits | id, name, description |
| `ReputationThresholds` | Six threshold levels from hostile to exalted | all 6 levels |
| `ThresholdRange` | Single threshold with min/max/label | min, max, label |
| `FactionRelationship` | Relationship between factions with propagation | factionId, relationship |
| `ReputationModifier` | Action that modifies reputation | action, amount, description |
| `ModifierCondition` | Conditional modifier for reputation changes | type, modifier |
| `FactionPerk` | Benefit unlocked at reputation threshold | id, name, description, requiredThreshold, effect |
| `VendorAccess` | Faction-specific vendor access rules | vendorId, requiredThreshold |

### Relationship Type Enumeration (6 values)

| Type | Description | Typical reputationLink |
|------|-------------|------------------------|
| `Allied` | Close allies, shared goals | +50% to +75% |
| `Friendly` | Trading partners, mutual respect | +25% to +50% |
| `Neutral` | No strong opinion | null (no propagation) |
| `Unfriendly` | Tension, competition | null or -10% to -25% |
| `Hostile` | Active conflict, territorial disputes | -25% to -50% |
| `AtWar` | Open warfare | -50% to -75% |

### Action Type Enumeration (8 values)

| Action | Description | Typical Amount |
|--------|-------------|----------------|
| `KillMember` | Kill a faction member | -20 to -30 |
| `HelpMember` | Assist a faction member | +5 to +15 |
| `CompleteQuest` | Complete a faction quest | +15 to +50 |
| `FailQuest` | Fail a faction quest | -10 to -25 |
| `Theft` | Steal from faction | -10 to -20 |
| `Gift` | Give resources to faction | +5 to +15 |
| `Betrayal` | Major betrayal act | -50 to -100 |
| `Discovery` | Share valuable information | +10 to +30 |

### Condition Type Enumeration (4 values)

| Type | Effect |
|------|--------|
| `Witnessed` | Full reputation change (100%) |
| `Unwitnessed` | No change (0%) |
| `InTerritory` | Modifier for actions in faction territory |
| `IsLeader` | Enhanced modifier for targeting leaders |

### Effect Type Enumeration (5 values)

| Effect Type | Description | Example |
|------------|-------------|---------|
| `PriceModifier` | Modify vendor prices | -0.15 (15% discount) |
| `StatBonus` | Grant stat increase | +2 to Survival skill |
| `AccessGrant` | Unlock access to areas/services | "hidden-cache-locations" |
| `AbilityGrant` | Provide special ability | "gutter-galdr-training" |
| `ReputationBonus` | Bonus reputation from actions | +25% quest rewards |

### Reputation Thresholds (6 levels)

| Threshold | Range | Default Label | Typical Effects |
|-----------|-------|---------------|-----------------|
| `hostile` | -1000 to -501 | Hostile | Kill on sight, +50% prices |
| `unfriendly` | -500 to -1 | Unfriendly | Limited services, +25% prices |
| `neutral` | 0 to 499 | Neutral | Standard interactions |
| `friendly` | 500 to 2999 | Friendly | -10% prices, more quests |
| `allied` | 3000 to 8999 | Allied | -20% prices, faction perks |
| `exalted` | 9000 to 10000 | Exalted | -30% prices, unique rewards |

### Faction Definitions (5 Total)

| ID | Name | Description | Key Features |
|----|------|-------------|--------------|
| `rust-clans` | Rust Clans | Exile raiders in Jötunheim | 5 relationships, 8 modifiers, 3 perks, 2 vendors |
| `midgard-combine` | Midgard Combine | Agricultural alliance | 5 relationships, 5 modifiers, 2 perks, 2 vendors |
| `iron-banes` | Iron-Bane Crusade | Anti-Undying zealots | 3 relationships, 4 modifiers, 2 perks |
| `dvergr-guild` | Dvergr Guild | Dwarven craftsmen | 3 relationships, 3 modifiers, 2 perks, 2 vendors |
| `forlorn` | The Forlorn | Corrupted beings | Permanently hostile (custom thresholds) |

### Unit Tests
- **[FactionsSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/FactionsSchemaTests.cs)** - 35+ tests
  - `FactionsSchema_LoadsAndParses_Successfully` - Schema structure validation (8 definitions)
  - `FactionsSchema_ExistingConfiguration_PassesValidation` - Validates factions.json
  - `FactionIdentity_*` - 5 tests for ID and name patterns
  - `ThresholdRange_*` - 3 tests for threshold validation
  - `RelationshipType_*` - 4 tests for relationship enums
  - `ReputationModifier_*` - 5 tests for action validation
  - `FactionPerk_*` - 6 tests for perk structure
  - `VendorAccess_*` - 2 tests for vendor access
  - Additional validation tests - 6+ tests for color, version, hidden flag

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/factions.schema.json` | Added |
| `config/factions.json` | Added |
| `tests/.../Schemas/FactionsSchemaTests.cs` | Added |
| `changelogs/v0.14.10a-changelog.md` | Added |

## Faction Schema Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  FACTION CONFIGURATION                                         │
├─────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"             │
│  type: object                                                   │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ROOT PROPERTIES                                          │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ version: "1.0.0" (semver format)                    │  │  │
│  │  │ defaultThresholds: { hostile, unfriendly, ... }     │  │  │
│  │  │ factions: [ ... ] (array of Faction)                │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  FACTION DEFINITION                                       │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ id: "rust-clans" (kebab-case)                       │  │  │
│  │  │ name: "Rust Clans"                                  │  │  │
│  │  │ description: "Exile raiders..."                     │  │  │
│  │  │ iconId, color: "#B87333", headquarters, tags        │  │  │
│  │  │ isHidden: false                                     │  │  │
│  │  │ thresholds: { ... } (optional override)             │  │  │
│  │  │ relationships: [ ... ]                              │  │  │
│  │  │ reputationModifiers: [ ... ]                        │  │  │
│  │  │ perks: [ ... ]                                      │  │  │
│  │  │ vendors: [ ... ]                                    │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  FACTION RELATIONSHIP                                     │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ factionId: "dvergr-guild"                           │  │  │
│  │  │ relationship: "Friendly" | "Hostile" | "AtWar"...   │  │  │
│  │  │ reputationLink: 50 (% propagation)                  │  │  │
│  │  │ description: "Trade partners—salvage for steel"     │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  REPUTATION MODIFIER                                      │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ action: "KillMember" | "HelpMember" | ...           │  │  │
│  │  │ amount: -20 (positive or negative)                  │  │  │
│  │  │ conditions: [ { type, modifier } ]                  │  │  │
│  │  │ description: "Killing a faction member"             │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  FACTION PERK                                             │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ id: "scavengers-discount"                           │  │  │
│  │  │ name: "Scavenger's Discount"                        │  │  │
│  │  │ description: "Reduced prices at vendors..."         │  │  │
│  │  │ requiredThreshold: "friendly" | "allied" | "exalted"│  │  │
│  │  │ effect: { type, target, value }                     │  │  │
│  │  │ isPassive: true                                     │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  VENDOR ACCESS                                            │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ vendorId: "utgard-salvage-merchant"                 │  │  │
│  │  │ requiredThreshold: "neutral" | "friendly" | ...     │  │  │
│  │  │ priceModifier: 0.9 (10% discount)                   │  │  │
│  │  │ exclusiveItems: ["item-1", "item-2"]                │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## Reputation Propagation Flow

```
  Player Action: Help Rust Clans member (+10 rep)
                      │
                      ▼
  ┌───────────────────────────────────────┐
  │         RUST CLANS                    │
  │         Reputation: +10               │
  │                                       │
  │  Relationships:                       │
  │  ┌─────────────────────────────────┐  │
  │  │ dvergr-guild: Friendly          │  │
  │  │   reputationLink: 50%           │──┼──► +5 to Dvergr Guild
  │  │                                 │  │
  │  │ iron-banes: Hostile             │  │
  │  │   reputationLink: -25%          │──┼──► -2 to Iron-Banes
  │  │                                 │  │
  │  │ midgard-combine: Neutral        │  │
  │  │   reputationLink: null          │──┼──► No change
  │  └─────────────────────────────────┘  │
  └───────────────────────────────────────┘

  Propagation Rules:
  ═══════════════════
  • Positive reputationLink: Allied factions share positive rep
  • Negative reputationLink: Hostile factions receive opposite rep
  • null reputationLink: No propagation occurs
  • Propagation is one-way (does not chain to secondary factions)
```

## v0.14.10 Game Systems Schemas - Progress

| Version | Schema | Tests | Status |
|---------|--------|-------|--------|
| v0.14.10a | `factions.schema.json` | 35+ ✓ | **Complete** |
| v0.14.10b | `quests.schema.json` | ~6 | Pending |
| v0.14.10c | `codex.schema.json` | ~6 | Pending |
| v0.14.10d | `commands.schema.json` | ~6 | Pending |
| v0.14.10e | `glossary.schema.json` | ~6 | Pending |
| v0.14.10f | `stances.schema.json` | ~6 | Pending |
| **Total** | **6 schemas** | **~36 tests** | 1/6 complete |

## Integration Points

| System | Integration |
|--------|-------------|
| **Dialogue (v0.14.9a)** | `AffectedFaction` references faction IDs |
| **Quests (v0.14.10b)** | Reputation rewards reference faction IDs |
| **Vendors (v0.14.5)** | `VendorAccess` references vendor IDs |

## Modding Scenarios Enabled

After this implementation, modders can:
- Create custom factions with unique identities and colors
- Define custom reputation thresholds per faction
- Configure inter-faction relationships and reputation propagation
- Set up reputation modifiers for various player actions
- Create faction perks unlocked at reputation thresholds
- Configure faction-specific vendor access and discounts
- Define exclusive items available at higher reputation levels
- Create hidden factions revealed through gameplay

---

*First entry in v0.14.10 Game Systems Configuration Schemas series. Next: v0.14.10b (Quest Schema).*
