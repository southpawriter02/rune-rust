# v0.20.1c Changelog — Skjaldmær Tier 3 & Capstone Abilities

**Version**: 0.20.1c  
**Date**: 2026-02-10  
**Category**: Domain / Application / Infrastructure — Specialization Abilities

---

## Summary

Implements the Tier 3 abilities (**Unbreakable**, **Guardian's Sacrifice**) and the Capstone ultimate (**The Wall Lives**) for the Skjaldmær specialization. Introduces a `DamageService` for the damage reduction pipeline and extends the tier infrastructure to support Tier 4 (Capstone).

---

## Added

### Domain Layer — Value Objects

| File                                | Purpose                                                                        |
| ----------------------------------- | ------------------------------------------------------------------------------ |
| `ValueObjects/TheWallLivesState.cs` | Immutable sealed record for The Wall Lives capstone (3-turn lethal protection) |

### Application Layer — Interfaces

| File                           | Purpose                                            |
| ------------------------------ | -------------------------------------------------- |
| `Interfaces/IDamageService.cs` | Damage pipeline interface (reduction + protection) |

### Application Layer — Services

| File                                        | Purpose                                                      |
| ------------------------------------------- | ------------------------------------------------------------ |
| `Services/SkjaldmaerTier3AbilityService.cs` | Unbreakable, Guardian's Sacrifice, The Wall Lives lifecycle  |
| `Services/DamageService.cs`                 | Two-step damage pipeline: flat reduction → lethal protection |

### Unit Tests

| File                                                           | Tests    |
| -------------------------------------------------------------- | -------- |
| `ValueObjects/TheWallLivesStateTests.cs` (Domain)              | 12 tests |
| `Services/SkjaldmaerTier3AbilityServiceTests.cs` (Application) | 14 tests |
| `Services/DamageServiceTests.cs` (Application)                 | 8 tests  |

---

## Changed

### Application Layer

| File                                      | Change                                                                  |
| ----------------------------------------- | ----------------------------------------------------------------------- |
| `Interfaces/ISkjaldmaerAbilityService.cs` | Extended with Tier 3 & Capstone method signatures (v0.20.1b → v0.20.1c) |

### Infrastructure — Tier 4 Support

| File                                        | Change                                             |
| ------------------------------------------- | -------------------------------------------------- |
| `ValueObjects/SpecializationAbilityTier.cs` | Raised tier cap 3 → 4, added `CreateTier4` factory |
| `Services/SpecializationProvider.cs`        | Updated docstring for 1-4 tier range               |

### Configuration

| File                                         | Change                                                          |
| -------------------------------------------- | --------------------------------------------------------------- |
| `config/specializations.json`                | Added Tier 3 and Tier 4 (Capstone) ability entries to Skjaldmær |
| `config/schemas/specializations.schema.json` | Updated `maxItems`, `maximum` constraints for tier 4 support    |

---

## Technical Details

### Ability Specifications

| Ability              | Type     | Cost            | Effect                                                    | Duration  |
| -------------------- | -------- | --------------- | --------------------------------------------------------- | --------- |
| Unbreakable          | Passive  | —               | Reduces all incoming damage by 3 (minimum 1)              | Permanent |
| Guardian's Sacrifice | Reaction | 2 Block Charges | Absorb 100% of ally's incoming damage; Skjaldmær takes it | Instant   |
| The Wall Lives       | Active   | 4 AP            | HP cannot drop below 1; once per combat                   | 3 turns   |

### Damage Pipeline Order of Operations

1. **Unbreakable** — Flat damage reduction (-3, minimum 1 damage)
2. **The Wall Lives** — Lethal damage prevention (cap damage so HP ≥ 1)

---

## Verification

| Metric         | Result          |
| -------------- | --------------- |
| Build Errors   | 0               |
| Build Warnings | 0               |
| New Tests      | 34              |
| All Tests Pass | ✓ (4,334 total) |

---

## Dependencies

- **Depends on**: v0.20.1b (Tier 2 abilities, PrerequisiteService, HoldTheLineState)
- **Required by**: Future combat system integration, Guardian's Sacrifice ally-targeting implementation
