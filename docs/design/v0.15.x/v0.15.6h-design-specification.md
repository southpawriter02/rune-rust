# v0.15.6h Design Specification: Specialization Integration

**Version:** 0.15.6h
**Parent:** v0.15.6 (Advanced Perception System)
**Prerequisites:** v0.15.6g Complete (Investigation Command)
**Status:** Design Complete

---

## Table of Contents

1. [Overview](#1-overview)
2. [Scope](#2-scope)
3. [Data Model](#3-data-model)
4. [Services](#4-services)
5. [Command Changes](#5-command-changes)
6. [Rendering Changes](#6-rendering-changes)
7. [Configuration](#7-configuration)
8. [Integration with Existing Systems](#8-integration-with-existing-systems)
9. [Acceptance Criteria](#9-acceptance-criteria)
10. [Test Specifications](#10-test-specifications)
11. [Dependencies](#11-dependencies)
12. [Implementation Notes](#12-implementation-notes)
13. [Design Decisions](#13-design-decisions)
14. [Future Considerations](#14-future-considerations)
15. [Appendix A: Specialization Ability Examples](#appendix-a-specialization-ability-examples)
16. [Appendix B: Complete Ability Reference](#appendix-b-complete-ability-reference)

---

## 1. Overview

### 1.1 Purpose

This phase integrates specialization-specific perception abilities into the Advanced Perception System. Each archetype (Jötun-Reader, Ruin-Stalker, Veiðimaðr, Thul) receives unique abilities that enhance their perception capabilities in specialized domains. These abilities provide bonuses to examination, passive perception, and investigation based on the character's chosen specialization, creating meaningful differentiation between character builds.

### 1.2 Key Changes

| Area | Current State (v0.15.6g) | Target State (v0.15.6h) |
|------|--------------------------|------------------------|
| Examination Bonuses | Generic WITS-based | Specialization bonuses for specific object types |
| Passive Perception | WITS ÷ 2 for all | Specialization modifiers (+1/+2 for specific threats) |
| Auto-Success | None | Auto-succeed examination layers for specialty areas |
| Investigation Bonuses | WITS + Investigation | Specialization bonuses for specific target types |
| Ability Tracking | Not implemented | Specialization abilities registered and applied |

### 1.3 Design Principles

1. **Meaningful Specialization**: Each archetype excels in distinct perception domains
2. **Additive Bonuses**: Specialization bonuses add to base mechanics, don't replace them
3. **Conditional Activation**: Abilities activate only when conditions are met (object type, target type)
4. **Non-Exclusive Design**: Non-specialists can still succeed, just with more difficulty
5. **Consistent Integration**: Abilities hook into existing perception services seamlessly

---

## 2. Scope

### 2.1 In Scope

From the scope breakdown (lines 531-552):

**Jötun-Reader Abilities:**
- `[Deep Scan]` - +2d10 to examine machinery/terminals
- `[Pattern Recognition]` - Auto-succeed Layer 2 for Jötun tech

**Ruin-Stalker Abilities:**
- `[Trap Sense]` - +2 passive perception vs traps
- `[Sixth Sense]` - Auto-detect traps within 10 feet

**Veiðimaðr (Hunter) Abilities:**
- `[Keen Senses]` - +1 passive perception (always)
- `[Read the Signs]` - Bonus to investigate creature remains

**Thul Abilities:**
- `[Lore Keeper]` - Auto-succeed Layer 3 for historical objects
- `[Ancient Knowledge]` - Reveal extra lore on expert examination

- ISpecializationPerceptionService interface
- PerceptionAbility value object
- AbilityActivation tracking
- Integration hooks for IPassivePerceptionService, IExaminationService, IInvestigationService
- Configuration file: specialization-perception.json

### 2.2 Out of Scope (Future Phases)

- Room entry integration flow (v0.15.6i)
- Additional specializations beyond the four listed
- Ability upgrades or progression
- Multi-specialization combinations
- Specialization abilities for other skill systems (covered in their respective versions)

---

## 3. Data Model

### 3.1 PerceptionAbility Value Object

```csharp
/// <summary>
/// Represents a specialization-specific perception ability that modifies
/// examination, passive perception, or investigation mechanics.
/// </summary>
/// <remarks>
/// <para>
/// Perception abilities are granted by character specializations and provide
/// bonuses or automatic successes in specific domains. Each ability has
/// conditions that must be met for activation.
/// </para>
/// </remarks>
public sealed record PerceptionAbility
{
    /// <summary>
    /// Unique identifier for this ability.
    /// </summary>
    public required string AbilityId { get; init; }

    /// <summary>
    /// Display name for the ability (e.g., "[Deep Scan]").
    /// </summary>
    public required string AbilityName { get; init; }

    /// <summary>
    /// The specialization that grants this ability.
    /// </summary>
    public required string SpecializationId { get; init; }

    /// <summary>
    /// The type of perception this ability affects.
    /// </summary>
    public required PerceptionAbilityType AbilityType { get; init; }

    /// <summary>
    /// Description of what this ability does.
    /// </summary>
    public required string Description { get; init; }

    /// <summary>
    /// Conditions required for this ability to activate.
    /// </summary>
    public required AbilityCondition Condition { get; init; }

    /// <summary>
    /// The effect applied when the ability activates.
    /// </summary>
    public required AbilityEffect Effect { get; init; }

    /// <summary>
    /// Flavor text displayed when the ability activates.
    /// </summary>
    public string? ActivationText { get; init; }

    /// <summary>
    /// Whether this ability is passive (always active when conditions met)
    /// or requires explicit activation.
    /// </summary>
    public bool IsPassive { get; init; } = true;
}
```

### 3.2 PerceptionAbilityType Enum

```csharp
/// <summary>
/// Defines the type of perception system an ability affects.
/// </summary>
public enum PerceptionAbilityType
{
    /// <summary>
    /// Affects passive perception calculations (IPassivePerceptionService).
    /// </summary>
    PassivePerception,

    /// <summary>
    /// Affects examination checks and results (IExaminationService).
    /// </summary>
    Examination,

    /// <summary>
    /// Affects investigation checks and clue discovery (IInvestigationService).
    /// </summary>
    Investigation,

    /// <summary>
    /// Affects search operations (ISearchService).
    /// </summary>
    Search
}
```

### 3.3 AbilityCondition Value Object

```csharp
/// <summary>
/// Defines the conditions that must be met for a perception ability to activate.
/// </summary>
public sealed record AbilityCondition
{
    /// <summary>
    /// The type of condition check.
    /// </summary>
    public required ConditionType Type { get; init; }

    /// <summary>
    /// Target object categories that trigger this ability (for Examination).
    /// Example: ["Machinery", "Terminal"] for Jötun-Reader's Deep Scan.
    /// </summary>
    public IReadOnlyList<string> ObjectCategories { get; init; } = Array.Empty<string>();

    /// <summary>
    /// Target object types that trigger this ability (more specific).
    /// Example: ["JotunTech", "AncientTerminal"] for Pattern Recognition.
    /// </summary>
    public IReadOnlyList<string> ObjectTypes { get; init; } = Array.Empty<string>();

    /// <summary>
    /// Hidden element types that trigger this ability (for Passive Perception).
    /// Example: ["Trap"] for Ruin-Stalker's Trap Sense.
    /// </summary>
    public IReadOnlyList<string> ElementTypes { get; init; } = Array.Empty<string>();

    /// <summary>
    /// Investigation target types that trigger this ability.
    /// Example: ["Remains"] for Veiðimaðr's Read the Signs.
    /// </summary>
    public IReadOnlyList<string> InvestigationTargets { get; init; } = Array.Empty<string>();

    /// <summary>
    /// Distance in feet within which the ability applies (for proximity-based).
    /// Example: 10 for Ruin-Stalker's Sixth Sense.
    /// </summary>
    public int? ProximityFeet { get; init; }

    /// <summary>
    /// Whether this condition is always met (for unconditional bonuses).
    /// Example: true for Veiðimaðr's Keen Senses.
    /// </summary>
    public bool AlwaysActive { get; init; }

    /// <summary>
    /// Tags that must be present on the target for activation.
    /// Example: ["historical", "ancient"] for Thul's Lore Keeper.
    /// </summary>
    public IReadOnlyList<string> RequiredTags { get; init; } = Array.Empty<string>();
}
```

### 3.4 ConditionType Enum

```csharp
/// <summary>
/// Defines the type of condition check for ability activation.
/// </summary>
public enum ConditionType
{
    /// <summary>
    /// Ability activates based on object category being examined.
    /// </summary>
    ObjectCategory,

    /// <summary>
    /// Ability activates based on specific object type.
    /// </summary>
    ObjectType,

    /// <summary>
    /// Ability activates based on hidden element type.
    /// </summary>
    ElementType,

    /// <summary>
    /// Ability activates based on investigation target type.
    /// </summary>
    InvestigationTarget,

    /// <summary>
    /// Ability activates based on proximity to elements.
    /// </summary>
    Proximity,

    /// <summary>
    /// Ability is always active regardless of conditions.
    /// </summary>
    Always,

    /// <summary>
    /// Ability activates based on object tags.
    /// </summary>
    ObjectTags
}
```

### 3.5 AbilityEffect Value Object

```csharp
/// <summary>
/// Defines the effect applied when a perception ability activates.
/// </summary>
public sealed record AbilityEffect
{
    /// <summary>
    /// The type of effect applied.
    /// </summary>
    public required EffectType Type { get; init; }

    /// <summary>
    /// Bonus dice added to the pool (for DiceBonus effects).
    /// Example: 2 for Jötun-Reader's +2d10 Deep Scan.
    /// </summary>
    public int BonusDice { get; init; }

    /// <summary>
    /// Flat bonus added to perception value (for PassiveBonus effects).
    /// Example: 1 for Veiðimaðr's +1 passive perception.
    /// </summary>
    public int FlatBonus { get; init; }

    /// <summary>
    /// The examination layer that is auto-succeeded (for AutoSuccess effects).
    /// Example: 2 for Pattern Recognition, 3 for Lore Keeper.
    /// </summary>
    public int? AutoSuccessLayer { get; init; }

    /// <summary>
    /// Whether this effect causes auto-detection without a check.
    /// Example: true for Sixth Sense trap auto-detection.
    /// </summary>
    public bool AutoDetect { get; init; }

    /// <summary>
    /// Additional lore or information revealed by this effect.
    /// Example: Extra historical context for Thul's Ancient Knowledge.
    /// </summary>
    public string? BonusLoreKey { get; init; }

    /// <summary>
    /// Bonus to investigation checks (for Investigation effects).
    /// </summary>
    public int InvestigationBonus { get; init; }
}
```

### 3.6 EffectType Enum

```csharp
/// <summary>
/// Defines the type of effect a perception ability applies.
/// </summary>
public enum EffectType
{
    /// <summary>
    /// Adds bonus dice to the check pool.
    /// </summary>
    DiceBonus,

    /// <summary>
    /// Adds a flat bonus to passive perception.
    /// </summary>
    PassiveBonus,

    /// <summary>
    /// Automatically succeeds an examination layer.
    /// </summary>
    AutoSuccessLayer,

    /// <summary>
    /// Automatically detects elements without a check.
    /// </summary>
    AutoDetect,

    /// <summary>
    /// Reveals additional lore or information.
    /// </summary>
    BonusLore,

    /// <summary>
    /// Provides a bonus to investigation checks.
    /// </summary>
    InvestigationBonus
}
```

### 3.7 AbilityActivation Value Object

```csharp
/// <summary>
/// Records when and how a perception ability was activated.
/// Used for display and tracking purposes.
/// </summary>
public sealed record AbilityActivation
{
    /// <summary>
    /// The ability that was activated.
    /// </summary>
    public required PerceptionAbility Ability { get; init; }

    /// <summary>
    /// The character who used the ability.
    /// </summary>
    public required string CharacterId { get; init; }

    /// <summary>
    /// The target that triggered the activation.
    /// </summary>
    public required string TargetId { get; init; }

    /// <summary>
    /// Timestamp of activation.
    /// </summary>
    public required DateTime ActivatedAt { get; init; }

    /// <summary>
    /// The specific effect that was applied.
    /// </summary>
    public required string EffectApplied { get; init; }
}
```

---

## 4. Services

### 4.1 ISpecializationPerceptionService Interface

```csharp
/// <summary>
/// Provides specialization-based perception ability management and application.
/// Integrates with passive perception, examination, and investigation services.
/// </summary>
/// <remarks>
/// <para>
/// This service acts as a centralized registry for perception abilities
/// and provides methods to query and apply abilities based on character
/// specialization and current context.
/// </para>
/// </remarks>
public interface ISpecializationPerceptionService
{
    /// <summary>
    /// Gets all perception abilities for a character based on their specialization.
    /// </summary>
    /// <param name="characterId">The character to query.</param>
    /// <returns>All perception abilities available to this character.</returns>
    IReadOnlyList<PerceptionAbility> GetAbilitiesForCharacter(string characterId);

    /// <summary>
    /// Checks if any abilities apply to examining the specified object.
    /// </summary>
    /// <param name="characterId">The examining character.</param>
    /// <param name="objectCategory">The object's category.</param>
    /// <param name="objectType">The object's specific type.</param>
    /// <param name="objectTags">Tags associated with the object.</param>
    /// <returns>List of applicable abilities with their effects.</returns>
    IReadOnlyList<PerceptionAbility> GetExaminationAbilities(
        string characterId,
        string objectCategory,
        string objectType,
        IReadOnlyList<string> objectTags);

    /// <summary>
    /// Gets passive perception modifiers from specialization abilities.
    /// </summary>
    /// <param name="characterId">The character to query.</param>
    /// <param name="elementTypes">Optional: specific element types to check against.</param>
    /// <returns>Total passive perception bonus from abilities.</returns>
    int GetPassivePerceptionBonus(
        string characterId,
        IReadOnlyList<string>? elementTypes = null);

    /// <summary>
    /// Checks if a character auto-detects specific element types.
    /// </summary>
    /// <param name="characterId">The character to check.</param>
    /// <param name="elementType">The hidden element type.</param>
    /// <param name="distanceFeet">Distance to the element in feet.</param>
    /// <returns>True if auto-detection applies.</returns>
    bool CheckAutoDetection(
        string characterId,
        string elementType,
        int distanceFeet);

    /// <summary>
    /// Gets investigation bonuses for a specific target type.
    /// </summary>
    /// <param name="characterId">The investigating character.</param>
    /// <param name="targetType">The investigation target type.</param>
    /// <returns>Total bonus dice and other modifiers.</returns>
    InvestigationModifiers GetInvestigationModifiers(
        string characterId,
        string targetType);

    /// <summary>
    /// Checks if a character auto-succeeds an examination layer for the given object.
    /// </summary>
    /// <param name="characterId">The examining character.</param>
    /// <param name="objectCategory">The object's category.</param>
    /// <param name="objectType">The object's type.</param>
    /// <param name="objectTags">Tags on the object.</param>
    /// <param name="layer">The examination layer to check.</param>
    /// <returns>True if auto-success applies for this layer.</returns>
    bool CheckExaminationAutoSuccess(
        string characterId,
        string objectCategory,
        string objectType,
        IReadOnlyList<string> objectTags,
        int layer);

    /// <summary>
    /// Gets bonus lore keys that should be revealed for the given examination.
    /// </summary>
    /// <param name="characterId">The examining character.</param>
    /// <param name="objectId">The object being examined.</param>
    /// <param name="objectTags">Tags on the object.</param>
    /// <returns>List of bonus lore keys to reveal.</returns>
    IReadOnlyList<string> GetBonusLoreKeys(
        string characterId,
        string objectId,
        IReadOnlyList<string> objectTags);

    /// <summary>
    /// Records an ability activation for tracking purposes.
    /// </summary>
    /// <param name="activation">The activation to record.</param>
    Task RecordActivationAsync(AbilityActivation activation);
}
```

### 4.2 InvestigationModifiers Value Object

```csharp
/// <summary>
/// Contains all investigation modifiers from specialization abilities.
/// </summary>
public sealed record InvestigationModifiers
{
    /// <summary>
    /// Bonus dice to add to the investigation pool.
    /// </summary>
    public int BonusDice { get; init; }

    /// <summary>
    /// Flat bonus to add to the check result.
    /// </summary>
    public int FlatBonus { get; init; }

    /// <summary>
    /// Whether certain clue types are auto-discovered.
    /// </summary>
    public IReadOnlyList<string> AutoDiscoverClueTypes { get; init; } = Array.Empty<string>();

    /// <summary>
    /// Additional narrative text to include in results.
    /// </summary>
    public string? BonusNarrativeKey { get; init; }

    /// <summary>
    /// The abilities that contributed to these modifiers.
    /// </summary>
    public IReadOnlyList<PerceptionAbility> ContributingAbilities { get; init; }
        = Array.Empty<PerceptionAbility>();
}
```

### 4.3 SpecializationPerceptionService Implementation Notes

```csharp
/// <summary>
/// Implementation of the specialization perception service.
/// </summary>
public sealed class SpecializationPerceptionService : ISpecializationPerceptionService
{
    private readonly ICharacterService _characterService;
    private readonly ISpecializationRepository _specializationRepository;
    private readonly IAbilityConfiguration _abilityConfiguration;

    public IReadOnlyList<PerceptionAbility> GetAbilitiesForCharacter(string characterId)
    {
        // 1. Get character's specialization
        var specialization = _characterService.GetSpecialization(characterId);
        if (specialization == null)
            return Array.Empty<PerceptionAbility>();

        // 2. Look up abilities for this specialization
        return _abilityConfiguration.GetAbilitiesForSpecialization(specialization.Id);
    }

    public IReadOnlyList<PerceptionAbility> GetExaminationAbilities(
        string characterId,
        string objectCategory,
        string objectType,
        IReadOnlyList<string> objectTags)
    {
        var abilities = GetAbilitiesForCharacter(characterId);

        return abilities
            .Where(a => a.AbilityType == PerceptionAbilityType.Examination)
            .Where(a => ConditionMet(a.Condition, objectCategory, objectType, objectTags))
            .ToList();
    }

    public int GetPassivePerceptionBonus(
        string characterId,
        IReadOnlyList<string>? elementTypes = null)
    {
        var abilities = GetAbilitiesForCharacter(characterId);
        var totalBonus = 0;

        foreach (var ability in abilities.Where(a =>
            a.AbilityType == PerceptionAbilityType.PassivePerception))
        {
            // Check if ability is always active
            if (ability.Condition.AlwaysActive)
            {
                totalBonus += ability.Effect.FlatBonus;
                continue;
            }

            // Check if ability applies to specific element types
            if (elementTypes != null &&
                ability.Condition.ElementTypes.Any(et => elementTypes.Contains(et)))
            {
                totalBonus += ability.Effect.FlatBonus;
            }
        }

        return totalBonus;
    }

    public bool CheckAutoDetection(
        string characterId,
        string elementType,
        int distanceFeet)
    {
        var abilities = GetAbilitiesForCharacter(characterId);

        return abilities.Any(a =>
            a.AbilityType == PerceptionAbilityType.PassivePerception &&
            a.Effect.AutoDetect &&
            a.Condition.ElementTypes.Contains(elementType) &&
            (!a.Condition.ProximityFeet.HasValue ||
             distanceFeet <= a.Condition.ProximityFeet.Value));
    }

    public bool CheckExaminationAutoSuccess(
        string characterId,
        string objectCategory,
        string objectType,
        IReadOnlyList<string> objectTags,
        int layer)
    {
        var abilities = GetExaminationAbilities(
            characterId, objectCategory, objectType, objectTags);

        return abilities.Any(a =>
            a.Effect.Type == EffectType.AutoSuccessLayer &&
            a.Effect.AutoSuccessLayer >= layer);
    }

    private bool ConditionMet(
        AbilityCondition condition,
        string objectCategory,
        string objectType,
        IReadOnlyList<string> objectTags)
    {
        return condition.Type switch
        {
            ConditionType.Always => true,
            ConditionType.ObjectCategory =>
                condition.ObjectCategories.Contains(objectCategory),
            ConditionType.ObjectType =>
                condition.ObjectTypes.Contains(objectType),
            ConditionType.ObjectTags =>
                condition.RequiredTags.All(t => objectTags.Contains(t)),
            _ => false
        };
    }
}
```

### 4.4 Integration with IPassivePerceptionService

```csharp
// Modified IPassivePerceptionService to include specialization bonuses

public interface IPassivePerceptionService
{
    /// <summary>
    /// Calculates passive perception for a character, including specialization bonuses.
    /// </summary>
    PassivePerception CalculatePassivePerception(string characterId);

    // Existing methods...
}

// In implementation:
public PassivePerception CalculatePassivePerception(string characterId)
{
    // Base calculation
    var wits = _characterService.GetAttribute(characterId, "Wits");
    var basePassive = (int)Math.Ceiling(wits / 2.0);

    // Get status effect modifiers (existing)
    var statusModifiers = _statusEffectService.GetPerceptionModifiers(characterId);

    // NEW: Get specialization bonuses
    var specializationBonus = _specializationPerceptionService
        .GetPassivePerceptionBonus(characterId);

    var modifiers = new List<PerceptionModifier>();

    // Add specialization modifier if present
    if (specializationBonus > 0)
    {
        modifiers.Add(new PerceptionModifier
        {
            ModifierId = "specialization-bonus",
            Source = "Specialization",
            Value = specializationBonus,
            Description = "Specialization ability bonus"
        });
    }

    // Add status modifiers
    modifiers.AddRange(statusModifiers);

    var effectiveValue = basePassive + modifiers.Sum(m => m.Value);

    return new PassivePerception
    {
        CharacterId = characterId,
        WitsAttribute = wits,
        PassiveValue = basePassive,
        ModifierBreakdown = modifiers,
        EffectiveValue = effectiveValue
    };
}
```

### 4.5 Integration with IExaminationService

```csharp
// Modified examination flow to include specialization abilities

public ExaminationResult ExamineObject(
    string objectId,
    string characterId,
    SkillContext? context = null)
{
    var obj = _objectRepository.GetObject(objectId);

    // Check for auto-success from specialization
    var autoSuccessLayer = 1; // Layer 1 is always available

    if (_specializationPerceptionService.CheckExaminationAutoSuccess(
        characterId,
        obj.Category,
        obj.Type,
        obj.Tags,
        layer: 2))
    {
        autoSuccessLayer = 2;
    }

    if (_specializationPerceptionService.CheckExaminationAutoSuccess(
        characterId,
        obj.Category,
        obj.Type,
        obj.Tags,
        layer: 3))
    {
        autoSuccessLayer = 3;
    }

    // Get dice bonuses from specialization
    var abilities = _specializationPerceptionService.GetExaminationAbilities(
        characterId,
        obj.Category,
        obj.Type,
        obj.Tags);

    var bonusDice = abilities.Sum(a => a.Effect.BonusDice);

    // Perform check with bonuses
    var witsPool = _characterService.GetAttribute(characterId, "Wits");
    var totalPool = witsPool + bonusDice;

    var checkResult = _witsCheckService.PerformCheck(totalPool);

    // Determine highest layer unlocked
    var highestLayer = autoSuccessLayer;

    if (checkResult.TotalSuccesses >= 12 && highestLayer < 2)
        highestLayer = 2;
    if (checkResult.TotalSuccesses >= 18 && highestLayer < 3)
        highestLayer = 3;

    // Get bonus lore if applicable
    var bonusLoreKeys = _specializationPerceptionService.GetBonusLoreKeys(
        characterId,
        objectId,
        obj.Tags);

    // Build result...
}
```

---

## 5. Command Changes

### 5.1 No New Commands

This phase does not introduce new commands. Instead, it modifies the behavior of existing commands:

- `examine <object>` - Now includes specialization bonuses and auto-success
- Passive perception on room entry - Now includes specialization modifiers
- `investigate <target>` - Now includes specialization bonuses
- `search` - May include specialization bonuses (e.g., for Ruin-Stalker trap detection)

### 5.2 Modified Examine Output

When a specialization ability activates during examination:

```
> examine terminal

[Jötun-Reader: Deep Scan activated - +2d10]
[Jötun-Reader: Pattern Recognition - Layer 2 auto-success]

[WITS Check vs DC 18]
WITS Pool: 4d10 + 2d10 (Deep Scan) = 6d10
Rolling 6d10... 4, 7, 8, 9, 10, 2
Successes: 3 (8, 9, 10)

Layer 2 (Auto-success): A Jötun Command Terminal, designation CMD-7741...
Layer 3 (DC 18 - 3 successes): The terminal's memory core contains...

Your expertise with Jötun technology reveals additional insights:
[Ancient Knowledge] The designation CMD-7741 indicates this was a
primary command node for the Level 7 security grid...
```

### 5.3 Modified Passive Perception Output

```
As you enter the Collapsed Tunnel...

[Ruin-Stalker: Trap Sense - +2 passive perception vs traps]
[Ruin-Stalker: Sixth Sense activated]

Your honed instincts immediately alert you to danger!

[Trap Auto-Detected: Pressure Plate (8 feet ahead)]
A concealed pressure plate lies beneath the rubble. Your experience
with ruins makes such hazards obvious to you.
```

---

## 6. Rendering Changes

### 6.1 IAbilityActivationRenderer Interface

```csharp
/// <summary>
/// Renders ability activation notifications during perception checks.
/// </summary>
public interface IAbilityActivationRenderer
{
    /// <summary>
    /// Renders a notification that an ability has activated.
    /// </summary>
    /// <param name="ability">The activated ability.</param>
    /// <returns>Formatted activation text.</returns>
    string RenderActivation(PerceptionAbility ability);

    /// <summary>
    /// Renders bonus lore revealed by an ability.
    /// </summary>
    /// <param name="ability">The ability providing bonus lore.</param>
    /// <param name="loreText">The lore text to display.</param>
    /// <returns>Formatted lore text.</returns>
    string RenderBonusLore(PerceptionAbility ability, string loreText);

    /// <summary>
    /// Renders auto-detection notification.
    /// </summary>
    /// <param name="ability">The ability providing auto-detection.</param>
    /// <param name="element">The detected element.</param>
    /// <returns>Formatted detection text.</returns>
    string RenderAutoDetection(PerceptionAbility ability, HiddenElement element);
}
```

### 6.2 Ability Activation Format

```
[{SpecializationName}: {AbilityName} activated - {EffectDescription}]
```

Examples:
```
[Jötun-Reader: Deep Scan activated - +2d10]
[Ruin-Stalker: Trap Sense - +2 passive perception vs traps]
[Thul: Lore Keeper - Layer 3 auto-success]
[Veiðimaðr: Read the Signs - +2d10 to creature remains]
```

### 6.3 Auto-Detection Format

```
[{SpecializationName}: {AbilityName} activated]

Your {flavor_text_for_ability}!

[{ElementType} Auto-Detected: {ElementName} ({distance} feet away)]
{ElementDescription}
```

---

## 7. Configuration

### 7.1 Specialization Perception Configuration File

**File:** `data/config/specialization-perception.json`

```json
{
  "abilities": [
    {
      "abilityId": "jotun-reader-deep-scan",
      "abilityName": "[Deep Scan]",
      "specializationId": "jotun-reader",
      "abilityType": "Examination",
      "description": "+2d10 to examine machinery and terminals",
      "condition": {
        "type": "ObjectCategory",
        "objectCategories": ["Machinery", "Terminal", "Console", "Device"]
      },
      "effect": {
        "type": "DiceBonus",
        "bonusDice": 2
      },
      "activationText": "Your expertise with Jötun technology guides your analysis...",
      "isPassive": true
    },
    {
      "abilityId": "jotun-reader-pattern-recognition",
      "abilityName": "[Pattern Recognition]",
      "specializationId": "jotun-reader",
      "abilityType": "Examination",
      "description": "Auto-succeed Layer 2 for Jötun tech",
      "condition": {
        "type": "ObjectType",
        "objectTypes": ["JotunTerminal", "JotunConsole", "JotunMachinery", "JotunDevice"]
      },
      "effect": {
        "type": "AutoSuccessLayer",
        "autoSuccessLayer": 2
      },
      "activationText": "The familiar patterns of Jötun engineering are immediately apparent...",
      "isPassive": true
    },
    {
      "abilityId": "ruin-stalker-trap-sense",
      "abilityName": "[Trap Sense]",
      "specializationId": "ruin-stalker",
      "abilityType": "PassivePerception",
      "description": "+2 passive perception vs traps",
      "condition": {
        "type": "ElementType",
        "elementTypes": ["Trap", "PressurePlate", "Tripwire", "SpikeTrap", "DartTrap"]
      },
      "effect": {
        "type": "PassiveBonus",
        "flatBonus": 2
      },
      "activationText": "Your instincts for danger tingle...",
      "isPassive": true
    },
    {
      "abilityId": "ruin-stalker-sixth-sense",
      "abilityName": "[Sixth Sense]",
      "specializationId": "ruin-stalker",
      "abilityType": "PassivePerception",
      "description": "Auto-detect traps within 10 feet",
      "condition": {
        "type": "Proximity",
        "elementTypes": ["Trap", "PressurePlate", "Tripwire", "SpikeTrap", "DartTrap"],
        "proximityFeet": 10
      },
      "effect": {
        "type": "AutoDetect",
        "autoDetect": true
      },
      "activationText": "Your honed instincts immediately alert you to danger!",
      "isPassive": true
    },
    {
      "abilityId": "veidmadr-keen-senses",
      "abilityName": "[Keen Senses]",
      "specializationId": "veidmadr",
      "abilityType": "PassivePerception",
      "description": "+1 passive perception (always)",
      "condition": {
        "type": "Always",
        "alwaysActive": true
      },
      "effect": {
        "type": "PassiveBonus",
        "flatBonus": 1
      },
      "activationText": null,
      "isPassive": true
    },
    {
      "abilityId": "veidmadr-read-the-signs",
      "abilityName": "[Read the Signs]",
      "specializationId": "veidmadr",
      "abilityType": "Investigation",
      "description": "Bonus to investigate creature remains",
      "condition": {
        "type": "InvestigationTarget",
        "investigationTargets": ["Remains", "CreatureRemains", "Corpse"]
      },
      "effect": {
        "type": "InvestigationBonus",
        "bonusDice": 2
      },
      "activationText": "Your hunter's eye reads the signs of what befell this creature...",
      "isPassive": true
    },
    {
      "abilityId": "thul-lore-keeper",
      "abilityName": "[Lore Keeper]",
      "specializationId": "thul",
      "abilityType": "Examination",
      "description": "Auto-succeed Layer 3 for historical objects",
      "condition": {
        "type": "ObjectTags",
        "requiredTags": ["historical", "ancient"]
      },
      "effect": {
        "type": "AutoSuccessLayer",
        "autoSuccessLayer": 3
      },
      "activationText": "Ancient knowledge floods your mind as you recognize this artifact...",
      "isPassive": true
    },
    {
      "abilityId": "thul-ancient-knowledge",
      "abilityName": "[Ancient Knowledge]",
      "specializationId": "thul",
      "abilityType": "Examination",
      "description": "Reveal extra lore on expert examination",
      "condition": {
        "type": "ObjectTags",
        "requiredTags": ["historical"]
      },
      "effect": {
        "type": "BonusLore",
        "bonusLoreKey": "thul-ancient-lore"
      },
      "activationText": "Your extensive study of the old ways reveals deeper truths...",
      "isPassive": true
    }
  ],
  "specializations": {
    "jotun-reader": {
      "displayName": "Jötun-Reader",
      "perceptionFocus": "Technology and machinery"
    },
    "ruin-stalker": {
      "displayName": "Ruin-Stalker",
      "perceptionFocus": "Traps and hazards"
    },
    "veidmadr": {
      "displayName": "Veiðimaðr",
      "perceptionFocus": "Creatures and tracking"
    },
    "thul": {
      "displayName": "Thul",
      "perceptionFocus": "History and lore"
    }
  }
}
```

---

## 8. Integration with Existing Systems

### 8.1 Passive Perception Integration (v0.15.6a)

The specialization service hooks into passive perception calculation:

```csharp
// In PassivePerceptionService.CalculatePassivePerception():

// Base calculation from WITS
var basePassive = (int)Math.Ceiling(wits / 2.0);

// Get specialization bonus (Veiðimaðr Keen Senses = +1)
var specializationBonus = _specializationPerceptionService
    .GetPassivePerceptionBonus(characterId);

// For trap-specific checks, include conditional bonuses
var trapBonus = _specializationPerceptionService
    .GetPassivePerceptionBonus(characterId, new[] { "Trap" });
```

### 8.2 Examination Integration (v0.15.6b)

The examination service checks for specialization abilities:

```csharp
// In ExaminationService.ExamineObject():

// Check for dice bonuses
var abilities = _specializationPerceptionService.GetExaminationAbilities(
    characterId, obj.Category, obj.Type, obj.Tags);
var bonusDice = abilities.Sum(a => a.Effect.BonusDice);

// Check for auto-success
if (_specializationPerceptionService.CheckExaminationAutoSuccess(
    characterId, obj.Category, obj.Type, obj.Tags, layer: 2))
{
    // Layer 2 is automatically successful
}
```

### 8.3 Investigation Integration (v0.15.6g)

The investigation service gets specialization modifiers:

```csharp
// In InvestigationService.InvestigateAsync():

var modifiers = _specializationPerceptionService.GetInvestigationModifiers(
    characterId,
    targetType.ToString());

// Apply bonus dice
var totalPool = witsPool + investigationRank + modifiers.BonusDice;
```

### 8.4 Hidden Element Detection (v0.15.6a)

For auto-detection abilities like Sixth Sense:

```csharp
// In PassivePerceptionService.CheckRoomEntry():

foreach (var element in hiddenElements)
{
    // Calculate distance to element
    var distance = CalculateDistance(characterPosition, element.Position);

    // Check for auto-detection (Ruin-Stalker Sixth Sense)
    if (_specializationPerceptionService.CheckAutoDetection(
        characterId, element.ElementType, distance))
    {
        // Auto-reveal without check
        RevealElement(element.ElementId, characterId, isAutoDetect: true);
        autoDetectedElements.Add(element);
    }
}
```

---

## 9. Acceptance Criteria

### 9.1 Jötun-Reader Abilities

| ID | Criterion | Priority |
|----|-----------|----------|
| AC-1 | `[Deep Scan]` adds +2d10 when examining machinery/terminals | Must |
| AC-2 | `[Pattern Recognition]` auto-succeeds Layer 2 for Jötun tech | Must |
| AC-3 | Ability activation is displayed in examine output | Must |

### 9.2 Ruin-Stalker Abilities

| ID | Criterion | Priority |
|----|-----------|----------|
| AC-4 | `[Trap Sense]` adds +2 to passive perception vs traps | Must |
| AC-5 | `[Sixth Sense]` auto-detects traps within 10 feet | Must |
| AC-6 | Auto-detection displays appropriate notification | Must |

### 9.3 Veiðimaðr Abilities

| ID | Criterion | Priority |
|----|-----------|----------|
| AC-7 | `[Keen Senses]` adds +1 to passive perception (always) | Must |
| AC-8 | `[Read the Signs]` adds bonus to creature remains investigation | Must |

### 9.4 Thul Abilities

| ID | Criterion | Priority |
|----|-----------|----------|
| AC-9 | `[Lore Keeper]` auto-succeeds Layer 3 for historical objects | Must |
| AC-10 | `[Ancient Knowledge]` reveals extra lore on expert examination | Must |

### 9.5 Integration

| ID | Criterion | Priority |
|----|-----------|----------|
| AC-11 | Abilities only activate for characters with matching specialization | Must |
| AC-12 | Multiple applicable abilities stack correctly | Should |
| AC-13 | Non-specialists can still succeed at higher DCs | Must |

---

## 10. Test Specifications

### 10.1 Unit Tests

#### Test Suite: SpecializationPerceptionServiceTests

```csharp
[TestClass]
public class SpecializationPerceptionServiceTests
{
    /// <summary>
    /// Verifies that Ruin-Stalker trap bonus applies to passive perception.
    /// </summary>
    /// <remarks>
    /// Given: Character with Ruin-Stalker specialization
    /// When: Calculating passive perception for traps
    /// Then: +2 bonus is applied
    /// </remarks>
    [TestMethod]
    public void GetPassivePerceptionBonus_RuinStalkerVsTraps_Returns2()
    {
        // Arrange
        var characterId = "char-ruinstalker-1";
        _characterServiceMock.Setup(c => c.GetSpecialization(characterId))
            .Returns(new Specialization { Id = "ruin-stalker" });

        // Act
        var bonus = _service.GetPassivePerceptionBonus(
            characterId,
            new[] { "Trap" });

        // Assert
        Assert.AreEqual(2, bonus);
    }

    /// <summary>
    /// Verifies that Thul auto-succeeds Layer 3 for historical objects.
    /// </summary>
    /// <remarks>
    /// Given: Character with Thul specialization
    /// When: Examining an object with "historical" and "ancient" tags
    /// Then: Layer 3 auto-success is granted
    /// </remarks>
    [TestMethod]
    public void CheckExaminationAutoSuccess_ThulHistoricalObject_ReturnsTrue()
    {
        // Arrange
        var characterId = "char-thul-1";
        _characterServiceMock.Setup(c => c.GetSpecialization(characterId))
            .Returns(new Specialization { Id = "thul" });

        var objectTags = new[] { "historical", "ancient" };

        // Act
        var autoSuccess = _service.CheckExaminationAutoSuccess(
            characterId,
            "Decorative",
            "Inscription",
            objectTags,
            layer: 3);

        // Assert
        Assert.IsTrue(autoSuccess);
    }

    /// <summary>
    /// Verifies that non-specialists do not receive ability bonuses.
    /// </summary>
    [TestMethod]
    public void GetPassivePerceptionBonus_NonSpecialist_ReturnsZero()
    {
        // Arrange
        var characterId = "char-generic-1";
        _characterServiceMock.Setup(c => c.GetSpecialization(characterId))
            .Returns((Specialization)null);

        // Act
        var bonus = _service.GetPassivePerceptionBonus(characterId);

        // Assert
        Assert.AreEqual(0, bonus);
    }

    /// <summary>
    /// Verifies Veiðimaðr Keen Senses always applies.
    /// </summary>
    [TestMethod]
    public void GetPassivePerceptionBonus_VeidmadrAlways_Returns1()
    {
        // Arrange
        var characterId = "char-veidmadr-1";
        _characterServiceMock.Setup(c => c.GetSpecialization(characterId))
            .Returns(new Specialization { Id = "veidmadr" });

        // Act - No element types specified
        var bonus = _service.GetPassivePerceptionBonus(characterId);

        // Assert
        Assert.AreEqual(1, bonus);
    }
}
```

### 10.2 Test Coverage Requirements

| Area | Minimum Coverage | Priority |
|------|------------------|----------|
| SpecializationPerceptionService | 95% | Critical |
| Ability condition matching | 100% | Critical |
| Integration with PassivePerceptionService | 90% | High |
| Integration with ExaminationService | 90% | High |
| Auto-detection logic | 95% | High |

---

## 11. Dependencies

### 11.1 Upstream Dependencies

| Dependency | Source | Usage |
|------------|--------|-------|
| IPassivePerceptionService | v0.15.6a | Hook for passive bonus application |
| IExaminationService | v0.15.6b | Hook for examination bonuses/auto-success |
| IInvestigationService | v0.15.6g | Hook for investigation bonuses |
| ISearchService | v0.15.6f | Hook for search-related bonuses |
| HiddenElement | v0.15.6a | Element type for condition matching |
| ICharacterService | Core | Get character specialization |

### 11.2 External Dependencies

| Dependency | Version | Purpose |
|------------|---------|---------|
| ISpecializationRepository | Core | Specialization data access |
| IConfigurationService | Core | Ability configuration loading |

### 11.3 Downstream Dependencies

This phase provides to future phases:

| Provides To | Interface/Component | Purpose |
|-------------|---------------------|---------|
| v0.15.6i | ISpecializationPerceptionService | Room entry uses specialization bonuses |
| Future | AbilityActivation | Tracking for achievements/statistics |

### 11.4 Dependency Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                  v0.15.6h Specialization Integration                 │
├─────────────────────────────────────────────────────────────────────┤
│  ISpecializationPerceptionService   PerceptionAbility               │
│  AbilityCondition   AbilityEffect   AbilityActivation               │
└───────────────────────────────┬─────────────────────────────────────┘
                                │
            ┌───────────────────┼───────────────────┐
            │                   │                   │
            ▼                   ▼                   ▼
┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
│ v0.15.6a Passive  │  │ v0.15.6b Examine  │  │ v0.15.6g Invest   │
│ Perception        │  │                   │  │                   │
│ ─────────────     │  │ ─────────────     │  │ ─────────────     │
│ Passive bonuses   │  │ Dice bonuses      │  │ Investigation     │
│ Auto-detection    │  │ Auto-success      │  │ bonuses           │
│ Trap sense        │  │ Bonus lore        │  │                   │
└───────────────────┘  └───────────────────┘  └───────────────────┘
            │                   │                   │
            └───────────────────┼───────────────────┘
                                │
                                ▼
            ┌───────────────────────────────────────┐
            │           Core Services               │
            │  ICharacterService                    │
            │  ISpecializationRepository            │
            └───────────────────────────────────────┘
```

---

## 12. Implementation Notes

### 12.1 Architecture Layers

```
┌─────────────────────────────────────────────────────────────────────┐
│                    Presentation Layer                                │
├─────────────────────────────────────────────────────────────────────┤
│  AbilityActivationRenderer                                          │
│  - Renders ability activation notifications                         │
│  - Formats bonus lore displays                                      │
│  - Displays auto-detection alerts                                   │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    Application Layer                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ISpecializationPerceptionService                                   │
│  - Manages ability registry                                         │
│  - Evaluates conditions                                             │
│  - Applies effects                                                  │
│  - Tracks activations                                               │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      Domain Layer                                    │
├─────────────────────────────────────────────────────────────────────┤
│  PerceptionAbility          AbilityCondition                        │
│  AbilityEffect              AbilityActivation                       │
│  PerceptionAbilityType      ConditionType                           │
│  EffectType                 InvestigationModifiers                  │
└─────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   Infrastructure Layer                               │
├─────────────────────────────────────────────────────────────────────┤
│  AbilityConfigurationLoader                                         │
│  SpecializationRepository                                           │
└─────────────────────────────────────────────────────────────────────┘
```

### 12.2 Implementation Order

1. **Domain Models** (~Day 1)
   - PerceptionAbility value object
   - AbilityCondition value object
   - AbilityEffect value object
   - PerceptionAbilityType enum
   - ConditionType enum
   - EffectType enum

2. **Configuration** (~Day 1)
   - specialization-perception.json
   - Configuration loader

3. **Service Layer** (~Day 2)
   - ISpecializationPerceptionService interface
   - SpecializationPerceptionService implementation
   - Condition evaluation logic

4. **Integration** (~Day 2-3)
   - Modify IPassivePerceptionService
   - Modify IExaminationService
   - Modify IInvestigationService

5. **Rendering** (~Day 3)
   - IAbilityActivationRenderer
   - Activation notification formatting

6. **Testing** (~Day 3)
   - SpecializationPerceptionServiceTests
   - Integration tests

---

## 13. Design Decisions

### 13.1 Additive vs Replacement Design

**Decision:** Specialization abilities add to base mechanics rather than replacing them.

**Rationale:**
- Non-specialists can still succeed with higher rolls
- Maintains challenge for all characters
- Specialists get advantages, not exclusivity
- Simpler to balance and understand

### 13.2 Passive Ability Activation

**Decision:** All perception abilities are passive (activate automatically when conditions met).

**Rationale:**
- Reduces command complexity
- Players don't need to remember to activate abilities
- Matches the "innate expertise" flavor of specializations
- Consistent with passive perception design

### 13.3 Conditional vs Always-On Abilities

**Decision:** Support both conditional and always-on abilities.

**Rationale:**
- Veiðimaðr's Keen Senses is always active (+1 perception)
- Ruin-Stalker's Trap Sense only activates vs traps
- Provides variety in ability design
- Matches thematic expectations

### 13.4 Proximity-Based Detection

**Decision:** Support proximity conditions for abilities like Sixth Sense.

**Rationale:**
- Creates tactical gameplay (approach carefully to auto-detect traps)
- Matches realistic "danger sense" concept
- Distance calculation already exists in room system
- Enables interesting dungeon navigation

---

## 14. Future Considerations

### 14.1 Planned Enhancements (v0.15.6i)

- **Room Entry Flow:** Integrate specialization checks into room entry sequence

### 14.2 Post-v0.15.6 Potential Features

- **Ability Upgrades:** Higher ranks unlock improved versions
- **Multi-Specialization:** Characters with multiple specializations
- **Temporary Abilities:** Items or effects that grant specialization abilities
- **Ability Cooldowns:** Some abilities might have usage limits
- **Party Synergy:** Abilities that benefit nearby party members

---

## Appendix A: Specialization Ability Examples

### A.1 Jötun-Reader Examination

```
> examine terminal

[Jötun-Reader: Deep Scan activated - +2d10]
[Jötun-Reader: Pattern Recognition - Layer 2 auto-success]

[WITS Check vs DC 18]
WITS Pool: 4d10 + 2d10 (Deep Scan) = 6d10
Rolling 6d10... 4, 7, 8, 9, 10, 2
Successes: 3 (8, 9, 10)

─── Jötun Command Terminal, Designation CMD-7741 ───

Layer 1 (Cursory):
A large terminal with a cracked display, partially covered in dust.

Layer 2 (Auto-Success via Pattern Recognition):
A Jötun Command Terminal, designation CMD-7741. The primary interface
remains functional despite surface damage. Standard security protocols
are in effect, but the authentication module shows signs of corruption.

Layer 3 (DC 18 - 3 successes):
The terminal's memory core contains fragmentary logs from the facility's
final days. The corruption pattern suggests deliberate data purging.

[Ancient Knowledge]
Your expertise reveals: The CMD-7741 designation indicates this was a
primary command node for the Level 7 security grid. Such terminals
typically have backup authentication paths through the maintenance
subsystem—knowledge that less specialized individuals would lack.
```

### A.2 Ruin-Stalker Trap Detection

```
As you enter the Collapsed Tunnel...

[Ruin-Stalker: Keen Senses - +1 passive perception]
Passive Perception: 4 (base 3 + 1 specialization)

[Ruin-Stalker: Trap Sense activated - +2 vs traps]
Effective Perception vs Traps: 6

[Ruin-Stalker: Sixth Sense activated]

Your honed instincts immediately alert you to danger!

[Trap Auto-Detected: Pressure Plate (8 feet ahead)]
A concealed pressure plate lies beneath the rubble, positioned to
trigger when stepped upon. Your years of navigating deadly ruins make
such hazards obvious to you, even in poor lighting.

[Trap Revealed: Dart Launcher (DC 4)]
Your heightened perception also notices a dart launcher mechanism
embedded in the wall, connected to the pressure plate.
```

### A.3 Thul Historical Object Examination

```
> examine inscription

[Thul: Lore Keeper - Layer 3 auto-success for historical objects]

─── Ancient Wall Inscription ───

Layer 1 (Cursory):
Faded carvings cover this section of wall, depicting figures and symbols.

Layer 2 (DC 12 - included):
The inscription uses Old Dvergr script, a formal ceremonial variant.
The craftsmanship suggests this dates to the Second Founding.

Layer 3 (Auto-Success via Lore Keeper):
The inscription records a covenant between the Forge-Lords and the
Runic Assembly, granting this level special protections. The final
line contains what appears to be a command phrase—speaking it might
still activate ancient mechanisms.

[Ancient Knowledge]
Your deep study of historical texts reveals additional context: This
covenant was one of only seven such agreements made during the Second
Founding. The command phrase "Járn-vakinn" ("Iron-Awakened") was used
to activate defensive protocols. This knowledge is mentioned in only
two surviving texts.

[Hint Revealed: Speak Command Phrase]
[New command available: speak jarn-vakinn]
```

---

## Appendix B: Complete Ability Reference

### B.1 Ability Summary Table

| Specialization | Ability | Type | Effect |
|----------------|---------|------|--------|
| Jötun-Reader | [Deep Scan] | Examination | +2d10 vs machinery/terminals |
| Jötun-Reader | [Pattern Recognition] | Examination | Auto-succeed Layer 2 for Jötun tech |
| Ruin-Stalker | [Trap Sense] | Passive | +2 passive perception vs traps |
| Ruin-Stalker | [Sixth Sense] | Passive | Auto-detect traps within 10 feet |
| Veiðimaðr | [Keen Senses] | Passive | +1 passive perception (always) |
| Veiðimaðr | [Read the Signs] | Investigation | +2d10 to creature remains investigation |
| Thul | [Lore Keeper] | Examination | Auto-succeed Layer 3 for historical objects |
| Thul | [Ancient Knowledge] | Examination | Reveal extra lore on expert examination |

### B.2 Condition Quick Reference

| Condition Type | Description | Example |
|----------------|-------------|---------|
| Always | No conditions, always active | Keen Senses |
| ObjectCategory | Triggers on object categories | Deep Scan (Machinery, Terminal) |
| ObjectType | Triggers on specific types | Pattern Recognition (JotunTech) |
| ObjectTags | Triggers on object tags | Lore Keeper (historical, ancient) |
| ElementType | Triggers on hidden element types | Trap Sense (Trap) |
| Proximity | Triggers within distance | Sixth Sense (10 feet) |
| InvestigationTarget | Triggers on investigation targets | Read the Signs (Remains) |

### B.3 Effect Quick Reference

| Effect Type | Description | Value |
|-------------|-------------|-------|
| DiceBonus | Add bonus dice to pool | +2d10 |
| PassiveBonus | Add flat bonus to passive | +1 or +2 |
| AutoSuccessLayer | Skip check for layer | Layer 2 or 3 |
| AutoDetect | Reveal without check | Boolean |
| BonusLore | Reveal additional text | Lore key |
| InvestigationBonus | Add dice to investigation | +2d10 |

---

*This design specification provides the detailed blueprint for implementing v0.15.6h Specialization Integration. See the scope breakdown for integration context with other v0.15.6 sub-phases.*
