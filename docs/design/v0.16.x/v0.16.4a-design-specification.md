# v0.16.4a Design Specification: Container Type System

## Document Information

| Field            | Value                                                                |
| ---------------- | -------------------------------------------------------------------- |
| Version          | v0.16.4a                                                             |
| Parent Version   | v0.16.4 - Container Loot Generation                                  |
| Epic             | v0.16.x - Advanced Loot & Proficiency Systems                        |
| Status           | Draft                                                                |
| Created          | 2025-01-XX                                                           |
| Scope Breakdown  | [v0.16.4-scope-breakdown.md](v0.16.4-scope-breakdown.md)             |
| Previous Version | [v0.16.3e-design-specification.md](v0.16.3e-design-specification.md) |

---

## 1. Executive Summary

### 1.1 Overview

Version 0.16.4a introduces the **Container Type System**, establishing the foundational data structures that define container categories and their loot specifications. This sub-phase creates the `ContainerType` enum, `ContainerTypeDefinition` value object, and the `container-types.json` configuration file.

### 1.2 Key Deliverables

| Category             | Count | Artifact                      |
| -------------------- | ----- | ----------------------------- |
| Domain Enums         | 1     | `ContainerType`               |
| Domain Value Objects | 1     | `ContainerTypeDefinition`     |
| Configuration Files  | 1     | `container-types.json`        |
| JSON Schemas         | 1     | `container-types.schema.json` |
| Unit Tests           | ~2    | Definition validation tests   |

### 1.3 Success Metrics

- All 10 container types defined with correct specifications
- Configuration file validates against JSON schema
- Unit tests pass for value object creation and validation

---

## 2. Feature Overview

### 2.1 Feature Tree

```
v0.16.4a: Container Type System
├── ContainerType Enum
│   ├── SmallChest
│   ├── MediumChest
│   ├── LargeChest
│   ├── BossChest
│   ├── HiddenCache
│   ├── Corpse
│   ├── Locker
│   ├── SupplyCrate
│   ├── WeaponRack
│   └── ArmorStand
├── ContainerTypeDefinition Value Object
│   ├── Type identifier
│   ├── Item count range (min/max)
│   ├── Quality tier range (min/max)
│   ├── Currency range (min/max, nullable)
│   ├── Item category filter (nullable)
│   ├── Discovery difficulty class (nullable)
│   └── Special flags
└── Configuration
    ├── container-types.json
    └── container-types.schema.json
```

### 2.2 Scope Boundaries

**In Scope:**

- `ContainerType` enum with 10 container categories
- `ContainerTypeDefinition` value object with all specification properties
- `container-types.json` configuration file
- `container-types.schema.json` validation schema
- Unit tests for value object validation

**Out of Scope:**

- Loot generation logic (v0.16.4d)
- Container state persistence (v0.16.4e)
- Room integration (v0.16.4f)
- Container entity creation (v0.16.4b)

---

## 3. Architecture Diagrams

### 3.1 Component Relationship Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    CONFIGURATION LAYER                          │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                  container-types.json                      │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │  │
│  │  │ SmallChest  │ │ MediumChest │ │ LargeChest  │ ...      │  │
│  │  │ Items: 1-2  │ │ Items: 2-4  │ │ Items: 3-5  │          │  │
│  │  │ Tier: 0-1   │ │ Tier: 1-2   │ │ Tier: 2-3   │          │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘          │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼ Loaded by (future v0.16.4d)
┌─────────────────────────────────────────────────────────────────┐
│                      DOMAIN LAYER                                │
│  ┌────────────────────┐    ┌─────────────────────────────────┐  │
│  │   ContainerType    │    │   ContainerTypeDefinition       │  │
│  │   (Enum)           │◄───│   (Value Object)                │  │
│  │                    │    │                                 │  │
│  │ • SmallChest       │    │ • ContainerType Type            │  │
│  │ • MediumChest      │    │ • int MinItems, MaxItems        │  │
│  │ • LargeChest       │    │ • int MinTier, MaxTier          │  │
│  │ • BossChest        │    │ • int? MinCurrency, MaxCurrency │  │
│  │ • HiddenCache      │    │ • string? ItemCategoryFilter    │  │
│  │ • Corpse           │    │ • int? DiscoveryDC              │  │
│  │ • Locker           │    │ • ContainerFlags Flags          │  │
│  │ • SupplyCrate      │    └─────────────────────────────────┘  │
│  │ • WeaponRack       │                                         │
│  │ • ArmorStand       │                                         │
│  └────────────────────┘                                         │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 Data Flow Diagram

```
┌──────────────────┐     ┌───────────────────┐     ┌─────────────────────┐
│ container-types  │     │ JSON Deserializer │     │ ContainerType       │
│ .json            │────▶│ (future v0.16.4d) │────▶│ Definition          │
│                  │     │                   │     │ Dictionary          │
└──────────────────┘     └───────────────────┘     └─────────────────────┘
                                                            │
                                                            ▼
                                               ┌─────────────────────────┐
                                               │ IContainerLootService   │
                                               │ (future v0.16.4d)       │
                                               └─────────────────────────┘
```

---

## 4. Feature Section: ContainerType Enum

### 4.1 Purpose

The `ContainerType` enum defines the 10 distinct container categories available in the game. Each type represents a different source of loot with unique characteristics.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/ContainerType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the categories of containers that can contain loot.
/// </summary>
/// <remarks>
/// Each container type has associated specifications defining item counts,
/// quality tier ranges, currency amounts, and special behaviors.
/// Specifications are loaded from container-types.json configuration.
/// </remarks>
public enum ContainerType
{
    /// <summary>
    /// A small treasure chest with modest contents.
    /// </summary>
    /// <remarks>
    /// Items: 1-2, Tier: 0-1, Currency: 10-30 gold.
    /// Common in early game areas.
    /// </remarks>
    SmallChest = 0,

    /// <summary>
    /// A medium-sized treasure chest with moderate contents.
    /// </summary>
    /// <remarks>
    /// Items: 2-4, Tier: 1-2, Currency: 25-75 gold.
    /// Standard container for mid-level areas.
    /// </remarks>
    MediumChest = 1,

    /// <summary>
    /// A large treasure chest with valuable contents.
    /// </summary>
    /// <remarks>
    /// Items: 3-5, Tier: 2-3, Currency: 50-150 gold.
    /// Found in challenging areas or as quest rewards.
    /// </remarks>
    LargeChest = 2,

    /// <summary>
    /// A boss-level treasure chest with exceptional contents.
    /// </summary>
    /// <remarks>
    /// Items: 4-6, Tier: 3-4, Currency: 100-300 gold.
    /// Has a chance to contain Myth-Forged quality items.
    /// </remarks>
    BossChest = 3,

    /// <summary>
    /// A hidden cache requiring discovery.
    /// </summary>
    /// <remarks>
    /// Items: 1-3, Tier: 1-3, Currency: 50-200 gold.
    /// Requires DC 14 Perception check to find.
    /// </remarks>
    HiddenCache = 4,

    /// <summary>
    /// A corpse that may contain loot.
    /// </summary>
    /// <remarks>
    /// Items: 0-2, Tier: 0-1, Currency: 5-20 gold.
    /// May be completely empty (minimum 0 items).
    /// </remarks>
    Corpse = 5,

    /// <summary>
    /// A storage locker with general supplies.
    /// </summary>
    /// <remarks>
    /// Items: 1-3, Tier: 0-2, Currency: 15-50 gold.
    /// Common in civilized areas and dungeons.
    /// </remarks>
    Locker = 6,

    /// <summary>
    /// A supply crate containing consumable items only.
    /// </summary>
    /// <remarks>
    /// Items: 2-3, Tier: 0-1, No currency.
    /// Restricted to consumable item category.
    /// </remarks>
    SupplyCrate = 7,

    /// <summary>
    /// A weapon rack containing weapons only.
    /// </summary>
    /// <remarks>
    /// Items: 1-2, Tier: 1-3, No currency.
    /// Restricted to weapon item category.
    /// </remarks>
    WeaponRack = 8,

    /// <summary>
    /// An armor stand containing a single armor piece.
    /// </summary>
    /// <remarks>
    /// Items: 1, Tier: 1-3, No currency.
    /// Restricted to armor item category.
    /// </remarks>
    ArmorStand = 9
}
```

### 4.3 Design Decisions

| Decision                | Rationale                                          |
| ----------------------- | -------------------------------------------------- |
| Explicit integer values | Ensures stable serialization and database storage  |
| 10 distinct types       | Covers common container scenarios in dungeon games |
| XML documentation       | Self-documenting specifications for each type      |

---

## 5. Feature Section: ContainerFlags Enum

### 5.1 Purpose

The `ContainerFlags` enum defines special behaviors that can be applied to container types using bitwise flags.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/ContainerFlags.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Flags indicating special behaviors for container types.
/// </summary>
[Flags]
public enum ContainerFlags
{
    /// <summary>
    /// No special flags.
    /// </summary>
    None = 0,

    /// <summary>
    /// Container may be completely empty (0 items).
    /// </summary>
    MayBeEmpty = 1 << 0,

    /// <summary>
    /// Container has a chance to spawn Myth-Forged quality items.
    /// </summary>
    MythForgedChance = 1 << 1,

    /// <summary>
    /// Container requires a discovery check to find.
    /// </summary>
    RequiresDiscovery = 1 << 2
}
```

---

## 6. Feature Section: ContainerTypeDefinition Value Object

### 6.1 Purpose

The `ContainerTypeDefinition` value object encapsulates all specification data for a container type, including item counts, tier ranges, currency amounts, and special behaviors.

### 6.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ContainerTypeDefinition.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines the loot specifications for a container type.
/// </summary>
/// <remarks>
/// This value object is immutable and loaded from container-types.json configuration.
/// It specifies item counts, quality tier ranges, currency amounts, and special behaviors.
/// </remarks>
/// <param name="Type">The container type this definition applies to.</param>
/// <param name="MinItems">Minimum number of items the container can hold.</param>
/// <param name="MaxItems">Maximum number of items the container can hold.</param>
/// <param name="MinTier">Minimum quality tier for items (0-4 scale).</param>
/// <param name="MaxTier">Maximum quality tier for items (0-4 scale).</param>
/// <param name="MinCurrency">Minimum currency amount, or null if no currency.</param>
/// <param name="MaxCurrency">Maximum currency amount, or null if no currency.</param>
/// <param name="ItemCategoryFilter">Item category restriction, or null for any.</param>
/// <param name="DiscoveryDC">Difficulty class to discover, or null if visible.</param>
/// <param name="Flags">Special behavior flags.</param>
public readonly record struct ContainerTypeDefinition(
    ContainerType Type,
    int MinItems,
    int MaxItems,
    int MinTier,
    int MaxTier,
    int? MinCurrency,
    int? MaxCurrency,
    string? ItemCategoryFilter,
    int? DiscoveryDC,
    ContainerFlags Flags)
{
    /// <summary>
    /// Gets whether this container can potentially be empty.
    /// </summary>
    public bool CanBeEmpty => MinItems == 0 || Flags.HasFlag(ContainerFlags.MayBeEmpty);

    /// <summary>
    /// Gets whether this container can spawn Myth-Forged items.
    /// </summary>
    public bool HasMythForgedChance => Flags.HasFlag(ContainerFlags.MythForgedChance);

    /// <summary>
    /// Gets whether this container requires discovery.
    /// </summary>
    public bool RequiresDiscovery => DiscoveryDC.HasValue || Flags.HasFlag(ContainerFlags.RequiresDiscovery);

    /// <summary>
    /// Gets whether this container has a category restriction.
    /// </summary>
    public bool HasCategoryFilter => !string.IsNullOrWhiteSpace(ItemCategoryFilter);

    /// <summary>
    /// Gets whether this container awards currency.
    /// </summary>
    public bool AwardsCurrency => MinCurrency.HasValue && MaxCurrency.HasValue;

    /// <summary>
    /// Creates a new ContainerTypeDefinition with validation.
    /// </summary>
    /// <exception cref="ArgumentOutOfRangeException">
    /// Thrown when item counts, tiers, or currency values are invalid.
    /// </exception>
    public static ContainerTypeDefinition Create(
        ContainerType type,
        int minItems,
        int maxItems,
        int minTier,
        int maxTier,
        int? minCurrency = null,
        int? maxCurrency = null,
        string? itemCategoryFilter = null,
        int? discoveryDC = null,
        ContainerFlags flags = ContainerFlags.None)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(minItems, nameof(minItems));
        ArgumentOutOfRangeException.ThrowIfNegative(maxItems, nameof(maxItems));
        ArgumentOutOfRangeException.ThrowIfLessThan(maxItems, minItems, nameof(maxItems));

        ArgumentOutOfRangeException.ThrowIfNegative(minTier, nameof(minTier));
        ArgumentOutOfRangeException.ThrowIfGreaterThan(maxTier, 4, nameof(maxTier));
        ArgumentOutOfRangeException.ThrowIfLessThan(maxTier, minTier, nameof(maxTier));

        if (minCurrency.HasValue)
        {
            ArgumentOutOfRangeException.ThrowIfNegative(minCurrency.Value, nameof(minCurrency));
        }

        if (maxCurrency.HasValue)
        {
            ArgumentOutOfRangeException.ThrowIfNegative(maxCurrency.Value, nameof(maxCurrency));

            if (minCurrency.HasValue && maxCurrency.Value < minCurrency.Value)
            {
                throw new ArgumentOutOfRangeException(
                    nameof(maxCurrency),
                    $"MaxCurrency ({maxCurrency.Value}) must be >= MinCurrency ({minCurrency.Value}).");
            }
        }

        if (discoveryDC.HasValue)
        {
            ArgumentOutOfRangeException.ThrowIfLessThan(discoveryDC.Value, 1, nameof(discoveryDC));
        }

        return new ContainerTypeDefinition(
            type,
            minItems,
            maxItems,
            minTier,
            maxTier,
            minCurrency,
            maxCurrency,
            itemCategoryFilter?.ToLowerInvariant(),
            discoveryDC,
            flags);
    }

    /// <inheritdoc />
    public override string ToString() =>
        $"{Type}: Items={MinItems}-{MaxItems}, Tier={MinTier}-{MaxTier}" +
        (AwardsCurrency ? $", Currency={MinCurrency}-{MaxCurrency}" : "") +
        (HasCategoryFilter ? $", Filter={ItemCategoryFilter}" : "") +
        (RequiresDiscovery ? $", DC={DiscoveryDC}" : "");
}
```

### 6.3 Design Decisions

| Decision                   | Rationale                                             |
| -------------------------- | ----------------------------------------------------- |
| `readonly record struct`   | Immutable value semantics, efficient memory usage     |
| Nullable currency fields   | Not all containers award currency                     |
| Nullable category filter   | Most containers have no restrictions                  |
| Nullable discovery DC      | Most containers are visible                           |
| Flags enum for behaviors   | Extensible special behaviors using bitwise operations |
| Factory method validation  | Ensures all definitions are valid at creation time    |
| Normalized category filter | Case-insensitive matching for item categories         |

---

## 7. Data Model Changes

### 7.1 New Enums

| Enum             | File Path                                             | Purpose                        |
| ---------------- | ----------------------------------------------------- | ------------------------------ |
| `ContainerType`  | `src/Core/RuneAndRust.Domain/Enums/ContainerType.cs`  | Container category identifiers |
| `ContainerFlags` | `src/Core/RuneAndRust.Domain/Enums/ContainerFlags.cs` | Special behavior flags         |

### 7.2 New Value Objects

| Value Object              | File Path                                                             | Purpose                       |
| ------------------------- | --------------------------------------------------------------------- | ----------------------------- |
| `ContainerTypeDefinition` | `src/Core/RuneAndRust.Domain/ValueObjects/ContainerTypeDefinition.cs` | Container loot specifications |

---

## 8. Configuration File Schemas

### 8.1 container-types.json

**File:** `config/container-types.json`

```json
{
    "$schema": "./schemas/container-types.schema.json",
    "containerTypes": [
        {
            "type": "SmallChest",
            "minItems": 1,
            "maxItems": 2,
            "minTier": 0,
            "maxTier": 1,
            "minCurrency": 10,
            "maxCurrency": 30,
            "itemCategoryFilter": null,
            "discoveryDC": null,
            "flags": []
        },
        {
            "type": "MediumChest",
            "minItems": 2,
            "maxItems": 4,
            "minTier": 1,
            "maxTier": 2,
            "minCurrency": 25,
            "maxCurrency": 75,
            "itemCategoryFilter": null,
            "discoveryDC": null,
            "flags": []
        },
        {
            "type": "LargeChest",
            "minItems": 3,
            "maxItems": 5,
            "minTier": 2,
            "maxTier": 3,
            "minCurrency": 50,
            "maxCurrency": 150,
            "itemCategoryFilter": null,
            "discoveryDC": null,
            "flags": []
        },
        {
            "type": "BossChest",
            "minItems": 4,
            "maxItems": 6,
            "minTier": 3,
            "maxTier": 4,
            "minCurrency": 100,
            "maxCurrency": 300,
            "itemCategoryFilter": null,
            "discoveryDC": null,
            "flags": ["MythForgedChance"]
        },
        {
            "type": "HiddenCache",
            "minItems": 1,
            "maxItems": 3,
            "minTier": 1,
            "maxTier": 3,
            "minCurrency": 50,
            "maxCurrency": 200,
            "itemCategoryFilter": null,
            "discoveryDC": 14,
            "flags": ["RequiresDiscovery"]
        },
        {
            "type": "Corpse",
            "minItems": 0,
            "maxItems": 2,
            "minTier": 0,
            "maxTier": 1,
            "minCurrency": 5,
            "maxCurrency": 20,
            "itemCategoryFilter": null,
            "discoveryDC": null,
            "flags": ["MayBeEmpty"]
        },
        {
            "type": "Locker",
            "minItems": 1,
            "maxItems": 3,
            "minTier": 0,
            "maxTier": 2,
            "minCurrency": 15,
            "maxCurrency": 50,
            "itemCategoryFilter": null,
            "discoveryDC": null,
            "flags": []
        },
        {
            "type": "SupplyCrate",
            "minItems": 2,
            "maxItems": 3,
            "minTier": 0,
            "maxTier": 1,
            "minCurrency": null,
            "maxCurrency": null,
            "itemCategoryFilter": "consumables",
            "discoveryDC": null,
            "flags": []
        },
        {
            "type": "WeaponRack",
            "minItems": 1,
            "maxItems": 2,
            "minTier": 1,
            "maxTier": 3,
            "minCurrency": null,
            "maxCurrency": null,
            "itemCategoryFilter": "weapons",
            "discoveryDC": null,
            "flags": []
        },
        {
            "type": "ArmorStand",
            "minItems": 1,
            "maxItems": 1,
            "minTier": 1,
            "maxTier": 3,
            "minCurrency": null,
            "maxCurrency": null,
            "itemCategoryFilter": "armor",
            "discoveryDC": null,
            "flags": []
        }
    ]
}
```

### 8.2 container-types.schema.json

**File:** `config/schemas/container-types.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "container-types.schema.json",
    "title": "Container Types Configuration",
    "description": "Defines loot specifications for each container type.",
    "type": "object",
    "required": ["containerTypes"],
    "properties": {
        "containerTypes": {
            "type": "array",
            "description": "Array of container type definitions.",
            "items": {
                "$ref": "#/$defs/containerTypeDefinition"
            },
            "minItems": 1
        }
    },
    "$defs": {
        "containerTypeDefinition": {
            "type": "object",
            "required": ["type", "minItems", "maxItems", "minTier", "maxTier"],
            "properties": {
                "type": {
                    "type": "string",
                    "description": "The container type identifier.",
                    "enum": [
                        "SmallChest",
                        "MediumChest",
                        "LargeChest",
                        "BossChest",
                        "HiddenCache",
                        "Corpse",
                        "Locker",
                        "SupplyCrate",
                        "WeaponRack",
                        "ArmorStand"
                    ]
                },
                "minItems": {
                    "type": "integer",
                    "description": "Minimum item count.",
                    "minimum": 0
                },
                "maxItems": {
                    "type": "integer",
                    "description": "Maximum item count.",
                    "minimum": 0
                },
                "minTier": {
                    "type": "integer",
                    "description": "Minimum quality tier (0-4).",
                    "minimum": 0,
                    "maximum": 4
                },
                "maxTier": {
                    "type": "integer",
                    "description": "Maximum quality tier (0-4).",
                    "minimum": 0,
                    "maximum": 4
                },
                "minCurrency": {
                    "type": ["integer", "null"],
                    "description": "Minimum currency, or null for no currency.",
                    "minimum": 0
                },
                "maxCurrency": {
                    "type": ["integer", "null"],
                    "description": "Maximum currency, or null for no currency.",
                    "minimum": 0
                },
                "itemCategoryFilter": {
                    "type": ["string", "null"],
                    "description": "Restrict to item category, or null for any."
                },
                "discoveryDC": {
                    "type": ["integer", "null"],
                    "description": "DC to find, or null if visible.",
                    "minimum": 1
                },
                "flags": {
                    "type": "array",
                    "description": "Special behavior flags.",
                    "items": {
                        "type": "string",
                        "enum": [
                            "MayBeEmpty",
                            "MythForgedChance",
                            "RequiresDiscovery"
                        ]
                    }
                }
            }
        }
    }
}
```

---

## 9. Logging Specifications

| Component             | Level       | Event                                                |
| --------------------- | ----------- | ---------------------------------------------------- |
| Configuration Loading | Information | "Loaded {Count} container type definitions"          |
| Configuration Loading | Debug       | "Container type {Type}: {MinItems}-{MaxItems} items" |
| Definition Validation | Warning     | "Invalid container definition: {Error}"              |
| Definition Access     | Debug       | "Retrieved definition for {ContainerType}"           |

---

## 10. Unit Testing Requirements

### 10.1 Test Summary

| Test Class                     | Test Count | Focus Area              |
| ------------------------------ | ---------- | ----------------------- |
| `ContainerTypeDefinitionTests` | ~2         | Value object validation |

### 10.2 Test Specifications

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/ContainerTypeDefinitionTests.cs`

```csharp
using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.UnitTests.ValueObjects;

[TestFixture]
public class ContainerTypeDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_CreatesDefinition()
    {
        // Arrange & Act
        var definition = ContainerTypeDefinition.Create(
            type: ContainerType.SmallChest,
            minItems: 1,
            maxItems: 2,
            minTier: 0,
            maxTier: 1,
            minCurrency: 10,
            maxCurrency: 30);

        // Assert
        definition.Type.Should().Be(ContainerType.SmallChest);
        definition.MinItems.Should().Be(1);
        definition.MaxItems.Should().Be(2);
        definition.MinTier.Should().Be(0);
        definition.MaxTier.Should().Be(1);
        definition.MinCurrency.Should().Be(10);
        definition.MaxCurrency.Should().Be(30);
        definition.AwardsCurrency.Should().BeTrue();
        definition.CanBeEmpty.Should().BeFalse();
    }

    [Test]
    public void Create_WithMaxItemsLessThanMinItems_ThrowsArgumentOutOfRangeException()
    {
        // Arrange & Act
        var act = () => ContainerTypeDefinition.Create(
            type: ContainerType.SmallChest,
            minItems: 5,
            maxItems: 2,
            minTier: 0,
            maxTier: 1);

        // Assert
        act.Should().Throw<ArgumentOutOfRangeException>()
            .WithParameterName("maxItems");
    }
}
```

---

## 11. Use Cases

### UC-001: Load Container Type Definitions

| Field   | Value                                                                                                                                           |
| ------- | ----------------------------------------------------------------------------------------------------------------------------------------------- |
| Actor   | System                                                                                                                                          |
| Trigger | Application startup                                                                                                                             |
| Flow    | 1. Read container-types.json<br>2. Validate against schema<br>3. Create ContainerTypeDefinition for each entry<br>4. Store in lookup dictionary |
| Outcome | All 10 container types available for loot generation                                                                                            |

### UC-002: Retrieve Container Specification

| Field   | Value                                                                       |
| ------- | --------------------------------------------------------------------------- |
| Actor   | Container Loot Service (future v0.16.4d)                                    |
| Trigger | Container loot generation request                                           |
| Flow    | 1. Look up ContainerTypeDefinition by ContainerType<br>2. Return definition |
| Outcome | Correct specification returned for container type                           |

---

## 12. Deliverable Checklist

### 12.1 Domain Layer

- [ ] `ContainerType` enum (`src/Core/RuneAndRust.Domain/Enums/ContainerType.cs`)
- [ ] `ContainerFlags` enum (`src/Core/RuneAndRust.Domain/Enums/ContainerFlags.cs`)
- [ ] `ContainerTypeDefinition` value object (`src/Core/RuneAndRust.Domain/ValueObjects/ContainerTypeDefinition.cs`)

### 12.2 Configuration

- [ ] `container-types.json` (`config/container-types.json`)
- [ ] `container-types.schema.json` (`config/schemas/container-types.schema.json`)

### 12.3 Tests

- [ ] `ContainerTypeDefinitionTests` (`tests/RuneAndRust.Domain.UnitTests/ValueObjects/ContainerTypeDefinitionTests.cs`)

---

## 13. Acceptance Criteria

### 13.1 Functional Criteria

| ID    | Criterion                                               | Verification    |
| ----- | ------------------------------------------------------- | --------------- |
| AC-01 | `ContainerType` enum defines all 10 container types     | Code inspection |
| AC-02 | Each container type has correct item count range        | Unit test       |
| AC-03 | Each container type has correct tier range (0-4 scale)  | Unit test       |
| AC-04 | Currency ranges match specification or are null         | Configuration   |
| AC-05 | Category filters correctly defined for restricted types | Configuration   |
| AC-06 | Discovery DC defined for HiddenCache                    | Configuration   |
| AC-07 | Flags correctly set for special behaviors               | Configuration   |

### 13.2 Quality Criteria

| ID    | Criterion                                   | Verification      |
| ----- | ------------------------------------------- | ----------------- |
| QC-01 | All code has XML documentation              | Code inspection   |
| QC-02 | Configuration validates against JSON schema | Schema validation |
| QC-03 | ~2 unit tests pass                          | Test execution    |

---

## 14. Dependencies

### 14.1 Prerequisites

| Dependency | Description                          | Status   |
| ---------- | ------------------------------------ | -------- |
| v0.16.0    | QualityTier enum (tier 0-4 scale)    | Complete |
| v0.16.3a-e | Smart loot system (provides context) | Complete |

### 14.2 Provides To

| Consumer | Description                           |
| -------- | ------------------------------------- |
| v0.16.4b | ContainerLootTable uses ContainerType |
| v0.16.4d | ContainerLootService uses definitions |

---

## 15. Future Considerations

### 15.1 Deferred to v0.16.4b

- `ContainerLootTable` entity (uses `ContainerType` enum)

### 15.2 Deferred to v0.16.4d

- `IContainerLootService` interface
- Container loot generation logic
- Loading definitions from configuration

### 15.3 Deferred to v0.16.4e

- Container state persistence (looted/unlooted)

### 15.4 Potential Future Enhancements

- Additional container types (TreasureVault, MagicChest, etc.)
- Biome-specific container variants
- Trap integration for containers
