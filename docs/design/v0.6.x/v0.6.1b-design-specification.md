# v0.6.1b Design Specification: ASCII Room Renderer

**Version:** 0.6.1b
**Parent:** v0.6.1 (Visual Components)
**Prerequisites:** v0.6.1a Complete (Health Bars)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [AsciiRoomRenderer Component](#4-asciiroomrenderer-component)
5. [Room Art Definition](#5-room-art-definition)
6. [Art Provider](#6-art-provider)
7. [Data Model](#7-data-model)
8. [Configuration](#8-configuration)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### Purpose

The ASCII Room Renderer implements visual room representations using ASCII art templates. Each room can have custom art that displays in the main content panel, with symbol legends explaining the meaning of characters. The system supports dynamic elements (player position, monsters), colored symbols, and fallback rendering for rooms without custom art.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Components** | AsciiRoomRenderer |
| **Value Objects** | RoomArtDefinition |
| **Interfaces** | IRoomArtProvider |
| **Configuration** | room-art.json |
| **Tests** | ~10 new unit tests |

### Architectural Significance

This version establishes the **Room Visualization Pattern** that will be used throughout the game:
- Data-driven room art via JSON configuration
- Symbol-based rendering with color support
- Dynamic entity overlays on static art
- Scalable art for various terminal widths

---

## 2. Feature Overview

```
v0.6.1b Features
├── AsciiRoomRenderer Component
│   ├── Room art rendering
│   ├── Entity overlay (player, monsters)
│   ├── Art scaling for width
│   └── Default art fallback
├── RoomArtDefinition
│   ├── Art lines (ASCII strings)
│   ├── Symbol legend mapping
│   ├── Symbol color mapping
│   └── Legend display flag
├── IRoomArtProvider
│   ├── Get art by room ID
│   ├── Get default art template
│   └── Art existence check
├── Legend Rendering
│   ├── Symbol → description
│   ├── Color-coded symbols
│   └── Compact/expanded format
└── Configuration
    ├── Room art templates
    ├── Symbol definitions
    └── Default art settings
```

---

## 3. Architecture Diagrams

### 3.1 Room Renderer Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                   ROOM RENDERER ARCHITECTURE                         │
└─────────────────────────────────────────────────────────────────────┘

    CONFIGURATION              APPLICATION              PRESENTATION
    ─────────────              ───────────              ────────────

    ┌──────────────┐      ┌──────────────────┐    ┌──────────────────┐
    │ room-art.json│─────▶│ IRoomArtProvider │───▶│AsciiRoomRenderer │
    ├──────────────┤      ├──────────────────┤    ├──────────────────┤
    │ rooms:       │      │ GetArtForRoom()  │    │ RenderRoom()     │
    │   dark-cave: │      │ GetDefaultArt()  │    │ RenderLegend()   │
    │     art: []  │      │ HasArt()         │    │ ScaleArt()       │
    │     legend:{}│      └──────────────────┘    └────────┬─────────┘
    │     colors:{}│                                       │
    └──────────────┘                                       │ uses
                                                          ▼
    ┌──────────────────┐                         ┌──────────────────┐
    │ RoomArtDefinition│◀────────────────────────│   ScreenLayout   │
    ├──────────────────┤                         │   (v0.6.0a)      │
    │ RoomId           │                         ├──────────────────┤
    │ ArtLines[]       │                         │ MainContent Panel│
    │ Legend{}         │                         └──────────────────┘
    │ SymbolColors{}   │
    │ ShowLegend       │                         ┌──────────────────┐
    └──────────────────┘                         │ IColorThemeService
                                                 │ (v0.6.0c)        │
                                                 └──────────────────┘
```

### 3.2 Room Rendering Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                      ROOM RENDERING FLOW                             │
└─────────────────────────────────────────────────────────────────────┘

    RenderRoom(room, entities)
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 1. CHECK FOR CUSTOM ART                                        │
    ├───────────────────────────────────────────────────────────────┤
    │ artDefinition = _artProvider.GetArtForRoom(room.RoomTypeId)   │
    │                                                                │
    │ IF artDefinition == null:                                      │
    │   artDefinition = _artProvider.GetDefaultArt()                │
    │   → Use fallback template                                      │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 2. GET PANEL DIMENSIONS                                        │
    ├───────────────────────────────────────────────────────────────┤
    │ panel = _layout.GetPanel(PanelPosition.MainContent)           │
    │ targetWidth = panel.ContentWidth                               │
    │ targetHeight = panel.ContentHeight                             │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 3. SCALE ART IF NEEDED                                         │
    ├───────────────────────────────────────────────────────────────┤
    │ IF art.MaxWidth > targetWidth:                                 │
    │   scaledArt = ScaleArt(art, targetWidth)                      │
    │ ELSE:                                                          │
    │   scaledArt = CenterArt(art, targetWidth)                     │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 4. OVERLAY ENTITIES                                            │
    ├───────────────────────────────────────────────────────────────┤
    │ FOR each entity in entities:                                   │
    │   IF entity.Position in art bounds:                           │
    │     scaledArt[y][x] = entity.Symbol                           │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 5. RENDER WITH COLORS                                          │
    ├───────────────────────────────────────────────────────────────┤
    │ FOR each line in scaledArt:                                    │
    │   FOR each char in line:                                       │
    │     IF char in symbolColors:                                   │
    │       WriteColored(char, symbolColors[char])                  │
    │     ELSE:                                                      │
    │       Write(char)                                              │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 6. RENDER LEGEND (if enabled)                                  │
    ├───────────────────────────────────────────────────────────────┤
    │ IF artDefinition.ShowLegend:                                   │
    │   RenderLegend(artDefinition.Legend)                          │
    └───────────────────────────────────────────────────────────────┘
```

### 3.3 Default Art Generation

```
┌─────────────────────────────────────────────────────────────────────┐
│                   DEFAULT ART GENERATION                             │
└─────────────────────────────────────────────────────────────────────┘

    Room without custom art
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ GENERATE DEFAULT TEMPLATE                                      │
    ├───────────────────────────────────────────────────────────────┤
    │                                                                │
    │   ┌─────────────────────────────────────────────┐             │
    │   │                                             │             │
    │   │                 [Room Name]                 │             │
    │   │                                             │             │
    │   │              (No art defined)               │             │
    │   │                                             │             │
    │   │  Exits: North, South, East                  │             │
    │   │                                             │             │
    │   │  You see: Goblin, Rusty Key                 │             │
    │   │                                             │             │
    │   └─────────────────────────────────────────────┘             │
    │                                                                │
    └───────────────────────────────────────────────────────────────┘
```

---

## 4. AsciiRoomRenderer Component

### 4.1 AsciiRoomRenderer Class

**File:** `src/Presentation/RuneAndRust.TUI/UI/AsciiRoomRenderer.cs`

```csharp
namespace RuneAndRust.Presentation.UI;

/// <summary>
/// Renders ASCII art for rooms with optional entity overlays.
/// </summary>
public class AsciiRoomRenderer
{
    private readonly IRoomArtProvider _artProvider;
    private readonly IColorThemeService _colorService;
    private readonly ITerminalService _terminal;
    private readonly ScreenLayout _layout;
    private readonly ILogger<AsciiRoomRenderer> _logger;
    
    public AsciiRoomRenderer(
        IRoomArtProvider artProvider,
        IColorThemeService colorService,
        ITerminalService terminal,
        ScreenLayout layout,
        ILogger<AsciiRoomRenderer> logger)
    {
        _artProvider = artProvider;
        _colorService = colorService;
        _terminal = terminal;
        _layout = layout;
        _logger = logger;
    }
    
    /// <summary>
    /// Renders the room art to the main content panel.
    /// </summary>
    /// <param name="room">The room to render.</param>
    public void RenderRoom(Room room)
    {
        RenderRoom(room, Array.Empty<Entity>());
    }
    
    /// <summary>
    /// Renders the room with dynamic entity overlays.
    /// </summary>
    /// <param name="room">The room to render.</param>
    /// <param name="entities">Entities to overlay on the art.</param>
    public void RenderRoom(Room room, IReadOnlyList<Entity> entities)
    {
        var panel = _layout.GetPanel(PanelPosition.MainContent);
        if (panel == null)
        {
            _logger.LogWarning("MainContent panel not found");
            return;
        }
        
        var art = _artProvider.GetArtForRoom(room.RoomTypeId);
        if (art == null)
        {
            _logger.LogDebug("No custom art for room '{RoomType}', using default", 
                room.RoomTypeId);
            RenderDefaultArt(room, entities, panel.Value);
            return;
        }
        
        var contentArea = panel.Value.ContentArea;
        var scaledArt = ScaleArt(art.ArtLines, contentArea.Width);
        var overlaidArt = OverlayEntities(scaledArt, entities);
        
        RenderArtWithColors(overlaidArt, art.SymbolColors, contentArea);
        
        if (art.ShowLegend)
        {
            RenderLegend(art.Legend, art.SymbolColors, contentArea);
        }
    }
    
    /// <summary>
    /// Renders the legend for the room art.
    /// </summary>
    /// <param name="legend">Symbol to description mapping.</param>
    /// <param name="colors">Symbol to color mapping.</param>
    /// <param name="contentArea">Available content area.</param>
    public void RenderLegend(
        IReadOnlyDictionary<char, string> legend,
        IReadOnlyDictionary<char, ConsoleColor>? colors,
        (int X, int Y, int Width, int Height) contentArea)
    {
        if (!legend.Any()) return;
        
        var legendParts = legend.Select(kvp => 
        {
            var color = colors?.GetValueOrDefault(kvp.Key);
            return (Symbol: kvp.Key, Description: kvp.Value, Color: color);
        }).ToList();
        
        // Render legend at bottom of content area
        var legendLine = "Legend: " + string.Join("  ", 
            legendParts.Select(p => $"{p.Symbol} = {p.Description}"));
        
        if (legendLine.Length > contentArea.Width)
        {
            // Multi-line legend
            RenderMultiLineLegend(legendParts, contentArea);
        }
        else
        {
            // Single-line legend
            _terminal.SetCursorPosition(contentArea.X, 
                contentArea.Y + contentArea.Height - 1);
            RenderLegendLine(legendParts, contentArea.Width);
        }
    }
    
    /// <summary>
    /// Scales art to fit the target width.
    /// </summary>
    private IReadOnlyList<string> ScaleArt(IReadOnlyList<string> art, int targetWidth)
    {
        var maxWidth = art.Max(line => line.Length);
        
        if (maxWidth <= targetWidth)
        {
            // Center the art
            var padding = (targetWidth - maxWidth) / 2;
            return art.Select(line => new string(' ', padding) + line).ToList();
        }
        
        // Truncate if too wide
        _logger.LogDebug("Truncating art from {OriginalWidth} to {TargetWidth}", 
            maxWidth, targetWidth);
        return art.Select(line => 
            line.Length > targetWidth ? line[..targetWidth] : line
        ).ToList();
    }
    
    /// <summary>
    /// Overlays entity symbols on the art.
    /// </summary>
    private IReadOnlyList<string> OverlayEntities(
        IReadOnlyList<string> art, 
        IReadOnlyList<Entity> entities)
    {
        if (!entities.Any()) return art;
        
        var mutableArt = art.Select(line => line.ToCharArray()).ToList();
        
        foreach (var entity in entities)
        {
            if (entity.ArtPosition.HasValue)
            {
                var (x, y) = entity.ArtPosition.Value;
                if (y >= 0 && y < mutableArt.Count && 
                    x >= 0 && x < mutableArt[y].Length)
                {
                    mutableArt[y][x] = entity.ArtSymbol;
                }
            }
        }
        
        return mutableArt.Select(chars => new string(chars)).ToList();
    }
    
    /// <summary>
    /// Renders art with colored symbols.
    /// </summary>
    private void RenderArtWithColors(
        IReadOnlyList<string> art,
        IReadOnlyDictionary<char, ConsoleColor>? symbolColors,
        (int X, int Y, int Width, int Height) contentArea)
    {
        for (var lineIndex = 0; lineIndex < art.Count && lineIndex < contentArea.Height; lineIndex++)
        {
            _terminal.SetCursorPosition(contentArea.X, contentArea.Y + lineIndex);
            var line = art[lineIndex];
            
            if (symbolColors == null || !symbolColors.Any())
            {
                _terminal.Write(line);
                continue;
            }
            
            foreach (var ch in line)
            {
                if (symbolColors.TryGetValue(ch, out var color))
                {
                    var prevColor = Console.ForegroundColor;
                    Console.ForegroundColor = color;
                    _terminal.Write(ch.ToString());
                    Console.ForegroundColor = prevColor;
                }
                else
                {
                    _terminal.Write(ch.ToString());
                }
            }
        }
    }
    
    /// <summary>
    /// Renders default art for rooms without custom art.
    /// </summary>
    private void RenderDefaultArt(
        Room room, 
        IReadOnlyList<Entity> entities,
        Panel panel)
    {
        var contentArea = panel.ContentArea;
        var lines = new List<string>();
        
        // Title
        var title = room.Name;
        var titlePadding = (contentArea.Width - title.Length) / 2;
        lines.Add(new string(' ', Math.Max(0, titlePadding)) + title);
        lines.Add("");
        
        // Description
        var descLines = WrapText(room.Description, contentArea.Width - 4);
        lines.AddRange(descLines.Select(l => "  " + l));
        lines.Add("");
        
        // Exits
        var exits = string.Join(", ", room.Connections.Select(c => c.Direction.ToString()));
        lines.Add($"  Exits: {exits}");
        lines.Add("");
        
        // Contents
        if (entities.Any())
        {
            var contents = string.Join(", ", entities.Select(e => e.Name));
            lines.Add($"  You see: {contents}");
        }
        
        _layout.RenderToPanel(PanelPosition.MainContent, lines);
    }
    
    private void RenderLegendLine(
        List<(char Symbol, string Description, ConsoleColor? Color)> parts,
        int maxWidth)
    {
        _terminal.Write("Legend: ");
        
        for (var i = 0; i < parts.Count; i++)
        {
            var part = parts[i];
            
            if (part.Color.HasValue)
            {
                var prevColor = Console.ForegroundColor;
                Console.ForegroundColor = part.Color.Value;
                _terminal.Write(part.Symbol.ToString());
                Console.ForegroundColor = prevColor;
            }
            else
            {
                _terminal.Write(part.Symbol.ToString());
            }
            
            _terminal.Write($" = {part.Description}");
            
            if (i < parts.Count - 1)
            {
                _terminal.Write("  ");
            }
        }
    }
    
    private void RenderMultiLineLegend(
        List<(char Symbol, string Description, ConsoleColor? Color)> parts,
        (int X, int Y, int Width, int Height) contentArea)
    {
        var startY = contentArea.Y + contentArea.Height - 2;
        _terminal.SetCursorPosition(contentArea.X, startY);
        _terminal.Write("Legend:");
        
        _terminal.SetCursorPosition(contentArea.X, startY + 1);
        RenderLegendLine(parts, contentArea.Width);
    }
    
    private static IReadOnlyList<string> WrapText(string text, int maxWidth)
    {
        var words = text.Split(' ');
        var lines = new List<string>();
        var currentLine = "";
        
        foreach (var word in words)
        {
            if (currentLine.Length + word.Length + 1 > maxWidth)
            {
                if (currentLine.Length > 0)
                {
                    lines.Add(currentLine.TrimEnd());
                    currentLine = "";
                }
            }
            currentLine += word + " ";
        }
        
        if (currentLine.Length > 0)
        {
            lines.Add(currentLine.TrimEnd());
        }
        
        return lines;
    }
}
```

---

## 5. Room Art Definition

### 5.1 RoomArtDefinition Record

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/RoomArtDefinition.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines ASCII art for a room type.
/// </summary>
/// <param name="RoomId">The room type ID this art is for.</param>
/// <param name="ArtLines">Lines of ASCII art.</param>
/// <param name="Legend">Symbol to description mapping.</param>
/// <param name="SymbolColors">Optional symbol to color mapping.</param>
/// <param name="ShowLegend">Whether to display the legend.</param>
public record RoomArtDefinition(
    string RoomId,
    IReadOnlyList<string> ArtLines,
    IReadOnlyDictionary<char, string> Legend,
    IReadOnlyDictionary<char, ConsoleColor>? SymbolColors = null,
    bool ShowLegend = true)
{
    /// <summary>
    /// Gets the maximum width of the art.
    /// </summary>
    public int MaxWidth => ArtLines.Max(line => line.Length);
    
    /// <summary>
    /// Gets the height of the art in lines.
    /// </summary>
    public int Height => ArtLines.Count;
    
    /// <summary>
    /// Gets all unique symbols used in the art.
    /// </summary>
    public IReadOnlySet<char> UsedSymbols => 
        ArtLines.SelectMany(line => line).ToHashSet();
}
```

---

## 6. Art Provider

### 6.1 IRoomArtProvider Interface

**File:** `src/Core/RuneAndRust.Application/Interfaces/IRoomArtProvider.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Provides room ASCII art definitions.
/// </summary>
public interface IRoomArtProvider
{
    /// <summary>
    /// Gets the art definition for a room type.
    /// </summary>
    /// <param name="roomTypeId">The room type ID.</param>
    /// <returns>Art definition, or null if not found.</returns>
    RoomArtDefinition? GetArtForRoom(string roomTypeId);
    
    /// <summary>
    /// Gets the default art template.
    /// </summary>
    /// <returns>Default art settings.</returns>
    DefaultArtSettings GetDefaultArt();
    
    /// <summary>
    /// Checks if a room type has custom art.
    /// </summary>
    /// <param name="roomTypeId">The room type ID.</param>
    /// <returns>True if custom art exists.</returns>
    bool HasArt(string roomTypeId);
    
    /// <summary>
    /// Gets all available room art IDs.
    /// </summary>
    IReadOnlyList<string> AvailableArtIds { get; }
}
```

### 6.2 DefaultArtSettings Record

**File:** `src/Core/RuneAndRust.Application/Configuration/DefaultArtSettings.cs`

```csharp
namespace RuneAndRust.Application.Configuration;

/// <summary>
/// Settings for default room art rendering.
/// </summary>
/// <param name="Template">Template style (simple-box, ornate, minimal).</param>
/// <param name="ShowExits">Whether to show exit directions.</param>
/// <param name="ShowContents">Whether to show room contents.</param>
public record DefaultArtSettings(
    string Template = "simple-box",
    bool ShowExits = true,
    bool ShowContents = true);
```

### 6.3 RoomArtProvider Implementation

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Providers/RoomArtProvider.cs`

```csharp
namespace RuneAndRust.Infrastructure.Providers;

/// <summary>
/// Provides room art from JSON configuration.
/// </summary>
public class RoomArtProvider : IRoomArtProvider
{
    private readonly Dictionary<string, RoomArtDefinition> _artDefinitions;
    private readonly DefaultArtSettings _defaultSettings;
    private readonly ILogger<RoomArtProvider> _logger;
    
    public IReadOnlyList<string> AvailableArtIds { get; }
    
    public RoomArtProvider(
        IGameConfigurationProvider configProvider,
        ILogger<RoomArtProvider> logger)
    {
        _logger = logger;
        
        var config = configProvider.GetRoomArtConfiguration();
        _artDefinitions = config.Rooms.ToDictionary(
            kvp => kvp.Key.ToLowerInvariant(),
            kvp => kvp.Value);
        _defaultSettings = config.DefaultArt;
        
        AvailableArtIds = _artDefinitions.Keys.ToList();
        
        _logger.LogInformation("Loaded {Count} room art definitions", 
            _artDefinitions.Count);
    }
    
    public RoomArtDefinition? GetArtForRoom(string roomTypeId)
    {
        var normalizedId = roomTypeId.ToLowerInvariant();
        return _artDefinitions.GetValueOrDefault(normalizedId);
    }
    
    public DefaultArtSettings GetDefaultArt() => _defaultSettings;
    
    public bool HasArt(string roomTypeId)
    {
        return _artDefinitions.ContainsKey(roomTypeId.ToLowerInvariant());
    }
}
```

---

## 7. Data Model

### 7.1 New Value Objects

| Value Object | Layer | Description |
|--------------|-------|-------------|
| `RoomArtDefinition` | Domain | Room art template data |

### 7.2 New Interfaces

| Interface | Layer | Description |
|-----------|-------|-------------|
| `IRoomArtProvider` | Application | Art provider interface |

### 7.3 New Records

| Record | Layer | Description |
|--------|-------|-------------|
| `DefaultArtSettings` | Application | Default art configuration |

### 7.4 New Services

| Service | Layer | Description |
|---------|-------|-------------|
| `RoomArtProvider` | Infrastructure | JSON-based art provider |
| `AsciiRoomRenderer` | Presentation | Room rendering component |

---

## 8. Configuration

### 8.1 room-art.json

**File:** `config/room-art.json`

```json
{
  "$schema": "./schemas/room-art.schema.json",
  "rooms": {
    "dark-cave": {
      "art": [
        "    ╔═══════════════════════════════════════╗",
        "   ╔╝                                       ╚╗",
        "  ╔╝   ~~~   ▲   ~~~                         ╚╗",
        " ╔╝    ~~~  ▲▲▲  ~~~    ☠                     ╚╗",
        "╔╝         ▲▲▲▲▲                               ╚╗",
        "║    ░░     cave     ░░                         ║",
        "╚╗        entrance                             ╔╝",
        " ╚╗   ░░░           ░░░                       ╔╝",
        "  ╚═══════════════════════════════════════════╝"
      ],
      "legend": {
        "~": "water",
        "▲": "stalagmite",
        "☠": "skeleton",
        "░": "shadow"
      },
      "symbolColors": {
        "~": "Blue",
        "▲": "DarkGray",
        "☠": "White",
        "░": "DarkGray"
      },
      "showLegend": true
    },
    "throne-room": {
      "art": [
        "╔═════════════════════════════════════════════╗",
        "║  ◊   ◊   ◊       THRONE ROOM       ◊   ◊   ◊║",
        "║                                             ║",
        "║   ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓   ║",
        "║   ▓                                   ▓   ║",
        "║   ▓    []      []      []      []     ▓   ║",
        "║   ▓                                   ▓   ║",
        "║   ▓              ╔═══╗                ▓   ║",
        "║   ▓              ║ ♔ ║                ▓   ║",
        "║   ▓              ╚═══╝                ▓   ║",
        "║   ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓   ║",
        "║                 entrance                   ║",
        "╚═════════════════════════════════════════════╝"
      ],
      "legend": {
        "◊": "torch",
        "▓": "carpet",
        "[]": "pillar",
        "♔": "throne"
      },
      "symbolColors": {
        "◊": "Yellow",
        "▓": "DarkRed",
        "♔": "Yellow"
      },
      "showLegend": true
    },
    "forest-clearing": {
      "art": [
        "     ♣   ♣        ♣   ♣        ♣   ♣     ",
        "   ♣   ♣    ♣        ♣    ♣   ♣   ♣   ♣ ",
        "         ┌────────────────────┐         ",
        "    ♣    │    Forest Clearing │    ♣    ",
        "         │                    │         ",
        "   ♣     │   ✿   ✿   ✿   ✿   │     ♣   ",
        "         │                    │         ",
        "    ♣    └────────────────────┘    ♣    ",
        "   ♣   ♣    ♣        ♣    ♣   ♣   ♣   ♣ ",
        "     ♣   ♣        ♣   ♣        ♣   ♣     "
      ],
      "legend": {
        "♣": "tree",
        "✿": "flower"
      },
      "symbolColors": {
        "♣": "DarkGreen",
        "✿": "Magenta"
      },
      "showLegend": true
    }
  },
  "defaultArt": {
    "template": "simple-box",
    "showExits": true,
    "showContents": true
  }
}
```

### 8.2 Configuration Schema

| Property | Type | Description |
|----------|------|-------------|
| `rooms` | object | Map of room ID to art definition |
| `rooms.*.art` | string[] | Lines of ASCII art |
| `rooms.*.legend` | object | Symbol → description mapping |
| `rooms.*.symbolColors` | object | Symbol → ConsoleColor mapping |
| `rooms.*.showLegend` | bool | Whether to show legend |
| `defaultArt.template` | string | Default template style |
| `defaultArt.showExits` | bool | Show exits in default art |
| `defaultArt.showContents` | bool | Show contents in default art |

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `AsciiRoomRenderer` | Debug | No custom art, scaling |
| `AsciiRoomRenderer` | Warning | Panel not found |
| `RoomArtProvider` | Information | Art definitions loaded |

### 9.2 Log Message Templates

```csharp
// AsciiRoomRenderer
_logger.LogDebug("No custom art for room '{RoomType}', using default", roomTypeId);
_logger.LogDebug("Truncating art from {OriginalWidth} to {TargetWidth}", 
    originalWidth, targetWidth);
_logger.LogWarning("MainContent panel not found");

// RoomArtProvider
_logger.LogInformation("Loaded {Count} room art definitions", count);
```

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| AsciiRoomRenderer | 5 |
| RoomArtDefinition | 2 |
| RoomArtProvider | 3 |
| **Total** | **~10** |

### 10.2 Test Specifications

#### AsciiRoomRendererTests.cs

```csharp
[TestFixture]
public class AsciiRoomRendererTests
{
    [Test]
    public void RenderRoom_WithCustomArt_RendersArtLines();
    
    [Test]
    public void RenderRoom_WithoutCustomArt_RendersDefaultArt();
    
    [Test]
    public void RenderRoom_WithEntities_OverlaysEntitySymbols();
    
    [Test]
    public void ScaleArt_WhenTooWide_TruncatesLines();
    
    [Test]
    public void RenderLegend_WithSymbols_DisplaysLegendLine();
}
```

#### RoomArtDefinitionTests.cs

```csharp
[TestFixture]
public class RoomArtDefinitionTests
{
    [Test]
    public void MaxWidth_ReturnsLongestLineWidth();
    
    [Test]
    public void UsedSymbols_ReturnsAllUniqueCharacters();
}
```

#### RoomArtProviderTests.cs

```csharp
[TestFixture]
public class RoomArtProviderTests
{
    [Test]
    public void GetArtForRoom_WithExistingId_ReturnsDefinition();
    
    [Test]
    public void GetArtForRoom_WithUnknownId_ReturnsNull();
    
    [Test]
    public void HasArt_WithExistingId_ReturnsTrue();
}
```

---

## 11. Use Cases

### UC-001: Display Room with Custom Art
**Actor:** Game Engine
**Flow:** Player enters room → GetArtForRoom() → Render art → Display legend → Show in main panel

### UC-002: Display Room without Art
**Actor:** Game Engine
**Flow:** Player enters room → GetArtForRoom() returns null → Render default template → Show room info

### UC-003: Overlay Monsters
**Actor:** Combat System
**Flow:** Combat starts → Get room art → Overlay monster symbols at positions → Render combined art

### UC-004: Scale Art for Narrow Terminal
**Actor:** UI System
**Flow:** Terminal width < art width → ScaleArt() → Truncate/center art → Render scaled version

---

## 12. Deliverable Checklist

### AsciiRoomRenderer Component
- [ ] `AsciiRoomRenderer` class created
- [ ] RenderRoom() with room only implemented
- [ ] RenderRoom() with entities implemented
- [ ] RenderLegend() implemented
- [ ] ScaleArt() implemented
- [ ] OverlayEntities() implemented
- [ ] RenderArtWithColors() implemented
- [ ] RenderDefaultArt() implemented
- [ ] Text wrapping helper implemented

### Room Art Definition
- [ ] `RoomArtDefinition` record created
- [ ] MaxWidth computed property
- [ ] Height property
- [ ] UsedSymbols property

### Art Provider
- [ ] `IRoomArtProvider` interface created
- [ ] `RoomArtProvider` implementation created
- [ ] `DefaultArtSettings` record created
- [ ] GetArtForRoom() implemented
- [ ] GetDefaultArt() implemented
- [ ] HasArt() implemented

### Configuration
- [ ] `config/room-art.json` created
- [ ] At least 3 sample room arts defined
- [ ] Legend and color mappings defined
- [ ] Default art settings configured

### Testing
- [ ] ~10 unit tests implemented
- [ ] All tests passing

---

## 13. Acceptance Criteria

### Functional
- [ ] Room art loads from JSON configuration correctly
- [ ] Art renders to main content panel
- [ ] Legend displays below art
- [ ] Symbols render with correct colors if defined
- [ ] Default art shows for rooms without custom art
- [ ] Default art includes room name, description, exits, contents
- [ ] Art scales (truncates/centers) to fit available width
- [ ] Entity symbols overlay on static art at specified positions
- [ ] Legend format adapts to available width
- [ ] AvailableArtIds lists all loaded room art IDs

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~10 unit tests pass
- [ ] XML documentation complete on all public members

---

## 14. Dependencies

### Required from v0.6.0a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `ScreenLayout` | `Presentation/UI/ScreenLayout.cs` | MainContent panel access |
| `Panel` | `Presentation/UI/Panel.cs` | Content area dimensions |
| `ITerminalService` | `Application/Interfaces/ITerminalService.cs` | Terminal output |

### Required from v0.6.0c

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `IColorThemeService` | `Application/Interfaces/IColorThemeService.cs` | Colored symbol output |

### Required from Prior Versions

| Type | Location | Usage |
|------|----------|-------|
| `Room` | `Domain/Entities/Room.cs` | Room data |
| `Entity` | `Domain/Entities/Entity.cs` | Entity overlays |

### Provides to v0.6.1c

| Type | Usage |
|------|-------|
| `IRoomArtProvider` | Mini-map may reference room types |
| Pattern | Similar rendering patterns for mini-map |

---

## 15. Future Considerations

### Deferred to v0.6.1c
- **Mini-Map**: Exploration tracking and map rendering (next part)

### Deferred to Future
- **Animated Art**: Simple frame-based animation (v0.7.x GUI)
- **Art Editor**: In-game art creation tool
- **Procedural Art**: Generated art based on room properties

### Out of Scope
- **3D Rendering**: Perspective/isometric views (GUI only)
- **Tile-Based Art**: Grid-based room templates

---

## Display Examples

### Dark Cave

```
    ╔═══════════════════════════════════════╗
   ╔╝                                       ╚╗
  ╔╝   ~~~   ▲   ~~~                         ╚╗
 ╔╝    ~~~  ▲▲▲  ~~~    ☠                     ╚╗
╔╝         ▲▲▲▲▲                               ╚╗
║    ░░     cave     ░░                         ║
╚╗        entrance                             ╔╝
 ╚╗   ░░░           ░░░                       ╔╝
  ╚═══════════════════════════════════════════╝

Legend: ~ = water  ▲ = stalagmite  ☠ = skeleton  ░ = shadow
```

### Default Art (No Custom Art)

```
┌─────────────────────────────────────────────┐
│                                             │
│                 Storage Room                │
│                                             │
│  A dusty storage room filled with old       │
│  crates and forgotten supplies.             │
│                                             │
│  Exits: North, South                        │
│                                             │
│  You see: Wooden Crate, Rusty Key           │
│                                             │
└─────────────────────────────────────────────┘
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: Assistant*
