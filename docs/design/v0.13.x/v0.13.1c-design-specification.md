# v0.13.1c Design Specification: Monster Group Display

**Version:** 0.13.1c
**Parent:** v0.13.1 (Boss & Monster UI)
**Prerequisites:** v0.13.0d Complete (Combat UI), v0.10.4c Complete (Monster Groups)
**Status:** Design Complete
**Estimated Unit Tests:** ~8

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Monster Group View Component](#4-monster-group-view-component)
   - 4.1 [MonsterGroupView Class](#41-monstergroupview-class)
   - 4.2 [Group Composition Rendering](#42-group-composition-rendering)
   - 4.3 [Individual Member Health Bars](#43-individual-member-health-bars)
5. [Tactic Indicator Component](#5-tactic-indicator-component)
   - 5.1 [TacticIndicator Class](#51-tacticindicator-class)
   - 5.2 [Tactic Description Formatting](#52-tactic-description-formatting)
   - 5.3 [Active Tactic Highlighting](#53-active-tactic-highlighting)
6. [Leader Badge Component](#6-leader-badge-component)
   - 6.1 [LeaderBadge Class](#61-leaderbadge-class)
   - 6.2 [Leader Bonus Display](#62-leader-bonus-display)
   - 6.3 [Leader Defeated Effects](#63-leader-defeated-effects)
7. [Group Morale Effects](#7-group-morale-effects)
   - 7.1 [Synergy Display](#71-synergy-display)
   - 7.2 [Morale Status Communication](#72-morale-status-communication)
8. [Monster Group Renderer](#8-monster-group-renderer)
   - 8.1 [MonsterGroupRenderer Class](#81-monstergrouprenderer-class)
   - 8.2 [Member Card Formatting](#82-member-card-formatting)
9. [Data Model Changes](#9-data-model-changes)
10. [Configuration File Schemas](#10-configuration-file-schemas)
11. [CombatView Integration](#11-combatview-integration)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)

---

## 1. Executive Summary

This version implements the monster group display UI components for presenting grouped enemy compositions, their coordinated tactics, and leader designation. The monster group display provides players with strategic information about enemy groups including member health bars, tactic indicators showing coordinated behaviors, leader badges highlighting group leaders, and morale effects communication when synergies are active or leaders are defeated.

### Key Deliverables

| Category | Items |
|----------|-------|
| **UI Components** | `MonsterGroupView`, `TacticIndicator`, `LeaderBadge` |
| **Renderers** | `MonsterGroupRenderer` |
| **DTOs** | `MonsterGroupDisplayDto`, `GroupMemberDisplayDto`, `TacticDisplayDto`, `LeaderStatusDto`, `SynergyDisplayDto` |
| **View Updates** | `CombatView` integration |
| **Configuration** | `monster-group-display.json` |
| **Tests** | ~8 unit tests |

### Architectural Significance

This version continues the **Combat UI Component Pattern** established in v0.13.0a:
- UI Components receive data from services via DTOs
- Renderers handle symbol/color mapping and terminal output
- Components integrate with existing `CombatView` via defined integration points
- Configuration drives visual appearance (colors, symbols, formats)
- Event-driven updates for group state changes (leader death, synergy triggers)

---

## 2. Feature Overview

```
v0.13.1c Features
├── MonsterGroupView (UI Component)
│   ├── RenderGroup(MonsterGroupDisplayDto)
│   ├── ShowMemberHealth(GroupMemberDisplayDto)
│   ├── HighlightLeader(GroupMemberDisplayDto)
│   └── ShowMoraleEffect(SynergyDisplayDto)
│
├── TacticIndicator (UI Component)
│   ├── RenderTactic(TacticDisplayDto)
│   ├── ShowTacticDetails(TacticDisplayDto)
│   └── HighlightActiveTactic()
│
├── LeaderBadge (UI Component)
│   ├── RenderBadge(LeaderStatusDto)
│   ├── ShowLeaderBonus(IEnumerable<string>)
│   └── ShowLeaderDefeated(LeaderStatusDto)
│
├── Group Morale Effects
│   ├── Synergy Display
│   ├── Morale Status Communication
│   └── Leader Defeated Effect Box
│
├── MonsterGroupRenderer (Renderer)
│   ├── FormatMemberCard(GroupMemberDisplayDto, bool)
│   ├── FormatTacticDescription(TacticDisplayDto)
│   ├── GetMemberHealthColor(double)
│   ├── GetLeaderBadgeSymbol()
│   └── FormatSynergyText(SynergyDisplayDto)
│
└── CombatView Integration
    ├── Group Detection
    ├── Side Panel Placement
    └── Event Subscription
```

### Scope Verification

| Feature | Source | Included |
|---------|--------|----------|
| Group composition view showing all members | v0.13.1-scope-breakdown.md | Yes |
| Individual member health bars | v0.13.1-scope-breakdown.md | Yes |
| Tactic indicators for coordinated behaviors | v0.13.1-scope-breakdown.md | Yes |
| Leader designation badge | v0.13.1-scope-breakdown.md | Yes |
| Group morale effects communication | v0.13.1-scope-breakdown.md | Yes |
| Boss health bar | v0.13.1-scope-breakdown.md | No (v0.13.1a) |
| Boss status display | v0.13.1-scope-breakdown.md | No (v0.13.1b) |

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          PRESENTATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │     CombatView          │      │   MonsterGroupView      │               │
│  │     (existing)          │◄────▶│   (NEW)                 │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderCombatState()   │      │ - RenderGroup()         │               │
│  │ - HandleMonsterGroups() │      │ - ShowMemberHealth()    │               │
│  │ - IntegrateComponents() │      │ - HighlightLeader()     │               │
│  └─────────────────────────┘      │ - ShowMoraleEffect()    │               │
│                                    └───────────┬─────────────┘               │
│                                                │                             │
│  ┌─────────────────────────┐      ┌────────────┴────────────┐               │
│  │   TacticIndicator       │      │     LeaderBadge         │               │
│  │   (NEW)                 │      │     (NEW)               │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderTactic()        │      │ - RenderBadge()         │               │
│  │ - ShowTacticDetails()   │      │ - ShowLeaderBonus()     │               │
│  │ - HighlightActiveTactic │      │ - ShowLeaderDefeated()  │               │
│  └─────────────────────────┘      └─────────────────────────┘               │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────┐            │
│  │                  MonsterGroupRenderer (NEW)                  │            │
│  ├─────────────────────────────────────────────────────────────┤            │
│  │ - FormatMemberCard()   - GetMemberHealthColor()              │            │
│  │ - FormatTacticDescription()  - GetLeaderBadgeSymbol()        │            │
│  │ - FormatSynergyText()  - FormatRoleAssignment()              │            │
│  └─────────────────────────────────────────────────────────────┘            │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          APPLICATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IMonsterGroupService (existing v0.10.4c)         │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetGroupForMonster(monster) : MonsterGroupInstance?               │    │
│  │ + GetActiveGroups() : IReadOnlyList<MonsterGroupInstance>           │    │
│  │ + IsInGroup(monster) : bool                                         │    │
│  │ + GetAdjacentAllyDamageBonus(monster) : int                         │    │
│  │ + GetAdjacentAllyAttackBonus(monster) : int                         │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IMonsterGroupProvider (existing v0.10.4c)        │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetGroup(groupId) : MonsterGroupDefinition?                       │    │
│  │ + GetAllGroups() : IReadOnlyList<MonsterGroupDefinition>            │    │
│  │ + GetGroupsByTag(tag) : IReadOnlyList<MonsterGroupDefinition>       │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IEventBus (existing)                             │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + Subscribe<EntityDeathEvent>(handler) : IDisposable               │    │
│  │ + Subscribe<GroupSynergyTriggeredEvent>(handler) : IDisposable     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    MonsterGroupInstance (existing v0.10.4c)         │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + Id: Guid                                                          │    │
│  │ + GroupId: string                                                   │    │
│  │ + Definition: MonsterGroupDefinition                                │    │
│  │ + AliveMembers: IReadOnlyList<Monster>                              │    │
│  │ + GetLeader() : Monster?                                            │    │
│  │ + GetMembersByRole(role) : IReadOnlyList<Monster>                   │    │
│  │ + HasAliveLeader: bool                                              │    │
│  │ + AliveCount: int                                                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │ MonsterGroupDefinition  │      │     GroupMember         │               │
│  │   (existing v0.10.4c)   │◄─────│   (existing v0.10.4c)   │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + GroupId: string       │      │ + MonsterDefinitionId   │               │
│  │ + Name: string          │      │ + Count: int            │               │
│  │ + Members: IReadOnly... │      │ + Role: string          │               │
│  │ + Tactics: IReadOnly... │      │ + PreferredPosition     │               │
│  │ + Synergies: IReadOnly..│      └─────────────────────────┘               │
│  │ + LeaderRole: string?   │                                                 │
│  │ + GetLeaderMember()     │      ┌─────────────────────────┐               │
│  │ + HasTactic(tactic)     │      │      GroupTactic        │               │
│  └─────────────────────────┘      │   (existing v0.10.4c)   │               │
│                                    ├─────────────────────────┤               │
│  ┌─────────────────────────┐      │ - Flank                 │               │
│  │     GroupSynergy        │      │ - FocusFire             │               │
│  │   (existing v0.10.4c)   │      │ - ProtectLeader         │               │
│  ├─────────────────────────┤      │ - ProtectCaster         │               │
│  │ + SynergyId: string     │      │ - Swarm                 │               │
│  │ + Name: string          │      │ - Retreat               │               │
│  │ + Trigger: SynergyTrigger│      │ - Ambush                │               │
│  │ + SourceRole: string?   │      │ - HitAndRun             │               │
│  │ + StatusEffectId: str?  │      └─────────────────────────┘               │
│  │ + AttackBonus: int      │                                                 │
│  │ + DamageBonus: int      │      ┌─────────────────────────┐               │
│  │ + AppliesToAllMembers   │      │      Monster            │               │
│  └─────────────────────────┘      │   (existing)            │               │
│                                    ├─────────────────────────┤               │
│  ┌─────────────────────────┐      │ + Id: Guid              │               │
│  │    SynergyTrigger       │      │ + Name: string          │               │
│  │   (existing v0.10.4c)   │      │ + Health: int           │               │
│  ├─────────────────────────┤      │ + MaxHealth: int        │               │
│  │ - Always                │      │ + IsAlive: bool         │               │
│  │ - OnAllyHit             │      └─────────────────────────┘               │
│  │ - OnAllyDamaged         │                                                 │
│  │ - OnLeaderCommand       │                                                 │
│  │ - PerAdjacentAlly       │                                                 │
│  └─────────────────────────┘                                                 │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Data Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    MONSTER GROUP DISPLAY DATA FLOW                           │
└─────────────────────────────────────────────────────────────────────────────┘

    Combat Encounter Started / Combat Turn Update
           │
           ▼
┌─────────────────────────┐
│      CombatView         │
│  HandleMonsterGroups()  │
└───────────┬─────────────┘
            │
            │ 1. Check for active monster groups
            ▼
┌─────────────────────────┐
│  IMonsterGroupService   │
│  GetActiveGroups()      │
└───────────┬─────────────┘
            │
            │ 2. Returns active MonsterGroupInstances
            ▼
┌─────────────────────────────────────────────────────────────┐
│    MonsterGroupView                                          │
│                                                              │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ CreateGroupDto()  │  │ CreateMemberDtos()│               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
│            │                      │                          │
│            │ 3. Build display DTOs                          │
│            ▼                      ▼                          │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ RenderGroup()     │  │ ShowMemberHealth()│               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
│            │                      │                          │
│            │ 4. Render group header and composition         │
│            ▼                      ▼                          │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ TacticIndicator   │  │ LeaderBadge       │               │
│  │ RenderTactic()    │  │ RenderBadge()     │               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
└────────────┼──────────────────────┼─────────────────────────┘
             │                      │
             │ 5. Call renderer for formatting
             ▼                      ▼
┌─────────────────────────────────────────────────────────────┐
│ MonsterGroupRenderer                                         │
│                                                              │
│ - FormatMemberCard()      │ 6. Format member cards          │
│ - FormatTacticDescription()  7. Format tactic text          │
│ - GetMemberHealthColor()  │ 8. Get color for health %       │
│ - GetLeaderBadgeSymbol()  │ 9. Return "[*]" badge           │
│ - FormatSynergyText()     │ 10. Format active synergies     │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 11. Return formatted strings
            ▼
┌─────────────────────────┐
│   ITerminalService      │
│   WriteAt(x, y, text)   │
│   WriteColoredAt(...)   │
└─────────────────────────┘
```

### 3.3 Event Flow Diagram - Leader Defeated

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    LEADER DEFEATED EVENT FLOW                                │
└─────────────────────────────────────────────────────────────────────────────┘

    Group Leader Takes Lethal Damage
           │
           ▼
┌─────────────────────────┐
│  Combat System          │
│  ProcessDeath(leader)   │
└───────────┬─────────────┘
            │
            │ 1. Publishes EntityDeathEvent
            ▼
┌─────────────────────────┐
│      IEventBus          │
│  Publish(event)         │
└───────────┬─────────────┘
            │
            │ 2. Event delivered to subscribers
            ▼
┌─────────────────────────┐
│  MonsterGroupView       │
│  OnEntityDeath(event)   │
└───────────┬─────────────┘
            │
            │ 3. Check if entity is group leader
            ▼
     ┌──────┴──────┐
     │ Is Leader?  │
     └──────┬──────┘
            │
      Yes   │   No (ignore)
            ▼
┌─────────────────────────┐
│  Get Group Instance     │
│  GetGroupForMonster()   │
└───────────┬─────────────┘
            │
            │ 4. Retrieve group definition
            ▼
┌─────────────────────────┐
│  Create LeaderStatusDto │
│                         │
│  LeaderName: "Goblin    │
│              Chief"     │
│  IsDefeated: true       │
│  MoraleEffects: [...]   │
└───────────┬─────────────┘
            │
            │ 5. Display leader defeated effect
            ▼
┌─────────────────────────┐
│  LeaderBadge            │
│  ShowLeaderDefeated()   │
│                         │
│  ╔═══════════════════╗  │
│  ║  LEADER DEFEATED  ║  │
│  ╠═══════════════════╣  │
│  ║ Goblin Chief has  ║  │
│  ║ fallen!           ║  │
│  ║                   ║  │
│  ║ Group morale      ║  │
│  ║ broken:           ║  │
│  ║ - -25% attack     ║  │
│  ║ - 50% flee chance ║  │
│  ╚═══════════════════╝  │
└─────────────────────────┘
```

---

## 4. Monster Group View Component

### 4.1 MonsterGroupView Class

**Purpose:** Renders the complete monster group display including group header, member cards, and coordination information.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/MonsterGroupView.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Application.Events;
using RuneAndRust.Application.Tracking;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.DTOs;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Renders the monster group display showing group composition,
/// member health bars, tactics, and leader designation.
/// </summary>
/// <remarks>
/// The monster group view is displayed during combat when fighting
/// coordinated enemy groups. It shows each member's health, the
/// group's current tactic, and highlights the group leader.
/// </remarks>
public class MonsterGroupView
{
    private readonly MonsterGroupRenderer _renderer;
    private readonly ITerminalService _terminalService;
    private readonly TacticIndicator _tacticIndicator;
    private readonly LeaderBadge _leaderBadge;
    private readonly MonsterGroupDisplayConfig _config;
    private readonly ILogger<MonsterGroupView> _logger;

    private MonsterGroupDisplayDto? _currentGroup;
    private IReadOnlyList<GroupMemberDisplayDto> _members = Array.Empty<GroupMemberDisplayDto>();

    /// <summary>
    /// Creates a new instance of the MonsterGroupView.
    /// </summary>
    /// <param name="renderer">The renderer for formatting group elements.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="tacticIndicator">The tactic indicator component.</param>
    /// <param name="leaderBadge">The leader badge component.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public MonsterGroupView(
        MonsterGroupRenderer renderer,
        ITerminalService terminalService,
        TacticIndicator tacticIndicator,
        LeaderBadge leaderBadge,
        MonsterGroupDisplayConfig config,
        ILogger<MonsterGroupView> logger)
    {
        _renderer = renderer ?? throw new ArgumentNullException(nameof(renderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _tacticIndicator = tacticIndicator ?? throw new ArgumentNullException(nameof(tacticIndicator));
        _leaderBadge = leaderBadge ?? throw new ArgumentNullException(nameof(leaderBadge));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders the complete monster group display.
    /// </summary>
    /// <param name="groupDto">The monster group display data.</param>
    public void RenderGroup(MonsterGroupDisplayDto groupDto)
    {
        _currentGroup = groupDto ?? throw new ArgumentNullException(nameof(groupDto));
        _members = groupDto.Members;

        _logger.LogDebug(
            "Rendering monster group '{GroupName}' with {MemberCount} members",
            groupDto.GroupName,
            groupDto.Members.Count);

        // Render group header with name
        RenderGroupHeader(groupDto.GroupName);

        // Render member cards in horizontal layout
        RenderMemberCards(groupDto.Members);

        // Render current tactic
        if (groupDto.CurrentTactic != null)
        {
            _tacticIndicator.RenderTactic(groupDto.CurrentTactic);
        }

        // Render morale/synergy hint if leader exists
        if (groupDto.HasLeader)
        {
            RenderMoraleHint(groupDto.LeaderRole);
        }
    }

    /// <summary>
    /// Renders individual member health bar.
    /// </summary>
    /// <param name="memberDto">The member display data.</param>
    public void ShowMemberHealth(GroupMemberDisplayDto memberDto)
    {
        var cardIndex = _members.ToList().FindIndex(m => m.MonsterId == memberDto.MonsterId);
        if (cardIndex < 0)
        {
            _logger.LogWarning("Member {MonsterId} not found in group", memberDto.MonsterId);
            return;
        }

        var cardX = CalculateMemberCardX(cardIndex);
        var healthY = _config.StartY + _config.MemberCardStartRow + 3;

        var healthText = _renderer.FormatMemberHealthBar(
            memberDto.CurrentHealth,
            memberDto.MaxHealth,
            _config.MemberCardWidth - 4);

        var healthColor = _renderer.GetMemberHealthColor(memberDto.HealthPercent);

        _terminalService.WriteColoredAt(cardX + 2, healthY, healthText, healthColor);

        _logger.LogDebug(
            "Updated health for {MemberName}: {Current}/{Max}",
            memberDto.MemberName,
            memberDto.CurrentHealth,
            memberDto.MaxHealth);
    }

    /// <summary>
    /// Highlights the leader member with the leader badge.
    /// </summary>
    /// <param name="memberDto">The leader member display data.</param>
    public void HighlightLeader(GroupMemberDisplayDto memberDto)
    {
        if (!memberDto.IsLeader)
        {
            _logger.LogWarning("Member {MemberName} is not the leader", memberDto.MemberName);
            return;
        }

        var leaderStatus = new LeaderStatusDto(
            LeaderName: memberDto.MemberName,
            LeaderRole: memberDto.Role,
            IsAlive: memberDto.IsAlive,
            IsDefeated: !memberDto.IsAlive,
            MoraleEffects: Array.Empty<string>());

        _leaderBadge.RenderBadge(leaderStatus);

        _logger.LogDebug("Highlighted leader: {LeaderName}", memberDto.MemberName);
    }

    /// <summary>
    /// Displays a morale effect notification.
    /// </summary>
    /// <param name="synergyDto">The synergy/morale effect data.</param>
    public void ShowMoraleEffect(SynergyDisplayDto synergyDto)
    {
        if (synergyDto == null) return;

        var effectY = _config.StartY + _config.MoraleEffectRow;
        var effectText = _renderer.FormatSynergyText(synergyDto);

        _terminalService.WriteColoredAt(
            _config.StartX,
            effectY,
            effectText,
            _config.Colors.SynergyColor);

        _logger.LogDebug(
            "Displayed morale effect: {SynergyName}",
            synergyDto.SynergyName);
    }

    /// <summary>
    /// Clears the monster group display from the terminal.
    /// </summary>
    public void Clear()
    {
        _currentGroup = null;
        _members = Array.Empty<GroupMemberDisplayDto>();

        // Clear the display area
        var clearLine = new string(' ', _config.TotalWidth);
        for (var row = 0; row < _config.TotalHeight; row++)
        {
            _terminalService.WriteAt(_config.StartX, _config.StartY + row, clearLine);
        }

        _tacticIndicator.Clear();
        _leaderBadge.Clear();

        _logger.LogDebug("Cleared monster group display");
    }

    #region Private Rendering Methods

    private void RenderGroupHeader(string groupName)
    {
        var header = _renderer.FormatGroupHeader(groupName, _config.TotalWidth);
        var headerColor = _config.Colors.HeaderColor;

        _terminalService.WriteColoredAt(
            _config.StartX,
            _config.StartY,
            header,
            headerColor);
    }

    private void RenderMemberCards(IReadOnlyList<GroupMemberDisplayDto> members)
    {
        for (var i = 0; i < members.Count; i++)
        {
            var member = members[i];
            var cardX = CalculateMemberCardX(i);

            RenderSingleMemberCard(member, cardX);
        }
    }

    private void RenderSingleMemberCard(GroupMemberDisplayDto member, int cardX)
    {
        var cardY = _config.StartY + _config.MemberCardStartRow;
        var card = _renderer.FormatMemberCard(member, _config.MemberCardWidth);

        // Card has multiple lines - render each
        var lines = card.Split('\n');
        for (var lineIndex = 0; lineIndex < lines.Length; lineIndex++)
        {
            var line = lines[lineIndex];
            var lineColor = GetLineColor(member, lineIndex);

            _terminalService.WriteColoredAt(cardX, cardY + lineIndex, line, lineColor);
        }
    }

    private ConsoleColor GetLineColor(GroupMemberDisplayDto member, int lineIndex)
    {
        // Line 0: Card border or leader badge
        if (lineIndex == 0 && member.IsLeader)
        {
            return _config.Colors.LeaderColor;
        }

        // Line 3: Health bar
        if (lineIndex == 3)
        {
            return _renderer.GetMemberHealthColor(member.HealthPercent);
        }

        return _config.Colors.DefaultColor;
    }

    private void RenderMoraleHint(string leaderRole)
    {
        var hintY = _config.StartY + _config.MoraleHintRow;
        var hintText = $"Kill the {leaderRole} to break morale!";

        _terminalService.WriteColoredAt(
            _config.StartX,
            hintY,
            hintText,
            _config.Colors.HintColor);
    }

    private int CalculateMemberCardX(int cardIndex)
    {
        return _config.StartX +
               _config.TextIndent +
               (cardIndex * (_config.MemberCardWidth + _config.CardSpacing));
    }

    #endregion
}
```

### 4.2 Group Composition Rendering

**Purpose:** Display all group members in a horizontal card layout showing name, role, and health.

The group composition uses a card-based layout where each member is displayed in a small bordered card showing:
- Leader badge (if applicable)
- Monster name
- Role designation
- Health bar

**Card Layout Example:**

```
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│ [*] LEADER  │  │   Goblin    │  │   Goblin    │
│   Goblin    │  │   Archer    │  │   Shaman    │
│   Chief     │  │             │  │             │
│ HP: 45/45   │  │ HP: 20/20   │  │ HP: 25/25   │
└─────────────┘  └─────────────┘  └─────────────┘
```

**Card Positioning Algorithm:**

```csharp
/// <summary>
/// Calculates the X position for a member card.
/// </summary>
/// <param name="cardIndex">The zero-based index of the card.</param>
/// <param name="startX">The starting X coordinate of the display.</param>
/// <param name="textIndent">The text indentation.</param>
/// <param name="cardWidth">The width of each card.</param>
/// <param name="cardSpacing">The spacing between cards.</param>
/// <returns>The X coordinate for the card.</returns>
/// <remarks>
/// Example: For 3 cards with cardWidth=15, spacing=2:
/// Card 0: startX + indent + 0 * (15 + 2) = startX + indent
/// Card 1: startX + indent + 1 * (15 + 2) = startX + indent + 17
/// Card 2: startX + indent + 2 * (15 + 2) = startX + indent + 34
/// </remarks>
private static int CalculateMemberCardX(int cardIndex, int startX, int textIndent, int cardWidth, int cardSpacing)
{
    return startX + textIndent + (cardIndex * (cardWidth + cardSpacing));
}
```

### 4.3 Individual Member Health Bars

**Purpose:** Display compact health bars for each group member within their card.

Each member's health bar is a simplified version showing current/max HP:

| Health Percentage | Display Color |
|-------------------|---------------|
| 76-100% | Green |
| 51-75% | Yellow |
| 26-50% | Orange |
| 1-25% | Red |
| 0% | Dark Red |

**Health Bar Format:**

```
HP: 45/45   (full health - green)
HP: 15/45   (33% - orange)
HP: 5/45    (11% - red)
```

---

## 5. Tactic Indicator Component

### 5.1 TacticIndicator Class

**Purpose:** Displays the current coordinated tactic being used by the monster group.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/TacticIndicator.cs`

```csharp
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.DTOs;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Renders tactic indicators showing the current coordinated
/// behavior of a monster group.
/// </summary>
/// <remarks>
/// The tactic indicator displays the group's current tactic name
/// and a description of what each role does within that tactic.
/// </remarks>
public class TacticIndicator
{
    private readonly MonsterGroupRenderer _renderer;
    private readonly ITerminalService _terminalService;
    private readonly MonsterGroupDisplayConfig _config;
    private readonly ILogger<TacticIndicator> _logger;

    private TacticDisplayDto? _currentTactic;
    private bool _isHighlighted;

    /// <summary>
    /// Creates a new instance of the TacticIndicator.
    /// </summary>
    /// <param name="renderer">The renderer for formatting tactic elements.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public TacticIndicator(
        MonsterGroupRenderer renderer,
        ITerminalService terminalService,
        MonsterGroupDisplayConfig config,
        ILogger<TacticIndicator> logger)
    {
        _renderer = renderer ?? throw new ArgumentNullException(nameof(renderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders the current tactic indicator.
    /// </summary>
    /// <param name="tacticDto">The tactic display data.</param>
    public void RenderTactic(TacticDisplayDto tacticDto)
    {
        _currentTactic = tacticDto ?? throw new ArgumentNullException(nameof(tacticDto));
        _isHighlighted = false;

        _logger.LogDebug(
            "Rendering tactic indicator: {TacticName}",
            tacticDto.TacticName);

        var tacticY = _config.StartY + _config.TacticIndicatorRow;

        // Render tactic title
        var titleText = $"TACTIC: {tacticDto.TacticName}";
        _terminalService.WriteColoredAt(
            _config.StartX + _config.TextIndent,
            tacticY,
            titleText,
            _config.Colors.TacticColor);

        // Render role assignments
        RenderRoleAssignments(tacticDto.RoleAssignments, tacticY + 1);
    }

    /// <summary>
    /// Shows detailed tactic information.
    /// </summary>
    /// <param name="tacticDto">The tactic display data.</param>
    public void ShowTacticDetails(TacticDisplayDto tacticDto)
    {
        if (tacticDto == null) return;

        _logger.LogDebug(
            "Showing tactic details: {TacticName} - {Description}",
            tacticDto.TacticName,
            tacticDto.Description);

        var detailY = _config.StartY + _config.TacticIndicatorRow + 1;

        // Show description if different from role assignments
        if (!string.IsNullOrEmpty(tacticDto.Description))
        {
            _terminalService.WriteAt(
                _config.StartX + _config.TextIndent,
                detailY,
                tacticDto.Description);
        }
    }

    /// <summary>
    /// Highlights the current tactic to draw attention.
    /// </summary>
    public void HighlightActiveTactic()
    {
        if (_currentTactic == null)
        {
            _logger.LogDebug("No tactic to highlight");
            return;
        }

        _isHighlighted = true;

        var tacticY = _config.StartY + _config.TacticIndicatorRow;
        var titleText = $"TACTIC: {_currentTactic.TacticName}";

        // Use highlight color
        _terminalService.WriteColoredAt(
            _config.StartX + _config.TextIndent,
            tacticY,
            titleText,
            _config.Colors.TacticHighlightColor);

        _logger.LogDebug("Highlighted tactic: {TacticName}", _currentTactic.TacticName);
    }

    /// <summary>
    /// Clears the tactic indicator display.
    /// </summary>
    public void Clear()
    {
        _currentTactic = null;
        _isHighlighted = false;

        var clearLine = new string(' ', _config.TotalWidth);
        var tacticY = _config.StartY + _config.TacticIndicatorRow;

        // Clear tactic title and role assignments (4 lines)
        for (var i = 0; i < 4; i++)
        {
            _terminalService.WriteAt(_config.StartX, tacticY + i, clearLine);
        }

        _logger.LogDebug("Cleared tactic indicator");
    }

    #region Private Methods

    private void RenderRoleAssignments(IReadOnlyList<RoleAssignmentDto> assignments, int startY)
    {
        for (var i = 0; i < assignments.Count; i++)
        {
            var assignment = assignments[i];
            var prefix = i == assignments.Count - 1 ? "+-- " : "|-- ";
            var text = $"{prefix}{assignment.RoleName}: {assignment.ActionDescription}";

            _terminalService.WriteAt(
                _config.StartX + _config.TextIndent,
                startY + i,
                text);
        }
    }

    #endregion
}
```

### 5.2 Tactic Description Formatting

**Purpose:** Format tactic information with role-specific action descriptions.

Each tactic type has predefined descriptions and role assignments:

| Tactic | Description | Role Assignments |
|--------|-------------|------------------|
| Flank | "Surround target for flanking bonuses" | Melee: Move to cardinal positions |
| FocusFire | "All attack same target" | All: Coordinate on lowest HP enemy |
| ProtectLeader | "Defend the group leader" | Non-leaders: Position between leader and threat |
| ProtectCaster | "Defend ranged/spellcasters" | Melee: Protect caster roles |
| Swarm | "Close in from all sides" | All: Move toward target |
| Retreat | "Fall back when damaged" | All: Fall back to regroup |
| Ambush | "Wait in ambush position" | All: Hold position until enemy in range |
| HitAndRun | "Attack then disengage" | All: Attack then move away |

**Tactic Display Format:**

```
TACTIC: Flanking Assault
|-- Archers: Attack from range
|-- Chief: Engage in melee
+-- Shaman: Provide support
```

### 5.3 Active Tactic Highlighting

**Purpose:** Visually emphasize when a tactic is being executed.

When a group executes a coordinated action, the tactic indicator briefly highlights:
- Tactic title changes to highlight color (Cyan)
- Brief flash effect (100ms)
- Returns to normal tactic color (Yellow)

---

## 6. Leader Badge Component

### 6.1 LeaderBadge Class

**Purpose:** Renders the leader designation badge and handles leader-related effects.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/LeaderBadge.cs`

```csharp
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.DTOs;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Renders the leader badge and handles leader defeat notifications.
/// </summary>
/// <remarks>
/// The leader badge appears on the leader's member card with a [*] symbol.
/// When the leader is defeated, a notification box appears showing the
/// morale impact on the remaining group members.
/// </remarks>
public class LeaderBadge
{
    private readonly MonsterGroupRenderer _renderer;
    private readonly ITerminalService _terminalService;
    private readonly MonsterGroupDisplayConfig _config;
    private readonly ILogger<LeaderBadge> _logger;

    private LeaderStatusDto? _currentStatus;

    /// <summary>
    /// Creates a new instance of the LeaderBadge.
    /// </summary>
    /// <param name="renderer">The renderer for formatting badge elements.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public LeaderBadge(
        MonsterGroupRenderer renderer,
        ITerminalService terminalService,
        MonsterGroupDisplayConfig config,
        ILogger<LeaderBadge> logger)
    {
        _renderer = renderer ?? throw new ArgumentNullException(nameof(renderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders the leader badge on a member card.
    /// </summary>
    /// <param name="leaderStatus">The leader status data.</param>
    public void RenderBadge(LeaderStatusDto leaderStatus)
    {
        _currentStatus = leaderStatus ?? throw new ArgumentNullException(nameof(leaderStatus));

        if (!leaderStatus.IsAlive)
        {
            _logger.LogDebug("Leader {LeaderName} is not alive, badge hidden", leaderStatus.LeaderName);
            return;
        }

        var badgeSymbol = _renderer.GetLeaderBadgeSymbol();

        _logger.LogDebug(
            "Rendering leader badge for {LeaderName} ({BadgeSymbol})",
            leaderStatus.LeaderName,
            badgeSymbol);
    }

    /// <summary>
    /// Shows the leader bonus information.
    /// </summary>
    /// <param name="bonuses">The list of bonus descriptions.</param>
    public void ShowLeaderBonus(IEnumerable<string> bonuses)
    {
        if (bonuses == null || !bonuses.Any())
        {
            _logger.LogDebug("No leader bonuses to display");
            return;
        }

        var bonusList = bonuses.ToList();
        _logger.LogDebug("Displaying {Count} leader bonuses", bonusList.Count);

        // Bonuses are displayed in the synergy area
        var bonusY = _config.StartY + _config.MoraleEffectRow;

        for (var i = 0; i < bonusList.Count; i++)
        {
            var prefix = i == 0 ? "Leader provides: " : "                 ";
            var bonusText = $"{prefix}{bonusList[i]}";

            _terminalService.WriteColoredAt(
                _config.StartX + _config.TextIndent,
                bonusY + i,
                bonusText,
                _config.Colors.LeaderColor);
        }
    }

    /// <summary>
    /// Shows the leader defeated effect box.
    /// </summary>
    /// <param name="leaderStatus">The leader status data with morale effects.</param>
    public void ShowLeaderDefeated(LeaderStatusDto leaderStatus)
    {
        if (!leaderStatus.IsDefeated)
        {
            _logger.LogWarning("ShowLeaderDefeated called but leader is not defeated");
            return;
        }

        _currentStatus = leaderStatus;

        _logger.LogDebug(
            "Showing leader defeated effect for {LeaderName}",
            leaderStatus.LeaderName);

        // Render the effect box
        RenderLeaderDefeatedBox(leaderStatus);
    }

    /// <summary>
    /// Clears the leader badge display.
    /// </summary>
    public void Clear()
    {
        _currentStatus = null;

        // Clear any effect box if displayed
        ClearEffectBox();

        _logger.LogDebug("Cleared leader badge display");
    }

    #region Private Methods

    private void RenderLeaderDefeatedBox(LeaderStatusDto leaderStatus)
    {
        var boxWidth = _config.EffectBox.Width;
        var boxX = _config.StartX + (_config.TotalWidth - boxWidth) / 2;
        var boxY = _config.StartY + _config.EffectBox.StartRow;

        // Box header
        var topBorder = "+" + new string('=', boxWidth - 2) + "+";
        var titleLine = FormatCenteredLine("[!]  LEADER DEFEATED", boxWidth);
        var divider = "+" + new string('=', boxWidth - 2) + "+";

        _terminalService.WriteColoredAt(boxX, boxY, topBorder, _config.Colors.EffectBoxBorderColor);
        _terminalService.WriteColoredAt(boxX, boxY + 1, titleLine, _config.Colors.EffectBoxTitleColor);
        _terminalService.WriteColoredAt(boxX, boxY + 2, divider, _config.Colors.EffectBoxBorderColor);

        // Content
        var defeatedText = $"{leaderStatus.LeaderName} has fallen!";
        _terminalService.WriteColoredAt(boxX, boxY + 3, FormatCenteredLine("", boxWidth), _config.Colors.DefaultColor);
        _terminalService.WriteColoredAt(boxX, boxY + 4, FormatCenteredLine(defeatedText, boxWidth), _config.Colors.EffectBoxContentColor);
        _terminalService.WriteColoredAt(boxX, boxY + 5, FormatCenteredLine("", boxWidth), _config.Colors.DefaultColor);
        _terminalService.WriteColoredAt(boxX, boxY + 6, FormatCenteredLine("Group morale broken:", boxWidth), _config.Colors.EffectBoxContentColor);

        // Morale effects
        var effectY = boxY + 7;
        foreach (var effect in leaderStatus.MoraleEffects)
        {
            var effectLine = FormatCenteredLine($"|-- {effect}", boxWidth);
            _terminalService.WriteColoredAt(boxX, effectY++, effectLine, _config.Colors.NegativeEffectColor);
        }

        // Bottom border
        _terminalService.WriteColoredAt(boxX, effectY, "+" + new string('=', boxWidth - 2) + "+", _config.Colors.EffectBoxBorderColor);
    }

    private void ClearEffectBox()
    {
        var boxWidth = _config.EffectBox.Width;
        var boxX = _config.StartX + (_config.TotalWidth - boxWidth) / 2;
        var boxY = _config.StartY + _config.EffectBox.StartRow;
        var boxHeight = _config.EffectBox.Height;

        var clearLine = new string(' ', boxWidth);

        for (var i = 0; i < boxHeight; i++)
        {
            _terminalService.WriteAt(boxX, boxY + i, clearLine);
        }
    }

    private static string FormatCenteredLine(string text, int width)
    {
        if (text.Length >= width - 4) return $"| {text.Substring(0, width - 4)} |";

        var padding = (width - 4 - text.Length) / 2;
        var paddedText = text.PadLeft(padding + text.Length).PadRight(width - 4);
        return $"| {paddedText} |";
    }

    #endregion
}
```

### 6.2 Leader Bonus Display

**Purpose:** Show bonuses provided by the leader to group members.

Leader bonuses are displayed when a leader has active synergies affecting the group:

```
Leader provides: +1 Attack to all allies
                 +2 Damage on flanking hits
```

### 6.3 Leader Defeated Effects

**Purpose:** Display dramatic notification when the group leader is killed.

When a group leader dies, a prominent effect box appears showing:
- Leader name and defeat notification
- Morale impact on remaining group members
- Negative effects applied to survivors

**Leader Defeated Effect Box:**

```
+=====================================================+
|  [!]  LEADER DEFEATED                               |
+=====================================================+
|                                                     |
|  Goblin Chief has fallen!                           |
|                                                     |
|  Group morale broken:                               |
|  |-- -25% attack for all remaining goblins          |
|  +-- 50% chance to flee on each turn                |
|                                                     |
+=====================================================+
```

---

## 7. Group Morale Effects

### 7.1 Synergy Display

**Purpose:** Communicate active synergy effects to the player.

Synergy effects from v0.10.4c are displayed when triggered:

| Synergy Trigger | Display Format |
|-----------------|----------------|
| Always | "Active: {SynergyName}" (shown on group display) |
| OnAllyHit | "SYNERGY: {SynergyName} triggered!" (flash notification) |
| OnAllyDamaged | "SYNERGY: {SynergyName} - {Effect}" (flash notification) |
| PerAdjacentAlly | "+{Bonus} from Pack Tactics" (shown in combat log) |

**Synergy Display Examples:**

```
Active: Shaman's Blessing (+1 attack to all allies)
```

```
SYNERGY: Pack Tactics triggered! (+2 attack for next attack)
```

### 7.2 Morale Status Communication

**Purpose:** Inform players about group morale state changes.

Morale status is communicated through:
1. **Morale hint** - Shows how to break group morale
2. **Leader defeat notification** - Shows immediate morale impact
3. **Tactic change display** - Shows when group changes tactics due to morale

**Morale Hint:**

```
Kill the Chief to break morale!
```

**Tactic Change Display:**

```
TACTIC CHANGE: Flanking Assault -> Desperate Defense
  Previous: Aggressive coordinated attacks
  Current: Defensive formation, protecting wounded
```

---

## 8. Monster Group Renderer

### 8.1 MonsterGroupRenderer Class

**Purpose:** Handles all text formatting and color selection for monster group elements.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Renderers/MonsterGroupRenderer.cs`

```csharp
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Tui.DTOs;

namespace RuneAndRust.Presentation.Tui.Renderers;

/// <summary>
/// Handles text formatting and color selection for monster group display elements.
/// </summary>
/// <remarks>
/// This renderer is stateless and handles all string formatting operations
/// for the monster group UI components. It reads configuration for symbols
/// and color thresholds.
/// </remarks>
public class MonsterGroupRenderer
{
    private readonly MonsterGroupDisplayConfig _config;

    /// <summary>
    /// Creates a new instance of the MonsterGroupRenderer.
    /// </summary>
    /// <param name="config">Configuration for display settings.</param>
    public MonsterGroupRenderer(MonsterGroupDisplayConfig config)
    {
        _config = config ?? throw new ArgumentNullException(nameof(config));
    }

    /// <summary>
    /// Formats the group name as a centered header.
    /// </summary>
    /// <param name="groupName">The group display name.</param>
    /// <param name="totalWidth">The total width of the display area.</param>
    /// <returns>A centered, decorated group name header.</returns>
    /// <example>
    /// FormatGroupHeader("GOBLIN WARBAND", 60)
    /// returns: "                    GOBLIN WARBAND                    "
    /// </example>
    public string FormatGroupHeader(string groupName, int totalWidth)
    {
        var decoratedName = groupName.ToUpperInvariant();
        var padding = (totalWidth - decoratedName.Length) / 2;

        if (padding < 0) padding = 0;

        return decoratedName.PadLeft(padding + decoratedName.Length).PadRight(totalWidth);
    }

    /// <summary>
    /// Formats a member card with name, role, and health.
    /// </summary>
    /// <param name="member">The member display data.</param>
    /// <param name="cardWidth">The width of the card.</param>
    /// <returns>A multi-line string representing the member card.</returns>
    /// <example>
    /// FormatMemberCard(leaderMember, 15) returns:
    /// "┌─────────────┐"
    /// "│ [*] LEADER  │"
    /// "│   Goblin    │"
    /// "│   Chief     │"
    /// "│ HP: 45/45   │"
    /// "└─────────────┘"
    /// </example>
    public string FormatMemberCard(GroupMemberDisplayDto member, int cardWidth)
    {
        var innerWidth = cardWidth - 2; // Account for borders

        var topBorder = $"┌{new string('─', innerWidth)}┐";
        var bottomBorder = $"└{new string('─', innerWidth)}┘";

        // Line 1: Leader badge or role
        var line1Content = member.IsLeader
            ? $"{_config.Symbols.LeaderBadge} LEADER"
            : $"   {member.Role}";
        var line1 = FormatCardLine(line1Content, innerWidth);

        // Line 2: Monster name (first part)
        var nameParts = SplitName(member.MemberName, innerWidth - 4);
        var line2 = FormatCardLine($"   {nameParts.Item1}", innerWidth);

        // Line 3: Monster name (second part) or empty
        var line3 = FormatCardLine($"   {nameParts.Item2}", innerWidth);

        // Line 4: Health
        var healthText = $"HP: {member.CurrentHealth}/{member.MaxHealth}";
        var line4 = FormatCardLine($" {healthText}", innerWidth);

        return string.Join("\n",
            topBorder,
            line1,
            line2,
            line3,
            line4,
            bottomBorder);
    }

    /// <summary>
    /// Formats a compact health bar for a member card.
    /// </summary>
    /// <param name="current">Current health value.</param>
    /// <param name="max">Maximum health value.</param>
    /// <param name="barWidth">Width available for the bar.</param>
    /// <returns>Formatted health text.</returns>
    public string FormatMemberHealthBar(int current, int max, int barWidth)
    {
        return $"HP: {current}/{max}";
    }

    /// <summary>
    /// Determines the health color based on health percentage.
    /// </summary>
    /// <param name="healthPercent">The current health percentage (0-100).</param>
    /// <returns>The console color for the health display.</returns>
    public ConsoleColor GetMemberHealthColor(int healthPercent)
    {
        foreach (var threshold in _config.HealthColorThresholds.OrderByDescending(t => t.Percent))
        {
            if (healthPercent > threshold.Percent)
            {
                return threshold.Color;
            }
        }

        return _config.Colors.CriticalHealthColor;
    }

    /// <summary>
    /// Gets the leader badge symbol.
    /// </summary>
    /// <returns>The leader badge string.</returns>
    public string GetLeaderBadgeSymbol()
    {
        return _config.Symbols.LeaderBadge;
    }

    /// <summary>
    /// Formats a tactic description with role assignments.
    /// </summary>
    /// <param name="tacticDto">The tactic display data.</param>
    /// <returns>A formatted tactic description.</returns>
    public string FormatTacticDescription(TacticDisplayDto tacticDto)
    {
        var lines = new List<string>
        {
            $"TACTIC: {tacticDto.TacticName}"
        };

        foreach (var assignment in tacticDto.RoleAssignments)
        {
            var prefix = assignment == tacticDto.RoleAssignments.Last() ? "+-- " : "|-- ";
            lines.Add($"{prefix}{assignment.RoleName}: {assignment.ActionDescription}");
        }

        return string.Join("\n", lines);
    }

    /// <summary>
    /// Formats synergy text for display.
    /// </summary>
    /// <param name="synergyDto">The synergy display data.</param>
    /// <returns>Formatted synergy text.</returns>
    public string FormatSynergyText(SynergyDisplayDto synergyDto)
    {
        if (synergyDto.IsTriggered)
        {
            return $"SYNERGY: {synergyDto.SynergyName} triggered! ({synergyDto.EffectDescription})";
        }

        return $"Active: {synergyDto.SynergyName} ({synergyDto.EffectDescription})";
    }

    /// <summary>
    /// Formats a role assignment line.
    /// </summary>
    /// <param name="roleName">The role name.</param>
    /// <param name="action">The action description.</param>
    /// <param name="isLast">Whether this is the last role in the list.</param>
    /// <returns>Formatted role assignment line.</returns>
    public string FormatRoleAssignment(string roleName, string action, bool isLast)
    {
        var prefix = isLast ? "+-- " : "|-- ";
        return $"{prefix}{roleName}: {action}";
    }

    #region Private Helper Methods

    private static string FormatCardLine(string content, int width)
    {
        if (content.Length > width)
        {
            content = content.Substring(0, width);
        }

        return $"│{content.PadRight(width)}│";
    }

    private static (string, string) SplitName(string name, int maxLength)
    {
        if (name.Length <= maxLength)
        {
            return (name, string.Empty);
        }

        // Try to split at a space
        var splitIndex = name.LastIndexOf(' ', maxLength);
        if (splitIndex > 0)
        {
            return (name.Substring(0, splitIndex), name.Substring(splitIndex + 1));
        }

        // Force split
        return (name.Substring(0, maxLength), name.Substring(maxLength));
    }

    #endregion
}
```

### 8.2 Member Card Formatting

**Purpose:** Create visually appealing member cards with consistent formatting.

**Member Card Structure:**

```
┌─────────────┐   ← Top border (15 chars)
│ [*] LEADER  │   ← Line 1: Leader badge or role (centered in 13 chars)
│   Goblin    │   ← Line 2: Name part 1 (left-aligned with indent)
│   Chief     │   ← Line 3: Name part 2 (left-aligned with indent)
│ HP: 45/45   │   ← Line 4: Health text (left-aligned)
└─────────────┘   ← Bottom border
```

**Card Dimensions:**
- Default width: 15 characters
- Height: 6 lines
- Inner width: 13 characters (excluding borders)
- Spacing between cards: 2 characters

---

## 9. Data Model Changes

### 9.1 New DTOs

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/MonsterGroupDtos.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Data transfer object containing monster group display information.
/// </summary>
/// <param name="GroupId">The unique identifier for the group instance.</param>
/// <param name="GroupName">The display name of the group.</param>
/// <param name="Members">The list of group member display data.</param>
/// <param name="CurrentTactic">The current tactic being used.</param>
/// <param name="HasLeader">Whether the group has a living leader.</param>
/// <param name="LeaderRole">The role designation of the leader.</param>
/// <param name="ActiveSynergies">The list of active synergy effects.</param>
public record MonsterGroupDisplayDto(
    Guid GroupId,
    string GroupName,
    IReadOnlyList<GroupMemberDisplayDto> Members,
    TacticDisplayDto? CurrentTactic,
    bool HasLeader,
    string LeaderRole,
    IReadOnlyList<SynergyDisplayDto> ActiveSynergies);

/// <summary>
/// Data transfer object for a single group member display.
/// </summary>
/// <param name="MonsterId">The unique monster instance ID.</param>
/// <param name="MemberName">The display name of the monster.</param>
/// <param name="Role">The tactical role (melee, ranged, leader, etc.).</param>
/// <param name="CurrentHealth">The current health value.</param>
/// <param name="MaxHealth">The maximum health value.</param>
/// <param name="HealthPercent">The calculated health percentage (0-100).</param>
/// <param name="IsLeader">Whether this member is the group leader.</param>
/// <param name="IsAlive">Whether this member is still alive.</param>
public record GroupMemberDisplayDto(
    Guid MonsterId,
    string MemberName,
    string Role,
    int CurrentHealth,
    int MaxHealth,
    int HealthPercent,
    bool IsLeader,
    bool IsAlive);

/// <summary>
/// Data transfer object for tactic display information.
/// </summary>
/// <param name="TacticType">The tactic enum value.</param>
/// <param name="TacticName">The display name of the tactic.</param>
/// <param name="Description">A brief description of the tactic.</param>
/// <param name="RoleAssignments">The role-specific actions.</param>
public record TacticDisplayDto(
    string TacticType,
    string TacticName,
    string Description,
    IReadOnlyList<RoleAssignmentDto> RoleAssignments);

/// <summary>
/// Data transfer object for a role assignment within a tactic.
/// </summary>
/// <param name="RoleName">The role name (e.g., "Archer", "Chief").</param>
/// <param name="ActionDescription">What this role does in the tactic.</param>
public record RoleAssignmentDto(
    string RoleName,
    string ActionDescription);

/// <summary>
/// Data transfer object for leader status display.
/// </summary>
/// <param name="LeaderName">The leader's display name.</param>
/// <param name="LeaderRole">The leader's role designation.</param>
/// <param name="IsAlive">Whether the leader is alive.</param>
/// <param name="IsDefeated">Whether the leader was recently defeated.</param>
/// <param name="MoraleEffects">The morale effects on remaining members.</param>
public record LeaderStatusDto(
    string LeaderName,
    string LeaderRole,
    bool IsAlive,
    bool IsDefeated,
    IReadOnlyList<string> MoraleEffects);

/// <summary>
/// Data transfer object for synergy effect display.
/// </summary>
/// <param name="SynergyId">The synergy identifier.</param>
/// <param name="SynergyName">The display name of the synergy.</param>
/// <param name="EffectDescription">Description of the effect.</param>
/// <param name="IsTriggered">Whether this was just triggered.</param>
/// <param name="SourceRole">The role that provides this synergy.</param>
public record SynergyDisplayDto(
    string SynergyId,
    string SynergyName,
    string EffectDescription,
    bool IsTriggered,
    string? SourceRole);
```

### 9.2 Configuration Classes

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Configuration/MonsterGroupDisplayConfig.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.Configuration;

/// <summary>
/// Configuration for monster group display settings.
/// </summary>
public class MonsterGroupDisplayConfig
{
    /// <summary>
    /// The total width of the display area.
    /// </summary>
    public int TotalWidth { get; set; } = 72;

    /// <summary>
    /// The total height of the display area in rows.
    /// </summary>
    public int TotalHeight { get; set; } = 16;

    /// <summary>
    /// Starting X coordinate for the display.
    /// </summary>
    public int StartX { get; set; } = 0;

    /// <summary>
    /// Starting Y coordinate for the display.
    /// </summary>
    public int StartY { get; set; } = 0;

    /// <summary>
    /// Indentation for text elements.
    /// </summary>
    public int TextIndent { get; set; } = 3;

    /// <summary>
    /// Row offset for member cards (from StartY).
    /// </summary>
    public int MemberCardStartRow { get; set; } = 2;

    /// <summary>
    /// Width of each member card.
    /// </summary>
    public int MemberCardWidth { get; set; } = 15;

    /// <summary>
    /// Spacing between member cards.
    /// </summary>
    public int CardSpacing { get; set; } = 2;

    /// <summary>
    /// Row offset for tactic indicator (from StartY).
    /// </summary>
    public int TacticIndicatorRow { get; set; } = 9;

    /// <summary>
    /// Row offset for morale hint (from StartY).
    /// </summary>
    public int MoraleHintRow { get; set; } = 13;

    /// <summary>
    /// Row offset for morale effect display (from StartY).
    /// </summary>
    public int MoraleEffectRow { get; set; } = 14;

    /// <summary>
    /// Symbol configuration for the group display.
    /// </summary>
    public MonsterGroupSymbols Symbols { get; set; } = new();

    /// <summary>
    /// Color configuration for the group display.
    /// </summary>
    public MonsterGroupColors Colors { get; set; } = new();

    /// <summary>
    /// Health color thresholds for member display.
    /// </summary>
    public List<HealthColorThreshold> HealthColorThresholds { get; set; } = new()
    {
        new HealthColorThreshold { Percent = 75, Color = ConsoleColor.Green },
        new HealthColorThreshold { Percent = 50, Color = ConsoleColor.Yellow },
        new HealthColorThreshold { Percent = 25, Color = ConsoleColor.DarkYellow },
        new HealthColorThreshold { Percent = 0, Color = ConsoleColor.Red }
    };

    /// <summary>
    /// Effect box configuration for notifications.
    /// </summary>
    public EffectBoxConfig EffectBox { get; set; } = new();
}

/// <summary>
/// Symbol characters for monster group display.
/// </summary>
public class MonsterGroupSymbols
{
    /// <summary>Symbol for leader badge.</summary>
    public string LeaderBadge { get; set; } = "[*]";

    /// <summary>Character for card top-left corner.</summary>
    public char CardTopLeft { get; set; } = '┌';

    /// <summary>Character for card top-right corner.</summary>
    public char CardTopRight { get; set; } = '┐';

    /// <summary>Character for card bottom-left corner.</summary>
    public char CardBottomLeft { get; set; } = '└';

    /// <summary>Character for card bottom-right corner.</summary>
    public char CardBottomRight { get; set; } = '┘';

    /// <summary>Character for card horizontal border.</summary>
    public char CardHorizontal { get; set; } = '─';

    /// <summary>Character for card vertical border.</summary>
    public char CardVertical { get; set; } = '│';

    /// <summary>Prefix for tree branch (non-last item).</summary>
    public string TreeBranch { get; set; } = "|-- ";

    /// <summary>Prefix for tree end (last item).</summary>
    public string TreeEnd { get; set; } = "+-- ";
}

/// <summary>
/// Color configuration for monster group elements.
/// </summary>
public class MonsterGroupColors
{
    /// <summary>Color for the group name header.</summary>
    public ConsoleColor HeaderColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>Color for leader badge and name.</summary>
    public ConsoleColor LeaderColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>Color for tactic title.</summary>
    public ConsoleColor TacticColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>Color for highlighted tactic.</summary>
    public ConsoleColor TacticHighlightColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>Color for synergy notifications.</summary>
    public ConsoleColor SynergyColor { get; set; } = ConsoleColor.Green;

    /// <summary>Color for morale hint text.</summary>
    public ConsoleColor HintColor { get; set; } = ConsoleColor.DarkYellow;

    /// <summary>Color for critical health (0%).</summary>
    public ConsoleColor CriticalHealthColor { get; set; } = ConsoleColor.DarkRed;

    /// <summary>Default text color.</summary>
    public ConsoleColor DefaultColor { get; set; } = ConsoleColor.Gray;

    /// <summary>Color for effect box border.</summary>
    public ConsoleColor EffectBoxBorderColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>Color for effect box title.</summary>
    public ConsoleColor EffectBoxTitleColor { get; set; } = ConsoleColor.Red;

    /// <summary>Color for effect box content.</summary>
    public ConsoleColor EffectBoxContentColor { get; set; } = ConsoleColor.White;

    /// <summary>Color for negative effect text.</summary>
    public ConsoleColor NegativeEffectColor { get; set; } = ConsoleColor.Red;
}

/// <summary>
/// Configuration for effect notification boxes.
/// </summary>
public class EffectBoxConfig
{
    /// <summary>Width of the effect box.</summary>
    public int Width { get; set; } = 53;

    /// <summary>Height of the effect box.</summary>
    public int Height { get; set; } = 10;

    /// <summary>Starting row for the effect box (from group display StartY).</summary>
    public int StartRow { get; set; } = 3;
}
```

---

## 10. Configuration File Schemas

### 10.1 monster-group-display.json

**File:** `config/monster-group-display.json`

```json
{
  "$schema": "./schemas/monster-group-display.schema.json",
  "totalWidth": 72,
  "totalHeight": 16,
  "startX": 0,
  "startY": 0,
  "textIndent": 3,
  "memberCardStartRow": 2,
  "memberCardWidth": 15,
  "cardSpacing": 2,
  "tacticIndicatorRow": 9,
  "moraleHintRow": 13,
  "moraleEffectRow": 14,
  "symbols": {
    "leaderBadge": "[*]",
    "cardTopLeft": "┌",
    "cardTopRight": "┐",
    "cardBottomLeft": "└",
    "cardBottomRight": "┘",
    "cardHorizontal": "─",
    "cardVertical": "│",
    "treeBranch": "|-- ",
    "treeEnd": "+-- "
  },
  "colors": {
    "headerColor": "Cyan",
    "leaderColor": "Yellow",
    "tacticColor": "Yellow",
    "tacticHighlightColor": "Cyan",
    "synergyColor": "Green",
    "hintColor": "DarkYellow",
    "criticalHealthColor": "DarkRed",
    "defaultColor": "Gray",
    "effectBoxBorderColor": "Yellow",
    "effectBoxTitleColor": "Red",
    "effectBoxContentColor": "White",
    "negativeEffectColor": "Red"
  },
  "healthColorThresholds": [
    { "percent": 75, "color": "Green" },
    { "percent": 50, "color": "Yellow" },
    { "percent": 25, "color": "DarkYellow" },
    { "percent": 0, "color": "Red" }
  ],
  "effectBox": {
    "width": 53,
    "height": 10,
    "startRow": 3
  },
  "tacticDescriptions": {
    "Flank": {
      "name": "Flanking Assault",
      "description": "Surround target for flanking bonuses",
      "roleActions": {
        "melee": "Move to cardinal positions around target",
        "ranged": "Attack from range while allies flank",
        "leader": "Coordinate flanking movements",
        "caster": "Support with buffs and debuffs"
      }
    },
    "FocusFire": {
      "name": "Focused Assault",
      "description": "All attack same target",
      "roleActions": {
        "melee": "Attack lowest HP enemy",
        "ranged": "Focus fire on group target",
        "leader": "Designate priority target",
        "caster": "Debuff focused target"
      }
    },
    "ProtectLeader": {
      "name": "Guardian Formation",
      "description": "Defend the group leader",
      "roleActions": {
        "melee": "Position between leader and threat",
        "ranged": "Attack threats to leader",
        "leader": "Stay protected behind allies",
        "caster": "Heal and buff leader"
      }
    },
    "ProtectCaster": {
      "name": "Caster Defense",
      "description": "Defend ranged/spellcasters",
      "roleActions": {
        "melee": "Guard caster positions",
        "ranged": "Maintain safe distance",
        "leader": "Direct melee to protect casters",
        "caster": "Stay behind melee line"
      }
    },
    "Swarm": {
      "name": "Overwhelming Swarm",
      "description": "Close in from all sides",
      "roleActions": {
        "melee": "Rush toward target",
        "ranged": "Close distance and swarm",
        "leader": "Lead the charge",
        "caster": "Support swarming allies"
      }
    },
    "Retreat": {
      "name": "Tactical Retreat",
      "description": "Fall back when damaged",
      "roleActions": {
        "melee": "Disengage and fall back",
        "ranged": "Retreat to safe distance",
        "leader": "Coordinate retreat",
        "caster": "Cover retreating allies"
      }
    },
    "Ambush": {
      "name": "Ambush Position",
      "description": "Wait in ambush position",
      "roleActions": {
        "melee": "Hold position until enemy in range",
        "ranged": "Prepare ranged ambush",
        "leader": "Signal ambush trigger",
        "caster": "Prepare surprise spells"
      }
    },
    "HitAndRun": {
      "name": "Strike and Fade",
      "description": "Attack then disengage",
      "roleActions": {
        "melee": "Attack then move away",
        "ranged": "Hit and reposition",
        "leader": "Coordinate strike timing",
        "caster": "Quick cast and retreat"
      }
    }
  }
}
```

### 10.2 monster-group-display.schema.json

**File:** `config/schemas/monster-group-display.schema.json`

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "monster-group-display.schema.json",
  "title": "Monster Group Display Configuration",
  "description": "Configuration for monster group display in combat UI",
  "type": "object",
  "properties": {
    "totalWidth": {
      "type": "integer",
      "description": "Total width of the display area",
      "minimum": 40,
      "maximum": 150,
      "default": 72
    },
    "totalHeight": {
      "type": "integer",
      "description": "Total height of the display area in rows",
      "minimum": 10,
      "maximum": 30,
      "default": 16
    },
    "startX": {
      "type": "integer",
      "description": "Starting X coordinate",
      "minimum": 0,
      "default": 0
    },
    "startY": {
      "type": "integer",
      "description": "Starting Y coordinate",
      "minimum": 0,
      "default": 0
    },
    "textIndent": {
      "type": "integer",
      "description": "Text indentation",
      "minimum": 0,
      "maximum": 10,
      "default": 3
    },
    "memberCardStartRow": {
      "type": "integer",
      "description": "Row offset for member cards",
      "minimum": 1,
      "maximum": 10,
      "default": 2
    },
    "memberCardWidth": {
      "type": "integer",
      "description": "Width of each member card",
      "minimum": 10,
      "maximum": 25,
      "default": 15
    },
    "cardSpacing": {
      "type": "integer",
      "description": "Spacing between cards",
      "minimum": 0,
      "maximum": 5,
      "default": 2
    },
    "tacticIndicatorRow": {
      "type": "integer",
      "description": "Row offset for tactic indicator",
      "minimum": 5,
      "maximum": 20,
      "default": 9
    },
    "moraleHintRow": {
      "type": "integer",
      "description": "Row offset for morale hint",
      "minimum": 8,
      "maximum": 25,
      "default": 13
    },
    "moraleEffectRow": {
      "type": "integer",
      "description": "Row offset for morale effect display",
      "minimum": 9,
      "maximum": 25,
      "default": 14
    },
    "symbols": {
      "type": "object",
      "description": "Symbol characters for display",
      "properties": {
        "leaderBadge": {
          "type": "string",
          "maxLength": 5,
          "default": "[*]"
        },
        "cardTopLeft": {
          "type": "string",
          "maxLength": 1,
          "default": "┌"
        },
        "cardTopRight": {
          "type": "string",
          "maxLength": 1,
          "default": "┐"
        },
        "cardBottomLeft": {
          "type": "string",
          "maxLength": 1,
          "default": "└"
        },
        "cardBottomRight": {
          "type": "string",
          "maxLength": 1,
          "default": "┘"
        },
        "cardHorizontal": {
          "type": "string",
          "maxLength": 1,
          "default": "─"
        },
        "cardVertical": {
          "type": "string",
          "maxLength": 1,
          "default": "│"
        },
        "treeBranch": {
          "type": "string",
          "maxLength": 5,
          "default": "|-- "
        },
        "treeEnd": {
          "type": "string",
          "maxLength": 5,
          "default": "+-- "
        }
      },
      "additionalProperties": false
    },
    "colors": {
      "type": "object",
      "description": "Color configuration",
      "properties": {
        "headerColor": { "$ref": "#/$defs/consoleColor", "default": "Cyan" },
        "leaderColor": { "$ref": "#/$defs/consoleColor", "default": "Yellow" },
        "tacticColor": { "$ref": "#/$defs/consoleColor", "default": "Yellow" },
        "tacticHighlightColor": { "$ref": "#/$defs/consoleColor", "default": "Cyan" },
        "synergyColor": { "$ref": "#/$defs/consoleColor", "default": "Green" },
        "hintColor": { "$ref": "#/$defs/consoleColor", "default": "DarkYellow" },
        "criticalHealthColor": { "$ref": "#/$defs/consoleColor", "default": "DarkRed" },
        "defaultColor": { "$ref": "#/$defs/consoleColor", "default": "Gray" },
        "effectBoxBorderColor": { "$ref": "#/$defs/consoleColor", "default": "Yellow" },
        "effectBoxTitleColor": { "$ref": "#/$defs/consoleColor", "default": "Red" },
        "effectBoxContentColor": { "$ref": "#/$defs/consoleColor", "default": "White" },
        "negativeEffectColor": { "$ref": "#/$defs/consoleColor", "default": "Red" }
      },
      "additionalProperties": false
    },
    "healthColorThresholds": {
      "type": "array",
      "description": "Health percentage color thresholds",
      "items": {
        "type": "object",
        "properties": {
          "percent": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100
          },
          "color": {
            "$ref": "#/$defs/consoleColor"
          }
        },
        "required": ["percent", "color"],
        "additionalProperties": false
      },
      "minItems": 1
    },
    "effectBox": {
      "type": "object",
      "description": "Effect box configuration",
      "properties": {
        "width": {
          "type": "integer",
          "minimum": 30,
          "maximum": 80,
          "default": 53
        },
        "height": {
          "type": "integer",
          "minimum": 6,
          "maximum": 15,
          "default": 10
        },
        "startRow": {
          "type": "integer",
          "minimum": 1,
          "maximum": 15,
          "default": 3
        }
      },
      "additionalProperties": false
    },
    "tacticDescriptions": {
      "type": "object",
      "description": "Descriptions and role actions for each tactic type",
      "patternProperties": {
        "^[A-Za-z]+$": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "description": { "type": "string" },
            "roleActions": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            }
          },
          "required": ["name", "description"],
          "additionalProperties": false
        }
      }
    }
  },
  "$defs": {
    "consoleColor": {
      "type": "string",
      "enum": [
        "Black", "DarkBlue", "DarkGreen", "DarkCyan",
        "DarkRed", "DarkMagenta", "DarkYellow", "Gray",
        "DarkGray", "Blue", "Green", "Cyan",
        "Red", "Magenta", "Yellow", "White"
      ]
    }
  },
  "additionalProperties": false
}
```

---

## 11. CombatView Integration

### 11.1 Integration Points

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Views/CombatView.cs` (modifications)

```csharp
// Add to CombatView class

private readonly MonsterGroupView _monsterGroupView;
private readonly IMonsterGroupService _monsterGroupService;
private IDisposable? _deathEventSubscription;
private IDisposable? _synergyEventSubscription;

/// <summary>
/// Initializes monster group UI components when groups are detected.
/// </summary>
private void InitializeMonsterGroupUI()
{
    var activeGroups = _monsterGroupService.GetActiveGroups();
    if (activeGroups.Count == 0)
    {
        _monsterGroupView.Clear();
        return;
    }

    // Display primary group (first active group)
    var groupInstance = activeGroups[0];

    // Create member display DTOs
    var memberDtos = groupInstance.AliveMembers
        .Select(m => CreateMemberDto(m, groupInstance))
        .ToList();

    // Create tactic display DTO
    var tacticDto = CreateTacticDto(groupInstance);

    // Create group display DTO
    var groupDto = new MonsterGroupDisplayDto(
        GroupId: groupInstance.Id,
        GroupName: groupInstance.Definition.Name,
        Members: memberDtos,
        CurrentTactic: tacticDto,
        HasLeader: groupInstance.HasAliveLeader,
        LeaderRole: groupInstance.Definition.LeaderRole ?? "Leader",
        ActiveSynergies: CreateSynergyDtos(groupInstance));

    // Render the group display
    _monsterGroupView.RenderGroup(groupDto);

    // Subscribe to death events for leader defeat
    SubscribeToGroupEvents(groupInstance);
}

/// <summary>
/// Creates a member display DTO from a monster.
/// </summary>
private GroupMemberDisplayDto CreateMemberDto(Monster monster, MonsterGroupInstance group)
{
    var isLeader = group.GetLeader()?.Id == monster.Id;
    var role = GetMemberRole(monster, group);

    return new GroupMemberDisplayDto(
        MonsterId: monster.Id,
        MemberName: monster.Name,
        Role: role,
        CurrentHealth: monster.Health,
        MaxHealth: monster.MaxHealth,
        HealthPercent: CalculateHealthPercent(monster),
        IsLeader: isLeader,
        IsAlive: monster.IsAlive);
}

/// <summary>
/// Creates a tactic display DTO from a group instance.
/// </summary>
private TacticDisplayDto? CreateTacticDto(MonsterGroupInstance group)
{
    var tactics = group.Definition.Tactics;
    if (tactics.Count == 0) return null;

    var primaryTactic = tactics[0];
    var tacticConfig = GetTacticConfig(primaryTactic);

    var roleAssignments = CreateRoleAssignments(group, tacticConfig);

    return new TacticDisplayDto(
        TacticType: primaryTactic.ToString(),
        TacticName: tacticConfig.Name,
        Description: tacticConfig.Description,
        RoleAssignments: roleAssignments);
}

/// <summary>
/// Subscribes to events for group state updates.
/// </summary>
private void SubscribeToGroupEvents(MonsterGroupInstance group)
{
    _deathEventSubscription?.Dispose();
    _deathEventSubscription = _eventBus.Subscribe<EntityDeathEvent>(evt =>
    {
        var leader = group.GetLeader();
        if (leader != null && evt.EntityId == leader.Id)
        {
            var leaderStatus = new LeaderStatusDto(
                LeaderName: leader.Name,
                LeaderRole: group.Definition.LeaderRole ?? "Leader",
                IsAlive: false,
                IsDefeated: true,
                MoraleEffects: new List<string>
                {
                    "-25% attack for all remaining members",
                    "50% chance to flee on each turn"
                });

            _monsterGroupView.Clear(); // Refresh display
            // Note: Leader defeated box shown by LeaderBadge component
        }
    });
}

/// <summary>
/// Calculates health percentage.
/// </summary>
private static int CalculateHealthPercent(Monster monster)
{
    if (monster.MaxHealth <= 0) return 0;
    return (int)Math.Ceiling((monster.Health / (float)monster.MaxHealth) * 100);
}
```

### 11.2 Layout Position

The monster group display is positioned below the main combat area:

```
┌─────────────────────────────────────────────────────────────────────┐
│                        [Main Combat Area]                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│                      GOBLIN WARBAND                                  │  ← Row 0: Group Header
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │  ← Rows 2-7: Member Cards
│   │ [*] LEADER  │  │   Goblin    │  │   Goblin    │                 │
│   │   Goblin    │  │   Archer    │  │   Shaman    │                 │
│   │   Chief     │  │             │  │             │                 │
│   │ HP: 45/45   │  │ HP: 20/20   │  │ HP: 25/25   │                 │
│   └─────────────┘  └─────────────┘  └─────────────┘                 │
│                                                                      │
│   TACTIC: Flanking Assault                                           │  ← Row 9: Tactic Indicator
│   |-- Archers attack from range                                      │  ← Rows 10-12: Role Assignments
│   |-- Chief engages in melee                                         │
│   +-- Shaman provides support                                        │
│                                                                      │
│   Kill the Chief to break morale!                                    │  ← Row 13: Morale Hint
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 12. Logging Specifications

### 12.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `MonsterGroupView` | Information | Monster group display initialized |
| `MonsterGroupView` | Debug | Rendering group, updating member health |
| `MonsterGroupView` | Warning | Member not found in group |
| `TacticIndicator` | Information | Tactic indicator initialized |
| `TacticIndicator` | Debug | Rendering tactic, highlighting active tactic |
| `LeaderBadge` | Information | Leader badge rendered |
| `LeaderBadge` | Debug | Showing leader bonus, leader defeated effect |
| `LeaderBadge` | Warning | ShowLeaderDefeated called but leader not defeated |
| `MonsterGroupRenderer` | Debug | Formatting operations |
| `CombatView` | Information | Monster group detected, UI initialized |
| `CombatView` | Debug | Subscribing to group events |

### 12.2 Log Message Examples

```
[INF] MonsterGroupView: Initialized monster group display for "Goblin Warband"
[DBG] MonsterGroupView: Rendering monster group 'Goblin Warband' with 3 members
[DBG] MonsterGroupView: Updated health for Goblin Chief: 35/45
[WRN] MonsterGroupView: Member 7a3f2b1c-... not found in group
[INF] TacticIndicator: Tactic indicator initialized with "Flanking Assault"
[DBG] TacticIndicator: Rendering tactic indicator: Flanking Assault
[DBG] TacticIndicator: Highlighted tactic: Flanking Assault
[DBG] LeaderBadge: Rendering leader badge for Goblin Chief ([*])
[DBG] LeaderBadge: Showing leader defeated effect for Goblin Chief
[INF] CombatView: Monster group detected - initializing group UI
```

---

## 13. Unit Testing Requirements

### 13.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| MonsterGroupRenderer | ~3 |
| MonsterGroupView | ~2 |
| TacticIndicator | ~1 |
| LeaderBadge | ~2 |
| **Total** | **~8** |

### 13.2 Test Specifications

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/Renderers/MonsterGroupRendererTests.cs`

```csharp
[TestFixture]
public class MonsterGroupRendererTests
{
    private MonsterGroupRenderer _renderer;
    private MonsterGroupDisplayConfig _config;

    [SetUp]
    public void Setup()
    {
        _config = new MonsterGroupDisplayConfig();
        _renderer = new MonsterGroupRenderer(_config);
    }

    [Test]
    public void FormatGroupHeader_WithGroupName_ReturnsCenteredHeader()
    {
        // Arrange
        var groupName = "GOBLIN WARBAND";
        var totalWidth = 60;

        // Act
        var result = _renderer.FormatGroupHeader(groupName, totalWidth);

        // Assert
        Assert.That(result, Does.Contain("GOBLIN WARBAND"));
        Assert.That(result.Length, Is.EqualTo(totalWidth));
    }

    [Test]
    [TestCase(100, ExpectedResult = ConsoleColor.Green)]
    [TestCase(76, ExpectedResult = ConsoleColor.Green)]
    [TestCase(75, ExpectedResult = ConsoleColor.Yellow)]
    [TestCase(51, ExpectedResult = ConsoleColor.Yellow)]
    [TestCase(50, ExpectedResult = ConsoleColor.DarkYellow)]
    [TestCase(26, ExpectedResult = ConsoleColor.DarkYellow)]
    [TestCase(25, ExpectedResult = ConsoleColor.Red)]
    [TestCase(1, ExpectedResult = ConsoleColor.Red)]
    [TestCase(0, ExpectedResult = ConsoleColor.DarkRed)]
    public ConsoleColor GetMemberHealthColor_WithHealthPercent_ReturnsCorrectColor(int healthPercent)
    {
        return _renderer.GetMemberHealthColor(healthPercent);
    }

    [Test]
    public void FormatMemberCard_WithLeader_IncludesLeaderBadge()
    {
        // Arrange
        var member = new GroupMemberDisplayDto(
            MonsterId: Guid.NewGuid(),
            MemberName: "Goblin Chief",
            Role: "leader",
            CurrentHealth: 45,
            MaxHealth: 45,
            HealthPercent: 100,
            IsLeader: true,
            IsAlive: true);

        // Act
        var result = _renderer.FormatMemberCard(member, 15);

        // Assert
        Assert.That(result, Does.Contain("[*]"));
        Assert.That(result, Does.Contain("LEADER"));
    }
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/MonsterGroupViewTests.cs`

```csharp
[TestFixture]
public class MonsterGroupViewTests
{
    private Mock<MonsterGroupRenderer> _mockRenderer;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<TacticIndicator> _mockTacticIndicator;
    private Mock<LeaderBadge> _mockLeaderBadge;
    private Mock<ILogger<MonsterGroupView>> _mockLogger;
    private MonsterGroupDisplayConfig _config;
    private MonsterGroupView _groupView;

    [SetUp]
    public void Setup()
    {
        _config = new MonsterGroupDisplayConfig();
        _mockRenderer = new Mock<MonsterGroupRenderer>(_config);
        _mockTerminal = new Mock<ITerminalService>();
        _mockTacticIndicator = new Mock<TacticIndicator>();
        _mockLeaderBadge = new Mock<LeaderBadge>();
        _mockLogger = new Mock<ILogger<MonsterGroupView>>();

        _groupView = new MonsterGroupView(
            _mockRenderer.Object,
            _mockTerminal.Object,
            _mockTacticIndicator.Object,
            _mockLeaderBadge.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    public void RenderGroup_WithValidDto_RendersAllElements()
    {
        // Arrange
        var members = new List<GroupMemberDisplayDto>
        {
            new(Guid.NewGuid(), "Goblin Chief", "leader", 45, 45, 100, true, true),
            new(Guid.NewGuid(), "Goblin Archer", "ranged", 20, 20, 100, false, true)
        };

        var tactic = new TacticDisplayDto(
            "Flank",
            "Flanking Assault",
            "Surround target",
            new List<RoleAssignmentDto>());

        var dto = new MonsterGroupDisplayDto(
            GroupId: Guid.NewGuid(),
            GroupName: "Goblin Warband",
            Members: members,
            CurrentTactic: tactic,
            HasLeader: true,
            LeaderRole: "Chief",
            ActiveSynergies: Array.Empty<SynergyDisplayDto>());

        _mockRenderer.Setup(r => r.FormatGroupHeader(It.IsAny<string>(), It.IsAny<int>()))
            .Returns("GOBLIN WARBAND");
        _mockRenderer.Setup(r => r.FormatMemberCard(It.IsAny<GroupMemberDisplayDto>(), It.IsAny<int>()))
            .Returns("┌─────────────┐\n│   Member    │\n└─────────────┘");

        // Act
        _groupView.RenderGroup(dto);

        // Assert
        _mockTerminal.Verify(t => t.WriteColoredAt(
            It.IsAny<int>(), It.IsAny<int>(),
            It.Is<string>(s => s.Contains("GOBLIN WARBAND")),
            It.IsAny<ConsoleColor>()), Times.Once);

        _mockTacticIndicator.Verify(ti => ti.RenderTactic(It.IsAny<TacticDisplayDto>()), Times.Once);
    }

    [Test]
    public void Clear_ClearsAllComponents()
    {
        // Act
        _groupView.Clear();

        // Assert
        _mockTacticIndicator.Verify(ti => ti.Clear(), Times.Once);
        _mockLeaderBadge.Verify(lb => lb.Clear(), Times.Once);
    }
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/TacticIndicatorTests.cs`

```csharp
[TestFixture]
public class TacticIndicatorTests
{
    private Mock<MonsterGroupRenderer> _mockRenderer;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<ILogger<TacticIndicator>> _mockLogger;
    private MonsterGroupDisplayConfig _config;
    private TacticIndicator _tacticIndicator;

    [SetUp]
    public void Setup()
    {
        _config = new MonsterGroupDisplayConfig();
        _mockRenderer = new Mock<MonsterGroupRenderer>(_config);
        _mockTerminal = new Mock<ITerminalService>();
        _mockLogger = new Mock<ILogger<TacticIndicator>>();

        _tacticIndicator = new TacticIndicator(
            _mockRenderer.Object,
            _mockTerminal.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    public void RenderTactic_WithValidDto_RendersTacticTitle()
    {
        // Arrange
        var tactic = new TacticDisplayDto(
            "Flank",
            "Flanking Assault",
            "Surround target for flanking bonuses",
            new List<RoleAssignmentDto>
            {
                new("Archer", "Attack from range"),
                new("Chief", "Engage in melee")
            });

        // Act
        _tacticIndicator.RenderTactic(tactic);

        // Assert
        _mockTerminal.Verify(t => t.WriteColoredAt(
            It.IsAny<int>(), It.IsAny<int>(),
            It.Is<string>(s => s.Contains("TACTIC: Flanking Assault")),
            _config.Colors.TacticColor), Times.Once);
    }
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/LeaderBadgeTests.cs`

```csharp
[TestFixture]
public class LeaderBadgeTests
{
    private Mock<MonsterGroupRenderer> _mockRenderer;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<ILogger<LeaderBadge>> _mockLogger;
    private MonsterGroupDisplayConfig _config;
    private LeaderBadge _leaderBadge;

    [SetUp]
    public void Setup()
    {
        _config = new MonsterGroupDisplayConfig();
        _mockRenderer = new Mock<MonsterGroupRenderer>(_config);
        _mockTerminal = new Mock<ITerminalService>();
        _mockLogger = new Mock<ILogger<LeaderBadge>>();

        _leaderBadge = new LeaderBadge(
            _mockRenderer.Object,
            _mockTerminal.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    public void RenderBadge_WithLivingLeader_RendersSuccessfully()
    {
        // Arrange
        var leaderStatus = new LeaderStatusDto(
            LeaderName: "Goblin Chief",
            LeaderRole: "leader",
            IsAlive: true,
            IsDefeated: false,
            MoraleEffects: Array.Empty<string>());

        _mockRenderer.Setup(r => r.GetLeaderBadgeSymbol()).Returns("[*]");

        // Act & Assert (no exception)
        Assert.DoesNotThrow(() => _leaderBadge.RenderBadge(leaderStatus));
    }

    [Test]
    public void ShowLeaderDefeated_WithDefeatedLeader_RendersEffectBox()
    {
        // Arrange
        var leaderStatus = new LeaderStatusDto(
            LeaderName: "Goblin Chief",
            LeaderRole: "leader",
            IsAlive: false,
            IsDefeated: true,
            MoraleEffects: new List<string>
            {
                "-25% attack for all remaining goblins",
                "50% chance to flee on each turn"
            });

        // Act
        _leaderBadge.ShowLeaderDefeated(leaderStatus);

        // Assert
        _mockTerminal.Verify(t => t.WriteColoredAt(
            It.IsAny<int>(), It.IsAny<int>(),
            It.Is<string>(s => s.Contains("LEADER DEFEATED")),
            It.IsAny<ConsoleColor>()), Times.Once);
    }
}
```

---

## 14. Use Cases

### UC-001: View Monster Group During Combat

**Actor:** Player
**Flow:** Enter combat with monster group → Group display appears → View all group members with health bars → See group name and composition → Continue combat with strategic awareness

### UC-002: Track Individual Member Health

**Actor:** Player
**Flow:** View monster group → Observe member health bars → Attack a group member → Health bar updates to reflect damage → Member color changes based on health percentage → Member dies → Card updates or removes

### UC-003: Observe Group Tactics

**Actor:** Player
**Flow:** View monster group → See current tactic indicator → Read tactic name and description → Understand role assignments → Plan counter-tactics based on enemy behavior

### UC-004: Identify Group Leader

**Actor:** Player
**Flow:** View monster group → Notice [*] leader badge on one member → Read "Kill the Chief to break morale!" hint → Prioritize attacking leader → Observe tactical benefit of leader elimination

### UC-005: Witness Leader Defeat

**Actor:** Player
**Flow:** Attack group leader → Leader takes lethal damage → "LEADER DEFEATED" effect box appears → View morale penalties applied to remaining group → See remaining enemies weakened → Continue combat with advantage

### UC-006: Observe Active Synergies

**Actor:** Player
**Flow:** View monster group → Notice "Active: Shaman's Blessing (+1 attack)" → Understand group synergy benefit → Consider targeting synergy source (Shaman) → Make tactical decision

---

## 15. Deliverable Checklist

### UI Components
- [ ] `MonsterGroupView` class implemented
- [ ] `RenderGroup()` method renders complete group display
- [ ] `ShowMemberHealth()` method updates individual member health
- [ ] `HighlightLeader()` method highlights group leader
- [ ] `ShowMoraleEffect()` method displays synergy effects
- [ ] `Clear()` method removes display

### TacticIndicator
- [ ] `TacticIndicator` class implemented
- [ ] `RenderTactic()` method renders tactic indicator
- [ ] `ShowTacticDetails()` method shows detailed tactic info
- [ ] `HighlightActiveTactic()` method highlights active tactic
- [ ] `Clear()` method removes indicator

### LeaderBadge
- [ ] `LeaderBadge` class implemented
- [ ] `RenderBadge()` method renders leader badge
- [ ] `ShowLeaderBonus()` method displays leader bonuses
- [ ] `ShowLeaderDefeated()` method shows defeat effect box
- [ ] `Clear()` method removes badge

### Renderers
- [ ] `MonsterGroupRenderer` class implemented
- [ ] `FormatGroupHeader()` formats group name
- [ ] `FormatMemberCard()` creates member card
- [ ] `GetMemberHealthColor()` returns correct color
- [ ] `GetLeaderBadgeSymbol()` returns badge symbol
- [ ] `FormatTacticDescription()` formats tactic text
- [ ] `FormatSynergyText()` formats synergy display

### DTOs
- [ ] `MonsterGroupDisplayDto` record created
- [ ] `GroupMemberDisplayDto` record created
- [ ] `TacticDisplayDto` record created
- [ ] `RoleAssignmentDto` record created
- [ ] `LeaderStatusDto` record created
- [ ] `SynergyDisplayDto` record created

### Configuration
- [ ] `MonsterGroupDisplayConfig` class created
- [ ] `MonsterGroupSymbols` class created
- [ ] `MonsterGroupColors` class created
- [ ] `EffectBoxConfig` class created
- [ ] `config/monster-group-display.json` created
- [ ] `config/schemas/monster-group-display.schema.json` created

### View Integration
- [ ] `CombatView` monster group detection implemented
- [ ] `CombatView` death event subscription implemented
- [ ] Monster group display positioned correctly in layout

### Testing
- [ ] ~8 unit tests implemented
- [ ] All tests passing

---

## 16. Acceptance Criteria

### Functional
- [ ] Monster group composition displays all living members
- [ ] Individual member health bars show correctly with color coding
- [ ] Leader designation highlights group leader with [*] badge
- [ ] Tactic indicators show current coordinated behavior
- [ ] Tactic details show role-specific action descriptions
- [ ] Group morale hint shows how to break morale
- [ ] Leader defeated effect box displays on leader death
- [ ] Morale effects are communicated to player
- [ ] Group display clears when group is defeated

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~8 unit tests pass
- [ ] Configuration file validates against schema
- [ ] XML documentation complete on all public members
- [ ] No hardcoded values (all configurable)

---

## 17. Dependencies

### Required from v0.10.4c

| Type | Location | Usage in v0.13.1c |
|------|----------|-------------------|
| `IMonsterGroupService` | `Application/Interfaces/` | Get group instances, check membership |
| `IMonsterGroupProvider` | `Application/Interfaces/` | Get group definitions |
| `MonsterGroupDefinition` | `Domain/Definitions/` | Group template with members, tactics |
| `MonsterGroupInstance` | `Application/Tracking/` | Runtime group state |
| `GroupMember` | `Domain/ValueObjects/` | Member definition with role |
| `GroupTactic` | `Domain/Enums/` | Tactic enum values |
| `GroupSynergy` | `Domain/ValueObjects/` | Synergy effect definitions |
| `SynergyTrigger` | `Domain/Enums/` | Synergy trigger types |
| `Monster` | `Domain/Entities/` | Current/max health values |
| `EntityDeathEvent` | `Application/Events/` | Trigger leader defeated |

### Required from v0.13.0

| Type | Location | Usage in v0.13.1c |
|------|----------|-------------------|
| `CombatView` | `Presentation.Tui/Views/` | Integration point |
| `ITerminalService` | `Presentation.Tui/Services/` | Terminal output |

### Required from v0.13.1a

| Type | Location | Usage in v0.13.1c |
|------|----------|-------------------|
| `HealthColorThreshold` | `Presentation.Tui/Configuration/` | Shared color threshold config |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `MonsterGroupView` | Reusable group display component |
| `MonsterGroupDisplayConfig` | Shared configuration patterns |
| `MonsterGroupRenderer` | Reusable rendering utilities |

---

## 18. Future Considerations

### Deferred to Future Versions
- **Multiple Group Display**: Displaying multiple groups simultaneously when fighting multiple coordinated groups
- **Tactic Animation**: Visual effects when tactics are executed
- **Dynamic Tactic Changes**: Real-time updates when group changes tactics during combat
- **Group Formations**: Visual representation of spatial formations on a mini-map

### Out of Scope
- **Group AI Logic**: All group AI and tactic selection is handled by v0.10.4c services
- **Synergy Calculations**: All synergy math is handled by domain layer
- **New Tactic Types**: Adding new tactic types (this is domain layer scope)
- **Monster Spawning**: Group spawning mechanics (handled by IMonsterGroupService)

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
*Author: Claude (AI Assistant)*
