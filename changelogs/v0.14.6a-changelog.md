# v0.14.6a Changelog - Sound Effect Schema

## Summary

Introduced the comprehensive **Sound Effect Schema** (`sound-effects.schema.json`) which validates sound effect definitions including categories, trigger associations, volume/pitch variance, and fallback handling. This schema enables full customization of game audio without code changes, supporting modding scenarios such as custom sound packs, themed audio, regional variations, or accessibility-focused audio profiles. The schema validates the existing `sound-effects.json` configuration file containing 6 categories with 19 sound effects. This is the first schema in the v0.14.6 Audio Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/sound-effects.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/sound-effects.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (5 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `SoundCategory` | Category grouping related sound effects | effects |
| `SoundEffect` | Single effect with playback configuration | files |
| `VolumeRange` | Volume variance multiplier range | min, max |
| `PitchRange` | Pitch variance multiplier range | min, max |
| `GlobalSettings` | System-wide audio configuration | (none - all have defaults) |

### SoundEffect Properties

| Property | Type | Range | Description |
|----------|------|-------|-------------|
| `files` | array | minItems: 1 | Audio file paths |
| `volume` | number | 0-1 | Base volume level |
| `volumeVariance` | VolumeRange | - | Dynamic volume range |
| `pitch` | number | 0.5-2.0 | Base pitch multiplier |
| `pitchVariance` | PitchRange | - | Dynamic pitch range |
| `randomize` | boolean | - | Random file selection |
| `loop` | boolean | - | Loop continuously |
| `cooldown` | number | ≥0 | Seconds between plays |
| `priority` | integer | 0-10 | Playback priority |
| `fallbackEffectId` | string | pattern | Fallback reference |
| `tags` | array | - | Filtering tags |

### GlobalSettings Properties

| Property | Type | Range | Default | Description |
|----------|------|-------|---------|-------------|
| `maxSimultaneous` | integer | ≥1 | 8 | Max concurrent sounds |
| `defaultVolume` | number | 0-1 | 1.0 | Default effect volume |
| `masterMute` | boolean | - | false | Global mute toggle |
| `fallbackEnabled` | boolean | - | true | Enable fallback resolution |

### Existing Categories Validated (6)

| Category | Effect Count | Example Effects |
|----------|--------------|-----------------|
| `combat` | 6 | attack-hit, attack-miss, attack-critical, attack-blocked, death-monster, death-player |
| `ability` | 3 | ability-cast, ability-fire, ability-heal |
| `ui` | 4 | button-click, button-hover, menu-open, menu-close |
| `items` | 3 | item-pickup, item-equip, gold-coins |
| `puzzle` | 3 | puzzle-correct, puzzle-incorrect, puzzle-complete |
| `movement` | 3 | footstep-stone, door-open, chest-open |

### Unit Tests
- **[SoundEffectsSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/SoundEffectsSchemaTests.cs)** - 13 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (5 definitions)
  - `SoundEffectsJson_ValidatesAgainstSchema` - Backwards compatibility (6 categories, 19 effects)
  - `Volume_OutOfRange_FailsValidation` - Volume 0-1 range
  - `Pitch_OutOfRange_FailsValidation` - Pitch 0.5-2.0 range
  - `Files_EmptyArray_FailsValidation` - Files minItems: 1
  - `Priority_OutOfRange_FailsValidation` - Priority 0-10 range
  - `Categories_Empty_FailsValidation` - Categories minProperties: 1
  - `VolumeVarianceMin_OutOfRange_FailsValidation` - VolumeRange validation
  - `PitchVarianceMax_OutOfRange_FailsValidation` - PitchRange validation
  - `MaxSimultaneous_LessThanOne_FailsValidation` - maxSimultaneous ≥ 1
  - `DefaultVolume_OutOfRange_FailsValidation` - defaultVolume 0-1
  - `FallbackEffectId_InvalidPattern_FailsValidation` - Kebab-case pattern
  - `Cooldown_Negative_FailsValidation` - Cooldown ≥ 0

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/sound-effects.schema.json` | Added |
| `tests/.../Schemas/SoundEffectsSchemaTests.cs` | Added |
| `changelogs/v0.14.6a-changelog.md` | Added |

## Test Results

```
Test summary: total: 13, failed: 0, succeeded: 13, skipped: 0
Build succeeded with 0 errors
```

## Sound Effect Schema Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  SOUND EFFECTS CONFIGURATION                                    │
├─────────────────────────────────────────────────────────────────┤
│  $schema: "./schemas/sound-effects.schema.json"                 │
│  version: "1.0.0" (optional)                                    │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  CATEGORIES (required, minProperties: 1)                   │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │  "combat": SoundCategory                             │  │  │
│  │  │  "ability": SoundCategory                            │  │  │
│  │  │  "ui": SoundCategory                                 │  │  │
│  │  │  "items": SoundCategory                              │  │  │
│  │  │  "puzzle": SoundCategory                             │  │  │
│  │  │  "movement": SoundCategory                           │  │  │
│  │  │  ... (extensible via additionalProperties)           │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  SETTINGS (optional)                                       │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │  maxSimultaneous: 8                                  │  │  │
│  │  │  defaultVolume: 0.8                                  │  │  │
│  │  │  masterMute: false                                   │  │  │
│  │  │  fallbackEnabled: true                               │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Sound Effect Definition Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  SOUND EFFECT                                                   │
├─────────────────────────────────────────────────────────────────┤
│  files: [                                                       │
│    "audio/sfx/combat/hit_01.ogg",                               │
│    "audio/sfx/combat/hit_02.ogg",                               │
│    "audio/sfx/combat/hit_03.ogg"                                │
│  ]                                                              │
│  volume: 0.8                                                    │
│  volumeVariance: { min: 0.9, max: 1.1 }                         │
│  pitch: 1.0                                                     │
│  pitchVariance: { min: 0.95, max: 1.05 }                        │
│  randomize: true                                                │
│  loop: false                                                    │
│  cooldown: 0.1                                                  │
│  priority: 6                                                    │
│  fallbackEffectId: "generic-hit"                                │
│  tags: ["weapon", "impact"]                                     │
└─────────────────────────────────────────────────────────────────┘
```

## Variance Calculation

```
VOLUME CALCULATION:
═══════════════════
  If volumeVariance is defined:
    randomFactor = random(min, max)
    finalVolume = volume × randomFactor
  Else:
    finalVolume = volume

  Example: volume=0.8, variance={0.9, 1.1}
    randomFactor = 0.95
    finalVolume = 0.8 × 0.95 = 0.76

PITCH CALCULATION:
══════════════════
  pitch < 1.0  →  Lower frequency, slower
  pitch = 1.0  →  Normal playback
  pitch > 1.0  →  Higher frequency, faster
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Define custom sound categories with any name
- Configure multiple audio files per effect with randomization
- Set up volume/pitch variance for dynamic audio
- Configure priority system for simultaneous playback limits
- Define fallback effects for missing audio files
- Tag effects for filtering and organization
- Adjust global settings (max simultaneous, default volume, master mute)

---

*First entry in v0.14.6 Audio Configuration Schemas series. See also: v0.14.6b (Music Theme Schema).*
