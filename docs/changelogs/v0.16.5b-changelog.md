# Changelog: v0.16.5b — Special Effect System

**Release Date:** 2026-01-29

## Summary

Implements the Special Effect System for Myth-Forged unique items, providing 14 distinct effect types with 6 different activation triggers.

---

## Added

### Domain Layer

#### Enums

- **`SpecialEffectType`** — Defines 14 special effect types organized into categories:
    - Combat Effects: `IgnoreArmor`, `LifeSteal`, `Cleave`, `Phase`, `Reflect`
    - Elemental Effects: `FireDamage`, `IceDamage`, `LightningDamage`
    - Triggered Effects: `Slow`, `AutoHide`
    - Passive Effects: `Detection`, `CriticalBonus`, `DamageReduction`, `FearAura`
    - Plus `None` (value 0) as default/uninitialized value

- **`EffectTriggerType`** — Defines 6 activation trigger types:
    - `Passive` (0) — Always active while equipped
    - `OnAttack` (1) — Before hit calculation
    - `OnHit` (2) — After successful hit
    - `OnDamageDealt` (3) — After damage applied
    - `OnDamageTaken` (4) — When receiving damage
    - `OnKill` (5) — After defeating an enemy

#### Value Objects

- **`SpecialEffect`** — Immutable value object with:
    - Properties: `EffectId`, `EffectType`, `TriggerType`, `Magnitude`, `DamageTypeId`, `Description`
    - Factory method `Create()` with comprehensive validation
    - Magnitude validation by effect type (percentage 0-1 vs flat values)
    - Required `DamageTypeId` for elemental effects
    - Trigger type matching validation via `GetExpectedTriggerType()`
    - Helper properties: `IsPassive`, `IsElemental`
    - Static `None` instance for empty/null effects
    - Auto-generated default descriptions
    - Optional `ILogger` parameter for detailed logging

### Configuration

- **`config/special-effects.json`** — 15 predefined special effects covering all effect types
- **`config/schemas/special-effects.schema.json`** — JSON Schema with conditional validations for elemental effects and percentage magnitude limits

### Tests

- **`SpecialEffectTypeTests`** — 6 tests verifying enum values and count
- **`EffectTriggerTypeTests`** — 4 tests verifying trigger types and ordering
- **`SpecialEffectTests`** — 30+ tests covering:
    - Valid effect creation and ID normalization
    - Null/empty/whitespace ID validation
    - `None` type rejection
    - Percentage magnitude range validation (0-1)
    - Flat value non-negative validation
    - Elemental damage type requirement
    - Trigger type matching validation
    - Helper property behavior (`IsPassive`, `IsElemental`, `HasTrigger`)
    - Default description generation
    - `ToString()` output

---

## Technical Notes

### Trigger Type Mapping

Each effect type has a canonical trigger:

| Effect Type     | Expected Trigger |
| --------------- | ---------------- |
| IgnoreArmor     | OnAttack         |
| Cleave          | OnAttack         |
| Phase           | OnAttack         |
| FireDamage      | OnHit            |
| IceDamage       | OnHit            |
| LightningDamage | OnHit            |
| Slow            | OnHit            |
| LifeSteal       | OnDamageDealt    |
| Reflect         | OnDamageTaken    |
| AutoHide        | OnKill           |
| Detection       | Passive          |
| CriticalBonus   | Passive          |
| DamageReduction | Passive          |
| FearAura        | Passive          |

### Dependencies

- Builds on **v0.16.5a** (`UniqueItem.SpecialEffectIds` references these effects)
- Required by **v0.16.5c** (Unique Item Registry) and later phases

---

## Verification

```bash
# Build domain project
dotnet build src/Core/RuneAndRust.Domain --configuration Release
# Result: Build succeeded

# Run unit tests
dotnet test tests/RuneAndRust.Domain.UnitTests --filter "FullyQualifiedName~SpecialEffect|FullyQualifiedName~EffectTrigger"
# Result: 58 tests passed
```
