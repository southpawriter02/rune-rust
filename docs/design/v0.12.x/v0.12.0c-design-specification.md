# v0.12.0c Design Specification: Statistics View

**Version:** 0.12.0c
**Parent:** v0.12.0 (Statistics System)
**Prerequisites:** v0.12.0a Complete (Core Statistics), v0.12.0b Complete (Dice Roll History)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [StatisticCategory Enum](#4-statisticcategory-enum)
5. [StatisticsFormatter Class](#5-statisticsformatter-class)
6. [StatisticsView Screen](#6-statisticsview-screen)
7. [StatsCommand Implementation](#7-statscommand-implementation)
8. [Statistics Persistence](#8-statistics-persistence)
9. [Save File Integration](#9-save-file-integration)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

### Overview

Version 0.12.0c implements the statistics view UI for the Statistics System. This includes the `StatisticsView` screen with tabbed category navigation (Combat, Exploration, Progression, Dice, Time), the `StatisticsFormatter` for consistent display formatting, the `StatsCommand` for TUI access, and full persistence integration to save/load statistics with character data. This completes the v0.12.0 Statistics System, providing players with comprehensive insight into their game performance.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Presentation** | StatisticsView screen |
| **Commands** | StatsCommand |
| **Formatters** | StatisticsFormatter |
| **Persistence** | Statistics save/load integration |
| **Save Integration** | Character save file updates |
| **Tests** | ~12 new unit tests |

### Architectural Significance

This version establishes the **Statistics Presentation Pattern** for displaying game data:
- Tabbed category navigation for organized display
- Consistent number, percentage, and duration formatting
- Combat rating visualization with star display
- Luck rating visualization with emoji
- Persistence of all statistics across sessions
- Integration with existing save file system

---

## 2. Feature Overview

```
v0.12.0c Statistics View Features
├── StatisticsView Screen
│   ├── Header with title
│   ├── Category tabs
│   │   ├── Combat tab
│   │   ├── Exploration tab
│   │   ├── Progression tab
│   │   ├── Dice tab
│   │   └── Time tab
│   ├── Combat stats display
│   │   ├── Monsters killed with breakdown
│   │   ├── Bosses killed
│   │   ├── Damage dealt with average
│   │   ├── Damage taken with average
│   │   ├── Critical hits with rate
│   │   ├── Attacks missed with rate
│   │   ├── Abilities used
│   │   ├── Times defeated
│   │   └── Combat rating display
│   ├── Exploration stats display
│   │   ├── Rooms discovered
│   │   ├── Secrets found
│   │   ├── Traps triggered/avoided
│   │   ├── Doors opened
│   │   └── Chests opened
│   ├── Progression stats display
│   │   ├── XP earned
│   │   ├── Levels gained
│   │   ├── Items found/crafted
│   │   ├── Gold earned/spent
│   │   ├── Quests completed
│   │   ├── Puzzles solved
│   │   └── Resources gathered
│   ├── Dice stats display
│   │   ├── Total d20 rolls
│   │   ├── Natural 20s with rate
│   │   ├── Natural 1s with rate
│   │   ├── Average d20 roll
│   │   ├── Luck rating with emoji
│   │   ├── Current streak
│   │   ├── Longest streaks
│   │   └── Recent rolls display
│   └── Time stats display
│       ├── Total playtime
│       ├── Session count
│       ├── Average session length
│       ├── First played date
│       └── Last played date
├── StatisticsFormatter
│   ├── FormatNumber (thousands separators)
│   ├── FormatPercent (percentage display)
│   ├── FormatDuration (time spans)
│   ├── FormatDate (dates)
│   └── FormatRecentRolls (roll highlights)
├── StatsCommand
│   ├── "stats" base command
│   ├── Category argument support
│   │   ├── "stats combat"
│   │   ├── "stats exploration"
│   │   ├── "stats progression"
│   │   ├── "stats dice"
│   │   └── "stats time"
│   └── Help text
├── Statistics Persistence
│   ├── PlayerStatistics serialization
│   ├── DiceRollHistory serialization
│   └── Load/Save with character
└── Save File Integration
    └── Statistics included in save data
```

---

## 3. Architecture Diagrams

### 3.1 Statistics View Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                    STATISTICS VIEW ARCHITECTURE                      │
└─────────────────────────────────────────────────────────────────────┘

                        PRESENTATION LAYER
                        ──────────────────

    User Input                           StatisticsView
    ──────────                           ──────────────

    > stats                 ┌────────────────────────────────────────┐
    > stats combat          │           STATISTICS VIEW              │
    > stats dice            ├────────────────────────────────────────┤
                            │ [Combat] [Explore] [Progress] [Dice]   │
                            │ [Time]                                 │
                            ├────────────────────────────────────────┤
                            │                                        │
                            │   Category-specific content here       │
                            │                                        │
                            └─────────────────┬──────────────────────┘
                                              │
                                              │ uses
                                              ▼
                            ┌────────────────────────────────────────┐
                            │        StatisticsFormatter             │
                            ├────────────────────────────────────────┤
                            │ + FormatNumber(4532) → "4,532"         │
                            │ + FormatPercent(0.092) → "9.2%"        │
                            │ + FormatDuration(TimeSpan)             │
                            │ + FormatDate(DateTime)                 │
                            │ + FormatRecentRolls(rolls)             │
                            └────────────────────────────────────────┘


                        APPLICATION LAYER
                        ─────────────────

    ┌────────────────────────────┐   ┌────────────────────────────────┐
    │      StatsCommand          │   │       CommandResult            │
    ├────────────────────────────┤   ├────────────────────────────────┤
    │ + Name: "stats"            │──▶│ + Success                      │
    │ + Execute(player, args)    │   │ + Message                      │
    └────────────────────────────┘   └────────────────────────────────┘
              │
              │ queries
              ▼
    ┌────────────────────────────┐   ┌────────────────────────────────┐
    │   IStatisticsService       │   │   IDiceHistoryService          │
    ├────────────────────────────┤   ├────────────────────────────────┤
    │ + GetPlayerStatistics()    │   │ + GetStatistics()              │
    │ + GetMetrics()             │   │ + GetRecentRolls()             │
    └────────────────────────────┘   └────────────────────────────────┘
```

### 3.2 Tab Navigation Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                      TAB NAVIGATION FLOW                             │
└─────────────────────────────────────────────────────────────────────┘

    User Command               Tab Selection           Content Display
    ────────────               ─────────────           ───────────────

    "stats"          ────▶    Combat (default)  ────▶ Combat Statistics
    "stats combat"   ────▶    Combat            ────▶ Combat Statistics
    "stats explore"  ────▶    Exploration       ────▶ Exploration Stats
    "stats progress" ────▶    Progression       ────▶ Progression Stats
    "stats dice"     ────▶    Dice              ────▶ Dice Statistics
    "stats time"     ────▶    Time              ────▶ Time Statistics


    TAB BAR RENDERING
    ─────────────────

    Current Tab = Combat:
    ┌─────────────────────────────────────────────────────────────────┐
    │ [*Combat*] [Exploration] [Progression] [Dice] [Time]            │
    └─────────────────────────────────────────────────────────────────┘

    Current Tab = Dice:
    ┌─────────────────────────────────────────────────────────────────┐
    │ [Combat] [Exploration] [Progression] [*Dice*] [Time]            │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.3 Statistics Display Layout

```
┌─────────────────────────────────────────────────────────────────────┐
│                    STATISTICS DISPLAY LAYOUT                         │
└─────────────────────────────────────────────────────────────────────┘

    COMBAT TAB LAYOUT
    ─────────────────

    ┌─────────────────────────────────────────────────────────────────┐
    │                         STATISTICS                               │
    ├─────────────────────────────────────────────────────────────────┤
    │ [*Combat*] [Exploration] [Progression] [Dice] [Time]            │
    ├─────────────────────────────────────────────────────────────────┤
    │                                                                  │
    │                      COMBAT STATISTICS                           │
    │                      ─────────────────                           │
    │                                                                  │
    │   Monsters Killed          127          Goblins: 45, Skeletons: 32│
    │   Bosses Killed              3          Skeleton King, Dragon    │
    │   Total Damage Dealt     4,532          Average: 12.3 per hit    │
    │   Total Damage Taken     1,876          Average: 8.7 per hit     │
    │   Critical Hits             47          Rate: 9.2%               │
    │   Attacks Missed            89          Miss Rate: 17.4%         │
    │   Abilities Used           234                                   │
    │   Times Defeated             3                                   │
    │                                                                  │
    │   ══════════════════════════════════════════════════════════    │
    │   COMBAT RATING: ★★★★☆ (Skilled)                                │
    │                                                                  │
    └─────────────────────────────────────────────────────────────────┘


    DICE TAB LAYOUT
    ───────────────

    ┌─────────────────────────────────────────────────────────────────┐
    │                         STATISTICS                               │
    ├─────────────────────────────────────────────────────────────────┤
    │ [Combat] [Exploration] [Progression] [*Dice*] [Time]            │
    ├─────────────────────────────────────────────────────────────────┤
    │                                                                  │
    │                       DICE STATISTICS                            │
    │                       ───────────────                            │
    │                                                                  │
    │   Total d20 Rolls          523                                   │
    │   Natural 20s               47          Rate: 9.0% (exp: 5.0%)  │
    │   Natural 1s                31          Rate: 5.9% (exp: 5.0%)  │
    │   Average d20 Roll        11.2          (expected: 10.5)         │
    │                                                                  │
    │   LUCK RATING: Lucky (+6.7% above average)                      │
    │                                                                  │
    │   Current Streak: +3 (3 above-average rolls in a row)           │
    │   Longest Lucky Streak: +7                                       │
    │   Longest Unlucky Streak: -5                                     │
    │                                                                  │
    │   Recent Rolls (d20): 18, 14, 12, 3, 20!, 8, 15, 11, 19, 7      │
    │                                                                  │
    └─────────────────────────────────────────────────────────────────┘


    TIME TAB LAYOUT
    ───────────────

    ┌─────────────────────────────────────────────────────────────────┐
    │                         STATISTICS                               │
    ├─────────────────────────────────────────────────────────────────┤
    │ [Combat] [Exploration] [Progression] [Dice] [*Time*]            │
    ├─────────────────────────────────────────────────────────────────┤
    │                                                                  │
    │                       TIME STATISTICS                            │
    │                       ───────────────                            │
    │                                                                  │
    │   Total Playtime        12h 34m 56s                              │
    │   Sessions                    15                                 │
    │   Average Session          50m 20s                               │
    │   First Played          2026-01-01                               │
    │   Last Played           2026-01-16                               │
    │                                                                  │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.4 Combat Rating Calculation

```
┌─────────────────────────────────────────────────────────────────────┐
│                    COMBAT RATING CALCULATION                         │
└─────────────────────────────────────────────────────────────────────┘

    RATING TIERS
    ────────────

    ┌────────────────────────────────────────────────────────────────┐
    │ Rating      │ Display              │ Criteria                  │
    ├─────────────┼──────────────────────┼───────────────────────────┤
    │ Novice      │ ★☆☆☆☆               │ < 10 monsters killed      │
    │ Apprentice  │ ★★☆☆☆               │ 10-49 monsters killed     │
    │ Journeyman  │ ★★★☆☆               │ 50-99 monsters killed     │
    │ Skilled     │ ★★★★☆               │ 100-249 monsters killed   │
    │ Veteran     │ ★★★★★               │ 250-499 monsters killed   │
    │ Master      │ ★★★★★+              │ 500-999 monsters killed   │
    │ Legend      │ LEGEND               │ 1000+ monsters killed     │
    └────────────────────────────────────────────────────────────────┘


    CALCULATION FLOW
    ────────────────

    GetCombatRating(PlayerStatistics stats)
           │
           ▼
    ┌──────────────────────────────────────┐
    │ monstersKilled = stats.MonstersKilled │
    └──────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────┐
    │ return monstersKilled switch          │
    │ {                                     │
    │     < 10   => Novice,                 │
    │     < 50   => Apprentice,             │
    │     < 100  => Journeyman,             │
    │     < 250  => Skilled,                │
    │     < 500  => Veteran,                │
    │     < 1000 => Master,                 │
    │     _      => Legend                  │
    │ };                                    │
    └──────────────────────────────────────┘
```

### 3.5 Statistics Persistence Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    STATISTICS PERSISTENCE FLOW                       │
└─────────────────────────────────────────────────────────────────────┘

    SAVE FLOW
    ─────────

    Player triggers save
           │
           ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                    SAVE SERVICE                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │ 1. Get Player entity                                            │
    │ 2. Get PlayerStatistics from Player.Statistics                  │
    │ 3. Get DiceRollHistory from Player.DiceHistory                  │
    │ 4. Serialize to SaveData structure                              │
    │ 5. Write to save file                                           │
    └─────────────────────────────────────────────────────────────────┘


    LOAD FLOW
    ─────────

    Player triggers load
           │
           ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                    LOAD SERVICE                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │ 1. Read save file                                               │
    │ 2. Deserialize SaveData structure                               │
    │ 3. Reconstruct PlayerStatistics                                 │
    │ 4. Reconstruct DiceRollHistory                                  │
    │ 5. Attach to Player entity                                      │
    │ 6. Update session count and last played                         │
    └─────────────────────────────────────────────────────────────────┘


    SAVE DATA STRUCTURE
    ───────────────────

    ┌─────────────────────────────────────────────────────────────────┐
    │ SaveData                                                        │
    ├─────────────────────────────────────────────────────────────────┤
    │ + Player                                                        │
    │   ├── Id, Name, Level, etc.                                     │
    │   ├── Statistics: PlayerStatistics                              │
    │   │   ├── MonstersKilled, BossesKilled                          │
    │   │   ├── TotalDamageDealt, TotalDamageReceived                 │
    │   │   ├── CriticalHits, AttacksMissed                           │
    │   │   ├── RoomsDiscovered, SecretsFound                         │
    │   │   ├── ItemsFound, ItemsCrafted, GoldEarned                  │
    │   │   ├── TotalPlaytime, SessionCount                           │
    │   │   ├── FirstPlayed, LastPlayed                               │
    │   │   └── MonstersByType: Dictionary<string, int>               │
    │   └── DiceHistory: DiceRollHistory                              │
    │       ├── TotalRolls, D20RollCount, D20RollSum                  │
    │       ├── TotalNaturalTwenties, TotalNaturalOnes                │
    │       ├── CurrentStreak, LongestLuckyStreak                     │
    │       ├── LongestUnluckyStreak, LongestNat20Streak              │
    │       └── RecentRolls: List<DiceRollRecord>                     │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.6 Clean Architecture Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                      CLEAN ARCHITECTURE LAYERS                       │
└─────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                      PRESENTATION LAYER                          │
    │                                                                  │
    │  ┌─────────────────────────┐  ┌─────────────────────────────┐   │
    │  │    StatisticsView       │  │   StatisticsFormatter       │   │
    │  │    (screen)             │  │   (helper)                  │   │
    │  │                         │  │                             │   │
    │  │ + Render(player, cat)   │  │ + FormatNumber()            │   │
    │  │ + RenderTabs()          │  │ + FormatPercent()           │   │
    │  │ + RenderCombatStats()   │  │ + FormatDuration()          │   │
    │  │ + RenderExplorationStats│  │ + FormatDate()              │   │
    │  │ + RenderProgressionStats│  │ + FormatRecentRolls()       │   │
    │  │ + RenderDiceStats()     │  └─────────────────────────────┘   │
    │  │ + RenderTimeStats()     │                                    │
    │  │ + RenderLuckRating()    │                                    │
    │  │ + RenderCombatRating()  │                                    │
    │  └─────────────────────────┘                                    │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                      APPLICATION LAYER                           │
    │                                                                  │
    │  ┌─────────────────────────┐  ┌─────────────────────────────┐   │
    │  │      StatsCommand       │  │     StatisticCategory       │   │
    │  │      (command)          │  │     (enum)                  │   │
    │  │                         │  │                             │   │
    │  │ + Name: "stats"         │  │ + Combat                    │   │
    │  │ + Description           │  │ + Exploration               │   │
    │  │ + Usage                 │  │ + Progression               │   │
    │  │ + Execute()             │  │ + Dice                      │   │
    │  └─────────────────────────┘  │ + Time                      │   │
    │                               └─────────────────────────────┘   │
    │  ┌─────────────────────────┐  ┌─────────────────────────────┐   │
    │  │  IStatisticsService     │  │   IDiceHistoryService       │   │
    │  │  (from v0.12.0a)        │  │   (from v0.12.0b)           │   │
    │  └─────────────────────────┘  └─────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                        DOMAIN LAYER                              │
    │                                                                  │
    │  ┌─────────────────────────┐  ┌─────────────────────────────┐   │
    │  │   PlayerStatistics      │  │    DiceRollHistory          │   │
    │  │   (from v0.12.0a)       │  │    (from v0.12.0b)          │   │
    │  └─────────────────────────┘  └─────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                    INFRASTRUCTURE LAYER                          │
    │                                                                  │
    │  ┌─────────────────────────────────────────────────────────┐    │
    │  │                  Save/Load Integration                   │    │
    │  │  - Statistics serialization                              │    │
    │  │  - Dice history serialization                            │    │
    │  │  - Save file format updates                              │    │
    │  └─────────────────────────────────────────────────────────┘    │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 4. StatisticCategory Enum

### 4.1 Enum Definition (Reference from v0.12.0a)

**File:** `src/Core/RuneAndRust.Domain/Enums/StatisticCategory.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories of statistics tracked for the player.
/// </summary>
/// <remarks>
/// <para>Used by StatisticsView for tab navigation:</para>
/// <list type="bullet">
///   <item><description>Combat: Kills, damage, abilities</description></item>
///   <item><description>Exploration: Rooms, secrets, discoveries</description></item>
///   <item><description>Progression: XP, levels, items, gold</description></item>
///   <item><description>Dice: Roll history and luck tracking</description></item>
///   <item><description>Time: Playtime and session data</description></item>
/// </list>
/// </remarks>
public enum StatisticCategory
{
    /// <summary>
    /// Combat-related statistics: kills, damage, abilities.
    /// </summary>
    Combat,

    /// <summary>
    /// Exploration-related statistics: rooms, secrets, discoveries.
    /// </summary>
    Exploration,

    /// <summary>
    /// Progression-related statistics: XP, levels, items, gold.
    /// </summary>
    Progression,

    /// <summary>
    /// Dice roll statistics: rolls, luck, streaks.
    /// </summary>
    Dice,

    /// <summary>
    /// Time-related statistics: playtime, sessions.
    /// </summary>
    Time
}
```

---

## 5. StatisticsFormatter Class

### 5.1 Class Definition

**File:** `src/Presentation/RuneAndRust.Presentation/Formatters/StatisticsFormatter.cs`

```csharp
namespace RuneAndRust.Presentation.Formatters;

using RuneAndRust.Domain.Records;
using System.Globalization;

/// <summary>
/// Formats statistics values for display in the statistics view.
/// </summary>
/// <remarks>
/// <para>Provides consistent formatting for:</para>
/// <list type="bullet">
///   <item><description>Numbers with thousands separators</description></item>
///   <item><description>Percentages with one decimal place</description></item>
///   <item><description>Durations in human-readable format</description></item>
///   <item><description>Dates in ISO format</description></item>
///   <item><description>Recent rolls with critical highlights</description></item>
/// </list>
/// </remarks>
public class StatisticsFormatter
{
    /// <summary>
    /// Formats a number with thousands separators.
    /// </summary>
    /// <param name="value">The number to format.</param>
    /// <returns>Formatted string with thousands separators (e.g., "4,532").</returns>
    /// <example>
    /// <code>
    /// var formatter = new StatisticsFormatter();
    /// formatter.FormatNumber(4532);  // Returns "4,532"
    /// formatter.FormatNumber(1000000);  // Returns "1,000,000"
    /// </code>
    /// </example>
    public string FormatNumber(long value)
    {
        return value.ToString("N0", CultureInfo.CurrentCulture);
    }

    /// <summary>
    /// Formats a percentage value.
    /// </summary>
    /// <param name="value">The decimal value to format (e.g., 0.092 for 9.2%).</param>
    /// <returns>Formatted percentage string (e.g., "9.2%").</returns>
    /// <example>
    /// <code>
    /// var formatter = new StatisticsFormatter();
    /// formatter.FormatPercent(0.092);  // Returns "9.2%"
    /// formatter.FormatPercent(0.5);    // Returns "50.0%"
    /// </code>
    /// </example>
    public string FormatPercent(double value)
    {
        return value.ToString("P1", CultureInfo.CurrentCulture);
    }

    /// <summary>
    /// Formats a duration in human-readable format.
    /// </summary>
    /// <param name="duration">The time span to format.</param>
    /// <returns>
    /// Formatted duration string. Format depends on magnitude:
    /// - Days or more: "Xd Yh Zm" (e.g., "2d 5h 30m")
    /// - Hours or more: "Xh Ym Zs" (e.g., "12h 34m 56s")
    /// - Less than an hour: "Xm Ys" (e.g., "45m 30s")
    /// </returns>
    /// <example>
    /// <code>
    /// var formatter = new StatisticsFormatter();
    /// formatter.FormatDuration(TimeSpan.FromHours(12.5));  // Returns "12h 30m 0s"
    /// formatter.FormatDuration(TimeSpan.FromMinutes(45));  // Returns "45m 0s"
    /// </code>
    /// </example>
    public string FormatDuration(TimeSpan duration)
    {
        if (duration.TotalDays >= 1)
        {
            return $"{(int)duration.TotalDays}d {duration.Hours}h {duration.Minutes}m";
        }

        if (duration.TotalHours >= 1)
        {
            return $"{(int)duration.TotalHours}h {duration.Minutes}m {duration.Seconds}s";
        }

        return $"{duration.Minutes}m {duration.Seconds}s";
    }

    /// <summary>
    /// Formats a date in ISO format.
    /// </summary>
    /// <param name="date">The date to format.</param>
    /// <returns>Date string in "yyyy-MM-dd" format.</returns>
    /// <example>
    /// <code>
    /// var formatter = new StatisticsFormatter();
    /// formatter.FormatDate(new DateTime(2026, 1, 16));  // Returns "2026-01-16"
    /// </code>
    /// </example>
    public string FormatDate(DateTime date)
    {
        return date.ToString("yyyy-MM-dd", CultureInfo.InvariantCulture);
    }

    /// <summary>
    /// Formats recent dice rolls with critical highlights.
    /// </summary>
    /// <param name="rolls">The recent rolls to format.</param>
    /// <returns>
    /// Comma-separated roll results. Natural 20s are followed by "!",
    /// natural 1s are wrapped in parentheses.
    /// </returns>
    /// <example>
    /// <code>
    /// // Given rolls with results: 18, 20, 14, 1, 12
    /// // Returns: "18, 20!, 14, (1), 12"
    /// </code>
    /// </example>
    public string FormatRecentRolls(IReadOnlyList<DiceRollRecord> rolls)
    {
        ArgumentNullException.ThrowIfNull(rolls);

        return string.Join(", ", rolls.Select(r =>
            r.IndividualRolls.Any(v => v == 20) ? $"{r.Result}!" :
            r.IndividualRolls.Any(v => v == 1) ? $"({r.Result})" :
            r.Result.ToString()));
    }

    /// <summary>
    /// Formats the average session duration.
    /// </summary>
    /// <param name="totalPlaytime">Total playtime across all sessions.</param>
    /// <param name="sessionCount">Number of sessions played.</param>
    /// <returns>Formatted average session duration.</returns>
    public string FormatAverageSession(TimeSpan totalPlaytime, int sessionCount)
    {
        if (sessionCount <= 0)
        {
            return "0m 0s";
        }

        var averageTicks = totalPlaytime.Ticks / sessionCount;
        var averageSession = TimeSpan.FromTicks(averageTicks);
        return FormatDuration(averageSession);
    }
}
```

---

## 6. StatisticsView Screen

### 6.1 Screen Definition

**File:** `src/Presentation/RuneAndRust.Presentation/Views/StatisticsView.cs`

```csharp
namespace RuneAndRust.Presentation.Views;

using RuneAndRust.Application.Interfaces;
using RuneAndRust.Application.Models;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Formatters;
using System.Text;

/// <summary>
/// View for displaying comprehensive player statistics.
/// </summary>
/// <remarks>
/// <para>This view provides:</para>
/// <list type="bullet">
///   <item><description>Tabbed navigation between statistic categories</description></item>
///   <item><description>Formatted display of combat, exploration, progression statistics</description></item>
///   <item><description>Dice roll history with luck rating</description></item>
///   <item><description>Time tracking and session information</description></item>
///   <item><description>Combat rating visualization</description></item>
/// </list>
/// </remarks>
public class StatisticsView
{
    private readonly IStatisticsService _statisticsService;
    private readonly IDiceHistoryService _diceHistoryService;
    private readonly StatisticsFormatter _formatter;
    private readonly StringBuilder _output;

    /// <summary>
    /// Initializes a new instance of the <see cref="StatisticsView"/> class.
    /// </summary>
    /// <param name="statisticsService">Service for retrieving player statistics.</param>
    /// <param name="diceHistoryService">Service for retrieving dice roll history.</param>
    public StatisticsView(
        IStatisticsService statisticsService,
        IDiceHistoryService diceHistoryService)
    {
        _statisticsService = statisticsService ??
            throw new ArgumentNullException(nameof(statisticsService));
        _diceHistoryService = diceHistoryService ??
            throw new ArgumentNullException(nameof(diceHistoryService));
        _formatter = new StatisticsFormatter();
        _output = new StringBuilder();
    }

    /// <summary>
    /// Renders the statistics view for a player.
    /// </summary>
    /// <param name="player">The player whose statistics to display.</param>
    /// <param name="category">The category to display (default: Combat).</param>
    /// <returns>The rendered view as a string.</returns>
    public string Render(Player player, StatisticCategory? category = null)
    {
        ArgumentNullException.ThrowIfNull(player);

        _output.Clear();

        var stats = _statisticsService.GetPlayerStatistics(player);
        var metrics = _statisticsService.GetMetrics(player);
        var diceStats = _diceHistoryService.GetStatistics(player);
        var selectedCategory = category ?? StatisticCategory.Combat;

        RenderHeader();
        RenderTabs(selectedCategory);

        switch (selectedCategory)
        {
            case StatisticCategory.Combat:
                RenderCombatStats(stats, metrics);
                break;
            case StatisticCategory.Exploration:
                RenderExplorationStats(stats);
                break;
            case StatisticCategory.Progression:
                RenderProgressionStats(stats);
                break;
            case StatisticCategory.Dice:
                RenderDiceStats(diceStats, player);
                break;
            case StatisticCategory.Time:
                RenderTimeStats(stats);
                break;
        }

        return _output.ToString();
    }

    /// <summary>
    /// Renders the statistics header.
    /// </summary>
    private void RenderHeader()
    {
        _output.AppendLine("                         STATISTICS                               ");
        _output.AppendLine("─────────────────────────────────────────────────────────────────");
    }

    /// <summary>
    /// Renders the category tabs.
    /// </summary>
    /// <param name="selected">The currently selected category.</param>
    private void RenderTabs(StatisticCategory selected)
    {
        var tabs = new[]
        {
            (StatisticCategory.Combat, "Combat"),
            (StatisticCategory.Exploration, "Exploration"),
            (StatisticCategory.Progression, "Progression"),
            (StatisticCategory.Dice, "Dice"),
            (StatisticCategory.Time, "Time")
        };

        var tabLine = string.Join(" ", tabs.Select(t =>
            t.Item1 == selected ? $"[*{t.Item2}*]" : $"[{t.Item2}]"));

        _output.AppendLine(tabLine);
        _output.AppendLine("─────────────────────────────────────────────────────────────────");
        _output.AppendLine();
    }

    /// <summary>
    /// Renders combat statistics.
    /// </summary>
    /// <param name="stats">The player statistics.</param>
    /// <param name="metrics">The calculated metrics.</param>
    private void RenderCombatStats(PlayerStatistics stats, StatisticsMetrics metrics)
    {
        _output.AppendLine("                     COMBAT STATISTICS");
        _output.AppendLine("                     ─────────────────");
        _output.AppendLine();

        RenderStatLine("Monsters Killed", stats.MonstersKilled,
            FormatTopMonsters(stats.MonstersByType, 3));
        RenderStatLine("Bosses Killed", stats.BossesKilled);
        RenderStatLine("Total Damage Dealt", _formatter.FormatNumber(stats.TotalDamageDealt),
            $"Average: {metrics.AverageDamagePerHit:F1} per hit");
        RenderStatLine("Total Damage Taken", _formatter.FormatNumber(stats.TotalDamageReceived),
            $"Average: {metrics.AverageDamageReceived:F1} per hit");
        RenderStatLine("Critical Hits", stats.CriticalHits,
            $"Rate: {_formatter.FormatPercent(metrics.CriticalHitRate)}");
        RenderStatLine("Attacks Missed", stats.AttacksMissed,
            $"Miss Rate: {_formatter.FormatPercent(metrics.MissRate)}");
        RenderStatLine("Abilities Used", stats.AbilitiesUsed);
        RenderStatLine("Times Defeated", stats.DeathCount);

        _output.AppendLine();
        _output.AppendLine("══════════════════════════════════════════════════════════════");
        RenderCombatRating(metrics.CombatRating);
        _output.AppendLine();
    }

    /// <summary>
    /// Renders exploration statistics.
    /// </summary>
    /// <param name="stats">The player statistics.</param>
    private void RenderExplorationStats(PlayerStatistics stats)
    {
        _output.AppendLine("                   EXPLORATION STATISTICS");
        _output.AppendLine("                   ──────────────────────");
        _output.AppendLine();

        RenderStatLine("Rooms Discovered", stats.RoomsDiscovered);
        RenderStatLine("Secrets Found", stats.SecretsFound);
        RenderStatLine("Traps Triggered", stats.TrapsTriggered);
        RenderStatLine("Traps Avoided", stats.TrapsAvoided);
        RenderStatLine("Doors Opened", stats.DoorsOpened);
        RenderStatLine("Chests Opened", stats.ChestsOpened);
        _output.AppendLine();
    }

    /// <summary>
    /// Renders progression statistics.
    /// </summary>
    /// <param name="stats">The player statistics.</param>
    private void RenderProgressionStats(PlayerStatistics stats)
    {
        _output.AppendLine("                   PROGRESSION STATISTICS");
        _output.AppendLine("                   ──────────────────────");
        _output.AppendLine();

        RenderStatLine("XP Earned", _formatter.FormatNumber(stats.XpEarned));
        RenderStatLine("Levels Gained", stats.LevelsGained);
        RenderStatLine("Items Found", stats.ItemsFound);
        RenderStatLine("Items Crafted", stats.ItemsCrafted);
        RenderStatLine("Gold Earned", _formatter.FormatNumber(stats.GoldEarned));
        RenderStatLine("Gold Spent", _formatter.FormatNumber(stats.GoldSpent));
        RenderStatLine("Quests Completed", stats.QuestsCompleted);
        RenderStatLine("Puzzles Solved", stats.PuzzlesSolved);
        RenderStatLine("Resources Gathered", stats.ResourcesGathered);
        _output.AppendLine();
    }

    /// <summary>
    /// Renders dice roll statistics.
    /// </summary>
    /// <param name="diceStats">The dice statistics.</param>
    /// <param name="player">The player for recent rolls.</param>
    private void RenderDiceStats(DiceStatistics diceStats, Player player)
    {
        _output.AppendLine("                      DICE STATISTICS");
        _output.AppendLine("                      ───────────────");
        _output.AppendLine();

        RenderStatLine("Total d20 Rolls", diceStats.TotalRolls);
        RenderStatLine("Natural 20s", diceStats.TotalNat20s,
            $"Rate: {_formatter.FormatPercent(diceStats.Nat20Rate)} (exp: {_formatter.FormatPercent(diceStats.ExpectedNat20Rate)})");
        RenderStatLine("Natural 1s", diceStats.TotalNat1s,
            $"Rate: {_formatter.FormatPercent(diceStats.Nat1Rate)} (exp: {_formatter.FormatPercent(diceStats.ExpectedNat1Rate)})");
        RenderStatLine("Average d20 Roll", $"{diceStats.AverageD20:F1}",
            $"(expected: {diceStats.ExpectedD20:F1})");

        _output.AppendLine();
        RenderLuckRating(diceStats.Rating, diceStats.LuckPercentage);

        _output.AppendLine();
        RenderStreakInfo(diceStats);

        _output.AppendLine();
        var recentRolls = _diceHistoryService.GetRecentRolls(player, 10);
        if (recentRolls.Count > 0)
        {
            _output.AppendLine($"   Recent Rolls (d20): {_formatter.FormatRecentRolls(recentRolls)}");
        }

        _output.AppendLine();
    }

    /// <summary>
    /// Renders time statistics.
    /// </summary>
    /// <param name="stats">The player statistics.</param>
    private void RenderTimeStats(PlayerStatistics stats)
    {
        _output.AppendLine("                       TIME STATISTICS");
        _output.AppendLine("                       ───────────────");
        _output.AppendLine();

        RenderStatLine("Total Playtime", _formatter.FormatDuration(stats.TotalPlaytime));
        RenderStatLine("Sessions", stats.SessionCount);
        RenderStatLine("Average Session", _formatter.FormatAverageSession(
            stats.TotalPlaytime, stats.SessionCount));
        RenderStatLine("First Played", _formatter.FormatDate(stats.FirstPlayed));
        RenderStatLine("Last Played", _formatter.FormatDate(stats.LastPlayed));
        _output.AppendLine();
    }

    /// <summary>
    /// Renders a single statistic line.
    /// </summary>
    /// <param name="label">The statistic label.</param>
    /// <param name="value">The statistic value.</param>
    /// <param name="detail">Optional detail text.</param>
    private void RenderStatLine(string label, object value, string? detail = null)
    {
        var line = $"   {label,-20} {value,10}";
        if (!string.IsNullOrEmpty(detail))
        {
            line += $"          {detail}";
        }

        _output.AppendLine(line);
    }

    /// <summary>
    /// Renders the luck rating display.
    /// </summary>
    /// <param name="rating">The luck rating.</param>
    /// <param name="percentage">The luck percentage.</param>
    private void RenderLuckRating(LuckRating rating, double percentage)
    {
        var label = rating switch
        {
            LuckRating.Cursed => "CURSED",
            LuckRating.Unlucky => "Unlucky",
            LuckRating.Average => "Average",
            LuckRating.Lucky => "Lucky",
            LuckRating.Blessed => "BLESSED",
            _ => "Unknown"
        };

        var sign = percentage >= 0 ? "+" : "";
        _output.AppendLine($"   LUCK RATING: {label} ({sign}{percentage:F1}% average)");
    }

    /// <summary>
    /// Renders streak information.
    /// </summary>
    /// <param name="diceStats">The dice statistics.</param>
    private void RenderStreakInfo(DiceStatistics diceStats)
    {
        var streakType = diceStats.CurrentStreak >= 0 ? "above" : "below";
        var streakCount = Math.Abs(diceStats.CurrentStreak);
        _output.AppendLine(
            $"   Current Streak: {(diceStats.CurrentStreak >= 0 ? "+" : "")}{diceStats.CurrentStreak} " +
            $"({streakCount} {streakType}-average rolls in a row)");
        _output.AppendLine($"   Longest Lucky Streak: +{diceStats.LongestLuckyStreak}");
        _output.AppendLine($"   Longest Unlucky Streak: -{diceStats.LongestUnluckyStreak}");
    }

    /// <summary>
    /// Renders the combat rating display.
    /// </summary>
    /// <param name="rating">The combat rating.</param>
    private void RenderCombatRating(CombatRating rating)
    {
        var (stars, label) = rating switch
        {
            CombatRating.Novice => ("*.....", "Novice"),
            CombatRating.Apprentice => ("**....", "Apprentice"),
            CombatRating.Journeyman => ("***...", "Journeyman"),
            CombatRating.Skilled => ("****.", "Skilled"),
            CombatRating.Veteran => ("*****", "Veteran"),
            CombatRating.Master => ("*****+", "Master"),
            CombatRating.Legend => ("LEGEND", "Legend"),
            _ => (".....", "Unknown")
        };

        _output.AppendLine($"   COMBAT RATING: [{stars}] ({label})");
    }

    /// <summary>
    /// Formats the top monsters killed.
    /// </summary>
    /// <param name="monstersByType">Dictionary of monster type to kill count.</param>
    /// <param name="count">Number of top monsters to show.</param>
    /// <returns>Formatted string of top monsters.</returns>
    private static string FormatTopMonsters(
        IReadOnlyDictionary<string, int> monstersByType,
        int count)
    {
        if (monstersByType.Count == 0)
        {
            return string.Empty;
        }

        var top = monstersByType
            .OrderByDescending(kvp => kvp.Value)
            .Take(count)
            .Select(kvp => $"{kvp.Key}: {kvp.Value}");

        return string.Join(", ", top);
    }
}
```

---

## 7. StatsCommand Implementation

### 7.1 Command Definition

**File:** `src/Core/RuneAndRust.Application/Commands/StatsCommand.cs`

```csharp
namespace RuneAndRust.Application.Commands;

using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Views;

/// <summary>
/// Command to view player statistics.
/// </summary>
/// <remarks>
/// <para>Supports viewing all statistics or specific categories:</para>
/// <list type="bullet">
///   <item><description><c>stats</c> - Show combat statistics (default)</description></item>
///   <item><description><c>stats combat</c> - Show combat statistics</description></item>
///   <item><description><c>stats exploration</c> - Show exploration statistics</description></item>
///   <item><description><c>stats progression</c> - Show progression statistics</description></item>
///   <item><description><c>stats dice</c> - Show dice roll statistics</description></item>
///   <item><description><c>stats time</c> - Show time statistics</description></item>
/// </list>
/// </remarks>
public class StatsCommand : IGameCommand
{
    private readonly StatisticsView _view;

    /// <summary>
    /// Gets the command name.
    /// </summary>
    public string Name => "stats";

    /// <summary>
    /// Gets the command description.
    /// </summary>
    public string Description => "View your game statistics";

    /// <summary>
    /// Gets the command usage text.
    /// </summary>
    public string Usage => "stats [combat|exploration|progression|dice|time]";

    /// <summary>
    /// Initializes a new instance of the <see cref="StatsCommand"/> class.
    /// </summary>
    /// <param name="view">The statistics view to render.</param>
    public StatsCommand(StatisticsView view)
    {
        _view = view ?? throw new ArgumentNullException(nameof(view));
    }

    /// <summary>
    /// Executes the stats command.
    /// </summary>
    /// <param name="player">The player viewing statistics.</param>
    /// <param name="args">Optional category argument.</param>
    /// <returns>Command result with rendered statistics.</returns>
    public CommandResult Execute(Player player, string[] args)
    {
        ArgumentNullException.ThrowIfNull(player);

        StatisticCategory? category = null;

        if (args is { Length: > 0 })
        {
            category = ParseCategory(args[0]);

            if (category is null)
            {
                return CommandResult.Failure(
                    $"Unknown category: '{args[0]}'. " +
                    "Valid categories: combat, exploration, progression, dice, time");
            }
        }

        var output = _view.Render(player, category);

        return CommandResult.Success(output);
    }

    /// <summary>
    /// Parses a category argument string.
    /// </summary>
    /// <param name="input">The input string.</param>
    /// <returns>The parsed category, or null if invalid.</returns>
    private static StatisticCategory? ParseCategory(string input)
    {
        return input.ToLowerInvariant() switch
        {
            "combat" => StatisticCategory.Combat,
            "exploration" or "explore" => StatisticCategory.Exploration,
            "progression" or "progress" => StatisticCategory.Progression,
            "dice" => StatisticCategory.Dice,
            "time" => StatisticCategory.Time,
            _ => null
        };
    }
}
```

---

## 8. Statistics Persistence

### 8.1 Statistics Data Model

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Persistence/Models/StatisticsData.cs`

```csharp
namespace RuneAndRust.Infrastructure.Persistence.Models;

/// <summary>
/// Data model for serializing player statistics to save files.
/// </summary>
/// <remarks>
/// <para>This model captures all statistic values for persistence:</para>
/// <list type="bullet">
///   <item><description>Combat statistics (kills, damage, abilities)</description></item>
///   <item><description>Exploration statistics (rooms, secrets, discoveries)</description></item>
///   <item><description>Progression statistics (XP, levels, items, gold)</description></item>
///   <item><description>Time statistics (playtime, sessions)</description></item>
/// </list>
/// </remarks>
public class StatisticsData
{
    // Combat Statistics
    public int MonstersKilled { get; set; }
    public int BossesKilled { get; set; }
    public long TotalDamageDealt { get; set; }
    public long TotalDamageReceived { get; set; }
    public int CriticalHits { get; set; }
    public int AttacksMissed { get; set; }
    public int AbilitiesUsed { get; set; }
    public int DeathCount { get; set; }
    public Dictionary<string, int> MonstersByType { get; set; } = new();

    // Exploration Statistics
    public int RoomsDiscovered { get; set; }
    public int SecretsFound { get; set; }
    public int TrapsTriggered { get; set; }
    public int TrapsAvoided { get; set; }
    public int DoorsOpened { get; set; }
    public int ChestsOpened { get; set; }

    // Progression Statistics
    public long XpEarned { get; set; }
    public int LevelsGained { get; set; }
    public int ItemsFound { get; set; }
    public int ItemsCrafted { get; set; }
    public long GoldEarned { get; set; }
    public long GoldSpent { get; set; }
    public int QuestsCompleted { get; set; }
    public int PuzzlesSolved { get; set; }
    public int ResourcesGathered { get; set; }

    // Time Statistics
    public long TotalPlaytimeTicks { get; set; }
    public int SessionCount { get; set; }
    public DateTime FirstPlayed { get; set; }
    public DateTime LastPlayed { get; set; }
}
```

### 8.2 Dice History Data Model

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Persistence/Models/DiceHistoryData.cs`

```csharp
namespace RuneAndRust.Infrastructure.Persistence.Models;

/// <summary>
/// Data model for serializing dice roll history to save files.
/// </summary>
/// <remarks>
/// <para>This model captures all dice history values for persistence:</para>
/// <list type="bullet">
///   <item><description>Roll counts and sums for average calculation</description></item>
///   <item><description>Natural 20/1 tracking</description></item>
///   <item><description>Streak records</description></item>
///   <item><description>Recent rolls buffer</description></item>
/// </list>
/// </remarks>
public class DiceHistoryData
{
    // Roll Counts
    public int TotalRolls { get; set; }
    public int D20RollCount { get; set; }
    public long D20RollSum { get; set; }
    public int TotalNaturalTwenties { get; set; }
    public int TotalNaturalOnes { get; set; }

    // Streak Tracking
    public int CurrentStreak { get; set; }
    public int LongestLuckyStreak { get; set; }
    public int LongestUnluckyStreak { get; set; }
    public int LongestNat20Streak { get; set; }

    // Recent Rolls (serialized as list)
    public List<DiceRollData> RecentRolls { get; set; } = new();
}

/// <summary>
/// Data model for a single dice roll record.
/// </summary>
public class DiceRollData
{
    public string DiceExpression { get; set; } = string.Empty;
    public int Result { get; set; }
    public int[] IndividualRolls { get; set; } = Array.Empty<int>();
    public bool WasCritical { get; set; }
    public string Context { get; set; } = string.Empty;
    public DateTime RolledAt { get; set; }
}
```

### 8.3 Statistics Mapper

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Persistence/Mappers/StatisticsMapper.cs`

```csharp
namespace RuneAndRust.Infrastructure.Persistence.Mappers;

using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Records;
using RuneAndRust.Infrastructure.Persistence.Models;

/// <summary>
/// Maps between domain entities and persistence data models for statistics.
/// </summary>
public static class StatisticsMapper
{
    /// <summary>
    /// Maps a PlayerStatistics entity to a data model.
    /// </summary>
    /// <param name="stats">The statistics entity.</param>
    /// <returns>The data model for serialization.</returns>
    public static StatisticsData ToData(PlayerStatistics stats)
    {
        ArgumentNullException.ThrowIfNull(stats);

        return new StatisticsData
        {
            // Combat
            MonstersKilled = stats.MonstersKilled,
            BossesKilled = stats.BossesKilled,
            TotalDamageDealt = stats.TotalDamageDealt,
            TotalDamageReceived = stats.TotalDamageReceived,
            CriticalHits = stats.CriticalHits,
            AttacksMissed = stats.AttacksMissed,
            AbilitiesUsed = stats.AbilitiesUsed,
            DeathCount = stats.DeathCount,
            MonstersByType = new Dictionary<string, int>(stats.MonstersByType),

            // Exploration
            RoomsDiscovered = stats.RoomsDiscovered,
            SecretsFound = stats.SecretsFound,
            TrapsTriggered = stats.TrapsTriggered,
            TrapsAvoided = stats.TrapsAvoided,
            DoorsOpened = stats.DoorsOpened,
            ChestsOpened = stats.ChestsOpened,

            // Progression
            XpEarned = stats.XpEarned,
            LevelsGained = stats.LevelsGained,
            ItemsFound = stats.ItemsFound,
            ItemsCrafted = stats.ItemsCrafted,
            GoldEarned = stats.GoldEarned,
            GoldSpent = stats.GoldSpent,
            QuestsCompleted = stats.QuestsCompleted,
            PuzzlesSolved = stats.PuzzlesSolved,
            ResourcesGathered = stats.ResourcesGathered,

            // Time
            TotalPlaytimeTicks = stats.TotalPlaytime.Ticks,
            SessionCount = stats.SessionCount,
            FirstPlayed = stats.FirstPlayed,
            LastPlayed = stats.LastPlayed
        };
    }

    /// <summary>
    /// Maps a data model to a PlayerStatistics entity.
    /// </summary>
    /// <param name="data">The data model.</param>
    /// <param name="playerId">The player ID.</param>
    /// <returns>The reconstructed statistics entity.</returns>
    public static PlayerStatistics FromData(StatisticsData data, Guid playerId)
    {
        ArgumentNullException.ThrowIfNull(data);

        return PlayerStatistics.Restore(
            playerId: playerId,
            monstersKilled: data.MonstersKilled,
            bossesKilled: data.BossesKilled,
            totalDamageDealt: data.TotalDamageDealt,
            totalDamageReceived: data.TotalDamageReceived,
            criticalHits: data.CriticalHits,
            attacksMissed: data.AttacksMissed,
            abilitiesUsed: data.AbilitiesUsed,
            deathCount: data.DeathCount,
            monstersByType: data.MonstersByType,
            roomsDiscovered: data.RoomsDiscovered,
            secretsFound: data.SecretsFound,
            trapsTriggered: data.TrapsTriggered,
            trapsAvoided: data.TrapsAvoided,
            doorsOpened: data.DoorsOpened,
            chestsOpened: data.ChestsOpened,
            xpEarned: data.XpEarned,
            levelsGained: data.LevelsGained,
            itemsFound: data.ItemsFound,
            itemsCrafted: data.ItemsCrafted,
            goldEarned: data.GoldEarned,
            goldSpent: data.GoldSpent,
            questsCompleted: data.QuestsCompleted,
            puzzlesSolved: data.PuzzlesSolved,
            resourcesGathered: data.ResourcesGathered,
            totalPlaytime: TimeSpan.FromTicks(data.TotalPlaytimeTicks),
            sessionCount: data.SessionCount,
            firstPlayed: data.FirstPlayed,
            lastPlayed: data.LastPlayed);
    }

    /// <summary>
    /// Maps a DiceRollHistory entity to a data model.
    /// </summary>
    /// <param name="history">The dice history entity.</param>
    /// <returns>The data model for serialization.</returns>
    public static DiceHistoryData ToData(DiceRollHistory history)
    {
        ArgumentNullException.ThrowIfNull(history);

        return new DiceHistoryData
        {
            TotalRolls = history.TotalRolls,
            D20RollCount = history.D20RollCount,
            D20RollSum = history.D20RollSum,
            TotalNaturalTwenties = history.TotalNaturalTwenties,
            TotalNaturalOnes = history.TotalNaturalOnes,
            CurrentStreak = history.CurrentStreak,
            LongestLuckyStreak = history.LongestLuckyStreak,
            LongestUnluckyStreak = history.LongestUnluckyStreak,
            LongestNat20Streak = history.LongestNat20Streak,
            RecentRolls = history.RecentRolls.Select(r => new DiceRollData
            {
                DiceExpression = r.DiceExpression,
                Result = r.Result,
                IndividualRolls = r.IndividualRolls,
                WasCritical = r.WasCritical,
                Context = r.Context,
                RolledAt = r.RolledAt
            }).ToList()
        };
    }

    /// <summary>
    /// Maps a data model to a DiceRollHistory entity.
    /// </summary>
    /// <param name="data">The data model.</param>
    /// <param name="playerId">The player ID.</param>
    /// <returns>The reconstructed dice history entity.</returns>
    public static DiceRollHistory FromData(DiceHistoryData data, Guid playerId)
    {
        ArgumentNullException.ThrowIfNull(data);

        var recentRolls = data.RecentRolls.Select(r => new DiceRollRecord(
            r.DiceExpression,
            r.Result,
            r.IndividualRolls,
            r.WasCritical,
            r.Context,
            r.RolledAt)).ToList();

        return DiceRollHistory.Restore(
            playerId: playerId,
            totalRolls: data.TotalRolls,
            d20RollCount: data.D20RollCount,
            d20RollSum: data.D20RollSum,
            totalNaturalTwenties: data.TotalNaturalTwenties,
            totalNaturalOnes: data.TotalNaturalOnes,
            currentStreak: data.CurrentStreak,
            longestLuckyStreak: data.LongestLuckyStreak,
            longestUnluckyStreak: data.LongestUnluckyStreak,
            longestNat20Streak: data.LongestNat20Streak,
            recentRolls: recentRolls);
    }
}
```

---

## 9. Save File Integration

### 9.1 Save Data Structure Updates

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Persistence/Models/SaveData.cs` (modifications)

```csharp
namespace RuneAndRust.Infrastructure.Persistence.Models;

/// <summary>
/// Root data model for save files.
/// </summary>
/// <remarks>
/// <para>Updates for v0.12.0c:</para>
/// <list type="bullet">
///   <item><description>Added Statistics property for player statistics</description></item>
///   <item><description>Added DiceHistory property for dice roll history</description></item>
/// </list>
/// </remarks>
public class SaveData
{
    /// <summary>
    /// Gets or sets the save file version.
    /// </summary>
    public int Version { get; set; } = 12; // Updated for v0.12.0c

    /// <summary>
    /// Gets or sets the player data.
    /// </summary>
    public PlayerData Player { get; set; } = new();

    /// <summary>
    /// Gets or sets the game state data.
    /// </summary>
    public GameStateData GameState { get; set; } = new();

    /// <summary>
    /// Gets or sets the player statistics data.
    /// </summary>
    public StatisticsData? Statistics { get; set; }

    /// <summary>
    /// Gets or sets the dice roll history data.
    /// </summary>
    public DiceHistoryData? DiceHistory { get; set; }

    /// <summary>
    /// Gets or sets the save timestamp.
    /// </summary>
    public DateTime SavedAt { get; set; }
}
```

### 9.2 Save Service Updates

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Services/SaveService.cs` (modifications)

```csharp
// Add to existing SaveService class:

/// <summary>
/// Saves the current game state including statistics.
/// </summary>
/// <param name="player">The player to save.</param>
/// <param name="gameState">The game state to save.</param>
/// <param name="filePath">The save file path.</param>
public async Task SaveAsync(Player player, GameState gameState, string filePath)
{
    ArgumentNullException.ThrowIfNull(player);
    ArgumentNullException.ThrowIfNull(gameState);
    ArgumentException.ThrowIfNullOrEmpty(filePath);

    _logger.LogInformation("Saving game to {FilePath}", filePath);

    var saveData = new SaveData
    {
        Version = 12,
        Player = PlayerMapper.ToData(player),
        GameState = GameStateMapper.ToData(gameState),
        SavedAt = DateTime.UtcNow
    };

    // Save statistics if present
    if (player.Statistics is not null)
    {
        saveData.Statistics = StatisticsMapper.ToData(player.Statistics);
        _logger.LogDebug("Statistics saved: {MonstersKilled} monsters killed",
            player.Statistics.MonstersKilled);
    }

    // Save dice history if present
    if (player.DiceHistory is not null)
    {
        saveData.DiceHistory = StatisticsMapper.ToData(player.DiceHistory);
        _logger.LogDebug("Dice history saved: {TotalRolls} rolls recorded",
            player.DiceHistory.TotalRolls);
    }

    var json = JsonSerializer.Serialize(saveData, _serializerOptions);
    await File.WriteAllTextAsync(filePath, json);

    _logger.LogInformation("Game saved successfully");
}

/// <summary>
/// Loads a saved game including statistics.
/// </summary>
/// <param name="filePath">The save file path.</param>
/// <returns>The loaded player and game state.</returns>
public async Task<(Player Player, GameState GameState)> LoadAsync(string filePath)
{
    ArgumentException.ThrowIfNullOrEmpty(filePath);

    _logger.LogInformation("Loading game from {FilePath}", filePath);

    var json = await File.ReadAllTextAsync(filePath);
    var saveData = JsonSerializer.Deserialize<SaveData>(json, _serializerOptions)
        ?? throw new InvalidOperationException("Failed to deserialize save data");

    var player = PlayerMapper.FromData(saveData.Player);
    var gameState = GameStateMapper.FromData(saveData.GameState);

    // Load statistics if present
    if (saveData.Statistics is not null)
    {
        var statistics = StatisticsMapper.FromData(saveData.Statistics, player.Id);
        player.InitializeStatistics(statistics);
        _logger.LogDebug("Statistics loaded: {MonstersKilled} monsters killed",
            statistics.MonstersKilled);
    }

    // Load dice history if present
    if (saveData.DiceHistory is not null)
    {
        var diceHistory = StatisticsMapper.FromData(saveData.DiceHistory, player.Id);
        player.InitializeDiceHistory(diceHistory);
        _logger.LogDebug("Dice history loaded: {TotalRolls} rolls recorded",
            diceHistory.TotalRolls);
    }

    // Update session tracking
    if (player.Statistics is not null)
    {
        player.Statistics.RecordSessionStart();
    }

    _logger.LogInformation("Game loaded successfully");

    return (player, gameState);
}
```

---

## 10. Logging Specifications

### 10.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `StatisticsView` | Debug | Rendering category, displaying statistics |
| `StatsCommand` | Debug | Command execution, category parsing |
| `SaveService` | Information | Save/Load operations |
| `SaveService` | Debug | Statistics serialization details |
| `StatisticsMapper` | Debug | Mapping operations |

### 10.2 Log Message Examples

```csharp
// StatisticsView - Debug
_logger.LogDebug("Rendering statistics view for player {PlayerId}, category: {Category}",
    player.Id, category);

// StatsCommand - Debug
_logger.LogDebug("Stats command executed for player {PlayerId} with args: {Args}",
    player.Id, string.Join(", ", args));

// SaveService - Information
_logger.LogInformation("Saving game to {FilePath}", filePath);
_logger.LogInformation("Game saved successfully");
_logger.LogInformation("Loading game from {FilePath}", filePath);
_logger.LogInformation("Game loaded successfully");

// SaveService - Debug
_logger.LogDebug("Statistics saved: {MonstersKilled} monsters killed",
    player.Statistics.MonstersKilled);
_logger.LogDebug("Dice history saved: {TotalRolls} rolls recorded",
    player.DiceHistory.TotalRolls);
_logger.LogDebug("Statistics loaded: {MonstersKilled} monsters killed",
    statistics.MonstersKilled);
_logger.LogDebug("Dice history loaded: {TotalRolls} rolls recorded",
    diceHistory.TotalRolls);
```

---

## 11. Unit Testing Requirements

### 11.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| StatisticsFormatter | 5 |
| StatisticsView | 3 |
| StatsCommand | 2 |
| Statistics Persistence | 2 |
| **Total** | **~12** |

### 11.2 Test Specifications

**File:** `tests/RuneAndRust.Tests/Presentation/StatisticsFormatterTests.cs`

```csharp
[TestFixture]
public class StatisticsFormatterTests
{
    [Test]
    public void FormatNumber_WithLargeNumber_ReturnsFormattedString();

    [Test]
    public void FormatPercent_WithDecimal_ReturnsPercentString();

    [Test]
    public void FormatDuration_WithHours_ReturnsHourMinuteSecondFormat();

    [Test]
    public void FormatDate_ReturnsIsoFormat();

    [Test]
    public void FormatRecentRolls_WithNat20_IncludesExclamation();
}
```

**File:** `tests/RuneAndRust.Tests/Presentation/StatisticsViewTests.cs`

```csharp
[TestFixture]
public class StatisticsViewTests
{
    [Test]
    public void Render_WithCombatCategory_ShowsCombatStats();

    [Test]
    public void Render_WithDiceCategory_ShowsDiceStats();

    [Test]
    public void Render_WithNoCategory_DefaultsToCombat();
}
```

**File:** `tests/RuneAndRust.Tests/Application/StatsCommandTests.cs`

```csharp
[TestFixture]
public class StatsCommandTests
{
    [Test]
    public void Execute_WithValidCategory_ReturnsSuccess();

    [Test]
    public void Execute_WithInvalidCategory_ReturnsFailure();
}
```

**File:** `tests/RuneAndRust.Tests/Infrastructure/StatisticsMapperTests.cs`

```csharp
[TestFixture]
public class StatisticsMapperTests
{
    [Test]
    public void ToData_FromData_RoundTripsStatistics();

    [Test]
    public void ToData_FromData_RoundTripsDiceHistory();
}
```

---

## 12. Use Cases

### UC-001: View Combat Statistics

**Actor:** Player
**Flow:** Player enters "stats" or "stats combat" → StatsCommand parses category → StatisticsView.Render() called with Combat category → IStatisticsService.GetPlayerStatistics() retrieves stats → Combat stats rendered with formatting → Combat rating displayed

### UC-002: View Dice Statistics

**Actor:** Player
**Flow:** Player enters "stats dice" → StatsCommand parses category → StatisticsView.Render() called with Dice category → IDiceHistoryService.GetStatistics() retrieves stats → Dice stats rendered with luck rating → Recent rolls displayed with highlights

### UC-003: View Time Statistics

**Actor:** Player
**Flow:** Player enters "stats time" → StatsCommand parses category → StatisticsView.Render() called with Time category → Time stats rendered with formatted duration → Session information displayed

### UC-004: Save Statistics with Game

**Actor:** System
**Flow:** Player triggers save → SaveService.SaveAsync() called → StatisticsMapper.ToData() converts PlayerStatistics → StatisticsMapper.ToData() converts DiceRollHistory → SaveData serialized to JSON → File written to disk

### UC-005: Load Statistics from Save

**Actor:** System
**Flow:** Player triggers load → SaveService.LoadAsync() called → File read and deserialized → StatisticsMapper.FromData() reconstructs PlayerStatistics → StatisticsMapper.FromData() reconstructs DiceRollHistory → Entities attached to Player → Session count incremented

---

## 13. Deliverable Checklist

### Presentation Layer
- [ ] `StatisticsFormatter` class created
- [ ] `StatisticsView` screen created

### Application Layer
- [ ] `StatsCommand` implementation created

### Infrastructure Layer
- [ ] `StatisticsData` model created
- [ ] `DiceHistoryData` model created
- [ ] `DiceRollData` model created
- [ ] `StatisticsMapper` class created
- [ ] `SaveData` updated with statistics properties
- [ ] `SaveService` updated with statistics save/load

### Domain Layer Updates
- [ ] `PlayerStatistics.Restore()` method added
- [ ] `DiceRollHistory.Restore()` method added

### Testing
- [ ] ~12 unit tests implemented
- [ ] All tests passing

---

## 14. Acceptance Criteria

### Functional
- [ ] StatisticsView renders Combat category correctly
- [ ] StatisticsView renders Exploration category correctly
- [ ] StatisticsView renders Progression category correctly
- [ ] StatisticsView renders Dice category correctly
- [ ] StatisticsView renders Time category correctly
- [ ] Tab navigation highlights selected category
- [ ] Combat rating displays with star visualization
- [ ] Luck rating displays with percentage
- [ ] Numbers format with thousands separators
- [ ] Percentages format with one decimal place
- [ ] Durations format in human-readable form
- [ ] Dates format in ISO format
- [ ] Recent rolls display with critical highlights
- [ ] StatsCommand accepts category argument
- [ ] StatsCommand defaults to Combat category
- [ ] StatsCommand rejects invalid categories
- [ ] Statistics persist across save/load cycles
- [ ] Dice history persists across save/load cycles
- [ ] Session count increments on load

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~12 unit tests pass
- [ ] XML documentation complete on all public members

---

## 15. Dependencies

### Required from v0.12.0a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `PlayerStatistics` | Domain/Entities | Displayed in view, persisted |
| `IStatisticsService` | Application/Interfaces | Queried by view |
| `StatisticsMetrics` | Application/Models | Displayed in combat stats |
| `CombatRating` | Application/Models | Displayed with stars |
| `StatisticCategory` | Domain/Enums | Tab navigation |

### Required from v0.12.0b

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `DiceRollHistory` | Domain/Entities | Displayed in view, persisted |
| `IDiceHistoryService` | Application/Interfaces | Queried by view |
| `DiceStatistics` | Application/Models | Displayed in dice tab |
| `LuckRating` | Application/Models | Displayed with label |
| `DiceRollRecord` | Domain/Records | Recent rolls display |

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `Player` | Domain/Entities | Statistics owner |
| `IGameCommand` | Application/Interfaces | Command base |
| `CommandResult` | Application/Models | Command return type |
| `SaveService` | Infrastructure/Services | Persistence |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `StatisticsView` | Foundation for achievements display |
| `StatisticsFormatter` | Reusable formatting utilities |
| `Statistics Persistence` | Save file format with statistics |

---

## 16. Future Considerations

### Deferred to v0.12.1 (Achievements)
- **Achievement Display**: Showing unlocked achievements in statistics
- **Progress Tracking**: Achievement progress indicators

### Out of Scope
- **Leaderboards**: Comparing statistics between players
- **Statistics Export**: Exporting statistics to external formats
- **Graphical Charts**: Visual charts or graphs of statistics
- **Statistics Reset**: Ability to reset statistics
- **Per-Session Statistics**: Detailed per-session breakdowns

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
*Author: Claude*
