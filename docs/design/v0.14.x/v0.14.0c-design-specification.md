# v0.14.0c Design Specification: Background Schema

**Version:** 0.14.0c
**Parent:** v0.14.0 (Character Configuration Schemas)
**Prerequisites:** v0.13.5 Complete (UI Standardization)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Background Schema Definition](#4-background-schema-definition)
   - 4.1 [Schema Structure](#41-schema-structure)
   - 4.2 [BackgroundDefinition Object](#42-backgrounddefinition-object)
   - 4.3 [AttributeBonuses Object](#43-attributebonuses-object)
5. [Validation Rules](#5-validation-rules)
   - 5.1 [ID Pattern Validation](#51-id-pattern-validation)
   - 5.2 [Attribute Bonus Range](#52-attribute-bonus-range)
   - 5.3 [Category Enum Validation](#53-category-enum-validation)
   - 5.4 [Required Fields](#54-required-fields)
6. [Configuration Schema](#6-configuration-schema)
7. [Configuration File Updates](#7-configuration-file-updates)
8. [Data Model Changes](#8-data-model-changes)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

Version 0.14.0c introduces the Background Schema (`backgrounds.schema.json`), a comprehensive JSON Schema Draft-07 specification that validates background configuration files. Backgrounds represent a character's history, divided into two categories: **Professions** (trained occupations) and **Lineages** (cultural/geographical origins).

The Background Schema enables IDE autocomplete and validation for background definitions, ensuring attribute bonuses remain within the 0 to +2 range, category values are valid enumeration members, starter abilities are properly defined, and all required fields are present. This supports modding scenarios where users create custom backgrounds while maintaining data integrity.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `backgrounds.schema.json` |
| **Schema Definitions** | `BackgroundDefinition`, `AttributeBonuses` |
| **Configuration Updates** | Update `backgrounds.json` schema reference |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version continues the **JSON Schema validation pattern** established in v0.14.0a:
- Draft-07 schema format
- Definitions section for reusable types
- Pattern validation for IDs (`^[a-z][a-z0-9-]*$`)
- Enum validation for categorical values (Profession, Lineage)
- Range validation for numeric fields (0-2 for bonuses)
- Optional fields with sensible defaults

### Key Differences from Race Schema (v0.14.0a)

| Aspect | Race Schema | Background Schema |
|--------|-------------|-------------------|
| **Attribute Range** | -3 to +3 (modifiers) | 0 to +2 (bonuses only) |
| **Attribute Fields** | All required | All optional (partial bonuses) |
| **Categories** | None | Profession, Lineage enum |
| **Starter Ability** | None | id, name, description fields |
| **Starting Items** | Optional array | Required array |

---

## 2. Feature Overview

```
v0.14.0c Background Schema Features
├── backgrounds.schema.json
│   ├── Root Object Properties
│   │   ├── $schema (string, optional)
│   │   ├── version (string, optional)
│   │   └── backgrounds (array of BackgroundDefinition, required)
│   └── Definitions
│       ├── BackgroundDefinition
│       │   ├── id (string, kebab-case pattern)
│       │   ├── name (string, minLength: 1)
│       │   ├── category (string, enum: Profession, Lineage)
│       │   ├── description (string)
│       │   ├── lore (string, optional)
│       │   ├── attributeBonuses (AttributeBonuses)
│       │   ├── starterAbilityId (string)
│       │   ├── starterAbilityName (string)
│       │   ├── starterAbilityDescription (string)
│       │   ├── startingItems (array of string)
│       │   ├── isPlayable (boolean, default: true)
│       │   └── sortOrder (integer, minimum: 0)
│       └── AttributeBonuses
│           ├── might (integer, 0 to 2, optional)
│           ├── fortitude (integer, 0 to 2, optional)
│           ├── will (integer, 0 to 2, optional)
│           ├── wits (integer, 0 to 2, optional)
│           └── finesse (integer, 0 to 2, optional)
├── Validation Rules
│   ├── ID Pattern Enforcement
│   ├── Attribute Bonus Range Validation (0-2)
│   ├── Category Enum Validation
│   └── Required Field Enforcement
└── Configuration Updates
    └── backgrounds.json $schema reference update
```

---

## 3. Architecture Diagrams

### 3.1 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits backgrounds.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from backgrounds.json                             │
│  2. Loads config/schemas/backgrounds.schema.json                             │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "id must match pattern ^[a-z][a-z0-9-]*$"
                           • "attributeBonuses.might must be <= 2"
                           • "category must be one of: Profession, Lineage"
                           • "missing required property 'starterAbilityId'"
```

### 3.2 Schema Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         backgrounds.schema.json                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"                         │
│  title: "Background Configuration"                                           │
│  type: object                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  properties:                                                                 │
│  ┌─────────────────┬───────────────────────────────────────────────────┐    │
│  │ $schema         │ type: string (optional)                           │    │
│  ├─────────────────┼───────────────────────────────────────────────────┤    │
│  │ version         │ type: string (optional)                           │    │
│  ├─────────────────┼───────────────────────────────────────────────────┤    │
│  │ backgrounds     │ type: array, items: $ref BackgroundDefinition     │    │
│  └─────────────────┴───────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────────────────┤
│  definitions:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ BackgroundDefinition                                                 │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ id                    │ string, pattern: ^[a-z][a-z0-9-]*$    │   │    │
│  │ │ name                  │ string, minLength: 1                  │   │    │
│  │ │ category              │ string, enum: [Profession, Lineage]   │   │    │
│  │ │ description           │ string                                │   │    │
│  │ │ lore                  │ string (optional)                     │   │    │
│  │ │ attributeBonuses      │ $ref AttributeBonuses                 │   │    │
│  │ │ starterAbilityId      │ string                                │   │    │
│  │ │ starterAbilityName    │ string                                │   │    │
│  │ │ starterAbilityDescription │ string                            │   │    │
│  │ │ startingItems         │ array of string                       │   │    │
│  │ │ isPlayable            │ boolean, default: true                │   │    │
│  │ │ sortOrder             │ integer, minimum: 0                   │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ AttributeBonuses                                                     │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ might                 │ integer, minimum: 0, maximum: 2       │   │    │
│  │ │ fortitude             │ integer, minimum: 0, maximum: 2       │   │    │
│  │ │ will                  │ integer, minimum: 0, maximum: 2       │   │    │
│  │ │ wits                  │ integer, minimum: 0, maximum: 2       │   │    │
│  │ │ finesse               │ integer, minimum: 0, maximum: 2       │   │    │
│  │ │ (all fields optional) │                                       │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Background Category Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       BACKGROUND CATEGORIES                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────┐   ┌─────────────────────────────────┐  │
│  │         PROFESSION              │   │           LINEAGE               │  │
│  │    (Trained Occupation)         │   │  (Cultural/Geographical Origin) │  │
│  ├─────────────────────────────────┤   ├─────────────────────────────────┤  │
│  │                                 │   │                                 │  │
│  │  ┌─────────────────────────┐   │   │  ┌─────────────────────────┐   │  │
│  │  │ Soldier                 │   │   │  │ Mountainborn            │   │  │
│  │  │ • might: +2             │   │   │  │ • fortitude: +1         │   │  │
│  │  │ • Shield Bash ability   │   │   │  │ • might: +1             │   │  │
│  │  └─────────────────────────┘   │   │  │ • Endurance ability     │   │  │
│  │  ┌─────────────────────────┐   │   │  └─────────────────────────┘   │  │
│  │  │ Scholar                 │   │   │  ┌─────────────────────────┐   │  │
│  │  │ • wits: +2              │   │   │  │ Coastlander             │   │  │
│  │  │ • Lore Recall ability   │   │   │  │ • finesse: +1           │   │  │
│  │  └─────────────────────────┘   │   │  │ • wits: +1              │   │  │
│  │  ┌─────────────────────────┐   │   │  │ • Strong Swimmer ability│   │  │
│  │  │ Thief                   │   │   │  └─────────────────────────┘   │  │
│  │  │ • finesse: +2           │   │   │  ┌─────────────────────────┐   │  │
│  │  │ • Sneak Attack ability  │   │   │  │ Forestkin               │   │  │
│  │  └─────────────────────────┘   │   │  │ • wits: +1              │   │  │
│  │  ┌─────────────────────────┐   │   │  │ • finesse: +1           │   │  │
│  │  │ Healer                  │   │   │  │ • Tracker ability       │   │  │
│  │  │ • will: +2              │   │   │  └─────────────────────────┘   │  │
│  │  │ • Minor Heal ability    │   │   │  ┌─────────────────────────┐   │  │
│  │  └─────────────────────────┘   │   │  │ Cityfolk                │   │  │
│  │                                 │   │  │ • will: +1              │   │  │
│  │  Pattern: Single +2 bonus       │   │  │ • wits: +1              │   │  │
│  │                                 │   │  │ • Streetwise ability    │   │  │
│  └─────────────────────────────────┘   │  └─────────────────────────┘   │  │
│                                        │                                 │  │
│                                        │  Pattern: Two +1 bonuses        │  │
│                                        └─────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── backgrounds.json ◀──────────────────────┐                              │
│  │   {                                        │ references                   │
│  │     "$schema": "./schemas/backgrounds.schema.json",                      │
│  │     "version": "1.0",                      │                              │
│  │     "backgrounds": [...]                   │                              │
│  │   }                                        │                              │
│  │                                            │                              │
│  └── schemas/                                 │                              │
│      └── backgrounds.schema.json ─────────────┘                              │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {...}                                              │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Background Schema Definition

### 4.1 Schema Structure

**File:** `config/schemas/backgrounds.schema.json`

The background schema follows JSON Schema Draft-07 specification, providing comprehensive validation for background configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Background Configuration",
    "description": "Schema for character background definitions. Backgrounds represent a character's history and provide attribute bonuses, starter abilities, and starting items.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Configuration file version for compatibility tracking",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "backgrounds": {
            "type": "array",
            "description": "List of background definitions",
            "items": {
                "$ref": "#/definitions/BackgroundDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["backgrounds"],
    "additionalProperties": false,
    "definitions": {
        "BackgroundDefinition": { ... },
        "AttributeBonuses": { ... }
    }
}
```

### 4.2 BackgroundDefinition Object

The `BackgroundDefinition` object represents a single character background with all associated properties.

```json
"BackgroundDefinition": {
    "type": "object",
    "description": "A single background definition with category, bonuses, ability, and metadata",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the background (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name for the background shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "category": {
            "type": "string",
            "description": "Background category determining bonus distribution pattern",
            "enum": ["Profession", "Lineage"]
        },
        "description": {
            "type": "string",
            "description": "Short description of the background for character creation",
            "minLength": 1,
            "maxLength": 500
        },
        "lore": {
            "type": "string",
            "description": "Extended lore and background story flavor text",
            "maxLength": 2000
        },
        "attributeBonuses": {
            "$ref": "#/definitions/AttributeBonuses",
            "description": "Attribute bonuses provided by this background (0-2 per attribute)"
        },
        "starterAbilityId": {
            "type": "string",
            "description": "Unique identifier for the starter ability granted by this background",
            "minLength": 1,
            "maxLength": 50
        },
        "starterAbilityName": {
            "type": "string",
            "description": "Display name for the starter ability",
            "minLength": 1,
            "maxLength": 100
        },
        "starterAbilityDescription": {
            "type": "string",
            "description": "Description of the starter ability's effect",
            "minLength": 1,
            "maxLength": 500
        },
        "startingItems": {
            "type": "array",
            "description": "Item IDs granted to characters with this background at creation",
            "items": {
                "type": "string",
                "minLength": 1
            },
            "uniqueItems": true
        },
        "isPlayable": {
            "type": "boolean",
            "description": "Whether this background can be selected during character creation",
            "default": true
        },
        "sortOrder": {
            "type": "integer",
            "description": "Display order in character creation UI (lower = earlier)",
            "minimum": 0,
            "default": 0
        }
    },
    "required": [
        "id",
        "name",
        "category",
        "description",
        "attributeBonuses",
        "starterAbilityId",
        "starterAbilityName",
        "starterAbilityDescription",
        "startingItems"
    ],
    "additionalProperties": false
}
```

### 4.3 AttributeBonuses Object

The `AttributeBonuses` object defines attribute bonuses for a background. Unlike race modifiers, all fields are **optional** and values are limited to **0-2** (bonuses only, no penalties).

```json
"AttributeBonuses": {
    "type": "object",
    "description": "Attribute bonuses provided by this background. All fields are optional; only specified attributes receive bonuses.",
    "properties": {
        "might": {
            "type": "integer",
            "description": "Physical power bonus affecting melee damage and carry capacity",
            "minimum": 0,
            "maximum": 2
        },
        "fortitude": {
            "type": "integer",
            "description": "Physical resilience bonus affecting health and resistances",
            "minimum": 0,
            "maximum": 2
        },
        "will": {
            "type": "integer",
            "description": "Mental fortitude bonus affecting magical resistance and focus",
            "minimum": 0,
            "maximum": 2
        },
        "wits": {
            "type": "integer",
            "description": "Mental acuity bonus affecting initiative and perception",
            "minimum": 0,
            "maximum": 2
        },
        "finesse": {
            "type": "integer",
            "description": "Dexterity bonus affecting accuracy and evasion",
            "minimum": 0,
            "maximum": 2
        }
    },
    "additionalProperties": false
}
```

---

## 5. Validation Rules

### 5.1 ID Pattern Validation

All identifier fields use kebab-case pattern validation to ensure consistency across configuration files.

| Field | Pattern | Valid Examples | Invalid Examples |
|-------|---------|----------------|------------------|
| `id` | `^[a-z][a-z0-9-]*$` | `soldier`, `mountain-born`, `city-folk` | `Soldier`, `mountain_born`, `123bg` |
| `startingItems[]` | (string, minLength: 1) | `iron_shield`, `ancient_tome`, `lockpicks` | `""` (empty string) |

**Note on starterAbilityId:** The existing `backgrounds.json` uses snake_case for `starterAbilityId` (e.g., `shield_bash`, `lore_recall`). The schema allows any non-empty string to maintain compatibility with existing data and potential cross-references to ability systems.

### 5.2 Attribute Bonus Range

Attribute bonuses are constrained to provide minor benefits without game balance issues:

| Constraint | Value | Rationale |
|------------|-------|-----------|
| Minimum | 0 | Backgrounds provide bonuses, not penalties |
| Maximum | +2 | Prevents overpowered background stacking |
| Optional | Yes | Backgrounds may not affect all attributes |

**Bonus Distribution Patterns:**

| Category | Pattern | Example |
|----------|---------|---------|
| Profession | Single attribute +2 | Soldier: might +2 |
| Lineage | Two attributes +1 each | Mountainborn: fortitude +1, might +1 |

**Validation Error Examples:**
```
Error: backgrounds[0].attributeBonuses.might must be >= 0
Error: backgrounds[1].attributeBonuses.finesse must be <= 2
```

### 5.3 Category Enum Validation

The `category` field accepts exactly two values:

| Value | Description | Bonus Pattern |
|-------|-------------|---------------|
| `Profession` | Trained occupation background | Typically single +2 |
| `Lineage` | Cultural/geographical origin | Typically two +1 bonuses |

**Validation Error Examples:**
```
Error: backgrounds[0].category must be one of: Profession, Lineage
Error: backgrounds[1].category "Occupation" is not a valid enum value
```

### 5.4 Required Fields

The following fields are required for each background definition:

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `id` | Must be present and non-empty | "missing required property 'id'" |
| `name` | Must be present with minLength 1 | "missing required property 'name'" |
| `category` | Must be present and valid enum | "missing required property 'category'" |
| `description` | Must be present with minLength 1 | "missing required property 'description'" |
| `attributeBonuses` | Must be present (may be empty object) | "missing required property 'attributeBonuses'" |
| `starterAbilityId` | Must be present | "missing required property 'starterAbilityId'" |
| `starterAbilityName` | Must be present | "missing required property 'starterAbilityName'" |
| `starterAbilityDescription` | Must be present | "missing required property 'starterAbilityDescription'" |
| `startingItems` | Must be present (may be empty array) | "missing required property 'startingItems'" |

**Optional Fields:**
- `lore` - Extended background story text
- `isPlayable` - Defaults to `true`
- `sortOrder` - Defaults to `0`

---

## 6. Configuration Schema

### Complete Schema File

**File:** `config/schemas/backgrounds.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Background Configuration",
    "description": "Schema for character background definitions. Backgrounds represent a character's history and provide attribute bonuses, starter abilities, and starting items.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Configuration file version for compatibility tracking",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "backgrounds": {
            "type": "array",
            "description": "List of background definitions",
            "items": {
                "$ref": "#/definitions/BackgroundDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["backgrounds"],
    "additionalProperties": false,
    "definitions": {
        "BackgroundDefinition": {
            "type": "object",
            "description": "A single background definition with category, bonuses, ability, and metadata",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the background (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name for the background shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "category": {
                    "type": "string",
                    "description": "Background category determining bonus distribution pattern",
                    "enum": ["Profession", "Lineage"]
                },
                "description": {
                    "type": "string",
                    "description": "Short description of the background for character creation",
                    "minLength": 1,
                    "maxLength": 500
                },
                "lore": {
                    "type": "string",
                    "description": "Extended lore and background story flavor text",
                    "maxLength": 2000
                },
                "attributeBonuses": {
                    "$ref": "#/definitions/AttributeBonuses",
                    "description": "Attribute bonuses provided by this background (0-2 per attribute)"
                },
                "starterAbilityId": {
                    "type": "string",
                    "description": "Unique identifier for the starter ability granted by this background",
                    "minLength": 1,
                    "maxLength": 50
                },
                "starterAbilityName": {
                    "type": "string",
                    "description": "Display name for the starter ability",
                    "minLength": 1,
                    "maxLength": 100
                },
                "starterAbilityDescription": {
                    "type": "string",
                    "description": "Description of the starter ability's effect",
                    "minLength": 1,
                    "maxLength": 500
                },
                "startingItems": {
                    "type": "array",
                    "description": "Item IDs granted to characters with this background at creation",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    },
                    "uniqueItems": true
                },
                "isPlayable": {
                    "type": "boolean",
                    "description": "Whether this background can be selected during character creation",
                    "default": true
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Display order in character creation UI (lower = earlier)",
                    "minimum": 0,
                    "default": 0
                }
            },
            "required": [
                "id",
                "name",
                "category",
                "description",
                "attributeBonuses",
                "starterAbilityId",
                "starterAbilityName",
                "starterAbilityDescription",
                "startingItems"
            ],
            "additionalProperties": false
        },
        "AttributeBonuses": {
            "type": "object",
            "description": "Attribute bonuses provided by this background. All fields are optional; only specified attributes receive bonuses.",
            "properties": {
                "might": {
                    "type": "integer",
                    "description": "Physical power bonus affecting melee damage and carry capacity",
                    "minimum": 0,
                    "maximum": 2
                },
                "fortitude": {
                    "type": "integer",
                    "description": "Physical resilience bonus affecting health and resistances",
                    "minimum": 0,
                    "maximum": 2
                },
                "will": {
                    "type": "integer",
                    "description": "Mental fortitude bonus affecting magical resistance and focus",
                    "minimum": 0,
                    "maximum": 2
                },
                "wits": {
                    "type": "integer",
                    "description": "Mental acuity bonus affecting initiative and perception",
                    "minimum": 0,
                    "maximum": 2
                },
                "finesse": {
                    "type": "integer",
                    "description": "Dexterity bonus affecting accuracy and evasion",
                    "minimum": 0,
                    "maximum": 2
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 7. Configuration File Updates

### Updated backgrounds.json

The existing `backgrounds.json` already references the schema. No content changes are required as all existing backgrounds validate against the new schema.

**File:** `config/backgrounds.json`

Current `$schema` reference:
```json
{
    "$schema": "./schemas/backgrounds.schema.json",
    "version": "1.0",
    "backgrounds": [...]
}
```

### Validation Confirmation

The existing eight backgrounds validate successfully:

| Background | Category | ID Pattern | Attribute Range | Required Fields |
|------------|----------|------------|-----------------|-----------------|
| Soldier | Profession | `soldier` ✓ | might: 2 ✓ | All present ✓ |
| Scholar | Profession | `scholar` ✓ | wits: 2 ✓ | All present ✓ |
| Thief | Profession | `thief` ✓ | finesse: 2 ✓ | All present ✓ |
| Healer | Profession | `healer` ✓ | will: 2 ✓ | All present ✓ |
| Mountainborn | Lineage | `mountainborn` ✓ | fortitude: 1, might: 1 ✓ | All present ✓ |
| Coastlander | Lineage | `coastlander` ✓ | finesse: 1, wits: 1 ✓ | All present ✓ |
| Forestkin | Lineage | `forestkin` ✓ | wits: 1, finesse: 1 ✓ | All present ✓ |
| Cityfolk | Lineage | `cityfolk` ✓ | will: 1, wits: 1 ✓ | All present ✓ |

---

## 8. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file for validation. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | Schema file added |

### Schema as Documentation

The schema serves as:
- **Validation contract** for configuration files
- **IDE documentation** via description fields
- **Modding reference** for custom background creation

---

## 9. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 10. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Category Enum Validation | ~1 |
| Attribute Bonus Range Validation | ~1 |
| Required Fields Validation | ~1 |
| Starter Ability Fields Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### BackgroundSchemaTests.cs

```csharp
[TestFixture]
public class BackgroundSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the existing backgrounds.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void ExistingBackgroundsJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies category must be a valid enum value (Profession or Lineage).
    /// </summary>
    [Test]
    public void Category_InvalidEnumValue_FailsValidation();

    /// <summary>
    /// Verifies attribute bonuses must be within 0 to 2 range.
    /// </summary>
    [Test]
    public void AttributeBonuses_OutOfRange_FailsValidation();

    /// <summary>
    /// Verifies all starter ability fields must be present together.
    /// </summary>
    [Test]
    public void StarterAbility_MissingFields_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 11. Use Cases

### UC-001: Load Background Configuration

**Actor:** Game System
**Flow:** System starts → Loads `backgrounds.json` → Schema validates content → Backgrounds available for character creation

### UC-002: Edit Background in IDE

**Actor:** Developer/Modder
**Flow:** Opens `backgrounds.json` in VS Code → IDE loads schema → Autocomplete suggests properties → Validation errors shown inline

### UC-003: Create Custom Background

**Actor:** Modder
**Flow:** Adds new background object to `backgrounds.json` → IDE validates against schema → Errors shown for missing fields → Modder corrects errors → Background validates successfully

### UC-004: Invalid Category Value

**Actor:** Modder
**Flow:** Sets `category: "Occupation"` in background definition → IDE shows error "must be one of: Profession, Lineage" → Modder corrects to valid category

### UC-005: Invalid Attribute Bonus

**Actor:** Modder
**Flow:** Sets `might: 3` in attributeBonuses → IDE shows error "must be <= 2" → Modder corrects to valid value (0-2 range)

---

## 12. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/backgrounds.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all defined properties
- [ ] Schema includes definitions section

### Validation Rules
- [ ] ID pattern validation: `^[a-z][a-z0-9-]*$`
- [ ] Category enum validation: Profession, Lineage
- [ ] Attribute bonus range: 0 to 2
- [ ] Required fields enforced
- [ ] Optional fields have defaults

### Configuration Updates
- [ ] Existing `backgrounds.json` validates against schema
- [ ] No changes required to background data

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 13. Acceptance Criteria

### Functional
- [ ] `backgrounds.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `backgrounds.json` without errors
- [ ] Category enum validated (Profession, Lineage)
- [ ] Attribute bonuses limited to 0-2 range
- [ ] Starting items validated as array of strings
- [ ] Starter ability fields all required together (id, name, description)
- [ ] ID pattern enforced (lowercase kebab-case)
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 14. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `backgrounds.json` | `config/backgrounds.json` | Validated by new schema |
| Schema patterns | `config/schemas/races.schema.json` | Reference for schema structure |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| Schema pattern | Future schemas will follow same Draft-07 structure |
| ID validation | Same `^[a-z][a-z0-9-]*$` pattern reused |
| Attribute names | Same attribute names (might, fortitude, will, wits, finesse) |
| Category enum | May be referenced for UI grouping logic |

---

## 15. Future Considerations

### Deferred to v0.14.2 (Cross-Reference Validation)

- **startingItems validation**: Cross-reference to items.json to verify item IDs exist
- **starterAbilityId validation**: Cross-reference to abilities.json to verify ability IDs exist

### Out of Scope

- **Runtime schema validation**: Application-level validation at load time (handled by existing provider patterns)
- **Schema versioning migration**: Automatic migration between schema versions
- **Skill proficiency grants**: Background skill bonuses (mentioned in scope overview but not in current backgrounds.json structure)
- **Starting gold ranges**: Background wealth variation (mentioned in scope overview but not in current backgrounds.json structure)
- **Background traits**: Separate trait definitions beyond starter ability (mentioned in scope overview but not in current backgrounds.json structure)

### Potential Future Enhancements

If the background system expands, consider adding:
- `skillProficiencies` - Array of skill IDs the background grants
- `startingGoldRange` - Object with min/max gold values
- `backgroundTraits` - Array of passive trait effects separate from starter ability

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
