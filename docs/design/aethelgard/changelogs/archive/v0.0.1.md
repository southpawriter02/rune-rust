> **Archived** - This changelog has been consolidated. See the complete version at [v0.0.1](../v0.0.x/v0.0.1.md).

# Changelog: v0.0.1 - The Foundation

**Release Date:** 2025-12-18

## Summary

Established the Clean Architecture foundation for Rune & Rust. This release creates the solution structure, enforces dependency rules, configures logging, sets up a comprehensive testing framework, and proves the DI container works with a "Hello World" from the Engine layer via the Terminal.

---

## Solution Scaffolding

### Projects Created

| Project | Type | Purpose |
|---------|------|---------|
| `RuneAndRust.Core` | Class Library | Pure Domain layer - entities, interfaces, no external dependencies |
| `RuneAndRust.Engine` | Class Library | Game Logic layer - services, systems, business rules |
| `RuneAndRust.Persistence` | Class Library | Data Access layer - EF Core, repositories |
| `RuneAndRust.Terminal` | Console App | Presentation layer - composition root, terminal UI |
| `RuneAndRust.Tests` | xUnit Test Project | Unit and integration tests for all layers |

### Dependency Graph

```
Terminal (Composition Root)
    ├── Core
    ├── Engine → Core
    └── Persistence → Core

Tests (Test Harness)
    ├── Core
    ├── Engine
    └── Persistence
```

**Dependency Rule Enforced:**
- Core has zero project references (clean domain)
- Engine depends only on Core
- Persistence depends only on Core
- Terminal references all projects (composition root pattern)
- Tests references Core, Engine, and Persistence for full coverage

---

## Packages Installed

### RuneAndRust.Terminal
| Package | Version | Purpose |
|---------|---------|---------|
| `Microsoft.Extensions.Hosting` | 10.0.1 | Generic host for DI container lifecycle |
| `Microsoft.Extensions.DependencyInjection` | 10.0.1 | Service registration |
| `Spectre.Console` | Latest | Rich terminal UI rendering |
| `Serilog` | Latest | Structured logging framework |
| `Serilog.Sinks.Console` | 6.1.1 | Console log output |
| `Serilog.Sinks.File` | 7.0.0 | Rolling file log output |
| `Serilog.Extensions.Hosting` | 10.0.0 | ILogger integration with Generic Host |

### RuneAndRust.Engine
| Package | Version | Purpose |
|---------|---------|---------|
| `Microsoft.Extensions.Logging.Abstractions` | 10.0.1 | ILogger<T> interface for DI |

### RuneAndRust.Persistence
| Package | Version | Purpose |
|---------|---------|---------|
| `Npgsql.EntityFrameworkCore.PostgreSQL` | 9.0.4 | PostgreSQL provider for EF Core |
| `Microsoft.EntityFrameworkCore.Design` | 9.0.6 | EF Core design-time tools (migrations) |

### RuneAndRust.Tests
| Package | Version | Purpose |
|---------|---------|---------|
| `xunit` | 2.9.3 | Modern test framework with Fact/Theory attributes |
| `xunit.runner.visualstudio` | 3.1.0 | Visual Studio / CLI test runner integration |
| `Microsoft.NET.Test.Sdk` | 17.14.0 | .NET test SDK for `dotnet test` |
| `FluentAssertions` | 8.8.0 | Readable, fluent assertion syntax |
| `Moq` | 4.20.72 | Mocking framework for dependency isolation |
| `coverlet.collector` | 6.0.4 | Code coverage collection |

---

## Code Implementation

### Core Layer

**File:** `RuneAndRust.Core/Interfaces/IGameService.cs`

Defines the contract for the main game service. This abstraction enables dependency inversion - the UI layer can call the Engine without knowing its implementation.

```csharp
public interface IGameService
{
    void Start();
}
```

### Engine Layer

**File:** `RuneAndRust.Engine/Services/GameService.cs`

Implements the game service with ILogger injection. Logging is a cross-cutting concern essential for tracking game flow and debugging complex systems.

```csharp
public class GameService : IGameService
{
    private readonly ILogger<GameService> _logger;

    public GameService(ILogger<GameService> logger)
    {
        _logger = logger;
    }

    public void Start()
    {
        _logger.LogInformation("Rune & Rust Engine Initialized.");
    }
}
```

### Terminal Layer

**File:** `RuneAndRust.Terminal/Program.cs`

Composition root that wires together:
1. **Serilog** - configured with Console and File sinks (rolling daily)
2. **Generic Host** - manages DI container and service lifecycles
3. **Spectre.Console** - rich terminal UI output
4. **DI Registration** - `IGameService` → `GameService` singleton

---

## Verification Results

### Build
```
Build succeeded in 1.1s
  RuneAndRust.Core succeeded
  RuneAndRust.Engine succeeded
  RuneAndRust.Persistence succeeded
  RuneAndRust.Terminal succeeded
  RuneAndRust.Tests succeeded
```

### Runtime Output
```
Rune & Rust v0.0.1 Booting...
[18:07:48 INF] Rune & Rust Engine Initialized.
```

### Log File
**Path:** `logs/runeandrust20251218.log`
```
2025-12-18 18:07:48.324 -07:00 [INF] Rune & Rust Engine Initialized.
```

### Test Results
```
[xUnit.net 00:00:00.00] xUnit.net VSTest Adapter v2.8.2+699d445a1a (64-bit .NET 9.0.10)
[xUnit.net 00:00:00.03]   Discovering: RuneAndRust.Tests
[xUnit.net 00:00:00.05]   Discovered:  RuneAndRust.Tests
[xUnit.net 00:00:00.05]   Starting:    RuneAndRust.Tests
[xUnit.net 00:00:00.11]   Finished:    RuneAndRust.Tests

Test summary: total: 2, failed: 0, succeeded: 2, skipped: 0, duration: 0.6s
```

### Dependency Rule Verification
- ✅ Core has no project references
- ✅ Engine references only Core (no Terminal, no Persistence)
- ✅ Persistence references only Core
- ✅ Terminal references all (valid as composition root)
- ✅ Tests references Core, Engine, Persistence (no Terminal)

---

## Testing Framework

### Test Project Structure

```
RuneAndRust.Tests/
├── RuneAndRust.Tests.csproj
├── Core/
│   └── PlaceholderTests.cs        # Ready for entity validation tests
├── Engine/
│   └── GameServiceTests.cs        # Service tests with mocking patterns
└── Persistence/
    └── PlaceholderTests.cs        # Ready for repository tests
```

### Test Patterns Established

#### Mocking with Moq
The `GameServiceTests` class demonstrates the standard pattern for testing services with injected dependencies:

```csharp
public class GameServiceTests
{
    private readonly Mock<ILogger<GameService>> _mockLogger;
    private readonly GameService _sut; // System Under Test

    public GameServiceTests()
    {
        _mockLogger = new Mock<ILogger<GameService>>();
        _sut = new GameService(_mockLogger.Object);
    }
}
```

#### Logger Verification Pattern
Testing that log messages are correctly emitted:

```csharp
[Fact]
public void Start_ShouldLogInitializationMessage()
{
    // Act
    _sut.Start();

    // Assert
    _mockLogger.Verify(
        x => x.Log(
            LogLevel.Information,
            It.IsAny<EventId>(),
            It.Is<It.IsAnyType>((v, t) => v.ToString()!.Contains("Rune & Rust Engine Initialized")),
            null,
            It.IsAny<Func<It.IsAnyType, Exception?, string>>()),
        Times.Once);
}
```

#### FluentAssertions Pattern
Using fluent syntax for readable assertions:

```csharp
[Fact]
public void Constructor_WithValidLogger_ShouldNotThrow()
{
    // Arrange & Act
    var action = () => new GameService(_mockLogger.Object);

    // Assert
    action.Should().NotThrow();
}
```

### Placeholder Tests

The `Core/PlaceholderTests.cs` and `Persistence/PlaceholderTests.cs` files are ready for future test implementation:

**Core Tests (Planned):**
- Character attribute validation
- Entity ID generation
- Value object equality
- Domain rule enforcement

**Persistence Tests (Planned):**
- SaveGame CRUD operations
- Character persistence
- In-memory database integration tests
- Repository pattern verification

### Running Tests

```bash
# Run all tests
dotnet test

# Run with verbose output
dotnet test --verbosity normal

# Run specific test class
dotnet test --filter "FullyQualifiedName~GameServiceTests"

# Run with code coverage
dotnet test --collect:"XPlat Code Coverage"
```

---

## Directory Structure

```
rune-rust/
├── RuneAndRust.sln
├── RuneAndRust.Core/
│   ├── RuneAndRust.Core.csproj
│   └── Interfaces/
│       └── IGameService.cs
├── RuneAndRust.Engine/
│   ├── RuneAndRust.Engine.csproj
│   └── Services/
│       └── GameService.cs
├── RuneAndRust.Persistence/
│   └── RuneAndRust.Persistence.csproj
├── RuneAndRust.Terminal/
│   ├── RuneAndRust.Terminal.csproj
│   └── Program.cs
├── RuneAndRust.Tests/
│   ├── RuneAndRust.Tests.csproj
│   ├── Core/
│   │   └── PlaceholderTests.cs
│   ├── Engine/
│   │   └── GameServiceTests.cs
│   └── Persistence/
│       └── PlaceholderTests.cs
├── logs/
│   └── runeandrust20251218.log
└── docs/
    └── changelogs/
        └── v0.0.1.md
```

---

## Commands Reference

### Solution Setup
```bash
# Create solution
dotnet new sln -n RuneAndRust

# Create projects
dotnet new classlib -n RuneAndRust.Core
dotnet new classlib -n RuneAndRust.Engine
dotnet new classlib -n RuneAndRust.Persistence
dotnet new console -n RuneAndRust.Terminal
dotnet new xunit -n RuneAndRust.Tests

# Add to solution
dotnet sln add RuneAndRust.Core
dotnet sln add RuneAndRust.Engine
dotnet sln add RuneAndRust.Persistence
dotnet sln add RuneAndRust.Terminal
dotnet sln add RuneAndRust.Tests

# Establish references
dotnet add RuneAndRust.Engine reference RuneAndRust.Core
dotnet add RuneAndRust.Persistence reference RuneAndRust.Core
dotnet add RuneAndRust.Terminal reference RuneAndRust.Core
dotnet add RuneAndRust.Terminal reference RuneAndRust.Engine
dotnet add RuneAndRust.Terminal reference RuneAndRust.Persistence
dotnet add RuneAndRust.Tests reference RuneAndRust.Core
dotnet add RuneAndRust.Tests reference RuneAndRust.Engine
dotnet add RuneAndRust.Tests reference RuneAndRust.Persistence
```

### Package Installation
```bash
# Terminal packages
dotnet add RuneAndRust.Terminal package Microsoft.Extensions.Hosting
dotnet add RuneAndRust.Terminal package Microsoft.Extensions.DependencyInjection
dotnet add RuneAndRust.Terminal package Spectre.Console
dotnet add RuneAndRust.Terminal package Serilog
dotnet add RuneAndRust.Terminal package Serilog.Sinks.Console
dotnet add RuneAndRust.Terminal package Serilog.Sinks.File
dotnet add RuneAndRust.Terminal package Serilog.Extensions.Hosting

# Engine packages
dotnet add RuneAndRust.Engine package Microsoft.Extensions.Logging.Abstractions

# Persistence packages
dotnet add RuneAndRust.Persistence package Npgsql.EntityFrameworkCore.PostgreSQL --version 9.0.4
dotnet add RuneAndRust.Persistence package Microsoft.EntityFrameworkCore.Design --version 9.0.6

# Test packages
dotnet add RuneAndRust.Tests package FluentAssertions
dotnet add RuneAndRust.Tests package Moq
```

### Build & Run
```bash
# Build solution
dotnet build

# Run terminal
dotnet run --project RuneAndRust.Terminal

# Run tests
dotnet test
```

---

## Next Steps

**v0.0.2: The Domain & Logic**
- Implement `DiceService` for dice rolling mechanics
- Create basic `Character` entity in Core
- Add comprehensive DiceService tests (distribution validation, modifiers, edge cases)
- Expand Engine services

