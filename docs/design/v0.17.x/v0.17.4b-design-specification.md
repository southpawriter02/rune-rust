# v0.17.4b Design Specification: Specialization & Special Resource Definitions

**Version:** 0.17.4b
**Theme:** Specialization Definition Entity & Special Resource Structures
**Author:** Claude
**Created:** 2026-01-27
**Status:** Draft
**Prerequisites:** v0.17.4a Complete (Specialization Enums)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [SpecialResourceDefinition Value Object](#4-specialresourcedefinition-value-object)
5. [SpecializationDefinition Entity](#5-specializationdefinition-entity)
6. [Configuration](#6-configuration)
7. [Commands](#7-commands)
8. [User-Facing Changes](#8-user-facing-changes)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Future Considerations](#14-future-considerations)
15. [Implementation Notes](#15-implementation-notes)
16. [Document Metadata](#16-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.17.4b, the Specialization & Special Resource Definitions phase. This phase creates the core entity structures that represent specializations and their unique resource systems.

Key components:

1. **SpecialResourceDefinition Value Object**: Defines unique resources tied to specific specializations (e.g., Rage for Berserkr, Block Charges for Skjaldmaer, Aether Resonance for Seidkona).

2. **SpecializationDefinition Entity**: The primary data-driven definition for each specialization, containing display information, path type, parent archetype reference, unlock costs, and optional special resource.

This infrastructure builds upon v0.17.4a's enums and enables subsequent ability tier definitions (v0.17.4c) and provider services (v0.17.4d).

### 1.2 Current vs. Target Implementation

| Aspect                  | Current Implementation | Target Implementation                                 |
| ----------------------- | ---------------------- | ----------------------------------------------------- |
| **Specialization Data** | Enums only (v0.17.4a)  | Full `SpecializationDefinition` entity                |
| **Special Resources**   | Not implemented        | `SpecialResourceDefinition` value object              |
| **Display Info**        | Extension method only  | Entity properties (DisplayName, Tagline, Description) |
| **Unlock Cost**         | Not implemented        | PP cost tracked in definition                         |
| **Selection Text**      | Not implemented        | Character creation selection text                     |

### 1.3 Scope

**In Scope:**

- Define `SpecialResourceDefinition` value object with min/max/regen properties
- Define `SpecializationDefinition` entity with all display and mechanical properties
- Configuration file structure for specialization definitions
- Unit tests for entity creation and validation (~3 tests)

**Out of Scope:**

- Ability tiers - v0.17.4c
- Provider service - v0.17.4d
- Application service - v0.17.4e

### 1.4 Key Deliverables

| Type          | Count | Details                                          |
| ------------- | ----- | ------------------------------------------------ |
| Value Objects | 1     | `SpecialResourceDefinition`                      |
| Entities      | 1     | `SpecializationDefinition`                       |
| Configuration | 1     | Enhanced `specializations.json` with definitions |
| Unit Tests    | ~3    | Entity creation, validation, special resource    |

---

## 2. Dependencies

### 2.1 Required from v0.17.4a

| Component                    | Location                                          | Usage in v0.17.4b                 |
| ---------------------------- | ------------------------------------------------- | --------------------------------- |
| `SpecializationId`           | `Domain/Enums/SpecializationId.cs`                | Primary identifier for definition |
| `SpecializationPathType`     | `Domain/Enums/SpecializationPathType.cs`          | Path classification property      |
| `SpecializationIdExtensions` | `Domain/Extensions/SpecializationIdExtensions.cs` | Parent archetype resolution       |

### 2.2 Required from v0.17.3 (Archetype System)

| Component             | Location                                 | Usage in v0.17.4b                  |
| --------------------- | ---------------------------------------- | ---------------------------------- |
| `Archetype`           | `Domain/Enums/Archetype.cs`              | Parent archetype reference         |
| `ArchetypeDefinition` | `Domain/Entities/ArchetypeDefinition.cs` | Links to available specializations |

### 2.3 Provides to Future Versions

| Version  | Component                   | Usage                                |
| -------- | --------------------------- | ------------------------------------ |
| v0.17.4c | `SpecializationDefinition`  | Parent entity for ability tiers      |
| v0.17.4c | `SpecialResourceDefinition` | Ability cost references              |
| v0.17.4d | `SpecializationDefinition`  | Provider returns these entities      |
| v0.17.4e | `SpecializationDefinition`  | Application service uses for preview |
| v0.17.5  | All                         | Character creation workflow display  |

---

## 3. Architecture Diagrams

### 3.1 Entity Relationship Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      ENTITY RELATIONSHIPS                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    SpecializationDefinition                           │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  + Id: Guid                          (IEntity.Id)                    │   │
│  │  + SpecializationId: SpecializationId (enum identifier)              │   │
│  │  + DisplayName: string               ("Berserkr")                    │   │
│  │  + Tagline: string                   ("Fury Unleashed")              │   │
│  │  + Description: string               (full lore text)                │   │
│  │  + SelectionText: string             (character creation prompt)     │   │
│  │  + ParentArchetype: Archetype        (Warrior, Skirmisher, etc.)     │   │
│  │  + PathType: SpecializationPathType  (Coherent/Heretical)            │   │
│  │  + UnlockCost: int                   (PP cost, 0 for first spec)     │   │
│  │  + SpecialResource: SpecialResourceDefinition?  (optional)           │   │
│  │  + AbilityTiers: IReadOnlyList<SpecializationAbilityTier>  (v0.17.4c)│   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                          │                                                   │
│                          │ 0..1                                              │
│                          ▼                                                   │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                    SpecialResourceDefinition                          │   │
│  ├──────────────────────────────────────────────────────────────────────┤   │
│  │  + ResourceId: string                ("rage", "block-charges")       │   │
│  │  + DisplayName: string               ("Rage", "Block Charges")       │   │
│  │  + MinValue: int                     (0)                             │   │
│  │  + MaxValue: int                     (100, 3, 10, etc.)              │   │
│  │  + StartsAt: int                     (initial value)                 │   │
│  │  + RegenPerTurn: int                 (passive regen amount)          │   │
│  │  + DecayPerTurn: int                 (passive decay amount)          │   │
│  │  + Description: string               (flavor text)                   │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Definition Loading Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      DEFINITION LOADING FLOW                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  specializations.json                                                       │
│         │                                                                    │
│         ▼                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │              JSON DESERIALIZATION                                    │    │
│  │                                                                      │    │
│  │  {                                                                   │    │
│  │    "specializationId": "Berserkr",                                   │    │
│  │    "displayName": "Berserkr",                                        │    │
│  │    "tagline": "Fury Unleashed",                                      │    │
│  │    "pathType": "Heretical",                                          │    │
│  │    "specialResource": { ... }                                        │    │
│  │  }                                                                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│         │                                                                    │
│         ▼                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │              ENTITY FACTORY                                          │    │
│  │                                                                      │    │
│  │  SpecializationDefinition.Create(                                    │    │
│  │      specializationId: SpecializationId.Berserkr,                    │    │
│  │      displayName: "Berserkr",                                        │    │
│  │      tagline: "Fury Unleashed",                                      │    │
│  │      ...                                                             │    │
│  │  );                                                                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│         │                                                                    │
│         ▼                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │              VALIDATION                                              │    │
│  │                                                                      │    │
│  │  ✓ DisplayName not null/empty                                        │    │
│  │  ✓ UnlockCost >= 0                                                   │    │
│  │  ✓ SpecialResource validated if present                              │    │
│  │  ✓ PathType matches SpecializationId.GetPathType()                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│         │                                                                    │
│         ▼                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │              IMMUTABLE ENTITY                                        │    │
│  │                                                                      │    │
│  │  SpecializationDefinition instance ready for use                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Entities/                                                          │    │
│  │  └── SpecializationDefinition.cs     ←── NEW                        │    │
│  │                                                                      │    │
│  │  ValueObjects/                                                      │    │
│  │  └── SpecialResourceDefinition.cs    ←── NEW                        │    │
│  │                                                                      │    │
│  │  Enums/ (from v0.17.4a)                                             │    │
│  │  ├── SpecializationId.cs                                            │    │
│  │  └── SpecializationPathType.cs                                      │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  INFRASTRUCTURE LAYER                                │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Configuration/                                                     │    │
│  │  └── specializations.json            ←── ENHANCED (definitions)     │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. SpecialResourceDefinition Value Object

### 4.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SpecialResourceDefinition.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines a special resource unique to a specialization.
/// </summary>
/// <remarks>
/// <para>
/// Special resources provide unique gameplay mechanics for certain specializations.
/// Unlike standard resources (Health, Stamina), these are tied to specific
/// specialization abilities and mechanics.
/// </para>
/// <para>
/// Examples:
/// <list type="bullet">
/// <item><description>Berserkr: Rage (0-100) - builds during combat, decays between combats</description></item>
/// <item><description>Skjaldmaer: Block Charges (0-3) - regenerates per turn</description></item>
/// <item><description>Seidkona: Aether Resonance (0-10) - builds when casting, enables resonance combos</description></item>
/// </list>
/// </para>
/// </remarks>
public readonly record struct SpecialResourceDefinition
{
    /// <summary>
    /// Gets the unique identifier for this resource type.
    /// </summary>
    /// <remarks>
    /// Uses kebab-case format (e.g., "rage", "block-charges", "aether-resonance").
    /// </remarks>
    public string ResourceId { get; init; }

    /// <summary>
    /// Gets the display name shown in UI.
    /// </summary>
    /// <example>"Rage", "Block Charges", "Aether Resonance"</example>
    public string DisplayName { get; init; }

    /// <summary>
    /// Gets the minimum value for this resource.
    /// </summary>
    /// <remarks>Typically 0, but could be negative for debt-based resources.</remarks>
    public int MinValue { get; init; }

    /// <summary>
    /// Gets the maximum value for this resource.
    /// </summary>
    /// <remarks>
    /// Examples:
    /// <list type="bullet">
    /// <item><description>Rage: 100</description></item>
    /// <item><description>Block Charges: 3</description></item>
    /// <item><description>Aether Resonance: 10</description></item>
    /// </list>
    /// </remarks>
    public int MaxValue { get; init; }

    /// <summary>
    /// Gets the starting value when combat begins.
    /// </summary>
    /// <remarks>
    /// Some resources start empty (Rage starts at 0, builds during combat).
    /// Others start full (Block Charges start at max).
    /// </remarks>
    public int StartsAt { get; init; }

    /// <summary>
    /// Gets the amount regenerated per turn (passive).
    /// </summary>
    /// <remarks>0 means no passive regeneration.</remarks>
    public int RegenPerTurn { get; init; }

    /// <summary>
    /// Gets the amount that decays per turn (passive).
    /// </summary>
    /// <remarks>0 means no passive decay. Used for resources like Rage.</remarks>
    public int DecayPerTurn { get; init; }

    /// <summary>
    /// Gets the flavor description for this resource.
    /// </summary>
    public string Description { get; init; }

    /// <summary>
    /// Represents a specialization with no special resource.
    /// </summary>
    public static SpecialResourceDefinition None => new()
    {
        ResourceId = string.Empty,
        DisplayName = string.Empty,
        MinValue = 0,
        MaxValue = 0,
        StartsAt = 0,
        RegenPerTurn = 0,
        DecayPerTurn = 0,
        Description = string.Empty
    };

    /// <summary>
    /// Gets whether this represents a valid special resource.
    /// </summary>
    public bool HasResource => !string.IsNullOrEmpty(ResourceId);

    /// <summary>
    /// Creates a new special resource definition with validation.
    /// </summary>
    /// <param name="resourceId">Unique identifier (kebab-case).</param>
    /// <param name="displayName">UI display name.</param>
    /// <param name="minValue">Minimum value.</param>
    /// <param name="maxValue">Maximum value.</param>
    /// <param name="startsAt">Initial value at combat start.</param>
    /// <param name="regenPerTurn">Passive regeneration per turn.</param>
    /// <param name="decayPerTurn">Passive decay per turn.</param>
    /// <param name="description">Flavor description.</param>
    /// <returns>A validated <see cref="SpecialResourceDefinition"/>.</returns>
    /// <exception cref="ArgumentException">Thrown when validation fails.</exception>
    public static SpecialResourceDefinition Create(
        string resourceId,
        string displayName,
        int minValue,
        int maxValue,
        int startsAt,
        int regenPerTurn,
        int decayPerTurn,
        string description)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(resourceId);
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
        ArgumentOutOfRangeException.ThrowIfGreaterThan(minValue, maxValue);
        ArgumentOutOfRangeException.ThrowIfLessThan(startsAt, minValue);
        ArgumentOutOfRangeException.ThrowIfGreaterThan(startsAt, maxValue);
        ArgumentOutOfRangeException.ThrowIfNegative(regenPerTurn);
        ArgumentOutOfRangeException.ThrowIfNegative(decayPerTurn);

        return new SpecialResourceDefinition
        {
            ResourceId = resourceId.ToLowerInvariant(),
            DisplayName = displayName,
            MinValue = minValue,
            MaxValue = maxValue,
            StartsAt = startsAt,
            RegenPerTurn = regenPerTurn,
            DecayPerTurn = decayPerTurn,
            Description = description ?? string.Empty
        };
    }

    /// <inheritdoc />
    public override string ToString()
    {
        return HasResource
            ? $"{DisplayName} ({MinValue}-{MaxValue})"
            : "None";
    }
}
```

### 4.2 Special Resource Examples

| Specialization | Resource ID        | Display Name     | Range | Starts | Regen  | Decay  |
| -------------- | ------------------ | ---------------- | ----- | ------ | ------ | ------ |
| Berserkr       | `rage`             | Rage             | 0-100 | 0      | 0      | 5/turn |
| Skjaldmaer     | `block-charges`    | Block Charges    | 0-3   | 3      | 1/turn | 0      |
| IronBane       | `righteous-fervor` | Righteous Fervor | 0-50  | 0      | 0      | 0      |
| Seidkona       | `aether-resonance` | Aether Resonance | 0-10  | 0      | 0      | 1/turn |
| EchoCaller     | `echoes`           | Echoes           | 0-5   | 0      | 0      | 0      |

---

## 5. SpecializationDefinition Entity

### 5.1 Entity Definition

**File:** `src/Core/RuneAndRust.Domain/Entities/SpecializationDefinition.cs`

```csharp
namespace RuneAndRust.Domain.Entities;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.Interfaces;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a data-driven specialization definition loaded from configuration.
/// </summary>
/// <remarks>
/// <para>
/// SpecializationDefinition is immutable after creation and represents the template
/// for a character specialization. Each specialization belongs to a single parent
/// archetype and may have unique mechanics via SpecialResourceDefinition.
/// </para>
/// <para>
/// Specializations are classified as either Coherent (stable reality) or Heretical
/// (corrupted Aether). Heretical specializations risk Corruption gain when using
/// certain abilities.
/// </para>
/// <para>
/// The first specialization is free during character creation; additional
/// specializations cost 3 Progression Points.
/// </para>
/// </remarks>
public class SpecializationDefinition : IEntity
{
    /// <summary>
    /// Gets the unique database identifier.
    /// </summary>
    public Guid Id { get; private set; }

    /// <summary>
    /// Gets the enum identifier for this specialization.
    /// </summary>
    /// <remarks>
    /// This maps directly to <see cref="SpecializationId"/> enum values.
    /// </remarks>
    public SpecializationId SpecializationId { get; private set; }

    /// <summary>
    /// Gets the display name shown in UI.
    /// </summary>
    /// <example>"Berserkr", "Skjaldmaer", "Seiðkona"</example>
    public string DisplayName { get; private set; }

    /// <summary>
    /// Gets the short tagline summarizing the specialization.
    /// </summary>
    /// <example>"Fury Unleashed", "The Living Shield", "Weaver of Aether"</example>
    public string Tagline { get; private set; }

    /// <summary>
    /// Gets the full lore description.
    /// </summary>
    public string Description { get; private set; }

    /// <summary>
    /// Gets the text displayed during character creation selection.
    /// </summary>
    /// <remarks>
    /// This is a shorter, more actionable description used when the player
    /// is choosing their specialization.
    /// </remarks>
    public string SelectionText { get; private set; }

    /// <summary>
    /// Gets the parent archetype for this specialization.
    /// </summary>
    /// <remarks>
    /// A character must have the parent archetype to select this specialization.
    /// </remarks>
    public Archetype ParentArchetype { get; private set; }

    /// <summary>
    /// Gets the path type classification.
    /// </summary>
    /// <remarks>
    /// <para>Coherent: Works within stable reality, no Corruption risk.</para>
    /// <para>Heretical: Interfaces with corrupted Aether, abilities may trigger Corruption.</para>
    /// </remarks>
    public SpecializationPathType PathType { get; private set; }

    /// <summary>
    /// Gets the Progression Point cost to unlock this specialization.
    /// </summary>
    /// <remarks>
    /// First specialization during character creation is free (cost 0).
    /// Additional specializations cost 3 PP.
    /// </remarks>
    public int UnlockCost { get; private set; }

    /// <summary>
    /// Gets the optional special resource for this specialization.
    /// </summary>
    /// <remarks>
    /// Not all specializations have special resources. Check
    /// <see cref="SpecialResourceDefinition.HasResource"/> before using.
    /// </remarks>
    public SpecialResourceDefinition SpecialResource { get; private set; }

    /// <summary>
    /// Gets whether this specialization has a special resource.
    /// </summary>
    public bool HasSpecialResource => SpecialResource.HasResource;

    /// <summary>
    /// Gets whether this specialization is Heretical (risks Corruption).
    /// </summary>
    public bool IsHeretical => PathType == SpecializationPathType.Heretical;

    /// <summary>
    /// Private constructor for EF Core.
    /// </summary>
    private SpecializationDefinition()
    {
        DisplayName = null!;
        Tagline = null!;
        Description = null!;
        SelectionText = null!;
    }

    /// <summary>
    /// Creates a new specialization definition with validation.
    /// </summary>
    /// <param name="specializationId">The enum identifier.</param>
    /// <param name="displayName">UI display name.</param>
    /// <param name="tagline">Short summary tagline.</param>
    /// <param name="description">Full lore description.</param>
    /// <param name="selectionText">Character creation selection text.</param>
    /// <param name="parentArchetype">Parent archetype requirement.</param>
    /// <param name="pathType">Coherent or Heretical classification.</param>
    /// <param name="unlockCost">PP cost to unlock (0 for first spec).</param>
    /// <param name="specialResource">Optional special resource definition.</param>
    /// <returns>A validated <see cref="SpecializationDefinition"/>.</returns>
    /// <exception cref="ArgumentException">Thrown when validation fails.</exception>
    public static SpecializationDefinition Create(
        SpecializationId specializationId,
        string displayName,
        string tagline,
        string description,
        string selectionText,
        Archetype parentArchetype,
        SpecializationPathType pathType,
        int unlockCost,
        SpecialResourceDefinition? specialResource = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
        ArgumentException.ThrowIfNullOrWhiteSpace(tagline);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);
        ArgumentException.ThrowIfNullOrWhiteSpace(selectionText);
        ArgumentOutOfRangeException.ThrowIfNegative(unlockCost);

        // Validate path type matches the specialization's inherent path
        var expectedPathType = specializationId.GetPathType();
        if (pathType != expectedPathType)
        {
            throw new ArgumentException(
                $"PathType mismatch: {specializationId} is {expectedPathType}, not {pathType}",
                nameof(pathType));
        }

        // Validate parent archetype matches
        var expectedArchetype = specializationId.GetParentArchetype();
        if (parentArchetype != expectedArchetype)
        {
            throw new ArgumentException(
                $"ParentArchetype mismatch: {specializationId} belongs to {expectedArchetype}, not {parentArchetype}",
                nameof(parentArchetype));
        }

        return new SpecializationDefinition
        {
            Id = Guid.NewGuid(),
            SpecializationId = specializationId,
            DisplayName = displayName,
            Tagline = tagline,
            Description = description,
            SelectionText = selectionText,
            ParentArchetype = parentArchetype,
            PathType = pathType,
            UnlockCost = unlockCost,
            SpecialResource = specialResource ?? SpecialResourceDefinition.None
        };
    }

    /// <summary>
    /// Gets the Corruption warning for character creation UI.
    /// </summary>
    /// <returns>Warning text if Heretical, otherwise null.</returns>
    public string? GetCorruptionWarning()
    {
        return PathType.GetCreationWarning();
    }

    /// <inheritdoc />
    public override string ToString()
    {
        return $"{DisplayName} ({ParentArchetype}, {PathType})";
    }
}
```

---

## 6. Configuration

### 6.1 Enhanced Specializations JSON Structure

**File:** `config/specializations.json`

```json
{
    "$schema": "./schemas/specializations.schema.json",
    "definitions": [
        {
            "specializationId": "Berserkr",
            "displayName": "Berserkr",
            "tagline": "Fury Unleashed",
            "description": "The Berserkr channels primal rage into devastating combat prowess. As fury builds, attacks become more powerful but control slips away. Those who walk this path risk losing themselves to the beast within.",
            "selectionText": "Embrace the fury. Let rage fuel your strikes and shatter your enemies.",
            "parentArchetype": "Warrior",
            "pathType": "Heretical",
            "unlockCost": 0,
            "specialResource": {
                "resourceId": "rage",
                "displayName": "Rage",
                "minValue": 0,
                "maxValue": 100,
                "startsAt": 0,
                "regenPerTurn": 0,
                "decayPerTurn": 5,
                "description": "Fury that builds with each strike and received blow"
            }
        },
        {
            "specializationId": "Skjaldmaer",
            "displayName": "Skjaldmaer",
            "tagline": "The Living Shield",
            "description": "The Skjaldmaer stands as an immovable bulwark between allies and harm. Through disciplined defense and protective techniques, they turn attacks aside and shelter those under their protection.",
            "selectionText": "Be the shield that never breaks. Protect those who cannot protect themselves.",
            "parentArchetype": "Warrior",
            "pathType": "Coherent",
            "unlockCost": 0,
            "specialResource": {
                "resourceId": "block-charges",
                "displayName": "Block Charges",
                "minValue": 0,
                "maxValue": 3,
                "startsAt": 3,
                "regenPerTurn": 1,
                "decayPerTurn": 0,
                "description": "Stored defensive reactions ready to deflect incoming attacks"
            }
        },
        {
            "specializationId": "IronBane",
            "displayName": "Iron-Bane",
            "tagline": "Hunter of Monsters",
            "description": "The Iron-Bane dedicates their life to hunting the Blighted and other abominations. Through study of their prey and righteous determination, they become living weapons against corruption.",
            "selectionText": "Hunt the hunters. Become the predator that monsters fear.",
            "parentArchetype": "Warrior",
            "pathType": "Coherent",
            "unlockCost": 0,
            "specialResource": {
                "resourceId": "righteous-fervor",
                "displayName": "Righteous Fervor",
                "minValue": 0,
                "maxValue": 50,
                "startsAt": 0,
                "regenPerTurn": 0,
                "decayPerTurn": 0,
                "description": "Zealous conviction that grows when facing abominations"
            }
        },
        {
            "specializationId": "SkarHorde",
            "displayName": "Skar-Horde",
            "tagline": "Voice of the Warband",
            "description": "The Skar-Horde leads through example and battlefield command. Their presence inspires allies to greater feats while coordinating devastating group tactics.",
            "selectionText": "Lead from the front. Your voice rallies the fallen and breaks enemy lines.",
            "parentArchetype": "Warrior",
            "pathType": "Coherent",
            "unlockCost": 0,
            "specialResource": null
        },
        {
            "specializationId": "AtgeirWielder",
            "displayName": "Atgeir-Wielder",
            "tagline": "Master of Reach",
            "description": "The Atgeir-Wielder turns the long-hafted spear into an extension of their will. Through disciplined technique, they control the battlefield, keeping enemies at bay while striking with precision.",
            "selectionText": "Keep them at bay. Your reach is your advantage; let none close the distance.",
            "parentArchetype": "Warrior",
            "pathType": "Coherent",
            "unlockCost": 0,
            "specialResource": null
        },
        {
            "specializationId": "GorgeMaw",
            "displayName": "Gorge-Maw",
            "tagline": "The Consuming Hunger",
            "description": "The Gorge-Maw has learned to draw power from defeated foes in ways that blur the line between survival and corruption. Each enemy consumed feeds an endless hunger that grants terrible strength.",
            "selectionText": "Consume to survive. Every enemy is fuel for your terrible hunger.",
            "parentArchetype": "Warrior",
            "pathType": "Heretical",
            "unlockCost": 0,
            "specialResource": null
        },
        {
            "specializationId": "Seidkona",
            "displayName": "Seiðkona",
            "tagline": "Weaver of Aether",
            "description": "The Seiðkona walks the boundary between worlds, shaping raw Aether into manifestations of will. Each spell risks drawing attention from forces beyond, yet the power to reshape reality proves irresistible.",
            "selectionText": "Weave the Aether. Reality bends to your will, but the void watches.",
            "parentArchetype": "Mystic",
            "pathType": "Heretical",
            "unlockCost": 0,
            "specialResource": {
                "resourceId": "aether-resonance",
                "displayName": "Aether Resonance",
                "minValue": 0,
                "maxValue": 10,
                "startsAt": 0,
                "regenPerTurn": 0,
                "decayPerTurn": 1,
                "description": "Harmonic attunement to the Aether that enables spell combinations"
            }
        },
        {
            "specializationId": "EchoCaller",
            "displayName": "Echo-Caller",
            "tagline": "Voice of the Dead",
            "description": "The Echo-Caller communes with those who have passed, drawing knowledge and power from the realm of the dead. Each conversation risks attracting unwanted attention from darker entities.",
            "selectionText": "Hear the whispers. The dead have much to say to those who listen.",
            "parentArchetype": "Mystic",
            "pathType": "Heretical",
            "unlockCost": 0,
            "specialResource": {
                "resourceId": "echoes",
                "displayName": "Echoes",
                "minValue": 0,
                "maxValue": 5,
                "startsAt": 0,
                "regenPerTurn": 0,
                "decayPerTurn": 0,
                "description": "Lingering connections to departed spirits"
            }
        }
    ]
}
```

### 6.2 Configuration Notes

- **17 total definitions** required (matching `SpecializationId` enum count)
- **specialResource** is `null` for specializations without unique mechanics
- **unlockCost** is `0` for first specialization choice, then `3` for additional
- Remaining 9 definitions (Veidimadr, MyrkGengr, Strandhogg, HlekkrMaster, BoneSetter, JotunReader, Skald, ScrapTinker, Einbui) follow same pattern

---

## 7. Commands

No new commands introduced in v0.17.4b. Entity definitions are internal to the system.

---

## 8. User-Facing Changes

### 8.1 No Direct UI Changes

v0.17.4b introduces foundational entities consumed by future UI components in v0.17.4e and v0.17.5.

### 8.2 Future UI Integration Points

The entities defined here will enable:

- Specialization detail display (v0.17.5)
- Special resource bar rendering (v0.17.5)
- Selection text during character creation (v0.17.5)

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component                          | Level   | Events                                               |
| ---------------------------------- | ------- | ---------------------------------------------------- |
| `SpecializationDefinition.Create`  | Debug   | Entity creation with specialization ID               |
| `SpecializationDefinition.Create`  | Warning | Validation failure (path type or archetype mismatch) |
| `SpecialResourceDefinition.Create` | Debug   | Resource definition creation                         |

### 9.2 Log Message Templates

```csharp
// Debug: Entity creation
_logger.LogDebug(
    "Created SpecializationDefinition for {SpecializationId} ({PathType})",
    definition.SpecializationId,
    definition.PathType);

// Debug: Special resource
_logger.LogDebug(
    "SpecialResource for {SpecializationId}: {ResourceId} ({MinValue}-{MaxValue})",
    definition.SpecializationId,
    definition.SpecialResource.ResourceId,
    definition.SpecialResource.MinValue,
    definition.SpecialResource.MaxValue);

// Warning: Validation failure
_logger.LogWarning(
    "PathType mismatch for {SpecializationId}: expected {Expected}, got {Actual}",
    specializationId,
    expectedPathType,
    pathType);
```

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature                             | Test Count |
| ----------------------------------- | ---------- |
| SpecialResourceDefinition           | 1          |
| SpecializationDefinition creation   | 1          |
| SpecializationDefinition validation | 1          |
| **Total**                           | **~3**     |

### 10.2 Test Specifications

**File:** `tests/RuneAndRust.Domain.UnitTests/Entities/SpecializationDefinitionTests.cs`

```csharp
[TestFixture]
public class SpecializationDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_CreatesDefinition()
    {
        // Arrange
        var specialResource = SpecialResourceDefinition.Create(
            resourceId: "rage",
            displayName: "Rage",
            minValue: 0,
            maxValue: 100,
            startsAt: 0,
            regenPerTurn: 0,
            decayPerTurn: 5,
            description: "Test rage");

        // Act
        var definition = SpecializationDefinition.Create(
            specializationId: SpecializationId.Berserkr,
            displayName: "Berserkr",
            tagline: "Fury Unleashed",
            description: "Test description",
            selectionText: "Test selection",
            parentArchetype: Archetype.Warrior,
            pathType: SpecializationPathType.Heretical,
            unlockCost: 0,
            specialResource: specialResource);

        // Assert
        definition.SpecializationId.Should().Be(SpecializationId.Berserkr);
        definition.DisplayName.Should().Be("Berserkr");
        definition.PathType.Should().Be(SpecializationPathType.Heretical);
        definition.ParentArchetype.Should().Be(Archetype.Warrior);
        definition.HasSpecialResource.Should().BeTrue();
        definition.SpecialResource.MaxValue.Should().Be(100);
    }

    [Test]
    public void Create_WithMismatchedPathType_ThrowsArgumentException()
    {
        // Arrange & Act
        var act = () => SpecializationDefinition.Create(
            specializationId: SpecializationId.Berserkr, // Heretical
            displayName: "Berserkr",
            tagline: "Fury Unleashed",
            description: "Test description",
            selectionText: "Test selection",
            parentArchetype: Archetype.Warrior,
            pathType: SpecializationPathType.Coherent, // Wrong!
            unlockCost: 0);

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*PathType mismatch*");
    }

    [Test]
    public void Create_WithMismatchedArchetype_ThrowsArgumentException()
    {
        // Arrange & Act
        var act = () => SpecializationDefinition.Create(
            specializationId: SpecializationId.Berserkr, // Warrior
            displayName: "Berserkr",
            tagline: "Fury Unleashed",
            description: "Test description",
            selectionText: "Test selection",
            parentArchetype: Archetype.Mystic, // Wrong!
            pathType: SpecializationPathType.Heretical,
            unlockCost: 0);

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*ParentArchetype mismatch*");
    }
}
```

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/SpecialResourceDefinitionTests.cs`

```csharp
[TestFixture]
public class SpecialResourceDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_CreatesResource()
    {
        // Arrange & Act
        var resource = SpecialResourceDefinition.Create(
            resourceId: "block-charges",
            displayName: "Block Charges",
            minValue: 0,
            maxValue: 3,
            startsAt: 3,
            regenPerTurn: 1,
            decayPerTurn: 0,
            description: "Defensive charges");

        // Assert
        resource.ResourceId.Should().Be("block-charges");
        resource.DisplayName.Should().Be("Block Charges");
        resource.MinValue.Should().Be(0);
        resource.MaxValue.Should().Be(3);
        resource.StartsAt.Should().Be(3);
        resource.RegenPerTurn.Should().Be(1);
        resource.DecayPerTurn.Should().Be(0);
        resource.HasResource.Should().BeTrue();
    }

    [Test]
    public void None_ReturnsEmptyResource()
    {
        // Arrange & Act
        var none = SpecialResourceDefinition.None;

        // Assert
        none.HasResource.Should().BeFalse();
        none.ResourceId.Should().BeEmpty();
    }

    [Test]
    public void Create_WithInvalidRange_ThrowsArgumentOutOfRangeException()
    {
        // Arrange & Act
        var act = () => SpecialResourceDefinition.Create(
            resourceId: "test",
            displayName: "Test",
            minValue: 10,
            maxValue: 5, // Invalid: min > max
            startsAt: 7,
            regenPerTurn: 0,
            decayPerTurn: 0,
            description: "Test");

        // Assert
        act.Should().Throw<ArgumentOutOfRangeException>();
    }
}
```

---

## 11. Use Cases

### UC-001: Create Specialization Definition

**Actor:** Configuration Loader
**Precondition:** Configuration file loaded
**Flow:**

1. Loader reads specialization JSON entry
2. Loader calls `SpecialResourceDefinition.Create()` if resource present
3. Loader calls `SpecializationDefinition.Create()` with all properties
4. Factory validates path type matches enum inherent value
5. Factory validates parent archetype matches enum inherent value
6. Factory returns immutable entity

**Postcondition:** Valid `SpecializationDefinition` instance created

### UC-002: Check for Special Resource

**Actor:** Combat System
**Precondition:** Player has selected specialization
**Flow:**

1. System retrieves player's `SpecializationDefinition`
2. System checks `definition.HasSpecialResource`
3. If true, system initializes resource tracker with `StartsAt` value
4. System applies `RegenPerTurn` / `DecayPerTurn` each turn

**Postcondition:** Special resource tracked correctly during combat

---

## 12. Deliverable Checklist

### Value Objects

- [ ] `SpecialResourceDefinition.cs` with all properties and factory method
- [ ] `SpecialResourceDefinition.None` static property
- [ ] `HasResource` computed property

### Entities

- [ ] `SpecializationDefinition.cs` with all properties and factory method
- [ ] Path type validation in factory
- [ ] Parent archetype validation in factory
- [ ] Private EF Core constructor

### Configuration

- [ ] Enhanced `specializations.json` with `definitions` array
- [ ] At least 8 complete definition entries (remaining 9 follow same pattern)

### Testing

- [ ] `SpecializationDefinitionTests.cs` with ~2 tests
- [ ] `SpecialResourceDefinitionTests.cs` with ~1 test
- [ ] All tests passing

### Documentation

- [ ] XML documentation on all public types and members
- [ ] Remarks sections with examples

---

## 13. Acceptance Criteria

### Functional

- [ ] `SpecialResourceDefinition.Create()` validates min/max/starts range
- [ ] `SpecialResourceDefinition.None` returns empty resource instance
- [ ] `SpecializationDefinition.Create()` validates path type matches enum
- [ ] `SpecializationDefinition.Create()` validates parent archetype matches enum
- [ ] `HasSpecialResource` returns true only when resource is defined
- [ ] `IsHeretical` returns true for Heretical path type
- [ ] `GetCorruptionWarning()` returns warning text for Heretical specializations

### Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~3 unit tests pass
- [ ] XML documentation complete on all public members
- [ ] Configuration file has valid JSON structure

---

## 14. Future Considerations

### Deferred to v0.17.4c

- **SpecializationAbilityTier**: Tier 1/2/3 ability groups
- **SpecializationAbility**: Individual ability definitions within tiers
- **AbilityTiers collection** on `SpecializationDefinition`

### Deferred to v0.17.4d

- **ISpecializationProvider**: Service for loading/querying specialization definitions

### Deferred to v0.17.4e

- **ISpecializationApplicationService**: Service for applying specialization during creation
- **SpecializationPreview**: Preview DTO for character creation UI

---

## 15. Implementation Notes

### 15.1 Entity Immutability

`SpecializationDefinition` is fully immutable after creation:

- All setters are private
- Factory method is only construction path
- No mutation methods exist

### 15.2 Validation Strategy

Validation occurs in factory methods, not constructors:

- Fail-fast with descriptive exceptions
- Path type and archetype validated against enum extension methods
- Prevents configuration errors from creating invalid entities

### 15.3 Null Handling

- `SpecialResource` uses `SpecialResourceDefinition.None` instead of null
- `HasSpecialResource` simplifies null checking
- JSON config uses `null` for no special resource (converted on load)

---

## 16. Document Metadata

---

_Document Version: 1.0_
_Last Updated: 2026-01-27_
_Author: Claude_
