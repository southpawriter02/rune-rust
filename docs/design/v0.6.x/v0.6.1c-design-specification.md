# v0.6.1c Design Specification: Mini-Map

**Version:** 0.6.1c
**Parent:** v0.6.1 (Visual Components)
**Prerequisites:** v0.6.1b Complete (ASCII Room Renderer)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [MiniMap Component](#4-minimap-component)
5. [Exploration Tracker](#5-exploration-tracker)
6. [Map Rendering](#6-map-rendering)
7. [Data Model](#7-data-model)
8. [Configuration](#8-configuration)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### Purpose

The Mini-Map system implements a persistent exploration map that displays in the sidebar, showing explored rooms, room connections, and the player's current position. Unexplored rooms adjacent to visited areas show as unknown until the player enters them. The map automatically centers on the current room and supports scrolling for large dungeons.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Components** | MiniMap |
| **Interfaces** | IExplorationTracker |
| **Services** | ExplorationTracker |
| **Tests** | ~10 new unit tests |

### Architectural Significance

This version establishes the **Exploration Tracking Pattern** that will be used throughout the game:
- Persistent tracking of visited locations
- Visual representation of spatial relationships
- Auto-centering and scrollable views

---

## 2. Feature Overview

```
v0.6.1c Features
├── MiniMap Component
│   ├── Render to sidebar
│   ├── Room box rendering (5x3 cells)
│   ├── Connection line rendering
│   ├── Current room highlighting (@)
│   ├── Auto-centering
│   └── Scroll controls
├── IExplorationTracker Interface
│   ├── MarkExplored()
│   ├── IsExplored()
│   ├── ExploredRooms set
│   ├── KnownAdjacentRooms set
│   ├── Reset()
│   └── OnRoomExplored event
├── ExplorationTracker Service
│   ├── Visited room persistence
│   ├── Adjacent room discovery
│   └── Session-based tracking
└── Map Symbols
    ├── @ = Current room
    ├── █ = Explored room
    ├── ? = Unexplored adjacent
    └── ─│ = Connections
```

---

## 3. Architecture Diagrams

### 3.1 Mini-Map Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                     MINI-MAP ARCHITECTURE                            │
└─────────────────────────────────────────────────────────────────────┘

    DOMAIN                       APPLICATION                PRESENTATION
    ──────                       ───────────                ────────────

    ┌─────────────┐            ┌──────────────────┐    ┌────────────────┐
    │    Room     │◀───────────│ IExplorationTracker   │    MiniMap      │
    ├─────────────┤            ├──────────────────┤    ├────────────────┤
    │ Id          │            │ MarkExplored()   │───▶│ Render()       │
    │ Connections │            │ IsExplored()     │    │ CenterOn()     │
    │ MapPosition │            │ ExploredRooms    │    │ Scroll()       │
    └─────────────┘            │ KnownAdjacentRooms    │ RenderRoom()   │
                               │ OnRoomExplored   │    │ RenderConnection
                               └──────────────────┘    └────────┬───────┘
                                        ▲                       │
                                        │ implements            │ uses
                                        │                       ▼
                               ┌──────────────────┐    ┌────────────────┐
                               │ExplorationTracker│    │  ScreenLayout  │
                               ├──────────────────┤    │  (v0.6.0a)     │
                               │ _exploredRooms   │    ├────────────────┤
                               │ _knownAdjacent   │    │ Sidebar Panel  │
                               │ _roomPositions   │    └────────────────┘
                               └──────────────────┘
```

### 3.2 Exploration Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                       EXPLORATION FLOW                               │
└─────────────────────────────────────────────────────────────────────┘

    Player enters new room
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 1. MARK ROOM AS EXPLORED                                       │
    ├───────────────────────────────────────────────────────────────┤
    │ _explorationTracker.MarkExplored(room.Id)                     │
    │                                                                │
    │ • Add room.Id to ExploredRooms set                            │
    │ • Fire OnRoomExplored event                                    │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 2. DISCOVER ADJACENT ROOMS                                     │
    ├───────────────────────────────────────────────────────────────┤
    │ FOR each connection in room.Connections:                       │
    │   IF NOT IsExplored(connection.TargetRoomId):                 │
    │     Add to KnownAdjacentRooms set                             │
    └───────────────────────────────────────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────────────────────────────────────┐
    │ 3. UPDATE MINI-MAP                                             │
    ├───────────────────────────────────────────────────────────────┤
    │ MiniMap.Render(currentRoom)                                    │
    │                                                                │
    │ • Center map on current room                                   │
    │ • Draw explored rooms (█)                                      │
    │ • Draw current room (@)                                        │
    │ • Draw known adjacent (?}                                      │
    │ • Draw connections (─│)                                        │
    └───────────────────────────────────────────────────────────────┘
```

### 3.3 Map Coordinate System

```
┌─────────────────────────────────────────────────────────────────────┐
│                    MAP COORDINATE SYSTEM                             │
└─────────────────────────────────────────────────────────────────────┘

    Each room occupies a 5x3 character cell:
    
      ┌───┐
      │ @ │   (5 wide x 3 tall)
      └───┘

    Connections use 2 characters:
    
      Horizontal: ──        Vertical: │
                                      │

    Grid layout (MapPosition):
    
      (0,0)            (1,0)            (2,0)
      ┌───┐            ┌───┐            ┌───┐
      │ █ │────────────│ █ │────────────│ @ │
      └─┬─┘            └─┬─┘            └───┘
        │                │
        │  (1 cell = 7 chars wide with connection)
        │
      (0,1)            (1,1)
      ┌───┐            ┌───┐
      │ █ │            │ ? │
      └───┘            └───┘


    Character positions:
    
      Room at (x,y) renders at:
        screenX = x * 7 + offset
        screenY = y * 4 + offset
      
      Connection between (x,y) and (x+1,y):
        Draw "──" at (x * 7 + 5, y * 4 + 1)
      
      Connection between (x,y) and (x,y+1):
        Draw "│" at (x * 7 + 2, y * 4 + 3)
```

---

## 4. MiniMap Component

### 4.1 MiniMap Class

**File:** `src/Presentation/RuneAndRust.TUI/UI/MiniMap.cs`

```csharp
namespace RuneAndRust.Presentation.UI;

/// <summary>
/// Renders a mini-map of explored rooms in the sidebar.
/// </summary>
public class MiniMap
{
    private readonly IExplorationTracker _exploration;
    private readonly IRoomRepository _roomRepository;
    private readonly ScreenLayout _layout;
    private readonly ITerminalService _terminal;
    private readonly ILogger<MiniMap> _logger;
    
    private int _scrollX = 0;
    private int _scrollY = 0;
    
    // Room cell dimensions
    private const int RoomWidth = 5;
    private const int RoomHeight = 3;
    private const int ConnectionLength = 2;
    private const int CellWidth = RoomWidth + ConnectionLength;   // 7
    private const int CellHeight = RoomHeight + 1;                 // 4
    
    // Symbols
    private const char CurrentRoomSymbol = '@';
    private const char ExploredRoomSymbol = '█';
    private const char UnexploredSymbol = '?';
    private const char HorizontalConnection = '─';
    private const char VerticalConnection = '│';
    
    public MiniMap(
        IExplorationTracker exploration,
        IRoomRepository roomRepository,
        ScreenLayout layout,
        ITerminalService terminal,
        ILogger<MiniMap> logger)
    {
        _exploration = exploration;
        _roomRepository = roomRepository;
        _layout = layout;
        _terminal = terminal;
        _logger = logger;
        
        _exploration.OnRoomExplored += OnRoomExplored;
    }
    
    /// <summary>
    /// Renders the mini-map to the sidebar.
    /// </summary>
    /// <param name="currentRoom">The player's current room.</param>
    public void Render(Room currentRoom)
    {
        var panel = _layout.GetPanel(PanelPosition.Sidebar);
        if (panel == null)
        {
            _logger.LogWarning("Sidebar panel not found for mini-map");
            return;
        }
        
        var contentArea = panel.Value.ContentArea;
        
        // Center on current room
        CenterOn(currentRoom);
        
        // Calculate visible area
        var visibleRoomsX = contentArea.Width / CellWidth;
        var visibleRoomsY = (contentArea.Height - 2) / CellHeight; // -2 for title
        
        // Render title
        _terminal.SetCursorPosition(contentArea.X, contentArea.Y);
        var title = "Mini-Map";
        var titlePadding = (contentArea.Width - title.Length) / 2;
        _terminal.Write(new string(' ', titlePadding) + title);
        
        // Render rooms and connections
        var exploredRooms = GetRoomsToRender(currentRoom, visibleRoomsX, visibleRoomsY);
        
        foreach (var roomInfo in exploredRooms)
        {
            RenderRoom(roomInfo.Room, roomInfo.ScreenX, roomInfo.ScreenY, 
                roomInfo.Room.Id == currentRoom.Id, contentArea);
            
            RenderConnections(roomInfo.Room, roomInfo.ScreenX, roomInfo.ScreenY, 
                contentArea);
        }
        
        // Render unexplored adjacent rooms
        RenderUnexploredAdjacent(currentRoom, contentArea);
        
        _logger.LogDebug("Mini-map rendered with {Count} rooms", exploredRooms.Count);
    }
    
    /// <summary>
    /// Centers the map on a room.
    /// </summary>
    /// <param name="room">Room to center on.</param>
    public void CenterOn(Room room)
    {
        if (room.MapPosition.HasValue)
        {
            var (x, y) = room.MapPosition.Value;
            var panel = _layout.GetPanel(PanelPosition.Sidebar);
            if (panel != null)
            {
                var visibleX = panel.Value.ContentWidth / CellWidth;
                var visibleY = panel.Value.ContentHeight / CellHeight;
                
                _scrollX = x - visibleX / 2;
                _scrollY = y - visibleY / 2;
            }
        }
    }
    
    /// <summary>
    /// Scrolls the map view.
    /// </summary>
    /// <param name="dx">Horizontal scroll amount.</param>
    /// <param name="dy">Vertical scroll amount.</param>
    public void Scroll(int dx, int dy)
    {
        _scrollX += dx;
        _scrollY += dy;
    }
    
    /// <summary>
    /// Renders a single room on the map.
    /// </summary>
    private void RenderRoom(
        Room room, 
        int screenX, 
        int screenY, 
        bool isCurrent,
        (int X, int Y, int Width, int Height) contentArea)
    {
        if (!IsInBounds(screenX, screenY, contentArea)) return;
        
        var symbol = isCurrent ? CurrentRoomSymbol : ExploredRoomSymbol;
        var color = isCurrent ? ConsoleColor.Yellow : ConsoleColor.White;
        
        // Draw room box
        var x = contentArea.X + screenX;
        var y = contentArea.Y + screenY + 2; // +2 for title
        
        // Top border
        _terminal.SetCursorPosition(x, y);
        _terminal.Write("┌───┐");
        
        // Middle with symbol
        _terminal.SetCursorPosition(x, y + 1);
        _terminal.Write("│ ");
        var prevColor = Console.ForegroundColor;
        Console.ForegroundColor = color;
        _terminal.Write(symbol.ToString());
        Console.ForegroundColor = prevColor;
        _terminal.Write(" │");
        
        // Bottom border
        _terminal.SetCursorPosition(x, y + 2);
        _terminal.Write("└───┘");
    }
    
    /// <summary>
    /// Renders connections between rooms.
    /// </summary>
    private void RenderConnections(
        Room room,
        int screenX,
        int screenY,
        (int X, int Y, int Width, int Height) contentArea)
    {
        foreach (var connection in room.Connections)
        {
            var targetRoom = _roomRepository.GetById(connection.TargetRoomId);
            if (targetRoom == null) continue;
            
            if (!_exploration.IsExplored(targetRoom.Id) && 
                !_exploration.KnownAdjacentRooms.Contains(targetRoom.Id))
                continue;
            
            var x = contentArea.X + screenX;
            var y = contentArea.Y + screenY + 2;
            
            switch (connection.Direction)
            {
                case Direction.East:
                    _terminal.SetCursorPosition(x + RoomWidth, y + 1);
                    _terminal.Write("──");
                    break;
                case Direction.South:
                    _terminal.SetCursorPosition(x + 2, y + RoomHeight);
                    _terminal.Write("│");
                    break;
                // West and North handled by the target room's rendering
            }
        }
    }
    
    /// <summary>
    /// Renders unexplored adjacent rooms as '?' markers.
    /// </summary>
    private void RenderUnexploredAdjacent(
        Room currentRoom,
        (int X, int Y, int Width, int Height) contentArea)
    {
        foreach (var adjacentId in _exploration.KnownAdjacentRooms)
        {
            var adjacentRoom = _roomRepository.GetById(adjacentId);
            if (adjacentRoom?.MapPosition == null) continue;
            
            var (mapX, mapY) = adjacentRoom.MapPosition.Value;
            var screenX = (mapX - _scrollX) * CellWidth;
            var screenY = (mapY - _scrollY) * CellHeight;
            
            if (!IsInBounds(screenX, screenY, contentArea)) continue;
            
            var x = contentArea.X + screenX;
            var y = contentArea.Y + screenY + 2;
            
            // Draw smaller unexplored box
            _terminal.SetCursorPosition(x, y);
            _terminal.Write("┌───┐");
            
            _terminal.SetCursorPosition(x, y + 1);
            _terminal.Write("│ ");
            var prevColor = Console.ForegroundColor;
            Console.ForegroundColor = ConsoleColor.DarkGray;
            _terminal.Write(UnexploredSymbol.ToString());
            Console.ForegroundColor = prevColor;
            _terminal.Write(" │");
            
            _terminal.SetCursorPosition(x, y + 2);
            _terminal.Write("└───┘");
        }
    }
    
    private IReadOnlyList<(Room Room, int ScreenX, int ScreenY)> GetRoomsToRender(
        Room currentRoom, int visibleX, int visibleY)
    {
        var result = new List<(Room, int, int)>();
        
        foreach (var roomId in _exploration.ExploredRooms)
        {
            var room = _roomRepository.GetById(roomId);
            if (room?.MapPosition == null) continue;
            
            var (mapX, mapY) = room.MapPosition.Value;
            var screenX = (mapX - _scrollX) * CellWidth;
            var screenY = (mapY - _scrollY) * CellHeight;
            
            if (screenX >= 0 && screenX < visibleX * CellWidth &&
                screenY >= 0 && screenY < visibleY * CellHeight)
            {
                result.Add((room, screenX, screenY));
            }
        }
        
        return result;
    }
    
    private static bool IsInBounds(
        int screenX, 
        int screenY, 
        (int X, int Y, int Width, int Height) contentArea)
    {
        return screenX >= 0 && screenX + RoomWidth <= contentArea.Width &&
               screenY >= 0 && screenY + RoomHeight <= contentArea.Height - 2;
    }
    
    private void OnRoomExplored(Guid roomId)
    {
        _logger.LogDebug("Room explored: {RoomId}, triggering map refresh", roomId);
    }
}
```

---

## 5. Exploration Tracker

### 5.1 IExplorationTracker Interface

**File:** `src/Core/RuneAndRust.Application/Interfaces/IExplorationTracker.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Tracks which rooms the player has explored.
/// </summary>
public interface IExplorationTracker
{
    /// <summary>
    /// Marks a room as explored.
    /// </summary>
    /// <param name="roomId">The room's unique identifier.</param>
    void MarkExplored(Guid roomId);
    
    /// <summary>
    /// Checks if a room has been explored.
    /// </summary>
    /// <param name="roomId">The room's unique identifier.</param>
    /// <returns>True if the room has been visited.</returns>
    bool IsExplored(Guid roomId);
    
    /// <summary>
    /// Gets all explored room IDs.
    /// </summary>
    IReadOnlySet<Guid> ExploredRooms { get; }
    
    /// <summary>
    /// Gets rooms adjacent to explored rooms (known but unvisited).
    /// </summary>
    IReadOnlySet<Guid> KnownAdjacentRooms { get; }
    
    /// <summary>
    /// Clears all exploration data.
    /// </summary>
    void Reset();
    
    /// <summary>
    /// Event raised when a room is explored.
    /// </summary>
    event Action<Guid>? OnRoomExplored;
}
```

### 5.2 ExplorationTracker Implementation

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Services/ExplorationTracker.cs`

```csharp
namespace RuneAndRust.Infrastructure.Services;

/// <summary>
/// Tracks explored rooms during a game session.
/// </summary>
public class ExplorationTracker : IExplorationTracker
{
    private readonly HashSet<Guid> _exploredRooms = new();
    private readonly HashSet<Guid> _knownAdjacentRooms = new();
    private readonly IRoomRepository _roomRepository;
    private readonly ILogger<ExplorationTracker> _logger;
    
    public IReadOnlySet<Guid> ExploredRooms => _exploredRooms;
    public IReadOnlySet<Guid> KnownAdjacentRooms => _knownAdjacentRooms;
    
    public event Action<Guid>? OnRoomExplored;
    
    public ExplorationTracker(
        IRoomRepository roomRepository,
        ILogger<ExplorationTracker> logger)
    {
        _roomRepository = roomRepository;
        _logger = logger;
    }
    
    public void MarkExplored(Guid roomId)
    {
        if (_exploredRooms.Contains(roomId))
        {
            return; // Already explored
        }
        
        _exploredRooms.Add(roomId);
        _knownAdjacentRooms.Remove(roomId); // No longer "adjacent unknown"
        
        // Discover adjacent rooms
        var room = _roomRepository.GetById(roomId);
        if (room != null)
        {
            foreach (var connection in room.Connections)
            {
                if (!_exploredRooms.Contains(connection.TargetRoomId))
                {
                    _knownAdjacentRooms.Add(connection.TargetRoomId);
                }
            }
        }
        
        _logger.LogDebug("Room {RoomId} marked as explored. " +
            "Total explored: {ExploredCount}, Adjacent: {AdjacentCount}",
            roomId, _exploredRooms.Count, _knownAdjacentRooms.Count);
        
        OnRoomExplored?.Invoke(roomId);
    }
    
    public bool IsExplored(Guid roomId)
    {
        return _exploredRooms.Contains(roomId);
    }
    
    public void Reset()
    {
        _exploredRooms.Clear();
        _knownAdjacentRooms.Clear();
        _logger.LogInformation("Exploration data reset");
    }
}
```

---

## 6. Map Rendering

### 6.1 Map Symbol Legend

| Symbol | Meaning | Color |
|--------|---------|-------|
| `@` | Current room (player location) | Yellow |
| `█` | Explored room | White |
| `?` | Unexplored adjacent room | DarkGray |
| `─` | Horizontal connection | Gray |
| `│` | Vertical connection | Gray |
| `┌┐└┘` | Room corners | Gray |

### 6.2 Map Layouts

```
SIMPLE MAP (Small dungeon):
┌─────────────┐
│ Mini-Map    │
├─────────────┤
│  ┌───┐ ┌───┐│     
│  │ ? ├─┤ ? ││     ? = Unexplored (known exit)
│  └───┘ └─┬─┘│     ─│ = Passage
│          │  │     @ = Current room
│       ┌──┴──┐     █ = Explored room
│       │  @  │
│       └──┬──┘
│          │  │
│       ┌──┴──┐
│       │  █  │
│       └─────┘
└─────────────┘

DETAILED MAP (Larger view):
┌─────────────────────────┐
│        Mini-Map         │
├─────────────────────────┤
│                         │
│   ┌───┐     ┌───┐       │
│   │ █ ├─────┤ █ │       │     Legend:
│   └─┬─┘     └─┬─┘       │     █ = Explored
│     │         │         │     @ = You are here
│   ┌─┴─┐     ┌─┴─┐       │     ? = Unknown
│   │ █ ├─────┤ @ │       │     ─ │ = Passage
│   └─┬─┘     └───┘       │
│     │                   │
│   ┌─┴─┐                 │
│   │ ? │                 │
│   └───┘                 │
│                         │
└─────────────────────────┘
```

### 6.3 Room.MapPosition Property

**Addition to existing Room entity:**

```csharp
// In Room.cs (Domain/Entities)

/// <summary>
/// Gets the room's position on the map grid.
/// </summary>
/// <remarks>
/// Used by the mini-map to position rooms spatially.
/// Null if the room has no defined map position.
/// </remarks>
public (int X, int Y)? MapPosition { get; private set; }
```

---

## 7. Data Model

### 7.1 New Interfaces

| Interface | Layer | Description |
|-----------|-------|-------------|
| `IExplorationTracker` | Application | Exploration tracking interface |

### 7.2 New Services

| Service | Layer | Description |
|---------|-------|-------------|
| `ExplorationTracker` | Infrastructure | Exploration implementation |
| `MiniMap` | Presentation | Map rendering component |

### 7.3 Modified Entities

| Entity | Modification | Description |
|--------|--------------|-------------|
| `Room` | Add `MapPosition` | Grid position for map rendering |

---

## 8. Configuration

### 8.1 Mini-Map Configuration

**File:** `config/ui.json` (miniMap section)

```json
{
  "miniMap": {
    "symbols": {
      "currentRoom": "@",
      "exploredRoom": "█",
      "unexploredRoom": "?",
      "horizontalConnection": "─",
      "verticalConnection": "│"
    },
    "colors": {
      "currentRoom": "Yellow",
      "exploredRoom": "White",
      "unexploredRoom": "DarkGray",
      "connection": "Gray"
    },
    "roomCell": {
      "width": 5,
      "height": 3
    },
    "showTitle": true,
    "title": "Mini-Map"
  }
}
```

### 8.2 Configuration Schema

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `symbols.currentRoom` | char | @ | Current room symbol |
| `symbols.exploredRoom` | char | █ | Explored room symbol |
| `symbols.unexploredRoom` | char | ? | Unknown room symbol |
| `colors.currentRoom` | ConsoleColor | Yellow | Current room color |
| `colors.exploredRoom` | ConsoleColor | White | Explored room color |
| `roomCell.width` | int | 5 | Room box width |
| `roomCell.height` | int | 3 | Room box height |

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `MiniMap` | Debug | Render count, room explored |
| `MiniMap` | Warning | Sidebar panel not found |
| `ExplorationTracker` | Debug | Room marked, counts |
| `ExplorationTracker` | Information | Reset |

### 9.2 Log Message Templates

```csharp
// MiniMap
_logger.LogDebug("Mini-map rendered with {Count} rooms", count);
_logger.LogDebug("Room explored: {RoomId}, triggering map refresh", roomId);
_logger.LogWarning("Sidebar panel not found for mini-map");

// ExplorationTracker
_logger.LogDebug("Room {RoomId} marked as explored. " +
    "Total explored: {ExploredCount}, Adjacent: {AdjacentCount}",
    roomId, exploredCount, adjacentCount);
_logger.LogInformation("Exploration data reset");
```

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| MiniMap rendering | 4 |
| ExplorationTracker | 4 |
| Map coordinate calculation | 2 |
| **Total** | **~10** |

### 10.2 Test Specifications

#### MiniMapTests.cs

```csharp
[TestFixture]
public class MiniMapTests
{
    [Test]
    public void Render_WithCurrentRoom_ShowsAtSymbol();
    
    [Test]
    public void Render_WithExploredRooms_ShowsFilledSymbols();
    
    [Test]
    public void CenterOn_UpdatesScrollPosition();
    
    [Test]
    public void Scroll_AdjustsViewport();
}
```

#### ExplorationTrackerTests.cs

```csharp
[TestFixture]
public class ExplorationTrackerTests
{
    [Test]
    public void MarkExplored_AddsToExploredSet();
    
    [Test]
    public void MarkExplored_DiscoverdsAdjacentRooms();
    
    [Test]
    public void MarkExplored_RemovesFromAdjacentSet();
    
    [Test]
    public void Reset_ClearsAllData();
    
    [Test]
    public void OnRoomExplored_FiresEvent();
}
```

---

## 11. Use Cases

### UC-001: Enter First Room
**Actor:** Player
**Flow:** Game start → MarkExplored(startRoom) → Adjacent rooms discovered → Map shows start room with @

### UC-002: Explore New Room
**Actor:** Player
**Flow:** Move to unexplored room → MarkExplored() → Remove from adjacent → Add new adjacent → Map updates

### UC-003: View Large Dungeon
**Actor:** Player
**Flow:** Many rooms explored → Map scrolls → Only visible rooms rendered → Current room centered

### UC-004: Return to Explored Room
**Actor:** Player
**Flow:** Move back to visited room → IsExplored() = true → Map re-centers → No state change

---

## 12. Deliverable Checklist

### MiniMap Component
- [ ] `MiniMap` class created
- [ ] Render() method implemented
- [ ] CenterOn() method implemented
- [ ] Scroll() method implemented
- [ ] RenderRoom() method implemented
- [ ] RenderConnections() method implemented
- [ ] RenderUnexploredAdjacent() method implemented
- [ ] GetRoomsToRender() helper implemented
- [ ] Bounds checking implemented

### Exploration Tracker
- [ ] `IExplorationTracker` interface created
- [ ] `ExplorationTracker` implementation created
- [ ] MarkExplored() implemented
- [ ] IsExplored() implemented
- [ ] ExploredRooms property implemented
- [ ] KnownAdjacentRooms property implemented
- [ ] Reset() implemented
- [ ] OnRoomExplored event implemented

### Room Modification
- [ ] MapPosition property added to Room entity

### Configuration
- [ ] `ui.json` miniMap section added

### Testing
- [ ] ~10 unit tests implemented
- [ ] All tests passing

---

## 13. Acceptance Criteria

### Functional
- [ ] Mini-map renders in sidebar panel
- [ ] Explored rooms display as filled boxes (█)
- [ ] Current room displays with @ marker
- [ ] Current room highlighted in yellow
- [ ] Unexplored adjacent rooms show ? marker
- [ ] Connections render between adjacent rooms
- [ ] Map auto-centers on current room
- [ ] Map scrolls for large dungeons
- [ ] Scroll() adjusts viewport
- [ ] Exploration persists during session
- [ ] Map updates when player moves to new room
- [ ] Reset() clears all exploration data

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~10 unit tests pass
- [ ] XML documentation complete on all public members

---

## 14. Dependencies

### Required from v0.6.0a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `ScreenLayout` | `Presentation/UI/ScreenLayout.cs` | Sidebar panel access |
| `Panel` | `Presentation/UI/Panel.cs` | Content area dimensions |
| `ITerminalService` | `Application/Interfaces/ITerminalService.cs` | Terminal output |

### Required from Prior Versions

| Type | Location | Usage |
|------|----------|-------|
| `Room` | `Domain/Entities/Room.cs` | Room data, connections |
| `RoomConnection` | `Domain/ValueObjects/RoomConnection.cs` | Connection data |
| `IRoomRepository` | `Application/Interfaces/IRoomRepository.cs` | Room lookup |
| `Direction` | `Domain/Enums/Direction.cs` | Connection directions |

### Provides to v0.6.1d

| Type | Usage |
|------|-------|
| Pattern | Similar sidebar rendering pattern for inventory |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `IExplorationTracker` | Save/load exploration state |
| `ExploredRooms` | Achievement tracking |

---

## 15. Future Considerations

### Deferred to v0.6.1d
- **Inventory Grid**: Visual inventory display (next part)

### Deferred to Future
- **Fog of War**: Fade unexplored areas
- **Map Legend Panel**: Separate legend display
- **Map Zoom**: Multiple zoom levels
- **Map Persistence**: Save exploration across sessions

### Out of Scope
- **Full-Screen Map**: Expanded map view (future command)
- **Map Annotations**: Player-added markers
- **3D Map**: Multi-level dungeons

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: Assistant*
