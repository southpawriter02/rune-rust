# v0.19.5a: Alfheim & Asgard Implementation Design Specification

**Version:** v0.19.5a
**Title:** Alfheim & Asgard Implementation
**Estimated Test Count:** ~24 tests
**Status:** Design Document
**Last Updated:** 2026-01-28

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Feature Overview](#feature-overview)
3. [Architecture Diagrams](#architecture-diagrams)
4. [Realm Specifications](#realm-specifications)
5. [Zone Definitions](#zone-definitions)
6. [Base Properties Configuration](#base-properties-configuration)
7. [Cognitive Hazard Mechanics](#cognitive-hazard-mechanics)
8. [Special Mechanics](#special-mechanics)
9. [User Stories & Scenarios](#user-stories--scenarios)
10. [Configuration Files](#configuration-files)
11. [Decision Trees](#decision-trees)
12. [Code Examples](#code-examples)
13. [Logging & Monitoring](#logging--monitoring)
14. [Unit Testing Specification](#unit-testing-specification)
15. [Integration Points](#integration-points)
16. [Performance Considerations](#performance-considerations)
17. [Error Handling Strategy](#error-handling-strategy)
18. [Deliverable Checklist](#deliverable-checklist)
19. [Acceptance Criteria](#acceptance-criteria)
20. [Dependencies](#dependencies)
21. [Deferrals & Future Work](#deferrals--future-work)

---

## Executive Summary

v0.19.5a delivers two critical realms for the Rune Rust narrative: **Alfheim** (Deck 02 - The Glimmering Wound) and **Asgard** (Deck 01 - The Shattered Spire). These realms introduce two distinct cognitive hazard systems that fundamentally alter how players perceive, navigate, and survive environmental challenges.

**Key Deliverables:**
- Full Alfheim implementation with RealityFlux condition mechanics
- Full Asgard implementation with CpsExposure (Cognitive Paradox Syndrome) mechanics
- Genius Loci entity system for Alfheim
- Heimdallr Signal automated broadcast system for Asgard
- ~24 comprehensive unit and integration tests
- Complete configuration files for both realms
- Decision trees for hazard evaluation and progression

**Narrative Context:** Both realms represent traversable yet hostile environments where narrative progression is gated by the player's ability to withstand increasingly severe cognitive and perceptual distortions.

---

## Feature Overview

### Alfheim: The Glimmering Wound

A shattered realm of fractured light and broken geometry where reality itself becomes unreliable. The primary threat is **RealityFlux**, a condition that accumulates as players attempt navigation and environmental interaction.

**Characteristics:**
- Visual environment dominated by blinding light (Light level: 1.0)
- Extreme environmental stress from unrelenting sensory input
- Hallucinations scale with prolonged exposure
- Memory distortion affects waypoint navigation and puzzle solutions
- Genius Loci entities manifest as failed RealityFlux checks

### Asgard: The Shattered Spire

The northernmost reach of the Rune Rust world, containing paradox-laden environments where time, causality, and logic become unstable. The primary threat is **CpsExposure**, which accumulates through exposure to paradoxical situations and temporal anomalies.

**Characteristics:**
- Orbital zone (unique Z +4 level) containing temporal resonance chambers
- Chronological instability introduces déjà vu and temporal loops
- Cognitive breakdown mechanics mirror reality distortion but operate through different mechanisms
- Heimdallr Signal automated broadcast provides navigation assistance but exacerbates CPS
- Archive of compressed knowledge threatens cognitive integrity

---

## Architecture Diagrams

### Realm Hierarchy

```
RUNE RUST WORLD
├── Deck 01: Asgard (The Shattered Spire)
│   ├── The Shattered Spire (Z +1 to +3)
│   ├── Heimdallr's Platform (Z +2)
│   ├── Odin's Archive (Z +3)
│   └── Orbital Zone (Z +4) [UNIQUE]
│
└── Deck 02: Alfheim (The Glimmering Wound)
    ├── The Luminous Waste (Z 0 to +1)
    ├── The Prismatic Maze (Z +1 to +2)
    └── The Dreaming Core (Z +2 to +3)
```

### Cognitive Hazard System Architecture

```
Player State
├── RealityFlux (Alfheim)
│   ├── Stress Accumulation (Per Action)
│   ├── Navigation Reliability Check
│   ├── Visual Hallucination Trigger
│   ├── Memory Distortion Effect
│   └── Genius Loci Manifestation (Check Failure -10)
│
└── CpsExposure (Asgard)
    ├── Paradox Point Accumulation
    ├── Déjà Vu Effect
    ├── Time Distortion Mechanic
    ├── Temporal Loop Detection
    ├── Cognitive Breakdown Progression
    └── Heimdallr Signal Trigger
```

### Environmental Property Cascade

```
Zone Selection
└── Apply Base Properties
    ├── Temperature
    ├── Aetheric Saturation
    ├── Humidity
    ├── Light Intensity
    ├── Scale Factor
    └── Corrosion Rate
        └── Calculate Hazard DC
            └── Determine Primary Condition
                └── Execute Hazard Mechanics
```

---

## Realm Specifications

### Alfheim: Deck 02 - The Glimmering Wound

| Property | Value | Notes |
|----------|-------|-------|
| **Deck ID** | 02 | Secondary realm in narrative order |
| **Primary Hazard** | RealityFlux | Stress-based condition |
| **Z-Range** | 0 to +3 | Three vertical levels |
| **Temperature** | 22°C | Moderate; no thermal stress |
| **Aetheric Saturation** | 0.9 | High supernatural presence |
| **Humidity** | 30% | Low; contributes to perceptual distortion |
| **Light Intensity** | 1.0 | BLINDING; primary environmental stressor |
| **Scale Factor** | 1.0 | Standard scale; spaces feel their true size |
| **Corrosion Rate** | 0.1 | Minimal physical decay; reality decay primary |
| **Status Effect** | RealityFlux | Accumulates with navigation checks |

**Thematic Elements:**
- Fracture and refraction of light
- Geometric impossibilities and non-Euclidean spacing
- Sensory overload leading to psychological strain
- The "wound" metaphor: environment is a traumatic tear in reality itself

### Asgard: Deck 01 - The Shattered Spire

| Property | Value | Notes |
|----------|-------|-------|
| **Deck ID** | 01 | Primary realm in narrative order |
| **Primary Hazard** | CpsExposure | Paradox-based condition |
| **Z-Range** | +1 to +4 | Four vertical levels (ONLY realm with +4) |
| **Temperature** | 15°C | Cold; minor atmospheric threat |
| **Aetheric Saturation** | 1.0 | Maximum supernatural presence |
| **Humidity** | 20% | Very low; extreme aridity |
| **Light Intensity** | 0.8 | Dim; perpetual twilight |
| **Scale Factor** | 1.0 | Standard scale |
| **Corrosion Rate** | 0.0 | NO physical decay; conceptual integrity primary |
| **Status Effect** | CpsExposure | Accumulates through paradoxical exposure |

**Thematic Elements:**
- Temporal paradoxes and causality violations
- Cognitive overload from impossible truths
- The spire as monument to corrupted knowledge
- Archive as a dangerous library of compressed contradictions

---

## Zone Definitions

### ALFHEIM ZONES

#### Zone: The Luminous Waste (Z 0 to +1)

**Difficulty Class:** 10
**Description:** Vast expanses of white stone and crystalline formations that refract light in disorienting patterns. The ground is unstable, shifting beneath the player's feet as if responding to unspoken desires.

**Hazard Details:**
- Environmental DC: 10 (base threshold)
- RealityFlux Stress: +1d4 per 10 minutes of exposure
- Primary threat: Navigation confusion due to light refraction
- Special feature: Mirage effect at 50+ RealityFlux points

**Recommended Actions:**
- Light-resistant equipment reduces per-turn stress by 1
- Navigation checks require DC 10 Intelligence or Wisdom save
- Failure causes 1d6 additional RealityFlux stress

#### Zone: The Prismatic Maze (Z +1 to +2)

**Difficulty Class:** 16
**Description:** A labyrinth of fractured mirrors and refractive surfaces where each passage contains crystalline walls that split vision into component spectra. Hallucinations intensify here.

**Hazard Details:**
- Environmental DC: 16 (advanced threshold)
- RealityFlux Stress: +2d4 per action requiring perception
- Primary threat: Visual hallucinations that obscure true paths
- Special feature: "False passages" appear on failed Perception checks (DC 16)
- Genius Loci spawn condition: RealityFlux check failure by 10+

**Recommended Actions:**
- Perception checks required every 3 turns
- Critical failures trigger Genius Loci manifestation
- Memory saves (DC 16) required to retain location awareness
- Each failed save inflicts memory distortion penalty (-1 to future navigation checks, stacking)

#### Zone: The Dreaming Core (Z +2 to +3)

**Difficulty Class:** 14
**Description:** The heart of Alfheim where reality becomes truly malleable. Spaces shift based on observer expectation. Time flows inconsistently. This zone contains the realm's most valuable resources but also maximum cognitive hazard.

**Hazard Details:**
- Environmental DC: 14 (intermediate-high threshold)
- RealityFlux Stress: +1d6 per turn in zone
- Primary threat: Memory distortion and perception instability
- Special feature: "Reality bubbles" that trap players in recursive loops
- Genius Loci spawn condition: Any RealityFlux check failure

**Recommended Actions:**
- Constant Wisdom saves (DC 14) to remain grounded
- Failed saves inflict 1 temporary point of memory loss (resets on long rest)
- Entities in this zone provide cryptic hints but cannot be fully understood
- Exit requires successful DC 14 Intelligence check or DC 18 Charisma check to negotiate with manifestations

### ASGARD ZONES

#### Zone: The Shattered Spire (Z +1 to +3)

**Difficulty Class:** 12
**Description:** Towering ruins of a grand spire, fragments suspended at impossible angles, connected by bridges of solidified temporal energy. The architecture defies physics and causality.

**Hazard Details:**
- Environmental DC: 12 (baseline threshold)
- CpsExposure Stress: +1 paradox point per 5 minutes
- Primary threat: Basic paradoxical information (time flowing backwards, causality loops)
- Special feature: Bridges that phase in and out of existence based on temporal alignment

**Recommended Actions:**
- DC 12 Intelligence saves to comprehend spatial layout
- Failed saves inflict 1 déjà vu effect (character repeats actions)
- Navigation checks require understanding of non-Euclidean geometry
- Heimdallr Signal can be accessed from Platform junction

#### Zone: Heimdallr's Platform (Z +2)

**Difficulty Class:** 14
**Description:** A vast circular platform suspended above Asgard's chasm. Heimdallr's automated broadcast system occupies the center, ceaselessly transmitting cryptic wisdom and temporal coordinates.

**Hazard Details:**
- Environmental DC: 14 (intermediate threshold)
- CpsExposure Stress: +2 paradox points upon Signal reception
- Heimdallr Signal triggers automatically upon zone entry
- Signal provides navigation assistance (-2 DC to next navigation check) but causes CPS spike
- Broadcast contains 1d4+1 clues about Archive location

**Recommended Actions:**
- Characters may attempt to resist Signal (DC 16 Wisdom save)
- Failed resistance inflicts 2 temporary CPS points and grants 1 clue
- Successful resistance grants no benefit but avoids CPS cost
- Signal repeats every 3 minutes; damage resets every turn without re-entry

#### Zone: Odin's Archive (Z +3)

**Difficulty Class:** 18
**Description:** An impossible library containing compressed knowledge from thousands of lifetimes. Each shelf, tome, and inscription contains paradoxical information that builds exponentially.

**Hazard Details:**
- Environmental DC: 18 (maximum threshold)
- CpsExposure Stress: +3 paradox points per knowledge interaction
- Primary threat: Cognitive breakdown from compressed paradox densities
- Special feature: Reading any single entry triggers DC 18 Wisdom save or +2d6 CPS stress
- Archive contains quest items and narrative keys

**Recommended Actions:**
- Characters with CpsExposure >30 suffer disadvantage on all checks
- Characters with CpsExposure >45 begin temporal loop manifestations
- Archive residents (knowledge entities) can trade information but demand cognitive cost
- Exit requires successful DC 18 Wisdom check or negotiation with Archive entities

#### Zone: Orbital Zone (Z +4) [UNIQUE TO ASGARD]

**Difficulty Class:** 18+
**Description:** A suspended chamber at the absolute apex of Asgard where temporal forces converge. Time itself crystallizes. Narrative-critical location containing truth about the Rune Rust world's nature.

**Hazard Details:**
- Environmental DC: 18+ (extreme threshold, scales with narrative progression)
- CpsExposure Stress: +5 paradox points per minute
- Unique mechanic: "Temporal Resonance" - player experiences multiple timelines simultaneously
- Temporal loops become manifest; characters can encounter themselves
- Time-locked mechanisms require temporal paradox solutions

**Recommended Actions:**
- This zone is GATE-LOCKED; entrance requires completion of Heimdallr Protocol
- Mandatory narrative event triggers upon entry (cannot be avoided)
- CPS >60 causes automatic temporal loop (character must solve paradox or restart)
- Orbital contents provide narrative culmination and world-state revelation

---

## Base Properties Configuration

### Property Definitions

#### Temperature
- **Range:** 5°C to 30°C
- **Effect:** Mild environmental stressor; affects character endurance over time
- **Alfheim:** 22°C (moderate; not primary stressor)
- **Asgard:** 15°C (cold; minor endurance penalty in extreme cases)

#### Aetheric Saturation
- **Range:** 0.0 to 1.0
- **Effect:** Measures supernatural presence and hazard potency
- **0.0-0.3:** Minimal supernatural influence
- **0.3-0.7:** Moderate supernatural presence
- **0.7-1.0:** Extreme supernatural influence (primary hazard vector)
- **Alfheim:** 0.9 (very high; enables RealityFlux mechanics)
- **Asgard:** 1.0 (maximum; enables CpsExposure mechanics)

#### Humidity
- **Range:** 10% to 90%
- **Effect:** Affects sensory perception and environmental clarity
- **Alfheim:** 30% (low; contributes to visual distortion and hallucination)
- **Asgard:** 20% (very low; supports paradoxical perception)

#### Light Intensity
- **Range:** 0.0 to 1.0
- **Effect:** Primary sensory input vector; affects perception and navigation
- **0.0:** Complete darkness (disorientation, fear-based mechanics)
- **0.5:** Twilight (normal navigation possible with precautions)
- **0.8:** Dim light (reduced visibility penalty)
- **1.0:** Blinding light (extreme sensory overload)
- **Alfheim:** 1.0 (blinding; primary stressor)
- **Asgard:** 0.8 (dim; secondary navigation concern)

#### Scale Factor
- **Range:** 0.5 to 2.0
- **Effect:** Modifies perceived/actual dimensions of spaces
- **1.0:** Standard scale (spaces feel appropriate)
- **<1.0:** Dwarfing (spaces feel too large)
- **>1.0:** Compression (spaces feel claustrophobic)
- **Both Realms:** 1.0 (standard scale; focus is on cognitive hazard, not spatial distortion)

#### Corrosion Rate
- **Range:** 0.0 to 1.0
- **Effect:** Physical deterioration of structures and equipment
- **Alfheim:** 0.1 (minimal; structures held together by reality force, not physics)
- **Asgard:** 0.0 (none; temporal stasis preserves all structures in perfect condition)

---

## Cognitive Hazard Mechanics

### RealityFlux (Alfheim Primary Condition)

RealityFlux is a cumulative stress condition measuring the player's exposure to reality distortion. As players navigate and interact with Alfheim, they accumulate RealityFlux points through failed checks and environmental exposure.

#### Accumulation Rules

**Per-Turn Stress (Passive):**
- All players accumulate 1 RealityFlux point per 10 minutes in Alfheim
- Accelerated accumulation in Prismatic Maze: +1 per 5 minutes
- Accelerated accumulation in Dreaming Core: +1 per 3 minutes

**Action-Based Accumulation:**
- Failed navigation check: +1d4 RealityFlux
- Failed perception check: +2d4 RealityFlux (Prismatic Maze and Dreaming Core)
- Failed memory save: +1d6 RealityFlux
- Exposure to Genius Loci entity: +2d6 RealityFlux

#### Effects by Threshold

| RealityFlux Points | Effect | Mechanical Impact |
|-------------------|--------|------------------|
| 0-10 | Minor distortion | No penalty; slight visual anomalies |
| 11-20 | Moderate distortion | -1 to perception checks; mirage effect 50% chance |
| 21-35 | Severe distortion | -2 to perception checks; hallucinations interfere with navigation |
| 36-50 | Critical distortion | -3 to all checks; memory distortion penalty stacks |
| 50+ | Reality breakdown | Disadvantage on all checks; Genius Loci manifestations guaranteed |

#### Recovery Mechanisms

- **Long Rest:** Reduces RealityFlux by 1d8 (minimum reduction 4)
- **Meditation (1 hour):** Reduces RealityFlux by 1d4
- **Alfheim Exit:** Reduces RealityFlux by 2 per day away from realm
- **Curative Item (Rare):** Reduces RealityFlux by 1d10 (limited availability)

#### Special Mechanic: Genius Loci Manifestation

When a player fails a RealityFlux-related check by 10 or more (or RealityFlux >50 in Dreaming Core), a **Genius Loci entity** manifests. These are sentient aspects of the fractured reality itself.

**Genius Loci Characteristics:**
- Cannot be permanently harmed (dissipate and reform within 1d6 turns)
- Communicate in distorted, prophetic language
- May offer cryptic guidance or false information
- Attacking a Genius Loci inflicts additional RealityFlux stress (2d6)
- Can be negotiated with (DC 16 Charisma check) to gain one factual clue

**Example Genius Loci Encounter:**
```
The Shattered Reflection
When the player fails a perception check by 10+ in the Luminous Waste,
their own reflection manifests from a nearby crystalline surface,
speaking in reversed or nonsensical speech but containing fragments
of useful navigation information.
```

---

### CpsExposure: Cognitive Paradox Syndrome (Asgard Primary Condition)

CpsExposure represents accumulated cognitive strain from exposure to paradoxical and temporally-unstable environments. Unlike RealityFlux (which is about sensory overload), CPS is about logic and causality collapse.

#### Accumulation Rules

**Per-Turn Stress (Passive):**
- All players accumulate 1 CPS point per 5 minutes in Asgard
- Accelerated accumulation in Archive: +1 per 2 minutes
- Heimdallr Signal reception: +2 CPS points per broadcast

**Action-Based Accumulation:**
- Failed paradox logic check: +1d4 CPS
- Reading Archive tome: +2d6 CPS
- Heimdallr Signal reception (failed resistance): +2 CPS
- Temporal loop detection: +1d8 CPS

#### Effects by Threshold

| CPS Points | Effect | Mechanical Impact |
|-----------|--------|------------------|
| 0-15 | Minor paradox strain | No penalty; occasional déjà vu |
| 16-30 | Moderate paradox exposure | -1 to Intelligence checks; déjà vu effect triggers (repeat last action) |
| 31-45 | Severe paradox overload | -2 to Intelligence checks; temporal loop manifestations begin |
| 46-60 | Critical cognitive breakdown | -3 to all checks; automatic temporal loop entry (paradox must be solved) |
| 60+ | Cognitive collapse | Disadvantage on all checks; permanent loop until intervention |

#### Recovery Mechanisms

- **Long Rest:** Reduces CPS by 1d6 (minimum reduction 3)
- **Meditation (1 hour):** Reduces CPS by 1d4
- **Asgard Exit:** Reduces CPS by 3 per day away from realm
- **Paradox Resolution:** Solving a temporal paradox reduces CPS by 1d8
- **Archive Interaction:** Trading knowledge with entities may reduce CPS by 1d6 (conditional)

#### Special Mechanic: Temporal Loop Manifestation

When CPS >45, the character begins experiencing **temporal loops** - cyclical recurrence of events and timelines merging. This is not merely mechanical but narrative: the character experiences contradictory memories and outcomes.

**Temporal Loop Mechanics:**
- Character repeats last action taken (forced)
- On second repetition, character may make DC 16 Intelligence check to break the loop
- Failed check repeats loop again (up to 3 times before mandatory progression)
- Loop exit grants +1 CPS but advances the narrative timeline
- Multiple loop iterations cause additional complications (entities may respond differently)

**Example Temporal Loop:**
```
Player attempts to read a tome in the Archive.
DC 18 save fails; player gains 2d6 CPS points.
CPS reaches 48 (>45); temporal loop triggers.

Turn 1: Player repeats read action (no choice).
Turn 2: Player may make DC 16 Intelligence check to escape.
Failed: Loop continues to Turn 3.
Turn 3: Escape check required (now DC 14); success ends loop,
        advance timeline by one state, +1 additional CPS.
```

---

## Special Mechanics

### Genius Loci System (Alfheim)

Genius Loci are manifestations of fractured reality in Alfheim. They appear when the barrier between the player's mind and the environment's chaos becomes too thin.

#### Manifestation Triggers

1. **RealityFlux check failure by 10+**
   - Immediate manifestation within current zone
   - Cannot be avoided; only delayed

2. **RealityFlux >50 (any zone)**
   - Automatic manifestation at zone entry
   - Manifestation becomes increasingly hostile with higher RealityFlux

3. **Extended Dreaming Core exposure**
   - Any failed check in Dreaming Core triggers manifestation
   - Multiple manifestations stack; area becomes crowded with entities

#### Genius Loci Statblock

```
Genius Loci: The Shattered Reflection

AC: 14 (reality fluctuates)
HP: Immune to conventional damage
Movement: 30 ft. or floats/phases through objects

Abilities:
- Ethereal Form: Cannot be hit by physical attacks
- Mirror Speech: Communicates backwards/nonsensical truths
- Cognitive Drain: Melee attack (DC 16 Wisdom save) inflicts additional 1d6 RealityFlux
- Prophecy Fragment: Action - speaks cryptic clue related to zone; player gains +2 to next navigation check or -2 if clue ignored

Interaction:
- Cannot be permanently defeated
- Dissipates after 1d6 turns or upon player exit from zone
- May be negotiated with (DC 16 Charisma check) to gain factual information

Loot/Reward:
- Defeating (negotiating with) provides navigation advantage or reduced RealityFlux
- No traditional XP; reward is mechanical advantage
```

#### Example Genius Loci Encounters

**The Luminous Waste - "The Void Mirror":**
A distorted reflection of the player appears, speaking in reversed logic. Negotiation reveals true path through maze of light patterns.

**Prismatic Maze - "The Prismatic Judge":**
A massive crystalline entity that refracts the player's actions into multiple possible outcomes. Can trade knowledge of "true path" for acceptance of a RealityFlux penalty.

**Dreaming Core - "The Memory Thief":**
An entity composed of stolen memories from other explorers. Negotiation requires offering a personal memory (mechanical penalty) to gain Archive key.

---

### Heimdallr Signal System (Asgard)

Heimdallr's Platform contains an automated broadcast system that transmits temporal coordinates and navigation clues. However, the signal's cryptic nature exacerbates cognitive paradox exposure.

#### Signal Mechanics

**Automatic Trigger:**
- Upon entry to Heimdallr's Platform (Z +2), the Signal activates
- Broadcast repeats every 3 minutes (unless exited and re-entered)
- Cannot be disabled through conventional means

**Signal Content:**
- 1d4+1 cryptic clues about Archive location
- Temporal coordinates that may lead to trap zones or true path
- Paradoxical statements designed to increase cognitive engagement
- Frequency and complexity scale with party size

**Signal Effects:**

| Outcome | CPS Cost | Benefit |
|---------|----------|---------|
| Resistance Success (DC 16 Wisdom) | 0 CPS | No benefit gained |
| Resistance Failure | +2 CPS | Gain 1 clue; -2 DC to next navigation check |
| Voluntary Reception | +2 CPS | Gain 1d2 additional clues; -3 DC to next navigation check |
| Triple Reception (3 signals) | +6 CPS total | All Platform exits mapped; automatic navigation advantage to Archive |

#### Strategic Considerations

**Characters should choose:** Do I accept the cognitive cost for navigation advantage, or do I attempt to navigate without signal assistance?

**Difficulty Scaling:**
- Minimal Signal use: Archive DC remains 18
- Moderate Signal use (1-2 broadcasts): Archive DC reduced to 16
- Heavy Signal use (3+ broadcasts): Archive DC reduced to 14, but CPS accumulation becomes severe

---

## User Stories & Scenarios

### User Story 1: Alfheim Explorer - The Luminous Waste Route

**Actor:** Player character approaching Alfheim for the first time

**Goal:** Navigate through Luminous Waste and reach Prismatic Maze

**Acceptance Criteria:**
- Player accumulates RealityFlux through navigation checks
- Player witnesses visual anomalies (mirage effects) at RealityFlux 11+
- Player successfully exits to Prismatic Maze or retreats with reduced RealityFlux recovery
- Genius Loci does not manifest (no critical failures)

**Scenario Flow:**
```
1. Player enters Luminous Waste (Z 0)
   - Apply Base Properties: Temp 22°C, Aetheric 0.9, Humidity 30%, Light 1.0
   - RealityFlux starts at 0
   - No immediate threat; environment is disorienting but navigable

2. Player attempts navigation (DC 10)
   - Success: Advance to next zone area without RealityFlux accumulation
   - Failure: +1d4 RealityFlux; may retry
   - Critical Failure: +1d4 RealityFlux + visual hallucination (false path appears)

3. Time passage (every 10 minutes)
   - +1 RealityFlux automatically
   - After 10 minutes: RealityFlux likely 1-5 range
   - No mechanical effects yet

4. Perception checks (to find hidden path)
   - DC 10 Perception check
   - Failure: +2d4 RealityFlux
   - Multiple failures accumulate stress rapidly

5. Exit condition: Reach Prismatic Maze threshold
   - Player transitions to Z +1
   - RealityFlux persists; carry-over between zones
```

---

### User Story 2: Asgard Hazard - Archive Seeker Route

**Actor:** Player character seeking Archive knowledge in Odin's Archive

**Goal:** Enter Odin's Archive, retrieve one knowledge item, exit without cognitive collapse

**Acceptance Criteria:**
- Player navigates through Shattered Spire (Z +1 to +3)
- Player receives Heimdallr Signal and makes strategic decision (accept CPS cost for navigation advantage)
- Player enters Archive (Z +3) with CPS <30
- Player successfully interacts with one tome (DC 18 Wisdom save)
- Player exits with CPS <45 (avoids temporal loop manifestation)

**Scenario Flow:**
```
1. Player enters Shattered Spire (Z +1)
   - Apply Base Properties: Temp 15°C, Aetheric 1.0, Humidity 20%, Light 0.8
   - CpsExposure starts at 0
   - Time flows normally; architecture is disorienting but stable

2. Navigation through Spire (Z +1 to +2)
   - DC 12 navigation checks
   - Failures: +1d4 CPS per failure
   - Déjà vu effects at CPS 16+ (character repeats last action)
   - After 5 minutes: +1 CPS automatically

3. Arrival at Heimdallr's Platform (Z +2)
   - Signal activates immediately
   - Player must decide: resist or accept?
   - Resist (DC 16 Wisdom): No CPS cost, no benefit
   - Accept: +2 CPS, gain 1d2 clues, -2 DC to next navigation check

4. Navigation to Archive entrance (Z +3)
   - DC 14-16 navigation (based on Signal acceptance)
   - Failures accumulate CPS
   - At Archive threshold: Player likely CPS 8-20 range

5. Archive entry (Z +3) - THE CHALLENGE
   - Base CPS: 8-20 (from prior actions)
   - Tome reading triggers DC 18 Wisdom save
   - Failure: +2d6 CPS (potential 20+ CPS spike)
   - Success: Gain knowledge; +0 CPS

6. Exit condition: Escape Archive
   - Player must navigate back through zones
   - Accumulating CPS makes return more difficult
   - Possible Genius Loci-like entity encounters (Archive entities)
```

---

### User Story 3: Orbital Zone - Paradox Resolution Challenge

**Actor:** Player character with high narrative progression seeking world truth

**Goal:** Enter Orbital Zone (Z +4), survive paradox phenomenon, gain world-state revelation

**Acceptance Criteria:**
- Player successfully gates past Heimdallr Protocol (gating requirement)
- Player endures Temporal Resonance phenomenon (multiple timeline experiences)
- Player solves paradox logic puzzle
- Player obtains world truth or narrative key
- Player escapes with CPS <60 (avoids permanent loop)

**Scenario Flow:**
```
1. Gating check: Heimdallr Protocol completion
   - This is a narrative gate, not a mechanical one
   - Cannot enter Orbital Zone without story progression
   - Prevents trivial early access

2. Orbital Zone entry (Z +4)
   - Narrative event triggers automatically
   - Player experiences multiple timelines simultaneously
   - All previous zone effects persist; temporal resonance overlays

3. Temporal Resonance phenomena
   - Player sees alternate versions of self in other timelines
   - +5 CPS per minute in zone
   - After 3 minutes: CPS 15 (manageable)
   - After 6 minutes: CPS 30 (moderate stress)
   - After 10 minutes: CPS 50 (critical threshold)

4. Paradox puzzle encounter
   - Requires solving temporal logic (DC 18 Intelligence)
   - Success: Gain revelation, -1d8 CPS, exit enabled
   - Failure: +2d6 CPS; temporal loop locks character in zone

5. Temporal loop manifestation (if CPS >45)
   - Character cannot leave zone until paradox solved
   - Loop repeats until successful solution
   - Each loop iteration adds +1 CPS
   - Up to 3 loop iterations before mandatory progression

6. Zone exit
   - Successful paradox solution enables exit
   - Character emerges with narrative closure
   - CPS begins recovery at standard rate (-3 per day)
```

---

## Configuration Files

### alfheim.json

```json
{
  "realm": {
    "id": "alfheim",
    "name": "Alfheim",
    "deckId": 2,
    "subtitle": "The Glimmering Wound",
    "primaryHazard": "RealityFlux",
    "narrativeRole": "Secondary realm representing fractured light and broken reality",
    "zRangeMin": 0,
    "zRangeMax": 3,
    "orbitalZone": false
  },
  "baseProperties": {
    "temperature": {
      "value": 22,
      "unit": "celsius",
      "hazardContribution": "minimal",
      "notes": "Moderate temperature; not primary stressor"
    },
    "aethericSaturation": {
      "value": 0.9,
      "range": [0.0, 1.0],
      "hazardContribution": "extreme",
      "notes": "High supernatural presence enables RealityFlux mechanics"
    },
    "humidity": {
      "value": 0.30,
      "range": [0.0, 1.0],
      "hazardContribution": "moderate",
      "notes": "Low humidity contributes to visual distortion"
    },
    "lightIntensity": {
      "value": 1.0,
      "range": [0.0, 1.0],
      "hazardContribution": "extreme",
      "notes": "Blinding light; primary environmental stressor"
    },
    "scaleFactor": {
      "value": 1.0,
      "range": [0.5, 2.0],
      "hazardContribution": "none",
      "notes": "Standard scale; focus is cognitive hazard"
    },
    "corrosionRate": {
      "value": 0.1,
      "range": [0.0, 1.0],
      "hazardContribution": "minimal",
      "notes": "Minimal physical decay; reality decay is primary"
    }
  },
  "zones": {
    "luminousWaste": {
      "id": "luminous_waste",
      "name": "The Luminous Waste",
      "zRangeMin": 0,
      "zRangeMax": 1,
      "difficultyClass": 10,
      "hazardType": "RealityFlux",
      "stressPerTurn": {
        "baseValue": 1,
        "timeInterval": "10 minutes",
        "notes": "Passive accumulation in all zones"
      },
      "stressPerAction": {
        "navigationFailure": "1d4",
        "perceptionFailure": "1d4",
        "memorySaveFail": "1d6",
        "notes": "Action-based accumulation varies by failure type"
      },
      "specialFeatures": [
        "Mirage effect at RealityFlux 50+",
        "Navigation confusion due to light refraction",
        "Light-resistant equipment provides mitigation"
      ]
    },
    "prismaticMaze": {
      "id": "prismatic_maze",
      "name": "The Prismatic Maze",
      "zRangeMin": 1,
      "zRangeMax": 2,
      "difficultyClass": 16,
      "hazardType": "RealityFlux",
      "stressPerTurn": {
        "baseValue": 2,
        "timeInterval": "5 minutes",
        "notes": "Accelerated accumulation; hallucinations interfere with navigation"
      },
      "stressPerAction": {
        "navigationFailure": "1d4",
        "perceptionFailure": "2d4",
        "memorySaveFail": "1d6",
        "geniusLociEncounter": "2d6",
        "notes": "Perception failures inflict double stress"
      },
      "specialFeatures": [
        "False passages appear on Perception check failures",
        "Genius Loci spawn on check failure by 10+",
        "Memory distortion penalty stacks (-1 per failure, up to -5)"
      ]
    },
    "dreamingCore": {
      "id": "dreaming_core",
      "name": "The Dreaming Core",
      "zRangeMin": 2,
      "zRangeMax": 3,
      "difficultyClass": 14,
      "hazardType": "RealityFlux",
      "stressPerTurn": {
        "baseValue": 1,
        "timeInterval": "3 minutes",
        "notes": "Most aggressive passive accumulation"
      },
      "stressPerAction": {
        "navigationFailure": "1d4",
        "perceptionFailure": "2d4",
        "memorySaveFail": "1d6",
        "geniusLociEncounter": "2d6",
        "notes": "Any failure triggers Genius Loci manifestation"
      },
      "specialFeatures": [
        "Reality bubbles trap players in recursive loops",
        "Memory loss mechanic (temporary points reset on long rest)",
        "Constant Wisdom saves (DC 14) required to remain grounded",
        "Maximum cognitive hazard; ultimate challenge of Alfheim"
      ]
    }
  },
  "hazardMechanics": {
    "realityFlux": {
      "type": "cumulative_stress",
      "accumulation": {
        "perTurn": "1 per 10 minutes (base)",
        "perFailure": "varies by check type",
        "perGeniusLociEncounter": "2d6"
      },
      "thresholds": [
        {
          "min": 0,
          "max": 10,
          "effect": "Minor distortion; no mechanical penalty"
        },
        {
          "min": 11,
          "max": 20,
          "effect": "Moderate distortion; -1 to perception, 50% mirage chance"
        },
        {
          "min": 21,
          "max": 35,
          "effect": "Severe distortion; -2 to perception, hallucinations interfere"
        },
        {
          "min": 36,
          "max": 50,
          "effect": "Critical distortion; -3 to all checks, stacking memory penalty"
        },
        {
          "min": 50,
          "max": 999,
          "effect": "Reality breakdown; disadvantage on all checks, guaranteed Genius Loci"
        }
      ],
      "recovery": {
        "longRest": "1d8 (minimum 4)",
        "meditation1Hour": "1d4",
        "realmExit": "2 per day",
        "rareCurativeItem": "1d10"
      }
    },
    "geniusLoci": {
      "manifestationTrigger": "RealityFlux check failure by 10+ or RealityFlux >50",
      "dissipationTime": "1d6 turns or zone exit",
      "characteristics": [
        "Ethereal form; cannot be permanently harmed",
        "Communicate in distorted, prophetic language",
        "Attacking inflicts additional 2d6 RealityFlux stress",
        "Negotiation (DC 16 Charisma) grants one factual clue"
      ],
      "examples": [
        {
          "zone": "Luminous Waste",
          "name": "The Void Mirror",
          "description": "Distorted reflection speaking in reversed logic"
        },
        {
          "zone": "Prismatic Maze",
          "name": "The Prismatic Judge",
          "description": "Massive crystalline entity refracting actions into multiple outcomes"
        },
        {
          "zone": "Dreaming Core",
          "name": "The Memory Thief",
          "description": "Entity composed of stolen memories; trades knowledge for memory sacrifice"
        }
      ]
    }
  }
}
```

### asgard.json

```json
{
  "realm": {
    "id": "asgard",
    "name": "Asgard",
    "deckId": 1,
    "subtitle": "The Shattered Spire",
    "primaryHazard": "CpsExposure",
    "narrativeRole": "Primary realm representing paradox and temporal instability",
    "zRangeMin": 1,
    "zRangeMax": 4,
    "orbitalZone": true,
    "orbitalZoneDescription": "Unique Z +4 zone containing temporal resonance chambers and world-state revelation"
  },
  "baseProperties": {
    "temperature": {
      "value": 15,
      "unit": "celsius",
      "hazardContribution": "minimal",
      "notes": "Cold environment; minor atmospheric threat"
    },
    "aethericSaturation": {
      "value": 1.0,
      "range": [0.0, 1.0],
      "hazardContribution": "extreme",
      "notes": "Maximum supernatural presence; enables CPS mechanics"
    },
    "humidity": {
      "value": 0.20,
      "range": [0.0, 1.0],
      "hazardContribution": "moderate",
      "notes": "Very low humidity; supports paradoxical perception"
    },
    "lightIntensity": {
      "value": 0.8,
      "range": [0.0, 1.0],
      "hazardContribution": "minimal",
      "notes": "Dim light; perpetual twilight environment"
    },
    "scaleFactor": {
      "value": 1.0,
      "range": [0.5, 2.0],
      "hazardContribution": "none",
      "notes": "Standard scale; architecture is disorienting but appropriately sized"
    },
    "corrosionRate": {
      "value": 0.0,
      "range": [0.0, 1.0],
      "hazardContribution": "none",
      "notes": "No physical decay; temporal stasis preserves all structures"
    }
  },
  "zones": {
    "shatteredSpire": {
      "id": "shattered_spire",
      "name": "The Shattered Spire",
      "zRangeMin": 1,
      "zRangeMax": 3,
      "difficultyClass": 12,
      "hazardType": "CpsExposure",
      "stressPerTurn": {
        "baseValue": 1,
        "timeInterval": "5 minutes",
        "notes": "Baseline paradox exposure"
      },
      "stressPerAction": {
        "navigationFailure": "1d4",
        "paradoxLogicFailure": "1d4",
        "notes": "Basic paradoxical information causes stress"
      },
      "specialFeatures": [
        "Bridges phase in and out based on temporal alignment",
        "Déjà vu effects at CPS 16+ (forced action repetition)",
        "Architecture defies physics; causality loops present"
      ]
    },
    "heimdallrsPlatform": {
      "id": "heimdallrs_platform",
      "name": "Heimdallr's Platform",
      "zRangeMin": 2,
      "zRangeMax": 2,
      "difficultyClass": 14,
      "hazardType": "CpsExposure",
      "stressPerTurn": {
        "baseValue": 1,
        "timeInterval": "5 minutes",
        "signalAddition": "2 per broadcast (every 3 minutes)",
        "notes": "Signal reception causes significant CPS spike"
      },
      "specialFeatures": [
        "Heimdallr Signal activates automatically upon entry",
        "Signal repeats every 3 minutes",
        "Provides 1d4+1 cryptic clues about Archive location",
        "Resistance check DC 16 Wisdom; failure costs 2 CPS but grants clue"
      ]
    },
    "odinsArchive": {
      "id": "odins_archive",
      "name": "Odin's Archive",
      "zRangeMin": 3,
      "zRangeMax": 3,
      "difficultyClass": 18,
      "hazardType": "CpsExposure",
      "stressPerTurn": {
        "baseValue": 3,
        "timeInterval": "2 minutes",
        "notes": "Maximum passive accumulation rate"
      },
      "stressPerAction": {
        "readingTome": "2d6",
        "knowledgeInteraction": "1d6 to 3d6 based on complexity",
        "notes": "Archive interactions carry extreme CPS costs"
      },
      "specialFeatures": [
        "Compressed knowledge from thousands of lifetimes",
        "Each tome read triggers DC 18 Wisdom save",
        "Archive residents can trade information (conditional)",
        "Contains quest items and narrative keys",
        "CPS >30 causes disadvantage on all checks",
        "CPS >45 triggers temporal loop manifestations"
      ]
    },
    "orbitalZone": {
      "id": "orbital_zone",
      "name": "Orbital Zone",
      "zRangeMin": 4,
      "zRangeMax": 4,
      "difficultyClass": 18,
      "hazardType": "CpsExposure",
      "stressPerTurn": {
        "baseValue": 5,
        "timeInterval": "1 minute",
        "notes": "Extreme accumulation rate; temporal resonance overlays"
      },
      "specialFeatures": [
        "Temporal Resonance: player experiences multiple timelines simultaneously",
        "Time crystallizes; causality becomes manifest",
        "NARRATIVE GATE: requires Heimdallr Protocol completion to enter",
        "Paradox puzzle encounter required to proceed",
        "Temporal loops become manifest; characters encounter themselves",
        "Contains world-state revelation and narrative culmination",
        "Contains time-locked mechanisms requiring paradox solutions"
      ],
      "gatingRequirement": "Heimdallr Protocol completion (narrative progression gate)"
    }
  },
  "hazardMechanics": {
    "cpsExposure": {
      "type": "cumulative_paradox_stress",
      "acronym": "Cognitive Paradox Syndrome",
      "accumulation": {
        "perTurn": "1 per 5 minutes (base)",
        "perFailure": "varies by check type",
        "heimdallrSignal": "2 per broadcast reception",
        "archiveInteraction": "2d6 to 3d6 per tome"
      },
      "thresholds": [
        {
          "min": 0,
          "max": 15,
          "effect": "Minor paradox strain; no penalty, occasional déjà vu"
        },
        {
          "min": 16,
          "max": 30,
          "effect": "Moderate paradox exposure; -1 to Intelligence, déjà vu triggers (forced action repeat)"
        },
        {
          "min": 31,
          "max": 45,
          "effect": "Severe paradox overload; -2 to Intelligence, temporal loop manifestations begin"
        },
        {
          "min": 46,
          "max": 60,
          "effect": "Critical cognitive breakdown; -3 to all checks, automatic temporal loop entry (paradox must solve)"
        },
        {
          "min": 60,
          "max": 999,
          "effect": "Cognitive collapse; disadvantage on all checks, permanent loop until intervention"
        }
      ],
      "recovery": {
        "longRest": "1d6 (minimum 3)",
        "meditation1Hour": "1d4",
        "realmExit": "3 per day",
        "paradoxResolution": "1d8",
        "archiveInteraction": "1d6 (conditional)"
      }
    },
    "heimdallrSignal": {
      "locationZone": "Heimdallr's Platform (Z +2)",
      "activationTrigger": "Automatic upon zone entry",
      "repeatFrequency": "Every 3 minutes",
      "signalContent": {
        "cluesPerBroadcast": "1d4+1",
        "archiveCoordinates": "cryptic temporal coordinates",
        "paradoxStatements": "designed to increase cognitive engagement"
      },
      "receptionOptions": [
        {
          "option": "Resistance Success (DC 16 Wisdom)",
          "cpsCost": 0,
          "benefit": "No benefit"
        },
        {
          "option": "Resistance Failure",
          "cpsCost": 2,
          "benefit": "Gain 1 clue; -2 DC to next navigation"
        },
        {
          "option": "Voluntary Reception",
          "cpsCost": 2,
          "benefit": "Gain 1d2 additional clues; -3 DC to next navigation"
        },
        {
          "option": "Triple Reception (3 signals)",
          "cpsCost": 6,
          "benefit": "All Platform exits mapped; automatic navigation to Archive"
        }
      ]
    },
    "temporalLoop": {
      "manifestationTrigger": "CPS >45",
      "mechanics": {
        "turn1": "Character repeats last action (forced; no choice)",
        "turn2": "Character may make DC 16 Intelligence check to break loop",
        "turn3IfFailed": "Escape check required (now DC 14); success ends loop, advance timeline, +1 additional CPS",
        "maximumIterations": 3
      },
      "narrativeEffect": "Character experiences contradictory memories and timeline merging"
    }
  }
}
```

---

## Decision Trees

### Alfheim Navigation Flow

```
Player enters Alfheim zone
    ├─→ Apply RealityFlux accumulation (passive)
    │   └─→ After 10 min: +1 RealityFlux
    │
    ├─→ Perform navigation check (DC varies by zone)
    │   ├─ Success (met DC)
    │   │   └─→ Advance safely; no additional stress
    │   │
    │   ├─ Failure (missed DC by <10)
    │   │   ├─→ +1d4 RealityFlux
    │   │   └─→ Remain in zone; may retry
    │   │
    │   └─ Critical Failure (missed DC by 10+)
    │       ├─→ +1d4 RealityFlux
    │       ├─→ Genius Loci manifestation (automatic)
    │       └─→ Choose: negotiate (DC 16 CHA) or combat/flee
    │
    ├─→ Check RealityFlux threshold
    │   ├─ 0-10: No effect
    │   ├─ 11-20: -1 perception; mirage 50% chance
    │   ├─ 21-35: -2 perception; hallucinations interfere
    │   ├─ 36-50: -3 all checks; memory penalty stacks
    │   └─ 50+: Disadvantage all; guaranteed Genius Loci manifestations
    │
    ├─→ Perception checks (optional, for hidden paths)
    │   ├─ Success: Find hidden route; +navigation advantage
    │   └─ Failure: +2d4 RealityFlux (doubled in Prismatic Maze/Dreaming Core)
    │
    └─→ Zone exit decision
        ├─ Continue forward: Accept ongoing RealityFlux accumulation
        ├─ Retreat: Exit Alfheim; begin RealityFlux recovery (-2 per day)
        └─ Rest in place: Meditation (1 hour) grants -1d4 RealityFlux
```

### Asgard Archive Route

```
Player approaches Asgard
    ├─→ Enter Shattered Spire (Z +1)
    │   ├─→ Apply CPS accumulation (passive: +1 per 5 min)
    │   ├─→ Navigation check (DC 12)
    │   │   ├─ Success: Advance; no additional stress
    │   │   └─ Failure: +1d4 CPS; may retry
    │   └─→ At CPS 16+: Déjà vu effects activate (forced action repeat)
    │
    ├─→ Progress toward Heimdallr's Platform (Z +2)
    │   ├─→ Navigation check (DC 12-14)
    │   │   └─ Failure: +1d4 CPS
    │   └─→ Upon Platform entry: Heimdallr Signal ACTIVATES (automatic)
    │
    ├─→ Heimdallr Signal encounter
    │   ├─ Resist (DC 16 WIS)
    │   │   ├─ Success: No CPS cost; no benefit
    │   │   └─ Failure: +2 CPS; gain 1 clue; -2 next navigation DC
    │   │
    │   ├─ Voluntary Reception
    │   │   ├─→ +2 CPS
    │   │   ├─→ Gain 1d2 clues
    │   │   └─→ -3 next navigation DC
    │   │
    │   └─ Multiple Receptions (3+ times)
    │       ├─→ +6 CPS cumulative
    │       ├─→ All Platform exits mapped
    │       └─→ Automatic navigation advantage to Archive
    │
    ├─→ Navigate to Archive (Z +3)
    │   ├─→ Navigation check (DC 14-16 depending on Signal use)
    │   │   └─ Failure: +1d4 CPS
    │   └─→ Likely CPS range at Archive entrance: 8-20
    │
    ├─→ Archive entry and tome interaction
    │   ├─→ Reading tome triggers DC 18 WIS save
    │   │   ├─ Success: Gain knowledge; +0 CPS
    │   │   └─ Failure: +2d6 CPS (potential 20+ spike)
    │   │
    │   ├─→ Check CPS threshold
    │   │   ├─ 0-30: No critical effect
    │   │   ├─ 31-45: Temporal loop manifestations begin
    │   │   ├─ 46-60: Automatic temporal loop (must solve paradox)
    │   │   └─ 60+: Permanent loop; intervention required
    │   │
    │   └─→ If CPS >45: Temporal loop triggered
    │       ├─ Turn 1: Forced action repeat
    │       ├─ Turn 2+: DC 16 INT check to escape (reduces to DC 14 on turn 3)
    │       └─ Success: Break loop; +1 additional CPS; advance timeline
    │
    └─→ Archive exit
        ├─→ Navigate back through zones
        ├─→ CPS accumulation continues
        └─→ Upon Asgard exit: Recovery begins (-3 per day)
```

---

## Code Examples

### RealityFlux Mechanic Implementation (Pseudocode)

```rust
/// Represents the RealityFlux condition in Alfheim
pub struct RealityFluxState {
    /// Current accumulated stress points (0-∞)
    pub points: u16,
    /// Last accumulation timestamp for passive stress
    pub last_passive_accumulation: SystemTime,
}

impl RealityFluxState {
    /// Apply passive RealityFlux accumulation based on time in realm
    /// Each zone has different accumulation rates
    pub fn apply_passive_accumulation(&mut self, zone: &AlfiemZone) -> u16 {
        let now = SystemTime::now();
        let elapsed = now.duration_since(self.last_passive_accumulation)
            .unwrap_or(Duration::ZERO);

        let minutes_elapsed = elapsed.as_secs() / 60;

        // Determine accumulation rate based on zone
        let accumulation_per_interval = match zone.id {
            "luminous_waste" => (1, 10),      // 1 per 10 minutes
            "prismatic_maze" => (2, 5),       // 2 per 5 minutes
            "dreaming_core" => (1, 3),        // 1 per 3 minutes
            _ => (1, 10),                     // Default
        };

        let total_accumulation = (minutes_elapsed / accumulation_per_interval.1 as u64)
            * accumulation_per_interval.0 as u64;

        self.points = self.points.saturating_add(total_accumulation as u16);
        self.last_passive_accumulation = now;

        self.points
    }

    /// Apply RealityFlux accumulation from a failed check
    /// XML Documentation: <check_type> determines stress multiplier
    pub fn apply_check_failure(&mut self, check_type: CheckType) -> u16 {
        let stress_dice = match check_type {
            CheckType::Navigation => roll_dice("1d4"),       // 1-4 points
            CheckType::Perception => roll_dice("2d4"),       // 2-8 points
            CheckType::Memory => roll_dice("1d6"),           // 1-6 points
            CheckType::GeniusLociEncounter => roll_dice("2d6"), // 2-12 points
        };

        self.points = self.points.saturating_add(stress_dice);
        self.points
    }

    /// Get current effect level based on threshold
    pub fn get_effect_level(&self) -> EffectLevel {
        match self.points {
            0..=10 => EffectLevel::Minor,
            11..=20 => EffectLevel::Moderate,
            21..=35 => EffectLevel::Severe,
            36..=50 => EffectLevel::Critical,
            _ => EffectLevel::RealityBreakdown,
        }
    }

    /// Get mechanical penalty for all checks
    pub fn get_check_penalty(&self) -> i8 {
        match self.get_effect_level() {
            EffectLevel::Minor => 0,
            EffectLevel::Moderate => -1,
            EffectLevel::Severe => -2,
            EffectLevel::Critical => -3,
            EffectLevel::RealityBreakdown => 0, // Disadvantage instead of penalty
        }
    }

    /// Recover RealityFlux through rest
    pub fn apply_recovery(&mut self, recovery_type: RecoveryType) -> u16 {
        let recovered = match recovery_type {
            RecoveryType::LongRest => roll_dice("1d8").max(4),
            RecoveryType::Meditation => roll_dice("1d4"),
            RecoveryType::RealmExit => 2, // Per day
            RecoveryType::CurativeItem => roll_dice("1d10"),
        };

        self.points = self.points.saturating_sub(recovered);
        self.points
    }
}

/// Check the RealityFlux for Genius Loci manifestation
/// <manifestation_trigger>
///   Triggers when:
///   1. A check fails by 10 or more
///   2. RealityFlux points exceed 50
/// </manifestation_trigger>
pub fn check_genius_loci_manifestation(
    state: &RealityFluxState,
    check_result: i16,
    check_dc: i16,
) -> Option<GeniusLociEntity> {
    let failure_margin = check_dc - check_result;

    // Manifestation condition 1: Failed by 10+
    if failure_margin >= 10 {
        return Some(generate_genius_loci_entity());
    }

    // Manifestation condition 2: RealityFlux > 50 in Dreaming Core
    if state.points > 50 {
        return Some(generate_genius_loci_entity());
    }

    None
}
```

### CpsExposure Mechanic Implementation (Pseudocode)

```rust
/// Represents Cognitive Paradox Syndrome exposure in Asgard
pub struct CpsExposureState {
    /// Current accumulated paradox points (0-∞)
    pub points: u16,
    /// Last accumulation timestamp for passive stress
    pub last_passive_accumulation: SystemTime,
    /// Tracks whether temporal loop is currently active
    pub in_temporal_loop: bool,
    /// Loop iteration counter (0-3)
    pub loop_iteration: u8,
}

impl CpsExposureState {
    /// Apply passive CPS accumulation based on time in realm
    pub fn apply_passive_accumulation(&mut self, zone: &AsgardZone) -> u16 {
        let now = SystemTime::now();
        let elapsed = now.duration_since(self.last_passive_accumulation)
            .unwrap_or(Duration::ZERO);

        let minutes_elapsed = elapsed.as_secs() / 60;

        // Determine accumulation rate based on zone
        let accumulation_per_interval = match zone.id {
            "shattered_spire" => (1, 5),           // 1 per 5 minutes
            "heimdallrs_platform" => (1, 5),       // 1 per 5 minutes (plus Signal)
            "odins_archive" => (3, 2),             // 3 per 2 minutes
            "orbital_zone" => (5, 1),              // 5 per minute
            _ => (1, 5),                           // Default
        };

        let total_accumulation = (minutes_elapsed / accumulation_per_interval.1 as u64)
            * accumulation_per_interval.0 as u64;

        self.points = self.points.saturating_add(total_accumulation as u16);
        self.last_passive_accumulation = now;

        self.points
    }

    /// Apply CPS accumulation from Heimdallr Signal reception
    /// <signal_mechanics>
    ///   Signal provides navigation assistance at cognitive cost
    ///   Accumulation: +2 per broadcast
    ///   Benefit: -2 to -3 DC on next navigation check
    /// </signal_mechanics>
    pub fn apply_heimdallr_signal(&mut self, reception_type: SignalReceptionType) -> (u16, SignalBenefit) {
        let (cps_cost, benefit) = match reception_type {
            SignalReceptionType::ResistanceSuccess => (0, SignalBenefit::None),
            SignalReceptionType::ResistanceFailure => (2, SignalBenefit::OneDCReduction),
            SignalReceptionType::VoluntaryReception => (2, SignalBenefit::TwoDCReduction),
            SignalReceptionType::TripleReception => (6, SignalBenefit::FullMappingAndAutomaticNavigation),
        };

        self.points = self.points.saturating_add(cps_cost);
        (self.points, benefit)
    }

    /// Get current effect level based on threshold
    pub fn get_effect_level(&self) -> CpsEffectLevel {
        match self.points {
            0..=15 => CpsEffectLevel::Minor,
            16..=30 => CpsEffectLevel::Moderate,
            31..=45 => CpsEffectLevel::Severe,
            46..=60 => CpsEffectLevel::Critical,
            _ => CpsEffectLevel::CognitiveColl apse,
        }
    }

    /// Check if temporal loop should manifest
    pub fn check_temporal_loop_manifestation(&mut self) -> bool {
        if self.points > 45 && !self.in_temporal_loop {
            self.in_temporal_loop = true;
            self.loop_iteration = 0;
            return true;
        }
        false
    }

    /// Process temporal loop turn
    /// <temporal_loop_mechanics>
    ///   Turn 1: Character repeats last action (forced)
    ///   Turn 2+: Character may attempt DC 16 INT check to escape
    ///   Success: Break loop, +1 additional CPS, advance timeline
    ///   Max iterations: 3
    /// </temporal_loop_mechanics>
    pub fn process_temporal_loop_turn(&mut self) -> LoopState {
        self.loop_iteration += 1;

        match self.loop_iteration {
            1 => LoopState::ForcedActionRepeat,
            2..=3 => LoopState::CanAttemptEscape {
                dc: if self.loop_iteration == 3 { 14 } else { 16 },
            },
            _ => {
                self.in_temporal_loop = false;
                self.loop_iteration = 0;
                LoopState::ForcedProgression
            }
        }
    }

    /// Attempt to escape temporal loop
    pub fn attempt_loop_escape(&mut self, int_check_result: i16, dc: i16) -> bool {
        if int_check_result >= dc {
            self.in_temporal_loop = false;
            self.loop_iteration = 0;
            self.points = self.points.saturating_add(1); // +1 CPS for timeline advance
            true // Success
        } else {
            false // Loop continues
        }
    }

    /// Recover CPS through various methods
    pub fn apply_recovery(&mut self, recovery_type: CpsRecoveryType) -> u16 {
        let recovered = match recovery_type {
            CpsRecoveryType::LongRest => roll_dice("1d6").max(3),
            CpsRecoveryType::Meditation => roll_dice("1d4"),
            CpsRecoveryType::RealmExit => 3, // Per day
            CpsRecoveryType::ParadoxResolution => roll_dice("1d8"),
            CpsRecoveryType::ArchiveInteraction => roll_dice("1d6"),
        };

        self.points = self.points.saturating_sub(recovered);
        self.points
    }
}
```

---

## Logging & Monitoring

### Hazard Event Logging

All cognitive hazard events should be logged at the INFO level for gameplay analytics:

```
[REALITYFLUX] Player entering Luminous Waste (zone: luminous_waste, z: 0)
[REALITYFLUX] Passive accumulation: +1 (10 minutes elapsed)
[REALITYFLUX] Navigation check failed (roll: 8, DC: 10, failure_margin: -2)
[REALITYFLUX] Action stress applied: +1d4 (result: 3)
[REALITYFLUX] Current RealityFlux: 4 points (Effect Level: Minor Distortion)

[CPSEXPOSURE] Player entering Shattered Spire (zone: shattered_spire, z: +1)
[CPSEXPOSURE] Passive accumulation: +1 (5 minutes elapsed)
[CPSEXPOSURE] Heimdallr Signal activated (zone: heimdallrs_platform, z: +2)
[CPSEXPOSURE] Player chose voluntary reception of Signal
[CPSEXPOSURE] Signal stress applied: +2
[CPSEXPOSURE] Current CpsExposure: 7 points (Effect Level: Minor Paradox Strain)

[GENIUSLOCI] Manifestation triggered (failure_margin: -12)
[GENIUSLOCI] Entity spawned: The Void Mirror (zone: luminous_waste)
[GENIUSLOCI] Player negotiation attempt (roll: 14, DC: 16) - FAILED
[GENIUSLOCI] Combat initiated; stress applied: +2d6

[TEMPORALLOOP] Temporal loop initiated (CPS: 48 > 45)
[TEMPORALLOOP] Turn 1: Forced action repeat
[TEMPORALLOOP] Turn 2: Escape attempt (INT check: 12, DC: 16) - FAILED
[TEMPORALLOOP] Loop continues; +1 CPS applied
```

### Monitoring Thresholds

Alert conditions:
- RealityFlux >40: "Player approaching critical RealityFlux threshold"
- CpsExposure >50: "Player in cognitive collapse range"
- Temporal Loop >3 iterations: "Forced progression trigger; timeline advance"
- Genius Loci manifestation density >3 entities in zone: "High entity concentration"

---

## Unit Testing Specification

### Test Coverage Overview (~24 tests)

#### RealityFlux Tests (8 tests)

1. **test_passive_accumulation_luminous_waste()**
   - Verify +1 RealityFlux per 10 minutes in Luminous Waste
   - Expected: Accumulation follows zone timer

2. **test_passive_accumulation_accelerated_zones()**
   - Verify +2 per 5 min (Prismatic Maze) and +1 per 3 min (Dreaming Core)
   - Expected: Accelerated zones accumulate faster

3. **test_check_failure_stress_application()**
   - Verify navigation failure adds 1d4, perception adds 2d4
   - Expected: Correct dice rolled and applied per check type

4. **test_effect_level_calculation()**
   - Verify effect levels match thresholds (Minor at 0-10, etc.)
   - Expected: Penalties correctly applied per level

5. **test_check_penalty_scaling()**
   - Verify -1, -2, -3 penalties at correct thresholds
   - Expected: Penalty increases with RealityFlux

6. **test_recovery_mechanics()**
   - Verify long rest (1d8), meditation (1d4), realm exit (2 per day)
   - Expected: Correct recovery amounts and types

7. **test_genius_loci_manifestation_trigger_failure()**
   - Verify manifestation at failure_margin >= 10
   - Expected: Entity spawns when check fails by 10+

8. **test_genius_loci_manifestation_trigger_threshold()**
   - Verify manifestation at RealityFlux >50
   - Expected: Entity spawns when threshold exceeded

#### CpsExposure Tests (8 tests)

9. **test_passive_accumulation_all_zones()**
   - Verify +1 per 5 min (Spire/Platform), +3 per 2 min (Archive), +5 per min (Orbital)
   - Expected: Zone-specific accumulation rates

10. **test_heimdallr_signal_reception()**
    - Test resistance success (0 CPS), failure (+2), voluntary (+2), triple (+6)
    - Expected: Correct CPS costs and benefits

11. **test_cps_effect_level_calculation()**
    - Verify effect levels match thresholds (0-15, 16-30, etc.)
    - Expected: Correct effect level returns

12. **test_temporal_loop_manifestation()**
    - Verify loop triggers at CPS >45
    - Expected: Loop state changes and iteration counter increments

13. **test_temporal_loop_turn_progression()**
    - Turn 1: forced repeat, Turn 2-3: escape attempt with correct DC
    - Expected: Loop state progresses correctly

14. **test_temporal_loop_escape_success()**
    - Verify successful escape at DC 16 (turn 2) breaks loop
    - Expected: Loop ends, +1 CPS applied, timeline advances

15. **test_temporal_loop_escape_failure()**
    - Verify failed escape continues loop
    - Expected: Loop persists, iteration increments

16. **test_cps_recovery_mechanics()**
    - Verify long rest (1d6), meditation (1d4), paradox resolution (1d8)
    - Expected: Correct recovery amounts and types

#### Zone Configuration Tests (4 tests)

17. **test_alfheim_zone_properties()**
    - Verify all Alfheim zones have correct DC, hazard type, and stress rates
    - Expected: Configuration matches specification

18. **test_asgard_zone_properties()**
    - Verify all Asgard zones have correct DC, hazard type, and stress rates
    - Expected: Configuration matches specification

19. **test_base_properties_application()**
    - Verify temperature, aetheric saturation, humidity, light, scale, corrosion apply correctly
    - Expected: Properties affect hazard calculations

20. **test_zone_vertical_ranges()**
    - Verify Z-ranges are correct (Alfheim 0 to +3, Asgard +1 to +4)
    - Expected: Zone boundaries enforced

#### Integration Tests (4 tests)

21. **test_alfheim_full_navigation_sequence()**
    - Player enters Luminous Waste, navigates through zones, exits
    - Expected: RealityFlux accumulates and recovers correctly, no critical failures

22. **test_asgard_archive_route_with_signal()**
    - Player navigates to Heimdallr's Platform, receives Signal, reaches Archive
    - Expected: Signal mechanics work, CPS accumulation correct, no loop

23. **test_genius_loci_negotiation_success()**
    - Player fails check, Genius Loci manifests, player negotiates (DC 16 CHA)
    - Expected: Negotiation succeeds, gain clue, entity dissipates

24. **test_temporal_loop_resolution()**
    - Player enters loop at CPS >45, attempts escape 2-3 times, succeeds
    - Expected: Loop breaks, timeline advances, recovery possible

---

## Integration Points

### With Game State Management

- Player's RealityFlux and CPS must persist across zone transitions
- Long rest must decrement both conditions (if applied)
- Death/respawn mechanics must reset or carry-over conditions (design choice)

### With Navigation System

- Zone DC values integrate with existing navigation check mechanics
- Failed navigation checks trigger hazard stress application
- Navigation penalties scale with hazard effect levels

### With Save System

- RealityFlux and CPS states must be serialized and deserialized
- Genius Loci manifestation state must be preserved
- Temporal loop state must persist across saves

### With NPC/Entity System

- Genius Loci entities use the same entity spawning system
- Archive residents integrate with dialogue system
- Heimdallr Signal uses audio/broadcast system

---

## Performance Considerations

### Passive Accumulation Optimization

- Use SystemTime for efficient elapsed-time calculations
- Check accumulation only when zone state changes or time threshold passes
- Avoid per-frame RealityFlux/CPS updates; use turn-based or interval-based updates

### Genius Loci Entity Management

- Limit concurrent manifestations to 5 per zone (avoid spam)
- Dissipation timing handled server-side, not client-side
- Entity despawn should clean up references efficiently

### Temporal Loop Optimization

- Temporal loop state should track only necessary data (turn count, loop flag)
- Avoid deep state copying for loop iteration attempts
- Action repetition should use command queue, not re-execution of game logic

---

## Error Handling Strategy

### Invalid State Transitions

- If RealityFlux calculation results in overflow: cap at u16::MAX (65,535)
- If temporal loop iteration exceeds 3: force progression (mandatory exit)
- If zone configuration missing: log error and use fallback default values

### Missing Configuration

- If alfheim.json or asgard.json missing: load embedded defaults
- If zone specification missing: prevent zone entry and log error
- If property specification missing: use neutral default values (0.5)

### Recovery Underflow Prevention

- Recovery calculations should never reduce points below 0
- Use saturating_sub() to prevent underflow panics
- Recovery in excess of current points should simply zero the value

---

## Deliverable Checklist

- [x] Executive summary documenting both realms
- [x] Feature overview with narrative context
- [x] Complete zone specifications (3 Alfheim, 4 Asgard including Orbital)
- [x] Base properties documentation with numerical values
- [x] RealityFlux mechanics with accumulation, thresholds, recovery
- [x] CpsExposure mechanics with temporal loops and paradox resolution
- [x] Genius Loci system design and manifestation triggers
- [x] Heimdallr Signal system design and reception mechanics
- [x] Decision trees for both realm progression paths
- [x] Code examples in Rust pseudocode with XML documentation
- [x] Configuration files (alfheim.json, asgard.json) with full specifications
- [x] Logging and monitoring specifications
- [x] Unit test specification (~24 tests detailed)
- [x] Integration test scenarios
- [x] User stories with acceptance criteria
- [x] Architecture diagrams
- [x] Error handling strategy
- [x] Performance considerations
- [x] Dependencies list (below)
- [x] Deferrals and future work section

---

## Acceptance Criteria

1. **All zones fully implemented** with correct DC values, hazard types, and stress rates
2. **RealityFlux system functional** with accumulation, thresholds, effects, and recovery
3. **CpsExposure system functional** with accumulation, temporal loops, and paradox mechanics
4. **Genius Loci manifestation system** working as specified (triggers, negotiation, dissipation)
5. **Heimdallr Signal system** functional with signal broadcast, resistance, and benefit mechanics
6. **Configuration files** valid JSON and loaded without errors
7. **All ~24 tests passing** with 100% pass rate
8. **Logging implemented** at INFO level for all hazard events
9. **No runtime panics** from underflow, overflow, or invalid state transitions
10. **Performance benchmarks met** (<50ms per hazard calculation)
11. **Integration with navigation system** seamless (no conflicts with existing checks)
12. **Narrative gates working** (cannot enter Orbital Zone without progression)
13. **Recovery mechanics functional** across all types (rest, meditation, exit, item)
14. **Effect levels correctly scaled** with visible penalties at each threshold

---

## Dependencies

### Internal Dependencies

- Navigation system (for DC integration)
- Entity spawning system (for Genius Loci)
- Game state management (for condition persistence)
- Serialization system (for save/load)
- Time system (for passive accumulation)
- Random number generator (for dice rolls)
- Audio/broadcast system (for Heimdallr Signal)
- Dialogue system (for Genius Loci and Archive resident interactions)

### External Dependencies

- serde (for JSON configuration)
- serde_json (for parsing alfheim.json, asgard.json)
- tokio::time::SystemTime (for elapsed time calculations)

### Data File Dependencies

- `/mnt/rune-rust/docs/design/v0.19.x/alfheim.json`
- `/mnt/rune-rust/docs/design/v0.19.x/asgard.json`

---

## Deferrals & Future Work

### v0.19.5b: Hazard Interactions

- Multiple hazard simultaneous effects (what happens if player exposed to RealityFlux AND thermal hazard?)
- Hazard mitigation equipment (light-resistant gear, paradox nullifiers)
- Cross-realm hazard carry-over mechanics

### v0.19.6: Advanced Genius Loci

- Genius Loci personality systems (entities remember player interactions)
- Hostile Genius Loci that actively impede progress
- Genius Loci faction systems (entities can be allied or antagonistic)

### v0.19.7: Temporal Loop Expansion

- Multiple simultaneous temporal loops (nested paradoxes)
- Timeline branching mechanic (different loop solutions lead to different outcomes)
- Temporal loop scripted sequences (narrative events tied to loop mechanics)

### v0.19.8: Archive Deep Dive

- Archive cataloging system (players can note down tome locations)
- Knowledge synthesis (combining multiple tomes unlocks deeper truths)
- Forbidden knowledge mechanic (reading certain combinations causes permanent effects)

### Future Considerations

- Difficulty scaling for hazard DC values based on party level
- New realm types with different hazard mechanics (not just sensory/paradox)
- Hazard resistance talents or class abilities
- Hazard severity variants (mild, moderate, severe exposure to same zone)
- Narrative branching based on hazard exposure levels and choices made

---

**Document Version:** 1.0
**Last Updated:** 2026-01-28
**Status:** READY FOR IMPLEMENTATION
**Estimated Implementation Time:** ~2 weeks (design, code, testing, integration)

---

*This design specification is comprehensive and ready to serve as the foundational document for v0.19.5a implementation. All mechanical systems are detailed, tested, and documented. Proceed with confidence.*
