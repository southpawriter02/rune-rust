# v0.8.1b Design Specification: Quest Log Window

**Version:** 0.8.1b
**Parent:** v0.8.1 (Navigation & Information)
**Prerequisites:** v0.8.1a Complete (Map View Panel)
**Status:** Design Complete
**Estimated Unit Tests:** ~13

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Quest Log Window](#4-quest-log-window)
5. [Quest Entry Control](#5-quest-entry-control)
6. [Objective List Control](#6-objective-list-control)
7. [View Models](#7-view-models)
8. [Tracked Quest HUD](#8-tracked-quest-hud)
9. [Styles](#9-styles)
10. [Data Model Changes](#10-data-model-changes)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)

---

## 1. Overview

### Purpose

Implement a quest log window that displays active and completed quests with details including objectives, progress, and rewards. Players can track a single active quest for on-screen HUD display, providing constant awareness of their current goal. The window supports real-time updates when quest progress changes.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Windows** | `QuestLogWindow` |
| **Controls** | `QuestEntryControl`, `ObjectiveListControl`, `TrackedQuestHud` |
| **ViewModels** | `QuestLogViewModel`, `QuestEntryViewModel`, `ObjectiveViewModel`, `RewardViewModel` |
| **Styles** | `QuestLogStyles.axaml` |
| **Tests** | ~13 unit tests |

### Design Principles

1. **Master-Detail Layout**: Quest list + details side-by-side
2. **Progress Visibility**: Clear progress indicators for all objectives
3. **Quest Tracking**: HUD display for currently tracked quest
4. **Real-Time Updates**: Quest changes reflected immediately
5. **Collapsible Sections**: Completed quests can be hidden

---

## 2. Feature Overview

```
v0.8.1b Features
â”œâ”€â”€ QuestLogWindow (Modal)
â”‚   â”œâ”€â”€ Active quests section
â”‚   â”œâ”€â”€ Completed quests section (collapsible)
â”‚   â”œâ”€â”€ Quest details panel
â”‚   â”œâ”€â”€ Track Quest button
â”‚   â””â”€â”€ J key toggle
â”‚
â”œâ”€â”€ QuestEntryControl
â”‚   â”œâ”€â”€ Quest title
â”‚   â”œâ”€â”€ Tracked indicator (â˜…)
â”‚   â”œâ”€â”€ Completion indicator (âœ“)
â”‚   â””â”€â”€ Selection highlight
â”‚
â”œâ”€â”€ ObjectiveListControl
â”‚   â”œâ”€â”€ Objective checkmarks (â˜‘/â˜)
â”‚   â”œâ”€â”€ Progress counter (2/5)
â”‚   â””â”€â”€ Completion styling
â”‚
â”œâ”€â”€ Quest Details View
â”‚   â”œâ”€â”€ Quest title + description
â”‚   â”œâ”€â”€ Objectives list
â”‚   â”œâ”€â”€ Rewards display
â”‚   â”œâ”€â”€ Progress bar + percentage
â”‚   â””â”€â”€ Track Quest button
â”‚
â”œâ”€â”€ TrackedQuestHud
â”‚   â”œâ”€â”€ Tracked quest title
â”‚   â”œâ”€â”€ Current objectives
â”‚   â””â”€â”€ Minimal footprint
â”‚
â”œâ”€â”€ QuestLogViewModel
â”‚   â”œâ”€â”€ Active quests collection
â”‚   â”œâ”€â”€ Completed quests collection
â”‚   â”œâ”€â”€ Selected quest binding
â”‚   â”œâ”€â”€ Tracked quest ID
â”‚   â””â”€â”€ Quest service integration
â”‚
â”œâ”€â”€ QuestEntryViewModel
â”‚   â”œâ”€â”€ Quest data wrapper
â”‚   â”œâ”€â”€ Objectives collection
â”‚   â”œâ”€â”€ Rewards collection
â”‚   â”œâ”€â”€ Progress calculation
â”‚   â””â”€â”€ Tracked state
â”‚
â””â”€â”€ Keyboard Integration
    â””â”€â”€ J key opens quest log
```

---

## 3. Architecture

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PRESENTATION LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Windows                                                                â”‚
â”‚  â””â”€â”€ QuestLogWindow : Window                                           â”‚
â”‚       â”œâ”€â”€ Active Quests ListView                                       â”‚
â”‚       â”œâ”€â”€ Completed Quests ListView (collapsible)                      â”‚
â”‚       â””â”€â”€ Quest Details Panel                                          â”‚
â”‚                                                                         â”‚
â”‚  Controls                                                               â”‚
â”‚  â”œâ”€â”€ QuestEntryControl : TemplatedControl                              â”‚
â”‚  â”‚    â”œâ”€â”€ Title (styled property)                                      â”‚
â”‚  â”‚    â”œâ”€â”€ IsCompleted (styled property)                                â”‚
â”‚  â”‚    â”œâ”€â”€ IsTracked (styled property)                                  â”‚
â”‚  â”‚    â””â”€â”€ IsSelected (styled property)                                 â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ ObjectiveListControl : ItemsControl                               â”‚
â”‚  â”‚    â””â”€â”€ ObjectiveViewModel items                                     â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ TrackedQuestHud : UserControl                                     â”‚
â”‚       â”œâ”€â”€ Quest title                                                  â”‚
â”‚       â””â”€â”€ Current objectives                                           â”‚
â”‚                                                                         â”‚
â”‚  ViewModels                                                             â”‚
â”‚  â”œâ”€â”€ QuestLogViewModel : ViewModelBase                                 â”‚
â”‚  â”‚    â”œâ”€â”€ ObservableCollection<QuestEntryViewModel> ActiveQuests       â”‚
â”‚  â”‚    â”œâ”€â”€ ObservableCollection<QuestEntryViewModel> CompletedQuests    â”‚
â”‚  â”‚    â”œâ”€â”€ QuestEntryViewModel? SelectedQuest                           â”‚
â”‚  â”‚    â”œâ”€â”€ Guid? TrackedQuestId                                         â”‚
â”‚  â”‚    â”œâ”€â”€ bool ShowCompletedQuests                                     â”‚
â”‚  â”‚    â”œâ”€â”€ [RelayCommand] SelectQuest()                                 â”‚
â”‚  â”‚    â”œâ”€â”€ [RelayCommand] TrackQuest()                                  â”‚
â”‚  â”‚    â””â”€â”€ [RelayCommand] ToggleCompletedQuests()                       â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ QuestEntryViewModel : ViewModelBase                               â”‚
â”‚  â”‚    â”œâ”€â”€ Guid QuestId                                                 â”‚
â”‚  â”‚    â”œâ”€â”€ string Title, Description                                    â”‚
â”‚  â”‚    â”œâ”€â”€ ObservableCollection<ObjectiveViewModel> Objectives          â”‚
â”‚  â”‚    â”œâ”€â”€ ObservableCollection<RewardViewModel> Rewards                â”‚
â”‚  â”‚    â”œâ”€â”€ bool IsCompleted, IsTracked                                  â”‚
â”‚  â”‚    â”œâ”€â”€ double ProgressPercentage                                    â”‚
â”‚  â”‚    â””â”€â”€ string ProgressText                                          â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ ObjectiveViewModel : ViewModelBase                                â”‚
â”‚  â”‚    â”œâ”€â”€ string Description                                           â”‚
â”‚  â”‚    â”œâ”€â”€ bool IsCompleted                                             â”‚
â”‚  â”‚    â”œâ”€â”€ int CurrentProgress, RequiredProgress                        â”‚
â”‚  â”‚    â””â”€â”€ bool HasProgress                                             â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ RewardViewModel : ViewModelBase                                   â”‚
â”‚       â”œâ”€â”€ string Type (XP, Gold, Item, Unlock)                         â”‚
â”‚       â”œâ”€â”€ string Description                                           â”‚
â”‚       â””â”€â”€ string Icon                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       APPLICATION LAYER                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Services                                                               â”‚
â”‚  â””â”€â”€ IQuestService                                                     â”‚
â”‚       â”œâ”€â”€ GetActiveQuests(): IReadOnlyList<Quest>                      â”‚
â”‚       â”œâ”€â”€ GetCompletedQuests(): IReadOnlyList<Quest>                   â”‚
â”‚       â”œâ”€â”€ GetQuest(questId): Quest?                                    â”‚
â”‚       â”œâ”€â”€ SetTrackedQuest(questId): void                               â”‚
â”‚       â”œâ”€â”€ GetTrackedQuestId(): Guid?                                   â”‚
â”‚       â””â”€â”€ event OnQuestUpdated(Quest quest)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DOMAIN LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Entities                                                               â”‚
â”‚  â””â”€â”€ Quest                                                              â”‚
â”‚       â”œâ”€â”€ Guid Id                                                       â”‚
â”‚       â”œâ”€â”€ string Title                                                  â”‚
â”‚       â”œâ”€â”€ string Description                                            â”‚
â”‚       â”œâ”€â”€ QuestStatus Status                                            â”‚
â”‚       â”œâ”€â”€ IReadOnlyList<QuestObjective> Objectives                     â”‚
â”‚       â””â”€â”€ IReadOnlyList<QuestReward> Rewards                           â”‚
â”‚                                                                         â”‚
â”‚  Value Objects                                                          â”‚
â”‚  â”œâ”€â”€ QuestObjective                                                     â”‚
â”‚  â”‚    â”œâ”€â”€ string Description                                           â”‚
â”‚  â”‚    â”œâ”€â”€ int CurrentProgress, RequiredProgress                        â”‚
â”‚  â”‚    â””â”€â”€ bool IsCompleted                                              â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ QuestReward                                                        â”‚
â”‚       â”œâ”€â”€ RewardType Type                                              â”‚
â”‚       â”œâ”€â”€ string Description                                           â”‚
â”‚       â””â”€â”€ int Amount                                                   â”‚
â”‚                                                                         â”‚
â”‚  Enums                                                                  â”‚
â”‚  â”œâ”€â”€ QuestStatus { NotStarted, Active, Completed, Failed }             â”‚
â”‚  â””â”€â”€ RewardType { Experience, Gold, Item, Unlock }                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quest Update Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      QUEST UPDATE FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Quest Progress Event (e.g., enemy killed, item collected)
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IQuestService.OnQuestUpdated                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Objective progress updated in domain                               â”‚
â”‚  2. Quest completion checked                                           â”‚
â”‚  3. OnQuestUpdated event fired                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              QuestLogViewModel.HandleQuestUpdated()                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Find QuestEntryViewModel for quest                                 â”‚
â”‚  2. Update objectives and progress                                     â”‚
â”‚  3. Move to completed if status changed                                â”‚
â”‚  4. Update TrackedQuestHud if tracked                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”œâ”€â”€â”€â–º Quest Log Window updates (if open)
                        â”‚
                        â””â”€â”€â”€â–º Tracked Quest HUD updates (always visible)
```

---

## 4. Quest Log Window

### QuestLogWindow.axaml

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/QuestLogWindow.axaml`

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
        xmlns:controls="using:RuneAndRust.Avalonia.Controls"
        x:Class="RuneAndRust.Avalonia.Views.QuestLogWindow"
        x:DataType="vm:QuestLogViewModel"
        Title="Quest Log"
        Width="700" Height="550"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ShowInTaskbar="False">
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <Border Grid.Row="0" Classes="quest-header" Padding="16,12">
            <TextBlock Text="QUEST LOG" Classes="window-title" />
        </Border>
        
        <!-- Content -->
        <Grid Grid.Row="1" ColumnDefinitions="250,*">
            
            <!-- Quest List (Left Panel) -->
            <Border Grid.Column="0" Classes="quest-list-panel">
                <ScrollViewer>
                    <StackPanel Margin="8">
                        
                        <!-- Active Quests Section -->
                        <StackPanel>
                            <TextBlock Text="{Binding ActiveQuestHeader}" 
                                       Classes="section-header" 
                                       Margin="0,0,0,8" />
                            
                            <ItemsControl ItemsSource="{Binding ActiveQuests}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:QuestEntryViewModel">
                                        <controls:QuestEntryControl
                                            Title="{Binding Title}"
                                            IsTracked="{Binding IsTracked}"
                                            IsCompleted="False"
                                            IsSelected="{Binding IsSelected}"
                                            PointerPressed="OnQuestEntryPressed" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        
                        <!-- Completed Quests Section (Collapsible) -->
                        <StackPanel Margin="0,16,0,0">
                            <Button Classes="section-toggle"
                                    Command="{Binding ToggleCompletedQuestsCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding CompletedExpander}" 
                                               Margin="0,0,8,0" />
                                    <TextBlock Text="{Binding CompletedQuestHeader}" 
                                               Classes="section-header" />
                                </StackPanel>
                            </Button>
                            
                            <ItemsControl ItemsSource="{Binding CompletedQuests}"
                                          IsVisible="{Binding ShowCompletedQuests}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate DataType="vm:QuestEntryViewModel">
                                        <controls:QuestEntryControl
                                            Title="{Binding Title}"
                                            IsTracked="False"
                                            IsCompleted="True"
                                            IsSelected="{Binding IsSelected}"
                                            PointerPressed="OnQuestEntryPressed" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <!-- Quest Details (Right Panel) -->
            <Border Grid.Column="1" Classes="quest-details-panel" Padding="16">
                <ScrollViewer>
                    <StackPanel IsVisible="{Binding HasSelectedQuest}">
                        
                        <!-- Quest Title -->
                        <TextBlock Text="{Binding SelectedQuest.Title}" 
                                   Classes="quest-title" />
                        <Border Classes="separator" Margin="0,8,0,12" />
                        
                        <!-- Quest Description -->
                        <TextBlock Text="{Binding SelectedQuest.Description}" 
                                   TextWrapping="Wrap"
                                   Classes="quest-description"
                                   Margin="0,0,0,16" />
                        
                        <!-- Objectives Section -->
                        <TextBlock Text="OBJECTIVES:" Classes="details-header" />
                        <Border Classes="separator" Margin="0,4,0,8" />
                        
                        <controls:ObjectiveListControl 
                            Objectives="{Binding SelectedQuest.Objectives}" />
                        
                        <!-- Rewards Section -->
                        <TextBlock Text="REWARDS:" 
                                   Classes="details-header" 
                                   Margin="0,16,0,0" />
                        <Border Classes="separator" Margin="0,4,0,8" />
                        
                        <ItemsControl ItemsSource="{Binding SelectedQuest.Rewards}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="vm:RewardViewModel">
                                    <StackPanel Orientation="Horizontal" Margin="0,4">
                                        <TextBlock Text="â€¢" Margin="0,0,8,0" />
                                        <TextBlock Text="{Binding Icon}" Margin="0,0,4,0" />
                                        <TextBlock Text="{Binding Description}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Progress Section -->
                        <StackPanel Margin="0,16,0,0">
                            <TextBlock Text="{Binding SelectedQuest.ProgressText}" 
                                       Classes="progress-text" />
                            <ProgressBar Value="{Binding SelectedQuest.ProgressPercentage}"
                                         Maximum="100"
                                         Classes="quest-progress"
                                         Margin="0,4,0,0" />
                        </StackPanel>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
        </Grid>
        
        <!-- Footer -->
        <Border Grid.Row="2" Classes="quest-footer" Padding="16,12">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <StackPanel Grid.Column="0" 
                            Orientation="Horizontal"
                            IsVisible="{Binding CanTrackQuest}">
                    <TextBlock Text="â˜…" 
                               Foreground="Gold" 
                               Margin="0,0,4,0"
                               IsVisible="{Binding SelectedQuest.IsTracked}" />
                    <TextBlock Text="{Binding TrackingStatus}" 
                               Classes="tracking-status" />
                </StackPanel>
                
                <Button Grid.Column="1"
                        Content="â˜… Track Quest"
                        Command="{Binding TrackQuestCommand}"
                        IsVisible="{Binding CanTrackQuest}"
                        Classes="track-button"
                        Margin="0,0,8,0" />
                
                <Button Grid.Column="2"
                        Content="Close"
                        Command="{Binding CloseCommand}"
                        Classes="close-button" />
            </Grid>
        </Border>
        
    </Grid>
</Window>
```

### QuestLogWindow Code-Behind

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/QuestLogWindow.axaml.cs`

```csharp
namespace RuneAndRust.Avalonia.Views;

public partial class QuestLogWindow : Window
{
    public QuestLogWindow()
    {
        InitializeComponent();
    }

    private void OnQuestEntryPressed(object? sender, PointerPressedEventArgs e)
    {
        if (sender is QuestEntryControl control && 
            DataContext is QuestLogViewModel vm &&
            control.DataContext is QuestEntryViewModel quest)
        {
            vm.SelectQuestCommand.Execute(quest);
        }
    }
}
```

---

## 5. Quest Entry Control

### QuestEntryControl

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/QuestEntryControl.cs`

```csharp
namespace RuneAndRust.Avalonia.Controls;

/// <summary>
/// Displays a quest entry in the quest list.
/// </summary>
/// <remarks>
/// Shows the quest title with indicators for tracked (â˜…) and completed (âœ“) states.
/// Provides visual feedback for selection and hover states.
/// </remarks>
public class QuestEntryControl : TemplatedControl
{
    public static readonly StyledProperty<string> TitleProperty =
        AvaloniaProperty.Register<QuestEntryControl, string>(nameof(Title), "");

    public static readonly StyledProperty<bool> IsTrackedProperty =
        AvaloniaProperty.Register<QuestEntryControl, bool>(nameof(IsTracked), false);

    public static readonly StyledProperty<bool> IsCompletedProperty =
        AvaloniaProperty.Register<QuestEntryControl, bool>(nameof(IsCompleted), false);

    public static readonly StyledProperty<bool> IsSelectedProperty =
        AvaloniaProperty.Register<QuestEntryControl, bool>(nameof(IsSelected), false);

    /// <summary>
    /// Gets or sets the quest title.
    /// </summary>
    public string Title
    {
        get => GetValue(TitleProperty);
        set => SetValue(TitleProperty, value);
    }

    /// <summary>
    /// Gets or sets whether this quest is currently tracked.
    /// </summary>
    public bool IsTracked
    {
        get => GetValue(IsTrackedProperty);
        set => SetValue(IsTrackedProperty, value);
    }

    /// <summary>
    /// Gets or sets whether this quest is completed.
    /// </summary>
    public bool IsCompleted
    {
        get => GetValue(IsCompletedProperty);
        set => SetValue(IsCompletedProperty, value);
    }

    /// <summary>
    /// Gets or sets whether this quest is currently selected.
    /// </summary>
    public bool IsSelected
    {
        get => GetValue(IsSelectedProperty);
        set => SetValue(IsSelectedProperty, value);
    }
}
```

### QuestEntryControl Template

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/QuestEntryControl.axaml`

```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="using:RuneAndRust.Avalonia.Controls">
    
    <ControlTheme x:Key="{x:Type controls:QuestEntryControl}" 
                  TargetType="controls:QuestEntryControl">
        
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="Margin" Value="0,2" />
        
        <Setter Property="Template">
            <ControlTemplate>
                <Border x:Name="EntryBorder"
                        Padding="8,6"
                        CornerRadius="4"
                        Background="Transparent"
                        BorderThickness="1"
                        BorderBrush="Transparent">
                    <Grid ColumnDefinitions="Auto,Auto,*">
                        
                        <!-- Tracked Indicator -->
                        <TextBlock Grid.Column="0"
                                   Text="â˜…"
                                   Foreground="Gold"
                                   FontSize="12"
                                   Margin="0,0,6,0"
                                   IsVisible="{TemplateBinding IsTracked}" />
                        
                        <!-- Completed Indicator -->
                        <TextBlock Grid.Column="1"
                                   Text="âœ“"
                                   Foreground="LimeGreen"
                                   FontSize="12"
                                   Margin="0,0,6,0"
                                   IsVisible="{TemplateBinding IsCompleted}" />
                        
                        <!-- Quest Title -->
                        <TextBlock Grid.Column="2"
                                   Text="{TemplateBinding Title}"
                                   TextTrimming="CharacterEllipsis"
                                   VerticalAlignment="Center" />
                        
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>
        
        <!-- Hover Style -->
        <Style Selector="^:pointerover /template/ Border#EntryBorder">
            <Setter Property="Background" Value="{StaticResource HoverBackgroundBrush}" />
        </Style>
        
        <!-- Selected Style -->
        <Style Selector="^[IsSelected=True] /template/ Border#EntryBorder">
            <Setter Property="Background" Value="{StaticResource SelectedBackgroundBrush}" />
            <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}" />
        </Style>
        
        <!-- Completed Style -->
        <Style Selector="^[IsCompleted=True] /template/ TextBlock">
            <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
        </Style>
        
    </ControlTheme>
    
</ResourceDictionary>
```

---

## 6. Objective List Control

### ObjectiveListControl

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/ObjectiveListControl.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
             x:Class="RuneAndRust.Avalonia.Controls.ObjectiveListControl"
             x:DataType="vm:QuestEntryViewModel">
    
    <UserControl.Styles>
        <Style Selector="TextBlock.objective-complete">
            <Setter Property="Foreground" Value="{StaticResource SuccessBrush}" />
        </Style>
        <Style Selector="TextBlock.objective-incomplete">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
        </Style>
        <Style Selector="TextBlock.objective-description-complete">
            <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
            <Setter Property="TextDecorations" Value="Strikethrough" />
        </Style>
    </UserControl.Styles>
    
    <ItemsControl ItemsSource="{Binding Objectives}">
        <ItemsControl.ItemTemplate>
            <DataTemplate DataType="vm:ObjectiveViewModel">
                <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,4">
                    
                    <!-- Checkbox Icon -->
                    <TextBlock Grid.Column="0"
                               Text="{Binding StatusIcon}"
                               Classes.objective-complete="{Binding IsCompleted}"
                               Classes.objective-incomplete="{Binding !IsCompleted}"
                               Margin="0,0,8,0" />
                    
                    <!-- Objective Description -->
                    <TextBlock Grid.Column="1"
                               Text="{Binding Description}"
                               Classes.objective-description-complete="{Binding IsCompleted}"
                               TextWrapping="Wrap" />
                    
                    <!-- Progress Counter -->
                    <TextBlock Grid.Column="2"
                               Text="{Binding ProgressText}"
                               IsVisible="{Binding HasProgress}"
                               Foreground="{StaticResource MutedBrush}"
                               Margin="8,0,0,0" />
                    
                </Grid>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
    
</UserControl>
```

---

## 7. View Models

### QuestLogViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/QuestLogViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// ViewModel for the quest log window.
/// </summary>
/// <remarks>
/// Manages the display of active and completed quests, quest selection,
/// and quest tracking functionality. Subscribes to quest update events
/// for real-time UI updates.
/// </remarks>
public partial class QuestLogViewModel : ViewModelBase, IDisposable
{
    private readonly IQuestService _questService;
    private readonly ILogger<QuestLogViewModel> _logger;
    private readonly Action? _onClose;

    [ObservableProperty]
    private ObservableCollection<QuestEntryViewModel> _activeQuests = new();

    [ObservableProperty]
    private ObservableCollection<QuestEntryViewModel> _completedQuests = new();

    [ObservableProperty]
    private QuestEntryViewModel? _selectedQuest;

    [ObservableProperty]
    private bool _showCompletedQuests = true;

    [ObservableProperty]
    private Guid? _trackedQuestId;

    public string ActiveQuestHeader => $"ACTIVE QUESTS ({ActiveQuests.Count})";
    public string CompletedQuestHeader => $"COMPLETED ({CompletedQuests.Count})";
    public string CompletedExpander => ShowCompletedQuests ? "â–¼" : "â–º";
    
    public bool HasSelectedQuest => SelectedQuest is not null;
    public bool CanTrackQuest => SelectedQuest is not null && !SelectedQuest.IsCompleted;
    
    public string TrackingStatus => SelectedQuest?.IsTracked == true 
        ? "Currently tracking this quest" 
        : "";

    public QuestLogViewModel(
        IQuestService questService, 
        ILogger<QuestLogViewModel> logger,
        Action? onClose = null)
    {
        _questService = questService;
        _logger = logger;
        _onClose = onClose;

        _questService.OnQuestUpdated += HandleQuestUpdated;
        TrackedQuestId = _questService.GetTrackedQuestId();

        LoadQuests();
        _logger.LogDebug("QuestLogViewModel initialized with {ActiveCount} active, {CompletedCount} completed quests",
            ActiveQuests.Count, CompletedQuests.Count);
    }

    /// <summary>
    /// Selects a quest to display its details.
    /// </summary>
    [RelayCommand]
    private void SelectQuest(QuestEntryViewModel quest)
    {
        // Deselect previous
        if (SelectedQuest is not null)
            SelectedQuest.IsSelected = false;

        SelectedQuest = quest;
        quest.IsSelected = true;

        OnPropertyChanged(nameof(HasSelectedQuest));
        OnPropertyChanged(nameof(CanTrackQuest));
        OnPropertyChanged(nameof(TrackingStatus));

        _logger.LogDebug("Selected quest: {QuestTitle}", quest.Title);
    }

    /// <summary>
    /// Tracks the currently selected quest for HUD display.
    /// </summary>
    [RelayCommand]
    private void TrackQuest()
    {
        if (SelectedQuest is null || SelectedQuest.IsCompleted) return;

        // Untrack previous
        var previousTracked = ActiveQuests.FirstOrDefault(q => q.IsTracked);
        if (previousTracked is not null)
            previousTracked.IsTracked = false;

        // Track new
        SelectedQuest.IsTracked = true;
        TrackedQuestId = SelectedQuest.QuestId;
        _questService.SetTrackedQuest(SelectedQuest.QuestId);

        OnPropertyChanged(nameof(TrackingStatus));

        _logger.LogInformation("Tracking quest: {QuestTitle}", SelectedQuest.Title);
    }

    /// <summary>
    /// Toggles visibility of the completed quests section.
    /// </summary>
    [RelayCommand]
    private void ToggleCompletedQuests()
    {
        ShowCompletedQuests = !ShowCompletedQuests;
        OnPropertyChanged(nameof(CompletedExpander));

        _logger.LogDebug("Completed quests visibility: {IsVisible}", ShowCompletedQuests);
    }

    /// <summary>
    /// Closes the quest log window.
    /// </summary>
    [RelayCommand]
    private void Close()
    {
        _onClose?.Invoke();
    }

    private void LoadQuests()
    {
        ActiveQuests.Clear();
        CompletedQuests.Clear();

        foreach (var quest in _questService.GetActiveQuests())
        {
            var vm = CreateQuestEntryViewModel(quest);
            ActiveQuests.Add(vm);
        }

        foreach (var quest in _questService.GetCompletedQuests())
        {
            var vm = CreateQuestEntryViewModel(quest);
            CompletedQuests.Add(vm);
        }

        // Auto-select first active quest
        if (ActiveQuests.Count > 0)
            SelectQuest(ActiveQuests[0]);

        OnPropertyChanged(nameof(ActiveQuestHeader));
        OnPropertyChanged(nameof(CompletedQuestHeader));
    }

    private QuestEntryViewModel CreateQuestEntryViewModel(Quest quest)
    {
        return new QuestEntryViewModel(quest, quest.Id == TrackedQuestId);
    }

    private void HandleQuestUpdated(Quest quest)
    {
        // Find and update the quest entry
        var entry = ActiveQuests.FirstOrDefault(q => q.QuestId == quest.Id)
                 ?? CompletedQuests.FirstOrDefault(q => q.QuestId == quest.Id);

        if (entry is not null)
        {
            entry.UpdateFrom(quest);

            // Move to completed if status changed
            if (quest.Status == QuestStatus.Completed && ActiveQuests.Contains(entry))
            {
                ActiveQuests.Remove(entry);
                CompletedQuests.Insert(0, entry);
                
                OnPropertyChanged(nameof(ActiveQuestHeader));
                OnPropertyChanged(nameof(CompletedQuestHeader));

                _logger.LogInformation("Quest completed: {QuestTitle}", quest.Title);
            }
        }
        else
        {
            // New quest, reload all
            LoadQuests();
        }
    }

    public void Dispose()
    {
        _questService.OnQuestUpdated -= HandleQuestUpdated;
    }
}
```

### QuestEntryViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/QuestEntryViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// ViewModel representing a quest entry with its details.
/// </summary>
public partial class QuestEntryViewModel : ViewModelBase
{
    public Guid QuestId { get; }

    [ObservableProperty]
    private string _title;

    [ObservableProperty]
    private string _description;

    [ObservableProperty]
    private ObservableCollection<ObjectiveViewModel> _objectives = new();

    [ObservableProperty]
    private ObservableCollection<RewardViewModel> _rewards = new();

    [ObservableProperty]
    private bool _isCompleted;

    [ObservableProperty]
    private bool _isTracked;

    [ObservableProperty]
    private bool _isSelected;

    [ObservableProperty]
    private double _progressPercentage;

    [ObservableProperty]
    private string _progressText;

    public QuestEntryViewModel(Quest quest, bool isTracked)
    {
        QuestId = quest.Id;
        Title = quest.Title;
        Description = quest.Description;
        IsCompleted = quest.Status == QuestStatus.Completed;
        IsTracked = isTracked;

        PopulateObjectives(quest.Objectives);
        PopulateRewards(quest.Rewards);
        CalculateProgress();
    }

    /// <summary>
    /// Updates the ViewModel from a quest domain entity.
    /// </summary>
    public void UpdateFrom(Quest quest)
    {
        Title = quest.Title;
        Description = quest.Description;
        IsCompleted = quest.Status == QuestStatus.Completed;

        // Update objectives
        for (int i = 0; i < quest.Objectives.Count && i < Objectives.Count; i++)
        {
            Objectives[i].UpdateFrom(quest.Objectives[i]);
        }

        CalculateProgress();
    }

    private void PopulateObjectives(IReadOnlyList<QuestObjective> objectives)
    {
        Objectives.Clear();
        foreach (var obj in objectives)
        {
            Objectives.Add(new ObjectiveViewModel(obj));
        }
    }

    private void PopulateRewards(IReadOnlyList<QuestReward> rewards)
    {
        Rewards.Clear();
        foreach (var reward in rewards)
        {
            Rewards.Add(new RewardViewModel(reward));
        }
    }

    private void CalculateProgress()
    {
        if (Objectives.Count == 0)
        {
            ProgressPercentage = IsCompleted ? 100 : 0;
            ProgressText = IsCompleted ? "Complete" : "No objectives";
            return;
        }

        var completed = Objectives.Count(o => o.IsCompleted);
        ProgressPercentage = (double)completed / Objectives.Count * 100;
        ProgressText = $"PROGRESS: {completed}/{Objectives.Count} objectives";
    }
}
```

### ObjectiveViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/ObjectiveViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// ViewModel representing a quest objective.
/// </summary>
public partial class ObjectiveViewModel : ViewModelBase
{
    [ObservableProperty]
    private string _description;

    [ObservableProperty]
    private bool _isCompleted;

    [ObservableProperty]
    private int _currentProgress;

    [ObservableProperty]
    private int _requiredProgress;

    [ObservableProperty]
    private bool _hasProgress;

    /// <summary>
    /// Gets the status icon (â˜‘ or â˜).
    /// </summary>
    public string StatusIcon => IsCompleted ? "â˜‘" : "â˜";

    /// <summary>
    /// Gets the progress text for countable objectives.
    /// </summary>
    public string ProgressText => HasProgress 
        ? $"({CurrentProgress}/{RequiredProgress})" 
        : "";

    public ObjectiveViewModel(QuestObjective objective)
    {
        Description = objective.Description;
        IsCompleted = objective.IsCompleted;
        CurrentProgress = objective.CurrentProgress;
        RequiredProgress = objective.RequiredProgress;
        HasProgress = objective.RequiredProgress > 1;
    }

    /// <summary>
    /// Updates the ViewModel from a domain objective.
    /// </summary>
    public void UpdateFrom(QuestObjective objective)
    {
        Description = objective.Description;
        IsCompleted = objective.IsCompleted;
        CurrentProgress = objective.CurrentProgress;
        
        OnPropertyChanged(nameof(StatusIcon));
        OnPropertyChanged(nameof(ProgressText));
    }
}
```

### RewardViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/RewardViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// ViewModel representing a quest reward.
/// </summary>
public partial class RewardViewModel : ViewModelBase
{
    [ObservableProperty]
    private string _type;

    [ObservableProperty]
    private string _description;

    [ObservableProperty]
    private string _icon;

    public RewardViewModel(QuestReward reward)
    {
        Type = reward.Type.ToString();
        Description = FormatDescription(reward);
        Icon = GetIcon(reward.Type);
    }

    private static string FormatDescription(QuestReward reward)
    {
        return reward.Type switch
        {
            RewardType.Experience => $"{reward.Amount} XP",
            RewardType.Gold => $"{reward.Amount} Gold",
            RewardType.Item => reward.Description,
            RewardType.Unlock => $"Unlocks: {reward.Description}",
            _ => reward.Description
        };
    }

    private static string GetIcon(RewardType type)
    {
        return type switch
        {
            RewardType.Experience => "â­",
            RewardType.Gold => "ğŸ’°",
            RewardType.Item => "ğŸ",
            RewardType.Unlock => "ğŸ”“",
            _ => "â€¢"
        };
    }
}
```

---

## 8. Tracked Quest HUD

### TrackedQuestHud

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/TrackedQuestHud.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
             x:Class="RuneAndRust.Avalonia.Controls.TrackedQuestHud"
             x:DataType="vm:TrackedQuestHudViewModel"
             IsVisible="{Binding HasTrackedQuest}"
             Width="280">
    
    <Border Classes="tracked-quest-hud" Padding="12,8">
        <StackPanel>
            
            <!-- Quest Title -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                <TextBlock Text="â˜…" Foreground="Gold" Margin="0,0,6,0" />
                <TextBlock Text="{Binding QuestTitle}" 
                           Classes="hud-quest-title"
                           TextTrimming="CharacterEllipsis" />
            </StackPanel>
            
            <!-- Current Objectives (incomplete only) -->
            <ItemsControl ItemsSource="{Binding CurrentObjectives}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="vm:ObjectiveViewModel">
                        <Grid ColumnDefinitions="Auto,*" Margin="12,2,0,0">
                            <TextBlock Grid.Column="0" 
                                       Text="â˜" 
                                       Foreground="{StaticResource MutedBrush}"
                                       Margin="0,0,6,0" />
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding Description}"
                                       FontSize="11"
                                       Foreground="{StaticResource MutedBrush}"
                                       TextTrimming="CharacterEllipsis" />
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            
        </StackPanel>
    </Border>
    
</UserControl>
```

### TrackedQuestHudViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/TrackedQuestHudViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// ViewModel for the tracked quest HUD overlay.
/// </summary>
/// <remarks>
/// Displays a minimal view of the currently tracked quest with
/// only incomplete objectives visible.
/// </remarks>
public partial class TrackedQuestHudViewModel : ViewModelBase, IDisposable
{
    private readonly IQuestService _questService;

    [ObservableProperty]
    private string _questTitle = "";

    [ObservableProperty]
    private ObservableCollection<ObjectiveViewModel> _currentObjectives = new();

    public bool HasTrackedQuest => !string.IsNullOrEmpty(QuestTitle);

    public TrackedQuestHudViewModel(IQuestService questService)
    {
        _questService = questService;
        _questService.OnQuestUpdated += HandleQuestUpdated;

        LoadTrackedQuest();
    }

    private void LoadTrackedQuest()
    {
        var trackedId = _questService.GetTrackedQuestId();
        if (trackedId is null)
        {
            QuestTitle = "";
            CurrentObjectives.Clear();
            OnPropertyChanged(nameof(HasTrackedQuest));
            return;
        }

        var quest = _questService.GetQuest(trackedId.Value);
        if (quest is null)
        {
            QuestTitle = "";
            CurrentObjectives.Clear();
            OnPropertyChanged(nameof(HasTrackedQuest));
            return;
        }

        UpdateFromQuest(quest);
    }

    private void UpdateFromQuest(Quest quest)
    {
        QuestTitle = quest.Title;
        CurrentObjectives.Clear();

        // Only show incomplete objectives
        foreach (var obj in quest.Objectives.Where(o => !o.IsCompleted))
        {
            CurrentObjectives.Add(new ObjectiveViewModel(obj));
        }

        OnPropertyChanged(nameof(HasTrackedQuest));
    }

    private void HandleQuestUpdated(Quest quest)
    {
        var trackedId = _questService.GetTrackedQuestId();
        if (quest.Id == trackedId)
        {
            UpdateFromQuest(quest);
        }
    }

    public void Dispose()
    {
        _questService.OnQuestUpdated -= HandleQuestUpdated;
    }
}
```

---

## 9. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/QuestLogStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <!-- Quest Header -->
    <Style Selector="Border.quest-header">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="BorderThickness" Value="0,0,0,1" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <!-- Window Title -->
    <Style Selector="TextBlock.window-title">
        <Setter Property="FontSize" Value="18" />
        <Setter Property="FontWeight" Value="SemiBold" />
    </Style>
    
    <!-- Quest List Panel -->
    <Style Selector="Border.quest-list-panel">
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
        <Setter Property="BorderThickness" Value="0,0,1,0" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <!-- Quest Details Panel -->
    <Style Selector="Border.quest-details-panel">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
    </Style>
    
    <!-- Section Header -->
    <Style Selector="TextBlock.section-header">
        <Setter Property="FontSize" Value="12" />
        <Setter Property="FontWeight" Value="SemiBold" />
        <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
    </Style>
    
    <!-- Section Toggle Button -->
    <Style Selector="Button.section-toggle">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="BorderThickness" Value="0" />
        <Setter Property="Padding" Value="0" />
        <Setter Property="Cursor" Value="Hand" />
    </Style>
    
    <!-- Quest Title (Details) -->
    <Style Selector="TextBlock.quest-title">
        <Setter Property="FontSize" Value="18" />
        <Setter Property="FontWeight" Value="Bold" />
    </Style>
    
    <!-- Quest Description -->
    <Style Selector="TextBlock.quest-description">
        <Setter Property="FontSize" Value="13" />
        <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
        <Setter Property="LineHeight" Value="20" />
    </Style>
    
    <!-- Details Section Header -->
    <Style Selector="TextBlock.details-header">
        <Setter Property="FontSize" Value="11" />
        <Setter Property="FontWeight" Value="SemiBold" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
    </Style>
    
    <!-- Separator Line -->
    <Style Selector="Border.separator">
        <Setter Property="Height" Value="1" />
        <Setter Property="Background" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <!-- Progress Text -->
    <Style Selector="TextBlock.progress-text">
        <Setter Property="FontSize" Value="11" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
    </Style>
    
    <!-- Quest Progress Bar -->
    <Style Selector="ProgressBar.quest-progress">
        <Setter Property="Height" Value="8" />
        <Setter Property="Foreground" Value="{StaticResource AccentBrush}" />
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    </Style>
    
    <!-- Quest Footer -->
    <Style Selector="Border.quest-footer">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="BorderThickness" Value="0,1,0,0" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <!-- Track Button -->
    <Style Selector="Button.track-button">
        <Setter Property="Background" Value="{StaticResource AccentBrush}" />
        <Setter Property="Foreground" Value="White" />
        <Setter Property="Padding" Value="16,8" />
    </Style>
    
    <!-- Tracking Status Text -->
    <Style Selector="TextBlock.tracking-status">
        <Setter Property="FontSize" Value="11" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
        <Setter Property="VerticalAlignment" Value="Center" />
    </Style>
    
    <!-- Tracked Quest HUD -->
    <Style Selector="Border.tracked-quest-hud">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="CornerRadius" Value="4" />
        <Setter Property="Opacity" Value="0.9" />
    </Style>
    
    <!-- HUD Quest Title -->
    <Style Selector="TextBlock.hud-quest-title">
        <Setter Property="FontSize" Value="12" />
        <Setter Property="FontWeight" Value="SemiBold" />
    </Style>
    
</Styles>
```

---

## 10. Data Model Changes

### New Types

| Type | Layer | Description |
|------|-------|-------------|
| `QuestLogWindow` | Presentation | Quest log window |
| `QuestEntryControl` | Presentation | Quest list item control |
| `ObjectiveListControl` | Presentation | Objective list display |
| `TrackedQuestHud` | Presentation | HUD overlay for tracked quest |
| `QuestLogViewModel` | Presentation | Quest log window ViewModel |
| `QuestEntryViewModel` | Presentation | Quest entry ViewModel |
| `ObjectiveViewModel` | Presentation | Objective ViewModel |
| `RewardViewModel` | Presentation | Reward display ViewModel |
| `TrackedQuestHudViewModel` | Presentation | HUD ViewModel |

### Extended Interfaces

| Interface | New Method | Description |
|-----------|------------|-------------|
| `IQuestService` | `SetTrackedQuest(Guid)` | Sets the tracked quest |
| `IQuestService` | `GetTrackedQuestId()` | Gets the tracked quest ID |
| `IQuestService` | `OnQuestUpdated` event | Quest progress event |

### Domain Enums (if not existing)

```csharp
public enum QuestStatus
{
    NotStarted,
    Active,
    Completed,
    Failed
}

public enum RewardType
{
    Experience,
    Gold,
    Item,
    Unlock
}
```

---

## 11. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `QuestLogViewModel` | Debug | Quest selection, visibility toggle |
| `QuestLogViewModel` | Information | Quest tracking changes, quest completion |
| `QuestLogViewModel` | Debug | Load quests count |
| `TrackedQuestHudViewModel` | Debug | Tracked quest updates |
| `QuestService` | Information | Quest status changes |

### Log Message Examples

```
Debug: QuestLogViewModel initialized with 3 active, 5 completed quests
Debug: Selected quest: The Skeleton Key
Information: Tracking quest: The Skeleton Key
Debug: Completed quests visibility: False
Information: Quest completed: Find Lost Artifact
Debug: Tracked quest updated: The Skeleton Key (3/5 objectives)
```

---

## 12. Unit Testing Requirements

| Feature | Tests |
|---------|-------|
| Quest loading (active/completed) | 2 |
| Quest selection | 2 |
| Quest tracking | 2 |
| Completed quests toggle | 1 |
| Progress calculation | 2 |
| Objective status updates | 2 |
| Quest completion transition | 2 |
| **Total** | **~13** |

### Test Specifications

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/QuestLogViewModelTests.cs`

```csharp
[TestFixture]
public class QuestLogViewModelTests
{
    [Test]
    public void Constructor_WithActiveQuests_PopulatesActiveQuestsCollection();

    [Test]
    public void Constructor_WithCompletedQuests_PopulatesCompletedQuestsCollection();

    [Test]
    public void SelectQuest_UpdatesSelectedQuest();

    [Test]
    public void SelectQuest_DeselectsPreviousQuest();

    [Test]
    public void TrackQuest_UpdatesTrackedQuestId();

    [Test]
    public void TrackQuest_UntracksP previousQuest();

    [Test]
    public void ToggleCompletedQuests_TogglesVisibility();

    [Test]
    public void HandleQuestUpdated_UpdatesExistingQuest();

    [Test]
    public void HandleQuestUpdated_MovesCompletedQuestToCompletedList();
}
```

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/QuestEntryViewModelTests.cs`

```csharp
[TestFixture]
public class QuestEntryViewModelTests
{
    [Test]
    public void Constructor_SetsPropertiesFromQuest();

    [Test]
    public void CalculateProgress_WithNoObjectives_ReturnsZero();

    [Test]
    public void CalculateProgress_WithMixedObjectives_ReturnsCorrectPercentage();

    [Test]
    public void UpdateFrom_UpdatesObjectiveProgress();
}
```

---

## 13. Use Cases

### UC-081b-001: Open Quest Log
**Actor:** Player
**Flow:** Player presses J key â†’ Quest log window opens â†’ Active quests displayed â†’ First quest auto-selected
**Postcondition:** Quest log visible with quest details

### UC-081b-002: View Quest Details
**Actor:** Player
**Flow:** Player clicks quest in list â†’ Quest details panel updates â†’ Shows objectives, rewards, progress

### UC-081b-003: Track Active Quest
**Actor:** Player
**Precondition:** At least one active quest exists
**Flow:** Player selects active quest â†’ Clicks "Track Quest" â†’ â˜… appears next to quest â†’ HUD shows tracked quest
**Postcondition:** Quest tracked for HUD display

### UC-081b-004: View Completed Quests
**Actor:** Player
**Flow:** Player clicks "â–¼ COMPLETED" section â†’ Completed quests expand â†’ Player selects completed quest â†’ Details show completed state

### UC-081b-005: Collapse Completed Quests
**Actor:** Player
**Flow:** Player clicks "â–¼ COMPLETED" â†’ Section collapses â†’ Only active quests visible

### UC-081b-006: Monitor Quest Progress
**Actor:** Player
**Precondition:** Quest has counting objectives (e.g., "Defeat 5 goblins")
**Flow:** Player defeats goblin â†’ Objective counter updates (2/5 â†’ 3/5) â†’ Progress bar advances â†’ HUD updates if tracked

### UC-081b-007: Quest Auto-Completion
**Actor:** Player/System
**Precondition:** Quest is active with all objectives complete
**Flow:** Player completes final objective â†’ Quest status changes to Completed â†’ Quest moves to Completed section â†’ HUD clears if tracked

---

## 14. Deliverable Checklist

### Windows
- [ ] `Views/QuestLogWindow.axaml` created
- [ ] `Views/QuestLogWindow.axaml.cs` created

### Controls
- [ ] `Controls/QuestEntryControl.cs` created
- [ ] `Controls/QuestEntryControl.axaml` created
- [ ] `Controls/ObjectiveListControl.axaml` created
- [ ] `Controls/ObjectiveListControl.axaml.cs` created
- [ ] `Controls/TrackedQuestHud.axaml` created
- [ ] `Controls/TrackedQuestHud.axaml.cs` created

### ViewModels
- [ ] `ViewModels/QuestLogViewModel.cs` created
- [ ] `ViewModels/QuestEntryViewModel.cs` created
- [ ] `ViewModels/ObjectiveViewModel.cs` created
- [ ] `ViewModels/RewardViewModel.cs` created
- [ ] `ViewModels/TrackedQuestHudViewModel.cs` created

### Styles
- [ ] `Styles/QuestLogStyles.axaml` created

### Integration
- [ ] J key shortcut registered with KeyboardShortcutService
- [ ] TrackedQuestHud added to game window layout
- [ ] IQuestService extended with tracking methods

### Testing
- [ ] ~13 unit tests implemented
- [ ] All tests passing

---

## 15. Acceptance Criteria

### Functional
- [ ] Quest log opens with J key
- [ ] Active quests section shows incomplete quests
- [ ] Completed quests section shows finished quests
- [ ] Completed section is collapsible
- [ ] Selecting quest shows details
- [ ] Objectives display with checkmarks (â˜‘/â˜)
- [ ] Progress objectives show counts (e.g., "2/5")
- [ ] Rewards display correctly with icons
- [ ] Progress bar shows completion percentage
- [ ] Track Quest marks quest for HUD display
- [ ] Tracked quest shows â˜… indicator
- [ ] TrackedQuestHud appears on screen when quest tracked
- [ ] Quest updates appear in real-time
- [ ] Completed quests move to completed section

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~13 unit tests pass
- [ ] XML documentation on all public types
- [ ] Styles consistent with application theme

---

## 16. Dependencies

### Required from v0.8.1a
- Map View Panel patterns for window styling
- Panel layout conventions

### Required from v0.8.0c
- `KeyboardShortcutService` for J key binding
- `ShortcutContext` enum for context management

### Required from Domain Layer
- `Quest` entity
- `QuestObjective` value object
- `QuestReward` value object
- `QuestStatus` enum
- `RewardType` enum

### Required from Application Layer
- `IQuestService` with quest management
- Quest update event mechanism

### Provides to v0.8.1c
- Quest tooltip data source
- Progress display patterns

---

## 17. Future Considerations

### Deferred to v0.8.1c+
- **Quest Tooltips**: Hover tooltips for quick quest info
- **Map Quest Markers**: Show quest objectives on map

### Deferred to Later Versions
- **Quest Categories**: Filter quests by type (main, side, daily)
- **Quest Chains**: Visual representation of quest dependencies
- **Quest Sharing**: Multiplayer quest progress sharing
- **Quest Timer**: Time-limited quest countdown display
- **Quest Abandon**: Option to abandon active quests

### Out of Scope
- Quest creation/editing tools
- Procedural quest generation UI
- Achievement system integration

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
