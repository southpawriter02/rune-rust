# Changelog v0.16.2e - Armor Proficiency Acquisition Service

**Version:** 0.16.2e  
**Date:** 2026-01-29  
**Theme:** Proficiency Acquisition  
**Status:** Implemented

---

## Summary

Implements the armor proficiency acquisition service, enabling characters to train and improve their armor proficiency levels through NPC training. This includes the creation of value objects for training requirements and results, a comprehensive service interface for proficiency acquisition, and configuration files for training costs.

---

## Added

### Domain Layer - Value Objects

#### [ArmorTrainingRequirement.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/src/Core/RuneAndRust.Domain/ValueObjects/ArmorTrainingRequirement.cs)

New value object representing requirements for armor proficiency training:

- **Properties:**
    - `TargetLevel` - The target proficiency level after training
    - `RequiredLevel` - The required proficiency level to begin training
    - `ArmorCategory` - The armor category being trained
    - `CurrencyCost` - Currency cost in Pieces Silver
    - `TrainingWeeks` - Training duration in weeks
    - `MinimumCharacterLevel` - Minimum character level required
    - `RequiresNpcTrainer` - Whether NPC trainer is required

- **Factory Methods:**
    - `Create()` - Creates a custom training requirement
    - `ForProficient()` - NonProficient → Proficient (50 PS, 2 weeks)
    - `ForExpert()` - Proficient → Expert (200 PS, 4 weeks, Level 5)
    - `ForMaster()` - Expert → Master (500 PS, 8 weeks, Level 10)
    - `Free()` - Creates a zero-cost requirement

- **Formatting:**
    - `FormatDescription()` - Full requirement description
    - `FormatCostSummary()` - Short cost summary (e.g., "50 PS / 2wk")

---

#### [ArmorTrainingResult.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/src/Core/RuneAndRust.Domain/ValueObjects/ArmorTrainingResult.cs)

New value object representing the outcome of armor proficiency training:

- **Properties:**
    - `Success` - Whether training succeeded
    - `ArmorCategory` - The armor category trained
    - `PreviousLevel` / `NewLevel` - Proficiency level before/after
    - `CurrencySpent` / `TimeSpentWeeks` - Resources consumed
    - `FailureReasons` - List of failure reasons
    - `Message` - Success/failure message

- **Success Factory Methods:**
    - `Successful()` - Generic success
    - `TrainedToProficient()` - NonProficient → Proficient
    - `TrainedToExpert()` - Proficient → Expert
    - `TrainedToMaster()` - Expert → Master

- **Failure Factory Methods:**
    - `Failed()` - Generic failure with reasons
    - `InsufficientCurrency()` - Insufficient funds
    - `LevelTooLow()` - Character level requirement not met
    - `AlreadyMaster()` - Already at maximum proficiency
    - `NoTrainerAvailable()` - No trainer in current location

---

### Application Layer - Interfaces

#### [IArmorProficiencyAcquisitionService.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/src/Core/RuneAndRust.Application/Interfaces/IArmorProficiencyAcquisitionService.cs)

New interface for armor proficiency training and acquisition:

- **Training Operations:**
    - `TrainArmorProficiencyAsync(player, category)` - Train to next level
    - `TrainArmorProficiencyAsync(player, category, targetLevel)` - Train to specific level

- **Requirement Queries:**
    - `GetTrainingRequirementsAsync()` - Get requirements for a level
    - `GetAllTrainingRequirementsAsync()` - Get all requirements for a category
    - `GetNextTrainingRequirementAsync()` - Get player's next training requirement

- **Eligibility Checks:**
    - `CanTrainAsync(player, category, targetLevel)` - Check training eligibility
    - `CanTrainNextLevelAsync()` - Check eligibility for next level

- **Proficiency Queries:**
    - `GetCurrentProficiencyAsync()` - Get player's current proficiency
    - `GetAllProficienciesAsync()` - Get all proficiencies for player

#### TrainingEligibility Struct

Supporting struct for eligibility check results:

- `IsEligible` - Whether player can train
- `TargetLevel` - Target proficiency level
- `BlockingReasons` - List of blocking reasons

---

### Application Layer - Services

#### [ArmorProficiencyAcquisitionService.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/src/Core/RuneAndRust.Application/Services/ArmorProficiencyAcquisitionService.cs)

New service implementation for armor proficiency acquisition:

- **Features:**
    - Configuration-driven training costs (with defaults)
    - Multi-source proficiency resolution (archetype, trained, quest)
    - Comprehensive eligibility validation
    - Currency deduction via `Player.RemoveCurrency()`
    - Detailed Serilog structured logging

- **Default Training Costs:**
    - Proficient: 50 PS, 2 weeks, Level 1
    - Expert: 200 PS, 4 weeks, Level 5
    - Master: 500 PS, 8 weeks, Level 10

---

### Configuration

#### [armor-training-requirements.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/armor-training-requirements.schema.json)

JSON Schema (Draft-07) for training requirements configuration:

- Default requirements for all armor categories
- Category-specific overrides for Heavy, Shield, Cloth
- Trainer availability settings
- Prerequisites system (quest, achievement, reputation, skill)

#### [armor-training-requirements.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/armor-training-requirements.json)

Configuration file with training costs:

| Category | Proficient | Expert     | Master      |
| -------- | ---------- | ---------- | ----------- |
| Default  | 50 PS/2wk  | 200 PS/4wk | 500 PS/8wk  |
| Heavy    | 75 PS/3wk  | 300 PS/6wk | 750 PS/12wk |
| Shield   | 40 PS/1wk  | 150 PS/3wk | 400 PS/6wk  |
| Cloth    | 25 PS/1wk  | 100 PS/2wk | 250 PS/4wk  |

---

### Unit Tests

#### [ArmorTrainingRequirementTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Domain.UnitTests/ValueObjects/ArmorTrainingRequirementTests.cs)

- Factory method creation tests
- Level-specific factory method tests
- Validation and error handling tests
- Computed properties and formatting tests

#### [ArmorTrainingResultTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Domain.UnitTests/ValueObjects/ArmorTrainingResultTests.cs)

- Success factory method tests
- Failure factory method tests
- Computed properties tests
- Formatting method tests

#### [ArmorProficiencyAcquisitionServiceTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Application.UnitTests/Services/ArmorProficiencyAcquisitionServiceTests.cs)

- Successful training scenarios
- Insufficient resource failures
- Level requirement failures
- Eligibility checking
- Training requirements retrieval
- Proficiency queries

---

## Dependencies

### Builds Upon

- **v0.16.2a:** Armor category definitions and `ArmorCategory` enum
- **v0.16.2b:** `ArmorProficiencyLevel` enum and proficiency effect system
- **v0.16.2c:** `IArchetypeArmorProficiencyProvider` for archetype proficiencies

### Uses

- `Player.GetCurrency()` / `Player.RemoveCurrency()` / `Player.CanAfford()` from Domain layer
- `IArchetypeArmorProficiencyProvider` for base proficiency resolution
- Microsoft.Extensions.Logging for structured logging

---

## Files Changed

### New Files (10)

| File                                         | Type         | Description                  |
| -------------------------------------------- | ------------ | ---------------------------- |
| `ArmorTrainingRequirement.cs`                | Value Object | Training requirements        |
| `ArmorTrainingResult.cs`                     | Value Object | Training outcome             |
| `IArmorProficiencyAcquisitionService.cs`     | Interface    | Acquisition service contract |
| `ArmorProficiencyAcquisitionService.cs`      | Service      | Acquisition implementation   |
| `armor-training-requirements.schema.json`    | Schema       | Configuration schema         |
| `armor-training-requirements.json`           | Config       | Training costs               |
| `ArmorTrainingRequirementTests.cs`           | Tests        | Value object tests           |
| `ArmorTrainingResultTests.cs`                | Tests        | Value object tests           |
| `ArmorProficiencyAcquisitionServiceTests.cs` | Tests        | Service tests                |
| `v0.16.2e-changelog.md`                      | Docs         | This changelog               |

---

## Notes

- Training costs are configurable via JSON but defaults are hardcoded in service for resilience
- Service integrates with `IArchetypeArmorProficiencyProvider` for multi-source proficiency resolution
- Currency uses "silver" as the currency ID (Pieces Silver from schema)
- TODO markers left for trained proficiency storage and quest reward integration
