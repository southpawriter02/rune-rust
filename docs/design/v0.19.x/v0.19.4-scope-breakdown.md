# v0.19.4 Scope Breakdown: Jötunheim & Vanaheim

## Overview

v0.19.4 implements two realms with unique scale and stratification mechanics:

- **Jötunheim — The Industrial Graveyard** (Deck 07) — Giant-scale heavy industry ruins
- **Vanaheim — The Overgrown Laboratory** (Deck 03) — Vertically-stratified bio-organic overgrowth

These realms showcase environmental storytelling through scale (Jötunheim) and vertical progression (Vanaheim).

---

## In Scope

### Jötunheim — The Industrial Graveyard

| Property | Value |
|----------|-------|
| **Realm ID** | `Jotunheim` |
| **Deck** | 07 — Heavy Industry |
| **Verticality** | Z=-2 to Z=+2 |
| **Population** | Small (Rust-Clan salvage operations) |
| **Primary Condition** | GiantScale |
| **Theme** | Titanic machinery; industrial decay |

> *"Built for giants. Abandoned by all."*

### Jötunheim Zones

| Zone | Theme | Hazard Profile |
|------|-------|----------------|
| **The Foundry Warrens** | Abandoned manufacturing | Giant-scale terrain; Ancient Constructs |
| **The Great Looms** | Textile production | Machinery hazards; web-like terrain |
| **The Titan Yards** | Heavy equipment storage | Colossal debris; unstable stacks |
| **The Rust-Clan Holds** | Salvager settlements | Faction territory; relative safety |

### Vanaheim — The Overgrown Laboratory

| Property | Value |
|----------|-------|
| **Realm ID** | `Vanaheim` |
| **Deck** | 03 — Bio-Engineering |
| **Verticality** | Z=-1 to Z=+2 |
| **Population** | Small (Grove-Clans in Canopy) |
| **Primary Condition** | MutagenicSpores |
| **Theme** | Feral bio-engineering; vertical stratification |

> *"The garden that tends itself—and anything that enters it."*

### Vanaheim Zones (Vertical Strata)

| Zone | Altitude | Theme | Hazard Profile |
|------|----------|-------|----------------|
| **The Canopy Sea** | Z=+2 | Livable canopy | Moderate spores; Grove-Clan territory |
| **The Gloom-Veil** | Z=0 to Z=+1 | Transitional shadow | Increasing spores; predatory flora |
| **The Under-growth** | Z=-1 | Extreme hazard | Maximum spores; Un-Womb |

---

## Out of Scope (Deferred)

- Rust-Clan faction mechanics
- Grove-Clan faction mechanics
- Golden Plague disease system
- Un-Womb entity encounter
- Great Loom puzzle mechanics

---

## Jötunheim Specifications

### Pre-Glitch Function

| System | Function |
|--------|----------|
| Designation | Heavy Industry Deck |
| Primary Function | Large-scale manufacturing; Jötun-Forged production |
| Scale | Continent-sized forge complexes built for giant servitors |
| Infrastructure | Great Looms; Foundry Warrens; Titan Yards |
| Governing Logic | Industrial automation at massive scale |

### Post-Glitch State

| Property | Description |
|----------|-------------|
| State | Abandoned ruins; giant-scale infrastructure decay |
| Inhabitants | Rust-Clans (salvage operations); Ancient Constructs (patrol) |
| Hazard | Giant-scale terrain; increased fall damage; traversal difficulty |
| Value | Massive salvage potential in intact machinery |

### Giant-Scale Mechanics

| Property | Value |
|----------|-------|
| Scale Factor | 2.5x human scale |
| Fall Damage | ×2.5 normal (Giant-scale drops) |
| Climb DC | +4 to climbing checks |
| Cover | Giant objects provide superior cover |
| Navigation | Requires climbing/rope work for vertical movement |

### Jötunheim Environmental Properties

```json
{
  "id": "Jotunheim",
  "baseProperties": {
    "temperatureCelsius": 18,
    "aethericIntensity": 0.2,
    "humidityPercent": 40,
    "lightLevel": 0.5,
    "scaleFactor": 2.5,
    "corrosionRate": 0.4
  },
  "primaryCondition": "GiantScale",
  "minVerticalZone": -2,
  "maxVerticalZone": 2
}
```

### Zone: The Foundry Warrens

```json
{
  "id": "FoundryWarrens",
  "name": "The Foundry Warrens",
  "description": "Abandoned manufacturing halls built for giant servitors. Human-sized beings navigate like mice in a cathedral.",
  "overrideProperties": {
    "scaleFactor": 2.5,
    "lightLevel": 0.4
  },
  "hazards": ["GiantScaleTerrain", "AncientConstructs", "FallingDebris"]
}
```

### Zone: The Great Looms

```json
{
  "id": "GreatLooms",
  "name": "The Great Looms",
  "description": "Textile production facilities with web-like machinery. Tangled infrastructure creates labyrinthine passages.",
  "overrideProperties": {
    "scaleFactor": 3.0
  },
  "hazards": ["MachineryHazards", "WeblikeTerrain", "EntanglementRisk"]
}
```

### Zone: The Titan Yards

```json
{
  "id": "TitanYards",
  "name": "The Titan Yards",
  "description": "Storage facilities for colossal equipment. Unstable stacks of giant machinery.",
  "overrideProperties": {
    "scaleFactor": 3.0,
    "corrosionRate": 0.5
  },
  "hazards": ["ColossalDebris", "UnstableStacks", "CrushingHazard"]
}
```

### Zone: The Rust-Clan Holds

```json
{
  "id": "RustClanHolds",
  "name": "The Rust-Clan Holds",
  "description": "Salvager settlements carved into giant infrastructure. Relatively safe territory.",
  "overrideProperties": {
    "scaleFactor": 1.5,
    "lightLevel": 0.6
  },
  "hazards": []
}
```

---

## Vanaheim Specifications

### Pre-Glitch Function

| System | Function |
|--------|----------|
| Designation | Bio-Engineering Deck |
| Primary Function | Genetic research; agricultural enhancement |
| Scale | Continent-sized laboratory ecosystems |
| Infrastructure | Growth chambers; genetic archives; cultivation zones |
| Governing Logic | Controlled mutagenic research |

### Post-Glitch State

| Property | Description |
|----------|-------------|
| State | Feral overgrowth; bio-engineering gone wild |
| Stratification | Vertical zones: Canopy Sea → Gloom-Veil → Under-growth |
| Hazard | Golden Plague spores; mutagenic corruption |
| Rule | Elevation determines survivability |

### Vertical Stratification

| Stratum | Z-Level | Survivability | Description |
|---------|---------|---------------|-------------|
| Canopy Sea | Z=+2 | Livable | Above most spore density; Grove-Clan territory |
| Gloom-Veil | Z=0 to Z=+1 | Transitional | Increasing danger with descent |
| Under-growth | Z=-1 | Extreme Hazard | Maximum spore density; Un-Womb territory |

### Golden Plague Mechanics

| Property | Value |
|----------|-------|
| Delivery | Airborne spores |
| Effect | Corruption accumulation |
| Rate | Increases with descent |
| Mitigation | Filtration, elevation, antispore treatments |
| Terminal | Un-Womb transformation at extreme exposure |

### Vanaheim Environmental Properties

```json
{
  "id": "Vanaheim",
  "baseProperties": {
    "temperatureCelsius": 25,
    "aethericIntensity": 0.5,
    "humidityPercent": 85,
    "lightLevel": 0.4,
    "scaleFactor": 1.2,
    "corrosionRate": 0.3
  },
  "primaryCondition": "MutagenicSpores",
  "minVerticalZone": -1,
  "maxVerticalZone": 2
}
```

### Zone: The Canopy Sea

```json
{
  "id": "CanopySea",
  "name": "The Canopy Sea",
  "description": "The livable zone above most spore density. Grove-Clans have carved a life here among the highest branches.",
  "overrideProperties": {
    "temperatureCelsius": 20,
    "humidityPercent": 60,
    "lightLevel": 0.6,
    "aethericIntensity": 0.4
  },
  "conditionDcModifier": -4,
  "hazards": ["ModerateSpores", "FallingHazard"]
}
```

### Zone: The Gloom-Veil

```json
{
  "id": "GloomVeil",
  "name": "The Gloom-Veil",
  "description": "Transitional shadow zone. Light fades, spores thicken, predatory flora awakens.",
  "overrideProperties": {
    "temperatureCelsius": 25,
    "humidityPercent": 80,
    "lightLevel": 0.3,
    "aethericIntensity": 0.6
  },
  "conditionDcModifier": 0,
  "hazards": ["IncreasingSpores", "PredatoryFlora", "DataWraiths"]
}
```

### Zone: The Under-growth

```json
{
  "id": "UnderGrowth",
  "name": "The Under-growth",
  "description": "The deepest, darkest layer. Maximum spore concentration. The Un-Womb waits here.",
  "overrideProperties": {
    "temperatureCelsius": 32,
    "humidityPercent": 95,
    "lightLevel": 0.0,
    "aethericIntensity": 0.8
  },
  "conditionDcModifier": 4,
  "damageOverride": "3d6",
  "hazards": ["MaximumSpores", "UnWomb", "TheUnraveled", "TotalDarkness"]
}
```

---

## Domain Layer Specifications

### JotunheimZoneId Enum

```csharp
/// <summary>
/// Identifies zones within Jötunheim.
/// </summary>
public enum JotunheimZoneId
{
    /// <summary>Abandoned manufacturing halls.</summary>
    FoundryWarrens,

    /// <summary>Textile production; web-like machinery.</summary>
    GreatLooms,

    /// <summary>Heavy equipment storage; colossal debris.</summary>
    TitanYards,

    /// <summary>Salvager settlements; relative safety.</summary>
    RustClanHolds
}
```

### VanaheimStratumId Enum

```csharp
/// <summary>
/// Identifies vertical strata within Vanaheim.
/// </summary>
public enum VanaheimStratumId
{
    /// <summary>Z=+2. Livable zone above spore density.</summary>
    CanopySea,

    /// <summary>Z=0 to Z=+1. Transitional shadow zone.</summary>
    GloomVeil,

    /// <summary>Z=-1. Maximum hazard; Un-Womb territory.</summary>
    UnderGrowth
}
```

### GiantScaleHazard Enum

```csharp
/// <summary>
/// Hazards specific to giant-scale environments.
/// </summary>
public enum GiantScaleHazard
{
    /// <summary>Increased fall damage from giant-scale drops.</summary>
    GiantScaleFall,

    /// <summary>Difficult climbing on giant-scale surfaces.</summary>
    DifficultClimb,

    /// <summary>Crushing hazard from unstable giant debris.</summary>
    CrushingHazard,

    /// <summary>Entanglement in machinery or web-like terrain.</summary>
    Entanglement,

    /// <summary>Ancient Construct patrol.</summary>
    AncientConstruct
}
```

### MutagenicExposure Value Object

```csharp
/// <summary>
/// Tracks mutagenic spore exposure in Vanaheim.
/// </summary>
public sealed record MutagenicExposure
{
    /// <summary>Current spore exposure points.</summary>
    public required int ExposurePoints { get; init; }

    /// <summary>Current stratum affecting exposure rate.</summary>
    public required VanaheimStratumId CurrentStratum { get; init; }

    /// <summary>Corruption gained from exposure.</summary>
    public int CorruptionGained { get; init; } = 0;

    /// <summary>Whether Un-Womb transformation threshold reached.</summary>
    public bool UnWombThresholdReached => ExposurePoints >= 100;
}
```

### GiantScaleMovement Value Object

```csharp
/// <summary>
/// Movement calculations for giant-scale environments.
/// </summary>
public sealed record GiantScaleMovement
{
    /// <summary>Scale factor of current zone.</summary>
    public required float ScaleFactor { get; init; }

    /// <summary>Fall damage multiplier.</summary>
    public float FallDamageMultiplier => ScaleFactor;

    /// <summary>Climbing DC modifier.</summary>
    public int ClimbDcModifier => (int)((ScaleFactor - 1.0f) * 4);

    /// <summary>Movement speed modifier (reduced in giant terrain).</summary>
    public float MovementSpeedModifier => 1.0f / ScaleFactor;
}
```

---

## Application Layer Specifications

### IJotunheimService Interface

```csharp
/// <summary>
/// Manages Jötunheim-specific mechanics.
/// </summary>
public interface IJotunheimService
{
    /// <summary>Gets the scale factor for a zone.</summary>
    float GetScaleFactor(JotunheimZoneId zone);

    /// <summary>Calculates fall damage in giant-scale zone.</summary>
    int CalculateFallDamage(int baseFallDamage, JotunheimZoneId zone);

    /// <summary>Gets climbing DC modifier for a zone.</summary>
    int GetClimbDcModifier(JotunheimZoneId zone);

    /// <summary>Checks for Ancient Construct presence.</summary>
    bool HasAncientConstructPatrol(int x, int y, int z);

    /// <summary>Gets giant-scale movement calculations.</summary>
    GiantScaleMovement GetMovementCalculations(JotunheimZoneId zone);

    /// <summary>Checks for crushing hazard from unstable debris.</summary>
    bool CheckCrushingHazard(int x, int y, int z);
}
```

### IVanaheimService Interface

```csharp
/// <summary>
/// Manages Vanaheim-specific mechanics.
/// </summary>
public interface IVanaheimService
{
    /// <summary>Gets the stratum for a Z-level.</summary>
    VanaheimStratumId GetStratumForZLevel(int zLevel);

    /// <summary>Gets the spore exposure DC for a stratum.</summary>
    int GetSporeDc(VanaheimStratumId stratum);

    /// <summary>Gets the spore damage for a stratum.</summary>
    string GetSporeDamageDice(VanaheimStratumId stratum);

    /// <summary>Updates mutagenic exposure.</summary>
    MutagenicExposure UpdateExposure(
        MutagenicExposure current,
        VanaheimStratumId stratum,
        int turnCount);

    /// <summary>Checks for Un-Womb proximity.</summary>
    bool IsInUnWombTerritory(int x, int y, int z);

    /// <summary>Gets corruption rate for a stratum.</summary>
    int GetCorruptionRate(VanaheimStratumId stratum);
}
```

---

## Configuration Specifications

### jotunheim.json

```json
{
  "id": "Jotunheim",
  "name": "Jötunheim",
  "subtitle": "The Industrial Graveyard",
  "deckNumber": 7,
  "preGlitchFunction": "Heavy Industry & Large-Scale Manufacturing",
  "postGlitchState": "Abandoned giant-scale ruins; Rust-Clan salvage operations; Ancient Construct patrols",
  "baseProperties": {
    "temperatureCelsius": 18,
    "aethericIntensity": 0.2,
    "humidityPercent": 40,
    "lightLevel": 0.5,
    "scaleFactor": 2.5,
    "corrosionRate": 0.4
  },
  "primaryCondition": "GiantScale",
  "minVerticalZone": -2,
  "maxVerticalZone": 2,
  "zones": [
    {
      "id": "FoundryWarrens",
      "name": "The Foundry Warrens",
      "description": "Abandoned manufacturing halls built for giant servitors.",
      "overrideProperties": { "scaleFactor": 2.5 }
    },
    {
      "id": "GreatLooms",
      "name": "The Great Looms",
      "description": "Textile production with web-like machinery.",
      "overrideProperties": { "scaleFactor": 3.0 }
    },
    {
      "id": "TitanYards",
      "name": "The Titan Yards",
      "description": "Storage for colossal equipment; unstable stacks.",
      "overrideProperties": { "scaleFactor": 3.0, "corrosionRate": 0.5 }
    },
    {
      "id": "RustClanHolds",
      "name": "The Rust-Clan Holds",
      "description": "Salvager settlements; relatively safe territory.",
      "overrideProperties": { "scaleFactor": 1.5, "lightLevel": 0.6 }
    }
  ],
  "flavorQuote": "Built for giants. Abandoned by all.",
  "colorPalette": "rust-brown-grey-amber"
}
```

### vanaheim.json

```json
{
  "id": "Vanaheim",
  "name": "Vanaheim",
  "subtitle": "The Overgrown Laboratory",
  "deckNumber": 3,
  "preGlitchFunction": "Bio-Engineering & Genetic Research",
  "postGlitchState": "Feral overgrowth; vertical stratification; Golden Plague spores",
  "baseProperties": {
    "temperatureCelsius": 25,
    "aethericIntensity": 0.5,
    "humidityPercent": 85,
    "lightLevel": 0.4,
    "scaleFactor": 1.2,
    "corrosionRate": 0.3
  },
  "primaryCondition": "MutagenicSpores",
  "minVerticalZone": -1,
  "maxVerticalZone": 2,
  "zones": [
    {
      "id": "CanopySea",
      "name": "The Canopy Sea",
      "description": "Livable zone above spore density. Grove-Clan territory.",
      "overrideProperties": {
        "temperatureCelsius": 20,
        "humidityPercent": 60,
        "lightLevel": 0.6,
        "aethericIntensity": 0.4
      },
      "conditionDcModifier": -4
    },
    {
      "id": "GloomVeil",
      "name": "The Gloom-Veil",
      "description": "Transitional shadow. Light fades, spores thicken.",
      "overrideProperties": {
        "humidityPercent": 80,
        "lightLevel": 0.3,
        "aethericIntensity": 0.6
      },
      "conditionDcModifier": 0
    },
    {
      "id": "UnderGrowth",
      "name": "The Under-growth",
      "description": "Maximum spore concentration. The Un-Womb waits here.",
      "overrideProperties": {
        "temperatureCelsius": 32,
        "humidityPercent": 95,
        "lightLevel": 0.0,
        "aethericIntensity": 0.8
      },
      "conditionDcModifier": 4,
      "damageOverride": "3d6"
    }
  ],
  "flavorQuote": "The garden that tends itself—and anything that enters it.",
  "colorPalette": "green-gold-brown-black"
}
```

---

## Unit Testing Requirements

### Jötunheim Tests (~8 tests)

| Test | Description |
|------|-------------|
| `JotunheimDefinition_HasCorrectDeckNumber` | Deck 07 |
| `JotunheimDefinition_HasFourZones` | All zones present |
| `JotunheimDefinition_HasGiantScaleCondition` | Primary condition |
| `GetScaleFactor_GreatLooms_Returns3` | Maximum scale zone |
| `CalculateFallDamage_GiantScale_Multiplies` | 2.5x fall damage |
| `GetClimbDcModifier_Scale25_Returns6` | +6 DC at 2.5 scale |
| `GetMovementCalculations_ReturnsValidObject` | Movement calcs work |
| `RustClanHolds_HasReducedScale` | Safe zone at 1.5x |

### Vanaheim Tests (~8 tests)

| Test | Description |
|------|-------------|
| `VanaheimDefinition_HasCorrectDeckNumber` | Deck 03 |
| `VanaheimDefinition_HasThreeStrata` | All strata present |
| `VanaheimDefinition_HasMutagenicSporesCondition` | Primary condition |
| `GetStratumForZLevel_ZPlus2_ReturnsCanopySea` | Z mapping works |
| `GetSporeDc_CanopySea_Returns8` | DC 12 - 4 = 8 |
| `GetSporeDc_UnderGrowth_Returns16` | DC 12 + 4 = 16 |
| `UpdateExposure_UnderGrowth_AccumulatesFaster` | Exposure scaling |
| `IsInUnWombTerritory_UnderGrowth_ReturnsTrue` | Un-Womb detection |

### Integration Tests (~4 tests)

| Test | Description |
|------|-------------|
| `BiomeAdjacency_JotunheimVanaheim_RequiresTransition` | Transition needed |
| `BiomeAdjacency_VanaheimMuspelheim_IsIncompatible` | Fire/Bio incompatible |
| `BiomeAdjacency_VanaheimMidgard_IsCompatible` | Direct connection |
| `VanaheimStrata_ZLevelMapping_Correct` | Vertical zones map |

**Total: ~20 tests**

---

## Acceptance Criteria

### Functional Requirements

- [ ] Jötunheim loads with 4 zones
- [ ] Vanaheim loads with 3 strata
- [ ] Giant-scale mechanics apply correctly (fall damage, climb DC)
- [ ] Scale factor varies by zone (1.5x - 3.0x)
- [ ] Vanaheim strata map to Z-levels correctly
- [ ] Spore DC decreases with elevation (Canopy < Gloom < Under)
- [ ] Mutagenic exposure accumulates and converts to Corruption
- [ ] Un-Womb territory detection works in Under-growth
- [ ] Muspelheim ↔ Vanaheim adjacency returns Incompatible

### Quality Requirements

- [ ] All public members have XML documentation
- [ ] Configuration validates against schema
- [ ] ~20 unit tests pass
- [ ] Lore descriptions match source documents

---

## Deliverable Checklist

### Domain Layer

- [ ] `JotunheimZoneId` enum (4 values)
- [ ] `VanaheimStratumId` enum (3 values)
- [ ] `GiantScaleHazard` enum (5 values)
- [ ] `MutagenicExposure` value object
- [ ] `GiantScaleMovement` value object

### Application Layer

- [ ] `IJotunheimService` interface
- [ ] `IVanaheimService` interface

### Configuration

- [ ] `jotunheim.json` complete definition
- [ ] `vanaheim.json` complete definition

### Tests

- [ ] Jötunheim tests (~8)
- [ ] Vanaheim tests (~8)
- [ ] Integration tests (~4)
