> **Archived** - This changelog has been consolidated. See the complete version at [v0.1.2](../v0.1.x/v0.1.2.md).

# Changelog: v0.1.2b - The Burden of Survival (Player Interaction)

**Release Date:** 2025-12-19

---

## Summary

Version 0.1.2b implements the complete **inventory and equipment system** for player interaction with items. This release introduces the `InventoryService` to manage inventory operations, burden calculation with encumbrance mechanics, and equipment management with attribute bonus recalculation. The system enforces realistic carrying capacity limits based on the MIGHT attribute, applies Finesse penalties when heavily burdened, and prevents movement when overburdened. The `CommandParser` received extensive updates to support inventory commands (`inventory`, `equipment`, `equip`, `unequip`, `drop`), creating a comprehensive item management interface. This release completes the player interaction layer, bridging domain models with user-facing commands through robust service orchestration.

---

## New Files Created

### Core Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/BurdenState.cs` | Defines encumbrance states (Light, Heavy, Overburdened) based on carried weight percentage |
| `RuneAndRust.Core/Interfaces/IInventoryService.cs` | Service contract for inventory operations including `InventoryResult` record type |
| `RuneAndRust.Core/Interfaces/IInventoryRepository.cs` | Repository contract for InventoryItem persistence and querying |

### Engine Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Engine/Services/InventoryService.cs` | Full inventory management implementation with burden calculation, equipment handling, and display formatting |

### Persistence Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Persistence/Repositories/InventoryRepository.cs` | EF Core repository implementation for InventoryItem queries and persistence |

### Test Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Tests/Engine/InventoryServiceTests.cs` | Comprehensive test suite with 55 tests covering all inventory operations |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Engine/Services/CommandParser.cs` | Added inventory commands (`inventory`/`i`/`pack`, `equipment`/`gear`/`equipped`, `equip <item>`, `unequip <slot>`, `drop <item>`) and corresponding ParseResult flags |
| `RuneAndRust.Engine/Services/StatCalculationService.cs` | Updated `RecalculateDerivedStats` to use `GetEffectiveAttribute` for equipment bonuses; added initialization logic and ratio preservation for HP/Stamina |
| `RuneAndRust.Tests/Engine/CommandParserTests.cs` | Added 15 tests for inventory command parsing and validation |
| `RuneAndRust.Tests/Engine/StatCalculationServiceTests.cs` | Added 30 tests for derived stat calculations, equipment bonus integration, and archetype/lineage bonus methods |

---

## Code Implementation Details

### BurdenState Enum

```csharp
public enum BurdenState
{
    Light = 0,        // Under 70% capacity - no penalties
    Heavy = 1,        // 70-90% capacity - -2 Finesse penalty
    Overburdened = 2  // Over 90% capacity - cannot move
}
```

**Values:**
- `Light`: Normal movement, full attributes
- `Heavy`: -2 Finesse penalty applied to EquipmentBonuses
- `Overburdened`: Movement blocked (CanMoveAsync returns false)

### IInventoryService Interface

**Key Methods:**
```csharp
Task<InventoryResult> AddItemAsync(Character character, Item item, int quantity = 1);
Task<InventoryResult> RemoveItemAsync(Character character, string itemName, int quantity = 1);
Task<InventoryResult> DropItemAsync(Character character, string itemName);
Task<InventoryResult> EquipItemAsync(Character character, string itemName);
Task<InventoryResult> UnequipSlotAsync(Character character, EquipmentSlot slot);
Task<InventoryResult> UnequipItemAsync(Character character, string itemName);
Task<BurdenState> CalculateBurdenAsync(Character character);
int GetMaxCapacity(Character character);
Task<int> GetCurrentWeightAsync(Character character);
Task<bool> CanMoveAsync(Character character);
Task RecalculateEquipmentBonusesAsync(Character character);
Task<string> FormatInventoryDisplayAsync(Character character);
Task<string> FormatEquipmentDisplayAsync(Character character);
```

**InventoryResult Record:**
```csharp
public record InventoryResult(bool Success, string Message);
```

### InventoryService Implementation

**Constants:**
- `HeavyBurdenThreshold = 0.7` (70% of max capacity)
- `OverburdenedThreshold = 0.9` (90% of max capacity)
- `GramsPerMight = 10000` (capacity formula)

**Core Behaviors:**

**AddItemAsync:**
- Validates quantity > 0
- Checks for existing inventory entry
- Handles stackable items: increases quantity if within MaxStackSize
- Rejects non-stackable duplicates
- Creates new InventoryItem with next SlotPosition

**RemoveItemAsync:**
- Finds item by name (case-insensitive via repository)
- Decreases quantity or removes entry entirely
- Returns failure if insufficient quantity

**DropItemAsync:**
- Prevents dropping equipped items
- Prevents dropping KeyItem types
- Removes entire stack from inventory

**EquipItemAsync:**
- Validates item is Equipment type
- Checks equipment requirements via `MeetsRequirements()`
- Unequips any item currently in target slot
- Sets `IsEquipped = true`
- Calls `RecalculateEquipmentBonusesAsync`

**UnequipSlotAsync / UnequipItemAsync:**
- Sets `IsEquipped = false`
- Calls `RecalculateEquipmentBonusesAsync`

**CalculateBurdenAsync:**
- Formula: `ratio = currentWeight / maxCapacity`
- Returns `Overburdened` if ratio >= 0.9
- Returns `Heavy` if ratio >= 0.7
- Returns `Light` otherwise
- Logs warning if maxCapacity == 0

**GetMaxCapacity:**
- Formula: `effectiveMight × 10,000 grams`
- Uses `character.GetEffectiveAttribute(Might)` to include equipment bonuses

**RecalculateEquipmentBonusesAsync:**
- Clears existing EquipmentBonuses dictionary
- Iterates equipped items, summing AttributeBonuses
- Applies -2 Finesse penalty if burden state is Heavy
- Does NOT apply penalty if Overburdened (movement already blocked)

**FormatInventoryDisplayAsync:**
- Header: "=== PACK ==="
- Lists unequipped items with quantity and weight in kg
- Displays current/max weight in kg
- Shows burden state with penalty descriptions

**FormatEquipmentDisplayAsync:**
- Header: "=== EQUIPMENT ==="
- Lists all equipment slots (MainHand, OffHand, Head, Body, Hands, Legs, Feet, Neck, Finger1, Finger2)
- Shows equipped item name or "(empty)"

### CommandParser Updates

**New ParseResult Flags:**
```csharp
public bool RequiresInventory { get; set; }
public bool RequiresEquipment { get; set; }
public bool RequiresEquip { get; set; }
public string? EquipTarget { get; set; }
public bool RequiresUnequip { get; set; }
public string? UnequipTarget { get; set; }
public bool RequiresDrop { get; set; }
public string? DropTarget { get; set; }
```

**Command Mappings:**
- `inventory`, `i`, `pack` → `RequiresInventory = true`
- `equipment`, `gear`, `equipped` → `RequiresEquipment = true`
- `equip <item>`, `bind <item>` → `RequiresEquip = true`, `EquipTarget = <item>`
- `unequip <slot>`, `unbind <item>`, `remove <slot>` → `RequiresUnequip = true`, `UnequipTarget = <slot|item>`
- `drop <item>`, `discard <item>` → `RequiresDrop = true`, `DropTarget = <item>`

**Target Extraction:**
- Uses `ExtractTarget()` helper to parse command targets
- Converts targets to lowercase for case-insensitive matching
- Displays error if command lacks required target

**Help Text Updates:**
- Added "Inventory:" section with inventory/equipment/equip/unequip/drop commands
- Separated "objects"/"items" (room objects) from "inventory"/"i"/"pack" (player inventory)

### StatCalculationService Updates

**RecalculateDerivedStats Changes:**

1. **Equipment Bonus Integration:**
   - Changed from base attributes to `GetEffectiveAttribute()` calls
   - MaxHP uses effective Sturdiness
   - MaxStamina uses effective Finesse and Sturdiness
   - ActionPoints uses effective Wits

2. **Initialization Logic:**
   - Detects first-time calculation when `previousMax = 0`
   - Sets CurrentHP to MaxHP on initialization
   - Sets CurrentStamina to MaxStamina on initialization

3. **Ratio Preservation:**
   - Calculates HP/Stamina ratio before updating max values
   - Applies ratio to new max values when max changes
   - Ensures CurrentHP >= 1 after recalculation
   - Ensures CurrentStamina >= 0 after recalculation

**New Methods Tested:**
- `CalculateMaxHP(int sturdiness)` - Formula: `50 + (sturdiness × 10)`
- `CalculateMaxStamina(int finesse, int sturdiness)` - Formula: `20 + (finesse × 5) + (sturdiness × 3)`
- `CalculateActionPoints(int wits)` - Formula: `2 + (wits / 4)` (integer division)
- `GetArchetypeBonuses(ArchetypeType)` - Returns attribute bonuses for Warrior, Skirmisher, Adept, Mystic
- `GetLineageBonuses(LineageType)` - Returns attribute bonuses for Human, RuneMarked, IronBlooded, VargrKin

---

## Logging Matrix

### InventoryService

| Event | Level | Template |
|-------|-------|----------|
| Add item start | Information | `"Adding {Quantity}x {ItemName} to {CharacterName}'s inventory"` |
| Invalid quantity | Warning | `"Invalid quantity {Quantity} for AddItemAsync"` |
| Stack exceeds max | Warning | `"Stack would exceed max size: {NewQuantity} > {MaxStack}"` |
| Update stack | Debug | `"Updated stack to {Quantity}x {ItemName}"` |
| Item not stackable | Warning | `"Item {ItemName} is not stackable and already in inventory"` |
| Add complete | Information | `"Added {Quantity}x {ItemName} to inventory"` |
| Remove start | Information | `"Removing {Quantity}x {ItemName} from {CharacterName}'s inventory"` |
| Item not found | Debug | `"Item {ItemName} not found in inventory"` |
| Insufficient quantity | Debug | `"Not enough {ItemName}: have {Have}, need {Need}"` |
| Remove complete | Information | `"Removed {Quantity}x {ItemName} from inventory"` |
| Drop start | Information | `"{CharacterName} dropping {ItemName}"` |
| Drop complete | Information | `"Dropped {ItemName}"` |
| Equip start | Information | `"{CharacterName} equipping {ItemName}"` |
| Unequip old item | Debug | `"Unequipped {OldItem} from {Slot}"` |
| Equip complete | Information | `"Equipped {ItemName} in {Slot}"` |
| Unequip slot start | Information | `"{CharacterName} unequipping slot {Slot}"` |
| Unequip slot complete | Information | `"Unequipped {ItemName} from {Slot}"` |
| Unequip item start | Information | `"{CharacterName} unequipping {ItemName}"` |
| Unequip item complete | Information | `"Unequipped {ItemName}"` |
| Max capacity zero | Warning | `"Max capacity is zero for {CharacterName}"` |
| Burden calculation | Debug | `"Burden calculation: {Current}g / {Max}g = {Ratio:P1}"` |
| Recalculate start | Debug | `"Recalculating equipment bonuses for {CharacterName}"` |
| Heavy burden penalty | Debug | `"Applied Heavy burden penalty: -2 Finesse"` |
| Recalculate complete | Information | `"Equipment bonuses recalculated: {BonusCount} attributes modified"` |

### StatCalculationService

| Event | Level | Template |
|-------|-------|----------|
| Recalculate start | Information | `"Recalculating derived stats for character {CharacterName}"` |
| Effective attributes | Debug | `"Effective attributes - Sturdiness: {Sturdiness}, Finesse: {Finesse}, Wits: {Wits}"` |
| Derived stats complete | Information | `"Derived stats calculated - MaxHP: {MaxHP}, MaxStamina: {MaxStamina}, ActionPoints: {ActionPoints}"` |
| Calculate MaxHP | Trace | `"Calculating MaxHP for Sturdiness {Sturdiness}"` |
| MaxHP result | Debug | `"MaxHP calculated: 50 + ({Sturdiness} * 10) = {Result}"` |
| Calculate MaxStamina | Trace | `"Calculating MaxStamina for Finesse {Finesse}, Sturdiness {Sturdiness}"` |
| MaxStamina result | Debug | `"MaxStamina calculated: 20 + ({Finesse} * 5) + ({Sturdiness} * 3) = {Result}"` |
| Calculate ActionPoints | Trace | `"Calculating ActionPoints for Wits {Wits}"` |
| ActionPoints result | Debug | `"ActionPoints calculated: 2 + ({Wits} / 4) = {Result}"` |

---

## Test Coverage

### Summary
```
Total: 962 | Passed: 962 | Failed: 0 | Duration: 514ms
```

**New Tests Added:** 92 tests
- InventoryServiceTests: 55 tests
- StatCalculationServiceTests: 30 new tests
- CommandParserTests: 15 new tests
- Modified: 2 tests updated in existing suites

---

## Complete Test Inventory

### InventoryServiceTests (55 tests)

#### AddItemAsync Tests (7 tests)

| Test Name | Description |
|-----------|-------------|
| `AddItemAsync_NewItem_ShouldSucceed` | Adds a new item to empty inventory |
| `AddItemAsync_StackableItem_ShouldIncreaseQuantity` | Stacks 2 items onto existing stack of 3 |
| `AddItemAsync_ExceedsMaxStack_ShouldFail` | Rejects adding 5 to stack of 8 when max is 10 |
| `AddItemAsync_NonStackableItemAlreadyOwned_ShouldFail` | Prevents duplicate non-stackable items |
| `AddItemAsync_InvalidQuantity_ShouldFail` | Rejects quantity of 0 |
| `AddItemAsync_NegativeQuantity_ShouldFail` | Rejects negative quantities |

#### RemoveItemAsync Tests (5 tests)

| Test Name | Description |
|-----------|-------------|
| `RemoveItemAsync_ExistingItem_ShouldSucceed` | Reduces quantity by 1 |
| `RemoveItemAsync_AllQuantity_ShouldRemoveEntry` | Removes entry when quantity reaches 0 |
| `RemoveItemAsync_NotEnoughQuantity_ShouldFail` | Rejects removing 5 when only 1 exists |
| `RemoveItemAsync_NotFound_ShouldFail` | Returns failure for non-existent item |

#### DropItemAsync Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `DropItemAsync_UnequippedItem_ShouldSucceed` | Removes unequipped item from inventory |
| `DropItemAsync_EquippedItem_ShouldFail` | Prevents dropping equipped items |
| `DropItemAsync_KeyItem_ShouldFail` | Prevents dropping KeyItem types |
| `DropItemAsync_NotFound_ShouldFail` | Returns failure for non-existent item |

#### EquipItemAsync Tests (7 tests)

| Test Name | Description |
|-----------|-------------|
| `EquipItemAsync_ValidEquipment_ShouldSucceed` | Equips item to empty slot |
| `EquipItemAsync_ReplacesExistingItem_ShouldSucceed` | Unequips old item and equips new |
| `EquipItemAsync_NonEquipment_ShouldFail` | Prevents equipping non-Equipment items |
| `EquipItemAsync_AlreadyEquipped_ShouldFail` | Rejects re-equipping same item |
| `EquipItemAsync_RequirementsNotMet_ShouldFail` | Validates equipment requirements |
| `EquipItemAsync_NotFound_ShouldFail` | Returns failure for non-existent item |

#### UnequipSlotAsync Tests (2 tests)

| Test Name | Description |
|-----------|-------------|
| `UnequipSlotAsync_EquippedSlot_ShouldSucceed` | Unequips item from slot |
| `UnequipSlotAsync_EmptySlot_ShouldFail` | Returns failure for empty slot |

#### UnequipItemAsync Tests (3 tests)

| Test Name | Description |
|-----------|-------------|
| `UnequipItemAsync_EquippedItem_ShouldSucceed` | Unequips item by name |
| `UnequipItemAsync_NotEquipped_ShouldFail` | Rejects unequipping non-equipped item |
| `UnequipItemAsync_NotFound_ShouldFail` | Returns failure for non-existent item |

#### CalculateBurdenAsync Tests (6 tests)

| Test Name | Description |
|-----------|-------------|
| `CalculateBurdenAsync_UnderSeventyPercent_ShouldReturnLight` | 60% capacity returns Light |
| `CalculateBurdenAsync_AtSeventyPercent_ShouldReturnHeavy` | 70% capacity returns Heavy |
| `CalculateBurdenAsync_AtEightyPercent_ShouldReturnHeavy` | 80% capacity returns Heavy |
| `CalculateBurdenAsync_AtNinetyPercent_ShouldReturnOverburdened` | 90% capacity returns Overburdened |
| `CalculateBurdenAsync_OverOneHundredPercent_ShouldReturnOverburdened` | 120% capacity returns Overburdened |
| `CalculateBurdenAsync_EmptyInventory_ShouldReturnLight` | 0% capacity returns Light |

#### GetMaxCapacity Tests (2 tests)

| Test Name | Description |
|-----------|-------------|
| `GetMaxCapacity_ShouldReturnMightTimesTenThousand` | MIGHT 5 returns 50,000g |
| `GetMaxCapacity_WithEquipmentBonuses_ShouldUseEffectiveAttribute` | MIGHT 5 + 2 bonus returns 70,000g |

#### CanMoveAsync Tests (3 tests)

| Test Name | Description |
|-----------|-------------|
| `CanMoveAsync_LightBurden_ShouldReturnTrue` | Light burden allows movement |
| `CanMoveAsync_HeavyBurden_ShouldReturnTrue` | Heavy burden allows movement |
| `CanMoveAsync_Overburdened_ShouldReturnFalse` | Overburdened blocks movement |

#### RecalculateEquipmentBonusesAsync Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `RecalculateEquipmentBonusesAsync_WithEquippedItems_ShouldApplyBonuses` | Applies +1 Might from sword |
| `RecalculateEquipmentBonusesAsync_MultipleItems_ShouldStackBonuses` | Stacks bonuses from multiple items |
| `RecalculateEquipmentBonusesAsync_HeavyBurden_ShouldApplyPenalty` | Applies -2 Finesse at 80% capacity |
| `RecalculateEquipmentBonusesAsync_NoItems_ShouldClearBonuses` | Clears pre-existing bonuses |

#### FormatInventoryDisplayAsync Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `FormatInventoryDisplayAsync_EmptyInventory_ShouldShowEmpty` | Displays "(empty)" for empty inventory |
| `FormatInventoryDisplayAsync_WithItems_ShouldListItems` | Lists items with quantity and weight |
| `FormatInventoryDisplayAsync_HeavyBurden_ShouldShowPenalty` | Shows "Heavy (-2 Finesse)" |
| `FormatInventoryDisplayAsync_Overburdened_ShouldShowWarning` | Shows "OVERBURDENED (Cannot move!)" |

#### FormatEquipmentDisplayAsync Tests (2 tests)

| Test Name | Description |
|-----------|-------------|
| `FormatEquipmentDisplayAsync_NoEquipment_ShouldShowEmptySlots` | Shows all slots as "(empty)" |
| `FormatEquipmentDisplayAsync_WithEquipment_ShouldShowItems` | Displays equipped items in slots |

### StatCalculationServiceTests (30 new tests)

#### CalculateMaxHP Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `CalculateMaxHP_BaseSturdinessOne_ReturnsSixty` | 1 Sturdiness = 60 HP |
| `CalculateMaxHP_BaseSturdinesssFive_ReturnsOneHundred` | 5 Sturdiness = 100 HP |
| `CalculateMaxHP_BaseSturdinesssTen_ReturnsOneHundredFifty` | 10 Sturdiness = 150 HP |
| `CalculateMaxHP_ZeroSturdiness_ReturnsFifty` | 0 Sturdiness = 50 HP |

#### CalculateMaxStamina Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `CalculateMaxStamina_BaseValues_CalculatesCorrectly` | Finesse 1, Sturdiness 1 = 28 |
| `CalculateMaxStamina_MidValues_CalculatesCorrectly` | Finesse 5, Sturdiness 5 = 60 |
| `CalculateMaxStamina_MaxValues_CalculatesCorrectly` | Finesse 10, Sturdiness 10 = 100 |
| `CalculateMaxStamina_ZeroValues_ReturnsBase` | Finesse 0, Sturdiness 0 = 20 |

#### CalculateActionPoints Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `CalculateActionPoints_WitsOne_ReturnsTwo` | Wits 1 = 2 AP |
| `CalculateActionPoints_WitsFour_ReturnsThree` | Wits 4 = 3 AP |
| `CalculateActionPoints_WitsEight_ReturnsFour` | Wits 8 = 4 AP |
| `CalculateActionPoints_WitsTen_ReturnsFour` | Wits 10 = 4 AP (integer division) |

#### RecalculateDerivedStats Tests (6 tests)

| Test Name | Description |
|-----------|-------------|
| `RecalculateDerivedStats_UsesEffectiveAttributes` | Applies equipment bonuses to calculations |
| `RecalculateDerivedStats_SetsMaxHP` | Sets MaxHP based on Sturdiness |
| `RecalculateDerivedStats_SetsMaxStamina` | Sets MaxStamina based on Finesse and Sturdiness |
| `RecalculateDerivedStats_SetsActionPoints` | Sets ActionPoints based on Wits |
| `RecalculateDerivedStats_PreservesHPRatio` | Maintains HP percentage when MaxHP changes |
| `RecalculateDerivedStats_PreservesStaminaRatio` | Maintains Stamina percentage when MaxStamina changes |
| `RecalculateDerivedStats_CurrentHPNeverBelowOne` | Ensures CurrentHP >= 1 after recalculation |

#### GetArchetypeBonuses Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `GetArchetypeBonuses_Warrior_ReturnsSturdinessAndMight` | Warrior: +2 Sturdiness, +1 Might |
| `GetArchetypeBonuses_Skirmisher_ReturnsFinesseAndWits` | Skirmisher: +2 Finesse, +1 Wits |
| `GetArchetypeBonuses_Adept_ReturnsWitsAndWill` | Adept: +2 Wits, +1 Will |
| `GetArchetypeBonuses_Mystic_ReturnsWillAndSturdiness` | Mystic: +2 Will, +1 Sturdiness |

#### GetLineageBonuses Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `GetLineageBonuses_Human_ReturnsAllAttributesPlus1` | Human: +1 to all 5 attributes |
| `GetLineageBonuses_RuneMarked_ReturnsWitsAndWillWithSturdinesssPenalty` | RuneMarked: +2 Wits, +2 Will, -1 Sturdiness |
| `GetLineageBonuses_IronBlooded_ReturnsSturdinessAndMightWithWitsPenalty` | IronBlooded: +2 Sturdiness, +2 Might, -1 Wits |
| `GetLineageBonuses_VargrKin_ReturnsFinesseAndWitsWithWillPenalty` | VargrKin: +2 Finesse, +2 Wits, -1 Will |

### CommandParserTests (15 new tests)

#### Inventory Command Tests (7 tests)

| Test Name | Description |
|-----------|-------------|
| `ParseAndExecute_Exploration_InventoryCommands_ReturnsRequiresInventory` | Validates "inventory", "i", "pack" commands |
| `ParseAndExecute_Exploration_EquipmentCommands_ReturnsRequiresEquipment` | Validates "equipment", "gear", "equipped" commands |
| `ParseAndExecute_Exploration_EquipCommand_ReturnsEquipWithTarget` | Parses "equip Iron Sword" and "bind Iron Sword" |
| `ParseAndExecute_Exploration_UnequipCommand_ReturnsUnequipWithTarget` | Parses "unequip mainhand", "unbind Iron Sword", "remove helmet" |
| `ParseAndExecute_Exploration_DropCommand_ReturnsDropWithTarget` | Parses "drop Iron Sword" and "discard junk" |
| `ParseAndExecute_Exploration_EquipWithoutTarget_DisplaysError` | Rejects "equip" without target |
| `ParseAndExecute_Exploration_UnequipWithoutTarget_DisplaysError` | Rejects "unequip" without target |
| `ParseAndExecute_Exploration_DropWithoutTarget_DisplaysError` | Rejects "drop" without target |
| `ParseAndExecute_Exploration_Objects_ReturnsRequiresListObjects` | Validates "objects" command distinct from inventory |
| `ParseAndExecute_Exploration_Help_IncludesInventoryCommands` | Verifies help text includes inventory section |

---

## DI Registration

No new service registrations were added in v0.1.2b. The `InventoryService` and `InventoryRepository` will be registered in a subsequent integration release when the complete persistence layer is wired into the application startup.

Expected future registration:
```csharp
// RuneAndRust.Terminal/Program.cs
services.AddScoped<IInventoryRepository, InventoryRepository>();
services.AddScoped<IInventoryService, InventoryService>();
```

---

## Verification Results

### Build Output
```
Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:03.42
```

### Test Output
```
Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:   962, Skipped:     0, Total:   962, Duration: 514 ms
```

---

## Directory Structure After v0.1.2b

```
RuneAndRust/
├── RuneAndRust.Core/
│   ├── Entities/
│   │   ├── Character.cs
│   │   ├── Equipment.cs
│   │   ├── InteractableObject.cs
│   │   ├── InventoryItem.cs
│   │   ├── Item.cs
│   │   ├── Room.cs
│   │   └── SaveGame.cs
│   ├── Enums/
│   │   ├── Attribute.cs
│   │   ├── ArchetypeType.cs
│   │   ├── BiomeType.cs
│   │   ├── BurdenState.cs           [NEW]
│   │   ├── DangerLevel.cs
│   │   ├── Direction.cs
│   │   ├── EquipmentSlot.cs
│   │   ├── GamePhase.cs
│   │   ├── ItemType.cs
│   │   ├── LineageType.cs
│   │   ├── ObjectType.cs
│   │   ├── PendingGameAction.cs
│   │   └── QualityTier.cs
│   ├── Interfaces/
│   │   ├── IDiceService.cs
│   │   ├── IInputHandler.cs
│   │   ├── IInventoryRepository.cs  [NEW]
│   │   ├── IInventoryService.cs     [NEW]
│   │   ├── IRepository.cs
│   │   ├── ISaveGameRepository.cs
│   │   └── IStatCalculationService.cs
│   └── Models/
│       ├── Character.cs
│       └── GameState.cs
├── RuneAndRust.Engine/
│   └── Services/
│       ├── CommandParser.cs         [MODIFIED]
│       ├── DiceService.cs
│       ├── GameService.cs           [MODIFIED]
│       ├── InventoryService.cs      [NEW]
│       ├── SaveManager.cs
│       └── StatCalculationService.cs [MODIFIED]
├── RuneAndRust.Persistence/
│   ├── Data/
│   │   └── RuneAndRustDbContext.cs
│   └── Repositories/
│       ├── CharacterRepository.cs
│       ├── GenericRepository.cs
│       ├── InteractableObjectRepository.cs
│       ├── InventoryRepository.cs   [NEW]
│       ├── ItemRepository.cs
│       ├── RoomRepository.cs
│       └── SaveGameRepository.cs
├── RuneAndRust.Terminal/
│   ├── Program.cs                   [MODIFIED]
│   ├── RuneAndRust.Terminal.csproj  [MODIFIED]
│   └── Services/
│       └── TerminalInputHandler.cs
├── RuneAndRust.Tests/
│   ├── Core/
│   │   ├── AttributeTests.cs
│   │   ├── CharacterTests.cs
│   │   ├── GamePhaseTests.cs
│   │   ├── GameStateTests.cs
│   │   └── PendingGameActionTests.cs
│   ├── Engine/
│   │   ├── CommandParserTests.cs    [MODIFIED]
│   │   ├── DiceServiceTests.cs
│   │   ├── GameLoopTests.cs
│   │   ├── GameServiceTests.cs      [MODIFIED]
│   │   ├── InventoryServiceTests.cs [NEW]
│   │   ├── SaveManagerTests.cs
│   │   └── StatCalculationServiceTests.cs [MODIFIED]
│   ├── Integration/
│   │   └── PersistenceTests.cs
│   └── RuneAndRust.Tests.csproj     [MODIFIED]
└── docs/
    └── changelogs/
        ├── v0.0.2.md
        ├── v0.0.3.md
        ├── v0.0.4.md
        ├── v0.1.1.md
        ├── v0.1.2a.md
        └── v0.1.2b.md               [NEW]
```

---

## Running Tests

### Run All Tests
```bash
dotnet test
```

### Run Only New Inventory Tests
```bash
dotnet test --filter "FullyQualifiedName~InventoryServiceTests"
```

### Run Updated CommandParser Tests
```bash
dotnet test --filter "FullyQualifiedName~CommandParserTests"
```

### Run Updated StatCalculation Tests
```bash
dotnet test --filter "FullyQualifiedName~StatCalculationServiceTests"
```

### Run All v0.1.2b Tests (Inventory + CommandParser + StatCalculation)
```bash
dotnet test --filter "FullyQualifiedName~InventoryServiceTests|FullyQualifiedName~CommandParserTests|FullyQualifiedName~StatCalculationServiceTests"
```

---

## Next Steps (v0.1.2c: The Burden of Survival - World Interaction)

Planned features for the next sub-version:

- **ObjectInteractionService** - Service for examining, opening, closing, and searching interactable objects in rooms
- **ObjectRepository** - Persistence layer for InteractableObject entities and room contents
- **Take/Get Commands** - Implement item pickup from room objects (containers, corpses, etc.)
- **Search Mechanics** - WITS-based hidden object discovery system
- **Container State Management** - Track open/closed/locked states for containers
- **Integration Testing** - End-to-end tests for room exploration and item acquisition flow
- **GameService Integration** - Wire inventory and object services into game loop for complete player interaction

This will complete the player interaction layer by enabling item acquisition from the game world, closing the loop between room exploration, object interaction, and inventory management.
