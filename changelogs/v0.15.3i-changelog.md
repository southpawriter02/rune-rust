# v0.15.3i Changelog - Specialization Integration for Rhetoric

## Summary

Implements the **Specialization Integration** subsystem of the Rhetoric skill. Enables archetype-specific abilities to modify social interaction mechanics through the **Specialization Bonus Hook Pattern**. Features 8 unique abilities across 4 archetypes (Thul, Skald, Kupmaðr, Myrk-gengr) with effect types including dice bonuses, auto-success conditions, outcome modifications, party buffs, stress relief, and asset creation. Each ability triggers based on specific context conditions and integrates with the existing social interaction flow at pre-check, post-check, and special action points.

## Added

### Domain Layer - Enums (1 file)

| File | Description |
|------|-------------|
| `RhetoricSpecializationAbility.cs` | 8-value enum defining rhetoric specialization abilities: VoiceOfReason(0), ScholarlyAuthority(1), InspiringWords(2), SagaOfHeroes(3), SilverTongue(4), SniffOutLies(5), MaintainCover(6), ForgeDocuments(7). Extensive XML documentation including activation conditions, limitations, and examples for each ability. |

### Domain Layer - Extensions (1 file)

| File | Description |
|------|-------------|
| `RhetoricSpecializationAbilityExtensions.cs` | Extension methods: `GetDisplayName()`, `GetDescription()`, `GetArchetypeId()`, `GetArchetypeName()`, `GetDiceBonus()`, `ModifiesDicePool()`, `ModifiesOutcome()`, `CanBypassCheck()`, `AffectsParty()`, `CreatesAsset()`, `RequiresActivationCheck()`, `GetActivationDc()`, `GetAutoSuccessThreshold()`, `GetBaseStressReduction()`, `GetAbilityType()`, `GetIconHint()`, `GetColorHint()`, `GetFlavorText()`, `GetAbilitiesForArchetype()`. |

### Domain Layer - Value Objects (1 file)

| File | Description |
|------|-------------|
| `SpecializationAbilityEffect.cs` | Readonly record struct capturing ability effect parameters. Properties: Ability, DiceBonus, AutoSuccess, AutoSuccessThreshold, PreventOptionLock, StressReduction, IsPartyWide, FumbleDowngrade, CreatesAsset, AssetType, AssetQuality, Duration, Description. Computed: ModifiesDicePool, ModifiesOutcome, BypassesCheck, AffectsParty, ReducesStress, ProducesAsset, HasEffect, HasDuration. Factory methods: `DiceBonusEffect()`, `AutoSucceedEffect()`, `PreventLockEffect()`, `StressReliefEffect()`, `InspirationEffect()`, `MaintainCoverEffect()`, `ForgeryEffect()`, `None`. |

### Domain Layer - Interfaces (1 file)

| File | Description |
|------|-------------|
| `IRhetoricSpecializationService.cs` | Service interface: `GetPreCheckBonus()`, `CanAutoSucceed()`, `ApplyPostCheckModification()`, `ApplyInspirationAsync()`, `PerformStorytellingAsync()`, `CreateForgedDocumentAsync()`, `GetPlayerAbilities()`, `GetPlayerArchetype()`, `HasAbility()`, `GetAbilityDetails()`. |

### Application Layer - Service (1 file)

| File | Description |
|------|-------------|
| `RhetoricSpecializationService.cs` | Full implementation with ILogger, ISkillService, IDiceService, and Func<Guid, Player?> dependencies. Constants: SilverTongueDcThreshold=12, ScholarlyAuthorityBonus=2, SniffOutLiesBonus=2, MaintainCoverBonus=2, InspiringWordsDc=12, SagaOfHeroesDc=10, ExceptionalSuccessThreshold=3. Private methods: `GetThulPreCheckBonus()`, `GetKupmadrPreCheckBonus()`, `GetMyrkGengrPreCheckBonus()`, `IsLoreOrHistoryTopic()`, `GetForgeryDc()`. |

### Configuration (2 files)

| File | Description |
|------|-------------|
| `config/social/rhetoric-specialization-abilities.json` | Ability definitions for all 8 abilities including triggers, effects, activation conditions, archetype mappings, ability types, global settings, and narrative templates. |
| `config/schemas/rhetoric-specialization-abilities.schema.json` | JSON Schema for rhetoric-specialization-abilities.json validation. Defines Ability, AbilityTrigger, AbilityActivation, AbilityEffect, StressReductionByTier, DocumentTypes, QualityBySuccess, ArchetypeMapping, AbilityTypeDefinition, GlobalSettings. |

### Unit Tests (1 test file, 50+ tests)

| File | Tests |
|------|-------|
| `RhetoricSpecializationSystemTests.cs` | GetDisplayName non-empty and expected values (all 8 abilities). GetArchetypeId correct mappings (Thul, Skald, Kupmaðr, Myrk-gengr). GetAbilitiesForArchetype returns correct abilities per archetype, empty for unknown, case-insensitive. GetDiceBonus returns 2/1/0 for appropriate abilities. GetAutoSuccessThreshold returns 12 for SilverTongue. CanBypassCheck true only for SilverTongue. GetActivationDc returns 12/10 for InspiringWords/SagaOfHeroes. AffectsParty true for party abilities. ModifiesOutcome true for VoiceOfReason/MaintainCover. CreatesAsset true only for ForgeDocuments. GetBaseStressReduction returns positive for SagaOfHeroes/MaintainCover. GetAbilityType returns correct categorization. SpecializationAbilityEffect factory methods (DiceBonusEffect, AutoSucceedEffect, PreventLockEffect, StressReliefEffect, InspirationEffect, MaintainCoverEffect, ForgeryEffect, None). ToDisplayString/ToLogString output. GetColorHint archetype consistency. GetIconHint/GetFlavorText/GetDescription non-empty. Enum ordinal values and count. |

## Key Features

### Archetype Abilities

| Archetype | Ability | Effect Type | Description |
|-----------|---------|-------------|-------------|
| Thul | Voice of Reason | Outcome Modification | Failed persuasion doesn't lock dialogue options |
| Thul | Scholarly Authority | Dice Bonus | +2d10 when discussing lore/history topics |
| Skald | Inspiring Words | Party Buff | Grant allies +1d10 on social checks (DC 12 activation) |
| Skald | Saga of Heroes | Stress Relief | Reduce party Stress 1-4 through storytelling (DC 10) |
| Kupmaðr | Silver Tongue | Auto-Success | Auto-succeed negotiation checks DC ≤ 12 |
| Kupmaðr | Sniff Out Lies | Dice Bonus | +2d10 when detecting NPC deception |
| Myrk-gengr | Maintain Cover | Composite | +2d10, -1 Stress, fumble downgrade when cover challenged |
| Myrk-gengr | Forge Documents | Asset Creation | Create forged documents (DC 10-20 based on type) |

### Ability Types

| Type | Description | Abilities |
|------|-------------|-----------|
| Outcome Modification | Modifies check outcome after resolution | Voice of Reason |
| Dice Bonus | Adds bonus dice to pool before rolling | Scholarly Authority, Sniff Out Lies, Maintain Cover |
| Auto-Success | Automatically succeeds below DC threshold | Silver Tongue |
| Party Buff | Provides temporary bonus to allies | Inspiring Words |
| Stress Relief | Reduces stress for party members | Saga of Heroes |
| Composite | Combines multiple effect types | Maintain Cover |
| Asset Creation | Creates usable assets | Forge Documents |

### Service Flow Integration

```
Pre-Check Phase:
  1. GetPreCheckBonus() - Check for dice bonuses (Scholarly Authority, Sniff Out Lies, Maintain Cover)
  2. CanAutoSucceed() - Check for auto-success (Silver Tongue)

Post-Check Phase:
  3. ApplyPostCheckModification() - Modify outcomes (Voice of Reason, Maintain Cover fumble downgrade)

Special Actions:
  4. ApplyInspirationAsync() - Skald inspires allies
  5. PerformStorytellingAsync() - Skald reduces party stress
  6. CreateForgedDocumentAsync() - Myrk-gengr creates forgeries
```

### Forgery Document Types

| Document Type | DC | Time Required |
|--------------|:--:|---------------|
| Simple note | 10 | 10 minutes |
| Travel papers | 12 | 30 minutes |
| Guild credentials | 14 | 1 hour |
| Official orders | 16 | 2 hours |
| Faction authorization | 18 | 4 hours |
| Rare/complex | 20+ | 8+ hours |

### Forgery Quality Tiers

| Success Tier | Quality | Detection DC Reduction |
|--------------|:-------:|:----------------------:|
| Marginal | Passable (2) | -2 |
| Full | Good (3) | -4 |
| Exceptional | Excellent (4) | -6 |
| Critical | Masterwork (5) | Requires expertise |

## Files Changed

| File | Change |
|------|--------|
| `src/Core/RuneAndRust.Domain/Enums/RhetoricSpecializationAbility.cs` | Added |
| `src/Core/RuneAndRust.Domain/Extensions/RhetoricSpecializationAbilityExtensions.cs` | Added |
| `src/Core/RuneAndRust.Domain/ValueObjects/SpecializationAbilityEffect.cs` | Added |
| `src/Core/RuneAndRust.Domain/Interfaces/IRhetoricSpecializationService.cs` | Added |
| `src/Core/RuneAndRust.Application/Services/RhetoricSpecializationService.cs` | Added |
| `config/social/rhetoric-specialization-abilities.json` | Added |
| `config/schemas/rhetoric-specialization-abilities.schema.json` | Added |
| `tests/RuneAndRust.Domain.UnitTests/Services/RhetoricSpecializationSystemTests.cs` | Added |
| `changelogs/v0.15.3i-changelog.md` | Added |

## Test Results

```
Total tests: 85+ (including existing tests)
     Passed: All
     Failed: 0
Build succeeded with 0 warnings, 0 errors
```

## Dependencies

- **v0.15.3h:** `ExtendedInfluenceService` patterns for multi-interaction tracking
- **v0.15.3g:** `CulturalProtocolService` patterns for cultural modifiers
- **v0.15.3f:** `InterrogationService` patterns for skill check mechanics
- **v0.15.3e:** `NegotiationService` patterns for negotiation type handling
- **v0.15.3d:** `IntimidationService` patterns for intimidation mechanics
- **v0.15.3c:** `DeceptionService` patterns for fumble consequences
- **v0.15.3b:** `PersuasionService` patterns for outcome modification
- **v0.15.3a:** `SocialContext`, `SocialContextBuilder`, `SocialModifier`, `SocialResult`
- **v0.15.1b:** `SkillOutcome`, dice pool calculation patterns
- **v0.15.0:** `DiceRollResult`, `IDiceService`, `ISkillService`

## Integration Points

### Previous Subsystems (v0.15.3a-h)

- **Persuasion:** Voice of Reason prevents option locking on failed persuasion
- **Negotiation:** Silver Tongue auto-succeeds DC ≤ 12 negotiations
- **Deception:** Maintain Cover provides +2d10 and fumble downgrade when cover challenged
- **Intimidation:** Abilities can enhance intimidation through dice bonuses
- **Interrogation:** Sniff Out Lies provides +2d10 when detecting deception
- **Cultural Protocols:** Topic tags can trigger Scholarly Authority

### Social Context Integration

```csharp
// Pre-check integration
var preBonus = _rhetoricsSpecializationService.GetPreCheckBonus(playerId, interactionType, context);
if (preBonus.ModifiesDicePool)
{
    dicePool += preBonus.DiceBonus;
}

// Auto-success check
if (_rhetoricsSpecializationService.CanAutoSucceed(playerId, interactionType, finalDc))
{
    return SocialResult.FullSuccess();
}

// Post-check integration
var postMod = _rhetoricsSpecializationService.ApplyPostCheckModification(playerId, result, context);
if (postMod.PreventOptionLock)
{
    result = result with { LockedOptions = Array.Empty<string>() };
}
```

### Future Integration

- Party system will receive inspiration/stress buffs from Skald abilities
- Inventory system will manage forged document assets
- Quest system can grant context bonuses that trigger abilities
- NPC dialogue system will respect Voice of Reason unlocking

## Logging Specifications

| Level | Event |
|-------|-------|
| Information | Service initialized, ability applied, auto-success triggered |
| Debug | Ability trigger check, context evaluation, DC calculation |
| Warning | Non-archetype player attempts archetype-specific action, player not found |

## Notes

- Each archetype has exactly 2 rhetoric abilities
- Abilities are checked in the order: pre-check bonuses → auto-success → post-check modifications
- Party-affecting abilities (Inspiring Words, Saga of Heroes) require explicit activation
- Forge Documents creates an asset that can be used in future interactions
- Voice of Reason only prevents locking on regular failure, not fumbles
- Maintain Cover is a composite ability with dice bonus, stress reduction, AND fumble downgrade
- Topic tag detection for Scholarly Authority uses case-insensitive matching
- Silver Tongue uses final DC (after all modifiers) for threshold comparison
- Extension methods provide static factory pattern for archetype-ability lookup
- Configuration JSON includes narrative templates for rich feedback
- All abilities are logged at appropriate levels for debugging and analytics
