# v0.5.0c Design Specification: Grid Display & Integration

**Version:** 0.5.0c
**Phase Name:** Grid Display & Integration
**Parent Version:** v0.5.0 (Combat Grid Foundation)
**Prerequisites:** v0.5.0b Complete (Movement System)
**Estimated Tests:** ~20 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [GridRenderer](#4-gridrenderer)
5. [CombatService Integration](#5-combatservice-integration)
6. [User-Facing Commands](#6-user-facing-commands)
7. [Data Model Changes](#7-data-model-changes)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [Deliverable Checklist](#11-deliverable-checklist)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Dependencies](#13-dependencies)
14. [Future Considerations](#14-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification implements the ASCII grid display and integrates the combat grid with the existing combat system. Building on the grid infrastructure (v0.5.0a) and movement mechanics (v0.5.0b), this phase enables visual representation of the tactical battlefield and connects grid operations to combat flow.

Key deliverables:
- **ASCII Grid Display**: Visual representation of combat positions
- **Combat Integration**: Grid initialization on combat start, cleanup on end
- **Position Awareness**: Combat commands show positional context
- **Grid Command**: Direct access to tactical map display

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Presentation Interfaces** | `IGridRenderer` |
| **Presentation Services** | `GridRenderer` |
| **Presentation DTOs** | `GridRenderOptions` |
| **CombatService Updates** | Grid initialization, turn management |
| **Commands** | `grid` |
| **GameRenderer Updates** | Grid display in combat view |
| **Tests** | ~20 unit tests |

### 1.3 Architectural Significance

This version completes the **Combat Grid Foundation**:

- **Visual Feedback**: Players see tactical positions via ASCII
- **Combat Lifecycle**: Grid created on combat start, cleared on end
- **Turn Integration**: Movement points reset at turn start
- **Positional Context**: Attack commands show distance and positions

---

## 2. Feature Overview

```
v0.5.0c Grid Display & Integration
├── GridRenderer
│   ├── RenderGrid(grid, options)
│   ├── RenderCompactGrid(grid, options)
│   ├── RenderLegend(grid)
│   └── RenderCombatantList(grid, player, monsters)
├── GridRenderOptions
│   ├── UseBoxDrawing
│   ├── ShowCoordinates
│   ├── ShowLegend
│   ├── HighlightValidMoves
│   └── Compact
├── CombatService Integration
│   ├── StartCombat() → Create grid → Initialize positions
│   ├── EndCombat() → Clear grid
│   ├── StartTurn() → Reset movement points
│   └── Attack awareness of positions
├── GameRenderer Updates
│   ├── Combat view includes grid
│   ├── Movement updates display
│   └── Attack shows position context
└── Commands
    ├── grid
    ├── grid compact
    └── look (includes grid in combat)
```

### 2.1 Scope Alignment

**In Scope:**
- ASCII grid rendering (8x8 default)
- Grid legend (player, monsters, empty, walls)
- Grid display in combat view
- Combat service integration (grid initialization)
- Attack command position awareness
- Combat end grid cleanup
- Grid display on `look` during combat
- `grid` command to show tactical map
- Position indicators in combat messages

**Out of Scope:**
- Range checking (v0.5.1)
- Line of sight (v0.5.1)
- Terrain display (v0.5.2)
- Cover display (v0.5.2)

---

## 3. Architecture Diagrams

### 3.1 Grid Display Formats

```
┌─────────────────────────────────────────────────────────────────────┐
│                      FULL GRID DISPLAY                               │
└─────────────────────────────────────────────────────────────────────┘

Combat Grid                              [Turn 3]
===============================================

     A   B   C   D   E   F   G   H
   +---+---+---+---+---+---+---+---+
 1 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 2 | . | . | M | . | . | M | . | . |
   +---+---+---+---+---+---+---+---+
 3 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 4 | . | . | . | @ | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 5 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 6 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 7 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 8 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+

Legend: @ = You (D4)  M = Monster  . = Empty  # = Wall


┌─────────────────────────────────────────────────────────────────────┐
│                      COMPACT GRID DISPLAY                            │
└─────────────────────────────────────────────────────────────────────┘

Combat: Skeleton x2                      [Your Turn]
═══════════════════════════════════════════════════

  A B C D E F G H
1 . . . . . . . .
2 . . M . . M . .     Legend:
3 . . . . . . . .       @ = You
4 . . . @ . . . .       M = Monster
5 . . . . . . . .       . = Empty
6 . . . . . . . .
7 . . . . . . . .
8 . . . . . . . .

You (D4) | HP: 25/30 | Move: 2/4
```

### 3.2 Combat Lifecycle with Grid

```
┌─────────────────────────────────────────────────────────────────────┐
│                    COMBAT LIFECYCLE WITH GRID                        │
└─────────────────────────────────────────────────────────────────────┘

    Encounter
        │
        ▼
┌───────────────────┐
│  CombatService    │
│  StartCombat()    │
└────────┬──────────┘
         │
         ├──▶ _gridService.CreateGrid(room)
         │         │
         │         ▼
         │    ┌─────────────────┐
         │    │   CombatGrid    │
         │    │   8x8 cells     │
         │    └────────┬────────┘
         │             │
         ├──▶ _gridService.InitializePositions(grid, player, monsters)
         │         │
         │         ├── Place player at center-south (D7)
         │         └── Place monsters in north zone
         │
         ├──▶ _gridService.SetActiveGrid(grid)
         │
         └──▶ _movementService.ResetAllMovement()
                   │
                   ▼
             Combat Active
                   │
         ┌─────────┴─────────┐
         │                   │
         ▼                   ▼
    Player Turn         Monster Turn
         │                   │
         ├── ResetMovement   ├── ResetMovement
         ├── Move command    ├── AI movement
         ├── Attack command  ├── AI attack
         └── End turn        └── End turn
                   │
                   ▼
    ┌───────────────────────┐
    │   Combat Ends         │
    │   (victory/defeat)    │
    └───────────┬───────────┘
                │
                ▼
    ┌───────────────────────┐
    │  CombatService        │
    │  EndCombat()          │
    └───────────┬───────────┘
                │
                └──▶ _gridService.ClearGrid()
                           │
                           ▼
                      Grid Cleared
```

### 3.3 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  IGridRenderer / GridRenderer                                        │
│  ├── RenderGrid(grid, options): string                              │
│  ├── RenderCompactGrid(grid, options): string                       │
│  ├── RenderLegend(grid): string                                     │
│  └── RenderCombatantList(grid, player, monsters): string            │
├─────────────────────────────────────────────────────────────────────┤
│  GridRenderOptions                                                   │
│  ├── UseBoxDrawing: bool = true                                     │
│  ├── ShowCoordinates: bool = true                                   │
│  ├── ShowLegend: bool = true                                        │
│  ├── HighlightValidMoves: bool = false                              │
│  └── Compact: bool = false                                          │
├─────────────────────────────────────────────────────────────────────┤
│  Commands                                                            │
│  ├── GridCommand: "grid", "grid compact"                            │
│  └── LookCommand: Updated to include grid in combat                 │
├─────────────────────────────────────────────────────────────────────┤
│  SpectreGameRenderer (Updated)                                       │
│  ├── RenderCombatView() → includes grid                             │
│  ├── RenderAttackResult() → includes positions                      │
│  └── RenderMovementResult() → includes updated grid                 │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  CombatService (Updated)                                             │
│  ├── StartCombat(player, monsters, room): CombatStartResult         │
│  │       + Creates grid via ICombatGridService                      │
│  │       + Initializes positions                                    │
│  │       + Sets active grid                                         │
│  │       + Resets all movement                                      │
│  ├── EndCombat(): void                                              │
│  │       + Clears active grid                                       │
│  │       + Cleans up combat state                                   │
│  └── StartTurn(entityId): void                                      │
│           + Resets entity movement points                           │
├─────────────────────────────────────────────────────────────────────┤
│  CombatStartResult (Updated)                                         │
│  ├── Success: bool                                                  │
│  ├── Grid: CombatGrid?                                              │
│  ├── PlayerPosition: GridPosition                                   │
│  ├── MonsterPositions: IReadOnlyDictionary<Guid, GridPosition>      │
│  └── Message: string                                                │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. GridRenderer

### 4.1 Interface

**File:** `src/Presentation/RuneAndRust.Presentation/Interfaces/IGridRenderer.cs`

```csharp
namespace RuneAndRust.Presentation.Interfaces;

/// <summary>
/// Renders the combat grid as ASCII art.
/// </summary>
public interface IGridRenderer
{
    /// <summary>Renders the full combat grid with box drawing.</summary>
    string RenderGrid(CombatGrid grid, GridRenderOptions? options = null);

    /// <summary>Renders a compact version without grid lines.</summary>
    string RenderCompactGrid(CombatGrid grid, GridRenderOptions? options = null);

    /// <summary>Renders the grid legend.</summary>
    string RenderLegend(CombatGrid grid);

    /// <summary>Renders combatant list with positions and stats.</summary>
    string RenderCombatantList(CombatGrid grid, Player player, IEnumerable<Monster> monsters);
}
```

### 4.2 Render Options

**File:** `src/Presentation/RuneAndRust.Presentation/DTOs/GridRenderOptions.cs`

```csharp
namespace RuneAndRust.Presentation.DTOs;

/// <summary>
/// Options for grid rendering.
/// </summary>
public class GridRenderOptions
{
    /// <summary>Whether to use box-drawing characters.</summary>
    public bool UseBoxDrawing { get; init; } = true;

    /// <summary>Whether to show column/row coordinates.</summary>
    public bool ShowCoordinates { get; init; } = true;

    /// <summary>Whether to show the legend.</summary>
    public bool ShowLegend { get; init; } = true;

    /// <summary>Whether to highlight valid move positions.</summary>
    public bool HighlightValidMoves { get; init; } = false;

    /// <summary>Use compact rendering (no grid lines).</summary>
    public bool Compact { get; init; } = false;

    /// <summary>Current turn number for display.</summary>
    public int? TurnNumber { get; init; }

    /// <summary>Whether it's the player's turn.</summary>
    public bool IsPlayerTurn { get; init; }

    public static GridRenderOptions Default => new();
    public static GridRenderOptions CompactDefault => new() { Compact = true };
}
```

### 4.3 Implementation

**File:** `src/Presentation/RuneAndRust.Presentation/Adapters/GridRenderer.cs`

```csharp
namespace RuneAndRust.Presentation.Adapters;

public class GridRenderer : IGridRenderer
{
    private const char PlayerChar = '@';
    private const char MonsterChar = 'M';
    private const char EmptyChar = '.';
    private const char WallChar = '#';

    public string RenderGrid(CombatGrid grid, GridRenderOptions? options = null)
    {
        options ??= GridRenderOptions.Default;
        if (options.Compact)
            return RenderCompactGrid(grid, options);

        var sb = new StringBuilder();

        // Header
        if (options.TurnNumber.HasValue)
            sb.AppendLine($"Combat Grid{new string(' ', 30)}[Turn {options.TurnNumber}]");
        else
            sb.AppendLine("Combat Grid");
        sb.AppendLine(new string('=', 47));
        sb.AppendLine();

        // Column headers
        sb.Append("     ");
        for (int x = 0; x < grid.Width; x++)
            sb.Append($" {(char)('A' + x)}  ");
        sb.AppendLine();

        // Grid with box drawing
        sb.Append("   ");
        sb.AppendLine("+" + string.Join("+", Enumerable.Repeat("---", grid.Width)) + "+");

        for (int y = 0; y < grid.Height; y++)
        {
            sb.Append($" {y + 1} |");
            for (int x = 0; x < grid.Width; x++)
            {
                var cell = grid.GetCell(x, y);
                var ch = cell?.GetDisplayChar() ?? EmptyChar;
                sb.Append($" {ch} |");
            }
            sb.AppendLine();
            sb.Append("   ");
            sb.AppendLine("+" + string.Join("+", Enumerable.Repeat("---", grid.Width)) + "+");
        }

        // Legend
        if (options.ShowLegend)
        {
            sb.AppendLine();
            sb.AppendLine(RenderLegend(grid));
        }

        return sb.ToString();
    }

    public string RenderCompactGrid(CombatGrid grid, GridRenderOptions? options = null)
    {
        options ??= GridRenderOptions.CompactDefault;
        var sb = new StringBuilder();

        // Column headers
        sb.Append("  ");
        for (int x = 0; x < grid.Width; x++)
            sb.Append($" {(char)('A' + x)}");
        sb.AppendLine();

        // Grid rows
        for (int y = 0; y < grid.Height; y++)
        {
            sb.Append($"{y + 1} ");
            for (int x = 0; x < grid.Width; x++)
            {
                var cell = grid.GetCell(x, y);
                var ch = cell?.GetDisplayChar() ?? EmptyChar;
                sb.Append($" {ch}");
            }

            // Legend on right side for first few rows
            if (options.ShowLegend && y == 1)
                sb.Append("     Legend:");
            else if (options.ShowLegend && y == 2)
                sb.Append("       @ = You");
            else if (options.ShowLegend && y == 3)
                sb.Append("       M = Monster");
            else if (options.ShowLegend && y == 4)
                sb.Append("       . = Empty");

            sb.AppendLine();
        }

        return sb.ToString();
    }

    public string RenderLegend(CombatGrid grid)
    {
        var playerPos = GetPlayerPosition(grid);
        var playerPosStr = playerPos.HasValue ? $" ({playerPos})" : "";
        return $"Legend: @ = You{playerPosStr}  M = Monster  . = Empty  # = Wall";
    }

    public string RenderCombatantList(
        CombatGrid grid, Player player, IEnumerable<Monster> monsters)
    {
        var sb = new StringBuilder();
        sb.AppendLine("Combatants:");

        var playerPos = player.CombatGridPosition;
        var playerPosStr = playerPos.HasValue ? $"({playerPos})" : "";
        var playerMove = $"{player.GetDisplayMovementRemaining():0.#}/{player.MovementSpeed}";
        sb.AppendLine($"  @ You {playerPosStr} - HP: {player.Health}/{player.Stats.MaxHealth} - Move: {playerMove}");

        foreach (var monster in monsters.Where(m => m.IsAlive))
        {
            var monsterPos = monster.CombatGridPosition;
            var monsterPosStr = monsterPos.HasValue ? $"({monsterPos})" : "";
            sb.AppendLine($"  M {monster.Name} {monsterPosStr} - HP: {monster.Health}/{monster.MaxHealth}");
        }

        return sb.ToString();
    }

    private GridPosition? GetPlayerPosition(CombatGrid grid)
    {
        foreach (var (entityId, pos) in grid.EntityPositions)
        {
            var cell = grid.GetCell(pos);
            if (cell?.IsPlayerOccupied == true)
                return pos;
        }
        return null;
    }
}
```

### 4.4 Display Symbols

| Symbol | Meaning | Color (future) |
|--------|---------|----------------|
| `@` | Player | Green |
| `M` | Monster | Red |
| `.` | Empty | Gray |
| `#` | Wall/Impassable | White |
| `*` | Valid move (optional) | Blue |

---

## 5. CombatService Integration

### 5.1 Updated CombatStartResult

**File:** `src/Core/RuneAndRust.Application/DTOs/CombatStartResult.cs`

```csharp
namespace RuneAndRust.Application.DTOs;

public readonly record struct CombatStartResult(
    bool Success,
    CombatGrid? Grid,
    GridPosition PlayerPosition,
    IReadOnlyDictionary<Guid, GridPosition> MonsterPositions,
    string Message);
```

### 5.2 CombatService Updates

**File:** `src/Core/RuneAndRust.Application/Services/CombatService.cs`

```csharp
// Add to CombatService:

private readonly ICombatGridService _gridService;
private readonly IMovementService _movementService;

/// <summary>
/// Starts combat with grid initialization.
/// </summary>
public CombatStartResult StartCombat(Player player, IEnumerable<Monster> monsters, Room room)
{
    var monsterList = monsters.ToList();

    // Create combat grid
    var grid = _gridService.CreateGrid(room);

    // Initialize positions
    var initResult = _gridService.InitializePositions(grid, player, monsterList);
    if (!initResult.Success)
    {
        _logger.LogWarning("Failed to initialize grid: {Message}", initResult.Message);
        // Could fallback to non-grid combat, but for now fail
        return new CombatStartResult(false, null, default,
            new Dictionary<Guid, GridPosition>(),
            $"Failed to initialize combat grid: {initResult.Message}");
    }

    // Set active grid
    _gridService.SetActiveGrid(grid);

    // Update entity grid positions
    player.SetCombatGridPosition(initResult.PlayerPosition);
    foreach (var (monsterId, pos) in initResult.MonsterPositions)
    {
        var monster = monsterList.FirstOrDefault(m => m.Id == monsterId);
        monster?.SetCombatGridPosition(pos);
    }

    // Reset movement for all combatants
    _movementService.ResetAllMovement();

    _logger.LogInformation(
        "Combat started in {Room} with grid {W}x{H}. Player at {Pos}",
        room.Name, grid.Width, grid.Height, initResult.PlayerPosition);

    return new CombatStartResult(
        true, grid, initResult.PlayerPosition,
        initResult.MonsterPositions,
        "Combat begins!");
}

/// <summary>
/// Ends combat and cleans up grid.
/// </summary>
public void EndCombat()
{
    _gridService.ClearGrid();

    // Clear entity grid positions
    var player = _sessionService.GetCurrentPlayer();
    player?.SetCombatGridPosition(null);

    foreach (var monster in _sessionService.GetActiveMonsters())
        monster.SetCombatGridPosition(null);

    _logger.LogInformation("Combat ended, grid cleared");
    // ... rest of combat cleanup
}

/// <summary>
/// Processes start of an entity's turn.
/// </summary>
public void StartTurn(Guid entityId)
{
    _movementService.ResetMovement(entityId);
    _logger.LogDebug("Turn started for {Entity}, movement reset", entityId);
    // ... rest of turn start logic
}
```

---

## 6. User-Facing Commands

### 6.1 Grid Command

```
> grid

Combat Grid                              [Turn 3]
===============================================

     A   B   C   D   E   F   G   H
   +---+---+---+---+---+---+---+---+
 1 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 2 | . | . | M | . | . | M | . | . |
   +---+---+---+---+---+---+---+---+
 3 | . | . | . | . | . | . | . | . |
   +---+---+---+---+---+---+---+---+
 4 | . | . | . | @ | . | . | . | . |
   +---+---+---+---+---+---+---+---+

Legend: @ = You (D4)  M = Monster  . = Empty  # = Wall

Combatants:
  @ You (D4) - HP: 25/30 - Move: 2/4
  M Skeleton (C2) - HP: 10/10
  M Skeleton (F2) - HP: 8/10
```

### 6.2 Compact Grid

```
> grid compact

  A B C D E F G H
1 . . . . . . . .
2 . . M . . M . .     Legend:
3 . . . . . . . .       @ = You
4 . . . @ . . . .       M = Monster
5 . . . . . . . .       . = Empty
6 . . . . . . . .
7 . . . . . . . .
8 . . . . . . . .

You (D4) | HP: 25/30 | Move: 2/4
```

### 6.3 Combat Start Display

```
=== COMBAT BEGINS ===

Two Skeletons block your path!

  A B C D E F G H
1 . . . . . . . .
2 . . M . . M . .       @ = You
3 . . . . . . . .       M = Monster
4 . . . @ . . . .       . = Empty
5 . . . . . . . .

You (D4) | HP: 25/30 | Move: 4/4

[Your Turn]
> _
```

### 6.4 Attack with Position Context

```
> attack skeleton

Which Skeleton?
  1. Skeleton at C2 (2 cells away)
  2. Skeleton at F2 (3 cells away)

> 1

You swing your sword at the Skeleton at C2...

[You at D4, target at C2 - distance: 2]
[Attack Roll: 2d6 + 3 = 14 vs AC 12]
Hit! 8 damage to Skeleton.

  A B C D E F G H
1 . . . . . . . .
2 . . M . . M . .       Skeleton (C2): 2/10 HP
3 . . . . . . . .       You (D4): 25/30 HP
4 . . . @ . . . .
5 . . . . . . . .
```

### 6.5 Look Command (Combat)

```
> look

You are in the Dungeon Corridor.

=== COMBAT ===

  A B C D E F G H
1 . . . . . . . .
2 . . M . . M . .
3 . . . . . . . .
4 . . . @ . . . .
5 . . . . . . . .

Combatants:
  @ You (D4) - HP: 25/30 - Move: 2/4
  M Skeleton (C2) - HP: 10/10
  M Skeleton (F2) - HP: 8/10

[Your Turn]
```

---

## 7. Data Model Changes

| Type | Layer | Description |
|------|-------|-------------|
| `IGridRenderer` | Presentation/Interfaces | Grid rendering interface |
| `GridRenderer` | Presentation/Adapters | ASCII grid rendering |
| `GridRenderOptions` | Presentation/DTOs | Rendering options |
| `CombatStartResult` | Application/DTOs | Updated with grid info |
| `CombatService` | Application/Services | Grid integration |
| `SpectreGameRenderer` | Presentation/Adapters | Updated for grid display |

---

## 8. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `CombatService` | Information | Grid created, combat start/end |
| `CombatService` | Debug | Position initialization, turn resets |
| `GridRenderer` | Debug | Render calls |

---

## 9. Unit Testing Requirements

| Feature | Test Count |
|---------|------------|
| GridRenderer.RenderGrid | ~5 |
| GridRenderer.RenderCompactGrid | ~3 |
| GridRenderer.RenderLegend | ~2 |
| GridRenderer.RenderCombatantList | ~3 |
| CombatService Grid Integration | ~5 |
| GridRenderOptions | ~2 |
| **Total** | **~20** |

---

## 10. Use Cases

### UC-001: Combat Start with Grid
**Flow:** Encounter → StartCombat → CreateGrid → InitPositions → Display grid

### UC-002: View Grid
**Flow:** Player uses `grid` → RenderGrid → Display with legend

### UC-003: Attack with Position
**Flow:** `attack skeleton` → Show distances → Select target → Show result with positions

### UC-004: Combat End Cleanup
**Flow:** Victory → EndCombat → ClearGrid → Remove positions

### UC-005: Turn Start
**Flow:** New turn → StartTurn → ResetMovement → Display updated grid

---

## 11. Deliverable Checklist

### Presentation Layer
- [ ] `IGridRenderer` interface
- [ ] `GridRenderer` implementation
- [ ] `GridRenderOptions` DTO
- [ ] `grid` command
- [ ] Updated `look` command for combat
- [ ] Updated `SpectreGameRenderer` for combat grid

### Application Layer
- [ ] Updated `CombatService.StartCombat()`
- [ ] Updated `CombatService.EndCombat()`
- [ ] Updated `CombatService.StartTurn()`
- [ ] Updated `CombatStartResult`

### Testing
- [ ] ~20 unit tests
- [ ] All tests passing

---

## 12. Acceptance Criteria

### Functional
- [ ] ASCII grid displays correctly with coordinates (A-H, 1-8)
- [ ] Player position shows as @
- [ ] Monster positions show as M
- [ ] Empty cells show as .
- [ ] Wall/impassable cells show as #
- [ ] Grid legend displays correctly
- [ ] Compact grid mode works without grid lines
- [ ] Combat initializes grid when starting
- [ ] Combat clears grid when ending
- [ ] Attack commands show position context (distance)
- [ ] `grid` command shows tactical map
- [ ] `grid compact` shows compact view
- [ ] `look` includes grid during combat
- [ ] Movement updates grid display
- [ ] Combatant list shows positions and stats
- [ ] Turn start resets movement points

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] ~20 unit tests pass
- [ ] Grid renders correctly for all valid dimensions (3-20)
- [ ] XML documentation complete

---

## 13. Dependencies

### Required from v0.5.0a

| Type | Usage |
|------|-------|
| `CombatGrid` | Grid data structure |
| `GridPosition` | Position tracking |
| `GridCell` | Cell display characters |
| `ICombatGridService` | Grid creation and management |

### Required from v0.5.0b

| Type | Usage |
|------|-------|
| `IMovementService` | Movement reset on turn start |
| `MovementPointsRemaining` | Display in combatant list |
| Player/Monster grid positions | Display and context |

### Provides to v0.5.1
- Grid display foundation for range indicators
- Position context for range-based combat

---

## 14. Future Considerations

### Deferred to v0.5.1
- Range checking before attacks
- Line of sight calculations
- Range indicators on grid

### Deferred to v0.5.2
- Terrain type display (water, rough, etc.)
- Cover indicators
- Movement cost display

### Out of Scope for v0.5.0
- Colored grid output
- Mouse/click interaction
- Fog of war

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: AI Assistant*
