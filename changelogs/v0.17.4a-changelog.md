# Changelog: v0.17.4a - Specialization Enum & Path Types

**Release Date:** 2026-01-30
**Phase:** Specialization System (1/5)
**Status:** Complete

---

## Overview

Implements the foundational enumeration and classification infrastructure for the Specialization system: the `SpecializationPathType` enum, `SpecializationId` enum, and their associated extension methods. These types define the 17 specializations across 4 archetypes and classify each as either Coherent (stable reality, no Corruption risk) or Heretical (corrupted Aether, abilities may trigger Corruption gain).

This phase establishes the type-safe foundation for all subsequent Specialization system components (v0.17.4b-v0.17.4e).

**Specialization Distribution by Archetype:**

| Archetype  | Count | Specializations                                                     | Heretical |
| ---------- | ----- | ------------------------------------------------------------------- | --------- |
| Warrior    | 6     | Berserkr, Iron-Bane, Skjaldmaer, Skar-Horde, Atgeir-Wielder, Gorge-Maw | 2         |
| Skirmisher | 4     | Veiðimaðr, Myrk-gengr, Strandhögg, Hlekkr-master                   | 1         |
| Mystic     | 2     | Seiðkona, Echo-Caller                                                | 2         |
| Adept      | 5     | Bone-Setter, Jötun-Reader, Skald, Scrap-Tinker, Einbúi              | 0         |
| **Total**  | **17**|                                                                     | **5**     |

---

## Added

### Domain Layer

#### Enums

- **`SpecializationPathType`** (`Enums/SpecializationPathType.cs`)
    - Enum with 2 values: `Coherent` (0), `Heretical` (1)
    - Explicit integer assignments (0-1) for stable serialization and database storage
    - Comprehensive XML documentation with `<summary>`, `<remarks>`, `<list>`, `<para>`, `<seealso>` tags
    - Per-value remarks detailing Corruption risk, archetype distribution, and total counts
    - `<seealso>` cross-references to `SpecializationId`, `Archetype`, and extension classes

- **`SpecializationId`** (`Enums/SpecializationId.cs`)
    - Enum with 17 values: Berserkr (0) through Einbui (16)
    - Explicit integer assignments (0-16) grouped by parent archetype
    - Section separators: WARRIOR SPECIALIZATIONS (6), SKIRMISHER SPECIALIZATIONS (4), MYSTIC SPECIALIZATIONS (2), ADEPT SPECIALIZATIONS (5)
    - Per-value XML docs with Parent archetype, Path type, Special Resource (where applicable), and thematic description
    - `<seealso>` cross-references to `SpecializationPathType`, `Archetype`, extensions, and `ArchetypeDefinition`

#### Extensions

- **`SpecializationPathTypeExtensions`** (`Extensions/SpecializationPathTypeExtensions.cs`)
    - `public static class` with 3 extension methods:
        - `RisksCorruption(this SpecializationPathType)` → `bool`: Returns true for Heretical paths
        - `GetCreationWarning(this SpecializationPathType)` → `string?`: Returns Corruption warning for Heretical, null for Coherent
        - `GetDescription(this SpecializationPathType)` → `string`: Human-readable path type description
    - Section separators: Corruption Risk Methods, UI Warning Methods, Display Methods
    - Full XML documentation with `<summary>`, `<param>`, `<returns>`, `<remarks>`, `<example>`, `<seealso>`

- **`SpecializationIdExtensions`** (`Extensions/SpecializationIdExtensions.cs`)
    - `public static class` with 5 extension methods:
        - `GetPathType(this SpecializationId)` → `SpecializationPathType`: 5 Heretical via explicit switch arms, all others default Coherent
        - `IsHeretical(this SpecializationId)` → `bool`: Convenience delegate to `GetPathType()`
        - `GetParentArchetype(this SpecializationId)` → `Archetype`: All 17 specializations mapped to parent archetype with `ArgumentOutOfRangeException` for unknown values
        - `GetDisplayName(this SpecializationId)` → `string`: Norse diacritics preserved (ð, ö, ú); hyphenated compound names
        - `GetCorruptionRisk(this SpecializationId)` → `string?`: Unique risk description for 5 Heretical, null for Coherent
    - Section separators: Path Type Methods, Archetype Mapping Methods, Display Methods, Corruption Risk Methods
    - All methods use switch expressions for O(1) lookup time
    - Full XML documentation with examples showing Norse diacritics

### Configuration Files

- **`config/specializations.json`** — Path type classifications for all 17 specializations
    - `$schema` reference to `./schemas/specializations.schema.json`
    - `pathTypes` array with 17 entries, each containing `specializationId`, `pathType`, and `corruptionRisk`
    - Heretical entries include Corruption risk descriptions; Coherent entries have `null` corruptionRisk
    - PascalCase `specializationId` values matching the C# enum naming convention

- **`config/schemas/specializations.schema.json`** — JSON Schema Draft-07 validation
    - `pathTypeEntry` definition with 3 required properties
    - `specializationId` constrained to enum of all 17 PascalCase values
    - `pathType` constrained to enum `["Coherent", "Heretical"]`
    - `corruptionRisk` uses `oneOf` with `string` or `null` for nullable support
    - `minItems: 17, maxItems: 17` for exactly 17 path type entries
    - `additionalProperties: false` at all levels

### Unit Tests

- **`SpecializationEnumTests`** (`Enums/SpecializationEnumTests.cs`) — 25 test methods (107 test cases with parameterization)
    - **SpecializationPathType Enum Tests (3 methods):**
        - `SpecializationPathType_HasTwoValues`: Exactly 2 enum values
        - `SpecializationPathType_ContainsAllExpectedValues`: Coherent and Heretical present
        - `SpecializationPathType_HasCorrectIntegerValues`: Parameterized (Coherent=0, Heretical=1)
    - **SpecializationId Enum Tests (3 methods):**
        - `SpecializationId_Has17Values`: Exactly 17 enum values
        - `SpecializationId_ContainsAllExpectedValues`: All 17 values present
        - `SpecializationId_HasCorrectIntegerValues`: Parameterized for all 17 (0-16)
    - **Path Type Classification Tests (3 methods):**
        - `SpecializationId_HereticalCount_IsFive`: Exactly 5 Heretical via LINQ count
        - `SpecializationId_SpecificHereticalSpecializations_AreHeretical`: 5 specific checks
        - `SpecializationId_CoherentExamples_AreNotHeretical`: 5 representative Coherent checks
    - **GetPathType Tests (1 method):**
        - `GetPathType_ReturnsCorrectType_ForAllSpecializations`: Parameterized for all 17
    - **Parent Archetype Mapping Tests (5 methods):**
        - `GetParentArchetype_ReturnsCorrectArchetype_ForAllSpecializations`: Parameterized for all 17
        - `GetParentArchetype_WarriorHasSixSpecializations`: Count via LINQ
        - `GetParentArchetype_SkirmisherHasFourSpecializations`: Count via LINQ
        - `GetParentArchetype_MysticHasTwoSpecializations`: Count via LINQ
        - `GetParentArchetype_AdeptHasFiveSpecializations`: Count via LINQ
    - **IsHeretical Tests (2 methods):**
        - `IsHeretical_ReturnsTrue_ForHereticalSpecs`: Parameterized for 5 Heretical
        - `IsHeretical_ReturnsFalse_ForCoherentSpecs`: Parameterized for 5 Coherent
    - **Display Name Tests (1 method):**
        - `GetDisplayName_ReturnsFormattedName_ForAllSpecs`: Parameterized for all 17 with diacritics
    - **Corruption Risk Tests (2 methods):**
        - `GetCorruptionRisk_ReturnsDescription_ForHereticalSpecs`: Parameterized for 5 with exact strings
        - `GetCorruptionRisk_ReturnsNull_ForCoherentSpecs`: Parameterized for 5 Coherent
    - **Path Type Extension Tests (5 methods):**
        - `RisksCorruption_Heretical_ReturnsTrue`
        - `RisksCorruption_Coherent_ReturnsFalse`
        - `GetCreationWarning_Heretical_ReturnsWarningText`: Contains "corrupted Aether" and "Corruption gain"
        - `GetCreationWarning_Coherent_ReturnsNull`
        - `GetDescription_ReturnsCorrectText_ForBothPathTypes`: Parameterized for both

### Glossary

- **`config/glossary.json`** — Added 3 glossary entries
    - `specialization-path-type`: Coherent vs Heretical classification determining Corruption risk (sortOrder: 37)
    - `specialization-id`: Enum identifying all 17 specializations across 4 archetypes (sortOrder: 38)
    - `specialization-extensions`: Extension methods for path type lookups and display names (sortOrder: 39)

---

## Changed

### Documentation

- **`docs/design/v0.17.x/v0.17.4-scope-breakdown.md`** — Checked off v0.17.4a unit test items
    - `[x] SpecializationPathType enum has 2 values`
    - `[x] Correct path types assigned to specializations`

- **`docs/design/v0.17.x/v0.17.x-overview.md`** — Checked off v0.17.4 deliverable
    - `[x] SpecializationPathType enum (Coherent, Heretical)`

---

## Design Decisions

### JSON Schema Draft-07 (Not Draft 2020-12)

The design specification uses Draft 2020-12 patterns, but all existing schemas in the codebase use Draft-07 with `definitions`. Draft-07 was chosen for consistency with `archetypes.schema.json`, `backgrounds.schema.json`, `lineages.schema.json`, `attributes.schema.json`, and other established schemas.

### Extension Methods Over Static Class Methods

Path type classification, parent archetype mapping, and display name resolution are implemented as extension methods on the enums rather than as methods on a service or static class. This follows the established codebase pattern (e.g., `ItemRarityExtensions`, `FacingDirectionExtensions`) and provides:
- Fluent API syntax: `specializationId.GetPathType()`
- O(1) switch expression lookup without dictionary allocation
- No dependency injection required for basic operations

### Norse-Themed Names (Scope Breakdown) Over English Names (v0.17.3d)

The v0.17.4a design specification uses Norse-themed names (Berserkr, Skjaldmaer, Skar-Horde, etc.) from the scope breakdown document, while v0.17.3d's `ArchetypeSpecializationMapping` used English names (Guardian, Berserker, Weapon Master, etc.). The design specification was treated as authoritative for v0.17.4a since it is the specialization-specific document. The v0.17.3d English-named mappings will need reconciliation in v0.17.4d when the provider loads from configuration.

### Default Coherent in GetPathType Switch

The `GetPathType()` extension method uses a `_ => Coherent` default arm rather than explicitly listing all 12 Coherent specializations. This is deliberate because:
- Only 5 of 17 are Heretical (minority), making explicit Heretical listing more maintainable
- Adding new Coherent specializations requires no code change
- The Heretical classification is the exceptional case that warrants explicit tracking

### Old Norse Diacritics in Display Names

Display names preserve Old Norse diacritics (ð, ö, ú) per the design specification for thematic authenticity. The `GetDisplayName()` extension returns these properly formatted. Console/UI renderers must support UTF-8 encoding to display these correctly.

### Copyright Header for Extensions vs. Separator Header for Enums

Extension files use the `──────` copyright header pattern matching `ItemRarityExtensions.cs`, while enum files use the `═══════` separator header pattern matching `Archetype.cs` and `AbilityType.cs`. This matches the established codebase convention where different file types use different header styles.

---

## Dependencies

### Prerequisites

| Type                  | Phase    | Usage                                           |
| --------------------- | -------- | ----------------------------------------------- |
| `Archetype`           | v0.17.3a | Parent archetype enum for `GetParentArchetype()` |
| `ArchetypeDefinition` | v0.17.3a | Conceptual link for specialization availability |

### Provides to Future Phases

| Type                              | Phase    | Usage                                           |
| --------------------------------- | -------- | ----------------------------------------------- |
| `SpecializationId`                | v0.17.4b | Primary key for SpecializationDefinition entity |
| `SpecializationPathType`          | v0.17.4b | Path type property on definition                |
| `SpecializationId`                | v0.17.4c | Links abilities to specialization               |
| `SpecializationId`                | v0.17.4d | Provider lookup key                             |
| `SpecializationPathType`          | v0.17.4e | Display Corruption warnings                     |
| `SpecializationIdExtensions`      | v0.17.4d | Provider uses for path type and archetype lookup|
| `SpecializationPathTypeExtensions`| v0.17.5  | Creation workflow warning generation            |

---

## Logging Strategy

| Level   | When                                                        |
|---------|-------------------------------------------------------------|
| N/A     | v0.17.4a introduces enums and static extension methods only |

Extension methods are pure functions with no side effects and do not include logging. Logging will be added in v0.17.4d (SpecializationProvider) and v0.17.4e (SpecializationApplicationService) where service-level operations justify diagnostic output.

---

## Files Created

| Path | Description |
|------|-------------|
| `src/Core/RuneAndRust.Domain/Enums/SpecializationPathType.cs` | SpecializationPathType enum with 2 values |
| `src/Core/RuneAndRust.Domain/Enums/SpecializationId.cs` | SpecializationId enum with 17 values |
| `src/Core/RuneAndRust.Domain/Extensions/SpecializationPathTypeExtensions.cs` | Path type extension methods (3 methods) |
| `src/Core/RuneAndRust.Domain/Extensions/SpecializationIdExtensions.cs` | Specialization ID extension methods (5 methods) |
| `config/specializations.json` | Path type classifications for all 17 specializations |
| `config/schemas/specializations.schema.json` | JSON Schema Draft-07 for specializations config |
| `tests/RuneAndRust.Domain.UnitTests/Enums/SpecializationEnumTests.cs` | Enum and extension method unit tests |
| `changelogs/v0.17.4a-changelog.md` | This changelog |

## Files Modified

| Path | Description |
|------|-------------|
| `config/glossary.json` | Added 3 glossary entries (sortOrder 37-39) |
| `docs/design/v0.17.x/v0.17.4-scope-breakdown.md` | Checked off v0.17.4a deliverables |
| `docs/design/v0.17.x/v0.17.x-overview.md` | Updated v0.17.4 deliverable checkboxes |

---

## Notes

- Total unit tests for v0.17.4a: 25 test methods expanding to 107 test cases via parameterization
- The design specification estimated ~2 tests; 25 methods (107 cases) were implemented for comprehensive coverage of all enum values, extension methods, path type classifications, archetype mappings, display names, and Corruption risk descriptions
- All Mystic specializations (2 of 2) are Heretical — Mystic is the only archetype with no Coherent options
- All Adept specializations (5 of 5) are Coherent — Adept is the only archetype with no Heretical options
- Display names use Old Norse diacritics: Veiðimaðr (ð), Strandhögg (ö), Seiðkona (ð), Jötun-Reader (ö), Einbúi (ú)
- The `specializationId` field in configuration uses PascalCase (e.g., "Berserkr", "IronBane") to match the C# enum naming convention
- Specialization definitions, ability tiers, provider service, and application service are deferred to v0.17.4b-e
- The specialization names in the `SpecializationId` enum (Norse-themed) differ from the `ArchetypeSpecializationMapping` names (English-themed) in v0.17.3d; reconciliation will occur in v0.17.4d when the provider loads from configuration
