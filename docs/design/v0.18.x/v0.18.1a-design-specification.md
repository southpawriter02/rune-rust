# v0.18.1a Design Specification: Corruption Enums & State

**Version:** 0.18.1a
**Parent:** v0.18.1 (Runic Blight Corruption)
**Prerequisites:** v0.18.0 Complete (Psychic Stress System), v0.6.x (Dice System)
**Status:** Design Complete
**Estimated Unit Tests:** ~4

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [CorruptionStage Enum](#5-corruptionstage-enum)
6. [CorruptionState Value Object](#6-corruptionstate-value-object)
7. [Logging Specifications](#7-logging-specifications)
8. [Unit Testing Requirements](#8-unit-testing-requirements)
9. [Use Cases](#9-use-cases)
10. [Deliverable Checklist](#10-deliverable-checklist)
11. [Acceptance Criteria](#11-acceptance-criteria)
12. [Dependencies](#12-dependencies)
13. [Future Considerations](#13-future-considerations)

---

## 1. Executive Summary

This design specification defines the foundational type system for Runic Blight Corruption — the second pillar of the Trauma Economy. v0.18.1a establishes the `CorruptionStage` enum and `CorruptionState` value object that mirror the patterns established in v0.18.0a for Psychic Stress.

Runic Blight Corruption represents the physical and spiritual contamination from exposure to corrupted runic energies in Aethelgard. Unlike Psychic Stress (mental strain), Corruption tracks the body's absorption of malevolent magical energy and its progressive mutation effects.

### Key Deliverables

| Category          | Items             |
| ----------------- | ----------------- |
| **Domain Enums**  | `CorruptionStage` |
| **Value Objects** | `CorruptionState` |
| **Tests**         | ~4 unit tests     |

### Architectural Significance

This version establishes the **Corruption State Pattern** that parallels the Stress State Pattern:

- 5-stage progression model (Uncorrupted → Consumed)
- Percentage-based threshold mechanics (0-100 scale)
- Immutable state tracking with factory methods
- Strategic mirroring of stress architecture for consistency

### Core Mechanics Summary

| Mechanic               | Formula/Value              |
| ---------------------- | -------------------------- |
| Corruption Range       | 0-100                      |
| Maximum Corruption     | 100 (triggers Consumption) |
| Minimum Corruption     | 0 (Uncorrupted)            |
| Stage Thresholds       | 0/<20/40/60/80/100         |
| Mutation Check Trigger | Corruption ≥ 100           |

---

## 2. Feature Overview

```
v0.18.1a Features
└── Corruption Foundation Layer
    │
    ├── ENUMS
    │   └── CorruptionStage — 5-stage corruption progression
    │       ├── Uncorrupted (0-19)
    │       ├── Tainted (20-39)
    │       ├── Infected (40-59)
    │       ├── Blighted (60-79)
    │       ├── Corrupted (80-99)
    │       └── Consumed (100)
    │
    └── VALUE OBJECTS
        └── CorruptionState — Immutable corruption snapshot
            ├── CurrentCorruption: int
            ├── Stage: CorruptionStage
            ├── PercentageToConsumption: double
            ├── RequiresMutationCheck: bool
            ├── HasMutationRisk: bool
            └── Factory: Create(int corruption)
```

---

## 3. Architecture Diagrams

### 3.1 Domain Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          DOMAIN LAYER                                   │
│                   src/Core/RuneAndRust.Domain                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     Enums/CorruptionStage.cs                     │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  Uncorrupted    = 0    // 0-19 corruption                       │   │
│  │  Tainted        = 1    // 20-39 corruption                      │   │
│  │  Infected       = 2    // 40-59 corruption                      │   │
│  │  Blighted       = 3    // 60-79 corruption                      │   │
│  │  Corrupted      = 4    // 80-99 corruption                      │   │
│  │  Consumed       = 5    // 100 corruption (mutation check)       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                │                                        │
│                                │ used by                                │
│                                ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                 ValueObjects/CorruptionState.cs                  │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │  readonly record struct CorruptionState                         │   │
│  │  ───────────────────────────────────────────────────────────    │   │
│  │  + CurrentCorruption: int                                       │   │
│  │  + Stage: CorruptionStage                                       │   │
│  │  + PercentageToConsumption: double                              │   │
│  │  + RequiresMutationCheck: bool                                  │   │
│  │  + HasMutationRisk: bool                                        │   │
│  │  ───────────────────────────────────────────────────────────    │   │
│  │  + Create(int corruption): CorruptionState                      │   │
│  │  + DetermineStage(int corruption): CorruptionStage              │   │
│  │  + ToString(): string                                           │   │
│  │  ───────────────────────────────────────────────────────────    │   │
│  │  + const MinCorruption = 0                                      │   │
│  │  + const MaxCorruption = 100                                    │   │
│  │  + const TaintedThreshold = 20                                  │   │
│  │  + const InfectedThreshold = 40                                 │   │
│  │  + const BlightedThreshold = 60                                 │   │
│  │  + const CorruptedThreshold = 80                                │   │
│  │  + const ConsumedThreshold = 100                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Corruption Stage Threshold Diagram

```
┌──────────────────────────────────────────────────────────────────────────┐
│                    CORRUPTION STAGE THRESHOLDS                           │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  0%        20%       40%       60%       80%       100%                  │
│  │         │         │         │         │         │                     │
│  ▼         ▼         ▼         ▼         ▼         ▼                     │
│  ╔═════════╦═════════╦═════════╦═════════╦═════════╦═════════╗          │
│  ║Uncorrupt║ Tainted ║Infected ║Blighted ║Corrupted║Consumed ║          │
│  ╚═════════╩═════════╩═════════╩═════════╩═════════╩═════════╝          │
│                                                                          │
│  STAGE EFFECTS                                                           │
│  ────────────────────────────────────────────────────────────            │
│  Uncorrupted (0-19):   No effects                                        │
│  Tainted (20-39):      Minor cosmetic signs, unease around pure entities │
│  Infected (40-59):     Visible corruption marks, -1 social checks        │
│  Blighted (60-79):     Physical mutations begin, -2 social, +1 horror    │
│  Corrupted (80-99):    Severe mutations, -3 social, +2 horror, ability   │
│  Consumed (100):       MUTATION CHECK REQUIRED — permanent change        │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Corruption vs Stress Comparison

```
┌─────────────────────────────────────────────────────────────────────────┐
│                 TRAUMA ECONOMY PARALLEL SYSTEMS                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  PSYCHIC STRESS (v0.18.0)              CORRUPTION (v0.18.1)              │
│  ─────────────────────────             ─────────────────────             │
│                                                                          │
│  ┌─────────────────────┐               ┌─────────────────────┐          │
│  │   StressThreshold   │               │   CorruptionStage   │          │
│  ├─────────────────────┤               ├─────────────────────┤          │
│  │ Calm (0-19)         │               │ Uncorrupted (0-19)  │          │
│  │ Uneasy (20-39)      │               │ Tainted (20-39)     │          │
│  │ Anxious (40-59)     │               │ Infected (40-59)    │          │
│  │ Distressed (60-79)  │               │ Blighted (60-79)    │          │
│  │ Panicked (80-99)    │               │ Corrupted (80-99)   │          │
│  │ Broken (100)        │               │ Consumed (100)      │          │
│  └─────────────────────┘               └─────────────────────┘          │
│           │                                     │                        │
│           ▼                                     ▼                        │
│  ┌─────────────────────┐               ┌─────────────────────┐          │
│  │     StressState     │               │   CorruptionState   │          │
│  ├─────────────────────┤               ├─────────────────────┤          │
│  │ CurrentStress       │               │ CurrentCorruption   │          │
│  │ Threshold           │               │ Stage               │          │
│  │ PercentageToBreak   │               │ PercentageToConsume │          │
│  │ RequiresTraumaCheck │               │ RequiresMutationChk │          │
│  │ HasMentalBreakRisk  │               │ HasMutationRisk     │          │
│  └─────────────────────┘               └─────────────────────┘          │
│           │                                     │                        │
│           ▼                                     ▼                        │
│  ┌─────────────────────┐               ┌─────────────────────┐          │
│  │   TRAUMA CHECK      │               │   MUTATION CHECK    │          │
│  │   (Mental Break)    │               │   (Physical Change) │          │
│  └─────────────────────┘               └─────────────────────┘          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Stage Determination Decision Tree

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     DetermineStage Decision Tree                         │
└─────────────────────────────────────────────────────────────────────────┘

                         DetermineStage(corruption)
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │  corruption >= 100?           │
                    └───────────────┬───────────────┘
                           │                │
                          YES              NO
                           │                │
                           ▼                ▼
                    ┌─────────────┐  ┌───────────────────────────────┐
                    │  Consumed   │  │  corruption >= 80?            │
                    └─────────────┘  └───────────────┬───────────────┘
                                            │                │
                                           YES              NO
                                            │                │
                                            ▼                ▼
                                     ┌─────────────┐  ┌───────────────────────────────┐
                                     │  Corrupted  │  │  corruption >= 60?            │
                                     └─────────────┘  └───────────────┬───────────────┘
                                                             │                │
                                                            YES              NO
                                                             │                │
                                                             ▼                ▼
                                                      ┌─────────────┐  ┌───────────────────────────────┐
                                                      │  Blighted   │  │  corruption >= 40?            │
                                                      └─────────────┘  └───────────────┬───────────────┘
                                                                              │                │
                                                                             YES              NO
                                                                              │                │
                                                                              ▼                ▼
                                                                       ┌─────────────┐  ┌───────────────────────────────┐
                                                                       │  Infected   │  │  corruption >= 20?            │
                                                                       └─────────────┘  └───────────────┬───────────────┘
                                                                                               │                │
                                                                                              YES              NO
                                                                                               │                │
                                                                                               ▼                ▼
                                                                                        ┌─────────────┐  ┌─────────────┐
                                                                                        │  Tainted    │  │ Uncorrupted │
                                                                                        └─────────────┘  └─────────────┘
```

---

## 4. User Stories

### US-18.1a-1: Track Corruption Progression

**As a** player
**I want to** understand my character's corruption level through clear stages
**So that** I can make informed decisions about risk exposure

**Acceptance Criteria:**

- Corruption displays as 0-100 numeric value
- Stage name clearly indicates severity
- Visual/narrative feedback appropriate to stage

### US-18.1a-2: Identify Mutation Risk

**As a** combat system
**I want to** identify when corruption reaches dangerous levels
**So that** I can trigger appropriate mutation checks

**Acceptance Criteria:**

- `RequiresMutationCheck` returns `true` when corruption = 100
- `HasMutationRisk` returns `true` when corruption ≥ 80
- State immutably captures current risk status

### US-18.1a-3: Query Corruption State

**As a** service layer developer
**I want to** query corruption state from a single value
**So that** I can make decisions without complex calculations

**Acceptance Criteria:**

- `CorruptionState.Create(corruption)` returns complete state
- State includes stage, percentage, and all risk flags
- State is immutable for thread safety

### US-18.1a-4: Understand Stage Effects

**As a** game designer
**I want to** define clear mechanical effects per corruption stage
**So that** corruption feels impactful and threatening

**Acceptance Criteria:**

- Each stage has documented mechanical effects
- Stages progress in clear severity order
- Consumed stage triggers mandatory mutation check

---

## 5. CorruptionStage Enum

### 5.1 Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/CorruptionStage.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the five progressive stages of Runic Blight Corruption.
/// </summary>
/// <remarks>
/// <para>
/// Corruption tracks physical/spiritual contamination from exposure to
/// corrupted runic energies. Unlike Psychic Stress (mental strain),
/// Corruption represents the body's absorption of malevolent magical energy.
/// </para>
/// <para>
/// Stage Thresholds:
/// <list type="bullet">
/// <item><see cref="Uncorrupted"/>: 0-19 corruption</item>
/// <item><see cref="Tainted"/>: 20-39 corruption</item>
/// <item><see cref="Infected"/>: 40-59 corruption</item>
/// <item><see cref="Blighted"/>: 60-79 corruption</item>
/// <item><see cref="Corrupted"/>: 80-99 corruption</item>
/// <item><see cref="Consumed"/>: 100 corruption (mutation check)</item>
/// </list>
/// </para>
/// </remarks>
public enum CorruptionStage
{
    /// <summary>
    /// No corruption present (0-19).
    /// </summary>
    /// <remarks>
    /// The character's essence is pure and untouched by Runic Blight.
    /// No mechanical effects or visible signs of corruption.
    /// </remarks>
    Uncorrupted = 0,

    /// <summary>
    /// Minor corruption exposure (20-39).
    /// </summary>
    /// <remarks>
    /// The character has been exposed to Runic Blight but shows only
    /// minor cosmetic signs. Pure entities may sense unease around them.
    /// No mechanical penalties, but narrative implications begin.
    /// </remarks>
    Tainted = 1,

    /// <summary>
    /// Moderate corruption infection (40-59).
    /// </summary>
    /// <remarks>
    /// Visible corruption marks appear on the character's body.
    /// Mechanical effect: -1 penalty to social checks with pure entities.
    /// The corruption is actively growing and cannot be hidden.
    /// </remarks>
    Infected = 2,

    /// <summary>
    /// Significant corruption spread (60-79).
    /// </summary>
    /// <remarks>
    /// Physical mutations begin manifesting.
    /// Mechanical effects:
    /// <list type="bullet">
    /// <item>-2 penalty to social checks with pure entities</item>
    /// <item>+1 to horror/intimidation against susceptible targets</item>
    /// </list>
    /// The character's humanity is visibly compromised.
    /// </remarks>
    Blighted = 3,

    /// <summary>
    /// Severe corruption (80-99).
    /// </summary>
    /// <remarks>
    /// Severe mutations are present and growing.
    /// Mechanical effects:
    /// <list type="bullet">
    /// <item>-3 penalty to social checks with pure entities</item>
    /// <item>+2 to horror/intimidation against susceptible targets</item>
    /// <item>May gain corrupted abilities at cost</item>
    /// </list>
    /// The character is at high risk of being Consumed.
    /// </remarks>
    Corrupted = 4,

    /// <summary>
    /// Maximum corruption reached (100).
    /// </summary>
    /// <remarks>
    /// <para>
    /// The character's essence is overwhelmed by Runic Blight.
    /// A <b>Mutation Check</b> is required immediately.
    /// </para>
    /// <para>
    /// Mutation Check outcomes:
    /// <list type="bullet">
    /// <item>Success: Gain a permanent mutation, corruption resets to 75</item>
    /// <item>Failure: Gain a severe mutation, corruption resets to 50</item>
    /// <item>Critical Failure: Character may become an NPC (GM discretion)</item>
    /// </list>
    /// </para>
    /// </remarks>
    Consumed = 5
}
```

### 5.2 Stage Summary Table

| Stage       | Value | Range | Social Penalty | Horror Bonus | Notes                    |
| ----------- | ----- | ----- | -------------- | ------------ | ------------------------ |
| Uncorrupted | 0     | 0-19  | —              | —            | No effects               |
| Tainted     | 1     | 20-39 | —              | —            | Cosmetic signs only      |
| Infected    | 2     | 40-59 | -1             | —            | Visible marks            |
| Blighted    | 3     | 60-79 | -2             | +1           | Mutations begin          |
| Corrupted   | 4     | 80-99 | -3             | +2           | Severe mutations         |
| Consumed    | 5     | 100   | N/A            | N/A          | Mutation Check triggered |

---

## 6. CorruptionState Value Object

### 6.1 Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/CorruptionState.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Immutable value object representing a character's current Runic Blight Corruption state.
/// </summary>
/// <remarks>
/// <para>
/// CorruptionState encapsulates all corruption-related calculations in a single
/// immutable snapshot. This parallels <see cref="StressState"/> in the Psychic
/// Stress system for architectural consistency.
/// </para>
/// <para>
/// Corruption mechanics:
/// <list type="bullet">
/// <item>Range: 0-100 (clamped)</item>
/// <item>5 progressive stages from Uncorrupted to Consumed</item>
/// <item>Mutation Check required at 100</item>
/// </list>
/// </para>
/// </remarks>
/// <example>
/// <code>
/// // Create corruption state from a value
/// var state = CorruptionState.Create(45);
///
/// // Query derived properties
/// Console.WriteLine($"Stage: {state.Stage}");           // Infected
/// Console.WriteLine($"Progress: {state.PercentageToConsumption:P0}"); // 45%
/// Console.WriteLine($"Mutation Risk: {state.HasMutationRisk}"); // false
/// </code>
/// </example>
public readonly record struct CorruptionState
{
    #region Constants

    /// <summary>Minimum corruption value (Uncorrupted).</summary>
    public const int MinCorruption = 0;

    /// <summary>Maximum corruption value (triggers Mutation Check).</summary>
    public const int MaxCorruption = 100;

    /// <summary>Threshold for Tainted stage (20+).</summary>
    public const int TaintedThreshold = 20;

    /// <summary>Threshold for Infected stage (40+).</summary>
    public const int InfectedThreshold = 40;

    /// <summary>Threshold for Blighted stage (60+).</summary>
    public const int BlightedThreshold = 60;

    /// <summary>Threshold for Corrupted stage (80+).</summary>
    public const int CorruptedThreshold = 80;

    /// <summary>Threshold for Consumed stage (100).</summary>
    public const int ConsumedThreshold = 100;

    #endregion

    #region Properties

    /// <summary>
    /// Gets the current corruption value (0-100).
    /// </summary>
    public int CurrentCorruption { get; private init; }

    /// <summary>
    /// Gets the current corruption stage based on <see cref="CurrentCorruption"/>.
    /// </summary>
    public CorruptionStage Stage { get; private init; }

    /// <summary>
    /// Gets the percentage of progress toward being Consumed (0.0 to 1.0).
    /// </summary>
    /// <remarks>
    /// Returns 1.0 when corruption equals <see cref="MaxCorruption"/>.
    /// </remarks>
    public double PercentageToConsumption { get; private init; }

    /// <summary>
    /// Gets whether a Mutation Check is required (corruption = 100).
    /// </summary>
    /// <remarks>
    /// When <c>true</c>, the character must immediately resolve a Mutation Check
    /// before any other actions can be taken.
    /// </remarks>
    public bool RequiresMutationCheck { get; private init; }

    /// <summary>
    /// Gets whether the character is at risk of mutation (corruption ≥ 80).
    /// </summary>
    /// <remarks>
    /// At Corrupted stage or higher, any additional corruption exposure
    /// could trigger a Mutation Check. Used for warning displays and
    /// risk-aware decision making.
    /// </remarks>
    public bool HasMutationRisk { get; private init; }

    #endregion

    #region Factory Methods

    /// <summary>
    /// Creates a new <see cref="CorruptionState"/> from a corruption value.
    /// </summary>
    /// <param name="corruption">
    /// The current corruption value. Will be clamped to 0-100 range.
    /// </param>
    /// <returns>
    /// An immutable <see cref="CorruptionState"/> with all derived properties calculated.
    /// </returns>
    /// <example>
    /// <code>
    /// var calm = CorruptionState.Create(15);    // Uncorrupted
    /// var danger = CorruptionState.Create(85);  // Corrupted, HasMutationRisk = true
    /// var max = CorruptionState.Create(100);    // Consumed, RequiresMutationCheck = true
    /// var clamped = CorruptionState.Create(150); // Clamped to 100, Consumed
    /// </code>
    /// </example>
    public static CorruptionState Create(int corruption)
    {
        // Clamp to valid range
        var clampedCorruption = Math.Clamp(corruption, MinCorruption, MaxCorruption);

        return new CorruptionState
        {
            CurrentCorruption = clampedCorruption,
            Stage = DetermineStage(clampedCorruption),
            PercentageToConsumption = clampedCorruption / (double)MaxCorruption,
            RequiresMutationCheck = clampedCorruption >= MaxCorruption,
            HasMutationRisk = clampedCorruption >= CorruptedThreshold
        };
    }

    /// <summary>
    /// Creates an uncorrupted state (corruption = 0).
    /// </summary>
    /// <returns>A <see cref="CorruptionState"/> representing no corruption.</returns>
    public static CorruptionState Uncorrupted => Create(MinCorruption);

    #endregion

    #region Stage Determination

    /// <summary>
    /// Determines the <see cref="CorruptionStage"/> for a given corruption value.
    /// </summary>
    /// <param name="corruption">The corruption value (0-100).</param>
    /// <returns>The corresponding <see cref="CorruptionStage"/>.</returns>
    /// <remarks>
    /// Stage thresholds:
    /// <list type="bullet">
    /// <item>0-19: Uncorrupted</item>
    /// <item>20-39: Tainted</item>
    /// <item>40-59: Infected</item>
    /// <item>60-79: Blighted</item>
    /// <item>80-99: Corrupted</item>
    /// <item>100: Consumed</item>
    /// </list>
    /// </remarks>
    public static CorruptionStage DetermineStage(int corruption) =>
        corruption switch
        {
            >= ConsumedThreshold => CorruptionStage.Consumed,
            >= CorruptedThreshold => CorruptionStage.Corrupted,
            >= BlightedThreshold => CorruptionStage.Blighted,
            >= InfectedThreshold => CorruptionStage.Infected,
            >= TaintedThreshold => CorruptionStage.Tainted,
            _ => CorruptionStage.Uncorrupted
        };

    #endregion

    #region Object Overrides

    /// <summary>
    /// Returns a string representation of the corruption state.
    /// </summary>
    /// <returns>A formatted string showing corruption value and stage.</returns>
    public override string ToString() =>
        $"Corruption: {CurrentCorruption}/{MaxCorruption} [{Stage}]" +
        (RequiresMutationCheck ? " [MUTATION CHECK REQUIRED]" : "") +
        (HasMutationRisk && !RequiresMutationCheck ? " [Mutation Risk]" : "");

    #endregion
}
```

### 6.2 Property Reference Table

| Property                  | Type              | Description                                    |
| ------------------------- | ----------------- | ---------------------------------------------- |
| `CurrentCorruption`       | `int`             | Current corruption value (0-100, clamped)      |
| `Stage`                   | `CorruptionStage` | Derived stage from corruption value            |
| `PercentageToConsumption` | `double`          | Progress toward Consumed (0.0-1.0)             |
| `RequiresMutationCheck`   | `bool`            | `true` when corruption = 100                   |
| `HasMutationRisk`         | `bool`            | `true` when corruption ≥ 80 (Corrupted+ stage) |

### 6.3 Constant Reference Table

| Constant             | Value | Description                         |
| -------------------- | ----- | ----------------------------------- |
| `MinCorruption`      | 0     | Minimum valid corruption value      |
| `MaxCorruption`      | 100   | Maximum corruption (Mutation Check) |
| `TaintedThreshold`   | 20    | Minimum for Tainted stage           |
| `InfectedThreshold`  | 40    | Minimum for Infected stage          |
| `BlightedThreshold`  | 60    | Minimum for Blighted stage          |
| `CorruptedThreshold` | 80    | Minimum for Corrupted stage         |
| `ConsumedThreshold`  | 100   | Minimum for Consumed stage          |

### 6.4 Usage Examples

```csharp
// Example 1: Query current corruption state
var state = CorruptionState.Create(45);
// state.CurrentCorruption = 45
// state.Stage = CorruptionStage.Infected
// state.PercentageToConsumption = 0.45
// state.RequiresMutationCheck = false
// state.HasMutationRisk = false

// Example 2: Check mutation risk threshold
var dangerState = CorruptionState.Create(85);
// dangerState.Stage = CorruptionStage.Corrupted
// dangerState.HasMutationRisk = true
// dangerState.RequiresMutationCheck = false

// Example 3: Maximum corruption (mutation check required)
var consumedState = CorruptionState.Create(100);
// consumedState.Stage = CorruptionStage.Consumed
// consumedState.RequiresMutationCheck = true
// consumedState.HasMutationRisk = true

// Example 4: Clamping out-of-range values
var overflowState = CorruptionState.Create(150);
// overflowState.CurrentCorruption = 100 (clamped)
// overflowState.Stage = CorruptionStage.Consumed

var underflowState = CorruptionState.Create(-20);
// underflowState.CurrentCorruption = 0 (clamped)
// underflowState.Stage = CorruptionStage.Uncorrupted

// Example 5: Convenience property
var pureState = CorruptionState.Uncorrupted;
// pureState.CurrentCorruption = 0
// pureState.Stage = CorruptionStage.Uncorrupted
```

---

## 7. Logging Specifications

### 7.1 Log Levels by Component

| Component         | Level       | Events                                |
| ----------------- | ----------- | ------------------------------------- |
| `CorruptionState` | N/A         | Value object, no logging              |
| Future Services   | Debug       | State creation, stage transitions     |
| Future Services   | Information | Corruption gained/lost, stage changes |
| Future Services   | Warning     | Mutation risk threshold reached       |
| Future Services   | Error       | Mutation check failures               |

### 7.2 Example Log Output (Preview for Future Services)

```
[10:30:15 DBG] Corruption state created: 45/100 [Infected]
[10:31:22 INF] Corruption gained for {CharacterId}: +15 [BlightExposure] (45 → 60)
[10:31:22 INF] Corruption stage changed for {CharacterId}: Infected → Blighted
[10:35:45 WRN] Mutation risk threshold reached for {CharacterId}: 85/100
[10:40:00 WRN] MUTATION CHECK REQUIRED for {CharacterId}: Corruption at 100
```

> **Note:** CorruptionState is a value object and does not perform logging directly.
> Logging specifications shown here are for future service implementations (v0.18.1d).

---

## 8. Unit Testing Requirements

### 8.1 Test Count by Feature

| Feature                      | Test Count |
| ---------------------------- | ---------- |
| CorruptionStage Enum         | ~1         |
| CorruptionState Value Object | ~3         |
| **Total**                    | **~4**     |

### 8.2 CorruptionStageTests

**File:** `tests/RuneAndRust.Domain.UnitTests/Enums/CorruptionStageTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.Enums;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;

[TestFixture]
public class CorruptionStageTests
{
    [Test]
    public void CorruptionStage_HasExpectedValues()
    {
        // Assert — Verify all expected stages exist with correct values
        ((int)CorruptionStage.Uncorrupted).Should().Be(0);
        ((int)CorruptionStage.Tainted).Should().Be(1);
        ((int)CorruptionStage.Infected).Should().Be(2);
        ((int)CorruptionStage.Blighted).Should().Be(3);
        ((int)CorruptionStage.Corrupted).Should().Be(4);
        ((int)CorruptionStage.Consumed).Should().Be(5);
    }

    [Test]
    public void CorruptionStage_HasCorrectCount()
    {
        // Assert — Verify exactly 6 stages exist
        Enum.GetValues<CorruptionStage>().Should().HaveCount(6);
    }
}
```

### 8.3 CorruptionStateTests

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CorruptionStateTests.cs`

```csharp
namespace RuneAndRust.Domain.UnitTests.ValueObjects;

using FluentAssertions;
using NUnit.Framework;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

[TestFixture]
public class CorruptionStateTests
{
    #region Create Tests

    [Test]
    [TestCase(0, CorruptionStage.Uncorrupted)]
    [TestCase(19, CorruptionStage.Uncorrupted)]
    [TestCase(20, CorruptionStage.Tainted)]
    [TestCase(39, CorruptionStage.Tainted)]
    [TestCase(40, CorruptionStage.Infected)]
    [TestCase(59, CorruptionStage.Infected)]
    [TestCase(60, CorruptionStage.Blighted)]
    [TestCase(79, CorruptionStage.Blighted)]
    [TestCase(80, CorruptionStage.Corrupted)]
    [TestCase(99, CorruptionStage.Corrupted)]
    [TestCase(100, CorruptionStage.Consumed)]
    public void Create_WithValidCorruption_ReturnsCorrectStage(
        int corruption,
        CorruptionStage expectedStage)
    {
        // Act
        var state = CorruptionState.Create(corruption);

        // Assert
        state.CurrentCorruption.Should().Be(corruption);
        state.Stage.Should().Be(expectedStage);
    }

    [Test]
    [TestCase(-10, 0)]
    [TestCase(-1, 0)]
    [TestCase(101, 100)]
    [TestCase(150, 100)]
    public void Create_WithOutOfRangeCorruption_ClampsToValidRange(
        int inputCorruption,
        int expectedCorruption)
    {
        // Act
        var state = CorruptionState.Create(inputCorruption);

        // Assert
        state.CurrentCorruption.Should().Be(expectedCorruption);
    }

    #endregion

    #region Derived Property Tests

    [Test]
    [TestCase(0, 0.0)]
    [TestCase(50, 0.5)]
    [TestCase(100, 1.0)]
    public void Create_CalculatesPercentageToConsumption(
        int corruption,
        double expectedPercentage)
    {
        // Act
        var state = CorruptionState.Create(corruption);

        // Assert
        state.PercentageToConsumption.Should().BeApproximately(expectedPercentage, 0.001);
    }

    [Test]
    [TestCase(79, false)]
    [TestCase(80, true)]
    [TestCase(99, true)]
    [TestCase(100, true)]
    public void Create_CalculatesHasMutationRisk(
        int corruption,
        bool expectedMutationRisk)
    {
        // Act
        var state = CorruptionState.Create(corruption);

        // Assert
        state.HasMutationRisk.Should().Be(expectedMutationRisk);
    }

    [Test]
    [TestCase(99, false)]
    [TestCase(100, true)]
    public void Create_CalculatesRequiresMutationCheck(
        int corruption,
        bool expectedRequiresMutationCheck)
    {
        // Act
        var state = CorruptionState.Create(corruption);

        // Assert
        state.RequiresMutationCheck.Should().Be(expectedRequiresMutationCheck);
    }

    #endregion

    #region Convenience Property Tests

    [Test]
    public void Uncorrupted_ReturnsZeroCorruptionState()
    {
        // Act
        var state = CorruptionState.Uncorrupted;

        // Assert
        state.CurrentCorruption.Should().Be(0);
        state.Stage.Should().Be(CorruptionStage.Uncorrupted);
        state.HasMutationRisk.Should().BeFalse();
        state.RequiresMutationCheck.Should().BeFalse();
    }

    #endregion

    #region ToString Tests

    [Test]
    public void ToString_WithNormalCorruption_ReturnsFormattedString()
    {
        // Arrange
        var state = CorruptionState.Create(45);

        // Act
        var result = state.ToString();

        // Assert
        result.Should().Contain("45/100");
        result.Should().Contain("Infected");
        result.Should().NotContain("MUTATION CHECK REQUIRED");
    }

    [Test]
    public void ToString_WithConsumed_IndicatesMutationCheckRequired()
    {
        // Arrange
        var state = CorruptionState.Create(100);

        // Act
        var result = state.ToString();

        // Assert
        result.Should().Contain("MUTATION CHECK REQUIRED");
    }

    [Test]
    public void ToString_WithMutationRisk_IndicatesRisk()
    {
        // Arrange
        var state = CorruptionState.Create(85);

        // Act
        var result = state.ToString();

        // Assert
        result.Should().Contain("Mutation Risk");
        result.Should().NotContain("MUTATION CHECK REQUIRED");
    }

    #endregion
}
```

### 8.4 Test Scenario Coverage Matrix

| Scenario                          | Test Case                                            |
| --------------------------------- | ---------------------------------------------------- |
| Stage determination at boundaries | `Create_WithValidCorruption_ReturnsCorrectStage`     |
| Clamping negative values          | `Create_WithOutOfRangeCorruption_ClampsToValidRange` |
| Clamping overflow values          | `Create_WithOutOfRangeCorruption_ClampsToValidRange` |
| Percentage calculation            | `Create_CalculatesPercentageToConsumption`           |
| Mutation risk flag                | `Create_CalculatesHasMutationRisk`                   |
| Mutation check flag               | `Create_CalculatesRequiresMutationCheck`             |
| Convenience property              | `Uncorrupted_ReturnsZeroCorruptionState`             |
| String representation             | `ToString_*` tests                                   |

---

## 9. Use Cases

### UC-18.1a-001: Create Corruption State

**Actor:** Application Service
**Flow:** Service receives corruption value → Calls `CorruptionState.Create()` → Receives immutable state → Queries derived properties

```
Service                CorruptionState
   │                        │
   │  Create(45)            │
   │───────────────────────▶│
   │                        │ Clamp to 0-100
   │                        │ Determine stage
   │                        │ Calculate percentage
   │                        │ Set risk flags
   │                        │
   │  CorruptionState      │
   │◀───────────────────────│
   │                        │
   │  .Stage → Infected     │
   │  .HasMutationRisk → F  │
```

### UC-18.1a-002: Check Mutation Risk

**Actor:** Combat Service
**Flow:** Combat ends → Query corruption state → Check `HasMutationRisk` → Display warning if true

```
CombatService          CorruptionState          UI
     │                      │                   │
     │  Create(85)          │                   │
     │─────────────────────▶│                   │
     │                      │                   │
     │  state               │                   │
     │◀─────────────────────│                   │
     │                      │                   │
     │  state.HasMutationRisk = true            │
     │                      │                   │
     │  ShowMutationWarning │                   │
     │─────────────────────────────────────────▶│
```

### UC-18.1a-003: Handle Consumed State

**Actor:** Corruption Service
**Flow:** Corruption reaches 100 → Check `RequiresMutationCheck` → Trigger Mutation Check flow

```
CorruptionService      CorruptionState      MutationService
     │                      │                     │
     │  Create(100)         │                     │
     │─────────────────────▶│                     │
     │                      │                     │
     │  state               │                     │
     │◀─────────────────────│                     │
     │                      │                     │
     │  state.RequiresMutationCheck = true        │
     │                      │                     │
     │  TriggerMutationCheck │                    │
     │──────────────────────────────────────────▶│
```

---

## 10. Deliverable Checklist

### Domain Layer

- [ ] `CorruptionStage` enum created with 6 stages
- [ ] `CorruptionStage` has complete XML documentation
- [ ] `CorruptionState` value object created
- [ ] `CorruptionState.Create()` factory method implemented
- [ ] `CorruptionState` has complete XML documentation
- [ ] Threshold constants defined and documented

### Unit Tests

- [ ] `CorruptionStageTests.cs` created
- [ ] `CorruptionStateTests.cs` created
- [ ] ~4 unit tests implemented
- [ ] All tests passing

### Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] Code follows .editorconfig conventions
- [ ] File-scoped namespace declarations used
- [ ] XML documentation on all public members

---

## 11. Acceptance Criteria

### Functional

- [ ] `CorruptionStage` enum contains exactly 6 values (Uncorrupted through Consumed)
- [ ] `CorruptionState.Create(corruption)` returns correct stage for all threshold boundaries
- [ ] `CorruptionState.Create()` clamps values outside 0-100 range
- [ ] `PercentageToConsumption` accurately calculates 0.0-1.0 range
- [ ] `RequiresMutationCheck` returns `true` only when corruption = 100
- [ ] `HasMutationRisk` returns `true` when corruption ≥ 80
- [ ] `CorruptionState.Uncorrupted` convenience property works correctly

### Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~4 unit tests pass
- [ ] XML documentation complete on all public members
- [ ] Code follows established patterns from v0.18.0a (StressState)

### Integration

- [ ] `CorruptionState` parallels `StressState` architecture
- [ ] No dependencies on future v0.18.1 components
- [ ] No dependencies beyond Domain layer

---

## 12. Dependencies

### 12.1 Prerequisites (Required Before v0.18.1a)

| Dependency | Status   | Description                              |
| ---------- | -------- | ---------------------------------------- |
| v0.18.0    | Complete | Psychic Stress System (parallel pattern) |
| v0.6.x     | Complete | Dice System (for future mutation checks) |

### 12.2 What This Version Provides

| Feature           | Used By                                  |
| ----------------- | ---------------------------------------- |
| `CorruptionStage` | v0.18.1b (Result Objects), Services, UI  |
| `CorruptionState` | v0.18.1c (Interface), v0.18.1d (Service) |

### 12.3 Dependency Graph

```
v0.18.0a (StressThreshold, StressState)
    │
    │ pattern reference
    ▼
v0.18.1a (CorruptionStage, CorruptionState)   ◀── THIS VERSION
    │
    │ provides foundation
    ▼
v0.18.1b (CorruptionApplicationResult, CorruptionCheckResult)
    │
    ▼
v0.18.1c (ICorruptionService)
    │
    ▼
v0.18.1d (CorruptionService implementation)
```

---

## 13. Future Considerations

### 13.1 Deferred to v0.18.1b

- **CorruptionApplicationResult** — Result object for corruption application
- **CorruptionCheckResult** — Result object for FORTITUDE resistance checks

### 13.2 Deferred to v0.18.1c

- **ICorruptionService** — Service interface for corruption operations

### 13.3 Deferred to v0.18.1d

- **CorruptionService** — Full implementation with FORTITUDE-based resistance

### 13.4 Deferred to v0.18.1e

- **Configuration & Schema** — `corruption-sources.json` and schema

### 13.5 Deferred to v0.18.1f

- **Database Persistence** — Schema extensions for corruption storage

### 13.6 Out of Scope for v0.18.1

The following are NOT part of the v0.18.1 scope and belong to future versions:

- **Mutation Definitions** — Specific mutations and their effects (v0.18.3+)
- **Corruption Abilities** — Using corruption for power at cost (future)
- **Purification System** — Methods to cleanse corruption (future)
- **Corruption Resistance Equipment** — Gear that reduces corruption gain (future)

---

_Document Version: 1.0_
_Last Updated: 2026-01-27_
_Author: Agent_
