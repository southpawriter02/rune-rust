# v0.15.2g Design Specification: Specialization Integration

**Version:** 0.15.2g
**Theme:** Specialization Integration
**Author:** Claude
**Created:** 2026-01-17
**Status:** Draft
**Prerequisites:** v0.15.2a-f Complete (Climbing, Leaping, Fall Damage, Stealth Movement, Chase Sequences, Balance Checks)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [SpecializationAbility Enum](#4-specializationability-enum)
5. [GantryRunnerAbility Enum](#5-gantryrunnerability-enum)
6. [MyrgengrAbility Enum](#6-myrkengrability-enum)
7. [SpecializationAbilityDefinition Value Object](#7-specializationabilitydefinition-value-object)
8. [AbilityActivationContext Value Object](#8-abilityactivationcontext-value-object)
9. [AbilityActivationResult Value Object](#9-abilityactivationresult-value-object)
10. [ISpecializationAbilityService Interface](#10-ispecializationabilityservice-interface)
11. [SpecializationAbilityService Implementation](#11-specializationabilityservice-implementation)
12. [Gantry-Runner Ability Implementations](#12-gantry-runner-ability-implementations)
13. [Myrk-gengr Ability Implementations](#13-myrk-gengr-ability-implementations)
14. [Configuration](#14-configuration)
15. [Commands](#15-commands)
16. [User-Facing Changes](#16-user-facing-changes)
17. [Logging Specifications](#17-logging-specifications)
18. [Unit Testing Requirements](#18-unit-testing-requirements)
19. [Use Cases](#19-use-cases)
20. [Deliverable Checklist](#20-deliverable-checklist)
21. [Acceptance Criteria](#21-acceptance-criteria)
22. [Future Considerations](#22-future-considerations)
23. [Implementation Notes](#23-implementation-notes)
24. [Document Metadata](#24-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.2g, the Specialization Integration phase. This part introduces specialization-specific abilities that enhance the base Acrobatics and Stealth systems from v0.15.2a-f. The key components are:

1. **Gantry-Runner Abilities**: Five acrobatics-focused abilities for the Gantry-Runner specialization that enhance climbing, leaping, and fall recovery capabilities.

2. **Myrk-gengr Abilities**: Four stealth-focused abilities for the Myrk-gengr specialization that enhance stealth entry, maintenance, and party coordination.

3. **SpecializationAbilityService**: Orchestrates ability activation, checks prerequisites, manages daily uses, and applies ability effects to the underlying systems.

This infrastructure completes the v0.15.2 Acrobatics Skill Expansion by providing meaningful specialization bonuses that reward character investment.

### 1.2 Current vs. Target Implementation

| Aspect | Current Implementation | Target Implementation |
|--------|------------------------|----------------------|
| **Climbing Stages** | Fixed stage count | Gantry-Runner reduces by 1 |
| **Leap Distance** | Fixed distance limits | Death-Defying Leap adds +10 ft |
| **Vertical Movement** | Climbing only | Wall-Run combat action |
| **Failed Leaps** | Fall immediately | Double Jump recovery (1/day) |
| **Crash Landing** | DC-based reduction | Featherfall auto-succeeds DC ≤ 3 |
| **[Hidden] Entry** | Requires action | Slip into Shadow (no action) |
| **Attack from [Hidden]** | Breaks [Hidden] | Ghostly Form maintains (1/encounter) |
| **Party Stealth** | Weakest link DC | Cloak the Party +2d10 |
| **Zone Effects** | Manual entry | Auto-[Hidden] in [Psychic Resonance] |

### 1.3 Scope

**In Scope:**
- Define `GantryRunnerAbility` enum with 5 abilities
- Define `MyrkengrAbility` enum with 4 abilities
- Define `SpecializationAbilityDefinition` value object for ability metadata
- Define `AbilityActivationContext` value object for activation parameters
- Define `AbilityActivationResult` value object for activation outcomes
- Create `ISpecializationAbilityService` interface for ability operations
- Implement `SpecializationAbilityService` with ability logic
- Integration with climbing, leaping, fall damage, and stealth systems
- Configuration file `specialization-abilities.json`
- Unit tests for specialization mechanics (~2 tests)

**Out of Scope:**
- Specialization acquisition/progression - character system
- Ability point costs - character system
- Specialization prerequisites - character system
- Multi-specialization rules - future version
- Ability upgrade trees - future version

### 1.4 Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Enums | 2 | `GantryRunnerAbility`, `MyrkengrAbility` |
| Value Objects | 3 | `SpecializationAbilityDefinition`, `AbilityActivationContext`, `AbilityActivationResult` |
| Interfaces | 1 | `ISpecializationAbilityService` |
| Services | 1 | `SpecializationAbilityService` |
| Configuration | 1 | `specialization-abilities.json` |
| Unit Tests | ~2 | Gantry-Runner reduces climbing stages, Myrk-gengr can enter [Hidden] without action |

---

## 2. Dependencies

### 2.1 Required from v0.15.0 (Dice Pool Refactor)

| Component | Location | Usage in v0.15.2g |
|-----------|----------|-------------------|
| `DiceRollResult` | `Domain/ValueObjects/DiceRollResult.cs` | Provides `NetSuccesses` for ability-modified checks |
| `IDiceRollerService` | `Application/Interfaces/IDiceRollerService.cs` | Modified dice rolls for ability bonuses |

### 2.2 Required from v0.15.1a (Skill Context & Modifiers)

| Component | Location | Usage in v0.15.2g |
|-----------|----------|-------------------|
| `SkillContext` | `Domain/ValueObjects/SkillContext.cs` | Modified by specialization abilities |
| `SkillContextBuilder` | `Application/Services/SkillContextBuilder.cs` | Applies ability modifiers |

### 2.3 Required from v0.15.2a (Climbing System)

| Component | Location | Usage in v0.15.2g |
|-----------|----------|-------------------|
| `ClimbContext` | `Domain/ValueObjects/ClimbContext.cs` | Modified by `[Roof-Runner]` |
| `ClimbState` | `Domain/Entities/ClimbState.cs` | Stage reduction application |
| `IClimbingService` | `Application/Interfaces/IClimbingService.cs` | Climbing stage modifications |

### 2.4 Required from v0.15.2b (Leaping System)

| Component | Location | Usage in v0.15.2g |
|-----------|----------|-------------------|
| `LeapContext` | `Domain/ValueObjects/LeapContext.cs` | Modified by `[Death-Defying Leap]` |
| `LeapResult` | `Domain/ValueObjects/LeapResult.cs` | Modified by `[Double Jump]` |
| `ILeapingService` | `Application/Interfaces/ILeapingService.cs` | Distance/recovery modifications |

### 2.5 Required from v0.15.2c (Fall Damage)

| Component | Location | Usage in v0.15.2g |
|-----------|----------|-------------------|
| `CrashLandingResult` | `Domain/ValueObjects/CrashLandingResult.cs` | Modified by `[Featherfall]` |
| `IFallDamageService` | `Application/Interfaces/IFallDamageService.cs` | Auto-success application |

### 2.6 Required from v0.15.2d (Stealth Movement)

| Component | Location | Usage in v0.15.2g |
|-----------|----------|-------------------|
| `HiddenStatus` | `Domain/Entities/HiddenStatus.cs` | Modified by Myrk-gengr abilities |
| `StealthContext` | `Domain/ValueObjects/StealthContext.cs` | Modified by `[Cloak the Party]` |
| `PartyStealthResult` | `Domain/ValueObjects/PartyStealthResult.cs` | Receives dice bonus |
| `IStealthService` | `Application/Interfaces/IStealthService.cs` | [Hidden] management |

### 2.7 Provides to Future Versions

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.3+ | Additional Skills | Pattern for skill-specific specializations |
| Character System | Progression | Ability unlock/upgrade tracking |
| Combat System | Actions | Wall-Run combat integration |

---

## 3. Architecture Diagrams

### 3.1 Specialization Ability Integration

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SPECIALIZATION ABILITY INTEGRATION                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  CHARACTER                                                                   │
│  ├── Specialization: Gantry-Runner                                          │
│  │   └── Abilities: [Roof-Runner], [Death-Defying Leap], [Wall-Run],       │
│  │                  [Double Jump], [Featherfall]                            │
│  │                                                                          │
│  └── Specialization: Myrk-gengr                                             │
│      └── Abilities: [Slip into Shadow], [Ghostly Form],                     │
│                     [Cloak the Party], [One with the Static]                │
│                                                                              │
│  ABILITY ACTIVATION FLOW                                                     │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │              SPECIALIZATION ABILITY SERVICE                          │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  1. Check ability availability (has ability, daily uses remaining)  │    │
│  │  2. Validate activation context (situation matches ability)         │    │
│  │  3. Apply ability effect to relevant service                        │    │
│  │  4. Track usage (decrement daily uses if applicable)                │    │
│  │  5. Return activation result                                        │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ├───────────────────┬───────────────────┬─────────────────────┐    │
│           ▼                   ▼                   ▼                     ▼    │
│  ┌─────────────┐    ┌──────────────┐    ┌──────────────┐    ┌────────────┐  │
│  │  Climbing   │    │   Leaping    │    │ Fall Damage  │    │  Stealth   │  │
│  │  Service    │    │   Service    │    │   Service    │    │  Service   │  │
│  ├─────────────┤    ├──────────────┤    ├──────────────┤    ├────────────┤  │
│  │ [Roof-     │    │ [Death-      │    │ [Featherfall]│    │ [Slip into │  │
│  │  Runner]   │    │  Defying     │    │              │    │  Shadow]   │  │
│  │ [Wall-Run] │    │  Leap]       │    │              │    │ [Ghostly   │  │
│  │            │    │ [Double Jump]│    │              │    │  Form]     │  │
│  │            │    │              │    │              │    │ [Cloak the │  │
│  │            │    │              │    │              │    │  Party]    │  │
│  │            │    │              │    │              │    │ [One with  │  │
│  │            │    │              │    │              │    │  Static]   │  │
│  └─────────────┘    └──────────────┘    └──────────────┘    └────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Gantry-Runner Ability Effects

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       GANTRY-RUNNER ABILITY EFFECTS                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [ROOF-RUNNER] - Passive                                                     │
│  ────────────────────────────────────────────                               │
│  Effect: Reduce climbing stages required by 1                                │
│                                                                              │
│    Normal Climb:  30ft = 3 stages                                           │
│    With Ability:  30ft = 2 stages                                           │
│                                                                              │
│    Formula: StagesRequired = max(1, (Height / 10) - 1)                      │
│                                                                              │
│  [DEATH-DEFYING LEAP] - Passive                                              │
│  ────────────────────────────────────────────                               │
│  Effect: +10 ft to maximum leap distance                                     │
│                                                                              │
│    Normal Max:    25ft (Heroic leap)                                        │
│    With Ability:  35ft (Extended heroic)                                    │
│                                                                              │
│    Formula: MaxDistance = BaseMax + 10                                       │
│                                                                              │
│  [WALL-RUN] - Combat Action                                                  │
│  ────────────────────────────────────────────                               │
│  Effect: Run vertically up walls for one combat action                       │
│  Cost: 1 Action                                                              │
│                                                                              │
│    Movement: Up to character's movement speed vertically                    │
│    Limitation: Must end on a surface or fall                                │
│    DC: Acrobatics DC 3 (success-counting)                                   │
│                                                                              │
│  [DOUBLE JUMP] - Reactive (1/day)                                            │
│  ────────────────────────────────────────────                               │
│  Effect: Correct a failed leap mid-air                                       │
│  Trigger: After failing a leap check but before falling                     │
│  Uses: 1 per day                                                            │
│                                                                              │
│    Mechanic: Reroll the leap check with +1d10 bonus                         │
│    If second roll also fails: Fall as normal                                │
│                                                                              │
│  [FEATHERFALL] - Passive                                                     │
│  ────────────────────────────────────────────                               │
│  Effect: Auto-succeed Crash Landing checks with DC ≤ 3                      │
│                                                                              │
│    DC ≤ 3:        Falls up to ~10ft (auto-success)                          │
│    DC > 3:        Must roll as normal                                       │
│                                                                              │
│    Formula: CrashLandingDc = 2 + (Height / 10)                              │
│    Threshold: DC ≤ 3 means Height ≤ 10ft                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Myrk-gengr Ability Effects

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        MYRK-GENGR ABILITY EFFECTS                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [SLIP INTO SHADOW] - Triggered                                              │
│  ────────────────────────────────────────────                               │
│  Effect: Enter [Hidden] without using an action                              │
│  Trigger: When entering a shadowed area or low-light conditions             │
│                                                                              │
│    Normal:        Entering [Hidden] costs an action                         │
│    With Ability:  Free entry when lighting conditions allow                 │
│                                                                              │
│    Requirements:                                                            │
│    - Area must have shadows or dim/dark lighting                            │
│    - Character must not be actively observed                                │
│    - Stealth check still required (but no action cost)                      │
│                                                                              │
│  [GHOSTLY FORM] - Reactive (1/encounter)                                     │
│  ────────────────────────────────────────────                               │
│  Effect: Stay [Hidden] after making an attack                                │
│  Trigger: After completing an attack from [Hidden]                          │
│  Uses: 1 per encounter                                                      │
│                                                                              │
│    Normal:        Attacking breaks [Hidden]                                 │
│    With Ability:  First attack per encounter maintains [Hidden]             │
│                                                                              │
│    Limitations:                                                             │
│    - Only applies to first attack each encounter                            │
│    - Second+ attacks break [Hidden] normally                                │
│                                                                              │
│  [CLOAK THE PARTY] - Active                                                  │
│  ────────────────────────────────────────────                               │
│  Effect: Grant party +2d10 on Passive Stealth checks                        │
│  Cost: Concentration (maintained)                                           │
│                                                                              │
│    Mechanic: Party members within 30ft gain +2d10                           │
│    Duration: While Myrk-gengr maintains concentration                       │
│    Party Stealth: Still uses weakest-link, but all get +2d10                │
│                                                                              │
│  [ONE WITH THE STATIC] - Passive                                             │
│  ────────────────────────────────────────────                               │
│  Effect: Automatically enter [Hidden] in [Psychic Resonance] zones          │
│  Trigger: Upon entering a zone with [Psychic Resonance] environmental tag   │
│                                                                              │
│    Normal:        [Psychic Resonance] causes disorientation                 │
│    With Ability:  The static provides concealment advantage                 │
│                                                                              │
│    Requirements:                                                            │
│    - Zone must have [Psychic Resonance] environment tag                     │
│    - No action or check required                                            │
│    - Breaks as normal when attacking or detected                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   SPECIALIZATION INTEGRATION LAYER ARCHITECTURE              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Enums/                                                             │    │
│  │  ├── GantryRunnerAbility.cs           ←── NEW                       │    │
│  │  └── MyrkengrAbility.cs               ←── NEW                       │    │
│  │                                                                      │    │
│  │  ValueObjects/                                                      │    │
│  │  ├── SpecializationAbilityDefinition.cs  ←── NEW                    │    │
│  │  ├── AbilityActivationContext.cs         ←── NEW                    │    │
│  │  └── AbilityActivationResult.cs          ←── NEW                    │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                        │    │
│  │  └── ISpecializationAbilityService.cs     ←── NEW                   │    │
│  │                                                                      │    │
│  │  Services/                                                          │    │
│  │  └── SpecializationAbilityService.cs      ←── NEW                   │    │
│  │                                                                      │    │
│  │  INTEGRATIONS (modifications to existing services):                 │    │
│  │  ├── IClimbingService.cs                  ←── EXTEND                │    │
│  │  ├── ILeapingService.cs                   ←── EXTEND                │    │
│  │  ├── IFallDamageService.cs                ←── EXTEND                │    │
│  │  └── IStealthService.cs                   ←── EXTEND                │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  INFRASTRUCTURE LAYER                                │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Configuration/                                                     │    │
│  │  └── specialization-abilities.json        ←── NEW                   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. SpecializationAbility Enum

### 4.1 Enum Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/SpecializationAbility.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Identifies the category of specialization ability.
/// </summary>
/// <remarks>
/// <para>
/// Specialization abilities fall into categories based on their activation:
/// <list type="bullet">
///   <item><description>Passive: Always active when character has the ability</description></item>
///   <item><description>Triggered: Activates automatically under specific conditions</description></item>
///   <item><description>Reactive: Character chooses to activate in response to event</description></item>
///   <item><description>Active: Requires deliberate activation and may cost resources</description></item>
/// </list>
/// </para>
/// </remarks>
public enum SpecializationAbilityType
{
    /// <summary>
    /// Always active when the character possesses this ability.
    /// No activation required.
    /// </summary>
    /// <example>
    /// [Roof-Runner], [Death-Defying Leap], [Featherfall], [One with the Static]
    /// </example>
    Passive = 0,

    /// <summary>
    /// Activates automatically when specific conditions are met.
    /// No character choice required.
    /// </summary>
    /// <example>
    /// [Slip into Shadow] when entering shadows
    /// </example>
    Triggered = 1,

    /// <summary>
    /// Character can choose to activate in response to an event.
    /// May have limited uses.
    /// </summary>
    /// <example>
    /// [Double Jump] after failed leap, [Ghostly Form] after attack
    /// </example>
    Reactive = 2,

    /// <summary>
    /// Requires deliberate activation, typically costs an action.
    /// May have duration or concentration requirements.
    /// </summary>
    /// <example>
    /// [Wall-Run], [Cloak the Party]
    /// </example>
    Active = 3
}
```

---

## 5. GantryRunnerAbility Enum

### 5.1 Enum Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/GantryRunnerAbility.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Identifies Gantry-Runner specialization abilities.
/// </summary>
/// <remarks>
/// <para>
/// The Gantry-Runner specialization focuses on acrobatic movement across
/// the urban landscape of the Sprawl, particularly rooftop traversal
/// and death-defying leaps between buildings.
/// </para>
/// <para>
/// These abilities enhance the base climbing (v0.15.2a), leaping (v0.15.2b),
/// and fall damage (v0.15.2c) systems.
/// </para>
/// </remarks>
public enum GantryRunnerAbility
{
    /// <summary>
    /// Reduces climbing stages required by 1.
    /// Type: Passive
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: When calculating stages for a climb, subtract 1 from the total
    /// (minimum 1 stage). This represents expertise in finding efficient routes.
    /// </para>
    /// <para>
    /// Formula: StagesRequired = max(1, (Height / 10) - 1)
    /// </para>
    /// </remarks>
    /// <example>
    /// A 30-foot climb normally requires 3 stages.
    /// With [Roof-Runner]: 30 / 10 - 1 = 2 stages.
    /// </example>
    RoofRunner = 0,

    /// <summary>
    /// Adds +10 ft to maximum leap distance.
    /// Type: Passive
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: Increases the maximum possible leap distance by 10 feet,
    /// allowing jumps beyond the normal Heroic (25ft) limit.
    /// </para>
    /// <para>
    /// Formula: MaxLeapDistance = BaseMax + 10
    /// </para>
    /// </remarks>
    /// <example>
    /// Normal maximum: 25ft (Heroic leap, DC 5)
    /// With [Death-Defying Leap]: 35ft maximum
    /// </example>
    DeathDefyingLeap = 1,

    /// <summary>
    /// Run vertically up walls as a combat action.
    /// Type: Active (1 Action)
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: Spend 1 action to run vertically up a wall up to your
    /// movement speed. Requires Acrobatics check DC 3 (success-counting).
    /// </para>
    /// <para>
    /// Limitation: Must end movement on a surface that can support you,
    /// or fall to the ground at the end of the action.
    /// </para>
    /// </remarks>
    WallRun = 2,

    /// <summary>
    /// Correct a failed leap mid-air once per day.
    /// Type: Reactive (1/day)
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: After failing a leap check but before falling, you may
    /// reroll the leap check with a +1d10 bonus.
    /// </para>
    /// <para>
    /// Uses: Once per day. Resets on long rest.
    /// If second roll fails: Fall proceeds as normal.
    /// </para>
    /// </remarks>
    DoubleJump = 3,

    /// <summary>
    /// Auto-succeed Crash Landing checks with DC ≤ 3.
    /// Type: Passive
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: When making a Crash Landing check, if the DC is 3 or less
    /// (falls of ~10 feet or less), automatically succeed.
    /// </para>
    /// <para>
    /// Formula: CrashLandingDc = 2 + (Height / 10)
    /// DC ≤ 3 means Height ≤ 10ft.
    /// </para>
    /// </remarks>
    Featherfall = 4
}
```

### 5.2 GantryRunnerAbility Extensions

**File:** `src/Core/RuneAndRust.Domain/Extensions/GantryRunnerAbilityExtensions.cs`

```csharp
namespace RuneAndRust.Domain.Extensions;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Extension methods for <see cref="GantryRunnerAbility"/> enum.
/// </summary>
public static class GantryRunnerAbilityExtensions
{
    /// <summary>
    /// Gets the display name for this ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>Human-readable display name with brackets.</returns>
    public static string GetDisplayName(this GantryRunnerAbility ability)
    {
        return ability switch
        {
            GantryRunnerAbility.RoofRunner => "[Roof-Runner]",
            GantryRunnerAbility.DeathDefyingLeap => "[Death-Defying Leap]",
            GantryRunnerAbility.WallRun => "[Wall-Run]",
            GantryRunnerAbility.DoubleJump => "[Double Jump]",
            GantryRunnerAbility.Featherfall => "[Featherfall]",
            _ => $"[Unknown Gantry-Runner Ability]"
        };
    }

    /// <summary>
    /// Gets the ability type for this ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>The ability activation type.</returns>
    public static SpecializationAbilityType GetAbilityType(this GantryRunnerAbility ability)
    {
        return ability switch
        {
            GantryRunnerAbility.RoofRunner => SpecializationAbilityType.Passive,
            GantryRunnerAbility.DeathDefyingLeap => SpecializationAbilityType.Passive,
            GantryRunnerAbility.WallRun => SpecializationAbilityType.Active,
            GantryRunnerAbility.DoubleJump => SpecializationAbilityType.Reactive,
            GantryRunnerAbility.Featherfall => SpecializationAbilityType.Passive,
            _ => SpecializationAbilityType.Passive
        };
    }

    /// <summary>
    /// Gets the description of this ability's effect.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>Description of the ability effect.</returns>
    public static string GetDescription(this GantryRunnerAbility ability)
    {
        return ability switch
        {
            GantryRunnerAbility.RoofRunner =>
                "Reduce climbing stages required by 1 (minimum 1 stage).",
            GantryRunnerAbility.DeathDefyingLeap =>
                "Add +10 ft to your maximum leap distance.",
            GantryRunnerAbility.WallRun =>
                "Spend 1 action to run vertically up a wall (DC 3 Acrobatics).",
            GantryRunnerAbility.DoubleJump =>
                "Once per day, reroll a failed leap check with +1d10 bonus.",
            GantryRunnerAbility.Featherfall =>
                "Auto-succeed Crash Landing checks with DC ≤ 3.",
            _ => "Unknown ability effect."
        };
    }

    /// <summary>
    /// Gets whether this ability has limited daily uses.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>True if the ability has daily use limits.</returns>
    public static bool HasDailyLimit(this GantryRunnerAbility ability)
    {
        return ability == GantryRunnerAbility.DoubleJump;
    }

    /// <summary>
    /// Gets the daily use limit for this ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>Number of daily uses, or -1 for unlimited.</returns>
    public static int GetDailyUses(this GantryRunnerAbility ability)
    {
        return ability switch
        {
            GantryRunnerAbility.DoubleJump => 1,
            _ => -1 // Unlimited
        };
    }
}
```

---

## 6. MyrkengrAbility Enum

### 6.1 Enum Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/MyrkengrAbility.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Identifies Myrk-gengr specialization abilities.
/// </summary>
/// <remarks>
/// <para>
/// The Myrk-gengr (Old Norse: "shadow-walker") specialization focuses on
/// stealth, infiltration, and moving unseen through the shadows of the Sprawl.
/// </para>
/// <para>
/// These abilities enhance the base stealth movement (v0.15.2d) system
/// and interact with the [Hidden] status effect.
/// </para>
/// </remarks>
public enum MyrkengrAbility
{
    /// <summary>
    /// Enter [Hidden] without using an action.
    /// Type: Triggered
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: When entering an area with shadows or low lighting,
    /// automatically enter [Hidden] without spending an action.
    /// A stealth check is still required.
    /// </para>
    /// <para>
    /// Trigger: Entering shadows, dim light, or darkness.
    /// Requirement: Cannot be actively observed by enemies.
    /// </para>
    /// </remarks>
    SlipIntoShadow = 0,

    /// <summary>
    /// Stay [Hidden] after attacking once per encounter.
    /// Type: Reactive (1/encounter)
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: After making an attack from [Hidden], you may choose
    /// to remain [Hidden] instead of being revealed.
    /// </para>
    /// <para>
    /// Uses: Once per encounter. Resets at end of combat.
    /// Subsequent attacks break [Hidden] normally.
    /// </para>
    /// </remarks>
    GhostlyForm = 1,

    /// <summary>
    /// Grant party members +2d10 on Passive Stealth.
    /// Type: Active (Concentration)
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: While maintaining concentration, party members within
    /// 30 feet gain +2d10 to their Passive Stealth checks.
    /// </para>
    /// <para>
    /// Duration: Maintained until concentration is broken.
    /// Party stealth still uses weakest-link rule, but all gain bonus.
    /// </para>
    /// </remarks>
    CloakTheParty = 2,

    /// <summary>
    /// Auto-enter [Hidden] in [Psychic Resonance] zones.
    /// Type: Passive
    /// </summary>
    /// <remarks>
    /// <para>
    /// Effect: When entering a zone with the [Psychic Resonance]
    /// environmental tag, automatically enter [Hidden] without
    /// an action or check.
    /// </para>
    /// <para>
    /// Trigger: Entering [Psychic Resonance] zone.
    /// The psychic static provides natural concealment.
    /// [Hidden] breaks normally when attacking or detected.
    /// </para>
    /// </remarks>
    OneWithTheStatic = 3
}
```

### 6.2 MyrkengrAbility Extensions

**File:** `src/Core/RuneAndRust.Domain/Extensions/MyrkengrAbilityExtensions.cs`

```csharp
namespace RuneAndRust.Domain.Extensions;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Extension methods for <see cref="MyrkengrAbility"/> enum.
/// </summary>
public static class MyrkengrAbilityExtensions
{
    /// <summary>
    /// Gets the display name for this ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>Human-readable display name with brackets.</returns>
    public static string GetDisplayName(this MyrkengrAbility ability)
    {
        return ability switch
        {
            MyrkengrAbility.SlipIntoShadow => "[Slip into Shadow]",
            MyrkengrAbility.GhostlyForm => "[Ghostly Form]",
            MyrkengrAbility.CloakTheParty => "[Cloak the Party]",
            MyrkengrAbility.OneWithTheStatic => "[One with the Static]",
            _ => $"[Unknown Myrk-gengr Ability]"
        };
    }

    /// <summary>
    /// Gets the ability type for this ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>The ability activation type.</returns>
    public static SpecializationAbilityType GetAbilityType(this MyrkengrAbility ability)
    {
        return ability switch
        {
            MyrkengrAbility.SlipIntoShadow => SpecializationAbilityType.Triggered,
            MyrkengrAbility.GhostlyForm => SpecializationAbilityType.Reactive,
            MyrkengrAbility.CloakTheParty => SpecializationAbilityType.Active,
            MyrkengrAbility.OneWithTheStatic => SpecializationAbilityType.Passive,
            _ => SpecializationAbilityType.Passive
        };
    }

    /// <summary>
    /// Gets the description of this ability's effect.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>Description of the ability effect.</returns>
    public static string GetDescription(this MyrkengrAbility ability)
    {
        return ability switch
        {
            MyrkengrAbility.SlipIntoShadow =>
                "Enter [Hidden] without an action when entering shadows.",
            MyrkengrAbility.GhostlyForm =>
                "Once per encounter, stay [Hidden] after making an attack.",
            MyrkengrAbility.CloakTheParty =>
                "Grant nearby party members +2d10 on Passive Stealth (concentration).",
            MyrkengrAbility.OneWithTheStatic =>
                "Automatically enter [Hidden] in [Psychic Resonance] zones.",
            _ => "Unknown ability effect."
        };
    }

    /// <summary>
    /// Gets whether this ability has limited encounter uses.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>True if the ability has per-encounter use limits.</returns>
    public static bool HasEncounterLimit(this MyrkengrAbility ability)
    {
        return ability == MyrkengrAbility.GhostlyForm;
    }

    /// <summary>
    /// Gets the per-encounter use limit for this ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>Number of per-encounter uses, or -1 for unlimited.</returns>
    public static int GetEncounterUses(this MyrkengrAbility ability)
    {
        return ability switch
        {
            MyrkengrAbility.GhostlyForm => 1,
            _ => -1 // Unlimited
        };
    }

    /// <summary>
    /// Gets whether this ability requires concentration.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>True if the ability requires concentration to maintain.</returns>
    public static bool RequiresConcentration(this MyrkengrAbility ability)
    {
        return ability == MyrkengrAbility.CloakTheParty;
    }
}
```

---

## 7. SpecializationAbilityDefinition Value Object

### 7.1 Class Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SpecializationAbilityDefinition.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Defines metadata and configuration for a specialization ability.
/// </summary>
/// <remarks>
/// <para>
/// This value object encapsulates all static information about a specialization
/// ability, including its name, type, description, and usage limits.
/// </para>
/// </remarks>
/// <param name="AbilityId">Unique identifier for the ability.</param>
/// <param name="Specialization">The specialization this ability belongs to.</param>
/// <param name="DisplayName">Human-readable name with brackets (e.g., "[Roof-Runner]").</param>
/// <param name="AbilityType">The activation type of this ability.</param>
/// <param name="Description">Detailed description of the ability effect.</param>
/// <param name="DailyUses">Number of daily uses (-1 for unlimited).</param>
/// <param name="EncounterUses">Number of per-encounter uses (-1 for unlimited).</param>
/// <param name="RequiresConcentration">Whether the ability requires concentration.</param>
/// <param name="ActionCost">Action cost to activate (0 for no action).</param>
/// <param name="TriggerCondition">Description of what triggers this ability.</param>
public readonly record struct SpecializationAbilityDefinition(
    string AbilityId,
    string Specialization,
    string DisplayName,
    SpecializationAbilityType AbilityType,
    string Description,
    int DailyUses = -1,
    int EncounterUses = -1,
    bool RequiresConcentration = false,
    int ActionCost = 0,
    string? TriggerCondition = null)
{
    /// <summary>
    /// Gets a value indicating whether this ability has unlimited uses.
    /// </summary>
    public bool IsUnlimited => DailyUses == -1 && EncounterUses == -1;

    /// <summary>
    /// Gets a value indicating whether this is a passive ability.
    /// </summary>
    public bool IsPassive => AbilityType == SpecializationAbilityType.Passive;

    /// <summary>
    /// Gets a value indicating whether this ability requires an action.
    /// </summary>
    public bool RequiresAction => ActionCost > 0;

    /// <summary>
    /// Gets a value indicating whether this ability is triggered automatically.
    /// </summary>
    public bool IsTriggered => AbilityType == SpecializationAbilityType.Triggered;

    /// <summary>
    /// Gets a value indicating whether this ability is reactive.
    /// </summary>
    public bool IsReactive => AbilityType == SpecializationAbilityType.Reactive;

    /// <summary>
    /// Gets a formatted string describing usage limits.
    /// </summary>
    public string UsageLimitDescription
    {
        get
        {
            if (IsUnlimited) return "Unlimited";
            if (DailyUses > 0) return $"{DailyUses}/day";
            if (EncounterUses > 0) return $"{EncounterUses}/encounter";
            return "Unknown";
        }
    }

    /// <inheritdoc/>
    public override string ToString() =>
        $"{DisplayName} ({Specialization}, {AbilityType}, {UsageLimitDescription})";
}
```

### 7.2 Static Factory Methods

```csharp
// Additional static factory methods in SpecializationAbilityDefinition

/// <summary>
/// Creates a definition for a Gantry-Runner ability.
/// </summary>
/// <param name="ability">The Gantry-Runner ability.</param>
/// <returns>A fully configured ability definition.</returns>
public static SpecializationAbilityDefinition FromGantryRunner(GantryRunnerAbility ability)
{
    return ability switch
    {
        GantryRunnerAbility.RoofRunner => new SpecializationAbilityDefinition(
            AbilityId: "gantry-runner.roof-runner",
            Specialization: "Gantry-Runner",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription()),

        GantryRunnerAbility.DeathDefyingLeap => new SpecializationAbilityDefinition(
            AbilityId: "gantry-runner.death-defying-leap",
            Specialization: "Gantry-Runner",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription()),

        GantryRunnerAbility.WallRun => new SpecializationAbilityDefinition(
            AbilityId: "gantry-runner.wall-run",
            Specialization: "Gantry-Runner",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription(),
            ActionCost: 1),

        GantryRunnerAbility.DoubleJump => new SpecializationAbilityDefinition(
            AbilityId: "gantry-runner.double-jump",
            Specialization: "Gantry-Runner",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription(),
            DailyUses: 1,
            TriggerCondition: "After failing a leap check, before falling"),

        GantryRunnerAbility.Featherfall => new SpecializationAbilityDefinition(
            AbilityId: "gantry-runner.featherfall",
            Specialization: "Gantry-Runner",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription()),

        _ => throw new ArgumentOutOfRangeException(nameof(ability))
    };
}

/// <summary>
/// Creates a definition for a Myrk-gengr ability.
/// </summary>
/// <param name="ability">The Myrk-gengr ability.</param>
/// <returns>A fully configured ability definition.</returns>
public static SpecializationAbilityDefinition FromMyrkengr(MyrkengrAbility ability)
{
    return ability switch
    {
        MyrkengrAbility.SlipIntoShadow => new SpecializationAbilityDefinition(
            AbilityId: "myrkengr.slip-into-shadow",
            Specialization: "Myrk-gengr",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription(),
            TriggerCondition: "When entering shadows or low lighting"),

        MyrkengrAbility.GhostlyForm => new SpecializationAbilityDefinition(
            AbilityId: "myrkengr.ghostly-form",
            Specialization: "Myrk-gengr",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription(),
            EncounterUses: 1,
            TriggerCondition: "After completing an attack from [Hidden]"),

        MyrkengrAbility.CloakTheParty => new SpecializationAbilityDefinition(
            AbilityId: "myrkengr.cloak-the-party",
            Specialization: "Myrk-gengr",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription(),
            RequiresConcentration: true,
            ActionCost: 1),

        MyrkengrAbility.OneWithTheStatic => new SpecializationAbilityDefinition(
            AbilityId: "myrkengr.one-with-the-static",
            Specialization: "Myrk-gengr",
            DisplayName: ability.GetDisplayName(),
            AbilityType: ability.GetAbilityType(),
            Description: ability.GetDescription(),
            TriggerCondition: "When entering a [Psychic Resonance] zone"),

        _ => throw new ArgumentOutOfRangeException(nameof(ability))
    };
}
```

---

## 8. AbilityActivationContext Value Object

### 8.1 Class Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/AbilityActivationContext.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Encapsulates context for activating a specialization ability.
/// </summary>
/// <remarks>
/// <para>
/// This value object provides all information needed to determine if an
/// ability can be activated and what its effects should be.
/// </para>
/// </remarks>
/// <param name="CharacterId">The character attempting to use the ability.</param>
/// <param name="AbilityId">The ability being activated.</param>
/// <param name="TriggerSource">What triggered this activation attempt.</param>
/// <param name="CurrentZone">The zone the character is currently in.</param>
/// <param name="LightingLevel">Current lighting conditions.</param>
/// <param name="IsInCombat">Whether the character is currently in combat.</param>
/// <param name="RemainingDailyUses">Remaining daily uses for this ability.</param>
/// <param name="RemainingEncounterUses">Remaining encounter uses for this ability.</param>
/// <param name="IsConcentrating">Whether the character is already concentrating.</param>
/// <param name="RelatedCheckResult">Result of a related skill check, if applicable.</param>
/// <param name="FallHeight">Height of fall, for Featherfall calculations.</param>
/// <param name="LeapDistance">Distance of leap, for Death-Defying Leap calculations.</param>
/// <param name="ClimbHeight">Height of climb, for Roof-Runner calculations.</param>
public readonly record struct AbilityActivationContext(
    string CharacterId,
    string AbilityId,
    string TriggerSource,
    string? CurrentZone = null,
    LightingLevel LightingLevel = LightingLevel.Normal,
    bool IsInCombat = false,
    int RemainingDailyUses = -1,
    int RemainingEncounterUses = -1,
    bool IsConcentrating = false,
    DiceRollResult? RelatedCheckResult = null,
    int FallHeight = 0,
    int LeapDistance = 0,
    int ClimbHeight = 0)
{
    /// <summary>
    /// Gets a value indicating whether the character has daily uses remaining.
    /// </summary>
    public bool HasDailyUsesRemaining => RemainingDailyUses == -1 || RemainingDailyUses > 0;

    /// <summary>
    /// Gets a value indicating whether the character has encounter uses remaining.
    /// </summary>
    public bool HasEncounterUsesRemaining => RemainingEncounterUses == -1 || RemainingEncounterUses > 0;

    /// <summary>
    /// Gets a value indicating whether the character can concentrate on a new ability.
    /// </summary>
    public bool CanStartConcentration => !IsConcentrating;

    /// <summary>
    /// Gets a value indicating whether the zone has [Psychic Resonance].
    /// </summary>
    public bool IsInPsychicResonance =>
        CurrentZone?.Contains("Psychic Resonance", StringComparison.OrdinalIgnoreCase) == true;

    /// <summary>
    /// Gets a value indicating whether lighting allows stealth entry.
    /// </summary>
    public bool HasShadowAccess => LightingLevel <= LightingLevel.Dim;

    /// <inheritdoc/>
    public override string ToString() =>
        $"Activation: {AbilityId} for {CharacterId} (Trigger: {TriggerSource})";
}
```

### 8.2 Supporting Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/LightingLevel.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines lighting levels that affect stealth and visibility.
/// </summary>
public enum LightingLevel
{
    /// <summary>
    /// Complete darkness. No natural vision without special abilities.
    /// </summary>
    Dark = 0,

    /// <summary>
    /// Dim lighting with shadows. Allows stealth with shadows.
    /// </summary>
    /// <example>
    /// Moonlight, distant street lights, candlelight.
    /// </example>
    Dim = 1,

    /// <summary>
    /// Normal indoor or overcast lighting.
    /// </summary>
    Normal = 2,

    /// <summary>
    /// Bright lighting. Difficult to hide.
    /// </summary>
    /// <example>
    /// Direct sunlight, bright artificial lights, spotlights.
    /// </example>
    Bright = 3
}
```

---

## 9. AbilityActivationResult Value Object

### 9.1 Class Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/AbilityActivationResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the result of attempting to activate a specialization ability.
/// </summary>
/// <remarks>
/// <para>
/// This value object captures whether the activation succeeded, why it failed
/// if applicable, and what effects were applied.
/// </para>
/// </remarks>
/// <param name="AbilityId">The ability that was activated.</param>
/// <param name="CharacterId">The character who activated the ability.</param>
/// <param name="Success">Whether the activation was successful.</param>
/// <param name="FailureReason">Reason for failure, if applicable.</param>
/// <param name="EffectApplied">Description of the effect that was applied.</param>
/// <param name="RemainingDailyUses">Remaining daily uses after activation.</param>
/// <param name="RemainingEncounterUses">Remaining encounter uses after activation.</param>
/// <param name="ModifiedValue">Any numeric value that was modified.</param>
/// <param name="ModifiedDescription">Description of what was modified.</param>
/// <param name="NewHiddenStatus">If [Hidden] was entered, the new status.</param>
/// <param name="ConcentrationStarted">Whether concentration was started.</param>
/// <param name="ActivatedAt">Timestamp of activation.</param>
public readonly record struct AbilityActivationResult(
    string AbilityId,
    string CharacterId,
    bool Success,
    string? FailureReason = null,
    string? EffectApplied = null,
    int RemainingDailyUses = -1,
    int RemainingEncounterUses = -1,
    int? ModifiedValue = null,
    string? ModifiedDescription = null,
    HiddenStatus? NewHiddenStatus = null,
    bool ConcentrationStarted = false,
    DateTime? ActivatedAt = null)
{
    /// <summary>
    /// Gets a value indicating whether the activation failed.
    /// </summary>
    public bool Failed => !Success;

    /// <summary>
    /// Gets a value indicating whether a use was consumed.
    /// </summary>
    public bool UseConsumed => Success && (RemainingDailyUses >= 0 || RemainingEncounterUses >= 0);

    /// <inheritdoc/>
    public override string ToString()
    {
        if (Success)
        {
            return $"{AbilityId} activated: {EffectApplied}";
        }
        return $"{AbilityId} failed: {FailureReason}";
    }
}
```

### 9.2 Static Factory Methods

```csharp
// Additional static factory methods in AbilityActivationResult

/// <summary>
/// Creates a successful activation result.
/// </summary>
public static AbilityActivationResult Succeeded(
    string abilityId,
    string characterId,
    string effectApplied,
    int remainingDailyUses = -1,
    int remainingEncounterUses = -1,
    int? modifiedValue = null,
    string? modifiedDescription = null)
{
    return new AbilityActivationResult(
        AbilityId: abilityId,
        CharacterId: characterId,
        Success: true,
        EffectApplied: effectApplied,
        RemainingDailyUses: remainingDailyUses,
        RemainingEncounterUses: remainingEncounterUses,
        ModifiedValue: modifiedValue,
        ModifiedDescription: modifiedDescription,
        ActivatedAt: DateTime.UtcNow);
}

/// <summary>
/// Creates a failed activation result.
/// </summary>
public static AbilityActivationResult Failed(
    string abilityId,
    string characterId,
    string failureReason)
{
    return new AbilityActivationResult(
        AbilityId: abilityId,
        CharacterId: characterId,
        Success: false,
        FailureReason: failureReason,
        ActivatedAt: DateTime.UtcNow);
}

/// <summary>
/// Creates a result for entering [Hidden] status.
/// </summary>
public static AbilityActivationResult EnteredHidden(
    string abilityId,
    string characterId,
    HiddenStatus hiddenStatus,
    string source)
{
    return new AbilityActivationResult(
        AbilityId: abilityId,
        CharacterId: characterId,
        Success: true,
        EffectApplied: $"Entered [Hidden] via {source}",
        NewHiddenStatus: hiddenStatus,
        ActivatedAt: DateTime.UtcNow);
}

/// <summary>
/// Creates a result for starting concentration.
/// </summary>
public static AbilityActivationResult ConcentrationStarted(
    string abilityId,
    string characterId,
    string effectApplied)
{
    return new AbilityActivationResult(
        AbilityId: abilityId,
        CharacterId: characterId,
        Success: true,
        EffectApplied: effectApplied,
        ConcentrationStarted: true,
        ActivatedAt: DateTime.UtcNow);
}
```

---

## 10. ISpecializationAbilityService Interface

### 10.1 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/ISpecializationAbilityService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service interface for managing specialization ability activation and effects.
/// </summary>
/// <remarks>
/// <para>
/// This service coordinates between specialization abilities and the
/// underlying skill systems (climbing, leaping, stealth, etc.) to
/// apply ability effects.
/// </para>
/// </remarks>
public interface ISpecializationAbilityService
{
    /// <summary>
    /// Checks if a character has a specific Gantry-Runner ability.
    /// </summary>
    /// <param name="characterId">The character to check.</param>
    /// <param name="ability">The ability to check for.</param>
    /// <returns>True if the character has the ability.</returns>
    bool HasGantryRunnerAbility(string characterId, GantryRunnerAbility ability);

    /// <summary>
    /// Checks if a character has a specific Myrk-gengr ability.
    /// </summary>
    /// <param name="characterId">The character to check.</param>
    /// <param name="ability">The ability to check for.</param>
    /// <returns>True if the character has the ability.</returns>
    bool HasMyrkengrAbility(string characterId, MyrkengrAbility ability);

    /// <summary>
    /// Applies [Roof-Runner] effect to reduce climbing stages.
    /// </summary>
    /// <param name="characterId">The character with the ability.</param>
    /// <param name="originalStages">The original number of climbing stages.</param>
    /// <returns>The modified number of stages (minimum 1).</returns>
    int ApplyRoofRunner(string characterId, int originalStages);

    /// <summary>
    /// Applies [Death-Defying Leap] effect to increase leap distance.
    /// </summary>
    /// <param name="characterId">The character with the ability.</param>
    /// <param name="originalMaxDistance">The original maximum leap distance.</param>
    /// <returns>The modified maximum distance (original + 10ft).</returns>
    int ApplyDeathDefyingLeap(string characterId, int originalMaxDistance);

    /// <summary>
    /// Attempts to activate [Wall-Run] ability.
    /// </summary>
    /// <param name="context">The activation context.</param>
    /// <returns>The result of the wall-run attempt.</returns>
    Task<AbilityActivationResult> ActivateWallRunAsync(AbilityActivationContext context);

    /// <summary>
    /// Attempts to activate [Double Jump] after a failed leap.
    /// </summary>
    /// <param name="context">The activation context including original check result.</param>
    /// <returns>The result of the double jump attempt.</returns>
    Task<AbilityActivationResult> ActivateDoubleJumpAsync(AbilityActivationContext context);

    /// <summary>
    /// Checks if [Featherfall] auto-succeeds for a given crash landing DC.
    /// </summary>
    /// <param name="characterId">The character with the ability.</param>
    /// <param name="crashLandingDc">The crash landing DC to check.</param>
    /// <returns>True if the ability auto-succeeds (DC ≤ 3).</returns>
    bool FeatherfallAutoSucceeds(string characterId, int crashLandingDc);

    /// <summary>
    /// Attempts to activate [Slip into Shadow].
    /// </summary>
    /// <param name="context">The activation context.</param>
    /// <returns>The result including new [Hidden] status if successful.</returns>
    Task<AbilityActivationResult> ActivateSlipIntoShadowAsync(AbilityActivationContext context);

    /// <summary>
    /// Attempts to activate [Ghostly Form] after attacking from [Hidden].
    /// </summary>
    /// <param name="context">The activation context.</param>
    /// <returns>The result indicating if [Hidden] was maintained.</returns>
    Task<AbilityActivationResult> ActivateGhostlyFormAsync(AbilityActivationContext context);

    /// <summary>
    /// Activates [Cloak the Party] concentration effect.
    /// </summary>
    /// <param name="context">The activation context.</param>
    /// <returns>The result including concentration started.</returns>
    Task<AbilityActivationResult> ActivateCloakThePartyAsync(AbilityActivationContext context);

    /// <summary>
    /// Gets the dice bonus from active [Cloak the Party] effect.
    /// </summary>
    /// <param name="characterId">The character potentially receiving the bonus.</param>
    /// <param name="sourceCharacterId">The character providing the cloak.</param>
    /// <returns>The dice bonus (2 if active, 0 otherwise).</returns>
    int GetCloakThePartyBonus(string characterId, string sourceCharacterId);

    /// <summary>
    /// Checks and applies [One with the Static] when entering a zone.
    /// </summary>
    /// <param name="context">The activation context with zone info.</param>
    /// <returns>The result including new [Hidden] status if applicable.</returns>
    Task<AbilityActivationResult> CheckOneWithTheStaticAsync(AbilityActivationContext context);

    /// <summary>
    /// Gets the definition for a Gantry-Runner ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>The ability definition.</returns>
    SpecializationAbilityDefinition GetGantryRunnerDefinition(GantryRunnerAbility ability);

    /// <summary>
    /// Gets the definition for a Myrk-gengr ability.
    /// </summary>
    /// <param name="ability">The ability.</param>
    /// <returns>The ability definition.</returns>
    SpecializationAbilityDefinition GetMyrkengrDefinition(MyrkengrAbility ability);

    /// <summary>
    /// Resets daily ability uses for a character.
    /// </summary>
    /// <param name="characterId">The character to reset.</param>
    void ResetDailyUses(string characterId);

    /// <summary>
    /// Resets encounter ability uses for a character.
    /// </summary>
    /// <param name="characterId">The character to reset.</param>
    void ResetEncounterUses(string characterId);
}
```

---

## 11. SpecializationAbilityService Implementation

### 11.1 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/SpecializationAbilityService.cs`

```csharp
namespace RuneAndRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.Extensions;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service for managing specialization ability activation and effects.
/// </summary>
public sealed class SpecializationAbilityService : ISpecializationAbilityService
{
    private readonly ILogger<SpecializationAbilityService> _logger;
    private readonly ICharacterService _characterService;
    private readonly IStealthService _stealthService;
    private readonly IDiceRollerService _diceRollerService;

    // Track daily and encounter uses per character
    private readonly Dictionary<string, Dictionary<string, int>> _dailyUsesRemaining = new();
    private readonly Dictionary<string, Dictionary<string, int>> _encounterUsesRemaining = new();

    // Track active concentration effects
    private readonly Dictionary<string, string> _activeConcentrations = new();

    /// <summary>
    /// Initializes a new instance of the <see cref="SpecializationAbilityService"/> class.
    /// </summary>
    public SpecializationAbilityService(
        ILogger<SpecializationAbilityService> logger,
        ICharacterService characterService,
        IStealthService stealthService,
        IDiceRollerService diceRollerService)
    {
        _logger = logger;
        _characterService = characterService;
        _stealthService = stealthService;
        _diceRollerService = diceRollerService;
    }

    /// <inheritdoc/>
    public bool HasGantryRunnerAbility(string characterId, GantryRunnerAbility ability)
    {
        var character = _characterService.GetCharacter(characterId);
        return character?.Specialization == "Gantry-Runner" &&
               character.HasAbility(ability.GetDisplayName());
    }

    /// <inheritdoc/>
    public bool HasMyrkengrAbility(string characterId, MyrkengrAbility ability)
    {
        var character = _characterService.GetCharacter(characterId);
        return character?.Specialization == "Myrk-gengr" &&
               character.HasAbility(ability.GetDisplayName());
    }

    /// <inheritdoc/>
    public int ApplyRoofRunner(string characterId, int originalStages)
    {
        if (!HasGantryRunnerAbility(characterId, GantryRunnerAbility.RoofRunner))
        {
            return originalStages;
        }

        var modifiedStages = Math.Max(1, originalStages - 1);

        _logger.LogDebug(
            "[Roof-Runner] applied for {CharacterId}: {Original} stages -> {Modified} stages",
            characterId, originalStages, modifiedStages);

        return modifiedStages;
    }

    /// <inheritdoc/>
    public int ApplyDeathDefyingLeap(string characterId, int originalMaxDistance)
    {
        if (!HasGantryRunnerAbility(characterId, GantryRunnerAbility.DeathDefyingLeap))
        {
            return originalMaxDistance;
        }

        var modifiedDistance = originalMaxDistance + 10;

        _logger.LogDebug(
            "[Death-Defying Leap] applied for {CharacterId}: {Original}ft -> {Modified}ft",
            characterId, originalMaxDistance, modifiedDistance);

        return modifiedDistance;
    }

    /// <inheritdoc/>
    public async Task<AbilityActivationResult> ActivateWallRunAsync(AbilityActivationContext context)
    {
        const string abilityId = "gantry-runner.wall-run";

        if (!HasGantryRunnerAbility(context.CharacterId, GantryRunnerAbility.WallRun))
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId, "Character does not have [Wall-Run]");
        }

        // Wall-Run requires an Acrobatics check DC 3
        var checkResult = await _diceRollerService.RollAsync(
            context.CharacterId, "Acrobatics", "Wall-Run attempt");

        if (checkResult.NetSuccesses >= 3)
        {
            _logger.LogInformation(
                "[Wall-Run] succeeded for {CharacterId} with {Successes} successes",
                context.CharacterId, checkResult.NetSuccesses);

            return AbilityActivationResult.Succeeded(
                abilityId,
                context.CharacterId,
                "Wall-Run successful - can move vertically up to movement speed",
                modifiedDescription: "Vertical movement enabled");
        }
        else
        {
            _logger.LogInformation(
                "[Wall-Run] failed for {CharacterId} with {Successes} successes (needed 3)",
                context.CharacterId, checkResult.NetSuccesses);

            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                $"Acrobatics check failed ({checkResult.NetSuccesses}/3 successes)");
        }
    }

    /// <inheritdoc/>
    public async Task<AbilityActivationResult> ActivateDoubleJumpAsync(AbilityActivationContext context)
    {
        const string abilityId = "gantry-runner.double-jump";

        if (!HasGantryRunnerAbility(context.CharacterId, GantryRunnerAbility.DoubleJump))
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId, "Character does not have [Double Jump]");
        }

        var remaining = GetRemainingDailyUses(context.CharacterId, abilityId);
        if (remaining <= 0)
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId, "No daily uses remaining for [Double Jump]");
        }

        // Consume the daily use
        ConsumeDailyUse(context.CharacterId, abilityId);
        var newRemaining = GetRemainingDailyUses(context.CharacterId, abilityId);

        // Reroll with +1d10 bonus
        var rerollResult = await _diceRollerService.RollWithBonusAsync(
            context.CharacterId, "Acrobatics", 1, "Double Jump reroll");

        _logger.LogInformation(
            "[Double Jump] activated for {CharacterId}, reroll: {Successes} successes ({Remaining} uses left)",
            context.CharacterId, rerollResult.NetSuccesses, newRemaining);

        return AbilityActivationResult.Succeeded(
            abilityId,
            context.CharacterId,
            $"Double Jump reroll: {rerollResult.NetSuccesses} successes",
            remainingDailyUses: newRemaining,
            modifiedValue: rerollResult.NetSuccesses,
            modifiedDescription: "Leap check rerolled with +1d10");
    }

    /// <inheritdoc/>
    public bool FeatherfallAutoSucceeds(string characterId, int crashLandingDc)
    {
        if (!HasGantryRunnerAbility(characterId, GantryRunnerAbility.Featherfall))
        {
            return false;
        }

        var autoSucceeds = crashLandingDc <= 3;

        if (autoSucceeds)
        {
            _logger.LogDebug(
                "[Featherfall] auto-success for {CharacterId}: DC {Dc} ≤ 3",
                characterId, crashLandingDc);
        }

        return autoSucceeds;
    }

    /// <inheritdoc/>
    public async Task<AbilityActivationResult> ActivateSlipIntoShadowAsync(AbilityActivationContext context)
    {
        const string abilityId = "myrkengr.slip-into-shadow";

        if (!HasMyrkengrAbility(context.CharacterId, MyrkengrAbility.SlipIntoShadow))
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId, "Character does not have [Slip into Shadow]");
        }

        if (!context.HasShadowAccess)
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                "No shadows available - lighting too bright");
        }

        // Still requires stealth check, just no action cost
        var stealthResult = await _stealthService.AttemptStealthAsync(
            context.CharacterId, free: true);

        if (stealthResult.IsSuccess)
        {
            _logger.LogInformation(
                "[Slip into Shadow] succeeded for {CharacterId}",
                context.CharacterId);

            return AbilityActivationResult.EnteredHidden(
                abilityId,
                context.CharacterId,
                stealthResult.HiddenStatus!,
                "[Slip into Shadow]");
        }
        else
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                $"Stealth check failed: {stealthResult.Description}");
        }
    }

    /// <inheritdoc/>
    public async Task<AbilityActivationResult> ActivateGhostlyFormAsync(AbilityActivationContext context)
    {
        const string abilityId = "myrkengr.ghostly-form";

        if (!HasMyrkengrAbility(context.CharacterId, MyrkengrAbility.GhostlyForm))
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId, "Character does not have [Ghostly Form]");
        }

        var remaining = GetRemainingEncounterUses(context.CharacterId, abilityId);
        if (remaining <= 0)
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                "No encounter uses remaining for [Ghostly Form]");
        }

        // Consume the encounter use
        ConsumeEncounterUse(context.CharacterId, abilityId);
        var newRemaining = GetRemainingEncounterUses(context.CharacterId, abilityId);

        // Maintain [Hidden] status instead of breaking it
        await _stealthService.MaintainHiddenAfterAttackAsync(context.CharacterId);

        _logger.LogInformation(
            "[Ghostly Form] activated for {CharacterId}, [Hidden] maintained ({Remaining} uses left)",
            context.CharacterId, newRemaining);

        return AbilityActivationResult.Succeeded(
            abilityId,
            context.CharacterId,
            "[Hidden] maintained after attack via [Ghostly Form]",
            remainingEncounterUses: newRemaining);
    }

    /// <inheritdoc/>
    public async Task<AbilityActivationResult> ActivateCloakThePartyAsync(AbilityActivationContext context)
    {
        const string abilityId = "myrkengr.cloak-the-party";

        if (!HasMyrkengrAbility(context.CharacterId, MyrkengrAbility.CloakTheParty))
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId, "Character does not have [Cloak the Party]");
        }

        if (context.IsConcentrating)
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                "Already concentrating on another effect");
        }

        // Start concentration
        _activeConcentrations[context.CharacterId] = abilityId;

        _logger.LogInformation(
            "[Cloak the Party] activated for {CharacterId}, party gains +2d10 Passive Stealth",
            context.CharacterId);

        return AbilityActivationResult.ConcentrationStarted(
            abilityId,
            context.CharacterId,
            "Party members within 30ft gain +2d10 on Passive Stealth");
    }

    /// <inheritdoc/>
    public int GetCloakThePartyBonus(string characterId, string sourceCharacterId)
    {
        if (_activeConcentrations.TryGetValue(sourceCharacterId, out var abilityId) &&
            abilityId == "myrkengr.cloak-the-party")
        {
            // TODO: Check if characterId is within 30ft of sourceCharacterId
            return 2;
        }

        return 0;
    }

    /// <inheritdoc/>
    public async Task<AbilityActivationResult> CheckOneWithTheStaticAsync(AbilityActivationContext context)
    {
        const string abilityId = "myrkengr.one-with-the-static";

        if (!HasMyrkengrAbility(context.CharacterId, MyrkengrAbility.OneWithTheStatic))
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                "Character does not have [One with the Static]");
        }

        if (!context.IsInPsychicResonance)
        {
            return AbilityActivationResult.Failed(
                abilityId, context.CharacterId,
                "Not in a [Psychic Resonance] zone");
        }

        // Automatic [Hidden] entry, no check required
        var hiddenStatus = await _stealthService.EnterHiddenAutomaticallyAsync(
            context.CharacterId, "[One with the Static]");

        _logger.LogInformation(
            "[One with the Static] triggered for {CharacterId} in [Psychic Resonance] zone",
            context.CharacterId);

        return AbilityActivationResult.EnteredHidden(
            abilityId,
            context.CharacterId,
            hiddenStatus,
            "[One with the Static] (Psychic Resonance)");
    }

    /// <inheritdoc/>
    public SpecializationAbilityDefinition GetGantryRunnerDefinition(GantryRunnerAbility ability)
    {
        return SpecializationAbilityDefinition.FromGantryRunner(ability);
    }

    /// <inheritdoc/>
    public SpecializationAbilityDefinition GetMyrkengrDefinition(MyrkengrAbility ability)
    {
        return SpecializationAbilityDefinition.FromMyrkengr(ability);
    }

    /// <inheritdoc/>
    public void ResetDailyUses(string characterId)
    {
        if (_dailyUsesRemaining.ContainsKey(characterId))
        {
            _dailyUsesRemaining.Remove(characterId);
        }

        _logger.LogDebug("Reset daily ability uses for {CharacterId}", characterId);
    }

    /// <inheritdoc/>
    public void ResetEncounterUses(string characterId)
    {
        if (_encounterUsesRemaining.ContainsKey(characterId))
        {
            _encounterUsesRemaining.Remove(characterId);
        }

        // Also clear any active concentrations
        if (_activeConcentrations.ContainsKey(characterId))
        {
            _activeConcentrations.Remove(characterId);
        }

        _logger.LogDebug("Reset encounter ability uses for {CharacterId}", characterId);
    }

    #region Private Helpers

    private int GetRemainingDailyUses(string characterId, string abilityId)
    {
        if (!_dailyUsesRemaining.TryGetValue(characterId, out var uses))
        {
            // Initialize with default uses
            uses = new Dictionary<string, int>();
            _dailyUsesRemaining[characterId] = uses;
        }

        if (!uses.TryGetValue(abilityId, out var remaining))
        {
            // Initialize Double Jump with 1 daily use
            if (abilityId == "gantry-runner.double-jump")
            {
                remaining = 1;
                uses[abilityId] = remaining;
            }
            else
            {
                remaining = -1; // Unlimited
            }
        }

        return remaining;
    }

    private void ConsumeDailyUse(string characterId, string abilityId)
    {
        if (!_dailyUsesRemaining.ContainsKey(characterId))
        {
            _dailyUsesRemaining[characterId] = new Dictionary<string, int>();
        }

        var current = GetRemainingDailyUses(characterId, abilityId);
        if (current > 0)
        {
            _dailyUsesRemaining[characterId][abilityId] = current - 1;
        }
    }

    private int GetRemainingEncounterUses(string characterId, string abilityId)
    {
        if (!_encounterUsesRemaining.TryGetValue(characterId, out var uses))
        {
            uses = new Dictionary<string, int>();
            _encounterUsesRemaining[characterId] = uses;
        }

        if (!uses.TryGetValue(abilityId, out var remaining))
        {
            // Initialize Ghostly Form with 1 encounter use
            if (abilityId == "myrkengr.ghostly-form")
            {
                remaining = 1;
                uses[abilityId] = remaining;
            }
            else
            {
                remaining = -1; // Unlimited
            }
        }

        return remaining;
    }

    private void ConsumeEncounterUse(string characterId, string abilityId)
    {
        if (!_encounterUsesRemaining.ContainsKey(characterId))
        {
            _encounterUsesRemaining[characterId] = new Dictionary<string, int>();
        }

        var current = GetRemainingEncounterUses(characterId, abilityId);
        if (current > 0)
        {
            _encounterUsesRemaining[characterId][abilityId] = current - 1;
        }
    }

    #endregion
}
```

---

## 12. Gantry-Runner Ability Implementations

### 12.1 Climbing Service Integration

**File:** `src/Core/RuneAndRust.Application/Services/ClimbingService.cs` (Modification)

```csharp
// Add to ClimbingService constructor
private readonly ISpecializationAbilityService _specializationService;

// Modify CalculateStages method
public int CalculateStages(string characterId, int height)
{
    var baseStages = (int)Math.Ceiling(height / 10.0);

    // Apply [Roof-Runner] if character has it
    var modifiedStages = _specializationService.ApplyRoofRunner(characterId, baseStages);

    return modifiedStages;
}
```

### 12.2 Leaping Service Integration

**File:** `src/Core/RuneAndRust.Application/Services/LeapingService.cs` (Modification)

```csharp
// Add to LeapingService constructor
private readonly ISpecializationAbilityService _specializationService;

// Modify GetMaximumLeapDistance method
public int GetMaximumLeapDistance(string characterId)
{
    const int BaseMaxDistance = 25; // Heroic leap

    // Apply [Death-Defying Leap] if character has it
    return _specializationService.ApplyDeathDefyingLeap(characterId, BaseMaxDistance);
}

// Add method for Double Jump handling
public async Task<LeapResult> AttemptDoubleJumpAsync(
    string characterId,
    LeapResult failedResult,
    AbilityActivationContext context)
{
    var activationResult = await _specializationService.ActivateDoubleJumpAsync(context);

    if (!activationResult.Success)
    {
        // Double Jump couldn't be used, return original failure
        return failedResult;
    }

    // Use the reroll result
    var newSuccesses = activationResult.ModifiedValue ?? 0;
    var dc = failedResult.Context.EffectiveDc;

    if (newSuccesses >= dc)
    {
        return LeapResult.Succeeded(
            failedResult.Context,
            newSuccesses,
            "[Double Jump] recovery successful");
    }
    else
    {
        return failedResult with
        {
            Description = $"[Double Jump] failed ({newSuccesses}/{dc}), falling"
        };
    }
}
```

### 12.3 Fall Damage Service Integration

**File:** `src/Core/RuneAndRust.Application/Services/FallDamageService.cs` (Modification)

```csharp
// Add to FallDamageService constructor
private readonly ISpecializationAbilityService _specializationService;

// Modify AttemptCrashLanding method
public async Task<CrashLandingResult> AttemptCrashLandingAsync(
    string characterId,
    FallDamage fallDamage)
{
    // Check for [Featherfall] auto-success
    if (_specializationService.FeatherfallAutoSucceeds(characterId, fallDamage.CrashLandingDc))
    {
        _logger.LogInformation(
            "[Featherfall] auto-success for {CharacterId}, DC {Dc} ≤ 3",
            characterId, fallDamage.CrashLandingDc);

        return CrashLandingResult.AutoSuccess(
            fallDamage,
            "[Featherfall] - automatic success");
    }

    // Normal crash landing check
    var result = await _diceRollerService.RollAsync(
        characterId, "Acrobatics", "Crash Landing");

    // ... rest of existing crash landing logic
}
```

---

## 13. Myrk-gengr Ability Implementations

### 13.1 Stealth Service Integration

**File:** `src/Core/RuneAndRust.Application/Services/StealthService.cs` (Modification)

```csharp
// Add to StealthService constructor
private readonly ISpecializationAbilityService _specializationService;

// Add method for automatic [Hidden] entry
public async Task<HiddenStatus> EnterHiddenAutomaticallyAsync(
    string characterId,
    string source)
{
    var hiddenStatus = HiddenStatus.Create(characterId, source);
    await _hiddenStatusRepository.SaveAsync(hiddenStatus);

    _logger.LogInformation(
        "Character {CharacterId} entered [Hidden] automatically via {Source}",
        characterId, source);

    return hiddenStatus;
}

// Add method to maintain [Hidden] after attack
public async Task MaintainHiddenAfterAttackAsync(string characterId)
{
    var hiddenStatus = await _hiddenStatusRepository.GetByCharacterIdAsync(characterId);

    if (hiddenStatus != null && hiddenStatus.IsHidden)
    {
        // Don't break [Hidden] - ability handles this
        _logger.LogDebug(
            "Character {CharacterId} maintains [Hidden] after attack",
            characterId);
    }
}

// Modify GetPartyStealthBonus to include [Cloak the Party]
public int GetPartyStealthBonus(string characterId, IEnumerable<string> partyMemberIds)
{
    var bonus = 0;

    foreach (var memberId in partyMemberIds)
    {
        var cloakBonus = _specializationService.GetCloakThePartyBonus(characterId, memberId);
        bonus = Math.Max(bonus, cloakBonus);
    }

    return bonus;
}
```

### 13.2 Zone Entry Handler

**File:** `src/Core/RuneAndRust.Application/Services/ZoneService.cs` (Modification)

```csharp
// Add check when character enters a zone
public async Task OnCharacterEnteredZoneAsync(string characterId, Zone zone)
{
    // Check for [One with the Static] trigger
    if (zone.HasEnvironmentTag("Psychic Resonance"))
    {
        var context = new AbilityActivationContext(
            CharacterId: characterId,
            AbilityId: "myrkengr.one-with-the-static",
            TriggerSource: "Zone Entry",
            CurrentZone: zone.EnvironmentTags);

        await _specializationService.CheckOneWithTheStaticAsync(context);
    }
}
```

---

## 14. Configuration

### 14.1 Configuration File

**File:** `config/specialization-abilities.json`

```json
{
  "$schema": "./schemas/specialization-abilities.schema.json",
  "version": "0.15.2g",
  "specializations": {
    "gantry-runner": {
      "displayName": "Gantry-Runner",
      "description": "Acrobatic specialists excelling at urban traversal and death-defying movement.",
      "abilities": {
        "roof-runner": {
          "displayName": "[Roof-Runner]",
          "type": "passive",
          "description": "Reduce climbing stages required by 1 (minimum 1 stage).",
          "effect": {
            "modifies": "climbing.stages",
            "modifier": -1,
            "minimum": 1
          }
        },
        "death-defying-leap": {
          "displayName": "[Death-Defying Leap]",
          "type": "passive",
          "description": "Add +10 ft to your maximum leap distance.",
          "effect": {
            "modifies": "leaping.maxDistance",
            "modifier": 10
          }
        },
        "wall-run": {
          "displayName": "[Wall-Run]",
          "type": "active",
          "description": "Spend 1 action to run vertically up a wall (DC 3 Acrobatics).",
          "actionCost": 1,
          "effect": {
            "checkType": "acrobatics",
            "dc": 3,
            "success": "Move up to movement speed vertically"
          }
        },
        "double-jump": {
          "displayName": "[Double Jump]",
          "type": "reactive",
          "description": "Once per day, reroll a failed leap check with +1d10 bonus.",
          "trigger": "After failing a leap check, before falling",
          "dailyUses": 1,
          "effect": {
            "action": "reroll",
            "bonusDice": 1
          }
        },
        "featherfall": {
          "displayName": "[Featherfall]",
          "type": "passive",
          "description": "Auto-succeed Crash Landing checks with DC ≤ 3.",
          "effect": {
            "modifies": "fallDamage.crashLanding",
            "autoSuccessThreshold": 3
          }
        }
      }
    },
    "myrk-gengr": {
      "displayName": "Myrk-gengr",
      "description": "Shadow-walkers specializing in stealth, infiltration, and unseen movement.",
      "abilities": {
        "slip-into-shadow": {
          "displayName": "[Slip into Shadow]",
          "type": "triggered",
          "description": "Enter [Hidden] without an action when entering shadows.",
          "trigger": "Entering shadows, dim light, or darkness",
          "requirements": ["shadow_access", "not_observed"],
          "effect": {
            "action": "enter_hidden",
            "freeAction": true,
            "requiresCheck": true
          }
        },
        "ghostly-form": {
          "displayName": "[Ghostly Form]",
          "type": "reactive",
          "description": "Once per encounter, stay [Hidden] after making an attack.",
          "trigger": "After completing an attack from [Hidden]",
          "encounterUses": 1,
          "effect": {
            "action": "maintain_hidden",
            "ignoresBreakCondition": "attack"
          }
        },
        "cloak-the-party": {
          "displayName": "[Cloak the Party]",
          "type": "active",
          "description": "Grant nearby party members +2d10 on Passive Stealth (concentration).",
          "actionCost": 1,
          "requiresConcentration": true,
          "effect": {
            "range": 30,
            "bonusDice": 2,
            "target": "party_stealth"
          }
        },
        "one-with-the-static": {
          "displayName": "[One with the Static]",
          "type": "passive",
          "description": "Automatically enter [Hidden] in [Psychic Resonance] zones.",
          "trigger": "Entering a zone with [Psychic Resonance] environment tag",
          "effect": {
            "action": "enter_hidden",
            "automatic": true,
            "requiresCheck": false
          }
        }
      }
    }
  }
}
```

### 14.2 JSON Schema

**File:** `config/schemas/specialization-abilities.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "specialization-abilities.schema.json",
  "title": "Specialization Abilities Configuration",
  "description": "Schema for specialization ability definitions",
  "type": "object",
  "required": ["version", "specializations"],
  "properties": {
    "$schema": { "type": "string" },
    "version": {
      "type": "string",
      "description": "Configuration version"
    },
    "specializations": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/Specialization"
      }
    }
  },
  "definitions": {
    "Specialization": {
      "type": "object",
      "required": ["displayName", "description", "abilities"],
      "properties": {
        "displayName": { "type": "string" },
        "description": { "type": "string" },
        "abilities": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/Ability"
          }
        }
      }
    },
    "Ability": {
      "type": "object",
      "required": ["displayName", "type", "description"],
      "properties": {
        "displayName": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["passive", "triggered", "reactive", "active"]
        },
        "description": { "type": "string" },
        "trigger": { "type": "string" },
        "requirements": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dailyUses": { "type": "integer", "minimum": 1 },
        "encounterUses": { "type": "integer", "minimum": 1 },
        "actionCost": { "type": "integer", "minimum": 0 },
        "requiresConcentration": { "type": "boolean" },
        "effect": { "type": "object" }
      }
    }
  }
}
```

---

## 15. Commands

### 15.1 Ability Commands

| Command | Description | Example |
|---------|-------------|---------|
| `!ability list` | List all abilities for current specialization | `!ability list` |
| `!ability info <name>` | Show details of an ability | `!ability info roof-runner` |
| `!ability use <name>` | Activate an active ability | `!ability use wall-run` |
| `!ability uses` | Show remaining daily/encounter uses | `!ability uses` |

### 15.2 Command Implementations

```csharp
// Example command handler
[Command("ability")]
public async Task HandleAbilityCommand(CommandContext ctx, string subcommand, string? abilityName = null)
{
    switch (subcommand.ToLowerInvariant())
    {
        case "list":
            await ListAbilitiesAsync(ctx);
            break;
        case "info":
            await ShowAbilityInfoAsync(ctx, abilityName);
            break;
        case "use":
            await UseAbilityAsync(ctx, abilityName);
            break;
        case "uses":
            await ShowRemainingUsesAsync(ctx);
            break;
        default:
            await ctx.ReplyAsync("Unknown subcommand. Use: list, info, use, or uses");
            break;
    }
}
```

---

## 16. User-Facing Changes

### 16.1 Status Display

```
┌─────────────────────────────────────────────────────────────────┐
│                     CHARACTER STATUS                             │
├─────────────────────────────────────────────────────────────────┤
│  Nyx - Gantry-Runner                                            │
│                                                                  │
│  SPECIALIZATION ABILITIES:                                       │
│  ├── [Roof-Runner]        Passive   Climbing stages -1           │
│  ├── [Death-Defying Leap] Passive   Max leap +10ft               │
│  ├── [Wall-Run]           Active    DC 3 vertical movement       │
│  ├── [Double Jump]        Reactive  1/day leap recovery ●○       │
│  └── [Featherfall]        Passive   Auto Crash Land DC ≤ 3       │
│                                                                  │
│  ● = Available  ○ = Used                                         │
└─────────────────────────────────────────────────────────────────┘
```

### 16.2 Ability Activation Feedback

```
┌─────────────────────────────────────────────────────────────────┐
│  [Wall-Run] - Acrobatics Check                                   │
├─────────────────────────────────────────────────────────────────┤
│  DC: 3 successes                                                 │
│  Roll: 6d10 → [2, 4, 8, 9, 3, 10] = 3 successes                 │
│  Result: SUCCESS                                                 │
│                                                                  │
│  Nyx runs vertically up the wall, defying gravity for a         │
│  moment as she reaches the rooftop above.                       │
└─────────────────────────────────────────────────────────────────┘
```

```
┌─────────────────────────────────────────────────────────────────┐
│  [Double Jump] Activated!                                        │
├─────────────────────────────────────────────────────────────────┤
│  Original leap failed with 2 successes (needed 4)               │
│  Activating [Double Jump] - 1/1 daily use consumed              │
│                                                                  │
│  Reroll with +1d10: 7d10 → [1, 6, 8, 9, 10, 3, 8] = 4 successes │
│  Result: SAVED!                                                  │
│                                                                  │
│  Mid-fall, Nyx kicks off an invisible platform of pure          │
│  willpower, launching herself to safety.                        │
│                                                                  │
│  [Double Jump] uses remaining: 0/1                               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 17. Logging Specifications

### 17.1 Log Categories

| Category | Level | Purpose |
|----------|-------|---------|
| `Specialization.Ability` | Information | Ability activations |
| `Specialization.Ability` | Debug | Passive effect applications |
| `Specialization.Usage` | Information | Daily/encounter use tracking |
| `Specialization.Integration` | Debug | Service integration calls |

### 17.2 Log Format Examples

```
[2026-01-17 14:32:15] INFO  Specialization.Ability: [Roof-Runner] applied for char_001: 3 stages -> 2 stages
[2026-01-17 14:32:18] INFO  Specialization.Ability: [Wall-Run] succeeded for char_001 with 4 successes
[2026-01-17 14:32:22] INFO  Specialization.Usage: [Double Jump] activated for char_001, 0/1 daily uses remaining
[2026-01-17 14:32:25] DEBUG Specialization.Integration: Featherfall check: DC 3 ≤ 3, auto-success
[2026-01-17 14:32:30] INFO  Specialization.Ability: [Slip into Shadow] succeeded for char_002
[2026-01-17 14:32:35] INFO  Specialization.Ability: [Ghostly Form] activated for char_002, [Hidden] maintained
```

---

## 18. Unit Testing Requirements

### 18.1 Test Categories

| Category | Test Count | Description |
|----------|------------|-------------|
| Gantry-Runner Abilities | 1 | Roof-Runner reduces climbing stages |
| Myrk-gengr Abilities | 1 | Slip into Shadow enters [Hidden] without action |
| **Total** | **~2** | As specified in scope |

### 18.2 Test Specifications

#### Test 1: Gantry-Runner Reduces Climbing Stages

**File:** `tests/RuneAndRust.Application.Tests/Services/SpecializationAbilityServiceTests.cs`

```csharp
[Fact]
public void ApplyRoofRunner_WithAbility_ReducesStagesByOne()
{
    // Arrange
    var characterId = "test-char-gantry";
    _mockCharacterService
        .Setup(x => x.GetCharacter(characterId))
        .Returns(new Character
        {
            Specialization = "Gantry-Runner",
            Abilities = new[] { "[Roof-Runner]" }
        });

    var service = CreateService();
    var originalStages = 4; // 40ft climb

    // Act
    var modifiedStages = service.ApplyRoofRunner(characterId, originalStages);

    // Assert
    Assert.Equal(3, modifiedStages); // 4 - 1 = 3
}

[Fact]
public void ApplyRoofRunner_WithAbility_MinimumOneStage()
{
    // Arrange
    var characterId = "test-char-gantry";
    _mockCharacterService
        .Setup(x => x.GetCharacter(characterId))
        .Returns(new Character
        {
            Specialization = "Gantry-Runner",
            Abilities = new[] { "[Roof-Runner]" }
        });

    var service = CreateService();
    var originalStages = 1; // 10ft climb

    // Act
    var modifiedStages = service.ApplyRoofRunner(characterId, originalStages);

    // Assert
    Assert.Equal(1, modifiedStages); // Cannot go below 1
}

[Fact]
public void ApplyRoofRunner_WithoutAbility_ReturnsOriginal()
{
    // Arrange
    var characterId = "test-char-other";
    _mockCharacterService
        .Setup(x => x.GetCharacter(characterId))
        .Returns(new Character { Specialization = "Other" });

    var service = CreateService();
    var originalStages = 4;

    // Act
    var modifiedStages = service.ApplyRoofRunner(characterId, originalStages);

    // Assert
    Assert.Equal(4, modifiedStages); // Unchanged
}
```

#### Test 2: Myrk-gengr Can Enter Hidden Without Action

**File:** `tests/RuneAndRust.Application.Tests/Services/SpecializationAbilityServiceTests.cs`

```csharp
[Fact]
public async Task ActivateSlipIntoShadow_WithShadowAccess_EntersHiddenFree()
{
    // Arrange
    var characterId = "test-char-myrk";
    _mockCharacterService
        .Setup(x => x.GetCharacter(characterId))
        .Returns(new Character
        {
            Specialization = "Myrk-gengr",
            Abilities = new[] { "[Slip into Shadow]" }
        });

    _mockStealthService
        .Setup(x => x.AttemptStealthAsync(characterId, true))
        .ReturnsAsync(StealthCheckResult.Succeeded(
            new HiddenStatus { CharacterId = characterId, IsHidden = true }));

    var service = CreateService();
    var context = new AbilityActivationContext(
        CharacterId: characterId,
        AbilityId: "myrkengr.slip-into-shadow",
        TriggerSource: "Entering shadows",
        LightingLevel: LightingLevel.Dim); // Has shadow access

    // Act
    var result = await service.ActivateSlipIntoShadowAsync(context);

    // Assert
    Assert.True(result.Success);
    Assert.NotNull(result.NewHiddenStatus);
    Assert.True(result.NewHiddenStatus!.IsHidden);

    // Verify stealth was attempted as free action
    _mockStealthService.Verify(
        x => x.AttemptStealthAsync(characterId, true),
        Times.Once);
}

[Fact]
public async Task ActivateSlipIntoShadow_WithoutShadowAccess_Fails()
{
    // Arrange
    var characterId = "test-char-myrk";
    _mockCharacterService
        .Setup(x => x.GetCharacter(characterId))
        .Returns(new Character
        {
            Specialization = "Myrk-gengr",
            Abilities = new[] { "[Slip into Shadow]" }
        });

    var service = CreateService();
    var context = new AbilityActivationContext(
        CharacterId: characterId,
        AbilityId: "myrkengr.slip-into-shadow",
        TriggerSource: "Open area",
        LightingLevel: LightingLevel.Bright); // No shadow access

    // Act
    var result = await service.ActivateSlipIntoShadowAsync(context);

    // Assert
    Assert.False(result.Success);
    Assert.Contains("lighting too bright", result.FailureReason);
}
```

---

## 19. Use Cases

### 19.1 Use Case: Roof Chase with Gantry-Runner

```
┌─────────────────────────────────────────────────────────────────┐
│                 USE CASE: ROOF CHASE                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  SCENARIO: Nyx (Gantry-Runner) flees across rooftops            │
│                                                                  │
│  1. CLIMB TO ROOF (30ft)                                        │
│     Normal:      3 stages required                              │
│     [Roof-Runner]: 2 stages required                            │
│     Result:      Faster escape, pursuer takes 3 stages          │
│                                                                  │
│  2. LEAP ACROSS GAP (20ft)                                      │
│     Normal max:  25ft (DC 5)                                    │
│     [Death-Defying Leap]: 35ft max                              │
│     Result:      20ft is well within extended range             │
│                                                                  │
│  3. LEAP FAILS (rolled 2/4 successes)                           │
│     Normal:      Fall begins immediately                        │
│     [Double Jump]: Reroll with +1d10                            │
│     Reroll:      4 successes - SAVED!                           │
│     Result:      Nyx lands safely, 0/1 daily uses remain        │
│                                                                  │
│  4. FORCED OFF LEDGE (10ft fall)                                │
│     Crash DC:    2 + (10/10) = 3                                │
│     [Featherfall]: Auto-success DC ≤ 3                          │
│     Result:      No damage taken                                │
│                                                                  │
│  OUTCOME: Nyx escapes using all her Gantry-Runner abilities     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 19.2 Use Case: Infiltration with Myrk-gengr

```
┌─────────────────────────────────────────────────────────────────┐
│                 USE CASE: CORP INFILTRATION                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  SCENARIO: Shadow (Myrk-gengr) infiltrates corporate facility   │
│                                                                  │
│  1. APPROACH IN SHADOWS                                         │
│     Normal:      Enter [Hidden] requires action                 │
│     [Slip into Shadow]: Enter free when reaching shadows        │
│     Result:      Shadow enters [Hidden] with no action cost     │
│                                                                  │
│  2. LEAD PARTY THROUGH CORRIDOR                                 │
│     Normal:      Party stealth uses weakest member              │
│     [Cloak the Party]: All party +2d10 Passive Stealth          │
│     Result:      Weakest member's check improved significantly  │
│                                                                  │
│  3. GUARD SPOTTED - TAKE OUT SILENTLY                           │
│     Normal:      Attack from [Hidden] breaks it                 │
│     [Ghostly Form]: Stay [Hidden] after first attack            │
│     Result:      Guard down, Shadow still [Hidden]              │
│                  (1/1 encounter use consumed)                    │
│                                                                  │
│  4. ENTER [PSYCHIC RESONANCE] SERVER ROOM                       │
│     Normal:      Need to re-establish [Hidden]                  │
│     [One with the Static]: Auto-[Hidden] in zone                │
│     Result:      Shadow automatically [Hidden] in server room   │
│                                                                  │
│  OUTCOME: Shadow completes infiltration maximizing stealth      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 20. Deliverable Checklist

### 20.1 Domain Layer

| File | Status | Description |
|------|--------|-------------|
| `Domain/Enums/SpecializationAbilityType.cs` | [ ] | Ability type enum |
| `Domain/Enums/GantryRunnerAbility.cs` | [ ] | Gantry-Runner abilities |
| `Domain/Enums/MyrkengrAbility.cs` | [ ] | Myrk-gengr abilities |
| `Domain/Enums/LightingLevel.cs` | [ ] | Lighting level enum |
| `Domain/Extensions/GantryRunnerAbilityExtensions.cs` | [ ] | Gantry-Runner extensions |
| `Domain/Extensions/MyrkengrAbilityExtensions.cs` | [ ] | Myrk-gengr extensions |
| `Domain/ValueObjects/SpecializationAbilityDefinition.cs` | [ ] | Ability metadata |
| `Domain/ValueObjects/AbilityActivationContext.cs` | [ ] | Activation parameters |
| `Domain/ValueObjects/AbilityActivationResult.cs` | [ ] | Activation outcome |

### 20.2 Application Layer

| File | Status | Description |
|------|--------|-------------|
| `Application/Interfaces/ISpecializationAbilityService.cs` | [ ] | Service interface |
| `Application/Services/SpecializationAbilityService.cs` | [ ] | Service implementation |
| `Application/Services/ClimbingService.cs` | [ ] | Integration (modify) |
| `Application/Services/LeapingService.cs` | [ ] | Integration (modify) |
| `Application/Services/FallDamageService.cs` | [ ] | Integration (modify) |
| `Application/Services/StealthService.cs` | [ ] | Integration (modify) |

### 20.3 Infrastructure Layer

| File | Status | Description |
|------|--------|-------------|
| `config/specialization-abilities.json` | [ ] | Ability configuration |
| `config/schemas/specialization-abilities.schema.json` | [ ] | JSON schema |

### 20.4 Test Layer

| File | Status | Description |
|------|--------|-------------|
| `Tests/Services/SpecializationAbilityServiceTests.cs` | [ ] | Unit tests (~2) |

---

## 21. Acceptance Criteria

### 21.1 Functional Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| AC-1 | [Roof-Runner] reduces climbing stages by 1 | Unit test |
| AC-2 | [Roof-Runner] maintains minimum 1 stage | Unit test |
| AC-3 | [Death-Defying Leap] adds +10ft to max distance | Integration test |
| AC-4 | [Wall-Run] requires DC 3 Acrobatics check | Manual test |
| AC-5 | [Double Jump] allows reroll with +1d10 | Integration test |
| AC-6 | [Double Jump] limited to 1/day | Unit test |
| AC-7 | [Featherfall] auto-succeeds DC ≤ 3 | Unit test |
| AC-8 | [Slip into Shadow] enters [Hidden] free | Unit test |
| AC-9 | [Slip into Shadow] requires shadows | Unit test |
| AC-10 | [Ghostly Form] maintains [Hidden] after attack | Integration test |
| AC-11 | [Ghostly Form] limited to 1/encounter | Unit test |
| AC-12 | [Cloak the Party] grants +2d10 party stealth | Integration test |
| AC-13 | [Cloak the Party] requires concentration | Manual test |
| AC-14 | [One with the Static] auto-[Hidden] in zone | Integration test |

### 21.2 Quality Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| QC-1 | All unit tests pass | `dotnet test` |
| QC-2 | No compiler warnings | `dotnet build` |
| QC-3 | Configuration validates against schema | Schema validation |
| QC-4 | XML documentation complete | Code review |
| QC-5 | Logging implemented for all activations | Log inspection |

---

## 22. Future Considerations

### 22.1 Deferred to Future Versions

| Feature | Reason | Target Version |
|---------|--------|----------------|
| Specialization acquisition | Character system dependency | Character System |
| Ability point costs | Character progression scope | Character System |
| Multi-specialization | Complex balance implications | Future |
| Ability upgrade trees | Additional design needed | v0.16+ |
| Additional specializations | Core framework first | v0.16+ |

### 22.2 Potential Extensions

1. **Combat Integration**: [Wall-Run] could enable elevated attack positions
2. **Party Coordination**: Additional party-wide ability buffs
3. **Environmental Synergies**: More zone-ability interactions
4. **Specialization Combos**: Multi-class ability combinations

---

## 23. Implementation Notes

### 23.1 Service Registration

```csharp
// In DependencyInjection.cs
services.AddScoped<ISpecializationAbilityService, SpecializationAbilityService>();
```

### 23.2 Existing Service Modifications

The following services require modifications to support specialization integration:

1. **ClimbingService**: Add `ISpecializationAbilityService` dependency, modify stage calculation
2. **LeapingService**: Add dependency, modify distance calculation, add Double Jump handling
3. **FallDamageService**: Add dependency, check Featherfall before Crash Landing rolls
4. **StealthService**: Add dependency, implement automatic [Hidden] entry methods
5. **ZoneService**: Add zone entry handler for [One with the Static]

### 23.3 State Management

- Daily uses reset on long rest (call `ResetDailyUses`)
- Encounter uses reset at combat end (call `ResetEncounterUses`)
- Concentration tracked per character (broken on damage or new concentration)

---

## 24. Document Metadata

| Field | Value |
|-------|-------|
| Document Version | 1.0 |
| Created | 2026-01-17 |
| Last Modified | 2026-01-17 |
| Author | Claude |
| Status | Draft |
| Review Status | Pending |

### 24.1 Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-17 | Claude | Initial specification |

### 24.2 References

| Document | Relationship |
|----------|--------------|
| v0.15.2-scope-breakdown.md | Source of requirements |
| v0.15.2a-design-specification.md | Climbing system integration |
| v0.15.2b-design-specification.md | Leaping system integration |
| v0.15.2c-design-specification.md | Fall damage integration |
| v0.15.2d-design-specification.md | Stealth system integration |
| v0.15.2e-design-specification.md | Chase sequences (reference) |
| v0.15.2f-design-specification.md | Balance checks (reference) |
