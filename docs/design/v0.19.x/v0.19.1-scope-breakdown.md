# v0.19.1 Midgard Implementation - Scope Breakdown

**Version:** 0.19.1
**Theme:** Midgard (The Tamed Ruin)
**Prerequisites:** v0.19.0 (Core Biome Infrastructure)
**Total Estimated Tests:** ~18 new tests

---

## Executive Summary

v0.19.1 implements Midgard, the starting realm and agricultural heartland of Aethelgard. This version defines the complete Midgard biome configuration including all sub-zones (The Greatwood, Sun Fields, Iron Marches, The Veil Edge), faction spawn pools, and environmental conditions. Midgard serves as the baseline realm against which all other realms are measured.

The work is divided into **1 sub-phase**:

| Phase    | Name                   | Focus                                         | Est. Tests |
| -------- | ---------------------- | --------------------------------------------- | ---------- |
| v0.19.1a | Midgard Implementation | Biome definition, zones, factions, conditions | ~18        |

---

## Feature Analysis & Categorization

### From v0.19.x-overview.md - Domain Layer

| Feature                          | Complexity | Dependencies                    | Assigned Phase |
| -------------------------------- | ---------- | ------------------------------- | -------------- |
| Midgard BiomeDefinition          | Medium     | BiomeDefinition entity, RealmId | **v0.19.1a**   |
| The Greatwood Zone               | Medium     | BiomeZone entity                | **v0.19.1a**   |
| Sun Fields Zone                  | Medium     | BiomeZone entity                | **v0.19.1a**   |
| Iron Marches Zone                | Medium     | BiomeZone entity                | **v0.19.1a**   |
| The Veil Edge Zone               | Medium     | BiomeZone entity                | **v0.19.1a**   |
| Midgard Environmental Conditions | Low        | EnvironmentalCondition entity   | **v0.19.1a**   |

### From v0.19.x-overview.md - Configuration Layer

| Feature                     | Complexity | Dependencies       | Assigned Phase |
| --------------------------- | ---------- | ------------------ | -------------- |
| midgard.json Configuration  | Medium     | biomes.schema.json | **v0.19.1a**   |
| Midgard Faction Spawn Pools | Medium     | Faction system     | **v0.19.1a**   |
| Midgard Lore Integration    | Low        | None               | **v0.19.1a**   |

---

## Phase Definitions

---

## v0.19.1a: Midgard Implementation

[v0.19.1a Design Specification](v0.19.1a-design-specification.md)

### Overview

This phase implements the complete Midgard realm, including its core definition, four sub-zones, faction spawn pools, and environmental conditions. Midgard is the starting realm and serves as the baseline for the entire biome system.

### Scope

**In Scope:**

- Midgard `BiomeDefinition` with complete properties
- Four sub-zones: The Greatwood, Sun Fields, Iron Marches, The Veil Edge
- Faction spawn pools per zone (Einherjar, Fenris Brood, Rustkin, Clockwork Remnants)
- Midgard-specific environmental conditions (None/Mild)
- Zone property overrides and DC modifiers
- Lore integration (quotes, descriptions, color palettes)
- Complete midgard.json configuration file

**Out of Scope:**

- Other realm implementations (v0.19.2+)
- Room template assignment (v0.20.x)
- NPC placement logic (v0.20.x)
- Travel mechanics (v0.19.6)
- Quest integration

### Key Deliverables

| Type             | Count | Details                                        |
| ---------------- | ----- | ---------------------------------------------- |
| Configuration    | 1     | midgard.json (biome definition + zones)        |
| Zone Definitions | 4     | Greatwood, Sun Fields, Iron Marches, Veil Edge |
| Faction Pools    | 4     | One per zone                                   |
| Unit Tests       | ~18   |                                                |

### Data Model Changes

```
NEW: Midgard BiomeDefinition (Configuration)
├── Id: Midgard (RealmId.Midgard)
├── Name: "Midgard"
├── Subtitle: "The Tamed Ruin"
├── DeckNumber: 4
├── PreGlitchFunction: "Civilian Habitation & Agricultural Production"
├── PostGlitchState: "Agricultural heartland; most populous realm"
├── BaseProperties:
│   ├── TemperatureCelsius: 18
│   ├── AethericIntensity: 0.3
│   ├── HumidityPercent: 60
│   ├── LightLevel: 0.7
│   ├── ScaleFactor: 1.0
│   └── CorrosionRate: 0.2
├── PrimaryCondition: None
├── MinVerticalZone: GroundLevel (0)
├── MaxVerticalZone: LowerTrunk (+1)
├── FlavorQuote: "The Wall is the soul of the Hold."
└── ColorPalette: "green-brown-grey-amber"

NEW: The Greatwood Zone
├── Id: "greatwood"
├── Name: "The Greatwood"
├── ParentRealm: Midgard
├── OverrideProperties:
│   ├── LightLevel: 0.4 (canopy coverage)
│   └── HumidityPercent: 75
├── OverrideCondition: MutagenicSpores (light)
├── ConditionDcModifier: -4 (DC 8)
├── FactionPools: ["fenris-brood", "rustkin"]
└── Description: "Ancient forest, bio-engineered remnants from Vanaheim"

NEW: Sun Fields Zone
├── Id: "sun-fields"
├── Name: "The Sun Fields"
├── ParentRealm: Midgard
├── OverrideProperties: null (uses base)
├── OverrideCondition: None
├── ConditionDcModifier: 0
├── FactionPools: ["einherjar", "clockwork-remnants"]
└── Description: "Agricultural heartland, golden wheat, scattered ruins"

NEW: Iron Marches Zone
├── Id: "iron-marches"
├── Name: "The Iron Marches"
├── ParentRealm: Midgard
├── OverrideProperties:
│   ├── CorrosionRate: 0.4
│   └── HumidityPercent: 45
├── OverrideCondition: None
├── ConditionDcModifier: 0
├── FactionPools: ["clockwork-remnants", "rustkin"]
└── Description: "Industrial ruins, rusted machinery, scavenger territory"

NEW: The Veil Edge Zone
├── Id: "veil-edge"
├── Name: "The Veil Edge"
├── ParentRealm: Midgard
├── OverrideProperties:
│   ├── AethericIntensity: 0.5
│   └── LightLevel: 0.5
├── OverrideCondition: RealityFlux (light)
├── ConditionDcModifier: -2 (DC 10)
├── FactionPools: ["fenris-brood"]
└── Description: "Border zone approaching Alfheim, reality distortions begin"
```

### User-Facing Changes

**Commands:**

```
N/A — Configuration version; no new player commands
```

**Output Example:**

```
N/A — No direct player-facing output in this version
```

### Acceptance Criteria

- [ ] Midgard BiomeDefinition loads with all required properties
- [ ] All four zones (Greatwood, Sun Fields, Iron Marches, Veil Edge) defined
- [ ] Zone property overrides correctly merge with base properties
- [ ] Faction spawn pools assigned to each zone
- [ ] Environmental conditions return correct DC for each zone
- [ ] Greatwood MutagenicSpores DC = 8 (base 12 - 4 modifier)
- [ ] Veil Edge RealityFlux DC = 10 (base 12 - 2 modifier)
- [ ] Sun Fields and Iron Marches have no environmental hazard
- [ ] IBiomeProvider.GetBiome(RealmId.Midgard) returns valid definition
- [ ] IBiomeProvider.GetZonesForRealm(RealmId.Midgard) returns 4 zones
- [ ] JSON configuration validates against biomes.schema.json
- [ ] ~18 unit tests pass

---

## Dependencies & Prerequisites

```
v0.19.0 (Core Biome Infrastructure) - REQUIRED
    │
    ├── RealmId.Midgard enum value
    ├── BiomeDefinition entity
    ├── BiomeZone entity
    ├── BiomeProperties value object
    ├── EnvironmentalConditionType enum
    ├── IBiomeProvider interface
    └── biomes.schema.json
            │
            ▼
v0.19.1 (Midgard Implementation)
    │
    └── v0.19.1a: Midgard Complete ─────────────────────────────┐
            Dependencies: IBiomeProvider, FactionService (existing)│
                                                                   │
                                                                   ▼
v0.19.2-v0.19.6 (Other Realms)
    │
    └── Reference Midgard as baseline for balance comparisons
```

---

## Estimated Effort Summary

| Phase     | New Files | Modified Files | Est. Tests | Complexity |
| --------- | --------- | -------------- | ---------- | ---------- |
| v0.19.1a  | 1         | 1              | ~18        | Medium     |
| **Total** | **1**     | **1**          | **~18**    |            |

---

## Risk Assessment

| Risk                           | Impact | Probability | Mitigation                                        |
| ------------------------------ | ------ | ----------- | ------------------------------------------------- |
| Faction integration complexity | Medium | Low         | Use existing faction system interfaces            |
| Zone balance issues            | Low    | Medium      | Midgard is baseline; adjust other realms to match |
| Schema validation failures     | Low    | Low         | Thorough test coverage                            |

---

## Design Decisions (Confirmed)

### Midgard Properties

| Decision              | Value      | Notes                            |
| --------------------- | ---------- | -------------------------------- |
| **Base temperature**  | 18°C       | Temperate climate baseline       |
| **Light level**       | 0.7        | Well-lit but not harsh           |
| **Scale factor**      | 1.0        | Human-scale baseline             |
| **Primary condition** | None       | Safe starting area               |
| **Vertical range**    | Z: 0 to +1 | Ground level to lower structures |

### Zone Design

| Decision                    | Value                  | Notes                                |
| --------------------------- | ---------------------- | ------------------------------------ |
| **Greatwood hazard**        | MutagenicSpores (DC 8) | Vanaheim influence, but mild         |
| **Veil Edge hazard**        | RealityFlux (DC 10)    | Alfheim border effects               |
| **Sun Fields/Iron Marches** | No hazard              | Safe agricultural/industrial areas   |
| **Faction distribution**    | Per-zone pools         | Different threats in different areas |

### Lore Integration

| Decision              | Value                               | Notes                          |
| --------------------- | ----------------------------------- | ------------------------------ |
| **Flavor quote**      | "The Wall is the soul of the Hold." | Cultural significance          |
| **Color palette**     | green-brown-grey-amber              | Natural, earthy tones          |
| **Zone descriptions** | Thematic, evocative                 | Support flavor text generation |

---

## Next Steps

1. **Review & Approve** - Confirm Midgard specifications with stakeholders
2. **v0.19.1a Design Spec** - Create detailed design specification
3. **Implement v0.19.1a** - Build Midgard configuration and tests
4. **Proceed to v0.19.2** - Implement Svartalfheim & Helheim

---

## Realm Lore Summary

### Midgard — Deck 04: The Tamed Ruin

**Pre-Glitch Function:** Civilian Habitation & Agricultural Production

**Post-Glitch State:** Agricultural heartland; most populous realm; foundation of post-Glitch civilization. The great Holds represent humanity's best chance at organized survival.

**Environmental Baseline:**

- Temperature: 18°C (temperate)
- Aetheric Intensity: 0.3 (low, stable)
- Humidity: 60%
- Light Level: 0.7 (daylight cycle preserved)
- Scale Factor: 1.0 (human-scale)
- Corrosion Rate: 0.2 (low decay)

**Key Locations:**

1. **The Greatwood** — Ancient forest with Vanaheim spillover
2. **The Sun Fields** — Agricultural heartland, golden wheat
3. **The Iron Marches** — Industrial ruins, scavenger territory
4. **The Veil Edge** — Border zone with Alfheim, reality distortions

**Dominant Factions:**

- Einherjar (The Chosen Dead)
- Fenris Brood (Corrupted Wolves)
- Rustkin (Scavenger Clans)
- Clockwork Remnants (Malfunctioning Automatons)

**Thematic Notes:**

- Starting area — relatively safe, well-understood
- Agricultural abundance creates political power
- The Wall defines Hold identity and survival
- Gateway to other realms via trade routes

---

## Configuration Schema

### midgard.json

```json
{
    "biome": {
        "id": "Midgard",
        "name": "Midgard",
        "subtitle": "The Tamed Ruin",
        "deckNumber": 4,
        "preGlitchFunction": "Civilian Habitation & Agricultural Production",
        "postGlitchState": "Agricultural heartland; most populous realm; foundation of post-Glitch civilization",
        "baseProperties": {
            "temperatureCelsius": 18,
            "aethericIntensity": 0.3,
            "humidityPercent": 60,
            "lightLevel": 0.7,
            "scaleFactor": 1.0,
            "corrosionRate": 0.2
        },
        "primaryCondition": "None",
        "minVerticalZone": 0,
        "maxVerticalZone": 1,
        "flavorQuote": "The Wall is the soul of the Hold.",
        "colorPalette": "green-brown-grey-amber",
        "zones": [
            {
                "id": "greatwood",
                "name": "The Greatwood",
                "description": "Ancient forest with bio-engineered remnants from Vanaheim. Canopy coverage reduces light, humidity increases. Light mutagenic spore presence.",
                "overrideProperties": {
                    "lightLevel": 0.4,
                    "humidityPercent": 75
                },
                "overrideCondition": "MutagenicSpores",
                "conditionDcModifier": -4,
                "factionPools": ["fenris-brood", "rustkin"],
                "minVerticalZone": 0,
                "maxVerticalZone": 1
            },
            {
                "id": "sun-fields",
                "name": "The Sun Fields",
                "description": "Agricultural heartland of the realm. Golden wheat fields stretch between scattered ruins. Relatively safe, well-patrolled by Hold militias.",
                "overrideProperties": null,
                "overrideCondition": null,
                "conditionDcModifier": 0,
                "factionPools": ["einherjar", "clockwork-remnants"],
                "minVerticalZone": 0,
                "maxVerticalZone": 0
            },
            {
                "id": "iron-marches",
                "name": "The Iron Marches",
                "description": "Industrial ruins from the pre-Glitch era. Rusted machinery, collapsed factories, and scavenger camps. Higher corrosion rate damages equipment.",
                "overrideProperties": {
                    "corrosionRate": 0.4,
                    "humidityPercent": 45
                },
                "overrideCondition": null,
                "conditionDcModifier": 0,
                "factionPools": ["clockwork-remnants", "rustkin"],
                "minVerticalZone": 0,
                "maxVerticalZone": 1
            },
            {
                "id": "veil-edge",
                "name": "The Veil Edge",
                "description": "Border zone approaching Alfheim. Reality begins to warp, colors shift, and the air tastes of ozone. Light reality distortions affect navigation.",
                "overrideProperties": {
                    "aethericIntensity": 0.5,
                    "lightLevel": 0.5
                },
                "overrideCondition": "RealityFlux",
                "conditionDcModifier": -2,
                "factionPools": ["fenris-brood"],
                "minVerticalZone": 0,
                "maxVerticalZone": 1
            }
        ]
    },
    "factionSpawnPools": {
        "einherjar": {
            "factionId": "einherjar",
            "displayName": "Einherjar",
            "baseSpawnWeight": 30,
            "levelRange": { "min": 1, "max": 5 },
            "monsterIds": [
                "einherjar-warrior",
                "einherjar-scout",
                "einherjar-captain"
            ]
        },
        "fenris-brood": {
            "factionId": "fenris-brood",
            "displayName": "Fenris Brood",
            "baseSpawnWeight": 25,
            "levelRange": { "min": 2, "max": 6 },
            "monsterIds": ["fenris-whelp", "fenris-hunter", "fenris-alpha"]
        },
        "rustkin": {
            "factionId": "rustkin",
            "displayName": "Rustkin",
            "baseSpawnWeight": 25,
            "levelRange": { "min": 1, "max": 4 },
            "monsterIds": [
                "rustkin-scavenger",
                "rustkin-tinker",
                "rustkin-chieftain"
            ]
        },
        "clockwork-remnants": {
            "factionId": "clockwork-remnants",
            "displayName": "Clockwork Remnants",
            "baseSpawnWeight": 20,
            "levelRange": { "min": 3, "max": 7 },
            "monsterIds": [
                "clockwork-drone",
                "clockwork-sentinel",
                "clockwork-overseer"
            ]
        }
    }
}
```

---

## Unit Testing Requirements

### Midgard BiomeDefinition Tests (~6 tests)

| Test                                        | Description                   |
| ------------------------------------------- | ----------------------------- |
| `GetBiome_Midgard_ReturnsValidDefinition`   | BiomeProvider returns Midgard |
| `GetBiome_Midgard_HasCorrectBaseProperties` | Temp=18, Light=0.7, Scale=1.0 |
| `GetBiome_Midgard_HasNoPrimaryCondition`    | PrimaryCondition == None      |
| `GetBiome_Midgard_HasCorrectVerticalRange`  | Z: 0 to +1                    |
| `GetBiome_Midgard_HasFlavorQuote`           | Quote is not null             |
| `GetBiome_Midgard_HasColorPalette`          | Palette is set                |

### Midgard Zone Tests (~8 tests)

| Test                                        | Description               |
| ------------------------------------------- | ------------------------- |
| `GetZonesForRealm_Midgard_ReturnsFourZones` | Returns 4 zones           |
| `GetZone_Greatwood_HasLightOverride`        | LightLevel = 0.4          |
| `GetZone_Greatwood_HasSporeCondition`       | MutagenicSpores with DC 8 |
| `GetZone_SunFields_HasNoOverrides`          | Uses base properties      |
| `GetZone_IronMarches_HasCorrosionOverride`  | CorrosionRate = 0.4       |
| `GetZone_VeilEdge_HasAethericOverride`      | AethericIntensity = 0.5   |
| `GetZone_VeilEdge_HasRealityFlux`           | RealityFlux with DC 10    |
| `GetZone_InvalidZone_ReturnsNull`           | Unknown zone returns null |

### Faction Pool Tests (~4 tests)

| Test                                                 | Description       |
| ---------------------------------------------------- | ----------------- |
| `GetFactionPool_Greatwood_ReturnsFenrisRustkin`      | Correct factions  |
| `GetFactionPool_SunFields_ReturnsEinherjarClockwork` | Correct factions  |
| `GetFactionPool_IronMarches_ReturnsClockworkRustkin` | Correct factions  |
| `GetFactionPool_VeilEdge_ReturnsFenris`              | Only Fenris Brood |

**Total: ~18 tests**

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    v0.19.1 Midgard Implementation               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Configuration                         │   │
│  │                                                          │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │                 midgard.json                     │   │   │
│  │  │  ┌───────────────────────────────────────────┐ │   │   │
│  │  │  │           Midgard Definition              │ │   │   │
│  │  │  │  • Deck 04                                │ │   │   │
│  │  │  │  • Temp: 18°C, Light: 0.7                 │ │   │   │
│  │  │  │  • Primary Condition: None                │ │   │   │
│  │  │  └───────────────────────────────────────────┘ │   │   │
│  │  │                                                 │   │   │
│  │  │  ┌────────────┐  ┌────────────┐              │   │   │
│  │  │  │ Greatwood  │  │ Sun Fields │              │   │   │
│  │  │  │ Light: 0.4 │  │ (base)     │              │   │   │
│  │  │  │ DC 8 Spore │  │ No hazard  │              │   │   │
│  │  │  └────────────┘  └────────────┘              │   │   │
│  │  │                                                 │   │   │
│  │  │  ┌────────────┐  ┌────────────┐              │   │   │
│  │  │  │Iron Marches│  │ Veil Edge  │              │   │   │
│  │  │  │ Corr: 0.4  │  │ Aether:0.5 │              │   │   │
│  │  │  │ No hazard  │  │ DC 10 Flux │              │   │   │
│  │  │  └────────────┘  └────────────┘              │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                          │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │              Faction Spawn Pools                 │   │   │
│  │  │  • Einherjar (30%) - Sun Fields                  │   │   │
│  │  │  • Fenris Brood (25%) - Greatwood, Veil Edge    │   │   │
│  │  │  • Rustkin (25%) - Greatwood, Iron Marches      │   │   │
│  │  │  • Clockwork Remnants (20%) - Sun Fields, Iron  │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 Application Layer                        │   │
│  │  ┌──────────────┐  ┌──────────────┐                     │   │
│  │  │   IBiome     │  │ IEnvironment │                     │   │
│  │  │  Provider    │  │  Condition   │                     │   │
│  │  │  (v0.19.0)   │  │   Service    │                     │   │
│  │  └──────────────┘  └──────────────┘                     │   │
│  │         │                  │                             │   │
│  │         └────────┬─────────┘                             │   │
│  │                  ▼                                        │   │
│  │  ┌──────────────────────────────┐                        │   │
│  │  │   Loads midgard.json into    │                        │   │
│  │  │   BiomeDefinition + Zones    │                        │   │
│  │  └──────────────────────────────┘                        │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Deliverable Checklist

### Configuration

- [ ] `midgard.json` complete with all zones
- [ ] Midgard BiomeDefinition with correct properties
- [ ] The Greatwood zone with MutagenicSpores (DC 8)
- [ ] Sun Fields zone with no environmental hazard
- [ ] Iron Marches zone with increased corrosion
- [ ] The Veil Edge zone with RealityFlux (DC 10)
- [ ] Faction spawn pools for all zones
- [ ] JSON validates against biomes.schema.json

### Tests

- [ ] BiomeDefinition tests (~6)
- [ ] Zone tests (~8)
- [ ] Faction pool tests (~4)

---

_This scope breakdown provides a structured approach to implementing v0.19.1 Midgard. This realm serves as the baseline starting area and reference point for all subsequent realm implementations._
