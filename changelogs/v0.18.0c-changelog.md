# Changelog: v0.18.0c - IStressService Interface

**Release Date:** 2026-01-31
**Phase:** Psychic Stress System (3/6)
**Status:** Complete

---

## Overview

Defines the `IStressService` interface — the application layer contract for all Psychic Stress management operations. This is the third phase of v0.18.0 (Psychic Stress System), establishing the **Application Layer Contract** that will be implemented in v0.18.0d.

The interface exposes 9 methods across three categories: 4 query methods for reading stress state and derived penalties without side effects, 4 command methods for applying stress (with optional WILL-based resistance), recovering stress (via rest or arbitrary sources), and resetting stress after Trauma Check resolution, and 1 internal method for performing resistance checks independently. By defining the interface before the implementation, dependent systems (CombatService, SkillCheckService, RestService, TraumaService, UI Layer) can develop against mock implementations in parallel.

A supporting `CharacterNotFoundException` exception class was also created to satisfy XML documentation `<exception cref>` references and provide a clean exception type for all character-lookup failures across the application layer.

---

## Added

### Application Layer — Interfaces

- **`IStressService`** (`Application/Interfaces/IStressService.cs`)
    - 9-method interface organized into three `#region` blocks: Query, Command, Internal
    - **Query Methods** (read-only, no side effects):
        - `GetStressState(Guid characterId)` → `StressState` snapshot
        - `GetDefensePenalty(Guid characterId)` → `int` (0-5, convenience for combat)
        - `HasSkillDisadvantage(Guid characterId)` → `bool` (true at 80+ stress)
        - `RequiresTraumaCheck(Guid characterId)` → `bool` (true at 100 stress)
    - **Command Methods** (modify character stress state):
        - `ApplyStress(Guid characterId, int amount, StressSource source, int resistDc = 0)` → `StressApplicationResult`
        - `RecoverStress(Guid characterId, RestType restType)` → `StressRecoveryResult`
        - `RecoverStress(Guid characterId, int amount, string source)` → `StressRecoveryResult`
        - `ResetAfterTraumaCheck(Guid characterId, bool passed)` → `void`
    - **Internal Methods** (exposed for testing):
        - `PerformResistanceCheck(Guid characterId, int baseStress, int dc)` → `StressCheckResult`
    - Comprehensive XML documentation on interface and all methods including `<summary>`, `<param>`, `<returns>`, `<exception>`, `<remarks>`, `<example>`, `<seealso>`
    - Interface-level documentation includes stress threshold table, death spiral description, consumer listing, and usage examples
    - Box comment header with version 0.18.0c, file-scoped namespace

### Application Layer — Exceptions

- **`CharacterNotFoundException`** (`Application/Exceptions/CharacterNotFoundException.cs`)
    - Custom exception for character-lookup failures across the application layer
    - `CharacterId` property storing the GUID that was not found
    - Four constructors: message-only, message+innerException, characterId-only (auto-generates message), characterId+message
    - Comprehensive XML documentation with `<remarks>`, `<list>`, `<example>`, `<seealso>`
    - Box comment header with version 0.18.0c, file-scoped namespace

### Glossary

- **`config/glossary.json`** — Added 1 glossary entry (sortOrder 82)
    - `stress-service`: Application layer interface defining the contract for stress queries, application, recovery, and trauma reset

---

## Design Decisions

### CharacterNotFoundException Creation

The design specification's XML documentation references `CharacterNotFoundException` via `<exception cref>` on all 9 methods. This type did not exist in the codebase — the existing exception types in `Application/Exceptions/` are all configuration-related (`ArchetypeConfigurationException`, `AttributeConfigurationException`, etc.). Creating `CharacterNotFoundException` avoids CS1574 cref warnings and provides a reusable exception type for v0.18.0d and all future character-targeting services.

The exception includes a `CharacterId` property and a constructor that auto-generates the error message from the GUID, which goes beyond the minimal two-constructor pattern of existing exceptions. This provides better diagnostic information when character lookups fail.

### Region Usage in Interface

The design specification's acceptance criteria explicitly requires "Methods organized into logical regions (Query, Command, Internal)." Existing interfaces in the codebase do not use `#region` blocks, relying instead on comment separators. The design specification was followed as authoritative for this interface, since the three method categories have distinct semantics (read-only queries, state-changing commands, implementation-detail internals) that benefit from explicit grouping.

### Using Directive for Exception

The `IStressService` interface file includes `using RuneAndRust.Application.Exceptions;` to resolve the `CharacterNotFoundException` cref in XML documentation. This is the only non-Domain using directive and is necessary for warning-free compilation.

---

## Dependencies

### Prerequisites

| Type | Phase | Usage |
| --- | --- | --- |
| `StressState` | v0.18.0a | Return type for `GetStressState` |
| `StressThreshold` | v0.18.0a | Referenced in XML documentation |
| `StressSource` | v0.18.0a | Parameter for `ApplyStress` |
| `RestType` | v0.18.0a | Parameter for `RecoverStress` |
| `StressCheckResult` | v0.18.0b | Return type for `PerformResistanceCheck` |
| `StressApplicationResult` | v0.18.0b | Return type for `ApplyStress` |
| `StressRecoveryResult` | v0.18.0b | Return type for `RecoverStress` |

### Provides to Future Phases

| Type | Phase | Usage |
| --- | --- | --- |
| `IStressService` | v0.18.0d | Interface for `StressService` implementation |
| `IStressService` | v0.18.0d+ | Mock target for dependent service tests |
| `CharacterNotFoundException` | v0.18.0d | Thrown by `StressService` on character-lookup failure |
| `CharacterNotFoundException` | Future | Reusable across all character-targeting services |

---

## Logging Strategy

No runtime logging in v0.18.0c — this is an interface-only deliverable with no executable code. The design specification documents recommended log event templates in section 8 for use by the v0.18.0d `StressService` implementation:

| Event | Level | Template |
| --- | --- | --- |
| Stress Queried | Debug | `"Stress state queried for {CharacterId}: {CurrentStress}/{MaxStress}"` |
| Stress Applied | Information | `"Stress applied to {CharacterId}: +{StressGained} [{Source}] ({PreviousStress} → {NewStress})"` |
| Resistance Check | Debug | `"Resistance check: {Successes} successes, {ReductionPercent:P0} reduction"` |
| Threshold Crossed | Information | `"Stress threshold crossed for {CharacterId}: {PreviousThreshold} → {NewThreshold}"` |
| Trauma Triggered | Warning | `"TRAUMA CHECK TRIGGERED for {CharacterId}: Stress at {NewStress}"` |
| Stress Recovered | Information | `"Stress recovered for {CharacterId}: -{AmountRecovered} [{RecoverySource}]"` |
| Trauma Reset | Information | `"Stress reset after Trauma Check for {CharacterId}: {Passed} → {NewStress}"` |

---

## Files Created

| Path | Description |
|------|-------------|
| `src/Core/RuneAndRust.Application/Interfaces/IStressService.cs` | Stress service interface (9 methods) |
| `src/Core/RuneAndRust.Application/Exceptions/CharacterNotFoundException.cs` | Character not found exception |
| `changelogs/v0.18.0c-changelog.md` | This changelog |

## Files Modified

| Path | Description |
|------|-------------|
| `config/glossary.json` | Added 1 glossary entry (sortOrder 82) |
| `docs/design/v0.18.x/v0.18.0-scope-breakdown.md` | Checked off v0.18.0c acceptance criteria |
| `docs/design/v0.18.x/v0.18.0c-design-specification.md` | Checked off deliverable and acceptance criteria |

---

## Notes

- No unit tests for v0.18.0c — interface-only deliverable per design specification (~0 estimated tests)
- Build succeeds with 0 errors, 0 warnings
- All existing tests unaffected (0 regressions); pre-existing glossary schema validation failure at term #88 remains (unrelated to v0.18.0c changes)
- All new files follow established codebase patterns: `═══════` box comment headers, file-scoped namespaces, comprehensive XML documentation with `<summary>`, `<remarks>`, `<para>`, `<list>`, `<example>`, `<seealso>`, `<exception>` tags
- The `CharacterNotFoundException` extends the existing exception pattern with a `CharacterId` property and additional constructors for convenience
- Mock usage examples are documented in design specification section 9.2 for v0.18.0d consumer development
