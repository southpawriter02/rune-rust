# v0.6.2 Combat Display - Scope Breakdown

**Version:** 0.6.2
**Theme:** Combat Display
**Prerequisites:** v0.6.1d Complete (Visual Components - Inventory Grid)
**Total Estimated Tests:** ~30 new tests

---

## Executive Summary

The Combat Display sub-version enhances the combat experience with an improved grid view integrated into the screen layout system, and text-based combat animations for visual feedback. The combat grid view displays combatants, their health, and turn information in a dedicated panel. Animations provide satisfying visual feedback for attacks, abilities, and deaths.

Key focus areas:
- **Combat Grid View**: Enhanced tactical grid with combatant list and turn tracking
- **Combat Animations**: Text-based animations for hits, misses, abilities, and deaths

The work is divided into **two sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.6.2a | Combat Grid View | Integrated grid panel, combatant list, turn info | ~15 |
| v0.6.2b | Combat Animations | Hit/miss animations, ability effects, death animations | ~15 |

---

## Existing Infrastructure

### Already Implemented (from v0.6.1-v0.6.2)

| Feature | Location | Notes |
|---------|----------|-------|
| ScreenLayout | `Presentation/UI/ScreenLayout.cs` | Panel management |
| Panel | `Presentation/UI/Panel.cs` | Panel value object |
| IColorThemeService | `Application/Interfaces/IColorThemeService.cs` | Color management |
| HealthBar | `Presentation/UI/HealthBar.cs` | HP visualization |
| ITerminalService | `Application/Interfaces/ITerminalService.cs` | Terminal operations |

### Already Implemented (from v0.5.x)

| Feature | Location | Notes |
|---------|----------|-------|
| CombatGrid | `Domain/Entities/CombatGrid.cs` | Grid state |
| GridRenderer | `Presentation/Adapters/GridRenderer.cs` | Basic grid rendering |
| CombatService | `Application/Services/CombatService.cs` | Combat processing |
| Combatant | `Domain/Entities/Combatant.cs` | Entity in combat |
| CombatState | `Domain/Entities/CombatState.cs` | Turn tracking |

### Needs Implementation (v0.6.2)

| Feature | Part | Notes |
|---------|------|-------|
| CombatGridView | v0.6.2a | Enhanced panel-based grid |
| CombatantListPanel | v0.6.2a | Combatant HP display |
| TurnInfoBar | v0.6.2a | Turn/action tracking |
| ICombatAnimator | v0.6.2b | Animation interface |
| CombatAnimator | v0.6.2b | Animation playback |
| AnimationDefinition | v0.6.2b | Animation templates |

---

## Feature Analysis & Categorization

### Combat Grid View Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Grid panel integration | Medium | ScreenLayout | **v0.6.2a** |
| Combatant list display | Medium | HealthBar | **v0.6.2a** |
| Turn information bar | Low | CombatState | **v0.6.2a** |
| Grid legend | Low | Grid panel | **v0.6.2a** |

### Combat Animation Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Animation framework | High | ITerminalService | **v0.6.2b** |
| Attack hit/miss animations | Medium | Animation framework | **v0.6.2b** |
| Ability effect animations | Medium | Animation framework | **v0.6.2b** |
| Death animations | Low | Animation framework | **v0.6.2b** |
| Damage number display | Low | Animation framework | **v0.6.2b** |

---

## Part Definitions

---

## v0.6.2a: Combat Grid View

[v0.6.2a Design Specification](v0.6.2a-design-specification.md)

### Overview

Implement an enhanced combat grid view that integrates with the screen layout system. The view consists of a main grid panel showing the tactical map, a side panel listing all combatants with their health bars, and a footer showing turn information and available actions.

### Scope

**In Scope:**
- `CombatGridView` component class
- Grid panel with cell rendering
- Coordinate labels (A-H, 1-8)
- Terrain type indicators
- Entity position markers
- Threat range highlighting
- `CombatantListPanel` component
- Combatant HP bars
- Status effect icons
- Turn order indicator
- `TurnInfoBar` component
- Current turn display
- Action/move points
- Combat grid legend

**Out of Scope:**
- Combat animations (v0.6.2b)
- Clickable grid (v0.7.0 GUI)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Presentation Classes | 3 | `CombatGridView`, `CombatantListPanel`, `TurnInfoBar` |
| Panel Configurations | 3 | Grid panel, combatant panel, turn bar |
| Integration Updates | 1 | CombatService display hooks |
| Unit Tests | ~15 | Grid rendering, panel tests |

### Combat Grid View Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   COMBAT GRID VIEW ARCHITECTURE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    CombatGridView                           â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ + Render(combatState): void                                â”‚
    â”‚ + HighlightCells(cells, type): void                        â”‚
    â”‚ + ClearHighlights(): void                                  â”‚
    â”‚ + SetSelectedCell(position): void                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Grid Panel     â”‚ â”‚ CombatantList    â”‚ â”‚   TurnInfoBar    â”‚
â”‚   (Main area)    â”‚ â”‚   (Sidebar)      â”‚ â”‚   (Footer)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ RenderGrid()     â”‚ â”‚ RenderList()     â”‚ â”‚ RenderInfo()     â”‚
â”‚ RenderEntities() â”‚ â”‚ RenderHealth()   â”‚ â”‚ RenderActions()  â”‚
â”‚ RenderTerrain()  â”‚ â”‚ RenderStatus()   â”‚ â”‚ RenderMove()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CombatGridView Component

```csharp
namespace RuneAndRust.Presentation.UI;

/// <summary>
/// Renders the enhanced combat grid view.
/// </summary>
public class CombatGridView
{
    private readonly ScreenLayout _layout;
    private readonly IColorThemeService _colorService;
    private readonly CombatantListPanel _combatantList;
    private readonly TurnInfoBar _turnInfo;
    private readonly ILogger<CombatGridView> _logger;
    
    public CombatGridView(
        ScreenLayout layout,
        IColorThemeService colorService,
        CombatantListPanel combatantList,
        TurnInfoBar turnInfo,
        ILogger<CombatGridView> logger)
    {
        _layout = layout;
        _colorService = colorService;
        _combatantList = combatantList;
        _turnInfo = turnInfo;
        _logger = logger;
    }
    
    /// <summary>Renders the complete combat view.</summary>
    public void Render(CombatState state);
    
    /// <summary>Highlights cells for movement, attack, or ability range.</summary>
    public void HighlightCells(IEnumerable<GridPosition> cells, HighlightType type);
    
    /// <summary>Clears all cell highlighting.</summary>
    public void ClearHighlights();
    
    /// <summary>Sets the currently selected cell.</summary>
    public void SetSelectedCell(GridPosition? position);
    
    /// <summary>Refreshes just the entity positions.</summary>
    public void RefreshEntities(CombatState state);
}

public enum HighlightType
{
    Movement,      // Blue - valid move targets
    Attack,        // Red - valid attack targets
    Ability,       // Purple - ability range
    Threatened,    // Orange - threatened squares
    Selected       // Yellow - current selection
}
```

### Combat Grid View Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              COMBAT GRID VIEW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              COMBAT GRID               â”‚           COMBATANTS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚                                       â”‚
â”‚      A   B   C   D   E   F   G   H     â”‚  â–º @ Hero        Lv5 Warrior         â”‚
â”‚    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”   â”‚    HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  80/100       â”‚
â”‚  1 â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚   â”‚    MP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  30/50        â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚    [Defensive Stance]                â”‚
â”‚  2 â”‚ . â”‚ . â”‚ M â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚   â”‚                                       â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚    M Skeleton     HP â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  15/30 â”‚
â”‚  3 â”‚ . â”‚ . â”‚ . â”‚ . â”‚ @ â”‚ . â”‚ . â”‚ . â”‚   â”‚      [Poisoned] ğŸŸ¢                    â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚                                       â”‚
â”‚  4 â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚   â”‚    M Goblin       HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  20/20 â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚                                       â”‚
â”‚  5 â”‚ . â”‚ ~ â”‚ ~ â”‚ ~ â”‚ . â”‚ M â”‚ . â”‚ . â”‚   â”‚    M Goblin       HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  15/20 â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚                                       â”‚
â”‚  6 â”‚ . â”‚ . â”‚ ~ â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚   â”‚                                       â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚                                       â”‚
â”‚  7 â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚   â”‚                                       â”‚
â”‚    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤   â”‚                                       â”‚
â”‚  8 â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚ . â”‚   â”‚                                       â”‚
â”‚    â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜   â”‚                                       â”‚
â”‚                                        â”‚  â–º = Current Turn                     â”‚
â”‚  Legend: @ = You  M = Monster          â”‚  ğŸŸ¢ = Status Effect                   â”‚
â”‚          . = Open  ~ = Water           â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Round 3  |  YOUR TURN  |  Action: âœ“ Available  |  Move: 4/4  |  Bonus: âœ“     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cell Highlighting

```
MOVEMENT HIGHLIGHTING (Blue):
    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
    â”‚   â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚   â”‚     â–‘ = Valid move
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     @ = Player
    â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚     M = Monster
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚ @ â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚ M â”‚     (Cannot move through M)
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚   â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚â–‘â–‘â–‘â”‚   â”‚
    â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜


ATTACK RANGE HIGHLIGHTING (Red):
    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
    â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     â–“ = Attack range
    â”‚   â”‚â–“â–“â–“â”‚â–“â–“â–“â”‚â–“â–“â–“â”‚   â”‚     @ = Player
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚   â”‚â–“â–“â–“â”‚ @ â”‚â–“â–“â–“â”‚   â”‚     Melee: Adjacent cells
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚   â”‚â–“â–“â–“â”‚â–“â–“â–“â”‚â–“â–“â–“â”‚   â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
    â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜


ABILITY AREA PREVIEW (Purple):
    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
    â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     â—Š = AoE effect area
    â”‚   â”‚   â”‚â—Šâ—Šâ—Šâ”‚   â”‚   â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤     Fireball: 3x3 area
    â”‚   â”‚â—Šâ—Šâ—Šâ”‚â—Šâ—Šâ—Šâ”‚â—Šâ—Šâ—Šâ”‚   â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚   â”‚   â”‚â—Šâ—Šâ—Šâ”‚   â”‚   â”‚
    â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
    â”‚   â”‚   â”‚   â”‚   â”‚   â”‚
    â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
```

### Acceptance Criteria

- [ ] Combat grid renders in main panel
- [ ] Coordinate labels display (A-H, 1-8)
- [ ] Entity markers show (@, M)
- [ ] Terrain types display correctly
- [ ] Combatant list shows all combatants
- [ ] HP bars display for each combatant
- [ ] Status effects show as icons
- [ ] Current turn indicator (â–º)
- [ ] Turn info bar shows round, actions, move
- [ ] Cell highlighting works for movement
- [ ] Cell highlighting works for attacks
- [ ] Grid legend displays
- [ ] ~15 unit tests pass

---

## v0.6.2b: Combat Animations

[v0.6.2b Design Specification](v0.6.2b-design-specification.md)

### Overview

Implement text-based combat animations that provide visual feedback for combat actions. Animations are frame-based with configurable timing, supporting hit effects, miss effects, ability casting, damage numbers, and death sequences.

### Scope

**In Scope:**
- `ICombatAnimator` interface
- `CombatAnimator` implementation
- `AnimationDefinition` for templates
- Frame-based animation system
- Attack hit animations
- Attack miss animations
- Ability effect animations
- Damage number display
- Healing animations
- Death animations
- Status effect application animations
- Animation queue for sequential playback
- Animation timing configuration
- Animation skip option

**Out of Scope:**
- Sound effects (v0.9.0)
- Particle effects (TUI limitation)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Application Interfaces | 1 | `ICombatAnimator` |
| Presentation Classes | 1 | `CombatAnimator` |
| Domain Value Objects | 1 | `AnimationDefinition` |
| Animation Types | 6 | Hit, miss, ability, heal, death, status |
| Configuration | 1 | `animations.json` |
| Unit Tests | ~15 | Animation playback, timing tests |

### Combat Animator Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMBAT ANIMATOR ARCHITECTURE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Combat Event                   Animation System
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    [AttackHit] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    [AttackMiss] â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â–¶â”‚     CombatAnimator      â”‚
                         â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    [AbilityUsed] â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚ + QueueAnimation()      â”‚
                         â”‚    â”‚ + PlayNext()            â”‚
    [EntityDied] â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ + SkipCurrent()         â”‚
                              â”‚ + ClearQueue()          â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                     â–¼                     â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ AnimationDef  â”‚    â”‚   Timer       â”‚    â”‚   Renderer    â”‚
           â”‚ (from config) â”‚    â”‚   (Timing)    â”‚    â”‚   (Display)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ICombatAnimator Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Handles combat animation playback.
/// </summary>
public interface ICombatAnimator
{
    /// <summary>Queues an animation for playback.</summary>
    void QueueAnimation(AnimationType type, AnimationContext context);
    
    /// <summary>Plays all queued animations.</summary>
    Task PlayQueuedAnimationsAsync(CancellationToken ct = default);
    
    /// <summary>Skips the current animation.</summary>
    void SkipCurrent();
    
    /// <summary>Clears all queued animations.</summary>
    void ClearQueue();
    
    /// <summary>Gets whether animations are enabled.</summary>
    bool AnimationsEnabled { get; set; }
    
    /// <summary>Gets or sets animation speed multiplier.</summary>
    float SpeedMultiplier { get; set; }
}

public enum AnimationType
{
    AttackHit,
    AttackMiss,
    CriticalHit,
    AbilityCast,
    AbilityEffect,
    Heal,
    DamageNumber,
    Death,
    StatusApplied,
    StatusRemoved
}

public record AnimationContext(
    string ActorName,
    string? TargetName,
    int? Value,
    string? AbilityName,
    string? DamageType,
    string? StatusName
);
```

### Animation Definitions

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines an animation sequence.
/// </summary>
public record AnimationDefinition(
    AnimationType Type,
    IReadOnlyList<AnimationFrame> Frames,
    int DefaultDurationMs
);

public record AnimationFrame(
    string TextTemplate,
    int DurationMs,
    ConsoleColor? Color = null,
    int? PositionX = null,
    int? PositionY = null,
    bool ClearPrevious = true
);
```

### Animation Examples

```
ATTACK HIT ANIMATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1 (100ms):  You strike the Skeleton!
Frame 2 (150ms):  * SLASH *                    [Red]
Frame 3 (200ms):  â”€â”€â”€â”€â”€â”€â–¶ -12                  [DarkRed]
Frame 4 (100ms):  The Skeleton reels!


ATTACK MISS ANIMATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1 (100ms):  You swing at the Skeleton...
Frame 2 (150ms):  * WHOOSH *                   [Gray]
Frame 3 (200ms):  MISS!                        [DarkGray]
Frame 4 (100ms):  The Skeleton dodges!


CRITICAL HIT ANIMATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1 (100ms):  You strike the Skeleton!
Frame 2 (200ms):  â˜… CRITICAL HIT! â˜…            [Magenta, centered]
Frame 3 (150ms):  â•â•â•â•â•â•â•â–¶ -24                 [DarkRed]
Frame 4 (100ms):  DEVASTATING BLOW!


ABILITY ANIMATION (Fireball):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1 (150ms):  You cast Fireball!
Frame 2 (100ms):      *
Frame 3 (100ms):     *.*
Frame 4 (100ms):    *.â˜¼.*                      [Yellow]
Frame 5 (100ms):     *.*
Frame 6 (100ms):      *
Frame 7 (200ms):  ğŸ”¥ 18 fire damage!           [Red]


HEALING ANIMATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1 (100ms):  You use Healing Potion!
Frame 2 (150ms):  âœ§ âœ§ âœ§                        [Green]
Frame 3 (200ms):  +25 HP                       [Green]
Frame 4 (100ms):  You feel restored!


DEATH ANIMATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Frame 1 (200ms):  The Skeleton collapses!
Frame 2 (300ms):  â˜                             [DarkGray, large]
Frame 3 (200ms):  [DEFEATED]
Frame 4 (100ms):  (Skeleton is removed from combat)


DAMAGE NUMBER (Floating):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Position: Above target entity on grid

Frame 1:  -12                                  [Red, at target]
Frame 2:  -12  (move up 1 row)
Frame 3:  -12  (move up 1 row, fade)
Frame 4:  (clear)
```

### Animation Configuration

```json
{
  "$schema": "./schemas/animations.schema.json",
  "settings": {
    "enabled": true,
    "speedMultiplier": 1.0,
    "showDamageNumbers": true,
    "skipKey": "Space"
  },
  "animations": {
    "attack-hit": {
      "frames": [
        { "text": "{actor} strikes {target}!", "duration": 100 },
        { "text": "* {verb} *", "duration": 150, "color": "Red" },
        { "text": "â”€â”€â”€â”€â”€â”€â–¶ -{value}", "duration": 200, "color": "DarkRed" },
        { "text": "{target} reels from the blow!", "duration": 100 }
      ],
      "verbs": ["SLASH", "STRIKE", "HIT", "BASH"]
    },
    "attack-miss": {
      "frames": [
        { "text": "{actor} swings at {target}...", "duration": 100 },
        { "text": "* WHOOSH *", "duration": 150, "color": "Gray" },
        { "text": "MISS!", "duration": 200, "color": "DarkGray" },
        { "text": "{target} dodges the attack!", "duration": 100 }
      ]
    },
    "critical-hit": {
      "frames": [
        { "text": "{actor} strikes {target}!", "duration": 100 },
        { "text": "â˜… CRITICAL HIT! â˜…", "duration": 200, "color": "Magenta", "center": true },
        { "text": "â•â•â•â•â•â•â•â–¶ -{value}", "duration": 150, "color": "DarkRed" },
        { "text": "DEVASTATING BLOW!", "duration": 100 }
      ]
    },
    "ability-cast": {
      "frames": [
        { "text": "{actor} casts {ability}!", "duration": 150 },
        { "text": "    *", "duration": 100 },
        { "text": "   *.*", "duration": 100 },
        { "text": "  *.â˜¼.*", "duration": 100, "color": "Yellow" },
        { "text": "   *.*", "duration": 100 },
        { "text": "    *", "duration": 100 },
        { "text": "ğŸ”¥ {value} {damageType} damage!", "duration": 200, "color": "Red" }
      ]
    },
    "heal": {
      "frames": [
        { "text": "{actor} uses {ability}!", "duration": 100 },
        { "text": "âœ§ âœ§ âœ§", "duration": 150, "color": "Green" },
        { "text": "+{value} HP", "duration": 200, "color": "Green" },
        { "text": "You feel restored!", "duration": 100 }
      ]
    },
    "death": {
      "frames": [
        { "text": "{target} collapses!", "duration": 200 },
        { "text": "â˜ ", "duration": 300, "color": "DarkGray" },
        { "text": "[DEFEATED]", "duration": 200 }
      ]
    },
    "status-applied": {
      "frames": [
        { "text": "{target} is now {status}!", "duration": 150, "color": "Yellow" }
      ]
    }
  }
}
```

### Animation Queue Flow

```
    Combat Events            Animation Queue              Display
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€
    
    AttackHit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    CriticalHit â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚  Animation 1    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Playing
    Death â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶   â”‚  Animation 2    â”‚            (wait...)
                            â”‚  Animation 3    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Playing
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            (wait...)
                                                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  Playing
                                                            (done)
    
    Skip Key â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Skip current, play next
    
    Speed = 2.0x â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Frame durations halved
```

### Acceptance Criteria

- [ ] Attack hit animation plays with frames
- [ ] Attack miss animation displays correctly
- [ ] Critical hit has special animation
- [ ] Ability animations show casting effect
- [ ] Damage numbers float above targets
- [ ] Healing shows positive numbers in green
- [ ] Death animation plays on entity death
- [ ] Status effect application animates
- [ ] Animations queue and play sequentially
- [ ] Skip key advances to next animation
- [ ] Speed multiplier affects timing
- [ ] Animations can be disabled
- [ ] ~15 unit tests pass

---

## Dependencies & Prerequisites

```
v0.6.1d (Inventory Grid) - REQUIRED
    â”‚
    â””â”€â”€ ScreenLayout, ColorThemeService, HealthBar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                      â”‚
v0.6.2 (Combat Display)                                               â”‚
    â”‚                                                                 â”‚
    â”œâ”€â”€ v0.6.2a: Combat Grid View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: ScreenLayout, HealthBar, CombatGrid         â”‚
    â”‚       Provides: CombatGridView, CombatantListPanel, TurnInfoBar â”‚
    â”‚                                                                 â”‚
    â””â”€â”€ v0.6.2b: Combat Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: v0.6.2a (display integration), ITerminalService
            Provides: ICombatAnimator, AnimationDefinition
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.6.2a | ~4 | ~2 | ~15 | Medium-High |
| v0.6.2b | ~3 | ~2 | ~15 | High |
| **Total** | **~7** | **~4** | **~30** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Animation timing issues | Medium | Medium | Configurable timing, graceful degradation |
| Frame flicker | Low | Medium | Proper clear/redraw sequencing |
| Queue blocking input | Medium | Low | Async playback with skip support |
| Unicode animation characters | Low | Medium | ASCII fallback animations |

---

## Design Decisions (Confirmed)

### Combat Grid View

| Decision | Value | Notes |
|----------|-------|-------|
| **Grid Size** | 8x8 default | Matches CombatGrid |
| **Coordinate Style** | Chess notation (A-H, 1-8) | Intuitive |
| **Entity Markers** | @ (player), M (monster) | Standard roguelike |

### Combat Animations

| Decision | Value | Notes |
|----------|-------|-------|
| **Animation Style** | Frame-based | Discrete frames with timing |
| **Default Frame Duration** | 100-200ms | Configurable per animation |
| **Queue Behavior** | Sequential | Animations don't overlap |
| **Skip Mechanism** | Spacebar | Standard skip key |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.6.2a Design Spec** - Create detailed design for Combat Grid View
3. **v0.6.2a Implementation** - Build grid view, combatant list, turn info
4. **v0.6.2b Design Spec** - Create specification for Combat Animations
5. **v0.6.2b Implementation** - Build animation framework and definitions

---

*This scope breakdown provides a structured approach to implementing v0.6.2 Combat Display. The grid view establishes the visual combat layout while animations add satisfying feedback for all combat actions.*
