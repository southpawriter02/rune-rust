# v0.15.5g Changelog - Scout Action System

## Summary

Implements the **Scout Action System** for the Wasteland Survival skill. This subsystem allows characters to perform reconnaissance on adjacent rooms, revealing enemies, hazards, and points of interest. Features terrain-based DCs (8-24 via NavigationTerrainType), visibility modifiers (-2 to +6), equipment bonuses (+1 to +2), room revelation formula `1 + (netSuccesses / 2)` capped at adjacent room count, threat level assessment (Low/Moderate/High/Extreme), hazard severity classification (Minor/Moderate/Severe/Lethal), and 6 point of interest types.

## Added

### Domain Layer - Enums (3 files)

| File | Description |
|------|-------------|
| `ThreatLevel.cs` | 4-value enum for enemy threat assessment: Low (0-50 XP), Moderate (51-150 XP), High (151-400 XP), Extreme (401+ XP). Extension methods: `GetMinXp()`, `GetMaxXp()`, `GetDisplayName()`, `GetShortDescriptor()`, `GetDescription()`, `GetTacticalRecommendation()`, `FromExperienceValue()`. |
| `HazardSeverity.cs` | 4-value enum for hazard danger classification: Minor (1d4), Moderate (1d8), Severe (2d8), Lethal (3d10). Extension methods: `GetDisplayName()`, `GetShortDescriptor()`, `GetTypicalDamageDice()`, `GetDescription()`, `GetTacticalRecommendation()`, `FromDetectableHazardType()`. |
| `PointOfInterestType.cs` | 6-value enum for POI categories: Container, ScavengerSign, Mechanism, ResourceNode, Landmark, Other. Extension methods: `GetDisplayName()`, `GetDescription()`, `GetDefaultInteractionHint()`, `GetIconCharacter()`, `ContainsItems()`, `RequiresSkillCheck()`, `MayBeDangerous()`, `MayHaveNarrativeSignificance()`, `GetAssociatedSkillId()`. |

### Domain Layer - Value Objects (6 files)

| File | Description |
|------|-------------|
| `ScoutResult.cs` | `readonly record struct` for scout outcomes. Properties: RoomsRevealed, NetSuccesses, ScoutSucceeded, TargetDc, RollDetails. Computed: RoomCount, TotalEnemiesDetected, TotalHazardsDetected, TotalPointsOfInterest, EnemiesPresent, HazardsPresent, PointsOfInterestPresent, ThreatsDetected, DangerousRoomsDetected, Margin, IsCriticalSuccess. Factory methods: `Success()`, `Failure()`, `Empty()`. Static: `CalculateRoomsRevealed()`. String formatting: `ToDisplayString()`, `ToDetailedString()`. |
| `ScoutContext.cs` | `readonly record struct` for scout attempt context. Properties: PlayerId, CurrentRoomId, TerrainType (NavigationTerrainType), AdjacentRoomIds, EquipmentBonus, VisibilityModifier. Computed: AdjacentRoomCount, TotalModifier, HasEquipmentBonus, HasVisibilityPenalty, HasVisibilityBonus. Factory methods: `Create()`, `CreateWithModifiers()`. |
| `ScoutedRoom.cs` | `readonly record struct` for revealed room information. Properties: RoomId, RoomName, Description, TerrainType, Enemies, Hazards, PointsOfInterest, Exits. Computed: HasEnemies, HasHazards, HasPointsOfInterest, IsDangerous, IsEmpty, TotalEnemyCount, HighestThreatLevel, MostSevereHazard. Factory methods: `Create()`, `CreateEmpty()`. String formatting: `ToSummaryString()`, `ToDetailedString()`. |
| `DetectedEnemy.cs` | `readonly record struct` for enemy presence info. Properties: EnemyType, Count, ThreatLevel, Position. Computed: ThreatDisplayName, ThreatShortDescriptor, TacticalRecommendation. Factory methods: `Create()`, `CreateWithThreatAssessment()`. |
| `DetectedHazard.cs` | `readonly record struct` for hazard info. Properties: HazardType (DetectableHazardType), Severity, Description, AvoidanceHint. Computed: SeverityDisplayName, SeverityShortDescriptor, TypicalDamageDice, TacticalRecommendation, IsLethal. Factory methods: `Create()`, `CreateWithSeverity()`. |
| `PointOfInterest.cs` | `readonly record struct` for notable features. Properties: InterestType, Description, InteractionHint. Computed: MayContainItems, RequiresSkillCheck, MayBeDangerous, AssociatedSkillId, TypeDisplayName. Factory methods: `Create()`, `CreateCustom()`, `Container()`, `ScavengerSign()`, `Mechanism()`, `ResourceNode()`, `Landmark()`, `Other()`. String formatting: `ToDisplayString()`, `ToDetailedString()`, `ToNotificationString()`. |

### Application Layer - Interface (1 file)

| File | Description |
|------|-------------|
| `IScoutService.cs` | Service interface with methods: **Scouting**: `PerformScout()`. **DC Calculation**: `GetBaseDc()`, `GetScoutDc()`. **Room Revelation**: `CalculateRoomsRevealed()`. **Detection**: `DetectEnemies()`, `DetectHazards()`, `DetectPointsOfInterest()`. **Prerequisites**: `CanScout()`, `GetScoutBlockedReason()`. Full XML documentation with terrain DC table, room revelation formula, and usage examples. |

### Application Layer - Service (1 file)

| File | Description |
|------|-------------|
| `ScoutService.cs` | Full implementation of IScoutService. Dependencies: SkillCheckService, ILogger. Constants for terrain DCs (8/12/16/20/24), visibility modifiers (-2 to +6), equipment bonuses (1-2), threat XP thresholds (50/150/400), critical threshold (4). Uses `PerformCheckWithDC` with skillId `"wasteland-survival"`. Enemy detection via Room._monsters with ExperienceValue-based threat assessment. Hazard detection via Room._hazardZones with severity mapping. POI detection from Room._items, _interactables, _hiddenItems. Comprehensive logging at Information, Debug, and Warning levels. |

### Configuration (2 files)

| File | Description |
|------|-------------|
| `config/scout-action.json` | Configuration for terrain types (5 types with DCs, descriptions, characteristics), visibility modifiers (6 levels: excellent to staticStorm), equipment bonuses (survivalKit, binoculars), room revelation formula and scaling, threat levels (4 tiers with XP ranges), hazard severity (4 tiers with damage dice), POI types (6 categories with characteristics), scout outcomes (success, criticalSuccess, failure), scouting blocked reasons, and balance notes. |
| `config/schemas/scout-action.schema.json` | JSON Schema 2020-12 for scout-action.json validation. Defines terrainTypeDefinition, terrainCharacteristicsDefinition, visibilityModifierDefinition, equipmentBonusDefinition, roomRevelationDefinition, roomRevelationScalingDefinition, threatLevelDefinition, hazardSeverityDefinition, poiTypeDefinition, poiCharacteristicsDefinition, scoutSuccessDefinition, scoutCriticalDefinition, scoutFailureDefinition. |

### Unit Tests (1 file, 50+ tests)

| File | Tests |
|------|-------|
| `ScoutServiceTests.cs` | **Base DC tests** (5 parameterized cases for terrain types). **Scout DC tests** (visibility modifier combinations, equipment bonus application). **Room Revelation tests** (8 boundary cases: negative successes, 0-1, 2-3, 4-5, 6+, capping at adjacent count). **Prerequisites tests** (CanScout true/false, GetScoutBlockedReason). **ScoutResult tests** (factory methods Success/Failure/Empty, computed properties, CalculateRoomsRevealed, IsCriticalSuccess). **ScoutContext tests** (factory methods, computed properties TotalModifier, HasEquipmentBonus, HasVisibilityPenalty). **ScoutedRoom tests** (factory methods, computed properties HasEnemies, HasHazards, IsDangerous, HighestThreatLevel). **DetectedEnemy tests** (factory methods, computed properties). **DetectedHazard tests** (factory methods, severity properties, IsLethal). **PointOfInterest tests** (factory methods for each type, computed properties). **ThreatLevel extension tests** (XP ranges, FromExperienceValue). **HazardSeverity extension tests** (damage dice, FromDetectableHazardType). **PointOfInterestType extension tests** (characteristics, associated skills). |

## Key Features

### Terrain-Based DCs (via NavigationTerrainType.GetBaseDc())

| Terrain | DC | Description | Travel Speed | Compass Effective |
|---------|-----|-------------|--------------|-------------------|
| OpenWasteland | 8 | Clear sightlines, easy reconnaissance | 1.0x | Yes |
| ModerateRuins | 12 | Partial cover, some obscured areas | 0.8x | Yes |
| DenseRuins | 16 | Many hiding spots, difficult observation | 0.6x | Yes |
| Labyrinthine | 20 | Twisting passages, severely limited visibility | 0.4x | Yes |
| GlitchedLabyrinth | 24 | Reality distortions, observation unreliable | 0.3x | No |

### Room Revelation Formula

```
if (netSuccesses >= 0):
    roomsRevealed = 1 + (netSuccesses / 2)
else:
    roomsRevealed = 0

roomsRevealed = min(roomsRevealed, adjacentRoomCount)
```

| Net Successes | Rooms Revealed | Description |
|---------------|----------------|-------------|
| < 0 (Failure) | 0 | No information gained |
| 0-1 | 1 | Base success - minimum revelation |
| 2-3 | 2 | Good success - additional room |
| 4-5 | 3 | Excellent success - substantial revelation |
| 6+ | 4+ | Outstanding success - capped at adjacent count |

### Visibility Modifiers

| Condition | DC Modifier | Description |
|-----------|-------------|-------------|
| Excellent | -2 | Bright light, clear weather, elevated position |
| Good | -1 | Adequate lighting, minimal obstructions |
| Normal | +0 | Standard conditions, no modifiers |
| Poor | +2 | Dim lighting, fog, light precipitation |
| Terrible | +4 | Darkness, heavy precipitation, dense fog |
| Static Storm | +6 | Reality-distorting storms, observation extremely unreliable |

### Equipment Bonuses

| Equipment | Bonus | Description |
|-----------|-------|-------------|
| Survival Kit | +1 | Basic survival equipment aiding reconnaissance |
| Binoculars | +2 | Optical equipment for long-distance observation |

### Threat Level Assessment

| Threat Level | XP Range | Short Descriptor | Tactical Recommendation |
|--------------|----------|------------------|------------------------|
| Low | 0-50 | minor | Engage at will |
| Moderate | 51-150 | moderate | Proceed with normal caution |
| High | 151-400 | dangerous | Prepare before engaging, consider tactical approach |
| Extreme | 401+ | deadly | Extreme caution advised, consider retreat |

### Hazard Severity Classification

| Severity | Damage Dice | Short Descriptor | Tactical Recommendation |
|----------|-------------|------------------|------------------------|
| Minor | 1d4 | minor | Proceed normally, minor damage expected |
| Moderate | 1d8 | moderate | Avoid if convenient, or prepare for damage |
| Severe | 2d8 | severe | Find alternate route or use protective equipment |
| Lethal | 3d10 | lethal | Do not enter without specialized protection |

### Point of Interest Types

| POI Type | Contains Items | Requires Skill Check | May Be Dangerous | Associated Skill |
|----------|---------------|---------------------|------------------|------------------|
| Container | Yes | No | Yes | Perception |
| ScavengerSign | No | Yes | No | Wasteland Survival |
| Mechanism | No | Yes | Yes | Technology |
| ResourceNode | Yes | Yes | No | Wasteland Survival |
| Landmark | No | No | No | None |
| Other | No | No | No | None |

### Scout Outcomes

| Outcome | Condition | Result |
|---------|-----------|--------|
| Success | Net successes >= 0 | Rooms revealed based on formula; enemies, hazards, POIs detected |
| Critical Success | Net successes >= 4 | 3+ rooms revealed (exceptional reconnaissance) |
| Failure | Net successes < 0 | No rooms revealed, no information gained |

## Files Changed

### Added (14 files)
- `src/Core/RuneAndRust.Domain/Enums/ThreatLevel.cs`
- `src/Core/RuneAndRust.Domain/Enums/HazardSeverity.cs`
- `src/Core/RuneAndRust.Domain/Enums/PointOfInterestType.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/ScoutResult.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/ScoutContext.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/ScoutedRoom.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/DetectedEnemy.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/DetectedHazard.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/PointOfInterest.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IScoutService.cs`
- `src/Core/RuneAndRust.Application/Services/ScoutService.cs`
- `config/scout-action.json`
- `config/schemas/scout-action.schema.json`
- `tests/RuneAndRust.Application.UnitTests/Services/ScoutServiceTests.cs`
- `changelogs/v0.15.5g-changelog.md`

## Dependencies

- `SkillCheckService.cs` - For performing Wasteland Survival scouting checks
- `NavigationTerrainType.cs` - For terrain-based DC calculation
- `DetectableHazardType.cs` - For hazard type identification and severity mapping
- `Room.cs` entity - Source for monsters, hazards, items, interactables, exits
- `Monster.cs` entity - For enemy information (Name, ExperienceValue)
- `HazardZone.cs` entity - For hazard information (HazardType)
- `ILogger<ScoutService>` - For comprehensive logging

## Integration Points

- **SkillCheckService**: Uses `PerformCheckWithDC()` for scouting skill checks with `"wasteland-survival"` skill
- **NavigationTerrainType.GetBaseDc()**: Provides terrain-appropriate DC (8/12/16/20/24)
- **Room._monsters**: Source for enemy detection with threat assessment
- **Room._hazardZones**: Source for hazard detection with severity classification
- **Room._items/_interactables/_hiddenItems**: Source for point of interest detection
- **Room._exits**: Source for exit information in scouted rooms
- **Monster.ExperienceValue**: Used for threat level assessment (thresholds: 50/150/400)
- **DetectableHazardType**: Maps to HazardSeverity for severity classification

## Notes

- Scout action uses the Wasteland Survival skill (`wasteland-survival`)
- Uses `NavigationTerrainType` (not `TerrainType`) for terrain classification with existing `GetBaseDc()` method
- Uses `DetectableHazardType` for exploration hazard detection, mapped from combat `HazardType`
- Threat level is derived from monster ExperienceValue, not ChallengeRating (which doesn't exist on Monster entity)
- Room entity provides all source data directly (no IRoomService abstraction needed)
- Equipment bonuses stack additively and reduce the effective DC
- Visibility modifiers can range from -2 (excellent) to +6 (static storm), applied to base DC
- Critical success (net >= 4) reveals 3+ rooms, rewarding investment in Wasteland Survival
- Adjacent room count caps revelation - cannot reveal more rooms than exist
- Comprehensive logging at all decision points for debugging and analytics
- This builds upon v0.15.5f (Scavenger Sign Reading) and provides foundation for v0.15.5h (Specialization Integration)
