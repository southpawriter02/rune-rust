# v0.16.5 Unique Items & Myth-Forged System - Scope Breakdown

**Version:** 0.16.5  
**Theme:** Unique Items & Myth-Forged System  
**Prerequisites:** v0.16.4 Complete (Container Loot Generation)  
**Total Estimated Tests:** ~10 new tests

---

## Executive Summary

This version implements the Myth-Forged (Tier 4) unique item system. Legendary items have special effects that can define a run, require duplicate prevention to maintain their "legendary" status, and deserve special presentation (visual/audio feedback). Each unique can only drop once per run.

The work is divided into **6 sub-phases**:

| Phase    | Name                         | Focus                                       | Est. Tests |
| -------- | ---------------------------- | ------------------------------------------- | ---------- |
| v0.16.5a | Unique Item Definition       | UniqueItem entity, ItemStats, DropSource    | ~2         |
| v0.16.5b | Special Effect System        | SpecialEffect, SpecialEffectType enum       | ~2         |
| v0.16.5c | Unique Item Registry         | UniqueItemRegistry, duplicate prevention    | ~2         |
| v0.16.5d | Myth-Forged Drop Integration | IMythForgedService, drop generation         | ~2         |
| v0.16.5e | Legendary Drop Presentation  | MythForgedDropEvent, ILegendaryPresentation | ~2         |
| v0.16.5f | Achievement Integration      | UniqueItemAchievements, collection hooks    | ~0         |

---

## Feature Analysis & Categorization

### Unique Item Definition

| Feature             | Complexity | Dependencies | Assigned Phase |
| ------------------- | ---------- | ------------ | -------------- |
| UniqueItem entity   | Medium     | QualityTier  | **v0.16.5a**   |
| ItemStats VO        | Low        | None         | **v0.16.5a**   |
| DropSource VO       | Low        | None         | **v0.16.5a**   |
| DropSourceType enum | Low        | None         | **v0.16.5a**   |
| unique-items.json   | Medium     | UniqueItem   | **v0.16.5a**   |

### Special Effects

| Feature                           | Complexity | Dependencies  | Assigned Phase |
| --------------------------------- | ---------- | ------------- | -------------- |
| SpecialEffect VO                  | Medium     | None          | **v0.16.5b**   |
| SpecialEffectType enum (14 types) | Low        | None          | **v0.16.5b**   |
| Effect processing logic           | High       | SpecialEffect | **v0.16.5b**   |
| special-effects.json              | Low        | SpecialEffect | **v0.16.5b**   |

### Registry

| Feature                    | Complexity | Dependencies       | Assigned Phase |
| -------------------------- | ---------- | ------------------ | -------------- |
| UniqueItemRegistry entity  | Medium     | UniqueItem         | **v0.16.5c**   |
| Duplicate prevention logic | Medium     | UniqueItemRegistry | **v0.16.5c**   |
| Per-run tracking           | Low        | UniqueItemRegistry | **v0.16.5c**   |

### Drop Integration

| Feature                        | Complexity | Dependencies       | Assigned Phase |
| ------------------------------ | ---------- | ------------------ | -------------- |
| IMythForgedService             | Medium     | UniqueItemRegistry | **v0.16.5d**   |
| Class affinity filtering (60%) | Medium     | v0.16.3            | **v0.16.5d**   |
| Tier 3 fallback                | Low        | IMythForgedService | **v0.16.5d**   |

### Presentation

| Feature                      | Complexity | Dependencies           | Assigned Phase |
| ---------------------------- | ---------- | ---------------------- | -------------- |
| MythForgedDropEvent VO       | Low        | UniqueItem             | **v0.16.5e**   |
| ILegendaryPresentation       | Medium     | MythForgedDropEvent    | **v0.16.5e**   |
| Drop announcement formatting | Low        | ILegendaryPresentation | **v0.16.5e**   |
| Examination text             | Low        | ILegendaryPresentation | **v0.16.5e**   |

### Achievements

| Feature                   | Complexity | Dependencies       | Assigned Phase |
| ------------------------- | ---------- | ------------------ | -------------- |
| UniqueItemAchievements VO | Low        | None               | **v0.16.5f**   |
| Collection tracking hooks | Low        | UniqueItemRegistry | **v0.16.5f**   |

---

## Phase Definitions

---

## v0.16.5a: Unique Item Definition

[v0.16.5a Design Specification](v0.16.5a-design-specification.md)

### Overview

Defines the UniqueItem entity and supporting value objects for legendary items.

### Scope

**In Scope:**

- UniqueItem entity
- ItemStats value object
- DropSource value object
- DropSourceType enum
- unique-items.json configuration

**Out of Scope:**

- Special effects (v0.16.5b)
- Registry (v0.16.5c)

### Key Deliverables

| Type                 | Count | Details                   |
| -------------------- | ----- | ------------------------- |
| Domain Entities      | 1     | `UniqueItem`              |
| Domain Enums         | 1     | `DropSourceType`          |
| Domain Value Objects | 2     | `ItemStats`, `DropSource` |
| Configuration        | 1     | `unique-items.json`       |
| Unit Tests           | ~2    |                           |

### Example Unique Items

| Name            | Category    | Effect                        | Drop Source    |
| --------------- | ----------- | ----------------------------- | -------------- |
| Dvergr Maul     | Hammer      | +2 MIGHT, Ignores Armor       | Any Boss       |
| Frostbane       | Sword       | +2 FINESSE, Ice damage        | Niflheim Boss  |
| Paradox Blade   | Dagger      | +2 WITS, Phase through blocks | Alfheim Boss   |
| Ironheart Plate | Heavy Armor | +3 STURDINESS, Reflect        | Jötunheim Boss |
| Eye of the Deep | Accessory   | +2 WILL, See hidden           | Hidden Cache   |

### Acceptance Criteria

- [ ] Unique item loads from configuration
- [ ] Special effects parsed correctly
- [ ] ~2 unit tests pass

---

## v0.16.5b: Special Effect System

[v0.16.5b Design Specification](v0.16.5b-design-specification.md)

### Overview

Implements the special effect types that make Myth-Forged items unique.

### Scope

**In Scope:**

- SpecialEffect value object
- SpecialEffectType enum (14 types)
- Effect processing hooks
- special-effects.json configuration

**Out of Scope:**

- Registry (v0.16.5c)
- Drop integration (v0.16.5d)

### Key Deliverables

| Type                 | Count | Details                |
| -------------------- | ----- | ---------------------- |
| Domain Enums         | 1     | `SpecialEffectType`    |
| Domain Value Objects | 1     | `SpecialEffect`        |
| Configuration        | 1     | `special-effects.json` |
| Unit Tests           | ~2    |                        |

### Special Effect Types

| Effect          | Trigger         | Description            |
| --------------- | --------------- | ---------------------- |
| IgnoreArmor     | On attack       | Bypass target Defense  |
| LifeSteal       | On damage       | Heal % of damage       |
| Cleave          | On attack       | Hit adjacent enemies   |
| ElementalDamage | On hit          | Add fire/ice/lightning |
| Slow            | On hit          | Reduce target speed    |
| Phase           | On attack       | Cannot be blocked      |
| AutoHide        | On kill         | Enter [Hidden] state   |
| Reflect         | On damage taken | Return damage          |
| Detection       | Passive         | Reveal hidden/traps    |
| CriticalBonus   | Passive         | Increased crit chance  |

### Acceptance Criteria

- [ ] IgnoreArmor sets defense to 0
- [ ] LifeSteal heals correct percentage
- [ ] ~2 unit tests pass

---

## v0.16.5c: Unique Item Registry

[v0.16.5c Design Specification](v0.16.5c-design-specification.md)

### Overview

Tracks dropped uniques per run to prevent duplicates.

### Scope

**In Scope:**

- UniqueItemRegistry entity
- HasDropped() / RegisterDrop() methods
- GetAvailableUniques() filtering
- Per-run reset

**Out of Scope:**

- Drop integration (v0.16.5d)
- Presentation (v0.16.5e)

### Key Deliverables

| Type            | Count | Details              |
| --------------- | ----- | -------------------- |
| Domain Entities | 1     | `UniqueItemRegistry` |
| Unit Tests      | ~2    |                      |

### Duplicate Prevention Logic

```
GetAvailableUniques(tier, dropSource):
  1. Get all unique items of specified tier
  2. Filter by drop source compatibility
  3. For each item where IsOnePerRun:
     - If HasDropped(itemId): Exclude
  4. Return remaining pool
```

### Acceptance Criteria

- [ ] Same unique cannot drop twice
- [ ] Registry resets between runs
- [ ] ~2 unit tests pass

---

## v0.16.5d: Myth-Forged Drop Integration

[v0.16.5d Design Specification](v0.16.5d-design-specification.md)

### Overview

Integrates Myth-Forged generation into the loot system.

### Scope

**In Scope:**

- IMythForgedService interface
- TryGenerateMythForged() method
- Class affinity filter (60% bias)
- Fallback to Tier 3 when pool empty

**Out of Scope:**

- Presentation (v0.16.5e)
- Achievements (v0.16.5f)

### Key Deliverables

| Type                   | Count | Details              |
| ---------------------- | ----- | -------------------- |
| Application Interfaces | 1     | `IMythForgedService` |
| Unit Tests             | ~2    |                      |

### Drop Chance by Source

| Source       | Chance | Notes                    |
| ------------ | ------ | ------------------------ |
| Boss         | 70%    | Already rolled as Tier 4 |
| Elite        | 10%    | Within Tier 3-4 pool     |
| Boss Chest   | 50%    | One item guaranteed      |
| Hidden Cache | 15%    | Rare but possible        |
| Quest Reward | 100%   | If quest specifies       |

### Generation Flow

```
TryGenerateMythForged(sourceType, sourceId, player, rng):
  1. Get available uniques for source
  2. If empty: Return null (fallback to Tier 3)
  3. Apply class affinity filter (60% chance)
  4. Select random unique from pool
  5. Register in UniqueItemRegistry
  6. Return unique item
```

### Acceptance Criteria

- [ ] Myth-Forged generates from available pool
- [ ] Class affinity filter applies 60% of time
- [ ] ~2 unit tests pass

---

## v0.16.5e: Legendary Drop Presentation

[v0.16.5e Design Specification](v0.16.5e-design-specification.md)

### Overview

Implements special visual presentation for Myth-Forged drops.

### Scope

**In Scope:**

- MythForgedDropEvent value object
- ILegendaryPresentation interface
- Drop announcement formatting
- Examination text with lore
- Color constants

**Out of Scope:**

- Achievement hooks (v0.16.5f)
- Audio (future version)

### Key Deliverables

| Type                   | Count | Details                  |
| ---------------------- | ----- | ------------------------ |
| Domain Value Objects   | 1     | `MythForgedDropEvent`    |
| Application Interfaces | 1     | `ILegendaryPresentation` |
| Unit Tests             | ~2    |                          |

### Drop Announcement Example

```
═══════════════════════════════════════════════
✦ LEGENDARY DROP ✦
The air hums. A relic of the Deep Kings lies before you.

[Myth-Forged] Dvergr Maul
2d6+4 Damage | +2 MIGHT | Ignores Armor
═══════════════════════════════════════════════
```

### Color Constants

| Tier       | Color  | Hex     |
| ---------- | ------ | ------- |
| JuryRigged | Gray   | #808080 |
| Scavenged  | White  | #FFFFFF |
| ClanForged | Green  | #00FF00 |
| Optimized  | Purple | #800080 |
| MythForged | Gold   | #FFD700 |

### Acceptance Criteria

- [ ] Myth-Forged drop shows special announcement
- [ ] Color constants match tier
- [ ] ~2 unit tests pass

---

## v0.16.5f: Achievement Integration

[v0.16.5f Design Specification](v0.16.5f-design-specification.md)

### Overview

Provides hooks for future achievement system integration.

### Scope

**In Scope:**

- UniqueItemAchievements value object (structure only)
- Collection tracking hooks (interfaces)

**Out of Scope:**

- Actual achievement implementation (future version)

### Key Deliverables

| Type                 | Count | Details                  |
| -------------------- | ----- | ------------------------ |
| Domain Value Objects | 1     | `UniqueItemAchievements` |
| Unit Tests           | ~0    | Hooks only               |

### Achievement Definitions (Future)

| Achievement     | Requirement                |
| --------------- | -------------------------- |
| FirstMythForged | First legendary drop       |
| CollectorBronze | 5 unique items found       |
| CollectorSilver | 15 unique items found      |
| CollectorGold   | All unique items found     |
| ClassMaster     | All class-specific uniques |

### Acceptance Criteria

- [ ] Achievement hooks defined
- [ ] No tests required (future feature)

---

## Dependencies & Prerequisites

```
v0.16.4 (Container Loot Generation) - REQUIRED
    │
    └── Boss chests, hidden caches
            │
            ▼
v0.16.5 (Unique Items & Myth-Forged)
    │
    ├── v0.16.5a: Unique Item Definition ───────────┐
    │       Dependencies: v0.16.0 (QualityTier)      │
    │                                                │
    ├── v0.16.5b: Special Effect System ────────────┤
    │       Dependencies: v0.16.5a                   │
    │                                                │
    ├── v0.16.5c: Unique Item Registry ─────────────┤
    │       Dependencies: v0.16.5a                   │
    │                                                │
    ├── v0.16.5d: Myth-Forged Drop Integration ─────┤
    │       Dependencies: v0.16.5a-c, v0.16.3        │
    │                                                │
    ├── v0.16.5e: Legendary Drop Presentation ──────┤
    │       Dependencies: v0.16.5a, v0.16.5d         │
    │                                                │
    └── v0.16.5f: Achievement Integration ──────────┘
            Dependencies: v0.16.5c (hooks only)
```

---

## Configuration Files

| File                          | Purpose                     | Phase    |
| ----------------------------- | --------------------------- | -------- |
| `unique-items.json`           | All unique item definitions | v0.16.5a |
| `special-effects.json`        | Effect type definitions     | v0.16.5b |
| `legendary-presentation.json` | Announcement text templates | v0.16.5e |

---

## Estimated Effort Summary

| Phase     | New Files | Modified Files | Est. Tests | Complexity |
| --------- | --------- | -------------- | ---------- | ---------- |
| v0.16.5a  | ~4        | 0              | ~2         | Medium     |
| v0.16.5b  | ~3        | 0              | ~2         | Medium     |
| v0.16.5c  | ~2        | 0              | ~2         | Medium     |
| v0.16.5d  | ~2        | ~1             | ~2         | Medium     |
| v0.16.5e  | ~3        | 0              | ~2         | Low        |
| v0.16.5f  | ~1        | 0              | ~0         | Low        |
| **Total** | **~15**   | **~1**         | **~10**    |            |

---

## Risk Assessment

| Risk                                     | Impact | Probability | Mitigation                   |
| ---------------------------------------- | ------ | ----------- | ---------------------------- |
| Special effect balance                   | High   | Medium      | Per-effect tuning parameters |
| Unique pool exhaustion                   | Low    | Low         | Tier 3 fallback mechanism    |
| Player disappointment on duplicate block | Low    | Low         | Clear messaging              |

---

_This scope breakdown provides a structured approach to implementing v0.16.5 Unique Items & Myth-Forged System. Each sub-phase builds on the previous, allowing for incremental development and testing._
