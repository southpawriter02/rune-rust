<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RuneAndRust.Presentation.Gui.ViewModels"
        x:Class="RuneAndRust.Presentation.Gui.Views.QuestLogWindow"
        x:DataType="vm:QuestLogWindowViewModel"
        Title="Quest Log"
        Width="750" Height="550"
        WindowStartupLocation="CenterOwner"
        CanResize="False"
        ShowInTaskbar="False"
        Background="#1E1E1E">
    
    <Design.DataContext>
        <vm:QuestLogWindowViewModel />
    </Design.DataContext>
    
    <Grid RowDefinitions="Auto,*,Auto">
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#2D2D2D" Padding="16,12">
            <TextBlock Text="QUEST LOG" FontWeight="Bold" FontSize="16" />
        </Border>
        
        <!-- Content -->
        <Grid Grid.Row="1" ColumnDefinitions="260,*">
            
            <!-- Quest List (Left Panel) -->
            <Border Grid.Column="0" Background="#1A1A1A" BorderThickness="0,0,1,0" BorderBrush="#333333">
                <ScrollViewer Padding="8">
                    <StackPanel>
                        
                        <!-- Active Quests -->
                        <TextBlock Text="{Binding ActiveQuestHeader}" 
                                   FontWeight="SemiBold" Foreground="#4CAF50"
                                   Margin="0,0,0,8" />
                        
                        <ItemsControl ItemsSource="{Binding ActiveQuests}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="8,6" CornerRadius="4" Margin="0,2" Cursor="Hand"
                                            Background="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}"
                                            PointerPressed="OnQuestEntryPressed">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="★" Foreground="Gold" Margin="0,0,6,0"
                                                       IsVisible="{Binding IsTracked}" />
                                            <TextBlock Text="{Binding Title}" TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Completed Quests (Collapsible) -->
                        <Button Classes="section-toggle" Margin="0,16,0,4"
                                Command="{Binding ToggleCompletedQuestsCommand}"
                                Background="Transparent" Padding="0"
                                HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding CompletedExpander}" Margin="0,0,8,0" />
                                <TextBlock Text="{Binding CompletedQuestHeader}" 
                                           FontWeight="SemiBold" Foreground="#888888" />
                            </StackPanel>
                        </Button>
                        
                        <ItemsControl ItemsSource="{Binding CompletedQuests}"
                                      IsVisible="{Binding ShowCompletedQuests}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="8,6" CornerRadius="4" Margin="0,2" Cursor="Hand"
                                            Background="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}"
                                            PointerPressed="OnQuestEntryPressed">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="✓" Foreground="LimeGreen" Margin="0,0,6,0" />
                                            <TextBlock Text="{Binding Title}" Foreground="#666666" 
                                                       TextTrimming="CharacterEllipsis" />
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
            <!-- Quest Details (Right Panel) -->
            <Border Grid.Column="1" Padding="16">
                <ScrollViewer>
                    <StackPanel IsVisible="{Binding HasSelectedQuest}">
                        
                        <!-- Quest Title -->
                        <TextBlock Text="{Binding SelectedQuest.Title}" 
                                   FontWeight="Bold" FontSize="18" />
                        <Border Height="1" Background="#333333" Margin="0,8,0,12" />
                        
                        <!-- Description -->
                        <TextBlock Text="{Binding SelectedQuest.Description}" 
                                   TextWrapping="Wrap" Foreground="#CCCCCC"
                                   Margin="0,0,0,16" />
                        
                        <!-- Objectives -->
                        <TextBlock Text="OBJECTIVES:" FontWeight="SemiBold" Foreground="#3F51B5" />
                        <Border Height="1" Background="#333333" Margin="0,4,0,8" />
                        
                        <ItemsControl ItemsSource="{Binding SelectedQuest.Objectives}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="Auto,*,Auto" Margin="0,4">
                                        <TextBlock Grid.Column="0" Text="{Binding StatusIcon}"
                                                   Foreground="{Binding IsCompleted, Converter={StaticResource BoolToForegroundConverter}}"
                                                   Margin="0,0,8,0" />
                                        <TextBlock Grid.Column="1" Text="{Binding Description}" 
                                                   TextWrapping="Wrap" />
                                        <TextBlock Grid.Column="2" Text="{Binding ProgressText}"
                                                   IsVisible="{Binding HasProgress}"
                                                   Foreground="#888888" Margin="8,0,0,0" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Rewards -->
                        <TextBlock Text="REWARDS:" FontWeight="SemiBold" Foreground="#FF9800"
                                   Margin="0,16,0,0" />
                        <Border Height="1" Background="#333333" Margin="0,4,0,8" />
                        
                        <ItemsControl ItemsSource="{Binding SelectedQuest.Rewards}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0,4">
                                        <TextBlock Text="{Binding Icon}" Margin="0,0,8,0" />
                                        <TextBlock Text="{Binding Description}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Progress -->
                        <StackPanel Margin="0,16,0,0">
                            <TextBlock Text="{Binding SelectedQuest.ProgressText}" 
                                       Foreground="#888888" FontSize="12" />
                            <ProgressBar Value="{Binding SelectedQuest.ProgressPercentage}"
                                         Maximum="100" Height="8" CornerRadius="4"
                                         Foreground="#4CAF50" Background="#333333"
                                         Margin="0,4,0,0" />
                        </StackPanel>
                        
                    </StackPanel>
                </ScrollViewer>
            </Border>
            
        </Grid>
        
        <!-- Footer -->
        <Border Grid.Row="2" Background="#252526" Padding="16,12">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal"
                            IsVisible="{Binding CanTrackQuest}">
                    <TextBlock Text="★" Foreground="Gold" Margin="0,0,4,0"
                               IsVisible="{Binding SelectedQuest.IsTracked}" />
                    <TextBlock Text="{Binding TrackingStatus}" Foreground="#888888" />
                </StackPanel>
                
                <Button Grid.Column="1" Content="★ Track Quest"
                        Command="{Binding TrackQuestCommand}"
                        IsVisible="{Binding CanTrackQuest}"
                        Background="#3F51B5" Foreground="White"
                        Padding="16,8" Margin="0,0,8,0" />
                
                <Button Grid.Column="2" Content="Close"
                        Command="{Binding CloseCommand}"
                        Padding="16,8" />
            </Grid>
        </Border>
        
    </Grid>
</Window>
