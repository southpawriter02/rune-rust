# v0.14.0e Design Specification: Progression Schema

**Version:** 0.14.0e
**Parent:** v0.14.0 (Character Configuration Schemas)
**Prerequisites:** v0.13.5 Complete (UI Standardization)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Progression Schema Definition](#4-progression-schema-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [StatBonuses Definition](#42-statbonuses-definition)
   - 4.3 [LevelMilestone Definition](#43-levelmilestone-definition)
5. [XP Curve Configuration](#5-xp-curve-configuration)
   - 5.1 [Curve Type Enum](#51-curve-type-enum)
   - 5.2 [XP Calculation Formulas](#52-xp-calculation-formulas)
6. [Level Milestone Definitions](#6-level-milestone-definitions)
   - 6.1 [Milestone Structure](#61-milestone-structure)
   - 6.2 [Custom Rewards](#62-custom-rewards)
   - 6.3 [Stat Overrides](#63-stat-overrides)
7. [Validation Rules](#7-validation-rules)
   - 7.1 [Range Validation](#71-range-validation)
   - 7.2 [Enum Validation](#72-enum-validation)
   - 7.3 [Required Fields](#73-required-fields)
8. [Configuration Schema](#8-configuration-schema)
9. [Configuration File Updates](#9-configuration-file-updates)
10. [Data Model Changes](#10-data-model-changes)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)

---

## 1. Executive Summary

Version 0.14.0e introduces the **Progression Schema** (`progression.schema.json`), which validates level progression configuration including XP curves, level milestones, default stat bonuses, and custom rewards. This schema enables full customization of the leveling experience without code changes, supporting different progression speeds, milestone titles, and reward systems for various game settings.

The Progression Schema validates XP curve types (Linear, Exponential, Custom), maximum level settings (1-100), base XP requirements, XP multipliers, heal-on-level-up behavior, and level milestone definitions with titles and custom rewards.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `progression.schema.json` |
| **Schema Definitions** | `StatBonuses`, `LevelMilestone` |
| **Configuration Updates** | Update `progression.json` with schema reference |
| **Tests** | ~4 new unit tests |

### Architectural Significance

This version completes the **Character Configuration Schemas** series and provides:
- **XP curve enumeration** - Three progression modes (Linear, Exponential, Custom)
- **Level milestone pattern** - Defines how significant levels are marked with titles and rewards
- **Default stat bonuses** - Per-level stat increases applied automatically
- **Terminology customization** - Allows games to rename "XP" and "Level" to fit their theme
- **Heal-on-level-up toggle** - Common RPG convenience feature made configurable

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     v0.14.0 CHARACTER CONFIGURATION SCHEMAS                  │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.0a: races.schema.json                                             │
  │  v0.14.0b: classes.schema.json                                           │
  │  v0.14.0c: backgrounds.schema.json                                       │
  │  v0.14.0d: skills.schema.json, archetypes.schema.json                    │
  │  v0.14.0e: progression.schema.json ◀── THIS VERSION                      │
  └─────────────────────────────────────────────────────────────────────────┘

  All schemas share:
  • JSON Schema Draft-07 format
  • ID pattern: ^[a-z][a-z0-9-]*$
  • Schema location: config/schemas/
  • Required field enforcement
  • IDE autocomplete support
```

---

## 2. Feature Overview

```
v0.14.0e Progression Schema Features
├── progression.schema.json
│   ├── Root Configuration Properties
│   │   ├── $schema (string, optional)
│   │   ├── experienceTerminology (string, default: "XP")
│   │   ├── levelTerminology (string, default: "Level")
│   │   ├── maxLevel (integer, 1-100, required)
│   │   ├── curveType (enum: Linear, Exponential, Custom)
│   │   ├── baseXpRequirement (integer, minimum: 1, required)
│   │   ├── xpMultiplier (number, minimum: 1.0)
│   │   ├── healOnLevelUp (boolean, default: true)
│   │   ├── defaultStatBonuses (StatBonuses object)
│   │   └── levels (array of LevelMilestone)
│   └── Definitions
│       ├── StatBonuses
│       │   ├── maxHealth (integer, minimum: 0)
│       │   ├── attack (integer, minimum: 0)
│       │   └── defense (integer, minimum: 0)
│       └── LevelMilestone
│           ├── level (integer, minimum: 1, required)
│           ├── title (string, optional)
│           ├── customRewards (array of string, optional)
│           └── statOverrides (StatBonuses, optional)
├── Validation Rules
│   ├── Max Level Range (1-100)
│   ├── Curve Type Enum
│   ├── Base XP Requirement Positive
│   ├── XP Multiplier >= 1.0
│   └── Level Milestone Level Number Valid
└── Configuration Updates
    └── progression.json $schema reference added
```

---

## 3. Architecture Diagrams

### 3.1 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits progression.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads progression.schema.json from config/schemas/                       │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "maxLevel must be >= 1 and <= 100"
                           • "curveType must be one of: Linear, Exponential, Custom"
                           • "baseXpRequirement must be >= 1"
                           • "xpMultiplier must be >= 1.0"
```

### 3.2 Progression Schema Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         progression.schema.json                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"                         │
│  title: "Progression Configuration"                                          │
│  type: object                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  properties:                                                                 │
│  ┌─────────────────────────┬─────────────────────────────────────────────┐  │
│  │ $schema                 │ type: string (optional)                     │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ experienceTerminology   │ type: string, default: "XP"                 │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ levelTerminology        │ type: string, default: "Level"              │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ maxLevel                │ type: integer, min: 1, max: 100 (required)  │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ curveType               │ enum: [Linear, Exponential, Custom]         │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ baseXpRequirement       │ type: integer, min: 1 (required)            │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ xpMultiplier            │ type: number, min: 1.0                      │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ healOnLevelUp           │ type: boolean, default: true                │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ defaultStatBonuses      │ $ref: StatBonuses                           │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ levels                  │ type: array, items: $ref LevelMilestone     │  │
│  └─────────────────────────┴─────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────────────────┤
│  definitions:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ StatBonuses                                                          │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ maxHealth             │ integer, minimum: 0                   │   │    │
│  │ │ attack                │ integer, minimum: 0                   │   │    │
│  │ │ defense               │ integer, minimum: 0                   │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ LevelMilestone                                                       │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ level                 │ integer, minimum: 1 (required)        │   │    │
│  │ │ title                 │ string (optional)                     │   │    │
│  │ │ customRewards         │ array of string (optional)            │   │    │
│  │ │ statOverrides         │ $ref: StatBonuses (optional)          │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 XP Curve Types Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           XP CURVE TYPES                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                          LINEAR                                      │    │
│  │  Formula: XP = baseXpRequirement × level                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Level 1 → 2:  100 XP     (100 × 1)                                  │    │
│  │  Level 2 → 3:  200 XP     (100 × 2)                                  │    │
│  │  Level 3 → 4:  300 XP     (100 × 3)                                  │    │
│  │  ...                                                                 │    │
│  │  Level 19 → 20: 1900 XP   (100 × 19)                                 │    │
│  │                                                                      │    │
│  │  Use Case: Steady, predictable progression                           │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                        EXPONENTIAL                                   │    │
│  │  Formula: XP = baseXpRequirement × (xpMultiplier ^ level)           │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Level 1 → 2:  150 XP     (100 × 1.5^1)                              │    │
│  │  Level 2 → 3:  225 XP     (100 × 1.5^2)                              │    │
│  │  Level 3 → 4:  337 XP     (100 × 1.5^3)                              │    │
│  │  ...                                                                 │    │
│  │  Level 19 → 20: ~148K XP  (100 × 1.5^19)                             │    │
│  │                                                                      │    │
│  │  Use Case: Accelerating difficulty, longer end-game                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                          CUSTOM                                      │    │
│  │  Formula: Defined per-level in LevelMilestone objects               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Level 1 → 2:  Custom XP from milestone                              │    │
│  │  Level 2 → 3:  Custom XP from milestone                              │    │
│  │  ...                                                                 │    │
│  │                                                                      │    │
│  │  Use Case: Full control over XP requirements                         │    │
│  │  Note: Requires xpRequired field in each LevelMilestone              │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Level Milestone System Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      LEVEL MILESTONE SYSTEM                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Level 1 ──────────────────────────────────────────────────────────────────▶│
│      │                                                                       │
│      ▼  Default stat bonuses applied: +5 maxHealth, +1 attack, +1 defense   │
│  Level 2 ──────────────────────────────────────────────────────────────────▶│
│      │                                                                       │
│      ▼  Default stat bonuses applied                                        │
│  Level 3 ──────────────────────────────────────────────────────────────────▶│
│      │                                                                       │
│      ▼  Default stat bonuses applied                                        │
│  Level 4 ──────────────────────────────────────────────────────────────────▶│
│      │                                                                       │
│      ▼  Default stat bonuses applied                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ Level 5: MILESTONE - "Veteran"                                       │    │
│  │   ├── Title: "Veteran"                                               │    │
│  │   ├── Custom Reward: "Unlock: Advanced Training"                     │    │
│  │   └── Stat bonuses (default or override)                             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│      │                                                                       │
│      ▼  Levels 6-9: Default stat bonuses applied                            │
│      │                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ Level 10: MILESTONE - "Elite"                                        │    │
│  │   ├── Title: "Elite"                                                 │    │
│  │   ├── Custom Reward: "Unlock: Mastery Skills"                        │    │
│  │   └── Stat bonuses (default or override)                             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│      │                                                                       │
│      ▼  Levels 11-14: Default stat bonuses applied                          │
│      │                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ Level 15: MILESTONE - "Champion"                                     │    │
│  │   ├── Title: "Champion"                                              │    │
│  │   ├── Custom Reward: "Unlock: Legendary Abilities"                   │    │
│  │   └── Stat bonuses (default or override)                             │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│      │                                                                       │
│      ▼  Levels 16-19: Default stat bonuses applied                          │
│      │                                                                       │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ Level 20: MILESTONE - "Legend" (MAX LEVEL)                           │    │
│  │   ├── Title: "Legend"                                                │    │
│  │   ├── Custom Reward: "Maximum Level Reached!"                        │    │
│  │   └── Final stat bonuses applied                                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── progression.json ◀────────────────────────────┐                        │
│  │   {                                              │ references             │
│  │     "$schema": "./schemas/progression.schema.json",                      │
│  │     "experienceTerminology": "XP",               │                        │
│  │     "levelTerminology": "Level",                 │                        │
│  │     "maxLevel": 20,                              │                        │
│  │     "curveType": "Linear",                       │                        │
│  │     "baseXpRequirement": 100,                    │                        │
│  │     "xpMultiplier": 1.5,                         │                        │
│  │     "healOnLevelUp": true,                       │                        │
│  │     "defaultStatBonuses": {...},                 │                        │
│  │     "levels": [...]                              │                        │
│  │   }                                              │                        │
│  │                                                  │                        │
│  └── schemas/                                       │                        │
│      └── progression.schema.json ───────────────────┘                        │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {                                                  │
│              "StatBonuses": {...},                                           │
│              "LevelMilestone": {...}                                         │
│            }                                                                 │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Progression Schema Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/progression.schema.json`

The progression schema follows JSON Schema Draft-07 specification, providing comprehensive validation for level progression configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Progression Configuration",
    "description": "Schema for level progression and XP requirements. Defines how characters advance through levels, including XP curves, milestones, and stat bonuses.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "experienceTerminology": {
            "type": "string",
            "description": "Display name for experience points (e.g., 'XP', 'Experience', 'Essence')",
            "default": "XP",
            "minLength": 1,
            "maxLength": 50
        },
        "levelTerminology": {
            "type": "string",
            "description": "Display name for character level (e.g., 'Level', 'Rank', 'Tier')",
            "default": "Level",
            "minLength": 1,
            "maxLength": 50
        },
        "maxLevel": {
            "type": "integer",
            "description": "Maximum level a character can reach",
            "minimum": 1,
            "maximum": 100
        },
        "curveType": {
            "type": "string",
            "description": "The XP curve calculation method",
            "enum": ["Linear", "Exponential", "Custom"],
            "default": "Linear"
        },
        "baseXpRequirement": {
            "type": "integer",
            "description": "Base XP needed for level calculations",
            "minimum": 1
        },
        "xpMultiplier": {
            "type": "number",
            "description": "Multiplier used in Exponential curve calculations",
            "minimum": 1.0,
            "default": 1.5
        },
        "healOnLevelUp": {
            "type": "boolean",
            "description": "Whether characters are fully healed when they level up",
            "default": true
        },
        "defaultStatBonuses": {
            "$ref": "#/definitions/StatBonuses",
            "description": "Stat bonuses applied at each level (unless overridden by milestone)"
        },
        "levels": {
            "type": "array",
            "description": "Level milestone definitions for significant levels",
            "items": {
                "$ref": "#/definitions/LevelMilestone"
            }
        }
    },
    "required": ["maxLevel", "baseXpRequirement"],
    "additionalProperties": false,
    "definitions": {
        "StatBonuses": { ... },
        "LevelMilestone": { ... }
    }
}
```

### 4.2 StatBonuses Definition

The `StatBonuses` object defines stat increases applied when leveling up.

```json
"StatBonuses": {
    "type": "object",
    "description": "Stat bonuses applied when gaining a level",
    "properties": {
        "maxHealth": {
            "type": "integer",
            "description": "Maximum health increase per level",
            "minimum": 0,
            "default": 0
        },
        "attack": {
            "type": "integer",
            "description": "Attack stat increase per level",
            "minimum": 0,
            "default": 0
        },
        "defense": {
            "type": "integer",
            "description": "Defense stat increase per level",
            "minimum": 0,
            "default": 0
        }
    },
    "additionalProperties": false
}
```

### 4.3 LevelMilestone Definition

The `LevelMilestone` object represents a significant level with optional title, rewards, and stat overrides.

```json
"LevelMilestone": {
    "type": "object",
    "description": "A milestone at a specific level with optional title and rewards",
    "properties": {
        "level": {
            "type": "integer",
            "description": "The level number this milestone applies to",
            "minimum": 1
        },
        "title": {
            "type": "string",
            "description": "Optional title earned at this level (e.g., 'Veteran', 'Champion')",
            "minLength": 1,
            "maxLength": 100
        },
        "customRewards": {
            "type": "array",
            "description": "List of custom rewards or unlocks at this level",
            "items": {
                "type": "string",
                "minLength": 1
            }
        },
        "statOverrides": {
            "$ref": "#/definitions/StatBonuses",
            "description": "Optional stat bonuses that override defaults for this level"
        },
        "xpRequired": {
            "type": "integer",
            "description": "Custom XP required to reach this level (used with Custom curve type)",
            "minimum": 0
        }
    },
    "required": ["level"],
    "additionalProperties": false
}
```

---

## 5. XP Curve Configuration

### 5.1 Curve Type Enum

The `curveType` field accepts exactly three values:

| Curve Type | Description | When to Use |
|------------|-------------|-------------|
| `Linear` | XP requirements increase steadily | Predictable progression, casual games |
| `Exponential` | XP requirements grow exponentially | Extended end-game, MMO-style |
| `Custom` | XP defined per-level in milestones | Full control, unique progression |

**Validation Error Examples:**
```
Error: curveType must be one of: Linear, Exponential, Custom
Error: curveType "Logarithmic" is not a valid enum value
```

### 5.2 XP Calculation Formulas

| Curve Type | Formula | Example (baseXP=100, multiplier=1.5) |
|------------|---------|--------------------------------------|
| `Linear` | `baseXpRequirement × level` | Level 5: 500 XP |
| `Exponential` | `baseXpRequirement × (xpMultiplier ^ level)` | Level 5: ~759 XP |
| `Custom` | `LevelMilestone.xpRequired` | Defined per milestone |

**XP Progression Examples:**

```
LINEAR CURVE (baseXP = 100)
Level 1 → 2:    100 XP   (100 × 1)
Level 2 → 3:    200 XP   (100 × 2)
Level 5 → 6:    500 XP   (100 × 5)
Level 10 → 11:  1,000 XP (100 × 10)
Level 19 → 20:  1,900 XP (100 × 19)
Total to max:   19,000 XP

EXPONENTIAL CURVE (baseXP = 100, multiplier = 1.5)
Level 1 → 2:    150 XP   (100 × 1.5^1)
Level 2 → 3:    225 XP   (100 × 1.5^2)
Level 5 → 6:    759 XP   (100 × 1.5^5)
Level 10 → 11:  5,766 XP (100 × 1.5^10)
Level 19 → 20:  148,478 XP (100 × 1.5^19)
Total to max:   ~441,000 XP
```

---

## 6. Level Milestone Definitions

### 6.1 Milestone Structure

Level milestones mark significant progression points with titles and rewards.

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `level` | integer | Yes | The level number (1-maxLevel) |
| `title` | string | No | Title earned at this level |
| `customRewards` | array | No | List of rewards/unlocks |
| `statOverrides` | object | No | Override default stat bonuses |
| `xpRequired` | integer | No | Custom XP for this level (Custom curve) |

### 6.2 Custom Rewards

The `customRewards` array contains string descriptions of rewards earned at milestone levels.

**Current Progression Configuration (from progression.json):**

| Level | Title | Custom Rewards |
|-------|-------|----------------|
| 5 | Veteran | "Unlock: Advanced Training" |
| 10 | Elite | "Unlock: Mastery Skills" |
| 15 | Champion | "Unlock: Legendary Abilities" |
| 20 | Legend | "Maximum Level Reached!" |

**Reward String Examples:**
```json
"customRewards": [
    "Unlock: Advanced Training",
    "Bonus skill point",
    "New ability slot"
]
```

### 6.3 Stat Overrides

The `statOverrides` property allows specific levels to grant different stat bonuses than the defaults.

**Example: Bonus Stats at Milestone Level**
```json
{
    "level": 10,
    "title": "Elite",
    "customRewards": ["Unlock: Mastery Skills"],
    "statOverrides": {
        "maxHealth": 15,
        "attack": 3,
        "defense": 3
    }
}
```

When a milestone has `statOverrides`, those values replace the `defaultStatBonuses` for that level only.

---

## 7. Validation Rules

### 7.1 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `maxLevel` | 1-100 | "maxLevel must be >= 1 and <= 100" |
| `baseXpRequirement` | ≥1 | "baseXpRequirement must be >= 1" |
| `xpMultiplier` | ≥1.0 | "xpMultiplier must be >= 1.0" |
| `StatBonuses.maxHealth` | ≥0 | "maxHealth must be >= 0" |
| `StatBonuses.attack` | ≥0 | "attack must be >= 0" |
| `StatBonuses.defense` | ≥0 | "defense must be >= 0" |
| `LevelMilestone.level` | ≥1 | "level must be >= 1" |

### 7.2 Enum Validation

| Property | Valid Values | Validation Error |
|----------|--------------|------------------|
| `curveType` | `Linear`, `Exponential`, `Custom` | "curveType must be one of: Linear, Exponential, Custom" |

### 7.3 Required Fields

#### Root Object Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `maxLevel` | Must be present and in range | "missing required property 'maxLevel'" |
| `baseXpRequirement` | Must be present and positive | "missing required property 'baseXpRequirement'" |

**Optional Fields with Defaults:**
- `experienceTerminology` - Defaults to "XP"
- `levelTerminology` - Defaults to "Level"
- `curveType` - Defaults to "Linear"
- `xpMultiplier` - Defaults to 1.5
- `healOnLevelUp` - Defaults to true
- `defaultStatBonuses` - All zeros if not specified
- `levels` - Empty array if not specified

#### LevelMilestone Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `level` | Must be present and ≥1 | "missing required property 'level'" |

**Optional Fields:**
- `title` - No title displayed if absent
- `customRewards` - Empty if absent
- `statOverrides` - Uses defaults if absent
- `xpRequired` - Calculated from curve if absent

---

## 8. Configuration Schema

### Complete Progression Schema File

**File:** `config/schemas/progression.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Progression Configuration",
    "description": "Schema for level progression and XP requirements. Defines how characters advance through levels, including XP curves, milestones, and stat bonuses.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "experienceTerminology": {
            "type": "string",
            "description": "Display name for experience points (e.g., 'XP', 'Experience', 'Essence')",
            "default": "XP",
            "minLength": 1,
            "maxLength": 50
        },
        "levelTerminology": {
            "type": "string",
            "description": "Display name for character level (e.g., 'Level', 'Rank', 'Tier')",
            "default": "Level",
            "minLength": 1,
            "maxLength": 50
        },
        "maxLevel": {
            "type": "integer",
            "description": "Maximum level a character can reach",
            "minimum": 1,
            "maximum": 100
        },
        "curveType": {
            "type": "string",
            "description": "The XP curve calculation method",
            "enum": ["Linear", "Exponential", "Custom"],
            "default": "Linear"
        },
        "baseXpRequirement": {
            "type": "integer",
            "description": "Base XP needed for level calculations",
            "minimum": 1
        },
        "xpMultiplier": {
            "type": "number",
            "description": "Multiplier used in Exponential curve calculations",
            "minimum": 1.0,
            "default": 1.5
        },
        "healOnLevelUp": {
            "type": "boolean",
            "description": "Whether characters are fully healed when they level up",
            "default": true
        },
        "defaultStatBonuses": {
            "$ref": "#/definitions/StatBonuses",
            "description": "Stat bonuses applied at each level (unless overridden by milestone)"
        },
        "levels": {
            "type": "array",
            "description": "Level milestone definitions for significant levels",
            "items": {
                "$ref": "#/definitions/LevelMilestone"
            }
        }
    },
    "required": ["maxLevel", "baseXpRequirement"],
    "additionalProperties": false,
    "definitions": {
        "StatBonuses": {
            "type": "object",
            "description": "Stat bonuses applied when gaining a level",
            "properties": {
                "maxHealth": {
                    "type": "integer",
                    "description": "Maximum health increase per level",
                    "minimum": 0,
                    "default": 0
                },
                "attack": {
                    "type": "integer",
                    "description": "Attack stat increase per level",
                    "minimum": 0,
                    "default": 0
                },
                "defense": {
                    "type": "integer",
                    "description": "Defense stat increase per level",
                    "minimum": 0,
                    "default": 0
                }
            },
            "additionalProperties": false
        },
        "LevelMilestone": {
            "type": "object",
            "description": "A milestone at a specific level with optional title and rewards",
            "properties": {
                "level": {
                    "type": "integer",
                    "description": "The level number this milestone applies to",
                    "minimum": 1
                },
                "title": {
                    "type": "string",
                    "description": "Optional title earned at this level (e.g., 'Veteran', 'Champion')",
                    "minLength": 1,
                    "maxLength": 100
                },
                "customRewards": {
                    "type": "array",
                    "description": "List of custom rewards or unlocks at this level",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "statOverrides": {
                    "$ref": "#/definitions/StatBonuses",
                    "description": "Optional stat bonuses that override defaults for this level"
                },
                "xpRequired": {
                    "type": "integer",
                    "description": "Custom XP required to reach this level (used with Custom curve type)",
                    "minimum": 0
                }
            },
            "required": ["level"],
            "additionalProperties": false
        }
    }
}
```

---

## 9. Configuration File Updates

### Updated progression.json

The existing `progression.json` does not have a `$schema` reference. It needs to be added.

**File:** `config/progression.json`

Current (no schema):
```json
{
  "experienceTerminology": "XP",
  "levelTerminology": "Level",
  "maxLevel": 20,
  "curveType": "Linear",
  "baseXpRequirement": 100,
  "xpMultiplier": 1.5,
  "healOnLevelUp": true,
  "defaultStatBonuses": {
    "maxHealth": 5,
    "attack": 1,
    "defense": 1
  },
  "levels": [...]
}
```

Updated with schema reference:
```json
{
  "$schema": "./schemas/progression.schema.json",
  "experienceTerminology": "XP",
  "levelTerminology": "Level",
  "maxLevel": 20,
  "curveType": "Linear",
  "baseXpRequirement": 100,
  "xpMultiplier": 1.5,
  "healOnLevelUp": true,
  "defaultStatBonuses": {
    "maxHealth": 5,
    "attack": 1,
    "defense": 1
  },
  "levels": [
    {
      "level": 5,
      "title": "Veteran",
      "customRewards": ["Unlock: Advanced Training"]
    },
    {
      "level": 10,
      "title": "Elite",
      "customRewards": ["Unlock: Mastery Skills"]
    },
    {
      "level": 15,
      "title": "Champion",
      "customRewards": ["Unlock: Legendary Abilities"]
    },
    {
      "level": 20,
      "title": "Legend",
      "customRewards": ["Maximum Level Reached!"]
    }
  ]
}
```

### Validation Confirmation

The existing configuration validates successfully against the schema:

| Property | Value | Valid |
|----------|-------|-------|
| `maxLevel` | 20 | Yes (1-100) |
| `curveType` | "Linear" | Yes (enum) |
| `baseXpRequirement` | 100 | Yes (≥1) |
| `xpMultiplier` | 1.5 | Yes (≥1.0) |
| `healOnLevelUp` | true | Yes (boolean) |
| `defaultStatBonuses.maxHealth` | 5 | Yes (≥0) |
| `defaultStatBonuses.attack` | 1 | Yes (≥0) |
| `defaultStatBonuses.defense` | 1 | Yes (≥0) |
| `levels[0].level` | 5 | Yes (≥1) |
| `levels[1].level` | 10 | Yes (≥1) |
| `levels[2].level` | 15 | Yes (≥1) |
| `levels[3].level` | 20 | Yes (≥1) |

---

## 10. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file for validation. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file added, one config file updated |

### Schema as Documentation

The schema serves as:
- **Validation contract** for progression configuration
- **IDE documentation** via description fields
- **Modding reference** for custom progression systems
- **Design specification** for progression mechanics

---

## 11. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 12. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Curve Type Enum Validation | ~1 |
| Max Level Range Validation | ~1 |
| Existing Configuration Validation | ~1 |
| **Total** | **~4** |

### Test Descriptions

#### ProgressionSchemaTests.cs

```csharp
[TestFixture]
public class ProgressionSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the existing progression.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void ExistingProgressionJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies curveType must be a valid enum value.
    /// </summary>
    [Test]
    public void CurveType_InvalidEnumValue_FailsValidation();

    /// <summary>
    /// Verifies maxLevel must be within valid range (1-100).
    /// </summary>
    [Test]
    public void MaxLevel_OutOfRange_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 13. Use Cases

### UC-001: Load Progression Configuration

**Actor:** Game System
**Flow:** System starts → Loads `progression.json` → Schema validates content → Progression rules available for XP and leveling

### UC-002: Edit Progression in IDE

**Actor:** Developer/Modder
**Flow:** Opens `progression.json` in VS Code → IDE loads schema → Autocomplete suggests properties → Validation errors shown inline

### UC-003: Change XP Curve Type

**Actor:** Modder
**Flow:** Changes `curveType` from "Linear" to "Exponential" → IDE validates enum value → Game uses exponential XP calculations

### UC-004: Add Level Milestone

**Actor:** Modder
**Flow:** Adds new milestone object to `levels` array → IDE validates level number → Milestone title and rewards configured

### UC-005: Invalid Max Level

**Actor:** Modder
**Flow:** Sets `maxLevel: 500` → IDE shows error "maxLevel must be <= 100" → Modder corrects to valid value

### UC-006: Configure Custom Terminology

**Actor:** Modder
**Flow:** Changes `experienceTerminology` to "Essence" and `levelTerminology` to "Rank" → Game displays "Essence" instead of "XP"

---

## 14. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/progression.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all defined properties
- [ ] Schema includes definitions section (StatBonuses, LevelMilestone)

### Validation Rules
- [ ] Max level range validation: 1-100
- [ ] Curve type enum validation: Linear, Exponential, Custom
- [ ] Base XP requirement minimum: 1
- [ ] XP multiplier minimum: 1.0
- [ ] Stat bonuses minimum: 0
- [ ] Level milestone level minimum: 1
- [ ] Required fields enforced
- [ ] Optional fields have defaults

### Configuration Updates
- [ ] `progression.json` $schema reference added as `./schemas/progression.schema.json`
- [ ] Existing `progression.json` validates against schema

### Testing
- [ ] ~4 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 15. Acceptance Criteria

### Functional
- [ ] `progression.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `progression.json` without errors
- [ ] Curve type enum validated (Linear, Exponential, Custom)
- [ ] Max level range validated (1-100)
- [ ] Base XP requirement validated (≥1)
- [ ] XP multiplier validated (≥1.0)
- [ ] Stat bonuses validated (≥0)
- [ ] Level milestone level validated (≥1)
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~4 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 16. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `progression.json` | `config/progression.json` | Validated by new schema |
| Schema patterns | `config/schemas/*.schema.json` | Reference for schema structure |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `progression.schema.json` | Validates progression configuration |
| XP curve pattern | Can be extended for custom curve formulas |
| Milestone pattern | Can be extended for ability unlocks |

### Implementation Order Note

**v0.14.0e is the final part of the Character Configuration Schemas series.** It has no dependencies on other v0.14.0 parts and can be implemented in any order relative to them.

Complete v0.14.0 implementation order:
1. v0.14.0d - Skill & Archetype Schemas (provides archetype dependency)
2. v0.14.0a - Race Schema
3. v0.14.0b - Class Schema (requires v0.14.0d for archetype reference)
4. v0.14.0c - Background Schema
5. v0.14.0e - Progression Schema (this version)

---

## 17. Future Considerations

### Deferred to Future Versions

- **Ability point allocation rules**: Points earned per level for ability upgrades
- **Prestige/multiclass mechanics**: Resetting progression or splitting levels
- **Custom XP formula expressions**: User-defined formula strings
- **Per-milestone XP validation**: Ensuring Custom curve has xpRequired for all levels

### Out of Scope

- **Runtime schema validation**: Application-level validation at load time (handled by existing provider patterns)
- **Schema versioning migration**: Automatic migration between schema versions
- **Level-up event handling**: Runtime mechanics when leveling (domain logic, not schema)
- **XP gain/loss mechanics**: How XP is earned or lost (game systems, not schema)
- **Level cap increases**: Dynamically raising maxLevel (runtime feature)

### Potential Future Enhancements

If the progression system expands, consider adding:
- `attributePointsPerLevel` - Attribute points to distribute
- `abilityPointsPerLevel` - Ability upgrade points
- `unlockedAbilities` - Array of ability IDs unlocked at milestone
- `requiredQuest` - Quest completion requirement for milestone
- `alternativeCurves` - Multiple curve definitions for different modes

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
