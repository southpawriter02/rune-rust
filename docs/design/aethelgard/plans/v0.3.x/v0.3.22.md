# v0.3.22: The Tactician II (Combat Polish)

**Milestone:** 5 (v0.3.x)
**Status:** Planned
**Previous:** [v0.3.21](./v0.3.21.md)
**Next:** [v0.3.23](./v0.3.23.md)

## Overview
**"The Tactician II"** refines the combat experience by giving players control over the flow of information. It addresses the "wall of text" problem in the combat log and provides deep tactical insights into enemies, rewarding the "Knowledge as Power" pillar of the Jötun-Reader and Adept archetypes.

This milestone is divided into three granular sub-plans to manage complexity:

### [v0.3.22a: The Filter (Log Customization)](./v0.3.22a.md)
*   **Goal:** Tame the "wall of text".
*   **Key Deliverables:**
    *   Structured `CombatLogEntry` model.
    *   `GameSettings` filters for Mechanics/Flavor.
    *   Renderer logic to hide/show categories.

### [v0.3.22b: The Inspector (Analysis Engine)](./v0.3.22b.md)
*   **Goal:** Gamify information gathering using the Codex.
*   **Key Deliverables:**
    *   `inspect` command.
    *   `AnalysisService` linking Combat to Codex/DataCapture.
    *   Visual "Intel" popup/panel.

### [v0.3.22c: The Forecast (Predictive UI)](./v0.3.22c.md)
*   **Goal:** Remove mental math and clarify risks.
*   **Key Deliverables:**
    *   Predictive calculation logic ("Dry Run").
    *   Forecast UI bar (Hit %, Dmg Range).
    *   Integration with `KnowledgeTier` (fog of war).

---

## Logging Requirements
*Reference: `logging.md`*

| System | Event | Level | Message Template | Properties |
|--------|-------|-------|------------------|------------|
| Analysis | Inspect | Info | `[Combat] Inspected {Target}. Knowledge Level: {Tier}.` | `Target`, `Tier` |
| UI | Filter | Trace | `[UI] Filtered {Count} log entries based on settings.` | `Count` |
| Combat | Forecast | Trace | `[Combat] Forecast vs {Target}: {Hit}% Hit, {Min}-{Max} Dmg.` | `Target`, `Hit`, `Min`, `Max` |

## Testing Strategy
Each sub-plan contains specific unit and integration test requirements.
*   **Core Logic:** Unit tests for `AnalysisService` and `AttackResolutionService`.
*   **Visuals:** Manual verification of TUI rendering and filter toggles.

## Changelog Draft
```markdown
# Changelog: v0.3.22 - The Tactician II

**Release Date:** 2026-03-XX

## Summary
"The Tactician II" refines the combat interface, giving players the tools to analyze their foes and filter the noise of battle. Knowledge gathered via the Codex now directly impacts tactical clarity.

## Changes
- **Log Filtering:** Added options to hide dice rolls or flavor text in the combat log.
- **Inspect Command:** Use `inspect <target>` to view enemy stats. Detailed info requires unlocking Bestiary entries.
- **Combat Forecast:** Highlighting an action now displays estimated Hit Chance and Damage Range.
- **Jötun-Reader Bonus:** Adept characters automatically perceive higher-tier intel when inspecting enemies.
```
