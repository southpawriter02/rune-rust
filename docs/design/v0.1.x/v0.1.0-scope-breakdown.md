# v0.1.0 Expanded Dungeon & Z-Axis - Scope Breakdown

**Version:** 0.1.0
**Theme:** Expanded Dungeon & Z-Axis
**Prerequisites:** v0.0.11 Complete (Descriptors & Ambience)
**Total Estimated Tests:** ~85 new tests

---

## Executive Summary

The Expanded Dungeon & Z-Axis version transforms the current static, single-level dungeon into a dynamic, multi-level procedurally generated exploration experience. This version adds vertical movement (stairs/ladders), procedural room generation, room type variety, hidden passage discovery, and player mapping capabilities.

Key focus areas:
- **Z-Axis Movement**: Vertical exploration via stairs and ladders between dungeon levels
- **Procedural Generation**: Dynamic room creation as players explore uncharted areas
- **Room Type Variety**: Treasure rooms, trap rooms, boss rooms, safe rooms with distinct behaviors
- **Hidden Passages**: Discoverable secret exits requiring skill checks to find
- **Player Mapping**: ASCII map visualization of explored dungeon areas
- **Depth Scaling**: Deeper levels feature harder enemies and better loot

The work is divided into **four sub-phases**:

| Phase | Name | Focus | Est. Tests |
|-------|------|-------|------------|
| v0.1.0a | Z-Axis Foundation | Position3D, Direction enum expansion, vertical connections | ~18 |
| v0.1.0b | Procedural Room Generation | Room templates, generation service, biome integration | ~25 |
| v0.1.0c | Room Types & Hidden Passages | Room types, search mechanic, hidden exits, discovery | ~22 |
| v0.1.0d | Map Command & Polish | ASCII map generation, exploration tracking, integration | ~20 |

---

## Existing Infrastructure

### Already Implemented

| Feature | Location | Notes |
|---------|----------|-------|
| Position (2D) | `Domain/ValueObjects/Position.cs` | X, Y coordinates, Move method |
| Direction enum | `Domain/Enums/Direction.cs` | North, South, East, West |
| Room entity | `Domain/Entities/Room.cs` | Name, Description, Position, Exits, Items, Monsters |
| Dungeon entity | `Domain/Entities/Dungeon.cs` | Room collection, ConnectRooms, GetRoomByPosition |
| EnvironmentContext | `Domain/ValueObjects/EnvironmentContext.cs` | Biome, climate, lighting context |
| BiomeConfiguration | `config/biomes.json` | 8 biome definitions with defaults |
| DescriptorService | `Application/Services/DescriptorService.cs` | Environment-aware descriptions |
| GameSession | `Domain/Entities/GameSession.cs` | Player state, visited rooms tracking |

### Needs Implementation (v0.1.0)

| Feature | Phase | Notes |
|---------|-------|-------|
| Position3D value object | v0.1.0a | Extend Position with Z coordinate |
| Up/Down directions | v0.1.0a | Add to Direction enum |
| Vertical room connections | v0.1.0a | Stairs, ladders between Z-levels |
| Room templates | v0.1.0b | Configurable room generation patterns |
| Procedural generation service | v0.1.0b | Dynamic room creation on exploration |
| RoomType enum | v0.1.0c | Standard, Treasure, Trap, Boss, Safe |
| Hidden exits | v0.1.0c | Discoverable secret passages |
| Search command | v0.1.0c | Player action to find hidden content |
| ASCII map generation | v0.1.0d | Visual map of explored rooms |
| Exploration tracking | v0.1.0d | Per-room discovered/explored state |

---

## Feature Analysis & Categorization

### Foundation Features

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Position3D value object | Medium | Position | **v0.1.0a** |
| Direction enum expansion | Low | Direction | **v0.1.0a** |
| Vertical exit connections | Medium | Room, Dungeon | **v0.1.0a** |
| GetOppositeDirection update | Low | Direction | **v0.1.0a** |
| Room Z-level property | Low | Room | **v0.1.0a** |

### Generation Features

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Room templates | High | BiomeConfiguration | **v0.1.0b** |
| RoomGeneratorService | High | Templates, EnvironmentContext | **v0.1.0b** |
| Connection rules | Medium | RoomGeneratorService | **v0.1.0b** |
| Depth difficulty scaling | Medium | Monster/Loot systems | **v0.1.0b** |
| On-demand room creation | High | RoomGeneratorService | **v0.1.0b** |

### Discovery Features

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| RoomType enum | Low | None | **v0.1.0c** |
| Room type behaviors | Medium | RoomType | **v0.1.0c** |
| Hidden exit property | Medium | Room | **v0.1.0c** |
| Search command | Medium | GameSessionService | **v0.1.0c** |
| Discovery dice checks | Medium | Dice system | **v0.1.0c** |
| Hidden item discovery | Low | Search command | **v0.1.0c** |

### Mapping Features

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Exploration state tracking | Medium | Room, GameSession | **v0.1.0d** |
| ASCII map renderer | High | Dungeon, Position3D | **v0.1.0d** |
| Map command handler | Low | MapRenderer | **v0.1.0d** |
| Multi-level map display | Medium | Z-axis | **v0.1.0d** |
| Room symbol mapping | Low | RoomType | **v0.1.0d** |

---

## Phase Definitions

---

## v0.1.0a: Z-Axis Foundation

### Overview

Extend the dungeon coordinate system to support vertical movement. Add Up and Down directions, create a Position3D value object (or extend Position), and enable rooms to connect across Z-levels via stairs and ladders.

### Scope

**In Scope:**
- Extend `Position` to include Z coordinate (or create `Position3D`)
- Add `Up` and `Down` to `Direction` enum
- Update `GetOppositeDirection` to handle Up↔Down
- Add `StairType` enum (StairsUp, StairsDown, Ladder, Shaft)
- Vertical room connection support in `Dungeon.ConnectRooms`
- Room-level Z coordinate property
- Movement commands: `up`, `down`, `climb`, `descend`
- Update starter dungeon with a second level

**Out of Scope:**
- Procedural generation (v0.1.0b)
- Room types (v0.1.0c)
- Map display (v0.1.0d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Value Objects | 1 | `Position3D` (or extend `Position`) |
| Enums | 2 | `Direction` update, `StairType` |
| Entity Updates | 2 | `Room`, `Dungeon` vertical support |
| Commands | 2 | `up`/`down` movement |
| Configuration | 0 | None required |
| Unit Tests | ~18 | Position, Direction, vertical movement |

### Position3D Design

```csharp
/// <summary>
/// Represents a 3D position in the dungeon grid.
/// </summary>
/// <param name="X">Horizontal coordinate (positive = east).</param>
/// <param name="Y">Vertical coordinate (positive = north).</param>
/// <param name="Z">Depth coordinate (positive = deeper underground).</param>
public readonly record struct Position3D(int X, int Y, int Z)
{
    public static Position3D Origin => new(0, 0, 0);

    public Position3D Move(int deltaX, int deltaY, int deltaZ) =>
        new(X + deltaX, Y + deltaY, Z + deltaZ);

    public Position3D MoveUp() => new(X, Y, Z - 1);
    public Position3D MoveDown() => new(X, Y, Z + 1);

    // Convert to/from 2D for compatibility
    public Position ToPosition2D() => new(X, Y);
    public static Position3D FromPosition2D(Position pos, int z = 0) =>
        new(pos.X, pos.Y, z);
}
```

### Direction Enum Extension

```csharp
public enum Direction
{
    North,
    South,
    East,
    West,
    Up,    // NEW: Toward surface (Z - 1)
    Down   // NEW: Toward depths (Z + 1)
}
```

### Vertical Connection Types

| Type | Description | Bidirectional |
|------|-------------|---------------|
| StairsUp | Standard stairs going up | Yes |
| StairsDown | Standard stairs going down | Yes |
| Ladder | Vertical ladder | Yes |
| Shaft | Open vertical shaft (may require climbing) | Yes |
| Pit | One-way drop (down only) | No |

### Acceptance Criteria

- [ ] Position3D value object created with X, Y, Z coordinates
- [ ] Direction enum includes Up and Down values
- [ ] GetOppositeDirection returns Down for Up and vice versa
- [ ] Rooms can connect vertically via Up/Down exits
- [ ] Player can move between Z-levels using up/down commands
- [ ] Starter dungeon includes at least one lower level
- [ ] ~18 unit tests pass

---

## v0.1.0b: Procedural Room Generation

### Overview

Implement a procedural room generation system that creates rooms dynamically as players explore. Use room templates configured per biome, apply depth-based difficulty scaling, and integrate with the existing environment context system.

### Scope

**In Scope:**
- `RoomTemplate` configuration class
- `RoomGeneratorService` for procedural creation
- Biome-specific room templates
- Depth-based difficulty scaling (deeper = harder)
- On-demand room generation when moving to unexplored coordinates
- Connection probability rules (not every direction has an exit)
- Integration with `EnvironmentContext` and descriptors
- Monster placement based on depth/biome
- Item placement based on room template

**Out of Scope:**
- Room types beyond "standard" (v0.1.0c)
- Hidden passages (v0.1.0c)
- Map visualization (v0.1.0d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Configuration | 2 | `room-templates.json`, `generation-rules.json` |
| Services | 1 | `RoomGeneratorService` |
| Entity Updates | 1 | `Dungeon` procedural support |
| Unit Tests | ~25 | Generation, scaling, template tests |

### Room Template Structure

```json
{
  "templates": {
    "dungeon_corridor": {
      "id": "dungeon_corridor",
      "biomes": ["dungeon", "cave", "ruins"],
      "names": ["Dark Corridor", "Stone Passage", "Dusty Hallway"],
      "descriptionPools": ["dungeon_corridor_descriptions"],
      "exitProbabilities": {
        "north": 0.6,
        "south": 0.6,
        "east": 0.4,
        "west": 0.4,
        "up": 0.1,
        "down": 0.15
      },
      "monsterChance": 0.3,
      "itemChance": 0.15,
      "weight": 40
    },
    "dungeon_chamber": {
      "id": "dungeon_chamber",
      "biomes": ["dungeon"],
      "names": ["Ancient Chamber", "Forgotten Hall", "Dusty Room"],
      "descriptionPools": ["dungeon_chamber_descriptions"],
      "exitProbabilities": {
        "north": 0.5,
        "south": 0.5,
        "east": 0.5,
        "west": 0.5,
        "up": 0.05,
        "down": 0.1
      },
      "monsterChance": 0.4,
      "itemChance": 0.25,
      "weight": 30
    }
  }
}
```

### Generation Rules

```json
{
  "generationRules": {
    "maxRoomsPerLevel": 50,
    "minExitsPerRoom": 1,
    "maxExitsPerRoom": 4,
    "depthDifficultyMultiplier": 0.15,
    "depthLootQualityMultiplier": 0.1,
    "stairsDownChanceBase": 0.08,
    "stairsUpGuaranteedIfDeep": true,
    "biomeTransitionDepths": {
      "dungeon": [0, 3],
      "cave": [2, 6],
      "volcanic": [5, 10]
    }
  }
}
```

### Depth Difficulty Scaling

| Depth (Z) | Monster Level Modifier | Loot Quality Modifier | New Biome Chance |
|-----------|------------------------|----------------------|------------------|
| 0 (Surface) | +0 | +0% | Base biome |
| 1-2 | +1 | +10% | 10% cave |
| 3-4 | +2 | +20% | 20% cave |
| 5-6 | +3 | +35% | 15% volcanic |
| 7+ | +4 | +50% | 25% volcanic |

### RoomGeneratorService Interface

```csharp
public interface IRoomGeneratorService
{
    /// <summary>
    /// Generates a new room at the specified position.
    /// </summary>
    Room GenerateRoom(Position3D position, string biomeId, int seed);

    /// <summary>
    /// Gets or generates a room when player moves to unexplored position.
    /// </summary>
    Room GetOrGenerateRoom(Dungeon dungeon, Position3D position);

    /// <summary>
    /// Determines which exits a generated room should have.
    /// </summary>
    IEnumerable<Direction> DetermineExits(Position3D position, RoomTemplate template, int seed);

    /// <summary>
    /// Calculates difficulty modifier for a given depth.
    /// </summary>
    float GetDepthDifficultyModifier(int depth);
}
```

### Acceptance Criteria

- [ ] Room templates load from configuration
- [ ] RoomGeneratorService creates rooms from templates
- [ ] Rooms generate dynamically when moving to unexplored positions
- [ ] Exit probabilities respected in generation
- [ ] Deeper levels have harder monsters
- [ ] Deeper levels have better loot chances
- [ ] Biome transitions occur at configured depths
- [ ] Generated rooms integrate with EnvironmentContext
- [ ] ~25 unit tests pass

---

## v0.1.0c: Room Types & Hidden Passages

### Overview

Add room type variety (treasure rooms, trap rooms, boss rooms, safe rooms) and implement hidden passage discovery mechanics. Players can use the `search` command to find hidden exits and items.

### Scope

**In Scope:**
- `RoomType` enum (Standard, Treasure, Trap, Boss, Safe, Shrine)
- Room type property on `Room` entity
- Room type behaviors (traps trigger, safe rooms no monsters)
- `IsHidden` property on exits
- `IsDiscovered` property on exits
- `Search` command for finding hidden content
- Dice check for discovery (Perception or Investigation)
- Hidden item discovery
- Room type indicators in room descriptions

**Out of Scope:**
- Trap mechanics implementation (future version)
- Boss encounter scripting (future version)
- Map display (v0.1.0d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Enums | 1 | `RoomType` |
| Value Objects | 1 | `Exit` (replaces Guid in dictionary) |
| Entity Updates | 1 | `Room` with type and exit visibility |
| Commands | 1 | `search` command |
| Configuration | 1 | `room-types.json` |
| Unit Tests | ~22 | Room types, search, discovery tests |

### RoomType Enum

```csharp
public enum RoomType
{
    /// <summary>Standard room with normal encounters.</summary>
    Standard,

    /// <summary>Contains valuable loot, may be guarded.</summary>
    Treasure,

    /// <summary>Contains traps that trigger on entry or interaction.</summary>
    Trap,

    /// <summary>Contains a powerful boss monster.</summary>
    Boss,

    /// <summary>Safe haven - no monsters spawn, may have services.</summary>
    Safe,

    /// <summary>Religious/magical site with special interactions.</summary>
    Shrine
}
```

### Exit Value Object

```csharp
/// <summary>
/// Represents an exit from a room with visibility state.
/// </summary>
public readonly record struct Exit
{
    /// <summary>Target room ID.</summary>
    public Guid TargetRoomId { get; init; }

    /// <summary>Whether this exit is hidden and requires discovery.</summary>
    public bool IsHidden { get; init; }

    /// <summary>Whether this exit has been discovered by the player.</summary>
    public bool IsDiscovered { get; init; }

    /// <summary>Description hint for hidden exits (e.g., "draft of air").</summary>
    public string? HiddenHint { get; init; }

    /// <summary>Difficulty class for discovery check.</summary>
    public int DiscoveryDC { get; init; }

    /// <summary>Type of vertical connection if applicable.</summary>
    public StairType? StairType { get; init; }

    public static Exit Standard(Guid targetId) => new()
    {
        TargetRoomId = targetId,
        IsHidden = false,
        IsDiscovered = true,
        DiscoveryDC = 0
    };

    public static Exit Hidden(Guid targetId, int dc, string? hint = null) => new()
    {
        TargetRoomId = targetId,
        IsHidden = true,
        IsDiscovered = false,
        DiscoveryDC = dc,
        HiddenHint = hint
    };
}
```

### Search Command

```
> search
You carefully examine your surroundings...
[Perception check: 14 vs DC 12 - Success!]
You notice a slight draft coming from behind a bookshelf to the east.
A hidden passage has been revealed!

> search
You search the room thoroughly...
[Perception check: 8 vs DC 15 - Failure]
You don't find anything unusual.
```

### Room Type Behaviors

| Type | Entry Behavior | Monster Spawn | Special |
|------|----------------|---------------|---------|
| Standard | None | Normal | - |
| Treasure | None | Guarded (50%) | Extra loot |
| Trap | Trigger check | Ambush possible | Damage/status |
| Boss | Warning text | Boss monster | Locked exits until clear |
| Safe | Healing available | Never | Rest mechanics |
| Shrine | Blessing offered | Rare guardians | Deity interactions |

### Acceptance Criteria

- [ ] RoomType enum defined with 6 types
- [ ] Room entity has RoomType property
- [ ] Exit value object replaces raw Guid in exits dictionary
- [ ] Hidden exits not shown in room description until discovered
- [ ] Search command performs discovery check
- [ ] Successful search reveals hidden exits
- [ ] Hidden items can be discovered via search
- [ ] Room type affects room description
- [ ] ~22 unit tests pass

---

## v0.1.0d: Map Command & Polish

### Overview

Implement ASCII map visualization showing explored rooms, add comprehensive exploration state tracking, and integrate all v0.1.0 systems for a polished multi-level dungeon experience.

### Scope

**In Scope:**
- `ExplorationState` per room (Unexplored, Visited, Cleared)
- `MapRendererService` for ASCII map generation
- `map` command showing current level
- `map all` showing all explored levels
- Room symbols based on type and state
- Player position indicator
- Exit indicators (|, -, etc.)
- Level indicator in map display
- Integration testing for all v0.1.0 features

**Out of Scope:**
- Graphical map (future GUI version)
- Minimap in TUI (future enhancement)
- Auto-mapping during movement (always on)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Enums | 1 | `ExplorationState` |
| Services | 1 | `MapRendererService` |
| Commands | 1 | `map` command with options |
| Entity Updates | 1 | `Room` exploration state |
| Unit Tests | ~20 | Map rendering, exploration tests |

### ExplorationState Enum

```csharp
public enum ExplorationState
{
    /// <summary>Room exists but player hasn't been there.</summary>
    Unexplored,

    /// <summary>Player has entered the room.</summary>
    Visited,

    /// <summary>Room fully explored (searched, monsters defeated).</summary>
    Cleared
}
```

### ASCII Map Symbols

| Symbol | Meaning |
|--------|---------|
| `@` | Player current position |
| `#` | Standard room (visited) |
| `$` | Treasure room |
| `!` | Trap room |
| `B` | Boss room |
| `+` | Safe room |
| `*` | Shrine |
| `?` | Unexplored (adjacent known) |
| `.` | Corridor/passage |
| `─` | Horizontal connection |
| `│` | Vertical connection |
| `↑` | Stairs up |
| `↓` | Stairs down |
| `≡` | Ladder |

### Map Command Output

```
> map
=== The Forgotten Depths - Level 1 (Z=0) ===

        ?
        │
    ?───#───$
        │
    +───@───#───?
        │
        #
        ↓

Legend: @ You  # Room  $ Treasure  + Safe  ? Unexplored
        ↑↓ Stairs  ─│ Passages

Rooms explored: 5/12 on this level
```

### Multi-Level Map

```
> map all

=== Level 0 (Surface) ===
    #───#
    │
    @───#

=== Level 1 ===
    #───#───?
    ↑
    #───#
        │
        ?

Current position: Level 0, (0, 0)
Total rooms explored: 8
```

### MapRendererService Interface

```csharp
public interface IMapRendererService
{
    /// <summary>
    /// Renders ASCII map for the specified dungeon level.
    /// </summary>
    string RenderLevel(Dungeon dungeon, int z, Position3D playerPosition);

    /// <summary>
    /// Renders ASCII map for all explored levels.
    /// </summary>
    string RenderAllLevels(Dungeon dungeon, Position3D playerPosition);

    /// <summary>
    /// Gets the symbol for a room based on type and state.
    /// </summary>
    char GetRoomSymbol(Room room, bool isPlayerHere);

    /// <summary>
    /// Generates legend text for map symbols.
    /// </summary>
    string GetLegend();
}
```

### Acceptance Criteria

- [ ] ExplorationState enum tracks room exploration
- [ ] Rooms track their exploration state
- [ ] Map command renders ASCII map of current level
- [ ] Map shows player position with @ symbol
- [ ] Room types shown with distinct symbols
- [ ] Connections shown between adjacent rooms
- [ ] Stairs/ladders indicated on map
- [ ] Unexplored adjacent rooms shown as ?
- [ ] Multi-level map option available
- [ ] Legend explains symbols
- [ ] ~20 unit tests pass

---

## Dependencies & Prerequisites

```
v0.0.11 (Descriptors & Ambience) - REQUIRED
    │
    └── EnvironmentContext, BiomeConfiguration, DescriptorService ───┐
                                                                      │
                                                                      ▼
v0.1.0 (Expanded Dungeon & Z-Axis)
    │
    ├── v0.1.0a: Z-Axis Foundation ───────────────────────────────────┐
    │       Dependencies: None (extends existing Position/Direction)  │
    │                                                                 │
    ├── v0.1.0b: Procedural Room Generation ──────────────────────────┤
    │       Dependencies: v0.1.0a (Position3D, vertical directions)   │
    │                     v0.0.11a (EnvironmentContext, biomes)       │
    │                     v0.0.9 (Monster/Loot systems)               │
    │                                                                 │
    ├── v0.1.0c: Room Types & Hidden Passages ────────────────────────┤
    │       Dependencies: v0.1.0a (Direction enum)                    │
    │                     v0.1.0b (room generation)                   │
    │                                                                 │
    └── v0.1.0d: Map Command & Polish ────────────────────────────────┘
            Dependencies: v0.1.0a, v0.1.0b, v0.1.0c
```

**Note:** v0.1.0b and v0.1.0c can be partially parallelized after v0.1.0a is complete. v0.1.0d integrates all previous phases.

---

## Estimated Effort Summary

| Phase | New Files | Modified Files | Est. Tests | Complexity |
|-------|-----------|----------------|------------|------------|
| v0.1.0a | ~5 | ~4 | ~18 | Medium |
| v0.1.0b | ~6 | ~3 | ~25 | High |
| v0.1.0c | ~4 | ~3 | ~22 | Medium |
| v0.1.0d | ~3 | ~4 | ~20 | Medium |
| **Total** | **~18** | **~14** | **~85** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Position3D breaks existing code | High | Medium | Careful migration, backwards compat |
| Procedural generation creates invalid dungeons | Medium | Medium | Validation, minimum connectivity rules |
| Hidden passages too easy/hard to find | Low | Medium | Configurable DC, playtesting |
| Map rendering performance | Low | Low | Caching, viewport limiting |
| Direction enum change breaks serialization | Medium | Low | Explicit enum values |

---

## Design Decisions

### Position System

| Decision | Value | Notes |
|----------|-------|-------|
| **Position approach** | Extend to Position3D | Full replacement for consistency |
| **Z coordinate meaning** | Positive = deeper | Matches "going down into dungeon" |
| **Origin Z level** | 0 | Surface/entrance level |
| **Max depth** | Configurable (default 10) | Prevents infinite generation |

### Procedural Generation

| Decision | Value | Notes |
|----------|-------|-------|
| **Generation timing** | On-demand (lazy) | Generate when player approaches |
| **Seed source** | Position-based deterministic | Same position = same room |
| **Minimum connectivity** | 1 exit (back) guaranteed | No dead ends without retreat |
| **Template selection** | Weighted random per biome | Variety within consistency |

### Room Types

| Decision | Value | Notes |
|----------|-------|-------|
| **Type assignment** | Template + random | Templates suggest types |
| **Hidden exit frequency** | 10-20% of rooms | Reward exploration |
| **Discovery mechanic** | Perception/Investigation DC | Uses existing dice system |
| **Boss room frequency** | 1 per 2-3 levels | Milestone encounters |

### Map Display

| Decision | Value | Notes |
|----------|-------|-------|
| **Map style** | ASCII grid | TUI compatible |
| **Unexplored visibility** | Adjacent only | Fog of war |
| **Multi-level display** | Stacked vertically | Clear level separation |
| **Auto-update** | On room change | Always current |

---

## Files Summary

### Files to Create (New)

| Phase | File | Purpose |
|-------|------|---------|
| 0a | `Position3D.cs` | 3D coordinate value object |
| 0a | `StairType.cs` | Vertical connection types |
| 0a | `Exit.cs` | Exit value object with visibility |
| 0b | `RoomTemplate.cs` | Room generation template |
| 0b | `RoomGeneratorService.cs` | Procedural generation |
| 0b | `GenerationConfiguration.cs` | Generation rules |
| 0b | `config/room-templates.json` | Template definitions |
| 0b | `config/generation-rules.json` | Generation parameters |
| 0c | `RoomType.cs` | Room type enum |
| 0c | `SearchService.cs` | Hidden discovery logic |
| 0c | `config/room-types.json` | Type behaviors |
| 0d | `ExplorationState.cs` | Exploration tracking enum |
| 0d | `MapRendererService.cs` | ASCII map generation |

### Files to Modify

| Phase | File | Changes |
|-------|------|---------|
| 0a | `Direction.cs` | Add Up, Down values |
| 0a | `Room.cs` | Use Position3D, Exit objects |
| 0a | `Dungeon.cs` | Update ConnectRooms, GetOppositeDirection |
| 0a | `GameSession.cs` | Position3D player position |
| 0b | `Dungeon.cs` | Integration with RoomGeneratorService |
| 0b | `GameSessionService.cs` | On-demand generation on move |
| 0c | `Room.cs` | Add RoomType, search support |
| 0c | `GameSessionService.cs` | Search command handler |
| 0d | `Room.cs` | Add ExplorationState |
| 0d | `GameSessionService.cs` | Map command handler |
| 0d | `CommandParser.cs` | New commands (map, search) |

---

## Final Metrics

| Metric | Before v0.1.0 | After v0.1.0 |
|--------|---------------|--------------|
| Position dimensions | 2 (X, Y) | 3 (X, Y, Z) |
| Direction values | 4 | 6 |
| Room types | 1 (implicit) | 6 |
| Dungeon levels | 1 (static) | 10+ (dynamic) |
| Room generation | Static factory | Procedural service |
| Hidden content | 0 | Hidden exits, items |
| Player commands | ~15 | ~17 (+map, search) |
| Unit tests (dungeon) | ~20 | ~105 |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.1.0a Design Spec** - Create Z-axis foundation specification
3. **Implement v0.1.0a** - Build vertical movement foundation
4. **v0.1.0b Design Spec** - Create procedural generation specification
5. **Implement v0.1.0b** - Build room generation service
6. **v0.1.0c Design Spec** - Create room types specification
7. **Implement v0.1.0c** - Build discovery mechanics
8. **v0.1.0d Design Spec** - Create map command specification
9. **Implement v0.1.0d** - Build map and integrate

---

*This scope breakdown establishes a comprehensive multi-level procedurally generated dungeon system. The Z-axis foundation enables vertical exploration, procedural generation creates infinite replayability, room types add variety to encounters, and the map command helps players navigate their discoveries. Together, these features transform the static starter dungeon into a dynamic, explorable underworld.*
