# v0.18.4 Specialization Resources - Scope Breakdown

**Version:** 0.18.4
**Theme:** Specialization-Specific Resources (Rage, Momentum, Coherence)
**Prerequisites:** v0.18.0 Complete (Psychic Stress), v0.17.4 Complete (Specialization System), v0.6.x (Dice System)
**Total Estimated Tests:** ~25 new tests

---

## Executive Summary

v0.18.4 implements **Specialization-Specific Resources** — three unique combat resources tied to the Berserker, Storm Blade, and Arcanist specializations. Each resource has distinct generation mechanics, thresholds, and synergies with the trauma economy.

The work is divided into **6 sub-phases**:

| Phase    | Name                            | Focus                                                 | Est. Tests |
| -------- | ------------------------------- | ----------------------------------------------------- | ---------- |
| v0.18.4a | Rage System                     | RageState, RageThreshold, RageSource                  | ~5         |
| v0.18.4b | Momentum System                 | MomentumState, MomentumThreshold, decay               | ~5         |
| v0.18.4c | Coherence System                | CoherenceState, CoherenceThreshold, special mechanics | ~5         |
| v0.18.4d | Resource Service Interfaces     | IRageService, IMomentumService, ICoherenceService     | ~0         |
| v0.18.4e | Resource Service Implementation | Core service logic                                    | ~7         |
| v0.18.4f | Configuration & Persistence     | JSON config, database schema                          | ~3         |

---

## Feature Analysis & Categorization

### From trauma-economy.md - Rage (Berserker)

| Feature            | Complexity | Dependencies   | Assigned Phase |
| ------------------ | ---------- | -------------- | -------------- |
| RageThreshold Enum | Low        | None           | **v0.18.4a**   |
| RageSource Enum    | Low        | None           | **v0.18.4a**   |
| RageState Entity   | Medium     | Threshold enum | **v0.18.4a**   |
| RageGainResult VO  | Low        | RageState      | **v0.18.4a**   |
| RageDecayResult VO | Low        | RageState      | **v0.18.4a**   |

### From trauma-economy.md - Momentum (Storm Blade)

| Feature                | Complexity | Dependencies   | Assigned Phase |
| ---------------------- | ---------- | -------------- | -------------- |
| MomentumThreshold Enum | Low        | None           | **v0.18.4b**   |
| MomentumSource Enum    | Low        | None           | **v0.18.4b**   |
| MomentumState Entity   | Medium     | Threshold enum | **v0.18.4b**   |
| MomentumGainResult VO  | Low        | MomentumState  | **v0.18.4b**   |
| MomentumDecayResult VO | Low        | MomentumState  | **v0.18.4b**   |

### From trauma-economy.md - Coherence (Arcanist)

| Feature                 | Complexity | Dependencies   | Assigned Phase |
| ----------------------- | ---------- | -------------- | -------------- |
| CoherenceThreshold Enum | Low        | None           | **v0.18.4c**   |
| CoherenceSource Enum    | Low        | None           | **v0.18.4c**   |
| CoherenceState Entity   | High       | Threshold enum | **v0.18.4c**   |
| CascadeResult VO        | Low        | CoherenceState | **v0.18.4c**   |
| ApotheosisResult VO     | Low        | CoherenceState | **v0.18.4c**   |

### From trauma-economy.md - Service Layer

| Feature                       | Complexity | Dependencies      | Assigned Phase |
| ----------------------------- | ---------- | ----------------- | -------------- |
| IRageService                  | Medium     | Rage VOs          | **v0.18.4d**   |
| IMomentumService              | Medium     | Momentum VOs      | **v0.18.4d**   |
| ICoherenceService             | Medium     | Coherence VOs     | **v0.18.4d**   |
| RageService                   | High       | IRageService      | **v0.18.4e**   |
| MomentumService               | High       | IMomentumService  | **v0.18.4e**   |
| CoherenceService              | High       | ICoherenceService | **v0.18.4e**   |
| specialization-resources.json | Medium     | None              | **v0.18.4f**   |

---

## Phase Definitions

---

## v0.18.4a: Rage System (Berserker)

[v0.18.4a Design Specification](v0.18.4a-design-specification.md)

### Overview

Defines the Rage resource system for the Berserker specialization — a volatile combat resource powered by violence and pain.

### Scope

**In Scope:**

- `RageThreshold` enum (5 tiers: Calm → FrenzyBeyondReason)
- `RageSource` enum (5 categories)
- `RageState` entity
- `RageGainResult` and `RageDecayResult` records

**Out of Scope:**

- Service implementation (v0.18.4e)
- Cross-resource interactions (v0.18.5)

### Key Deliverables

| Type                 | Count | Details                         |
| -------------------- | ----- | ------------------------------- |
| Domain Enums         | 2     | RageThreshold, RageSource       |
| Domain Entities      | 1     | RageState                       |
| Domain Value Objects | 2     | RageGainResult, RageDecayResult |
| Unit Tests           | ~5    |                                 |

### Data Model Changes

```
NEW: RageThreshold (Enum)
├── Calm = 0              (0-20 rage)
├── Simmering = 1         (21-40 rage)
├── Burning = 2           (41-60 rage)
├── BerserkFury = 3       (61-80 rage)
└── FrenzyBeyondReason = 4 (81-100 rage)

NEW: RageSource (Enum)
├── TakingDamage     - Gain rage from damage taken
├── DealingDamage    - Gain rage from damage dealt
├── AllyDamaged      - Rage when allies hurt
├── EnemyKill        - Bonus rage from kills
└── RageMaintenance  - Passive rage generation when angry

NEW: RageState (Entity)
├── CharacterId: Guid
├── CurrentRage: int (0-100)
├── Threshold: RageThreshold (computed)
├── DamageBonus: int (floor(Rage/10))
├── DamageTakenReduction: int (floor(Rage/20) × 5%)
├── SoakBonus: int (by threshold)
├── PartyStressReduction: int? (at FrenzyBeyondReason)
├── FearImmune: bool (at FrenzyBeyondReason)
├── MustAttackNearest: bool (at FrenzyBeyondReason)
├── DecayPerTurn: int (10 per turn in non-combat)
└── LastCombatTime: DateTime?

NEW: RageGainResult (Record)
├── PreviousRage: int
├── NewRage: int
├── AmountGained: int
├── Source: RageSource
├── ThresholdChanged: bool
└── NewThreshold: RageThreshold?

NEW: RageDecayResult (Record)
├── PreviousRage: int
├── NewRage: int
├── AmountDecayed: int
├── ThresholdChanged: bool
└── NewThreshold: RageThreshold?
```

### Rage Threshold Bonuses

| Threshold          | Rage  | Damage Bonus | Soak Bonus | Special Effects                                              |
| ------------------ | ----- | ------------ | ---------- | ------------------------------------------------------------ |
| Calm               | 0-20  | +0 to +2     | +0         | None                                                         |
| Simmering          | 21-40 | +3 to +4     | +1         | Minor aggression                                             |
| Burning            | 41-60 | +5 to +6     | +2         | Intimidation bonus                                           |
| BerserkFury        | 61-80 | +7 to +8     | +3         | Fear resistance                                              |
| FrenzyBeyondReason | 81+   | +9 to +10    | +4         | Party -10 stress next rest, Fear immune, Must attack nearest |

### Acceptance Criteria

- [x] RageThreshold enum has 5 values with correct ranges
- [x] RageSource enum has 5 generation categories
- [x] RageState damage bonus = floor(Rage/10)
- [x] Damage reduction = floor(Rage/20) × 5%
- [x] FrenzyBeyondReason grants fear immunity
- [x] FrenzyBeyondReason forces attack on nearest target
- [x] Decay rate is 10 per non-combat turn
- [x] ~5 unit tests pass (60 tests implemented)

---

## v0.18.4b: Momentum System (Storm Blade)

[v0.18.4b Design Specification](v0.18.4b-design-specification.md)

### Overview

Defines the Momentum resource system for the Storm Blade specialization — a flow-state resource that rewards sustained aggression but penalizes interruption.

### Scope

**In Scope:**

- `MomentumThreshold` enum (5 tiers: Stationary → Unstoppable)
- `MomentumSource` enum (4 categories)
- `MomentumState` entity
- `MomentumGainResult` and `MomentumDecayResult` records

**Out of Scope:**

- Service implementation (v0.18.4e)
- Chain attack abilities (v0.19.x)

### Key Deliverables

| Type                 | Count | Details                                 |
| -------------------- | ----- | --------------------------------------- |
| Domain Enums         | 2     | MomentumThreshold, MomentumSource       |
| Domain Entities      | 1     | MomentumState                           |
| Domain Value Objects | 2     | MomentumGainResult, MomentumDecayResult |
| Unit Tests           | ~5    |                                         |

### Data Model Changes

```
NEW: MomentumThreshold (Enum)
├── Stationary = 0      (0-20 momentum)
├── Moving = 1          (21-40 momentum)
├── Flowing = 2         (41-60 momentum)
├── Surging = 3         (61-80 momentum)
└── Unstoppable = 4     (81-100 momentum)

NEW: MomentumSource (Enum)
├── SuccessfulAttack     - Basic momentum from hits
├── KillingBlow          - Bonus momentum from kills
├── ChainAttack          - Momentum from sequential attacks
└── MovementAction       - Momentum from repositioning

NEW: MomentumState (Entity)
├── CharacterId: Guid
├── CurrentMomentum: int (0-100)
├── Threshold: MomentumThreshold (computed)
├── BonusAttacks: int (by threshold: 0/0/1/1/2)
├── MovementBonus: int (floor(Momentum/20))
├── DefenseBonus: int (by threshold)
├── AttackBonus: int (by threshold)
├── CriticalChance: int (at Unstoppable)
├── DecayOnMissedAttack: int (25 flat)
├── DecayOnStunned: int (full reset)
├── ConsecutiveHits: int (tracking chain)
└── LastActionTime: DateTime?

NEW: MomentumGainResult (Record)
├── PreviousMomentum: int
├── NewMomentum: int
├── AmountGained: int
├── Source: MomentumSource
├── ChainBonus: int?
├── ThresholdChanged: bool
└── NewThreshold: MomentumThreshold?

NEW: MomentumDecayResult (Record)
├── PreviousMomentum: int
├── NewMomentum: int
├── AmountDecayed: int
├── DecayReason: string
├── ChainBroken: bool
├── ThresholdChanged: bool
└── NewThreshold: MomentumThreshold?
```

### Momentum Threshold Bonuses

| Threshold   | Momentum | Bonus Attacks | Defense | Attack | Special Effects              |
| ----------- | -------- | ------------- | ------- | ------ | ---------------------------- |
| Stationary  | 0-20     | 0             | +0      | +0     | None                         |
| Moving      | 21-40    | 0             | +1      | +1     | Movement +1                  |
| Flowing     | 41-60    | 1             | +2      | +2     | Chain attacks enabled        |
| Surging     | 61-80    | 1             | +3      | +3     | Reduced recovery time        |
| Unstoppable | 81+      | 2             | +4      | +4     | +10% crit, Full heal on kill |

### Decay Mechanics

| Event                   | Decay Amount | Notes                 |
| ----------------------- | ------------ | --------------------- |
| Missed Attack           | 25 flat      | Breaks chain          |
| Stunned/Frozen          | 100% (full)  | Complete reset        |
| No Attack Action        | 15 per turn  | Encourages aggression |
| Damage Taken (Critical) | 20 flat      | Disrupts flow         |

### Acceptance Criteria

- [x] MomentumThreshold enum has 5 values with correct ranges
- [x] Bonus attacks scale correctly with threshold (0/0/1/1/2)
- [x] Movement bonus = floor(Momentum/20)
- [x] Missed attack causes 25 momentum decay
- [x] Stunned causes full momentum reset
- [x] ConsecutiveHits tracking enables chain bonuses
- [x] ~5 unit tests pass (71 tests implemented)

---

## v0.18.4c: Coherence System (Arcanist)

[v0.18.4c Design Specification](v0.18.4c-design-specification.md)

### Overview

Defines the Coherence resource system for the Arcanist specialization — a reality-stability meter with both power bonuses and dangerous instability at extremes.

### Scope

**In Scope:**

- `CoherenceThreshold` enum (5 tiers: Destabilized → Apotheosis)
- `CoherenceSource` enum (4 categories)
- `CoherenceState` entity
- `CascadeResult` and `ApotheosisResult` records

**Out of Scope:**

- Cascade effect tables (v0.19.x)
- Apotheosis ability unlocks (v0.19.x)

### Key Deliverables

| Type                 | Count | Details                             |
| -------------------- | ----- | ----------------------------------- |
| Domain Enums         | 2     | CoherenceThreshold, CoherenceSource |
| Domain Entities      | 1     | CoherenceState                      |
| Domain Value Objects | 2     | CascadeResult, ApotheosisResult     |
| Unit Tests           | ~5    |                                     |

### Data Model Changes

```
NEW: CoherenceThreshold (Enum)
├── Destabilized = 0    (0-20 coherence) - Dangerous!
├── Unstable = 1        (21-40 coherence)
├── Balanced = 2        (41-60 coherence) - Ideal
├── Focused = 3         (61-80 coherence)
└── Apotheosis = 4      (81-100 coherence) - Powerful but risky

NEW: CoherenceSource (Enum)
├── SuccessfulCast      - Coherence from spell completion
├── ControlledChannel   - Bonus from maintained spells
├── MeditationAction    - Active coherence recovery
└── StabilityField      - Environmental or ally bonus

NEW: CoherenceState (Entity)
├── CharacterId: Guid
├── CurrentCoherence: int (0-100)
├── Threshold: CoherenceThreshold (computed)
├── SpellPowerBonus: int (by threshold)
├── CriticalCastChance: int (by threshold)
├── CascadeRisk: int (at Destabilized: 25% per cast)
├── InApotheosis: bool (at Apotheosis threshold)
├── ApotheosisAbilitiesUnlocked: bool
├── ApotheosisStressCost: int (10/turn during Apotheosis)
├── CanMeditate: bool (not in combat)
├── LastCastTime: DateTime?
└── TurnsInApotheosis: int

NEW: CascadeResult (Record)
├── CascadeTriggered: bool
├── CoherenceLost: int
├── SelfDamage: int?
├── StressGained: int?
├── CorruptionGained: int?
├── SpellDisrupted: bool
└── CascadeEffectId: string?

NEW: ApotheosisResult (Record)
├── EnteredApotheosis: bool
├── TurnsRemaining: int?
├── AbilitiesUnlocked: IReadOnlyList<string>
├── StressCostPerTurn: int
├── ExitedApotheosis: bool
├── ExitReason: string?
└── FinalCoherence: int
```

### Coherence Threshold Effects

| Threshold    | Coherence | Spell Power | Crit Chance | Special Effects                    |
| ------------ | --------- | ----------- | ----------- | ---------------------------------- |
| Destabilized | 0-20      | -2          | 0%          | 25% Cascade risk per cast          |
| Unstable     | 21-40     | -1          | 0%          | 10% Cascade risk                   |
| Balanced     | 41-60     | +0          | 5%          | Ideal state, no risk               |
| Focused      | 61-80     | +2          | 10%         | Reduced mana costs                 |
| Apotheosis   | 81+       | +5          | 20%         | Ultimate abilities, 10 stress/turn |

### Special Mechanics

**Cascade (Destabilized/Unstable):**

- Risk per cast based on threshold
- Effects: Self-damage, stress gain, corruption, spell disruption
- Cascade effect determined by random table (v0.19.x)

**Apotheosis (81+):**

- Unlocks ultimate Arcanist abilities
- Costs 10 stress per turn to maintain
- Auto-exits if stress reaches 100
- Cannot voluntarily exit during combat

**Meditation:**

- Available outside combat
- Restores 20 coherence per action
- Interrupted by damage

### Acceptance Criteria

- [ ] CoherenceThreshold enum has 5 values with correct ranges
- [ ] Destabilized threshold has 25% Cascade risk
- [ ] Apotheosis threshold grants +5 spell power
- [ ] Apotheosis costs 10 stress per turn
- [ ] CascadeResult tracks all cascade effects
- [ ] ApotheosisResult tracks state transitions
- [ ] CanMeditate only outside combat
- [ ] ~5 unit tests pass

---

## v0.18.4d: Resource Service Interfaces

[v0.18.4d Design Specification](v0.18.4d-design-specification.md)

### Overview

Defines the service contracts for all three specialization resources.

### Scope

**In Scope:**

- `IRageService` interface
- `IMomentumService` interface
- `ICoherenceService` interface
- Method signatures and XML documentation

**Out of Scope:**

- Implementation (v0.18.4e)

### Key Deliverables

| Type                   | Count | Details                                           |
| ---------------------- | ----- | ------------------------------------------------- |
| Application Interfaces | 3     | IRageService, IMomentumService, ICoherenceService |
| Unit Tests             | ~0    | Interface only                                    |

### Interface Definitions

```csharp
public interface IRageService
{
    RageState GetRageState(Guid characterId);
    RageGainResult GainRage(Guid characterId, int amount, RageSource source);
    RageDecayResult ApplyDecay(Guid characterId);
    int GetDamageBonus(Guid characterId);
    int GetSoakBonus(Guid characterId);
    bool IsFearImmune(Guid characterId);
    bool MustAttackNearest(Guid characterId);
    int GetPartyStressReduction(Guid characterId);
}

public interface IMomentumService
{
    MomentumState GetMomentumState(Guid characterId);
    MomentumGainResult GainMomentum(Guid characterId, int amount, MomentumSource source);
    MomentumDecayResult ApplyDecay(Guid characterId, string reason);
    MomentumDecayResult ResetMomentum(Guid characterId, string reason);
    int GetBonusAttacks(Guid characterId);
    int GetMovementBonus(Guid characterId);
    int GetAttackBonus(Guid characterId);
    int GetDefenseBonus(Guid characterId);
    void RecordHit(Guid characterId);
    void RecordMiss(Guid characterId);
}

public interface ICoherenceService
{
    CoherenceState GetCoherenceState(Guid characterId);
    bool GainCoherence(Guid characterId, int amount, CoherenceSource source);
    bool LoseCoherence(Guid characterId, int amount, string reason);
    CascadeResult CheckCascade(Guid characterId);
    ApotheosisResult UpdateApotheosis(Guid characterId);
    int GetSpellPowerBonus(Guid characterId);
    int GetCriticalCastChance(Guid characterId);
    bool CanMeditate(Guid characterId);
    bool Meditate(Guid characterId);
}
```

### Acceptance Criteria

- [ ] IRageService defines all 8 methods
- [ ] IMomentumService defines all 10 methods
- [ ] ICoherenceService defines all 9 methods
- [ ] All methods have XML documentation
- [ ] Interfaces compile without implementation dependencies

---

## v0.18.4e: Resource Service Implementation

[v0.18.4e Design Specification](v0.18.4e-design-specification.md)

### Overview

Implements the core logic for all three specialization resource services.

### Scope

**In Scope:**

- `RageService` class implementing `IRageService`
- `MomentumService` class implementing `IMomentumService`
- `CoherenceService` class implementing `ICoherenceService`

**Out of Scope:**

- Cascade effect tables (v0.19.x)
- Apotheosis ability definitions (v0.19.x)
- Cross-resource interactions (v0.18.5)

### Key Deliverables

| Type                 | Count | Details                                        |
| -------------------- | ----- | ---------------------------------------------- |
| Application Services | 3     | RageService, MomentumService, CoherenceService |
| Unit Tests           | ~7    |                                                |

### Acceptance Criteria

- [ ] RageService correctly calculates damage/soak bonuses
- [ ] RageService decay works in non-combat
- [ ] MomentumService tracks consecutive hits
- [ ] MomentumService handles decay on miss/stun
- [ ] CoherenceService calculates cascade risk
- [ ] CoherenceService manages Apotheosis state
- [ ] Meditation restores 20 coherence per action
- [ ] ~7 unit tests pass

---

## v0.18.4f: Configuration & Persistence

[v0.18.4f Design Specification](v0.18.4f-design-specification.md)

### Overview

Defines the JSON configuration for all specialization resources and extends the database schema for persistence.

### Scope

**In Scope:**

- `config/specialization-resources.json` configuration file
- `config/schemas/specialization-resources.schema.json` JSON Schema
- Database tables for resource state persistence

**Out of Scope:**

- Runtime configuration loading (uses existing `IConfigurationProvider`)

### Key Deliverables

| Type                | Count | Details                              |
| ------------------- | ----- | ------------------------------------ |
| Configuration Files | 1     | specialization-resources.json        |
| JSON Schemas        | 1     | specialization-resources.schema.json |
| Database Migrations | 1     | Add resource tables                  |
| Unit Tests          | ~3    |                                      |

### specialization-resources.json Structure

```json
{
    "version": "1.0",
    "rage": {
        "maxValue": 100,
        "decayPerTurn": 10,
        "thresholds": [
            { "name": "Calm", "minValue": 0, "maxValue": 20, "soakBonus": 0 },
            {
                "name": "Simmering",
                "minValue": 21,
                "maxValue": 40,
                "soakBonus": 1
            },
            {
                "name": "Burning",
                "minValue": 41,
                "maxValue": 60,
                "soakBonus": 2
            },
            {
                "name": "BerserkFury",
                "minValue": 61,
                "maxValue": 80,
                "soakBonus": 3
            },
            {
                "name": "FrenzyBeyondReason",
                "minValue": 81,
                "maxValue": 100,
                "soakBonus": 4,
                "fearImmune": true,
                "mustAttackNearest": true,
                "partyStressReduction": 10
            }
        ],
        "sources": {
            "takingDamage": { "formula": "floor(damage / 5)" },
            "dealingDamage": { "formula": "floor(damage / 10)" },
            "allyDamaged": { "flat": 5 },
            "enemyKill": { "flat": 15 }
        }
    },
    "momentum": {
        "maxValue": 100,
        "decayOnMiss": 25,
        "decayOnStun": 100,
        "decayPerIdleTurn": 15,
        "thresholds": [
            {
                "name": "Stationary",
                "minValue": 0,
                "maxValue": 20,
                "bonusAttacks": 0,
                "defense": 0,
                "attack": 0
            },
            {
                "name": "Moving",
                "minValue": 21,
                "maxValue": 40,
                "bonusAttacks": 0,
                "defense": 1,
                "attack": 1
            },
            {
                "name": "Flowing",
                "minValue": 41,
                "maxValue": 60,
                "bonusAttacks": 1,
                "defense": 2,
                "attack": 2
            },
            {
                "name": "Surging",
                "minValue": 61,
                "maxValue": 80,
                "bonusAttacks": 1,
                "defense": 3,
                "attack": 3
            },
            {
                "name": "Unstoppable",
                "minValue": 81,
                "maxValue": 100,
                "bonusAttacks": 2,
                "defense": 4,
                "attack": 4,
                "critBonus": 10,
                "healOnKill": true
            }
        ],
        "sources": {
            "successfulAttack": { "flat": 10 },
            "killingBlow": { "flat": 20 },
            "chainBonus": { "perConsecutiveHit": 5 },
            "movement": { "perSquare": 2 }
        }
    },
    "coherence": {
        "maxValue": 100,
        "meditationGain": 20,
        "apotheosisStressCost": 10,
        "thresholds": [
            {
                "name": "Destabilized",
                "minValue": 0,
                "maxValue": 20,
                "spellPower": -2,
                "critChance": 0,
                "cascadeRisk": 25
            },
            {
                "name": "Unstable",
                "minValue": 21,
                "maxValue": 40,
                "spellPower": -1,
                "critChance": 0,
                "cascadeRisk": 10
            },
            {
                "name": "Balanced",
                "minValue": 41,
                "maxValue": 60,
                "spellPower": 0,
                "critChance": 5,
                "cascadeRisk": 0
            },
            {
                "name": "Focused",
                "minValue": 61,
                "maxValue": 80,
                "spellPower": 2,
                "critChance": 10,
                "cascadeRisk": 0
            },
            {
                "name": "Apotheosis",
                "minValue": 81,
                "maxValue": 100,
                "spellPower": 5,
                "critChance": 20,
                "cascadeRisk": 0,
                "ultimateAbilities": true
            }
        ],
        "sources": {
            "successfulCast": { "flat": 5 },
            "controlledChannel": { "perTurn": 3 },
            "meditation": { "perAction": 20 }
        }
    }
}
```

### Database Schema

```sql
CREATE TABLE IF NOT EXISTS character_rage (
    character_id UUID PRIMARY KEY REFERENCES characters(id) ON DELETE CASCADE,
    current_rage INT NOT NULL DEFAULT 0
        CONSTRAINT chk_rage_range CHECK (current_rage >= 0 AND current_rage <= 100),
    last_combat_time TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS character_momentum (
    character_id UUID PRIMARY KEY REFERENCES characters(id) ON DELETE CASCADE,
    current_momentum INT NOT NULL DEFAULT 0
        CONSTRAINT chk_momentum_range CHECK (current_momentum >= 0 AND current_momentum <= 100),
    consecutive_hits INT NOT NULL DEFAULT 0,
    last_action_time TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS character_coherence (
    character_id UUID PRIMARY KEY REFERENCES characters(id) ON DELETE CASCADE,
    current_coherence INT NOT NULL DEFAULT 50
        CONSTRAINT chk_coherence_range CHECK (current_coherence >= 0 AND current_coherence <= 100),
    in_apotheosis BOOLEAN NOT NULL DEFAULT false,
    turns_in_apotheosis INT NOT NULL DEFAULT 0,
    last_cast_time TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### Acceptance Criteria

- [ ] Schema validates correct resource configurations
- [ ] Configuration loads all three resource systems
- [ ] Database tables created with proper constraints
- [ ] Coherence defaults to 50 (Balanced state)
- [ ] Resource history can be tracked
- [ ] ~3 unit tests pass

---

## Dependencies & Prerequisites

```
v0.17.4 (Specialization System) - REQUIRED
    │
    └── Specialization detection for resource eligibility
                    │
v0.18.0 (Psychic Stress) - REQUIRED
    │
    └── StressState for Apotheosis stress cost
                    │
v0.6.x (Dice System) - REQUIRED
    │
    └── IDiceService (cascade checks, control checks)
                    │
                    ▼
v0.18.4 (Specialization Resources)
    │
    ├── v0.18.4a: Rage System ───────────────────────┐
    │       Dependencies: v0.17.4 (Berserker spec)   │
    │                                                 │
    ├── v0.18.4b: Momentum System ───────────────────┤
    │       Dependencies: v0.17.4 (Storm Blade spec) │
    │                                                 │
    ├── v0.18.4c: Coherence System ──────────────────┤
    │       Dependencies: v0.17.4 (Arcanist spec)    │
    │                                                 │
    ├── v0.18.4d: Resource Service Interfaces ───────┤
    │       Dependencies: v0.18.4a-c                 │
    │                                                 │
    ├── v0.18.4e: Resource Service Implementation ───┤
    │       Dependencies: v0.18.4d                   │
    │                                                 │
    └── v0.18.4f: Configuration & Persistence ───────┘
            Dependencies: v0.18.4e
```

---

## Estimated Effort Summary

| Phase     | New Files | Modified Files | Est. Tests | Complexity |
| --------- | --------- | -------------- | ---------- | ---------- |
| v0.18.4a  | 5         | 0              | ~5         | Medium     |
| v0.18.4b  | 5         | 0              | ~5         | Medium     |
| v0.18.4c  | 5         | 0              | ~5         | High       |
| v0.18.4d  | 3         | 0              | ~0         | Low        |
| v0.18.4e  | 3         | 0              | ~7         | High       |
| v0.18.4f  | 3         | 1              | ~3         | Medium     |
| **Total** | **24**    | **1**          | **~25**    |            |

---

## Risk Assessment

| Risk                         | Impact | Probability | Mitigation                       |
| ---------------------------- | ------ | ----------- | -------------------------------- |
| Resource balance issues      | Medium | Medium      | Configurable values, playtesting |
| Apotheosis stress loop       | Medium | Low         | Clear exit conditions            |
| Cascade effect complexity    | Low    | Low         | Effects deferred to v0.19.x      |
| Momentum chain tracking bugs | Low    | Medium      | Comprehensive hit/miss tests     |

---

## Design Decisions (Confirmed)

### Resource Philosophy

| Decision                | Value             | Notes                           |
| ----------------------- | ----------------- | ------------------------------- |
| **Resource Range**      | 0-100             | Consistent across all systems   |
| **Threshold Count**     | 5 tiers each      | 20-point increments             |
| **Specialization Lock** | One per character | Resource tied to specialization |

### Resource-Specific

| Resource  | Philosophy                        | Notes                   |
| --------- | --------------------------------- | ----------------------- |
| Rage      | Violence begets violence          | Berserker power fantasy |
| Momentum  | Flow state, sustained aggression  | Storm Blade finesse     |
| Coherence | Balance between power and control | Arcanist risk/reward    |

### Decay Mechanics

| Resource  | Combat Decay   | Non-Combat Decay           |
| --------- | -------------- | -------------------------- |
| Rage      | None           | 10 per turn                |
| Momentum  | On miss/stun   | 15 per idle turn           |
| Coherence | On failed cast | Slow drift toward balanced |

---

## Out of Scope

| Feature                             | Deferred To | Reason                 |
| ----------------------------------- | ----------- | ---------------------- |
| Cascade effect tables               | v0.19.x     | Wild Magic system      |
| Apotheosis ability definitions      | v0.19.x     | Ability system         |
| Cross-resource interactions         | v0.18.5     | Integration version    |
| Resource UI visualization           | v0.19.x     | UI version             |
| Additional specialization resources | v0.20.x     | Future specializations |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown with stakeholders
2. **v0.18.4a Design Spec** - Create detailed design specification for Rage System
3. **Implement v0.18.4a** - Build Rage enums, state, and result objects
4. **Repeat for v0.18.4b through v0.18.4f**

---

_This scope breakdown provides a structured approach to implementing v0.18.4 Specialization Resources. Each sub-phase builds on the previous, allowing for incremental development and testing._

---

## Changelog

| Version | Date       | Changes                        |
| ------- | ---------- | ------------------------------ |
| 1.0     | 2026-01-17 | Initial scope breakdown        |
| 1.1     | 2026-01-27 | Restructured to match template |
