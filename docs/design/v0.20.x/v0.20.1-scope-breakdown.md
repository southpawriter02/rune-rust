# v0.20.1 Scope Breakdown: Skjaldmær (Shieldmaiden)

**Version:** 0.20.1
**Theme:** Skjaldmær Specialization Implementation
**Prerequisites:** v0.20.0 Complete (Legacy Class Removal & Migration)
**Total Estimated Tests:** ~25 new tests

---

## Executive Summary

v0.20.1 implements the **Skjaldmær (Shieldmaiden)** specialization — the first complete ability tree for the Warrior archetype. The Skjaldmær embodies the Coherent path's defensive philosophy, serving as the party's living shield through Block Charges, protective stances, and ally-focused abilities.

> _"The Wall is the soul of the Hold."_

The work is divided into **3 sub-phases**:

| Phase    | Name                         | Focus                                                   | Est. Tests |
| -------- | ---------------------------- | ------------------------------------------------------- | ---------- |
| v0.20.1a | Framework & Tier 1 Abilities | Block Charges resource, Shield Wall, Intercept, Bulwark | ~10        |
| v0.20.1b | Tier 2 Abilities             | Hold the Line, Counter-Shield, Rally                    | ~8         |
| v0.20.1c | Tier 3 Abilities & Capstone  | Unbreakable, Guardian's Sacrifice, The Wall Lives       | ~7         |

---

## Specialization Profile

### Skjaldmær Identity

| Attribute            | Value                     |
| -------------------- | ------------------------- |
| **Display Name**     | Skjaldmær                 |
| **Pronunciation**    | SKYALD-mair               |
| **Translation**      | Shieldmaiden              |
| **Archetype**        | Warrior                   |
| **Path Type**        | Coherent                  |
| **Role**             | Living Shield / Protector |
| **Special Resource** | Block Charges (Max 3)     |
| **Tagline**          | "The Living Shield"       |

### Thematic Elements

The Skjaldmær represents the disciplined defenders of Aethelgard's Holds — warriors who stand between the horrors of the broken world and those they protect. Unlike the Heretical Berserkr who surrenders control for power, the Skjaldmær maintains absolute discipline, channeling their strength into protection rather than destruction.

**Design Principles:**

1. **Protection First**: Abilities prioritize ally survival over personal damage
2. **Positional Awareness**: Many abilities require or reward tactical positioning
3. **Resource Management**: Block Charges create meaningful defensive decisions
4. **Reactive Combat**: Strong reaction-based abilities reward anticipation
5. **Coherent Path**: No Corruption risk — the Skjaldmær works within stable reality

---

## Feature Analysis & Categorization

### From v0.20.x-overview.md — Ability Tier Structure

| Ability              | Tier | Type     | Complexity | Assigned Phase |
| -------------------- | ---- | -------- | ---------- | -------------- |
| Shield Wall          | T1   | Stance   | Medium     | **v0.20.1a**   |
| Intercept            | T1   | Reaction | Medium     | **v0.20.1a**   |
| Bulwark              | T1   | Passive  | Low        | **v0.20.1a**   |
| Hold the Line        | T2   | Active   | Medium     | **v0.20.1b**   |
| Counter-Shield       | T2   | Reaction | Medium     | **v0.20.1b**   |
| Rally                | T2   | Active   | Low        | **v0.20.1b**   |
| Unbreakable          | T3   | Passive  | Low        | **v0.20.1c**   |
| Guardian's Sacrifice | T3   | Reaction | High       | **v0.20.1c**   |
| The Wall Lives       | Cap  | Ultimate | High       | **v0.20.1c**   |

### From v0.20.x-overview.md — Special Resource

| Feature                        | Complexity | Dependencies           | Assigned Phase |
| ------------------------------ | ---------- | ---------------------- | -------------- |
| Block Charges (Max 3)          | Medium     | Resource System (Core) | **v0.20.1a**   |
| Block Charge generation (rest) | Low        | Rest system            | **v0.20.1a**   |
| Block Charge spending          | Low        | Ability execution      | **v0.20.1a**   |

---

## Phase Definitions

---

## v0.20.1a: Framework & Tier 1 Abilities

[v0.20.1a Design Specification](v0.20.1a-design-specification.md)

### Overview

This phase establishes the Skjaldmær specialization framework including the Block Charges special resource and implements the three Tier 1 abilities that define the core defensive identity.

### Scope

**In Scope:**

- `SkjaldmaerSpecialization` registration with v0.17.4 framework
- `BlockChargeResource` special resource implementation
- Block Charge restoration on rest
- Shield Wall stance ability (+3 Defense, +1 Defense to adjacent allies)
- Intercept reaction ability (redirect attack to self)
- Bulwark passive ability (+5 Max HP per Block Charge held)
- Ability slot initialization for Skjaldmær
- Configuration entries in `specializations.json` and `abilities.json`

**Out of Scope:**

- Tier 2 abilities (v0.20.1b)
- Tier 3 abilities and Capstone (v0.20.1c)
- Other specialization implementations (v0.20.2+)

### Key Deliverables

| Type                    | Count | Details                                                  |
| ----------------------- | ----- | -------------------------------------------------------- |
| Domain Value Objects    | 2     | `BlockChargeResource`, `ShieldWallState`                 |
| Domain Enums            | 1     | `SkjaldmaerAbilityId`                                    |
| Application Services    | 2     | `BlockChargeService`, `SkjaldmaerAbilityService`         |
| Ability Implementations | 3     | Shield Wall, Intercept, Bulwark                          |
| Configuration           | 2     | `specializations.json` updates, `abilities.json` updates |
| Unit Tests              | ~10   |                                                          |

### Data Model Changes

```
NEW: BlockChargeResource (Value Object)
├── CurrentCharges: int (0-3)
├── MaxCharges: int (default 3)
├── LastRestoredAt: DateTime?
└── Methods:
    ├── Spend(int amount): bool
    ├── Restore(int amount): void
    └── RestoreAll(): void

NEW: ShieldWallState (Value Object)
├── IsActive: bool
├── DefenseBonus: int (default 3)
├── AllyDefenseBonus: int (default 1)
├── ActivatedAt: DateTime?
└── Methods:
    └── GetAffectedAllies(IReadOnlyList<Character> allies, Position characterPosition): IReadOnlyList<Guid>

NEW: SkjaldmaerAbilityId (Enum)
├── ShieldWall
├── Intercept
├── Bulwark
├── HoldTheLine
├── CounterShield
├── Rally
├── Unbreakable
├── GuardiansSacrifice
└── TheWallLives

MODIFY: Character (Entity)
├── ADD: BlockCharges: BlockChargeResource?
└── ADD: ActiveStance: StanceId?
```

### Tier 1 Ability Specifications

#### Shield Wall (Stance)

| Property         | Value                                       |
| ---------------- | ------------------------------------------- |
| **ID**           | `shield-wall`                               |
| **Type**         | Stance                                      |
| **AP Cost**      | 2 AP                                        |
| **Duration**     | Until stance ends                           |
| **Effect**       | +3 Defense; adjacent allies gain +1 Defense |
| **Restrictions** | Requires shield equipped                    |

**Mechanics:**

- Entering stance costs 2 AP
- Stance persists until explicitly ended or character is incapacitated
- "Adjacent" defined as within 1 space (including diagonals)
- Ally defense bonus recalculates when allies move
- Cannot have multiple stances active simultaneously

#### Intercept (Reaction)

| Property         | Value                                      |
| ---------------- | ------------------------------------------ |
| **ID**           | `intercept`                                |
| **Type**         | Reaction                                   |
| **Trigger**      | Ally within 2 spaces is targeted by attack |
| **Cost**         | 1 Block Charge                             |
| **Effect**       | Redirect attack to self                    |
| **Restrictions** | Must have line of sight to ally            |

**Mechanics:**

- Triggered before attack resolution
- Attack is made against Skjaldmær's Defense instead
- If Skjaldmær is hit, they take the damage
- Costs 1 Block Charge regardless of hit/miss
- Cannot intercept area-of-effect attacks
- Cannot intercept attacks targeting self

#### Bulwark (Passive)

| Property         | Value                                     |
| ---------------- | ----------------------------------------- |
| **ID**           | `bulwark`                                 |
| **Type**         | Passive                                   |
| **Effect**       | +5 Max HP per Block Charge currently held |
| **Restrictions** | None                                      |

**Mechanics:**

- Max HP bonus is dynamic (recalculates when Block Charges change)
- At 3 charges: +15 Max HP
- At 2 charges: +10 Max HP
- At 1 charge: +5 Max HP
- At 0 charges: +0 Max HP
- If current HP exceeds new Max HP after spending charges, current HP is set to new Max HP

### User-Facing Changes

**Commands:**

```
> stance shield-wall          # Enter Shield Wall stance
> stance end                  # End current stance
> ability intercept <ally>    # (Reaction) Intercept attack on ally
> status                      # Shows Block Charges: 3/3
```

**Output Example:**

```
╔══════════════════════════════════════════════════════════════╗
║  SKJALDMÆR - Erikka Ironshield                               ║
╠══════════════════════════════════════════════════════════════╣
║  HP: 45/45 (+15 from Bulwark)    Defense: 18 (+3 Shield Wall)║
║  Block Charges: ███ 3/3                                      ║
║                                                              ║
║  Active Stance: Shield Wall                                  ║
║  └── Adjacent allies gain +1 Defense                         ║
╚══════════════════════════════════════════════════════════════╝
```

### Acceptance Criteria

- [ ] Skjaldmær specialization registered in SpecializationDefinition
- [ ] Block Charges initialize to 3/3 on character creation/selection
- [ ] Block Charges restore to full on rest
- [ ] Shield Wall stance grants +3 Defense to self
- [ ] Shield Wall stance grants +1 Defense to adjacent allies
- [ ] Intercept redirects attacks and costs 1 Block Charge
- [ ] Bulwark dynamically adjusts Max HP based on current Block Charges
- [ ] Ability slots correctly show Tier 1 abilities as unlocked
- [ ] ~10 unit tests pass

---

## v0.20.1b: Tier 2 Abilities

[v0.20.1b Design Specification](v0.20.1b-design-specification.md)

### Overview

This phase implements the three Tier 2 abilities that expand the Skjaldmær's tactical options with crowd control, counterattacks, and party support.

### Scope

**In Scope:**

- Hold the Line active ability (enemies cannot move through space)
- Counter-Shield reaction ability (deal damage on successful block)
- Rally active ability (+2 to allies' next save)
- Tier 2 unlock validation (requires 8 PP invested in tree)
- PP cost enforcement (4 PP per Tier 2 ability)

**Out of Scope:**

- Tier 3 abilities and Capstone (v0.20.1c)
- Block Charge modifications (established in v0.20.1a)

### Key Deliverables

| Type                    | Count | Details                              |
| ----------------------- | ----- | ------------------------------------ |
| Domain Value Objects    | 2     | `HoldTheLineState`, `RallyBuff`      |
| Ability Implementations | 3     | Hold the Line, Counter-Shield, Rally |
| StatusEffects           | 1     | Rally buff effect                    |
| Unit Tests              | ~8    |                                      |

### Tier 2 Ability Specifications

#### Hold the Line (Active)

| Property         | Value                                  |
| ---------------- | -------------------------------------- |
| **ID**           | `hold-the-line`                        |
| **Type**         | Active                                 |
| **AP Cost**      | 3 AP                                   |
| **Duration**     | 2 turns                                |
| **Effect**       | Enemies cannot move through your space |
| **PP Cost**      | 4 PP to unlock                         |
| **Prerequisite** | 8 PP invested in Skjaldmær tree        |

**Mechanics:**

- Creates impassable zone in Skjaldmær's current space
- Enemies attempting to move through are stopped at adjacent space
- Does not prevent enemies from moving around the space
- Allies can move through freely
- Effect ends early if Skjaldmær moves or is incapacitated

#### Counter-Shield (Reaction)

| Property         | Value                           |
| ---------------- | ------------------------------- |
| **ID**           | `counter-shield`                |
| **Type**         | Reaction                        |
| **Trigger**      | Successfully block an attack    |
| **Cost**         | None                            |
| **Effect**       | Deal 1d6 damage to attacker     |
| **PP Cost**      | 4 PP to unlock                  |
| **Prerequisite** | 8 PP invested in Skjaldmær tree |

**Mechanics:**

- Triggers automatically on successful block
- "Successful block" = attack misses due to Defense/shield
- Damage is untyped physical damage
- Attacker must be within melee range (1 space)
- Does not trigger on ranged attacks from distance

#### Rally (Active)

| Property         | Value                                                |
| ---------------- | ---------------------------------------------------- |
| **ID**           | `rally`                                              |
| **Type**         | Active                                               |
| **AP Cost**      | 2 AP                                                 |
| **Range**        | 6 spaces                                             |
| **Effect**       | All allies within range gain +2 to next saving throw |
| **Duration**     | Until next save or end of combat                     |
| **PP Cost**      | 4 PP to unlock                                       |
| **Prerequisite** | 8 PP invested in Skjaldmær tree                      |

**Mechanics:**

- Affects all allies within 6 spaces at time of use
- Buff applies to the next saving throw each ally makes
- Consumed after one save (successful or not)
- Stacks with other save bonuses
- Does not affect self

### Acceptance Criteria

- [ ] Tier 2 abilities locked until 8 PP invested in tree
- [ ] Each Tier 2 ability costs 4 PP to unlock
- [ ] Hold the Line prevents enemy movement through space
- [ ] Counter-Shield deals 1d6 damage on successful block
- [ ] Rally grants +2 to allies' next saving throw
- [ ] ~8 unit tests pass

---

## v0.20.1c: Tier 3 Abilities & Capstone

[v0.20.1c Design Specification](v0.20.1c-design-specification.md)

### Overview

This phase implements the two Tier 3 abilities and the Capstone ultimate that represent the pinnacle of the Skjaldmær's defensive mastery, including the signature "cannot die" capstone ability.

### Scope

**In Scope:**

- Unbreakable passive ability (reduce damage taken by 3)
- Guardian's Sacrifice reaction ability (absorb all damage from one attack on ally)
- The Wall Lives ultimate ability (cannot be reduced below 1 HP for 3 turns)
- Tier 3 unlock validation (requires 16 PP invested in tree)
- Capstone unlock validation (requires 24 PP invested in tree)
- PP cost enforcement (5 PP per Tier 3, 6 PP for Capstone)

**Out of Scope:**

- Other specialization implementations (v0.20.2+)
- Additional Warrior specializations (Berserkr in v0.20.5)

### Key Deliverables

| Type                    | Count | Details                                           |
| ----------------------- | ----- | ------------------------------------------------- |
| Domain Value Objects    | 1     | `TheWallLivesState`                               |
| Ability Implementations | 3     | Unbreakable, Guardian's Sacrifice, The Wall Lives |
| Damage Reduction System | 1     | Integration with damage pipeline                  |
| Unit Tests              | ~7    |                                                   |

### Tier 3 & Capstone Ability Specifications

#### Unbreakable (Passive)

| Property         | Value                                           |
| ---------------- | ----------------------------------------------- |
| **ID**           | `unbreakable`                                   |
| **Type**         | Passive                                         |
| **Effect**       | Reduce all damage taken by 3 (minimum 1 damage) |
| **PP Cost**      | 5 PP to unlock                                  |
| **Prerequisite** | 16 PP invested in Skjaldmær tree                |

**Mechanics:**

- Applies to all damage types (physical, elemental, Aetheric)
- Damage cannot be reduced below 1 (prevents immunity)
- Stacks additively with other damage reduction
- Applied before armor/resistance calculations

#### Guardian's Sacrifice (Reaction)

| Property         | Value                                    |
| ---------------- | ---------------------------------------- |
| **ID**           | `guardians-sacrifice`                    |
| **Type**         | Reaction                                 |
| **Trigger**      | Ally within 2 spaces is hit by an attack |
| **Cost**         | 2 Block Charges                          |
| **Effect**       | Absorb ALL damage from the attack        |
| **PP Cost**      | 5 PP to unlock                           |
| **Prerequisite** | 16 PP invested in Skjaldmær tree         |

**Mechanics:**

- Triggered after attack hits but before damage is applied
- Skjaldmær takes 100% of the damage intended for ally
- Ally takes 0 damage from the attack
- Costs 2 Block Charges (cannot use if fewer than 2)
- Can be used on same attack that triggered Intercept (if different ally)
- Skjaldmær's own damage reduction (Unbreakable) still applies

#### The Wall Lives (Ultimate/Capstone)

| Property         | Value                            |
| ---------------- | -------------------------------- |
| **ID**           | `the-wall-lives`                 |
| **Type**         | Ultimate                         |
| **AP Cost**      | 4 AP                             |
| **Duration**     | 3 turns                          |
| **Effect**       | Cannot be reduced below 1 HP     |
| **Cooldown**     | Once per combat                  |
| **PP Cost**      | 6 PP to unlock                   |
| **Prerequisite** | 24 PP invested in Skjaldmær tree |

**Mechanics:**

- For 3 turns, any damage that would reduce HP below 1 instead leaves HP at 1
- Does not prevent damage, only prevents death
- Effect is clearly visible in combat UI ("The Wall Lives: 3 turns")
- When effect ends, normal damage rules apply
- Can be dispelled by effects that remove buffs
- Does not prevent instant-death effects (if any exist)

### Data Model Changes

```
NEW: TheWallLivesState (Value Object)
├── IsActive: bool
├── TurnsRemaining: int
├── ActivatedAt: DateTime
└── Methods:
    ├── Tick(): void (decrements turns)
    ├── IsExpired(): bool
    └── PreventLethalDamage(int incomingDamage, int currentHp): int
```

### Acceptance Criteria

- [ ] Tier 3 abilities locked until 16 PP invested in tree
- [ ] Capstone locked until 24 PP invested in tree
- [ ] Tier 3 abilities cost 5 PP each to unlock
- [ ] Capstone costs 6 PP to unlock
- [ ] Unbreakable reduces all damage by 3 (minimum 1)
- [ ] Guardian's Sacrifice absorbs all damage for 2 Block Charges
- [ ] The Wall Lives prevents HP from dropping below 1 for 3 turns
- [ ] The Wall Lives usable once per combat
- [ ] ~7 unit tests pass

---

## Dependencies & Prerequisites

```
v0.17.3 (Archetype System) - REQUIRED
    │
    └── Warrior archetype foundation
                                    │
                                    ▼
v0.17.4 (Specialization Framework) - REQUIRED
    │
    ├── SpecializationDefinition entity
    ├── SpecializationPathType enum
    ├── SpecializationId enum (includes Skjaldmaer)
    ├── SpecialResourceDefinition
    └── Tier unlock mechanics (8/16/24 PP)
                                    │
                                    ▼
v0.20.0 (Legacy Class Removal) - REQUIRED
    │
    ├── IAbilitySlotService
    ├── ISpecializationPrerequisiteService
    └── Migration infrastructure
                                    │
                                    ▼
v0.20.1 (Skjaldmær)
    │
    ├── v0.20.1a: Framework & Tier 1 ──────────────────┐
    │       ├── BlockChargeResource                     │
    │       ├── Shield Wall                             │
    │       ├── Intercept                               │
    │       └── Bulwark                                 │
    │                                                   │
    ├── v0.20.1b: Tier 2 Abilities ────────────────────┤
    │       Dependencies: v0.20.1a                      │
    │       ├── Hold the Line                           │
    │       ├── Counter-Shield                          │
    │       └── Rally                                   │
    │                                                   │
    └── v0.20.1c: Tier 3 & Capstone ───────────────────┘
            Dependencies: v0.20.1a, v0.20.1b
            ├── Unbreakable
            ├── Guardian's Sacrifice
            └── The Wall Lives
```

---

## Block Charges Resource

### Resource Specification

```csharp
/// <summary>
/// Special resource for Skjaldmær specialization.
/// Block Charges power defensive abilities and modify Max HP through Bulwark.
/// </summary>
public sealed record BlockChargeResource
{
    /// <summary>Current number of Block Charges (0-3).</summary>
    public int CurrentCharges { get; private set; }

    /// <summary>Maximum Block Charges (default 3).</summary>
    public int MaxCharges { get; init; } = 3;

    /// <summary>When charges were last restored (for UI display).</summary>
    public DateTime? LastRestoredAt { get; private set; }

    /// <summary>
    /// Spends the specified number of Block Charges.
    /// </summary>
    /// <returns>True if charges were available and spent.</returns>
    public bool Spend(int amount)
    {
        if (amount <= 0 || CurrentCharges < amount)
            return false;

        CurrentCharges -= amount;
        return true;
    }

    /// <summary>
    /// Restores the specified number of Block Charges.
    /// </summary>
    public void Restore(int amount)
    {
        CurrentCharges = Math.Min(CurrentCharges + amount, MaxCharges);
        LastRestoredAt = DateTime.UtcNow;
    }

    /// <summary>
    /// Restores all Block Charges to maximum.
    /// </summary>
    public void RestoreAll()
    {
        CurrentCharges = MaxCharges;
        LastRestoredAt = DateTime.UtcNow;
    }

    /// <summary>
    /// Calculates Bulwark HP bonus based on current charges.
    /// </summary>
    public int GetBulwarkHpBonus() => CurrentCharges * 5;
}
```

### Resource Generation & Consumption

| Action                        | Effect                         |
| ----------------------------- | ------------------------------ |
| Rest (short or long)          | Restore all Block Charges to 3 |
| Intercept (Tier 1)            | Spend 1 Block Charge           |
| Guardian's Sacrifice (Tier 3) | Spend 2 Block Charges          |

---

## Ability Type Classification

### Ability Types Used

| Type         | Description                           | Examples in Skjaldmær                           |
| ------------ | ------------------------------------- | ----------------------------------------------- |
| **Stance**   | Toggle ability with persistent effect | Shield Wall                                     |
| **Reaction** | Triggered by specific combat events   | Intercept, Counter-Shield, Guardian's Sacrifice |
| **Passive**  | Always-on effect                      | Bulwark, Unbreakable                            |
| **Active**   | Standard ability with AP cost         | Hold the Line, Rally                            |
| **Ultimate** | Powerful ability with cooldown        | The Wall Lives                                  |

### Reaction Trigger Table

| Ability              | Trigger Event             | Timing                   |
| -------------------- | ------------------------- | ------------------------ |
| Intercept            | Ally targeted by attack   | Before attack roll       |
| Counter-Shield       | Successfully block attack | After attack misses      |
| Guardian's Sacrifice | Ally hit by attack        | After hit, before damage |

---

## Configuration Updates

### specializations.json

```json
{
    "specializations": [
        {
            "specializationId": "Skjaldmaer",
            "displayName": "Skjaldmær",
            "tagline": "The Living Shield",
            "description": "The Skjaldmær stands between allies and danger, absorbing blows that would fell lesser warriors. Their shield is not just a tool—it is an extension of their will.",
            "selectionText": "None shall fall while I stand. Your shield is the last line between the horror and the innocent.",
            "parentArchetype": "Warrior",
            "pathType": "Coherent",
            "specialResource": {
                "resourceId": "block-charges",
                "resourceName": "Block Charges",
                "description": "Consumable charges for powerful defensive abilities. Restored on rest.",
                "maxValue": 3,
                "startingValue": 3,
                "generationMethod": "Restore all on rest",
                "consumptionMethod": "Spent by Intercept (1) and Guardian's Sacrifice (2)"
            },
            "unlockCost": 0,
            "abilityTiers": [
                {
                    "tier": 1,
                    "ppRequirement": 0,
                    "abilityCost": 0,
                    "abilities": ["shield-wall", "intercept", "bulwark"]
                },
                {
                    "tier": 2,
                    "ppRequirement": 8,
                    "abilityCost": 4,
                    "abilities": ["hold-the-line", "counter-shield", "rally"]
                },
                {
                    "tier": 3,
                    "ppRequirement": 16,
                    "abilityCost": 5,
                    "abilities": ["unbreakable", "guardians-sacrifice"]
                },
                {
                    "tier": "capstone",
                    "ppRequirement": 24,
                    "abilityCost": 6,
                    "abilities": ["the-wall-lives"]
                }
            ]
        }
    ]
}
```

### abilities.json (Skjaldmær Section)

```json
{
    "abilities": [
        {
            "abilityId": "shield-wall",
            "displayName": "Shield Wall",
            "specializationId": "Skjaldmaer",
            "tier": 1,
            "type": "Stance",
            "apCost": 2,
            "description": "Enter a defensive stance, gaining +3 Defense. Adjacent allies gain +1 Defense while stance is active.",
            "requirements": {
                "equippedItemType": "Shield"
            },
            "effects": [
                {
                    "type": "DefenseModifier",
                    "target": "Self",
                    "value": 3
                },
                {
                    "type": "DefenseModifier",
                    "target": "AdjacentAllies",
                    "value": 1
                }
            ]
        },
        {
            "abilityId": "intercept",
            "displayName": "Intercept",
            "specializationId": "Skjaldmaer",
            "tier": 1,
            "type": "Reaction",
            "trigger": "AllyTargetedByAttack",
            "triggerRange": 2,
            "resourceCost": {
                "resourceId": "block-charges",
                "amount": 1
            },
            "description": "When an ally within 2 spaces is targeted by an attack, spend 1 Block Charge to redirect the attack to yourself.",
            "effects": [
                {
                    "type": "RedirectAttack",
                    "target": "Self"
                }
            ]
        },
        {
            "abilityId": "bulwark",
            "displayName": "Bulwark",
            "specializationId": "Skjaldmaer",
            "tier": 1,
            "type": "Passive",
            "description": "Gain +5 maximum HP for each Block Charge you currently hold.",
            "effects": [
                {
                    "type": "MaxHpModifier",
                    "formula": "BlockCharges * 5"
                }
            ]
        },
        {
            "abilityId": "hold-the-line",
            "displayName": "Hold the Line",
            "specializationId": "Skjaldmaer",
            "tier": 2,
            "type": "Active",
            "apCost": 3,
            "duration": 2,
            "durationUnit": "Turns",
            "description": "For 2 turns, enemies cannot move through your space. Allies pass freely.",
            "effects": [
                {
                    "type": "BlockMovement",
                    "target": "Enemies",
                    "affectedSpace": "Self"
                }
            ]
        },
        {
            "abilityId": "counter-shield",
            "displayName": "Counter-Shield",
            "specializationId": "Skjaldmaer",
            "tier": 2,
            "type": "Reaction",
            "trigger": "SuccessfulBlock",
            "description": "When you successfully block an attack from a melee attacker, deal 1d6 damage to them.",
            "requirements": {
                "attackerRange": "Melee"
            },
            "effects": [
                {
                    "type": "Damage",
                    "target": "Attacker",
                    "dice": "1d6",
                    "damageType": "Physical"
                }
            ]
        },
        {
            "abilityId": "rally",
            "displayName": "Rally",
            "specializationId": "Skjaldmaer",
            "tier": 2,
            "type": "Active",
            "apCost": 2,
            "range": 6,
            "description": "All allies within 6 spaces gain +2 to their next saving throw.",
            "effects": [
                {
                    "type": "ApplyBuff",
                    "buffId": "rally-bonus",
                    "target": "AlliesInRange",
                    "range": 6
                }
            ]
        },
        {
            "abilityId": "unbreakable",
            "displayName": "Unbreakable",
            "specializationId": "Skjaldmaer",
            "tier": 3,
            "type": "Passive",
            "description": "Reduce all damage taken by 3. Damage cannot be reduced below 1.",
            "effects": [
                {
                    "type": "DamageReduction",
                    "value": 3,
                    "minimumDamage": 1
                }
            ]
        },
        {
            "abilityId": "guardians-sacrifice",
            "displayName": "Guardian's Sacrifice",
            "specializationId": "Skjaldmaer",
            "tier": 3,
            "type": "Reaction",
            "trigger": "AllyHitByAttack",
            "triggerRange": 2,
            "resourceCost": {
                "resourceId": "block-charges",
                "amount": 2
            },
            "description": "When an ally within 2 spaces is hit by an attack, spend 2 Block Charges to absorb all damage from that attack.",
            "effects": [
                {
                    "type": "AbsorbDamage",
                    "source": "TriggeredAttack",
                    "percentage": 100
                }
            ]
        },
        {
            "abilityId": "the-wall-lives",
            "displayName": "The Wall Lives",
            "specializationId": "Skjaldmaer",
            "tier": "capstone",
            "type": "Ultimate",
            "apCost": 4,
            "duration": 3,
            "durationUnit": "Turns",
            "cooldown": "Combat",
            "description": "For 3 turns, you cannot be reduced below 1 HP. Usable once per combat.",
            "effects": [
                {
                    "type": "PreventLethalDamage",
                    "minimumHp": 1
                }
            ]
        }
    ]
}
```

---

## Estimated Effort Summary

| Phase     | New Files | Modified Files | Est. Tests | Complexity |
| --------- | --------- | -------------- | ---------- | ---------- |
| v0.20.1a  | ~5        | ~3             | ~10        | Medium     |
| v0.20.1b  | ~3        | ~2             | ~8         | Medium     |
| v0.20.1c  | ~3        | ~2             | ~7         | High       |
| **Total** | **~11**   | **~7**         | **~25**    |            |

---

## Risk Assessment

| Risk                                  | Impact | Probability | Mitigation                                          |
| ------------------------------------- | ------ | ----------- | --------------------------------------------------- |
| Block Charge depletion too fast       | Medium | Medium      | Tune rest restoration, consider combat regeneration |
| Shield Wall ally detection complexity | Medium | Low         | Use existing adjacency system from v0.14.x          |
| Damage absorption edge cases          | High   | Low         | Comprehensive unit tests for Guardian's Sacrifice   |
| The Wall Lives exploit potential      | Medium | Low         | Strict "once per combat" enforcement                |
| Stance stacking with other effects    | Medium | Medium      | Clear stance override rules in design spec          |

---

## Design Decisions (Confirmed)

### Block Charges

| Decision                               | Value     | Notes                                                  |
| -------------------------------------- | --------- | ------------------------------------------------------ |
| **Max Charges**                        | 3         | Provides meaningful choices without being overwhelming |
| **Restoration Method**                 | Rest only | Prevents infinite defensive loops                      |
| **Charge Cost (Intercept)**            | 1         | Allows multiple uses per combat                        |
| **Charge Cost (Guardian's Sacrifice)** | 2         | High cost for high reward                              |

### Ability Balance

| Decision                      | Value              | Notes                                                 |
| ----------------------------- | ------------------ | ----------------------------------------------------- |
| **Shield Wall Defense Bonus** | +3 self, +1 allies | Significant but not overwhelming                      |
| **Intercept Range**           | 2 spaces           | Requires tactical positioning                         |
| **Bulwark HP Bonus**          | +5 per charge      | Max +15 HP encourages holding charges                 |
| **Unbreakable Reduction**     | 3 (minimum 1)      | Consistent with other damage reduction                |
| **The Wall Lives Duration**   | 3 turns            | Long enough to matter, short enough to not trivialize |

### Reaction Timing

| Decision                        | Value                    | Notes                           |
| ------------------------------- | ------------------------ | ------------------------------- |
| **Intercept Timing**            | Before attack roll       | Redirects the entire attack     |
| **Counter-Shield Timing**       | After miss               | Requires successful defense     |
| **Guardian's Sacrifice Timing** | After hit, before damage | Allows absorbing confirmed hits |

---

## Unit Test Specifications

### v0.20.1a Tests (~10 tests)

#### BlockChargeResourceTests.cs

```csharp
[TestFixture]
public class BlockChargeResourceTests
{
    [Test]
    public void Create_InitializesWithMaxCharges();

    [Test]
    public void Spend_SufficientCharges_ReturnsTrue();

    [Test]
    public void Spend_InsufficientCharges_ReturnsFalse();

    [Test]
    public void RestoreAll_SetsToMaxCharges();

    [Test]
    public void GetBulwarkHpBonus_ReturnsCorrectValue();
}
```

#### SkjaldmaerAbilityServiceTests.cs

```csharp
[TestFixture]
public class SkjaldmaerAbilityServiceTests
{
    [Test]
    public void ActivateShieldWall_GrantsDefenseBonus();

    [Test]
    public void ActivateShieldWall_GrantsAllyDefenseBonus();

    [Test]
    public void Intercept_RedirectsAttack_CostsOneCharge();

    [Test]
    public void Bulwark_CalculatesMaxHpBonus();

    [Test]
    public void Bulwark_AdjustsWhenChargesChange();
}
```

### v0.20.1b Tests (~8 tests)

#### Tier2AbilityTests.cs

```csharp
[TestFixture]
public class Tier2AbilityTests
{
    [Test]
    public void HoldTheLine_PreventsEnemyMovement();

    [Test]
    public void HoldTheLine_AllowsAllyMovement();

    [Test]
    public void HoldTheLine_ExpiresAfterTwoTurns();

    [Test]
    public void CounterShield_DealsDamageOnBlock();

    [Test]
    public void CounterShield_RequiresMeleeRange();

    [Test]
    public void Rally_GrantsSaveBonus();

    [Test]
    public void Rally_BonusConsumedAfterSave();

    [Test]
    public void Tier2_LockedUntil8PPInvested();
}
```

### v0.20.1c Tests (~7 tests)

#### Tier3AndCapstoneTests.cs

```csharp
[TestFixture]
public class Tier3AndCapstoneTests
{
    [Test]
    public void Unbreakable_ReducesDamageByThree();

    [Test]
    public void Unbreakable_MinimumOneDamage();

    [Test]
    public void GuardiansSacrifice_AbsorbsAllDamage();

    [Test]
    public void GuardiansSacrifice_CostsTwoCharges();

    [Test]
    public void TheWallLives_PreventsLethalDamage();

    [Test]
    public void TheWallLives_ExpiresAfterThreeTurns();

    [Test]
    public void TheWallLives_OncePerCombat();
}
```

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│               v0.20.1 Skjaldmær Specialization                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Domain Layer                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │   Block      │  │  ShieldWall  │  │  Intercept   │  │   │
│  │  │  Charge      │  │   State      │  │   Result     │  │   │
│  │  │  Resource    │  │ Value Object │  │ Value Object │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │  HoldTheLine │  │   Rally      │  │  Guardian's  │  │   │
│  │  │    State     │  │   Buff       │  │  Sacrifice   │  │   │
│  │  │ Value Object │  │ Value Object │  │    Result    │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │                                                          │   │
│  │  ┌──────────────┐  ┌──────────────┐                     │   │
│  │  │  Skjaldmær  │  │  TheWall     │                     │   │
│  │  │  AbilityId   │  │   Lives      │                     │   │
│  │  │    Enum      │  │   State      │                     │   │
│  │  └──────────────┘  └──────────────┘                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  Application Layer                       │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │  IBlock      │  │ ISkjaldmær  │  │  IReaction   │  │   │
│  │  │  Charge      │  │   Ability    │  │   Service    │  │   │
│  │  │   Service    │  │   Service    │  │              │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  │         │                  │                  │         │   │
│  │         ▼                  ▼                  ▼         │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │   │
│  │  │   Block      │  │ Skjaldmær   │  │  Reaction    │  │   │
│  │  │  Charge      │  │   Ability    │  │   Service    │  │   │
│  │  │Service Impl  │  │ Service Impl │  │    Impl      │  │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 Infrastructure Layer                     │   │
│  │  ┌──────────────────────┐  ┌──────────────────────┐    │   │
│  │  │ specializations.json │  │ abilities.json       │    │   │
│  │  │ (Skjaldmær entry)   │  │ (9 Skjaldmær        │    │   │
│  │  │                      │  │  abilities)          │    │   │
│  │  └──────────────────────┘  └──────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

Block Charge Resource Flow:
┌─────────────┐                    ┌─────────────┐                ┌─────────────┐
│    Rest     │ ─────────────────► │   Block     │ ──────────────►│  Defensive  │
│  (Short)    │  Restore to Max    │  Charges    │  Spend Charge  │  Abilities  │
└─────────────┘                    └─────────────┘                └─────────────┘
                                          │
                                          ▼ Reaction Trigger
                                   ┌─────────────┐
                                   │ Intercept / │
                                   │ CounterShield│
                                   └─────────────┘
```

---

## Integration Points

### With v0.20.0 Systems

| System                               | Integration Point                            |
| ------------------------------------ | -------------------------------------------- |
| `IAbilitySlotService`                | Initialize Skjaldmær ability slots (3+3+2+1) |
| `ISpecializationPrerequisiteService` | Validate Warrior archetype requirement       |

### With Core Systems

| System               | Integration Point                     |
| -------------------- | ------------------------------------- |
| Combat System        | Reaction triggers, damage pipeline    |
| Rest System          | Block Charge restoration              |
| Status Effect System | Rally buff application                |
| Position System      | Adjacent ally detection, range checks |

### Provides to Future Versions

| Provides                   | Consumer                                 |
| -------------------------- | ---------------------------------------- |
| Block Charge pattern       | Other resource-based specializations     |
| Reaction ability framework | Berserkr (v0.20.5), other specs          |
| Stance system              | Future stance-based abilities            |
| Damage reduction pipeline  | Unbreakable pattern for other defensives |

---

## Deliverable Checklist

### Domain Layer

- [ ] `BlockChargeResource` value object
- [ ] `ShieldWallState` value object
- [ ] `HoldTheLineState` value object
- [ ] `RallyBuff` value object
- [ ] `TheWallLivesState` value object
- [ ] `SkjaldmaerAbilityId` enum

### Application Layer

- [ ] `BlockChargeService` implementation
- [ ] `SkjaldmaerAbilityService` implementation
- [ ] Shield Wall ability handler
- [ ] Intercept ability handler
- [ ] Bulwark passive integration
- [ ] Hold the Line ability handler
- [ ] Counter-Shield ability handler
- [ ] Rally ability handler
- [ ] Unbreakable passive integration
- [ ] Guardian's Sacrifice ability handler
- [ ] The Wall Lives ability handler

### Infrastructure Layer

- [ ] `specializations.json` Skjaldmær entry
- [ ] `abilities.json` Skjaldmær abilities (9 total)

### Tests

- [ ] BlockChargeResourceTests.cs (~5 tests)
- [ ] SkjaldmaerAbilityServiceTests.cs (~5 tests)
- [ ] Tier2AbilityTests.cs (~8 tests)
- [ ] Tier3AndCapstoneTests.cs (~7 tests)

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown with stakeholders
2. **v0.20.1a Design Spec** - Create detailed design specification for Tier 1
3. **Implement v0.20.1a** - Build Block Charges and Tier 1 abilities
4. **v0.20.1b Design Spec** - Create detailed design specification for Tier 2
5. **Implement v0.20.1b** - Build Tier 2 abilities
6. **v0.20.1c Design Spec** - Create detailed design specification for Tier 3 & Capstone
7. **Implement v0.20.1c** - Build Tier 3 abilities and The Wall Lives
8. **Proceed to v0.20.2** - Rúnasmiðr specialization

---

_This scope breakdown provides a structured approach to implementing the Skjaldmær specialization. Each sub-phase builds on the previous, allowing for incremental development and testing of the defensive tank archetype._
