# v0.7.2a Design Specification: Inventory Panel

**Version:** 0.7.2a
**Parent:** v0.7.2 (Interactive Panels)
**Prerequisites:** v0.7.1c Complete (Core Display Panels - Message Log)
**Status:** Design Complete
**Estimated Unit Tests:** ~10

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Inventory Panel](#4-inventory-panel)
5. [Inventory Panel ViewModel](#5-inventory-panel-viewmodel)
6. [Item Slot Control](#6-item-slot-control)
7. [Item Slot ViewModel](#7-item-slot-viewmodel)
8. [Drag-and-Drop Behavior](#8-drag-and-drop-behavior)
9. [Styles](#9-styles)
10. [Data Model Changes](#10-data-model-changes)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)

---

## 1. Overview

### Purpose

This phase implements the interactive inventory panel that displays items in a clickable grid. Users can select items to view details, navigate with keyboard, and optionally reorder items via drag-and-drop. The panel occupies the RightSidebarBottom region of the GameWindow.

### Key Deliverables

| Category | Items |
|----------|-------|
| **User Controls** | `InventoryPanel`, `ItemSlotControl` |
| **ViewModels** | `InventoryPanelViewModel`, `ItemSlotViewModel` |
| **Behaviors** | `DragDropReorderBehavior` |
| **Styles** | `InventoryStyles.axaml` |
| **Tests** | ~10 unit tests |

### Design Principles

1. **Grid-Based Layout**: Clear visual organization of items
2. **Click-to-Select**: Single click selects item for details
3. **Keyboard Accessible**: Arrow keys navigate slots
4. **Drag-to-Reorder**: Optional reorganization of items

---

## 2. Feature Overview

```
v0.7.2a Features
â”œâ”€â”€ Inventory Panel (UserControl)
â”‚   â”œâ”€â”€ Item grid (5 columns, configurable)
â”‚   â”œâ”€â”€ Selected item details pane
â”‚   â”œâ”€â”€ Capacity indicator
â”‚   â”œâ”€â”€ Weight indicator
â”‚   â””â”€â”€ Empty slot display
â”œâ”€â”€ Item Slot Control (TemplatedControl)
â”‚   â”œâ”€â”€ Item property
â”‚   â”œâ”€â”€ IsSelected property
â”‚   â”œâ”€â”€ IsEmpty computed property
â”‚   â”œâ”€â”€ Category icon display
â”‚   â”œâ”€â”€ Short name display
â”‚   â””â”€â”€ Tooltip on hover
â”œâ”€â”€ Inventory Panel ViewModel
â”‚   â”œâ”€â”€ Slots collection
â”‚   â”œâ”€â”€ SelectedSlot property
â”‚   â”œâ”€â”€ SelectedItem property
â”‚   â”œâ”€â”€ Capacity/Weight tracking
â”‚   â”œâ”€â”€ SelectSlotCommand
â”‚   â”œâ”€â”€ MoveItemCommand
â”‚   â””â”€â”€ Keyboard navigation
â”œâ”€â”€ Item Slot ViewModel
â”‚   â”œâ”€â”€ Index property
â”‚   â”œâ”€â”€ Item property
â”‚   â”œâ”€â”€ IsSelected property
â”‚   â”œâ”€â”€ Icon computed property
â”‚   â””â”€â”€ ShortName computed property
â””â”€â”€ Drag-and-Drop Behavior
    â”œâ”€â”€ Drag initiation
    â”œâ”€â”€ Drop handling
    â””â”€â”€ Visual feedback
```

---

## 3. Architecture

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PRESENTATION LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  VIEWS                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      InventoryPanel                                â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ - HeaderSection (title, capacity indicator)                       â”‚ â”‚
â”‚  â”‚ - GridSection (UniformGrid of ItemSlotControls)                   â”‚ â”‚
â”‚  â”‚ - DetailsSection (selected item info)                             â”‚ â”‚
â”‚  â”‚ - FooterSection (weight indicator)                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                   â”‚ DataContext                        â”‚
â”‚                                   â–¼                                    â”‚
â”‚  VIEWMODELS                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  InventoryPanelViewModel                           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ + Slots: ObservableCollection<ItemSlotViewModel>                  â”‚ â”‚
â”‚  â”‚ + SelectedSlot: ItemSlotViewModel?                                â”‚ â”‚
â”‚  â”‚ + SelectedItem: Item?                                             â”‚ â”‚
â”‚  â”‚ + CurrentCapacity: int                                            â”‚ â”‚
â”‚  â”‚ + MaxCapacity: int                                                â”‚ â”‚
â”‚  â”‚ + CurrentWeight: double                                           â”‚ â”‚
â”‚  â”‚ + MaxWeight: double                                               â”‚ â”‚
â”‚  â”‚ + GridColumns: int (default 5)                                    â”‚ â”‚
â”‚  â”‚ + SelectSlotCommand                                               â”‚ â”‚
â”‚  â”‚ + MoveItemCommand                                                 â”‚ â”‚
â”‚  â”‚ + NavigateCommand (arrow keys)                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  CUSTOM CONTROLS                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ItemSlotControl                               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ + Item: Item? (StyledProperty)                                    â”‚ â”‚
â”‚  â”‚ + IsSelected: bool (StyledProperty)                               â”‚ â”‚
â”‚  â”‚ + IsEmpty: bool (computed)                                        â”‚ â”‚
â”‚  â”‚ + Icon: string (computed)                                         â”‚ â”‚
â”‚  â”‚ + ShortName: string (computed)                                    â”‚ â”‚
â”‚  â”‚ + Tooltip: string (computed)                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  SUPPORTING VIEWMODELS                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      ItemSlotViewModel                             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ + Index: int                                                      â”‚ â”‚
â”‚  â”‚ + Item: Item?                                                     â”‚ â”‚
â”‚  â”‚ + IsSelected: bool                                                â”‚ â”‚
â”‚  â”‚ + IsEmpty: bool                                                   â”‚ â”‚
â”‚  â”‚ + Icon: string                                                    â”‚ â”‚
â”‚  â”‚ + ShortName: string                                               â”‚ â”‚
â”‚  â”‚ + Tooltip: string                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APPLICATION LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      IGameSessionService                           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ + OnInventoryChanged: event Action<Inventory>                      â”‚â”‚
â”‚  â”‚ + CurrentPlayer: Player                                            â”‚â”‚
â”‚  â”‚ + ReorderInventory(fromIndex, toIndex): void                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INVENTORY UPDATE FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Player picks up / drops / uses item
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               GameSessionService.OnInventoryChanged                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Raises event with updated Inventory entity                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        InventoryPanelViewModel.HandleInventoryChanged(inventory)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Update CurrentCapacity, MaxCapacity                                â”‚
â”‚  2. Update CurrentWeight, MaxWeight                                    â”‚
â”‚  3. Update Slots with item data                                        â”‚
â”‚  4. Clear selection if selected item removed                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   InventoryPanel (UI Updates)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - Grid slots refresh with item icons                                  â”‚
â”‚  - Capacity/weight indicators update                                   â”‚
â”‚  - Details pane updates if selection changed                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Inventory Panel

### Panel Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           INVENTORY                  â”‚
â”‚           8/15 items                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”      â”‚
â”‚ â”‚ âš” â”‚ â”‚ ğŸ›¡ â”‚ â”‚ ğŸ§ªâ”‚ â”‚ ğŸ§ªâ”‚ â”‚ ğŸ”‘â”‚      â”‚   Row 1
â”‚ â”‚Swdâ”‚ â”‚Shdâ”‚ â”‚Potâ”‚ â”‚Potâ”‚ â”‚Keyâ”‚      â”‚
â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜      â”‚
â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”      â”‚
â”‚ â”‚ ğŸ“œâ”‚ â”‚ ğŸ’â”‚ â”‚â–“â–“â–“â”‚ â”‚   â”‚ â”‚   â”‚      â”‚   Row 2 (â–“ = selected)
â”‚ â”‚Scrâ”‚ â”‚Rngâ”‚ â”‚Gemâ”‚ â”‚   â”‚ â”‚   â”‚      â”‚
â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜      â”‚
â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”      â”‚
â”‚ â”‚   â”‚ â”‚   â”‚ â”‚   â”‚ â”‚   â”‚ â”‚   â”‚      â”‚   Row 3 (empty)
â”‚ â”‚   â”‚ â”‚   â”‚ â”‚   â”‚ â”‚   â”‚ â”‚   â”‚      â”‚
â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜      â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ’ Red Gem                      â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ A brilliant red gemstone that  â”‚ â”‚
â”‚ â”‚ sparkles with inner fire.      â”‚ â”‚
â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ Type: Treasure                  â”‚ â”‚
â”‚ â”‚ Value: 50 gold                  â”‚ â”‚
â”‚ â”‚ Weight: 0.5 lbs                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Weight: 12.5/50 lbs                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### XAML Implementation

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/InventoryPanel.axaml`

```xml
<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
             xmlns:ctrl="using:RuneAndRust.Avalonia.Controls"
             x:Class="RuneAndRust.Avalonia.Controls.InventoryPanel"
             x:DataType="vm:InventoryPanelViewModel"
             Focusable="True"
             KeyDown="OnKeyDown">
    
    <Design.DataContext>
        <vm:InventoryPanelViewModel />
    </Design.DataContext>
    
    <Grid RowDefinitions="Auto,*,Auto,Auto">
        
        <!-- Header -->
        <Border Grid.Row="0" Classes="panel-header" Padding="12,8">
            <Grid ColumnDefinitions="*,Auto">
                <TextBlock Text="INVENTORY"
                           Classes="secondary"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center" />
                <TextBlock Grid.Column="1" Classes="muted" VerticalAlignment="Center">
                    <Run Text="{Binding CurrentCapacity}" />
                    <Run Text="/" />
                    <Run Text="{Binding MaxCapacity}" />
                    <Run Text=" items" />
                </TextBlock>
            </Grid>
        </Border>
        
        <!-- Item Grid -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Slots}" Margin="8">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <UniformGrid Columns="{Binding GridColumns}" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="vm:ItemSlotViewModel">
                        <ctrl:ItemSlotControl Item="{Binding Item}"
                                              IsSelected="{Binding IsSelected}"
                                              Margin="2"
                                              PointerPressed="OnSlotPointerPressed"
                                              DoubleTapped="OnSlotDoubleTapped" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        
        <!-- Details Section -->
        <Border Grid.Row="2" Classes="panel" Padding="12"
                IsVisible="{Binding SelectedItem, Converter={x:Static ObjectConverters.IsNotNull}}">
            <StackPanel Spacing="8">
                <!-- Item Header -->
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="{Binding SelectedItemIcon}"
                               FontSize="18" />
                    <TextBlock Text="{Binding SelectedItem.Name}"
                               Classes="heading" />
                </StackPanel>
                
                <!-- Description -->
                <TextBlock Text="{Binding SelectedItem.Description}"
                           Classes="body"
                           TextWrapping="Wrap"
                           MaxLines="3" />
                
                <!-- Stats Grid -->
                <Grid ColumnDefinitions="80,*" RowDefinitions="Auto,Auto,Auto">
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Type:" Classes="muted" />
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SelectedItem.ItemType}" />
                    
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Value:" Classes="muted" />
                    <TextBlock Grid.Row="1" Grid.Column="1">
                        <Run Text="{Binding SelectedItem.Value}" />
                        <Run Text=" gold" Classes="muted" />
                    </TextBlock>
                    
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Weight:" Classes="muted" />
                    <TextBlock Grid.Row="2" Grid.Column="1">
                        <Run Text="{Binding SelectedItem.Weight}" />
                        <Run Text=" lbs" Classes="muted" />
                    </TextBlock>
                </Grid>
            </StackPanel>
        </Border>
        
        <!-- Empty State -->
        <Border Grid.Row="2" Classes="panel" Padding="12"
                IsVisible="{Binding SelectedItem, Converter={x:Static ObjectConverters.IsNull}}">
            <TextBlock Text="Select an item to view details"
                       Classes="muted"
                       HorizontalAlignment="Center" />
        </Border>
        
        <!-- Footer -->
        <Border Grid.Row="3" Classes="panel-footer" Padding="8">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock Text="Weight:" Classes="muted" />
                <TextBlock>
                    <Run Text="{Binding CurrentWeight, StringFormat='{}{0:F1}'}" />
                    <Run Text="/" Classes="muted" />
                    <Run Text="{Binding MaxWeight, StringFormat='{}{0:F1}'}" />
                    <Run Text=" lbs" Classes="muted" />
                </TextBlock>
                
                <!-- Weight warning -->
                <TextBlock Text="âš  Heavy"
                           Foreground="{StaticResource WarningColor}"
                           IsVisible="{Binding IsOverweightWarning}" />
            </StackPanel>
        </Border>
        
    </Grid>
</UserControl>
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/InventoryPanel.axaml.cs`

```csharp
namespace RuneAndRust.Avalonia.Controls;

using global::Avalonia.Controls;
using global::Avalonia.Input;
using RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// Panel control displaying the player's inventory.
/// </summary>
public partial class InventoryPanel : UserControl
{
    public InventoryPanel()
    {
        InitializeComponent();
    }

    private void OnSlotPointerPressed(object? sender, PointerPressedEventArgs e)
    {
        if (sender is ItemSlotControl control && 
            DataContext is InventoryPanelViewModel vm)
        {
            var point = e.GetCurrentPoint(control);
            
            if (point.Properties.IsLeftButtonPressed)
            {
                // Find the corresponding slot ViewModel
                if (control.DataContext is ItemSlotViewModel slotVm)
                {
                    vm.SelectSlotCommand.Execute(slotVm);
                }
            }
        }
    }

    private void OnSlotDoubleTapped(object? sender, TappedEventArgs e)
    {
        // Double-click could trigger default action (use/equip)
        // Integration point for v0.7.2b context menus
    }

    private void OnKeyDown(object? sender, KeyEventArgs e)
    {
        if (DataContext is not InventoryPanelViewModel vm)
            return;

        switch (e.Key)
        {
            case Key.Left:
                vm.NavigateCommand.Execute("left");
                e.Handled = true;
                break;
            case Key.Right:
                vm.NavigateCommand.Execute("right");
                e.Handled = true;
                break;
            case Key.Up:
                vm.NavigateCommand.Execute("up");
                e.Handled = true;
                break;
            case Key.Down:
                vm.NavigateCommand.Execute("down");
                e.Handled = true;
                break;
        }
    }
}
```

---

## 5. Inventory Panel ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/InventoryPanelViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using System.Collections.ObjectModel;
using Serilog;

/// <summary>
/// View model for the inventory panel.
/// </summary>
public partial class InventoryPanelViewModel : ViewModelBase
{
    private readonly IGameSessionService? _gameSession;

    [ObservableProperty]
    private ObservableCollection<ItemSlotViewModel> _slots = new();

    [ObservableProperty]
    private ItemSlotViewModel? _selectedSlot;

    [ObservableProperty]
    private Item? _selectedItem;

    [ObservableProperty]
    private string _selectedItemIcon = "";

    [ObservableProperty]
    private int _currentCapacity;

    [ObservableProperty]
    private int _maxCapacity = 15;

    [ObservableProperty]
    private double _currentWeight;

    [ObservableProperty]
    private double _maxWeight = 50.0;

    [ObservableProperty]
    private bool _isOverweightWarning;

    /// <summary>
    /// Number of columns in the inventory grid.
    /// </summary>
    public int GridColumns { get; } = 5;

    /// <summary>
    /// Creates a new InventoryPanelViewModel with game session.
    /// </summary>
    public InventoryPanelViewModel(IGameSessionService gameSession)
    {
        _gameSession = gameSession;
        _gameSession.OnInventoryChanged += HandleInventoryChanged;

        InitializeSlots();

        // Initialize with current inventory if available
        if (_gameSession.CurrentPlayer?.Inventory is not null)
        {
            HandleInventoryChanged(_gameSession.CurrentPlayer.Inventory);
        }
    }

    /// <summary>
    /// Design-time constructor with sample data.
    /// </summary>
    public InventoryPanelViewModel()
    {
        InitializeSlots();
        AddSampleItems();
    }

    /// <summary>
    /// Selects an inventory slot.
    /// </summary>
    [RelayCommand]
    private void SelectSlot(ItemSlotViewModel? slot)
    {
        // Deselect previous
        if (SelectedSlot is not null)
        {
            SelectedSlot.IsSelected = false;
        }

        // Select new
        SelectedSlot = slot;
        
        if (slot is not null)
        {
            slot.IsSelected = true;
            SelectedItem = slot.Item;
            SelectedItemIcon = slot.Icon;
            Log.Debug("Selected inventory slot {Index}: {ItemName}", 
                slot.Index, slot.Item?.Name ?? "Empty");
        }
        else
        {
            SelectedItem = null;
            SelectedItemIcon = "";
        }
    }

    /// <summary>
    /// Moves an item between slots (drag-and-drop).
    /// </summary>
    [RelayCommand]
    private void MoveItem(MoveItemArgs args)
    {
        if (args.From?.Item is null)
            return;

        Log.Information("Moving item from slot {FromIndex} to {ToIndex}", 
            args.From.Index, args.To.Index);

        // Swap items in view models
        (args.From.Item, args.To.Item) = (args.To.Item, args.From.Item);

        // Notify game session
        _gameSession?.ReorderInventory(args.From.Index, args.To.Index);
    }

    /// <summary>
    /// Navigates selection with arrow keys.
    /// </summary>
    [RelayCommand]
    private void Navigate(string direction)
    {
        if (SelectedSlot is null)
        {
            // Select first slot if none selected
            if (Slots.Count > 0)
                SelectSlot(Slots[0]);
            return;
        }

        var currentIndex = SelectedSlot.Index;
        var newIndex = direction switch
        {
            "left" => currentIndex > 0 ? currentIndex - 1 : currentIndex,
            "right" => currentIndex < Slots.Count - 1 ? currentIndex + 1 : currentIndex,
            "up" => currentIndex >= GridColumns ? currentIndex - GridColumns : currentIndex,
            "down" => currentIndex + GridColumns < Slots.Count ? currentIndex + GridColumns : currentIndex,
            _ => currentIndex
        };

        if (newIndex != currentIndex)
        {
            SelectSlot(Slots[newIndex]);
        }
    }

    private void InitializeSlots()
    {
        Slots.Clear();
        for (int i = 0; i < MaxCapacity; i++)
        {
            Slots.Add(new ItemSlotViewModel { Index = i });
        }
    }

    private void HandleInventoryChanged(Inventory inventory)
    {
        Log.Debug("Inventory changed: {Count} items", inventory.Items.Count);

        CurrentCapacity = inventory.Items.Count;
        MaxCapacity = inventory.MaxCapacity;
        CurrentWeight = inventory.TotalWeight;
        MaxWeight = inventory.MaxWeight;
        IsOverweightWarning = CurrentWeight > MaxWeight * 0.9;

        // Ensure we have enough slots
        while (Slots.Count < MaxCapacity)
        {
            Slots.Add(new ItemSlotViewModel { Index = Slots.Count });
        }

        // Update slot items
        for (int i = 0; i < Slots.Count; i++)
        {
            Slots[i].Item = i < inventory.Items.Count ? inventory.Items[i] : null;
        }

        // Clear selection if selected item was removed
        if (SelectedSlot?.Item is null && SelectedItem is not null)
        {
            SelectSlot(null);
        }
    }

    private void AddSampleItems()
    {
        CurrentCapacity = 8;
        CurrentWeight = 12.5;
        
        Slots[0].Item = CreateSampleItem("Iron Sword", "weapon", "âš”");
        Slots[1].Item = CreateSampleItem("Leather Shield", "armor", "ğŸ›¡");
        Slots[2].Item = CreateSampleItem("Healing Potion", "potion", "ğŸ§ª");
        Slots[3].Item = CreateSampleItem("Mana Potion", "potion", "ğŸ§ª");
        Slots[4].Item = CreateSampleItem("Rusty Key", "key", "ğŸ”‘");
        Slots[5].Item = CreateSampleItem("Ancient Scroll", "scroll", "ğŸ“œ");
        Slots[6].Item = CreateSampleItem("Silver Ring", "ring", "ğŸ’");
        Slots[7].Item = CreateSampleItem("Red Gem", "treasure", "ğŸ’");
    }

    private static Item CreateSampleItem(string name, string type, string icon)
    {
        return new Item
        {
            Name = name,
            ItemType = type,
            Description = $"A {name.ToLower()} of fine quality.",
            Value = 50,
            Weight = 1.0
        };
    }
}

/// <summary>
/// Arguments for moving items between slots.
/// </summary>
public record MoveItemArgs(ItemSlotViewModel From, ItemSlotViewModel To);
```

---

## 6. Item Slot Control

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/ItemSlotControl.cs`

```csharp
namespace RuneAndRust.Avalonia.Controls;

using global::Avalonia;
using global::Avalonia.Controls.Primitives;
using RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a single inventory slot in the grid.
/// </summary>
public class ItemSlotControl : TemplatedControl
{
    public static readonly StyledProperty<Item?> ItemProperty =
        AvaloniaProperty.Register<ItemSlotControl, Item?>(nameof(Item));

    public static readonly StyledProperty<bool> IsSelectedProperty =
        AvaloniaProperty.Register<ItemSlotControl, bool>(nameof(IsSelected));

    /// <summary>
    /// Gets or sets the item in this slot.
    /// </summary>
    public Item? Item
    {
        get => GetValue(ItemProperty);
        set => SetValue(ItemProperty, value);
    }

    /// <summary>
    /// Gets or sets whether this slot is selected.
    /// </summary>
    public bool IsSelected
    {
        get => GetValue(IsSelectedProperty);
        set => SetValue(IsSelectedProperty, value);
    }

    /// <summary>
    /// Gets whether the slot is empty.
    /// </summary>
    public bool IsEmpty => Item is null;

    /// <summary>
    /// Gets the category icon for the item.
    /// </summary>
    public string Icon => Item?.GetCategoryIcon() ?? " ";

    /// <summary>
    /// Gets the shortened name for display.
    /// </summary>
    public string ShortName => Item?.Name.Length > 3 
        ? Item.Name[..3] 
        : Item?.Name ?? "";

    /// <summary>
    /// Gets the tooltip text.
    /// </summary>
    public string Tooltip => Item?.Name ?? "Empty Slot";

    static ItemSlotControl()
    {
        ItemProperty.Changed.AddClassHandler<ItemSlotControl>((c, _) => c.OnItemChanged());
    }

    private void OnItemChanged()
    {
        // Trigger updates for computed properties
        Classes.Set("empty", IsEmpty);
        Classes.Set("filled", !IsEmpty);
    }
}
```

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/ItemSlotControl.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ctrl="using:RuneAndRust.Avalonia.Controls">
    
    <Style Selector="ctrl|ItemSlotControl">
        <Setter Property="Width" Value="52" />
        <Setter Property="Height" Value="52" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="ToolTip.Tip" Value="{Binding Tooltip, RelativeSource={RelativeSource Self}}" />
        <Setter Property="Template">
            <ControlTemplate>
                <Border Name="SlotBorder"
                        Background="{StaticResource SurfaceBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4">
                    <Grid RowDefinitions="*,Auto">
                        <!-- Icon -->
                        <TextBlock Grid.Row="0"
                                   Text="{TemplateBinding Icon}"
                                   FontSize="18"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center" />
                        
                        <!-- Short Name -->
                        <TextBlock Grid.Row="1"
                                   Text="{TemplateBinding ShortName}"
                                   FontSize="9"
                                   Classes="muted"
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,2" />
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>
    </Style>
    
    <!-- Empty slot -->
    <Style Selector="ctrl|ItemSlotControl.empty">
        <Setter Property="Opacity" Value="0.5" />
    </Style>
    
    <Style Selector="ctrl|ItemSlotControl.empty /template/ Border#SlotBorder">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderDarkBrush}" />
    </Style>
    
    <!-- Hover -->
    <Style Selector="ctrl|ItemSlotControl:pointerover /template/ Border#SlotBorder">
        <Setter Property="BorderBrush" Value="{StaticResource PrimaryLightBrush}" />
    </Style>
    
    <!-- Selected -->
    <Style Selector="ctrl|ItemSlotControl[IsSelected=True] /template/ Border#SlotBorder">
        <Setter Property="Background" Value="{StaticResource PrimaryBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}" />
        <Setter Property="BorderThickness" Value="2" />
    </Style>
    
</Styles>
```

---

## 7. Item Slot ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/ItemSlotViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

using CommunityToolkit.Mvvm.ComponentModel;
using RuneAndRust.Domain.Entities;

/// <summary>
/// View model for an inventory slot.
/// </summary>
public partial class ItemSlotViewModel : ViewModelBase
{
    /// <summary>
    /// Gets or sets the slot index.
    /// </summary>
    public int Index { get; set; }

    [ObservableProperty]
    private Item? _item;

    [ObservableProperty]
    private bool _isSelected;

    /// <summary>
    /// Gets whether the slot is empty.
    /// </summary>
    public bool IsEmpty => Item is null;

    /// <summary>
    /// Gets the category icon.
    /// </summary>
    public string Icon => Item?.GetCategoryIcon() ?? " ";

    /// <summary>
    /// Gets the short name for display.
    /// </summary>
    public string ShortName => Item?.Name.Length > 3
        ? Item.Name[..3]
        : Item?.Name ?? "";

    /// <summary>
    /// Gets the tooltip text.
    /// </summary>
    public string Tooltip => Item?.Name ?? "Empty Slot";

    partial void OnItemChanged(Item? value)
    {
        OnPropertyChanged(nameof(IsEmpty));
        OnPropertyChanged(nameof(Icon));
        OnPropertyChanged(nameof(ShortName));
        OnPropertyChanged(nameof(Tooltip));
    }
}
```

---

## 8. Drag-and-Drop Behavior

**File:** `src/Presentation/RuneAndRust.Avalonia/Behaviors/DragDropReorderBehavior.cs`

```csharp
namespace RuneAndRust.Avalonia.Behaviors;

using global::Avalonia;
using global::Avalonia.Controls;
using global::Avalonia.Input;
using global::Avalonia.Interactivity;
using global::Avalonia.Xaml.Interactivity;
using RuneAndRust.Avalonia.Controls;
using RuneAndRust.Avalonia.ViewModels;

/// <summary>
/// Behavior that enables drag-and-drop reordering of inventory slots.
/// </summary>
public class DragDropReorderBehavior : Behavior<ItemSlotControl>
{
    private Point _dragStartPoint;
    private bool _isDragging;

    protected override void OnAttached()
    {
        base.OnAttached();
        
        if (AssociatedObject is null)
            return;

        AssociatedObject.AddHandler(InputElement.PointerPressedEvent, OnPointerPressed, RoutingStrategies.Tunnel);
        AssociatedObject.AddHandler(InputElement.PointerMovedEvent, OnPointerMoved, RoutingStrategies.Tunnel);
        AssociatedObject.AddHandler(InputElement.PointerReleasedEvent, OnPointerReleased, RoutingStrategies.Tunnel);
        
        DragDrop.SetAllowDrop(AssociatedObject, true);
        AssociatedObject.AddHandler(DragDrop.DropEvent, OnDrop);
        AssociatedObject.AddHandler(DragDrop.DragOverEvent, OnDragOver);
    }

    protected override void OnDetaching()
    {
        if (AssociatedObject is not null)
        {
            AssociatedObject.RemoveHandler(InputElement.PointerPressedEvent, OnPointerPressed);
            AssociatedObject.RemoveHandler(InputElement.PointerMovedEvent, OnPointerMoved);
            AssociatedObject.RemoveHandler(InputElement.PointerReleasedEvent, OnPointerReleased);
            AssociatedObject.RemoveHandler(DragDrop.DropEvent, OnDrop);
            AssociatedObject.RemoveHandler(DragDrop.DragOverEvent, OnDragOver);
        }
        
        base.OnDetaching();
    }

    private void OnPointerPressed(object? sender, PointerPressedEventArgs e)
    {
        if (AssociatedObject?.Item is not null)
        {
            _dragStartPoint = e.GetPosition(AssociatedObject);
            _isDragging = false;
        }
    }

    private async void OnPointerMoved(object? sender, PointerEventArgs e)
    {
        if (!e.GetCurrentPoint(AssociatedObject).Properties.IsLeftButtonPressed)
            return;

        if (AssociatedObject?.Item is null)
            return;

        var currentPoint = e.GetPosition(AssociatedObject);
        var delta = currentPoint - _dragStartPoint;

        // Start drag if moved enough
        if (!_isDragging && (Math.Abs(delta.X) > 5 || Math.Abs(delta.Y) > 5))
        {
            _isDragging = true;

            var data = new DataObject();
            data.Set("ItemSlotViewModel", AssociatedObject.DataContext);

            await DragDrop.DoDragDrop(e, data, DragDropEffects.Move);
            _isDragging = false;
        }
    }

    private void OnPointerReleased(object? sender, PointerReleasedEventArgs e)
    {
        _isDragging = false;
    }

    private void OnDragOver(object? sender, DragEventArgs e)
    {
        e.DragEffects = e.Data.Contains("ItemSlotViewModel") 
            ? DragDropEffects.Move 
            : DragDropEffects.None;
    }

    private void OnDrop(object? sender, DragEventArgs e)
    {
        if (AssociatedObject?.DataContext is not ItemSlotViewModel targetSlot)
            return;

        if (e.Data.Get("ItemSlotViewModel") is not ItemSlotViewModel sourceSlot)
            return;

        if (sourceSlot == targetSlot)
            return;

        // Find parent ViewModel and execute move
        if (AssociatedObject.FindAncestorOfType<InventoryPanel>()?.DataContext 
            is InventoryPanelViewModel panelVm)
        {
            panelVm.MoveItemCommand.Execute(new MoveItemArgs(sourceSlot, targetSlot));
        }
    }
}
```

---

## 9. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/InventoryStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <!-- Include ItemSlotControl styles -->
    <StyleInclude Source="avares://RuneAndRust.Avalonia/Controls/ItemSlotControl.axaml" />
    
    <!-- Inventory-specific styles -->
    
    <!-- Capacity text warning when near full -->
    <Style Selector="TextBlock.capacity-warning">
        <Setter Property="Foreground" Value="{StaticResource WarningColor}" />
    </Style>
    
    <!-- Item detail header -->
    <Style Selector="TextBlock.item-header">
        <Setter Property="FontSize" Value="{StaticResource FontSizeLarge}" />
        <Setter Property="FontWeight" Value="SemiBold" />
    </Style>
    
    <!-- Drag overlay visual -->
    <Style Selector="ItemSlotControl.dragging">
        <Setter Property="Opacity" Value="0.6" />
    </Style>
    
    <!-- Drop target highlight -->
    <Style Selector="ItemSlotControl.drop-target /template/ Border#SlotBorder">
        <Setter Property="BorderBrush" Value="{StaticResource AccentBrush}" />
        <Setter Property="BorderThickness" Value="2" />
    </Style>
    
</Styles>
```

---

## 10. Data Model Changes

### New Types

| Type | Layer | Description |
|------|-------|-------------|
| `InventoryPanel` | Presentation | Inventory UserControl |
| `InventoryPanelViewModel` | Presentation | Inventory state view model |
| `ItemSlotControl` | Presentation | Individual slot control |
| `ItemSlotViewModel` | Presentation | Slot state view model |
| `DragDropReorderBehavior` | Presentation | Drag-drop behavior |
| `MoveItemArgs` | Presentation | Move command arguments |

### Domain Extensions

| Type | Method | Description |
|------|--------|-------------|
| `Item` | `GetCategoryIcon()` | Returns icon based on ItemType |

```csharp
// Extension method for Item
public static string GetCategoryIcon(this Item item)
{
    return item.ItemType switch
    {
        "weapon" => "âš”",
        "armor" => "ğŸ›¡",
        "potion" => "ğŸ§ª",
        "scroll" => "ğŸ“œ",
        "key" => "ğŸ”‘",
        "ring" => "ğŸ’",
        "amulet" => "ğŸ“¿",
        "treasure" => "ğŸ’",
        "gold" => "ğŸ’°",
        _ => "â—‡"
    };
}
```

---

## 11. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `InventoryPanelViewModel` | Debug | Slot selection, inventory updates |
| `InventoryPanelViewModel` | Information | Item moves/reorders |
| `DragDropReorderBehavior` | Debug | Drag start/drop events |

---

## 12. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| InventoryPanelViewModel | ~5 |
| ItemSlotViewModel | ~2 |
| Navigation logic | ~2 |
| Item extension | ~1 |
| **Total** | **~10** |

### Test Specifications

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/InventoryPanelViewModelTests.cs`

```csharp
[TestFixture]
public class InventoryPanelViewModelTests
{
    [Test]
    public void SelectSlot_UpdatesSelectedSlot();

    [Test]
    public void SelectSlot_DeselectsPreviousSlot();

    [Test]
    public void HandleInventoryChanged_UpdatesSlots();

    [Test]
    public void MoveItem_SwapsItems();

    [Test]
    public void Navigate_Right_SelectsNextSlot();
}
```

**File:** `tests/RuneAndRust.Avalonia.UnitTests/ViewModels/ItemSlotViewModelTests.cs`

```csharp
[TestFixture]
public class ItemSlotViewModelTests
{
    [Test]
    public void IsEmpty_WithNoItem_ReturnsTrue();

    [Test]
    public void Icon_WithWeapon_ReturnsSwordIcon();
}
```

---

## 13. Use Cases

### UC-072a-001: View Inventory Grid
**Actor:** Player
**Flow:** Open inventory â†’ Grid displays items with icons and names

### UC-072a-002: Select Item
**Actor:** Player
**Flow:** Click slot â†’ Slot highlights â†’ Details pane shows item info

### UC-072a-003: Navigate with Keyboard
**Actor:** Player
**Flow:** Use arrow keys â†’ Selection moves between slots

### UC-072a-004: Reorder Items
**Actor:** Player
**Flow:** Drag item from slot A â†’ Drop on slot B â†’ Items swap positions

### UC-072a-005: View Capacity
**Actor:** Player
**Flow:** View header â†’ See "8/15 items" capacity indicator

### UC-072a-006: View Weight
**Actor:** Player
**Flow:** View footer â†’ See weight with warning if near limit

---

## 14. Deliverable Checklist

### Controls
- [ ] `Controls/InventoryPanel.axaml` created
- [ ] `Controls/InventoryPanel.axaml.cs` created
- [ ] `Controls/ItemSlotControl.cs` created
- [ ] `Controls/ItemSlotControl.axaml` created

### ViewModels
- [ ] `ViewModels/InventoryPanelViewModel.cs` created
- [ ] `ViewModels/ItemSlotViewModel.cs` created

### Behaviors
- [ ] `Behaviors/DragDropReorderBehavior.cs` created

### Styles
- [ ] `Styles/InventoryStyles.axaml` created

### Domain Extensions
- [ ] `Item.GetCategoryIcon()` extension method added

### Integration
- [ ] `App.axaml` includes InventoryStyles
- [ ] GameWindow registers InventoryPanel in RightSidebarBottom region

### Testing
- [ ] ~10 unit tests implemented
- [ ] All tests passing

---

## 15. Acceptance Criteria

### Grid Display
- [ ] Inventory displays as grid with 5 columns
- [ ] Items show category icon and short name
- [ ] Empty slots display differently
- [ ] Tooltips show full item name

### Selection
- [ ] Click on slot selects item
- [ ] Selected slot is highlighted
- [ ] Previous selection is deselected
- [ ] Details pane shows selected item

### Item Details
- [ ] Name displays with icon
- [ ] Description displays (max 3 lines)
- [ ] Type, Value, Weight display
- [ ] Empty message when no selection

### Navigation
- [ ] Arrow keys move selection
- [ ] Wrapping behavior at edges is correct
- [ ] Grid columns affect up/down navigation

### Drag-and-Drop
- [ ] Drag initiates with item slot
- [ ] Drop swaps items between slots
- [ ] Visual feedback during drag
- [ ] Empty slots accept drops

### Capacity/Weight
- [ ] Header shows item count
- [ ] Footer shows current/max weight
- [ ] Warning shows when near weight limit

### Quality
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] ~10 unit tests pass
- [ ] Panel updates when inventory changes

---

## 16. Dependencies

### Required from v0.7.1c

| Type | Location | Usage |
|------|----------|-------|
| Panel patterns | v0.7.1c | Consistent panel structure |
| Style patterns | v0.7.1c | Panel header/footer styles |

### Required from v0.7.0c

| Type | Location | Usage |
|------|----------|-------|
| `GameWindow` | `Views/GameWindow.axaml` | RightSidebarBottom region host |
| `IWindowLayoutService` | `Services/IWindowLayoutService.cs` | Panel registration |
| `PanelRegion.RightSidebarBottom` | `Services/PanelRegion.cs` | Region identifier |

### Required from Domain Layer

| Type | Location | Usage |
|------|----------|-------|
| `Inventory` | Domain layer | Item collection |
| `Item` | Domain layer | Item data |

### Provides to v0.7.2b

| Type | Usage |
|------|-------|
| `ItemSlotControl` | Context menu integration point |
| `InventoryPanel` | Right-click handling |

---

## 17. Future Considerations

### Deferred to v0.7.2b
- **Context menus**: Right-click on items for actions
- **Quick actions**: Double-click to use/equip

### Deferred to v0.7.2c
- **Command integration**: Type "use potion" commands

### Deferred to v0.8.0
- **Equipment panel**: Separate equipment management
- **Item comparison**: Compare with equipped items
- **Sorting options**: Sort by type, value, weight
- **Search/filter**: Filter inventory items

### Out of Scope
- **Multi-select**: Single selection only
- **Stack splitting**: Not in initial implementation
- **Shop UI**: Separate feature

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: Assistant*
