# v0.7.1 Window System - Scope Breakdown

**Version:** 0.7.1
**Theme:** Core Display Panels
**Prerequisites:** v0.7.0c Complete (Application Shell - Game Window Layout)
**Total Estimated Tests:** ~25 new tests

---

## Executive Summary

The Core Display Panels sub-version implements the three essential read-only panels that display game state: the room display panel showing room descriptions and visuals, the player status panel showing HP/stats/equipment, and the message log panel for scrollable game output. These panels populate the game window layout established in v0.7.1.

Key focus areas:
- **Room Display**: Room name, description, ASCII art, exits, visible entities
- **Player Status**: HP/MP/XP bars, stats, equipped items, gold
- **Message Log**: Scrollable message history with timestamps and colors

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.7.1a | Room Display Panel | Room description, ASCII art, exits, entities | ~8 |
| v0.7.1b | Player Status Panel | HP/stats bars, equipment, character info | ~9 |
| v0.7.1c | Message Log Panel | Scrollable history, timestamps, colored messages | ~8 |

---

## Existing Infrastructure

### Already Implemented (from v0.7.1)

| Feature | Location | Notes |
|---------|----------|-------|
| GameWindow | `Views/GameWindow.axaml` | Panel container |
| WindowLayoutService | `Services/WindowLayoutService.cs` | Region management |
| NavigationService | `Services/NavigationService.cs` | Window navigation |
| BaseTheme | `Themes/BaseTheme.axaml` | Styling resources |
| Colors | `Themes/Colors.axaml` | Color palette |

### Already Implemented (from prior versions)

| Feature | Location | Notes |
|---------|----------|-------|
| Room | `Domain/Entities/Room.cs` | Room data |
| Player | `Domain/Entities/Player.cs` | Player state |
| RoomArtDefinition | `Domain/ValueObjects/RoomArtDefinition.cs` | ASCII art templates |
| GameSessionService | `Application/Services/GameSessionService.cs` | Game state |
| HealthBar (TUI) | `Presentation/UI/HealthBar.cs` | Bar logic (adapt for GUI) |

### Needs Implementation (v0.7.1)

| Feature | Part | Notes |
|---------|------|-------|
| RoomDisplayPanel | v0.7.1a | Avalonia UserControl |
| RoomDisplayViewModel | v0.7.1a | Room state binding |
| PlayerStatusPanel | v0.7.1b | Status UserControl |
| PlayerStatusViewModel | v0.7.1b | Player state binding |
| HealthBarControl | v0.7.1b | Avalonia health bar |
| MessageLogPanel | v0.7.0c | Log UserControl |
| MessageLogViewModel | v0.7.0c | Message state binding |
| GameMessage | v0.7.0c | Message value object |

---

## Feature Analysis & Categorization

### Room Display Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Room name/description | Low | Room entity | **v0.7.1a** |
| ASCII art display | Medium | RoomArtDefinition | **v0.7.1a** |
| Exit buttons | Low | Room connections | **v0.7.1a** |
| Entity list | Low | Room entities | **v0.7.1a** |

### Player Status Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| HP/MP/XP bars | Medium | Player stats | **v0.7.1b** |
| Stat display | Low | Player stats | **v0.7.1b** |
| Equipment slots | Medium | Inventory | **v0.7.1b** |
| Character info | Low | Player entity | **v0.7.1b** |

### Message Log Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Message display | Medium | Game events | **v0.7.0c** |
| Auto-scroll | Low | ScrollViewer | **v0.7.0c** |
| Timestamp formatting | Low | DateTime | **v0.7.0c** |
| Color coding | Medium | ColorThemeService | **v0.7.0c** |

---

## Part Definitions

---

## v0.7.1a: Room Display Panel

[v0.7.1a Design Specification](v0.7.1a-design-specification.md)

### Overview

Implement the room display panel that shows the current room's name, description, ASCII art (if defined), available exits, and visible entities. This is the primary view of the game world.

### Scope

**In Scope:**
- `RoomDisplayPanel` UserControl
- `RoomDisplayViewModel` with room data binding
- Room name header
- Room description text
- ASCII art rendering (monospace font)
- Exit buttons (clickable direction buttons)
- Visible monsters list
- Visible items list
- Room art legend display
- Transition animation (fade, optional)

**Out of Scope:**
- Player status (v0.7.1b)
- Message log (v0.7.0c)
- Context menus (v0.7.2)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| User Controls | 1 | `RoomDisplayPanel` |
| ViewModels | 1 | `RoomDisplayViewModel` |
| Value Converters | 1 | `DirectionToSymbolConverter` |
| Styles | 1 | `RoomDisplayStyles.axaml` |
| Unit Tests | ~8 | Binding, display tests |

### Room Display Panel Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ROOM DISPLAY PANEL                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚                            â•â•â• Dark Cave â•â•â•                             â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚  â”‚
â”‚  â”‚   â•”â•                                                           â•šâ•— â”‚  â”‚
â”‚  â”‚  â•”â•   ~~~   â–²   ~~~                                             â•šâ•—â”‚  â”‚
â”‚  â”‚ â•”â•    ~~~  â–²â–²â–²  ~~~    â˜                                         â•šâ•—  â”‚
â”‚  â”‚â•”â•         â–²â–²â–²â–²â–²                                                  â•šâ•— â”‚
â”‚  â”‚â•‘    â–‘â–‘     cave     â–‘â–‘                                            â•‘ â”‚
â”‚  â”‚â•šâ•—        entrance                                                â•”â• â”‚
â”‚  â”‚ â•šâ•—   â–‘â–‘â–‘           â–‘â–‘â–‘                                          â•”â•  â”‚
â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  Legend: ~ water  â–² stalagmite  â˜  skeleton  â–‘ shadow              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ You stand in a dark, damp cave. Water drips from stalactites      â”‚  â”‚
â”‚  â”‚ overhead. The air smells of mold and decay. A skeletal figure     â”‚  â”‚
â”‚  â”‚ guards the passage to the north, its empty eye sockets watching   â”‚  â”‚
â”‚  â”‚ your every move.                                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Exits:    [â†‘ North]    [â†’ East]                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ You see:                                                        â”‚    â”‚
â”‚  â”‚   â˜  Skeleton (hostile)                                          â”‚    â”‚
â”‚  â”‚   ğŸ”‘ Rusty Key                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RoomDisplayViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class RoomDisplayViewModel : ViewModelBase
{
    private readonly IGameSessionService _gameSession;
    
    [ObservableProperty]
    private string _roomName = string.Empty;
    
    [ObservableProperty]
    private string _roomDescription = string.Empty;
    
    [ObservableProperty]
    private IReadOnlyList<string>? _asciiArt;
    
    [ObservableProperty]
    private IReadOnlyDictionary<char, string>? _artLegend;
    
    [ObservableProperty]
    private bool _hasAsciiArt;
    
    [ObservableProperty]
    private ObservableCollection<ExitViewModel> _exits = new();
    
    [ObservableProperty]
    private ObservableCollection<EntityViewModel> _visibleMonsters = new();
    
    [ObservableProperty]
    private ObservableCollection<ItemViewModel> _visibleItems = new();
    
    public RoomDisplayViewModel(IGameSessionService gameSession)
    {
        _gameSession = gameSession;
        _gameSession.OnRoomChanged += HandleRoomChanged;
    }
    
    [RelayCommand]
    private void MoveToExit(Direction direction)
    {
        _gameSession.ExecuteCommand($"go {direction.ToString().ToLower()}");
    }
    
    private void HandleRoomChanged(Room room)
    {
        RoomName = room.Name;
        RoomDescription = room.Description;
        
        // Update ASCII art
        var art = _gameSession.GetRoomArt(room.Id);
        AsciiArt = art?.ArtLines;
        ArtLegend = art?.Legend;
        HasAsciiArt = art is not null;
        
        // Update exits
        Exits.Clear();
        foreach (var exit in room.Exits)
        {
            Exits.Add(new ExitViewModel(exit.Direction, exit.IsLocked));
        }
        
        // Update visible entities
        UpdateVisibleEntities(room);
    }
}
```

### ExitViewModel

```csharp
public record ExitViewModel(Direction Direction, bool IsLocked)
{
    public string Symbol => Direction switch
    {
        Direction.North => "â†‘",
        Direction.South => "â†“",
        Direction.East => "â†’",
        Direction.West => "â†",
        Direction.Up => "â¬†",
        Direction.Down => "â¬‡",
        _ => "?"
    };
    
    public string Label => $"{Symbol} {Direction}";
    public string Tooltip => IsLocked ? $"{Direction} (Locked)" : Direction.ToString();
}
```

### Acceptance Criteria

- [ ] Room name displays as header
- [ ] Room description displays in text area
- [ ] ASCII art renders with monospace font
- [ ] Art legend displays when art present
- [ ] Exit buttons show for each exit
- [ ] Exit buttons execute move commands
- [ ] Locked exits show lock indicator
- [ ] Visible monsters display with icons
- [ ] Visible items display with icons
- [ ] Panel updates on room change
- [ ] ~8 unit tests pass

---

## v0.7.1b: Player Status Panel

[v0.7.1b Design Specification](v0.7.1b-design-specification.md)

### Overview

Implement the player status panel that displays character information, HP/MP/XP bars with visual fill indicators, all character stats with modifiers, and currently equipped items. This provides at-a-glance player state.

### Scope

**In Scope:**
- `PlayerStatusPanel` UserControl
- `PlayerStatusViewModel` with player binding
- `HealthBarControl` custom control
- Character name and class display
- Level display
- HP bar with color thresholds
- MP/Mana bar
- XP bar with level progress
- Stats display (STR, DEX, CON, INT, WIS, CHA)
- Stat modifiers (+/-X)
- Equipment slots display
- Gold display
- Current location

**Out of Scope:**
- Room display (v0.7.1a)
- Message log (v0.7.0c)
- Inventory interaction (v0.7.2)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| User Controls | 2 | `PlayerStatusPanel`, `HealthBarControl` |
| ViewModels | 1 | `PlayerStatusViewModel` |
| Value Converters | 2 | `HealthToColorConverter`, `ModifierToStringConverter` |
| Styles | 1 | `StatusPanelStyles.axaml` |
| Unit Tests | ~9 | Bar rendering, stat display tests |

### Player Status Panel Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PLAYER STATUS                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  âš” Hero                               â”‚
â”‚  Level 5 Warrior                      â”‚
â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  65/100    â”‚
â”‚  MP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  30/100    â”‚
â”‚  XP â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  550/1000  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ STATS                           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ STR: 16 (+3)    DEX: 14 (+2)   â”‚  â”‚
â”‚  â”‚ CON: 15 (+2)    INT: 10 (+0)   â”‚  â”‚
â”‚  â”‚ WIS: 12 (+1)    CHA: 11 (+0)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ EQUIPPED                        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ âš” Weapon: Iron Sword (+4 atk)  â”‚  â”‚
â”‚  â”‚ ğŸ›¡ Armor:  Leather (+2 def)    â”‚  â”‚
â”‚  â”‚ ğŸ›¡ Shield: None                â”‚  â”‚
â”‚  â”‚ ğŸ’ Ring:   Ring of Protection  â”‚  â”‚
â”‚  â”‚ ğŸ“¿ Amulet: None                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’° Gold: 150                         â”‚
â”‚  ğŸ“ Location: Dark Cave               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HealthBarControl

```csharp
namespace RuneAndRust.Avalonia.Controls;

/// <summary>
/// Custom Avalonia control for health/resource bars.
/// </summary>
public class HealthBarControl : TemplatedControl
{
    public static readonly StyledProperty<int> CurrentValueProperty =
        AvaloniaProperty.Register<HealthBarControl, int>(nameof(CurrentValue));
    
    public static readonly StyledProperty<int> MaxValueProperty =
        AvaloniaProperty.Register<HealthBarControl, int>(nameof(MaxValue), 100);
    
    public static readonly StyledProperty<BarType> BarTypeProperty =
        AvaloniaProperty.Register<HealthBarControl, BarType>(nameof(BarType), BarType.Health);
    
    public static readonly StyledProperty<string> LabelProperty =
        AvaloniaProperty.Register<HealthBarControl, string>(nameof(Label), "HP");
    
    public int CurrentValue
    {
        get => GetValue(CurrentValueProperty);
        set => SetValue(CurrentValueProperty, value);
    }
    
    public int MaxValue
    {
        get => GetValue(MaxValueProperty);
        set => SetValue(MaxValueProperty, value);
    }
    
    public BarType BarType
    {
        get => GetValue(BarTypeProperty);
        set => SetValue(BarTypeProperty, value);
    }
    
    public string Label
    {
        get => GetValue(LabelProperty);
        set => SetValue(LabelProperty, value);
    }
    
    public double FillPercentage => MaxValue > 0 ? (double)CurrentValue / MaxValue : 0;
    
    public IBrush FillBrush => BarType switch
    {
        BarType.Health => GetHealthBrush(),
        BarType.Mana => Brushes.RoyalBlue,
        BarType.Experience => Brushes.Purple,
        _ => Brushes.Gray
    };
    
    private IBrush GetHealthBrush()
    {
        var percent = FillPercentage * 100;
        return percent switch
        {
            > 75 => Brushes.ForestGreen,
            > 50 => Brushes.Gold,
            > 25 => Brushes.OrangeRed,
            _ => Brushes.DarkRed
        };
    }
}

public enum BarType { Health, Mana, Experience, Stamina, Custom }
```

### PlayerStatusViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class PlayerStatusViewModel : ViewModelBase
{
    private readonly IGameSessionService _gameSession;
    
    [ObservableProperty]
    private string _playerName = string.Empty;
    
    [ObservableProperty]
    private string _className = string.Empty;
    
    [ObservableProperty]
    private int _level;
    
    [ObservableProperty]
    private int _currentHp;
    
    [ObservableProperty]
    private int _maxHp;
    
    [ObservableProperty]
    private int _currentMp;
    
    [ObservableProperty]
    private int _maxMp;
    
    [ObservableProperty]
    private int _currentXp;
    
    [ObservableProperty]
    private int _xpToNextLevel;
    
    [ObservableProperty]
    private ObservableCollection<StatViewModel> _stats = new();
    
    [ObservableProperty]
    private ObservableCollection<EquipmentSlotViewModel> _equipment = new();
    
    [ObservableProperty]
    private int _gold;
    
    [ObservableProperty]
    private string _locationName = string.Empty;
    
    public PlayerStatusViewModel(IGameSessionService gameSession)
    {
        _gameSession = gameSession;
        _gameSession.OnPlayerChanged += HandlePlayerChanged;
        _gameSession.OnRoomChanged += r => LocationName = r.Name;
    }
    
    private void HandlePlayerChanged(Player player)
    {
        PlayerName = player.Name;
        ClassName = player.Class.Name;
        Level = player.Level;
        
        CurrentHp = player.Health;
        MaxHp = player.Stats.MaxHealth;
        CurrentMp = player.GetResource("mana")?.Current ?? 0;
        MaxMp = player.GetResource("mana")?.Max ?? 0;
        CurrentXp = player.Experience;
        XpToNextLevel = player.ExperienceToNextLevel;
        
        UpdateStats(player);
        UpdateEquipment(player);
        Gold = player.Gold;
    }
}
```

### Acceptance Criteria

- [ ] Character name displays
- [ ] Class and level display
- [ ] HP bar fills proportionally
- [ ] HP bar color changes with thresholds
- [ ] MP bar displays in blue
- [ ] XP bar shows level progress
- [ ] All 6 stats display with values
- [ ] Stat modifiers show (+X/-X)
- [ ] Equipment slots show equipped items
- [ ] Empty slots show "None"
- [ ] Gold amount displays
- [ ] Location name displays
- [ ] Panel updates on player change
- [ ] ~9 unit tests pass

---

## v0.7.0c: Message Log Panel

[v0.7.0c Design Specification](v0.7.0c-design-specification.md)

### Overview

Implement the message log panel that displays a scrollable history of game messages with timestamps and color coding. The log auto-scrolls to show new messages but allows manual scrolling to review history.

### Scope

**In Scope:**
- `MessageLogPanel` UserControl
- `MessageLogViewModel` with message binding
- `GameMessage` value object
- Scrollable message list
- Timestamp display
- Message type color coding
- Auto-scroll to newest messages
- Manual scroll override
- Auto-scroll resume button
- Message filtering (optional toggle)
- Clear log option
- Max message limit

**Out of Scope:**
- Room display (v0.7.1a)
- Player status (v0.7.1b)
- Command input (v0.7.2)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| User Controls | 1 | `MessageLogPanel` |
| ViewModels | 1 | `MessageLogViewModel` |
| Value Objects | 1 | `GameMessage` |
| Value Converters | 1 | `MessageTypeToColorConverter` |
| Styles | 1 | `MessageLogStyles.axaml` |
| Unit Tests | ~8 | Scroll behavior, color tests |

### Message Log Panel Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MESSAGE LOG                                            [â–¼ Auto-scroll] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  [12:30:15] You wake up in a small village.                             â”‚
â”‚  [12:30:18] You see a sword shop to the north.                          â”‚
â”‚  [12:31:02] You enter the sword shop.                                   â”‚
â”‚  [12:31:05] The shopkeeper greets you warmly.                           â”‚
â”‚  [12:32:15] You purchased: Iron Sword (50 gold)                         â”‚
â”‚  [12:33:00] You leave the shop and head east.                           â”‚
â”‚  [12:34:22] You enter the dark cave.                                    â”‚
â”‚  [12:34:25] A skeleton blocks your path!                                â”‚
â”‚  [12:34:30] â•â•â•â•â•â• COMBAT BEGINS â•â•â•â•â•â•                                 â”‚
â”‚  [12:34:35] You attack the Skeleton with Iron Sword!                    â”‚
â”‚  [12:34:35] Hit! 12 damage to Skeleton.                    [Red]        â”‚
â”‚  [12:34:40] Skeleton attacks you!                                       â”‚
â”‚  [12:34:40] Miss! The skeleton's attack misses.            [Gray]       â”‚
â”‚  [12:34:45] You attack the Skeleton with Iron Sword!                    â”‚
â”‚  [12:34:45] Critical Hit! 24 damage to Skeleton.           [Magenta]    â”‚
â”‚  [12:34:50] Skeleton defeated! +50 XP                      [Green]      â”‚
â”‚  [12:34:55] â•â•â•â•â•â• COMBAT ENDS â•â•â•â•â•â•                                   â”‚
â”‚  [12:35:00] You found: Rusty Key                           [Cyan]       â”‚
â”‚  [12:35:05] The key might unlock something nearby.                      â”‚
â”‚                                                                    â–¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### GameMessage Value Object

```csharp
namespace RuneAndRust.Avalonia.Models;

/// <summary>
/// Represents a message in the game log.
/// </summary>
public record GameMessage(
    DateTime Timestamp,
    string Text,
    MessageType Type,
    MessageCategory Category = MessageCategory.General
)
{
    public string FormattedTime => Timestamp.ToString("HH:mm:ss");
    
    public static GameMessage Info(string text) => 
        new(DateTime.Now, text, MessageType.Info);
    
    public static GameMessage Combat(string text, MessageType type = MessageType.CombatHit) => 
        new(DateTime.Now, text, type, MessageCategory.Combat);
    
    public static GameMessage Loot(string text, MessageType type = MessageType.LootCommon) => 
        new(DateTime.Now, text, type, MessageCategory.Loot);
    
    public static GameMessage System(string text) => 
        new(DateTime.Now, text, MessageType.Info, MessageCategory.System);
}

public enum MessageCategory
{
    General,
    Combat,
    Loot,
    Dialogue,
    System
}
```

### MessageLogViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class MessageLogViewModel : ViewModelBase
{
    private readonly IGameSessionService _gameSession;
    private const int MaxMessages = 500;
    
    [ObservableProperty]
    private ObservableCollection<GameMessage> _messages = new();
    
    [ObservableProperty]
    private bool _autoScrollEnabled = true;
    
    [ObservableProperty]
    private bool _showCombatMessages = true;
    
    [ObservableProperty]
    private bool _showLootMessages = true;
    
    [ObservableProperty]
    private bool _showSystemMessages = true;
    
    public ICollectionView FilteredMessages { get; }
    
    public MessageLogViewModel(IGameSessionService gameSession)
    {
        _gameSession = gameSession;
        _gameSession.OnMessage += HandleNewMessage;
        
        FilteredMessages = new CollectionViewSource { Source = Messages }.View;
        FilteredMessages.Filter = FilterMessage;
    }
    
    [RelayCommand]
    private void ClearLog()
    {
        Messages.Clear();
    }
    
    [RelayCommand]
    private void ToggleAutoScroll()
    {
        AutoScrollEnabled = !AutoScrollEnabled;
    }
    
    private void HandleNewMessage(string text, MessageType type)
    {
        var message = new GameMessage(DateTime.Now, text, type);
        
        // Add message
        Messages.Add(message);
        
        // Trim old messages
        while (Messages.Count > MaxMessages)
        {
            Messages.RemoveAt(0);
        }
        
        // Trigger auto-scroll if enabled
        if (AutoScrollEnabled)
        {
            OnPropertyChanged(nameof(Messages));
        }
    }
    
    private bool FilterMessage(object obj)
    {
        if (obj is not GameMessage msg) return false;
        
        return msg.Category switch
        {
            MessageCategory.Combat => ShowCombatMessages,
            MessageCategory.Loot => ShowLootMessages,
            MessageCategory.System => ShowSystemMessages,
            _ => true
        };
    }
}
```

### MessageTypeToColorConverter

```csharp
namespace RuneAndRust.Avalonia.Converters;

public class MessageTypeToColorConverter : IValueConverter
{
    public object Convert(object? value, Type targetType, object? parameter, CultureInfo culture)
    {
        if (value is not MessageType type)
            return Brushes.White;
        
        return type switch
        {
            MessageType.Default => Application.Current!.FindResource("TextPrimaryBrush"),
            MessageType.Info => Brushes.Cyan,
            MessageType.Warning => Brushes.Yellow,
            MessageType.Error => Brushes.Red,
            MessageType.CombatHit => Brushes.OrangeRed,
            MessageType.CombatMiss => Brushes.Gray,
            MessageType.CombatHeal => Brushes.LimeGreen,
            MessageType.CombatCritical => Brushes.Magenta,
            MessageType.LootCommon => Brushes.White,
            MessageType.LootUncommon => Brushes.LimeGreen,
            MessageType.LootRare => Brushes.RoyalBlue,
            MessageType.LootEpic => Brushes.Purple,
            MessageType.LootLegendary => Brushes.Gold,
            MessageType.Dialogue => Brushes.Yellow,
            MessageType.Success => Brushes.LimeGreen,
            MessageType.Failure => Brushes.OrangeRed,
            _ => Brushes.White
        };
    }
    
    public object ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture)
        => throw new NotImplementedException();
}
```

### Acceptance Criteria

- [ ] Messages display in scrollable list
- [ ] Timestamps show for each message
- [ ] Messages color-coded by type
- [ ] Combat messages show in appropriate colors
- [ ] Loot messages show rarity colors
- [ ] Auto-scroll keeps newest visible
- [ ] Manual scroll pauses auto-scroll
- [ ] Auto-scroll toggle button works
- [ ] Clear log removes all messages
- [ ] Max message limit enforced
- [ ] Panel updates on new messages
- [ ] ~8 unit tests pass

---

## Dependencies & Prerequisites

```
v0.7.0c (Game Window Layout) - REQUIRED
    â”‚
    â””â”€â”€ GameWindow, WindowLayoutService, NavigationService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                         â”‚
v0.7.1 (Core Display Panels)                                             â”‚
    â”‚                                                                    â”‚
    â”œâ”€â”€ v0.7.1a: Room Display Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: WindowLayoutService (MainContent region)       â”‚
    â”‚       Provides: RoomDisplayPanel, RoomDisplayViewModel             â”‚
    â”‚                                                                    â”‚
    â”œâ”€â”€ v0.7.1b: Player Status Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: WindowLayoutService (RightSidebarTop)          â”‚
    â”‚       Provides: PlayerStatusPanel, HealthBarControl                â”‚
    â”‚                                                                    â”‚
    â””â”€â”€ v0.7.0c: Message Log Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: WindowLayoutService (BottomContent)
            Provides: MessageLogPanel, GameMessage
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.7.1a | ~4 | ~1 | ~8 | Medium |
| v0.7.1b | ~5 | ~1 | ~9 | Medium |
| v0.7.0c | ~4 | ~1 | ~8 | Medium |
| **Total** | **~13** | **~3** | **~25** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| ASCII art rendering issues | Medium | Medium | Use monospace font, test character widths |
| Bar control styling | Low | Low | Use Avalonia templated control |
| Auto-scroll interruption | Low | Medium | Clear UX for toggle |
| Performance with many messages | Low | Low | Enforce max limit, virtualization |

---

## Design Decisions (Confirmed)

### Room Display

| Decision | Value | Notes |
|----------|-------|-------|
| **Art Font** | Monospace (Consolas/JetBrains Mono) | ASCII alignment |
| **Exit Buttons** | Direction symbols (â†‘â†“â†â†’) | Intuitive navigation |
| **Entity Icons** | Unicode symbols | Same as TUI |

### Player Status

| Decision | Value | Notes |
|----------|-------|-------|
| **Bar Style** | Filled rectangle | Clean visual |
| **Color Thresholds** | 75/50/25% | Same as TUI |
| **Stat Layout** | 2-column grid | Compact |

### Message Log

| Decision | Value | Notes |
|----------|-------|-------|
| **Timestamp Format** | HH:mm:ss | Clean, compact |
| **Max Messages** | 500 | Memory limit |
| **Auto-Scroll** | Default on | Standard behavior |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.7.1a Design Spec** - Create detailed design for Room Display Panel
3. **v0.7.1a Implementation** - Build room display UserControl
4. **v0.7.1b Design Spec** - Create specification for Player Status Panel
5. **v0.7.1b Implementation** - Build status panel and HealthBarControl
6. **v0.7.0c Design Spec** - Create specification for Message Log Panel
7. **v0.7.0c Implementation** - Build message log with scroll behavior

---

*This scope breakdown provides a structured approach to implementing v0.7.1 Core Display Panels. Each panel is independent and can be developed in parallel after v0.7.1 is complete, with all three integrating into the game window layout.*
