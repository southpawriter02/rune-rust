# v0.14.1 Combat Configuration Schemas - Scope Breakdown

**Version:** 0.14.1
**Theme:** Combat Configuration Schemas
**Prerequisites:** v0.14.0 Complete (Character Configuration Schemas)
**Total Estimated Tests:** ~27 new tests

---

## Executive Summary

The Combat Configuration Schemas version creates comprehensive JSON schemas for all combat-related configuration files, enabling full customization of abilities, status effects, damage types, and combat rules without code changes. This builds on the existing abilities.schema.json by expanding it and creates new schemas for status effects, damage types, and combat mechanics. These schemas support modding scenarios like magic-heavy systems, status-effect-focused combat, or simplified combat rules.

The work is divided into **four sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.14.1a | Ability Schema Expansion | Expand abilities.schema.json with combo chains, prerequisites | ~6 |
| v0.14.1b | Status Effect Schema | status-effects.schema.json with duration, stacking, triggers | ~7 |
| v0.14.1c | Damage Type Schema | damage-types.schema.json with categories, resistances, immunities, relationships | ~8 |
| v0.14.1d | Combat Rules Schema | combat.schema.json with flanking, initiative, opportunity attacks | ~6 |

---

## Feature Analysis & Categorization

### From v0.14.x-overview.md - Combat Configuration Schemas

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| abilities.schema.json expansion | Medium | Existing schema | **v0.14.1a** |
| Effect type definitions | Low | abilities.schema.json | **v0.14.1a** |
| Targeting rules | Low | abilities.schema.json | **v0.14.1a** |
| Cost definitions | Low | abilities.schema.json | **v0.14.1a** |
| Combo chain references | Medium | abilities.schema.json | **v0.14.1a** |
| Prerequisite validation | Medium | abilities.schema.json | **v0.14.1a** |
| status-effects.schema.json | Medium | None | **v0.14.1b** |
| Effect duration types | Low | status-effects.schema.json | **v0.14.1b** |
| Stacking rules | Medium | status-effects.schema.json | **v0.14.1b** |
| Immunity definitions | Low | status-effects.schema.json | **v0.14.1b** |
| Trigger conditions | Medium | status-effects.schema.json | **v0.14.1b** |
| Cleanse categories | Low | status-effects.schema.json | **v0.14.1b** |
| damage-types.schema.json | Medium | None | **v0.14.1c** |
| Damage categories | Low | damage-types.schema.json | **v0.14.1c** |
| Resistance/vulnerability modifiers | Medium | damage-types.schema.json | **v0.14.1c** |
| Immunity definitions | Low | damage-types.schema.json | **v0.14.1c** |
| Damage type relationships | Medium | damage-types.schema.json | **v0.14.1c** |
| Resistance templates | Medium | damage-types.schema.json | **v0.14.1c** |
| Visual effect associations | Low | damage-types.schema.json | **v0.14.1c** |
| Sound effect associations | Low | damage-types.schema.json | **v0.14.1c** |
| combat.schema.json | Medium | None | **v0.14.1d** |
| Initiative rules | Low | combat.schema.json | **v0.14.1d** |
| Flanking definitions | Low | combat.schema.json | **v0.14.1d** |
| Opportunity attack rules | Low | combat.schema.json | **v0.14.1d** |
| Death/unconscious rules | Low | combat.schema.json | **v0.14.1d** |

---

## Existing Infrastructure

### Current Configuration Files

| File | Current State | Schema Exists |
|------|---------------|---------------|
| `config/abilities.json` | 20+ abilities with effects, costs, targeting | Yes (basic) |
| `config/status-effects.json` | 15+ effects with duration, stacking, modifiers | Partial ($schema reference) |
| `config/damage-types.json` | 7 damage types (physical, fire, ice, etc.) | No |
| `config/combat.json` | Flanking and opportunity attack rules | No |
| `config/effect-interactions.json` | Effect interaction rules | No |

### Existing Schema (abilities.schema.json)

The current abilities schema includes:
- Basic ability structure (id, name, description, classIds, targetType)
- Cost definitions (costResource, costAmount, cooldown)
- Effect definitions (type, value, duration, chance, scaling)
- Effect types enum (Damage, Heal, Buff, Debuff, etc.)

**Gaps to address:**
- Combo chain references
- Prerequisite validation (level, class, other abilities)
- Area-of-effect parameters (radius, shape)
- Charge-based abilities
- Enhanced effect targeting options

---

## Phase Definitions

---

## v0.14.1a: Ability Schema Expansion

[v0.14.1a Design Specification](v0.14.1a-design-specification.md)

### Overview

Expand the existing abilities.schema.json to support combo chain references, ability prerequisites, AoE parameters, and charge-based abilities, enabling more complex ability configurations.

### Scope

**In Scope:**
- Expand `abilities.schema.json` with new fields
- Combo chain definitions (nextAbilityId, comboWindowTurns)
- Prerequisite validation (requiredLevel, requiredClassIds, requiredAbilityIds)
- AoE parameters (aoeRadius, aoeShape)
- Charge-based abilities (maxCharges, chargeRegenTurns)
- Enhanced targeting options (cone angle, line length)

**Out of Scope:**
- Status effect schema (v0.14.1b)
- Damage type schema (v0.14.1c)
- Combat rules schema (v0.14.1d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | Expanded `abilities.schema.json` |
| Schema Definitions | 4 | `ComboChain`, `Prerequisites`, `AoEParameters`, `ChargeConfig` |
| Configuration Updates | 0 | Existing abilities.json remains valid |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure Additions

```
abilities.schema.json (EXPANDED)
+-- definitions:
    |-- ability (MODIFY)
    |   |-- ADD: comboChain: ComboChain (optional)
    |   |-- ADD: prerequisites: Prerequisites (optional)
    |   |-- ADD: aoeParameters: AoEParameters (optional, when targetType is Area)
    |   |-- ADD: charges: ChargeConfig (optional)
    |   +-- MODIFY: targetType enum (add Cone, Line)
    |
    |-- ComboChain (NEW)
    |   |-- nextAbilityId: string (kebab-case, optional)
    |   |-- comboWindowTurns: integer (minimum: 1, default: 1)
    |   +-- comboBonusDamage: number (percentage, optional)
    |
    |-- Prerequisites (NEW)
    |   |-- requiredLevel: integer (minimum: 1, optional)
    |   |-- requiredClassIds: array of string (optional)
    |   |-- requiredAbilityIds: array of string (optional)
    |   +-- requiredArchetypeId: string (optional)
    |
    |-- AoEParameters (NEW)
    |   |-- radius: integer (minimum: 1)
    |   |-- shape: string (enum: Circle, Square, Cone, Line)
    |   |-- coneAngle: integer (15-180, for Cone shape)
    |   |-- lineLength: integer (minimum: 1, for Line shape)
    |   +-- includeOrigin: boolean (default: false)
    |
    +-- ChargeConfig (NEW)
        |-- maxCharges: integer (minimum: 1)
        |-- chargeRegenTurns: integer (minimum: 1)
        +-- startingCharges: integer (optional, defaults to maxCharges)
```

### Enhanced Target Types

| Target Type | Description | Parameters |
|-------------|-------------|------------|
| `Self` | Caster only | None |
| `SingleEnemy` | One enemy | None |
| `SingleAlly` | One ally | None |
| `AllEnemies` | All enemies | None |
| `AllAllies` | All allies | None |
| `Area` | Grid area | aoeParameters required |
| `Cone` | Cone from caster | aoeParameters with coneAngle |
| `Line` | Line from caster | aoeParameters with lineLength |
| `None` | No target (passive) | None |

### Acceptance Criteria

- [x] `abilities.schema.json` expanded with new definitions
- [x] Existing `abilities.json` validates without errors
- [x] Combo chain fields validated (nextAbilityId format)
- [x] Prerequisites support level, class, and ability requirements
- [x] AoE parameters required when targetType is Area/Cone/Line
- [x] Charge configuration validates maxCharges >= startingCharges
- [x] ~6 unit tests pass

---

## v0.14.1b: Status Effect Schema

[v0.14.1b Design Specification](v0.14.1b-design-specification.md)

### Overview

Create a comprehensive JSON schema for status effect definitions that validates duration types, stacking rules, trigger conditions, stat modifiers, and cleanse categories.

### Scope

**In Scope:**
- `status-effects.schema.json` - Full schema for status effects
- Duration type enumeration (Turns, Seconds, Permanent, UntilDispelled)
- Stacking rule enumeration (None, RefreshDuration, StackIntensity, StackDuration, Block)
- Trigger condition definitions (OnHit, OnDamage, OnTurnStart, OnTurnEnd)
- Stat modifier validation
- Cleanse category enumeration (Magic, Poison, Curse, Disease, Physical)
- Immunity definitions

**Out of Scope:**
- Damage type schema (v0.14.1c)
- Combat rules schema (v0.14.1d)
- Ability schema expansion (v0.14.1a)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `status-effects.schema.json` |
| Schema Definitions | 4 | `StatusEffect`, `StatModifier`, `TriggerCondition`, `EffectImmunity` |
| Configuration Updates | 1 | Update `status-effects.json` to reference schema |
| Unit Tests | ~7 | Schema validation tests |

### Schema Structure

```
status-effects.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Status Effects Configuration"
|-- description: "Schema for buff/debuff status effect definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   +-- effects: array of StatusEffect
|-- required: ["effects"]
+-- definitions:
    |-- StatusEffect
    |   |-- id: string (kebab-case pattern)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- category: string (enum: Buff, Debuff, Neutral)
    |   |-- durationType: string (enum: Turns, Seconds, Permanent, UntilDispelled)
    |   |-- baseDuration: integer (minimum: 0, required if durationType is Turns/Seconds)
    |   |-- stackingRule: string (enum: None, RefreshDuration, StackIntensity, StackDuration, Block)
    |   |-- maxStacks: integer (minimum: 1, optional, for StackIntensity/StackDuration)
    |   |-- damagePerTurn: integer (optional, for DoT effects)
    |   |-- healPerTurn: integer (optional, for HoT effects)
    |   |-- damageType: string (optional, references damage-types)
    |   |-- statModifiers: array of StatModifier (optional)
    |   |-- triggerConditions: array of TriggerCondition (optional)
    |   |-- cleansableBy: array of string (enum values, optional)
    |   |-- immunities: array of EffectImmunity (optional)
    |   |-- preventsActions: boolean (default: false)
    |   |-- preventsMovement: boolean (default: false)
    |   |-- preventsAttacking: boolean (default: false)
    |   |-- preventsAbilities: boolean (default: false)
    |   |-- iconId: string (optional)
    |   +-- sortOrder: integer (minimum: 0)
    |
    |-- StatModifier
    |   |-- statId: string (enum: attack, defense, speed, might, fortitude, will, wits, finesse, maxHealth)
    |   |-- modifierType: string (enum: Flat, Percentage)
    |   +-- value: number (negative for debuffs)
    |
    |-- TriggerCondition
    |   |-- trigger: string (enum: OnHit, OnDamage, OnTurnStart, OnTurnEnd, OnAbilityUse, OnMove)
    |   |-- effectId: string (optional, applies another effect)
    |   |-- damageAmount: integer (optional, for OnHit/OnDamage triggers)
    |   +-- chance: number (0.0 to 1.0, default: 1.0)
    |
    +-- EffectImmunity
        |-- effectId: string (specific effect immunity)
        +-- category: string (enum: Buff, Debuff, or specific cleanse category)
```

### Stacking Rules

| Rule | Description | Example |
|------|-------------|---------|
| `None` | Cannot stack, reapplication does nothing | Unique buffs |
| `RefreshDuration` | Resets duration to base | Bleeding, Burning |
| `StackIntensity` | Increases effect strength | Poison stacks |
| `StackDuration` | Adds duration | Extended buffs |
| `Block` | Prevents reapplication entirely | Stunned |

### Cleanse Categories

| Category | Description | Examples |
|----------|-------------|----------|
| `Magic` | Magical effects | Curses, hexes |
| `Poison` | Toxin-based effects | Poisoned, venomed |
| `Curse` | Curse effects | Cursed, hexed |
| `Disease` | Illness effects | Diseased, plagued |
| `Physical` | Physical effects | Bleeding, broken |

### Acceptance Criteria

- [x] `status-effects.schema.json` created in `config/schemas/`
- [x] Schema validates existing `status-effects.json` without errors
- [x] Duration type enum validated
- [x] Stacking rule enum validated
- [x] Stat modifier structure validated (statId enum, modifierType enum)
- [x] Trigger condition structure validated
- [x] Cleanse category enum validated
- [x] ~7 unit tests pass

---

## v0.14.1c: Damage Type Schema

[v0.14.1c Design Specification](v0.14.1c-design-specification.md)

### Overview

Create a comprehensive JSON schema for damage type definitions that validates damage categories, resistance/vulnerability modifiers, immunity definitions, damage type relationships, and resistance templates for common creature types.

### Scope

**In Scope:**
- `damage-types.schema.json` - Full schema for damage types and resistances
- Damage categories (Physical, Elemental, Magical, Special)
- Resistance modifier definitions (-100% to 100%)
- Vulnerability modifier definitions (negative resistance)
- Immunity definitions (100% resistance as distinct concept)
- Absorption definitions (negative damage heals)
- Damage type relationships (strengths/weaknesses)
- Resistance templates for creature types (undead, elemental, construct, etc.)
- Color association for UI display
- Visual effect ID references (optional)
- Sound effect ID references (optional)

**Out of Scope:**
- Combat rules schema (v0.14.1d)
- Ability schema expansion (v0.14.1a)
- Status effect schema (v0.14.1b)
- Runtime resistance calculations (runtime concern)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `damage-types.schema.json` |
| Schema Definitions | 5 | `DamageType`, `DamageCategory`, `DamageRelationship`, `ResistanceTemplate`, `ResistanceEntry` |
| Configuration Updates | 1 | Update `damage-types.json` with categories and templates |
| Unit Tests | ~8 | Schema validation tests |

### Schema Structure

```
damage-types.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Damage Types Configuration"
|-- description: "Schema for damage type and resistance definitions"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   |-- damageCategories: array of DamageCategory
|   |-- damageTypes: array of DamageType
|   +-- resistanceTemplates: array of ResistanceTemplate
|-- required: ["damageTypes"]
+-- definitions:
    |-- DamageCategory
    |   |-- id: string (kebab-case pattern)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   +-- sortOrder: integer (minimum: 0)
    |
    |-- DamageType
    |   |-- id: string (kebab-case pattern)
    |   |-- name: string (minLength: 1)
    |   |-- description: string
    |   |-- categoryId: string (references DamageCategory)
    |   |-- color: string (console color name or hex)
    |   |-- iconId: string (optional, icon reference)
    |   |-- vfxId: string (optional, visual effect reference)
    |   |-- sfxId: string (optional, sound effect reference)
    |   |-- bypassesArmor: boolean (default: false)
    |   |-- canCrit: boolean (default: true)
    |   |-- relationships: array of DamageRelationship (optional)
    |   +-- sortOrder: integer (minimum: 0)
    |
    |-- DamageRelationship
    |   |-- targetTypeId: string (another damage type ID)
    |   |-- relationship: string (enum: Strong, Weak, Neutral, Nullifies)
    |   +-- modifier: number (damage multiplier, 0.0 to 3.0)
    |
    |-- ResistanceTemplate
    |   |-- id: string (kebab-case pattern)
    |   |-- name: string (e.g., "Undead Resistances")
    |   |-- description: string
    |   |-- creatureTypes: array of string (creature tags this applies to)
    |   +-- resistances: array of ResistanceEntry
    |
    +-- ResistanceEntry
        |-- damageTypeId: string (references DamageType)
        |-- value: integer (-100 to 100, percentage)
        |-- isImmunity: boolean (default: false, true = complete immunity)
        +-- isAbsorption: boolean (default: false, true = heals instead)
```

### Damage Categories

| ID | Name | Description | Example Types |
|----|------|-------------|---------------|
| `physical` | Physical | Mundane physical damage | physical, piercing, slashing, bludgeoning |
| `elemental` | Elemental | Natural elemental forces | fire, ice, lightning |
| `magical` | Magical | Pure magical energy | arcane, holy, dark |
| `special` | Special | Unique damage types | poison, psychic, true |

### Standard Damage Types

| ID | Category | Name | Color | Description |
|----|----------|------|-------|-------------|
| `physical` | physical | Physical | white | Standard weapon damage |
| `piercing` | physical | Piercing | white | Puncturing attacks |
| `slashing` | physical | Slashing | white | Cutting attacks |
| `bludgeoning` | physical | Bludgeoning | white | Crushing attacks |
| `fire` | elemental | Fire | red | Heat and flame damage |
| `ice` | elemental | Ice | cyan | Cold and frost damage |
| `lightning` | elemental | Lightning | yellow | Electrical damage |
| `poison` | special | Poison | green | Toxic damage |
| `holy` | magical | Holy | gold | Divine radiant damage |
| `dark` | magical | Dark | purple | Necrotic shadow damage |
| `arcane` | magical | Arcane | blue | Pure magical energy |
| `psychic` | special | Psychic | pink | Mental damage |
| `true` | special | True | white | Unmitigable damage |

### Resistance Values

| Value | Meaning | Example |
|-------|---------|---------|
| `100` | Immunity | Undead immune to poison |
| `75` | High resistance | Fire elemental vs fire |
| `50` | Moderate resistance | Dwarf vs poison |
| `25` | Low resistance | Armored vs physical |
| `0` | Normal (no modifier) | Default |
| `-25` | Low vulnerability | Skeleton vs bludgeoning |
| `-50` | Moderate vulnerability | Ice elemental vs fire |
| `-75` | High vulnerability | Paper golem vs fire |
| `-100` | Extreme vulnerability | Double damage |

### Special Resistance Flags

| Flag | Meaning | Example |
|------|---------|---------|
| `isImmunity: true` | Complete immunity, cannot be reduced | Construct vs poison |
| `isAbsorption: true` | Damage heals instead | Fire elemental healed by fire |

### Resistance Templates

| Template ID | Creature Types | Key Resistances |
|-------------|----------------|-----------------|
| `undead-resistances` | undead | Poison: immune, Holy: -50, Dark: +50, Ice: +25 |
| `construct-resistances` | construct | Poison: immune, Psychic: immune, Physical: +25 |
| `elemental-fire-resistances` | fire-elemental | Fire: absorb, Ice: -75, Lightning: +25 |
| `elemental-ice-resistances` | ice-elemental | Ice: absorb, Fire: -75, Lightning: -25 |
| `demon-resistances` | demon, fiend | Fire: +50, Holy: -50, Dark: +75, Poison: +50 |
| `celestial-resistances` | celestial, angel | Holy: absorb, Dark: -50, Fire: +25 |
| `plant-resistances` | plant | Fire: -50, Poison: +75, Ice: -25 |
| `ooze-resistances` | ooze, slime | Physical: +50, Poison: immune, Lightning: -25 |

### Damage Type Relationships

```
Fire ──────[Strong]──────> Ice (1.5x damage)
Ice ───────[Strong]──────> Lightning (1.25x damage)
Lightning ─[Strong]──────> Water/Wet targets (2.0x damage)
Holy ──────[Strong]──────> Dark (1.5x damage)
Dark ──────[Strong]──────> Holy (1.5x damage)
Fire ──────[Nullifies]───> Fire Elemental (0x, absorbed)
```

### Example Resistance Template (JSON)

```json
{
  "id": "undead-resistances",
  "name": "Undead Resistances",
  "description": "Standard resistances for undead creatures",
  "creatureTypes": ["undead", "skeleton", "zombie", "ghost", "vampire"],
  "resistances": [
    { "damageTypeId": "poison", "value": 100, "isImmunity": true },
    { "damageTypeId": "psychic", "value": 100, "isImmunity": true },
    { "damageTypeId": "dark", "value": 50 },
    { "damageTypeId": "ice", "value": 25 },
    { "damageTypeId": "holy", "value": -50 },
    { "damageTypeId": "fire", "value": -25 }
  ]
}
```

### Integration with Monsters

The `baseResistances` field in `monsters.json` can either:
1. Reference a template: `"resistanceTemplateId": "undead-resistances"`
2. Define inline resistances (current format): `"baseResistances": { "physical": 25, "fire": -50 }`
3. Combine both: template + overrides

```json
{
  "id": "frost-skeleton",
  "resistanceTemplateId": "undead-resistances",
  "resistanceOverrides": {
    "ice": 75,
    "fire": -75
  }
}
```

### Acceptance Criteria

- [x] `damage-types.schema.json` created in `config/schemas/`
- [x] Schema validates existing `damage-types.json` without errors
- [x] Damage category enum/definitions validated
- [x] ID pattern enforced (lowercase kebab-case)
- [x] Color field validated (non-empty string)
- [x] Resistance value range validated (-100 to 100)
- [x] Immunity flag validated as boolean
- [x] Absorption flag validated as boolean
- [x] Relationship enum validated (Strong, Weak, Neutral, Nullifies)
- [x] Resistance template structure validated
- [x] Template creature types validated as string array
- [x] ~8 unit tests pass

---

## v0.14.1d: Combat Rules Schema

[v0.14.1d Design Specification](v0.14.1d-design-specification.md)

### Overview

Create a JSON schema for combat mechanics configuration that validates flanking rules, opportunity attack settings, initiative calculations, and death/unconscious behaviors.

### Scope

**In Scope:**
- `combat.schema.json` - Full schema for combat mechanics
- Flanking configuration (enabled, bonuses)
- Opportunity attack rules (enabled, requirements)
- Initiative calculation settings
- Death and unconscious threshold rules
- Disengage action configuration

**Out of Scope:**
- Ability schema expansion (v0.14.1a)
- Status effect schema (v0.14.1b)
- Damage type schema (v0.14.1c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| JSON Schemas | 1 | `combat.schema.json` |
| Schema Definitions | 4 | `FlankingConfig`, `OpportunityAttackConfig`, `InitiativeConfig`, `DeathConfig` |
| Configuration Updates | 1 | Update `combat.json` to reference schema |
| Unit Tests | ~6 | Schema validation tests |

### Schema Structure

```
combat.schema.json
|-- $schema: "http://json-schema.org/draft-07/schema#"
|-- title: "Combat Rules Configuration"
|-- description: "Schema for combat mechanics and rules"
|-- type: object
|-- properties:
|   |-- $schema: string
|   |-- version: string (optional)
|   |-- flanking: FlankingConfig
|   |-- opportunityAttacks: OpportunityAttackConfig
|   |-- initiative: InitiativeConfig (optional)
|   +-- death: DeathConfig (optional)
+-- definitions:
    |-- FlankingConfig
    |   |-- enabled: boolean (default: true)
    |   |-- attackBonus: integer (minimum: 0)
    |   |-- damageBonus: integer (minimum: 0)
    |   |-- behindAttackBonus: integer (minimum: 0, optional)
    |   +-- behindDamageBonus: integer (minimum: 0, optional)
    |
    |-- OpportunityAttackConfig
    |   |-- enabled: boolean (default: true)
    |   |-- requiresMeleeWeapon: boolean (default: true)
    |   |-- oneReactionPerRound: boolean (default: true)
    |   +-- disengage: DisengageConfig
    |
    |-- DisengageConfig
    |   |-- enabled: boolean (default: true)
    |   +-- consumesAction: boolean (default: true)
    |
    |-- InitiativeConfig
    |   |-- baseAttribute: string (enum: wits, finesse, default: wits)
    |   |-- diceExpression: string (dice notation, e.g., "1d20")
    |   |-- tieBreaker: string (enum: HigherAttribute, Random, PlayerFirst)
    |   +-- surpriseRoundBonus: integer (optional)
    |
    +-- DeathConfig
        |-- unconsciousThreshold: integer (HP threshold, default: 0)
        |-- deathThreshold: integer (HP threshold, default: -10 or null for instant)
        |-- deathSavesEnabled: boolean (default: false)
        |-- deathSaveSuccesses: integer (minimum: 1, for death saves)
        +-- deathSaveFailures: integer (minimum: 1, for death saves)
```

### Flanking Configuration

```
+------------------+
|   Flanking Positions
+------------------+

      [Enemy]
         |
    +----+----+
    |         |
[Ally A]   [Ally B]  <- Flanking (attackBonus applies)

      [Enemy]
         |
         |
      [Ally]           <- Behind (behindAttackBonus + behindDamageBonus)
```

### Initiative Tie Breakers

| Option | Description |
|--------|-------------|
| `HigherAttribute` | Higher initiative attribute goes first |
| `Random` | Random selection |
| `PlayerFirst` | Player always wins ties |

### Acceptance Criteria

- [x] `combat.schema.json` created in `config/schemas/`
- [x] Schema validates existing `combat.json` without errors
- [x] Flanking config validates bonus ranges
- [x] Opportunity attack config validates boolean fields
- [x] Disengage nested config validates correctly
- [x] Initiative attribute enum validated
- [x] Death threshold allows negative values or null
- [x] ~6 unit tests pass

---

## Dependencies & Prerequisites

```
v0.14.0 (Character Configuration Schemas) - REQUIRED
    |
    +-- All character schemas complete ─────────────────────────────────┐
                                                                        |
                                    v
v0.14.1 (Combat Configuration Schemas)
    |
    |-- v0.14.1a: Ability Schema Expansion ─────────────────────────────┐
    |       Dependencies: Existing abilities.schema.json                 |
    |       Provides: Expanded abilities schema with combos, prereqs     |
    |                                                                    |
    |-- v0.14.1b: Status Effect Schema ─────────────────────────────────┤
    |       Dependencies: None                                           |
    |       Provides: status-effects.schema.json                         |
    |                                                                    |
    |-- v0.14.1c: Damage Type Schema ───────────────────────────────────┤
    |       Dependencies: None                                           |
    |       Provides: damage-types.schema.json                           |
    |                                                                    |
    +-- v0.14.1d: Combat Rules Schema ──────────────────────────────────┘
            Dependencies: None
            Provides: combat.schema.json

Note: v0.14.1a-d can be implemented in parallel as they have no internal dependencies
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.14.1a | 0 | 1 | ~6 | Medium |
| v0.14.1b | 1 | 1 | ~7 | Medium |
| v0.14.1c | 1 | 1 | ~8 | Medium |
| v0.14.1d | 1 | 1 | ~6 | Medium |
| **Total** | **3** | **4** | **~27** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Abilities schema changes break existing configs | Medium | Low | Ensure backwards compatibility, new fields optional |
| Status effect complexity too high | Low | Medium | Start with simple validation, iterate |
| Cross-reference validation complexity | Low | Low | Defer to future version |
| Combat rules vary significantly by game mode | Medium | Low | Make most fields optional with sensible defaults |

---

## Design Decisions (Confirmed)

### Schema Standards

| Decision | Value | Notes |
|----------|-------|-------|
| **JSON Schema Version** | Draft-07 | Consistent with v0.14.0 |
| **ID Pattern** | `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| **Schema Location** | `config/schemas/` | Centralized |
| **Backwards Compatibility** | Required | New fields must be optional |

### Ability System

| Decision | Value | Notes |
|----------|-------|-------|
| **Combo window default** | 1 turn | Single turn to continue combo |
| **Max charges default** | None | Only required for charge-based abilities |
| **AoE shape options** | Circle, Square, Cone, Line | Standard shapes |

### Status Effects

| Decision | Value | Notes |
|----------|-------|-------|
| **Stacking rules** | 5 options | None, RefreshDuration, StackIntensity, StackDuration, Block |
| **Duration types** | 4 options | Turns, Seconds, Permanent, UntilDispelled |
| **Cleanse categories** | 5 options | Magic, Poison, Curse, Disease, Physical |

### Damage Types & Resistances

| Decision | Value | Notes |
|----------|-------|-------|
| **Damage categories** | 4 options | Physical, Elemental, Magical, Special |
| **Resistance range** | -100 to 100 | Negative = vulnerability, positive = resistance |
| **Immunity flag** | Distinct from 100% | Cannot be reduced by effects |
| **Absorption flag** | Heals instead | Fire elemental healed by fire |
| **Resistance templates** | 8 standard | Undead, construct, elementals, etc. |
| **Template + override** | Supported | Monsters can extend templates |

### Combat Rules

| Decision | Value | Notes |
|----------|-------|-------|
| **Default flanking bonus** | +2 attack | Standard tactical advantage |
| **Opportunity attack default** | Enabled | Melee weapon required |
| **Initiative attribute** | Wits | Can be configured |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.14.1a Design Spec** - Create detailed design for Ability Schema Expansion
3. **v0.14.1b Design Spec** - Create detailed design for Status Effect Schema
4. **v0.14.1c Design Spec** - Create detailed design for Damage Type Schema
5. **v0.14.1d Design Spec** - Create detailed design for Combat Rules Schema
6. **Parallel Implementation** - All four sub-parts can be implemented concurrently
7. **Integration Testing** - Verify all schemas work together

---

*This scope breakdown provides a structured approach to implementing v0.14.1 Combat Configuration Schemas. The four sub-parts can be developed in parallel since they have no internal dependencies. v0.14.1a expands the existing abilities schema while v0.14.1b-d create new schemas for status effects, damage types, and combat rules respectively.*
