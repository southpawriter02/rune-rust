# v0.14.3c Changelog - Tier Schema

## Summary

Implemented `tiers.schema.json` with comprehensive validation for monster difficulty tier definitions, including stat multipliers (health, attack, defense), reward multipliers (XP, loot), spawn weight distribution, name configuration (prefix/suffix/unique generation), level gating, and additional trait assignments. This schema enables full customization of difficulty progression without code changes, supporting modding scenarios for custom difficulty levels like "Legendary", "Nightmare", or "Miniboss".

## Added

### Schema Files
- **[config/schemas/tiers.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/tiers.schema.json)** - JSON Schema Draft-07 for tier configuration
  - `TierDefinition` - Complete tier with multipliers, spawn config, name config, and display settings

### TierDefinition Properties
| Property | Type | Constraint | Description |
|----------|------|------------|-------------|
| `id` | string | Pattern: `^[a-z][a-z0-9_]*$` | Unique identifier (required) |
| `name` | string | minLength: 1 | Display name (required) |
| `namePrefix` | string/null | maxLength: 50 | Prefix before monster name |
| `nameSuffix` | string/null | maxLength: 50 | Suffix after monster name |
| `healthMultiplier` | number | >= 0.1, default: 1.0 | HP scaling multiplier |
| `attackMultiplier` | number | >= 0.1, default: 1.0 | Attack scaling multiplier |
| `defenseMultiplier` | number | >= 0.1, default: 1.0 | Defense scaling multiplier |
| `experienceMultiplier` | number | >= 0.1, default: 1.0 | XP reward multiplier |
| `lootMultiplier` | number | >= 0.1, default: 1.0 | Loot drop chance multiplier |
| `lootQualityBonus` | integer | (optional) | Rarity tier shift |
| `color` | string | minLength: 1 | UI display color (required) |
| `spawnWeight` | integer | >= 0, default: 100 | Spawn probability weight |
| `generatesUniqueName` | boolean | default: false | Use procedural name generation |
| `additionalTraits` | string[] | Pattern validated | Forced trait IDs |
| `minimumLevel` | integer | >= 1 (optional) | Level gate for spawning |
| `sortOrder` | integer | >= 0 | Display order (required) |

### Validation Rules
| Property | Constraint | Error Message |
|----------|------------|---------------|
| All multipliers | >= 0.1 | "must be >= 0.1" |
| `spawnWeight` | >= 0 | "must be >= 0" |
| `minimumLevel` | >= 1 | "must be >= 1" |
| `sortOrder` | >= 0 | "must be >= 0" |
| `id` | Pattern | "must match ^[a-z][a-z0-9_]*$" |
| `additionalTraits[*]` | Pattern | "must match ^[a-z][a-z0-9_]*$" |

### Standard Tier Distribution
| Tier | Spawn Weight | Probability | Multipliers (HP/ATK/DEF) | XP Mult |
|------|--------------|-------------|--------------------------|---------|
| common | 70 | 70% | 1.0x / 1.0x / 1.0x | 1.0x |
| named | 20 | 20% | 1.5x / 1.3x / 1.2x | 2.0x |
| elite | 8 | 8% | 2.0x / 1.5x / 1.5x | 3.0x |
| boss | 2 | 2% | 5.0x / 2.0x / 2.0x | 10.0x |

### Configuration Updates
- **[config/tiers.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/tiers.json)** - Updated with `$schema` reference
  - Added `lootQualityBonus` to elite (+1) and boss (+2) tiers
  - Added `minimumLevel` to elite (5) and boss (10) tiers
  - Existing 4 tiers validate successfully:
    - `common` - Base tier with no modifications (70% spawn)
    - `named` - Unique names with moderate scaling (20% spawn)
    - `elite` - Prefix "Elite" with strong scaling, level 5+ (8% spawn)
    - `boss` - Prefix "Boss" with heavy scaling, level 10+ (2% spawn)

### Unit Tests
- **[TiersSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/TiersSchemaTests.cs)** - 6 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation
  - `ExistingTiersJson_ValidatesAgainstSchema` - Backwards compatibility (4 tiers)
  - `Multipliers_LessThanMinimum_FailsValidation` - Multiplier >= 0.1 validation
  - `SpawnWeight_Negative_FailsValidation` - Spawn weight >= 0 validation
  - `MinimumLevel_Zero_FailsValidation` - Level gate >= 1 validation
  - `AdditionalTraits_InvalidPattern_FailsValidation` - Trait ID pattern validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/tiers.schema.json` | Added |
| `config/tiers.json` | Modified (schema ref, added lootQualityBonus, minimumLevel) |
| `tests/.../Schemas/TiersSchemaTests.cs` | Added |
| `changelogs/v0.14.3c-changelog.md` | Added |

## Test Results

```
Test summary: total: 6, failed: 0, succeeded: 6, skipped: 0
Build succeeded with 0 errors
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Add custom difficulty tiers (Legendary, Nightmare, Miniboss, etc.)
- Configure stat scaling multipliers for balanced difficulty
- Set up spawn weight distributions for tier rarity
- Gate tiers behind player level requirements
- Force specific traits on tier monsters via `additionalTraits`
- Enable unique procedural name generation per tier
- Customize display colors for visual distinction
- Add name prefixes/suffixes for thematic naming

---

*Part of v0.14.3 Monster Configuration Schemas series. See also: v0.14.3a (Monster Schema), v0.14.3b (Trait Schema), v0.14.3d (Boss Schema).*
