# v0.20.1a Changelog — Skjaldmær Framework & Tier 1 Abilities

**Version**: 0.20.1a  
**Date**: 2026-02-09  
**Category**: Domain / Application Layer — Skjaldmær Specialization

---

## Summary

Implements the Skjaldmær specialization framework including the Block Charge resource system and three Tier 1 ability definitions (Shield Wall, Intercept, Bulwark). This is the first fully-implemented specialization for the Warrior archetype, establishing immutable value object patterns for all future specialization resource systems.

---

## Added

### Domain Layer — Enumerations

| File                           | Purpose                                             |
| ------------------------------ | --------------------------------------------------- |
| `Enums/SkjaldmaerAbilityId.cs` | Identifies all 9 Skjaldmær abilities across 4 tiers |

### Domain Layer — Value Objects

| File                                  | Purpose                                                                   |
| ------------------------------------- | ------------------------------------------------------------------------- |
| `ValueObjects/BlockChargeResource.cs` | Immutable Block Charge resource (3 max, TrySpend, Restore, Bulwark HP)    |
| `ValueObjects/ShieldWallState.cs`     | Immutable stance state with defense bonuses and 8-dir adjacency detection |

### Application Layer — Interfaces

| File                                      | Purpose                                                                               |
| ----------------------------------------- | ------------------------------------------------------------------------------------- |
| `Interfaces/IBlockChargeService.cs`       | Contract for charge spending, restoration, and validation                             |
| `Interfaces/ISkjaldmaerAbilityService.cs` | Contract for Shield Wall, Intercept, and Bulwark operations (implementation deferred) |

### Application Layer — Services

| File                             | Purpose                                                        |
| -------------------------------- | -------------------------------------------------------------- |
| `Services/BlockChargeService.cs` | Logging-enriched charge management with structured audit trail |

### Configuration

| File                          | Change                                                      |
| ----------------------------- | ----------------------------------------------------------- |
| `config/specializations.json` | Populated Skjaldmaer `abilityTiers` with 3 Tier 1 abilities |

### Unit Tests

| File                                                | Tests   |
| --------------------------------------------------- | ------- |
| `ValueObjects/BlockChargeResourceTests.cs` (Domain) | 5 tests |
| `Services/BlockChargeServiceTests.cs` (Application) | 5 tests |

---

## Technical Details

### Block Charge Resource

- Immutable `sealed record` with functional mutation (`TrySpend` returns `(bool, BlockChargeResource)`)
- Default: 3/3 charges, restores to max on rest
- Bulwark passive: +5 Max HP per charge held (max +15 HP at 3 charges)
- Constants: `DefaultMaxCharges = 3`, `BulwarkHpPerCharge = 5`

### Shield Wall State

- Immutable `sealed record` with `Activate`/`Deactivate` factory methods
- Self defense bonus: +3 Defense when active
- Ally defense bonus: +1 Defense to adjacent allies (Chebyshev distance ≤ 1)
- `GetAdjacentAllies()` uses 8-directional adjacency on position grid

### Skjaldmær Ability Tiers

| Tier     | Abilities                            | PP Cost | Unlock Requirement |
| -------- | ------------------------------------ | ------- | ------------------ |
| Tier 1   | Shield Wall, Intercept, Bulwark      | Free    | Rank 1             |
| Tier 2   | Hold the Line, Counter-Shield, Rally | 4 PP    | 8 PP invested      |
| Tier 3   | Unbreakable, Guardian's Sacrifice    | 5 PP    | 16 PP invested     |
| Capstone | The Wall Lives                       | 6 PP    | 24 PP invested     |

### Logging Strategy

| Operation       | Level       | Template                                                       |
| --------------- | ----------- | -------------------------------------------------------------- |
| Charge spent    | Information | `"Block Charges spent: Character {CharacterId}..."`            |
| Charge restored | Information | `"Block Charges restored: Character {CharacterId}..."`         |
| Full restore    | Information | `"Block Charges fully restored: Character {CharacterId}..."`   |
| Spend rejected  | Warning     | `"Block Charge spend rejected for character {CharacterId}..."` |

---

## Verification

| Metric         | Result |
| -------------- | ------ |
| Build Errors   | 0      |
| Build Warnings | 0      |
| New Tests      | 10     |
| Total Tests    | 4,289  |
| All Tests Pass | ✓      |

---

## Design Decisions

| Decision                    | Choice                     | Rationale                                                    |
| --------------------------- | -------------------------- | ------------------------------------------------------------ |
| Value object mutability     | Immutable records          | Consistent with `AbilitySlotPreparation` pattern             |
| Service API surface         | Operates on value objects  | Avoids coupling to full Character entity                     |
| `ISkjaldmaerAbilityService` | Interface-only, no impl    | Implementation requires combat system hooks (future version) |
| Ability identifiers         | `SkjaldmaerAbilityId` enum | Strongly-typed within specialization; string IDs in config   |

---

## Dependencies

- **Depends on**: v0.20.0a (SpecializationId enum, specializations.json structure)
- **Required by**: v0.20.1b (Tier 2 abilities), v0.20.1c (Tier 3 + Capstone)
