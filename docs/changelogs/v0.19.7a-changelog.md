# v0.19.7a Changelog — Content Verification & Hardening

**Release Date:** 2026-02-06
**Version:** 0.19.7a
**Focus:** Content verification, configuration file validation, and hazard system hardening.

---

## Changed

### Configuration

- **Renamed** `hazards.json` to `environmental-hazards.json` for clarity and consistency with the provider service.
- **Updated** `monsters.json`:
    - Added `frost-draugr` (Niflheim)
    - Added `rot-stalker` (Vanaheim)
    - Fixed `surtrs-scion` ID to `surtr-scion`
- **Updated** `environmental-hazards.json`:
    - Validated all entries against the `HazardType` enum.
    - Ensured damage fields map correctly to the new structured format.

### Domain Layer

- **Updated** `HazardType` enum (`Domain/Enums/HazardType.cs`):
    - Added missing values to match configuration: `Lava`, `Contact`, `Environmental`, `Trap`, `Gap`, `Curse`, `Psychic`.

### Application Layer

- **Updated** `EnvironmentalHazardDefinition` (`Application/DTOs/EnvironmentalHazardDefinition.cs`):
    - Added `EntryDamage` and `TurnDamage` properties using `DamageDefinition`.
    - Marked legacy `DamageDice` and `DamageType` as `[Obsolete]`.
    - Updated `Create` factory method to populate new structure while maintaining backward compatibility.
- **Updated** `EnvironmentalCombatService` (`Application/Services/EnvironmentalCombatService.cs`):
    - Rewrote `ApplyHazardDamage` to utilize `EntryDamage` and `TurnDamage` properties correctly.
    - Added fallback logic for legacy definitions.

### Infrastructure Layer

- **Updated** `JsonEnvironmentalHazardProvider` (`Infrastructure/Providers/JsonEnvironmentalHazardProvider.cs`):
    - Added `[JsonPropertyName("hazardType")]` to `HazardDto` to fix deserialization issues.
    - Updated `MapToDefinition` to correctly map JSON fields to the new `EnvironmentalHazardDefinition` structure.
    - Added strict validation for `HazardType` parsing.

## Added

### Testing

- **Added** `ContentVerificationTests` (`Application/Tests/Configuration/ContentVerificationTests.cs`):
    - `Monsters_Json_ShouldLoadAndContainNewEnemies` — Verifies new v0.19 enemies exist.
    - `EnvironmentalHazards_Json_ShouldLoadAndContainNewHazards` — Verifies hazard loading and type mapping.
    - `RoomTemplates_Json_ShouldLoadAndContainNewTemplates` — Verifies room template loading.
    - `Descriptors_Json_ShouldLoad` — Verifies descriptor system configuration.

## Technical Notes

- **Hazard Damage Logic:** The system now distinguishes between `DamageOnEnter` (immediate) and `DamagePerTurn` (tick) with separate damage profiles (dice, type, bonus).
- **Verification Suite:** The new `ContentVerificationTests` suite validates that the JSON configuration files are syntactically correct and contain the expected required content for v0.19 release.
