# Changelog: v0.3.0 - The Trauma Economy (Complete)

**Versions:** v0.3.0a through v0.3.0c
**Release Dates:** 2025-12-20
**Test Count:** 1655 tests (74 new across all parts)

## Table of Contents

- [Overview](#overview)
- [Part A: The Weight (Psychic Stress & Resolve)](#part-a-the-weight-psychic-stress--resolve)
  - [Summary](#summary)
  - [New Features](#new-features)
  - [New Files](#new-files)
  - [Modified Files](#modified-files)
  - [Code Implementation Details](#code-implementation-details)
  - [Architecture](#architecture)
  - [Logging Matrix](#logging-matrix)
  - [Test Coverage Matrix](#test-coverage-matrix)
  - [DI Registration](#di-registration)
  - [Migration Notes](#migration-notes)
  - [Known Limitations](#known-limitations)
  - [Verification Results](#verification-results)
  - [Directory Structure After Release](#directory-structure-after-release)
  - [Milestone v0.3.0 Progress](#milestone-v030-progress)
  - [Next Steps (v0.3.0b)](#next-steps-v030b)
  - [Contributors](#contributors)
- [Part B: The Stain (Corruption & Tiers)](#part-b-the-stain-corruption--tiers)
  - [Summary](#summary-1)
  - [New Features](#new-features-1)
  - [New Files](#new-files-1)
  - [Modified Files](#modified-files-1)
  - [Code Implementation Details](#code-implementation-details-1)
  - [Architecture](#architecture-1)
  - [Logging Matrix](#logging-matrix-1)
  - [Test Coverage Matrix](#test-coverage-matrix-1)
  - [Verification Results](#verification-results-1)
  - [Directory Structure After Release](#directory-structure-after-release-1)
  - [Milestone v0.3.0 Progress](#milestone-v030-progress-1)
  - [Next Steps (v0.3.0c)](#next-steps-v030c)
  - [Known Limitations](#known-limitations-1)
  - [Contributors](#contributors-1)
- [Part C: The Scar (Consequences)](#part-c-the-scar-consequences)
  - [Summary](#summary-2)
  - [New Features](#new-features-2)
  - [Files Created](#files-created)
  - [Files Modified](#files-modified)
  - [Technical Implementation](#technical-implementation)
  - [Logging Matrix](#logging-matrix-2)
  - [Test Coverage](#test-coverage)
  - [Integration Notes](#integration-notes)
  - [Design Decisions](#design-decisions)
  - [Known Limitations](#known-limitations-2)
  - [Milestone Status](#milestone-status)
  - [Directory Structure](#directory-structure)
  - [Related Documentation](#related-documentation)
- [Final Notes](#final-notes)

---

## Overview

Version 0.3.0 introduces the complete **Trauma Economy** system for Rune & Rust, comprising three interconnected psychological and spiritual degradation mechanics:

1. **Psychic Stress** (v0.3.0a): A 0-100 accumulating resource representing psychological trauma and mental strain, mitigated by WILL-based Resolve Checks that reduce incoming stress. Features a 6-tier status system (Stable → Unsettled → Shaken → Distressed → Fractured → BREAKING) with escalating Defense penalties.

2. **Runic Blight Corruption** (v0.3.0b): A 0-100 permanent accumulation mechanic representing spiritual contamination from the Runic Blight, with NO mitigation available. Features a 6-tier classification (Pristine → Tainted → Corrupted → Blighted → Fractured → Terminal) with penalties to Max Aether Points and attributes (WILL/WITS). Reaching 100 triggers Terminal Error (character becomes Forlorn).

3. **Breaking Point & Trauma** (v0.3.0c): When stress reaches 100, characters trigger a WILL-based Breaking Point resolution with three possible outcomes: Stabilized (stress reset to 75 + Disoriented), Trauma (stress reset to 50 + permanent trauma), or Catastrophe (stress reset to 50 + trauma + Stunned). Introduces 10 starter traumas across 4 categories (Phobias, Somatic, Delusions, Compulsions) with permanent attribute penalties and environmental triggers.

This milestone establishes the foundation for the game's mental health and corruption systems, creating a tense resource management layer that rewards careful play while punishing recklessness with permanent consequences.

---

## Part A: The Weight (Psychic Stress & Resolve)

**Release Date:** 2025-12-20
**Milestone:** v0.3.0 - The Trauma Economy (1 of 3)
**Test Count:** 1555 tests (46 new)

---

### Summary

This release introduces the **Psychic Stress** system, a 0-100 accumulating resource that represents psychological trauma and mental strain. Unlike HP which depletes, stress builds up during combat and dangerous encounters. The core mechanic features **WILL-based Resolve Checks** where each success on a WILL dice pool roll reduces incoming stress by 1. Stress affects combat performance through a **Defense Penalty** (stress / 20, max 5), making high-stress combatants easier to hit. The Combat UI now displays stress with a **6-tier color-coded status indicator** (Stable → Unsettled → Shaken → Distressed → Fractured → BREAKING). This lays the foundation for the full Trauma Economy system in subsequent v0.3.0 releases.

---

### New Features

#### Psychic Stress System

Core stress mechanics:

| Component | Formula | Description |
|-----------|---------|-------------|
| **Max Stress** | 100 (fixed) | All combatants have 100 max stress |
| **Resolve Check** | Roll WILL d10 pool | Each success reduces incoming stress by 1 |
| **Net Stress** | Raw - Mitigation | Minimum 0 (cannot go negative) |
| **Breaking Point** | Stress = 100 | Triggers special event (implemented in v0.3.0c) |

#### Stress Status Tiers

| Status | Range | Defense Penalty | UI Color |
|--------|-------|-----------------|----------|
| Stable | 0-19 | 0 | Green |
| Unsettled | 20-39 | 1 | Cyan |
| Shaken | 40-59 | 2 | Yellow |
| Distressed | 60-79 | 3 | Magenta |
| Fractured | 80-99 | 4 | Red |
| BREAKING | 100 | 5 | Bold Red |

#### Defense Integration

Stress now affects the defense calculation:

```
Defense Score = 10 + FINESSE - Stress Penalty
Stress Penalty = stress / 20 (max 5)
```

**Example:** A combatant with FINESSE 5 and 60 stress:
- Defense = 10 + 5 - 3 = 12 (instead of 15)

#### Combat UI Stress Display

The combat header now shows stress alongside HP and Stamina:

```
──────── COMBAT ────────────────────────────────────────────────
  HP: 45/60    Stamina: 35/50    Stress: 45 (Shaken)
```

Stress color changes based on tier for immediate visual feedback.

---

### New Files

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/StressStatus.cs` | 6-tier stress classification enum |
| `RuneAndRust.Core/Models/Combat/StressResult.cs` | Record for stress infliction/recovery results |
| `RuneAndRust.Core/Interfaces/ITraumaService.cs` | Service contract for stress mechanics |
| `RuneAndRust.Engine/Services/TraumaService.cs` | Implementation of stress mechanics with WILL-based resolve |
| `RuneAndRust.Tests/Engine/TraumaServiceTests.cs` | 24 unit tests for TraumaService |

---

### Modified Files

| File | Changes |
|------|---------|
| `RuneAndRust.Core/Entities/Character.cs` | Added `PsychicStress` (0-100) and `MaxPsychicStress` (always 100) properties |
| `RuneAndRust.Core/Models/Combat/Combatant.cs` | Added `CurrentStress`, `MaxStress`; updated `FromCharacter()` and `FromEnemy()` factory methods |
| `RuneAndRust.Core/ViewModels/CombatViewModel.cs` | Added `CurrentStress`, `MaxStress` to `PlayerStatsView` record |
| `RuneAndRust.Engine/Services/AttackResolutionService.cs` | Injected `ITraumaService`; `CalculateDefenseScore()` now includes stress penalty |
| `RuneAndRust.Engine/Services/CombatService.cs` | Updated `GetViewModel()` to pass stress to `PlayerStatsView` |
| `RuneAndRust.Terminal/Services/CombatScreenRenderer.cs` | Added 6-tier stress color coding and label display in `RenderHeader()` |
| `RuneAndRust.Terminal/Program.cs` | Registered `ITraumaService` as Singleton; updated version to v0.3.0a |
| `RuneAndRust.Tests/Engine/AttackResolutionServiceTests.cs` | Added `ITraumaService` mock; added stress penalty tests |

---

### Code Implementation Details

#### StressStatus Enum

```csharp
public enum StressStatus
{
    Stable = 0,      // 0-19
    Unsettled = 1,   // 20-39
    Shaken = 2,      // 40-59
    Distressed = 3,  // 60-79
    Fractured = 4,   // 80-99
    Breaking = 5     // 100
}
```

#### StressResult Record

```csharp
public record StressResult(
    int RawStress,           // Initial stress amount
    int MitigatedAmount,     // Stress reduced by WILL successes
    int NetStressApplied,    // Actual stress added (Raw - Mitigated)
    int CurrentTotal,        // New stress total after application
    StressStatus PreviousStatus,
    StressStatus NewStatus,
    bool IsBreakingPoint,    // True if stress just hit 100
    int ResolveSuccesses,    // WILL roll successes
    string Source            // What caused the stress
);
```

#### ITraumaService Interface

```csharp
public interface ITraumaService
{
    StressResult InflictStress(Combatant target, int amount, string source);
    StressResult RecoverStress(Combatant target, int amount, string source);
    StressStatus GetStressStatus(int stressValue);
    int GetDefensePenalty(int stressValue);
    void HandleBreakingPoint(Combatant target); // Stub for v0.3.0c
}
```

#### Key TraumaService Methods

**InflictStress:**
```csharp
public StressResult InflictStress(Combatant target, int amount, string source)
{
    // 1. Roll WILL dice pool for resolve check
    var willValue = target.GetAttribute(CharacterAttribute.Will);
    var resolveRoll = _dice.Roll(willValue, $"{target.Name} Resolve Check");

    // 2. Each success mitigates 1 stress
    var mitigation = resolveRoll.Successes;
    var netStress = Math.Max(0, amount - mitigation);

    // 3. Apply stress, clamped to 0-100
    target.CurrentStress = Math.Clamp(target.CurrentStress + netStress, 0, 100);

    // 4. Check for breaking point (first time hitting 100)
    var isBreakingPoint = target.CurrentStress >= 100 && previousStress < 100;

    return new StressResult(...);
}
```

**GetDefensePenalty:**
```csharp
public int GetDefensePenalty(int stressValue)
{
    // Defense penalty = stress / 20, max 5
    // 0-19 = 0, 20-39 = 1, 40-59 = 2, 60-79 = 3, 80-99 = 4, 100 = 5
    return Math.Min(5, stressValue / 20);
}
```

#### AttackResolutionService Defense Integration

```csharp
public int CalculateDefenseScore(Combatant defender)
{
    var finesse = defender.GetAttribute(CharacterAttribute.Finesse);
    var stressPenalty = _traumaService.GetDefensePenalty(defender.CurrentStress);
    var defense = 10 + finesse - stressPenalty;
    return defense;
}
```

#### Combat Screen Stress Display

```csharp
// Stress color mapping based on tier
var stressColor = stats.CurrentStress switch
{
    >= 100 => "bold red",   // Breaking
    >= 80 => "red",          // Fractured
    >= 60 => "magenta",      // Distressed
    >= 40 => "yellow",       // Shaken
    >= 20 => "cyan",         // Unsettled
    _ => "green"             // Stable
};

AnsiConsole.MarkupLine(
    $"  [bold]HP:[/] [{hpColor}]{stats.CurrentHp}/{stats.MaxHp}[/]    " +
    $"[bold]Stamina:[/] [{staminaColor}]{stats.CurrentStamina}/{stats.MaxStamina}[/]    " +
    $"[bold]Stress:[/] [{stressColor}]{stats.CurrentStress}[/] [grey]({stressLabel})[/]");
```

---

### Architecture

#### Stress Infliction Flow

```
Trauma Event (e.g., witness ally death, encounter horror)
    │
    └─ TraumaService.InflictStress(target, rawAmount, "Witnessed Ally Death")
          │
          ├─ Get target.GetAttribute(WILL) → willValue
          │
          ├─ DiceService.Roll(willValue, "Resolve Check")
          │     └─ Returns: successes, botches, individual rolls
          │
          ├─ mitigation = successes
          │
          ├─ netStress = Max(0, rawAmount - mitigation)
          │
          ├─ target.CurrentStress = Clamp(current + net, 0, 100)
          │
          ├─ If CurrentStress >= 100 && was < 100
          │     └─ HandleBreakingPoint(target) [stub for v0.3.0c]
          │
          └─ Return StressResult with all details
```

#### Defense Calculation Flow

```
AttackResolutionService.ResolveMeleeAttack()
    │
    └─ CalculateDefenseScore(defender)
          │
          ├─ finesse = defender.GetAttribute(FINESSE)
          │
          ├─ stressPenalty = _traumaService.GetDefensePenalty(defender.CurrentStress)
          │     └─ Returns: stress / 20 (capped at 5)
          │
          └─ defense = 10 + finesse - stressPenalty
```

---

### Logging Matrix

#### TraumaService Logs

| Event | Level | Template |
|-------|-------|----------|
| Stress Infliction Start | Information | `"Inflicting {Amount} stress on {Target} from {Source}"` |
| Resolve Check Result | Debug | `"Resolve check: {Will}d10 = {Successes} successes. Raw {Raw} - Mitigated {Mit} = Net {Net}"` |
| Stress Change | Debug | `"{Target} stress: {Previous} -> {Current} (Status: {Status})"` |
| Status Transition | Information | `"{Target} stress status changed: {Previous} -> {New}"` |
| Breaking Point | Warning | `"{Target} has reached the BREAKING POINT!"` |
| Stress Recovery Start | Information | `"Recovering {Amount} stress from {Target} via {Source}"` |
| Stress Recovery Result | Debug | `"{Target} stress recovered: {Previous} -> {Current} (Status: {Status})"` |
| Status Improvement | Information | `"{Target} stress status improved: {Previous} -> {New}"` |

#### AttackResolutionService Logs

| Event | Level | Template |
|-------|-------|----------|
| Defense Calculation | Trace | `"Defense: 10 + Finesse({Finesse}) - StressPenalty({Penalty}) = {Defense}"` |

---

### Test Coverage Matrix

#### TraumaServiceTests (24 tests)

| Test Name | Category | Validates |
|-----------|----------|-----------|
| `GetStressStatus_ReturnsCorrectTier` | Unit | 17 inline data cases for all tier boundaries |
| `GetDefensePenalty_ReturnsCorrectValue` | Unit | 12 inline data cases including cap at 5 |
| `GetDefensePenalty_CapsAtFive` | Unit | Penalty never exceeds 5 |
| `InflictStress_ReducesByWillSuccesses` | Unit | WILL mitigation math |
| `InflictStress_ZeroNetOnHighResistance` | Unit | Full mitigation scenario |
| `InflictStress_ClampsAt100` | Unit | Max stress cap |
| `InflictStress_TriggersBreakingPointAt100` | Unit | Breaking point flag |
| `InflictStress_NoBreakingPointIfAlreadyAt100` | Unit | No repeat breaking |
| `InflictStress_TracksStatusTransition` | Unit | Status tracking |
| `InflictStress_StoresSourceInResult` | Unit | Source preservation |
| `InflictStress_UsesCorrectWillAttribute` | Integration | WILL attribute lookup |
| `InflictStress_WorksWithEnemyCombatant` | Integration | Enemy compatibility |
| `RecoverStress_ReducesStress` | Unit | Recovery math |
| `RecoverStress_ClampsAtZero` | Unit | Min stress cap |
| `RecoverStress_TracksStatusTransition` | Unit | Status improvement |
| `RecoverStress_NeverTriggersBreakingPoint` | Unit | No breaking on recovery |
| `RecoverStress_ReturnsNegativeRawStress` | Unit | Negative raw for recovery |

#### AttackResolutionServiceTests (2 new tests)

| Test Name | Category | Validates |
|-----------|----------|-----------|
| `CalculateDefenseScore_IncludesStressPenalty` | Integration | Defense uses stress penalty |
| `CalculateDefenseScore_WithMaxStressPenalty` | Integration | Max penalty of 5 at breaking point |

---

### DI Registration

#### Program.cs Changes

```csharp
// Register Trauma Service (v0.3.0a) - BEFORE AttackResolutionService
services.AddSingleton<ITraumaService, TraumaService>();

// AttackResolutionService now depends on ITraumaService
services.AddSingleton<IAttackResolutionService, AttackResolutionService>();
```

**Registration Order:** `ITraumaService` must be registered before `IAttackResolutionService` since the latter depends on the former.

#### AttackResolutionService Constructor (Breaking Change)

**Before (v0.2.3c):**
```csharp
public AttackResolutionService(
    IDiceService dice,
    IStatusEffectService statusEffects,
    ILogger<AttackResolutionService> logger)
```

**After (v0.3.0a):**
```csharp
public AttackResolutionService(
    IDiceService dice,
    IStatusEffectService statusEffects,
    ITraumaService traumaService,  // NEW
    ILogger<AttackResolutionService> logger)
```

---

### Migration Notes

#### For Developers

If you have custom `AttackResolutionService` instantiations, add the `ITraumaService`:

```csharp
// Update your mocks in tests
var mockTraumaService = new Mock<ITraumaService>();
mockTraumaService.Setup(t => t.GetDefensePenalty(It.IsAny<int>())).Returns(0);

_sut = new AttackResolutionService(
    _mockDice.Object,
    _mockStatusEffects.Object,
    mockTraumaService.Object,  // NEW
    _mockLogger.Object);
```

#### Entity Updates

`Character` entities now include `PsychicStress`:
```csharp
// New property (default 0)
character.PsychicStress = 0;

// Read-only max (always 100)
var max = character.MaxPsychicStress; // 100
```

`Combatant` adapters now include stress:
```csharp
// FromCharacter copies stress
combatant.CurrentStress = character.PsychicStress;

// FromEnemy starts at 0
combatant.CurrentStress = 0;
```

---

### Known Limitations

1. **Stress Sources Not Implemented:** No game events currently inflict stress (coming in v0.3.0b)
2. **Breaking Point Is Stub:** Reaching 100 stress logs a warning but has no gameplay effect (v0.3.0c)
3. **No Stress Recovery Mechanics:** Recovery method exists but nothing calls it yet
4. **Stress Not Persisted:** Character.PsychicStress is not saved to database yet
5. **Enemy Stress Ignored:** Enemies start at 0 and never gain stress in current implementation

---

### Verification Results

#### Build Output

```
Build succeeded.
    63 Warning(s)
    0 Error(s)
```

#### Test Output

```
Test run for RuneAndRust.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (arm64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:  1555, Skipped:     0, Total:  1555, Duration: 575 ms
```

---

### Directory Structure After Release

```
RuneAndRust.Core/
├── Entities/
│   └── Character.cs                    [MODIFIED - added PsychicStress, MaxPsychicStress]
├── Enums/
│   └── StressStatus.cs                 [NEW]
├── Interfaces/
│   └── ITraumaService.cs               [NEW]
├── Models/Combat/
│   ├── Combatant.cs                    [MODIFIED - added CurrentStress, MaxStress]
│   └── StressResult.cs                 [NEW]
├── ViewModels/
│   └── CombatViewModel.cs              [MODIFIED - added stress to PlayerStatsView]

RuneAndRust.Engine/Services/
├── AttackResolutionService.cs          [MODIFIED - injected ITraumaService, stress penalty]
├── CombatService.cs                    [MODIFIED - stress in GetViewModel]
├── TraumaService.cs                    [NEW]

RuneAndRust.Terminal/
├── Program.cs                          [MODIFIED - registered ITraumaService, version bump]
├── Services/
│   └── CombatScreenRenderer.cs         [MODIFIED - stress bar display]

RuneAndRust.Tests/Engine/
├── AttackResolutionServiceTests.cs     [MODIFIED - added ITraumaService mock, stress tests]
├── TraumaServiceTests.cs               [NEW - 24 tests]
```

---

### Milestone v0.3.0 Progress

This release begins the v0.3.0 milestone "The Trauma Economy":

| Sub-version | Feature | Status |
|-------------|---------|--------|
| v0.3.0a | Psychic Stress & Resolve | **Complete** |
| v0.3.0b | Stress Sources (Combat Events) | Pending |
| v0.3.0c | Breaking Point & Trauma Selection | Pending |

---

### Next Steps (v0.3.0b)

- Implement stress sources for combat events:
  - Ally death: 15-25 stress
  - Critical hit received: 5-10 stress
  - Fumble attack: 3-5 stress
  - Horror creature encounter: 10-20 stress
- Add stress to combat log messages
- Implement stress recovery during rest
- Add visual/audio feedback for stress tier changes
- Create Breaking Point event placeholder for v0.3.0c

---

### Contributors

- Implementation: Claude Opus 4.5

---

## Part B: The Stain (Corruption & Tiers)

**Release Date:** 2025-12-20
**Milestone:** v0.3.0 - The Trauma Economy (2 of 3)
**Test Count:** 1638 tests (83 new)

---

### Summary

This release introduces the **Runic Blight Corruption** system, a 0-100 accumulating permanent resource representing the corrupting influence of the Runic Blight. Unlike Stress which can be mitigated by WILL rolls, **Corruption accumulates directly with NO mitigation** - it is a "High Water Mark" mechanic that scales up easily but requires rare, significant resources to lower. The system features a **6-tier classification** (Pristine → Tainted → Corrupted → Blighted → Fractured → Terminal) with escalating penalties affecting Max Aether Points and attributes. Reaching 100 Corruption triggers **Terminal Error** - the character becomes a Forlorn (unplayable). The Combat UI now displays corruption with a dark red/black color scheme, and the StatCalculationService applies corruption penalties to derived stats.

---

### New Features

#### Runic Blight Corruption System

Core corruption mechanics:

| Component | Formula | Description |
|-----------|---------|-------------|
| **Max Corruption** | 100 (fixed) | All characters have 100 max corruption |
| **Accumulation** | Direct | NO mitigation from WILL - corruption is permanent |
| **Terminal Error** | Corruption = 100 | Character becomes Forlorn (unplayable) |
| **Purging** | Rare | Requires special rituals or artifacts |

#### Corruption Tiers & Penalties

| Tier | Range | Max AP | WILL | WITS | UI Color |
|------|-------|--------|------|------|----------|
| Pristine | 0-20 | 100% | - | - | Green |
| Tainted | 21-40 | 100% | - | - | Grey |
| Corrupted | 41-60 | 90% | - | - | Maroon |
| Blighted | 61-80 | 80% | -1 | - | Red |
| Fractured | 81-99 | 60% | -2 | -1 | Bold Red |
| Terminal | 100 | 0% | -2 | -1 | White on Red |

#### Corruption Penalty Integration

Corruption penalties now affect the StatCalculationService:

```
Effective WILL = Base WILL - Corruption WILL Penalty
Effective WITS = Base WITS - Corruption WITS Penalty
Base Max AP = 10 + (WILL * 5) for Mystics, 0 for others
Final Max AP = Base Max AP * Corruption Multiplier
```

**Example:** A Mystic with WILL 5 and 70 Corruption (Blighted):
- Effective WILL = 5 - 1 = 4
- Base Max AP = 10 + (4 * 5) = 30
- Final Max AP = 30 * 0.80 = 24 (instead of 35)

#### Combat UI Corruption Display

The combat header now shows corruption on a second line (only when > 0):

```
──────── COMBAT ────────────────────────────────────────────────
  HP: 45/60    Stamina: 35/50    Stress: 45 (Shaken)
  Blight: 65 (Blighted)
```

Corruption uses a dark color scheme to distinguish from stress.

---

### New Files

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/CorruptionTier.cs` | 6-tier corruption classification enum |
| `RuneAndRust.Core/Models/Combat/CorruptionState.cs` | Value object with tier logic and penalty calculations |
| `RuneAndRust.Core/Models/Combat/CorruptionResult.cs` | Record for corruption change results |
| `RuneAndRust.Tests/Core/CorruptionStateTests.cs` | 48 unit tests for CorruptionState |

---

### Modified Files

| File | Changes |
|------|---------|
| `RuneAndRust.Core/Entities/Character.cs` | Added `Corruption` (0-100) and `MaxCorruption` (always 100) properties |
| `RuneAndRust.Core/Models/Combat/Combatant.cs` | Added `CurrentCorruption`, `MaxCorruption`; updated `FromCharacter()` and `FromEnemy()` factory methods |
| `RuneAndRust.Core/ViewModels/CombatViewModel.cs` | Added `CurrentCorruption`, `MaxCorruption` to `PlayerStatsView` record |
| `RuneAndRust.Core/Interfaces/ITraumaService.cs` | Added corruption methods region: `AddCorruption`, `PurgeCorruption`, `GetCorruptionState`, `HandleTerminalError` |
| `RuneAndRust.Core/Interfaces/IStatCalculationService.cs` | Added `CalculateBaseMaxAp()` method signature |
| `RuneAndRust.Engine/Services/TraumaService.cs` | Implemented all corruption methods (no WILL mitigation) |
| `RuneAndRust.Engine/Services/StatCalculationService.cs` | Added `CalculateBaseMaxAp()`; updated `RecalculateDerivedStats()` with corruption penalties |
| `RuneAndRust.Engine/Services/CombatService.cs` | Updated `GetViewModel()` to pass corruption to `PlayerStatsView` |
| `RuneAndRust.Terminal/Services/CombatScreenRenderer.cs` | Added corruption bar display with 6-tier dark color scheme |
| `RuneAndRust.Tests/Engine/TraumaServiceTests.cs` | Added 16 corruption tests |

---

### Code Implementation Details

#### CorruptionTier Enum

```csharp
public enum CorruptionTier
{
    Pristine = 0,    // 0-20
    Tainted = 1,     // 21-40
    Corrupted = 2,   // 41-60
    Blighted = 3,    // 61-80
    Fractured = 4,   // 81-99
    Terminal = 5     // 100
}
```

#### CorruptionState Record

```csharp
public record CorruptionState(int Value)
{
    public CorruptionTier Tier => Value switch
    {
        >= 100 => CorruptionTier.Terminal,
        >= 81 => CorruptionTier.Fractured,
        >= 61 => CorruptionTier.Blighted,
        >= 41 => CorruptionTier.Corrupted,
        >= 21 => CorruptionTier.Tainted,
        _ => CorruptionTier.Pristine
    };

    public double MaxApMultiplier => Tier switch
    {
        CorruptionTier.Terminal => 0.0,
        CorruptionTier.Fractured => 0.60,
        CorruptionTier.Blighted => 0.80,
        CorruptionTier.Corrupted => 0.90,
        _ => 1.0
    };

    public int WillPenalty => Tier switch
    {
        CorruptionTier.Terminal => 2,
        CorruptionTier.Fractured => 2,
        CorruptionTier.Blighted => 1,
        _ => 0
    };

    public int WitsPenalty => Tier switch
    {
        CorruptionTier.Terminal => 1,
        CorruptionTier.Fractured => 1,
        _ => 0
    };

    public bool IsTerminal => Tier == CorruptionTier.Terminal;
}
```

#### CorruptionResult Record

```csharp
public record CorruptionResult(
    int RawCorruption,          // Initial corruption amount
    int NetCorruptionApplied,   // Actual corruption added (no mitigation)
    int CurrentTotal,           // New corruption total after application
    CorruptionTier PreviousTier,
    CorruptionTier NewTier,
    bool TierChanged,           // True if tier changed
    bool IsTerminal,            // True if just reached 100
    string Source               // What caused the corruption
);
```

#### ITraumaService Corruption Methods

```csharp
public interface ITraumaService
{
    // ... existing stress methods ...

    #region Corruption Methods (v0.3.0b)
    CorruptionResult AddCorruption(Character character, int amount, string source);
    CorruptionResult AddCorruption(Combatant combatant, int amount, string source);
    CorruptionResult PurgeCorruption(Character character, int amount, string source);
    CorruptionState GetCorruptionState(int corruptionValue);
    void HandleTerminalError(Character character);
    #endregion
}
```

#### Key TraumaService Methods

**AddCorruption (NO mitigation):**
```csharp
public CorruptionResult AddCorruption(Character character, int amount, string source)
{
    // Corruption accumulates directly - NO WILL mitigation
    _logger.LogWarning("{Name} corrupted: +{Amount} (Source: {Source})",
        character.Name, amount, source);

    var previousCorruption = character.Corruption;
    var previousState = GetCorruptionState(previousCorruption);

    // Direct accumulation, clamped to 100
    character.Corruption = Math.Min(100, character.Corruption + amount);

    var newState = GetCorruptionState(character.Corruption);
    var isTerminal = newState.IsTerminal && !previousState.IsTerminal;

    if (isTerminal)
    {
        _logger.LogCritical("TERMINAL ERROR: {Name} reached 100 Corruption. Entity Lost.",
            character.Name);
        HandleTerminalError(character);
    }

    return new CorruptionResult(...);
}
```

#### StatCalculationService Corruption Integration

```csharp
public void RecalculateDerivedStats(Character character)
{
    // Get corruption state for penalty calculations
    var corruptionState = new CorruptionState(character.Corruption);

    var effectiveWill = character.GetEffectiveAttribute(CharacterAttribute.Will);
    var effectiveWits = character.GetEffectiveAttribute(CharacterAttribute.Wits);

    // Apply corruption attribute penalties
    if (corruptionState.WillPenalty > 0)
    {
        effectiveWill = Math.Max(1, effectiveWill - corruptionState.WillPenalty);
    }
    if (corruptionState.WitsPenalty > 0)
    {
        effectiveWits = Math.Max(1, effectiveWits - corruptionState.WitsPenalty);
    }

    // Calculate Max AP with corruption penalty
    var baseMaxAp = CalculateBaseMaxAp(character.Archetype, effectiveWill);
    character.MaxAp = (int)(baseMaxAp * corruptionState.MaxApMultiplier);
}
```

#### Combat Screen Corruption Display

```csharp
// Corruption color mapping based on tier
var corruptionColor = stats.CurrentCorruption switch
{
    >= 100 => "bold white on red",  // Terminal - inverted for emphasis
    >= 81 => "bold red",             // Fractured
    >= 61 => "red",                  // Blighted
    >= 41 => "maroon",               // Corrupted
    >= 21 => "grey",                 // Tainted
    _ => "green"                     // Pristine
};

// Second line for corruption (only show if > 0)
if (stats.CurrentCorruption > 0)
{
    AnsiConsole.MarkupLine(
        $"  [bold darkred]Blight:[/] [{corruptionColor}]{stats.CurrentCorruption}[/] [grey]({corruptionLabel})[/]");
}
```

---

### Architecture

#### Corruption vs Stress Comparison

| Aspect | Stress | Corruption |
|--------|--------|------------|
| Mitigation | WILL roll reduces incoming | None - direct accumulation |
| Recovery | Via rest, abilities | Rare rituals only |
| Effect | Defense penalty | Max AP, WILL, WITS penalties |
| Terminal | Breaking Point (v0.3.0c) | Forlorn (unplayable) |
| Thematic | Psychological strain | Physical/spiritual contamination |

#### Corruption Flow

```
Corruption Source (e.g., Blight creature, dark artifact)
    │
    └─ TraumaService.AddCorruption(target, amount, "Blight Exposure")
          │
          ├─ NO WILL roll - corruption is permanent
          │
          ├─ previousState = GetCorruptionState(current)
          │
          ├─ target.Corruption = Min(100, current + amount)
          │
          ├─ newState = GetCorruptionState(target.Corruption)
          │
          ├─ If newState.IsTerminal && !previousState.IsTerminal
          │     └─ HandleTerminalError(target) - character lost
          │
          └─ Return CorruptionResult with tier changes
```

#### Stat Recalculation with Corruption

```
StatCalculationService.RecalculateDerivedStats(character)
    │
    ├─ corruptionState = new CorruptionState(character.Corruption)
    │
    ├─ Apply WILL penalty (Blighted: -1, Fractured: -2)
    │     └─ effectiveWill = Max(1, baseWill - corruptionState.WillPenalty)
    │
    ├─ Apply WITS penalty (Fractured: -1)
    │     └─ effectiveWits = Max(1, baseWits - corruptionState.WitsPenalty)
    │
    ├─ Calculate Base Max AP
    │     └─ Mystic: 10 + (effectiveWill * 5), Others: 0
    │
    └─ Apply corruption multiplier
          └─ MaxAp = baseMaxAp * corruptionState.MaxApMultiplier
```

---

### Logging Matrix

#### TraumaService Corruption Logs

| Event | Level | Template |
|-------|-------|----------|
| Corruption Added | Warning | `"{Name} corrupted: +{Amount} (Source: {Source})"` |
| Tier Transition | Information | `"{Name} corruption threshold reached: {OldTier} -> {NewTier}"` |
| Penalty Applied | Debug | `"Applied corruption penalty: MaxAP x{Mult}, WILL -{WillPen}, WITS -{WitsPen}"` |
| Terminal Error | Critical | `"TERMINAL ERROR: {Name} reached 100 Corruption. Entity Lost."` |
| Corruption Purged | Information | `"{Name} purged of corruption: -{Amount} (Source: {Source})"` |
| Tier Improved | Information | `"{Name} corruption tier improved: {OldTier} -> {NewTier}"` |
| Non-player Combatant | Debug | `"AddCorruption called on non-player combatant {Name}, updating local state only"` |

#### StatCalculationService Corruption Logs

| Event | Level | Template |
|-------|-------|----------|
| WILL Penalty Applied | Debug | `"Corruption penalty applied to WILL: -{Penalty} (effective: {Effective})"` |
| WITS Penalty Applied | Debug | `"Corruption penalty applied to WITS: -{Penalty} (effective: {Effective})"` |
| MaxAP Penalty Applied | Debug | `"Corruption penalty applied to MaxAP: -{Penalty}% (base: {Base}, final: {Final})"` |

---

### Test Coverage Matrix

#### CorruptionStateTests (48 tests)

| Test Category | Count | Description |
|---------------|-------|-------------|
| Tier Classification | 16 | Boundary tests for all tier thresholds |
| MaxApMultiplier | 12 | Multiplier values for each tier |
| WillPenalty | 8 | WILL penalty values |
| WitsPenalty | 8 | WITS penalty values |
| Terminal Detection | 4 | IsTerminal flag |
| Display Labels | 11 | TierDisplayName for each tier |
| Edge Cases | 2 | Negative and over-100 values |
| Boundary Tests | 5 | Exact boundary transitions |
| Combined Penalties | 4 | Multi-penalty tier verification |

#### TraumaServiceTests Corruption Tests (16 tests)

| Test Name | Category | Validates |
|-----------|----------|-----------|
| `AddCorruption_AccumulatesDirectly_NoMitigation` | Unit | No WILL roll |
| `AddCorruption_ClampsAt100` | Unit | Max corruption cap |
| `AddCorruption_TriggersTerminalAt100` | Unit | Terminal flag |
| `AddCorruption_NoTerminalIfAlreadyAt100` | Unit | No repeat terminal |
| `AddCorruption_TracksTierTransition` | Unit | Tier change tracking |
| `AddCorruption_IgnoresNonPositiveAmounts` | Unit | Zero/negative handling |
| `AddCorruption_Combatant_UpdatesCharacterSource` | Integration | Player sync |
| `AddCorruption_NonPlayerCombatant_OnlyUpdatesLocal` | Integration | Enemy handling |
| `PurgeCorruption_ReducesCorruption` | Unit | Purge math |
| `PurgeCorruption_ClampsAtZero` | Unit | Min corruption cap |
| `PurgeCorruption_TracksTierTransition` | Unit | Tier improvement |
| `PurgeCorruption_NeverTriggersTerminal` | Unit | No terminal on purge |
| `GetCorruptionState_ReturnsCorrectState` | Unit | State factory |

---

### Verification Results

#### Build Output

```
Build succeeded.
    63 Warning(s)
    0 Error(s)
```

#### Test Output

```
Test run for RuneAndRust.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (arm64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:  1638, Skipped:     0, Total:  1638, Duration: 584 ms
```

---

### Directory Structure After Release

```
RuneAndRust.Core/
├── Entities/
│   └── Character.cs                    [MODIFIED - added Corruption, MaxCorruption]
├── Enums/
│   ├── StressStatus.cs                 [v0.3.0a]
│   └── CorruptionTier.cs               [NEW]
├── Interfaces/
│   ├── ITraumaService.cs               [MODIFIED - added corruption methods]
│   └── IStatCalculationService.cs      [MODIFIED - added CalculateBaseMaxAp]
├── Models/Combat/
│   ├── Combatant.cs                    [MODIFIED - added CurrentCorruption, MaxCorruption]
│   ├── StressResult.cs                 [v0.3.0a]
│   ├── CorruptionState.cs              [NEW]
│   └── CorruptionResult.cs             [NEW]
├── ViewModels/
│   └── CombatViewModel.cs              [MODIFIED - added corruption to PlayerStatsView]

RuneAndRust.Engine/Services/
├── TraumaService.cs                    [MODIFIED - added corruption methods]
├── StatCalculationService.cs           [MODIFIED - corruption penalties]
├── CombatService.cs                    [MODIFIED - corruption in GetViewModel]

RuneAndRust.Terminal/
├── Services/
│   └── CombatScreenRenderer.cs         [MODIFIED - corruption bar display]

RuneAndRust.Tests/
├── Core/
│   └── CorruptionStateTests.cs         [NEW - 48 tests]
├── Engine/
│   └── TraumaServiceTests.cs           [MODIFIED - 16 corruption tests]
```

---

### Milestone v0.3.0 Progress

| Sub-version | Feature | Status |
|-------------|---------|--------|
| v0.3.0a | Psychic Stress & Resolve | Complete |
| v0.3.0b | Corruption & Tiers | **Complete** |
| v0.3.0c | Breaking Point & Trauma Selection | Pending |

---

### Next Steps (v0.3.0c)

- Implement Breaking Point event when stress hits 100:
  - Force trauma selection from available options
  - Apply permanent debuffs or quirks
- Create Trauma catalog with selection UI
- Implement Terminal Error full sequence:
  - Lock character as Forlorn
  - Display Terminal Error modal
  - Force return to Main Menu
- Add corruption sources in combat:
  - Blight creature attacks
  - Corrupted artifact usage
  - Failed aether manipulation

---

### Known Limitations

1. **Corruption Sources Not Implemented:** No game events currently inflict corruption
2. **Terminal Error Is Stub:** Reaching 100 corruption logs a critical error but doesn't lock the character
3. **No Purge Mechanics:** PurgeCorruption method exists but nothing calls it yet
4. **Corruption Not Persisted:** Character.Corruption is not saved to database yet
5. **StatCalculationService Dependency:** Corruption penalties only apply when RecalculateDerivedStats is called

---

### Contributors

- Implementation: Claude Opus 4.5

---

## Part C: The Scar (Consequences)

**Release Date**: 2025-12-20

---

### Summary

This release implements the third and final phase of the v0.3.0 Trauma Economy milestone: **Breaking Point Resolution and Permanent Traumas**. When a character's psychic stress reaches 100, they trigger a Breaking Point event that rolls a WILL-based resolve check to determine the outcome - stabilization, trauma acquisition, or catastrophic collapse.

---

### New Features

#### Breaking Point Resolution System
- **WILL-based Resolve Check**: When stress reaches 100, roll WILL dice pool with difficulty 3
  - **Stabilized** (3+ successes): Stress resets to 75, character gains Disoriented status for 2 turns
  - **Trauma** (<3 successes, no fumble): Stress resets to 50, character acquires a random permanent trauma
  - **Catastrophe** (0 successes + botches): Stress resets to 50, character acquires trauma + Stunned status

#### Trauma System
- **Permanent Psychological Scars**: Traumas persist across combat encounters and affect character capabilities
- **4 Trauma Categories**:
  - **Phobias**: Fear-based, triggered by environmental conditions
  - **Somatic**: Physical manifestations with permanent attribute penalties
  - **Delusions**: Distorted perception affecting behavior
  - **Compulsions**: Forced behavioral patterns

#### 10 Starter Traumas

| ID | Name | Type | Effect |
|----|------|------|--------|
| TRM_NYCTO | Nyctophobia | Phobia | +2 stress/turn in dark areas |
| TRM_CLAUSTRO | Claustrophobia | Phobia | +2 stress/turn in confined spaces |
| TRM_HEMATO | Hemophobia | Phobia | +1 stress/turn when blood is drawn |
| TRM_SHAKES | The Shakes | Somatic | Permanent -1 Finesse |
| TRM_MIGRAINES | Chronic Migraines | Somatic | Permanent -1 Wits |
| TRM_FATIGUE | Bone-Deep Exhaustion | Somatic | Permanent -1 Sturdiness |
| TRM_PARANOIA | Paranoia | Delusion | +1 stress when receiving ally effects |
| TRM_VOICES | The Whispers | Delusion | Permanent -1 Will |
| TRM_SELFHARM | Self-Destructive Urges | Compulsion | Triggers at Fractured stress tier |
| TRM_HOARDER | Compulsive Hoarding | Compulsion | +1 stress when discarding items |

#### Status Effects
- **Disoriented** (new): Mental impairment from near-breaking. -1 to all dice pools. Applied when stabilizing from a Breaking Point. Does not stack; reapplication refreshes duration only. Enum value: 4.

---

### Files Created

| File | Purpose | Lines |
|------|---------|-------|
| `Core/Enums/TraumaType.cs` | 4-category trauma classification enum (Phobia, Compulsion, Delusion, Somatic) | ~25 |
| `Core/Enums/BreakingPointOutcome.cs` | Breaking Point resolution outcomes enum (Stabilized, Trauma, Catastrophe) | ~30 |
| `Core/Entities/Trauma.cs` | Persistent trauma entity with Id, DefinitionId, Name, Description, Type, Source, AcquiredAt, IsActive properties | ~45 |
| `Core/Models/Combat/TraumaDefinition.cs` | Trauma template record with AttributePenalties dictionary, StressPerTurnInCondition, TriggerCondition; includes `CreateInstance(source)` factory method | ~42 |
| `Core/Models/Combat/BreakingPointResult.cs` | Breaking Point resolution result record with Outcome, AcquiredTrauma, NewStressLevel, ResolveSuccesses, ResolveBotches, WasStunned, WasDisoriented | ~35 |
| `Engine/Services/TraumaRegistry.cs` | Static registry of 10 starter traumas with `GetRandom()`, `GetById(id)`, `GetByType(type)` methods | ~167 |

---

### Files Modified

#### Core Layer

| File | Change | Details |
|------|--------|---------|
| `Core/Entities/Character.cs` | Added `ActiveTraumas` property | New `List<Trauma>` property in Trauma System region (v0.3.0c) |
| `Core/Enums/StatusEffectType.cs` | Added `Disoriented` status effect | Value 4 in DEBUFFS section, includes XML documentation |
| `Core/Interfaces/ITraumaService.cs` | Added Breaking Point resolution methods | New region with `ResolveBreakingPoint()`, `ApplyTraumaPenalties()`, `GetTraumaAttributePenalty()` |

#### Engine Layer

| File | Change | Details |
|------|--------|---------|
| `Engine/Services/TraumaService.cs` | Implemented Breaking Point resolution | New `#region Breaking Point Resolution (v0.3.0c)` with full WILL-based resolve check logic, trauma acquisition, and attribute penalty application |
| `Engine/Services/TraumaService.cs` | Updated `HandleBreakingPoint()` | Now calls `ResolveBreakingPoint()` for player combatants; non-player combatants reset to stress 75 |
| `Engine/Services/CombatService.cs` | Added `ITraumaService` injection | Constructor parameter added, field stored as `_traumaService` |
| `Engine/Services/CombatService.cs` | Added trauma trigger processing | New `ProcessTraumaTriggers()` method in `#region Trauma System (v0.3.0c)`, called at turn start for player combatants |

#### Test Layer

| File | Change | Details |
|------|--------|---------|
| `Tests/Engine/TraumaServiceTests.cs` | Added 18 new test cases | Two new test regions: `Breaking Point Tests (v0.3.0c)` and `Trauma Registry Tests (v0.3.0c)` |
| `Tests/Engine/TraumaServiceTests.cs` | Updated existing stress tests | `InflictStress_ClampsAt100` and `InflictStress_TriggersBreakingPointAt100` updated for new Breaking Point behavior |
| `Tests/Engine/CombatServiceTests.cs` | Added `ITraumaService` mock | Mock added to constructor call to support new dependency |

---

### Technical Implementation

#### Architecture

```
Breaking Point Cycle:
┌───────────────────┐    ┌──────────────────┐    ┌─────────────────────┐
│  InflictStress()  │───▶│ HandleBreaking   │───▶│ ResolveBreaking     │
│ (Stress hits 100) │    │ Point()          │    │ Point()             │
└───────────────────┘    └──────────────────┘    └─────────────────────┘
                                                           │
                              ┌─────────────────────────────┼─────────────────────────────┐
                              ▼                             ▼                             ▼
                    ┌─────────────────┐           ┌─────────────────┐           ┌─────────────────┐
                    │   STABILIZED    │           │     TRAUMA      │           │   CATASTROPHE   │
                    │ Stress = 75     │           │ Stress = 50     │           │ Stress = 50     │
                    │ + Disoriented   │           │ + Random Trauma │           │ + Trauma        │
                    └─────────────────┘           └─────────────────┘           │ + Stunned       │
                                                                                └─────────────────┘
```

#### Trauma Trigger Processing Flow

```
Turn Start (NextTurn)
    │
    ├── Process DoT damage (StatusEffectService)
    ├── Process trait regeneration (CreatureTraitService)
    ├── Process stamina regeneration (ResourceService)
    ├── Process ability cooldowns (AbilityService)
    │
    └── Process trauma triggers (NEW - v0.3.0c)
            │
            └── For each active trauma with "Always active" trigger:
                    │
                    └── InflictStress(combatant, StressPerTurnInCondition, "Trauma: {Name}")
```

#### Decision Logic

```csharp
public BreakingPointResult ResolveBreakingPoint(Character character, string source)
{
    var willValue = character.GetAttribute(CharacterAttribute.Will);
    var resolveRoll = _dice.Roll(willValue, $"{character.Name} Breaking Point Resolve");

    if (resolveRoll.Successes >= 3)
        outcome = BreakingPointOutcome.Stabilized;   // Stress = 75, +Disoriented
    else if (resolveRoll.Successes == 0 && resolveRoll.Botches > 0)
        outcome = BreakingPointOutcome.Catastrophe;  // Stress = 50, +Trauma, +Stunned
    else
        outcome = BreakingPointOutcome.Trauma;       // Stress = 50, +Trauma
}
```

#### Trauma Definition Structure

```csharp
public record TraumaDefinition(
    string DefinitionId,           // e.g., "TRM_SHAKES"
    string Name,                   // e.g., "The Shakes"
    string Description,            // Narrative flavor text
    TraumaType Type,               // Phobia, Somatic, Delusion, Compulsion
    Dictionary<CharacterAttribute, int> AttributePenalties,  // e.g., {Finesse: -1}
    int StressPerTurnInCondition,  // Passive stress per turn when triggered
    string TriggerCondition        // e.g., "Always active", "In dark areas"
)
{
    public Trauma CreateInstance(string source) => new()
    {
        DefinitionId = DefinitionId,
        Name = Name,
        Description = Description,
        Type = Type,
        Source = source,
        AcquiredAt = DateTime.UtcNow,
        IsActive = true
    };
}
```

#### Attribute Penalty Application

```csharp
public void ApplyTraumaPenalties(Character character, Trauma trauma)
{
    var definition = TraumaRegistry.GetById(trauma.DefinitionId);

    foreach (var penalty in definition.AttributePenalties)
    {
        var currentValue = character.GetAttribute(penalty.Key);
        var newValue = Math.Max(1, currentValue + penalty.Value); // Min 1
        character.SetAttribute(penalty.Key, newValue);
    }
}
```

---

### Logging Matrix

| Event | Level | Template |
|-------|-------|----------|
| Breaking Point triggered | Warning | `"BREAKING POINT: {Name} triggered. Source: {Source}. Rolling WILL resolve check..."` |
| Resolve check rolled | Information | `"Resolve check: {Will}d10 = {Successes} successes, {Botches} botches"` |
| Stabilized outcome | Information | `"{Name} STABILIZED from Breaking Point. Stress reset to 75. Gains Disoriented status."` |
| Trauma outcome | Warning | `"{Name} acquired trauma at Breaking Point: {Trauma}. Stress reset to 50."` |
| Catastrophe outcome | Critical | `"{Name} CATASTROPHE at Breaking Point! Acquired trauma: {Trauma}. Stress reset to 50. Gains Stunned."` |
| Breaking Point resolved | Warning | `"BREAKING POINT RESOLVED: {Target} - Outcome: {Outcome}, New Stress: {Stress}"` |
| Non-player Breaking Point | Warning | `"BREAKING POINT: {Target} (non-player) stress reset to 75"` |
| Penalty applied | Information | `"{Name} trauma penalty applied: {Attribute} {CurrentValue} -> {NewValue} (from {Trauma})"` |
| No definition found | Warning | `"No trauma definition found for {DefinitionId}, skipping penalty application"` |
| Trauma trigger processing | Debug | `"Processing {Count} active traumas for {Name}"` |
| Trauma trigger applied | Debug | `"Trauma trigger: {Trauma} inflicted {Net} stress (Raw: {Raw}, Mitigated: {Mit})"` |

---

### Test Coverage

#### New Tests (18 total)

##### Breaking Point Resolution Tests
- `ResolveBreakingPoint_Stabilized_WhenThreeOrMoreSuccesses` - Verifies 3+ successes → Stabilized, stress=75, Disoriented=true
- `ResolveBreakingPoint_Trauma_WhenFewerThanThreeSuccessesNoBotches` - Verifies <3 successes → Trauma, stress=50, trauma acquired
- `ResolveBreakingPoint_Catastrophe_WhenZeroSuccessesAndBotches` - Verifies 0 successes + botches → Catastrophe, Stunned=true
- `ResolveBreakingPoint_Trauma_NotCatastrophe_WhenZeroSuccessesButNoBotches` - Edge case: 0 successes without botches is Trauma, not Catastrophe
- `ResolveBreakingPoint_AddsTraumaToCharacterActiveTraumas` - Verifies trauma added to character's list with correct source

##### Trauma Penalty Tests
- `ApplyTraumaPenalties_AppliesAttributePenalties` - Verifies Finesse reduced by The Shakes (-1)
- `ApplyTraumaPenalties_ClampsAttributeToMinimumOne` - Verifies attributes never go below 1
- `GetTraumaAttributePenalty_ReturnsTotalPenaltiesForAttribute` - Verifies penalty calculation from active traumas
- `GetTraumaAttributePenalty_IgnoresInactiveTraumas` - Verifies inactive traumas don't contribute to penalties

##### HandleBreakingPoint Integration Tests
- `HandleBreakingPoint_ResolvesBreakingPointForPlayerCombatant` - Verifies full resolution flow for players
- `HandleBreakingPoint_ResetsStressTo75ForNonPlayerCombatant` - Verifies simplified handling for enemies

##### TraumaRegistry Tests
- `TraumaRegistry_HasAllStarterTraumas` - Verifies 10+ traumas registered
- `TraumaRegistry_GetById_ReturnsCorrectTrauma` - Verifies TRM_NYCTO lookup
- `TraumaRegistry_GetById_ReturnsNullForInvalidId` - Verifies null for unknown IDs
- `TraumaRegistry_GetByType_ReturnsMatchingTraumas` - Verifies 3+ Phobia type traumas
- `TraumaRegistry_GetRandom_ReturnsValidTrauma` - Verifies random selection returns valid trauma

##### TraumaDefinition Tests
- `TraumaDefinition_CreateInstance_CreatesValidTrauma` - Verifies factory method creates correct trauma entity

##### Updated Existing Tests
- `InflictStress_ClampsAt100AndTriggersBreakingPoint` - Updated: now expects stress=50 (Trauma outcome)
- `InflictStress_TriggersBreakingPointAt100` - Updated: now expects stress=50 (Trauma outcome)

#### Test Results
```
Passed: 1655 | Failed: 0 | Skipped: 0
Duration: 604ms
```

---

### Integration Notes

#### Combat Service Integration
- `ITraumaService` injected into `CombatService` constructor (12th parameter)
- Trauma triggers processed at turn start after ability cooldowns, before defending stance reset
- Only "Always active" traumas trigger automatically via `ProcessTraumaTriggers()`
- Combat log shows trauma stress application: `"[magenta]{Name}[/] suffers from [grey]{trauma.Name}[/] (+{stress} stress)"`

#### Character Entity
- `ActiveTraumas` list persists with character (new region: Trauma System v0.3.0c)
- Traumas applied via `TraumaDefinition.CreateInstance(source)` factory method
- Attribute penalties applied immediately upon trauma acquisition

#### Combatant Sync
- `HandleBreakingPoint()` syncs stress from `CharacterSource.PsychicStress` back to `Combatant.CurrentStress`
- Non-player combatants (enemies) reset to 75 without trauma mechanics

---

### Design Decisions

#### Why Stress Resets Differ (75 vs 50)
- **Stabilized (75)**: Character barely held on; still fragile but functional
- **Trauma/Catastrophe (50)**: Mental break occurred; character is recovering but scarred

#### Why Random Trauma Selection
- Mirrors unpredictable nature of psychological breaks
- Future enhancement: weighted selection based on combat context

#### Why Attribute Minimum of 1
- Prevents characters from becoming completely non-functional
- Aligns with D10 dice pool minimum (always roll at least 1 die)

#### Phobia vs Somatic Design
- **Phobias**: Conditional stress accumulation (environmental triggers)
- **Somatic**: Permanent attribute penalties (always active)
- This split creates meaningful gameplay variety

---

### Known Limitations

1. **Environmental Triggers**: Phobia triggers (dark areas, confined spaces) require environment system integration (future version)
2. **Combat-Specific Triggers**: Hemophobia and similar triggers require damage event hooks (future version)
3. **Disoriented Status**: Status effect enum exists but dice pool penalty not yet wired into roll mechanics
4. **Stunned Application**: Breaking Point returns `WasStunned` flag but status effect not automatically applied to combatant
5. **Trauma Removal**: No mechanism to cure or remove traumas (intentional for v0.3.0c - traumas are permanent scars)

---

### Milestone Status

**v0.3.0 Trauma Economy: COMPLETE**

| Phase | Feature | Status | Tests Added |
|-------|---------|--------|-------------|
| v0.3.0a | Psychic Stress + Resolve Checks | Complete | 28 |
| v0.3.0b | Corruption + Tier System | Complete | 28 |
| v0.3.0c | Breaking Point + Traumas | Complete | 18 |
| **Total** | | | **74 tests** |

---

### Directory Structure

```
RuneAndRust.Core/
├── Entities/
│   ├── Character.cs          [MODIFIED - ActiveTraumas]
│   └── Trauma.cs              [NEW]
├── Enums/
│   ├── BreakingPointOutcome.cs [NEW]
│   ├── StatusEffectType.cs    [MODIFIED - Disoriented]
│   └── TraumaType.cs          [NEW]
├── Interfaces/
│   └── ITraumaService.cs      [MODIFIED - Breaking Point methods]
└── Models/Combat/
    ├── BreakingPointResult.cs [NEW]
    └── TraumaDefinition.cs    [NEW]

RuneAndRust.Engine/
└── Services/
    ├── CombatService.cs       [MODIFIED - ITraumaService, ProcessTraumaTriggers]
    ├── TraumaRegistry.cs      [NEW]
    └── TraumaService.cs       [MODIFIED - Breaking Point implementation]

RuneAndRust.Tests/
└── Engine/
    ├── CombatServiceTests.cs  [MODIFIED - ITraumaService mock]
    └── TraumaServiceTests.cs  [MODIFIED - 18 new tests]
```

---

### Related Documentation

- [v0.3.0a Changelog](v0.3.0a.md) - Psychic Stress System
- [v0.3.0b Changelog](v0.3.0b.md) - Corruption & Tiers

---

## Final Notes

The v0.3.0 Trauma Economy milestone is now complete, establishing a comprehensive mental health and corruption system for Rune & Rust. This system creates meaningful consequences for player actions, encourages strategic play, and adds permanent character progression (both positive and negative) beyond simple stat increases.

Future enhancements may include:
- Environmental trigger system for phobia-type traumas
- Trauma therapy mechanics (rare, expensive, but possible)
- Corruption purging rituals and artifacts
- Additional traumas based on combat context
- Database persistence for stress, corruption, and traumas
- Visual/audio feedback for tier transitions
