# v0.20.5a Design Specification: Berserkr Framework & Tier 1 Abilities

**Version:** 0.20.5a
**Phase Name:** Framework & Tier 1 Abilities
**Parent Version:** v0.20.5 (Berserkr Specialization)
**Prerequisites:** v0.20.4 Complete (Myrk-gengr Specialization)
**Estimated Tests:** ~10 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Overview](#3-architecture-overview)
4. [RageResource Value Object](#4-rageresource-value-object)
5. [RageThreshold Value Object](#5-ragethreshold-value-object)
6. [BloodiedState Value Object](#6-bloodiedstate-value-object)
7. [FuryStrikeResult Value Object](#7-furystrike-result-value-object)
8. [Domain Enums](#8-domain-enums)
9. [RageService Implementation](#9-rageservice-implementation)
10. [BerserkrAbilityService Implementation](#10-berserkrabilityservice-implementation)
11. [BerserkrCorruptionService Implementation](#11-berserkrcorruptionservice-implementation)
12. [Character Integration](#12-character-integration)
13. [Tier 1 Abilities](#13-tier-1-abilities)
14. [Data Model Changes](#14-data-model-changes)
15. [Configuration File Schemas](#15-configuration-file-schemas)
16. [Combat Flow & Interactions](#16-combat-flow--interactions)
17. [Logging Specifications](#17-logging-specifications)
18. [Unit Testing Requirements](#18-unit-testing-requirements)
19. [Acceptance Criteria](#19-acceptance-criteria)
20. [Dependencies & Prerequisites](#20-dependencies--prerequisites)

---

## 1. Executive Summary

### 1.1 Purpose

This specification establishes the foundational framework for the Berserkr specialization — the fury-powered warrior of the Heretical path. v0.20.5a implements the Rage resource system, Heretical Corruption integration, and three Tier 1 abilities (Fury Strike, Blood Scent, Pain is Fuel) that form the core berserker identity.

As the second Heretical specialization, Berserkr extends the Corruption patterns established by Myrk-gengr (v0.20.4) with combat-focused triggers centered around high Rage levels (80+). This phase establishes:

- **Rage Resource**: 0-100 point resource that builds through combat and powers devastating abilities
- **Corruption Integration**: Combat escalation triggers at 80+ Rage via IBerserkrCorruptionService
- **Tier 1 Foundation**: Three abilities that embody the Berserkr's core mechanics

### 1.2 Key Deliverables

| Category | Count | Items |
|----------|-------|-------|
| **Domain Value Objects** | 4 | RageResource, RageThreshold, BloodiedState, FuryStrikeResult |
| **Domain Enums** | 3 | BerserkrAbilityId, RageLevel, BerserkrCorruptionTrigger |
| **Application Interfaces** | 3 | IRageService, IBerserkrAbilityService, IBerserkrCorruptionService |
| **Application Services** | 3 | RageService, BerserkrAbilityService, BerserkrCorruptionService |
| **Ability Implementations** | 3 | Fury Strike, Blood Scent, Pain is Fuel |
| **Configuration** | 2 | specializations.json, abilities.json |
| **Tests** | ~10 | Unit tests across all services |

### 1.3 Architectural Significance

This version establishes the **Berserkr Combat Escalation Pattern**:

- **Resource-Driven Escalation**: Rage builds naturally through combat and powers increasingly dangerous abilities
- **Risk-Reward Mechanics**: Higher Rage = more power but greater Corruption risk
- **Passive Fury Generation**: Blood Scent and Pain is Fuel grant automatic Rage outside the ability system
- **Heretical Corruption Pattern**: Extends v0.20.4 Corruption service patterns with combat thresholds
- **Threshold-Based Mechanics**: Rage level (80+) determines Corruption triggers and ability effectiveness

---

## 2. Feature Overview

```
v0.20.5a Berserkr Framework & Tier 1
├── RageResource (Special Resource)
│   ├── Current/Max Rage (0-100)
│   ├── Rage Level Classification (Calm→Berserk)
│   ├── Spend(amount) → bool
│   ├── Gain(amount, source) → void
│   ├── GainFromDamage(amount) → void (Pain is Fuel)
│   ├── GainFromBloodied() → void (Blood Scent)
│   ├── IsEnraged → bool (80+)
│   ├── GetRageLevel() → RageLevel
│   └── DecayOutOfCombat() → void
├── RageThreshold (Value Object)
│   ├── Level: RageLevel
│   ├── MinimumRage: int
│   ├── EffectDescription: string
│   ├── CorruptionRisk: int
│   └── Methods for threshold validation
├── BloodiedState (Value Object)
│   ├── TargetId, TargetName
│   ├── CurrentHp, MaxHp
│   ├── IsBloodied (computed: ≤50% HP)
│   ├── CheckBloodied() → bool
│   └── WasJustBloodied(previousHp) → bool
├── FuryStrikeResult (Value Object)
│   ├── AttackRoll, BaseDamage, FuryDamage, TotalDamage
│   ├── RageSpent, WasCritical, CorruptionTriggered
│   └── GetDamageBreakdown() → string
├── Domain Enums
│   ├── BerserkrAbilityId (all 9 abilities)
│   ├── RageLevel (Calm→Berserk)
│   └── BerserkrCorruptionTrigger (combat entry, ability, etc.)
├── IRageService (Interface)
│   ├── GetRage(characterId) → RageResource
│   ├── AddRage(characterId, amount, source) → void
│   ├── SpendRage(characterId, amount) → bool
│   ├── DecayRageOutOfCombat(characterId) → void
│   └── ResetRage(characterId) → void
├── IBerserkrAbilityService (Interface)
│   ├── UseFuryStrike(characterId, targetId) → FuryStrikeResult
│   ├── CheckBloodScent(targetId) → bool
│   ├── CheckPainIsFuel(characterId, damageReceived) → void
│   └── GetAbilityReadiness(characterId, abilityId) → AbilityReadiness
├── IBerserkrCorruptionService (Interface)
│   ├── EvaluateRisk(ability, currentRage, targetIsCoherent) → CorruptionRiskResult
│   ├── ApplyCorruption(characterId, risk) → void
│   ├── CheckCombatEntryRisk(currentRage) → CorruptionRiskResult
│   └── GetTriggerDescription(trigger) → string
├── Tier 1 Abilities
│   ├── Fury Strike (Attack)
│   │   ├── 2 AP, 20 Rage cost
│   │   ├── Weapon damage + 3d6 fury damage
│   │   ├── +1 Corruption at 80+ Rage
│   │   └── On crit: +1d6 bonus damage
│   ├── Blood Scent (Passive)
│   │   ├── Trigger: Enemy becomes bloodied (≤50% HP)
│   │   ├── Effect: +10 Rage, +1 attack vs bloodied
│   │   └── No Corruption risk
│   └── Pain is Fuel (Passive)
│       ├── Trigger: Take damage from any source
│       ├── Effect: +5 Rage per instance
│       └── No Corruption risk
└── Integration Points
    ├── CorruptionService (v0.18.x)
    ├── IShadowCorruptionService pattern (v0.20.4)
    ├── Character entity (Rage property)
    └── Combat system (damage/bloodied triggers)
```

---

## 3. Architecture Overview

### 3.1 Layered Architecture

```
┌────────────────────────────────────────────────────────────┐
│             v0.20.5a Berserkr Framework                     │
├────────────────────────────────────────────────────────────┤
│  Presentation Layer (Commands/Output)                       │
│  > ability fury-strike <target>                             │
│  > status (shows Rage bar)                                  │
└────────────────────┬─────────────────────────────────────────┘
                     │
┌────────────────────▼─────────────────────────────────────────┐
│  Application Layer (Services)                                │
│  ┌─────────────────┐ ┌──────────────┐ ┌─────────────────┐   │
│  │ RageService     │ │ BerserkrAb   │ │ BerserkrCorrupt │   │
│  │                 │ │ ilityService │ │ ionService      │   │
│  └────────┬────────┘ └──────┬───────┘ └────────┬────────┘   │
│           │                 │                   │             │
│           └─────────────────┼───────────────────┘             │
│                             │                                 │
│                       Uses IShadowCorruptionService           │
│                       (from v0.20.4)                          │
└─────────────────────────────┬────────────────────────────────┘
                              │
┌─────────────────────────────▼────────────────────────────────┐
│  Domain Layer (Value Objects & Entities)                     │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐          │
│  │ RageResource │ │ RageThreshold│ │ BloodiedState│          │
│  └──────────────┘ └──────────────┘ └──────────────┘          │
│                                                               │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐          │
│  │FuryStrike    │ │BerserkrAb    │ │RageLevel     │          │
│  │Result        │ │ilityId       │ │Enum          │          │
│  └──────────────┘ └──────────────┘ └──────────────┘          │
│                                                               │
│  Extend Character entity with: Rage: RageResource?           │
└────────────────────────────────────────────────────────────────┘
```

### 3.2 Service Interaction Flow

```
Combat Damage Event
        │
        ▼
[Pain is Fuel] (Passive Check)
        │
        ├─► Trigger: Damage ≥ 0 (must be hit)
        │
        ├─► RageService.AddRage(+5, "Pain is Fuel")
        │
        └─► If Rage becomes 80+:
            BerserkrCorruptionService.CheckThreshold()
                │
                └─► Potential +1 Corruption (depends on ability)

Enemy HP Drop to ≤50%
        │
        ▼
[Blood Scent] (Passive Check)
        │
        ├─► Trigger: Enemy enters bloodied state
        │
        ├─► RageService.AddRage(+10, "Blood Scent")
        │
        └─► No immediate Corruption risk

Fury Strike Usage
        │
        ├─► Check: Rage ≥ 20?
        │
        ├─► BerserkrAbilityService.UseFuryStrike()
        │   │
        │   ├─► Make weapon attack
        │   │
        │   ├─► Apply +3d6 damage
        │   │
        │   ├─► RageService.SpendRage(-20)
        │   │
        │   └─► Check Corruption:
        │       If Rage was ≥ 80:
        │           BerserkrCorruptionService.ApplyCorruption(+1)
        │
        └─► Return FuryStrikeResult
```

---

## 4. RageResource Value Object

### 4.1 Definition

```csharp
/// <summary>
/// Special resource for Berserkr specialization.
/// Rage builds through combat (damage taken, enemies bloodied) and powers
/// devastating fury abilities. At 80+ Rage, using abilities risks Corruption.
/// </summary>
public sealed record RageResource
{
    /// <summary>
    /// Current Rage points. Range: 0-100.
    /// </summary>
    public int CurrentRage { get; private set; }

    /// <summary>
    /// Maximum Rage capacity. Default: 100.
    /// </summary>
    public int MaxRage { get; init; } = 100;

    /// <summary>
    /// DateTime when Rage was last gained.
    /// </summary>
    public DateTime? LastGainedAt { get; private set; }

    /// <summary>
    /// Source of the last Rage gain (e.g., "Pain is Fuel", "Blood Scent").
    /// </summary>
    public string? GainSource { get; private set; }

    /// <summary>
    /// True if Rage is at or above the Corruption risk threshold (80).
    /// </summary>
    public bool IsEnraged => CurrentRage >= 80;

    /// <summary>
    /// True if Rage is at maximum (100), enabling Capstone ability.
    /// </summary>
    public bool IsMaximum => CurrentRage >= MaxRage;

    /// <summary>
    /// Spends the specified amount of Rage.
    /// </summary>
    /// <param name="amount">Rage to spend (must be positive).</param>
    /// <returns>True if Rage was sufficient; false otherwise.</returns>
    /// <remarks>
    /// On success, CurrentRage is reduced by amount.
    /// On failure, no Rage is spent (atomic operation).
    /// </remarks>
    public bool Spend(int amount)
    {
        if (amount <= 0 || CurrentRage < amount)
            return false;

        CurrentRage -= amount;
        return true;
    }

    /// <summary>
    /// Gains the specified amount of Rage with source attribution.
    /// </summary>
    /// <param name="amount">Rage to gain (must be positive).</param>
    /// <param name="source">Source identifier (e.g., "Pain is Fuel").</param>
    /// <remarks>
    /// Rage is capped at MaxRage. Tracks LastGainedAt and GainSource.
    /// </remarks>
    public void Gain(int amount, string source)
    {
        if (amount <= 0) return;

        CurrentRage = Math.Min(CurrentRage + amount, MaxRage);
        LastGainedAt = DateTime.UtcNow;
        GainSource = source;
    }

    /// <summary>
    /// Gains Rage from taking damage (triggered by Pain is Fuel passive).
    /// </summary>
    /// <param name="damageReceived">Damage received (0+ valid; -1 or less invalid).</param>
    /// <remarks>
    /// Always grants 5 Rage if damageReceived >= 0, even if damage was absorbed.
    /// This represents the Berserkr's fury from being attacked.
    /// </remarks>
    public void GainFromDamage(int damageReceived)
    {
        if (damageReceived >= 0) // 0 damage is valid if attack hit
            Gain(5, "Pain is Fuel");
    }

    /// <summary>
    /// Gains Rage from an enemy being bloodied (triggered by Blood Scent passive).
    /// </summary>
    /// <remarks>
    /// Grants 10 Rage when an enemy drops to 50% HP or below.
    /// </remarks>
    public void GainFromBloodied()
    {
        Gain(10, "Blood Scent");
    }

    /// <summary>
    /// Gets the current Rage level classification.
    /// </summary>
    /// <returns>RageLevel enumeration value.</returns>
    public RageLevel GetRageLevel()
    {
        return CurrentRage switch
        {
            100 => RageLevel.Berserk,
            >= 80 => RageLevel.Enraged,
            >= 60 => RageLevel.Furious,
            >= 40 => RageLevel.Angry,
            >= 20 => RageLevel.Irritated,
            _ => RageLevel.Calm
        };
    }

    /// <summary>
    /// Checks if Rage is at or above a specific threshold level.
    /// </summary>
    /// <param name="level">RageLevel to check.</param>
    /// <returns>True if current Rage meets or exceeds the threshold.</returns>
    public bool IsAtThreshold(RageLevel level)
    {
        return level switch
        {
            RageLevel.Berserk => CurrentRage >= 100,
            RageLevel.Enraged => CurrentRage >= 80,
            RageLevel.Furious => CurrentRage >= 60,
            RageLevel.Angry => CurrentRage >= 40,
            RageLevel.Irritated => CurrentRage >= 20,
            RageLevel.Calm => true, // Always at least Calm
            _ => false
        };
    }

    /// <summary>
    /// Decays Rage out of combat (per minute passed without taking damage).
    /// </summary>
    /// <remarks>
    /// Out of combat Rage decay represents the Berserkr losing focus.
    /// Decay per minute: 10 Rage (minimum 0).
    /// </remarks>
    public void DecayOutOfCombat()
    {
        CurrentRage = Math.Max(0, CurrentRage - 10);
    }

    /// <summary>
    /// Gets a human-readable Rage status string.
    /// </summary>
    /// <returns>String like "45/100 [ANGRY]".</returns>
    public string GetStatusString()
    {
        var level = GetRageLevel();
        return $"{CurrentRage}/{MaxRage} [{level}]";
    }

    /// <summary>
    /// Gets the Rage bar as a visual string for UI display.
    /// </summary>
    /// <param name="barLength">Length of bar (default 20).</param>
    /// <returns>Visual bar string like "████████░░░░░░░░░░".</returns>
    public string GetRageBar(int barLength = 20)
    {
        int filled = (CurrentRage * barLength) / MaxRage;
        var bar = new string('█', filled) + new string('░', barLength - filled);
        return bar;
    }
}
```

### 4.2 Rage Generation & Consumption Summary

| Action | Effect | Source |
|--------|--------|--------|
| Take damage (any amount) | Gain 5 Rage | Pain is Fuel passive |
| Enemy becomes bloodied (≤50% HP) | Gain 10 Rage | Blood Scent passive |
| Death Defiance triggers | Gain 20 Rage | Death Defiance passive (v0.20.5c) |
| Fury Strike usage | Spend 20 Rage | Active ability |
| Unstoppable usage | Spend 15 Rage | Active ability (v0.20.5b) |
| Intimidating Presence usage | Spend 10 Rage | Active ability (v0.20.5b) |
| Fury of the Forlorn usage | Spend 30 Rage | Active ability (v0.20.5c) |
| Avatar of Destruction usage | Spend all (requires 100) | Capstone (v0.20.5c) |
| Out of combat (per minute) | Lose 10 Rage | Passive decay |
| Short rest | Reset to 0 | Rest mechanic |
| Long rest | Reset to 0 | Rest mechanic |

---

## 5. RageThreshold Value Object

### 5.1 Definition

```csharp
/// <summary>
/// Represents a threshold of Rage level with associated effects and risks.
/// </summary>
public sealed record RageThreshold
{
    /// <summary>
    /// The Rage level this threshold represents.
    /// </summary>
    public RageLevel Level { get; init; }

    /// <summary>
    /// Minimum Rage value to be at this level.
    /// </summary>
    public int MinimumRage { get; init; }

    /// <summary>
    /// Description of effects at this Rage level.
    /// </summary>
    public string EffectDescription { get; init; }

    /// <summary>
    /// Corruption risk per use of ability at this Rage level.
    /// </summary>
    public int CorruptionRisk { get; init; }

    /// <summary>
    /// Checks if the given Rage value meets this threshold.
    /// </summary>
    public bool IsMet(int currentRage) => currentRage >= MinimumRage;

    /// <summary>
    /// Gets a human-readable description of the threshold and its effects.
    /// </summary>
    public string GetDescription()
    {
        return $"{Level}: {MinimumRage}+ Rage - {EffectDescription}";
    }

    /// <summary>
    /// Gets a warning string about Corruption risk at this threshold.
    /// </summary>
    public string GetCorruptionWarning()
    {
        if (CorruptionRisk == 0)
            return "No Corruption risk";

        return CorruptionRisk switch
        {
            1 => "Using abilities risks +1 Corruption",
            2 => "WARNING: Using Capstone risks +2 Corruption",
            _ => $"WARNING: +{CorruptionRisk} Corruption risk"
        };
    }

    /// <summary>
    /// Static factory method to create standard Rage thresholds.
    /// </summary>
    public static RageThreshold[] CreateStandardThresholds() => new[]
    {
        new RageThreshold
        {
            Level = RageLevel.Calm,
            MinimumRage = 0,
            EffectDescription = "No special effects",
            CorruptionRisk = 0
        },
        new RageThreshold
        {
            Level = RageLevel.Irritated,
            MinimumRage = 20,
            EffectDescription = "Minor bonus to attack (+1)",
            CorruptionRisk = 0
        },
        new RageThreshold
        {
            Level = RageLevel.Angry,
            MinimumRage = 40,
            EffectDescription = "Moderate bonus to attack (+2)",
            CorruptionRisk = 0
        },
        new RageThreshold
        {
            Level = RageLevel.Furious,
            MinimumRage = 60,
            EffectDescription = "Significant bonus to attack (+3)",
            CorruptionRisk = 0
        },
        new RageThreshold
        {
            Level = RageLevel.Enraged,
            MinimumRage = 80,
            EffectDescription = "Maximum power (+4 attack), Corruption risk!",
            CorruptionRisk = 1
        },
        new RageThreshold
        {
            Level = RageLevel.Berserk,
            MinimumRage = 100,
            EffectDescription = "Capstone available, extreme Corruption risk!",
            CorruptionRisk = 2
        }
    };
}
```

---

## 6. BloodiedState Value Object

### 6.1 Definition

```csharp
/// <summary>
/// Represents the bloodied state of an enemy (at or below 50% HP).
/// Used to track Blood Scent passive ability triggers.
/// </summary>
public sealed record BloodiedState
{
    /// <summary>
    /// ID of the bloodied target.
    /// </summary>
    public Guid TargetId { get; init; }

    /// <summary>
    /// Name of the target for UI display.
    /// </summary>
    public string TargetName { get; init; }

    /// <summary>
    /// Current HP of the target.
    /// </summary>
    public int CurrentHp { get; init; }

    /// <summary>
    /// Maximum HP of the target.
    /// </summary>
    public int MaxHp { get; init; }

    /// <summary>
    /// DateTime when this target became bloodied.
    /// </summary>
    public DateTime BloodiedAt { get; init; }

    /// <summary>
    /// Computed property: true if CurrentHp <= MaxHp / 2.
    /// </summary>
    public bool IsBloodied => CurrentHp <= (MaxHp / 2);

    /// <summary>
    /// Gets the bloodied percentage (0-100).
    /// </summary>
    /// <returns>Percentage of max HP (0 = dead, 50 = bloodied, 100 = full).</returns>
    public float GetBloodiedPercentage()
    {
        return MaxHp > 0 ? (CurrentHp * 100f) / MaxHp : 0f;
    }

    /// <summary>
    /// Checks if this target is in bloodied state.
    /// </summary>
    public bool CheckBloodied()
    {
        return IsBloodied;
    }

    /// <summary>
    /// Determines if this target was just bloodied (transition from >50% to ≤50%).
    /// </summary>
    /// <param name="previousHp">HP before the last damage event.</param>
    /// <returns>True if target crossed the bloodied threshold.</returns>
    public bool WasJustBloodied(int previousHp)
    {
        int bloodiedThreshold = MaxHp / 2;
        return previousHp > bloodiedThreshold && CurrentHp <= bloodiedThreshold;
    }

    /// <summary>
    /// Gets a description of the bloodied state.
    /// </summary>
    public string GetDescription()
    {
        return $"{TargetName}: {CurrentHp}/{MaxHp} HP ({GetBloodiedPercentage():F1}%) {(IsBloodied ? "[BLOODIED]" : "")}";
    }
}
```

---

## 7. FuryStrike Result Value Object

### 7.1 Definition

```csharp
/// <summary>
/// Result of a Fury Strike ability usage, containing attack and damage data.
/// </summary>
public sealed record FuryStrikeResult
{
    /// <summary>
    /// The attack roll (1-20 + modifiers).
    /// </summary>
    public int AttackRoll { get; init; }

    /// <summary>
    /// Base weapon damage dealt.
    /// </summary>
    public int BaseDamage { get; init; }

    /// <summary>
    /// Fury bonus damage (3d6 roll).
    /// </summary>
    public int FuryDamage { get; init; }

    /// <summary>
    /// Total damage before critical bonuses.
    /// </summary>
    public int TotalDamage => BaseDamage + FuryDamage;

    /// <summary>
    /// Critical hit bonus damage (+1d6 if crit).
    /// </summary>
    public int CriticalBonusDamage { get; init; }

    /// <summary>
    /// Total damage including critical bonus.
    /// </summary>
    public int FinalDamage => TotalDamage + CriticalBonusDamage;

    /// <summary>
    /// Rage spent for this ability (20).
    /// </summary>
    public int RageSpent { get; init; } = 20;

    /// <summary>
    /// Whether this attack was a critical hit (nat 20).
    /// </summary>
    public bool WasCritical { get; init; }

    /// <summary>
    /// Whether Corruption was triggered by using at 80+ Rage.
    /// </summary>
    public bool CorruptionTriggered { get; init; }

    /// <summary>
    /// Reason for Corruption trigger (if any).
    /// </summary>
    public string? CorruptionReason { get; init; }

    /// <summary>
    /// Gets a formatted damage breakdown string.
    /// </summary>
    /// <returns>String like "7 (weapon) + 12 (3d6 fury) + 4 (crit) = 23 total".</returns>
    public string GetDamageBreakdown()
    {
        var parts = new List<string>
        {
            $"{BaseDamage} (weapon)",
            $"{FuryDamage} (3d6 fury)"
        };

        if (CriticalBonusDamage > 0)
            parts.Add($"{CriticalBonusDamage} (crit)");

        return string.Join(" + ", parts) + $" = {FinalDamage} total";
    }

    /// <summary>
    /// Gets a human-readable result string for combat log.
    /// </summary>
    public string GetResultString(string targetName)
    {
        var critText = WasCritical ? " [CRITICAL]" : "";
        var corruptText = CorruptionTriggered ? " [+1 CORRUPTION]" : "";

        return $"Attack Roll: {AttackRoll} | {GetDamageBreakdown()}{critText}{corruptText}";
    }
}
```

---

## 8. Domain Enums

### 8.1 RageLevel Enum

```csharp
/// <summary>
/// Classification of Rage level with associated thresholds and effects.
/// </summary>
public enum RageLevel
{
    /// <summary>Calm (0-19 Rage): No special effects. Default state out of combat.</summary>
    Calm = 0,

    /// <summary>Irritated (20-39 Rage): Minor bonuses, starting to feel the fury.</summary>
    Irritated = 1,

    /// <summary>Angry (40-59 Rage): Moderate bonuses, combat intensifying.</summary>
    Angry = 2,

    /// <summary>Furious (60-79 Rage): Significant bonuses, approaching peak fury.</summary>
    Furious = 3,

    /// <summary>Enraged (80-99 Rage): Maximum power, but high Corruption risk.</summary>
    Enraged = 4,

    /// <summary>Berserk (100 Rage): Peak fury, enables Capstone, extreme Corruption risk.</summary>
    Berserk = 5
}
```

### 8.2 BerserkrAbilityId Enum

```csharp
/// <summary>
/// Enumeration of all Berserkr specialization abilities across all tiers.
/// </summary>
public enum BerserkrAbilityId
{
    // Tier 1 (v0.20.5a)
    /// <summary>Tier 1 Attack: Weapon damage + 3d6 fury, costs 20 Rage.</summary>
    FuryStrike = 1,

    /// <summary>Tier 1 Passive: Gain 10 Rage when enemy becomes bloodied.</summary>
    BloodScent = 2,

    /// <summary>Tier 1 Passive: Gain 5 Rage when taking damage.</summary>
    PainIsFuel = 3,

    // Tier 2 (v0.20.5b)
    /// <summary>Tier 2 Stance: +4 Attack, -2 Defense, bonus scales with Rage.</summary>
    RecklessAssault = 4,

    /// <summary>Tier 2 Active: Ignore movement penalties for 2 turns, costs 15 Rage.</summary>
    Unstoppable = 5,

    /// <summary>Tier 2 Active: Force save against fear effect, -2 Attack if failed, costs 10 Rage.</summary>
    IntimidatingPresence = 6,

    // Tier 3 (v0.20.5c)
    /// <summary>Tier 3 Active: Cleave attack hitting all adjacent enemies, requires 80+ Rage, costs 30 Rage.</summary>
    FuryOfTheForlorn = 7,

    /// <summary>Tier 3 Passive: Prevent death once per combat, stay at 1 HP instead.</summary>
    DeathDefiance = 8,

    // Capstone (v0.20.5c)
    /// <summary>Capstone Ultimate: Double damage for 2 turns, CC immune, requires 100 Rage, +2 Corruption.</summary>
    AvatarOfDestruction = 9
}
```

### 8.3 BerserkrCorruptionTrigger Enum

```csharp
/// <summary>
/// Enumeration of situations that trigger Corruption for Berserkr.
/// </summary>
public enum BerserkrCorruptionTrigger
{
    /// <summary>Starting combat while at 80+ Rage.</summary>
    EnterCombatEnraged = 1,

    /// <summary>Using any ability while at 80+ Rage.</summary>
    AbilityWhileEnraged = 2,

    /// <summary>Using Fury Strike at 80+ Rage.</summary>
    FuryStrikeWhileEnraged = 3,

    /// <summary>Using Unstoppable at 80+ Rage.</summary>
    UnstoppableWhileEnraged = 4,

    /// <summary>Using Intimidating Presence against Coherent target.</summary>
    IntimidatingCoherentTarget = 5,

    /// <summary>Using Fury of the Forlorn (always triggers, requires 80+ Rage).</summary>
    FuryOfTheForlornUsage = 6,

    /// <summary>Using Avatar of Destruction Capstone.</summary>
    CapstoneActivation = 7,

    /// <summary>Killing a Coherent-aligned creature while at 80+ Rage.</summary>
    KillCoherentEnraged = 8,

    /// <summary>Maintaining 100 Rage for extended period (future mechanic).</summary>
    SustainedBerserkRage = 9
}
```

---

## 9. RageService Implementation

### 9.1 Interface Definition

```csharp
/// <summary>
/// Service for managing Rage resource for Berserkr characters.
/// </summary>
public interface IRageService
{
    /// <summary>
    /// Gets the Rage resource for a character.
    /// </summary>
    /// <param name="characterId">Character ID.</param>
    /// <returns>RageResource or null if character has no Rage.</returns>
    RageResource? GetRage(Guid characterId);

    /// <summary>
    /// Adds Rage to a character.
    /// </summary>
    /// <param name="characterId">Character ID.</param>
    /// <param name="amount">Amount to add (positive).</param>
    /// <param name="source">Source identifier for tracking.</param>
    void AddRage(Guid characterId, int amount, string source);

    /// <summary>
    /// Attempts to spend Rage.
    /// </summary>
    /// <param name="characterId">Character ID.</param>
    /// <param name="amount">Amount to spend (positive).</param>
    /// <returns>True if Rage was sufficient; false otherwise.</returns>
    bool SpendRage(Guid characterId, int amount);

    /// <summary>
    /// Applies out-of-combat Rage decay.
    /// </summary>
    /// <param name="characterId">Character ID.</param>
    /// <remarks>Called periodically (e.g., per minute out of combat).</remarks>
    void DecayRageOutOfCombat(Guid characterId);

    /// <summary>
    /// Resets Rage to 0 (e.g., on rest or combat end).
    /// </summary>
    /// <param name="characterId">Character ID.</param>
    void ResetRage(Guid characterId);

    /// <summary>
    /// Gets all characters currently at 80+ Rage (Enraged).
    /// </summary>
    /// <returns>IEnumerable of Guids for enraged characters.</returns>
    IEnumerable<Guid> GetEnragedCharacters();
}
```

### 9.2 Implementation Details

```csharp
/// <summary>
/// Implementation of IRageService.
/// </summary>
public class RageService : IRageService
{
    private readonly Dictionary<Guid, RageResource> _characterRage;
    private readonly ILogger<RageService> _logger;

    public RageService(ILogger<RageService> logger)
    {
        _characterRage = new Dictionary<Guid, RageResource>();
        _logger = logger;
    }

    public RageResource? GetRage(Guid characterId)
    {
        if (_characterRage.TryGetValue(characterId, out var rage))
        {
            return rage;
        }
        return null;
    }

    public void AddRage(Guid characterId, int amount, string source)
    {
        if (!_characterRage.TryGetValue(characterId, out var rage))
        {
            rage = new RageResource();
            _characterRage[characterId] = rage;
        }

        var previousRage = rage.CurrentRage;
        rage.Gain(amount, source);

        _logger.LogInformation(
            "Character {CharacterId} gained {Amount} Rage ({Source}): {Previous} → {Current}",
            characterId, amount, source, previousRage, rage.CurrentRage);

        // Check if crossed Enraged threshold
        if (previousRage < 80 && rage.IsEnraged)
        {
            _logger.LogWarning(
                "Character {CharacterId} entered ENRAGED state at {Rage} Rage!",
                characterId, rage.CurrentRage);
        }
    }

    public bool SpendRage(Guid characterId, int amount)
    {
        if (!_characterRage.TryGetValue(characterId, out var rage))
            return false;

        var spent = rage.Spend(amount);
        if (spent)
        {
            _logger.LogInformation(
                "Character {CharacterId} spent {Amount} Rage: {RageAfter}/100",
                characterId, amount, rage.CurrentRage);
        }
        else
        {
            _logger.LogWarning(
                "Character {CharacterId} attempted to spend {Amount} Rage but only had {Available}",
                characterId, amount, rage.CurrentRage);
        }

        return spent;
    }

    public void DecayRageOutOfCombat(Guid characterId)
    {
        if (!_characterRage.TryGetValue(characterId, out var rage))
            return;

        var previousRage = rage.CurrentRage;
        rage.DecayOutOfCombat();

        if (previousRage != rage.CurrentRage)
        {
            _logger.LogDebug(
                "Character {CharacterId} out-of-combat decay: {Previous} → {Current}",
                characterId, previousRage, rage.CurrentRage);
        }
    }

    public void ResetRage(Guid characterId)
    {
        if (_characterRage.TryGetValue(characterId, out var rage))
        {
            _logger.LogInformation(
                "Character {CharacterId} Rage reset to 0 (was {Previous})",
                characterId, rage.CurrentRage);

            _characterRage[characterId] = new RageResource();
        }
    }

    public IEnumerable<Guid> GetEnragedCharacters()
    {
        return _characterRage
            .Where(kvp => kvp.Value.IsEnraged)
            .Select(kvp => kvp.Key);
    }

    /// <summary>
    /// Initializes Rage for a character (on specialization selection).
    /// </summary>
    public void InitializeRage(Guid characterId)
    {
        if (!_characterRage.ContainsKey(characterId))
        {
            _characterRage[characterId] = new RageResource();
            _logger.LogInformation("Rage initialized for character {CharacterId}", characterId);
        }
    }
}
```

---

## 10. BerserkrAbilityService Implementation

### 10.1 Interface Definition

```csharp
/// <summary>
/// Service for executing Berserkr abilities and checking passive triggers.
/// </summary>
public interface IBerserkrAbilityService
{
    /// <summary>
    /// Executes Fury Strike attack ability.
    /// </summary>
    /// <param name="characterId">Attacker character ID.</param>
    /// <param name="targetId">Target character ID.</param>
    /// <returns>FuryStrikeResult with attack and damage data.</returns>
    FuryStrikeResult UseFuryStrike(Guid characterId, Guid targetId);

    /// <summary>
    /// Checks if Blood Scent passive should trigger.
    /// </summary>
    /// <param name="targetId">Target that may be bloodied.</param>
    /// <returns>True if target is now bloodied and passive should trigger.</returns>
    bool CheckBloodScent(Guid targetId);

    /// <summary>
    /// Executes Pain is Fuel passive check and applies Rage if triggered.
    /// </summary>
    /// <param name="characterId">Character taking damage.</param>
    /// <param name="damageReceived">Damage amount (0+ valid).</param>
    /// <returns>Rage gained (5 if triggered, 0 if not).</returns>
    int CheckPainIsFuel(Guid characterId, int damageReceived);

    /// <summary>
    /// Gets the readiness status of an ability for a character.
    /// </summary>
    /// <param name="characterId">Character ID.</param>
    /// <param name="abilityId">Ability to check.</param>
    /// <returns>AbilityReadiness indicating whether ability can be used.</returns>
    AbilityReadiness GetAbilityReadiness(Guid characterId, BerserkrAbilityId abilityId);
}
```

### 10.2 Implementation Details

```csharp
/// <summary>
/// Implementation of IBerserkrAbilityService.
/// </summary>
public class BerserkrAbilityService : IBerserkrAbilityService
{
    private readonly IRageService _rageService;
    private readonly ICombatService _combatService; // For attacks/damage
    private readonly ILogger<BerserkrAbilityService> _logger;

    public BerserkrAbilityService(
        IRageService rageService,
        ICombatService combatService,
        ILogger<BerserkrAbilityService> logger)
    {
        _rageService = rageService;
        _combatService = combatService;
        _logger = logger;
    }

    public FuryStrikeResult UseFuryStrike(Guid characterId, Guid targetId)
    {
        var rage = _rageService.GetRage(characterId);

        // Check Rage requirement
        if (rage?.CurrentRage < 20)
        {
            _logger.LogWarning(
                "Character {CharacterId} insufficient Rage for Fury Strike ({Current}/20)",
                characterId, rage?.CurrentRage ?? 0);
            return new FuryStrikeResult { AttackRoll = 0 };
        }

        // Make weapon attack
        var attackRoll = _combatService.RollAttack(characterId, targetId);
        var baseDamage = _combatService.RollWeaponDamage(characterId);
        var furyDamage = RollFuryDamage(); // 3d6
        var criticalBonus = attackRoll == 20 ? RollCriticalBonus() : 0; // 1d6 on nat 20

        // Spend Rage
        _rageService.SpendRage(characterId, 20);

        var result = new FuryStrikeResult
        {
            AttackRoll = attackRoll,
            BaseDamage = baseDamage,
            FuryDamage = furyDamage,
            CriticalBonusDamage = criticalBonus,
            WasCritical = attackRoll == 20,
            RageSpent = 20,
            CorruptionTriggered = rage.IsEnraged // At 80+ Rage
        };

        if (result.CorruptionTriggered)
        {
            result = result with { CorruptionReason = "Used Fury Strike while Enraged (80+ Rage)" };
        }

        _logger.LogInformation(
            "Fury Strike: Character {CharacterId} → {TargetId}: {Result}",
            characterId, targetId, result.GetResultString("Target"));

        return result;
    }

    public bool CheckBloodScent(Guid targetId)
    {
        var target = _combatService.GetCharacter(targetId);
        if (target == null) return false;

        int bloodiedThreshold = target.MaxHp / 2;
        return target.CurrentHp <= bloodiedThreshold && target.CurrentHp > 0;
    }

    public int CheckPainIsFuel(Guid characterId, int damageReceived)
    {
        // Only trigger if damage was valid (hit or absorbed)
        if (damageReceived < 0)
            return 0;

        _rageService.AddRage(characterId, 5, "Pain is Fuel");
        _logger.LogDebug(
            "Pain is Fuel triggered for Character {CharacterId}: +5 Rage from {Damage} damage",
            characterId, damageReceived);

        return 5;
    }

    public AbilityReadiness GetAbilityReadiness(Guid characterId, BerserkrAbilityId abilityId)
    {
        var character = _combatService.GetCharacter(characterId);
        var rage = _rageService.GetRage(characterId);

        if (character == null || rage == null)
            return AbilityReadiness.NotAvailable;

        return abilityId switch
        {
            BerserkrAbilityId.FuryStrike =>
                rage.CurrentRage >= 20 ? AbilityReadiness.Ready : AbilityReadiness.InsufficientResource,

            BerserkrAbilityId.BloodScent =>
                AbilityReadiness.Ready, // Always ready (passive)

            BerserkrAbilityId.PainIsFuel =>
                AbilityReadiness.Ready, // Always ready (passive)

            _ => AbilityReadiness.NotAvailable
        };
    }

    private int RollFuryDamage() => DiceRoller.Roll(3, 6); // 3d6
    private int RollCriticalBonus() => DiceRoller.Roll(1, 6); // 1d6
}
```

---

## 11. BerserkrCorruptionService Implementation

### 11.1 Interface Definition

```csharp
/// <summary>
/// Service for evaluating and applying Corruption risk from Berserkr abilities.
/// Extends v0.20.4 Heretical Corruption patterns with combat-focused triggers.
/// </summary>
public interface IBerserkrCorruptionService
{
    /// <summary>
    /// Evaluates Corruption risk for a Berserkr ability or action.
    /// </summary>
    /// <param name="abilityId">Ability being used.</param>
    /// <param name="currentRage">Current Rage level.</param>
    /// <param name="targetIsCoherent">Whether target is Coherent-aligned.</param>
    /// <returns>CorruptionRiskResult indicating amount and reason.</returns>
    CorruptionRiskResult EvaluateRisk(
        BerserkrAbilityId abilityId,
        int currentRage,
        bool targetIsCoherent = false);

    /// <summary>
    /// Applies Corruption to a character from a Berserkr action.
    /// </summary>
    /// <param name="characterId">Character gaining Corruption.</param>
    /// <param name="risk">Risk result to apply.</param>
    void ApplyCorruption(Guid characterId, CorruptionRiskResult risk);

    /// <summary>
    /// Checks Corruption risk for entering combat at current Rage level.
    /// </summary>
    /// <param name="currentRage">Current Rage at combat start.</param>
    /// <returns>CorruptionRiskResult (0 if safe, +1 if at 80+ Rage).</returns>
    CorruptionRiskResult CheckCombatEntryRisk(int currentRage);

    /// <summary>
    /// Gets human-readable description of a trigger type.
    /// </summary>
    string GetTriggerDescription(BerserkrCorruptionTrigger trigger);
}
```

### 11.2 CorruptionRiskResult Value Object

```csharp
/// <summary>
/// Result of Corruption risk evaluation.
/// </summary>
public sealed record CorruptionRiskResult
{
    /// <summary>Amount of Corruption to apply (0 if no risk).</summary>
    public int CorruptionAmount { get; init; }

    /// <summary>Trigger type (if any).</summary>
    public BerserkrCorruptionTrigger? Trigger { get; init; }

    /// <summary>Human-readable reason for Corruption.</summary>
    public string Reason { get; init; }

    /// <summary>Whether Corruption was triggered.</summary>
    public bool IsTriggered => CorruptionAmount > 0;

    /// <summary>Gets a warning message if Corruption is triggered.</summary>
    public string GetWarning()
    {
        if (!IsTriggered) return "No Corruption risk";

        return CorruptionAmount switch
        {
            1 => $"[HERETICAL] +1 Corruption: {Reason}",
            2 => $"[HERETICAL] +2 Corruption: {Reason}",
            _ => $"[HERETICAL] +{CorruptionAmount} Corruption: {Reason}"
        };
    }
}
```

### 11.3 Implementation Details

```csharp
/// <summary>
/// Implementation of IBerserkrCorruptionService.
/// </summary>
public class BerserkrCorruptionService : IBerserkrCorruptionService
{
    private readonly IShadowCorruptionService _shadowCorruptionService;
    private readonly ILogger<BerserkrCorruptionService> _logger;

    public BerserkrCorruptionService(
        IShadowCorruptionService shadowCorruptionService,
        ILogger<BerserkrCorruptionService> logger)
    {
        _shadowCorruptionService = shadowCorruptionService;
        _logger = logger;
    }

    public CorruptionRiskResult EvaluateRisk(
        BerserkrAbilityId abilityId,
        int currentRage,
        bool targetIsCoherent = false)
    {
        return abilityId switch
        {
            BerserkrAbilityId.FuryStrike =>
                currentRage >= 80
                    ? new CorruptionRiskResult
                    {
                        CorruptionAmount = 1,
                        Trigger = BerserkrCorruptionTrigger.FuryStrikeWhileEnraged,
                        Reason = "Used Fury Strike while Enraged (80+ Rage)"
                    }
                    : new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Safe Rage level" },

            BerserkrAbilityId.BloodScent =>
                new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Passive ability, no risk" },

            BerserkrAbilityId.PainIsFuel =>
                new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Passive ability, no risk" },

            BerserkrAbilityId.Unstoppable =>
                currentRage >= 80
                    ? new CorruptionRiskResult
                    {
                        CorruptionAmount = 1,
                        Trigger = BerserkrCorruptionTrigger.UnstoppableWhileEnraged,
                        Reason = "Used Unstoppable while Enraged (80+ Rage)"
                    }
                    : new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Safe Rage level" },

            BerserkrAbilityId.IntimidatingPresence =>
                targetIsCoherent
                    ? new CorruptionRiskResult
                    {
                        CorruptionAmount = 1,
                        Trigger = BerserkrCorruptionTrigger.IntimidatingCoherentTarget,
                        Reason = "Used Intimidating Presence against Coherent target"
                    }
                    : new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Target not Coherent-aligned" },

            BerserkrAbilityId.FuryOfTheForlorn =>
                new CorruptionRiskResult
                {
                    CorruptionAmount = 1,
                    Trigger = BerserkrCorruptionTrigger.FuryOfTheForlornUsage,
                    Reason = "Used Fury of the Forlorn (requires 80+ Rage)"
                },

            BerserkrAbilityId.DeathDefiance =>
                new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Passive ability, no risk" },

            BerserkrAbilityId.AvatarOfDestruction =>
                new CorruptionRiskResult
                {
                    CorruptionAmount = 2,
                    Trigger = BerserkrCorruptionTrigger.CapstoneActivation,
                    Reason = "Used Avatar of Destruction Capstone"
                },

            _ => new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Unknown ability" }
        };
    }

    public void ApplyCorruption(Guid characterId, CorruptionRiskResult risk)
    {
        if (!risk.IsTriggered) return;

        _shadowCorruptionService.AddCorruption(characterId, risk.CorruptionAmount);

        _logger.LogWarning(
            "Berserkr Corruption applied to {CharacterId}: +{Amount} ({Reason})",
            characterId, risk.CorruptionAmount, risk.Reason);
    }

    public CorruptionRiskResult CheckCombatEntryRisk(int currentRage)
    {
        if (currentRage >= 80)
        {
            return new CorruptionRiskResult
            {
                CorruptionAmount = 1,
                Trigger = BerserkrCorruptionTrigger.EnterCombatEnraged,
                Reason = "Entered combat while Enraged (80+ Rage)"
            };
        }

        return new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Safe Rage level at combat entry" };
    }

    public string GetTriggerDescription(BerserkrCorruptionTrigger trigger)
    {
        return trigger switch
        {
            BerserkrCorruptionTrigger.EnterCombatEnraged =>
                "Entered combat at 80+ Rage",

            BerserkrCorruptionTrigger.AbilityWhileEnraged =>
                "Used ability while at 80+ Rage",

            BerserkrCorruptionTrigger.FuryStrikeWhileEnraged =>
                "Used Fury Strike while Enraged",

            BerserkrCorruptionTrigger.UnstoppableWhileEnraged =>
                "Used Unstoppable while Enraged",

            BerserkrCorruptionTrigger.IntimidatingCoherentTarget =>
                "Used Intimidating Presence against Coherent target",

            BerserkrCorruptionTrigger.FuryOfTheForlornUsage =>
                "Used Fury of the Forlorn",

            BerserkrCorruptionTrigger.CapstoneActivation =>
                "Used Avatar of Destruction",

            BerserkrCorruptionTrigger.KillCoherentEnraged =>
                "Killed Coherent-aligned creature while Enraged",

            BerserkrCorruptionTrigger.SustainedBerserkRage =>
                "Maintained 100 Rage for extended period",

            _ => "Unknown trigger"
        };
    }
}
```

---

## 12. Character Integration

### 12.1 Character Entity Modifications

```csharp
public partial class Character
{
    /// <summary>
    /// Berserkr specialization Rage resource (if specialization is Berserkr).
    /// </summary>
    public RageResource? Rage { get; private set; }

    /// <summary>
    /// Gets the current Rage level (if Berserkr).
    /// </summary>
    public RageLevel? RageLevel
    {
        get => Rage?.GetRageLevel();
    }

    /// <summary>
    /// Computed: True if character is Enraged (80+ Rage).
    /// </summary>
    public bool IsEnraged => Rage?.IsEnraged ?? false;

    /// <summary>
    /// Initialization of Rage when selecting Berserkr specialization.
    /// </summary>
    public void InitializeBerserkrSpecialization()
    {
        if (Specialization.Id != SpecializationId.Berserkr)
            throw new InvalidOperationException("Specialization is not Berserkr");

        Rage = new RageResource();
    }

    /// <summary>
    /// Resets Rage on combat end or rest.
    /// </summary>
    public void ResetRage()
    {
        if (Rage != null)
            Rage = new RageResource();
    }
}
```

---

## 13. Tier 1 Abilities

### 13.1 Fury Strike (Attack Ability)

**Specifications:**

| Property | Value |
|----------|-------|
| **ID** | `fury-strike` |
| **Type** | Attack (Active) |
| **Tier** | 1 |
| **AP Cost** | 2 |
| **Rage Cost** | 20 |
| **Effect** | Weapon damage + 3d6 fury |
| **Corruption Risk** | +1 if at 80+ Rage |
| **Cooldown** | None |

**Mechanics:**

- Make a melee weapon attack against target
- Deals base weapon damage + 3d6 (roll once, distribute to target)
- If attack is a critical hit (natural 20), add additional 1d6 bonus
- Costs 20 Rage to use (fails if Rage < 20)
- If used while at 80+ Rage, triggers +1 Corruption
- On successful hit, damage is dealt immediately
- Does not provoke opportunity attacks

**Usage Example:**

```
> ability fury-strike Draugr Warrior
You channel your rage into a devastating blow!
Attack Roll: 18 (Hit!)
Damage: 7 (weapon) + 12 (3d6 fury) = 19 total damage
Rage: 50 → 30/100 (-20)

The Draugr Warrior takes 19 damage!
```

### 13.2 Blood Scent (Passive Ability)

**Specifications:**

| Property | Value |
|----------|-------|
| **ID** | `blood-scent` |
| **Type** | Passive |
| **Tier** | 1 |
| **Effect** | +10 Rage when enemy bloodied |
| **Bonus Effect** | +1 attack vs bloodied targets |
| **Corruption Risk** | None |
| **Trigger** | Enemy becomes bloodied (≤50% HP) |

**Mechanics:**

- Passive ability that triggers automatically
- Whenever any visible enemy drops to 50% HP or below, gain 10 Rage
- Also grants +1 bonus to attack rolls against bloodied targets
- Can trigger multiple times (once per unique enemy bloodied)
- Does not consume any Rage
- No Corruption risk

**Trigger Conditions:**

| Scenario | Triggers? | Notes |
|----------|-----------|-------|
| Enemy at 50% HP exactly | Yes | Meets bloodied threshold |
| Enemy below 50% HP | Yes | Considered bloodied |
| Ally bloodies enemy | Yes | If within line of sight |
| Enemy heals above 50% then drops again | Yes | New trigger |
| Already bloodied enemy takes more damage | No | Already triggered |

**Usage Example:**

```
Enemy takes 15 damage from Ally's attack!
Draugr Warrior HP: 24/48 → 9/48 (bloodied!)

[Blood Scent] The scent of blood drives your fury onward!
Rage: 30 → 40/100 (+10)

[You gain +1 Attack bonus vs Draugr Warrior]
```

### 13.3 Pain is Fuel (Passive Ability)

**Specifications:**

| Property | Value |
|----------|-------|
| **ID** | `pain-is-fuel` |
| **Type** | Passive |
| **Tier** | 1 |
| **Effect** | +5 Rage when taking damage |
| **Corruption Risk** | None |
| **Trigger** | Take damage from any source |

**Mechanics:**

- Passive ability that triggers automatically whenever character takes damage
- Gain 5 Rage per damage instance (not per damage point)
- Triggers even if damage is absorbed by armor/shields (0 damage dealt but attack hit)
- Does NOT trigger on self-inflicted damage or environmental damage
- No per-turn limit on triggers (can stack)
- Does not consume any Rage
- No Corruption risk

**Trigger Conditions:**

| Scenario | Triggers? | Rage Gained |
|----------|-----------|-------------|
| Take 5 damage | Yes | +5 |
| Take 20 damage | Yes | +5 (not 20) |
| Armor absorbs all damage | Yes | +5 (attack still hit) |
| Self-inflicted damage | No | 0 |
| Environmental damage (fire, etc.) | No | 0 |
| Repeated hits same turn | Yes per hit | +5 each |

**Usage Example:**

```
Draugr Warrior attacks you!
Attack Roll: 16 (Hit!)
You take 8 damage!

[Pain is Fuel] The pain feeds your fury!
Rage: 25 → 30/100 (+5)

[HP: 42/50]
```

---

## 14. Data Model Changes

### 14.1 Character Entity

```csharp
MODIFY: Character (Entity)
├── ADD: Rage: RageResource? (nullable, only if Berserkr)
├── ADD: IsEnraged: bool (computed from Rage ≥ 80)
├── ADD: RageLevel: RageLevel? (computed from Rage)
├── ADD: BerserkrState: BerserkrState?
├── ADD: HasDeathDefianceTriggered: bool (for v0.20.5c)
└── ADD: InitializeBerserkrSpecialization(): void
```

### 14.2 Specialization Definition

```csharp
MODIFY: SpecializationDefinition (Entity)
├── ADD: SpecialResource: SpecialResourceDefinition? (for Rage)
├── ADD: CorruptionPatternType: enum (Heretical/Holy/etc.)
└── ADD: CombatEscalationMechanics: CombatEscalationDefinition?
```

### 14.3 Combat Combat Event Tracking

```csharp
NEW: CombatEscalationEvent (Value Object)
├── CharacterId: Guid
├── EventType: CombatEscalationEventType
├── RageBeforeEvent: int
├── RageAfterEvent: int
├── CorruptionTriggered: bool
├── Timestamp: DateTime
└── Description: string
```

---

## 15. Configuration File Schemas

### 15.1 specializations.json (Berserkr Entry)

```json
{
  "specializations": [
    {
      "specializationId": "Berserkr",
      "displayName": "Berserkr",
      "tagline": "Clarity Through Fury",
      "archetype": "Warrior",
      "pathType": "Heretical",
      "description": "The Berserkr has surrendered to the primal fury that lurks within every survivor of Aethelgard. Where others fight for hope or duty, the Berserkr fights because the rage demands it. Their power is drawn from a dark wellspring — the collective anguish of the World-Machine's victims, the desperate fury of those who refuse to accept extinction.",
      "selectionText": "The rage is not madness. The rage is clarity. Let the fury flow through you.",
      "specialResource": {
        "resourceId": "rage",
        "resourceName": "Rage",
        "description": "Fury drawn from combat. Builds when taking damage or witnessing bloodshed. Powers devastating attacks and transformations.",
        "maxValue": 100,
        "startingValue": 0,
        "displayPriority": 1
      },
      "abilityTiers": [
        {
          "tier": 1,
          "ppRequirement": 0,
          "abilityCost": 0,
          "abilities": ["fury-strike", "blood-scent", "pain-is-fuel"]
        },
        {
          "tier": 2,
          "ppRequirement": 8,
          "abilityCost": 4,
          "abilities": ["reckless-assault", "unstoppable", "intimidating-presence"]
        },
        {
          "tier": 3,
          "ppRequirement": 16,
          "abilityCost": 5,
          "abilities": ["fury-of-the-forlorn", "death-defiance"]
        },
        {
          "tier": "capstone",
          "ppRequirement": 24,
          "abilityCost": 6,
          "abilities": ["avatar-of-destruction"]
        }
      ],
      "corruptionRisk": {
        "pathType": "Heretical",
        "triggers": [
          {
            "trigger": "EnterCombatEnraged",
            "amount": 1,
            "description": "Entered combat while at 80+ Rage"
          },
          {
            "trigger": "AbilityWhileEnraged",
            "amount": 1,
            "description": "Used ability while at 80+ Rage"
          },
          {
            "trigger": "CapstoneActivation",
            "amount": 2,
            "description": "Used Avatar of Destruction"
          }
        ]
      }
    }
  ]
}
```

### 15.2 abilities.json (Tier 1 Berserkr Abilities)

```json
{
  "abilities": [
    {
      "abilityId": "fury-strike",
      "displayName": "Fury Strike",
      "specializationId": "Berserkr",
      "tier": 1,
      "type": "Attack",
      "apCost": 2,
      "resourceCost": {
        "resourceId": "rage",
        "amount": 20
      },
      "description": "Channel your rage into a devastating melee attack. Deals weapon damage +3d6 fury damage. On critical hit, additional +1d6.",
      "shortDescription": "Attack dealing weapon damage + 3d6 fury",
      "requirements": {
        "minimumRage": 20
      },
      "effects": [
        {
          "type": "WeaponAttack",
          "target": "single",
          "range": "melee"
        },
        {
          "type": "BonusDamage",
          "diceCount": 3,
          "diceSize": 6,
          "damageType": "Physical"
        },
        {
          "type": "CriticalBonusDamage",
          "diceCount": 1,
          "diceSize": 6,
          "damageType": "Physical"
        }
      ],
      "corruptionRisk": {
        "trigger": "AtEnragedLevel",
        "minimumRage": 80,
        "corruptionAmount": 1,
        "description": "Using Fury Strike while Enraged (80+ Rage) risks +1 Corruption"
      }
    },
    {
      "abilityId": "blood-scent",
      "displayName": "Blood Scent",
      "specializationId": "Berserkr",
      "tier": 1,
      "type": "Passive",
      "apCost": 0,
      "resourceCost": null,
      "description": "The scent of blood drives your fury. Gain 10 Rage whenever an enemy within line of sight becomes bloodied (drops to 50% HP or below). Also grants +1 to attack rolls against bloodied targets.",
      "shortDescription": "Passive: +10 Rage when enemy bloodied, +1 attack vs bloodied",
      "effects": [
        {
          "type": "OnEnemyBloodied",
          "rageGain": 10,
          "rageSource": "Blood Scent"
        },
        {
          "type": "AttackBonus",
          "condition": "TargetIsBloodied",
          "value": 1,
          "description": "+1 to attack rolls against bloodied enemies"
        }
      ],
      "corruptionRisk": null
    },
    {
      "abilityId": "pain-is-fuel",
      "displayName": "Pain is Fuel",
      "specializationId": "Berserkr",
      "tier": 1,
      "type": "Passive",
      "apCost": 0,
      "resourceCost": null,
      "description": "Every wound feeds your fury. Gain 5 Rage whenever you take damage from any source. Does not trigger on self-inflicted damage.",
      "shortDescription": "Passive: +5 Rage when taking damage",
      "effects": [
        {
          "type": "OnDamageTaken",
          "rageGain": 5,
          "rageSource": "Pain is Fuel",
          "excludeSelfInflicted": true
        }
      ],
      "corruptionRisk": null
    }
  ]
}
```

---

## 16. Combat Flow & Interactions

### 16.1 Typical Combat Scenario

```
TURN 1: Berserkr (Bjorn) starts combat
├─ Rage: 0/100
├─ Combat Entry Check: 0 Rage < 80 → No Corruption
│
├─ Enemy attacks Bjorn
│  ├─ Draugr Warrior hits for 8 damage
│  ├─ [Pain is Fuel] Triggered: Bjorn gains +5 Rage
│  │  └─ Rage: 0 → 5/100
│  └─ Bjorn HP: 45 → 37/45
│
├─ Bjorn's Turn
│  ├─ Uses Fury Strike on Draugr Warrior
│  ├─ Attack Roll: 16 (Hit!)
│  ├─ Damage: 7 (weapon) + 10 (3d6) = 17 total
│  ├─ Draugr HP: 30 → 13/30 (not yet bloodied)
│  ├─ Rage Cost: 5 → -15 (fails! need 20)
│  │  └─ Bjorn does not have enough Rage (only 5)
│  │
│  └─ Instead, Bjorn attacks normally (Attack action)
│     └─ Draugr takes 6 damage
│        └─ Draugr HP: 13 → 7/30 (BLOODIED!)

TURN 2: Draugr attacks again
├─ Hit for 6 damage
├─ [Pain is Fuel] Triggered: +5 Rage
│  └─ Rage: 5 → 10/100
├─ [Blood Scent] Triggered! (Draugr still bloodied)
│  └─ Rage: 10 → 20/100 (just bloodied!)
│
├─ Bjorn HP: 37 → 31/45

Bjorn's Turn
├─ Rage: 20/100 (meets Fury Strike requirement!)
├─ Uses Fury Strike on Draugr Warrior
├─ Attack Roll: 19 (Hit!)
├─ Damage: 7 (weapon) + 14 (3d6) = 21 total
├─ Draugr dies!
├─ Rage: 20 → 0/100 (-20 spent)
│
└─ Combat Continues or Ends...
```

### 16.2 Rage Threshold Effects in Combat

```
RAGE LEVEL PROGRESSION:

Calm (0-19 Rage):
├─ Status: Safe, no Corruption
├─ Passive generation only
└─ Example: Starting state, building fury

Irritated (20-39 Rage):
├─ Status: Getting angry
├─ Can use Fury Strike
├─ Passive generation continues
└─ Example: After first hit or two taken

Angry (40-59 Rage):
├─ Status: Fighting seriously
├─ Fury Strike available and effective
├─ No Corruption yet
└─ Example: Extended combat engagement

Furious (60-79 Rage):
├─ Status: Very angry
├─ Peak non-risky state
├─ Still safe from Corruption
└─ Example: Prolonged battles

Enraged (80-99 Rage):
├─ Status: CORRUPTION THRESHOLD
├─ Abilities grant +1 Corruption each
├─ Combat entry risk: +1 Corruption
├─ Warning: "Beware, fury consumes you!"
└─ Example: Desperate combat situations

Berserk (100 Rage):
├─ Status: EXTREME DANGER
├─ Avatar of Destruction available
├─ Capstone costs +2 Corruption always
├─ Warning: "You are consumed by rage!"
└─ Example: Total war state
```

---

## 17. Logging Specifications

### 17.1 Log Levels & Examples

**Debug Level:**
```
[DEBUG] Rage decay applied: Character 123e4567-e89b-12d3-a456-426614174000 (25 → 15 Rage)
[DEBUG] Pain is Fuel checked: 8 damage dealt, +5 Rage applied
```

**Information Level:**
```
[INFO] Character 123e4567-e89b-12d3-a456-426614174000 gained 10 Rage (Blood Scent): 30 → 40/100
[INFO] Fury Strike executed: Character 123e → Target 789a, Roll: 18, Damage: 21
[INFO] Rage spent: Character 123e Fury Strike cost 20 Rage (40 → 20/100)
```

**Warning Level:**
```
[WARN] Character 123e entered ENRAGED state at 80 Rage!
[WARN] Berserkr Corruption applied: Character 123e +1 Corruption (Fury Strike while Enraged)
[WARN] Character 123e insufficient Rage for Fury Strike (10/20)
```

**Error Level:**
```
[ERROR] Failed to apply Rage: Character not found (ID: invalid-guid)
[ERROR] Corruption service unavailable for Berserkr
```

---

## 18. Unit Testing Requirements

### 18.1 RageResourceTests.cs (~7 tests)

```csharp
[TestFixture]
public class RageResourceTests
{
    [Test]
    public void Create_InitializesWithZeroRage()
    {
        var rage = new RageResource();
        Assert.That(rage.CurrentRage, Is.EqualTo(0));
        Assert.That(rage.MaxRage, Is.EqualTo(100));
        Assert.That(rage.IsEnraged, Is.False);
    }

    [Test]
    public void Spend_SufficientRage_ReturnsTrue()
    {
        var rage = new RageResource();
        rage.Gain(30, "Test");
        Assert.That(rage.Spend(20), Is.True);
        Assert.That(rage.CurrentRage, Is.EqualTo(10));
    }

    [Test]
    public void Spend_InsufficientRage_ReturnsFalse()
    {
        var rage = new RageResource();
        rage.Gain(10, "Test");
        Assert.That(rage.Spend(20), Is.False);
        Assert.That(rage.CurrentRage, Is.EqualTo(10)); // Unchanged
    }

    [Test]
    public void GainFromDamage_AddsCorrectAmount()
    {
        var rage = new RageResource();
        rage.GainFromDamage(15);
        Assert.That(rage.CurrentRage, Is.EqualTo(5));
        Assert.That(rage.GainSource, Is.EqualTo("Pain is Fuel"));
    }

    [Test]
    public void GainFromBloodied_AddsTenRage()
    {
        var rage = new RageResource();
        rage.GainFromBloodied();
        Assert.That(rage.CurrentRage, Is.EqualTo(10));
        Assert.That(rage.GainSource, Is.EqualTo("Blood Scent"));
    }

    [Test]
    public void IsEnraged_AtEightyRage_ReturnsTrue()
    {
        var rage = new RageResource();
        rage.Gain(80, "Test");
        Assert.That(rage.IsEnraged, Is.True);
    }

    [Test]
    public void GetRageLevel_ReturnsCorrectLevel()
    {
        var rage = new RageResource();

        rage.Gain(15, "Test");
        Assert.That(rage.GetRageLevel(), Is.EqualTo(RageLevel.Calm));

        rage.Gain(10, "Test");
        Assert.That(rage.GetRageLevel(), Is.EqualTo(RageLevel.Irritated));

        rage.Gain(20, "Test");
        Assert.That(rage.GetRageLevel(), Is.EqualTo(RageLevel.Angry));
    }
}
```

### 18.2 BerserkrAbilityServiceTests.cs (~3 tests)

```csharp
[TestFixture]
public class BerserkrAbilityServiceTests
{
    private BerserkrAbilityService _service;
    private Mock<IRageService> _rageServiceMock;

    [SetUp]
    public void Setup()
    {
        _rageServiceMock = new Mock<IRageService>();
        var combatServiceMock = new Mock<ICombatService>();
        var loggerMock = new Mock<ILogger<BerserkrAbilityService>>();

        _service = new BerserkrAbilityService(
            _rageServiceMock.Object,
            combatServiceMock.Object,
            loggerMock.Object);
    }

    [Test]
    public void CheckPainIsFuel_ValidDamage_AddsRage()
    {
        var characterId = Guid.NewGuid();
        _rageServiceMock.Setup(r => r.AddRage(It.IsAny<Guid>(), 5, "Pain is Fuel"));

        var result = _service.CheckPainIsFuel(characterId, 8);

        Assert.That(result, Is.EqualTo(5));
        _rageServiceMock.Verify(r => r.AddRage(characterId, 5, "Pain is Fuel"), Times.Once);
    }

    [Test]
    public void CheckBloodScent_EnemyBloodied_ReturnsTrue()
    {
        // Mock combat service to return bloodied enemy
        var result = _service.CheckBloodScent(Guid.NewGuid());
        // (implementation-specific assertions)
    }

    [Test]
    public void UseFuryStrike_InsufficientRage_FailsGracefully()
    {
        // Test insufficient Rage handling
    }
}
```

### 18.3 BerserkrCorruptionServiceTests.cs (~2 tests)

```csharp
[TestFixture]
public class BerserkrCorruptionServiceTests
{
    [Test]
    public void EvaluateRisk_FuryStrikeWhileEnraged_ReturnsOneCorruption()
    {
        var service = new BerserkrCorruptionService(
            new Mock<IShadowCorruptionService>().Object,
            new Mock<ILogger<BerserkrCorruptionService>>().Object);

        var result = service.EvaluateRisk(
            BerserkrAbilityId.FuryStrike,
            currentRage: 85,
            targetIsCoherent: false);

        Assert.That(result.IsTriggered, Is.True);
        Assert.That(result.CorruptionAmount, Is.EqualTo(1));
    }

    [Test]
    public void CheckCombatEntryRisk_AtEightyRage_ReturnsCorruption()
    {
        var service = new BerserkrCorruptionService(
            new Mock<IShadowCorruptionService>().Object,
            new Mock<ILogger<BerserkrCorruptionService>>().Object);

        var result = service.CheckCombatEntryRisk(currentRage: 80);

        Assert.That(result.IsTriggered, Is.True);
        Assert.That(result.CorruptionAmount, Is.EqualTo(1));
    }
}
```

---

## 19. Acceptance Criteria

- [ ] Berserkr specialization registered in SpecializationDefinition
- [ ] Rage initializes to 0/100 on character creation
- [ ] Rage generates when taking damage (+5 via Pain is Fuel)
- [ ] Rage generates when enemies bloodied (+10 via Blood Scent)
- [ ] Fury Strike costs 20 Rage and deals weapon damage + 3d6
- [ ] Fury Strike fails if Rage < 20
- [ ] Corruption check triggered when using abilities at 80+ Rage
- [ ] Rage level correctly computed from current Rage value
- [ ] Heretical path Corruption integration functional (using v0.20.4 patterns)
- [ ] Combat entry at 80+ Rage triggers +1 Corruption
- [ ] Ability slots correctly show Tier 1 abilities as unlocked
- [ ] Passive abilities trigger without AP cost
- [ ] All ~10 unit tests pass
- [ ] Configuration files (specializations.json, abilities.json) valid JSON

---

## 20. Dependencies & Prerequisites

### 20.1 Required Previous Versions

| Dependency | Purpose | Integration |
|-----------|---------|-------------|
| v0.17.3 | Archetype System | Warrior archetype foundation |
| v0.17.4 | Specialization Framework | SpecializationDefinition, Tier unlock mechanics |
| v0.18.x | Corruption System | CorruptionService base functionality |
| v0.20.0 | Legacy Class Removal | IAbilitySlotService, SpecializationPrerequisiteService |
| v0.20.1-v0.20.3 | Prior Specializations | Establish specialization ability patterns |
| v0.20.4 | Myrk-gengr (Heretical) | IShadowCorruptionService pattern, Corruption triggers |

### 20.2 External Dependencies

- `NLog` or similar for logging
- `DiceRoller` utility for damage calculations
- Combat system for attack/damage resolution
- Character system for entity management

---

## Appendix: Quick Reference

### Rage Generation Summary

| Source | Amount | Trigger |
|--------|--------|---------|
| Pain is Fuel | +5 | Any damage taken |
| Blood Scent | +10 | Enemy becomes bloodied (≤50% HP) |
| Death Defiance | +20 | Trigger (v0.20.5c) |
| Decay | -10 | Per minute out of combat |

### Ability Cost Summary

| Ability | AP | Rage | Tier |
|---------|----|----|------|
| Fury Strike | 2 | 20 | 1 |
| Blood Scent | - | - | 1 (passive) |
| Pain is Fuel | - | - | 1 (passive) |
| Unstoppable | 1 | 15 | 2 |
| Intimidating Presence | 2 | 10 | 2 |
| Reckless Assault | 1 | - | 2 (stance) |
| Fury of the Forlorn | 3 | 30 | 3 |
| Death Defiance | - | - | 3 (passive) |
| Avatar of Destruction | 3 | 100 | Capstone |

---

_This specification provides the complete framework for v0.20.5a: Berserkr Framework & Tier 1 Abilities. It establishes the Rage resource system, Corruption integration, and foundational abilities that define the Berserkr specialization._
