# Changelog: v0.18.2a - CPS Enums & State

**Release Date:** 2026-02-01
**Phase:** Cognitive Paradox Syndrome (1/4)
**Status:** Complete

---

## Overview

Implements the domain layer foundation for the **Cognitive Paradox Syndrome (CPS)** system — the mental deterioration from processing reality-bending paradoxes. This establishes the base types that v0.18.2b-d will build upon.

CPS is distinct from Corruption (physical taint) in that it derives from Psychic Stress and can recover when stress is reduced through rest or abilities. The terminal state (HollowShell) occurs at 80+ stress, requiring a survival check or permanent character loss.

---

## Added

### Domain Layer — Enums

- **`CpsStage.cs`** (`Domain/Enums/CpsStage.cs`)
    - 5 progressive stages of cognitive deterioration
    - Box comment header with `═══` separators (Version: 0.18.2a)
    - Comprehensive XML documentation with `<summary>`, `<remarks>`, `<seealso>`
    - Explicit integer values (0-4) for stable serialization

| Stage           | Value | Stress Range | Description             |
| --------------- | ----- | ------------ | ----------------------- |
| None            | 0     | 0-19         | No cognitive impairment |
| WeightOfKnowing | 1     | 20-39        | Reality feels "off"     |
| GlimmerMadness  | 2     | 40-59        | Reality flickers        |
| RuinMadness     | 3     | 60-79        | Panic Table triggers    |
| HollowShell     | 4     | 80+          | Terminal state          |

- **`PanicEffect.cs`** (`Domain/Enums/PanicEffect.cs`)
    - 10 possible Panic Table outcomes (d10 roll results)
    - Box comment header with `═══` separators (Version: 0.18.2a)
    - Explicit integer values (0-9) for stable serialization

| Effect       | Value | d10 | Description             |
| ------------ | ----- | --- | ----------------------- |
| None         | 0     | 10  | Lucky break             |
| Frozen       | 1     | 1   | Cannot act 1 round      |
| Scream       | 2     | 2   | Alerts enemies          |
| Flee         | 3     | 3   | Must flee combat        |
| Fetal        | 4     | 4   | Drop prone              |
| Blackout     | 5     | 5   | Unconscious 1d4 rounds  |
| Denial       | 6     | 6   | Cannot perceive threat  |
| Violence     | 7     | 7   | Attack nearest creature |
| Catatonia    | 8     | 8   | Stunned until hit       |
| Dissociation | 9     | 9   | Random action           |

### Domain Layer — Value Objects

- **`CpsState.cs`** (`Domain/ValueObjects/CpsState.cs`)
    - Immutable `readonly record struct` following `CorruptionState` pattern
    - Box comment header with `═══` separators (Version: 0.18.2a)
    - Comprehensive XML documentation with `<summary>`, `<remarks>`, `<example>`, `<seealso>`

**Constants:**

- `MinStress = 0`, `MaxStress = 100`
- Threshold constants: 20, 40, 60, 80

**Properties:**

- `CurrentStress` — clamped 0-100
- `Stage` — computed via `DetermineStage()`
- `RequiresPanicCheck` — true when Stage ≥ RuinMadness
- `IsTerminal` — true when Stage == HollowShell
- `PercentageToHollowShell` — stress/80, capped at 1.0
- `IsClear` — true when Stage == None
- `IsHollow` — alias for IsTerminal

**Methods:**

- `Create(int stress)` — factory method with clamping
- `DetermineStage(int stress)` — static stage calculation
- `ToString()` — debug formatting with `[PANIC CHECK]` and `[TERMINAL!]` indicators

### Unit Tests

- **`CpsStateTests.cs`** (`Domain.UnitTests/ValueObjects/CpsStateTests.cs`)
    - 62 test cases across 17 test methods
    - Following `CorruptionStateTests` pattern with AAA format
    - FluentAssertions for readable assertions

| Test Category           | Test Count | Description                        |
| ----------------------- | ---------- | ---------------------------------- |
| Create (boundary)       | 11         | All threshold boundaries           |
| Create (clamping)       | 4          | Negative and overflow values       |
| RequiresPanicCheck      | 10         | RuinMadness/HollowShell detection  |
| IsTerminal              | 6          | HollowShell detection              |
| PercentageToHollowShell | 7          | Percentage calculation and capping |
| IsClear                 | 5          | None stage detection               |
| DetermineStage          | 10         | Static method direct test          |
| ToString                | 4          | Formatting verification            |
| Record Equality         | 2          | Value-based comparison             |

---

## Files Created

| Path                                                               | Description                      |
| ------------------------------------------------------------------ | -------------------------------- |
| `src/Core/RuneAndRust.Domain/Enums/CpsStage.cs`                    | 5-stage CPS progression enum     |
| `src/Core/RuneAndRust.Domain/Enums/PanicEffect.cs`                 | 10-effect Panic Table enum       |
| `src/Core/RuneAndRust.Domain/ValueObjects/CpsState.cs`             | Immutable CPS state value object |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CpsStateTests.cs` | Comprehensive unit tests         |
| `changelogs/v0.18.2a-changelog.md`                                 | This changelog                   |

---

## Verification Results

### Build

- **Build:** ✅ Succeeded
- **Errors:** 0
- **Warnings:** 0

### Tests

- **Total Tests:** 62
- **Passed:** 62
- **Failed:** 0
- **Duration:** 0.46 seconds

---

## Notes

- All new files follow established codebase patterns: `═══════` box comment headers, file-scoped namespaces, comprehensive XML documentation
- CPS uses 5 stages (vs 6 for Corruption) with terminal state at 80+ stress (vs 100 for Corruption)
- The `PercentageToHollowShell` property uses divisor of 80 to match the terminal threshold
- `PanicEffect` enum values are offset by 1 from d10 rolls (None=0 for default, effects 1-9 match rolls 1-9, roll 10=None)
- This completes v0.18.2a — foundation ready for v0.18.2b (Panic & Result Objects)
