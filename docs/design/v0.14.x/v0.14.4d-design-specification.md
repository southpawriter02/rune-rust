# v0.14.4d Design Specification: Interactive Object Schema

**Version:** 0.14.4d
**Parent:** v0.14.4 (Environment Configuration Schemas)
**Prerequisites:** v0.14.3 Complete (Monster Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Interactive Object Schema Root Definition](#4-interactive-object-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [InteractiveObjectDefinition Schema](#42-interactiveobjectdefinition-schema)
5. [Object Type Configuration](#5-object-type-configuration)
   - 5.1 [Object Type Enum](#51-object-type-enum)
   - 5.2 [Object Categories](#52-object-categories)
6. [State Configuration](#6-state-configuration)
   - 6.1 [State Enum](#61-state-enum)
   - 6.2 [Default States by Object Type](#62-default-states-by-object-type)
7. [Interaction Configuration](#7-interaction-configuration)
   - 7.1 [Interaction Type Enum](#71-interaction-type-enum)
   - 7.2 [Allowed Interactions by Object Type](#72-allowed-interactions-by-object-type)
8. [Skill Check Configuration](#8-skill-check-configuration)
   - 8.1 [SkillCheck Definition](#81-skillcheck-definition)
   - 8.2 [Alternate Skills](#82-alternate-skills)
9. [State Transition Configuration](#9-state-transition-configuration)
   - 9.1 [StateTransition Definition](#91-statetransition-definition)
   - 9.2 [Transition Flow Examples](#92-transition-flow-examples)
10. [Reward Configuration](#10-reward-configuration)
    - 10.1 [Reward Definition](#101-reward-definition)
    - 10.2 [Item Rewards](#102-item-rewards)
    - 10.3 [Gold and Experience Rewards](#103-gold-and-experience-rewards)
11. [Trap Effect Configuration](#11-trap-effect-configuration)
    - 11.1 [TrapEffect Definition](#111-trapeffect-definition)
    - 11.2 [Saving Throws](#112-saving-throws)
12. [Passage and Visibility Configuration](#12-passage-and-visibility-configuration)
13. [Keywords Configuration](#13-keywords-configuration)
14. [Validation Rules](#14-validation-rules)
    - 14.1 [ID Pattern Validation](#141-id-pattern-validation)
    - 14.2 [Enum Validation](#142-enum-validation)
    - 14.3 [Range Validation](#143-range-validation)
    - 14.4 [Required Fields](#144-required-fields)
15. [Configuration Schema](#15-configuration-schema)
16. [Configuration File Updates](#16-configuration-file-updates)
17. [Data Model Changes](#17-data-model-changes)
18. [Logging Specifications](#18-logging-specifications)
19. [Unit Testing Requirements](#19-unit-testing-requirements)
20. [Use Cases](#20-use-cases)
21. [Deliverable Checklist](#21-deliverable-checklist)
22. [Acceptance Criteria](#22-acceptance-criteria)
23. [Dependencies](#23-dependencies)
24. [Future Considerations](#24-future-considerations)

---

## 1. Executive Summary

Version 0.14.4d introduces the **Interactive Object Schema** (`interactive-objects.schema.json`), which validates interactive object definitions including object types, states, allowed interactions, skill check requirements, state transitions, rewards, trap effects, and keywords. This schema enables full customization of dungeon interactables without code changes, supporting modding scenarios such as custom puzzle rooms, trap-filled corridors, or treasure vaults with unique containers.

The Interactive Object Schema validates the existing `interactive-objects.json` configuration file which currently defines 12 interactive objects (doors, chests, levers, crates, barrels, webs, statues, altars, torches, and inscriptions). The schema establishes patterns for interactive object configurations that are referenced by room types (v0.14.4b) for feature spawning and connection rules.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `interactive-objects.schema.json` |
| **Schema Definitions** | `InteractiveObjectDefinition`, `SkillCheck`, `StateTransition`, `Reward`, `ItemReward`, `TrapEffect`, `QuantityRange` |
| **Configuration Files** | Validate existing `interactive-objects.json` against new schema |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version provides:
- **Object type validation** - 14 object type categories (Door, Chest, Lever, etc.)
- **State validation** - 12 state values (Closed, Open, Locked, etc.)
- **Interaction validation** - 12 interaction types (Open, Close, Examine, etc.)
- **Skill check validation** - Skill ID references and difficulty classes
- **State transition validation** - From/to/via transition rules
- **Reward validation** - Items, gold, experience, and information rewards
- **Trap effect validation** - Damage, saving throws, and status effects
- **Keyword validation** - Natural language parsing support

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  v0.14.4 ENVIRONMENT CONFIGURATION SCHEMAS                   │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.4a: biomes.schema.json                                           │
  │  v0.14.4b: room-types.schema.json                                       │
  │  v0.14.4c: terrain.schema.json (expansion)                              │
  │  v0.14.4d: interactive-objects.schema.json ◀── THIS VERSION             │
  └─────────────────────────────────────────────────────────────────────────┘

  Cross-references:
  • interactive-objects.json → skillChecks.skillId references skills.json
  • interactive-objects.json → rewards.lootTableId references loot-tables.json
  • interactive-objects.json → rewards.fixedItems[].itemId references items.json
  • interactive-objects.json → trapEffect.damageType references damage-types
  • interactive-objects.json → trapEffect.statusEffect references status-effects.json

  Referenced by:
  • room-types.json → connectionRules.allowedDoorTypes
  • room-types.json → featureSpawnRules[].featureId
  • room-types.json → requiredFeatures / forbiddenFeatures

  Shared definitions:
  • ID pattern: ^[a-z][a-z0-9-]*$ (lowercase kebab-case)
  • Schema location: config/schemas/
  • Dice expression pattern: ^[0-9]+d[0-9]+([+-][0-9]+)?$
  • SavingThrow definition (shared with terrain.schema.json)
```

---

## 2. Feature Overview

```
v0.14.4d Interactive Object Schema Features
├── interactive-objects.schema.json
│   ├── Root Configuration Properties
│   │   ├── $schema (string, optional)
│   │   ├── version (string, optional)
│   │   └── interactiveObjects (array of InteractiveObjectDefinition, required)
│   └── Definitions
│       ├── InteractiveObjectDefinition
│       │   ├── id (string, kebab-case pattern, required)
│       │   ├── name (string, minLength: 1, required)
│       │   ├── description (string, required)
│       │   ├── objectType (enum: 14 types, required)
│       │   ├── defaultState (enum: 12 states, required)
│       │   ├── allowedInteractions (array of enum, required)
│       │   ├── blocksPassage (boolean, default: false)
│       │   ├── blocksLOS (boolean, default: false)
│       │   ├── keywords (array of string, required)
│       │   ├── skillChecks (object, interaction -> SkillCheck, optional)
│       │   ├── stateTransitions (array of StateTransition, optional)
│       │   ├── rewards (object, state -> Reward, optional)
│       │   ├── trapEffect (TrapEffect, optional)
│       │   └── sortOrder (integer, minimum: 0, optional)
│       ├── SkillCheck
│       │   ├── skillId (string, skill reference, required)
│       │   ├── dc (integer, minimum: 1, required)
│       │   ├── alternateSkillId (string, optional)
│       │   └── alternateDc (integer, optional)
│       ├── StateTransition
│       │   ├── fromState (enum, required)
│       │   ├── toState (enum, required)
│       │   ├── viaInteraction (enum, required)
│       │   ├── requiresSkillCheck (boolean, default: false)
│       │   └── message (string, optional)
│       ├── Reward
│       │   ├── lootTableId (string, optional)
│       │   ├── fixedItems (array of ItemReward, optional)
│       │   ├── goldRange (QuantityRange, optional)
│       │   ├── experienceReward (integer, optional)
│       │   └── informationText (string, optional)
│       ├── ItemReward
│       │   ├── itemId (string, required)
│       │   ├── quantity (integer, minimum: 1, default: 1)
│       │   └── chance (number, 0-1, default: 1.0)
│       ├── QuantityRange
│       │   ├── min (integer, minimum: 0)
│       │   └── max (integer, minimum: 0)
│       └── TrapEffect
│           ├── damage (string, dice expression, required)
│           ├── damageType (string, damage type id, required)
│           ├── statusEffect (string, optional)
│           ├── savingThrow (SavingThrow, optional)
│           ├── triggerChance (number, 0-1, default: 1.0)
│           └── disarmDc (integer, optional)
├── Validation Rules
│   ├── Object Type Enum Validation (14 values)
│   ├── State Enum Validation (12 values)
│   ├── Interaction Enum Validation (12 values)
│   ├── Skill Check DC Validation (>= 1)
│   ├── Trigger Chance Range Validation (0-1)
│   ├── Item Chance Range Validation (0-1)
│   ├── Dice Expression Pattern Validation
│   └── Required Fields Enforced
└── Configuration Updates
    └── interactive-objects.json validated with schema
```

---

## 3. Architecture Diagrams

### 3.1 Interactive Object Definition Structure Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                   INTERACTIVE OBJECT DEFINITION STRUCTURE                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                 INTERACTIVE OBJECT DEFINITION                        │    │
│  │                                                                      │    │
│  │  id: "iron-chest-locked"                                             │    │
│  │  name: "Locked Iron Chest"                                           │    │
│  │  description: "A heavy iron chest secured with a complex lock."      │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  TYPE & STATE CONFIGURATION                                    │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ objectType: "Chest"                                     │  │  │    │
│  │  │  │ defaultState: "Locked"                                  │  │  │    │
│  │  │  │ blocksPassage: false                                    │  │  │    │
│  │  │  │ blocksLOS: false                                        │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  INTERACTIONS & KEYWORDS                                       │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ allowedInteractions: ["Unlock", "Open", "Close",        │  │  │    │
│  │  │  │                       "Examine", "Search", "Break"]     │  │  │    │
│  │  │  │ keywords: ["chest", "iron chest", "locked chest"]       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  SKILL CHECKS (optional)                                       │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ skillChecks: {                                          │  │  │    │
│  │  │  │   "Unlock": {                                           │  │  │    │
│  │  │  │     skillId: "lockpicking",                             │  │  │    │
│  │  │  │     dc: 15,                                             │  │  │    │
│  │  │  │     alternateSkillId: "perception",                     │  │  │    │
│  │  │  │     alternateDc: 20                                     │  │  │    │
│  │  │  │   },                                                    │  │  │    │
│  │  │  │   "Break": { skillId: "strength", dc: 18 }              │  │  │    │
│  │  │  │ }                                                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  STATE TRANSITIONS (optional)                                  │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ stateTransitions: [                                     │  │  │    │
│  │  │  │   { from: "Locked", to: "Closed", via: "Unlock",        │  │  │    │
│  │  │  │     requiresSkillCheck: true,                           │  │  │    │
│  │  │  │     message: "You hear a click as the lock opens." },   │  │  │    │
│  │  │  │   { from: "Closed", to: "Open", via: "Open" },          │  │  │    │
│  │  │  │   { from: "Open", to: "Closed", via: "Close" },         │  │  │    │
│  │  │  │   { from: "Locked", to: "Broken", via: "Break",         │  │  │    │
│  │  │  │     requiresSkillCheck: true }                          │  │  │    │
│  │  │  │ ]                                                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  REWARDS (optional, by state)                                  │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ rewards: {                                              │  │  │    │
│  │  │  │   "Open": {                                             │  │  │    │
│  │  │  │     lootTableId: "treasure-chest-rare",                 │  │  │    │
│  │  │  │     goldRange: { min: 50, max: 150 },                   │  │  │    │
│  │  │  │     experienceReward: 25                                │  │  │    │
│  │  │  │   }                                                     │  │  │    │
│  │  │  │ }                                                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits interactive-objects.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads interactive-objects.schema.json from config/schemas/              │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │               (suggests objectType, defaultState, interactions)
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "objectType must be one of: Door, Chest, Lever, ..."
                           • "defaultState must be one of: Closed, Open, ..."
                           • "skillChecks.dc must be >= 1"
                           • "triggerChance must be between 0 and 1"
```

### 3.3 Object Type Categories

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        OBJECT TYPE CATEGORIES                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  PASSAGE BLOCKERS                                                            │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Type          │ Description            │ Typical Interactions         │ │
│  │  ──────────────┼────────────────────────┼────────────────────────────  │ │
│  │  Door          │ Room connectors        │ Open, Close, Unlock, Break   │ │
│  │  Web           │ Breakable obstacles    │ Break, Examine               │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  CONTAINERS                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Type          │ Description            │ Typical Interactions         │ │
│  │  ──────────────┼────────────────────────┼────────────────────────────  │ │
│  │  Chest         │ Lockable storage       │ Open, Close, Unlock, Search  │ │
│  │  Barrel        │ Simple storage         │ Open, Search, Examine        │ │
│  │  Crate         │ Breakable storage      │ Open, Break, Search          │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  MECHANISMS                                                                  │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Type          │ Description            │ Typical Interactions         │ │
│  │  ──────────────┼────────────────────────┼────────────────────────────  │ │
│  │  Lever         │ Wall-mounted trigger   │ Activate, Examine            │ │
│  │  Switch        │ Floor/wall trigger     │ Activate, Push, Examine      │ │
│  │  Trap          │ Harmful trigger        │ Examine, Disarm              │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  DECORATIVE / INFORMATION                                                    │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Type          │ Description            │ Typical Interactions         │ │
│  │  ──────────────┼────────────────────────┼────────────────────────────  │ │
│  │  Statue        │ Decorative figure      │ Examine, Activate            │ │
│  │  Inscription   │ Readable text          │ Examine, Read                │ │
│  │  Bookshelf     │ Information source     │ Search, Read, Examine        │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  INTERACTIVE FEATURES                                                        │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Type          │ Description            │ Typical Interactions         │ │
│  │  ──────────────┼────────────────────────┼────────────────────────────  │ │
│  │  Altar         │ Shrine interactable    │ Activate, Examine, Use       │ │
│  │  Fountain      │ Resource source        │ Use, Examine                 │ │
│  │  LightSource   │ Torches, lamps         │ Examine                      │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 State Transition System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        STATE TRANSITION SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  DOOR STATE MACHINE                                                          │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │                    ┌──────────────────┐                                │ │
│  │                    │      LOCKED      │                                │ │
│  │                    └────────┬─────────┘                                │ │
│  │                             │                                          │ │
│  │              Unlock (skill) │                                          │ │
│  │                             ▼                                          │ │
│  │   ┌──────────────────────────────────────────────────────┐            │ │
│  │   │                                                      │            │ │
│  │   │    ┌──────────┐  Open   ┌──────────┐                │            │ │
│  │   │    │  CLOSED  │ ◄─────▶ │   OPEN   │                │            │ │
│  │   │    └──────────┘  Close  └──────────┘                │            │ │
│  │   │                                                      │            │ │
│  │   └──────────────────────────────────────────────────────┘            │ │
│  │                             │                                          │ │
│  │              Lock (skill)   │                                          │ │
│  │                             ▼                                          │ │
│  │                    ┌──────────────────┐                                │ │
│  │                    │      LOCKED      │                                │ │
│  │                    └──────────────────┘                                │ │
│  │                                                                        │ │
│  │              Break (skill from any state)                              │ │
│  │                             │                                          │ │
│  │                             ▼                                          │ │
│  │                    ┌──────────────────┐                                │ │
│  │                    │      BROKEN      │                                │ │
│  │                    └──────────────────┘                                │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  LEVER STATE MACHINE                                                         │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │    ┌──────────┐  Activate  ┌──────────┐                               │ │
│  │    │   DOWN   │ ◄────────▶ │    UP    │                               │ │
│  │    └──────────┘  Activate  └──────────┘                               │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  CHEST STATE MACHINE                                                         │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │    LOCKED ──Unlock──▶ CLOSED ◀──Close──▶ OPEN                          │ │
│  │       │                  │                  │                          │ │
│  │       │                  │                  │                          │ │
│  │       └──────── Break ───┴──────────────────┘                          │ │
│  │                    │                                                   │ │
│  │                    ▼                                                   │ │
│  │                 BROKEN                                                 │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ALTAR STATE MACHINE                                                         │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │    ┌──────────┐  Activate  ┌──────────┐                               │ │
│  │    │ INACTIVE │ ─────────▶ │  ACTIVE  │                               │ │
│  │    └──────────┘            └──────────┘                               │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Skill Check System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SKILL CHECK SYSTEM                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  SKILL CHECK CONFIGURATION                                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  skillChecks: {                                                        │ │
│  │    "Unlock": {                                                         │ │
│  │      "skillId": "lockpicking",    // Primary skill                     │ │
│  │      "dc": 15,                    // Difficulty class                  │ │
│  │      "alternateSkillId": "perception",  // Secondary option            │ │
│  │      "alternateDc": 20            // Higher DC for alternate           │ │
│  │    },                                                                  │ │
│  │    "Break": {                                                          │ │
│  │      "skillId": "strength",                                            │ │
│  │      "dc": 18                                                          │ │
│  │    }                                                                   │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  SKILL CHECK FLOW                                                            │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Player attempts interaction                                           │ │
│  │         │                                                              │ │
│  │         ▼                                                              │ │
│  │  Has skill check for this interaction?                                 │ │
│  │         │                                                              │ │
│  │    Yes  │  No                                                          │ │
│  │    │    └──▶ Interaction succeeds automatically                        │ │
│  │    ▼                                                                   │ │
│  │  Check transition: requiresSkillCheck?                                 │ │
│  │         │                                                              │ │
│  │    Yes  │  No                                                          │ │
│  │    │    └──▶ Interaction succeeds automatically                        │ │
│  │    ▼                                                                   │ │
│  │  Roll skill check                                                      │ │
│  │         │                                                              │ │
│  │   Pass  │  Fail                                                        │ │
│  │    │    └──▶ Show failure message                                      │ │
│  │    ▼                                                                   │ │
│  │  Transition state, show success message                                │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  COMMON SKILL CHECKS BY INTERACTION                                          │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Interaction │ Typical Skills      │ DC Range │ Notes                  │ │
│  │  ────────────┼─────────────────────┼──────────┼──────────────────────  │ │
│  │  Unlock      │ lockpicking         │ 10-25    │ Alternate: perception  │ │
│  │  Break       │ strength            │ 12-20    │ Destroys object        │ │
│  │  Search      │ perception          │ 8-18     │ Find hidden items      │ │
│  │  Read        │ arcana, history     │ 10-20    │ Decipher text          │ │
│  │  Activate    │ arcana              │ 12-22    │ Magical objects        │ │
│  │  Push/Pull   │ strength            │ 8-15     │ Heavy mechanisms       │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 Reward System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           REWARD SYSTEM                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  REWARD CONFIGURATION                                                        │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  rewards: {                                                            │ │
│  │    "Open": {                              // Reward when opened        │ │
│  │      "lootTableId": "treasure-chest-common",                           │ │
│  │      "fixedItems": [                                                   │ │
│  │        { "itemId": "healing-potion", "quantity": 1, "chance": 0.5 }    │ │
│  │      ],                                                                │ │
│  │      "goldRange": { "min": 10, "max": 50 },                            │ │
│  │      "experienceReward": 10                                            │ │
│  │    },                                                                  │ │
│  │    "Search": {                            // Reward when searched      │ │
│  │      "informationText": "You find a hidden note with a clue..."        │ │
│  │    }                                                                   │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  REWARD TYPES                                                                │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Type             │ Description            │ Source                    │ │
│  │  ─────────────────┼────────────────────────┼─────────────────────────  │ │
│  │  lootTableId      │ Random drops           │ References loot-tables    │ │
│  │  fixedItems       │ Guaranteed items       │ Direct item references    │ │
│  │  goldRange        │ Currency reward        │ Min/max gold amount       │ │
│  │  experienceReward │ XP for interaction     │ Flat XP value             │ │
│  │  informationText  │ Lore/clue text         │ Direct string             │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  REWARD FLOW                                                                 │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Object transitions to rewarding state (e.g., "Open")                  │ │
│  │         │                                                              │ │
│  │         ▼                                                              │ │
│  │  Check rewards[currentState]                                           │ │
│  │         │                                                              │ │
│  │    Has  │  None                                                        │ │
│  │    │    └──▶ No rewards granted                                        │ │
│  │    ▼                                                                   │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │  For each reward type present:                                  │  │ │
│  │  │  1. Roll loot table (if lootTableId)                            │  │ │
│  │  │  2. Roll each fixedItem.chance                                  │  │ │
│  │  │  3. Roll gold between min-max                                   │  │ │
│  │  │  4. Grant experienceReward                                      │  │ │
│  │  │  5. Display informationText                                     │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │         │                                                              │ │
│  │         ▼                                                              │ │
│  │  Grant rewards to player                                               │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.7 Trap Effect System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          TRAP EFFECT SYSTEM                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  TRAP EFFECT CONFIGURATION                                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  trapEffect: {                                                         │ │
│  │    "damage": "2d6",                    // Dice expression              │ │
│  │    "damageType": "piercing",           // Damage type reference        │ │
│  │    "statusEffect": "bleeding",         // Optional status effect       │ │
│  │    "triggerChance": 0.8,               // 80% chance to trigger        │ │
│  │    "savingThrow": {                                                    │ │
│  │      "attribute": "finesse",           // Save attribute               │ │
│  │      "dc": 14,                         // Difficulty class             │ │
│  │      "halfOnSuccess": true             // Half damage on save          │ │
│  │    },                                                                  │ │
│  │    "disarmDc": 15                      // DC to disarm                 │ │
│  │  }                                                                     │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  TRAP TRIGGER FLOW                                                           │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Player interacts with trapped object                                  │ │
│  │         │                                                              │ │
│  │         ▼                                                              │ │
│  │  Roll triggerChance                                                    │ │
│  │         │                                                              │ │
│  │   Pass  │  Fail                                                        │ │
│  │    │    └──▶ Trap doesn't trigger (lucky)                              │ │
│  │    ▼                                                                   │ │
│  │  Has savingThrow?                                                      │ │
│  │         │                                                              │ │
│  │    Yes  │  No                                                          │ │
│  │    │    └──▶ Full damage applied                                       │ │
│  │    ▼                                                                   │ │
│  │  Roll saving throw                                                     │ │
│  │         │                                                              │ │
│  │   Pass  │  Fail                                                        │ │
│  │    │    └──▶ Full damage applied                                       │ │
│  │    ▼                                                                   │ │
│  │  halfOnSuccess?                                                        │ │
│  │         │                                                              │ │
│  │   Yes   │  No                                                          │ │
│  │    │    └──▶ No damage                                                 │ │
│  │    ▼                                                                   │ │
│  │  Half damage applied                                                   │ │
│  │         │                                                              │ │
│  │         ▼                                                              │ │
│  │  Apply statusEffect (if present)                                       │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  TRAP DISARM FLOW                                                            │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Player attempts to disarm trap                                        │ │
│  │         │                                                              │ │
│  │         ▼                                                              │ │
│  │  Roll skill check vs disarmDc                                          │ │
│  │         │                                                              │ │
│  │   Pass  │  Fail                                                        │ │
│  │    │    └──▶ Trap triggers! (apply damage)                             │ │
│  │    ▼                                                                   │ │
│  │  Trap disabled, state → "Triggered" (safe)                             │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.8 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── interactive-objects.json ◀─────────────────┐                           │
│  │   {                                           │ references                │
│  │     "$schema": "./schemas/interactive-objects.schema.json",               │
│  │     "interactiveObjects": [                   │                           │
│  │       {                                       │                           │
│  │         "id": "iron-door-basic",              │                           │
│  │         "name": "Heavy Iron Door",            │                           │
│  │         "description": "...",                 │                           │
│  │         "objectType": "Door",                 │                           │
│  │         "defaultState": "Closed",             │                           │
│  │         "allowedInteractions": [...],         │                           │
│  │         "blocksPassage": true,                │                           │
│  │         "keywords": [...]                     │                           │
│  │       },                                      │                           │
│  │       ...                                     │                           │
│  │     ]                                         │                           │
│  │   }                                           │                           │
│  │                                               │                           │
│  ├── room-types.json (references interactive object IDs)                     │
│  │   └── connectionRules.allowedDoorTypes                                    │
│  │   └── featureSpawnRules[].featureId                                       │
│  │                                               │                           │
│  ├── skills.json (provides skill IDs for checks) │                           │
│  ├── loot-tables.json (provides loot table IDs)  │                           │
│  ├── items.json (provides item IDs)              │                           │
│  │                                               │                           │
│  └── schemas/                                    │                           │
│      └── interactive-objects.schema.json ────────┘                           │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {                                                  │
│              "InteractiveObjectDefinition": {...},                           │
│              "SkillCheck": {...},                                            │
│              "StateTransition": {...},                                       │
│              "Reward": {...},                                                │
│              "ItemReward": {...},                                            │
│              "TrapEffect": {...}                                             │
│            }                                                                 │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Interactive Object Schema Root Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/interactive-objects.schema.json`

The interactive object schema follows JSON Schema Draft-07 specification, providing comprehensive validation for interactive object configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Interactive Object Configuration",
    "description": "Schema for interactive object definitions including types, states, interactions, skill checks, and rewards.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "interactiveObjects": {
            "type": "array",
            "description": "List of interactive object definitions",
            "items": {
                "$ref": "#/definitions/InteractiveObjectDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["interactiveObjects"],
    "additionalProperties": false,
    "definitions": {
        "InteractiveObjectDefinition": { ... },
        "SkillCheck": { ... },
        "StateTransition": { ... },
        "Reward": { ... },
        "ItemReward": { ... },
        "QuantityRange": { ... },
        "TrapEffect": { ... },
        "SavingThrow": { ... }
    }
}
```

### 4.2 InteractiveObjectDefinition Schema

The `InteractiveObjectDefinition` object defines a complete interactive object with all its behavioral properties.

```json
"InteractiveObjectDefinition": {
    "type": "object",
    "description": "An interactive object definition with type, state, interactions, and behavior",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the interactive object (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "Detailed description shown when examined",
            "minLength": 1
        },
        "objectType": {
            "type": "string",
            "description": "Category of interactive object",
            "enum": ["Door", "Chest", "Lever", "Altar", "Barrel", "Crate", "Web",
                     "Statue", "LightSource", "Inscription", "Trap", "Switch",
                     "Bookshelf", "Fountain"]
        },
        "defaultState": {
            "type": "string",
            "description": "Initial state when object is spawned",
            "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit",
                     "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
        },
        "allowedInteractions": {
            "type": "array",
            "description": "List of interactions this object supports",
            "items": {
                "type": "string",
                "enum": ["Open", "Close", "Examine", "Search", "Activate", "Break",
                         "Unlock", "Lock", "Read", "Use", "Push", "Pull"]
            },
            "minItems": 1
        },
        "blocksPassage": {
            "type": "boolean",
            "description": "Whether this object blocks player movement",
            "default": false
        },
        "blocksLOS": {
            "type": "boolean",
            "description": "Whether this object blocks line of sight",
            "default": false
        },
        "keywords": {
            "type": "array",
            "description": "Alternative names for natural language parsing",
            "items": {
                "type": "string",
                "minLength": 1
            },
            "minItems": 1
        },
        "skillChecks": {
            "type": "object",
            "description": "Skill checks required for specific interactions",
            "additionalProperties": {
                "$ref": "#/definitions/SkillCheck"
            }
        },
        "stateTransitions": {
            "type": "array",
            "description": "Rules for changing object state via interactions",
            "items": {
                "$ref": "#/definitions/StateTransition"
            }
        },
        "rewards": {
            "type": "object",
            "description": "Rewards granted when reaching specific states",
            "additionalProperties": {
                "$ref": "#/definitions/Reward"
            }
        },
        "trapEffect": {
            "$ref": "#/definitions/TrapEffect",
            "description": "Trap configuration for harmful interactive objects"
        },
        "sortOrder": {
            "type": "integer",
            "description": "Order for display sorting (lower values first)",
            "minimum": 0
        }
    },
    "required": ["id", "name", "description", "objectType", "defaultState",
                 "allowedInteractions", "keywords"],
    "additionalProperties": false
}
```

---

## 5. Object Type Configuration

### 5.1 Object Type Enum

The `objectType` field categorizes interactive objects into 14 distinct types.

```json
"objectType": {
    "type": "string",
    "description": "Category of interactive object",
    "enum": ["Door", "Chest", "Lever", "Altar", "Barrel", "Crate", "Web",
             "Statue", "LightSource", "Inscription", "Trap", "Switch",
             "Bookshelf", "Fountain"]
}
```

| Object Type | Description | Primary Use |
|-------------|-------------|-------------|
| `Door` | Passage blockers between rooms | Room connections |
| `Chest` | Lockable item containers | Treasure storage |
| `Lever` | Wall-mounted mechanism triggers | Puzzle mechanics |
| `Altar` | Shrine interactables | Blessings, rituals |
| `Barrel` | Simple storage containers | Random loot |
| `Crate` | Breakable storage containers | Destructible loot |
| `Web` | Breakable passage obstacles | Exploration barriers |
| `Statue` | Decorative or interactive figures | Decoration, puzzles |
| `LightSource` | Torches, lamps, braziers | Ambient lighting |
| `Inscription` | Readable text on surfaces | Lore, clues |
| `Trap` | Harmful triggered mechanisms | Combat hazards |
| `Switch` | Floor or wall triggers | Puzzle mechanics |
| `Bookshelf` | Information sources | Lore, item searches |
| `Fountain` | Resource restoration sources | Healing, buffs |

### 5.2 Object Categories

Objects are logically grouped into functional categories:

| Category | Object Types | Common Traits |
|----------|--------------|---------------|
| **Passage Blockers** | Door, Web | `blocksPassage: true` |
| **Containers** | Chest, Barrel, Crate | Searchable, may have rewards |
| **Mechanisms** | Lever, Switch, Trap | Activatable, state-changing |
| **Decorative** | Statue, Inscription, LightSource | Primarily Examine interaction |
| **Interactive Features** | Altar, Fountain, Bookshelf | Special interactions (Use, Read) |

---

## 6. State Configuration

### 6.1 State Enum

The `defaultState` field defines the initial state of an interactive object.

```json
"defaultState": {
    "type": "string",
    "description": "Initial state when object is spawned",
    "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit",
             "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
}
```

| State | Description | Typical Objects |
|-------|-------------|-----------------|
| `Closed` | Shut but not locked | Door, Chest, Crate |
| `Open` | Currently open | Door, Chest |
| `Locked` | Secured, requires unlocking | Door, Chest |
| `Broken` | Destroyed, cannot be used | Any breakable |
| `Lit` | Light source is on | LightSource |
| `Unlit` | Light source is off | LightSource |
| `Active` | Mechanism is activated | Altar, Switch |
| `Inactive` | Mechanism is not activated | Altar, Switch |
| `Normal` | Default undamaged state | Web, Statue, Inscription |
| `Triggered` | Trap has been set off | Trap |
| `Down` | Lever in down position | Lever |
| `Up` | Lever in up position | Lever |

### 6.2 Default States by Object Type

| Object Type | Typical Default State | Notes |
|-------------|----------------------|-------|
| `Door` | Closed | May also default to Locked |
| `Chest` | Closed | May also default to Locked |
| `Lever` | Down | Toggle between Down/Up |
| `Altar` | Inactive | Becomes Active when used |
| `Barrel` | Closed | Simple container |
| `Crate` | Closed | Breakable container |
| `Web` | Normal | Becomes Broken when destroyed |
| `Statue` | Normal | Rarely changes state |
| `LightSource` | Lit | May be Unlit for dark rooms |
| `Inscription` | Normal | Static state |
| `Trap` | Normal | Becomes Triggered when set off |
| `Switch` | Inactive | Toggle between states |
| `Bookshelf` | Normal | May become searched |
| `Fountain` | Active | May become Inactive if drained |

---

## 7. Interaction Configuration

### 7.1 Interaction Type Enum

The `allowedInteractions` array defines which interactions an object supports.

```json
"allowedInteractions": {
    "type": "array",
    "items": {
        "type": "string",
        "enum": ["Open", "Close", "Examine", "Search", "Activate", "Break",
                 "Unlock", "Lock", "Read", "Use", "Push", "Pull"]
    },
    "minItems": 1
}
```

| Interaction | Description | Typical Objects |
|-------------|-------------|-----------------|
| `Open` | Open a closed object | Door, Chest, Crate, Barrel |
| `Close` | Close an open object | Door, Chest |
| `Examine` | Get detailed description | All objects |
| `Search` | Look for hidden items | Chest, Barrel, Bookshelf |
| `Activate` | Trigger a mechanism | Lever, Altar, Switch |
| `Break` | Destroy the object | Crate, Web, Door |
| `Unlock` | Remove a lock | Door, Chest |
| `Lock` | Add a lock | Door, Chest |
| `Read` | Read text content | Inscription, Bookshelf |
| `Use` | Consume or interact specially | Fountain, Altar |
| `Push` | Push a mechanism | Switch, Statue |
| `Pull` | Pull a mechanism | Lever, Switch |

### 7.2 Allowed Interactions by Object Type

| Object Type | Typical Allowed Interactions |
|-------------|------------------------------|
| `Door` | Open, Close, Unlock, Lock, Break, Examine |
| `Chest` | Open, Close, Unlock, Lock, Search, Break, Examine |
| `Lever` | Activate, Pull, Examine |
| `Altar` | Activate, Use, Examine |
| `Barrel` | Open, Search, Examine |
| `Crate` | Open, Break, Search, Examine |
| `Web` | Break, Examine |
| `Statue` | Examine, Push, Activate |
| `LightSource` | Examine |
| `Inscription` | Examine, Read |
| `Trap` | Examine (may trigger) |
| `Switch` | Activate, Push, Examine |
| `Bookshelf` | Search, Read, Examine |
| `Fountain` | Use, Examine |

---

## 8. Skill Check Configuration

### 8.1 SkillCheck Definition

The `SkillCheck` object defines requirements for skill-based interactions.

```json
"SkillCheck": {
    "type": "object",
    "description": "Skill check requirement for an interaction",
    "properties": {
        "skillId": {
            "type": "string",
            "description": "Primary skill ID reference",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "dc": {
            "type": "integer",
            "description": "Difficulty class for the check",
            "minimum": 1
        },
        "alternateSkillId": {
            "type": "string",
            "description": "Alternative skill that can be used",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "alternateDc": {
            "type": "integer",
            "description": "DC for the alternate skill (typically higher)",
            "minimum": 1
        }
    },
    "required": ["skillId", "dc"],
    "additionalProperties": false
}
```

**Example Skill Check:**
```json
{
    "skillChecks": {
        "Unlock": {
            "skillId": "lockpicking",
            "dc": 15,
            "alternateSkillId": "perception",
            "alternateDc": 20
        },
        "Break": {
            "skillId": "strength",
            "dc": 18
        }
    }
}
```

### 8.2 Alternate Skills

The alternate skill system allows multiple approaches to challenges:

| Primary Skill | Alternate Skill | Use Case |
|---------------|-----------------|----------|
| lockpicking | perception | Find hidden key mechanism |
| strength | athletics | Leverage vs brute force |
| arcana | history | Magical vs historical knowledge |
| perception | investigation | Spot vs deduce |

**Behavior:**
- Player can choose which skill to use
- Alternate skill typically has higher DC
- Provides flexibility for different character builds

---

## 9. State Transition Configuration

### 9.1 StateTransition Definition

The `StateTransition` object defines how interactions change object state.

```json
"StateTransition": {
    "type": "object",
    "description": "Rule for changing object state via interaction",
    "properties": {
        "fromState": {
            "type": "string",
            "description": "Required current state",
            "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit",
                     "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
        },
        "toState": {
            "type": "string",
            "description": "Resulting state after interaction",
            "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit",
                     "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
        },
        "viaInteraction": {
            "type": "string",
            "description": "Interaction that causes this transition",
            "enum": ["Open", "Close", "Examine", "Search", "Activate", "Break",
                     "Unlock", "Lock", "Read", "Use", "Push", "Pull"]
        },
        "requiresSkillCheck": {
            "type": "boolean",
            "description": "Whether a skill check is required",
            "default": false
        },
        "message": {
            "type": "string",
            "description": "Feedback text shown on successful transition"
        }
    },
    "required": ["fromState", "toState", "viaInteraction"],
    "additionalProperties": false
}
```

### 9.2 Transition Flow Examples

**Door Transitions:**
```json
{
    "stateTransitions": [
        { "fromState": "Locked", "toState": "Closed", "viaInteraction": "Unlock",
          "requiresSkillCheck": true, "message": "You hear a click as the lock opens." },
        { "fromState": "Closed", "toState": "Open", "viaInteraction": "Open",
          "message": "The door swings open." },
        { "fromState": "Open", "toState": "Closed", "viaInteraction": "Close",
          "message": "The door closes with a thud." },
        { "fromState": "Closed", "toState": "Locked", "viaInteraction": "Lock",
          "message": "You lock the door." },
        { "fromState": "Locked", "toState": "Broken", "viaInteraction": "Break",
          "requiresSkillCheck": true, "message": "The door splinters from the blow!" },
        { "fromState": "Closed", "toState": "Broken", "viaInteraction": "Break",
          "requiresSkillCheck": true, "message": "The door splinters from the blow!" }
    ]
}
```

**Lever Transitions:**
```json
{
    "stateTransitions": [
        { "fromState": "Down", "toState": "Up", "viaInteraction": "Activate",
          "message": "You pull the lever up. Somewhere, gears begin to turn." },
        { "fromState": "Up", "toState": "Down", "viaInteraction": "Activate",
          "message": "You push the lever down. A mechanism clicks into place." }
    ]
}
```

---

## 10. Reward Configuration

### 10.1 Reward Definition

The `Reward` object defines what players receive from interactions.

```json
"Reward": {
    "type": "object",
    "description": "Reward granted when reaching a state or completing interaction",
    "properties": {
        "lootTableId": {
            "type": "string",
            "description": "Reference to loot table for random drops",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "fixedItems": {
            "type": "array",
            "description": "Guaranteed or chance-based specific items",
            "items": {
                "$ref": "#/definitions/ItemReward"
            }
        },
        "goldRange": {
            "$ref": "#/definitions/QuantityRange",
            "description": "Range of gold to reward"
        },
        "experienceReward": {
            "type": "integer",
            "description": "Experience points granted",
            "minimum": 0
        },
        "informationText": {
            "type": "string",
            "description": "Lore, clue, or other information revealed"
        }
    },
    "additionalProperties": false
}
```

### 10.2 Item Rewards

The `ItemReward` object defines specific item rewards with quantities and chances.

```json
"ItemReward": {
    "type": "object",
    "description": "A specific item reward with quantity and chance",
    "properties": {
        "itemId": {
            "type": "string",
            "description": "Reference to item definition",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "quantity": {
            "type": "integer",
            "description": "Number of items to grant",
            "minimum": 1,
            "default": 1
        },
        "chance": {
            "type": "number",
            "description": "Probability of granting this item (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1,
            "default": 1.0
        }
    },
    "required": ["itemId"],
    "additionalProperties": false
}
```

### 10.3 Gold and Experience Rewards

The `QuantityRange` object defines min/max values for gold rewards.

```json
"QuantityRange": {
    "type": "object",
    "description": "A range of quantities",
    "properties": {
        "min": {
            "type": "integer",
            "description": "Minimum quantity",
            "minimum": 0
        },
        "max": {
            "type": "integer",
            "description": "Maximum quantity",
            "minimum": 0
        }
    },
    "required": ["min", "max"],
    "additionalProperties": false
}
```

**Example Reward Configuration:**
```json
{
    "rewards": {
        "Open": {
            "lootTableId": "treasure-chest-common",
            "fixedItems": [
                { "itemId": "healing-potion", "quantity": 1, "chance": 0.3 },
                { "itemId": "gold-coin", "quantity": 5, "chance": 1.0 }
            ],
            "goldRange": { "min": 10, "max": 50 },
            "experienceReward": 15
        },
        "Search": {
            "informationText": "Hidden beneath false bottom, you find a cryptic note: 'The eastern passage holds secrets...'"
        }
    }
}
```

---

## 11. Trap Effect Configuration

### 11.1 TrapEffect Definition

The `TrapEffect` object defines harmful effects for trap objects.

```json
"TrapEffect": {
    "type": "object",
    "description": "Trap configuration for harmful interactive objects",
    "properties": {
        "damage": {
            "type": "string",
            "description": "Dice expression for damage (e.g., '2d6', '1d8+2')",
            "pattern": "^[0-9]+d[0-9]+([+-][0-9]+)?$"
        },
        "damageType": {
            "type": "string",
            "description": "Damage type ID (e.g., 'piercing', 'poison', 'fire')",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "statusEffect": {
            "type": "string",
            "description": "Status effect ID applied on hit",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "savingThrow": {
            "$ref": "#/definitions/SavingThrow",
            "description": "Saving throw to reduce or avoid damage"
        },
        "triggerChance": {
            "type": "number",
            "description": "Probability of trap triggering (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1,
            "default": 1.0
        },
        "disarmDc": {
            "type": "integer",
            "description": "Difficulty class to disarm the trap",
            "minimum": 1
        }
    },
    "required": ["damage", "damageType"],
    "additionalProperties": false
}
```

### 11.2 Saving Throws

The `SavingThrow` object (shared with terrain schema) defines save mechanics.

```json
"SavingThrow": {
    "type": "object",
    "description": "Saving throw configuration for damage avoidance",
    "properties": {
        "attribute": {
            "type": "string",
            "description": "Attribute used for the saving throw",
            "enum": ["might", "fortitude", "will", "wits", "finesse"]
        },
        "dc": {
            "type": "integer",
            "description": "Difficulty class for the saving throw",
            "minimum": 1
        },
        "halfOnSuccess": {
            "type": "boolean",
            "description": "Whether success reduces damage to half instead of negating it",
            "default": true
        }
    },
    "required": ["attribute", "dc"],
    "additionalProperties": false
}
```

**Example Trap Configuration:**
```json
{
    "id": "poison-needle-trap",
    "name": "Poison Needle Trap",
    "description": "A tiny needle coated in deadly poison.",
    "objectType": "Trap",
    "defaultState": "Normal",
    "allowedInteractions": ["Examine"],
    "keywords": ["trap", "needle", "lock"],
    "trapEffect": {
        "damage": "1d4",
        "damageType": "piercing",
        "statusEffect": "poisoned",
        "savingThrow": {
            "attribute": "fortitude",
            "dc": 14,
            "halfOnSuccess": false
        },
        "triggerChance": 0.9,
        "disarmDc": 16
    }
}
```

---

## 12. Passage and Visibility Configuration

The `blocksPassage` and `blocksLOS` fields control how objects affect movement and sight.

```json
"blocksPassage": {
    "type": "boolean",
    "description": "Whether this object blocks player movement",
    "default": false
}

"blocksLOS": {
    "type": "boolean",
    "description": "Whether this object blocks line of sight",
    "default": false
}
```

| Object Type | blocksPassage | blocksLOS | Notes |
|-------------|---------------|-----------|-------|
| Door (Closed) | true | true | Opens to allow passage |
| Door (Open) | false | false | Open doors don't block |
| Web | true | false | Can see through, can't pass |
| Chest | false | false | Can walk around |
| Statue (large) | true | true | May block passage |
| LightSource | false | false | Mounted on wall |

**State-Dependent Behavior:**
- `blocksPassage` may change based on state (e.g., closed door blocks, open door doesn't)
- This is handled at runtime, not in schema
- Schema validates the default values

---

## 13. Keywords Configuration

The `keywords` array enables natural language parsing for player commands.

```json
"keywords": {
    "type": "array",
    "description": "Alternative names for natural language parsing",
    "items": {
        "type": "string",
        "minLength": 1
    },
    "minItems": 1
}
```

**Keyword Guidelines:**

| Category | Examples |
|----------|----------|
| Object name | "door", "chest", "lever" |
| With material | "iron door", "wooden chest" |
| Descriptive | "heavy door", "rusty lever" |
| Generic | "box", "container", "switch" |

**Example Keywords by Object:**
```json
{
    "id": "iron-chest-locked",
    "keywords": ["chest", "iron chest", "locked chest", "treasure chest", "strongbox"]
}

{
    "id": "rusty-lever-wall",
    "keywords": ["lever", "switch", "mechanism", "rusty lever", "wall lever"]
}
```

**Usage:**
- Parser matches player input against keywords
- Multiple objects may share generic keywords
- Context (current room) disambiguates matches

---

## 14. Validation Rules

### 14.1 ID Pattern Validation

| Property | Pattern | Description |
|----------|---------|-------------|
| `InteractiveObjectDefinition.id` | `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| `skillChecks.skillId` | `^[a-z][a-z0-9-]*$` | Skill reference |
| `skillChecks.alternateSkillId` | `^[a-z][a-z0-9-]*$` | Alternate skill reference |
| `rewards.lootTableId` | `^[a-z][a-z0-9-]*$` | Loot table reference |
| `rewards.fixedItems[].itemId` | `^[a-z][a-z0-9-]*$` | Item reference |
| `trapEffect.damageType` | `^[a-z][a-z0-9-]*$` | Damage type reference |
| `trapEffect.statusEffect` | `^[a-z][a-z0-9-]*$` | Status effect reference |

### 14.2 Enum Validation

| Enum | Values |
|------|--------|
| `objectType` | Door, Chest, Lever, Altar, Barrel, Crate, Web, Statue, LightSource, Inscription, Trap, Switch, Bookshelf, Fountain (14 values) |
| `defaultState` | Closed, Open, Locked, Broken, Lit, Unlit, Active, Inactive, Normal, Triggered, Down, Up (12 values) |
| `allowedInteractions[]` | Open, Close, Examine, Search, Activate, Break, Unlock, Lock, Read, Use, Push, Pull (12 values) |
| `stateTransitions[].fromState` | Same as defaultState (12 values) |
| `stateTransitions[].toState` | Same as defaultState (12 values) |
| `stateTransitions[].viaInteraction` | Same as allowedInteractions (12 values) |
| `savingThrow.attribute` | might, fortitude, will, wits, finesse (5 values) |

### 14.3 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `skillChecks.dc` | >= 1 | "dc must be >= 1" |
| `skillChecks.alternateDc` | >= 1 | "alternateDc must be >= 1" |
| `rewards.experienceReward` | >= 0 | "experienceReward must be >= 0" |
| `rewards.fixedItems[].quantity` | >= 1 | "quantity must be >= 1" |
| `rewards.fixedItems[].chance` | 0-1 | "chance must be between 0 and 1" |
| `rewards.goldRange.min` | >= 0 | "min must be >= 0" |
| `rewards.goldRange.max` | >= 0 | "max must be >= 0" |
| `trapEffect.triggerChance` | 0-1 | "triggerChance must be between 0 and 1" |
| `trapEffect.disarmDc` | >= 1 | "disarmDc must be >= 1" |
| `trapEffect.savingThrow.dc` | >= 1 | "dc must be >= 1" |
| `sortOrder` | >= 0 | "sortOrder must be >= 0" |

### 14.4 Required Fields

| Definition | Required Fields |
|------------|-----------------|
| `InteractiveObjectDefinition` | id, name, description, objectType, defaultState, allowedInteractions, keywords |
| `SkillCheck` | skillId, dc |
| `StateTransition` | fromState, toState, viaInteraction |
| `ItemReward` | itemId |
| `QuantityRange` | min, max |
| `TrapEffect` | damage, damageType |
| `SavingThrow` | attribute, dc |

---

## 15. Configuration Schema

### Complete Interactive Objects Schema File

**File:** `config/schemas/interactive-objects.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Interactive Object Configuration",
    "description": "Schema for interactive object definitions including types, states, interactions, skill checks, and rewards.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "interactiveObjects": {
            "type": "array",
            "description": "List of interactive object definitions",
            "items": {
                "$ref": "#/definitions/InteractiveObjectDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["interactiveObjects"],
    "additionalProperties": false,
    "definitions": {
        "InteractiveObjectDefinition": {
            "type": "object",
            "description": "An interactive object definition with type, state, interactions, and behavior",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the interactive object (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "description": {
                    "type": "string",
                    "description": "Detailed description shown when examined",
                    "minLength": 1
                },
                "objectType": {
                    "type": "string",
                    "description": "Category of interactive object",
                    "enum": ["Door", "Chest", "Lever", "Altar", "Barrel", "Crate", "Web", "Statue", "LightSource", "Inscription", "Trap", "Switch", "Bookshelf", "Fountain"]
                },
                "defaultState": {
                    "type": "string",
                    "description": "Initial state when object is spawned",
                    "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit", "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
                },
                "allowedInteractions": {
                    "type": "array",
                    "description": "List of interactions this object supports",
                    "items": {
                        "type": "string",
                        "enum": ["Open", "Close", "Examine", "Search", "Activate", "Break", "Unlock", "Lock", "Read", "Use", "Push", "Pull"]
                    },
                    "minItems": 1
                },
                "blocksPassage": {
                    "type": "boolean",
                    "description": "Whether this object blocks player movement",
                    "default": false
                },
                "blocksLOS": {
                    "type": "boolean",
                    "description": "Whether this object blocks line of sight",
                    "default": false
                },
                "keywords": {
                    "type": "array",
                    "description": "Alternative names for natural language parsing",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    },
                    "minItems": 1
                },
                "skillChecks": {
                    "type": "object",
                    "description": "Skill checks required for specific interactions",
                    "additionalProperties": {
                        "$ref": "#/definitions/SkillCheck"
                    }
                },
                "stateTransitions": {
                    "type": "array",
                    "description": "Rules for changing object state via interactions",
                    "items": {
                        "$ref": "#/definitions/StateTransition"
                    }
                },
                "rewards": {
                    "type": "object",
                    "description": "Rewards granted when reaching specific states",
                    "additionalProperties": {
                        "$ref": "#/definitions/Reward"
                    }
                },
                "trapEffect": {
                    "$ref": "#/definitions/TrapEffect",
                    "description": "Trap configuration for harmful interactive objects"
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Order for display sorting (lower values first)",
                    "minimum": 0
                }
            },
            "required": ["id", "name", "description", "objectType", "defaultState", "allowedInteractions", "keywords"],
            "additionalProperties": false
        },
        "SkillCheck": {
            "type": "object",
            "description": "Skill check requirement for an interaction",
            "properties": {
                "skillId": {
                    "type": "string",
                    "description": "Primary skill ID reference",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "dc": {
                    "type": "integer",
                    "description": "Difficulty class for the check",
                    "minimum": 1
                },
                "alternateSkillId": {
                    "type": "string",
                    "description": "Alternative skill that can be used",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "alternateDc": {
                    "type": "integer",
                    "description": "DC for the alternate skill (typically higher)",
                    "minimum": 1
                }
            },
            "required": ["skillId", "dc"],
            "additionalProperties": false
        },
        "StateTransition": {
            "type": "object",
            "description": "Rule for changing object state via interaction",
            "properties": {
                "fromState": {
                    "type": "string",
                    "description": "Required current state",
                    "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit", "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
                },
                "toState": {
                    "type": "string",
                    "description": "Resulting state after interaction",
                    "enum": ["Closed", "Open", "Locked", "Broken", "Lit", "Unlit", "Active", "Inactive", "Normal", "Triggered", "Down", "Up"]
                },
                "viaInteraction": {
                    "type": "string",
                    "description": "Interaction that causes this transition",
                    "enum": ["Open", "Close", "Examine", "Search", "Activate", "Break", "Unlock", "Lock", "Read", "Use", "Push", "Pull"]
                },
                "requiresSkillCheck": {
                    "type": "boolean",
                    "description": "Whether a skill check is required",
                    "default": false
                },
                "message": {
                    "type": "string",
                    "description": "Feedback text shown on successful transition"
                }
            },
            "required": ["fromState", "toState", "viaInteraction"],
            "additionalProperties": false
        },
        "Reward": {
            "type": "object",
            "description": "Reward granted when reaching a state or completing interaction",
            "properties": {
                "lootTableId": {
                    "type": "string",
                    "description": "Reference to loot table for random drops",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "fixedItems": {
                    "type": "array",
                    "description": "Guaranteed or chance-based specific items",
                    "items": {
                        "$ref": "#/definitions/ItemReward"
                    }
                },
                "goldRange": {
                    "$ref": "#/definitions/QuantityRange",
                    "description": "Range of gold to reward"
                },
                "experienceReward": {
                    "type": "integer",
                    "description": "Experience points granted",
                    "minimum": 0
                },
                "informationText": {
                    "type": "string",
                    "description": "Lore, clue, or other information revealed"
                }
            },
            "additionalProperties": false
        },
        "ItemReward": {
            "type": "object",
            "description": "A specific item reward with quantity and chance",
            "properties": {
                "itemId": {
                    "type": "string",
                    "description": "Reference to item definition",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "quantity": {
                    "type": "integer",
                    "description": "Number of items to grant",
                    "minimum": 1,
                    "default": 1
                },
                "chance": {
                    "type": "number",
                    "description": "Probability of granting this item (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 1.0
                }
            },
            "required": ["itemId"],
            "additionalProperties": false
        },
        "QuantityRange": {
            "type": "object",
            "description": "A range of quantities",
            "properties": {
                "min": {
                    "type": "integer",
                    "description": "Minimum quantity",
                    "minimum": 0
                },
                "max": {
                    "type": "integer",
                    "description": "Maximum quantity",
                    "minimum": 0
                }
            },
            "required": ["min", "max"],
            "additionalProperties": false
        },
        "TrapEffect": {
            "type": "object",
            "description": "Trap configuration for harmful interactive objects",
            "properties": {
                "damage": {
                    "type": "string",
                    "description": "Dice expression for damage (e.g., '2d6', '1d8+2')",
                    "pattern": "^[0-9]+d[0-9]+([+-][0-9]+)?$"
                },
                "damageType": {
                    "type": "string",
                    "description": "Damage type ID (e.g., 'piercing', 'poison', 'fire')",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "statusEffect": {
                    "type": "string",
                    "description": "Status effect ID applied on hit",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "savingThrow": {
                    "$ref": "#/definitions/SavingThrow",
                    "description": "Saving throw to reduce or avoid damage"
                },
                "triggerChance": {
                    "type": "number",
                    "description": "Probability of trap triggering (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 1.0
                },
                "disarmDc": {
                    "type": "integer",
                    "description": "Difficulty class to disarm the trap",
                    "minimum": 1
                }
            },
            "required": ["damage", "damageType"],
            "additionalProperties": false
        },
        "SavingThrow": {
            "type": "object",
            "description": "Saving throw configuration for damage avoidance",
            "properties": {
                "attribute": {
                    "type": "string",
                    "description": "Attribute used for the saving throw",
                    "enum": ["might", "fortitude", "will", "wits", "finesse"]
                },
                "dc": {
                    "type": "integer",
                    "description": "Difficulty class for the saving throw",
                    "minimum": 1
                },
                "halfOnSuccess": {
                    "type": "boolean",
                    "description": "Whether success reduces damage to half instead of negating it",
                    "default": true
                }
            },
            "required": ["attribute", "dc"],
            "additionalProperties": false
        }
    }
}
```

---

## 16. Configuration File Updates

### Existing interactive-objects.json (Validates Without Changes)

The existing `interactive-objects.json` validates against the new schema because all new optional properties are indeed optional. The 12 existing interactive objects contain the required fields.

**File:** `config/interactive-objects.json` (current state - no changes required)

```json
{
    "$schema": "./schemas/interactive-objects.schema.json",
    "interactiveObjects": [
        {
            "id": "iron-door-basic",
            "name": "Heavy Iron Door",
            "description": "A massive iron door with ancient hinges.",
            "objectType": "Door",
            "defaultState": "Closed",
            "allowedInteractions": ["Open", "Close", "Examine"],
            "blocksPassage": true,
            "keywords": ["door", "iron door", "heavy door"]
        },
        {
            "id": "wooden-door-basic",
            "name": "Wooden Door",
            "description": "A sturdy wooden door.",
            "objectType": "Door",
            "defaultState": "Closed",
            "allowedInteractions": ["Open", "Close", "Examine"],
            "blocksPassage": true,
            "keywords": ["door", "wooden door"]
        },
        ...
    ]
}
```

### Example Enhanced interactive-objects.json Entry

If users choose to utilize the new features, entries can be enhanced:

```json
{
    "id": "iron-chest-locked",
    "name": "Locked Iron Chest",
    "description": "A heavy iron chest secured with a complex lock.",
    "objectType": "Chest",
    "defaultState": "Locked",
    "allowedInteractions": ["Unlock", "Open", "Close", "Examine", "Search", "Break"],
    "blocksPassage": false,
    "keywords": ["chest", "iron chest", "locked chest", "strongbox"],
    "skillChecks": {
        "Unlock": {
            "skillId": "lockpicking",
            "dc": 15,
            "alternateSkillId": "perception",
            "alternateDc": 20
        },
        "Break": {
            "skillId": "strength",
            "dc": 18
        }
    },
    "stateTransitions": [
        { "fromState": "Locked", "toState": "Closed", "viaInteraction": "Unlock",
          "requiresSkillCheck": true, "message": "The lock clicks open." },
        { "fromState": "Closed", "toState": "Open", "viaInteraction": "Open",
          "message": "The chest lid swings open." },
        { "fromState": "Open", "toState": "Closed", "viaInteraction": "Close" },
        { "fromState": "Locked", "toState": "Broken", "viaInteraction": "Break",
          "requiresSkillCheck": true, "message": "The chest shatters!" }
    ],
    "rewards": {
        "Open": {
            "lootTableId": "treasure-chest-rare",
            "goldRange": { "min": 50, "max": 150 },
            "experienceReward": 25
        }
    }
}
```

---

## 17. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file. The existing configuration file validates without modification. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file created |

### Schema as Documentation

The schema serves as:
- **Validation contract** for interactive object configuration
- **IDE documentation** via description fields
- **Modding reference** for custom interactive objects
- **Design specification** for interaction mechanics

---

## 18. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 19. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Object Type Enum Validation | ~1 |
| State Enum Validation | ~1 |
| Skill Check DC Validation | ~1 |
| Existing Configuration Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### InteractiveObjectsSchemaTests.cs

```csharp
[TestFixture]
public class InteractiveObjectsSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the existing interactive-objects.json validates against
    /// the schema without errors.
    /// </summary>
    [Test]
    public void InteractiveObjectsJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies objectType must be one of the valid enum values.
    /// </summary>
    [Test]
    public void ObjectType_InvalidEnum_FailsValidation();

    /// <summary>
    /// Verifies defaultState must be one of the valid enum values.
    /// </summary>
    [Test]
    public void DefaultState_InvalidEnum_FailsValidation();

    /// <summary>
    /// Verifies skillChecks.dc must be >= 1.
    /// </summary>
    [Test]
    public void SkillCheckDc_LessThanOne_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results
4. Verify backward compatibility with existing interactive-objects.json

---

## 20. Use Cases

### UC-001: Load Interactive Object Configuration

**Actor:** Game System
**Flow:** System starts -> Loads `interactive-objects.json` -> Schema validates content -> Objects available for room generation

### UC-002: Edit Interactive Objects in IDE

**Actor:** Developer/Modder
**Flow:** Opens `interactive-objects.json` in VS Code -> IDE loads schema -> Autocomplete suggests objectType, defaultState, interactions -> Validation errors shown inline

### UC-003: Add New Interactive Object

**Actor:** Modder
**Flow:** Adds new object to array -> Sets id, name, description -> Selects objectType from enum -> Configures allowedInteractions -> Adds keywords -> IDE validates structure

### UC-004: Configure Skill Checks

**Actor:** Modder
**Flow:** Adds skillChecks object to entry -> Maps interaction to skill check -> Sets skillId and dc -> Optionally adds alternateSkillId -> IDE validates DC >= 1

### UC-005: Configure State Transitions

**Actor:** Modder
**Flow:** Adds stateTransitions array -> Defines from/to/via transitions -> Sets requiresSkillCheck flag -> Adds optional message -> IDE validates enum values

### UC-006: Configure Trap Effect

**Actor:** Modder
**Flow:** Adds trapEffect to Trap object -> Sets damage dice and damageType -> Configures savingThrow -> Sets triggerChance and disarmDc -> IDE validates ranges

### UC-007: Invalid Object Type

**Actor:** Modder
**Flow:** Sets objectType to "Container" (invalid) -> IDE shows error "objectType must be one of: Door, Chest, Lever, ..." -> Modder corrects to valid value

---

## 21. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/interactive-objects.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes 8 definitions (InteractiveObjectDefinition, SkillCheck, StateTransition, Reward, ItemReward, QuantityRange, TrapEffect, SavingThrow)

### Validation Rules
- [ ] Object type enum validation: 14 types
- [ ] State enum validation: 12 states
- [ ] Interaction enum validation: 12 interactions
- [ ] Skill check DC validation (>= 1)
- [ ] Trigger chance range validation (0-1)
- [ ] Item chance range validation (0-1)
- [ ] Dice expression pattern validation
- [ ] ID pattern validation for all references
- [ ] Required fields enforced for all definitions

### Configuration Files
- [ ] Existing `interactive-objects.json` validates against schema
- [ ] All 12 existing interactive objects remain valid

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover enum validation and range validation

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 22. Acceptance Criteria

### Functional
- [ ] `interactive-objects.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `interactive-objects.json` without errors
- [ ] Object type enum validated (14 types)
- [ ] Default state enum validated (12 states)
- [ ] Allowed interactions enum validated (12 interactions)
- [ ] Skill check validated with skill reference and DC
- [ ] State transitions validated with from/to/via
- [ ] Rewards validated with items, gold, experience, loot tables
- [ ] Trap effect validated with damage, saving throw, trigger chance
- [ ] Keywords validated as non-empty string array
- [ ] blocksPassage and blocksLOS validated as booleans
- [ ] VS Code provides autocomplete for enums when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 23. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `skills.json` | `config/` | Skill IDs for skillChecks references |
| `loot-tables.json` | `config/` | Loot table IDs for reward references |
| `items.json` | `config/` | Item IDs for fixedItems references |
| `status-effects.json` | `config/` | Status effect IDs for trapEffect references |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `interactive-objects.schema.json` | Validates interactive object configuration |
| Interactive object IDs | Referenced by room-types.json for feature spawning |
| Door IDs | Referenced by room-types.json for connectionRules.allowedDoorTypes |
| Object type enum | Used by interaction system |
| State enum | Used by object state machine |
| Interaction enum | Used by command parser |

### Implementation Order Note

**v0.14.4d can be implemented in parallel with v0.14.4a, v0.14.4b, and v0.14.4c** as they have no internal dependencies within v0.14.4.

---

## 24. Future Considerations

### Deferred to Future Versions

- **Cross-reference validation**: Validating skillId exists in skills.json
- **Cross-reference validation**: Validating lootTableId exists in loot-tables.json
- **Cross-reference validation**: Validating itemId exists in items.json
- **Cross-reference validation**: Validating damageType exists in damage-types.json
- **Cross-reference validation**: Validating statusEffect exists in status-effects.json
- **Interaction execution logic**: Runtime interaction processing (domain logic)
- **State machine logic**: Runtime state transitions (domain logic)
- **Reward distribution logic**: Runtime reward granting (domain logic)
- **Trap trigger logic**: Runtime trap activation (domain logic)

### Out of Scope

- **Biome schema** (v0.14.4a) - Biomes that reference terrain/objects
- **Room type schema** (v0.14.4b) - Room types that reference interactive objects
- **Terrain schema expansion** (v0.14.4c) - Terrain definitions
- **Runtime interaction handling**: Application-level command processing
- **Object balance tuning**: Specific DC values, damage amounts

### Potential Future Enhancements

If the interactive object system expands, consider adding to the schema:

**Multi-Part Objects:**
```json
"linkedObjects": {
    "type": "array",
    "description": "Other objects affected by this object's state changes",
    "items": {
        "type": "object",
        "properties": {
            "objectId": { "type": "string" },
            "triggerState": { "type": "string" },
            "targetState": { "type": "string" }
        }
    }
}
```

**Timed Effects:**
```json
"timedBehavior": {
    "type": "object",
    "description": "Time-based automatic state changes",
    "properties": {
        "duration": { "type": "integer" },
        "autoTransition": { "$ref": "#/definitions/StateTransition" }
    }
}
```

**Durability:**
```json
"durability": {
    "type": "object",
    "description": "Object health/durability for breakable objects",
    "properties": {
        "maxHp": { "type": "integer", "minimum": 1 },
        "currentHp": { "type": "integer", "minimum": 0 },
        "material": { "type": "string" }
    }
}
```

**Sound Effects:**
```json
"soundEffects": {
    "type": "object",
    "description": "Sound effects for various interactions",
    "additionalProperties": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$"
    }
}
```

**Visual Effects:**
```json
"visualEffects": {
    "type": "object",
    "description": "Visual effects for various states",
    "additionalProperties": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$"
    }
}
```

**Combination Locks:**
```json
"combinationLock": {
    "type": "object",
    "description": "Multi-step unlock sequence",
    "properties": {
        "sequence": { "type": "array", "items": { "type": "string" } },
        "resetOnFailure": { "type": "boolean" },
        "hintText": { "type": "string" }
    }
}
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
