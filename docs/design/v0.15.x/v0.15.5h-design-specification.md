# v0.15.5h Design Specification: Specialization Integration

**Version:** 0.15.5h
**Theme:** Specialization Integration
**Author:** Claude
**Created:** 2026-01-18
**Status:** Draft
**Prerequisites:** v0.15.5a Complete (Extended Tracking System), v0.15.5b Complete (Counter-Tracking System), v0.15.5c Complete (Foraging System), v0.15.5d Complete (Navigation System), v0.15.5e Complete (Hazard Detection System), v0.15.5f Complete (Scavenger Sign Reading), v0.15.5g Complete (Scout Action)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
   - 3.1 [Specialization Bonus Flow Diagram](#31-specialization-bonus-flow-diagram)
   - 3.2 [Ability Activation Flow](#32-ability-activation-flow)
   - 3.3 [Service Interaction Diagram](#33-service-interaction-diagram)
   - 3.4 [Layer Architecture](#34-layer-architecture)
4. [Specialization Ability System](#4-specialization-ability-system)
5. [Veioimaor (Hunter) Abilities](#5-veioimaor-hunter-abilities)
6. [Myr-Stalker Abilities](#6-myr-stalker-abilities)
7. [Gantry-Runner Abilities](#7-gantry-runner-abilities)
8. [ISpecializationBonusService Interface](#8-ispecializationbonusservice-interface)
9. [SpecializationBonusService Implementation](#9-specializationbonusservice-implementation)
10. [Data Model Changes](#10-data-model-changes)
11. [Configuration Files](#11-configuration-files)
    - 11.1 [specialization-abilities.json](#111-specialization-abilitiesjson)
    - 11.2 [specialization-abilities.schema.json](#112-specialization-abilitiesschemajson)
    - 11.3 [Configuration Schema Summary](#113-configuration-schema-summary)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)
19. [Document Metadata](#19-document-metadata)

---

## 1. Executive Summary

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.5h, the Specialization Integration system. This phase implements specialization-specific bonuses and abilities that enhance Wasteland Survival checks based on a character's chosen archetype.

Specializations in Aethelgard represent focused training and expertise that characters develop through their backgrounds and careers. The Veioimaor (Hunter) excels at tracking living creatures and exploiting their weaknesses. The Myr-Stalker masters swamp and marsh environments with resistance to toxins. The Gantry-Runner thrives in industrial ruins, finding paths others miss and scavenging valuable components.

Each specialization provides passive bonuses that automatically apply when conditions are met, as well as active abilities that can be triggered during play. This system rewards players who choose specializations aligned with their playstyle by providing meaningful mechanical advantages in specific situations.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Value Objects** | `SpecializationBonus`, `AbilityActivation`, `HuntingGroundsMarker` |
| **Enums** | `SpecializationType`, `AbilityTrigger` |
| **Interfaces** | `ISpecializationBonusService` |
| **Services** | `SpecializationBonusService` |
| **Configuration** | `specialization-abilities.json` |
| **Tests** | ~2 new unit tests |

### 1.3 Architectural Significance

This version establishes the **specialization bonus pattern** that will be reused for other skill expansions:

- **Conditional bonuses**: Automatic dice pool modifiers when conditions match
- **Active abilities**: Player-triggered effects with specific outcomes
- **Terrain affinity**: Specializations tied to environment types
- **Target affinity**: Specializations tied to creature or object categories

---

## 2. Feature Overview

```
v0.15.5h Specialization Integration
├── Veioimaor (Hunter) Abilities
│   ├── [Beast Tracker] - +2d10 tracking living creatures
│   ├── [Predator's Eye] - Identify creature weaknesses from tracks
│   └── [Hunting Grounds] - Mark area, +2d10 all checks in marked zone
├── Myr-Stalker Abilities
│   ├── [Swamp Navigator] - +1d10 in swamp/marsh terrain
│   ├── [Toxin Resistance] - Advantage on poison hazard saves
│   └── [Mire Knowledge] - Identify safe paths through bog
├── Gantry-Runner Abilities
│   ├── [Urban Navigator] - +1d10 in industrial ruins
│   ├── [Rooftop Routes] - Find elevated paths
│   └── [Scrap Familiar] - +1d10 foraging in ruins
└── Unit Tests (~2)
    ├── Veioimaor bonus applies to creature tracking
    └── Terrain specialization bonuses apply
```

---

## 3. Architecture Diagrams

### 3.1 Specialization Bonus Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SPECIALIZATION BONUS FLOW DIAGRAM                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    Player initiates Wasteland Survival check                                 │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    CHECK PLAYER SPECIALIZATION                      │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  Query player's active specialization:                              │  │
│    │  ├── Veioimaor (Hunter)                                            │  │
│    │  ├── Myr-Stalker                                                   │  │
│    │  ├── Gantry-Runner                                                 │  │
│    │  └── Other (no Wasteland Survival bonuses)                         │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    EVALUATE BONUS CONDITIONS                        │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │                                                                      │  │
│    │  VEIOIMAOR CONDITIONS:                                              │  │
│    │  │ Condition              │ Bonus    │ Ability              │      │  │
│    │  │────────────────────────│──────────│──────────────────────│      │  │
│    │  │ Tracking living target │ +2d10    │ [Beast Tracker]      │      │  │
│    │  │ In marked hunting zone │ +2d10    │ [Hunting Grounds]    │      │  │
│    │  │ Reading creature tracks│ Special  │ [Predator's Eye]     │      │  │
│    │                                                                      │  │
│    │  MYR-STALKER CONDITIONS:                                            │  │
│    │  │ Condition              │ Bonus    │ Ability              │      │  │
│    │  │────────────────────────│──────────│──────────────────────│      │  │
│    │  │ Swamp/marsh terrain    │ +1d10    │ [Swamp Navigator]    │      │  │
│    │  │ Poison hazard check    │ Advntg   │ [Toxin Resistance]   │      │  │
│    │  │ Navigating bog         │ Special  │ [Mire Knowledge]     │      │  │
│    │                                                                      │  │
│    │  GANTRY-RUNNER CONDITIONS:                                          │  │
│    │  │ Condition              │ Bonus    │ Ability              │      │  │
│    │  │────────────────────────│──────────│──────────────────────│      │  │
│    │  │ Industrial ruins       │ +1d10    │ [Urban Navigator]    │      │  │
│    │  │ Foraging in ruins      │ +1d10    │ [Scrap Familiar]     │      │  │
│    │  │ Seeking elevated path  │ Special  │ [Rooftop Routes]     │      │  │
│    │                                                                      │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    APPLY BONUSES TO CHECK                           │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  1. Calculate base dice pool (attribute + skill)                   │  │
│    │  2. Add specialization bonus dice (if conditions met)              │  │
│    │  3. Apply advantage/disadvantage (if applicable)                   │  │
│    │  4. Perform check with modified pool                               │  │
│    │  5. Apply special ability effects (if triggered)                   │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│                ▼                                                             │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    RETURN ENHANCED RESULT                           │  │
│    └─────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Ability Activation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       ABILITY ACTIVATION FLOW                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    PASSIVE ABILITIES (Automatic):                                            │
│    ─────────────────────────────────────────────────────────────────────    │
│                                                                              │
│    ┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐  │
│    │  [Beast Tracker]  │    │ [Swamp Navigator] │    │ [Urban Navigator] │  │
│    ├───────────────────┤    ├───────────────────┤    ├───────────────────┤  │
│    │ Trigger: Track    │    │ Trigger: Terrain  │    │ Trigger: Terrain  │  │
│    │ living creature   │    │ is swamp/marsh    │    │ is industrial     │  │
│    │                   │    │                   │    │                   │  │
│    │ Effect: +2d10     │    │ Effect: +1d10     │    │ Effect: +1d10     │  │
│    │ to tracking check │    │ to all WS checks  │    │ to all WS checks  │  │
│    └───────────────────┘    └───────────────────┘    └───────────────────┘  │
│                                                                              │
│    ┌───────────────────┐    ┌───────────────────┐                           │
│    │[Toxin Resistance] │    │ [Scrap Familiar]  │                           │
│    ├───────────────────┤    ├───────────────────┤                           │
│    │ Trigger: Poison   │    │ Trigger: Foraging │                           │
│    │ hazard save       │    │ in ruins biome    │                           │
│    │                   │    │                   │                           │
│    │ Effect: Advantage │    │ Effect: +1d10     │                           │
│    │ on the save       │    │ to foraging check │                           │
│    └───────────────────┘    └───────────────────┘                           │
│                                                                              │
│    ACTIVE ABILITIES (Player-Triggered):                                      │
│    ─────────────────────────────────────────────────────────────────────    │
│                                                                              │
│    ┌───────────────────┐    ┌───────────────────┐    ┌───────────────────┐  │
│    │ [Predator's Eye]  │    │ [Mire Knowledge]  │    │ [Rooftop Routes]  │  │
│    ├───────────────────┤    ├───────────────────┤    ├───────────────────┤  │
│    │ Activation: After │    │ Activation: When  │    │ Activation: When  │  │
│    │ successful track  │    │ navigating bog    │    │ seeking path in   │  │
│    │                   │    │                   │    │ industrial area   │  │
│    │ Effect: Learn     │    │ Effect: Identify  │    │ Effect: Find      │  │
│    │ creature weakness │    │ safe path through │    │ elevated route    │  │
│    │ (damage type,     │    │ treacherous mire  │    │ avoiding ground   │  │
│    │ behavior pattern) │    │ (auto-avoid pits) │    │ hazards           │  │
│    └───────────────────┘    └───────────────────┘    └───────────────────┘  │
│                                                                              │
│    ┌───────────────────┐                                                    │
│    │ [Hunting Grounds] │                                                    │
│    ├───────────────────┤                                                    │
│    │ Activation: Mark  │                                                    │
│    │ current area      │                                                    │
│    │                   │                                                    │
│    │ Effect: Create    │                                                    │
│    │ zone where all    │                                                    │
│    │ WS checks get     │                                                    │
│    │ +2d10 bonus       │                                                    │
│    │                   │                                                    │
│    │ Duration: Until   │                                                    │
│    │ rest or new mark  │                                                    │
│    └───────────────────┘                                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Interaction Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SERVICE INTERACTION DIAGRAM                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                   WASTELAND SURVIVAL CHECK                          │   │
│   │                      (Any WS subsystem)                             │   │
│   └─────────────────────────────┬───────────────────────────────────────┘   │
│                                 │                                            │
│                       requests bonuses                                      │
│                                 │                                            │
│                                 ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │               SPECIALIZATION BONUS SERVICE                          │   │
│   │                (ISpecializationBonusService)                        │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  + GetBonusesForCheck(player, context)                              │   │
│   │  + HasAbility(player, abilityId)                                    │   │
│   │  + ActivateAbility(player, abilityId, context)                      │   │
│   │  + GetActiveHuntingGrounds(playerId)                                │   │
│   │  + MarkHuntingGrounds(player, areaId)                               │   │
│   │  + GetPassiveBonuses(player, checkType, terrain, targetType)        │   │
│   └──────────┬──────────────────────────┬───────────────────────────────┘   │
│              │                          │                                    │
│    queries player               loads ability data                          │
│              │                          │                                    │
│              ▼                          ▼                                    │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │    PLAYER SERVICE       │  │  CONFIGURATION LOADER   │                  │
│   │    (IPlayerService)     │  │  (IConfigurationLoader) │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ + GetSpecialization()   │  │ + LoadAbilities()       │                  │
│   │ + GetKnownAbilities()   │  │ + LoadBonusConditions() │                  │
│   │ + GetMarkedAreas()      │  │ + LoadTerrainMappings() │                  │
│   └─────────────────────────┘  └─────────────────────────┘                  │
│                                                                              │
│   Data Flow:                                                                │
│   ─────────────────────────────────────────────────────────────────────    │
│   1. WS subsystem (tracking, foraging, etc.) initiates check               │
│   2. SpecializationBonusService queries player's specialization            │
│   3. Match check context against ability trigger conditions                │
│   4. Calculate applicable passive bonuses (dice pool modifiers)            │
│   5. Return bonuses to be applied to the check                             │
│   6. For active abilities, return special effects to apply post-check      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Enums/                                                              │    │
│  │  ├── SpecializationType.cs                                          │    │
│  │  │   └── Veioimaor, MyrStalker, GantryRunner, Other                │    │
│  │  │                                                                   │    │
│  │  └── AbilityTrigger.cs                                              │    │
│  │      └── TrackingLivingCreature, SwampTerrain, IndustrialTerrain,  │    │
│  │          PoisonHazard, ForagingInRuins, InHuntingGrounds            │    │
│  │                                                                      │    │
│  │  ValueObjects/                                                       │    │
│  │  ├── SpecializationBonus.cs                                         │    │
│  │  │   └── AbilityId, BonusDice, BonusType, Description              │    │
│  │  │                                                                   │    │
│  │  ├── AbilityActivation.cs                                           │    │
│  │  │   └── AbilityId, ActivationType, EffectDescription,             │    │
│  │  │       AdditionalData                                             │    │
│  │  │                                                                   │    │
│  │  └── HuntingGroundsMarker.cs                                        │    │
│  │      └── PlayerId, AreaId, MarkedAt, ExpiresAt                     │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                         │    │
│  │  └── ISpecializationBonusService.cs                                 │    │
│  │      ├── GetBonusesForCheck(player, context)                        │    │
│  │      ├── HasAbility(player, abilityId)                              │    │
│  │      ├── ActivateAbility(player, abilityId, context)                │    │
│  │      ├── GetActiveHuntingGrounds(playerId)                          │    │
│  │      ├── MarkHuntingGrounds(player, areaId)                         │    │
│  │      └── GetPassiveBonuses(player, checkType, terrain, targetType)  │    │
│  │                                                                      │    │
│  │  Services/                                                           │    │
│  │  └── SpecializationBonusService.cs                                  │    │
│  │      └── Implements ISpecializationBonusService                     │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   INFRASTRUCTURE LAYER                               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  config/                                                             │    │
│  │  ├── specialization-abilities.json                                  │    │
│  │  │   └── Ability definitions, triggers, bonuses                     │    │
│  │  │                                                                   │    │
│  │  └── schemas/                                                        │    │
│  │      └── specialization-abilities.schema.json                       │    │
│  │          └── JSON Schema validation                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Specialization Ability System

### 4.1 Purpose

The specialization ability system provides a framework for applying archetype-specific bonuses to Wasteland Survival checks. It distinguishes between passive abilities (automatically applied when conditions are met) and active abilities (player-triggered with special effects).

### 4.2 Ability Categories

| Category | Trigger | Examples |
|----------|---------|----------|
| **Passive Dice Bonus** | Automatic when condition matches | Beast Tracker, Swamp Navigator |
| **Passive Advantage** | Automatic advantage on specific checks | Toxin Resistance |
| **Active Effect** | Player triggers after successful check | Predator's Eye, Mire Knowledge |
| **Zone Marker** | Player marks area for persistent bonus | Hunting Grounds |

### 4.3 SpecializationBonus Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SpecializationBonus.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a bonus from a specialization ability.
/// </summary>
/// <remarks>
/// SpecializationBonus encapsulates the mechanical effect of a specialization ability:
/// - AbilityId identifies which ability granted the bonus
/// - BonusDice is the number of extra dice to add to the pool
/// - BonusType indicates if this is dice, advantage, or special effect
/// - Description provides player-facing explanation
/// </remarks>
/// <param name="AbilityId">Identifier for the ability granting the bonus.</param>
/// <param name="BonusDice">Number of bonus dice to add (0 if not applicable).</param>
/// <param name="BonusType">Type of bonus being applied.</param>
/// <param name="Description">Player-facing description of the bonus.</param>
public readonly record struct SpecializationBonus(
    string AbilityId,
    int BonusDice,
    SpecializationBonusType BonusType,
    string Description)
{
    /// <summary>
    /// Gets whether this bonus adds dice to the pool.
    /// </summary>
    public bool AddsDice => BonusDice > 0;

    /// <summary>
    /// Gets whether this bonus grants advantage.
    /// </summary>
    public bool GrantsAdvantage => BonusType == SpecializationBonusType.Advantage;

    /// <summary>
    /// Creates a dice pool bonus.
    /// </summary>
    public static SpecializationBonus DiceBonus(string abilityId, int dice, string description) =>
        new(abilityId, dice, SpecializationBonusType.DicePool, description);

    /// <summary>
    /// Creates an advantage bonus.
    /// </summary>
    public static SpecializationBonus Advantage(string abilityId, string description) =>
        new(abilityId, 0, SpecializationBonusType.Advantage, description);

    /// <summary>
    /// Creates a display string for this bonus.
    /// </summary>
    public string ToDisplayString() => BonusType switch
    {
        SpecializationBonusType.DicePool => $"[{AbilityId}] +{BonusDice}d10: {Description}",
        SpecializationBonusType.Advantage => $"[{AbilityId}] Advantage: {Description}",
        _ => $"[{AbilityId}]: {Description}"
    };
}

/// <summary>
/// Types of specialization bonuses.
/// </summary>
public enum SpecializationBonusType
{
    /// <summary>Adds dice to the pool.</summary>
    DicePool = 0,

    /// <summary>Grants advantage on the check.</summary>
    Advantage = 1,

    /// <summary>Provides a special effect after the check.</summary>
    SpecialEffect = 2
}
```

### 4.4 AbilityActivation Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/AbilityActivation.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the activation of an active specialization ability.
/// </summary>
/// <remarks>
/// AbilityActivation captures the result of triggering an active ability:
/// - Used for abilities like Predator's Eye, Mire Knowledge, Rooftop Routes
/// - Contains the effect description and any additional data
/// - May include information about creature weaknesses, safe paths, etc.
/// </remarks>
/// <param name="AbilityId">Identifier for the activated ability.</param>
/// <param name="ActivationType">How the ability was activated.</param>
/// <param name="EffectDescription">Description of the ability's effect.</param>
/// <param name="AdditionalData">Context-specific data from the activation.</param>
public readonly record struct AbilityActivation(
    string AbilityId,
    AbilityActivationType ActivationType,
    string EffectDescription,
    IReadOnlyDictionary<string, string>? AdditionalData)
{
    /// <summary>
    /// Gets whether this activation provides additional information.
    /// </summary>
    public bool HasAdditionalData => AdditionalData?.Count > 0;

    /// <summary>
    /// Creates an activation for Predator's Eye.
    /// </summary>
    public static AbilityActivation PredatorsEye(
        string creatureType,
        string weakness,
        string behaviorPattern) =>
        new(
            "predators-eye",
            AbilityActivationType.PostCheck,
            $"Your hunter's instincts reveal details about the {creatureType}.",
            new Dictionary<string, string>
            {
                ["creatureType"] = creatureType,
                ["weakness"] = weakness,
                ["behaviorPattern"] = behaviorPattern
            });

    /// <summary>
    /// Creates an activation for Mire Knowledge.
    /// </summary>
    public static AbilityActivation MireKnowledge(string safePath) =>
        new(
            "mire-knowledge",
            AbilityActivationType.PathReveal,
            "Your knowledge of the mire reveals a safe path through the treacherous terrain.",
            new Dictionary<string, string>
            {
                ["safePath"] = safePath
            });

    /// <summary>
    /// Creates an activation for Rooftop Routes.
    /// </summary>
    public static AbilityActivation RooftopRoutes(string elevatedPath) =>
        new(
            "rooftop-routes",
            AbilityActivationType.PathReveal,
            "You spot a route across the rooftops and elevated gantries.",
            new Dictionary<string, string>
            {
                ["elevatedPath"] = elevatedPath
            });

    /// <summary>
    /// Creates a display string for this activation.
    /// </summary>
    public string ToDisplayString()
    {
        var result = $"[{AbilityId}] {EffectDescription}";

        if (HasAdditionalData)
        {
            foreach (var kvp in AdditionalData!)
            {
                result += $"\n  {kvp.Key}: {kvp.Value}";
            }
        }

        return result;
    }
}

/// <summary>
/// How an active ability is activated.
/// </summary>
public enum AbilityActivationType
{
    /// <summary>Activated after a successful check.</summary>
    PostCheck = 0,

    /// <summary>Reveals a path or route.</summary>
    PathReveal = 1,

    /// <summary>Marks an area for persistent effects.</summary>
    ZoneMarker = 2
}
```

---

## 5. Veioimaor (Hunter) Abilities

### 5.1 Overview

The Veioimaor specialization focuses on tracking and hunting living creatures. Hunters gain significant bonuses when pursuing prey and can learn creature weaknesses from their tracks.

### 5.2 [Beast Tracker]

**Type:** Passive Dice Bonus
**Trigger:** Tracking a living creature
**Effect:** +2d10 to tracking checks

```csharp
/// <summary>
/// Checks if Beast Tracker bonus applies.
/// </summary>
public bool BeastTrackerApplies(TrackingContext context)
{
    return context.TargetType == TargetType.LivingCreature;
}

/// <summary>
/// Gets the Beast Tracker bonus.
/// </summary>
public SpecializationBonus GetBeastTrackerBonus()
{
    return SpecializationBonus.DiceBonus(
        "beast-tracker",
        2,
        "Your hunter training grants insight into creature movements.");
}
```

### 5.3 [Predator's Eye]

**Type:** Active Effect
**Trigger:** After successful creature tracking
**Effect:** Reveals creature weakness (damage vulnerability) and behavior pattern

```csharp
/// <summary>
/// Activates Predator's Eye after successful creature tracking.
/// </summary>
public AbilityActivation ActivatePredatorsEye(TrackingResult trackResult)
{
    var creatureInfo = GetCreatureInfo(trackResult.TargetDescription);

    return AbilityActivation.PredatorsEye(
        creatureInfo.Type,
        creatureInfo.Weakness,
        creatureInfo.BehaviorPattern);
}
```

| Creature Type | Weakness Example | Behavior Pattern Example |
|---------------|------------------|--------------------------|
| Beast | Fire vulnerability | Territorial, attacks intruders |
| Predator | Flanking effective | Stalks prey, ambush attacks |
| Scavenger | Loud noises startle | Flees when outnumbered |
| Swarm | Area damage | Disperses, reforms elsewhere |

### 5.4 [Hunting Grounds]

**Type:** Zone Marker (Active)
**Trigger:** Player marks current area
**Effect:** +2d10 to all Wasteland Survival checks in marked zone
**Duration:** Until rest or new area marked

```csharp
/// <summary>
/// Represents a marked hunting grounds zone.
/// </summary>
public readonly record struct HuntingGroundsMarker(
    string PlayerId,
    string AreaId,
    DateTime MarkedAt,
    DateTime? ExpiresAt)
{
    /// <summary>
    /// Gets whether this marker is still active.
    /// </summary>
    public bool IsActive => ExpiresAt == null || DateTime.UtcNow < ExpiresAt;

    /// <summary>
    /// Gets the bonus provided by hunting grounds.
    /// </summary>
    public SpecializationBonus GetBonus() =>
        SpecializationBonus.DiceBonus(
            "hunting-grounds",
            2,
            "You know this area intimately—every hiding spot, every trail.");
}
```

---

## 6. Myr-Stalker Abilities

### 6.1 Overview

The Myr-Stalker specialization focuses on swamp and marsh environments. These characters have adapted to toxic conditions and can navigate treacherous mires safely.

### 6.2 [Swamp Navigator]

**Type:** Passive Dice Bonus
**Trigger:** Terrain is swamp or marsh
**Effect:** +1d10 to all Wasteland Survival checks

```csharp
/// <summary>
/// Checks if Swamp Navigator bonus applies.
/// </summary>
public bool SwampNavigatorApplies(TerrainType terrain)
{
    return terrain == TerrainType.Swamp || terrain == TerrainType.Marsh;
}

/// <summary>
/// Gets the Swamp Navigator bonus.
/// </summary>
public SpecializationBonus GetSwampNavigatorBonus()
{
    return SpecializationBonus.DiceBonus(
        "swamp-navigator",
        1,
        "The mire is your home—you read its signs instinctively.");
}
```

### 6.3 [Toxin Resistance]

**Type:** Passive Advantage
**Trigger:** Making a save against poison hazard
**Effect:** Advantage on poison hazard saves

```csharp
/// <summary>
/// Checks if Toxin Resistance applies.
/// </summary>
public bool ToxinResistanceApplies(HazardType hazardType)
{
    return hazardType == HazardType.ToxicZone;
}

/// <summary>
/// Gets the Toxin Resistance bonus.
/// </summary>
public SpecializationBonus GetToxinResistanceBonus()
{
    return SpecializationBonus.Advantage(
        "toxin-resistance",
        "Years in the swamp have hardened you against poisons.");
}
```

### 6.4 [Mire Knowledge]

**Type:** Active Effect
**Trigger:** When navigating through bog terrain
**Effect:** Identifies safe path, automatically avoids hidden pits

```csharp
/// <summary>
/// Activates Mire Knowledge when navigating bog.
/// </summary>
public AbilityActivation ActivateMireKnowledge(NavigationContext context)
{
    var safePath = CalculateSafePath(context);

    return AbilityActivation.MireKnowledge(safePath);
}
```

---

## 7. Gantry-Runner Abilities

### 7.1 Overview

The Gantry-Runner specialization focuses on industrial ruins and urban wasteland environments. These characters excel at navigating vertical spaces and finding valuable salvage.

### 7.2 [Urban Navigator]

**Type:** Passive Dice Bonus
**Trigger:** Terrain is industrial ruins (ModerateRuins, DenseRuins with industrial tag)
**Effect:** +1d10 to all Wasteland Survival checks

```csharp
/// <summary>
/// Checks if Urban Navigator bonus applies.
/// </summary>
public bool UrbanNavigatorApplies(TerrainType terrain, BiomeType biome)
{
    return (terrain == TerrainType.ModerateRuins || terrain == TerrainType.DenseRuins)
           && biome == BiomeType.Industrial;
}

/// <summary>
/// Gets the Urban Navigator bonus.
/// </summary>
public SpecializationBonus GetUrbanNavigatorBonus()
{
    return SpecializationBonus.DiceBonus(
        "urban-navigator",
        1,
        "You know the patterns of industrial decay—where floors hold, where they don't.");
}
```

### 7.3 [Rooftop Routes]

**Type:** Active Effect
**Trigger:** Seeking elevated path in industrial area
**Effect:** Reveals elevated route that avoids ground-level hazards

```csharp
/// <summary>
/// Activates Rooftop Routes when seeking elevated path.
/// </summary>
public AbilityActivation ActivateRooftopRoutes(NavigationContext context)
{
    var elevatedPath = FindElevatedPath(context);

    return AbilityActivation.RooftopRoutes(elevatedPath);
}
```

### 7.4 [Scrap Familiar]

**Type:** Passive Dice Bonus
**Trigger:** Foraging in ruins biome
**Effect:** +1d10 to foraging checks

```csharp
/// <summary>
/// Checks if Scrap Familiar bonus applies.
/// </summary>
public bool ScrapFamiliarApplies(ForagingContext context)
{
    return context.BiomeType == BiomeType.Ruins || context.BiomeType == BiomeType.Industrial;
}

/// <summary>
/// Gets the Scrap Familiar bonus.
/// </summary>
public SpecializationBonus GetScrapFamiliarBonus()
{
    return SpecializationBonus.DiceBonus(
        "scrap-familiar",
        1,
        "You know where the good salvage hides—behind panels, under debris, in forgotten corners.");
}
```

---

## 8. ISpecializationBonusService Interface

### 8.1 Purpose

The `ISpecializationBonusService` interface defines the contract for retrieving and applying specialization bonuses to Wasteland Survival checks.

### 8.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Interfaces/ISpecializationBonusService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service interface for specialization bonuses in the Wasteland Survival system.
/// </summary>
public interface ISpecializationBonusService
{
    /// <summary>
    /// Gets all applicable bonuses for a Wasteland Survival check.
    /// </summary>
    /// <param name="player">The player making the check.</param>
    /// <param name="checkType">The type of WS check being made.</param>
    /// <param name="terrain">The current terrain type.</param>
    /// <param name="targetType">The target type (for tracking).</param>
    /// <returns>List of applicable bonuses.</returns>
    IReadOnlyList<SpecializationBonus> GetBonusesForCheck(
        Player player,
        WastelandSurvivalCheckType checkType,
        TerrainType terrain,
        TargetType? targetType = null);

    /// <summary>
    /// Checks if a player has a specific ability.
    /// </summary>
    /// <param name="player">The player to check.</param>
    /// <param name="abilityId">The ability identifier.</param>
    /// <returns>True if the player has the ability.</returns>
    bool HasAbility(Player player, string abilityId);

    /// <summary>
    /// Activates an active ability.
    /// </summary>
    /// <param name="player">The player activating the ability.</param>
    /// <param name="abilityId">The ability to activate.</param>
    /// <param name="context">Context for the activation.</param>
    /// <returns>The activation result.</returns>
    AbilityActivation? ActivateAbility(
        Player player,
        string abilityId,
        object context);

    /// <summary>
    /// Gets the player's active hunting grounds marker.
    /// </summary>
    /// <param name="playerId">The player's identifier.</param>
    /// <returns>The active hunting grounds marker, or null.</returns>
    HuntingGroundsMarker? GetActiveHuntingGrounds(string playerId);

    /// <summary>
    /// Marks an area as hunting grounds.
    /// </summary>
    /// <param name="player">The player marking the area.</param>
    /// <param name="areaId">The area to mark.</param>
    /// <returns>The created marker.</returns>
    HuntingGroundsMarker MarkHuntingGrounds(Player player, string areaId);

    /// <summary>
    /// Clears the player's hunting grounds marker.
    /// </summary>
    /// <param name="playerId">The player's identifier.</param>
    void ClearHuntingGrounds(string playerId);

    /// <summary>
    /// Gets the total bonus dice from all applicable passive abilities.
    /// </summary>
    /// <param name="player">The player making the check.</param>
    /// <param name="checkType">The type of check.</param>
    /// <param name="terrain">The terrain type.</param>
    /// <param name="targetType">The target type.</param>
    /// <returns>Total bonus dice to add.</returns>
    int GetTotalBonusDice(
        Player player,
        WastelandSurvivalCheckType checkType,
        TerrainType terrain,
        TargetType? targetType = null);

    /// <summary>
    /// Checks if the player has advantage on this check from specialization.
    /// </summary>
    /// <param name="player">The player making the check.</param>
    /// <param name="checkType">The type of check.</param>
    /// <param name="hazardType">The hazard type (if applicable).</param>
    /// <returns>True if specialization grants advantage.</returns>
    bool HasAdvantage(
        Player player,
        WastelandSurvivalCheckType checkType,
        HazardType? hazardType = null);
}
```

---

## 9. SpecializationBonusService Implementation

### 9.1 Purpose

The `SpecializationBonusService` implements the specialization bonus system, evaluating conditions and applying appropriate bonuses based on player archetype.

### 9.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Services/SpecializationBonusService.cs`

```csharp
namespace RuneAndRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Implements specialization bonuses for the Wasteland Survival system.
/// </summary>
/// <remarks>
/// The SpecializationBonusService handles:
///
/// Veioimaor (Hunter):
/// - Beast Tracker: +2d10 when tracking living creatures
/// - Predator's Eye: Learn creature weakness after successful track
/// - Hunting Grounds: Mark area for +2d10 to all WS checks
///
/// Myr-Stalker:
/// - Swamp Navigator: +1d10 in swamp/marsh terrain
/// - Toxin Resistance: Advantage on poison hazard saves
/// - Mire Knowledge: Identify safe paths through bog
///
/// Gantry-Runner:
/// - Urban Navigator: +1d10 in industrial ruins
/// - Rooftop Routes: Find elevated paths
/// - Scrap Familiar: +1d10 foraging in ruins
/// </remarks>
public class SpecializationBonusService : ISpecializationBonusService
{
    private readonly IPlayerService _playerService;
    private readonly IConfigurationLoader _configLoader;
    private readonly ILogger<SpecializationBonusService> _logger;

    // In-memory storage for hunting grounds markers
    private readonly Dictionary<string, HuntingGroundsMarker> _huntingGrounds = new();

    public SpecializationBonusService(
        IPlayerService playerService,
        IConfigurationLoader configLoader,
        ILogger<SpecializationBonusService> logger)
    {
        _playerService = playerService;
        _configLoader = configLoader;
        _logger = logger;
    }

    /// <inheritdoc />
    public IReadOnlyList<SpecializationBonus> GetBonusesForCheck(
        Player player,
        WastelandSurvivalCheckType checkType,
        TerrainType terrain,
        TargetType? targetType = null)
    {
        var bonuses = new List<SpecializationBonus>();
        var specialization = player.Specialization;

        _logger.LogDebug(
            "Evaluating specialization bonuses for {PlayerId} ({Spec}) - Check: {Check}, Terrain: {Terrain}",
            player.Id, specialization, checkType, terrain);

        switch (specialization)
        {
            case SpecializationType.Veioimaor:
                bonuses.AddRange(GetVeioimaorBonuses(player, checkType, targetType));
                break;

            case SpecializationType.MyrStalker:
                bonuses.AddRange(GetMyrStalkerBonuses(checkType, terrain));
                break;

            case SpecializationType.GantryRunner:
                bonuses.AddRange(GetGantryRunnerBonuses(checkType, terrain));
                break;
        }

        // Check hunting grounds for all specializations
        var huntingGrounds = GetActiveHuntingGrounds(player.Id);
        if (huntingGrounds != null && IsInHuntingGrounds(player, huntingGrounds.Value))
        {
            bonuses.Add(huntingGrounds.Value.GetBonus());
        }

        _logger.LogDebug(
            "Found {Count} applicable bonuses for {PlayerId}",
            bonuses.Count, player.Id);

        return bonuses;
    }

    private IEnumerable<SpecializationBonus> GetVeioimaorBonuses(
        Player player,
        WastelandSurvivalCheckType checkType,
        TargetType? targetType)
    {
        // Beast Tracker: +2d10 when tracking living creatures
        if (checkType == WastelandSurvivalCheckType.Tracking &&
            targetType == TargetType.LivingCreature)
        {
            yield return SpecializationBonus.DiceBonus(
                "beast-tracker",
                2,
                "Your hunter training grants insight into creature movements.");
        }
    }

    private IEnumerable<SpecializationBonus> GetMyrStalkerBonuses(
        WastelandSurvivalCheckType checkType,
        TerrainType terrain)
    {
        // Swamp Navigator: +1d10 in swamp/marsh terrain
        if (terrain == TerrainType.Swamp || terrain == TerrainType.Marsh)
        {
            yield return SpecializationBonus.DiceBonus(
                "swamp-navigator",
                1,
                "The mire is your home—you read its signs instinctively.");
        }
    }

    private IEnumerable<SpecializationBonus> GetGantryRunnerBonuses(
        WastelandSurvivalCheckType checkType,
        TerrainType terrain)
    {
        // Urban Navigator: +1d10 in industrial ruins
        if (terrain == TerrainType.ModerateRuins || terrain == TerrainType.DenseRuins)
        {
            yield return SpecializationBonus.DiceBonus(
                "urban-navigator",
                1,
                "You know the patterns of industrial decay.");
        }

        // Scrap Familiar: +1d10 foraging in ruins
        if (checkType == WastelandSurvivalCheckType.Foraging &&
            (terrain == TerrainType.ModerateRuins || terrain == TerrainType.DenseRuins))
        {
            yield return SpecializationBonus.DiceBonus(
                "scrap-familiar",
                1,
                "You know where the good salvage hides.");
        }
    }

    /// <inheritdoc />
    public bool HasAbility(Player player, string abilityId)
    {
        var abilities = GetAbilitiesForSpecialization(player.Specialization);
        return abilities.Contains(abilityId);
    }

    /// <inheritdoc />
    public AbilityActivation? ActivateAbility(
        Player player,
        string abilityId,
        object context)
    {
        if (!HasAbility(player, abilityId))
        {
            _logger.LogWarning(
                "Player {PlayerId} attempted to activate ability {AbilityId} they don't have",
                player.Id, abilityId);
            return null;
        }

        _logger.LogInformation(
            "Player {PlayerId} activating ability {AbilityId}",
            player.Id, abilityId);

        return abilityId switch
        {
            "predators-eye" when context is TrackingResult trackResult =>
                ActivatePredatorsEye(trackResult),
            "mire-knowledge" when context is NavigationContext navContext =>
                ActivateMireKnowledge(navContext),
            "rooftop-routes" when context is NavigationContext navContext =>
                ActivateRooftopRoutes(navContext),
            _ => null
        };
    }

    private AbilityActivation ActivatePredatorsEye(TrackingResult trackResult)
    {
        // Get creature information from configuration
        var creatureInfo = _configLoader.GetCreatureInfo(trackResult.TargetDescription);

        return AbilityActivation.PredatorsEye(
            creatureInfo?.Type ?? "unknown creature",
            creatureInfo?.Weakness ?? "no obvious weakness",
            creatureInfo?.BehaviorPattern ?? "unpredictable behavior");
    }

    private AbilityActivation ActivateMireKnowledge(NavigationContext context)
    {
        var safePath = $"Follow the moss line heading {context.Destination}—the ground is firm there.";
        return AbilityActivation.MireKnowledge(safePath);
    }

    private AbilityActivation ActivateRooftopRoutes(NavigationContext context)
    {
        var elevatedPath = $"The gantries above connect to {context.Destination}—climb the rusted ladder here.";
        return AbilityActivation.RooftopRoutes(elevatedPath);
    }

    /// <inheritdoc />
    public HuntingGroundsMarker? GetActiveHuntingGrounds(string playerId)
    {
        if (_huntingGrounds.TryGetValue(playerId, out var marker) && marker.IsActive)
        {
            return marker;
        }
        return null;
    }

    /// <inheritdoc />
    public HuntingGroundsMarker MarkHuntingGrounds(Player player, string areaId)
    {
        if (player.Specialization != SpecializationType.Veioimaor)
        {
            throw new InvalidOperationException(
                "Only Veioimaor specialization can mark hunting grounds.");
        }

        var marker = new HuntingGroundsMarker(
            player.Id,
            areaId,
            DateTime.UtcNow,
            null // No expiration until rest
        );

        _huntingGrounds[player.Id] = marker;

        _logger.LogInformation(
            "Player {PlayerId} marked area {AreaId} as hunting grounds",
            player.Id, areaId);

        return marker;
    }

    /// <inheritdoc />
    public void ClearHuntingGrounds(string playerId)
    {
        if (_huntingGrounds.Remove(playerId))
        {
            _logger.LogDebug("Cleared hunting grounds for player {PlayerId}", playerId);
        }
    }

    /// <inheritdoc />
    public int GetTotalBonusDice(
        Player player,
        WastelandSurvivalCheckType checkType,
        TerrainType terrain,
        TargetType? targetType = null)
    {
        var bonuses = GetBonusesForCheck(player, checkType, terrain, targetType);
        return bonuses.Where(b => b.AddsDice).Sum(b => b.BonusDice);
    }

    /// <inheritdoc />
    public bool HasAdvantage(
        Player player,
        WastelandSurvivalCheckType checkType,
        HazardType? hazardType = null)
    {
        // Toxin Resistance: Advantage on poison hazard saves
        if (player.Specialization == SpecializationType.MyrStalker &&
            checkType == WastelandSurvivalCheckType.HazardDetection &&
            hazardType == HazardType.ToxicZone)
        {
            return true;
        }

        return false;
    }

    private bool IsInHuntingGrounds(Player player, HuntingGroundsMarker marker)
    {
        // Check if player's current area matches the marked area
        var currentAreaId = _playerService.GetCurrentAreaId(player.Id);
        return currentAreaId == marker.AreaId;
    }

    private static HashSet<string> GetAbilitiesForSpecialization(SpecializationType spec)
    {
        return spec switch
        {
            SpecializationType.Veioimaor => new HashSet<string>
            {
                "beast-tracker",
                "predators-eye",
                "hunting-grounds"
            },
            SpecializationType.MyrStalker => new HashSet<string>
            {
                "swamp-navigator",
                "toxin-resistance",
                "mire-knowledge"
            },
            SpecializationType.GantryRunner => new HashSet<string>
            {
                "urban-navigator",
                "rooftop-routes",
                "scrap-familiar"
            },
            _ => new HashSet<string>()
        };
    }
}
```

---

## 10. Data Model Changes

### 10.1 New Enums

| Enum | Layer | Description |
|------|-------|-------------|
| `SpecializationType` | Domain | Character specialization archetypes |
| `AbilityTrigger` | Domain | Conditions that trigger abilities |
| `SpecializationBonusType` | Domain | Types of bonuses (dice, advantage, effect) |
| `AbilityActivationType` | Domain | How active abilities are triggered |
| `WastelandSurvivalCheckType` | Domain | Categories of WS checks |
| `TargetType` | Domain | Target categories for tracking |

### 10.2 New Value Objects

| Value Object | Layer | Description |
|--------------|-------|-------------|
| `SpecializationBonus` | Domain | Bonus from specialization ability |
| `AbilityActivation` | Domain | Result of activating an ability |
| `HuntingGroundsMarker` | Domain | Marked hunting grounds zone |

### 10.3 New Interfaces

| Interface | Layer | Description |
|-----------|-------|-------------|
| `ISpecializationBonusService` | Application | Specialization bonus service contract |

### 10.4 New Services

| Service | Layer | Description |
|---------|-------|-------------|
| `SpecializationBonusService` | Application | Specialization bonus implementation |

### 10.5 SpecializationType Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/SpecializationType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Character specialization archetypes with Wasteland Survival bonuses.
/// </summary>
public enum SpecializationType
{
    /// <summary>No specialization or specialization without WS bonuses.</summary>
    None = 0,

    /// <summary>Hunter specialization - tracking and creature expertise.</summary>
    Veioimaor = 1,

    /// <summary>Swamp stalker - marsh terrain and toxin resistance.</summary>
    MyrStalker = 2,

    /// <summary>Urban explorer - industrial ruins and scavenging.</summary>
    GantryRunner = 3
}
```

### 10.6 WastelandSurvivalCheckType Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/WastelandSurvivalCheckType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories of Wasteland Survival checks.
/// </summary>
public enum WastelandSurvivalCheckType
{
    /// <summary>General survival check.</summary>
    General = 0,

    /// <summary>Tracking a target.</summary>
    Tracking = 1,

    /// <summary>Foraging for resources.</summary>
    Foraging = 2,

    /// <summary>Navigating terrain.</summary>
    Navigation = 3,

    /// <summary>Detecting hazards.</summary>
    HazardDetection = 4,

    /// <summary>Interpreting scavenger signs.</summary>
    SignReading = 5,

    /// <summary>Scouting adjacent areas.</summary>
    Scouting = 6
}
```

### 10.7 TargetType Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/TargetType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories of tracking targets.
/// </summary>
public enum TargetType
{
    /// <summary>Unknown or unspecified target.</summary>
    Unknown = 0,

    /// <summary>Living creature (beast, predator, humanoid).</summary>
    LivingCreature = 1,

    /// <summary>Mechanical or construct target.</summary>
    Construct = 2,

    /// <summary>Vehicle or transport.</summary>
    Vehicle = 3,

    /// <summary>Group of targets.</summary>
    Group = 4
}
```

---

## 11. Configuration Files

### 11.1 specialization-abilities.json

**File:** `config/specialization-abilities.json`

```json
{
    "$schema": "./schemas/specialization-abilities.schema.json",
    "specializations": [
        {
            "id": "veioimaor",
            "displayName": "Veioimaor (Hunter)",
            "description": "Hunters who excel at tracking and exploiting creature weaknesses.",
            "abilities": [
                {
                    "id": "beast-tracker",
                    "displayName": "Beast Tracker",
                    "type": "passive",
                    "trigger": "tracking-living-creature",
                    "bonusType": "dice",
                    "bonusValue": 2,
                    "description": "Your hunter training grants insight into creature movements."
                },
                {
                    "id": "predators-eye",
                    "displayName": "Predator's Eye",
                    "type": "active",
                    "trigger": "post-successful-tracking",
                    "bonusType": "special",
                    "description": "Identify creature weakness and behavior pattern from tracks."
                },
                {
                    "id": "hunting-grounds",
                    "displayName": "Hunting Grounds",
                    "type": "active",
                    "trigger": "player-activation",
                    "bonusType": "zone",
                    "bonusValue": 2,
                    "duration": "until-rest",
                    "description": "Mark an area as your hunting grounds. +2d10 to all WS checks in the zone."
                }
            ]
        },
        {
            "id": "myr-stalker",
            "displayName": "Myr-Stalker",
            "description": "Swamp dwellers adapted to toxic environments and treacherous terrain.",
            "abilities": [
                {
                    "id": "swamp-navigator",
                    "displayName": "Swamp Navigator",
                    "type": "passive",
                    "trigger": "terrain-swamp-marsh",
                    "bonusType": "dice",
                    "bonusValue": 1,
                    "description": "The mire is your home—you read its signs instinctively."
                },
                {
                    "id": "toxin-resistance",
                    "displayName": "Toxin Resistance",
                    "type": "passive",
                    "trigger": "poison-hazard-save",
                    "bonusType": "advantage",
                    "description": "Years in the swamp have hardened you against poisons."
                },
                {
                    "id": "mire-knowledge",
                    "displayName": "Mire Knowledge",
                    "type": "active",
                    "trigger": "navigating-bog",
                    "bonusType": "special",
                    "description": "Identify safe paths through treacherous bog, automatically avoiding hidden pits."
                }
            ]
        },
        {
            "id": "gantry-runner",
            "displayName": "Gantry-Runner",
            "description": "Urban explorers who navigate industrial ruins and find valuable salvage.",
            "abilities": [
                {
                    "id": "urban-navigator",
                    "displayName": "Urban Navigator",
                    "type": "passive",
                    "trigger": "terrain-industrial-ruins",
                    "bonusType": "dice",
                    "bonusValue": 1,
                    "description": "You know the patterns of industrial decay—where floors hold, where they don't."
                },
                {
                    "id": "rooftop-routes",
                    "displayName": "Rooftop Routes",
                    "type": "active",
                    "trigger": "seeking-elevated-path",
                    "bonusType": "special",
                    "description": "Find elevated routes across rooftops and gantries, avoiding ground hazards."
                },
                {
                    "id": "scrap-familiar",
                    "displayName": "Scrap Familiar",
                    "type": "passive",
                    "trigger": "foraging-in-ruins",
                    "bonusType": "dice",
                    "bonusValue": 1,
                    "description": "You know where the good salvage hides—behind panels, under debris."
                }
            ]
        }
    ],
    "terrainMappings": {
        "swamp": ["Swamp", "Marsh", "Bog"],
        "industrial": ["ModerateRuins", "DenseRuins"],
        "wilderness": ["OpenWasteland", "Forest", "Hills"]
    },
    "creatureInfo": {
        "wasteland-wolf": {
            "type": "Predator",
            "weakness": "Fire vulnerability",
            "behaviorPattern": "Hunts in packs, flanks prey"
        },
        "rust-beetle": {
            "type": "Swarm",
            "weakness": "Area damage effective",
            "behaviorPattern": "Disperses when damaged, reforms"
        },
        "glitch-stalker": {
            "type": "Aberration",
            "weakness": "Grounded attacks",
            "behaviorPattern": "Phases through obstacles, ambushes"
        }
    }
}
```

### 11.2 specialization-abilities.schema.json

**File:** `config/schemas/specialization-abilities.schema.json`

```json
{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runeandrust.game/schemas/specialization-abilities.schema.json",
    "title": "Specialization Abilities Configuration",
    "description": "Configuration schema for specialization abilities in Wasteland Survival",
    "type": "object",
    "required": ["specializations"],
    "properties": {
        "specializations": {
            "type": "array",
            "description": "Array of specialization definitions",
            "items": {
                "type": "object",
                "required": ["id", "displayName", "abilities"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the specialization"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Human-readable name"
                    },
                    "description": {
                        "type": "string",
                        "description": "Flavor text for the specialization"
                    },
                    "abilities": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "required": ["id", "displayName", "type", "trigger", "bonusType"],
                            "properties": {
                                "id": {
                                    "type": "string",
                                    "description": "Unique ability identifier"
                                },
                                "displayName": {
                                    "type": "string",
                                    "description": "Human-readable ability name"
                                },
                                "type": {
                                    "type": "string",
                                    "enum": ["passive", "active"],
                                    "description": "Whether ability is automatic or player-triggered"
                                },
                                "trigger": {
                                    "type": "string",
                                    "description": "Condition that activates the ability"
                                },
                                "bonusType": {
                                    "type": "string",
                                    "enum": ["dice", "advantage", "special", "zone"],
                                    "description": "Type of bonus provided"
                                },
                                "bonusValue": {
                                    "type": "integer",
                                    "minimum": 1,
                                    "description": "Numeric bonus value (for dice bonuses)"
                                },
                                "duration": {
                                    "type": "string",
                                    "description": "How long the effect lasts"
                                },
                                "description": {
                                    "type": "string",
                                    "description": "Player-facing description"
                                }
                            }
                        }
                    }
                }
            }
        },
        "terrainMappings": {
            "type": "object",
            "description": "Maps terrain categories to terrain types",
            "additionalProperties": {
                "type": "array",
                "items": { "type": "string" }
            }
        },
        "creatureInfo": {
            "type": "object",
            "description": "Creature information for Predator's Eye",
            "additionalProperties": {
                "type": "object",
                "properties": {
                    "type": { "type": "string" },
                    "weakness": { "type": "string" },
                    "behaviorPattern": { "type": "string" }
                }
            }
        }
    }
}
```

### 11.3 Configuration Schema Summary

| Config File | Schema File | Purpose |
|-------------|-------------|---------|
| `specialization-abilities.json` | `specialization-abilities.schema.json` | Ability definitions, triggers, bonuses |

---

## 12. Logging Specifications

### 12.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `SpecializationBonusService` | Information | Ability activations, hunting grounds markers |
| `SpecializationBonusService` | Debug | Bonus evaluations, condition checks |
| `SpecializationBonusService` | Warning | Invalid ability activation attempts |
| `SpecializationBonusService` | Error | Configuration loading failures |

### 12.2 Log Message Examples

```
[Debug] Evaluating specialization bonuses for {PlayerId} ({Spec}) - Check: {Check}, Terrain: {Terrain}
[Debug] Found {Count} applicable bonuses for {PlayerId}
[Information] Player {PlayerId} activating ability {AbilityId}
[Information] Player {PlayerId} marked area {AreaId} as hunting grounds
[Warning] Player {PlayerId} attempted to activate ability {AbilityId} they don't have
[Debug] Cleared hunting grounds for player {PlayerId}
```

---

## 13. Unit Testing Requirements

### 13.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Veioimaor bonus applies to creature tracking | 1 |
| Terrain specialization bonuses apply | 1 |
| **Total** | **~2** |

### 13.2 Test Specifications

**File:** `tests/RuneAndRust.Tests/Services/SpecializationBonusServiceTests.cs`

```csharp
[TestFixture]
public class SpecializationBonusServiceTests
{
    [Test]
    public void GetBonusesForCheck_VeioimaorTrackingLivingCreature_ReturnsBeastTrackerBonus()
    {
        // Arrange
        var player = CreatePlayer(SpecializationType.Veioimaor);
        var service = CreateService();

        // Act
        var bonuses = service.GetBonusesForCheck(
            player,
            WastelandSurvivalCheckType.Tracking,
            TerrainType.OpenWasteland,
            TargetType.LivingCreature);

        // Assert
        Assert.That(bonuses, Has.Count.EqualTo(1));
        Assert.That(bonuses[0].AbilityId, Is.EqualTo("beast-tracker"));
        Assert.That(bonuses[0].BonusDice, Is.EqualTo(2));
    }

    [Test]
    [TestCase(SpecializationType.MyrStalker, TerrainType.Swamp, 1, "swamp-navigator")]
    [TestCase(SpecializationType.MyrStalker, TerrainType.Marsh, 1, "swamp-navigator")]
    [TestCase(SpecializationType.GantryRunner, TerrainType.ModerateRuins, 1, "urban-navigator")]
    [TestCase(SpecializationType.GantryRunner, TerrainType.DenseRuins, 1, "urban-navigator")]
    public void GetBonusesForCheck_TerrainSpecialization_ReturnsCorrectBonus(
        SpecializationType spec,
        TerrainType terrain,
        int expectedDice,
        string expectedAbilityId)
    {
        // Arrange
        var player = CreatePlayer(spec);
        var service = CreateService();

        // Act
        var bonuses = service.GetBonusesForCheck(
            player,
            WastelandSurvivalCheckType.General,
            terrain,
            null);

        // Assert
        Assert.That(bonuses, Has.Count.GreaterThanOrEqualTo(1));
        var bonus = bonuses.First(b => b.AbilityId == expectedAbilityId);
        Assert.That(bonus.BonusDice, Is.EqualTo(expectedDice));
    }
}
```

### 13.3 Test Case Details

**Test 1: Veioimaor Creature Tracking Bonus**
- Creates Veioimaor player
- Requests bonuses for tracking a living creature
- Verifies Beast Tracker provides +2d10

**Test 2: Terrain Specialization Bonuses**
- Tests Myr-Stalker in swamp/marsh terrain
- Tests Gantry-Runner in ruins terrain
- Verifies correct ability applies with correct bonus dice

---

## 14. Use Cases

### UC-001: Veioimaor Tracks Creature
**Actor:** Player (Veioimaor specialization)
**Flow:** Start tracking → System detects living creature target → Beast Tracker +2d10 applied → Check succeeds → Predator's Eye option offered → Player learns creature weakness

### UC-002: Myr-Stalker Navigates Swamp
**Actor:** Player (Myr-Stalker specialization)
**Flow:** Enter swamp terrain → Swamp Navigator +1d10 automatically applied → Player encounters toxic hazard → Toxin Resistance grants advantage on save

### UC-003: Gantry-Runner Forages in Ruins
**Actor:** Player (Gantry-Runner specialization)
**Flow:** Forage in industrial ruins → Urban Navigator +1d10 applied → Scrap Familiar +1d10 applied → Total +2d10 to foraging check

### UC-004: Hunter Marks Hunting Grounds
**Actor:** Player (Veioimaor specialization)
**Flow:** Use 'mark hunting grounds' command → Area marked → All subsequent WS checks in area get +2d10 → Effect persists until rest or new mark

---

## 15. Deliverable Checklist

### 15.1 Domain Layer

- [ ] `SpecializationType.cs` enum created in `Enums/`
- [ ] `WastelandSurvivalCheckType.cs` enum created in `Enums/`
- [ ] `TargetType.cs` enum created in `Enums/`
- [ ] `SpecializationBonus.cs` value object created in `ValueObjects/`
- [ ] `AbilityActivation.cs` value object created in `ValueObjects/`
- [ ] `HuntingGroundsMarker.cs` value object created in `ValueObjects/`

### 15.2 Application Layer

- [ ] `ISpecializationBonusService.cs` interface created in `Interfaces/`
- [ ] `SpecializationBonusService.cs` created in `Services/`
- [ ] Service registered in dependency injection

### 15.3 Configuration

- [ ] `config/specialization-abilities.json` created
- [ ] `config/schemas/specialization-abilities.schema.json` created
- [ ] Configuration files validate against schemas

### 15.4 Testing

- [ ] `SpecializationBonusServiceTests.cs` created (~2 tests)
- [ ] All tests passing

### 15.5 Documentation

- [ ] XML documentation complete on all public members
- [ ] Design specification finalized

---

## 16. Acceptance Criteria

### 16.1 Functional

- [ ] Veioimaor [Beast Tracker] provides +2d10 when tracking living creatures
- [ ] Veioimaor [Predator's Eye] reveals creature weakness after successful track
- [ ] Veioimaor [Hunting Grounds] can be marked and provides +2d10 in zone
- [ ] Myr-Stalker [Swamp Navigator] provides +1d10 in swamp/marsh terrain
- [ ] Myr-Stalker [Toxin Resistance] grants advantage on poison hazard saves
- [ ] Myr-Stalker [Mire Knowledge] identifies safe paths through bog
- [ ] Gantry-Runner [Urban Navigator] provides +1d10 in industrial ruins
- [ ] Gantry-Runner [Rooftop Routes] finds elevated paths
- [ ] Gantry-Runner [Scrap Familiar] provides +1d10 foraging in ruins
- [ ] Bonuses stack appropriately when multiple conditions apply

### 16.2 Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~2 tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete

---

## 17. Dependencies

### 17.1 Required from Previous Versions

| Type | Version | Usage |
|------|---------|-------|
| `ISkillCheckService` | v0.15.0 | Apply bonuses to skill checks |
| `TerrainType` | v0.15.5d | Terrain condition matching |
| `HazardType` | v0.15.5e | Hazard condition matching |
| `TrackingResult` | v0.15.5a | Post-tracking ability activation |
| `NavigationContext` | v0.15.5d | Path-finding ability activation |
| `ForagingContext` | v0.15.5c | Foraging bonus conditions |

### 17.2 Provides to Future Versions

| Type | Usage |
|------|-------|
| `ISpecializationBonusService` | v0.15.5i Exploration Synergies combined checks |
| `SpecializationBonus` | Integration with other skill expansions |
| `SpecializationType` | Character creation and progression |

---

## 18. Future Considerations

### 18.1 Deferred to v0.15.5i (Exploration Synergies)

- **Combined specialization checks**: Synergy between specialization abilities and other skills
- **Cross-specialization bonuses**: Abilities that benefit party members

### 18.2 Deferred to Future Versions

- **Specialization advancement**: Unlocking stronger versions of abilities
- **Hybrid specializations**: Characters with abilities from multiple specializations
- **Specialization-specific equipment**: Items that enhance specialization abilities

### 18.3 Out of Scope

- **Specialization selection**: Character creation choice of specialization
- **Specialization prerequisites**: Requirements to take a specialization
- **Non-WS specialization abilities**: Other skills have their own expansions

---

## 19. Document Metadata

---

*Document Version: 1.0*
*Last Updated: 2026-01-18*
*Author: Claude*

---

### Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-18 | Claude | Initial design specification |

---

*This design specification provides the detailed blueprint for implementing v0.15.5h Specialization Integration. This establishes the specialization bonus pattern for archetype-specific abilities in the Wasteland Survival skill expansion.*
