# v0.16.3a Changelog - Equipment Class Mapping

## Overview

Creates foundational data structures for the Smart Loot Generation system. This is the first phase (a) of v0.16.3, establishing equipment-to-archetype affinity mappings that enable class-appropriate loot drops.

## Added

### Enums

- **`EquipmentClassAffinity`** (`src/Core/RuneAndRust.Domain/Enums/EquipmentClassAffinity.cs`)
    - 5 values: Warrior (0), Skirmisher (1), Mystic (2), Adept (3), Universal (4)
    - Explicit integer assignments for stable serialization
    - Comprehensive XML documentation with equipment examples

### Value Objects

- **`EquipmentClassMapping`** (`src/Core/RuneAndRust.Domain/ValueObjects/EquipmentClassMapping.cs`)
    - Maps equipment category to archetype affinity
    - Properties: `CategoryId`, `DisplayName`, `Affinity`, `PrimaryAttribute`, `EquipmentSlot`, `ExampleItems`
    - Computed: `IsUniversal`, `IsWeapon`, `IsArmor`, `IsAccessory`
    - Method: `IsAppropriateFor(archetypeId)` - checks if category is appropriate for archetype
    - Factory: `Create()` with validation and ID normalization
    - Static: `EquipmentClassMapping.Empty` for fallback

### Interfaces

- **`IEquipmentClassMappingProvider`** (`src/Core/RuneAndRust.Application/Interfaces/IEquipmentClassMappingProvider.cs`)
    - `GetMapping(categoryId)` - Single mapping lookup
    - `GetAffinityForCategory(categoryId)` - Affinity lookup
    - `GetMappingsForAffinity(affinity)` - Filter by affinity
    - `GetAllMappings()` - All configured mappings
    - `GetAppropriateCategories(archetypeId)` - Categories for archetype (includes Universal)
    - `IsClassAppropriate(categoryId, archetypeId)` - Validation check
    - `ValidateConfiguration()` - Configuration completeness check

### Configuration

- **`equipment-class-mapping.json`** (`config/equipment-class-mapping.json`)
    - 15 equipment category mappings:
        - Warrior (4): axes, greatswords, hammers, heavy-armor
        - Skirmisher (4): daggers, blades, bows, medium-armor
        - Mystic (3): staves, foci, orbs
        - Adept (2): crossbows, arc-cannons
        - Universal (2): light-armor, accessories
    - Each mapping includes example items

- **`equipment-class-mapping.schema.json`** (`config/schemas/equipment-class-mapping.schema.json`)
    - JSON Schema Draft-07 validation
    - Required fields: categoryId, displayName, affinity, equipmentSlot, exampleItems
    - Enum validation for affinity and equipmentSlot
    - ID pattern validation: `^[a-z][a-z0-9-]*$`

### Unit Tests

- **`EquipmentClassAffinityTests.cs`** (15 tests)
    - Enum value count and integer assignments
    - Parsing (case-insensitive)
    - Integer casting
    - Sequential value verification

- **`EquipmentClassMappingTests.cs`** (41 tests)
    - `IsAppropriateFor` affinity matching
    - Universal category handling
    - Slot type computed properties
    - Factory validation
    - Utility method tests

## Design Notes

### Equipment Affinity Pattern

Equipment categories are assigned to archetypes based on primary attribute scaling:

- **Warrior** → MIGHT (heavy weapons, heavy armor)
- **Skirmisher** → FINESSE (agile weapons, medium armor)
- **Mystic** → WILL (arcane implements)
- **Adept** → WITS (technical equipment)
- **Universal** → All (light armor, accessories)

### Smart Loot Integration

This phase provides the mapping data that v0.16.3b (Smart Loot Algorithm) will use to filter loot drops. When generating loot for a Warrior:

1. Query `GetAppropriateCategories("warrior")`
2. Returns Warrior-affinity + Universal categories
3. Weight loot tables toward these categories

## Dependencies

- v0.16.2: Armor Proficiency System (prerequisite)

## Provides To

- v0.16.3b: Smart Loot Algorithm
- v0.16.3c: Weighted Item Selection
- v0.16.3d: Loot Service Integration

## Testing

```bash
dotnet test tests/RuneAndRust.Domain.UnitTests \
  --filter "EquipmentClass" \
  --verbosity normal
```

All 56 tests pass.
