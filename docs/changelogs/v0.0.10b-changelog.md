# v0.0.10b Changelog - Unit Test Coverage

**Date:** 2026-01-08

## Summary

Implements reusable test infrastructure for Rune and Rust. This phase extends the TestUtilities project (created in v0.0.10a) with fluent entity builders, mock providers, test fixtures, and deterministic random utilities. This is the second sub-phase of v0.0.10 (Documentation & Polish).

## Added

### Test Utilities - Builders (New)

- `PlayerBuilder` class:
  - Fluent builder pattern with `Create()` factory
  - `WithName()`, `WithStats()`, `WithAttributes()` for basic setup
  - `WithRace()`, `WithBackground()` for character creation
  - `WithClass()` to set archetype and class
  - `WithResource()` to initialize resource pools
  - `WithAbility()` to add abilities
  - `WithCurrentHealth()` to set damaged state
  - `AtPosition()` to place in dungeon
  - `WithItem()` to add inventory items
  - `WithLevel()`, `WithExperience()` for progression
  - `Build()` returns configured Player

- `MonsterBuilder` class:
  - Fluent builder with preset factory methods: `Goblin()`, `Orc()`, `Skeleton()`, `Slime()`
  - `WithName()`, `WithDescription()`, `WithStats()` for configuration
  - `WithCurrentHealth()` to set damaged state
  - `WithDefinitionId()`, `WithExperienceValue()` for definition linking
  - `WithInitiativeModifier()`, `WithBehavior()` for AI configuration
  - `WithResistances()` for damage resistance
  - `Build()` returns configured Monster

- `RoomBuilder` class:
  - `WithId()`, `WithName()`, `WithDescription()` for basic setup
  - `AtPosition()` to set dungeon grid position
  - `WithExit()` to add directional exits
  - `WithMonster()` to populate room (accepts Monster or MonsterBuilder)
  - `WithItem()` to add items
  - `Build()` returns configured Room

- `GameSessionBuilder` class:
  - `WithPlayer()` accepts Player, PlayerBuilder, or configuration action
  - `WithDungeon()` to set custom dungeon
  - `WithRoom()` to add rooms
  - `InRoom()` to set starting room
  - `WithState()` to set game state
  - `Build()` returns configured GameSession

### Test Utilities - Mocks (New)

- `MockConfigurationProvider` class:
  - Implements `IGameConfigurationProvider` with in-memory storage
  - Fluent methods: `WithRace()`, `WithBackground()`, `WithArchetype()`, `WithClass()`
  - `WithAbility()`, `WithResourceType()`, `WithMonster()`, `WithDamageType()`
  - `WithTier()`, `WithTrait()`, `WithCurrency()`, `WithSkill()`
  - `WithPointBuyRules()`, `WithProgression()`
  - Helper methods: `WithDefaultResourceTypes()`, `WithDefaultTiers()`
  - Full implementation of all Get* methods from interface

- `MockRepository` class:
  - Implements `IGameRepository` with dictionary-based storage
  - `WithSession()` to pre-populate for tests
  - `SaveAsync()`, `GetByIdAsync()`, `GetSavedGamesAsync()`, `DeleteAsync()`
  - `Sessions` property for test verification
  - `Count` and `Clear()` utility methods

### Test Utilities - Fixtures (New)

- `TestFixtureBase` abstract class:
  - Properties: `ConfigProvider`, `Repository`, `LoggerFactory`
  - NUnit `[SetUp]` initializes all providers automatically
  - `CreateMockLogger<T>()` returns Moq mock logger
  - `GetTestLogger<T>()` returns TestLogger for log verification
  - `VerifyLog<T>()` asserts log messages exist
  - `VerifyNoLogs<T>()` asserts no log messages at level
  - `CreateSeededRandom()` for deterministic tests

### Test Utilities - Random (New)

- `SeededRandom` static class:
  - `DefaultSeed = 12345` constant for consistency
  - `Create(int seed)` creates seeded Random instance
  - `CreateMultiple(int count, int baseSeed)` creates multiple instances

## Modified

### Test Utilities Project

- `RuneAndRust.TestUtilities.csproj`:
  - Added PackageReference: FluentAssertions 7.0.0
  - Added PackageReference: Moq 4.20.72
  - Added PackageReference: NUnit 4.2.2
  - Added ProjectReference: RuneAndRust.Domain
  - Added ProjectReference: RuneAndRust.Application

## Test Results

```
Domain Tests:      578 passed
Application Tests: 204 passed (+30 new test utilities tests)
Architecture Tests:  8 passed
Total:             790 passed
```

## New Unit Tests

| Test File | Count |
|-----------|-------|
| `BuilderTests.cs` | 13 |
| `MockProviderTests.cs` | 9 |
| `UtilityTests.cs` | 8 |
| **Total New** | 30 |

## Files Summary

### New Files (11)
| File | Purpose |
|------|---------|
| `TestUtilities/Builders/PlayerBuilder.cs` | Fluent player builder |
| `TestUtilities/Builders/MonsterBuilder.cs` | Fluent monster builder with presets |
| `TestUtilities/Builders/RoomBuilder.cs` | Fluent room builder |
| `TestUtilities/Builders/GameSessionBuilder.cs` | Fluent session builder |
| `TestUtilities/Mocks/MockConfigurationProvider.cs` | In-memory config provider |
| `TestUtilities/Mocks/MockRepository.cs` | In-memory repository |
| `TestUtilities/Fixtures/TestFixtureBase.cs` | Test base class |
| `TestUtilities/SeededRandom.cs` | Deterministic random |
| `Application.UnitTests/TestUtilities/BuilderTests.cs` | Builder tests |
| `Application.UnitTests/TestUtilities/MockProviderTests.cs` | Mock provider tests |
| `Application.UnitTests/TestUtilities/UtilityTests.cs` | Utility tests |

### Modified Files (1)
| File | Changes |
|------|---------|
| `TestUtilities/RuneAndRust.TestUtilities.csproj` | +FluentAssertions, Moq, NUnit, Domain/Application refs |

## Usage Examples

### Using PlayerBuilder
```csharp
var player = PlayerBuilder.Create()
    .WithName("Hero")
    .WithStats(150, 15, 10)
    .WithClass("martial", "warrior")
    .WithResource("rage", 100, 50)
    .WithCurrentHealth(75)
    .Build();
```

### Using MonsterBuilder Presets
```csharp
var goblin = MonsterBuilder.Goblin().Build();
var orc = MonsterBuilder.Orc().WithCurrentHealth(25).Build();
var customMonster = MonsterBuilder.Create()
    .WithName("Dragon")
    .WithStats(500, 50, 30)
    .WithExperienceValue(1000)
    .Build();
```

### Using MockConfigurationProvider
```csharp
var config = new MockConfigurationProvider()
    .WithDefaultResourceTypes()
    .WithDefaultTiers()
    .WithClass(ClassDefinition.Create("warrior", ...))
    .WithAbility(AbilityDefinition.Create("power_strike", ...));

var mana = config.GetResourceTypeById("mana");
var warrior = config.GetClassById("warrior");
```

### Using TestFixtureBase
```csharp
[TestFixture]
public class MyServiceTests : TestFixtureBase
{
    [Test]
    public void MyTest()
    {
        // ConfigProvider, Repository, LoggerFactory are pre-initialized
        var logger = GetTestLogger<MyService>();
        var service = new MyService(logger, ConfigProvider);

        service.DoSomething();

        VerifyLog<MyService>(LogLevel.Information, "expected message");
    }
}
```

### Using SeededRandom
```csharp
// Same seed = same sequence
var random1 = SeededRandom.Create(42);
var random2 = SeededRandom.Create(42);
Assert.AreEqual(random1.Next(), random2.Next()); // Always true

// Multiple randoms for parallel tests
var randoms = SeededRandom.CreateMultiple(5).ToList();
```

## v0.0.10b Complete

This completes the Unit Test Coverage phase:
- Fluent entity builders for Player, Monster, Room, GameSession
- Mock configuration provider with fluent setup
- Mock repository for service testing
- Test fixture base class with common setup
- Seeded random for deterministic tests
- 30 new unit tests

Ready for v0.0.10c: XML Documentation.
