# v0.18.0c Design Specification: IStressService Interface

**Version:** 0.18.0c
**Parent:** v0.18.0 (Psychic Stress System)
**Prerequisites:** v0.18.0a (Stress Enums & State), v0.18.0b (Stress Result Objects)
**Status:** Design Complete
**Estimated Unit Tests:** ~0 (Interface only)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [IStressService Interface](#5-istressservice-interface)
6. [Method Specifications](#6-method-specifications)
7. [Data Flow Diagrams](#7-data-flow-diagrams)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [Deliverable Checklist](#11-deliverable-checklist)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Dependencies](#13-dependencies)
14. [Future Considerations](#14-future-considerations)

---

## 1. Executive Summary

This design specification defines the `IStressService` interface — the service contract for all stress management operations in the Psychic Stress system.

v0.18.0c establishes the **Application Layer Contract** that will be implemented in v0.18.0d. By defining the interface first, we enable:

- Mock-based testing of dependent systems
- Clear separation between contract and implementation
- Parallel development of consumers and implementation

### Key Deliverables

| Category                   | Items                          |
| -------------------------- | ------------------------------ |
| **Application Interfaces** | `IStressService`               |
| **Tests**                  | ~0 (interface definition only) |

### Interface Method Summary

| Category     | Methods | Description                                      |
| ------------ | ------- | ------------------------------------------------ |
| **Queries**  | 4       | Read stress state and derived values             |
| **Commands** | 4       | Apply stress, recover stress, reset after trauma |
| **Internal** | 1       | Resistance check calculation                     |

---

## 2. Feature Overview

```
v0.18.0c Features
└── IStressService Interface (9 methods)
    │
    ├── QUERY METHODS
    │   ├── GetStressState(characterId) → StressState
    │   ├── GetDefensePenalty(characterId) → int
    │   ├── HasSkillDisadvantage(characterId) → bool
    │   └── RequiresTraumaCheck(characterId) → bool
    │
    ├── COMMAND METHODS
    │   ├── ApplyStress(characterId, amount, source, dc?) → StressApplicationResult
    │   ├── RecoverStress(characterId, restType) → StressRecoveryResult
    │   ├── RecoverStress(characterId, amount, source) → StressRecoveryResult
    │   └── ResetAfterTraumaCheck(characterId, passed) → void
    │
    └── INTERNAL METHODS
        └── PerformResistanceCheck(characterId, baseStress, dc) → StressCheckResult
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                       IStressService                             │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │                                                                  │   │
│  │  QUERIES                                                         │   │
│  │  ─────────────────────────────────────────────────────────────   │   │
│  │  + GetStressState(characterId: Guid): StressState               │   │
│  │  + GetDefensePenalty(characterId: Guid): int                    │   │
│  │  + HasSkillDisadvantage(characterId: Guid): bool                │   │
│  │  + RequiresTraumaCheck(characterId: Guid): bool                 │   │
│  │                                                                  │   │
│  │  COMMANDS                                                        │   │
│  │  ─────────────────────────────────────────────────────────────   │   │
│  │  + ApplyStress(characterId, amount, source, dc?):               │   │
│  │        StressApplicationResult                                   │   │
│  │  + RecoverStress(characterId, restType): StressRecoveryResult   │   │
│  │  + RecoverStress(characterId, amount, source):                  │   │
│  │        StressRecoveryResult                                      │   │
│  │  + ResetAfterTraumaCheck(characterId, passed): void             │   │
│  │                                                                  │   │
│  │  INTERNAL                                                        │   │
│  │  ─────────────────────────────────────────────────────────────   │   │
│  │  + PerformResistanceCheck(characterId, baseStress, dc):         │   │
│  │        StressCheckResult                                         │   │
│  │                                                                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                               │                                         │
│                               │ Uses                                    │
│                               ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    DOMAIN VALUE OBJECTS                          │   │
│  │  ┌───────────────┐ ┌─────────────────────┐ ┌──────────────────┐ │   │
│  │  │  StressState  │ │StressApplicationResult│ │StressCheckResult│ │   │
│  │  └───────────────┘ └─────────────────────┘ └──────────────────┘ │   │
│  │  ┌───────────────┐ ┌─────────────────────┐ ┌──────────────────┐ │   │
│  │  │StressThreshold│ │  StressRecoveryResult│ │   RestType      │ │   │
│  │  └───────────────┘ └─────────────────────┘ └──────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Service Integration Diagram

```
    ┌─────────────────────────────────────────────────────────────────┐
    │                       CONSUMERS                                  │
    ├───────────────┬───────────────┬───────────────┬────────────────┤
    │ CombatService │  RestService  │  EventSystem  │   TUI/GUI      │
    └───────┬───────┴───────┬───────┴───────┬───────┴───────┬────────┘
            │               │               │               │
            │   Query       │   Recover     │   Subscribe   │  Display
            │   Defense     │   Stress      │   Threshold   │  Stress
            │   Penalty     │               │   Events      │  Bar
            │               │               │               │
            └───────────────┴───────┬───────┴───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │        IStressService         │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │    StressService (v0.18.0d)   │
                    │    Implements IStressService  │
                    └───────────────┬───────────────┘
                                    │
                          ┌─────────┴─────────┐
                          │                   │
                          ▼                   ▼
            ┌────────────────────┐   ┌───────────────────┐
            │ ICharacterRepository│   │   IDiceService    │
            │ (Stress Persistence)│   │ (Resistance Rolls)│
            └────────────────────┘   └───────────────────┘
```

### 3.3 Method Flow Decision Tree

```
                    ┌────────────────────────────┐
                    │    IStressService Call     │
                    └─────────────┬──────────────┘
                                  │
          ┌───────────────────────┼───────────────────────┐
          │                       │                       │
          ▼                       ▼                       ▼
    ┌──────────────┐       ┌──────────────┐       ┌──────────────┐
    │    QUERY     │       │   COMMAND    │       │   INTERNAL   │
    │              │       │              │       │              │
    │ GetStressState│       │ ApplyStress  │       │PerformResist │
    │ GetDefense...│       │ RecoverStress│       │  anceCheck   │
    │ HasSkill...  │       │ ResetAfter...│       │              │
    │ RequiresT... │       │              │       │              │
    └──────┬───────┘       └──────┬───────┘       └──────┬───────┘
           │                      │                      │
           ▼                      ▼                      ▼
    ┌──────────────┐       ┌──────────────┐       ┌──────────────┐
    │  Read-Only   │       │ State Change │       │ Calculation  │
    │  No Side     │       │ + Return     │       │ Only         │
    │  Effects     │       │ Result Object│       │              │
    └──────────────┘       └──────────────┘       └──────────────┘
```

---

## 4. User Stories

### US-18c-1: Combat Defense Query

**As a** combat service developer
**I want to** query a character's defense penalty from stress
**So that** I can calculate effective defense during combat

**Acceptance Criteria:**

- Method returns integer penalty value
- Works without modifying character state

### US-18c-2: Apply Combat Stress

**As a** combat system
**I want to** apply stress from a combat event with optional resistance
**So that** psychological damage is tracked alongside physical damage

**Acceptance Criteria:**

- Accepts stress amount, source category, and optional DC
- Returns full result with threshold transition info
- Triggers trauma check flag when appropriate

### US-18c-3: Process Rest Recovery

**As a** rest system
**I want to** apply stress recovery based on rest type
**So that** characters can recover from psychological damage

**Acceptance Criteria:**

- Accepts rest type (Short, Long, Sanctuary, Milestone)
- Calculates appropriate recovery based on WILL
- Returns result with threshold improvement info

### US-18c-4: Reset After Trauma Check

**As a** trauma system
**I want to** reset stress after trauma check resolution
**So that** the death spiral resets appropriately

**Acceptance Criteria:**

- Passed check: stress resets to 75
- Failed check: stress resets to 50
- No result object (simple state change)

---

## 5. IStressService Interface

### 5.1 Purpose

Defines the service contract for stress management, enabling dependency injection and mock-based testing.

### 5.2 Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/IStressService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service interface for managing character Psychic Stress.
/// </summary>
/// <remarks>
/// <para>
/// The stress service handles all aspects of the Psychic Stress system:
/// <list type="bullet">
/// <item>Querying current stress state and derived penalties</item>
/// <item>Applying stress from various sources with optional resistance</item>
/// <item>Recovering stress through rest and other means</item>
/// <item>Resetting stress after Trauma Check resolution</item>
/// </list>
/// </para>
/// <para>
/// Stress is a negative resource (0-100) that accumulates and imposes
/// escalating penalties. Reaching 100 stress triggers a Trauma Check.
/// </para>
/// </remarks>
/// <example>
/// <code>
/// // Query stress state
/// var state = _stressService.GetStressState(characterId);
/// var penalty = _stressService.GetDefensePenalty(characterId);
///
/// // Apply combat stress with resistance check
/// var result = _stressService.ApplyStress(
///     characterId,
///     amount: 20,
///     source: StressSource.Combat,
///     resistDc: 2);
///
/// if (result.TraumaCheckTriggered)
///     InitiateTraumaCheck(characterId);
///
/// // Recover stress from Long Rest
/// var recovery = _stressService.RecoverStress(characterId, RestType.Long);
/// </code>
/// </example>
public interface IStressService
{
    #region Query Methods

    /// <summary>
    /// Gets the current stress state for a character.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <returns>
    /// A <see cref="StressState"/> snapshot containing current stress,
    /// threshold, and computed penalties.
    /// </returns>
    /// <exception cref="CharacterNotFoundException">
    /// Thrown when no character exists with the specified ID.
    /// </exception>
    StressState GetStressState(Guid characterId);

    /// <summary>
    /// Gets the defense penalty from current stress level.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <returns>
    /// The defense penalty (0-5) calculated as floor(stress/20).
    /// </returns>
    /// <remarks>
    /// This is a convenience method equivalent to:
    /// <c>GetStressState(characterId).DefensePenalty</c>
    /// </remarks>
    int GetDefensePenalty(Guid characterId);

    /// <summary>
    /// Gets whether the character has skill check disadvantage from stress.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <returns>
    /// True if stress is 80 or higher (Breaking or Trauma threshold).
    /// </returns>
    /// <remarks>
    /// At Breaking (80-99): disadvantage on non-combat checks.
    /// At Trauma (100): disadvantage on ALL checks.
    /// </remarks>
    bool HasSkillDisadvantage(Guid characterId);

    /// <summary>
    /// Gets whether a Trauma Check is required (stress at 100).
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <returns>True if stress is at maximum (100).</returns>
    bool RequiresTraumaCheck(Guid characterId);

    #endregion

    #region Command Methods

    /// <summary>
    /// Applies stress to a character from a specified source.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <param name="amount">
    /// The base stress amount before any resistance reduction.
    /// </param>
    /// <param name="source">
    /// The category of stress source (Combat, Exploration, etc.).
    /// </param>
    /// <param name="resistDc">
    /// Optional difficulty class for a WILL-based resistance check.
    /// If 0 or omitted, no resistance check is performed.
    /// </param>
    /// <returns>
    /// A <see cref="StressApplicationResult"/> containing before/after
    /// state, threshold transitions, and resistance check results.
    /// </returns>
    /// <remarks>
    /// <para>
    /// If <paramref name="resistDc"/> is greater than 0, a WILL-based
    /// resistance check is performed. Successes reduce stress:
    /// <list type="bullet">
    /// <item>0 successes: 0% reduction</item>
    /// <item>1 success: 50% reduction</item>
    /// <item>2-3 successes: 75% reduction</item>
    /// <item>4+ successes: 100% reduction (no stress)</item>
    /// </list>
    /// </para>
    /// <para>
    /// After applying stress, check <see cref="StressApplicationResult.TraumaCheckTriggered"/>
    /// to determine if a Trauma Check should be initiated.
    /// </para>
    /// </remarks>
    StressApplicationResult ApplyStress(
        Guid characterId,
        int amount,
        StressSource source,
        int resistDc = 0);

    /// <summary>
    /// Recovers stress for a character based on rest type.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <param name="restType">
    /// The type of rest determining recovery amount.
    /// </param>
    /// <returns>
    /// A <see cref="StressRecoveryResult"/> containing recovery details
    /// and threshold changes.
    /// </returns>
    /// <remarks>
    /// Recovery formulas:
    /// <list type="bullet">
    /// <item>Short: WILL × 2</item>
    /// <item>Long: WILL × 5</item>
    /// <item>Sanctuary: Full reset to 0</item>
    /// <item>Milestone: Fixed 25</item>
    /// </list>
    /// </remarks>
    StressRecoveryResult RecoverStress(Guid characterId, RestType restType);

    /// <summary>
    /// Recovers a specific amount of stress from a named source.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <param name="amount">The amount of stress to recover.</param>
    /// <param name="source">
    /// Descriptive name of the recovery source (e.g., "Bone-Setter Ability").
    /// </param>
    /// <returns>
    /// A <see cref="StressRecoveryResult"/> containing recovery details.
    /// </returns>
    /// <remarks>
    /// Use this overload for non-rest recovery sources such as abilities,
    /// consumables, or special events. The <see cref="StressRecoveryResult.RecoverySource"/>
    /// will be logged as the source string passed.
    /// </remarks>
    StressRecoveryResult RecoverStress(Guid characterId, int amount, string source);

    /// <summary>
    /// Resets stress after a Trauma Check is resolved.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <param name="passed">
    /// True if the character passed the Trauma Check, false if failed.
    /// </param>
    /// <remarks>
    /// <para>
    /// Stress reset values:
    /// <list type="bullet">
    /// <item>Passed: Stress resets to 75</item>
    /// <item>Failed: Stress resets to 50 (+ character gains permanent Trauma)</item>
    /// </list>
    /// </para>
    /// <para>
    /// This method should only be called after a Trauma Check is fully
    /// resolved. Trauma application is handled by the Trauma System (v0.18.3).
    /// </para>
    /// </remarks>
    void ResetAfterTraumaCheck(Guid characterId, bool passed);

    #endregion

    #region Internal Methods

    /// <summary>
    /// Performs a WILL-based resistance check against stress.
    /// </summary>
    /// <param name="characterId">The character's unique identifier.</param>
    /// <param name="baseStress">
    /// The original stress amount before reduction.
    /// </param>
    /// <param name="dc">The difficulty class for the check.</param>
    /// <returns>
    /// A <see cref="StressCheckResult"/> containing success count,
    /// reduction percentage, and final stress amount.
    /// </returns>
    /// <remarks>
    /// This method is typically called internally by <see cref="ApplyStress"/>
    /// but is exposed for testing and specialized use cases.
    /// </remarks>
    StressCheckResult PerformResistanceCheck(Guid characterId, int baseStress, int dc);

    #endregion
}
```

---

## 6. Method Specifications

### 6.1 Query Methods

| Method                 | Parameters         | Returns       | Side Effects |
| ---------------------- | ------------------ | ------------- | ------------ |
| `GetStressState`       | `Guid characterId` | `StressState` | None         |
| `GetDefensePenalty`    | `Guid characterId` | `int`         | None         |
| `HasSkillDisadvantage` | `Guid characterId` | `bool`        | None         |
| `RequiresTraumaCheck`  | `Guid characterId` | `bool`        | None         |

### 6.2 Command Methods

| Method                     | Parameters                               | Returns                   | Side Effects             |
| -------------------------- | ---------------------------------------- | ------------------------- | ------------------------ |
| `ApplyStress`              | `characterId, amount, source, resistDc?` | `StressApplicationResult` | Updates character stress |
| `RecoverStress` (RestType) | `characterId, restType`                  | `StressRecoveryResult`    | Reduces character stress |
| `RecoverStress` (Amount)   | `characterId, amount, source`            | `StressRecoveryResult`    | Reduces character stress |
| `ResetAfterTraumaCheck`    | `characterId, passed`                    | `void`                    | Sets stress to 75 or 50  |

### 6.3 Reset Values

| Trauma Check Result | Reset Value | Reason                                   |
| ------------------- | ----------- | ---------------------------------------- |
| **Passed**          | 75          | Character barely maintained composure    |
| **Failed**          | 50          | Lower stress but gained permanent Trauma |

---

## 7. Data Flow Diagrams

### 7.1 ApplyStress Flow

```
    ┌────────────────────────────────────────────────────────────────┐
    │                     ApplyStress Flow                            │
    └────────────────────────────────────────────────────────────────┘

    Input: characterId, amount=20, source=Combat, resistDc=2
                               │
                               ▼
    ┌────────────────────────────────────────┐
    │  1. Get Character Current Stress       │
    │     currentStress = 35                 │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  2. Check if resistDc > 0              │
    │     resistDc = 2 → YES                 │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  3. PerformResistanceCheck             │
    │     Roll WILL (8) vs DC 2              │
    │     Successes = 2                      │
    │     → 75% reduction                    │
    │     → FinalStress = 5                  │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  4. Calculate New Stress               │
    │     35 + 5 = 40                        │
    │     Clamp(0, 100) → 40                 │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  5. Update Character Stress            │
    │     character.Stress = 40              │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  6. Create StressApplicationResult     │
    │     PreviousStress = 35                │
    │     NewStress = 40                     │
    │     StressGained = 5                   │
    │     PreviousThreshold = Uneasy         │
    │     NewThreshold = Anxious             │
    │     ThresholdCrossed = TRUE            │
    │     TraumaCheckTriggered = FALSE       │
    └────────────────────────────────────────┘
```

### 7.2 RecoverStress Flow

```
    ┌────────────────────────────────────────────────────────────────┐
    │                    RecoverStress Flow                           │
    └────────────────────────────────────────────────────────────────┘

    Input: characterId, restType=Long
                               │
                               ▼
    ┌────────────────────────────────────────┐
    │  1. Get Character                      │
    │     currentStress = 75                 │
    │     WILL = 4                           │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  2. Calculate Recovery Amount          │
    │     RestType.Long = WILL × 5           │
    │     4 × 5 = 20                         │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  3. Apply Recovery                     │
    │     75 - 20 = 55                       │
    │     Max(0, 55) → 55                    │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  4. Update Character Stress            │
    │     character.Stress = 55              │
    └────────────────────┬───────────────────┘
                         │
                         ▼
    ┌────────────────────────────────────────┐
    │  5. Create StressRecoveryResult        │
    │     PreviousStress = 75                │
    │     NewStress = 55                     │
    │     AmountRecovered = 20               │
    │     RecoverySource = Long              │
    │     PreviousThreshold = Panicked       │
    │     NewThreshold = Anxious             │
    │     ThresholdDropped = TRUE            │
    └────────────────────────────────────────┘
```

---

## 8. Logging Specifications

### 8.1 Recommended Log Events (for Implementation)

| Event             | Level       | Template                                                                                         |
| ----------------- | ----------- | ------------------------------------------------------------------------------------------------ |
| Stress Queried    | Debug       | `"Stress state queried for {CharacterId}: {CurrentStress}/{MaxStress}"`                          |
| Stress Applied    | Information | `"Stress applied to {CharacterId}: +{StressGained} [{Source}] ({PreviousStress} → {NewStress})"` |
| Resistance Check  | Debug       | `"Resistance check: {Successes} successes, {ReductionPercent:P0} reduction"`                     |
| Threshold Crossed | Information | `"Stress threshold crossed for {CharacterId}: {PreviousThreshold} → {NewThreshold}"`             |
| Trauma Triggered  | Warning     | `"TRAUMA CHECK TRIGGERED for {CharacterId}: Stress at {NewStress}"`                              |
| Stress Recovered  | Information | `"Stress recovered for {CharacterId}: -{AmountRecovered} [{RecoverySource}]"`                    |
| Trauma Reset      | Information | `"Stress reset after Trauma Check for {CharacterId}: {Passed} → {NewStress}"`                    |

---

## 9. Unit Testing Requirements

### 9.1 Interface Testing

Since this is an interface-only deliverable, no unit tests are required for v0.18.0c. The implementation tests will be part of v0.18.0d.

### 9.2 Mock Usage Examples

```csharp
// Example mock setup for dependent services
var mockStressService = new Mock<IStressService>();

// Setup query methods
mockStressService
    .Setup(s => s.GetDefensePenalty(It.IsAny<Guid>()))
    .Returns(3);

mockStressService
    .Setup(s => s.HasSkillDisadvantage(It.IsAny<Guid>()))
    .Returns(true);

// Setup command methods
mockStressService
    .Setup(s => s.ApplyStress(
        It.IsAny<Guid>(),
        It.IsAny<int>(),
        It.IsAny<StressSource>(),
        It.IsAny<int>()))
    .Returns(StressApplicationResult.Create(35, 55, StressSource.Combat));

// Verify calls
mockStressService.Verify(
    s => s.ApplyStress(characterId, 20, StressSource.Combat, 2),
    Times.Once);
```

---

## 10. Use Cases

### UC-001: Combat Defense Calculation

**Actor:** CombatService
**Flow:** Calculate hit → Query defense penalty → Apply to defense total
**Precondition:** Character in combat with stress > 0
**Postcondition:** Reduced effective defense

### UC-002: Fear Aura Attack

**Actor:** MonsterAI
**Flow:** Monster uses fear → ApplyStress with Combat source and DC → Check trauma trigger
**Precondition:** Monster has fear ability
**Postcondition:** Character stress increased, UI notified

### UC-003: Long Rest Recovery

**Actor:** RestService
**Flow:** Player takes Long Rest → RecoverStress(Long) → Display recovery feedback
**Precondition:** Character at safe location
**Postcondition:** Stress reduced by WILL × 5

### UC-004: Trauma Check Resolution

**Actor:** TraumaService
**Flow:** Execute Trauma Check → Call ResetAfterTraumaCheck → Continue gameplay
**Precondition:** Character at 100 stress
**Postcondition:** Stress reset to 75 (pass) or 50 (fail)

---

## 11. Deliverable Checklist

### Application Layer — Interfaces

- [x] `src/Core/RuneAndRust.Application/Interfaces/IStressService.cs`

### Documentation

- [x] XML documentation on interface
- [x] XML documentation on all 9 methods
- [x] Parameter and return documentation complete
- [x] Exception documentation where applicable
- [x] Code examples in interface remarks

---

## 12. Acceptance Criteria

### Functional Criteria

- [x] `IStressService` interface compiles without errors
- [x] Interface defines exactly 9 methods (4 query, 4 command, 1 internal)
- [x] All methods have complete XML documentation
- [x] All parameters have XML parameter documentation
- [x] All return types have XML returns documentation
- [x] Interface uses only types from v0.18.0a and v0.18.0b
- [x] No implementation logic in interface file

### Quality Criteria

- [x] Build succeeds with 0 errors
- [x] Build succeeds with 0 warnings
- [x] Interface follows project naming conventions
- [x] File-scoped namespace used
- [x] Methods organized into logical regions (Query, Command, Internal)

---

## 13. Dependencies

### Required from v0.18.0a

| Type              | Usage                             |
| ----------------- | --------------------------------- |
| `StressState`     | Return type for `GetStressState`  |
| `StressThreshold` | Used in result object comparisons |
| `StressSource`    | Parameter for `ApplyStress`       |
| `RestType`        | Parameter for `RecoverStress`     |

### Required from v0.18.0b

| Type                      | Usage                                    |
| ------------------------- | ---------------------------------------- |
| `StressCheckResult`       | Return type for `PerformResistanceCheck` |
| `StressApplicationResult` | Return type for `ApplyStress`            |
| `StressRecoveryResult`    | Return type for `RecoverStress`          |

### Provides to v0.18.0d

| Type             | Usage                                        |
| ---------------- | -------------------------------------------- |
| `IStressService` | Interface for `StressService` implementation |

### Provides to Consumers

| Consumer          | Methods Used                                   |
| ----------------- | ---------------------------------------------- |
| CombatService     | `GetDefensePenalty`, `ApplyStress`             |
| SkillCheckService | `HasSkillDisadvantage`                         |
| RestService       | `RecoverStress`                                |
| TraumaService     | `RequiresTraumaCheck`, `ResetAfterTraumaCheck` |
| UI Layer          | `GetStressState`                               |

---

## 14. Future Considerations

### Deferred to v0.18.0d

- `StressService` class implementing this interface
- Actual WILL-based dice rolling logic
- Character repository integration

### Deferred to v0.18.0e

- Configuration-based stress source definitions
- Customizable resistance DC values

### Deferred to v0.18.3

- Trauma Check execution methods
- Permanent Trauma application

### Out of Scope

- Async method variants (not needed for current architecture)
- Event raising (handled by service implementation)
- Caching (implementation detail)

---

_Document Version: 1.0_
_Last Updated: 2026-01-27_
