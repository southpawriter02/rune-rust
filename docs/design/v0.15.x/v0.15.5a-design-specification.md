# v0.15.5a Design Specification: Extended Tracking System

**Version:** 0.15.5a
**Theme:** Extended Tracking System
**Author:** Claude
**Created:** 2026-01-18
**Status:** Draft
**Prerequisites:** v0.15.0 Complete (Dice Pool Refactor), v0.15.1 Complete (Skill Infrastructure)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
   - 3.1 [Tracking Flow Diagram](#31-tracking-flow-diagram)
   - 3.2 [Phase Transition Diagram](#32-phase-transition-diagram)
   - 3.3 [Service Interaction Diagram](#33-service-interaction-diagram)
   - 3.4 [Layer Architecture](#34-layer-architecture)
4. [TrailAge Enum](#4-trailage-enum)
5. [TrackingPhase Enum](#5-trackingphase-enum)
6. [TrackingState Entity](#6-trackingstate-entity)
7. [TrackingModifiers Value Object](#7-trackingmodifiers-value-object)
8. [TrackingCheck Value Object](#8-trackingcheck-value-object)
9. [TrackingResult Value Object](#9-trackingresult-value-object)
10. [TrackingService Implementation](#10-trackingservice-implementation)
11. [Data Model Changes](#11-data-model-changes)
12. [Configuration Files](#12-configuration-files)
    - 12.1 [trail-ages.json](#121-trail-agesjson)
    - 12.2 [tracking-modifiers.json](#122-tracking-modifiersjson)
    - 12.3 [trail-ages.schema.json](#123-trail-agesschemajson)
    - 12.4 [tracking-modifiers.schema.json](#124-tracking-modifiersschemajson)
    - 12.5 [Configuration Schema Summary](#125-configuration-schema-summary)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Use Cases](#15-use-cases)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies](#18-dependencies)
19. [Future Considerations](#19-future-considerations)
20. [Document Metadata](#20-document-metadata)

---

## 1. Executive Summary

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.5a, the Extended Tracking System. This phase implements the multi-phase tracking mechanics for the Wasteland Survival skill, enabling characters to pursue targets across the wasteland through systematic trail analysis and pursuit.

Tracking in Aethelgard follows a three-phase approach reflecting the practical realities of wasteland pursuit:

1. **Acquisition Phase**: Finding and identifying the initial trail
2. **Pursuit Phase**: Maintaining the trail across changing terrain with periodic checks
3. **Closing In Phase**: Final approach with contested perception checks

The system supports trail degradation over time, environmental modifiers, and recovery procedures when trails are lost.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Enums** | `TrailAge`, `TrackingPhase`, `TrackingStatus` |
| **Value Objects** | `TrackingModifiers`, `TrackingCheck`, `TrackingResult` |
| **Entities** | `TrackingState` |
| **Services** | `ITrackingService`, `TrackingService` |
| **Configuration** | `trail-ages.json`, `tracking-modifiers.json` |
| **Tests** | ~4 new unit tests |

### 1.3 Architectural Significance

This version establishes the **multi-phase procedural skill pattern** that will be reused throughout v0.15.5:

- **Phase-based state machine**: TrackingPhase enum with defined transitions
- **Cumulative modifiers**: DC adjustments that accumulate over time
- **Recovery procedures**: Mechanisms to recover from partial/full failure
- **Terrain integration**: Location-aware difficulty scaling

---

## 2. Feature Overview

```
v0.15.5a Extended Tracking System
├── Trail Classification
│   ├── TrailAge enum (6 age categories with base DCs)
│   ├── Trail type identification (automatic on acquisition)
│   └── Trail degradation over time (+1 DC per hour)
├── Tracking Phases
│   ├── Acquisition (initial trail discovery)
│   ├── Pursuit (maintain trail across terrain)
│   ├── Closing In (final approach, contested checks)
│   ├── Lost (trail lost, need recovery)
│   └── Cold (trail unrecoverable)
├── Tracking State
│   ├── TrackingState entity (persistent pursuit data)
│   ├── Check history tracking
│   ├── Cumulative DC modifiers
│   └── Distance/terrain history
├── Modifiers System
│   ├── Environmental modifiers (rain, blood trail, etc.)
│   ├── Target behavior modifiers (hiding, multiple targets)
│   └── Equipment bonuses
├── Recovery Procedures
│   ├── Partial loss (backtrack, same DC)
│   ├── Full loss (spiral search, +4 DC)
│   └── Critical loss (return to last known, +8 DC)
└── Phase Transitions
    ├── Acquisition → Pursuit (on success)
    ├── Pursuit → Closing In (within 500ft)
    ├── Any → Lost (on failure)
    └── Lost → Cold (3 failed recovery attempts)
```

---

## 3. Architecture Diagrams

### 3.1 Tracking Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         TRACKING ATTEMPT FLOW                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Player: "track goblin patrol"                                              │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    1. DETERMINE TRAIL AGE                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  TrailAge Classification:                                           │    │
│  │  ├── Obvious (DC 8)  - Caravan through ash                         │    │
│  │  ├── Fresh (DC 12)   - Less than 1 hour old                        │    │
│  │  ├── Standard (DC 16) - 2-8 hours old                              │    │
│  │  ├── Old (DC 20)     - 12-24 hours old                             │    │
│  │  ├── Obscured (DC 24) - Deliberately hidden                        │    │
│  │  └── Cold (DC 28)    - 24-48 hours (Master rank only)              │    │
│  │                                                                      │    │
│  │  Example: Fresh trail → Base DC 12                                  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    2. APPLY MODIFIERS                                │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  TrackingModifiers:                                                 │    │
│  │  ├── Blood trail: -4 DC                                            │    │
│  │  ├── Multiple targets: -2 DC                                       │    │
│  │  ├── Recent rain: +4 DC                                            │    │
│  │  ├── Target hiding: +2 DC                                          │    │
│  │  └── Hours passed: +1 DC per hour                                  │    │
│  │                                                                      │    │
│  │  Example: Fresh (12) + Blood (-4) = Effective DC 8                  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    3. PHASE 1: ACQUISITION                          │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Wasteland Survival check vs Effective DC                          │    │
│  │                                                                      │    │
│  │  On Success:                                                        │    │
│  │  ├── Trail found and identified                                    │    │
│  │  ├── Direction determined (automatic)                              │    │
│  │  ├── Optional: Estimate target count (DC 10 contested)             │    │
│  │  ├── Optional: Estimate trail age (DC 12)                          │    │
│  │  └── Transition to PURSUIT phase                                   │    │
│  │                                                                      │    │
│  │  On Failure:                                                        │    │
│  │  ├── May retry after 10 minutes at DC +2                           │    │
│  │  └── 3 failures: Trail unfindable, marked COLD                     │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼ (on success)                                                    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    4. PHASE 2: PURSUIT                              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Check frequency by terrain:                                        │    │
│  │  ├── Open wasteland: Every 2 miles                                 │    │
│  │  ├── Moderate ruins: Every 1 mile                                  │    │
│  │  ├── Dense ruins: Every 0.5 miles                                  │    │
│  │  └── Labyrinthine: Every room/intersection                         │    │
│  │                                                                      │    │
│  │  On Success: Continue pursuit, update distance                      │    │
│  │  On Failure: Transition to LOST phase                              │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼ (within 500ft of target)                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    5. PHASE 3: CLOSING IN                           │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Distance modifiers:                                                │    │
│  │  ├── Within 500 ft: -4 DC (target may detect pursuit)              │    │
│  │  ├── Within 100 ft: -6 DC (contested vs target Perception)         │    │
│  │  └── Within 50 ft: Auto-success (immediate encounter)              │    │
│  │                                                                      │    │
│  │  On Success: Target located, encounter begins                       │    │
│  │  On Failure: Target alerted, may flee or ambush                    │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Phase Transition Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      TRACKING PHASE STATE MACHINE                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│                              ┌──────────────┐                               │
│                              │   START      │                               │
│                              └──────┬───────┘                               │
│                                     │                                        │
│                                     │ Player initiates tracking             │
│                                     ▼                                        │
│                         ┌───────────────────────┐                           │
│                         │     ACQUISITION       │◄────────────────┐         │
│                         │  (Find initial trail) │                 │         │
│                         └───────────┬───────────┘                 │         │
│                                     │                              │         │
│                    ┌────────────────┼────────────────┐            │         │
│                    │ Success        │ Failure        │            │         │
│                    ▼                ▼                │            │         │
│         ┌──────────────────┐   ┌─────────────┐      │            │         │
│         │     PURSUIT      │   │ Retry (DC+2)│──────┘            │         │
│         │  (Follow trail)  │   └──────┬──────┘                   │         │
│         └────────┬─────────┘          │ 3 failures               │         │
│                  │                    ▼                           │         │
│     ┌────────────┼────────────┐   ┌─────────────┐                │         │
│     │ Success    │ Failure    │   │    COLD     │                │         │
│     ▼            ▼            │   │ (Unfindable)│                │         │
│  ┌──────┐   ┌─────────┐       │   └─────────────┘                │         │
│  │ More │   │  LOST   │       │                                  │         │
│  │ dist │   │(Recover)│       │                                  │         │
│  └──┬───┘   └────┬────┘       │                                  │         │
│     │            │            │                                  │         │
│     │            │ Recovery   │                                  │         │
│     │            ▼            │                                  │         │
│     │    ┌───────────────┐    │                                  │         │
│     │    │ Backtrack     │────┼───── Success ────────────────────┘         │
│     │    │ (Same DC)     │    │                                            │
│     │    ├───────────────┤    │                                            │
│     │    │ Spiral Search │    │      ┌─────────────┐                       │
│     │    │ (+4 DC)       │────┼─────▶│    COLD     │                       │
│     │    ├───────────────┤    │      │ (3 failures)│                       │
│     │    │ Return Known  │    │      └─────────────┘                       │
│     │    │ (+8 DC)       │────┘                                            │
│     │    └───────────────┘                                                  │
│     │                                                                        │
│     │  Within 500ft                                                         │
│     ▼                                                                        │
│  ┌────────────────────┐                                                     │
│  │    CLOSING IN      │                                                     │
│  │ (Final approach)   │                                                     │
│  └─────────┬──────────┘                                                     │
│            │                                                                 │
│    ┌───────┴───────┐                                                        │
│    │ Success       │ Failure                                                │
│    ▼               ▼                                                        │
│  ┌──────────┐  ┌──────────────┐                                            │
│  │ COMPLETE │  │ Target alerted│                                           │
│  │(Encounter)│  │ (Flee/Ambush)│                                           │
│  └──────────┘  └──────────────┘                                            │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Interaction Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SERVICE INTERACTION DIAGRAM                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                      COMMAND HANDLER                                 │   │
│   │                (TrackingCommandHandler)                             │   │
│   └─────────────────────────────┬───────────────────────────────────────┘   │
│                                 │                                            │
│                       parses command & target                               │
│                                 │                                            │
│                                 ▼                                            │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                      TRACKING SERVICE                                │   │
│   │                      (ITrackingService)                             │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  + InitiateTracking(player, targetDescription)                      │   │
│   │  + ContinuePursuit(player, trackingId)                              │   │
│   │  + AttemptRecovery(player, trackingId, recoveryType)                │   │
│   │  + GetTrackingState(trackingId)                                     │   │
│   │  + AbandonTracking(trackingId)                                      │   │
│   └──────────┬──────────────────────────┬───────────────────────────────┘   │
│              │                          │                                    │
│    performs check              manages state                                │
│              │                          │                                    │
│              ▼                          ▼                                    │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │   SKILL CHECK SERVICE   │  │   TRACKING STATE REPO   │                  │
│   │   (ISkillCheckService)  │  │  (ITrackingStateRepo)   │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ + PerformCheckWithDC()  │  │ + Save(trackingState)   │                  │
│   │ + CalculateDicePool()   │  │ + GetById(trackingId)   │                  │
│   │ + ApplyContext()        │  │ + GetActiveByPlayer()   │                  │
│   └──────────┬──────────────┘  └─────────────────────────┘                  │
│              │                                                               │
│       rolls dice                                                            │
│              │                                                               │
│              ▼                                                               │
│   ┌─────────────────────────┐                                               │
│   │     DICE SERVICE        │                                               │
│   │     (IDiceService)      │                                               │
│   ├─────────────────────────┤                                               │
│   │ + RollPool(count)       │                                               │
│   │ + CountSuccesses()      │                                               │
│   └─────────────────────────┘                                               │
│                                                                              │
│   Data Flow:                                                                │
│   ─────────────────────────────────────────────────────────────────────    │
│   1. CommandHandler parses "track <target>" command                         │
│   2. TrackingService.InitiateTracking() creates new TrackingState           │
│   3. Trail age determined from target/environment                           │
│   4. TrackingModifiers calculated from conditions                           │
│   5. SkillCheckService performs Wasteland Survival check                    │
│   6. TrackingState updated with result, phase transitioned                  │
│   7. TrackingResult returned with narrative and next steps                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Enums/                                                              │    │
│  │  ├── TrailAge.cs              ←── NEW (trail age classification)    │    │
│  │  ├── TrackingPhase.cs         ←── NEW (phase state machine)         │    │
│  │  └── TrackingStatus.cs        ←── NEW (overall tracking status)     │    │
│  │                                                                      │    │
│  │  ValueObjects/                                                       │    │
│  │  ├── TrackingModifiers.cs     ←── NEW (condition modifiers)         │    │
│  │  ├── TrackingCheck.cs         ←── NEW (individual check record)     │    │
│  │  └── TrackingResult.cs        ←── NEW (attempt result)              │    │
│  │                                                                      │    │
│  │  Entities/                                                           │    │
│  │  └── TrackingState.cs         ←── NEW (persistent pursuit state)    │    │
│  │                                                                      │    │
│  │  Interfaces/                                                         │    │
│  │  ├── ITrackingService.cs      ←── NEW (service interface)           │    │
│  │  └── ITrackingStateRepository.cs ←── NEW (persistence interface)    │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ implements                                │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Services/                                                           │    │
│  │  └── TrackingService.cs       ←── NEW (tracking mechanics)          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  EXISTING DEPENDENCIES                               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  From v0.15.0:                                                       │    │
│  │  ├── DiceRollResult          (success counting)                     │    │
│  │  ├── DiceService             (dice rolling)                         │    │
│  │  └── DiceConstants           (thresholds)                           │    │
│  │                                                                      │    │
│  │  From v0.15.1:                                                       │    │
│  │  ├── SkillContext            (modifier aggregation)                 │    │
│  │  ├── SkillContextBuilder     (context construction)                 │    │
│  │  ├── EquipmentModifier       (tool bonuses)                         │    │
│  │  ├── EnvironmentModifier     (terrain effects)                      │    │
│  │  ├── SkillCheckService       (check execution)                      │    │
│  │  └── SkillOutcome            (outcome classification)               │    │
│  │                                                                      │    │
│  │  From v0.15.4:                                                       │    │
│  │  └── TerrainType             (navigation terrain)                   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. TrailAge Enum

### 4.1 Enum Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/TrailAge.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Classification of trail ages with associated base difficulty classes for tracking.
/// </summary>
/// <remarks>
/// <para>
/// Trail age represents how old the signs of passage are, directly affecting the
/// difficulty of following the trail. Older trails have degraded more, with
/// footprints blown over, scent dissipated, and disturbances settled.
/// </para>
/// <para>
/// Base DCs assume normal conditions. Additional modifiers apply for:
/// <list type="bullet">
///   <item><description>Environmental conditions (rain +4, blood trail -4)</description></item>
///   <item><description>Target behavior (hiding +2, multiple targets -2)</description></item>
///   <item><description>Time elapsed since last check (+1 DC per hour)</description></item>
/// </list>
/// </para>
/// <para>
/// Cold trails (24-48 hours) can only be attempted by Master rank (Rank 5) trackers.
/// </para>
/// </remarks>
public enum TrailAge
{
    /// <summary>
    /// Obvious trail such as a caravan through ash or large group passage.
    /// </summary>
    /// <remarks>
    /// Unmistakable signs: deep ruts, scattered debris, obvious disturbance.
    /// Even untrained observers might notice this trail.
    /// Base DC: 8 (requires ~1-2 net successes).
    /// </remarks>
    Obvious = 8,

    /// <summary>
    /// Fresh trail less than 1 hour old.
    /// </summary>
    /// <remarks>
    /// Clear footprints, undisturbed dust patterns, fresh scent.
    /// Standard tracking difficulty for recent passage.
    /// Base DC: 12 (requires ~2 net successes).
    /// </remarks>
    Fresh = 12,

    /// <summary>
    /// Standard trail 2-8 hours old.
    /// </summary>
    /// <remarks>
    /// Footprints partially obscured, dust settling, scent fading.
    /// Most common tracking scenario in the wasteland.
    /// Base DC: 16 (requires ~3 net successes).
    /// </remarks>
    Standard = 16,

    /// <summary>
    /// Old trail 12-24 hours old.
    /// </summary>
    /// <remarks>
    /// Significantly degraded signs, requires careful examination.
    /// Wind, weather, and other passage have obscured much evidence.
    /// Base DC: 20 (requires ~4 net successes).
    /// </remarks>
    Old = 20,

    /// <summary>
    /// Deliberately obscured trail where target has taken counter-tracking measures.
    /// </summary>
    /// <remarks>
    /// Target has actively hidden their passage: brushed tracks, false trails,
    /// walked on hard surfaces, or used water crossings.
    /// Base DC: 24 (requires ~5 net successes).
    /// </remarks>
    Obscured = 24,

    /// <summary>
    /// Cold trail 24-48 hours old.
    /// </summary>
    /// <remarks>
    /// Extremely degraded, only the most subtle signs remain.
    /// Requires Master rank (Rank 5) in Wasteland Survival to attempt.
    /// Base DC: 28 (requires ~5+ net successes with high skill).
    /// </remarks>
    Cold = 28
}
```

### 4.2 Trail Age Summary Table

| Trail Age | Base DC | Time Range | Description | Rank Required |
|-----------|---------|------------|-------------|---------------|
| Obvious | 8 | N/A | Caravan, large group | Any |
| Fresh | 12 | < 1 hour | Clear signs, fresh scent | Any |
| Standard | 16 | 2-8 hours | Partially obscured | Any |
| Old | 20 | 12-24 hours | Significantly degraded | Any |
| Obscured | 24 | N/A | Deliberately hidden | Any |
| Cold | 28 | 24-48 hours | Extremely degraded | Master (Rank 5) |

---

## 5. TrackingPhase Enum

### 5.1 Enum Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/TrackingPhase.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Phases of the multi-stage tracking procedure.
/// </summary>
/// <remarks>
/// <para>
/// Tracking proceeds through distinct phases, each with different check
/// requirements and consequences:
/// </para>
/// <list type="bullet">
///   <item><description>Acquisition: Find the initial trail</description></item>
///   <item><description>Pursuit: Maintain trail over distance</description></item>
///   <item><description>ClosingIn: Final approach to target</description></item>
///   <item><description>Lost: Trail temporarily lost, recovery needed</description></item>
///   <item><description>Cold: Trail unrecoverable</description></item>
/// </list>
/// </remarks>
public enum TrackingPhase
{
    /// <summary>
    /// Initial phase: Finding and identifying the trail.
    /// </summary>
    /// <remarks>
    /// First check to locate signs of passage. On success, automatically
    /// identifies trail type and direction. Optional additional checks
    /// can estimate target count (DC 10) and trail age (DC 12).
    /// Failure allows retry after 10 minutes at DC +2.
    /// Three failures mark trail as Cold (unfindable).
    /// </remarks>
    Acquisition = 0,

    /// <summary>
    /// Following the trail across terrain.
    /// </summary>
    /// <remarks>
    /// Subsequent checks to maintain the trail over distance.
    /// Check frequency depends on terrain:
    /// - Open wasteland: Every 2 miles
    /// - Moderate ruins: Every 1 mile
    /// - Dense ruins: Every 0.5 miles
    /// - Labyrinthine: Every room/intersection
    /// Failure transitions to Lost phase.
    /// </remarks>
    Pursuit = 1,

    /// <summary>
    /// Final approach phase when near the target.
    /// </summary>
    /// <remarks>
    /// Triggered when within 500 feet of target.
    /// DC modifiers by distance:
    /// - Within 500 ft: -4 DC (target may detect pursuit)
    /// - Within 100 ft: -6 DC (contested vs target Perception)
    /// - Within 50 ft: Auto-success (immediate encounter)
    /// </remarks>
    ClosingIn = 2,

    /// <summary>
    /// Trail has been lost; recovery procedures needed.
    /// </summary>
    /// <remarks>
    /// Entered when a pursuit check fails. Recovery options:
    /// - Partial loss: Backtrack (10 min, same DC)
    /// - Full loss: Spiral search (30 min, +4 DC)
    /// - Critical loss: Return to last known (1 hr, +8 DC or new lead)
    /// Three failed recovery attempts mark trail as Cold.
    /// </remarks>
    Lost = 3,

    /// <summary>
    /// Trail is unrecoverable; tracking attempt has ended.
    /// </summary>
    /// <remarks>
    /// Terminal state indicating the trail cannot be followed further.
    /// Entered after 3 failed acquisition attempts or 3 failed recovery attempts.
    /// Player must find a new lead to resume tracking.
    /// </remarks>
    Cold = 4
}
```

### 5.2 TrackingStatus Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/TrackingStatus.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Overall status of a tracking pursuit.
/// </summary>
public enum TrackingStatus
{
    /// <summary>
    /// Tracking is actively in progress.
    /// </summary>
    Active = 0,

    /// <summary>
    /// Tracking was abandoned by the player.
    /// </summary>
    Abandoned = 1,

    /// <summary>
    /// Target was successfully located.
    /// </summary>
    TargetFound = 2,

    /// <summary>
    /// Trail went cold and is unrecoverable.
    /// </summary>
    TrailCold = 3
}
```

---

## 6. TrackingState Entity

### 6.1 Entity Definition

**File:** `src/Core/RuneAndRust.Domain/Entities/TrackingState.cs`

```csharp
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Persistent state for a multi-phase tracking pursuit.
/// </summary>
/// <remarks>
/// <para>
/// Tracks all information about an ongoing pursuit including:
/// <list type="bullet">
///   <item><description>Current phase and overall status</description></item>
///   <item><description>Trail characteristics and degradation</description></item>
///   <item><description>Check history and cumulative modifiers</description></item>
///   <item><description>Distance covered and terrain traversed</description></item>
/// </list>
/// </para>
/// <para>
/// TrackingState is an aggregate root that manages its own state transitions
/// and validates phase changes according to the tracking state machine.
/// </para>
/// </remarks>
public class TrackingState
{
    /// <summary>
    /// Unique identifier for this tracking pursuit.
    /// </summary>
    public string TrackingId { get; private set; }

    /// <summary>
    /// Identifier of the character performing the tracking.
    /// </summary>
    public string TrackerId { get; private set; }

    /// <summary>
    /// Description of what is being tracked.
    /// </summary>
    /// <remarks>
    /// May be specific ("goblin patrol") or general ("large creature").
    /// Updated as more information is discovered.
    /// </remarks>
    public string TargetDescription { get; private set; }

    /// <summary>
    /// Current phase of the tracking procedure.
    /// </summary>
    public TrackingPhase CurrentPhase { get; private set; }

    /// <summary>
    /// Age classification of the trail being followed.
    /// </summary>
    public TrailAge TrailAge { get; private set; }

    /// <summary>
    /// Total distance covered during pursuit in miles.
    /// </summary>
    public float DistanceCovered { get; private set; }

    /// <summary>
    /// Cumulative DC modifier from time elapsed and failed attempts.
    /// </summary>
    /// <remarks>
    /// Increases by 1 per hour elapsed and 2 per failed acquisition retry.
    /// Does not include base DC or condition modifiers.
    /// </remarks>
    public int CumulativeDcModifier { get; private set; }

    /// <summary>
    /// Number of failed attempts in current phase.
    /// </summary>
    /// <remarks>
    /// Resets when phase changes. Used to track 3-failure threshold
    /// for trail going cold.
    /// </remarks>
    public int FailedAttemptsInPhase { get; private set; }

    /// <summary>
    /// History of all tracking checks performed.
    /// </summary>
    public IReadOnlyList<TrackingCheck> CheckHistory => _checkHistory.AsReadOnly();
    private readonly List<TrackingCheck> _checkHistory;

    /// <summary>
    /// History of terrain types traversed during pursuit.
    /// </summary>
    public IReadOnlyList<TerrainType> TerrainHistory => _terrainHistory.AsReadOnly();
    private readonly List<TerrainType> _terrainHistory;

    /// <summary>
    /// Overall status of the tracking pursuit.
    /// </summary>
    public TrackingStatus Status { get; private set; }

    /// <summary>
    /// Timestamp when tracking began.
    /// </summary>
    public DateTime StartedAt { get; private set; }

    /// <summary>
    /// Timestamp of last check performed.
    /// </summary>
    public DateTime LastCheckAt { get; private set; }

    /// <summary>
    /// Estimated distance to target in feet (if known).
    /// </summary>
    /// <remarks>
    /// Only populated when in ClosingIn phase or through special abilities.
    /// </remarks>
    public int? EstimatedDistanceToTarget { get; private set; }

    /// <summary>
    /// Estimated number of targets (if determined).
    /// </summary>
    public int? EstimatedTargetCount { get; private set; }

    // Private constructor for EF Core
    private TrackingState()
    {
        _checkHistory = new List<TrackingCheck>();
        _terrainHistory = new List<TerrainType>();
    }

    /// <summary>
    /// Creates a new tracking state for a pursuit.
    /// </summary>
    /// <param name="trackerId">ID of the tracking character.</param>
    /// <param name="targetDescription">Description of the target.</param>
    /// <param name="trailAge">Age classification of the trail.</param>
    /// <returns>A new TrackingState in Acquisition phase.</returns>
    public static TrackingState Create(
        string trackerId,
        string targetDescription,
        TrailAge trailAge)
    {
        return new TrackingState
        {
            TrackingId = Guid.NewGuid().ToString(),
            TrackerId = trackerId ?? throw new ArgumentNullException(nameof(trackerId)),
            TargetDescription = targetDescription ?? throw new ArgumentNullException(nameof(targetDescription)),
            CurrentPhase = TrackingPhase.Acquisition,
            TrailAge = trailAge,
            DistanceCovered = 0f,
            CumulativeDcModifier = 0,
            FailedAttemptsInPhase = 0,
            Status = TrackingStatus.Active,
            StartedAt = DateTime.UtcNow,
            LastCheckAt = DateTime.UtcNow,
            _checkHistory = new List<TrackingCheck>(),
            _terrainHistory = new List<TerrainType>()
        };
    }

    /// <summary>
    /// Gets the base difficulty class for the current trail.
    /// </summary>
    public int BaseDc => (int)TrailAge;

    /// <summary>
    /// Gets the effective difficulty class including cumulative modifiers.
    /// </summary>
    /// <remarks>
    /// Does not include condition modifiers (blood trail, rain, etc.)
    /// which are calculated separately in TrackingModifiers.
    /// </remarks>
    public int EffectiveDc => BaseDc + CumulativeDcModifier;

    /// <summary>
    /// Whether the trail can still be followed.
    /// </summary>
    public bool IsActive => Status == TrackingStatus.Active;

    /// <summary>
    /// Whether the tracking has reached a terminal state.
    /// </summary>
    public bool IsComplete => Status != TrackingStatus.Active;

    /// <summary>
    /// Records a successful tracking check.
    /// </summary>
    /// <param name="check">The check result to record.</param>
    /// <param name="distanceAdvanced">Distance advanced in miles.</param>
    /// <param name="terrain">Terrain type traversed.</param>
    public void RecordSuccess(TrackingCheck check, float distanceAdvanced, TerrainType terrain)
    {
        ArgumentNullException.ThrowIfNull(check);

        _checkHistory.Add(check);
        _terrainHistory.Add(terrain);
        DistanceCovered += distanceAdvanced;
        LastCheckAt = DateTime.UtcNow;
        FailedAttemptsInPhase = 0; // Reset on success
    }

    /// <summary>
    /// Records a failed tracking check.
    /// </summary>
    /// <param name="check">The check result to record.</param>
    public void RecordFailure(TrackingCheck check)
    {
        ArgumentNullException.ThrowIfNull(check);

        _checkHistory.Add(check);
        LastCheckAt = DateTime.UtcNow;
        FailedAttemptsInPhase++;
    }

    /// <summary>
    /// Transitions to the Pursuit phase after successful acquisition.
    /// </summary>
    /// <exception cref="InvalidOperationException">If not in Acquisition phase.</exception>
    public void TransitionToPursuit()
    {
        if (CurrentPhase != TrackingPhase.Acquisition)
            throw new InvalidOperationException(
                $"Cannot transition to Pursuit from {CurrentPhase}. Must be in Acquisition phase.");

        CurrentPhase = TrackingPhase.Pursuit;
        FailedAttemptsInPhase = 0;
    }

    /// <summary>
    /// Transitions to the ClosingIn phase when near target.
    /// </summary>
    /// <param name="estimatedDistance">Estimated distance to target in feet.</param>
    /// <exception cref="InvalidOperationException">If not in Pursuit phase.</exception>
    public void TransitionToClosingIn(int estimatedDistance)
    {
        if (CurrentPhase != TrackingPhase.Pursuit)
            throw new InvalidOperationException(
                $"Cannot transition to ClosingIn from {CurrentPhase}. Must be in Pursuit phase.");

        CurrentPhase = TrackingPhase.ClosingIn;
        EstimatedDistanceToTarget = estimatedDistance;
        FailedAttemptsInPhase = 0;
    }

    /// <summary>
    /// Transitions to the Lost phase after a failed pursuit check.
    /// </summary>
    /// <exception cref="InvalidOperationException">If in terminal phase.</exception>
    public void TransitionToLost()
    {
        if (CurrentPhase == TrackingPhase.Cold)
            throw new InvalidOperationException("Cannot transition from Cold phase.");

        CurrentPhase = TrackingPhase.Lost;
        FailedAttemptsInPhase = 0;
    }

    /// <summary>
    /// Transitions to the Cold phase when trail is unrecoverable.
    /// </summary>
    public void TransitionToCold()
    {
        CurrentPhase = TrackingPhase.Cold;
        Status = TrackingStatus.TrailCold;
    }

    /// <summary>
    /// Recovers from Lost phase back to Pursuit.
    /// </summary>
    /// <exception cref="InvalidOperationException">If not in Lost phase.</exception>
    public void RecoverToPursuit()
    {
        if (CurrentPhase != TrackingPhase.Lost)
            throw new InvalidOperationException(
                $"Cannot recover from {CurrentPhase}. Must be in Lost phase.");

        CurrentPhase = TrackingPhase.Pursuit;
        FailedAttemptsInPhase = 0;
    }

    /// <summary>
    /// Marks tracking as complete when target is found.
    /// </summary>
    public void MarkTargetFound()
    {
        Status = TrackingStatus.TargetFound;
    }

    /// <summary>
    /// Marks tracking as abandoned by the player.
    /// </summary>
    public void Abandon()
    {
        Status = TrackingStatus.Abandoned;
    }

    /// <summary>
    /// Increases the cumulative DC modifier.
    /// </summary>
    /// <param name="amount">Amount to increase by.</param>
    public void IncreaseCumulativeModifier(int amount)
    {
        CumulativeDcModifier += Math.Max(0, amount);
    }

    /// <summary>
    /// Updates the estimated target count.
    /// </summary>
    /// <param name="count">Estimated number of targets.</param>
    public void SetEstimatedTargetCount(int count)
    {
        EstimatedTargetCount = Math.Max(1, count);
    }

    /// <summary>
    /// Updates the estimated distance to target.
    /// </summary>
    /// <param name="distanceFeet">Distance in feet.</param>
    public void UpdateDistanceToTarget(int distanceFeet)
    {
        EstimatedDistanceToTarget = Math.Max(0, distanceFeet);
    }
}
```

### 6.2 Property Summary Table

| Property | Type | Description |
|----------|------|-------------|
| `TrackingId` | `string` | Unique identifier |
| `TrackerId` | `string` | Character performing tracking |
| `TargetDescription` | `string` | What is being tracked |
| `CurrentPhase` | `TrackingPhase` | Current tracking phase |
| `TrailAge` | `TrailAge` | Age classification of trail |
| `DistanceCovered` | `float` | Miles traveled |
| `CumulativeDcModifier` | `int` | Accumulated DC increases |
| `FailedAttemptsInPhase` | `int` | Failures in current phase |
| `CheckHistory` | `List<TrackingCheck>` | Record of all checks |
| `TerrainHistory` | `List<TerrainType>` | Terrain traversed |
| `Status` | `TrackingStatus` | Overall tracking status |
| `EstimatedDistanceToTarget` | `int?` | Distance to target (feet) |
| `EstimatedTargetCount` | `int?` | Number of targets |

---

## 7. TrackingModifiers Value Object

### 7.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TrackingModifiers.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Contextual modifiers affecting tracking difficulty.
/// </summary>
/// <remarks>
/// <para>
/// Aggregates all condition-based modifiers that affect tracking checks.
/// Positive values increase difficulty, negative values decrease it.
/// </para>
/// <para>
/// Standard modifiers:
/// <list type="bullet">
///   <item><description>Blood trail: -4 DC</description></item>
///   <item><description>Rain (recent): +4 DC</description></item>
///   <item><description>Multiple targets: -2 DC</description></item>
///   <item><description>Single careful target: +2 DC</description></item>
///   <item><description>Fresh blood/injury: -2 DC per check</description></item>
///   <item><description>Each hour passed: +1 DC</description></item>
///   <item><description>Target deliberately hiding: +2 DC</description></item>
/// </list>
/// </para>
/// </remarks>
public sealed class TrackingModifiers
{
    /// <summary>
    /// Whether the target is leaving a blood trail.
    /// </summary>
    public bool HasBloodTrail { get; }

    /// <summary>
    /// Whether recent rain has obscured the trail.
    /// </summary>
    public bool HasRecentRain { get; }

    /// <summary>
    /// Number of targets being tracked.
    /// </summary>
    /// <remarks>
    /// Multiple targets (2+) make tracking easier (-2 DC).
    /// </remarks>
    public int TargetCount { get; }

    /// <summary>
    /// Whether the target is being careful to hide their passage.
    /// </summary>
    public bool TargetIsHiding { get; }

    /// <summary>
    /// Whether the target is freshly injured (bleeding each check).
    /// </summary>
    public bool TargetIsFreshlyInjured { get; }

    /// <summary>
    /// Hours elapsed since trail was created.
    /// </summary>
    public int HoursElapsed { get; }

    /// <summary>
    /// Current terrain type affecting check frequency.
    /// </summary>
    public TerrainType Terrain { get; }

    /// <summary>
    /// Tracker's equipment bonus (survival kit, tracking gear).
    /// </summary>
    public int EquipmentBonus { get; }

    /// <summary>
    /// Whether this is familiar territory to the tracker.
    /// </summary>
    public bool IsFamiliarTerritory { get; }

    /// <summary>
    /// Creates a new set of tracking modifiers.
    /// </summary>
    public TrackingModifiers(
        bool hasBloodTrail = false,
        bool hasRecentRain = false,
        int targetCount = 1,
        bool targetIsHiding = false,
        bool targetIsFreshlyInjured = false,
        int hoursElapsed = 0,
        TerrainType terrain = TerrainType.OpenWasteland,
        int equipmentBonus = 0,
        bool isFamiliarTerritory = false)
    {
        HasBloodTrail = hasBloodTrail;
        HasRecentRain = hasRecentRain;
        TargetCount = Math.Max(1, targetCount);
        TargetIsHiding = targetIsHiding;
        TargetIsFreshlyInjured = targetIsFreshlyInjured;
        HoursElapsed = Math.Max(0, hoursElapsed);
        Terrain = terrain;
        EquipmentBonus = equipmentBonus;
        IsFamiliarTerritory = isFamiliarTerritory;
    }

    /// <summary>
    /// Total DC modifier from all conditions.
    /// </summary>
    /// <remarks>
    /// Positive values increase difficulty, negative decrease it.
    /// </remarks>
    public int TotalDcModifier
    {
        get
        {
            int modifier = 0;

            // Blood trail makes tracking easier
            if (HasBloodTrail) modifier -= 4;

            // Fresh injury provides ongoing blood trail bonus
            if (TargetIsFreshlyInjured) modifier -= 2;

            // Multiple targets leave more signs
            if (TargetCount >= 2) modifier -= 2;

            // Rain obscures tracks
            if (HasRecentRain) modifier += 4;

            // Careful targets are harder to follow
            if (TargetIsHiding) modifier += 2;

            // Time degrades the trail
            modifier += HoursElapsed;

            return modifier;
        }
    }

    /// <summary>
    /// Total dice pool modifier from equipment and familiarity.
    /// </summary>
    public int TotalDiceModifier
    {
        get
        {
            int modifier = EquipmentBonus;

            // Familiar territory grants bonus
            if (IsFamiliarTerritory) modifier += 2;

            return modifier;
        }
    }

    /// <summary>
    /// Distance interval for pursuit checks based on terrain.
    /// </summary>
    /// <returns>Distance in miles between required checks.</returns>
    public float GetCheckIntervalMiles()
    {
        return Terrain switch
        {
            TerrainType.OpenWasteland => 2.0f,
            TerrainType.ModerateRuins => 1.0f,
            TerrainType.DenseRuins => 0.5f,
            TerrainType.Labyrinthine or TerrainType.GlitchedLabyrinth => 0.1f, // Per room
            _ => 1.0f
        };
    }

    /// <summary>
    /// Converts to SkillContext for skill check integration.
    /// </summary>
    public SkillContext ToSkillContext()
    {
        var builder = new SkillContextBuilder();

        // Add equipment modifier
        if (EquipmentBonus != 0)
        {
            builder.WithEquipment(
                equipmentId: "tracking-gear",
                equipmentName: "Tracking Equipment",
                diceModifier: EquipmentBonus);
        }

        // Add terrain/environment modifiers
        if (HasRecentRain)
        {
            builder.WithEnvironment(
                source: "Recent Rain",
                dcModifier: 4);
        }

        // Add situational modifiers
        if (HasBloodTrail)
        {
            builder.WithSituation(
                source: "Blood Trail",
                dcModifier: -4,
                description: "Target is leaving a blood trail");
        }

        if (TargetIsHiding)
        {
            builder.WithSituation(
                source: "Target Hiding",
                dcModifier: 2,
                description: "Target is actively concealing their trail");
        }

        if (IsFamiliarTerritory)
        {
            builder.WithSituation(
                source: "Familiar Territory",
                diceModifier: 2,
                description: "Tracker knows this area well");
        }

        return builder.Build();
    }

    /// <summary>
    /// Returns a human-readable description of active modifiers.
    /// </summary>
    public override string ToString()
    {
        var parts = new List<string>();

        if (HasBloodTrail) parts.Add("Blood Trail (-4 DC)");
        if (TargetIsFreshlyInjured) parts.Add("Fresh Injury (-2 DC)");
        if (TargetCount >= 2) parts.Add($"Multiple Targets ({TargetCount}, -2 DC)");
        if (HasRecentRain) parts.Add("Recent Rain (+4 DC)");
        if (TargetIsHiding) parts.Add("Target Hiding (+2 DC)");
        if (HoursElapsed > 0) parts.Add($"Time Elapsed (+{HoursElapsed} DC)");
        if (EquipmentBonus != 0) parts.Add($"Equipment ({(EquipmentBonus >= 0 ? "+" : "")}{EquipmentBonus}d10)");
        if (IsFamiliarTerritory) parts.Add("Familiar Territory (+2d10)");

        return parts.Count > 0
            ? string.Join(", ", parts)
            : "No modifiers";
    }
}
```

### 7.2 Modifiers Summary Table

| Condition | DC Modifier | Description |
|-----------|-------------|-------------|
| Blood trail | -4 | Target leaving blood |
| Fresh injury | -2 | Ongoing bleeding per check |
| Multiple targets (2+) | -2 | More signs to follow |
| Recent rain | +4 | Tracks obscured |
| Target hiding | +2 | Active concealment |
| Hours elapsed | +1/hour | Trail degradation |
| Familiar territory | +2d10 | Dice pool bonus |
| Equipment | varies | Survival kit, etc. |

---

## 8. TrackingCheck Value Object

### 8.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TrackingCheck.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Record of a single tracking check performed during pursuit.
/// </summary>
/// <remarks>
/// Captures all details of an individual check including the phase,
/// modifiers, result, and any consequences.
/// </remarks>
/// <param name="CheckId">Unique identifier for this check.</param>
/// <param name="Phase">Tracking phase when check was made.</param>
/// <param name="BaseDc">Base DC from trail age.</param>
/// <param name="EffectiveDc">Final DC after all modifiers.</param>
/// <param name="NetSuccesses">Net successes rolled.</param>
/// <param name="Outcome">Skill check outcome tier.</param>
/// <param name="Terrain">Terrain type at time of check.</param>
/// <param name="DistanceAtCheck">Distance covered when check was made.</param>
/// <param name="Timestamp">When the check was performed.</param>
/// <param name="ModifiersApplied">Description of modifiers used.</param>
public readonly record struct TrackingCheck(
    string CheckId,
    TrackingPhase Phase,
    int BaseDc,
    int EffectiveDc,
    int NetSuccesses,
    SkillOutcome Outcome,
    TerrainType Terrain,
    float DistanceAtCheck,
    DateTime Timestamp,
    string ModifiersApplied)
{
    /// <summary>
    /// Whether this check was successful.
    /// </summary>
    public bool IsSuccess => Outcome is SkillOutcome.MarginalSuccess
        or SkillOutcome.FullSuccess
        or SkillOutcome.ExceptionalSuccess
        or SkillOutcome.CriticalSuccess;

    /// <summary>
    /// Whether this was a critical success.
    /// </summary>
    public bool IsCriticalSuccess => Outcome == SkillOutcome.CriticalSuccess;

    /// <summary>
    /// Whether this was a fumble.
    /// </summary>
    public bool IsFumble => Outcome == SkillOutcome.CriticalFailure;

    /// <summary>
    /// Success margin (positive) or failure margin (negative).
    /// </summary>
    public int Margin => NetSuccesses - (EffectiveDc / 5); // Rough DC to successes conversion

    /// <summary>
    /// Creates a tracking check record from a skill check result.
    /// </summary>
    public static TrackingCheck FromSkillCheck(
        TrackingPhase phase,
        int baseDc,
        int effectiveDc,
        SkillCheckResult checkResult,
        TerrainType terrain,
        float distance,
        string modifiers)
    {
        return new TrackingCheck(
            CheckId: Guid.NewGuid().ToString(),
            Phase: phase,
            BaseDc: baseDc,
            EffectiveDc: effectiveDc,
            NetSuccesses: checkResult.DiceResult.NetSuccesses,
            Outcome: checkResult.Outcome,
            Terrain: terrain,
            DistanceAtCheck: distance,
            Timestamp: DateTime.UtcNow,
            ModifiersApplied: modifiers);
    }

    /// <summary>
    /// Returns a formatted summary of the check.
    /// </summary>
    public override string ToString()
    {
        var result = IsSuccess ? "SUCCESS" : "FAILURE";
        if (IsCriticalSuccess) result = "CRITICAL";
        if (IsFumble) result = "FUMBLE";

        return $"[{Phase}] {result}: {NetSuccesses} vs DC {EffectiveDc} ({ModifiersApplied})";
    }
}
```

---

## 9. TrackingResult Value Object

### 9.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TrackingResult.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Result of a tracking attempt or phase transition.
/// </summary>
/// <remarks>
/// Encapsulates the outcome of any tracking operation including:
/// <list type="bullet">
///   <item><description>Whether the check succeeded</description></item>
///   <item><description>The updated tracking state</description></item>
///   <item><description>Narrative description for the player</description></item>
///   <item><description>Available next actions</description></item>
/// </list>
/// </remarks>
/// <param name="IsSuccess">Whether the tracking check succeeded.</param>
/// <param name="Phase">Current tracking phase after this result.</param>
/// <param name="PreviousPhase">Phase before this check.</param>
/// <param name="Check">The check that was performed.</param>
/// <param name="TrackingState">Updated tracking state.</param>
/// <param name="NarrativeDescription">Flavor text for the player.</param>
/// <param name="NextActions">Available actions the player can take.</param>
/// <param name="DiscoveredInfo">Any new information discovered.</param>
public readonly record struct TrackingResult(
    bool IsSuccess,
    TrackingPhase Phase,
    TrackingPhase PreviousPhase,
    TrackingCheck Check,
    TrackingState TrackingState,
    string NarrativeDescription,
    IReadOnlyList<string> NextActions,
    TrackingDiscovery? DiscoveredInfo)
{
    /// <summary>
    /// Whether the phase changed as a result of this check.
    /// </summary>
    public bool PhaseChanged => Phase != PreviousPhase;

    /// <summary>
    /// Whether the tracking has completed (found target or trail cold).
    /// </summary>
    public bool IsComplete => TrackingState.IsComplete;

    /// <summary>
    /// Whether the trail has gone cold.
    /// </summary>
    public bool TrailWentCold => Phase == TrackingPhase.Cold;

    /// <summary>
    /// Whether the target was found.
    /// </summary>
    public bool TargetFound => TrackingState.Status == TrackingStatus.TargetFound;

    /// <summary>
    /// Creates a success result.
    /// </summary>
    public static TrackingResult Success(
        TrackingPhase phase,
        TrackingPhase previousPhase,
        TrackingCheck check,
        TrackingState state,
        string narrative,
        IReadOnlyList<string> nextActions,
        TrackingDiscovery? discovery = null)
    {
        return new TrackingResult(
            IsSuccess: true,
            Phase: phase,
            PreviousPhase: previousPhase,
            Check: check,
            TrackingState: state,
            NarrativeDescription: narrative,
            NextActions: nextActions,
            DiscoveredInfo: discovery);
    }

    /// <summary>
    /// Creates a failure result.
    /// </summary>
    public static TrackingResult Failure(
        TrackingPhase phase,
        TrackingPhase previousPhase,
        TrackingCheck check,
        TrackingState state,
        string narrative,
        IReadOnlyList<string> nextActions)
    {
        return new TrackingResult(
            IsSuccess: false,
            Phase: phase,
            PreviousPhase: previousPhase,
            Check: check,
            TrackingState: state,
            NarrativeDescription: narrative,
            NextActions: nextActions,
            DiscoveredInfo: null);
    }

    /// <summary>
    /// Returns a formatted summary of the result.
    /// </summary>
    public override string ToString()
    {
        var status = IsSuccess ? "SUCCESS" : "FAILURE";
        if (TargetFound) status = "TARGET FOUND";
        if (TrailWentCold) status = "TRAIL COLD";

        return $"Tracking {status}: {NarrativeDescription}";
    }
}

/// <summary>
/// Information discovered during tracking.
/// </summary>
/// <param name="TargetCount">Estimated number of targets.</param>
/// <param name="TrailAge">Estimated age of the trail.</param>
/// <param name="Direction">Direction of travel.</param>
/// <param name="AdditionalInfo">Any other discovered details.</param>
public readonly record struct TrackingDiscovery(
    int? TargetCount,
    TrailAge? TrailAge,
    string? Direction,
    string? AdditionalInfo);
```

---

## 10. TrackingService Implementation

### 10.1 Interface Definition

**File:** `src/Core/RuneAndRust.Domain/Interfaces/ITrackingService.cs`

```csharp
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.Interfaces;

/// <summary>
/// Service for executing multi-phase tracking pursuits.
/// </summary>
public interface ITrackingService
{
    /// <summary>
    /// Initiates a new tracking pursuit.
    /// </summary>
    /// <param name="player">The player initiating tracking.</param>
    /// <param name="targetDescription">Description of what to track.</param>
    /// <param name="trailAge">Age classification of the trail.</param>
    /// <param name="modifiers">Environmental and condition modifiers.</param>
    /// <returns>Result of the acquisition check.</returns>
    TrackingResult InitiateTracking(
        Player player,
        string targetDescription,
        TrailAge trailAge,
        TrackingModifiers modifiers);

    /// <summary>
    /// Continues an active pursuit with another check.
    /// </summary>
    /// <param name="player">The player continuing pursuit.</param>
    /// <param name="trackingId">ID of the active tracking state.</param>
    /// <param name="modifiers">Current modifiers.</param>
    /// <param name="distanceAdvanced">Distance traveled since last check.</param>
    /// <returns>Result of the pursuit check.</returns>
    TrackingResult ContinuePursuit(
        Player player,
        string trackingId,
        TrackingModifiers modifiers,
        float distanceAdvanced);

    /// <summary>
    /// Attempts to recover a lost trail.
    /// </summary>
    /// <param name="player">The player attempting recovery.</param>
    /// <param name="trackingId">ID of the tracking state.</param>
    /// <param name="recoveryType">Type of recovery procedure.</param>
    /// <param name="modifiers">Current modifiers.</param>
    /// <returns>Result of the recovery attempt.</returns>
    TrackingResult AttemptRecovery(
        Player player,
        string trackingId,
        RecoveryType recoveryType,
        TrackingModifiers modifiers);

    /// <summary>
    /// Gets the current state of a tracking pursuit.
    /// </summary>
    /// <param name="trackingId">ID of the tracking state.</param>
    /// <returns>The tracking state, or null if not found.</returns>
    TrackingState? GetTrackingState(string trackingId);

    /// <summary>
    /// Gets the active tracking for a player.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <returns>Active tracking state, or null if none.</returns>
    TrackingState? GetActiveTracking(string playerId);

    /// <summary>
    /// Abandons an active tracking pursuit.
    /// </summary>
    /// <param name="trackingId">ID of the tracking to abandon.</param>
    void AbandonTracking(string trackingId);

    /// <summary>
    /// Attempts to estimate target count (optional acquisition check).
    /// </summary>
    /// <param name="player">The player making the estimate.</param>
    /// <param name="trackingId">ID of the tracking state.</param>
    /// <returns>Estimated count on success, null on failure.</returns>
    int? EstimateTargetCount(Player player, string trackingId);

    /// <summary>
    /// Attempts to estimate trail age (optional acquisition check).
    /// </summary>
    /// <param name="player">The player making the estimate.</param>
    /// <param name="trackingId">ID of the tracking state.</param>
    /// <returns>Estimated age on success, null on failure.</returns>
    TrailAge? EstimateTrailAge(Player player, string trackingId);
}

/// <summary>
/// Types of trail recovery procedures.
/// </summary>
public enum RecoveryType
{
    /// <summary>
    /// Backtrack to last confirmed point (10 min, same DC).
    /// </summary>
    Backtrack,

    /// <summary>
    /// Spiral search pattern (30 min, +4 DC).
    /// </summary>
    SpiralSearch,

    /// <summary>
    /// Return to last known location (1 hr, +8 DC or new lead).
    /// </summary>
    ReturnToLastKnown
}
```

### 10.2 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/TrackingService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.Interfaces;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Service for executing multi-phase tracking pursuits using Wasteland Survival skill.
/// </summary>
/// <remarks>
/// <para>
/// Implements the three-phase tracking procedure:
/// <list type="bullet">
///   <item><description>Acquisition: Find and identify the trail</description></item>
///   <item><description>Pursuit: Maintain the trail over distance</description></item>
///   <item><description>Closing In: Final approach to target</description></item>
/// </list>
/// </para>
/// </remarks>
public class TrackingService : ITrackingService
{
    private readonly ISkillCheckService _skillCheckService;
    private readonly ITrackingStateRepository _stateRepository;
    private readonly IGameConfigurationProvider _configProvider;
    private readonly ILogger<TrackingService> _logger;

    private const string WastelandSurvivalSkillId = "wasteland-survival";
    private const int MaxAcquisitionFailures = 3;
    private const int MaxRecoveryFailures = 3;
    private const int TargetCountEstimateDc = 10;
    private const int TrailAgeEstimateDc = 12;

    /// <summary>
    /// Creates a new TrackingService.
    /// </summary>
    public TrackingService(
        ISkillCheckService skillCheckService,
        ITrackingStateRepository stateRepository,
        IGameConfigurationProvider configProvider,
        ILogger<TrackingService> logger)
    {
        _skillCheckService = skillCheckService ?? throw new ArgumentNullException(nameof(skillCheckService));
        _stateRepository = stateRepository ?? throw new ArgumentNullException(nameof(stateRepository));
        _configProvider = configProvider ?? throw new ArgumentNullException(nameof(configProvider));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public TrackingResult InitiateTracking(
        Player player,
        string targetDescription,
        TrailAge trailAge,
        TrackingModifiers modifiers)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentNullException.ThrowIfNull(targetDescription);
        ArgumentNullException.ThrowIfNull(modifiers);

        // Check for cold trails requiring Master rank
        if (trailAge == TrailAge.Cold && !HasMasterRank(player))
        {
            _logger.LogWarning(
                "Player {PlayerId} attempted cold trail without Master rank",
                player.Id);

            return CreateBlockedResult(
                "The trail is too old. Only a Master tracker could follow signs this faded.",
                TrackingPhase.Cold);
        }

        _logger.LogInformation(
            "Player {PlayerId} initiating tracking for '{Target}' (TrailAge: {Age})",
            player.Id, targetDescription, trailAge);

        // Create tracking state
        var state = TrackingState.Create(player.Id.ToString(), targetDescription, trailAge);

        // Calculate effective DC
        var baseDc = (int)trailAge;
        var effectiveDc = baseDc + modifiers.TotalDcModifier;

        // Build skill context
        var skillContext = modifiers.ToSkillContext();

        // Perform acquisition check
        var checkResult = _skillCheckService.PerformCheckWithDC(
            player,
            WastelandSurvivalSkillId,
            effectiveDc,
            difficultyName: $"{trailAge} Trail",
            context: skillContext);

        // Record the check
        var trackingCheck = TrackingCheck.FromSkillCheck(
            TrackingPhase.Acquisition,
            baseDc,
            effectiveDc,
            checkResult,
            modifiers.Terrain,
            0f,
            modifiers.ToString());

        if (checkResult.Outcome.IsSuccess())
        {
            state.RecordSuccess(trackingCheck, 0f, modifiers.Terrain);
            state.TransitionToPursuit();
            _stateRepository.Save(state);

            _logger.LogInformation(
                "Tracking {TrackingId} acquired trail successfully",
                state.TrackingId);

            return TrackingResult.Success(
                phase: TrackingPhase.Pursuit,
                previousPhase: TrackingPhase.Acquisition,
                check: trackingCheck,
                state: state,
                narrative: GenerateAcquisitionSuccessNarrative(trailAge, checkResult.Outcome),
                nextActions: new[] { "Continue pursuit", "Estimate target count", "Estimate trail age" },
                discovery: new TrackingDiscovery(null, trailAge, "North", null));
        }
        else
        {
            state.RecordFailure(trackingCheck);
            state.IncreaseCumulativeModifier(2); // +2 DC for retry

            if (state.FailedAttemptsInPhase >= MaxAcquisitionFailures)
            {
                state.TransitionToCold();
                _logger.LogWarning("Tracking {TrackingId} trail went cold after 3 failures", state.TrackingId);
            }

            _stateRepository.Save(state);

            _logger.LogDebug(
                "Tracking acquisition failed, attempt {Attempt}/{Max}",
                state.FailedAttemptsInPhase, MaxAcquisitionFailures);

            return TrackingResult.Failure(
                phase: state.CurrentPhase,
                previousPhase: TrackingPhase.Acquisition,
                check: trackingCheck,
                state: state,
                narrative: GenerateAcquisitionFailureNarrative(state),
                nextActions: state.CurrentPhase == TrackingPhase.Cold
                    ? new[] { "Find a new lead" }
                    : new[] { "Retry (10 min, DC +2)", "Abandon tracking" });
        }
    }

    /// <inheritdoc/>
    public TrackingResult ContinuePursuit(
        Player player,
        string trackingId,
        TrackingModifiers modifiers,
        float distanceAdvanced)
    {
        var state = _stateRepository.GetById(trackingId);
        if (state == null)
        {
            throw new InvalidOperationException($"Tracking state {trackingId} not found.");
        }

        if (state.CurrentPhase != TrackingPhase.Pursuit)
        {
            throw new InvalidOperationException(
                $"Cannot continue pursuit in {state.CurrentPhase} phase.");
        }

        var effectiveDc = state.EffectiveDc + modifiers.TotalDcModifier;
        var skillContext = modifiers.ToSkillContext();

        var checkResult = _skillCheckService.PerformCheckWithDC(
            player,
            WastelandSurvivalSkillId,
            effectiveDc,
            difficultyName: "Pursuit",
            context: skillContext);

        var trackingCheck = TrackingCheck.FromSkillCheck(
            TrackingPhase.Pursuit,
            state.BaseDc,
            effectiveDc,
            checkResult,
            modifiers.Terrain,
            state.DistanceCovered + distanceAdvanced,
            modifiers.ToString());

        if (checkResult.Outcome.IsSuccess())
        {
            state.RecordSuccess(trackingCheck, distanceAdvanced, modifiers.Terrain);

            // Check if closing in (within 500ft)
            // This would be determined by game state; for now use distance heuristic
            var estimatedDistanceToTarget = CalculateEstimatedDistance(state);
            if (estimatedDistanceToTarget <= 500)
            {
                state.TransitionToClosingIn(estimatedDistanceToTarget);
            }

            _stateRepository.Save(state);

            return TrackingResult.Success(
                phase: state.CurrentPhase,
                previousPhase: TrackingPhase.Pursuit,
                check: trackingCheck,
                state: state,
                narrative: GeneratePursuitSuccessNarrative(checkResult.Outcome, state),
                nextActions: GetPursuitNextActions(state));
        }
        else
        {
            state.RecordFailure(trackingCheck);
            state.TransitionToLost();
            _stateRepository.Save(state);

            return TrackingResult.Failure(
                phase: TrackingPhase.Lost,
                previousPhase: TrackingPhase.Pursuit,
                check: trackingCheck,
                state: state,
                narrative: "The trail becomes confused. You've lost the signs of passage.",
                nextActions: new[] { "Backtrack (10 min)", "Spiral search (30 min)", "Return to last known (1 hr)" });
        }
    }

    /// <inheritdoc/>
    public TrackingResult AttemptRecovery(
        Player player,
        string trackingId,
        RecoveryType recoveryType,
        TrackingModifiers modifiers)
    {
        var state = _stateRepository.GetById(trackingId);
        if (state == null)
        {
            throw new InvalidOperationException($"Tracking state {trackingId} not found.");
        }

        if (state.CurrentPhase != TrackingPhase.Lost)
        {
            throw new InvalidOperationException(
                $"Cannot attempt recovery in {state.CurrentPhase} phase.");
        }

        // Calculate DC based on recovery type
        var dcModifier = recoveryType switch
        {
            RecoveryType.Backtrack => 0,
            RecoveryType.SpiralSearch => 4,
            RecoveryType.ReturnToLastKnown => 8,
            _ => 0
        };

        var effectiveDc = state.EffectiveDc + modifiers.TotalDcModifier + dcModifier;
        var skillContext = modifiers.ToSkillContext();

        var checkResult = _skillCheckService.PerformCheckWithDC(
            player,
            WastelandSurvivalSkillId,
            effectiveDc,
            difficultyName: $"Recovery ({recoveryType})",
            context: skillContext);

        var trackingCheck = TrackingCheck.FromSkillCheck(
            TrackingPhase.Lost,
            state.BaseDc,
            effectiveDc,
            checkResult,
            modifiers.Terrain,
            state.DistanceCovered,
            $"{modifiers}, Recovery: {recoveryType}");

        if (checkResult.Outcome.IsSuccess())
        {
            state.RecordSuccess(trackingCheck, 0f, modifiers.Terrain);
            state.RecoverToPursuit();
            _stateRepository.Save(state);

            return TrackingResult.Success(
                phase: TrackingPhase.Pursuit,
                previousPhase: TrackingPhase.Lost,
                check: trackingCheck,
                state: state,
                narrative: GenerateRecoverySuccessNarrative(recoveryType),
                nextActions: new[] { "Continue pursuit" });
        }
        else
        {
            state.RecordFailure(trackingCheck);

            if (state.FailedAttemptsInPhase >= MaxRecoveryFailures)
            {
                state.TransitionToCold();
            }

            _stateRepository.Save(state);

            return TrackingResult.Failure(
                phase: state.CurrentPhase,
                previousPhase: TrackingPhase.Lost,
                check: trackingCheck,
                state: state,
                narrative: GenerateRecoveryFailureNarrative(state, recoveryType),
                nextActions: state.CurrentPhase == TrackingPhase.Cold
                    ? new[] { "Find a new lead" }
                    : new[] { "Backtrack (10 min)", "Spiral search (30 min)", "Return to last known (1 hr)" });
        }
    }

    /// <inheritdoc/>
    public TrackingState? GetTrackingState(string trackingId)
    {
        return _stateRepository.GetById(trackingId);
    }

    /// <inheritdoc/>
    public TrackingState? GetActiveTracking(string playerId)
    {
        return _stateRepository.GetActiveByPlayer(playerId);
    }

    /// <inheritdoc/>
    public void AbandonTracking(string trackingId)
    {
        var state = _stateRepository.GetById(trackingId);
        if (state != null)
        {
            state.Abandon();
            _stateRepository.Save(state);
            _logger.LogInformation("Tracking {TrackingId} abandoned", trackingId);
        }
    }

    /// <inheritdoc/>
    public int? EstimateTargetCount(Player player, string trackingId)
    {
        var state = _stateRepository.GetById(trackingId);
        if (state == null || state.CurrentPhase == TrackingPhase.Cold)
            return null;

        var checkResult = _skillCheckService.PerformCheckWithDC(
            player,
            WastelandSurvivalSkillId,
            TargetCountEstimateDc,
            difficultyName: "Estimate Count");

        if (checkResult.Outcome.IsSuccess())
        {
            var count = Random.Shared.Next(1, 6); // Would come from actual target data
            state.SetEstimatedTargetCount(count);
            _stateRepository.Save(state);
            return count;
        }

        return null;
    }

    /// <inheritdoc/>
    public TrailAge? EstimateTrailAge(Player player, string trackingId)
    {
        var state = _stateRepository.GetById(trackingId);
        if (state == null || state.CurrentPhase == TrackingPhase.Cold)
            return null;

        var checkResult = _skillCheckService.PerformCheckWithDC(
            player,
            WastelandSurvivalSkillId,
            TrailAgeEstimateDc,
            difficultyName: "Estimate Age");

        if (checkResult.Outcome.IsSuccess())
        {
            return state.TrailAge;
        }

        return null;
    }

    // Private helper methods

    private bool HasMasterRank(Player player)
    {
        // Check if player has Master (Rank 5) in Wasteland Survival
        // Implementation depends on skill system
        return false; // Placeholder
    }

    private int CalculateEstimatedDistance(TrackingState state)
    {
        // Calculate estimated distance to target based on pursuit progress
        // This would integrate with actual world state
        return 1000; // Placeholder: 1000 feet
    }

    private static string[] GetPursuitNextActions(TrackingState state)
    {
        if (state.CurrentPhase == TrackingPhase.ClosingIn)
        {
            return new[] { "Close in on target", "Observe from distance" };
        }
        return new[] { "Continue pursuit" };
    }

    private TrackingResult CreateBlockedResult(string message, TrackingPhase phase)
    {
        return new TrackingResult(
            IsSuccess: false,
            Phase: phase,
            PreviousPhase: phase,
            Check: default,
            TrackingState: null!,
            NarrativeDescription: message,
            NextActions: Array.Empty<string>(),
            DiscoveredInfo: null);
    }

    private static string GenerateAcquisitionSuccessNarrative(TrailAge age, SkillOutcome outcome)
    {
        return outcome switch
        {
            SkillOutcome.CriticalSuccess =>
                "With masterful precision, you immediately identify the trail and discern details most would miss. " +
                "The signs of passage are clear to your trained eye.",
            SkillOutcome.ExceptionalSuccess =>
                "You quickly locate the trail and determine the direction of travel. " +
                "The quarry passed this way recently.",
            SkillOutcome.FullSuccess =>
                "After careful examination, you find the trail. Footprints and disturbed debris " +
                "mark the path your target took.",
            _ =>
                "You manage to locate signs of passage. The trail leads onward, though following it " +
                "will require continued vigilance."
        };
    }

    private static string GenerateAcquisitionFailureNarrative(TrackingState state)
    {
        if (state.CurrentPhase == TrackingPhase.Cold)
        {
            return "Despite your best efforts, the trail has gone completely cold. " +
                   "Too many hours have passed, or the target has covered their tracks too well.";
        }

        return state.FailedAttemptsInPhase switch
        {
            1 => "You search the area but find no clear signs of passage. Perhaps another approach would help.",
            2 => "The trail remains elusive. The signs are there but faded, confused by time and elements.",
            _ => "You struggle to find any trace. One more failure and the trail will be lost entirely."
        };
    }

    private static string GeneratePursuitSuccessNarrative(SkillOutcome outcome, TrackingState state)
    {
        if (state.CurrentPhase == TrackingPhase.ClosingIn)
        {
            return "The signs grow fresher. You're closing in on your quarry. " +
                   "Caution is needed now—they may detect your pursuit.";
        }

        return "You maintain the trail, following the signs through the wasteland. " +
               "The pursuit continues.";
    }

    private static string GenerateRecoverySuccessNarrative(RecoveryType type)
    {
        return type switch
        {
            RecoveryType.Backtrack =>
                "Retracing your steps, you find where you lost the trail and pick it up again.",
            RecoveryType.SpiralSearch =>
                "Your systematic search pays off. After circling the area, you locate the trail once more.",
            RecoveryType.ReturnToLastKnown =>
                "Returning to the last confirmed location, you start fresh and rediscover the path forward.",
            _ => "You've recovered the trail."
        };
    }

    private static string GenerateRecoveryFailureNarrative(TrackingState state, RecoveryType type)
    {
        if (state.CurrentPhase == TrackingPhase.Cold)
        {
            return "Despite your best efforts, the trail is truly lost. " +
                   "You'll need to find a new lead to continue the pursuit.";
        }

        return type switch
        {
            RecoveryType.Backtrack =>
                "Backtracking yields nothing. The trail seems to have vanished entirely.",
            RecoveryType.SpiralSearch =>
                "Your search turns up nothing useful. The trail remains lost.",
            RecoveryType.ReturnToLastKnown =>
                "Even from the last known point, you cannot pick up the trail again.",
            _ => "The recovery attempt fails."
        };
    }
}
```

---

## 11. Data Model Changes

### 11.1 New Types Summary

| Type | Layer | File | Description |
|------|-------|------|-------------|
| `TrailAge` | Domain | `Enums/TrailAge.cs` | Trail age classification enum |
| `TrackingPhase` | Domain | `Enums/TrackingPhase.cs` | Tracking phase state machine |
| `TrackingStatus` | Domain | `Enums/TrackingStatus.cs` | Overall tracking status |
| `TrackingModifiers` | Domain | `ValueObjects/TrackingModifiers.cs` | Condition modifiers |
| `TrackingCheck` | Domain | `ValueObjects/TrackingCheck.cs` | Individual check record |
| `TrackingResult` | Domain | `ValueObjects/TrackingResult.cs` | Attempt result |
| `TrackingDiscovery` | Domain | `ValueObjects/TrackingResult.cs` | Discovered information |
| `TrackingState` | Domain | `Entities/TrackingState.cs` | Persistent pursuit state |
| `ITrackingService` | Domain | `Interfaces/ITrackingService.cs` | Service interface |
| `ITrackingStateRepository` | Domain | `Interfaces/ITrackingStateRepository.cs` | Persistence interface |
| `RecoveryType` | Domain | `Interfaces/ITrackingService.cs` | Recovery procedure enum |
| `TrackingService` | Application | `Services/TrackingService.cs` | Service implementation |

### 11.2 Dependencies on Existing Types

| Type | Layer | Usage |
|------|-------|-------|
| `TerrainType` | Domain | Terrain classification |
| `SkillOutcome` | Domain | Outcome classification |
| `SkillCheckResult` | Domain | Underlying check result |
| `SkillContext` | Domain | Skill modifier aggregation |
| `ISkillCheckService` | Application | Skill check execution |

---

## 12. Configuration Files

### 12.1 trail-ages.json

**File:** `config/trail-ages.json`

```json
{
    "$schema": "./schemas/trail-ages.schema.json",
    "trailAges": [
        {
            "id": "obvious",
            "type": "Obvious",
            "baseDc": 8,
            "displayName": "Obvious Trail",
            "description": "Unmistakable signs of passage: deep ruts, scattered debris, obvious disturbance.",
            "timeRange": null,
            "requiresMasterRank": false
        },
        {
            "id": "fresh",
            "type": "Fresh",
            "baseDc": 12,
            "displayName": "Fresh Trail",
            "description": "Clear footprints, undisturbed dust patterns, fresh scent.",
            "timeRange": "< 1 hour",
            "requiresMasterRank": false
        },
        {
            "id": "standard",
            "type": "Standard",
            "baseDc": 16,
            "displayName": "Standard Trail",
            "description": "Footprints partially obscured, dust settling, scent fading.",
            "timeRange": "2-8 hours",
            "requiresMasterRank": false
        },
        {
            "id": "old",
            "type": "Old",
            "baseDc": 20,
            "displayName": "Old Trail",
            "description": "Significantly degraded signs, requires careful examination.",
            "timeRange": "12-24 hours",
            "requiresMasterRank": false
        },
        {
            "id": "obscured",
            "type": "Obscured",
            "baseDc": 24,
            "displayName": "Obscured Trail",
            "description": "Target has actively hidden their passage.",
            "timeRange": null,
            "requiresMasterRank": false
        },
        {
            "id": "cold",
            "type": "Cold",
            "baseDc": 28,
            "displayName": "Cold Trail",
            "description": "Extremely degraded, only the most subtle signs remain.",
            "timeRange": "24-48 hours",
            "requiresMasterRank": true
        }
    ]
}
```

### 12.2 tracking-modifiers.json

**File:** `config/tracking-modifiers.json`

```json
{
    "$schema": "./schemas/tracking-modifiers.schema.json",
    "conditionModifiers": [
        {
            "id": "blood-trail",
            "displayName": "Blood Trail",
            "dcModifier": -4,
            "description": "Target is leaving a blood trail"
        },
        {
            "id": "fresh-injury",
            "displayName": "Fresh Injury",
            "dcModifier": -2,
            "description": "Target is actively bleeding"
        },
        {
            "id": "multiple-targets",
            "displayName": "Multiple Targets",
            "dcModifier": -2,
            "description": "Two or more targets leave more signs"
        },
        {
            "id": "recent-rain",
            "displayName": "Recent Rain",
            "dcModifier": 4,
            "description": "Rain has obscured tracks"
        },
        {
            "id": "target-hiding",
            "displayName": "Target Hiding",
            "dcModifier": 2,
            "description": "Target is actively concealing their trail"
        },
        {
            "id": "single-careful",
            "displayName": "Careful Target",
            "dcModifier": 2,
            "description": "Single target moving carefully"
        }
    ],
    "timeModifiers": {
        "perHourDcIncrease": 1,
        "description": "Trail degrades +1 DC per hour elapsed"
    },
    "terrainCheckIntervals": [
        {
            "terrain": "OpenWasteland",
            "intervalMiles": 2.0,
            "description": "Check every 2 miles"
        },
        {
            "terrain": "ModerateRuins",
            "intervalMiles": 1.0,
            "description": "Check every 1 mile"
        },
        {
            "terrain": "DenseRuins",
            "intervalMiles": 0.5,
            "description": "Check every half mile"
        },
        {
            "terrain": "Labyrinthine",
            "intervalMiles": 0.1,
            "description": "Check every room/intersection"
        },
        {
            "terrain": "GlitchedLabyrinth",
            "intervalMiles": 0.1,
            "description": "Check every room/intersection"
        }
    ],
    "recoveryProcedures": [
        {
            "type": "Backtrack",
            "dcModifier": 0,
            "timeCostMinutes": 10,
            "description": "Retrace steps to last confirmed point"
        },
        {
            "type": "SpiralSearch",
            "dcModifier": 4,
            "timeCostMinutes": 30,
            "description": "Systematic search of surrounding area"
        },
        {
            "type": "ReturnToLastKnown",
            "dcModifier": 8,
            "timeCostMinutes": 60,
            "description": "Return to last known location and restart"
        }
    ],
    "closingInModifiers": [
        {
            "distanceFeet": 500,
            "dcModifier": -4,
            "note": "Target may detect pursuit"
        },
        {
            "distanceFeet": 100,
            "dcModifier": -6,
            "note": "Contested vs target Perception"
        },
        {
            "distanceFeet": 50,
            "dcModifier": null,
            "note": "Auto-success, immediate encounter"
        }
    ]
}
```

### 12.3 trail-ages.schema.json

**File:** `config/schemas/trail-ages.schema.json`

```json
{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runeandrust.game/schemas/trail-ages.schema.json",
    "title": "Trail Ages Configuration",
    "description": "Configuration schema for trail age classifications",
    "type": "object",
    "required": ["trailAges"],
    "properties": {
        "trailAges": {
            "type": "array",
            "description": "Array of trail age definitions",
            "items": {
                "type": "object",
                "required": ["id", "type", "baseDc", "displayName", "description", "requiresMasterRank"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier"
                    },
                    "type": {
                        "type": "string",
                        "enum": ["Obvious", "Fresh", "Standard", "Old", "Obscured", "Cold"],
                        "description": "TrailAge enum value"
                    },
                    "baseDc": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30,
                        "description": "Base difficulty class"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Human-readable name"
                    },
                    "description": {
                        "type": "string",
                        "description": "Flavor text"
                    },
                    "timeRange": {
                        "type": ["string", "null"],
                        "description": "Time range for this age category"
                    },
                    "requiresMasterRank": {
                        "type": "boolean",
                        "description": "Whether Master rank is required"
                    }
                }
            }
        }
    }
}
```

### 12.4 tracking-modifiers.schema.json

**File:** `config/schemas/tracking-modifiers.schema.json`

```json
{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runeandrust.game/schemas/tracking-modifiers.schema.json",
    "title": "Tracking Modifiers Configuration",
    "description": "Configuration schema for tracking condition modifiers",
    "type": "object",
    "required": ["conditionModifiers", "timeModifiers", "terrainCheckIntervals", "recoveryProcedures", "closingInModifiers"],
    "properties": {
        "conditionModifiers": {
            "type": "array",
            "description": "Environmental and target condition modifiers",
            "items": {
                "type": "object",
                "required": ["id", "displayName", "dcModifier", "description"],
                "properties": {
                    "id": {
                        "type": "string"
                    },
                    "displayName": {
                        "type": "string"
                    },
                    "dcModifier": {
                        "type": "integer",
                        "minimum": -10,
                        "maximum": 10
                    },
                    "description": {
                        "type": "string"
                    }
                }
            }
        },
        "timeModifiers": {
            "type": "object",
            "required": ["perHourDcIncrease"],
            "properties": {
                "perHourDcIncrease": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 5
                },
                "description": {
                    "type": "string"
                }
            }
        },
        "terrainCheckIntervals": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["terrain", "intervalMiles"],
                "properties": {
                    "terrain": {
                        "type": "string"
                    },
                    "intervalMiles": {
                        "type": "number",
                        "minimum": 0.1
                    },
                    "description": {
                        "type": "string"
                    }
                }
            }
        },
        "recoveryProcedures": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["type", "dcModifier", "timeCostMinutes"],
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": ["Backtrack", "SpiralSearch", "ReturnToLastKnown"]
                    },
                    "dcModifier": {
                        "type": "integer"
                    },
                    "timeCostMinutes": {
                        "type": "integer",
                        "minimum": 1
                    },
                    "description": {
                        "type": "string"
                    }
                }
            }
        },
        "closingInModifiers": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["distanceFeet"],
                "properties": {
                    "distanceFeet": {
                        "type": "integer",
                        "minimum": 0
                    },
                    "dcModifier": {
                        "type": ["integer", "null"]
                    },
                    "note": {
                        "type": "string"
                    }
                }
            }
        }
    }
}
```

### 12.5 Configuration Schema Summary

| Config File | Schema File | Purpose |
|-------------|-------------|---------|
| `trail-ages.json` | `trail-ages.schema.json` | Trail age classifications and DCs |
| `tracking-modifiers.json` | `tracking-modifiers.schema.json` | Condition modifiers, terrain intervals, recovery procedures |

---

## 13. Logging Specifications

### 13.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `TrackingService` | Information | Tracking initiated, trail acquired, target found |
| `TrackingService` | Information | Trail went cold, tracking abandoned |
| `TrackingService` | Warning | Cold trail attempted without Master rank |
| `TrackingService` | Warning | Trail went cold after max failures |
| `TrackingService` | Debug | Check performed, phase transition |
| `TrackingService` | Debug | Modifier calculation, DC computation |

### 13.2 Log Message Formats

```
[Information] Player {PlayerId} initiating tracking for '{Target}' (TrailAge: {Age})
[Information] Tracking {TrackingId} acquired trail successfully
[Information] Tracking {TrackingId} target found at distance {Distance}
[Warning] Player {PlayerId} attempted cold trail without Master rank
[Warning] Tracking {TrackingId} trail went cold after 3 failures
[Debug] Tracking acquisition failed, attempt {Attempt}/{Max}
[Debug] Phase transition: {FromPhase} -> {ToPhase}
```

---

## 14. Unit Testing Requirements

### 14.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Trail age DC assignment | 1 |
| Modifiers accumulate correctly | 1 |
| Phase transitions work properly | 1 |
| Recovery procedures apply correct DC | 1 |
| **Total** | **~4** |

### 14.2 Test Specifications

**File:** `tests/RuneAndRust.Application.UnitTests/Services/TrackingServiceTests.cs`

```csharp
[TestFixture]
public class TrackingServiceTests
{
    private Mock<ISkillCheckService> _mockSkillCheckService = null!;
    private Mock<ITrackingStateRepository> _mockStateRepository = null!;
    private Mock<IGameConfigurationProvider> _mockConfigProvider = null!;
    private Mock<ILogger<TrackingService>> _mockLogger = null!;
    private TrackingService _service = null!;

    [SetUp]
    public void SetUp()
    {
        _mockSkillCheckService = new Mock<ISkillCheckService>();
        _mockStateRepository = new Mock<ITrackingStateRepository>();
        _mockConfigProvider = new Mock<IGameConfigurationProvider>();
        _mockLogger = new Mock<ILogger<TrackingService>>();

        _service = new TrackingService(
            _mockSkillCheckService.Object,
            _mockStateRepository.Object,
            _mockConfigProvider.Object,
            _mockLogger.Object);
    }

    [Test]
    [TestCase(TrailAge.Obvious, 8)]
    [TestCase(TrailAge.Fresh, 12)]
    [TestCase(TrailAge.Standard, 16)]
    [TestCase(TrailAge.Old, 20)]
    [TestCase(TrailAge.Obscured, 24)]
    [TestCase(TrailAge.Cold, 28)]
    public void TrailAge_SetsCorrectBaseDc(TrailAge age, int expectedDc)
    {
        // Arrange
        var state = TrackingState.Create("player-1", "goblin", age);

        // Assert
        Assert.That(state.BaseDc, Is.EqualTo(expectedDc));
    }

    [Test]
    public void TrackingModifiers_AccumulateCorrectly()
    {
        // Arrange
        var modifiers = new TrackingModifiers(
            hasBloodTrail: true,       // -4
            hasRecentRain: true,       // +4
            targetCount: 3,            // -2
            targetIsHiding: true,      // +2
            hoursElapsed: 2);          // +2

        // Act
        var totalDcModifier = modifiers.TotalDcModifier;

        // Assert
        // -4 + 4 - 2 + 2 + 2 = 2
        Assert.That(totalDcModifier, Is.EqualTo(2));
    }

    [Test]
    public void PhaseTransitions_WorkProperly()
    {
        // Arrange
        var state = TrackingState.Create("player-1", "goblin", TrailAge.Fresh);

        // Act & Assert - Acquisition -> Pursuit
        Assert.That(state.CurrentPhase, Is.EqualTo(TrackingPhase.Acquisition));
        state.TransitionToPursuit();
        Assert.That(state.CurrentPhase, Is.EqualTo(TrackingPhase.Pursuit));

        // Pursuit -> ClosingIn
        state.TransitionToClosingIn(300);
        Assert.That(state.CurrentPhase, Is.EqualTo(TrackingPhase.ClosingIn));
        Assert.That(state.EstimatedDistanceToTarget, Is.EqualTo(300));
    }

    [Test]
    [TestCase(RecoveryType.Backtrack, 0)]
    [TestCase(RecoveryType.SpiralSearch, 4)]
    [TestCase(RecoveryType.ReturnToLastKnown, 8)]
    public void RecoveryProcedures_ApplyCorrectDcModifier(RecoveryType type, int expectedModifier)
    {
        // Arrange
        var player = CreateTestPlayer();
        var state = TrackingState.Create("player-1", "goblin", TrailAge.Fresh);
        state.TransitionToPursuit();
        state.TransitionToLost();

        _mockStateRepository.Setup(r => r.GetById(It.IsAny<string>())).Returns(state);
        SetupSuccessfulCheck();

        // Act
        var result = _service.AttemptRecovery(
            player,
            state.TrackingId,
            type,
            new TrackingModifiers());

        // Assert
        _mockSkillCheckService.Verify(
            s => s.PerformCheckWithDC(
                It.IsAny<Player>(),
                "wasteland-survival",
                state.BaseDc + expectedModifier, // Base DC + recovery modifier
                It.IsAny<string>(),
                It.IsAny<SkillContext>()),
            Times.Once);
    }

    private Player CreateTestPlayer()
    {
        return Player.Create("Test Player", /* attributes */);
    }

    private void SetupSuccessfulCheck()
    {
        _mockSkillCheckService
            .Setup(s => s.PerformCheckWithDC(
                It.IsAny<Player>(),
                It.IsAny<string>(),
                It.IsAny<int>(),
                It.IsAny<string>(),
                It.IsAny<SkillContext>()))
            .Returns(CreateCheckResult(SkillOutcome.FullSuccess));
    }

    private SkillCheckResult CreateCheckResult(SkillOutcome outcome)
    {
        return new SkillCheckResult(/* ... */);
    }
}
```

---

## 15. Use Cases

### 15.1 UC-1505a-001: Initiate Tracking

**Actor:** Player
**Flow:** Player issues track command → System determines trail age → Acquisition check → Trail found or lost

**Details:**
1. Player issues `track goblin patrol` command
2. System determines trail age from world state (e.g., Fresh)
3. System calculates modifiers (blood trail, rain, etc.)
4. `TrackingService.InitiateTracking()` called
5. Wasteland Survival check performed against effective DC
6. On success: TrackingState created in Pursuit phase
7. On failure: May retry at DC +2 (up to 3 attempts)

### 15.2 UC-1505a-002: Continue Pursuit

**Actor:** Player
**Flow:** Player continues tracking → Pursuit check at terrain interval → Trail maintained or lost

**Details:**
1. Player in active pursuit traverses terrain
2. At terrain-appropriate interval (e.g., 2 miles for open wasteland)
3. `TrackingService.ContinuePursuit()` called
4. Check performed with current modifiers
5. On success: Distance updated, continue pursuit
6. On failure: Transition to Lost phase

### 15.3 UC-1505a-003: Recover Lost Trail

**Actor:** Player
**Flow:** Player selects recovery method → Recovery check → Trail recovered or permanently lost

**Details:**
1. Player in Lost phase selects recovery type
2. System applies recovery DC modifier (+0/+4/+8)
3. `TrackingService.AttemptRecovery()` called
4. Check performed against modified DC
5. On success: Return to Pursuit phase
6. On failure: Increment failure count, 3 failures = Cold

### 15.4 UC-1505a-004: Trail Goes Cold

**Actor:** System
**Flow:** Third failed attempt → Trail marked Cold → Tracking ends

**Details:**
1. Player fails 3rd acquisition or recovery attempt
2. TrackingState transitions to Cold phase
3. Status set to TrailCold
4. Player notified trail is unrecoverable
5. Must find new lead to resume tracking

---

## 16. Deliverable Checklist

### 16.1 Domain Layer

- [ ] `TrailAge.cs` enum created in `Enums/`
- [ ] `TrackingPhase.cs` enum created in `Enums/`
- [ ] `TrackingStatus.cs` enum created in `Enums/`
- [ ] `TrackingModifiers.cs` value object created in `ValueObjects/`
- [ ] `TrackingCheck.cs` value object created in `ValueObjects/`
- [ ] `TrackingResult.cs` value object created in `ValueObjects/`
- [ ] `TrackingState.cs` entity created in `Entities/`
- [ ] `ITrackingService.cs` interface created in `Interfaces/`
- [ ] `ITrackingStateRepository.cs` interface created in `Interfaces/`

### 16.2 Application Layer

- [ ] `TrackingService.cs` created in `Services/`
- [ ] Service registered in dependency injection

### 16.3 Configuration

- [ ] `config/trail-ages.json` created
- [ ] `config/tracking-modifiers.json` created
- [ ] `config/schemas/trail-ages.schema.json` created
- [ ] `config/schemas/tracking-modifiers.schema.json` created
- [ ] Configuration files validate against schemas

### 16.4 Testing

- [ ] `TrackingServiceTests.cs` created (~4 tests)
- [ ] All tests passing

### 16.5 Documentation

- [ ] XML documentation complete on all public members
- [ ] This design specification complete

---

## 17. Acceptance Criteria

### 17.1 Functional

- [ ] Trail age enum values correspond to correct base DCs
- [ ] Condition modifiers accumulate correctly (blood trail -4, rain +4, etc.)
- [ ] Time elapsed adds +1 DC per hour
- [ ] Acquisition phase allows 3 failure attempts before Cold
- [ ] Pursuit phase checks occur at terrain-appropriate intervals
- [ ] Lost phase offers 3 recovery options with correct DC modifiers
- [ ] Cold trails require Master rank (Rank 5)
- [ ] Phase transitions follow state machine rules
- [ ] TrackingState correctly tracks check history
- [ ] TrackingModifiers correctly converts to SkillContext

### 17.2 Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~4 new unit tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete on all public members

---

## 18. Dependencies

### 18.1 Required from Previous Versions

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.0 | `DiceRollResult` | Success/botch counting |
| v0.15.0 | `DiceService` | Dice rolling |
| v0.15.0c | `SkillCheckService` | Check execution |
| v0.15.0c | `SkillOutcome` | Outcome classification |
| v0.15.1a | `SkillContext` | Modifier aggregation |
| v0.15.1a | `EnvironmentModifier` | Terrain/weather effects |
| v0.15.4d | `TerrainType` | Navigation terrain enum |

### 18.2 Provides to Future Versions

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.5b | Counter-Tracking | Contested concealment checks |
| v0.15.5h | Specialization | Veiðimaðr creature tracking bonuses |
| v0.15.5i | Exploration Synergies | Combined skill check patterns |

---

## 19. Future Considerations

### 19.1 Deferred to v0.15.5b (Counter-Tracking System)

- Concealment technique enum and bonuses
- Contested tracker vs concealer checks
- Time multiplier for concealment techniques

### 19.2 Deferred to v0.15.5c (Foraging System)

- Search duration and yield tables
- Biome-specific loot tables
- Hidden cache discovery on rolled 10s

### 19.3 Deferred to v0.15.5h (Specialization Integration)

- Veiðimaðr [Beast Tracker] ability (+2d10 for creatures)
- Veiðimaðr [Predator's Eye] ability (identify weaknesses)
- Myr-Stalker terrain bonuses

### 19.4 Out of Scope

- Actual target entity integration (world state)
- Combat encounter initiation
- Map/location system integration
- Visual trail rendering

---

## 20. Document Metadata

---

*Document Version: 1.0*
*Last Updated: 2026-01-18*
*Author: Claude*

---

### Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-18 | Claude | Initial design specification |

---

*This design specification provides the detailed blueprint for implementing v0.15.5a Extended Tracking System. This establishes the foundational patterns for all Wasteland Survival subsystems in v0.15.5.*
