# v0.16.0a Design Specification: Quality Tier Enum

**Version:** 0.16.0a  
**Phase Name:** Quality Tier Enum  
**Parent Version:** v0.16.0 (Quality Tier System)  
**Prerequisites:** v0.15.x Complete (Advanced Skill Systems)  
**Estimated Tests:** ~4 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [QualityTier Enum](#4-qualitytier-enum)
5. [TierMetadata Value Object](#5-tiermetadata-value-object)
6. [TierColorDefinition Value Object](#6-tiercolordefinition-value-object)
7. [ITierMetadataProvider Interface](#7-itiermetadataprovider-interface)
8. [Data Model Changes](#8-data-model-changes)
9. [Configuration File Schemas](#9-configuration-file-schemas)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the Quality Tier enumeration and metadata system that forms the foundation of the v0.16.x loot and proficiency systems. Every piece of equipment in the game (weapons, armor, accessories) will be assigned a quality tier that determines its base stats, visual presentation, and rarity.

The five-tier system follows Norse-inspired naming conventions:

- **Tier 0: Jury-Rigged** — Makeshift, improvised equipment
- **Tier 1: Scavenged** — Common finds, functional but unremarkable
- **Tier 2: Clan-Forged** — Quality craftsmanship from regional smiths
- **Tier 3: Optimized** — Exceptional gear optimized for combat
- **Tier 4: Myth-Forged** — Legendary items of mythic origin

This phase establishes the enum, tier metadata structure, and color constants that all subsequent v0.16.x phases depend upon.

### 1.2 Key Deliverables

| Category          | Items                                             |
| ----------------- | ------------------------------------------------- |
| **Enums**         | `QualityTier`                                     |
| **Value Objects** | `TierMetadata`, `TierColorDefinition`             |
| **Interfaces**    | `ITierMetadataProvider`                           |
| **Configuration** | `quality-tiers.json`, `quality-tiers.schema.json` |
| **Tests**         | ~4 unit tests                                     |

### 1.3 Architectural Significance

This version establishes the **Quality Tier Pattern** that will be used throughout the loot system:

- **Enum-Based Tier Identification**: All equipment references a `QualityTier` value
- **Metadata-Driven Presentation**: Display names, colors, and icons come from configuration
- **Configurable Color System**: Tier colors are defined externally for UI flexibility
- **Provider Pattern**: `ITierMetadataProvider` centralizes tier data access
- **Future-Proof Design**: The structure supports adding new tiers without code changes

---

## 2. Feature Overview

```
v0.16.0a Quality Tier Enum
├── QualityTier Enum
│   ├── JuryRigged (0) — Makeshift equipment
│   ├── Scavenged (1) — Common equipment
│   ├── ClanForged (2) — Quality craftsmanship
│   ├── Optimized (3) — Exceptional gear
│   └── MythForged (4) — Legendary items
├── TierMetadata Value Object
│   ├── Tier: QualityTier
│   ├── DisplayName: string
│   ├── DisplayNamePlural: string
│   ├── Description: string
│   ├── ColorDefinition: TierColorDefinition
│   ├── IconGlyph: char
│   └── DropWeightMultiplier: decimal
├── TierColorDefinition Value Object
│   ├── HexColor: string
│   ├── ConsoleColor: ConsoleColor
│   ├── RgbRed: byte
│   ├── RgbGreen: byte
│   └── RgbBlue: byte
└── ITierMetadataProvider Interface
    ├── GetMetadata(tier): TierMetadata
    ├── GetAllMetadata(): IReadOnlyList<TierMetadata>
    ├── GetTierColor(tier): TierColorDefinition
    └── GetTierDisplayName(tier): string
```

### 2.1 Scope Alignment

**In Scope:**

- `QualityTier` enum with five tier values (0-4)
- `TierMetadata` value object with display properties
- `TierColorDefinition` value object for color specifications
- `ITierMetadataProvider` interface for tier data access
- `quality-tiers.json` configuration file
- `quality-tiers.schema.json` validation schema
- Norse-inspired tier naming conventions
- Color constants for TUI and GUI rendering

**Out of Scope:**

- Stat scaling formulas (v0.16.0b)
- Drop probability tables (v0.16.0c)
- Loot service integration (v0.16.0d)
- Weapon proficiency system (v0.16.1)
- Armor proficiency system (v0.16.2)
- Smart loot generation (v0.16.3)

---

## 3. Architecture Diagrams

### 3.1 Quality Tier System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                    QUALITY TIER SYSTEM OVERVIEW                      │
└─────────────────────────────────────────────────────────────────────┘

    Equipment Item
           │
           │  Has QualityTier property
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         QualityTier Enum                             │
├─────────────────────────────────────────────────────────────────────┤
│  JuryRigged (0)  │  Scavenged (1)  │  ClanForged (2)                │
│  Optimized (3)   │  MythForged (4) │                                 │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Get metadata for display
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      ITierMetadataProvider                           │
├─────────────────────────────────────────────────────────────────────┤
│  + GetMetadata(tier): TierMetadata                                  │
│  + GetAllMetadata(): IReadOnlyList<TierMetadata>                    │
│  + GetTierColor(tier): TierColorDefinition                          │
│  + GetTierDisplayName(tier): string                                 │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Returns tier presentation data
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         TierMetadata                                 │
├─────────────────────────────────────────────────────────────────────┤
│  - Tier: QualityTier                                                │
│  - DisplayName: string        (e.g., "Clan-Forged")                 │
│  - DisplayNamePlural: string  (e.g., "Clan-Forged items")           │
│  - Description: string        (flavor text)                          │
│  - ColorDefinition: TierColorDefinition                              │
│  - IconGlyph: char            (terminal icon)                        │
│  - DropWeightMultiplier: decimal                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  IGameRenderer                                                       │
│  └── Uses TierColorDefinition for item name coloring                │
│                                                                      │
│  InventoryView, LootView                                             │
│  └── Uses TierMetadata.IconGlyph for tier indicators                │
│                                                                      │
│  ItemDetailsPanel                                                    │
│  └── Uses TierMetadata.Description for flavor text                  │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │               TierMetadataProvider                             │  │
│  │                 (implements ITierMetadataProvider)             │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  + GetMetadata(QualityTier): TierMetadata                     │  │
│  │  + GetAllMetadata(): IReadOnlyList<TierMetadata>              │  │
│  │  + GetTierColor(QualityTier): TierColorDefinition             │  │
│  │  + GetTierDisplayName(QualityTier): string                    │  │
│  │                                                               │  │
│  │  - LoadConfiguration(): void (from JSON)                      │  │
│  │  - ValidateTiers(): void (ensure all tiers present)           │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  LootService (v0.16.0d)                                              │
│  └── Uses QualityTier for generated items                           │
│                                                                      │
│  TierScalingService (v0.16.0b)                                       │
│  └── Uses QualityTier for stat calculations                         │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌────────────────────────────────────┐   │
│  │    QualityTier      │  │          TierMetadata              │   │
│  │       (Enum)        │  │        (Value Object)              │   │
│  ├─────────────────────┤  ├────────────────────────────────────┤   │
│  │ JuryRigged = 0      │  │ Tier: QualityTier                  │   │
│  │ Scavenged = 1       │  │ DisplayName: string                │   │
│  │ ClanForged = 2      │  │ DisplayNamePlural: string          │   │
│  │ Optimized = 3       │  │ Description: string                │   │
│  │ MythForged = 4      │  │ ColorDefinition: TierColorDef      │   │
│  └─────────────────────┘  │ IconGlyph: char                    │   │
│                           │ DropWeightMultiplier: decimal      │   │
│  ┌─────────────────────┐  └────────────────────────────────────┘   │
│  │ TierColorDefinition │                                           │
│  │   (Value Object)    │                                           │
│  ├─────────────────────┤                                           │
│  │ HexColor: string    │                                           │
│  │ ConsoleColor: enum  │                                           │
│  │ RgbRed: byte        │                                           │
│  │ RgbGreen: byte      │                                           │
│  │ RgbBlue: byte       │                                           │
│  └─────────────────────┘                                           │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.3 Tier Metadata Lookup Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    TIER METADATA LOOKUP FLOW                         │
└─────────────────────────────────────────────────────────────────────┘

    Equipment.QualityTier
           │
           │  e.g., QualityTier.ClanForged
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    ITierMetadataProvider                             │
├─────────────────────────────────────────────────────────────────────┤
│  GetMetadata(QualityTier.ClanForged)                                │
│                                                                      │
│  1. Look up tier in internal dictionary                             │
│  2. Dictionary keyed by QualityTier enum value                      │
│  3. Return TierMetadata or throw if not found                       │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Returns TierMetadata
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         TierMetadata                                 │
├─────────────────────────────────────────────────────────────────────┤
│  Tier: ClanForged                                                   │
│  DisplayName: "Clan-Forged"                                         │
│  DisplayNamePlural: "Clan-Forged items"                             │
│  Description: "Quality craftsmanship from regional smiths..."       │
│  ColorDefinition: { Hex: "#00FF00", Console: Green, RGB: 0,255,0 }  │
│  IconGlyph: '◆'                                                     │
│  DropWeightMultiplier: 0.25                                         │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Used for display
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      RENDERING EXAMPLES                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Inventory (TUI):                                                    │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  ◆ [Clan-Forged] Iron Longsword                              │   │
│  │    └── Rendered in green (#00FF00)                           │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                                                                      │
│  Loot Drop Notification:                                             │
│  ┌──────────────────────────────────────────────────────────────┐   │
│  │  You found: Clan-Forged Iron Longsword                       │   │
│  │             ^^^^^^^^^^^^^^^^                                  │   │
│  │             Green colored text                                │   │
│  └──────────────────────────────────────────────────────────────┘   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.4 Configuration Loading Sequence

```
┌─────────────────────────────────────────────────────────────────────┐
│                  CONFIGURATION LOADING SEQUENCE                      │
└─────────────────────────────────────────────────────────────────────┘

    Application         TierMetadataProvider        Config System
       Startup               (Service)                  │
         │                      │                       │
         │  Register services   │                       │
         ├─────────────────────▶│                       │
         │                      │                       │
         │                      │  Load quality-tiers.json
         │                      ├──────────────────────▶│
         │                      │                       │
         │                      │  ◀── JSON content     │
         │                      │                       │
         │                      │  Validate against     │
         │                      │  quality-tiers.schema.json
         │                      │                       │
         │                      │  Parse to TierMetadata[]
         │                      │                       │
         │                      │  Build lookup dictionary
         │                      │  (keyed by QualityTier)
         │                      │                       │
         │                      │  Validate:            │
         │                      │  - All 5 tiers present
         │                      │  - No duplicate tiers │
         │                      │  - Valid color formats
         │                      │                       │
         │  ◀─────── Ready      │                       │
         │                      │                       │
         │  GetMetadata(tier)   │                       │
         ├─────────────────────▶│                       │
         │                      │                       │
         │  ◀── TierMetadata    │                       │
         ▼                      ▼                       ▼
```

---

## 4. QualityTier Enum

### 4.1 Purpose

The `QualityTier` enum defines the five quality levels for all equipment in the game. This enum is the foundation for stat scaling, drop rates, and visual presentation throughout the loot system.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/QualityTier.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the quality tier of equipment items.
/// </summary>
/// <remarks>
/// <para>
/// Quality tiers determine the base stat ranges, drop rarity, and visual
/// presentation of equipment. Higher tiers have better stats but are rarer.
/// </para>
/// <para>
/// The five tiers follow Norse-inspired naming conventions:
/// - Jury-Rigged: Makeshift equipment cobbled together from scraps
/// - Scavenged: Common finds, functional but unremarkable
/// - Clan-Forged: Quality craftsmanship from regional smiths
/// - Optimized: Exceptional gear fine-tuned for combat
/// - Myth-Forged: Legendary items of mythic origin
/// </para>
/// <para>
/// Tier values are explicitly assigned (0-4) to ensure stable serialization
/// and database storage. New tiers should be added at the end if needed.
/// </para>
/// </remarks>
public enum QualityTier
{
    /// <summary>
    /// Tier 0: Makeshift equipment cobbled together from available materials.
    /// </summary>
    /// <remarks>
    /// Jury-rigged items have the lowest stats and no special properties.
    /// They are common in early game and serve as placeholders until
    /// better equipment is found.
    /// </remarks>
    JuryRigged = 0,

    /// <summary>
    /// Tier 1: Common equipment scavenged from the environment.
    /// </summary>
    /// <remarks>
    /// Scavenged items are functional but unremarkable. They represent
    /// standard equipment found on defeated enemies or in basic containers.
    /// </remarks>
    Scavenged = 1,

    /// <summary>
    /// Tier 2: Quality craftsmanship from regional clan smiths.
    /// </summary>
    /// <remarks>
    /// Clan-forged items show skilled craftsmanship and often bear clan
    /// markings. They have noticeably better stats than scavenged gear.
    /// </remarks>
    ClanForged = 2,

    /// <summary>
    /// Tier 3: Exceptional gear optimized for combat effectiveness.
    /// </summary>
    /// <remarks>
    /// Optimized items have been refined for maximum performance. They
    /// represent the best non-legendary equipment available and may have
    /// minor special properties.
    /// </remarks>
    Optimized = 3,

    /// <summary>
    /// Tier 4: Legendary items of mythic origin with unique properties.
    /// </summary>
    /// <remarks>
    /// Myth-forged items are unique artifacts with special effects that
    /// can define a playstyle. Only one of each myth-forged item can
    /// drop per run to maintain their legendary status.
    /// </remarks>
    MythForged = 4
}
```

### 4.3 Design Decisions

#### 4.3.1 Explicit Enum Values

**Decision:** Explicitly assign integer values (0-4) to enum members.

**Rationale:**

- Ensures stable serialization to JSON and database storage
- Prevents accidental value changes if enum order is modified
- Allows tier comparison using integer operators (`tier > QualityTier.Scavenged`)
- Matches existing game patterns for enums

#### 4.3.2 Five-Tier System

**Decision:** Use exactly five quality tiers.

**Rationale:**

- Matches the design specification in v0.16.x-overview.md
- Provides meaningful progression without tier bloat
- Aligns with industry-standard loot systems (common/uncommon/rare/epic/legendary)
- Norse naming adds thematic depth unique to Aethelgard

#### 4.3.3 Naming Conventions

**Decision:** Use PascalCase names based on Norse-inspired thematic terms.

**Rationale:**

- `JuryRigged`: Suggests improvised, desperate construction
- `Scavenged`: Implies found rather than crafted
- `ClanForged`: References the clan-based society of Aethelgard
- `Optimized`: Technical term fitting the Dvergr influence
- `MythForged`: Evokes legendary, mythological origins

### 4.4 Tier Reference Table

| Enum Value   | Integer | Display Name | Description           |
| ------------ | ------- | ------------ | --------------------- |
| `JuryRigged` | 0       | Jury-Rigged  | Makeshift equipment   |
| `Scavenged`  | 1       | Scavenged    | Common equipment      |
| `ClanForged` | 2       | Clan-Forged  | Quality craftsmanship |
| `Optimized`  | 3       | Optimized    | Exceptional gear      |
| `MythForged` | 4       | Myth-Forged  | Legendary items       |

---

## 5. TierMetadata Value Object

### 5.1 Purpose

The `TierMetadata` value object encapsulates all presentation and configuration data for a quality tier. This separates the enum definition from its display properties, allowing localization and customization without code changes.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TierMetadata.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Contains metadata for a quality tier including display properties and configuration.
/// </summary>
/// <remarks>
/// <para>
/// TierMetadata is loaded from configuration (quality-tiers.json) rather than
/// hardcoded, allowing customization of tier names, colors, and descriptions
/// without code changes.
/// </para>
/// <para>
/// This value object is immutable after creation. Use the factory method
/// <see cref="Create"/> to construct new instances.
/// </para>
/// </remarks>
/// <param name="Tier">The quality tier this metadata describes.</param>
/// <param name="DisplayName">The singular display name (e.g., "Clan-Forged").</param>
/// <param name="DisplayNamePlural">The plural display name (e.g., "Clan-Forged items").</param>
/// <param name="Description">Flavor text describing items of this tier.</param>
/// <param name="ColorDefinition">Color specification for UI rendering.</param>
/// <param name="IconGlyph">Single character icon for terminal display.</param>
/// <param name="DropWeightMultiplier">Relative drop rate multiplier (1.0 = baseline).</param>
public readonly record struct TierMetadata(
    QualityTier Tier,
    string DisplayName,
    string DisplayNamePlural,
    string Description,
    TierColorDefinition ColorDefinition,
    char IconGlyph,
    decimal DropWeightMultiplier)
{
    /// <summary>
    /// Gets the tier as an integer value.
    /// </summary>
    public int TierValue => (int)Tier;

    /// <summary>
    /// Gets whether this is the lowest tier (Jury-Rigged).
    /// </summary>
    public bool IsLowestTier => Tier == QualityTier.JuryRigged;

    /// <summary>
    /// Gets whether this is the highest tier (Myth-Forged).
    /// </summary>
    public bool IsHighestTier => Tier == QualityTier.MythForged;

    /// <summary>
    /// Gets whether this is a legendary tier (Myth-Forged).
    /// </summary>
    /// <remarks>
    /// Legendary items have special rules: unique per run, special effects, etc.
    /// </remarks>
    public bool IsLegendary => Tier == QualityTier.MythForged;

    /// <summary>
    /// Creates a new TierMetadata instance with validation.
    /// </summary>
    /// <param name="tier">The quality tier.</param>
    /// <param name="displayName">The singular display name.</param>
    /// <param name="displayNamePlural">The plural display name.</param>
    /// <param name="description">Flavor text description.</param>
    /// <param name="colorDefinition">Color specification.</param>
    /// <param name="iconGlyph">Terminal icon character.</param>
    /// <param name="dropWeightMultiplier">Drop rate multiplier.</param>
    /// <returns>A new TierMetadata instance.</returns>
    /// <exception cref="ArgumentException">Thrown when string parameters are null or empty.</exception>
    /// <exception cref="ArgumentOutOfRangeException">Thrown when dropWeightMultiplier is negative.</exception>
    public static TierMetadata Create(
        QualityTier tier,
        string displayName,
        string displayNamePlural,
        string description,
        TierColorDefinition colorDefinition,
        char iconGlyph,
        decimal dropWeightMultiplier)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
        ArgumentException.ThrowIfNullOrWhiteSpace(displayNamePlural);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);
        ArgumentOutOfRangeException.ThrowIfNegative(dropWeightMultiplier);

        return new TierMetadata(
            tier,
            displayName,
            displayNamePlural,
            description,
            colorDefinition,
            iconGlyph,
            dropWeightMultiplier);
    }

    /// <summary>
    /// Formats an item name with the tier prefix for display.
    /// </summary>
    /// <param name="itemName">The base item name.</param>
    /// <returns>The formatted name with tier prefix (e.g., "[Clan-Forged] Iron Sword").</returns>
    public string FormatItemName(string itemName)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(itemName);
        return $"[{DisplayName}] {itemName}";
    }

    /// <summary>
    /// Creates a display string for debug/logging purposes.
    /// </summary>
    /// <returns>A formatted string representation.</returns>
    public override string ToString() =>
        $"{DisplayName} (Tier {TierValue}, Weight: {DropWeightMultiplier:F2})";
}
```

### 5.3 Default Values Reference

| Tier       | Display Name | Icon | Drop Weight | Color            |
| ---------- | ------------ | ---- | ----------- | ---------------- |
| JuryRigged | Jury-Rigged  | ○    | 1.00        | Gray (#808080)   |
| Scavenged  | Scavenged    | ●    | 0.50        | White (#FFFFFF)  |
| ClanForged | Clan-Forged  | ◆    | 0.25        | Green (#00FF00)  |
| Optimized  | Optimized    | ★    | 0.10        | Purple (#800080) |
| MythForged | Myth-Forged  | ✦    | 0.02        | Gold (#FFD700)   |

---

## 6. TierColorDefinition Value Object

### 6.1 Purpose

The `TierColorDefinition` value object encapsulates color information for a quality tier across different rendering contexts (TUI console, GUI, hex for web).

### 6.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/TierColorDefinition.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines color representation for a quality tier across different rendering contexts.
/// </summary>
/// <remarks>
/// <para>
/// This value object provides color data in multiple formats:
/// - HexColor: For GUI and web rendering ("#RRGGBB" format)
/// - ConsoleColor: For TUI terminal rendering (System.ConsoleColor)
/// - RGB: Individual byte values for custom color mixing
/// </para>
/// <para>
/// Colors are loaded from configuration to allow theme customization.
/// </para>
/// </remarks>
/// <param name="HexColor">Hex color code in "#RRGGBB" format.</param>
/// <param name="ConsoleColor">Closest matching System.ConsoleColor for terminal display.</param>
/// <param name="RgbRed">Red component (0-255).</param>
/// <param name="RgbGreen">Green component (0-255).</param>
/// <param name="RgbBlue">Blue component (0-255).</param>
public readonly record struct TierColorDefinition(
    string HexColor,
    ConsoleColor ConsoleColor,
    byte RgbRed,
    byte RgbGreen,
    byte RgbBlue)
{
    /// <summary>
    /// Gets the color as a tuple for easy destructuring.
    /// </summary>
    public (byte R, byte G, byte B) RgbTuple => (RgbRed, RgbGreen, RgbBlue);

    /// <summary>
    /// Gets the hex color without the leading '#'.
    /// </summary>
    public string HexColorRaw => HexColor.TrimStart('#');

    /// <summary>
    /// Creates a TierColorDefinition from a hex color string.
    /// </summary>
    /// <param name="hexColor">Hex color in "#RRGGBB" format.</param>
    /// <param name="consoleColor">Closest matching ConsoleColor.</param>
    /// <returns>A new TierColorDefinition instance.</returns>
    /// <exception cref="ArgumentException">Thrown when hexColor is invalid.</exception>
    public static TierColorDefinition FromHex(string hexColor, ConsoleColor consoleColor)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(hexColor);

        var hex = hexColor.TrimStart('#');
        if (hex.Length != 6)
        {
            throw new ArgumentException(
                $"Invalid hex color format: '{hexColor}'. Expected '#RRGGBB' format.",
                nameof(hexColor));
        }

        var red = Convert.ToByte(hex[..2], 16);
        var green = Convert.ToByte(hex[2..4], 16);
        var blue = Convert.ToByte(hex[4..6], 16);

        return new TierColorDefinition(
            hexColor.StartsWith('#') ? hexColor : $"#{hexColor}",
            consoleColor,
            red,
            green,
            blue);
    }

    /// <summary>
    /// Creates a TierColorDefinition from RGB components.
    /// </summary>
    /// <param name="red">Red component (0-255).</param>
    /// <param name="green">Green component (0-255).</param>
    /// <param name="blue">Blue component (0-255).</param>
    /// <param name="consoleColor">Closest matching ConsoleColor.</param>
    /// <returns>A new TierColorDefinition instance.</returns>
    public static TierColorDefinition FromRgb(byte red, byte green, byte blue, ConsoleColor consoleColor)
    {
        var hexColor = $"#{red:X2}{green:X2}{blue:X2}";
        return new TierColorDefinition(hexColor, consoleColor, red, green, blue);
    }

    // Standard tier color definitions

    /// <summary>
    /// Gray color for Jury-Rigged tier.
    /// </summary>
    public static TierColorDefinition JuryRiggedDefault =>
        FromHex("#808080", ConsoleColor.Gray);

    /// <summary>
    /// White color for Scavenged tier.
    /// </summary>
    public static TierColorDefinition ScavengedDefault =>
        FromHex("#FFFFFF", ConsoleColor.White);

    /// <summary>
    /// Green color for Clan-Forged tier.
    /// </summary>
    public static TierColorDefinition ClanForgedDefault =>
        FromHex("#00FF00", ConsoleColor.Green);

    /// <summary>
    /// Purple color for Optimized tier.
    /// </summary>
    public static TierColorDefinition OptimizedDefault =>
        FromHex("#800080", ConsoleColor.Magenta);

    /// <summary>
    /// Gold color for Myth-Forged tier.
    /// </summary>
    public static TierColorDefinition MythForgedDefault =>
        FromHex("#FFD700", ConsoleColor.Yellow);

    /// <summary>
    /// Creates a display string for debug/logging purposes.
    /// </summary>
    public override string ToString() => $"{HexColor} ({ConsoleColor})";
}
```

### 6.3 Color Reference Table

| Tier       | Hex Code | Console Color | RGB Values    | Notes                 |
| ---------- | -------- | ------------- | ------------- | --------------------- |
| JuryRigged | #808080  | Gray          | 128, 128, 128 | Neutral, unremarkable |
| Scavenged  | #FFFFFF  | White         | 255, 255, 255 | Clean, standard       |
| ClanForged | #00FF00  | Green         | 0, 255, 0     | Uncommon indicator    |
| Optimized  | #800080  | Magenta       | 128, 0, 128   | Rare indicator        |
| MythForged | #FFD700  | Yellow        | 255, 215, 0   | Legendary gold        |

---

## 7. ITierMetadataProvider Interface

### 7.1 Purpose

The `ITierMetadataProvider` interface defines the contract for accessing quality tier metadata. This abstraction allows the metadata source to be configured (JSON, database, in-memory) without affecting consuming code.

### 7.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Interfaces/ITierMetadataProvider.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Provides access to quality tier metadata for equipment items.
/// </summary>
/// <remarks>
/// <para>
/// This interface abstracts the source of tier metadata, allowing it to be
/// loaded from configuration files, databases, or hardcoded defaults.
/// </para>
/// <para>
/// Implementations should cache loaded metadata for performance and validate
/// that all quality tiers have corresponding metadata entries.
/// </para>
/// </remarks>
public interface ITierMetadataProvider
{
    /// <summary>
    /// Gets the metadata for a specific quality tier.
    /// </summary>
    /// <param name="tier">The quality tier to get metadata for.</param>
    /// <returns>The TierMetadata for the specified tier.</returns>
    /// <exception cref="ArgumentException">Thrown when metadata for the tier is not found.</exception>
    TierMetadata GetMetadata(QualityTier tier);

    /// <summary>
    /// Gets metadata for all quality tiers.
    /// </summary>
    /// <returns>
    /// A read-only list of all tier metadata, ordered by tier value ascending.
    /// </returns>
    IReadOnlyList<TierMetadata> GetAllMetadata();

    /// <summary>
    /// Gets the color definition for a specific quality tier.
    /// </summary>
    /// <param name="tier">The quality tier to get the color for.</param>
    /// <returns>The TierColorDefinition for the specified tier.</returns>
    /// <exception cref="ArgumentException">Thrown when metadata for the tier is not found.</exception>
    TierColorDefinition GetTierColor(QualityTier tier);

    /// <summary>
    /// Gets the display name for a specific quality tier.
    /// </summary>
    /// <param name="tier">The quality tier to get the name for.</param>
    /// <returns>The display name (e.g., "Clan-Forged").</returns>
    /// <exception cref="ArgumentException">Thrown when metadata for the tier is not found.</exception>
    string GetTierDisplayName(QualityTier tier);

    /// <summary>
    /// Gets the icon glyph for a specific quality tier.
    /// </summary>
    /// <param name="tier">The quality tier to get the icon for.</param>
    /// <returns>The icon character for terminal display.</returns>
    /// <exception cref="ArgumentException">Thrown when metadata for the tier is not found.</exception>
    char GetTierIcon(QualityTier tier);

    /// <summary>
    /// Formats an item name with the appropriate tier prefix.
    /// </summary>
    /// <param name="tier">The quality tier of the item.</param>
    /// <param name="itemName">The base item name.</param>
    /// <returns>The formatted name (e.g., "[Clan-Forged] Iron Sword").</returns>
    string FormatItemName(QualityTier tier, string itemName);

    /// <summary>
    /// Gets the drop weight multiplier for a specific tier.
    /// </summary>
    /// <param name="tier">The quality tier.</param>
    /// <returns>The relative drop weight (1.0 = baseline).</returns>
    decimal GetDropWeight(QualityTier tier);

    /// <summary>
    /// Validates that all required tiers have metadata entries.
    /// </summary>
    /// <returns>True if all tiers are configured, false otherwise.</returns>
    bool ValidateConfiguration();
}
```

### 7.3 Usage Examples

```csharp
// Get metadata for a tier
var clanForgedMeta = _tierMetadataProvider.GetMetadata(QualityTier.ClanForged);
Console.WriteLine($"Tier: {clanForgedMeta.DisplayName}");  // "Clan-Forged"

// Format an item name with tier prefix
var formattedName = _tierMetadataProvider.FormatItemName(
    QualityTier.Optimized,
    "Steel Longsword");
// Result: "[Optimized] Steel Longsword"

// Get all tiers for display
var allTiers = _tierMetadataProvider.GetAllMetadata();
foreach (var tier in allTiers)
{
    Console.WriteLine($"{tier.IconGlyph} {tier.DisplayName}");
}
// Output:
// ○ Jury-Rigged
// ● Scavenged
// ◆ Clan-Forged
// ★ Optimized
// ✦ Myth-Forged

// Get color for rendering
var goldColor = _tierMetadataProvider.GetTierColor(QualityTier.MythForged);
Console.ForegroundColor = goldColor.ConsoleColor;  // Yellow
Console.WriteLine("[Myth-Forged] Dvergr Maul");
```

---

## 8. Data Model Changes

### 8.1 New Types Summary

| Type                    | Layer       | Category     | Description                                   |
| ----------------------- | ----------- | ------------ | --------------------------------------------- |
| `QualityTier`           | Domain      | Enum         | Five-tier quality classification              |
| `TierMetadata`          | Domain      | Value Object | Display and configuration data for a tier     |
| `TierColorDefinition`   | Domain      | Value Object | Color specification across rendering contexts |
| `ITierMetadataProvider` | Application | Interface    | Abstraction for tier metadata access          |

### 8.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── Enums/
│   └── QualityTier.cs                    ← NEW
└── ValueObjects/
    ├── TierMetadata.cs                   ← NEW
    └── TierColorDefinition.cs            ← NEW

src/Core/RuneAndRust.Application/
└── Interfaces/
    └── ITierMetadataProvider.cs          ← NEW

config/
├── quality-tiers.json                    ← NEW
└── schemas/
    └── quality-tiers.schema.json         ← NEW
```

### 8.3 Entity Relationships

```
┌─────────────────┐         ┌─────────────────────┐
│   QualityTier   │◄────────│    TierMetadata     │
│     (Enum)      │  1:1    │   (Value Object)    │
└─────────────────┘         └──────────┬──────────┘
                                       │
                                       │ contains
                                       ▼
                            ┌─────────────────────┐
                            │ TierColorDefinition │
                            │   (Value Object)    │
                            └─────────────────────┘

┌─────────────────────┐
│ ITierMetadataProvider│
│    (Interface)      │
└──────────┬──────────┘
           │
           │ returns
           ▼
┌─────────────────────┐
│    TierMetadata     │
│   (Value Object)    │
└─────────────────────┘
```

---

## 9. Configuration File Schemas

### 9.1 quality-tiers.json

**File:** `config/quality-tiers.json`

```json
{
    "$schema": "./schemas/quality-tiers.schema.json",
    "tiers": [
        {
            "tier": "JuryRigged",
            "tierValue": 0,
            "displayName": "Jury-Rigged",
            "displayNamePlural": "Jury-Rigged items",
            "description": "Makeshift equipment cobbled together from salvaged scraps and broken tools. Functional, but barely.",
            "iconGlyph": "○",
            "dropWeightMultiplier": 1.0,
            "color": {
                "hexColor": "#808080",
                "consoleColor": "Gray"
            }
        },
        {
            "tier": "Scavenged",
            "tierValue": 1,
            "displayName": "Scavenged",
            "displayNamePlural": "Scavenged items",
            "description": "Standard equipment found on fallen enemies or in abandoned caches. Unremarkable but reliable.",
            "iconGlyph": "●",
            "dropWeightMultiplier": 0.5,
            "color": {
                "hexColor": "#FFFFFF",
                "consoleColor": "White"
            }
        },
        {
            "tier": "ClanForged",
            "tierValue": 2,
            "displayName": "Clan-Forged",
            "displayNamePlural": "Clan-Forged items",
            "description": "Quality craftsmanship from regional clan smiths. These weapons and armor bear the marks of skilled artisans.",
            "iconGlyph": "◆",
            "dropWeightMultiplier": 0.25,
            "color": {
                "hexColor": "#00FF00",
                "consoleColor": "Green"
            }
        },
        {
            "tier": "Optimized",
            "tierValue": 3,
            "displayName": "Optimized",
            "displayNamePlural": "Optimized items",
            "description": "Exceptional gear refined by master craftsmen or enhanced through Dvergr techniques. Combat-optimized for maximum effectiveness.",
            "iconGlyph": "★",
            "dropWeightMultiplier": 0.1,
            "color": {
                "hexColor": "#800080",
                "consoleColor": "Magenta"
            }
        },
        {
            "tier": "MythForged",
            "tierValue": 4,
            "displayName": "Myth-Forged",
            "displayNamePlural": "Myth-Forged items",
            "description": "Legendary artifacts of mythic origin. Each piece carries unique properties that can define a warrior's path. Only one of each can exist in a run.",
            "iconGlyph": "✦",
            "dropWeightMultiplier": 0.02,
            "color": {
                "hexColor": "#FFD700",
                "consoleColor": "Yellow"
            }
        }
    ]
}
```

### 9.2 quality-tiers.schema.json

**File:** `config/schemas/quality-tiers.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "quality-tiers.schema.json",
    "title": "Quality Tiers Configuration",
    "description": "Defines the quality tier metadata for the loot system",
    "type": "object",
    "required": ["tiers"],
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON schema reference"
        },
        "tiers": {
            "type": "array",
            "description": "Array of quality tier definitions",
            "minItems": 5,
            "maxItems": 5,
            "items": {
                "$ref": "#/$defs/tierDefinition"
            }
        }
    },
    "$defs": {
        "tierDefinition": {
            "type": "object",
            "description": "Definition of a single quality tier",
            "required": [
                "tier",
                "tierValue",
                "displayName",
                "displayNamePlural",
                "description",
                "iconGlyph",
                "dropWeightMultiplier",
                "color"
            ],
            "properties": {
                "tier": {
                    "type": "string",
                    "description": "The enum name for this tier",
                    "enum": [
                        "JuryRigged",
                        "Scavenged",
                        "ClanForged",
                        "Optimized",
                        "MythForged"
                    ]
                },
                "tierValue": {
                    "type": "integer",
                    "description": "The integer value of the tier (0-4)",
                    "minimum": 0,
                    "maximum": 4
                },
                "displayName": {
                    "type": "string",
                    "description": "Singular display name for the tier",
                    "minLength": 1,
                    "maxLength": 50
                },
                "displayNamePlural": {
                    "type": "string",
                    "description": "Plural display name for the tier",
                    "minLength": 1,
                    "maxLength": 60
                },
                "description": {
                    "type": "string",
                    "description": "Flavor text describing items of this tier",
                    "minLength": 10,
                    "maxLength": 500
                },
                "iconGlyph": {
                    "type": "string",
                    "description": "Single character icon for terminal display",
                    "minLength": 1,
                    "maxLength": 1
                },
                "dropWeightMultiplier": {
                    "type": "number",
                    "description": "Relative drop rate multiplier (1.0 = baseline)",
                    "minimum": 0,
                    "maximum": 10
                },
                "color": {
                    "$ref": "#/$defs/colorDefinition"
                }
            },
            "additionalProperties": false
        },
        "colorDefinition": {
            "type": "object",
            "description": "Color specification for the tier",
            "required": ["hexColor", "consoleColor"],
            "properties": {
                "hexColor": {
                    "type": "string",
                    "description": "Hex color code in #RRGGBB format",
                    "pattern": "^#[0-9A-Fa-f]{6}$"
                },
                "consoleColor": {
                    "type": "string",
                    "description": "System.ConsoleColor enum name",
                    "enum": [
                        "Black",
                        "DarkBlue",
                        "DarkGreen",
                        "DarkCyan",
                        "DarkRed",
                        "DarkMagenta",
                        "DarkYellow",
                        "Gray",
                        "DarkGray",
                        "Blue",
                        "Green",
                        "Cyan",
                        "Red",
                        "Magenta",
                        "Yellow",
                        "White"
                    ]
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 10. Logging Specifications

### 10.1 Log Levels by Component

| Component              | Level       | Events                                            |
| ---------------------- | ----------- | ------------------------------------------------- |
| `TierMetadataProvider` | Information | Configuration loaded, validation complete         |
| `TierMetadataProvider` | Debug       | Individual tier metadata loaded, cache hits       |
| `TierMetadataProvider` | Warning     | Missing tier in configuration, fallback used      |
| `TierMetadataProvider` | Error       | Configuration file not found, invalid JSON format |

### 10.2 Structured Logging Templates

```csharp
// Information - Configuration loaded
_logger.LogInformation(
    "Quality tier configuration loaded. TierCount={TierCount}",
    tiers.Count);

// Information - Validation complete
_logger.LogInformation(
    "Quality tier configuration validated. AllTiersPresent={AllPresent}",
    allTiersPresent);

// Debug - Tier metadata accessed
_logger.LogDebug(
    "Tier metadata retrieved. Tier={Tier}, DisplayName={DisplayName}",
    tier,
    metadata.DisplayName);

// Warning - Missing tier fallback
_logger.LogWarning(
    "Tier metadata missing, using default. Tier={Tier}",
    tier);

// Error - Configuration failure
_logger.LogError(
    "Failed to load quality tier configuration. FilePath={FilePath}, Error={Error}",
    filePath,
    exception.Message);
```

---

## 11. Unit Testing Requirements

### 11.1 Test Count by Feature

| Feature                          | Test Count |
| -------------------------------- | ---------- |
| QualityTier enum                 | ~1         |
| TierMetadata value object        | ~1         |
| TierColorDefinition value object | ~1         |
| ITierMetadataProvider            | ~1         |
| **Total**                        | **~4**     |

### 11.2 Test Specifications

#### QualityTierTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/Enums/QualityTierTests.cs`

```csharp
[TestFixture]
public class QualityTierTests
{
    [Test]
    public void QualityTier_AllTiersHaveExpectedValues_ValuesMatchSpecification();

    [Test]
    public void QualityTier_CanCastToInt_ReturnsCorrectValues();

    [Test]
    public void QualityTier_CanCompare_HigherTiersGreaterThanLower();

    [Test]
    public void QualityTier_AllFiveTiersDefined_CountEquals5();
}
```

#### TierMetadataTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/TierMetadataTests.cs`

```csharp
[TestFixture]
public class TierMetadataTests
{
    [Test]
    public void Create_WithValidParameters_CreatesTierMetadata();

    [Test]
    public void Create_WithNullDisplayName_ThrowsArgumentException();

    [Test]
    public void Create_WithNegativeDropWeight_ThrowsArgumentOutOfRangeException();

    [Test]
    public void FormatItemName_WithValidName_ReturnsFormattedString();

    [Test]
    public void EffectiveValue_ReturnsCorrectTierValue();

    [Test]
    public void IsLegendary_ForMythForged_ReturnsTrue();

    [Test]
    public void IsLegendary_ForOtherTiers_ReturnsFalse();
}
```

#### TierColorDefinitionTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/TierColorDefinitionTests.cs`

```csharp
[TestFixture]
public class TierColorDefinitionTests
{
    [Test]
    public void FromHex_WithValidHexColor_CreatesColorDefinition();

    [Test]
    public void FromHex_WithInvalidHexColor_ThrowsArgumentException();

    [Test]
    public void FromRgb_WithValidComponents_CreatesColorDefinition();

    [Test]
    public void RgbTuple_ReturnsCorrectComponents();

    [Test]
    public void DefaultColors_MatchSpecification();
}
```

---

## 12. Use Cases

### UC-001: Retrieve Tier Metadata for Display

**Actor:** Presentation Layer (InventoryView, LootView)  
**Flow:** Request tier metadata → Get metadata from provider → Display tier name with color → Render item with icon

### UC-002: Format Item Name with Tier

**Actor:** Loot Service  
**Flow:** Generate loot item → Get tier metadata → Format name with tier prefix → Return formatted item

### UC-003: Validate Tier Configuration on Startup

**Actor:** Application Startup  
**Flow:** Load configuration → Parse tier definitions → Validate all tiers present → Log validation result

### UC-004: Get Tier Color for Rendering

**Actor:** Game Renderer  
**Flow:** Request tier color → Get color definition → Apply to console/GUI → Render colored text

---

## 13. Deliverable Checklist

### Domain Layer

- [ ] `QualityTier.cs` enum created in `src/Core/RuneAndRust.Domain/Enums/`
- [ ] `TierMetadata.cs` value object created in `src/Core/RuneAndRust.Domain/ValueObjects/`
- [ ] `TierColorDefinition.cs` value object created in `src/Core/RuneAndRust.Domain/ValueObjects/`
- [ ] All types have complete XML documentation

### Application Layer

- [ ] `ITierMetadataProvider.cs` interface created in `src/Core/RuneAndRust.Application/Interfaces/`
- [ ] Interface has complete XML documentation

### Configuration Files

- [ ] `config/quality-tiers.json` created with all 5 tiers
- [ ] `config/schemas/quality-tiers.schema.json` created
- [ ] Configuration validates against schema

### Testing

- [ ] `QualityTierTests.cs` created
- [ ] `TierMetadataTests.cs` created
- [ ] `TierColorDefinitionTests.cs` created
- [ ] ~4 unit tests passing

### Documentation

- [ ] `v0.16.0a-changelog.md` created
- [ ] Inline code comments complete

---

## 14. Acceptance Criteria

### Functional

- [ ] `QualityTier` enum defines exactly 5 tiers with values 0-4
- [ ] `TierMetadata.Create()` validates all parameters
- [ ] `TierMetadata.FormatItemName()` returns `[TierName] ItemName` format
- [ ] `TierColorDefinition.FromHex()` parses valid hex colors
- [ ] `TierColorDefinition.FromHex()` throws for invalid hex colors
- [ ] Default color constants match specification values
- [ ] `ITierMetadataProvider.GetMetadata()` returns correct metadata for each tier
- [ ] `ITierMetadataProvider.GetTierColor()` returns correct color for each tier

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~4 unit tests pass
- [ ] Configuration validates against JSON schema
- [ ] All public types have XML documentation

---

## 15. Dependencies

### Required from Prior Versions

| Type                          | Location                         | Usage                  |
| ----------------------------- | -------------------------------- | ---------------------- |
| `IEntity`                     | `RuneAndRust.Domain/Interfaces/` | Base interface pattern |
| Configuration loading pattern | Various                          | Loading JSON config    |

### Provides to v0.16.0b

| Type                    | Usage                                |
| ----------------------- | ------------------------------------ |
| `QualityTier`           | Used for stat scaling calculations   |
| `TierMetadata`          | Display information for scaled items |
| `ITierMetadataProvider` | Access to tier metadata              |

### Provides to v0.16.0c

| Type                                | Usage                            |
| ----------------------------------- | -------------------------------- |
| `QualityTier`                       | Used in drop probability tables  |
| `TierMetadata.DropWeightMultiplier` | Base drop weight for probability |

### Provides to v0.16.0d

| Type                    | Usage                            |
| ----------------------- | -------------------------------- |
| `QualityTier`           | Assigned to generated loot items |
| `ITierMetadataProvider` | Formatting loot drop names       |

---

## 16. Future Considerations

### Deferred to v0.16.0b

- **Stat Scaling Formulas**: Weapon and armor stat calculations based on tier
- **WeaponTierScaling Value Object**: Damage ranges per tier
- **ArmorTierScaling Value Object**: Defense values per tier

### Deferred to v0.16.0c

- **Drop Probability Tables**: Enemy drop class to tier probability mapping
- **EnemyDropClass Enum**: Classification of enemy loot potential

### Deferred to v0.16.1+

- **TierMetadataProvider Implementation**: Actual service implementation
- **UI Integration**: Rendering tier colors in inventory/loot views

### Out of Scope

- **Tier 5+ Expansion**: No additional tiers planned; five tiers are sufficient
- **Per-Item Color Overrides**: Colors are tier-based, not item-based
- **Animated Tier Effects**: Visual effects for legendary items handled elsewhere

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_  
_Author: AI Assistant_
