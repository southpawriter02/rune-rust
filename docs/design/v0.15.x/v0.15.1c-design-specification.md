# v0.15.1c Design Specification: Master Abilities

**Version:** 0.15.1c
**Theme:** Master Abilities
**Author:** Claude
**Created:** 2026-01-17
**Status:** Draft
**Prerequisites:** v0.15.0 Complete (Dice Pool Refactor), v0.15.1a Complete (Skill Context & Modifiers), v0.15.1b Complete (Outcome Classification)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [MasterAbilityType Enum](#4-masterabilitytype-enum)
5. [MasterAbility Entity](#5-masterability-entity)
6. [MasterAbilityEffect Value Object](#6-masterabilityeffect-value-object)
7. [IMasterAbilityProvider Interface](#7-imasterabilityprovider-interface)
8. [MasterAbilityProvider Implementation](#8-masterabilityprovider-implementation)
9. [IMasterAbilityService Interface](#9-imasterabilityservice-interface)
10. [MasterAbilityService Implementation](#10-masterabilityservice-implementation)
11. [SkillCheckService Integration](#11-skillcheckservice-integration)
12. [Data Model Changes](#12-data-model-changes)
13. [Configuration](#13-configuration)
14. [JSON Schema](#14-json-schema)
15. [Commands](#15-commands)
16. [User-Facing Changes](#16-user-facing-changes)
17. [Logging Specifications](#17-logging-specifications)
18. [Unit Testing Requirements](#18-unit-testing-requirements)
19. [Use Cases](#19-use-cases)
20. [Deliverable Checklist](#20-deliverable-checklist)
21. [Acceptance Criteria](#21-acceptance-criteria)
22. [Future Considerations](#22-future-considerations)
23. [Implementation Notes](#23-implementation-notes)
24. [Document Metadata](#24-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.1c, the Master Abilities phase. This part introduces the infrastructure for Rank 5 passive and active abilities that provide powerful capstone bonuses to skilled characters. Master abilities represent the pinnacle of skill mastery, granting effects such as:

1. **Auto-Succeed Abilities**: Automatically succeed on checks below a threshold DC (e.g., Spider Climb auto-succeeds climbing DC ≤ 12).

2. **Dice Bonus Abilities**: Permanent dice pool bonuses for specific check types (e.g., Fearsome Reputation +2d10 to intimidation).

3. **Damage/Distance Modifiers**: Enhanced physical capabilities (e.g., Cat's Grace negates fall damage ≤ 30ft, Death-Defying Leap +10ft distance).

4. **Re-roll Abilities**: One-time re-roll opportunities (e.g., Master Negotiator re-rolls one failed check per conversation).

5. **Special Action Abilities**: Unique action unlocks (e.g., Salvage Expertise always recovers trap components).

This infrastructure is used by all four skill expansions (v0.15.2-v0.15.5) to apply master-rank bonuses during skill checks.

### 1.2 Current vs. Target Implementation

| Aspect | Current Implementation | Target Implementation |
|--------|------------------------|----------------------|
| **Master Abilities** | Not implemented | `MasterAbility` entity with type-specific effects |
| **Rank 5 Bonuses** | No special handling | Auto-succeed, dice bonus, special effects |
| **Ability Lookup** | N/A | `IMasterAbilityProvider` for data access |
| **Check Integration** | No master ability checks | Pre-check evaluation in `SkillCheckService` |
| **Configuration** | N/A | `master-abilities.json` with 18 defined abilities |
| **Passive vs Active** | N/A | `IsPassive` flag for always-on vs triggered |

### 1.3 Scope

**In Scope:**
- Define `MasterAbilityType` enum for ability classification
- Define `MasterAbility` entity for ability templates
- Define `MasterAbilityEffect` value object for effect parameters
- Create `IMasterAbilityProvider` interface for data access
- Implement `MasterAbilityProvider` for JSON configuration loading
- Create `IMasterAbilityService` interface for ability evaluation
- Implement `MasterAbilityService` for check modification and auto-succeed logic
- Integrate master abilities into `SkillCheckService`
- Configuration file `master-abilities.json` with 18 abilities
- JSON schema `master-abilities.schema.json` for validation
- Unit tests for master ability evaluation (~3 tests per scope breakdown)

**Out of Scope:**
- Cooperative and chained checks - v0.15.1d
- Trauma economy integration - v0.15.1e
- Specialization bonus hooks - v0.15.1e
- Voice guidance integration - v0.15.1e
- Skill-specific ability implementations (climbing, stealth, etc.) - v0.15.2-v0.15.5
- UI for displaying active master abilities - future version
- Active ability activation commands - future version (abilities are passive for now)

### 1.4 Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Enums | 1 | `MasterAbilityType` |
| Entities | 1 | `MasterAbility` |
| Value Objects | 1 | `MasterAbilityEffect` |
| Interfaces | 2 | `IMasterAbilityProvider`, `IMasterAbilityService` |
| Services | 2 | `MasterAbilityProvider`, `MasterAbilityService` |
| Configuration | 1 | `master-abilities.json` (18 abilities) |
| Schema | 1 | `master-abilities.schema.json` |
| Unit Tests | ~3 | Auto-succeed, dice bonus, rank validation |

---

## 2. Dependencies

### 2.1 Required from v0.15.0a (Core Dice Mechanics)

| Component | Location | Usage in v0.15.1c |
|-----------|----------|-------------------|
| `DiceRollResult` | `Domain/ValueObjects/DiceRollResult.cs` | Modified by dice bonus abilities |
| `DiceConstants` | `Domain/Constants/DiceConstants.cs` | Threshold values for auto-succeed |

### 2.2 Required from v0.15.0c (Skill Check Refactor)

| Component | Location | Usage in v0.15.1c |
|-----------|----------|-------------------|
| `SkillCheckResult` | `Domain/ValueObjects/SkillCheckResult.cs` | Extended with master ability flags |
| `SkillOutcome` | `Domain/Enums/SkillOutcome.cs` | Auto-succeed returns `FullSuccess` |
| `SkillCheckService` | `Application/Services/SkillCheckService.cs` | Calls `MasterAbilityService` pre-check |

### 2.3 Required from v0.15.1a (Skill Context & Modifiers)

| Component | Location | Usage in v0.15.1c |
|-----------|----------|-------------------|
| `SkillContext` | `Domain/ValueObjects/SkillContext.cs` | Context for ability applicability |
| `SkillContextBuilder` | `Application/Services/SkillContextBuilder.cs` | Adds master ability dice bonuses |

### 2.4 Required from v0.4.x-v0.5.x (Skill System)

| Component | Location | Usage in v0.15.1c |
|-----------|----------|-------------------|
| `ProficiencyLevel` | `Domain/Enums/ProficiencyLevel.cs` | Must be `Master` (Rank 5) for abilities |
| `SkillDefinition` | `Domain/Entities/SkillDefinition.cs` | Links abilities to skills |
| `Player` | `Domain/Entities/Player.cs` | Provides skill proficiency levels |

### 2.5 Provides to Future Versions

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.1d | `MasterAbilityService` | Checks master abilities during cooperative checks |
| v0.15.2 | Acrobatics | Uses Spider Climb, Cat's Grace, Ghost Walk, Death-Defying Leap, Perfect Balance |
| v0.15.3 | Rhetoric | Uses Polyglot, Cultural Diplomat, Master Negotiator, Silver Tongue, Fearsome Reputation |
| v0.15.4 | System Bypass | Uses Auto-Bypass, Salvage Expertise, Silent Bypass, Glitch Reader |
| v0.15.5 | Wasteland Survival | Uses Wasteland Cartographer, Apex Scavenger, Master Tracker, Hazard Sense |

---

## 3. Architecture Diagrams

### 3.1 Master Ability Evaluation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      MASTER ABILITY EVALUATION FLOW                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  INPUT: Skill Check Request                                                 │
│  ├── CharacterId: "player-1"                                                │
│  ├── SkillId: "acrobatics"                                                  │
│  ├── SubType: "climbing"                                                    │
│  └── DifficultyClass: 10                                                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  STEP 1: CHECK PROFICIENCY RANK                                     │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Player.GetSkillProficiency("acrobatics") → Master (Rank 5)         │    │
│  │                                                                      │    │
│  │  if (rank != ProficiencyLevel.Master) → SKIP MASTER ABILITIES       │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼ (Rank 5 confirmed)                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  STEP 2: GET APPLICABLE MASTER ABILITIES                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  MasterAbilityProvider.GetAbilitiesForSkill("acrobatics")           │    │
│  │  → [Spider Climb, Cat's Grace, Ghost Walk, Death-Defying Leap,      │    │
│  │     Perfect Balance]                                                 │    │
│  │                                                                      │    │
│  │  Filter by SubType:                                                  │    │
│  │  → Spider Climb (SubTypes: ["climbing"])                            │    │
│  │  → Perfect Balance (SubTypes: ["climbing", "balance"])              │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  STEP 3: EVALUATE AUTO-SUCCEED ABILITIES                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Spider Climb:                                                       │    │
│  │    AbilityType: AutoSucceed                                         │    │
│  │    AutoSucceedDc: 12                                                │    │
│  │                                                                      │    │
│  │  Check: DC 10 ≤ AutoSucceedDc 12 → AUTO-SUCCEED TRIGGERED           │    │
│  │                                                                      │    │
│  │  Return early:                                                       │    │
│  │  SkillCheckResult {                                                  │    │
│  │    Outcome: FullSuccess,                                            │    │
│  │    WasAutoSucceed: true,                                            │    │
│  │    AppliedMasterAbility: "spider-climb",                            │    │
│  │    Message: "Your mastery allows you to scale the surface           │    │
│  │             effortlessly."                                           │    │
│  │  }                                                                   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─  │
│  ALTERNATE PATH: No Auto-Succeed (DC > Threshold)                          │
│  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─  │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  STEP 4: APPLY DICE BONUS ABILITIES                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  (Example with Intimidation, not Climbing)                          │    │
│  │                                                                      │    │
│  │  Fearsome Reputation:                                                │    │
│  │    AbilityType: DiceBonus                                           │    │
│  │    DiceBonus: +2                                                    │    │
│  │                                                                      │    │
│  │  Modify SkillContext:                                                │    │
│  │  context.AddMasterAbilityModifier(                                  │    │
│  │      abilityId: "fearsome-reputation",                              │    │
│  │      diceBonus: +2,                                                 │    │
│  │      description: "Fearsome Reputation: +2d10")                     │    │
│  │                                                                      │    │
│  │  → Continue to normal skill check with modified dice pool           │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  OUTPUT: Modified SkillContext or Early SkillCheckResult                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Master Ability Type Hierarchy

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       MASTER ABILITY TYPE HIERARCHY                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  MasterAbilityType (Enum)                                                   │
│  │                                                                           │
│  ├── AutoSucceed                                                            │
│  │   └── Automatically succeed on checks at or below threshold DC           │
│  │       ├── Requires: AutoSucceedDc parameter                              │
│  │       ├── Returns: FullSuccess without rolling                           │
│  │       └── Examples: Spider Climb (DC ≤ 12), Ghost Walk (DC ≤ 14)        │
│  │                                                                           │
│  ├── DiceBonus                                                              │
│  │   └── Permanent bonus dice added to pool                                 │
│  │       ├── Requires: DiceBonus parameter                                  │
│  │       ├── Applied: During context building                               │
│  │       └── Examples: Fearsome Reputation (+2d10), Glitch Reader (-2 DC)  │
│  │                                                                           │
│  ├── DamageReduction                                                        │
│  │   └── Reduces or negates damage from specific sources                    │
│  │       ├── Requires: DamageThreshold, ReductionAmount parameters          │
│  │       ├── Applied: During damage calculation                             │
│  │       └── Examples: Cat's Grace (no damage ≤ 30ft fall)                 │
│  │                                                                           │
│  ├── DistanceBonus                                                          │
│  │   └── Increases effective range or distance                              │
│  │       ├── Requires: DistanceBonus parameter                              │
│  │       ├── Applied: During distance calculation                           │
│  │       └── Examples: Death-Defying Leap (+10ft), Master Tracker (+24hr)  │
│  │                                                                           │
│  ├── RerollFailure                                                          │
│  │   └── Allows re-rolling a failed check once per period                   │
│  │       ├── Requires: RerollPeriod parameter (Conversation, Scene, Day)    │
│  │       ├── Applied: After initial failure, before consequence             │
│  │       └── Examples: Master Negotiator (once per conversation)            │
│  │                                                                           │
│  └── SpecialAction                                                          │
│      └── Grants unique capabilities not tied to check mechanics             │
│          ├── Requires: SpecialEffect string (parsed by skill systems)       │
│          ├── Applied: Context-dependent by skill subsystem                  │
│          └── Examples: Salvage Expertise, Silent Bypass, Apex Scavenger    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Master Abilities by Skill

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        MASTER ABILITIES BY SKILL                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  ACROBATICS (5 abilities)                                           │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  spider-climb         │ AutoSucceed    │ DC ≤ 12 climbing           │    │
│  │  cats-grace           │ DamageReduction│ No damage ≤ 30ft fall      │    │
│  │  ghost-walk           │ AutoSucceed    │ DC ≤ 14 stealth            │    │
│  │  death-defying-leap   │ DistanceBonus  │ +10ft leap distance        │    │
│  │  perfect-balance      │ AutoSucceed    │ DC ≤ 16 balance            │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  RHETORIC (5 abilities)                                             │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  polyglot             │ AutoSucceed    │ DC ≤ 14 cant/language      │    │
│  │  cultural-diplomat    │ AutoSucceed    │ DC ≤ 14 cultural protocol  │    │
│  │  master-negotiator    │ RerollFailure  │ Once per conversation      │    │
│  │  silver-tongue        │ AutoSucceed    │ DC ≤ 12 persuasion         │    │
│  │  fearsome-reputation  │ DiceBonus      │ +2d10 intimidation         │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  SYSTEM BYPASS (4 abilities)                                        │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  auto-bypass          │ AutoSucceed    │ DC ≤ 10 bypass             │    │
│  │  salvage-expertise    │ SpecialAction  │ Always recover components  │    │
│  │  silent-bypass        │ SpecialAction  │ No noise on success        │    │
│  │  glitch-reader        │ DiceBonus      │ -2 to [Glitched] DC penalty│    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │  WASTELAND SURVIVAL (4 abilities)                                   │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  wasteland-cartographer│ AutoSucceed   │ DC ≤ 10 navigation         │    │
│  │  apex-scavenger        │ SpecialAction │ Never empty, +50% yield    │    │
│  │  master-tracker        │ DistanceBonus │ Track trails up to 48hr    │    │
│  │  hazard-sense          │ AutoSucceed   │ DC ≤ 16 hazard detection   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  TOTALS:                                                                    │
│  ├── AutoSucceed: 9 abilities                                               │
│  ├── DiceBonus: 2 abilities                                                 │
│  ├── DamageReduction: 1 ability                                             │
│  ├── DistanceBonus: 2 abilities                                             │
│  ├── RerollFailure: 1 ability                                               │
│  └── SpecialAction: 3 abilities                                             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Entities/                                                           │    │
│  │  └── MasterAbility.cs              ←── NEW (ability template)       │    │
│  │                                                                      │    │
│  │  ValueObjects/                                                       │    │
│  │  └── MasterAbilityEffect.cs        ←── NEW (effect parameters)      │    │
│  │                                                                      │    │
│  │  Enums/                                                              │    │
│  │  ├── MasterAbilityType.cs          ←── NEW (ability classification) │    │
│  │  └── RerollPeriod.cs               ←── NEW (reroll timing)          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                         │    │
│  │  ├── IMasterAbilityProvider.cs     ←── NEW (data access)            │    │
│  │  └── IMasterAbilityService.cs      ←── NEW (ability evaluation)     │    │
│  │                                                                      │    │
│  │  Services/                                                           │    │
│  │  ├── MasterAbilityService.cs       ←── NEW (ability logic)          │    │
│  │  └── SkillCheckService.cs          ←── MODIFIED (master ability     │    │
│  │                                         pre-check integration)       │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  INFRASTRUCTURE LAYER                                │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Providers/                                                          │    │
│  │  └── MasterAbilityProvider.cs      ←── NEW (JSON loading)           │    │
│  │                                                                      │    │
│  │  Configuration/                                                      │    │
│  │  └── master-abilities.json         ←── NEW (18 abilities)           │    │
│  │                                                                      │    │
│  │  Schemas/                                                            │    │
│  │  └── master-abilities.schema.json  ←── NEW (validation schema)      │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  DEPENDENCY INJECTION                                │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  services.AddSingleton<IMasterAbilityProvider, MasterAbilityProvider>();│ │
│  │  services.AddScoped<IMasterAbilityService, MasterAbilityService>(); │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. MasterAbilityType Enum

### 4.1 Enum Definition

**File:** `src/Core/RuneAndRust.Domain/Enums/MasterAbilityType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Classifies the type of effect a master ability provides.
/// </summary>
/// <remarks>
/// <para>
/// Master abilities are Rank 5 capstone abilities that provide powerful bonuses
/// to skilled characters. Each type has different mechanics:
/// </para>
/// <list type="bullet">
///   <item><description><see cref="AutoSucceed"/>: Skip the check entirely below threshold DC</description></item>
///   <item><description><see cref="DiceBonus"/>: Permanent bonus dice to specific checks</description></item>
///   <item><description><see cref="DamageReduction"/>: Reduce or negate damage from specific sources</description></item>
///   <item><description><see cref="DistanceBonus"/>: Increase effective range or distance</description></item>
///   <item><description><see cref="RerollFailure"/>: Re-roll a failed check once per period</description></item>
///   <item><description><see cref="SpecialAction"/>: Unique capabilities not tied to check mechanics</description></item>
/// </list>
/// </remarks>
public enum MasterAbilityType
{
    /// <summary>
    /// Automatically succeed on checks at or below a threshold DC.
    /// </summary>
    /// <remarks>
    /// When the check's DC is at or below the ability's <c>AutoSucceedDc</c>,
    /// the check automatically succeeds with <see cref="SkillOutcome.FullSuccess"/>
    /// without rolling dice. The result includes <c>WasAutoSucceed: true</c>.
    /// </remarks>
    /// <example>
    /// Spider Climb: Auto-succeed climbing checks DC ≤ 12.
    /// Ghost Walk: Auto-succeed stealth checks DC ≤ 14.
    /// </example>
    AutoSucceed = 0,

    /// <summary>
    /// Provides a permanent bonus to the dice pool for specific check types.
    /// </summary>
    /// <remarks>
    /// The ability's <c>DiceBonus</c> is added to the dice pool during context
    /// building. This stacks with other modifiers.
    /// </remarks>
    /// <example>
    /// Fearsome Reputation: +2d10 to all intimidation checks.
    /// Glitch Reader: Reduces [Glitched] DC penalty by 2 (effectively +2d10 equivalent).
    /// </example>
    DiceBonus = 1,

    /// <summary>
    /// Reduces or negates damage from specific sources.
    /// </summary>
    /// <remarks>
    /// The ability specifies a damage threshold and reduction amount.
    /// Damage at or below the threshold is reduced by the specified amount.
    /// </remarks>
    /// <example>
    /// Cat's Grace: No damage from falls of 30ft or less.
    /// </example>
    DamageReduction = 2,

    /// <summary>
    /// Increases effective range, distance, or duration for skill effects.
    /// </summary>
    /// <remarks>
    /// The ability's <c>DistanceBonus</c> is added to distance calculations,
    /// time limits, or similar numeric bounds.
    /// </remarks>
    /// <example>
    /// Death-Defying Leap: +10ft maximum leap distance.
    /// Master Tracker: Track trails up to 48 hours old (vs normal 24 hours).
    /// </example>
    DistanceBonus = 3,

    /// <summary>
    /// Allows re-rolling a failed check once per specified period.
    /// </summary>
    /// <remarks>
    /// When a check fails, the player may invoke this ability to re-roll.
    /// The ability tracks usage per <c>RerollPeriod</c> (conversation, scene, day).
    /// </remarks>
    /// <example>
    /// Master Negotiator: Re-roll one failed negotiation check per conversation.
    /// </example>
    RerollFailure = 4,

    /// <summary>
    /// Grants unique capabilities not tied to standard check mechanics.
    /// </summary>
    /// <remarks>
    /// The ability's <c>SpecialEffect</c> string describes the unique capability.
    /// Interpretation is handled by the specific skill subsystem (e.g., Acrobatics,
    /// System Bypass).
    /// </remarks>
    /// <example>
    /// Salvage Expertise: Always recover trap components on successful disarmament.
    /// Silent Bypass: No noise generated on successful bypass.
    /// Apex Scavenger: Never find empty containers, +50% foraging yield.
    /// </example>
    SpecialAction = 5
}
```

### 4.2 RerollPeriod Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/RerollPeriod.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the time period after which a re-roll ability can be used again.
/// </summary>
/// <remarks>
/// Used by <see cref="MasterAbilityType.RerollFailure"/> abilities to track
/// how often the re-roll can be invoked.
/// </remarks>
public enum RerollPeriod
{
    /// <summary>
    /// Re-roll refreshes after the current conversation or dialogue ends.
    /// </summary>
    /// <example>Master Negotiator: Once per conversation.</example>
    Conversation = 0,

    /// <summary>
    /// Re-roll refreshes after the current scene or encounter ends.
    /// </summary>
    /// <example>A stealth re-roll that refreshes after leaving the area.</example>
    Scene = 1,

    /// <summary>
    /// Re-roll refreshes after an in-game day passes.
    /// </summary>
    /// <example>A powerful re-roll limited to once per day.</example>
    Day = 2,

    /// <summary>
    /// Re-roll refreshes after a long rest.
    /// </summary>
    /// <example>An exhausting ability requiring rest to recover.</example>
    Rest = 3
}
```

---

## 5. MasterAbility Entity

### 5.1 Entity Definition

**File:** `src/Core/RuneAndRust.Domain/Entities/MasterAbility.cs`

```csharp
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a master-rank (Rank 5) ability that provides powerful bonuses to skilled characters.
/// </summary>
/// <remarks>
/// <para>
/// Master abilities are the pinnacle of skill mastery. Each of the four core skills
/// (Acrobatics, Rhetoric, System Bypass, Wasteland Survival) has 4-5 master abilities
/// that characters unlock at Rank 5 proficiency.
/// </para>
/// <para>
/// Abilities can be passive (always active) or active (require explicit invocation).
/// Most abilities in v0.15.1c are passive, with active abilities planned for future versions.
/// </para>
/// </remarks>
public sealed class MasterAbility
{
    /// <summary>
    /// Unique identifier for this master ability.
    /// </summary>
    /// <remarks>
    /// Uses kebab-case format matching the configuration file.
    /// Example: "spider-climb", "fearsome-reputation".
    /// </remarks>
    public string AbilityId { get; private set; } = string.Empty;

    /// <summary>
    /// The skill this ability is associated with.
    /// </summary>
    /// <remarks>
    /// Must match a valid skill ID from the skill definitions.
    /// Example: "acrobatics", "rhetoric", "system-bypass", "wasteland-survival".
    /// </remarks>
    public string SkillId { get; private set; } = string.Empty;

    /// <summary>
    /// Display name of the ability.
    /// </summary>
    /// <example>"Spider Climb", "Fearsome Reputation"</example>
    public string Name { get; private set; } = string.Empty;

    /// <summary>
    /// Full description of the ability's effect.
    /// </summary>
    /// <example>"Automatically succeed on climbing checks with DC 12 or lower. You climb at full speed."</example>
    public string Description { get; private set; } = string.Empty;

    /// <summary>
    /// The type of effect this ability provides.
    /// </summary>
    /// <seealso cref="MasterAbilityType"/>
    public MasterAbilityType AbilityType { get; private set; }

    /// <summary>
    /// The effect parameters for this ability.
    /// </summary>
    /// <remarks>
    /// Contains type-specific values like <c>AutoSucceedDc</c>, <c>DiceBonus</c>, etc.
    /// </remarks>
    public MasterAbilityEffect Effect { get; private set; } = MasterAbilityEffect.Empty;

    /// <summary>
    /// Skill subtypes this ability applies to.
    /// </summary>
    /// <remarks>
    /// <para>
    /// If empty, the ability applies to all checks for the associated skill.
    /// If specified, the ability only applies when the check's subtype matches.
    /// </para>
    /// <para>
    /// Examples:
    /// <list type="bullet">
    ///   <item><description>Spider Climb: ["climbing"]</description></item>
    ///   <item><description>Ghost Walk: ["stealth"]</description></item>
    ///   <item><description>Fearsome Reputation: ["intimidation"]</description></item>
    /// </list>
    /// </para>
    /// </remarks>
    public IReadOnlyList<string> SubTypes { get; private set; } = Array.Empty<string>();

    /// <summary>
    /// Whether this ability is always active (passive) or requires activation (active).
    /// </summary>
    /// <remarks>
    /// Passive abilities are automatically evaluated during skill checks.
    /// Active abilities require explicit player invocation (future feature).
    /// </remarks>
    public bool IsPassive { get; private set; } = true;

    /// <summary>
    /// Optional flavor text for when the ability triggers.
    /// </summary>
    /// <example>"Your mastery allows you to scale the surface effortlessly."</example>
    public string? TriggerMessage { get; private set; }

    // Private constructor for deserialization
    private MasterAbility() { }

    /// <summary>
    /// Creates a new master ability.
    /// </summary>
    /// <param name="abilityId">Unique identifier for the ability.</param>
    /// <param name="skillId">Associated skill ID.</param>
    /// <param name="name">Display name.</param>
    /// <param name="description">Full description.</param>
    /// <param name="abilityType">Type of effect.</param>
    /// <param name="effect">Effect parameters.</param>
    /// <param name="subTypes">Optional skill subtypes.</param>
    /// <param name="isPassive">Whether passive (default: true).</param>
    /// <param name="triggerMessage">Optional trigger flavor text.</param>
    /// <returns>A new <see cref="MasterAbility"/> instance.</returns>
    /// <exception cref="ArgumentException">
    /// Thrown when <paramref name="abilityId"/>, <paramref name="skillId"/>,
    /// or <paramref name="name"/> is null or whitespace.
    /// </exception>
    public static MasterAbility Create(
        string abilityId,
        string skillId,
        string name,
        string description,
        MasterAbilityType abilityType,
        MasterAbilityEffect effect,
        IReadOnlyList<string>? subTypes = null,
        bool isPassive = true,
        string? triggerMessage = null)
    {
        if (string.IsNullOrWhiteSpace(abilityId))
            throw new ArgumentException("Ability ID is required.", nameof(abilityId));
        if (string.IsNullOrWhiteSpace(skillId))
            throw new ArgumentException("Skill ID is required.", nameof(skillId));
        if (string.IsNullOrWhiteSpace(name))
            throw new ArgumentException("Name is required.", nameof(name));

        return new MasterAbility
        {
            AbilityId = abilityId,
            SkillId = skillId,
            Name = name,
            Description = description ?? string.Empty,
            AbilityType = abilityType,
            Effect = effect,
            SubTypes = subTypes ?? Array.Empty<string>(),
            IsPassive = isPassive,
            TriggerMessage = triggerMessage
        };
    }

    /// <summary>
    /// Checks if this ability applies to a specific skill check subtype.
    /// </summary>
    /// <param name="subType">The subtype to check, or null for general checks.</param>
    /// <returns>
    /// <c>true</c> if the ability has no subtype restrictions, or if the specified
    /// subtype is in the ability's <see cref="SubTypes"/> list; otherwise <c>false</c>.
    /// </returns>
    public bool AppliesToSubType(string? subType)
    {
        // No restrictions means applies to all
        if (SubTypes.Count == 0)
            return true;

        // Must match one of the specified subtypes
        if (string.IsNullOrWhiteSpace(subType))
            return false;

        return SubTypes.Contains(subType, StringComparer.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Checks if this ability would auto-succeed a check at the given DC.
    /// </summary>
    /// <param name="difficultyClass">The DC of the check.</param>
    /// <returns>
    /// <c>true</c> if this is an <see cref="MasterAbilityType.AutoSucceed"/> ability
    /// and the DC is at or below the threshold; otherwise <c>false</c>.
    /// </returns>
    public bool WouldAutoSucceed(int difficultyClass)
    {
        if (AbilityType != MasterAbilityType.AutoSucceed)
            return false;

        return Effect.AutoSucceedDc.HasValue && difficultyClass <= Effect.AutoSucceedDc.Value;
    }

    /// <summary>
    /// Gets the dice bonus provided by this ability, if any.
    /// </summary>
    /// <returns>
    /// The dice bonus for <see cref="MasterAbilityType.DiceBonus"/> abilities,
    /// or 0 if not applicable.
    /// </returns>
    public int GetDiceBonus()
    {
        if (AbilityType != MasterAbilityType.DiceBonus)
            return 0;

        return Effect.DiceBonus ?? 0;
    }

    /// <summary>
    /// Returns a string representation for debugging.
    /// </summary>
    public override string ToString() => $"[{AbilityId}] {Name} ({AbilityType})";
}
```

---

## 6. MasterAbilityEffect Value Object

### 6.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/MasterAbilityEffect.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Contains the effect parameters for a master ability.
/// </summary>
/// <remarks>
/// <para>
/// This value object holds the type-specific parameters for different
/// <see cref="MasterAbilityType"/> values:
/// </para>
/// <list type="bullet">
///   <item><description><see cref="MasterAbilityType.AutoSucceed"/>: Uses <see cref="AutoSucceedDc"/></description></item>
///   <item><description><see cref="MasterAbilityType.DiceBonus"/>: Uses <see cref="DiceBonus"/></description></item>
///   <item><description><see cref="MasterAbilityType.DamageReduction"/>: Uses <see cref="DamageThreshold"/> and <see cref="ReductionAmount"/></description></item>
///   <item><description><see cref="MasterAbilityType.DistanceBonus"/>: Uses <see cref="DistanceBonus"/></description></item>
///   <item><description><see cref="MasterAbilityType.RerollFailure"/>: Uses <see cref="RerollPeriod"/></description></item>
///   <item><description><see cref="MasterAbilityType.SpecialAction"/>: Uses <see cref="SpecialEffect"/></description></item>
/// </list>
/// </remarks>
/// <param name="AutoSucceedDc">DC threshold for auto-succeed abilities.</param>
/// <param name="DiceBonus">Bonus dice for dice bonus abilities.</param>
/// <param name="DamageThreshold">Maximum damage height/amount for damage reduction.</param>
/// <param name="ReductionAmount">Amount to reduce damage by (null = negate entirely).</param>
/// <param name="DistanceBonus">Additional distance/time for distance bonus abilities.</param>
/// <param name="RerollPeriod">Period for re-roll ability refresh.</param>
/// <param name="SpecialEffect">Special effect description for skill subsystem parsing.</param>
public readonly record struct MasterAbilityEffect(
    int? AutoSucceedDc = null,
    int? DiceBonus = null,
    int? DamageThreshold = null,
    int? ReductionAmount = null,
    int? DistanceBonus = null,
    RerollPeriod? RerollPeriod = null,
    string? SpecialEffect = null)
{
    /// <summary>
    /// An empty effect with no parameters set.
    /// </summary>
    public static MasterAbilityEffect Empty => new();

    /// <summary>
    /// Creates an auto-succeed effect.
    /// </summary>
    /// <param name="autoSucceedDc">Maximum DC that auto-succeeds.</param>
    /// <returns>A new effect configured for auto-succeed.</returns>
    public static MasterAbilityEffect ForAutoSucceed(int autoSucceedDc)
        => new(AutoSucceedDc: autoSucceedDc);

    /// <summary>
    /// Creates a dice bonus effect.
    /// </summary>
    /// <param name="diceBonus">Number of bonus dice.</param>
    /// <returns>A new effect configured for dice bonus.</returns>
    public static MasterAbilityEffect ForDiceBonus(int diceBonus)
        => new(DiceBonus: diceBonus);

    /// <summary>
    /// Creates a damage reduction effect.
    /// </summary>
    /// <param name="damageThreshold">Maximum damage that can be reduced (e.g., 30ft fall).</param>
    /// <param name="reductionAmount">Amount to reduce by, or null to negate entirely.</param>
    /// <returns>A new effect configured for damage reduction.</returns>
    public static MasterAbilityEffect ForDamageReduction(int damageThreshold, int? reductionAmount = null)
        => new(DamageThreshold: damageThreshold, ReductionAmount: reductionAmount);

    /// <summary>
    /// Creates a distance bonus effect.
    /// </summary>
    /// <param name="distanceBonus">Additional distance/time.</param>
    /// <returns>A new effect configured for distance bonus.</returns>
    public static MasterAbilityEffect ForDistanceBonus(int distanceBonus)
        => new(DistanceBonus: distanceBonus);

    /// <summary>
    /// Creates a re-roll failure effect.
    /// </summary>
    /// <param name="rerollPeriod">How often the re-roll refreshes.</param>
    /// <returns>A new effect configured for re-roll.</returns>
    public static MasterAbilityEffect ForRerollFailure(RerollPeriod rerollPeriod)
        => new(RerollPeriod: rerollPeriod);

    /// <summary>
    /// Creates a special action effect.
    /// </summary>
    /// <param name="specialEffect">Description of the special effect.</param>
    /// <returns>A new effect configured for special action.</returns>
    public static MasterAbilityEffect ForSpecialAction(string specialEffect)
        => new(SpecialEffect: specialEffect);

    /// <summary>
    /// Validates that the effect has appropriate parameters for the given ability type.
    /// </summary>
    /// <param name="abilityType">The ability type to validate against.</param>
    /// <returns><c>true</c> if the effect has valid parameters; otherwise <c>false</c>.</returns>
    public bool IsValidForType(MasterAbilityType abilityType)
    {
        return abilityType switch
        {
            MasterAbilityType.AutoSucceed => AutoSucceedDc.HasValue,
            MasterAbilityType.DiceBonus => DiceBonus.HasValue,
            MasterAbilityType.DamageReduction => DamageThreshold.HasValue,
            MasterAbilityType.DistanceBonus => DistanceBonus.HasValue,
            MasterAbilityType.RerollFailure => RerollPeriod.HasValue,
            MasterAbilityType.SpecialAction => !string.IsNullOrWhiteSpace(SpecialEffect),
            _ => false
        };
    }

    /// <summary>
    /// Returns a human-readable description of the effect.
    /// </summary>
    public string ToDisplayString()
    {
        if (AutoSucceedDc.HasValue)
            return $"Auto-succeed DC ≤ {AutoSucceedDc}";
        if (DiceBonus.HasValue)
            return $"+{DiceBonus}d10 bonus";
        if (DamageThreshold.HasValue)
            return ReductionAmount.HasValue
                ? $"Reduce damage ≤ {DamageThreshold} by {ReductionAmount}"
                : $"Negate damage ≤ {DamageThreshold}";
        if (DistanceBonus.HasValue)
            return $"+{DistanceBonus} distance/time";
        if (RerollPeriod.HasValue)
            return $"Re-roll once per {RerollPeriod}";
        if (!string.IsNullOrWhiteSpace(SpecialEffect))
            return SpecialEffect;

        return "No effect";
    }
}
```

---

## 7. IMasterAbilityProvider Interface

### 7.1 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/IMasterAbilityProvider.cs`

```csharp
using RuneAndRust.Domain.Entities;

namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Provides access to master ability definitions loaded from configuration.
/// </summary>
/// <remarks>
/// <para>
/// The provider loads master ability definitions from <c>master-abilities.json</c>
/// and caches them for efficient lookup. Abilities are keyed by their ID and
/// indexed by skill ID for fast retrieval.
/// </para>
/// <para>
/// This interface is implemented by <see cref="MasterAbilityProvider"/> in the
/// Infrastructure layer.
/// </para>
/// </remarks>
public interface IMasterAbilityProvider
{
    /// <summary>
    /// Gets all defined master abilities.
    /// </summary>
    /// <returns>A read-only collection of all master abilities.</returns>
    IReadOnlyList<MasterAbility> GetAllAbilities();

    /// <summary>
    /// Gets a master ability by its unique identifier.
    /// </summary>
    /// <param name="abilityId">The ability ID (e.g., "spider-climb").</param>
    /// <returns>The ability if found; otherwise <c>null</c>.</returns>
    MasterAbility? GetAbilityById(string abilityId);

    /// <summary>
    /// Gets all master abilities for a specific skill.
    /// </summary>
    /// <param name="skillId">The skill ID (e.g., "acrobatics").</param>
    /// <returns>
    /// A collection of all master abilities associated with the skill.
    /// Returns an empty collection if no abilities exist for the skill.
    /// </returns>
    IReadOnlyList<MasterAbility> GetAbilitiesForSkill(string skillId);

    /// <summary>
    /// Gets master abilities for a skill filtered by subtype.
    /// </summary>
    /// <param name="skillId">The skill ID (e.g., "acrobatics").</param>
    /// <param name="subType">The check subtype (e.g., "climbing", "stealth").</param>
    /// <returns>
    /// Abilities that apply to the given skill and subtype.
    /// Includes abilities with no subtype restrictions.
    /// </returns>
    IReadOnlyList<MasterAbility> GetAbilitiesForSkillAndSubType(string skillId, string? subType);

    /// <summary>
    /// Checks if a skill has any master abilities defined.
    /// </summary>
    /// <param name="skillId">The skill ID to check.</param>
    /// <returns><c>true</c> if the skill has master abilities; otherwise <c>false</c>.</returns>
    bool HasAbilitiesForSkill(string skillId);
}
```

---

## 8. MasterAbilityProvider Implementation

### 8.1 Provider Implementation

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Providers/MasterAbilityProvider.cs`

```csharp
using System.Text.Json;
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Infrastructure.Providers;

/// <summary>
/// Provides master ability definitions loaded from JSON configuration.
/// </summary>
/// <remarks>
/// <para>
/// Loads abilities from <c>Configuration/master-abilities.json</c> at construction
/// and caches them for the lifetime of the application. The provider validates
/// abilities against the JSON schema during loading.
/// </para>
/// <para>
/// Abilities are indexed by ID and skill ID for O(1) lookup performance.
/// </para>
/// </remarks>
public sealed class MasterAbilityProvider : IMasterAbilityProvider
{
    private readonly ILogger<MasterAbilityProvider> _logger;
    private readonly Dictionary<string, MasterAbility> _abilitiesById;
    private readonly Dictionary<string, List<MasterAbility>> _abilitiesBySkill;
    private readonly List<MasterAbility> _allAbilities;

    /// <summary>
    /// Creates a new master ability provider.
    /// </summary>
    /// <param name="logger">Logger for diagnostic output.</param>
    public MasterAbilityProvider(ILogger<MasterAbilityProvider> logger)
    {
        _logger = logger;
        _abilitiesById = new Dictionary<string, MasterAbility>(StringComparer.OrdinalIgnoreCase);
        _abilitiesBySkill = new Dictionary<string, List<MasterAbility>>(StringComparer.OrdinalIgnoreCase);
        _allAbilities = new List<MasterAbility>();

        LoadAbilities();
    }

    /// <inheritdoc />
    public IReadOnlyList<MasterAbility> GetAllAbilities() => _allAbilities.AsReadOnly();

    /// <inheritdoc />
    public MasterAbility? GetAbilityById(string abilityId)
    {
        if (string.IsNullOrWhiteSpace(abilityId))
            return null;

        return _abilitiesById.TryGetValue(abilityId, out var ability) ? ability : null;
    }

    /// <inheritdoc />
    public IReadOnlyList<MasterAbility> GetAbilitiesForSkill(string skillId)
    {
        if (string.IsNullOrWhiteSpace(skillId))
            return Array.Empty<MasterAbility>();

        return _abilitiesBySkill.TryGetValue(skillId, out var abilities)
            ? abilities.AsReadOnly()
            : Array.Empty<MasterAbility>();
    }

    /// <inheritdoc />
    public IReadOnlyList<MasterAbility> GetAbilitiesForSkillAndSubType(string skillId, string? subType)
    {
        var skillAbilities = GetAbilitiesForSkill(skillId);
        if (skillAbilities.Count == 0)
            return skillAbilities;

        return skillAbilities
            .Where(a => a.AppliesToSubType(subType))
            .ToList()
            .AsReadOnly();
    }

    /// <inheritdoc />
    public bool HasAbilitiesForSkill(string skillId)
    {
        if (string.IsNullOrWhiteSpace(skillId))
            return false;

        return _abilitiesBySkill.ContainsKey(skillId);
    }

    private void LoadAbilities()
    {
        const string configPath = "Configuration/master-abilities.json";

        try
        {
            if (!File.Exists(configPath))
            {
                _logger.LogWarning("Master abilities configuration not found at {Path}", configPath);
                return;
            }

            var json = File.ReadAllText(configPath);
            var config = JsonSerializer.Deserialize<MasterAbilitiesConfig>(json, new JsonSerializerOptions
            {
                PropertyNameCaseInsensitive = true
            });

            if (config?.MasterAbilities == null)
            {
                _logger.LogWarning("No master abilities found in configuration");
                return;
            }

            foreach (var dto in config.MasterAbilities)
            {
                try
                {
                    var ability = CreateAbilityFromDto(dto);

                    _abilitiesById[ability.AbilityId] = ability;
                    _allAbilities.Add(ability);

                    if (!_abilitiesBySkill.TryGetValue(ability.SkillId, out var skillList))
                    {
                        skillList = new List<MasterAbility>();
                        _abilitiesBySkill[ability.SkillId] = skillList;
                    }
                    skillList.Add(ability);
                }
                catch (Exception ex)
                {
                    _logger.LogError(ex, "Failed to load master ability: {AbilityId}", dto.Id);
                }
            }

            _logger.LogInformation(
                "Loaded {Count} master abilities for {SkillCount} skills",
                _allAbilities.Count,
                _abilitiesBySkill.Count);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to load master abilities configuration");
        }
    }

    private static MasterAbility CreateAbilityFromDto(MasterAbilityDto dto)
    {
        var abilityType = Enum.Parse<MasterAbilityType>(dto.AbilityType, ignoreCase: true);
        var effect = CreateEffectFromDto(dto, abilityType);

        return MasterAbility.Create(
            abilityId: dto.Id,
            skillId: dto.SkillId,
            name: dto.Name,
            description: dto.Description,
            abilityType: abilityType,
            effect: effect,
            subTypes: dto.SubTypes,
            isPassive: dto.IsPassive,
            triggerMessage: dto.TriggerMessage);
    }

    private static MasterAbilityEffect CreateEffectFromDto(MasterAbilityDto dto, MasterAbilityType abilityType)
    {
        return abilityType switch
        {
            MasterAbilityType.AutoSucceed =>
                MasterAbilityEffect.ForAutoSucceed(dto.AutoSucceedDc ?? 10),

            MasterAbilityType.DiceBonus =>
                MasterAbilityEffect.ForDiceBonus(dto.DiceBonus ?? 0),

            MasterAbilityType.DamageReduction =>
                MasterAbilityEffect.ForDamageReduction(
                    dto.DamageThreshold ?? 0,
                    dto.ReductionAmount),

            MasterAbilityType.DistanceBonus =>
                MasterAbilityEffect.ForDistanceBonus(dto.DistanceBonus ?? 0),

            MasterAbilityType.RerollFailure =>
                MasterAbilityEffect.ForRerollFailure(
                    Enum.Parse<RerollPeriod>(dto.RerollPeriod ?? "Scene", ignoreCase: true)),

            MasterAbilityType.SpecialAction =>
                MasterAbilityEffect.ForSpecialAction(dto.SpecialEffect ?? string.Empty),

            _ => MasterAbilityEffect.Empty
        };
    }

    // Configuration DTOs for JSON deserialization
    private sealed class MasterAbilitiesConfig
    {
        public List<MasterAbilityDto>? MasterAbilities { get; set; }
    }

    private sealed class MasterAbilityDto
    {
        public string Id { get; set; } = string.Empty;
        public string SkillId { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public string AbilityType { get; set; } = string.Empty;
        public List<string>? SubTypes { get; set; }
        public bool IsPassive { get; set; } = true;
        public string? TriggerMessage { get; set; }

        // Type-specific parameters
        public int? AutoSucceedDc { get; set; }
        public int? DiceBonus { get; set; }
        public int? DamageThreshold { get; set; }
        public int? ReductionAmount { get; set; }
        public int? DistanceBonus { get; set; }
        public string? RerollPeriod { get; set; }
        public string? SpecialEffect { get; set; }
    }
}
```

---

## 9. IMasterAbilityService Interface

### 9.1 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/IMasterAbilityService.cs`

```csharp
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Service for evaluating and applying master abilities during skill checks.
/// </summary>
/// <remarks>
/// <para>
/// This service is called by <see cref="SkillCheckService"/> before performing
/// a skill check to determine if any master abilities apply. The service handles:
/// </para>
/// <list type="bullet">
///   <item><description>Checking if the character has Rank 5 proficiency</description></item>
///   <item><description>Finding applicable abilities for the skill and subtype</description></item>
///   <item><description>Evaluating auto-succeed conditions</description></item>
///   <item><description>Applying dice bonuses to the skill context</description></item>
///   <item><description>Tracking re-roll usage</description></item>
/// </list>
/// </remarks>
public interface IMasterAbilityService
{
    /// <summary>
    /// Evaluates master abilities for a skill check and returns the evaluation result.
    /// </summary>
    /// <param name="player">The player making the check.</param>
    /// <param name="skillId">The skill being checked.</param>
    /// <param name="subType">Optional skill subtype (e.g., "climbing", "stealth").</param>
    /// <param name="difficultyClass">The check's difficulty class.</param>
    /// <returns>
    /// A result indicating whether auto-succeed triggers, dice bonuses to apply,
    /// and any special effects that are active.
    /// </returns>
    MasterAbilityEvaluationResult EvaluateForCheck(
        Player player,
        string skillId,
        string? subType,
        int difficultyClass);

    /// <summary>
    /// Gets all applicable master abilities for a character's skill check.
    /// </summary>
    /// <param name="player">The player making the check.</param>
    /// <param name="skillId">The skill being checked.</param>
    /// <param name="subType">Optional skill subtype.</param>
    /// <returns>
    /// Abilities that apply if the character has Rank 5 proficiency.
    /// Returns empty if character is not master rank.
    /// </returns>
    IReadOnlyList<MasterAbility> GetApplicableAbilities(
        Player player,
        string skillId,
        string? subType);

    /// <summary>
    /// Checks if a character can use a re-roll ability.
    /// </summary>
    /// <param name="player">The player.</param>
    /// <param name="abilityId">The re-roll ability ID.</param>
    /// <returns><c>true</c> if the re-roll is available; otherwise <c>false</c>.</returns>
    bool CanUseReroll(Player player, string abilityId);

    /// <summary>
    /// Marks a re-roll ability as used for the current period.
    /// </summary>
    /// <param name="player">The player using the re-roll.</param>
    /// <param name="abilityId">The re-roll ability ID.</param>
    void UseReroll(Player player, string abilityId);

    /// <summary>
    /// Resets re-roll usage for abilities with the specified period.
    /// </summary>
    /// <param name="player">The player.</param>
    /// <param name="period">The period that has elapsed (e.g., Conversation, Scene).</param>
    void ResetRerollsForPeriod(Player player, RerollPeriod period);
}
```

### 9.2 MasterAbilityEvaluationResult Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/MasterAbilityEvaluationResult.cs`

```csharp
using RuneAndRust.Domain.Entities;

namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Result of evaluating master abilities for a skill check.
/// </summary>
/// <remarks>
/// <para>
/// This result tells <see cref="SkillCheckService"/> how master abilities affect
/// the check:
/// </para>
/// <list type="bullet">
///   <item><description>If <see cref="ShouldAutoSucceed"/> is true, skip the roll</description></item>
///   <item><description>Otherwise, apply <see cref="TotalDiceBonus"/> to the pool</description></item>
///   <item><description><see cref="ActiveSpecialEffects"/> are passed to skill subsystems</description></item>
/// </list>
/// </remarks>
/// <param name="ShouldAutoSucceed">Whether the check auto-succeeds without rolling.</param>
/// <param name="AutoSucceedAbility">The ability that triggered auto-succeed, if any.</param>
/// <param name="TotalDiceBonus">Sum of dice bonuses from applicable abilities.</param>
/// <param name="DiceBonusAbilities">Abilities contributing dice bonuses.</param>
/// <param name="ActiveSpecialEffects">Special effect strings for skill subsystem handling.</param>
/// <param name="CanReroll">Whether a re-roll ability is available if the check fails.</param>
/// <param name="RerollAbilityId">The ID of the available re-roll ability, if any.</param>
public readonly record struct MasterAbilityEvaluationResult(
    bool ShouldAutoSucceed = false,
    MasterAbility? AutoSucceedAbility = null,
    int TotalDiceBonus = 0,
    IReadOnlyList<MasterAbility>? DiceBonusAbilities = null,
    IReadOnlyList<string>? ActiveSpecialEffects = null,
    bool CanReroll = false,
    string? RerollAbilityId = null)
{
    /// <summary>
    /// A result indicating no master abilities apply.
    /// </summary>
    public static MasterAbilityEvaluationResult None => new();

    /// <summary>
    /// Creates a result indicating the check auto-succeeds.
    /// </summary>
    /// <param name="ability">The ability triggering auto-succeed.</param>
    /// <returns>An auto-succeed evaluation result.</returns>
    public static MasterAbilityEvaluationResult ForAutoSucceed(MasterAbility ability)
        => new(
            ShouldAutoSucceed: true,
            AutoSucceedAbility: ability);

    /// <summary>
    /// Whether any master abilities affect this check.
    /// </summary>
    public bool HasActiveAbilities =>
        ShouldAutoSucceed || TotalDiceBonus > 0 ||
        (ActiveSpecialEffects?.Count ?? 0) > 0 || CanReroll;

    /// <summary>
    /// Gets the trigger message for auto-succeed, if applicable.
    /// </summary>
    public string? AutoSucceedMessage =>
        ShouldAutoSucceed ? AutoSucceedAbility?.TriggerMessage : null;

    /// <summary>
    /// Gets all abilities that contributed to this evaluation.
    /// </summary>
    public IEnumerable<MasterAbility> AllContributingAbilities
    {
        get
        {
            if (AutoSucceedAbility != null)
                yield return AutoSucceedAbility;

            if (DiceBonusAbilities != null)
            {
                foreach (var ability in DiceBonusAbilities)
                    yield return ability;
            }
        }
    }
}
```

---

## 10. MasterAbilityService Implementation

### 10.1 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/MasterAbilityService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Evaluates and applies master abilities during skill checks.
/// </summary>
/// <remarks>
/// <para>
/// This service determines how master abilities affect skill checks. It is called
/// by <see cref="SkillCheckService"/> before rolling dice to check for auto-succeed
/// conditions and apply dice bonuses.
/// </para>
/// <para>
/// Re-roll usage is tracked in memory per player and reset when the appropriate
/// period elapses (conversation end, scene change, etc.).
/// </para>
/// </remarks>
public sealed class MasterAbilityService : IMasterAbilityService
{
    private readonly IMasterAbilityProvider _provider;
    private readonly ILogger<MasterAbilityService> _logger;

    // Track re-roll usage: PlayerId -> AbilityId -> LastUsedAt
    private readonly Dictionary<string, Dictionary<string, DateTime>> _rerollUsage = new();

    /// <summary>
    /// Creates a new master ability service.
    /// </summary>
    /// <param name="provider">Provider for ability definitions.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public MasterAbilityService(
        IMasterAbilityProvider provider,
        ILogger<MasterAbilityService> logger)
    {
        _provider = provider;
        _logger = logger;
    }

    /// <inheritdoc />
    public MasterAbilityEvaluationResult EvaluateForCheck(
        Player player,
        string skillId,
        string? subType,
        int difficultyClass)
    {
        // Get applicable abilities (checks Rank 5 requirement)
        var abilities = GetApplicableAbilities(player, skillId, subType);

        if (abilities.Count == 0)
        {
            _logger.LogDebug(
                "No master abilities apply for {SkillId}/{SubType}",
                skillId, subType ?? "general");
            return MasterAbilityEvaluationResult.None;
        }

        // Check for auto-succeed (highest DC threshold wins)
        var autoSucceedAbility = abilities
            .Where(a => a.WouldAutoSucceed(difficultyClass))
            .OrderByDescending(a => a.Effect.AutoSucceedDc)
            .FirstOrDefault();

        if (autoSucceedAbility != null)
        {
            _logger.LogInformation(
                "Master ability {AbilityId} auto-succeeds DC {DC} check for {SkillId}",
                autoSucceedAbility.AbilityId, difficultyClass, skillId);

            return MasterAbilityEvaluationResult.ForAutoSucceed(autoSucceedAbility);
        }

        // Gather dice bonuses
        var diceBonusAbilities = abilities
            .Where(a => a.AbilityType == MasterAbilityType.DiceBonus)
            .ToList();

        var totalDiceBonus = diceBonusAbilities.Sum(a => a.GetDiceBonus());

        // Gather special effects
        var specialEffects = abilities
            .Where(a => a.AbilityType == MasterAbilityType.SpecialAction)
            .Select(a => a.Effect.SpecialEffect!)
            .Where(e => !string.IsNullOrWhiteSpace(e))
            .ToList();

        // Check for available re-roll
        var rerollAbility = abilities
            .FirstOrDefault(a =>
                a.AbilityType == MasterAbilityType.RerollFailure &&
                CanUseReroll(player, a.AbilityId));

        if (totalDiceBonus > 0)
        {
            _logger.LogDebug(
                "Master abilities provide +{Bonus}d10 for {SkillId}/{SubType}",
                totalDiceBonus, skillId, subType ?? "general");
        }

        return new MasterAbilityEvaluationResult(
            ShouldAutoSucceed: false,
            AutoSucceedAbility: null,
            TotalDiceBonus: totalDiceBonus,
            DiceBonusAbilities: diceBonusAbilities.AsReadOnly(),
            ActiveSpecialEffects: specialEffects.AsReadOnly(),
            CanReroll: rerollAbility != null,
            RerollAbilityId: rerollAbility?.AbilityId);
    }

    /// <inheritdoc />
    public IReadOnlyList<MasterAbility> GetApplicableAbilities(
        Player player,
        string skillId,
        string? subType)
    {
        // Check if player has Rank 5 proficiency
        var proficiency = player.GetSkillProficiency(skillId);
        if (proficiency != ProficiencyLevel.Master)
        {
            return Array.Empty<MasterAbility>();
        }

        // Get abilities for skill and subtype
        return _provider.GetAbilitiesForSkillAndSubType(skillId, subType);
    }

    /// <inheritdoc />
    public bool CanUseReroll(Player player, string abilityId)
    {
        if (!_rerollUsage.TryGetValue(player.Id, out var playerUsage))
            return true;

        if (!playerUsage.TryGetValue(abilityId, out var lastUsed))
            return true;

        // Get the ability to check its period
        var ability = _provider.GetAbilityById(abilityId);
        if (ability == null || ability.Effect.RerollPeriod == null)
            return false;

        // For now, we track usage but actual period reset is handled by
        // ResetRerollsForPeriod when game events occur
        return false; // Used this period
    }

    /// <inheritdoc />
    public void UseReroll(Player player, string abilityId)
    {
        if (!_rerollUsage.TryGetValue(player.Id, out var playerUsage))
        {
            playerUsage = new Dictionary<string, DateTime>(StringComparer.OrdinalIgnoreCase);
            _rerollUsage[player.Id] = playerUsage;
        }

        playerUsage[abilityId] = DateTime.UtcNow;

        _logger.LogInformation(
            "Player {PlayerId} used re-roll ability {AbilityId}",
            player.Id, abilityId);
    }

    /// <inheritdoc />
    public void ResetRerollsForPeriod(Player player, RerollPeriod period)
    {
        if (!_rerollUsage.TryGetValue(player.Id, out var playerUsage))
            return;

        var abilitiesToReset = _provider.GetAllAbilities()
            .Where(a =>
                a.AbilityType == MasterAbilityType.RerollFailure &&
                a.Effect.RerollPeriod == period)
            .Select(a => a.AbilityId)
            .ToList();

        foreach (var abilityId in abilitiesToReset)
        {
            if (playerUsage.Remove(abilityId))
            {
                _logger.LogDebug(
                    "Reset re-roll ability {AbilityId} for player {PlayerId} (period: {Period})",
                    abilityId, player.Id, period);
            }
        }
    }
}
```

---

## 11. SkillCheckService Integration

### 11.1 Modified SkillCheckService

The `SkillCheckService` is modified to call `MasterAbilityService` before performing checks.

**File:** `src/Core/RuneAndRust.Application/Services/SkillCheckService.cs` (additions)

```csharp
// Add to constructor dependencies:
private readonly IMasterAbilityService _masterAbilityService;

public SkillCheckService(
    // ... existing dependencies ...
    IMasterAbilityService masterAbilityService)
{
    // ... existing initialization ...
    _masterAbilityService = masterAbilityService;
}

// Modified PerformCheckWithDC method:
/// <summary>
/// Performs a skill check with master ability evaluation.
/// </summary>
/// <param name="player">The player making the check.</param>
/// <param name="skillId">The skill being checked.</param>
/// <param name="difficultyClass">The check's difficulty class.</param>
/// <param name="difficultyName">Display name for the difficulty.</param>
/// <param name="context">Skill context with modifiers.</param>
/// <param name="subType">Optional skill subtype for master ability filtering.</param>
/// <returns>The skill check result.</returns>
public SkillCheckResult PerformCheckWithDC(
    Player player,
    string skillId,
    int difficultyClass,
    string difficultyName = "Custom",
    SkillContext? context = null,
    string? subType = null)
{
    // STEP 1: Evaluate master abilities
    var masterEvaluation = _masterAbilityService.EvaluateForCheck(
        player, skillId, subType, difficultyClass);

    // STEP 2: Check for auto-succeed
    if (masterEvaluation.ShouldAutoSucceed)
    {
        _logger.LogInformation(
            "Master ability {AbilityId} auto-succeeds {SkillId} DC {DC}",
            masterEvaluation.AutoSucceedAbility?.AbilityId,
            skillId,
            difficultyClass);

        return CreateAutoSucceedResult(
            player, skillId, difficultyClass, difficultyName,
            masterEvaluation);
    }

    // STEP 3: Apply master ability dice bonuses to context
    var effectiveContext = context ?? SkillContext.Empty;
    if (masterEvaluation.TotalDiceBonus > 0)
    {
        effectiveContext = effectiveContext.WithMasterAbilityBonus(
            masterEvaluation.TotalDiceBonus,
            masterEvaluation.DiceBonusAbilities);
    }

    // STEP 4: Proceed with normal check
    var result = PerformCheckInternal(
        player, skillId, difficultyClass, difficultyName, effectiveContext);

    // STEP 5: Attach master ability metadata to result
    return result with
    {
        AppliedMasterAbilities = masterEvaluation.AllContributingAbilities.ToList(),
        CanReroll = masterEvaluation.CanReroll,
        RerollAbilityId = masterEvaluation.RerollAbilityId,
        ActiveSpecialEffects = masterEvaluation.ActiveSpecialEffects
    };
}

private SkillCheckResult CreateAutoSucceedResult(
    Player player,
    string skillId,
    int difficultyClass,
    string difficultyName,
    MasterAbilityEvaluationResult masterEvaluation)
{
    var ability = masterEvaluation.AutoSucceedAbility!;

    return new SkillCheckResult(
        SkillId: skillId,
        Outcome: SkillOutcome.FullSuccess,
        DifficultyClass: difficultyClass,
        DifficultyName: difficultyName,
        NetSuccesses: difficultyClass, // Exactly met DC
        WasAutoSucceed: true,
        AppliedMasterAbilities: new[] { ability },
        AutoSucceedMessage: ability.TriggerMessage,
        // No dice result - auto-succeed skips rolling
        DiceResult: null);
}
```

### 11.2 SkillCheckResult Modifications

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SkillCheckResult.cs` (additions)

```csharp
// Add to SkillCheckResult record:

/// <summary>
/// Whether the check auto-succeeded due to a master ability.
/// </summary>
public bool WasAutoSucceed { get; init; } = false;

/// <summary>
/// Master abilities that were applied to this check.
/// </summary>
public IReadOnlyList<MasterAbility> AppliedMasterAbilities { get; init; } =
    Array.Empty<MasterAbility>();

/// <summary>
/// Message from the auto-succeed ability, if applicable.
/// </summary>
public string? AutoSucceedMessage { get; init; }

/// <summary>
/// Whether a re-roll is available for this failed check.
/// </summary>
public bool CanReroll { get; init; } = false;

/// <summary>
/// The ID of the available re-roll ability, if any.
/// </summary>
public string? RerollAbilityId { get; init; }

/// <summary>
/// Active special effects from master abilities.
/// </summary>
public IReadOnlyList<string>? ActiveSpecialEffects { get; init; }
```

---

## 12. Data Model Changes

### 12.1 Summary of Changes

| Entity/Type | Change Type | Description |
|-------------|-------------|-------------|
| `MasterAbilityType` | **NEW** | Enum for ability classification |
| `RerollPeriod` | **NEW** | Enum for re-roll timing |
| `MasterAbility` | **NEW** | Entity for ability definitions |
| `MasterAbilityEffect` | **NEW** | Value object for effect parameters |
| `MasterAbilityEvaluationResult` | **NEW** | Value object for evaluation results |
| `SkillCheckResult` | **MODIFIED** | Added master ability metadata properties |
| `SkillContext` | **MODIFIED** | Added `WithMasterAbilityBonus` method |

### 12.2 SkillContext Modification

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SkillContext.cs` (addition)

```csharp
/// <summary>
/// Creates a new context with master ability dice bonuses applied.
/// </summary>
/// <param name="diceBonus">The bonus dice from master abilities.</param>
/// <param name="abilities">The abilities providing the bonus.</param>
/// <returns>A new context with the master ability modifier added.</returns>
public SkillContext WithMasterAbilityBonus(
    int diceBonus,
    IReadOnlyList<MasterAbility>? abilities)
{
    if (diceBonus == 0)
        return this;

    var description = abilities?.Count > 0
        ? string.Join(", ", abilities.Select(a => a.Name))
        : "Master Ability";

    var modifier = new SituationalModifier(
        ModifierId: "master-ability-bonus",
        DiceModifier: diceBonus,
        DcModifier: 0,
        Source: description,
        Duration: ModifierDuration.Instant);

    return this with
    {
        SituationalModifiers = SituationalModifiers.Append(modifier).ToList()
    };
}
```

---

## 13. Configuration

### 13.1 master-abilities.json

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/master-abilities.json`

```json
{
  "$schema": "./Schemas/master-abilities.schema.json",
  "masterAbilities": [
    {
      "id": "spider-climb",
      "skillId": "acrobatics",
      "name": "Spider Climb",
      "description": "Your mastery of climbing allows you to scale surfaces that would challenge lesser climbers. Automatically succeed on climbing checks with DC 12 or lower, moving at full speed.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 12,
      "subTypes": ["climbing"],
      "isPassive": true,
      "triggerMessage": "Your mastery allows you to scale the surface effortlessly."
    },
    {
      "id": "cats-grace",
      "skillId": "acrobatics",
      "name": "Cat's Grace",
      "description": "You land with supernatural grace, absorbing impact that would injure others. Take no damage from falls of 30 feet or less.",
      "abilityType": "DamageReduction",
      "damageThreshold": 30,
      "reductionAmount": null,
      "subTypes": ["falling", "leaping"],
      "isPassive": true,
      "triggerMessage": "You land with cat-like grace, absorbing the impact."
    },
    {
      "id": "ghost-walk",
      "skillId": "acrobatics",
      "name": "Ghost Walk",
      "description": "You move with preternatural silence, your footsteps barely disturbing the air. Automatically succeed on stealth checks with DC 14 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 14,
      "subTypes": ["stealth"],
      "isPassive": true,
      "triggerMessage": "You move like a shadow, making no sound."
    },
    {
      "id": "death-defying-leap",
      "skillId": "acrobatics",
      "name": "Death-Defying Leap",
      "description": "Your leaping ability far exceeds normal limits. Add 10 feet to your maximum leap distance.",
      "abilityType": "DistanceBonus",
      "distanceBonus": 10,
      "subTypes": ["leaping"],
      "isPassive": true,
      "triggerMessage": "You launch yourself through the air with impossible distance."
    },
    {
      "id": "perfect-balance",
      "skillId": "acrobatics",
      "name": "Perfect Balance",
      "description": "Your sense of balance is impeccable. Automatically succeed on balance checks with DC 16 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 16,
      "subTypes": ["balance", "climbing"],
      "isPassive": true,
      "triggerMessage": "Your perfect balance keeps you steady."
    },
    {
      "id": "polyglot",
      "skillId": "rhetoric",
      "name": "Polyglot",
      "description": "Your linguistic mastery encompasses all common cants and dialects. Automatically succeed on language and cant checks with DC 14 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 14,
      "subTypes": ["language", "cant"],
      "isPassive": true,
      "triggerMessage": "The words come naturally, as if you've spoken this tongue your whole life."
    },
    {
      "id": "cultural-diplomat",
      "skillId": "rhetoric",
      "name": "Cultural Diplomat",
      "description": "You understand the subtle protocols of every culture. Automatically succeed on cultural protocol checks with DC 14 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 14,
      "subTypes": ["protocol", "etiquette"],
      "isPassive": true,
      "triggerMessage": "You navigate the cultural expectations with practiced ease."
    },
    {
      "id": "master-negotiator",
      "skillId": "rhetoric",
      "name": "Master Negotiator",
      "description": "Your negotiation skills allow you to recover from setbacks. Once per conversation, you may re-roll a failed negotiation check.",
      "abilityType": "RerollFailure",
      "rerollPeriod": "Conversation",
      "subTypes": ["negotiation", "bargaining"],
      "isPassive": true,
      "triggerMessage": "You adjust your approach, finding a new angle."
    },
    {
      "id": "silver-tongue",
      "skillId": "rhetoric",
      "name": "Silver Tongue",
      "description": "Your words carry an almost magical persuasiveness. Automatically succeed on persuasion checks with DC 12 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 12,
      "subTypes": ["persuasion"],
      "isPassive": true,
      "triggerMessage": "Your silver tongue works its magic."
    },
    {
      "id": "fearsome-reputation",
      "skillId": "rhetoric",
      "name": "Fearsome Reputation",
      "description": "Your reputation precedes you, making your threats all the more effective. Add +2d10 to all intimidation checks.",
      "abilityType": "DiceBonus",
      "diceBonus": 2,
      "subTypes": ["intimidation"],
      "isPassive": true,
      "triggerMessage": "Your fearsome reputation lends weight to your words."
    },
    {
      "id": "auto-bypass",
      "skillId": "system-bypass",
      "name": "Auto-Bypass",
      "description": "Simple locks and systems pose no challenge to your expertise. Automatically succeed on bypass checks with DC 10 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 10,
      "subTypes": ["lockpicking", "hacking"],
      "isPassive": true,
      "triggerMessage": "The mechanism yields instantly to your expert touch."
    },
    {
      "id": "salvage-expertise",
      "skillId": "system-bypass",
      "name": "Salvage Expertise",
      "description": "Your careful technique always preserves valuable components. You always recover trap components on successful disarmament.",
      "abilityType": "SpecialAction",
      "specialEffect": "AlwaysRecoverTrapComponents",
      "subTypes": ["traps", "disarmament"],
      "isPassive": true,
      "triggerMessage": "Your expert touch preserves the valuable components."
    },
    {
      "id": "silent-bypass",
      "skillId": "system-bypass",
      "name": "Silent Bypass",
      "description": "You work with absolute silence, never alerting guards or triggering audio sensors. Your successful bypass attempts generate no noise.",
      "abilityType": "SpecialAction",
      "specialEffect": "NoNoiseOnSuccess",
      "subTypes": ["lockpicking", "hacking", "traps"],
      "isPassive": true,
      "triggerMessage": "You work in perfect silence."
    },
    {
      "id": "glitch-reader",
      "skillId": "system-bypass",
      "name": "Glitch Reader",
      "description": "You've learned to read the patterns in corrupted systems. Reduce the DC penalty from [Glitched] status by 2.",
      "abilityType": "DiceBonus",
      "diceBonus": 2,
      "subTypes": ["glitched"],
      "isPassive": true,
      "triggerMessage": "You read the glitch patterns, finding the rhythm in the chaos."
    },
    {
      "id": "wasteland-cartographer",
      "skillId": "wasteland-survival",
      "name": "Wasteland Cartographer",
      "description": "You've mapped so much of the wasteland that finding your way is second nature. Automatically succeed on navigation checks with DC 10 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 10,
      "subTypes": ["navigation"],
      "isPassive": true,
      "triggerMessage": "Your mental map guides you unerringly."
    },
    {
      "id": "apex-scavenger",
      "skillId": "wasteland-survival",
      "name": "Apex Scavenger",
      "description": "You find resources where others see only waste. You never return empty-handed from foraging, and all yields are increased by 50%.",
      "abilityType": "SpecialAction",
      "specialEffect": "NeverEmptyForaging,YieldBonus50",
      "subTypes": ["foraging", "scavenging"],
      "isPassive": true,
      "triggerMessage": "Your expert eye spots resources others would miss."
    },
    {
      "id": "master-tracker",
      "skillId": "wasteland-survival",
      "name": "Master Tracker",
      "description": "Your tracking skills border on the supernatural. You can follow trails up to 48 hours old, double the normal limit.",
      "abilityType": "DistanceBonus",
      "distanceBonus": 24,
      "subTypes": ["tracking"],
      "isPassive": true,
      "triggerMessage": "Even the faintest signs tell you a story."
    },
    {
      "id": "hazard-sense",
      "skillId": "wasteland-survival",
      "name": "Hazard Sense",
      "description": "Your instincts for danger have been honed to perfection. Automatically succeed on hazard detection checks with DC 16 or lower.",
      "abilityType": "AutoSucceed",
      "autoSucceedDc": 16,
      "subTypes": ["hazard-detection"],
      "isPassive": true,
      "triggerMessage": "Your instincts scream a warning."
    }
  ]
}
```

---

## 14. JSON Schema

### 14.1 master-abilities.schema.json

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/Schemas/master-abilities.schema.json`

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "master-abilities.schema.json",
  "title": "Master Abilities Configuration",
  "description": "Schema for master ability definitions in the skill system.",
  "type": "object",
  "required": ["masterAbilities"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this schema file."
    },
    "masterAbilities": {
      "type": "array",
      "description": "Collection of master ability definitions.",
      "items": {
        "$ref": "#/$defs/masterAbility"
      },
      "minItems": 1
    }
  },
  "$defs": {
    "masterAbility": {
      "type": "object",
      "description": "A master-rank (Rank 5) ability definition.",
      "required": ["id", "skillId", "name", "description", "abilityType"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this ability.",
          "pattern": "^[a-z][a-z0-9-]*$",
          "minLength": 1,
          "maxLength": 64,
          "examples": ["spider-climb", "fearsome-reputation"]
        },
        "skillId": {
          "type": "string",
          "description": "The skill this ability is associated with.",
          "enum": ["acrobatics", "rhetoric", "system-bypass", "wasteland-survival"],
          "examples": ["acrobatics"]
        },
        "name": {
          "type": "string",
          "description": "Display name of the ability.",
          "minLength": 1,
          "maxLength": 64,
          "examples": ["Spider Climb", "Fearsome Reputation"]
        },
        "description": {
          "type": "string",
          "description": "Full description of the ability's effect.",
          "minLength": 1,
          "maxLength": 500
        },
        "abilityType": {
          "type": "string",
          "description": "The type of effect this ability provides.",
          "enum": [
            "AutoSucceed",
            "DiceBonus",
            "DamageReduction",
            "DistanceBonus",
            "RerollFailure",
            "SpecialAction"
          ]
        },
        "subTypes": {
          "type": "array",
          "description": "Skill subtypes this ability applies to. Empty means all checks.",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "default": []
        },
        "isPassive": {
          "type": "boolean",
          "description": "Whether this ability is always active (true) or requires activation (false).",
          "default": true
        },
        "triggerMessage": {
          "type": "string",
          "description": "Flavor text displayed when the ability triggers.",
          "maxLength": 200
        },
        "autoSucceedDc": {
          "type": "integer",
          "description": "For AutoSucceed: Maximum DC that auto-succeeds.",
          "minimum": 1,
          "maximum": 30
        },
        "diceBonus": {
          "type": "integer",
          "description": "For DiceBonus: Number of bonus dice.",
          "minimum": 1,
          "maximum": 10
        },
        "damageThreshold": {
          "type": "integer",
          "description": "For DamageReduction: Maximum damage amount that can be reduced.",
          "minimum": 1,
          "maximum": 100
        },
        "reductionAmount": {
          "type": ["integer", "null"],
          "description": "For DamageReduction: Amount to reduce by, or null to negate entirely.",
          "minimum": 0,
          "maximum": 100
        },
        "distanceBonus": {
          "type": "integer",
          "description": "For DistanceBonus: Additional distance/time.",
          "minimum": 1,
          "maximum": 100
        },
        "rerollPeriod": {
          "type": "string",
          "description": "For RerollFailure: How often the re-roll refreshes.",
          "enum": ["Conversation", "Scene", "Day", "Rest"]
        },
        "specialEffect": {
          "type": "string",
          "description": "For SpecialAction: Effect description for skill subsystem parsing.",
          "minLength": 1,
          "maxLength": 100
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "abilityType": { "const": "AutoSucceed" } }
          },
          "then": {
            "required": ["autoSucceedDc"]
          }
        },
        {
          "if": {
            "properties": { "abilityType": { "const": "DiceBonus" } }
          },
          "then": {
            "required": ["diceBonus"]
          }
        },
        {
          "if": {
            "properties": { "abilityType": { "const": "DamageReduction" } }
          },
          "then": {
            "required": ["damageThreshold"]
          }
        },
        {
          "if": {
            "properties": { "abilityType": { "const": "DistanceBonus" } }
          },
          "then": {
            "required": ["distanceBonus"]
          }
        },
        {
          "if": {
            "properties": { "abilityType": { "const": "RerollFailure" } }
          },
          "then": {
            "required": ["rerollPeriod"]
          }
        },
        {
          "if": {
            "properties": { "abilityType": { "const": "SpecialAction" } }
          },
          "then": {
            "required": ["specialEffect"]
          }
        }
      ]
    }
  }
}
```

---

## 15. Commands

### 15.1 No New Commands

No new user commands are introduced in v0.15.1c. Master abilities are automatically evaluated during skill checks. Future versions may add commands for:

- Viewing active master abilities
- Invoking active (non-passive) abilities
- Checking re-roll availability

### 15.2 Internal Command Flow

The existing `check <skill>` command automatically invokes master ability evaluation:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    COMMAND FLOW: check acrobatics                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. User enters: check acrobatics climbing                                  │
│                                                                              │
│  2. CommandHandler parses command                                           │
│     └── SkillId: "acrobatics"                                               │
│     └── SubType: "climbing"                                                 │
│     └── DC: (determined by context)                                         │
│                                                                              │
│  3. SkillCheckService.PerformCheckWithDC()                                  │
│     │                                                                        │
│     ├── MasterAbilityService.EvaluateForCheck() ←── NEW STEP                │
│     │   ├── Check Rank 5 proficiency                                        │
│     │   ├── Get applicable abilities (Spider Climb, Perfect Balance)       │
│     │   └── Check auto-succeed (DC 10 ≤ Spider Climb threshold 12)         │
│     │                                                                        │
│     └── If auto-succeed: Return FullSuccess immediately                     │
│         Else: Apply dice bonuses and proceed with roll                      │
│                                                                              │
│  4. Result displayed to user with master ability attribution                │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 16. User-Facing Changes

### 16.1 Skill Check Display (Auto-Succeed)

When a master ability auto-succeeds a check:

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                            ACROBATICS CHECK                                    ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  Climbing the rusted scaffolding...                                          ║
║                                                                               ║
║  ┌───────────────────────────────────────────────────────────────────────┐   ║
║  │  ★ MASTER ABILITY: Spider Climb                                       │   ║
║  │                                                                       │   ║
║  │  Your mastery allows you to scale the surface effortlessly.          │   ║
║  │                                                                       │   ║
║  │  DC 10 ≤ Auto-Succeed Threshold 12                                   │   ║
║  └───────────────────────────────────────────────────────────────────────┘   ║
║                                                                               ║
║  Result: SUCCESS (Auto)                                                      ║
║                                                                               ║
║  You climb the scaffolding at full speed, finding handholds that others     ║
║  would never notice.                                                         ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

### 16.2 Skill Check Display (Dice Bonus)

When a master ability provides dice bonuses:

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                            RHETORIC CHECK                                      ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  Intimidating the guard...                                                   ║
║                                                                               ║
║  Base Pool: 4d10 (WILL 2 + Rhetoric Rank 2)                                 ║
║  ┌───────────────────────────────────────────────────────────────────────┐   ║
║  │  ★ Fearsome Reputation: +2d10                                         │   ║
║  └───────────────────────────────────────────────────────────────────────┘   ║
║  Final Pool: 6d10                                                            ║
║                                                                               ║
║  Roll: [10] [8] [9] [4] [2] [7]                                             ║
║  Successes: 3  |  Botches: 0  |  Net: 3                                     ║
║  DC: 2  |  Margin: +1                                                        ║
║                                                                               ║
║  Result: FULL SUCCESS                                                        ║
║                                                                               ║
║  The guard pales and steps aside. Your reputation precedes you.             ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

### 16.3 Character Sheet Display

Master abilities appear on the character sheet for Rank 5 skills:

```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                              SKILLS                                            ║
╠═══════════════════════════════════════════════════════════════════════════════╣
║                                                                               ║
║  Acrobatics     ████████████████████ MASTER (Rank 5)                         ║
║  ├── Spider Climb      : Auto-succeed climbing DC ≤ 12                       ║
║  ├── Cat's Grace       : No damage from falls ≤ 30ft                         ║
║  ├── Ghost Walk        : Auto-succeed stealth DC ≤ 14                        ║
║  ├── Death-Defying Leap: +10ft leap distance                                 ║
║  └── Perfect Balance   : Auto-succeed balance DC ≤ 16                        ║
║                                                                               ║
║  Rhetoric       ████████████░░░░░░░░ Adept (Rank 3)                          ║
║  └── (Master abilities unlock at Rank 5)                                     ║
║                                                                               ║
╚═══════════════════════════════════════════════════════════════════════════════╝
```

---

## 17. Logging Specifications

### 17.1 Log Events

| Event | Level | Template |
|-------|-------|----------|
| Abilities loaded | Information | `"Loaded {Count} master abilities for {SkillCount} skills"` |
| Auto-succeed triggered | Information | `"Master ability {AbilityId} auto-succeeds DC {DC} check for {SkillId}"` |
| Dice bonus applied | Debug | `"Master abilities provide +{Bonus}d10 for {SkillId}/{SubType}"` |
| No abilities apply | Debug | `"No master abilities apply for {SkillId}/{SubType}"` |
| Re-roll used | Information | `"Player {PlayerId} used re-roll ability {AbilityId}"` |
| Re-roll reset | Debug | `"Reset re-roll ability {AbilityId} for player {PlayerId} (period: {Period})"` |
| Ability load failed | Error | `"Failed to load master ability: {AbilityId}"` |
| Config load failed | Error | `"Failed to load master abilities configuration"` |

### 17.2 Example Log Output

```
[INF] Loaded 18 master abilities for 4 skills
[DBG] No master abilities apply for rhetoric/general (player not Rank 5)
[INF] Master ability spider-climb auto-succeeds DC 10 check for acrobatics
[DBG] Master abilities provide +2d10 for rhetoric/intimidation
[INF] Player player-1 used re-roll ability master-negotiator
[DBG] Reset re-roll ability master-negotiator for player player-1 (period: Conversation)
```

---

## 18. Unit Testing Requirements

### 18.1 Test Overview

Per the scope breakdown, ~3 unit tests are required. These tests validate the core functionality:

| Test ID | Test Name | Description |
|---------|-----------|-------------|
| MA-001 | AutoSucceed_BelowThreshold_ReturnsAutoSucceedResult | Auto-succeed abilities bypass checks correctly |
| MA-002 | DiceBonus_AddsToPool_Correctly | Dice bonus abilities add to pool correctly |
| MA-003 | OnlyRank5_HasMasterAbilities | Only Rank 5 characters have master abilities |

### 18.2 Test Specifications

**File:** `tests/RuneAndRust.Tests/Application/Services/MasterAbilityServiceTests.cs`

```csharp
using NUnit.Framework;
using Moq;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Application.Services;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Tests.Application.Services;

[TestFixture]
public class MasterAbilityServiceTests
{
    private Mock<IMasterAbilityProvider> _providerMock;
    private Mock<ILogger<MasterAbilityService>> _loggerMock;
    private MasterAbilityService _service;

    [SetUp]
    public void SetUp()
    {
        _providerMock = new Mock<IMasterAbilityProvider>();
        _loggerMock = new Mock<ILogger<MasterAbilityService>>();
        _service = new MasterAbilityService(_providerMock.Object, _loggerMock.Object);
    }

    /// <summary>
    /// MA-001: Verifies that auto-succeed abilities bypass checks when DC is at or below threshold.
    /// </summary>
    [Test]
    public void EvaluateForCheck_AutoSucceedBelowThreshold_ReturnsAutoSucceedResult()
    {
        // Arrange
        var player = CreateMasterRankPlayer("acrobatics");
        var spiderClimb = CreateAutoSucceedAbility("spider-climb", "acrobatics", 12);

        _providerMock
            .Setup(p => p.GetAbilitiesForSkillAndSubType("acrobatics", "climbing"))
            .Returns(new[] { spiderClimb });

        // Act
        var result = _service.EvaluateForCheck(player, "acrobatics", "climbing", difficultyClass: 10);

        // Assert
        Assert.That(result.ShouldAutoSucceed, Is.True);
        Assert.That(result.AutoSucceedAbility, Is.EqualTo(spiderClimb));
    }

    /// <summary>
    /// MA-002: Verifies that dice bonus abilities correctly add to the total bonus.
    /// </summary>
    [Test]
    public void EvaluateForCheck_DiceBonus_AddsToPoolCorrectly()
    {
        // Arrange
        var player = CreateMasterRankPlayer("rhetoric");
        var fearsomeRep = CreateDiceBonusAbility("fearsome-reputation", "rhetoric", 2);

        _providerMock
            .Setup(p => p.GetAbilitiesForSkillAndSubType("rhetoric", "intimidation"))
            .Returns(new[] { fearsomeRep });

        // Act
        var result = _service.EvaluateForCheck(player, "rhetoric", "intimidation", difficultyClass: 3);

        // Assert
        Assert.That(result.ShouldAutoSucceed, Is.False);
        Assert.That(result.TotalDiceBonus, Is.EqualTo(2));
        Assert.That(result.DiceBonusAbilities, Has.Count.EqualTo(1));
    }

    /// <summary>
    /// MA-003: Verifies that only Rank 5 characters receive master ability benefits.
    /// </summary>
    [Test]
    public void GetApplicableAbilities_NotRank5_ReturnsEmpty()
    {
        // Arrange
        var player = CreatePlayer("acrobatics", ProficiencyLevel.Adept); // Rank 3

        // Act
        var abilities = _service.GetApplicableAbilities(player, "acrobatics", "climbing");

        // Assert
        Assert.That(abilities, Is.Empty);
        _providerMock.Verify(
            p => p.GetAbilitiesForSkillAndSubType(It.IsAny<string>(), It.IsAny<string>()),
            Times.Never); // Provider should not even be called
    }

    // Helper methods
    private static Player CreateMasterRankPlayer(string skillId)
    {
        return CreatePlayer(skillId, ProficiencyLevel.Master);
    }

    private static Player CreatePlayer(string skillId, ProficiencyLevel level)
    {
        var player = new Mock<Player>();
        player.Setup(p => p.Id).Returns("test-player");
        player.Setup(p => p.GetSkillProficiency(skillId)).Returns(level);
        return player.Object;
    }

    private static MasterAbility CreateAutoSucceedAbility(string id, string skillId, int threshold)
    {
        return MasterAbility.Create(
            abilityId: id,
            skillId: skillId,
            name: "Test Auto-Succeed",
            description: "Test",
            abilityType: MasterAbilityType.AutoSucceed,
            effect: MasterAbilityEffect.ForAutoSucceed(threshold));
    }

    private static MasterAbility CreateDiceBonusAbility(string id, string skillId, int bonus)
    {
        return MasterAbility.Create(
            abilityId: id,
            skillId: skillId,
            name: "Test Dice Bonus",
            description: "Test",
            abilityType: MasterAbilityType.DiceBonus,
            effect: MasterAbilityEffect.ForDiceBonus(bonus));
    }
}
```

### 18.3 Additional Tests (Beyond Minimum)

For comprehensive coverage, consider these additional tests:

```csharp
[Test]
public void EvaluateForCheck_AutoSucceedAboveThreshold_DoesNotAutoSucceed()
{
    // DC 15 > Spider Climb threshold 12 → should not auto-succeed
}

[Test]
public void EvaluateForCheck_MultipleAbilities_StacksDiceBonuses()
{
    // Multiple dice bonus abilities should sum
}

[Test]
public void GetApplicableAbilities_SubTypeFiltering_ReturnsMatchingOnly()
{
    // Spider Climb (climbing) should not apply to stealth checks
}

[Test]
public void CanUseReroll_FirstUse_ReturnsTrue()
{
    // Re-roll should be available on first use
}

[Test]
public void CanUseReroll_AlreadyUsed_ReturnsFalse()
{
    // Re-roll should not be available after use
}

[Test]
public void ResetRerollsForPeriod_ResetsCorrectAbilities()
{
    // Only abilities with matching period should reset
}
```

---

## 19. Use Cases

### 19.1 Use Case 1: Auto-Succeed Climbing Check

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  USE CASE: Auto-Succeed Climbing Check                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ACTOR: Player with Rank 5 Acrobatics                                       │
│                                                                              │
│  PRECONDITIONS:                                                             │
│  - Player has Master rank in Acrobatics                                     │
│  - Player has Spider Climb ability (auto-succeed DC ≤ 12)                   │
│  - Climbing check has DC 10                                                 │
│                                                                              │
│  FLOW:                                                                       │
│  1. Player initiates climbing action                                        │
│  2. System determines climbing DC is 10                                     │
│  3. MasterAbilityService evaluates Spider Climb                            │
│  4. DC 10 ≤ threshold 12 → auto-succeed triggered                          │
│  5. System returns FullSuccess without rolling                             │
│  6. Display shows "Your mastery allows you to scale the surface            │
│     effortlessly."                                                          │
│                                                                              │
│  POSTCONDITIONS:                                                            │
│  - Player successfully climbs without dice roll                             │
│  - Result marked as auto-succeed                                            │
│  - No fumble risk (no dice rolled)                                          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 19.2 Use Case 2: Dice Bonus Applied to Intimidation

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  USE CASE: Dice Bonus Applied to Intimidation                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ACTOR: Player with Rank 5 Rhetoric                                         │
│                                                                              │
│  PRECONDITIONS:                                                             │
│  - Player has Master rank in Rhetoric                                       │
│  - Player has Fearsome Reputation (+2d10 intimidation)                     │
│  - Intimidation check has DC 3                                              │
│                                                                              │
│  FLOW:                                                                       │
│  1. Player initiates intimidation attempt                                   │
│  2. System determines intimidation DC is 3                                  │
│  3. MasterAbilityService evaluates Fearsome Reputation                     │
│  4. No auto-succeed (type is DiceBonus, not AutoSucceed)                   │
│  5. +2d10 added to dice pool                                                │
│  6. Base 4d10 + 2d10 = 6d10 rolled                                          │
│  7. Normal check resolution with enhanced pool                              │
│                                                                              │
│  POSTCONDITIONS:                                                            │
│  - Dice pool enhanced by +2d10                                              │
│  - Result attributes Fearsome Reputation bonus                              │
│  - Higher success probability                                               │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 19.3 Use Case 3: Re-roll Failed Negotiation

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  USE CASE: Re-roll Failed Negotiation                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ACTOR: Player with Rank 5 Rhetoric                                         │
│                                                                              │
│  PRECONDITIONS:                                                             │
│  - Player has Master rank in Rhetoric                                       │
│  - Player has Master Negotiator (re-roll once per conversation)            │
│  - Re-roll not yet used this conversation                                   │
│                                                                              │
│  FLOW:                                                                       │
│  1. Player fails negotiation check                                          │
│  2. Result includes CanReroll: true, RerollAbilityId: "master-negotiator"  │
│  3. System prompts: "Use Master Negotiator to re-roll? (Y/N)"              │
│  4. Player chooses to re-roll                                               │
│  5. MasterAbilityService.UseReroll() marks ability as used                 │
│  6. New dice roll performed                                                 │
│  7. New result replaces failed result                                       │
│                                                                              │
│  POSTCONDITIONS:                                                            │
│  - Re-roll consumed for this conversation                                   │
│  - CanReroll false for subsequent checks in same conversation              │
│  - Refreshes when conversation ends                                         │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 19.4 Use Case 4: Special Action - Salvage Expertise

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  USE CASE: Special Action - Salvage Expertise                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ACTOR: Player with Rank 5 System Bypass                                    │
│                                                                              │
│  PRECONDITIONS:                                                             │
│  - Player has Master rank in System Bypass                                  │
│  - Player has Salvage Expertise (always recover trap components)           │
│  - Trap disarmament check in progress                                       │
│                                                                              │
│  FLOW:                                                                       │
│  1. Player successfully disarms trap                                        │
│  2. MasterAbilityService returns ActiveSpecialEffects:                     │
│     ["AlwaysRecoverTrapComponents"]                                         │
│  3. Trap subsystem (v0.15.4) checks special effects                        │
│  4. "AlwaysRecoverTrapComponents" triggers component recovery              │
│  5. Player receives trap components regardless of success margin           │
│                                                                              │
│  POSTCONDITIONS:                                                            │
│  - Trap components added to inventory                                       │
│  - Works even on marginal success (normally requires critical)             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 19.5 Use Case 5: Non-Master Rank - No Abilities

```
┌─────────────────────────────────────────────────────────────────────────────┐
│  USE CASE: Non-Master Rank - No Abilities                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ACTOR: Player with Rank 3 (Adept) Acrobatics                               │
│                                                                              │
│  PRECONDITIONS:                                                             │
│  - Player has Adept rank in Acrobatics (not Master)                        │
│  - Spider Climb ability exists for Acrobatics masters                      │
│  - Climbing check has DC 10                                                 │
│                                                                              │
│  FLOW:                                                                       │
│  1. Player initiates climbing action                                        │
│  2. System determines climbing DC is 10                                     │
│  3. MasterAbilityService checks proficiency                                │
│  4. Proficiency is Adept (Rank 3), not Master (Rank 5)                     │
│  5. GetApplicableAbilities returns empty                                   │
│  6. Evaluation returns MasterAbilityEvaluationResult.None                  │
│  7. Normal skill check proceeds without master ability benefits            │
│                                                                              │
│  POSTCONDITIONS:                                                            │
│  - No auto-succeed (would trigger at Master rank)                          │
│  - No dice bonuses                                                          │
│  - Standard skill check with normal dice pool                              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 20. Deliverable Checklist

### 20.1 Domain Layer

| File | Type | Status |
|------|------|--------|
| `Domain/Enums/MasterAbilityType.cs` | Enum | ☐ |
| `Domain/Enums/RerollPeriod.cs` | Enum | ☐ |
| `Domain/Entities/MasterAbility.cs` | Entity | ☐ |
| `Domain/ValueObjects/MasterAbilityEffect.cs` | Value Object | ☐ |
| `Domain/ValueObjects/MasterAbilityEvaluationResult.cs` | Value Object | ☐ |
| `Domain/ValueObjects/SkillCheckResult.cs` | Modified | ☐ |
| `Domain/ValueObjects/SkillContext.cs` | Modified | ☐ |

### 20.2 Application Layer

| File | Type | Status |
|------|------|--------|
| `Application/Interfaces/IMasterAbilityProvider.cs` | Interface | ☐ |
| `Application/Interfaces/IMasterAbilityService.cs` | Interface | ☐ |
| `Application/Services/MasterAbilityService.cs` | Service | ☐ |
| `Application/Services/SkillCheckService.cs` | Modified | ☐ |

### 20.3 Infrastructure Layer

| File | Type | Status |
|------|------|--------|
| `Infrastructure/Providers/MasterAbilityProvider.cs` | Provider | ☐ |
| `Infrastructure/Configuration/master-abilities.json` | Config | ☐ |
| `Infrastructure/Configuration/Schemas/master-abilities.schema.json` | Schema | ☐ |

### 20.4 Tests

| File | Type | Status |
|------|------|--------|
| `Tests/Application/Services/MasterAbilityServiceTests.cs` | Unit Tests | ☐ |
| `Tests/Infrastructure/Providers/MasterAbilityProviderTests.cs` | Unit Tests | ☐ |

### 20.5 Dependency Injection

| Registration | Status |
|--------------|--------|
| `IMasterAbilityProvider` → `MasterAbilityProvider` (Singleton) | ☐ |
| `IMasterAbilityService` → `MasterAbilityService` (Scoped) | ☐ |

---

## 21. Acceptance Criteria

### 21.1 Functional Criteria

| ID | Criterion | Status |
|----|-----------|--------|
| AC-001 | Auto-succeed abilities bypass checks when DC ≤ threshold | ☐ |
| AC-002 | Auto-succeed returns FullSuccess without dice roll | ☐ |
| AC-003 | Dice bonus abilities add to pool correctly | ☐ |
| AC-004 | Multiple dice bonuses stack | ☐ |
| AC-005 | Only Rank 5 characters receive master ability benefits | ☐ |
| AC-006 | Abilities filter by skill subtype correctly | ☐ |
| AC-007 | Re-roll abilities track usage per period | ☐ |
| AC-008 | Re-roll abilities reset when period elapses | ☐ |
| AC-009 | Special effects passed to skill subsystems | ☐ |
| AC-010 | Configuration loads 18 abilities from JSON | ☐ |

### 21.2 Quality Criteria

| ID | Criterion | Status |
|----|-----------|--------|
| QC-001 | All ~3 unit tests pass | ☐ |
| QC-002 | Build completes with 0 errors | ☐ |
| QC-003 | Build completes with 0 warnings | ☐ |
| QC-004 | JSON validates against schema | ☐ |
| QC-005 | Logging captures all key events | ☐ |
| QC-006 | XML documentation complete | ☐ |

### 21.3 Integration Criteria

| ID | Criterion | Status |
|----|-----------|--------|
| IC-001 | SkillCheckService calls MasterAbilityService | ☐ |
| IC-002 | SkillCheckResult includes master ability metadata | ☐ |
| IC-003 | SkillContext accepts master ability bonuses | ☐ |
| IC-004 | Provider loads at application startup | ☐ |

---

## 22. Future Considerations

### 22.1 Deferred to v0.15.1d-v0.15.1e

- **Active Ability Invocation**: Commands for invoking non-passive abilities
- **Cooperative Check Master Abilities**: How master abilities interact with party checks
- **Trauma Economy**: Stress effects on master abilities
- **Specialization Bonuses**: Archetype-specific master ability enhancements
- **Voice Guidance**: Narrative descriptor pools for master ability triggers

### 22.2 Deferred to v0.15.2-v0.15.5

- **Skill-Specific Implementations**: How each skill subsystem interprets special effects
- **Damage Reduction Integration**: Cat's Grace integration with fall damage system
- **Distance Bonus Integration**: Death-Defying Leap integration with jump mechanics
- **Tracking Time Limits**: Master Tracker integration with trail degradation

### 22.3 Future Enhancements

- **UI for Master Abilities**: Visual display of active abilities and cooldowns
- **Ability Unlocking**: Narrative events that unlock master abilities
- **Ability Variants**: Multiple master abilities that can be chosen (not all at once)
- **Cross-Skill Synergies**: Master abilities that affect multiple skills

---

## 23. Implementation Notes

### 23.1 Performance Considerations

1. **Provider Caching**: `MasterAbilityProvider` loads abilities once at startup and caches them. Dictionary lookups provide O(1) access.

2. **Lazy Evaluation**: Master abilities are only evaluated when a check is performed, not on every game tick.

3. **Re-roll Tracking**: In-memory dictionary per player. Consider persistence for long-running sessions.

### 23.2 Design Decisions

1. **Passive by Default**: All initial abilities are passive to avoid UI complexity. Active abilities can be added later.

2. **Subtype Filtering**: Abilities specify subtypes they apply to. Empty list means "all checks for this skill."

3. **Effect Parameters**: Single value object with optional fields rather than polymorphic types for simplicity.

4. **Auto-Succeed Outcome**: Returns `FullSuccess` (not `CriticalSuccess`) to be fair while still significant.

### 23.3 Edge Cases

1. **Multiple Auto-Succeed**: If multiple abilities could auto-succeed, use the one with highest threshold (most powerful).

2. **Subtype Overlap**: An ability can specify multiple subtypes. Spider Climb works for "climbing" and Perfect Balance for "climbing" and "balance".

3. **DC Exactly at Threshold**: DC equal to threshold triggers auto-succeed (DC ≤ threshold, not DC < threshold).

---

## 24. Document Metadata

| Attribute | Value |
|-----------|-------|
| **Document Version** | 1.0 |
| **Created** | 2026-01-17 |
| **Last Updated** | 2026-01-17 |
| **Author** | Claude |
| **Status** | Draft |
| **Review Status** | Pending |

### 24.1 Change History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-17 | Claude | Initial specification |

### 24.2 References

- [v0.15.1-scope-breakdown.md](v0.15.1-scope-breakdown.md) - Scope definitions
- [v0.15.x-overview.md](v0.15.x-overview.md) - Version overview
- [v0.15.1a-design-specification.md](v0.15.1a-design-specification.md) - Skill Context & Modifiers
- [v0.15.1b-design-specification.md](v0.15.1b-design-specification.md) - Outcome Classification
- [acrobatics.md](../../aethelgard/design/01-core/skills/acrobatics.md) - Acrobatics skill spec
- [rhetoric.md](../../aethelgard/design/01-core/skills/rhetoric.md) - Rhetoric skill spec
- [system-bypass.md](../../aethelgard/design/01-core/skills/system-bypass.md) - System Bypass skill spec
- [wasteland-survival.md](../../aethelgard/design/01-core/skills/wasteland-survival.md) - Wasteland Survival skill spec
