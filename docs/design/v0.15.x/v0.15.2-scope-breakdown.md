## v0.15.2 - Acrobatics Skill Expansion

**Focus:** Multi-stage climbing, leaping mechanics, stealth movement, fall damage, and chase sequences

**Source Specification:** [acrobatics.md](../../aethelgard/design/01-core/skills/acrobatics.md)

### Overview

This version transforms Acrobatics from a simple skill check into a rich traversal system. Characters can climb multi-stage heights, leap across gaps with distance-based DCs, move stealthily through noisy terrain, and engage in cinematic chase sequences.

---

### Deliverables Summary

| Category | Items | Estimated Tests |
|----------|-------|-----------------|
| Enums | 4 | 4 |
| Value Objects | 6 | 10 |
| Entities | 2 | 6 |
| Services | 5 | 10 |
| **Total** | **17** | **~30** |

---

### v0.15.2a - Climbing System

#### ClimbingStage Value Object
**Purpose:** Represents one stage of a multi-stage climb

```
ClimbingStage
├── StageNumber: int
├── HeightReached: int (feet)
├── SurfaceType: SurfaceType enum
├── StageDc: int
├── StageResult: SkillOutcome?
└── FallHeight: int (if failed)
```

#### SurfaceType Enum
```
SurfaceType
├── Stable (+1d10)
├── Normal (+0)
├── Wet (-1d10)
├── Compromised (-2d10)
├── Collapsing (-3d10)
└── Glitched (+2 DC)
```

#### ClimbContext Value Object
- [ ] `TotalHeight` - Total height to climb (feet)
- [ ] `StagesRequired` - Calculated from height (10-20ft=1, 30-40ft=2, 50+ft=3)
- [ ] `SurfaceType` - Current surface classification
- [ ] `BaseDc` - DC based on surface type
- [ ] `EquipmentModifiers` - Climbing gear, grappling hook
- [ ] `ArmorPenalty` - Heavy armor penalty

#### ClimbState Entity
- [ ] `ClimbId` - Unique identifier
- [ ] `CharacterId` - Who is climbing
- [ ] `Context` - ClimbContext
- [ ] `CurrentStage` - Progress (0 = ground)
- [ ] `StageHistory` - List of completed stages
- [ ] `Status` - InProgress, Completed, Fallen

#### IClimbingService Interface
```csharp
public interface IClimbingService
{
    ClimbState StartClimb(string characterId, ClimbContext context);
    ClimbStageResult AttemptStage(string climbId, SkillContext? modifiers = null);
    FallResult ProcessFall(string climbId, int fromStage);
}
```

**Climbing Logic:**
- [ ] 10-20ft = 1 stage
- [ ] 30-40ft = 2 stages
- [ ] 50+ft = 3 stages
- [ ] Success = advance stage
- [ ] Failure = slip back one stage
- [ ] Fumble (0 successes + botch) = [The Slip] - fall from current height
- [ ] Critical Success (net ≥ 5) = advance 2 stages or reach top

**Equipment Modifiers:**
| Equipment | Modifier |
|-----------|----------|
| Climbing Gear | +1d10 |
| Grappling Hook | +2d10 (vertical surfaces) |
| Light/No Armor | +0 |
| Medium Armor | -1d10 |
| Heavy Armor | -4d10 |

**Unit Tests (~6):**
- [ ] Height correctly calculates stages required
- [ ] Surface type applies correct modifier
- [ ] Success advances to next stage
- [ ] Failure slips back one stage
- [ ] Fumble triggers fall from current height
- [ ] Critical success advances two stages

---

### v0.15.2b - Leaping System

#### LeapDistance Enum
```
LeapDistance
├── Short (5ft, DC 8)
├── Medium (10ft, DC 12)
├── Long (15ft, DC 16)
├── Extreme (20ft, DC 20)
└── Heroic (25ft, DC 24, Master only)
```

#### LeapContext Value Object
- [ ] `Distance` - Gap to cross (feet)
- [ ] `HasRunningStart` - +5ft effective or -2 DC
- [ ] `LandingType` - Normal, Precision (small target), Glitched
- [ ] `EncumbranceLevel` - Affects DC
- [ ] `GravityModifier` - [Low Gravity] zones

#### LeapResult Value Object
- [ ] `Outcome` - SkillOutcome
- [ ] `Landed` - True if reached other side
- [ ] `FallTriggered` - True if failed and fell
- [ ] `FallDepth` - How far they fell (if applicable)
- [ ] `StaminaCost` - Movement cost

**Leaping Logic:**
- [ ] Distance determines base DC
- [ ] Running start: -2 DC (minimum DC 3) or +5ft effective
- [ ] Precision landing: +1 DC
- [ ] [Glitched] landing: +2 DC
- [ ] Encumbered: +2 DC
- [ ] [Low Gravity]: -2 DC
- [ ] Success = land safely
- [ ] Failure = fall into gap
- [ ] Critical Success = perfect landing, halved stamina cost
- [ ] Fumble = [The Long Fall] - bonus damage + stress

**Unit Tests (~4):**
- [ ] Distance correctly sets base DC
- [ ] Running start reduces DC
- [ ] Failure triggers fall
- [ ] Fumble applies bonus damage and stress

---

### v0.15.2c - Fall Damage System

#### FallDamage Value Object
- [ ] `FallHeight` - Height fallen (feet)
- [ ] `DamageDice` - Calculated (1d10 per 10ft, max 10d10)
- [ ] `DamageType` - Bludgeoning
- [ ] `CanCrashLand` - If character can attempt save

#### CrashLandingResult Value Object
- [ ] `CrashDc` - 12 + (height/10)
- [ ] `Successes` - Roll result
- [ ] `DiceReduced` - Successes above threshold
- [ ] `FinalDamage` - After reduction

**Fall Damage Logic:**
- [ ] Damage = (Height / 10) × 1d10
- [ ] Maximum = 10d10 (100+ feet)
- [ ] Crash Landing DC = 12 + (Height / 10)
- [ ] Each success above threshold reduces damage by 1d10

| Fall Height | Damage Dice | Crash Landing DC |
|-------------|-------------|------------------|
| 10 ft | 1d10 | 13 |
| 20 ft | 2d10 | 14 |
| 30 ft | 3d10 | 15 |
| 50 ft | 5d10 | 17 |
| 100+ ft | 10d10 | 22 |

**Unit Tests (~4):**
- [ ] Fall height correctly calculates damage dice
- [ ] Damage caps at 10d10
- [ ] Crash landing reduces damage on success
- [ ] Crash landing DC scales with height

---

### v0.15.2d - Stealth Movement

#### StealthSurface Enum
```
StealthSurface
├── Silent (DC 10) - carpet, moss
├── Normal (DC 14) - concrete, dirt
├── Noisy (DC 18) - loose rubble
├── VeryNoisy (DC 22) - scrap metal
```

#### HiddenStatus Entity
**Purpose:** Track [Hidden] state for characters

- [ ] `CharacterId` - Who is hidden
- [ ] `IsHidden` - Current state
- [ ] `HiddenSince` - When they entered hidden
- [ ] `BreakConditions` - What will reveal them
- [ ] `DetectionModifier` - Difficulty for enemies to spot

**[Hidden] Status Effects:**
- [ ] Cannot be directly targeted by single-target attacks
- [ ] Can still be hit by AoE abilities
- [ ] Broken by: attacking, loud action, enemy critical Perception
- [ ] Re-enters: `hide` command or specialization ability

#### PartyStealthResult Value Object
**Purpose:** Weakest link party stealth

- [ ] `ParticipantIds` - Party members
- [ ] `WeakestMemberId` - Who made the check
- [ ] `WeakestPool` - Their dice pool
- [ ] `Outcome` - Result of check
- [ ] `DetectedBy` - Which enemies noticed

**Stealth Logic:**
- [ ] Surface determines DC
- [ ] Dim Light / Obscuring Terrain: -2 DC
- [ ] Illuminated: +3 DC
- [ ] Enemy Alerted / Combat: +2 DC
- [ ] [Psychic Resonance] zone: -3 DC
- [ ] Party uses lowest pool member's roll
- [ ] Fumble = [System-Wide Alert] - all adjacent rooms alerted

**Unit Tests (~4):**
- [ ] Surface type sets correct DC
- [ ] [Hidden] prevents single-target attacks
- [ ] Party stealth uses weakest member
- [ ] Fumble triggers system-wide alert

---

### v0.15.2e - Chase Sequences

#### ChaseState Entity
**Purpose:** Track chase encounter state

```
ChaseState
├── ChaseId: string
├── FleeingId: string (character trying to escape)
├── PursuerId: string (character chasing)
├── Distance: int (0-6 track position)
├── ObstacleHistory: List<ChaseObstacle>
├── RoundNumber: int
├── Status: ChaseStatus enum
└── MaxRounds: int?
```

#### ChaseStatus Enum
```
ChaseStatus
├── InProgress
├── Caught (distance ≤ 0)
├── Escaped (distance ≥ 6)
├── Abandoned
└── TimedOut
```

#### ChaseObstacle Value Object
```
ChaseObstacle
├── ObstacleType: ObstacleType enum
├── SkillRequired: string
├── Dc: int
├── SuccessEffect: string
├── FailureEffect: string
```

#### ObstacleType Enum
```
ObstacleType
├── Gap - Leap check
├── Climb - Climb check
├── Debris - Balance check
├── Crowd - Dodge check
├── Hazard - Avoid check
```

#### IChaseService Interface
```csharp
public interface IChaseService
{
    ChaseState StartChase(string fleeingId, string pursuerId, int startDistance = 3);
    ChaseObstacle GenerateObstacle(ChaseState state);
    ChaseRoundResult ProcessRound(string chaseId, bool fleeingAttempts, bool pursuerAttempts);
    void AbandonChase(string chaseId, string byCharacterId);
}
```

**Chase Distance Track:**
| Position | Status |
|----------|--------|
| 0-1 (Close) | Can attempt capture |
| 2-3 (Near) | Within striking distance |
| 4-5 (Far) | Safe for now |
| 6+ (Lost) | Escaped pursuit |

**Chase Logic:**
- [ ] Each round: obstacle generated
- [ ] Both characters attempt obstacle check
- [ ] Success = +1 position (for that character)
- [ ] Failure = -1 position
- [ ] Critical = +2 position
- [ ] Distance 0 = caught
- [ ] Distance 6+ = escaped

**Unit Tests (~4):**
- [ ] Chase starts at specified distance
- [ ] Success moves position correctly
- [ ] Distance 0 triggers caught status
- [ ] Distance 6+ triggers escaped status

---

### v0.15.2f - Balance Checks

#### BalanceSurface Value Object
- [ ] `Width` - Surface width
- [ ] `Stability` - Stable, Unstable, Swaying
- [ ] `Length` - Distance to cross
- [ ] `BaseDc` - From width

| Surface Width | DC |
|---------------|-----|
| Wide (2+ ft) | 8 |
| Narrow (1 ft) | 12 |
| Cable/Pipe (6 in) | 16 |
| Razor Edge (< 6 in) | 20 |

**Balance Logic:**
- [ ] Width determines base DC
- [ ] Unstable surface: +2 DC
- [ ] Swaying surface: +4 DC
- [ ] Strong wind: +2 DC
- [ ] Failure = fall (height-dependent)

**Unit Tests (~2):**
- [ ] Width correctly sets DC
- [ ] Failure triggers fall

---

### v0.15.2g - Specialization Integration

#### Gantry-Runner Abilities
- [ ] `[Roof-Runner]` - Reduce climbing stages by 1
- [ ] `[Death-Defying Leap]` - +10 ft to maximum leap distance
- [ ] `[Wall-Run]` - Run vertically (combat action)
- [ ] `[Double Jump]` - Once per day, correct failed leap mid-air
- [ ] `[Featherfall]` - Auto-succeed Crash Landing DC ≤ 14

#### Myrk-gengr Abilities
- [ ] `[Slip into Shadow]` - Enter [Hidden] without action
- [ ] `[Ghostly Form]` - Stay [Hidden] after attacking (once per encounter)
- [ ] `[Cloak the Party]` - Grant party +2d10 on Passive Stealth
- [ ] `[One with the Static]` - Auto-enter [Hidden] in [Psychic Resonance] zones

**Unit Tests (~2):**
- [ ] Gantry-Runner reduces climbing stages
- [ ] Myrk-gengr can enter [Hidden] without action

---

### Configuration Files

| File | Purpose |
|------|---------|
| `climbing-surfaces.json` | Surface type definitions and modifiers |
| `leap-distances.json` | Distance-to-DC mapping |
| `stealth-surfaces.json` | Surface noise classifications |
| `chase-obstacles.json` | Obstacle type definitions |
| `acrobatics-descriptors.json` | Voice guidance text |

---

### Dependencies

**Requires:**
- v0.15.0: Dice pool refactor (success-counting, fumble/critical detection)
- v0.15.1: Skill infrastructure (SkillContext, SkillOutcome, FumbleConsequence)
- v0.10.x: Status effects ([Hidden])
- v0.11.x: Combat system (for chase integration)

**Provides to:**
- Combat movement actions
- Environmental traversal
- Escape mechanics

---

### Acceptance Criteria

- [ ] Multi-stage climbing works with proper stage progression
- [ ] Climbing fumbles trigger falls from correct height
- [ ] Leaping uses distance-based DCs
- [ ] Running start provides correct bonus
- [ ] Fall damage calculates correctly
- [ ] Crash landing reduces damage appropriately
- [ ] [Hidden] status prevents targeting
- [ ] Party stealth uses weakest member
- [ ] Chase sequences track distance correctly
- [ ] Chase ends on caught/escaped conditions
- [ ] Balance checks use width-based DCs
- [ ] Specialization abilities function
- [ ] ~30 unit tests pass
