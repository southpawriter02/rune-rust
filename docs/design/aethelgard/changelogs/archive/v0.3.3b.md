> **Archived** - This changelog has been consolidated. See the complete version at [v0.3.3](../v0.3.x/v0.3.3.md).

# Changelog: v0.3.3b - The Haze (Ambient Conditions)

**Release Date:** 2025-12-21

## Summary

This release introduces the Ambient Condition system - persistent room-wide environmental effects that apply passive stat penalties and active turn-based damage/stress/corruption. Conditions (Psychic Resonance, Toxic Atmosphere, Deep Cold, Scorching Heat, Low Visibility, Blighted Ground, Static Field, Dread Presence) transform rooms into hostile zones affecting all combatants equally. The system leverages a two-tier penalty model: passive modifiers applied at combat start (e.g., -1 WILL for Psychic Resonance) and active tick effects processed each turn (e.g., +2 Stress per turn). ConditionService handles stat modifier lookups via ConditionTypeExtensions, passive penalty application to Combatant instances, and tick script parsing (DAMAGE/STRESS/CORRUPTION commands). Integration in CombatService applies penalties at combat start and processes ticks at turn start. NavigationService displays condition information when entering rooms. The Room entity gained a ConditionId property for database persistence, and Combatant gained four new condition modifier properties plus ActiveCondition tracking. This release includes 24 new unit tests validating stat modifiers, passive penalty application, and tick effects with chance-based triggers.

---

## New Files Created

### Core Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Entities/AmbientCondition.cs` | Entity representing room-wide environmental conditions with Type, Name, Description, Color, TickScript, TickChance properties |
| `RuneAndRust.Core/Models/Combat/ConditionTickResult.cs` | Result record for condition tick processing with WasApplied, ConditionName, Message, DamageDealt, StressApplied, CorruptionApplied fields |
| `RuneAndRust.Core/Interfaces/IConditionService.cs` | Service contract defining GetRoomConditionAsync, GetStatModifiers, ApplyPassiveModifiers, ProcessTurnTickAsync methods |

### Engine Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Engine/Services/ConditionService.cs` | Core condition processing logic with passive modifier application and tick script parsing |

### Persistence Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Persistence/Data/ConditionSeeder.cs` | Seeds 8 condition definitions with AAM-VOICE compliant descriptions |

### Test Layer
| File | Purpose |
|------|---------|
| `RuneAndRust.Tests/Engine/ConditionServiceTests.cs` | 24 unit tests validating condition stat modifiers, passive penalties, and tick effects |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Core/Enums/ConditionType.cs` | Added ConditionTypeExtensions static class with GetPassivePenalties() method returning attribute penalty dictionaries |
| `RuneAndRust.Core/Entities/Room.cs` | Added ConditionId nullable Guid property for FK relationship to AmbientCondition |
| `RuneAndRust.Core/Models/Combat/Combatant.cs` | Added ActiveCondition, ConditionSturdinessModifier, ConditionFinesseModifier, ConditionWitsModifier, ConditionWillModifier properties |
| `RuneAndRust.Engine/Services/CombatService.cs` | Added IConditionService dependency, ApplyConditionPenalties() method at combat start, ProcessConditionTick() method at turn start |
| `RuneAndRust.Engine/Services/NavigationService.cs` | Added IConditionService dependency, integrated condition display in FormatRoomDescriptionAsync() |
| `RuneAndRust.Persistence/Data/RuneAndRustDbContext.cs` | Configured AmbientCondition entity with unique index on Type, added Room -> Condition FK relationship |
| `RuneAndRust.Terminal/Program.cs` | Registered IConditionService as Scoped, updated version string to v0.3.3b |
| `RuneAndRust.Tests/Engine/CombatServiceTests.cs` | Added IConditionService mock to constructor |
| `RuneAndRust.Tests/Engine/NavigationServiceTests.cs` | Added IConditionService mock to constructor |

---

## Code Implementation Details

### ConditionType Enum (Extended)

**Enum Values:**
```csharp
public enum ConditionType
{
    PsychicResonance = 0,  // -1 WILL, +2 Stress/turn
    ToxicAtmosphere = 1,   // No passive, 1d4 Poison/turn
    DeepCold = 2,          // -1 FINESSE, 1 Ice/turn
    ScorchingHeat = 3,     // -1 STURDINESS, 1 Fire/turn
    LowVisibility = 4,     // -2 WITS, No active
    BlightedGround = 5,    // -1 WILL, -1 WITS, +1 Corruption/turn
    StaticField = 6,       // -1 FINESSE, 1d6 Lightning (25% chance)
    DreadPresence = 7      // -2 WILL, +3 Stress/turn
}
```

**ConditionTypeExtensions:**
```csharp
public static class ConditionTypeExtensions
{
    public static Dictionary<Attribute, int> GetPassivePenalties(this ConditionType type) => type switch
    {
        ConditionType.PsychicResonance => new Dictionary<Attribute, int> { { Attribute.Will, -1 } },
        ConditionType.DeepCold => new Dictionary<Attribute, int> { { Attribute.Finesse, -1 } },
        ConditionType.ScorchingHeat => new Dictionary<Attribute, int> { { Attribute.Sturdiness, -1 } },
        ConditionType.LowVisibility => new Dictionary<Attribute, int> { { Attribute.Wits, -2 } },
        ConditionType.BlightedGround => new Dictionary<Attribute, int>
        {
            { Attribute.Will, -1 },
            { Attribute.Wits, -1 }
        },
        ConditionType.StaticField => new Dictionary<Attribute, int> { { Attribute.Finesse, -1 } },
        ConditionType.DreadPresence => new Dictionary<Attribute, int> { { Attribute.Will, -2 } },
        ConditionType.ToxicAtmosphere => new Dictionary<Attribute, int>(), // No passive
        _ => new Dictionary<Attribute, int>()
    };
}
```

### AmbientCondition Entity

**Key Properties:**
- `Id` (Guid): Unique identifier
- `Type` (ConditionType): Enum type for passive penalty lookup
- `Name` (string): Display name
- `Description` (string): AAM-VOICE compliant narrative description
- `Color` (string): Spectre.Console color for UI rendering (e.g., "purple", "green", "cyan")
- `TickScript` (string): Command script for turn-based effects (e.g., "STRESS:2", "DAMAGE:Poison:1d4", "CORRUPTION:1")
- `TickChance` (float): Probability (0.0-1.0) that tick triggers each turn, default 1.0 (always)

**Supported TickScript Commands:**
- `DAMAGE:Type:Dice` - Deal typed damage using EffectScriptExecutor
- `STRESS:Amount` - Apply stress to combatant (capped at MaxStress)
- `CORRUPTION:Amount` - Apply corruption to combatant (capped at MaxCorruption)

### ConditionTickResult Record

```csharp
public record ConditionTickResult(
    bool WasApplied,
    string ConditionName,
    string Message,
    int DamageDealt,
    int StressApplied,
    int CorruptionApplied
)
{
    public static ConditionTickResult None => new(false, string.Empty, string.Empty, 0, 0, 0);
}
```

### IConditionService Interface

**Method Signatures:**
```csharp
Task<AmbientCondition?> GetRoomConditionAsync(Guid roomId);
Dictionary<CharacterAttribute, int> GetStatModifiers(ConditionType type);
void ApplyPassiveModifiers(Combatant combatant, ConditionType? conditionType);
Task<ConditionTickResult> ProcessTurnTickAsync(Combatant combatant, AmbientCondition condition);
```

### ConditionService Implementation

**Constructor:**
```csharp
public ConditionService(
    IRepository<AmbientCondition> conditionRepository,
    IRoomRepository roomRepository,
    EffectScriptExecutor effectScriptExecutor,
    IDiceService diceService,
    ILogger<ConditionService> logger)
```

**GetRoomConditionAsync:**
- Retrieves Room by roomId
- If Room.ConditionId is null, returns null
- Otherwise, loads AmbientCondition from repository
- Logs condition lookup at Trace/Debug levels

**GetStatModifiers:**
- Calls ConditionType.GetPassivePenalties() extension method
- Returns dictionary of attribute penalties
- Logs penalty count at Debug level

**ApplyPassiveModifiers:**
- If conditionType is null, no-op
- Retrieves penalties via GetStatModifiers()
- Iterates penalties and applies to Combatant:
  - `Attribute.Sturdiness` -> `ConditionSturdinessModifier`
  - `Attribute.Finesse` -> `ConditionFinesseModifier`
  - `Attribute.Wits` -> `ConditionWitsModifier`
  - `Attribute.Will` -> `ConditionWillModifier`
- Sets `ActiveCondition` property on Combatant
- Logs each penalty application at Debug level
- Logs zone entry at Info level

**ProcessTurnTickAsync:**
- Returns ConditionTickResult.None if TickScript is empty
- Checks TickChance via dice roll (d100 vs threshold)
- Parses TickScript commands separated by `;`
- Executes each command:
  - `DAMAGE:Type:Dice` -> Delegates to EffectScriptExecutor
  - `STRESS:Amount` -> Calls ParseStressCommand()
  - `CORRUPTION:Amount` -> Calls ParseCorruptionCommand()
- Aggregates damage, stress, corruption across all commands
- Builds display message from narratives
- Logs tick processing at Trace/Debug/Info levels

**ParseStressCommand (Private):**
- Validates command has amount parameter (2 parts)
- Parses amount as integer
- Applies stress to Combatant.CurrentStress, clamped to MaxStress
- Returns actual stress applied (handles cap overflow)
- Logs stress change at Debug level

**ParseCorruptionCommand (Private):**
- Validates command has amount parameter (2 parts)
- Parses amount as integer
- Applies corruption to Combatant.CurrentCorruption, clamped to MaxCorruption
- Returns actual corruption applied (handles cap overflow)
- Logs corruption change at Debug level

### Combatant Modifications

**New Properties:**
```csharp
public ConditionType? ActiveCondition { get; set; }
public int ConditionSturdinessModifier { get; set; } = 0;
public int ConditionFinesseModifier { get; set; } = 0;
public int ConditionWitsModifier { get; set; } = 0;
public int ConditionWillModifier { get; set; } = 0;
```

**Usage:**
- Set at combat start via ConditionService.ApplyPassiveModifiers()
- Read during attribute calculations (integrated with existing stat systems)
- Condition modifiers are combat-volatile, not persisted to Character entity

### CombatService Integration

**New Dependency:**
```csharp
private readonly IConditionService _conditionService;
```

**ApplyConditionPenalties (Combat Start):**
```csharp
// In StartCombat method, after building TurnOrder:
if (_gameState.CurrentRoomId.HasValue)
{
    var room = await _roomRepository.GetByIdAsync(_gameState.CurrentRoomId.Value);
    var condition = await _conditionService.GetRoomConditionAsync(_gameState.CurrentRoomId.Value);

    if (condition != null)
    {
        foreach (var combatant in state.TurnOrder)
        {
            _conditionService.ApplyPassiveModifiers(combatant, condition.Type);
        }

        _logger.LogInformation(
            "[Condition] Combat starting in [{ConditionName}] zone. {Count} combatants affected.",
            condition.Name, state.TurnOrder.Count);
    }
}
```

**ProcessConditionTick (Turn Start):**
```csharp
// In NextTurn method, after determining active combatant:
private void ProcessConditionTick(Combatant combatant)
{
    if (!_gameState.CurrentRoomId.HasValue || combatant.ActiveCondition == null)
    {
        return;
    }

    // Retrieve room and condition from database
    var room = _roomRepository.GetByIdAsync(_gameState.CurrentRoomId.Value).Result;
    var condition = _conditionService.GetRoomConditionAsync(_gameState.CurrentRoomId.Value).Result;

    if (condition == null) return;

    // Process tick effect
    var tickResult = _conditionService.ProcessTurnTickAsync(combatant, condition).Result;

    if (tickResult.WasApplied)
    {
        _inputHandler.DisplayMessage($"[CONDITION] {tickResult.Message}");

        // Sync effects to player source if player combatant
        if (combatant.IsPlayer && combatant.CharacterSource != null)
        {
            combatant.CharacterSource.CurrentHP = combatant.CurrentHp;
            combatant.CharacterSource.PsychicStress = combatant.CurrentStress;
            combatant.CharacterSource.Corruption = combatant.CurrentCorruption;

            _characterRepository.UpdateAsync(combatant.CharacterSource).Wait();

            _logger.LogDebug(
                "[Condition] Synced condition effects to player source. HP: {HP}, Stress: {Stress}, Corruption: {Corruption}",
                combatant.CharacterSource.CurrentHP, combatant.CharacterSource.PsychicStress, combatant.CharacterSource.Corruption);
        }
    }
}
```

### NavigationService Integration

**New Dependency:**
```csharp
private readonly IConditionService _conditionService;
```

**FormatRoomDescriptionAsync (Condition Display):**
```csharp
// After exit text formatting:
var conditionText = string.Empty;
var condition = await _conditionService.GetRoomConditionAsync(room.Id);
if (condition != null)
{
    conditionText = $"\n[AMBIENT] [{condition.Color}]{condition.Name}[/]: {condition.Description}";
    _logger.LogDebug(
        "[Condition] Room {RoomName} has condition [{ConditionName}]",
        room.Name, condition.Name);
}

return $"{prefix}[{room.Name}]\n{room.Description}{conditionText}\n\n{exitText}";
```

### Database Configuration

**DbContext Changes:**
```csharp
public DbSet<AmbientCondition> AmbientConditions { get; set; } = null!;

// In OnModelCreating:
modelBuilder.Entity<AmbientCondition>(entity =>
{
    entity.ToTable("AmbientConditions");
    entity.HasKey(c => c.Id);

    entity.Property(c => c.Type)
        .HasConversion<int>()
        .IsRequired();

    // Unique constraint on Type (only one definition per condition type)
    entity.HasIndex(c => c.Type)
        .IsUnique();

    entity.Property(c => c.Name)
        .HasMaxLength(100)
        .IsRequired();

    entity.Property(c => c.Description)
        .HasMaxLength(1000)
        .IsRequired();

    entity.Property(c => c.Color)
        .HasMaxLength(50)
        .IsRequired();

    entity.Property(c => c.TickScript)
        .HasMaxLength(500)
        .IsRequired();

    entity.Property(c => c.TickChance)
        .HasColumnType("real")
        .IsRequired();
});

// Room -> Condition FK relationship
modelBuilder.Entity<Room>()
    .HasOne<AmbientCondition>()
    .WithMany()
    .HasForeignKey(r => r.ConditionId)
    .IsRequired(false);
```

### ConditionSeeder

**Seed Data (8 Conditions):**

All descriptions are Domain 4 compliant (no precision measurements, JÃ¶tun-Reader voice).

1. **Psychic Resonance** (purple)
   - Passive: -1 WILL
   - Active: STRESS:2
   - Description: "A low hum permeates the air, pressing against your thoughts. The walls themselves seem to whisper."

2. **Toxic Atmosphere** (green)
   - Passive: None
   - Active: DAMAGE:Poison:1d4
   - Description: "The air shimmers with chemical haze. Each breath burns the lungs and corrodes the throat."

3. **Deep Cold** (cyan)
   - Passive: -1 FINESSE
   - Active: DAMAGE:Ice:1d1
   - Description: "Numbing frost clings to every surface. Your fingers grow stiff, and your breath hangs frozen in the air."

4. **Scorching Heat** (red)
   - Passive: -1 STURDINESS
   - Active: DAMAGE:Fire:1d1
   - Description: "Oppressive heat radiates from the walls. Sweat beads instantly, and the air itself seems to shimmer."

5. **Low Visibility** (grey)
   - Passive: -2 WITS
   - Active: None (TickScript empty, TickChance 0)
   - Description: "Thick dust or fog obscures the path ahead. Shapes loom and fade in the murk."

6. **Blighted Ground** (darkred)
   - Passive: -1 WILL, -1 WITS
   - Active: CORRUPTION:1
   - Description: "Runic corruption seeps from cracks in the floor. The air tastes of rust and old blood."

7. **Static Field** (yellow)
   - Passive: -1 FINESSE
   - Active: DAMAGE:Lightning:1d6
   - TickChance: 0.25 (25% chance per turn)
   - Description: "Electrical discharge crackles through the air. Your hair stands on end, and the taste of ozone fills your mouth."

8. **Dread Presence** (darkmagenta)
   - Passive: -2 WILL
   - Active: STRESS:3
   - Description: "Something ancient and terrible watches from the shadows. Your heart pounds, and primal fear claws at your spine."

---

## Logging Matrix

| Context | Level | Template |
|---------|-------|----------|
| Service Init | Trace | `"[Condition] ConditionService initialized"` |
| Room Lookup | Trace | `"[Condition] Getting condition for room {RoomId}"` |
| No Condition | Trace | `"[Condition] Room {RoomId} has no active condition"` |
| Condition Found | Debug | `"[Condition] Room {RoomId} has condition [{ConditionName}] ({ConditionType})"` |
| Stat Modifiers | Trace | `"[Condition] Getting stat modifiers for {ConditionType}"` |
| Penalty Count | Debug | `"[Condition] {ConditionType} has {Count} passive penalties"` |
| No Modifiers | Trace | `"[Condition] No condition to apply to {Combatant}"` |
| Sturdiness Penalty | Debug | `"[Condition] {Combatant} affected by STURDINESS {Penalty} from {Condition}"` |
| Finesse Penalty | Debug | `"[Condition] {Combatant} affected by FINESSE {Penalty} from {Condition}"` |
| Wits Penalty | Debug | `"[Condition] {Combatant} affected by WITS {Penalty} from {Condition}"` |
| Will Penalty | Debug | `"[Condition] {Combatant} affected by WILL {Penalty} from {Condition}"` |
| Might Unimplemented | Warning | `"[Condition] MIGHT modifier from {Condition} not implemented"` |
| Zone Entry | Info | `"[Condition] {Combatant} entered [{Condition}] zone"` |
| Tick Processing | Trace | `"[Condition] Processing tick for {Combatant} in [{ConditionName}]"` |
| No Tick Effect | Trace | `"[Condition] {Condition} has no tick effect"` |
| Tick Skipped | Trace | `"[Condition] {Condition} tick skipped (rolled {Roll} vs threshold {Threshold})"` |
| Tick Triggered | Debug | `"[Condition] {Condition} tick triggered (rolled {Roll} vs threshold {Threshold})"` |
| Tick Complete | Info | `"[Condition] {Condition} affects {Combatant}: Damage={Damage}, Stress={Stress}, Corruption={Corruption}"` |
| Stress Parse Error | Warning | `"[Condition] STRESS command missing amount parameter"` |
| Stress Invalid | Warning | `"[Condition] STRESS command has invalid amount: {Amount}"` |
| Stress Applied | Debug | `"[Condition] STRESS: {Combatant} gained {Stress} stress ({Previous} -> {Current})"` |
| Corruption Parse Error | Warning | `"[Condition] CORRUPTION command missing amount parameter"` |
| Corruption Invalid | Warning | `"[Condition] CORRUPTION command has invalid amount: {Amount}"` |
| Corruption Applied | Debug | `"[Condition] CORRUPTION: {Combatant} gained {Corruption} corruption ({Previous} -> {Current})"` |
| Unknown Command | Warning | `"[Condition] Unknown tick command type: {CommandType}"` |
| Combat Start Zone | Info | `"[Condition] Combat starting in [{ConditionName}] zone. {Count} combatants affected."` |
| Effect Sync | Debug | `"[Condition] Synced condition effects to player source. HP: {HP}, Stress: {Stress}, Corruption: {Corruption}"` |
| Nav Condition | Debug | `"[Condition] Room {RoomName} has condition [{ConditionName}]"` |

---

## Test Coverage

**Total: 24 tests | Passed: 24 | Failed: 0 | Duration: 67ms**

### ConditionServiceTests (24 tests)

#### GetStatModifiers Tests (7 tests)

| Test Name | Description |
|-----------|-------------|
| GetStatModifiers_PsychicResonance_ReturnsMinusOneWill | PsychicResonance returns {Will: -1} |
| GetStatModifiers_LowVisibility_ReturnsMinusTwoWits | LowVisibility returns {Wits: -2} |
| GetStatModifiers_BlightedGround_ReturnsBothPenalties | BlightedGround returns {Will: -1, Wits: -1} |
| GetStatModifiers_ToxicAtmosphere_ReturnsEmpty | ToxicAtmosphere returns empty dictionary |
| GetStatModifiers_DeepCold_ReturnsMinusOneFinesse | DeepCold returns {Finesse: -1} |
| GetStatModifiers_ScorchingHeat_ReturnsMinusOneSturdiness | ScorchingHeat returns {Sturdiness: -1} |
| GetStatModifiers_DreadPresence_ReturnsMinusTwoWill | DreadPresence returns {Will: -2} |

#### ApplyPassiveModifiers Tests (6 tests)

| Test Name | Description |
|-----------|-------------|
| ApplyPassiveModifiers_SetsWillModifier | Applies -1 Will modifier, sets ActiveCondition |
| ApplyPassiveModifiers_SetsWitsModifier | Applies -2 Wits modifier, sets ActiveCondition |
| ApplyPassiveModifiers_SetsFinesseModifier | Applies -1 Finesse modifier, sets ActiveCondition |
| ApplyPassiveModifiers_SetsSturdinessModifier | Applies -1 Sturdiness modifier, sets ActiveCondition |
| ApplyPassiveModifiers_BlightedGround_SetsBothModifiers | Applies -1 Will and -1 Wits, sets ActiveCondition |
| ApplyPassiveModifiers_NullCondition_NoEffect | Null condition leaves all modifiers at 0, ActiveCondition null |

#### ProcessTurnTick Tests (8 tests)

| Test Name | Description |
|-----------|-------------|
| ProcessTurnTick_DamageScript_AppliesDamage | DAMAGE:Poison:1d4 script deals 4 damage, reduces CurrentHp |
| ProcessTurnTick_StressScript_AppliesStress | STRESS:2 script applies 2 stress, increases CurrentStress |
| ProcessTurnTick_CorruptionScript_AppliesCorruption | CORRUPTION:1 script applies 1 corruption, increases CurrentCorruption |
| ProcessTurnTick_EmptyScript_ReturnsNone | Empty TickScript returns ConditionTickResult.None |
| ProcessTurnTick_LowChance_SkipsOnFailedRoll | TickChance 0.25, roll 80 > 25 threshold, no effect applied |
| ProcessTurnTick_LowChance_AppliesOnSuccessfulRoll | TickChance 0.25, roll 20 <= 25 threshold, effect applied |
| ProcessTurnTick_StressCappedAtMax | STRESS:3 at CurrentStress 99 caps at 100, returns StressApplied 1 |
| ProcessTurnTick_CorruptionCappedAtMax | CORRUPTION:5 at CurrentCorruption 99 caps at 100, returns CorruptionApplied 1 |

#### GetRoomCondition Tests (3 tests)

| Test Name | Description |
|-----------|-------------|
| GetRoomCondition_NoCondition_ReturnsNull | Room with ConditionId null returns null |
| GetRoomCondition_WithCondition_ReturnsCondition | Room with valid ConditionId returns AmbientCondition entity |
| GetRoomCondition_RoomNotFound_ReturnsNull | Non-existent roomId returns null |

---

## DI Registration

**Program.cs Additions:**
```csharp
// Register Condition Services (v0.3.3b)
services.AddScoped<IConditionService, ConditionService>();
```

**Lifetime Rationale:**
- `ConditionService` registered as Scoped (per-request lifecycle, matches CombatService/NavigationService)
- Uses existing Singleton `EffectScriptExecutor` for damage command parsing

---

## Verification Results

### Build Output
```
Build succeeded.

/usr/local/share/dotnet/sdk/9.0.306/Microsoft.Common.CurrentVersion.targets(2433,5): warning MSB3277: Found conflicts between different versions of "Microsoft.EntityFrameworkCore.Relational" that could not be resolved.
    1 Warning(s)
    0 Error(s)

Time Elapsed 00:00:01.13
```

### Test Output
```
Test run for /Volumes/GitHub/github/southpawriter02/rune-rust/RuneAndRust.Tests/bin/Debug/net9.0/RuneAndRust.Tests.dll (.NETCoreApp,Version=v9.0)

Passed!  - Failed:     0, Passed:    24, Skipped:     0, Total:    24, Duration: 67 ms - RuneAndRust.Tests.dll (net9.0)
```

---

## Running Tests

### All Condition Tests
```bash
dotnet test --filter "FullyQualifiedName~ConditionServiceTests"
```

### Specific Test Categories
```bash
# Stat modifier tests
dotnet test --filter "FullyQualifiedName~ConditionServiceTests&Name~GetStatModifiers"

# Passive penalty application tests
dotnet test --filter "FullyQualifiedName~ConditionServiceTests&Name~ApplyPassiveModifiers"

# Tick processing tests
dotnet test --filter "FullyQualifiedName~ConditionServiceTests&Name~ProcessTurnTick"

# Room lookup tests
dotnet test --filter "FullyQualifiedName~ConditionServiceTests&Name~GetRoomCondition"
```

---

## Next Steps

The following features are planned for later versions in the v0.3.3 cycle:

### v0.3.3c - The Mind (AI Hazard Awareness)
- **AI Condition Awareness**: Enemies can detect and react to room conditions
- **Tactical AI Updates**: Condition-based behavior modifiers (e.g., avoid Blighted Ground)
- **Condition Combos**: Hazards + Conditions synergy (e.g., Fire hazard in Toxic Atmosphere)
- **UI Condition Rendering**: Visual representation of active conditions in TUI

### v0.4.0 - Worldbuilding Milestone
- **Condition Persistence**: Save/load room conditions across sessions
- **Dynamic Condition Application**: Events/items that apply temporary conditions to rooms
- **Condition Intensity Levels**: Tiered severity (Mild/Moderate/Severe variants)
- **Player Condition Mitigation**: Equipment/abilities that reduce condition penalties

---

## Breaking Changes

None. This release is backward compatible.

---

## Migration Notes

### Database
A new migration is required to add the AmbientConditions table and Room.ConditionId FK.

**New Table: AmbientConditions**
- `Id` (Guid, PK)
- `Type` (int, Unique Index)
- `Name` (varchar 100)
- `Description` (varchar 1000)
- `Color` (varchar 50)
- `TickScript` (varchar 500)
- `TickChance` (real)

**Room Table Alteration**
- Add `ConditionId` (Guid, nullable, FK to AmbientConditions)

**Seeding**
Run `ConditionSeeder.SeedAsync()` to populate 8 base condition definitions.

---

## Contributors

- Claude Code (Chronicle-Smith Agent)
