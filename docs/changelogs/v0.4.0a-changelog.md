# v0.4.0a Changelog - Interactive Object Core

**Release Date:** 2026-01-12
**Focus:** Interactive object entity enhancements, room integration, and foundational interaction system

## Summary

This release establishes the foundational interactive object system for v0.4.0. It enhances the existing `InteractiveObject` entity with state tracking improvements, expands interaction and object type enums, integrates an `Interactables` collection into `Room`, and updates the `InteractionService` with room-aware methods. This creates the infrastructure for future container, lock, and activation features.

## New Features

### InteractionType Enum Expansion
- **6 new interaction types** added for future container and destruction features:
  - `Unlock` - unlock a locked object with a key
  - `Lock` - lock an unlocked object with a key
  - `Break` - break/destroy the object
  - `Search` - search the object for hidden items
  - `Take` - take items from a container
  - `Put` - put items into a container

### InteractiveObjectType Enum Expansion
- **5 new object types** added for varied environmental interaction:
  - `Crate` - breakable wooden crate
  - `Barrel` - storage barrel
  - `Button` - momentary push button
  - `Web` - spider web or similar traversal barrier
  - `Barrier` - generic destructible barrier

### InteractiveObject Entity Enhancements
- **New properties:**
  - `DefaultState` - tracks the initial state for reset functionality
  - `BlocksPassage` - explicit boolean for passage-blocking capability
  - `IsVisible` - controls visibility in room descriptions
  - `CanInteract` - computed property checking if object can be interacted with
- **Improved `IsCurrentlyBlocking`:**
  - Now correctly blocks on both `Closed` AND `Locked` states
  - Requires both `BlocksPassage=true` and valid `BlockedDirection`
- **New methods:**
  - `FromDefinition(InteractiveObjectDefinition)` - factory method for configuration-based creation
  - `Reset()` - restores object to its default state
  - `SetVisibility(bool)` - controls object visibility

### InteractiveObjectDefinition
- New definition class for JSON configuration of interactive objects
- Properties: Id, Name, Description, ObjectType, DefaultState, AllowedInteractions, BlocksPassage, BlockedDirection, Keywords, IsVisible
- Enables data-driven object creation via `InteractiveObject.FromDefinition()`

### Room.Interactables Collection
- **New collection:** `_interactables` private field with `Interactables` readonly property
- **New properties:**
  - `HasInteractables` - checks if room contains interactive objects
- **New methods:**
  - `AddInteractable(InteractiveObject)` - adds an object to the room
  - `RemoveInteractable(InteractiveObject)` - removes an object from the room
  - `GetInteractableByKeyword(string)` - finds object by keyword search
  - `GetBlockingObject(Direction)` - finds object blocking a specific direction
  - `GetVisibleInteractables()` - returns enumerable of visible objects
  - `IsDirectionBlocked(Direction)` - checks if direction is blocked

### InteractionService Expansion
- **New interface methods:**
  - `FindObject(Room, string)` - finds object in room by keyword with logging
  - `GetRoomObjectsDescription(Room)` - formats visible objects for room descriptions
- **New helper:**
  - `GetStateDisplayText(ObjectState)` - returns parenthesized state text for display

### Configuration
- **New file:** `config/interactive-objects.json` with 12 object definitions:
  - Doors: iron-door-basic, wooden-door-basic
  - Chests: wooden-chest-basic, iron-chest-basic
  - Levers: rusty-lever-basic
  - Crates/Barrels: wooden-crate-basic, storage-barrel-basic
  - Barriers: spider-web-basic
  - Decorative: stone-statue-basic, ancient-altar-basic, wall-torch-basic, stone-inscription-basic

## Files Created

### Domain Layer
- `src/Core/RuneAndRust.Domain/Definitions/InteractiveObjectDefinition.cs`

### Configuration
- `config/interactive-objects.json`

### Unit Tests
- `tests/RuneAndRust.Domain.UnitTests/Entities/RoomInteractableTests.cs` (6 tests)

## Files Modified

### Domain Enums
- `src/Core/RuneAndRust.Domain/Enums/InteractionType.cs` - Added 6 enum values
- `src/Core/RuneAndRust.Domain/Enums/InteractiveObjectType.cs` - Added 5 enum values

### Domain Entities
- `src/Core/RuneAndRust.Domain/Entities/InteractiveObject.cs` - Rewrote with new properties, improved blocking logic, and new methods
- `src/Core/RuneAndRust.Domain/Entities/Room.cs` - Added `_interactables` collection with 6 management methods

### Application Layer
- `src/Core/RuneAndRust.Application/Interfaces/IInteractionService.cs` - Added 2 method signatures
- `src/Core/RuneAndRust.Application/Services/InteractionService.cs` - Added 2 methods + helper

### Unit Tests
- `tests/RuneAndRust.Domain.UnitTests/Entities/InteractiveObjectTests.cs` - Added 5 tests, fixed 1 existing test

## Test Results

- **11 new tests** added (5 InteractiveObject + 6 RoomInteractable)
- **All 1332 tests pass**
- **0 errors, 0 warnings**

## Breaking Changes

- `InteractiveObject.Create()` signature changed:
  - Removed: `blocksDirection` parameter
  - Added: `blocksPassage`, `blockedDirection`, `isVisible` parameters
- Property renamed: `BlocksDirection` â†’ `BlockedDirection`
- Added: `BlocksPassage` property required for blocking behavior

## Dependencies

- Requires v0.3.2 (Quest Systems) complete
- No new package dependencies

## Usage Example

```csharp
// Create object from definition
var definition = new InteractiveObjectDefinition
{
    Id = "iron-door",
    Name = "Heavy Iron Door",
    ObjectType = InteractiveObjectType.Door,
    DefaultState = ObjectState.Closed,
    AllowedInteractions = [InteractionType.Open, InteractionType.Close],
    BlocksPassage = true
};
var door = InteractiveObject.FromDefinition(definition);

// Add to room
room.AddInteractable(door);

// Check if direction is blocked
if (room.IsDirectionBlocked(Direction.North))
{
    var blockingObj = room.GetBlockingObject(Direction.North);
    Console.WriteLine($"The {blockingObj.Name} blocks your path.");
}

// Find object by keyword
var interactionService = new InteractionService(logger);
var found = interactionService.FindObject(room, "door");
if (found != null)
{
    var result = interactionService.Open(found);
    Console.WriteLine(result.Message);
}

// Get room objects description
var description = interactionService.GetRoomObjectsDescription(room);
// Output:
// You notice:
//   Heavy Iron Door (closed) - blocking north
```

## Metrics Summary

| Category | Before | After |
|----------|--------|-------|
| InteractionType values | 8 | 14 |
| InteractiveObjectType values | 8 | 13 |
| InteractionService methods | 7 | 9 |
| Room collection types | 5 | 6 |
| Unit Tests | ~1321 | ~1332 |

## v0.4.0 Milestone Progress

| Sub-Version | Focus | Status |
|-------------|-------|--------|
| v0.4.0a | Interactive Object Core | âœ… Complete |
| v0.4.0b | Containers & Locks | ðŸ”² Pending |
| v0.4.0c | Activation & Destruction | ðŸ”² Pending |

## Next Steps

- **v0.4.0b**: Container inventories, key/lock mechanics, lockpicking skill checks
- **v0.4.0c**: Lever/button activation behavior, linked trigger effects, destructible objects
