# v0.13.2a Changelog: Tree Visualization

**Version:** 0.13.2a  
**Date:** 2026-01-20  
**Parent:** v0.13.2 (Ability Tree UI)  
**Theme:** Tree Visualization - Hierarchical ability tree layout and rendering

---

## Summary

Implements the ability tree visualization component for displaying hierarchical ability nodes organized by tiers. The tree visualization shows all nodes in a column-based layout with clear tier separation, branch organization, and a tree header displaying the tree name.

---

## Added

### DTOs (`src/Presentation/RuneAndRust.Presentation.Tui/DTOs/`)

- **AbilityTreeDtos.cs** - Data transfer objects for tree visualization:
  - `TreeDisplayDto` - Complete tree data for rendering
  - `TierDisplayDto` - Single tier column data
  - `NodeLayoutDto` - Node position and display info
  - `BranchDisplayDto` - Branch display metadata
  - `NodeScreenPosition` - Calculated screen coordinates

### Configuration (`src/Presentation/RuneAndRust.Presentation.Tui/Configuration/`)

- **AbilityTreeDisplayConfig.cs** - Display configuration class:
  - Layout dimensions: `TotalWidth`, `TotalHeight`, `StartX`, `StartY`
  - Node sizing: `NodeWidth`, `NodeHeight`, `ColumnSpacing`, `NodeVerticalSpacing`
  - Row offsets: `TierLabelRow`, `BranchHeaderRow`, `NodeAreaStartRow`
  - Color config: `AbilityTreeColors` nested record

### JSON Configuration (`config/`)

- **ability-tree-display.json** - Default configuration settings
- **schemas/ability-tree-display.schema.json** - JSON schema for validation

### Renderers (`src/Presentation/RuneAndRust.Presentation.Tui/Renderers/`)

- **TreeLayoutRenderer.cs** - Layout calculations and text formatting:
  - `CalculateNodePositions(TreeDisplayDto)` - Calculate screen positions for all nodes
  - `GetTierLabel(int)` - Return formatted "TIER #" string
  - `GetTreeWidth(int)` - Calculate total display width
  - `FormatNodeBox(NodeLayoutDto, int, int)` - Create ASCII node box
  - `FormatTreeHeader(string, int)` - Center tree name in header
  - `FormatBranchHeader(string)` - Format bracketed branch label
  - `RenderTierColumn(TierDisplayDto)` - Build tier column string

### UI Components (`src/Presentation/RuneAndRust.Presentation.Tui/UI/`)

- **AbilityTreeView.cs** - Tree visualization component:
  - `RenderTree(TreeDisplayDto)` - Render complete tree display
  - `RenderTiers(IReadOnlyList<TierDisplayDto>)` - Render tier columns
  - `SetTreeHeader(string)` - Display centered tree name
  - `HandleSelection(int, int)` - Keyboard navigation support
  - `GetSelectedNodeId()` - Get currently selected node
  - `Clear()` - Clear display

### Unit Tests (`tests/RuneAndRust.Presentation.Tui.UnitTests/`)

- **Renderers/TreeLayoutRendererTests.cs** (9 tests)
  - Tier label formatting
  - Tree header centering and truncation
  - Node box structure validation
  - Branch header formatting
  - Tree width calculation

- **Renderers/NodePositionCalculationTests.cs** (7 tests)
  - Position calculation for various tier/index combinations
  - Multi-tier position calculation
  - Empty tree handling

- **UI/AbilityTreeViewTests.cs** (5 tests)
  - Tree rendering with header and tiers
  - Branch header rendering for multi-branch trees
  - Selection handling
  - Invalid selection handling
  - Clear functionality

---

## Technical Details

### Tree Layout Structure

```
┌─────────────────────────────────────────────────────────────────────┐
│                      WARRIOR ABILITY TREE                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  TIER 1                    TIER 2                    TIER 3         │
│  ──────                    ──────                    ──────         │
│                                                                      │
│  ┌─────────┐              ┌─────────┐              ┌─────────┐      │
│  │  Power  │              │  Cleave │              │  Whirl  │      │
│  │  Strike │              │         │              │   wind  │      │
│  └─────────┘              └─────────┘              └─────────┘      │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### Position Calculation

- **X Position:** `StartX + Padding + ((Tier - 1) * (NodeWidth + ColumnSpacing))`
- **Y Position:** `StartY + NodeAreaStartRow + (NodeIndex * (NodeHeight + NodeVerticalSpacing))`

### Default Configuration

| Setting | Value |
|---------|-------|
| TotalWidth | 72 |
| TotalHeight | 24 |
| NodeWidth | 11 |
| NodeHeight | 3 |
| ColumnSpacing | 8 |
| NodeVerticalSpacing | 1 |

---

## Dependencies

### Required from v0.10.2a

- `IAbilityTreeProvider` - Tree definition retrieval
- `AbilityTreeDefinition` - Tree structure with branches
- `AbilityTreeNode` - Node with position data

### Provides to v0.13.2b

- `AbilityTreeView` - Integration point for node state rendering
- `TreeLayoutRenderer` - Position calculations for state display
- `NodeLayoutDto` - Node information for state determination
- `AbilityTreeDisplayConfig` - Shared configuration

---

## Verification

- ✅ Build succeeds with 0 errors/0 warnings
- ✅ 21 unit tests pass
- ✅ Configuration validates against JSON schema
- ✅ XML documentation on all public members
