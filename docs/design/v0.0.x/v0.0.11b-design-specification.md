# v0.0.11b Design Specification: Combat & Ability Descriptors

**Version:** 0.0.11b
**Phase Name:** Combat & Ability Descriptors
**Parent Version:** v0.0.11 (Descriptors & Ambience)
**Prerequisites:** v0.0.11a Complete (Descriptor Framework Expansion)
**Estimated Tests:** ~15 unit tests

---

## 1. Overview

### 1.1 Purpose

Expand combat descriptor variety with weapon-specific attack descriptions, damage-tier narratives, ability effect flavor text, and death descriptions that vary by monster type. This creates dynamic, engaging combat narration that changes based on weapon type, damage amount, ability used, and target characteristics.

### 1.2 Current State

| Area | Current State (v0.0.11a) | Target State (v0.0.11b) |
|------|--------------------------|-------------------------|
| Hit descriptions | Generic pool (`hit_descriptions`) | Weapon-type specific pools |
| Damage severity | 4 tiers (graze, wound, grievous, devastate) | 6 tiers with richer variety |
| Miss descriptions | Generic pool | Weapon-aware misses |
| Death descriptions | Limited pool, tag-filtered | Monster-category specific pools |
| Ability flavor | Basic casting/effect pools | Activation + impact + aftermath descriptions |
| Damage type flavor | None | Per-damage-type effect descriptions |
| Critical hits | Not distinguished | Dedicated critical hit pool |

### 1.3 Design Principles

1. **Weapon Identity**: Each weapon type has distinct combat feel through descriptors
2. **Damage Scaling**: Descriptions reflect the severity of damage dealt
3. **Monster Personality**: Death descriptions match monster type (undead, beast, etc.)
4. **Ability Drama**: Abilities have visual, audio, and impact phases
5. **Configurability**: All descriptors loaded from JSON, easily extended

---

## 2. Scope

### 2.1 In Scope

- Weapon-type hit descriptor pools (sword, axe, bow, staff, dagger, fist, mace, spear)
- Damage-tier descriptors (6 tiers based on damage percentage)
- Critical hit and fumble descriptor pools
- Miss descriptor pools (dodge, parry, block, whiff)
- Monster death descriptors by category (humanoid, undead, beast, construct, elemental, demon)
- Player near-death and death descriptors
- Ability activation descriptors (casting, channeling, charging)
- Ability impact descriptors (on-hit effects by damage type)
- Ability aftermath descriptors (lingering effects)
- Status effect application and removal descriptors
- Damage type flavor text integration
- `CombatDescriptorService` for combat-specific descriptor generation

### 2.2 Out of Scope (Future Phases)

- Environmental descriptors (v0.0.11c)
- Sensory descriptors (v0.0.11c)
- Interactive objects (v0.0.11d)
- Ambient events (v0.0.11d)

---

## 3. Data Model

### 3.1 New: CombatDescriptorContext (Value Object)

**File:** `src/Core/RuneAndRust.Application/Services/CombatDescriptorService.cs`

```csharp
namespace RuneAndRust.Application.Services;

/// <summary>
/// Context information for combat descriptor selection.
/// </summary>
/// <remarks>
/// Provides all the information needed to select appropriate combat descriptors,
/// including weapon type, damage dealt, target characteristics, and environment.
/// </remarks>
public record CombatDescriptorContext
{
    /// <summary>
    /// The weapon type used for the attack (e.g., "sword", "axe", "bow").
    /// </summary>
    public string? WeaponType { get; init; }

    /// <summary>
    /// The damage type inflicted (e.g., "physical", "fire", "ice").
    /// </summary>
    public string? DamageType { get; init; }

    /// <summary>
    /// The damage dealt as a percentage of target's max health (0.0 to 1.0+).
    /// </summary>
    public double DamagePercent { get; init; }

    /// <summary>
    /// Whether this attack was a critical hit.
    /// </summary>
    public bool IsCritical { get; init; }

    /// <summary>
    /// Whether this attack was a fumble/critical miss.
    /// </summary>
    public bool IsFumble { get; init; }

    /// <summary>
    /// The attacker's name for description generation.
    /// </summary>
    public string AttackerName { get; init; } = string.Empty;

    /// <summary>
    /// The target's name for description generation.
    /// </summary>
    public string TargetName { get; init; } = string.Empty;

    /// <summary>
    /// Category tags for the target (e.g., "humanoid", "undead", "beast").
    /// </summary>
    public IReadOnlyList<string> TargetTags { get; init; } = [];

    /// <summary>
    /// The environment context for biome-aware descriptors.
    /// </summary>
    public EnvironmentContext? Environment { get; init; }

    /// <summary>
    /// Gets the damage tier based on damage percentage.
    /// </summary>
    public DamageTier GetDamageTier()
    {
        return DamagePercent switch
        {
            <= 0.15 => DamageTier.Glancing,
            <= 0.30 => DamageTier.Light,
            <= 0.50 => DamageTier.Solid,
            <= 0.75 => DamageTier.Heavy,
            <= 0.90 => DamageTier.Devastating,
            _ => DamageTier.Lethal
        };
    }
}

/// <summary>
/// Damage severity tiers for descriptor selection.
/// </summary>
public enum DamageTier
{
    /// <summary>0-15% of max health - barely scratches.</summary>
    Glancing,

    /// <summary>15-30% of max health - finds purchase.</summary>
    Light,

    /// <summary>30-50% of max health - strikes true.</summary>
    Solid,

    /// <summary>50-75% of max health - crashes into.</summary>
    Heavy,

    /// <summary>75-90% of max health - devastates.</summary>
    Devastating,

    /// <summary>90-100%+ of max health - lethal blow.</summary>
    Lethal
}
```

### 3.2 New: AbilityDescriptorContext (Value Object)

```csharp
/// <summary>
/// Context information for ability descriptor selection.
/// </summary>
public record AbilityDescriptorContext
{
    /// <summary>
    /// The ability identifier.
    /// </summary>
    public string AbilityId { get; init; } = string.Empty;

    /// <summary>
    /// The ability's damage type if applicable.
    /// </summary>
    public string? DamageType { get; init; }

    /// <summary>
    /// Tags from the ability definition.
    /// </summary>
    public IReadOnlyList<string> AbilityTags { get; init; } = [];

    /// <summary>
    /// The target type (self, enemy, area).
    /// </summary>
    public string TargetType { get; init; } = string.Empty;

    /// <summary>
    /// The caster's name.
    /// </summary>
    public string CasterName { get; init; } = string.Empty;

    /// <summary>
    /// The target's name if applicable.
    /// </summary>
    public string? TargetName { get; init; }

    /// <summary>
    /// Effects that were applied.
    /// </summary>
    public IReadOnlyList<string> AppliedEffects { get; init; } = [];

    /// <summary>
    /// The environment context for biome-aware descriptors.
    /// </summary>
    public EnvironmentContext? Environment { get; init; }
}
```

### 3.3 New: DeathDescriptorContext (Value Object)

```csharp
/// <summary>
/// Context information for death descriptor selection.
/// </summary>
public record DeathDescriptorContext
{
    /// <summary>
    /// The creature that died.
    /// </summary>
    public string CreatureName { get; init; } = string.Empty;

    /// <summary>
    /// Category tags for the creature (e.g., "humanoid", "undead").
    /// </summary>
    public IReadOnlyList<string> CreatureTags { get; init; } = [];

    /// <summary>
    /// Whether the kill was from a critical hit.
    /// </summary>
    public bool WasCriticalKill { get; init; }

    /// <summary>
    /// The damage type that killed the creature.
    /// </summary>
    public string? KillingDamageType { get; init; }

    /// <summary>
    /// The weapon type that killed the creature.
    /// </summary>
    public string? KillingWeaponType { get; init; }

    /// <summary>
    /// Whether this is a player death (for special handling).
    /// </summary>
    public bool IsPlayerDeath { get; init; }

    /// <summary>
    /// Gets the primary creature category for descriptor selection.
    /// </summary>
    public string GetPrimaryCategory()
    {
        // Priority order for category matching
        var categories = new[] { "undead", "beast", "construct", "elemental", "demon", "humanoid" };
        return CreatureTags.FirstOrDefault(t => categories.Contains(t.ToLowerInvariant())) ?? "humanoid";
    }
}
```

### 3.4 Modified: Descriptor (Configuration Class)

**File:** `src/Core/RuneAndRust.Application/Configuration/DescriptorConfiguration.cs`

```csharp
// Add to existing Descriptor class:

/// <summary>
/// Weapon types this descriptor applies to.
/// Empty list means all weapon types.
/// </summary>
public IReadOnlyList<string> WeaponTypes { get; init; } = [];

/// <summary>
/// Damage types this descriptor applies to (fire, ice, physical, etc.).
/// Empty list means all damage types.
/// </summary>
public IReadOnlyList<string> DamageTypes { get; init; } = [];

/// <summary>
/// Creature categories this descriptor applies to.
/// Empty list means all categories.
/// </summary>
public IReadOnlyList<string> CreatureCategories { get; init; } = [];

/// <summary>
/// Whether this descriptor is for critical hits only.
/// </summary>
public bool CriticalOnly { get; init; }

/// <summary>
/// Whether this descriptor is for misses/fumbles only.
/// </summary>
public bool MissOnly { get; init; }
```

---

## 4. Services

### 4.1 CombatDescriptorService

**File:** `src/Core/RuneAndRust.Application/Services/CombatDescriptorService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Generates descriptive combat narratives based on context.
/// </summary>
/// <remarks>
/// This service extends the base DescriptorService with combat-specific
/// logic for weapon types, damage tiers, and creature categories.
/// </remarks>
public class CombatDescriptorService
{
    private readonly DescriptorService _descriptorService;
    private readonly ILogger<CombatDescriptorService> _logger;

    public CombatDescriptorService(
        DescriptorService descriptorService,
        ILogger<CombatDescriptorService> logger)
    {
        _descriptorService = descriptorService ?? throw new ArgumentNullException(nameof(descriptorService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));

        _logger.LogDebug("CombatDescriptorService initialized");
    }

    /// <summary>
    /// Generates a complete hit description for an attack.
    /// </summary>
    /// <param name="context">The combat context.</param>
    /// <returns>A narrative description of the attack.</returns>
    public string GetHitDescription(CombatDescriptorContext context)
    {
        _logger.LogDebug(
            "GetHitDescription: Weapon={Weapon}, DamagePercent={Percent:P}, Critical={Critical}",
            context.WeaponType, context.DamagePercent, context.IsCritical);

        var poolPath = GetHitPoolPath(context);
        var descriptorContext = BuildDescriptorContext(context);

        var action = _descriptorService.GetDescriptor(poolPath, context.TargetTags, descriptorContext);
        var severity = GetDamageTierDescription(context);

        if (string.IsNullOrEmpty(action))
        {
            action = "strikes";
        }

        var description = FormatHitDescription(context, action, severity);

        _logger.LogDebug("Generated hit description: {Description}", description);
        return description;
    }

    /// <summary>
    /// Generates a miss description for a failed attack.
    /// </summary>
    /// <param name="context">The combat context.</param>
    /// <returns>A narrative description of the miss.</returns>
    public string GetMissDescription(CombatDescriptorContext context)
    {
        _logger.LogDebug(
            "GetMissDescription: Weapon={Weapon}, Fumble={Fumble}",
            context.WeaponType, context.IsFumble);

        var poolPath = context.IsFumble
            ? "combat.fumble_descriptions"
            : "combat.miss_descriptions";

        var descriptorContext = BuildDescriptorContext(context);
        var miss = _descriptorService.GetDescriptor(poolPath, context.TargetTags, descriptorContext);

        if (string.IsNullOrEmpty(miss))
        {
            miss = context.IsFumble ? "stumbles badly" : "misses";
        }

        return $"{context.AttackerName}'s attack {miss}!";
    }

    /// <summary>
    /// Generates a death description for a defeated creature.
    /// </summary>
    /// <param name="context">The death context.</param>
    /// <returns>A narrative description of the death.</returns>
    public string GetDeathDescription(DeathDescriptorContext context)
    {
        _logger.LogDebug(
            "GetDeathDescription: Creature={Creature}, Category={Category}",
            context.CreatureName, context.GetPrimaryCategory());

        var category = context.GetPrimaryCategory();
        var poolPath = $"combat.death_{category}";

        // Fall back to generic pool if category-specific doesn't exist
        var description = _descriptorService.GetDescriptor(poolPath, context.CreatureTags);

        if (string.IsNullOrEmpty(description))
        {
            description = _descriptorService.GetDescriptor("combat.death_descriptions", context.CreatureTags);
        }

        if (string.IsNullOrEmpty(description))
        {
            description = "falls lifeless";
        }

        // Add critical kill flair
        if (context.WasCriticalKill)
        {
            var criticalFlair = _descriptorService.GetDescriptor("combat.critical_kill");
            if (!string.IsNullOrEmpty(criticalFlair))
            {
                description = $"{criticalFlair} {context.CreatureName} {description}";
                return description;
            }
        }

        return $"The {context.CreatureName} {description}.";
    }

    /// <summary>
    /// Generates a player death description.
    /// </summary>
    /// <param name="playerName">The player's name.</param>
    /// <param name="killerName">The name of what killed the player.</param>
    /// <returns>A narrative description of the player's death.</returns>
    public string GetPlayerDeathDescription(string playerName, string killerName)
    {
        var description = _descriptorService.GetDescriptor("combat.player_death");

        if (string.IsNullOrEmpty(description))
        {
            return $"{playerName} has fallen in battle against the {killerName}...";
        }

        return description
            .Replace("{player}", playerName)
            .Replace("{killer}", killerName);
    }

    /// <summary>
    /// Generates a near-death warning description.
    /// </summary>
    /// <param name="healthPercent">Current health as percentage (0.0 to 1.0).</param>
    /// <returns>A warning description based on health level.</returns>
    public string? GetNearDeathDescription(double healthPercent)
    {
        if (healthPercent > 0.25) return null;

        var poolPath = healthPercent <= 0.10
            ? "combat.near_death_critical"
            : "combat.near_death_warning";

        return _descriptorService.GetDescriptor(poolPath);
    }

    private string GetHitPoolPath(CombatDescriptorContext context)
    {
        if (context.IsCritical)
        {
            // Try weapon-specific critical pool first
            if (!string.IsNullOrEmpty(context.WeaponType))
            {
                return $"combat.critical_{context.WeaponType}";
            }
            return "combat.critical_hit";
        }

        // Try weapon-specific pool
        if (!string.IsNullOrEmpty(context.WeaponType))
        {
            return $"combat.hit_{context.WeaponType}";
        }

        return "combat.hit_descriptions";
    }

    private string GetDamageTierDescription(CombatDescriptorContext context)
    {
        var tier = context.GetDamageTier();
        var poolPath = $"combat.damage_tier_{tier.ToString().ToLowerInvariant()}";

        var description = _descriptorService.GetDescriptor(poolPath);

        // Fall back to severity pool with damage percent filtering
        if (string.IsNullOrEmpty(description))
        {
            var descriptorContext = new DescriptorContext { DamagePercent = context.DamagePercent };
            description = _descriptorService.GetDescriptor("combat.damage_severity", context: descriptorContext);
        }

        return description ?? string.Empty;
    }

    private DescriptorContext BuildDescriptorContext(CombatDescriptorContext context)
    {
        return new DescriptorContext
        {
            DamagePercent = context.DamagePercent,
            Tags = context.TargetTags.ToList(),
            Environment = context.Environment
        };
    }

    private string FormatHitDescription(CombatDescriptorContext context, string action, string severity)
    {
        var parts = new List<string>();

        // Add attacker
        parts.Add(context.AttackerName);

        // Add action
        parts.Add(action);

        // Add target
        parts.Add($"the {context.TargetName}");

        var description = string.Join(" ", parts);

        // Add severity if present
        if (!string.IsNullOrEmpty(severity))
        {
            description = $"{description}, {severity}";
        }

        // Add damage type flavor if applicable
        if (!string.IsNullOrEmpty(context.DamageType) && context.DamageType != "physical")
        {
            var damageTypeFlavor = _descriptorService.GetDescriptor(
                $"combat.damage_type_{context.DamageType}");
            if (!string.IsNullOrEmpty(damageTypeFlavor))
            {
                description = $"{description}. {damageTypeFlavor}";
            }
        }

        return $"{description}!";
    }
}
```

### 4.2 AbilityDescriptorService

**File:** `src/Core/RuneAndRust.Application/Services/AbilityDescriptorService.cs`

```csharp
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Generates descriptive ability narratives.
/// </summary>
public class AbilityDescriptorService
{
    private readonly DescriptorService _descriptorService;
    private readonly ILogger<AbilityDescriptorService> _logger;

    public AbilityDescriptorService(
        DescriptorService descriptorService,
        ILogger<AbilityDescriptorService> logger)
    {
        _descriptorService = descriptorService ?? throw new ArgumentNullException(nameof(descriptorService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Generates an ability activation description (casting/channeling phase).
    /// </summary>
    /// <param name="context">The ability context.</param>
    /// <returns>A narrative description of ability activation.</returns>
    public string GetActivationDescription(AbilityDescriptorContext context)
    {
        _logger.LogDebug("GetActivationDescription: Ability={Ability}", context.AbilityId);

        // Try ability-specific activation first
        var description = _descriptorService.GetDescriptor(
            $"abilities.activation_{context.AbilityId}",
            context.AbilityTags);

        // Fall back to damage-type specific
        if (string.IsNullOrEmpty(description) && !string.IsNullOrEmpty(context.DamageType))
        {
            description = _descriptorService.GetDescriptor(
                $"abilities.activation_{context.DamageType}",
                context.AbilityTags);
        }

        // Fall back to generic casting
        if (string.IsNullOrEmpty(description))
        {
            description = _descriptorService.GetDescriptor("abilities.casting", context.AbilityTags);
        }

        return FormatWithCaster(description, context.CasterName) ?? $"{context.CasterName} channels power";
    }

    /// <summary>
    /// Generates an ability impact description (effect hitting target).
    /// </summary>
    /// <param name="context">The ability context.</param>
    /// <returns>A narrative description of the ability's impact.</returns>
    public string GetImpactDescription(AbilityDescriptorContext context)
    {
        _logger.LogDebug(
            "GetImpactDescription: Ability={Ability}, DamageType={DamageType}",
            context.AbilityId, context.DamageType);

        // Try damage-type specific effect pool
        if (!string.IsNullOrEmpty(context.DamageType))
        {
            var effectDescription = _descriptorService.GetDescriptor(
                $"abilities.effects_{context.DamageType}",
                context.AbilityTags);

            if (!string.IsNullOrEmpty(effectDescription))
            {
                return FormatWithTarget(effectDescription, context.TargetName) ?? effectDescription;
            }
        }

        // Fall back to generic impact
        var impact = _descriptorService.GetDescriptor("abilities.impact", context.AbilityTags);
        return FormatWithTarget(impact, context.TargetName) ?? "The ability takes effect";
    }

    /// <summary>
    /// Generates an ability aftermath description (lingering effects).
    /// </summary>
    /// <param name="context">The ability context.</param>
    /// <returns>A narrative description of lingering effects, or null if none.</returns>
    public string? GetAftermathDescription(AbilityDescriptorContext context)
    {
        if (context.AppliedEffects.Count == 0) return null;

        var description = _descriptorService.GetDescriptor("abilities.duration", context.AbilityTags);
        return description;
    }

    /// <summary>
    /// Generates a complete ability use narrative combining all phases.
    /// </summary>
    /// <param name="context">The ability context.</param>
    /// <returns>A complete narrative of the ability use.</returns>
    public string GetCompleteAbilityNarrative(AbilityDescriptorContext context)
    {
        var parts = new List<string>();

        var activation = GetActivationDescription(context);
        if (!string.IsNullOrEmpty(activation))
            parts.Add(activation);

        var impact = GetImpactDescription(context);
        if (!string.IsNullOrEmpty(impact))
            parts.Add(impact);

        var aftermath = GetAftermathDescription(context);
        if (!string.IsNullOrEmpty(aftermath))
            parts.Add(aftermath);

        return string.Join(" ", parts);
    }

    /// <summary>
    /// Generates a status effect application description.
    /// </summary>
    /// <param name="effectId">The status effect identifier.</param>
    /// <param name="targetName">The target's name.</param>
    /// <returns>A description of the status effect being applied.</returns>
    public string GetStatusEffectAppliedDescription(string effectId, string targetName)
    {
        var description = _descriptorService.GetDescriptor($"status.applied_{effectId}");

        if (string.IsNullOrEmpty(description))
        {
            description = _descriptorService.GetDescriptor("status.applied_generic");
        }

        return FormatWithTarget(description, targetName) ?? $"{targetName} is affected by {effectId}";
    }

    /// <summary>
    /// Generates a status effect removal description.
    /// </summary>
    /// <param name="effectId">The status effect identifier.</param>
    /// <param name="targetName">The target's name.</param>
    /// <returns>A description of the status effect being removed.</returns>
    public string GetStatusEffectRemovedDescription(string effectId, string targetName)
    {
        var description = _descriptorService.GetDescriptor($"status.removed_{effectId}");

        if (string.IsNullOrEmpty(description))
        {
            description = _descriptorService.GetDescriptor("status.removed_generic");
        }

        return FormatWithTarget(description, targetName) ?? $"The {effectId} effect on {targetName} fades";
    }

    private string? FormatWithCaster(string? template, string casterName)
    {
        if (string.IsNullOrEmpty(template)) return null;
        return template.Replace("{caster}", casterName);
    }

    private string? FormatWithTarget(string? template, string? targetName)
    {
        if (string.IsNullOrEmpty(template)) return null;
        if (string.IsNullOrEmpty(targetName)) return template;
        return template.Replace("{target}", targetName);
    }
}
```

### 4.3 Service Integration Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    COMBAT HIT DESCRIPTION FLOW                  │
└─────────────────────────────────────────────────────────────────┘

    CombatService.ResolveCombatRound()
           │
           ▼
    CombatDescriptorService.GetHitDescription(context)
           │
           ├── Determine pool path
           │   ├── Critical? → "combat.critical_{weapon}" or "combat.critical_hit"
           │   └── Normal? → "combat.hit_{weapon}" or "combat.hit_descriptions"
           │
           ├── Get action descriptor
           │   └── DescriptorService.GetDescriptor(poolPath, tags, context)
           │
           ├── Get damage tier descriptor
           │   └── DescriptorService.GetDescriptor("combat.damage_tier_{tier}")
           │
           ├── Get damage type flavor (if not physical)
           │   └── DescriptorService.GetDescriptor("combat.damage_type_{type}")
           │
           └── Format complete description
                   │
                   ▼
           "Thorin slashes the Goblin with his sword, striking true. Fire sears the wound!"
```

---

## 5. Command Changes

### 5.1 No New Commands

This phase does not introduce new player commands. Combat descriptions are automatically enhanced when attacks, abilities, and deaths occur.

### 5.2 Enhanced CombatService Integration

The existing `CombatService.GetCombatDescription()` method will be updated to use `CombatDescriptorService`:

```csharp
// In CombatService:
public string GetCombatDescription(
    CombatResult result,
    string playerName,
    string monsterName,
    CombatDescriptorContext? context = null)
{
    if (context == null)
    {
        // Fall back to simple description
        return GetSimpleCombatDescription(result, playerName, monsterName);
    }

    var lines = new List<string>();

    if (result.DamageDealt > 0)
    {
        var hitContext = context with { DamagePercent = /* calculate */ };
        lines.Add(_combatDescriptorService.GetHitDescription(hitContext));
    }

    if (result.MonsterDefeated)
    {
        var deathContext = new DeathDescriptorContext { /* ... */ };
        lines.Add(_combatDescriptorService.GetDeathDescription(deathContext));
    }
    else if (result.DamageReceived > 0)
    {
        // Monster counterattack description
        lines.Add(_combatDescriptorService.GetHitDescription(/* monster context */));
    }

    if (result.PlayerDefeated)
    {
        lines.Add(_combatDescriptorService.GetPlayerDeathDescription(playerName, monsterName));
    }

    return string.Join(Environment.NewLine, lines);
}
```

---

## 6. Rendering Changes

### 6.1 Enhanced Combat Display

Combat descriptions become more narrative and varied:

**Before (v0.0.10):**
```
Thorin attacks the Goblin for 12 damage!
The Goblin strikes back for 5 damage!
```

**After (v0.0.11b):**
```
Thorin drives his blade into the Goblin, striking true and wounding it!
The Goblin slashes back with its rusty dagger, grazing Thorin!
```

### 6.2 Death Description Examples

**Humanoid:**
```
With a final gasp, the Goblin crumples to the ground.
```

**Undead:**
```
The Skeleton collapses into a heap of bones, the unholy light fading from its hollow eyes.
```

**Beast:**
```
The Giant Spider lets out a keening shriek and curls into itself, motionless.
```

**Construct:**
```
The Stone Golem grinds to a halt, cracks spreading through its form before it shatters.
```

### 6.3 Ability Description Examples

**Fire Ability:**
```
Elara traces arcane gestures in the air, gathering flames in her palm.
An inferno roars to life, engulfing the Orc in searing fire!
The flames linger, crackling with residual heat.
```

**Ice Ability:**
```
Elara incants ancient words of power, frost crystallizing around her fingers.
Bitter cold bites deep, ice spreading across the Skeleton's bones!
```

---

## 7. Configuration

### 7.1 combat-hits.json (Enhanced)

**File:** `config/descriptors/combat-hits.json`

```json
{
  "category": "combat-hits",
  "pools": {
    "hit_sword": {
      "id": "hit_sword",
      "name": "Sword Hit Descriptions",
      "descriptors": [
        {
          "id": "slashes_across",
          "text": "slashes across",
          "weight": 25
        },
        {
          "id": "drives_blade",
          "text": "drives the blade into",
          "weight": 20
        },
        {
          "id": "cleaves_through",
          "text": "cleaves through",
          "weight": 15,
          "minDamagePercent": 0.5
        },
        {
          "id": "carves_wound",
          "text": "carves a wound in",
          "weight": 20
        },
        {
          "id": "thrusts_at",
          "text": "thrusts at",
          "weight": 20
        }
      ]
    },
    "hit_axe": {
      "id": "hit_axe",
      "name": "Axe Hit Descriptions",
      "descriptors": [
        {
          "id": "hews_into",
          "text": "hews into",
          "weight": 25
        },
        {
          "id": "chops_at",
          "text": "chops at",
          "weight": 25
        },
        {
          "id": "buries_axe",
          "text": "buries the axe head in",
          "weight": 15,
          "minDamagePercent": 0.5
        },
        {
          "id": "cleaves_into",
          "text": "cleaves into",
          "weight": 20
        },
        {
          "id": "splits",
          "text": "splits",
          "weight": 15,
          "minDamagePercent": 0.75
        }
      ]
    },
    "hit_bow": {
      "id": "hit_bow",
      "name": "Bow Hit Descriptions",
      "descriptors": [
        {
          "id": "arrow_pierces",
          "text": "arrow pierces",
          "weight": 25
        },
        {
          "id": "shaft_buries",
          "text": "shaft buries itself in",
          "weight": 20
        },
        {
          "id": "arrow_finds_mark",
          "text": "arrow finds its mark in",
          "weight": 25
        },
        {
          "id": "arrow_strikes",
          "text": "arrow strikes",
          "weight": 30
        }
      ]
    },
    "hit_staff": {
      "id": "hit_staff",
      "name": "Staff Hit Descriptions",
      "descriptors": [
        {
          "id": "cracks_against",
          "text": "cracks the staff against",
          "weight": 25
        },
        {
          "id": "sweeps_into",
          "text": "sweeps the staff into",
          "weight": 25
        },
        {
          "id": "brings_down",
          "text": "brings the staff down upon",
          "weight": 25
        },
        {
          "id": "jabs_at",
          "text": "jabs the staff at",
          "weight": 25
        }
      ]
    },
    "hit_dagger": {
      "id": "hit_dagger",
      "name": "Dagger Hit Descriptions",
      "descriptors": [
        {
          "id": "stabs_into",
          "text": "stabs into",
          "weight": 25
        },
        {
          "id": "slips_blade",
          "text": "slips the blade between",
          "weight": 20
        },
        {
          "id": "opens_wound",
          "text": "opens a wound in",
          "weight": 25
        },
        {
          "id": "slashes_at",
          "text": "slashes at",
          "weight": 30
        }
      ]
    },
    "hit_fist": {
      "id": "hit_fist",
      "name": "Unarmed Hit Descriptions",
      "descriptors": [
        {
          "id": "hammers_into",
          "text": "hammers a fist into",
          "weight": 25
        },
        {
          "id": "crashes_fist",
          "text": "crashes a fist into",
          "weight": 25
        },
        {
          "id": "pummels",
          "text": "pummels",
          "weight": 25
        },
        {
          "id": "strikes_hard",
          "text": "strikes hard at",
          "weight": 25
        }
      ]
    },
    "hit_mace": {
      "id": "hit_mace",
      "name": "Mace Hit Descriptions",
      "descriptors": [
        {
          "id": "smashes_into",
          "text": "smashes into",
          "weight": 25
        },
        {
          "id": "crushes",
          "text": "crushes",
          "weight": 20,
          "minDamagePercent": 0.5
        },
        {
          "id": "batters",
          "text": "batters",
          "weight": 25
        },
        {
          "id": "slams_against",
          "text": "slams the mace against",
          "weight": 30
        }
      ]
    },
    "hit_spear": {
      "id": "hit_spear",
      "name": "Spear Hit Descriptions",
      "descriptors": [
        {
          "id": "thrusts_into",
          "text": "thrusts the spear into",
          "weight": 25
        },
        {
          "id": "impales",
          "text": "impales",
          "weight": 15,
          "minDamagePercent": 0.5
        },
        {
          "id": "jabs_at",
          "text": "jabs at",
          "weight": 30
        },
        {
          "id": "skewers",
          "text": "skewers",
          "weight": 15,
          "minDamagePercent": 0.75
        }
      ]
    },
    "critical_hit": {
      "id": "critical_hit",
      "name": "Critical Hit Descriptions",
      "descriptors": [
        {
          "id": "devastating_strike",
          "text": "lands a devastating strike on",
          "weight": 25
        },
        {
          "id": "finds_weakness",
          "text": "finds a critical weakness in",
          "weight": 25
        },
        {
          "id": "perfect_blow",
          "text": "delivers a perfect blow to",
          "weight": 25
        },
        {
          "id": "strikes_vital",
          "text": "strikes a vital point on",
          "weight": 25
        }
      ]
    },
    "miss_descriptions": {
      "id": "miss_descriptions",
      "name": "Miss Descriptions",
      "descriptors": [
        {
          "id": "swings_wide",
          "text": "swings wide",
          "weight": 20
        },
        {
          "id": "is_deflected",
          "text": "is deflected away",
          "weight": 20
        },
        {
          "id": "is_dodged",
          "text": "is narrowly dodged",
          "weight": 20
        },
        {
          "id": "is_parried",
          "text": "is parried expertly",
          "weight": 20
        },
        {
          "id": "misses_completely",
          "text": "misses completely",
          "weight": 20
        }
      ]
    },
    "fumble_descriptions": {
      "id": "fumble_descriptions",
      "name": "Fumble/Critical Miss Descriptions",
      "descriptors": [
        {
          "id": "stumbles_badly",
          "text": "stumbles badly, nearly dropping their weapon",
          "weight": 25
        },
        {
          "id": "overextends",
          "text": "overextends and loses balance",
          "weight": 25
        },
        {
          "id": "weapon_slips",
          "text": "weapon slips in their grip",
          "weight": 25
        },
        {
          "id": "mistimes",
          "text": "completely mistimes the attack",
          "weight": 25
        }
      ]
    }
  }
}
```

### 7.2 combat-deaths.json

**File:** `config/descriptors/combat-deaths.json`

```json
{
  "category": "combat-deaths",
  "pools": {
    "death_humanoid": {
      "id": "death_humanoid",
      "name": "Humanoid Death Descriptions",
      "descriptors": [
        {
          "id": "crumples",
          "text": "crumples to the ground",
          "weight": 25
        },
        {
          "id": "falls_lifeless",
          "text": "falls lifeless",
          "weight": 25
        },
        {
          "id": "final_gasp",
          "text": "lets out a final gasp and collapses",
          "weight": 20
        },
        {
          "id": "slumps",
          "text": "slumps forward, defeated",
          "weight": 15
        },
        {
          "id": "topples",
          "text": "topples backward, eyes glazing over",
          "weight": 15
        }
      ]
    },
    "death_undead": {
      "id": "death_undead",
      "name": "Undead Death Descriptions",
      "descriptors": [
        {
          "id": "crumbles_bones",
          "text": "collapses into a heap of bones",
          "weight": 25
        },
        {
          "id": "unholy_fades",
          "text": "the unholy light fades from its hollow eyes as it crumbles",
          "weight": 25
        },
        {
          "id": "dissolves",
          "text": "dissolves into dust and shadow",
          "weight": 20
        },
        {
          "id": "falls_still",
          "text": "falls still, the dark magic animating it finally spent",
          "weight": 20
        },
        {
          "id": "rattles_apart",
          "text": "rattles apart, bones scattering across the floor",
          "weight": 10,
          "tags": ["skeleton"]
        }
      ]
    },
    "death_beast": {
      "id": "death_beast",
      "name": "Beast Death Descriptions",
      "descriptors": [
        {
          "id": "final_howl",
          "text": "lets out a final howl and collapses",
          "weight": 25
        },
        {
          "id": "slumps_motionless",
          "text": "slumps motionless to the ground",
          "weight": 25
        },
        {
          "id": "keening_shriek",
          "text": "lets out a keening shriek and curls into itself",
          "weight": 20
        },
        {
          "id": "thrashes",
          "text": "thrashes briefly before going still",
          "weight": 15
        },
        {
          "id": "whimpers",
          "text": "whimpers once and breathes its last",
          "weight": 15
        }
      ]
    },
    "death_construct": {
      "id": "death_construct",
      "name": "Construct Death Descriptions",
      "descriptors": [
        {
          "id": "shatters",
          "text": "shatters into fragments",
          "weight": 25
        },
        {
          "id": "grinds_halt",
          "text": "grinds to a halt, gears clicking uselessly",
          "weight": 25
        },
        {
          "id": "crumbles_rubble",
          "text": "crumbles into rubble",
          "weight": 25
        },
        {
          "id": "cracks_spread",
          "text": "cracks spread through its form before it collapses",
          "weight": 25
        }
      ]
    },
    "death_elemental": {
      "id": "death_elemental",
      "name": "Elemental Death Descriptions",
      "descriptors": [
        {
          "id": "disperses",
          "text": "disperses into wisps of energy",
          "weight": 30
        },
        {
          "id": "implodes",
          "text": "implodes in a flash of elemental power",
          "weight": 25
        },
        {
          "id": "fades",
          "text": "fades back into the ether from whence it came",
          "weight": 25
        },
        {
          "id": "dissipates",
          "text": "dissipates with a final burst of energy",
          "weight": 20
        }
      ]
    },
    "death_demon": {
      "id": "death_demon",
      "name": "Demon Death Descriptions",
      "descriptors": [
        {
          "id": "dissolves_shadows",
          "text": "dissolves into shadows with a terrible shriek",
          "weight": 25
        },
        {
          "id": "banished",
          "text": "is banished back to the void, screaming in rage",
          "weight": 25
        },
        {
          "id": "bursts_flames",
          "text": "bursts into unholy flames and is consumed",
          "weight": 25
        },
        {
          "id": "curses_dying",
          "text": "curses you with its dying breath before fading",
          "weight": 25
        }
      ]
    },
    "critical_kill": {
      "id": "critical_kill",
      "name": "Critical Kill Flair",
      "descriptors": [
        {
          "id": "with_devastating",
          "text": "With a devastating blow,",
          "weight": 25
        },
        {
          "id": "in_single_stroke",
          "text": "In a single, brutal stroke,",
          "weight": 25
        },
        {
          "id": "with_lethal_precision",
          "text": "With lethal precision,",
          "weight": 25
        },
        {
          "id": "finishing_blow",
          "text": "Delivering the finishing blow,",
          "weight": 25
        }
      ]
    },
    "player_death": {
      "id": "player_death",
      "name": "Player Death Descriptions",
      "descriptors": [
        {
          "id": "falls_battle",
          "text": "{player} has fallen in battle against the {killer}...",
          "weight": 25
        },
        {
          "id": "vision_fades",
          "text": "{player}'s vision fades as the {killer} delivers the final blow...",
          "weight": 25
        },
        {
          "id": "darkness_claims",
          "text": "Darkness claims {player} as they fall before the {killer}...",
          "weight": 25
        },
        {
          "id": "overwhelmed",
          "text": "Overwhelmed by the {killer}, {player} collapses...",
          "weight": 25
        }
      ]
    },
    "near_death_warning": {
      "id": "near_death_warning",
      "name": "Near Death Warnings (25% health)",
      "descriptors": [
        {
          "id": "blood_loss",
          "text": "Blood loss makes your vision swim.",
          "weight": 25
        },
        {
          "id": "wounds_severe",
          "text": "Your wounds are becoming severe.",
          "weight": 25
        },
        {
          "id": "legs_weak",
          "text": "Your legs feel weak beneath you.",
          "weight": 25
        },
        {
          "id": "breathing_ragged",
          "text": "Your breathing grows ragged and painful.",
          "weight": 25
        }
      ]
    },
    "near_death_critical": {
      "id": "near_death_critical",
      "name": "Critical Health Warnings (10% health)",
      "descriptors": [
        {
          "id": "verge_collapse",
          "text": "You are on the verge of collapse!",
          "weight": 25
        },
        {
          "id": "darkness_edges",
          "text": "Darkness creeps at the edges of your vision!",
          "weight": 25
        },
        {
          "id": "one_more_blow",
          "text": "One more blow may be your last!",
          "weight": 25
        },
        {
          "id": "barely_standing",
          "text": "You're barely standing!",
          "weight": 25
        }
      ]
    }
  }
}
```

### 7.3 damage-tiers.json

**File:** `config/descriptors/damage-tiers.json`

```json
{
  "category": "damage-tiers",
  "pools": {
    "damage_tier_glancing": {
      "id": "damage_tier_glancing",
      "name": "Glancing Blow (0-15%)",
      "descriptors": [
        { "id": "barely_scratches", "text": "barely scratching", "weight": 25 },
        { "id": "grazes", "text": "grazing", "weight": 25 },
        { "id": "deflects_off", "text": "deflecting off armor", "weight": 25 },
        { "id": "nicks", "text": "nicking", "weight": 25 }
      ]
    },
    "damage_tier_light": {
      "id": "damage_tier_light",
      "name": "Light Hit (15-30%)",
      "descriptors": [
        { "id": "finds_purchase", "text": "finding purchase", "weight": 25 },
        { "id": "connects", "text": "connecting solidly", "weight": 25 },
        { "id": "lands_blow", "text": "landing a blow", "weight": 25 },
        { "id": "wounds", "text": "wounding", "weight": 25 }
      ]
    },
    "damage_tier_solid": {
      "id": "damage_tier_solid",
      "name": "Solid Hit (30-50%)",
      "descriptors": [
        { "id": "strikes_true", "text": "striking true", "weight": 25 },
        { "id": "lands_solidly", "text": "landing solidly", "weight": 25 },
        { "id": "bites_deep", "text": "biting deep", "weight": 25 },
        { "id": "connects_force", "text": "connecting with force", "weight": 25 }
      ]
    },
    "damage_tier_heavy": {
      "id": "damage_tier_heavy",
      "name": "Heavy Hit (50-75%)",
      "descriptors": [
        { "id": "crashes_into", "text": "crashing into", "weight": 25 },
        { "id": "smashes_against", "text": "smashing against", "weight": 25 },
        { "id": "strikes_hard", "text": "striking hard", "weight": 25 },
        { "id": "rends", "text": "rending", "weight": 25 }
      ]
    },
    "damage_tier_devastating": {
      "id": "damage_tier_devastating",
      "name": "Devastating Hit (75-90%)",
      "descriptors": [
        { "id": "devastates", "text": "devastating", "weight": 25 },
        { "id": "shatters_defenses", "text": "shattering defenses", "weight": 25 },
        { "id": "tears_through", "text": "tearing through", "weight": 25 },
        { "id": "crushes", "text": "crushing", "weight": 25 }
      ]
    },
    "damage_tier_lethal": {
      "id": "damage_tier_lethal",
      "name": "Lethal Blow (90-100%+)",
      "descriptors": [
        { "id": "cleaves_through", "text": "cleaving through", "weight": 25 },
        { "id": "destroys", "text": "utterly destroying", "weight": 25 },
        { "id": "annihilates", "text": "annihilating", "weight": 25 },
        { "id": "ends", "text": "ending", "weight": 25 }
      ]
    }
  }
}
```

### 7.4 Configuration Schema Summary

| Property | Type | Description |
|----------|------|-------------|
| `weaponTypes` | string[] | Weapon types this descriptor applies to |
| `damageTypes` | string[] | Damage types this descriptor applies to |
| `creatureCategories` | string[] | Creature categories for death descriptors |
| `criticalOnly` | boolean | Only use for critical hits |
| `missOnly` | boolean | Only use for misses/fumbles |
| `minDamagePercent` | number | Minimum damage percentage (0.0-1.0) |
| `maxDamagePercent` | number | Maximum damage percentage (0.0-1.0) |

---

## 8. Acceptance Criteria

### 8.1 Combat Descriptors

- [ ] Weapon-type specific hit pools implemented (8 weapon types)
- [ ] Hit descriptions selected based on equipped weapon type
- [ ] Damage tier descriptions scale with damage percentage (6 tiers)
- [ ] Critical hit descriptions use dedicated pool
- [ ] Miss descriptions vary (dodge, parry, block, whiff)
- [ ] Fumble descriptions for critical misses

### 8.2 Death Descriptors

- [ ] Monster death descriptions vary by creature category (6 categories)
- [ ] Death descriptions filtered by monster tags
- [ ] Critical kill descriptions include flair prefix
- [ ] Player death descriptions use template placeholders
- [ ] Near-death warnings at 25% and 10% health

### 8.3 Ability Descriptors

- [ ] Ability activation descriptions implemented
- [ ] Ability impact descriptions per damage type
- [ ] Ability aftermath descriptions for lingering effects
- [ ] Status effect application descriptions
- [ ] Status effect removal descriptions

### 8.4 Integration

- [ ] CombatDescriptorService integrates with CombatService
- [ ] AbilityDescriptorService integrates with AbilityService
- [ ] Environment context passed through for biome-aware descriptors
- [ ] Fallback to generic pools when specific pools empty

### 8.5 General

- [ ] ~15 unit tests pass
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] Existing combat flow unchanged (enhanced output only)

---

## 9. Test Specifications

### 9.1 Unit Tests (~15 tests)

#### CombatDescriptorServiceTests.cs

```csharp
[TestFixture]
public class CombatDescriptorServiceTests
{
    [Test]
    public void GetHitDescription_WithWeaponType_UsesWeaponPool();

    [Test]
    public void GetHitDescription_WithoutWeaponType_UsesGenericPool();

    [Test]
    public void GetHitDescription_WhenCritical_UsesCriticalPool();

    [Test]
    public void GetMissDescription_WhenFumble_UsesFumblePool();

    [Test]
    public void GetMissDescription_NormalMiss_UsesMissPool();

    [Test]
    public void GetDeathDescription_ByCreatureCategory_UsesCorrectPool();

    [Test]
    public void GetDeathDescription_WithCriticalKill_IncludesFlair();

    [Test]
    public void GetNearDeathDescription_AtLowHealth_ReturnsWarning();

    [Test]
    public void GetNearDeathDescription_AtNormalHealth_ReturnsNull();
}
```

#### AbilityDescriptorServiceTests.cs

```csharp
[TestFixture]
public class AbilityDescriptorServiceTests
{
    [Test]
    public void GetActivationDescription_WithDamageType_UsesDamageTypePool();

    [Test]
    public void GetImpactDescription_WithFireDamage_UsesFireEffects();

    [Test]
    public void GetAftermathDescription_WithAppliedEffects_ReturnsDescription();

    [Test]
    public void GetStatusEffectAppliedDescription_FormatsCorrectly();

    [Test]
    public void GetStatusEffectRemovedDescription_FormatsCorrectly();

    [Test]
    public void GetCompleteAbilityNarrative_CombinesAllPhases();
}
```

---

## 10. Dependencies

### 10.1 Required from v0.0.11a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `EnvironmentContext` | `Domain/ValueObjects/EnvironmentContext.cs` | Biome-aware descriptors |
| `DescriptorService` | `Application/Services/DescriptorService.cs` | Base descriptor selection |
| `DescriptorContext` | `Application/Services/DescriptorService.cs` | Extended for combat context |

### 10.2 Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `CombatService` | `Domain/Services/CombatService.cs` | Integration point for descriptors |
| `AbilityService` | `Application/Services/AbilityService.cs` | Integration point for ability descriptors |
| `MonsterDefinition.Tags` | v0.0.9a | Creature category tags |
| `AIBehavior` | v0.0.6b | Monster behavior context |

### 10.3 Provides to v0.0.11c

| Type | Usage |
|------|-------|
| `CombatDescriptorContext` | May reference environment for sensory effects |
| `DamageTier` enum | Could influence environmental reactions |

---

## 11. Files Summary

### 11.1 New Files

| File | Purpose |
|------|---------|
| `src/Core/RuneAndRust.Application/Services/CombatDescriptorService.cs` | Combat descriptor generation |
| `src/Core/RuneAndRust.Application/Services/AbilityDescriptorService.cs` | Ability descriptor generation |
| `config/descriptors/combat-hits.json` | Weapon-type hit descriptors |
| `config/descriptors/combat-deaths.json` | Death descriptors by category |
| `config/descriptors/damage-tiers.json` | Damage tier descriptors |
| `tests/RuneAndRust.Application.UnitTests/Services/CombatDescriptorServiceTests.cs` | Combat tests |
| `tests/RuneAndRust.Application.UnitTests/Services/AbilityDescriptorServiceTests.cs` | Ability tests |

### 11.2 Modified Files

| File | Changes |
|------|---------|
| `DescriptorConfiguration.cs` | Add weapon/damage/creature category fields |
| `CombatService.cs` | Integrate CombatDescriptorService |
| `AbilityService.cs` | Integrate AbilityDescriptorService |
| `config/descriptors/combat.json` | Enhanced with new pools |
| `config/descriptors/abilities.json` | Enhanced with activation/impact pools |
| `DependencyInjection.cs` | Register new services |

---

*This design specification establishes rich, varied combat narratives that respond to weapon types, damage severity, creature categories, and ability characteristics. The descriptor system creates immersive combat experiences while remaining fully configurable through JSON.*
