# v0.0.4 Design Specification: Player Classes & Abilities

## Overview

**Version:** 0.0.4
**Status:** Implemented
**Focus:** Data-driven class system with configurable abilities and resources
**Prerequisites:** v0.0.3 (Player Creation & Identity)

---

## Sub-Part Breakdown

v0.0.4 is divided into four sub-parts to manage complexity:

| Sub-Part | Focus | Key Deliverables |
|----------|-------|------------------|
| **v0.0.4a** | Archetype & Class Foundations | ArchetypeDefinition, ClassDefinition, class selection UI |
| **v0.0.4b** | Resource Pool System | ResourceTypeDefinition, ResourcePool, class-specific resources |
| **v0.0.4c** | Ability System | AbilityDefinition, ability costs, cooldowns, effects |
| **v0.0.4d** | Integration & Polish | Ability command, combat integration, full testing |

---

## v0.0.4a - Archetype & Class Foundations

[Design Specification](v0.0.4a-design-specification.md)

[v0.0.4a Changelog](../../changelogs/v0.0.4a-changelog.md)

**Goal:** Establish the data-driven class hierarchy with archetypes and specializations.

### Features
- [ ] **ArchetypeDefinition** - Base class types (Warrior, Skirmisher, Adept, Mystic)
- [ ] **ClassDefinition** - Specialized classes derived from archetypes
- [ ] **Class-Specific Stats** - Base stats and growth rates per class
- [ ] **Class Selection UI** - TUI class selection during character creation
- [ ] **Class Requirements** - Optional race/stat prerequisites

### Default Archetypes & Classes
```
Warrior (Archetype)
└── Shieldmaiden - Defensive tank, high HP/DEF

Skirmisher (Archetype)
└── Shadow-Walker - Agile rogue, high finesse/crit

Adept (Archetype)
└── Scrap-Tinker - Resourceful crafter, utility focus

Mystic (Archetype)
├── Galdr-Caster - Offensive magic, high spell damage
└── Blood-Priest - Support/healing, resource manipulation
```

### New Domain Entities
- `ArchetypeDefinition` - Loaded from JSON
- `ClassDefinition` - Loaded from JSON, references archetype
- `PlayerClass` - Player's selected class instance

### Configuration Files
- `config/archetypes.json`
- `config/classes.json`

### Unit Tests (~25 tests)
- ArchetypeDefinition loading and validation
- ClassDefinition loading and validation
- Class selection during character creation
- Class stat modifiers applied correctly
- Class requirements enforcement

---

## v0.0.4b - Resource Pool System

[Design Specification](v0.0.4b-design-specification.md)

[v0.0.4b Changelog](../../changelogs/v0.0.4b-changelog.md)

**Goal:** Implement class-specific resource pools beyond Health.

### Features
- [ ] **ResourceTypeDefinition** - Configurable resource types (Mana, Rage, Energy, Faith)
- [ ] **ResourcePool** - Value object tracking current/max values
- [ ] **Resource Regeneration** - Per-turn regen, decay, build-on-hit mechanics
- [ ] **Class-Resource Binding** - Classes define which resources they use
- [ ] **Resource Display** - Show resources in status command

### Default Resource Types
| Resource | Display Name | Class | Mechanic |
|----------|--------------|-------|----------|
| health | Vitality | All | Universal, no natural regen |
| mana | Arcane Power | Galdr-Caster | Regenerates per turn |
| rage | Fury | Shieldmaiden | Builds on hit, decays over time |
| energy | Stamina | Shadow-Walker | Fast regeneration |
| faith | Divine Favor | Blood-Priest | Builds from healing/support |
| focus | Concentration | Scrap-Tinker | Steady regen, spent on gadgets |

### New Domain Entities
- `ResourceTypeDefinition` - Loaded from JSON
- `ResourcePool` - Value object (current, max, regen rate)
- `PlayerResources` - Dictionary of resource pools keyed by type ID

### Configuration Files
- `config/resources.json`

### Unit Tests (~30 tests)
- ResourceTypeDefinition loading and validation
- ResourcePool creation and modification
- Resource regeneration calculations
- Resource decay mechanics
- Build-on-hit resource gain
- Class-resource binding validation

---

## v0.0.4c - Ability System

[Design Specification](v0.0.4c-design-specification.md)

[v0.0.4c Changelog](../../changelogs/v0.0.4c-changelog.md)

**Goal:** Define and implement data-driven abilities with costs, cooldowns, and effects.

### Features
- [ ] **AbilityDefinition** - Data-driven abilities loaded from JSON
- [ ] **Ability Costs** - Resource costs (which resource, how much)
- [ ] **Ability Cooldowns** - Turns between uses
- [ ] **Ability Effects** - Damage, healing, buffs, debuffs
- [ ] **Class-Ability Binding** - Classes define available abilities
- [ ] **Ability Unlocks** - Abilities unlock at specific levels

### Default Abilities (Per Class)

**Shieldmaiden:**
- Shield Bash (15 Rage) - Deals damage + stun chance
- Taunt (10 Rage) - Forces enemy to attack you
- Fortify (20 Rage) - Increases defense for 3 turns

**Shadow-Walker:**
- Backstab (25 Energy) - High damage from stealth
- Shadowstep (15 Energy) - Teleport behind enemy
- Poison Blade (20 Energy) - Apply poison DoT

**Galdr-Caster:**
- Flame Bolt (15 Mana) - Fire damage, single target
- Frost Nova (25 Mana) - Ice damage, AOE + slow
- Arcane Shield (20 Mana) - Absorb damage for 2 turns

**Blood-Priest:**
- Healing Word (20 Faith) - Restore HP
- Smite (15 Faith) - Holy damage
- Sanctuary (30 Faith) - Damage reduction aura

**Scrap-Tinker:**
- Deploy Turret (25 Focus) - Summon attacking turret
- Repair Kit (15 Focus) - Heal over time
- Smoke Bomb (20 Focus) - Escape combat/blind enemies

### New Domain Entities
- `AbilityDefinition` - Loaded from JSON
- `AbilityEffect` - Describes what the ability does
- `AbilityCost` - Resource type + amount
- `PlayerAbility` - Player's ability instance with cooldown tracking

### Configuration Files
- `config/abilities.json`

### Unit Tests (~40 tests)
- AbilityDefinition loading and validation
- Ability cost calculations
- Cooldown tracking and reset
- Effect application (damage, healing, buffs)
- Class-ability binding
- Level-based ability unlocks

---

## v0.0.4d - Integration & Polish

[Design Specification](v0.0.4d-design-specification.md)

[v0.0.4d Changelog](../../changelogs/v0.0.4d-changelog.md)

**Goal:** Wire everything together with commands and combat integration.

### Features
- [ ] **Ability Command** - `ability <name>` or `skill <name>` to use abilities
- [ ] **Abilities Command** - List available abilities with costs/cooldowns
- [ ] **Combat Integration** - Use abilities during combat
- [ ] **Resource Management** - Spend/regenerate resources during gameplay
- [ ] **Turn Processing** - Regeneration/decay at turn boundaries

### New Commands
| Command | Description |
|---------|-------------|
| `ability <name>` | Use a specific ability |
| `skill <name>` | Alias for ability |
| `abilities` | List all available abilities |
| `skills` | Alias for abilities |

### Workflow: Using an Ability in Combat
```
┌─────────────────────────────────────────────────────────────┐
│                    ABILITY USAGE FLOW                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Player: "ability flame bolt"                               │
│           │                                                 │
│           ▼                                                 │
│  ┌─────────────────┐                                        │
│  │ Parse Command   │                                        │
│  └────────┬────────┘                                        │
│           │                                                 │
│           ▼                                                 │
│  ┌─────────────────┐    No     ┌──────────────────┐        │
│  │ Has Ability?    │─────────► │ "Unknown ability" │        │
│  └────────┬────────┘           └──────────────────┘        │
│           │ Yes                                             │
│           ▼                                                 │
│  ┌─────────────────┐    No     ┌──────────────────┐        │
│  │ Off Cooldown?   │─────────► │ "On cooldown (N)" │        │
│  └────────┬────────┘           └──────────────────┘        │
│           │ Yes                                             │
│           ▼                                                 │
│  ┌─────────────────┐    No     ┌──────────────────┐        │
│  │ Has Resources?  │─────────► │ "Not enough X"   │        │
│  └────────┬────────┘           └──────────────────┘        │
│           │ Yes                                             │
│           ▼                                                 │
│  ┌─────────────────┐                                        │
│  │ Deduct Cost     │                                        │
│  │ Start Cooldown  │                                        │
│  │ Apply Effects   │                                        │
│  └────────┬────────┘                                        │
│           │                                                 │
│           ▼                                                 │
│  ┌─────────────────┐                                        │
│  │ Return Result   │                                        │
│  └─────────────────┘                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Unit Tests (~35 tests)
- Ability command parsing
- Ability usage validation
- Resource deduction on use
- Cooldown application and tracking
- Combat integration
- Turn-based resource regeneration
- Error message accuracy

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────────┤
│  ClassSelectionView    AbilityCommandHandler    StatusView (updated)    │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           APPLICATION LAYER                             │
├─────────────────────────────────────────────────────────────────────────┤
│  ClassService          AbilityService          ResourceService          │
│  ├─ GetArchetypes()    ├─ GetAbilities()       ├─ GetResources()        │
│  ├─ GetClasses()       ├─ UseAbility()         ├─ SpendResource()       │
│  └─ SelectClass()      └─ GetCooldowns()       └─ RegenerateResources() │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                             DOMAIN LAYER                                │
├─────────────────────────────────────────────────────────────────────────┤
│  ENTITIES                        VALUE OBJECTS                          │
│  ├─ ArchetypeDefinition          ├─ ResourcePool                        │
│  ├─ ClassDefinition              ├─ AbilityCost                         │
│  ├─ ResourceTypeDefinition       └─ AbilityEffect                       │
│  ├─ AbilityDefinition                                                   │
│  └─ PlayerAbility                                                       │
├─────────────────────────────────────────────────────────────────────────┤
│  SERVICES                                                               │
│  └─ AbilityEffectResolver                                               │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          INFRASTRUCTURE LAYER                           │
├─────────────────────────────────────────────────────────────────────────┤
│  ConfigurationLoader (archetypes.json, classes.json, resources.json,    │
│                       abilities.json)                                   │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## Configuration File Summary

| File | Purpose | Sub-Part |
|------|---------|----------|
| `config/archetypes.json` | Base class type definitions | v0.0.4a |
| `config/classes.json` | Specialized class definitions | v0.0.4a |
| `config/resources.json` | Resource type definitions | v0.0.4b |
| `config/abilities.json` | Ability definitions | v0.0.4c |

---

## Data Model Changes Summary

### Player Entity Updates
```csharp
public class Player
{
    // Existing properties...

    // v0.0.4a additions
    public string ArchetypeId { get; private set; }
    public string ClassId { get; private set; }

    // v0.0.4b additions
    public Dictionary<string, ResourcePool> Resources { get; private set; }

    // v0.0.4c additions
    public List<PlayerAbility> Abilities { get; private set; }
}
```

---

## Test Summary

| Sub-Part | Test Count | Focus Areas |
|----------|------------|-------------|
| v0.0.4a | ~25 | Archetype/class loading, selection, stat modifiers |
| v0.0.4b | ~30 | Resource pools, regeneration, decay, class binding |
| v0.0.4c | ~40 | Abilities, costs, cooldowns, effects |
| v0.0.4d | ~35 | Commands, combat integration, turn processing |
| **Total** | **~130** | |

---

## Implementation Order

```
v0.0.4a ──► v0.0.4b ──► v0.0.4c ──► v0.0.4d
   │           │           │           │
   │           │           │           └─► Full integration tests
   │           │           └─► Ability unit tests
   │           └─► Resource unit tests
   └─► Class/archetype unit tests
```

Each sub-part should be completed and tested before moving to the next. v0.0.4d cannot begin until all other sub-parts are complete.

---

## Detailed Sub-Part Specifications

Detailed design specifications for each sub-part will be created in separate documents:

- [v0.0.4a-design-specification.md](v0.0.4a-design-specification.md) - Archetype & Class Foundations
- [v0.0.4b-design-specification.md](v0.0.4b-design-specification.md) - Resource Pool System
- [v0.0.4c-design-specification.md](v0.0.4c-design-specification.md) - Ability System
- [v0.0.4d-design-specification.md](v0.0.4d-design-specification.md) - Integration & Polish

---

## Acceptance Criteria (High-Level)

### v0.0.4a Complete When:
- [ ] Archetypes load from JSON configuration
- [ ] Classes load from JSON with archetype references
- [ ] Class selection works during character creation
- [ ] Class stat modifiers apply to player
- [ ] All v0.0.4a unit tests pass

### v0.0.4b Complete When:
- [ ] Resource types load from JSON configuration
- [ ] Players have class-appropriate resource pools
- [ ] Resources regenerate/decay correctly per turn
- [ ] Resources display in status command
- [ ] All v0.0.4b unit tests pass

### v0.0.4c Complete When:
- [ ] Abilities load from JSON configuration
- [ ] Abilities have correct costs and cooldowns
- [ ] Ability effects apply correctly
- [ ] Class-ability binding works
- [ ] All v0.0.4c unit tests pass

### v0.0.4d Complete When:
- [ ] `ability` command works in and out of combat
- [ ] `abilities` command lists available abilities
- [ ] Resources deduct on ability use
- [ ] Cooldowns track correctly across turns
- [ ] Turn processing handles regen/decay
- [ ] All v0.0.4d unit tests pass
- [ ] All integration tests pass

---

## Dependencies

### From v0.0.3:
- Player creation wizard (for class selection step)
- Race definitions (for class requirements)
- Attribute definitions (for stat calculations)
- Configuration loading infrastructure

### For v0.0.5+:
- v0.0.5 (Dice Pool System) will use abilities for skill checks
- v0.0.6 (Enhanced Combat) will expand ability effects
- v0.0.8 (Experience & Leveling) will unlock abilities at levels
