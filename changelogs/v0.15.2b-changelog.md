# v0.15.2b Changelog - Leaping System

**Release Date:** 2026-01-22
**Parent Version:** v0.15.2 (Acrobatics Skill Expansion)
**Prerequisite:** v0.15.2a (Climbing System)

---

## Summary

Version 0.15.2b implements the **Leaping System**, enabling distance-based horizontal traversal mechanics. Characters can now leap across gaps with DC calculations based on distance categories, modifiers for running starts, landing types, and environmental factors. The system integrates with the fumble consequence system via **[The Long Fall]**.

---

## Added

### Domain Layer

#### Enums
- **`LeapDistance`** (`src/Core/RuneAndRust.Domain/Enums/LeapDistance.cs`)
  - Five distance categories: Short (5ft), Medium (10ft), Long (15ft), Extreme (20ft), Heroic (25ft)
  - Each category maps to a base DC (1-5 successes required)

- **`LandingType`** (`src/Core/RuneAndRust.Domain/Enums/LandingType.cs`)
  - Five landing surface types: Normal, Precision, Glitched, PrecisionGlitched, Downward
  - DC modifiers: Precision (+1), Glitched (+2), PrecisionGlitched (+3), Downward (-1)

#### Extensions
- **`LeapDistanceExtensions`** (`src/Core/RuneAndRust.Domain/Extensions/LeapDistanceExtensions.cs`)
  - `GetBaseDc()` - Returns base DC for category
  - `GetMaxFeet()` / `GetMinFeet()` - Returns feet boundaries
  - `GetBaseStaminaCost()` - Returns stamina cost
  - `GetDescription()` / `GetDisplayName()` - Human-readable strings
  - `FromFeet(int)` - Converts feet to category
  - `RequiresMasterRank()` - Heroic distance indicator

- **`LandingTypeExtensions`** (`src/Core/RuneAndRust.Domain/Extensions/LandingTypeExtensions.cs`)
  - `GetDcModifier()` - Returns DC adjustment
  - `GetDescription()` / `GetDisplayName()` - Human-readable strings
  - `IsGlitched()` / `IsPrecision()` / `IsAssisted()` - Type queries

#### Value Objects
- **`LeapContext`** (`src/Core/RuneAndRust.Domain/ValueObjects/LeapContext.cs`)
  - Encapsulates all leap parameters: distance, running start, landing type, encumbrance, gravity, fall depth
  - Computed properties: `DistanceCategory`, `BaseDc`, `TotalDcModifier`, `FinalDc`, `BaseStaminaCost`
  - Factory methods: `Simple()`, `WithRunningStart()`, `PrecisionLanding()`, `GlitchedLanding()`, `Downward()`

- **`LeapResult`** (`src/Core/RuneAndRust.Domain/ValueObjects/LeapResult.cs`)
  - Captures leap outcome: success/failure status, stamina cost, fumble effects
  - Factory methods: `Success()`, `Failure()`, `Fumble()`
  - Integrates with `FallResult` from v0.15.2a

### Application Layer

#### Interfaces
- **`ILeapingService`** (`src/Core/RuneAndRust.Application/Interfaces/ILeapingService.cs`)
  - `AttemptLeap()` - Main leap operation
  - `CalculateDc()` - DC calculation with modifiers
  - `GetDistanceCategory()` / `GetBaseDc()` - Category utilities
  - `GetStaminaCost()` - Outcome-modified stamina
  - `RequiresMasterRank()` - Heroic distance check

#### Services
- **`LeapingService`** (`src/Core/RuneAndRust.Application/Services/LeapingService.cs`)
  - Full implementation of leaping mechanics
  - Distance-to-DC mapping with modifier calculation
  - Outcome determination (Critical Success, Success, Marginal, Failure, Fumble)
  - Integration with `IFumbleConsequenceService` for [The Long Fall]
  - Exhaustive structured logging at Information and Debug levels

### Configuration

- **`leap-distances.json`** (`config/leap-distances.json`)
  - Distance categories with DC and stamina costs
  - DC modifiers: running start, standing jump, precision, glitched, encumbered, low gravity, downward
  - Landing types with DC adjustments
  - Outcome definitions including fumble effects

- **`leap-distances.schema.json`** (`config/schemas/leap-distances.schema.json`)
  - JSON Schema Draft-2020-12 validation
  - Definitions: DistanceCategory, DcModifier, LandingType, Outcome, FumbleOutcome, Defaults

### Testing

- **`LeapingServiceTests`** (`tests/RuneAndRust.Application.UnitTests/Services/LeapingServiceTests.cs`)
  - 32 test cases covering:
    - Distance-to-DC mapping (Short→1, Medium→2, Long→3, Extreme→4, Heroic→5)
    - DC modifier tests (running start, precision, glitched, downward, encumbered, low gravity, minimum DC)
    - Leap attempt outcomes (success, failure, fumble, critical success, marginal success)
    - Stamina cost calculations
    - Master rank requirement checks

---

## Mechanics

### Distance-to-DC Mapping

| Distance | Category | Base DC | Stamina |
|----------|----------|---------|---------|
| 1-5ft    | Short    | 1       | 1       |
| 6-10ft   | Medium   | 2       | 1       |
| 11-15ft  | Long     | 3       | 2       |
| 16-20ft  | Extreme  | 4       | 2       |
| 21-25ft  | Heroic   | 5       | 3       |

### DC Modifiers

| Modifier | Effect | Condition |
|----------|--------|-----------|
| Running Start | -1 DC | 10ft clear run-up |
| Standing Jump | +1 DC | No run-up space |
| Precision | +1 DC | Landing < 5ft wide |
| Glitched | +2 DC | Corruption-affected |
| Encumbered | +1 DC | Over capacity |
| [Low Gravity] | -1 DC | Environmental |
| Downward | -1 DC | Lower elevation |

*Minimum DC is always 1.*

### Outcomes

| Outcome | Condition | Effect |
|---------|-----------|--------|
| Critical Success | Margin ≥5 or dice critical | Half stamina |
| Full Success | Margin ≥1 | Normal stamina |
| Marginal Success | Margin = 0 | +1 stamina |
| Failure | Margin < 0 | Fall (FallDepth) |
| Fumble | 0 successes + botch | [The Long Fall] |

### [The Long Fall] Fumble

- +1d10 bonus fall damage
- +2 Stress
- [Disoriented] for 2 rounds (-2d10 to checks)
- Creates FumbleConsequence record

---

## Dependencies

### From v0.15.0 (Dice Pool Refactor)
- `DicePool`, `DiceRollResult`, `IDiceService`

### From v0.15.1b (Outcome Classification)
- `SkillOutcome`, `FumbleType.TheLongFall`

### From v0.15.2a (Climbing System)
- `FallResult`, `FallSource.Leaping`

---

## Files Changed

### New Files (10)
- `src/Core/RuneAndRust.Domain/Enums/LeapDistance.cs`
- `src/Core/RuneAndRust.Domain/Enums/LandingType.cs`
- `src/Core/RuneAndRust.Domain/Extensions/LeapDistanceExtensions.cs`
- `src/Core/RuneAndRust.Domain/Extensions/LandingTypeExtensions.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/LeapContext.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/LeapResult.cs`
- `src/Core/RuneAndRust.Application/Interfaces/ILeapingService.cs`
- `src/Core/RuneAndRust.Application/Services/LeapingService.cs`
- `config/leap-distances.json`
- `config/schemas/leap-distances.schema.json`

### Test Files (1)
- `tests/RuneAndRust.Application.UnitTests/Services/LeapingServiceTests.cs`

---

## Quality Metrics

| Metric | Value |
|--------|-------|
| Build Errors | 0 |
| Build Warnings | 0 |
| Unit Tests | 32 |
| Test Pass Rate | 100% |

---

## Next Version

**v0.15.2c: Fall Damage System** - Implements the damage calculation and Crash Landing mechanics that consume the `FallResult` value objects created by both climbing and leaping systems.
