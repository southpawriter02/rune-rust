# v0.0.8c Changelog - Progression Configuration

**Date:** 2026-01-08

## Summary

Transforms the hardcoded progression system into a fully configurable, data-driven system via `progression.json`. Enables customizable XP curves, terminology, stat bonuses, level caps, milestone titles, and custom rewards.

## Added

### Domain Layer - Enums (New)

- `ProgressionCurve` enum:
  - `Linear` - Level N = N * BaseXP (e.g., Level 2 = 200, Level 3 = 300)
  - `Exponential` - Cumulative sum with multiplier
  - `Custom` - Per-level overrides with linear fallback

### Domain Layer - Definitions (New)

- `StatBonusConfig` class:
  - Properties: MaxHealth, Attack, Defense (mutable for JSON binding)
  - Default values: +5 HP, +1 ATK, +1 DEF
  - `ToLevelStatModifiers()` conversion method

- `LevelDefinition` class:
  - Properties: Level, XpRequired?, StatBonuses?, CustomRewards[], Title?
  - Per-level configuration for milestones and overrides

- `ProgressionDefinition` class:
  - Properties: ExperienceTerminology, LevelTerminology, MaxLevel, CurveType, BaseXpRequirement, XpMultiplier, DefaultStatBonuses, LevelOverrides, HealOnLevelUp
  - `Default` static property - default configuration
  - `GetExperienceForLevel(int)` - XP threshold calculation
  - `GetLevelForExperience(int)` - reverse level lookup
  - `GetStatBonusesForLevel(int, classGrowthRates?)` - stat increases per level

### Domain Layer - Entities (Modified)

- `Player` entity enhancements:
  - `GetExperienceForLevel(int, ProgressionDefinition?)` - now accepts optional config
  - `GetLevelForExperience(int, ProgressionDefinition?)` - now accepts optional config
  - `GetExperienceToNextLevel(ProgressionDefinition?)` - instance method with config support

### Domain Layer - Services (Modified)

- `ProgressionService` enhancements:
  - Constructor overload accepting `ProgressionDefinition`
  - `Progression` property - exposes configuration
  - `CheckForLevelUp(Player, classGrowthRates?)` - respects max level cap
  - `GetStatIncreasesForLevels(from, to, classGrowthRates?)` - uses config bonuses
  - `GetExperienceForNextLevel(int)` - instance method using config curve
  - `GetExperienceUntilNextLevel(Player)` - instance method using config
  - `GetCustomRewardsForLevel(int)` - retrieves level rewards
  - `GetTitleForLevel(int)` - retrieves milestone titles

### Application Layer - Interfaces (Modified)

- `IGameConfigurationProvider` interface:
  - Added `GetProgressionConfiguration()` method

### Application Layer - DTOs (Modified)

- `ExperienceGainDto` record:
  - Added `ExperienceTerminology` property (default "XP")
  - Added `LevelTerminology` property (default "Level")

- `LevelUpDto` record:
  - Added `CustomRewards` property (IReadOnlyList<string>)
  - Added `Title` property (string?)
  - Added `ExperienceTerminology` property (default "XP")
  - Added `LevelTerminology` property (default "Level")
  - Added computed: `HasCustomRewards`, `HasTitle`

### Application Layer - Services (Modified)

- `GameSessionService` enhancements:
  - Loads progression config from provider
  - Creates ProgressionService with config
  - Passes terminology to ExperienceGainDto
  - Passes rewards, title, and terminology to LevelUpDto

### Infrastructure Layer (Modified)

- `JsonConfigurationProvider` enhancements:
  - Added `_progression` caching field
  - Added `GetProgressionConfiguration()` implementation
  - Added `ProgressionJsonConfig` internal class
  - Added `LevelDefinitionJsonConfig` internal class
  - Graceful fallback to defaults when file not found

### Presentation Layer - Adapters (Modified)

- `SpectreGameRenderer` enhancements:
  - `RenderExperienceGainAsync()` uses configurable terminology
  - `RenderLevelUpAsync()` enhancements:
    - Dynamic panel header with terminology ("LEVEL UP!" / "RANK UP!")
    - Title display for milestone levels
    - Custom rewards section
    - Configurable terminology throughout

### Configuration (New)

- `config/progression.json`:
  - Default configuration file
  - Linear curve with BaseXP=100
  - MaxLevel=20
  - Milestone titles at levels 5, 10, 15, 20
  - Custom rewards at each milestone

## Tests Added

| Test File | Count |
|-----------|-------|
| `ProgressionDefinitionTests.cs` | 21 |
| `ProgressionServiceConfigTests.cs` | 19 |
| **Total New** | 40 |

## Test Results

```
Domain Tests:      494 passed (+39)
Application Tests: 117 passed
Architecture Tests:  8 passed
Total:             619 passed
```

## Configuration System

### progression.json Structure

```json
{
  "experienceTerminology": "XP",
  "levelTerminology": "Level",
  "maxLevel": 20,
  "curveType": "Linear",
  "baseXpRequirement": 100,
  "xpMultiplier": 1.5,
  "healOnLevelUp": true,
  "defaultStatBonuses": {
    "maxHealth": 5,
    "attack": 1,
    "defense": 1
  },
  "levels": [
    { "level": 5, "title": "Veteran", "customRewards": ["..."] },
    { "level": 10, "title": "Elite", "customRewards": ["..."] }
  ]
}
```

### XP Curve Formulas

**Linear (Default)**
```
Level N = N * BaseXP
Level 2 = 200 XP, Level 3 = 300 XP, Level 5 = 500 XP
```

**Exponential**
```
Cumulative sum: BaseXP * (Multiplier ^ (level-2))
With base=100, mult=1.5:
Level 2 = 100, Level 3 = 250, Level 4 = 475
```

**Custom**
```
Per-level values in levels[] array
Falls back to Linear for undefined levels
```

### Customization Examples

**Fantasy RPG (default)**
```json
{
  "experienceTerminology": "XP",
  "levelTerminology": "Level"
}
```

**Glory-Based System**
```json
{
  "experienceTerminology": "Glory",
  "levelTerminology": "Rank"
}
```

**Hardcore Mode**
```json
{
  "healOnLevelUp": false,
  "curveType": "Exponential",
  "xpMultiplier": 2.0
}
```

## UI Display Updates

### Level-Up Panel with Title and Rewards
```
╔══════════════════════════════════════════╗
║           ★ LEVEL UP! ★                  ║
╠══════════════════════════════════════════╣
║         ★ Veteran ★                      ║
║                                          ║
║ You have reached Level 5!                ║
║                                          ║
║ Stat Increases:                          ║
║   Max Health: 120 → 125 (+5)             ║
║   Attack: 14 → 15 (+1)                   ║
║   Defense: 9 → 10 (+1)                   ║
║                                          ║
║ Rewards:                                 ║
║   • Unlock: Advanced Training            ║
║                                          ║
║ Next Level: 600 XP needed (Level 6)      ║
╚══════════════════════════════════════════╝
```

### Glory/Rank Terminology
```
╔══════════════════════════════════════════╗
║           ★ RANK UP! ★                   ║
╠══════════════════════════════════════════╣
║ You have reached Rank 5!                 ║
║ ...                                      ║
║ Next Rank: 600 Glory needed (Rank 6)     ║
╚══════════════════════════════════════════╝
```

## Files Summary

### New Files (6)
| File | Purpose |
|------|---------|
| `Domain/Enums/ProgressionCurve.cs` | XP curve type enum |
| `Domain/Definitions/StatBonusConfig.cs` | JSON-bindable stat config |
| `Domain/Definitions/LevelDefinition.cs` | Per-level configuration |
| `Domain/Definitions/ProgressionDefinition.cs` | Main progression configuration |
| `config/progression.json` | Default configuration file |
| `Domain.UnitTests/Definitions/ProgressionDefinitionTests.cs` | Definition tests |
| `Domain.UnitTests/Services/ProgressionServiceConfigTests.cs` | Config integration tests |

### Modified Files (10)
| File | Changes |
|------|---------|
| `Domain/Entities/Player.cs` | ProgressionDefinition parameter support |
| `Domain/Services/ProgressionService.cs` | Config injection, rewards/title methods |
| `Application/Interfaces/IConfigurationProvider.cs` | GetProgressionConfiguration() |
| `Application/DTOs/ExperienceGainDto.cs` | Terminology properties |
| `Application/DTOs/LevelUpDto.cs` | Rewards, title, terminology properties |
| `Application/Services/GameSessionService.cs` | Load config, pass to DTOs |
| `Infrastructure/Configuration/JsonConfigurationProvider.cs` | Load progression.json |
| `Presentation.Tui/Adapters/SpectreGameRenderer.cs` | Terminology, rewards, titles display |
| `Domain.UnitTests/Services/ProgressionServiceTests.cs` | Instance method updates |

## v0.0.8c Complete

This completes the progression configuration system:
- Data-driven XP curves (Linear, Exponential, Custom)
- Configurable terminology (XP/Glory, Level/Rank)
- Level cap support (maxLevel)
- Configurable stat bonuses per level
- Level-specific overrides for custom XP, stats, rewards
- Milestone titles at key levels
- Custom rewards at milestone levels
- Optional heal-on-level-up toggle
- Full backward compatibility with defaults

## v0.0.8 Series Complete

The v0.0.8 Experience & Leveling series is now complete:
- **v0.0.8a**: Core XP tracking, monster XP values, XP display
- **v0.0.8b**: Level-up detection, stat increases, heal on level-up, UI
- **v0.0.8c**: Full configuration via progression.json
