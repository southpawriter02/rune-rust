## v0.17.5 - Character Creation Workflow

**Focus:** Six-step creation wizard, state management, validation, persistence, and TUI integration

**Source Specification:** [character-creation.md](../../aethelgard/design/01-core/character-creation.md)

### Overview

This version implements the complete character creation workflow that guides players through the six-step process. The workflow supports forward/backward navigation, maintains state across steps, validates choices, and persists the final character to the database. The TUI provides clear presentation of options with "permanent choice" warnings where appropriate.

---

### Deliverables Summary

| Category | Items | Estimated Tests |
|----------|-------|-----------------|
| Enums | 1 | 2 |
| Value Objects | 4 | 5 |
| Entities | 2 | 4 |
| Services | 4 | 9 |
| **Total** | **11** | **~20** |

---

### v0.17.5a - Creation Step Enum & State

#### CharacterCreationStep Enum
```
CharacterCreationStep
â”œâ”€â”€ Lineage (Step 1) - Blood heritage
â”œâ”€â”€ Background (Step 2) - Pre-Silence profession
â”œâ”€â”€ Attributes (Step 3) - Point allocation
â”œâ”€â”€ Archetype (Step 4) - Combat role
â”œâ”€â”€ Specialization (Step 5) - Tactical identity
â”œâ”€â”€ Summary (Step 6) - Review & name entry
```

#### CharacterCreationState Entity
```
CharacterCreationState
â”œâ”€â”€ SessionId: string
â”œâ”€â”€ CurrentStep: CharacterCreationStep
â”œâ”€â”€ // Step 1 - Lineage
â”œâ”€â”€ SelectedLineage: Lineage?
â”œâ”€â”€ FlexibleAttributeBonus: CoreAttribute? (for Clan-Born)
â”œâ”€â”€ // Step 2 - Background
â”œâ”€â”€ SelectedBackground: Background?
â”œâ”€â”€ // Step 3 - Attributes
â”œâ”€â”€ AttributeAllocationMode: AttributeAllocationMode
â”œâ”€â”€ Attributes: AttributeAllocationState
â”œâ”€â”€ // Step 4 - Archetype
â”œâ”€â”€ SelectedArchetype: Archetype?
â”œâ”€â”€ // Step 5 - Specialization
â”œâ”€â”€ SelectedSpecialization: SpecializationId?
â”œâ”€â”€ // Step 6 - Summary
â”œâ”€â”€ CharacterName: string?
â”œâ”€â”€ // Metadata
â”œâ”€â”€ CreatedAt: DateTime
â”œâ”€â”€ LastModifiedAt: DateTime
â”œâ”€â”€ IsComplete: bool
â”œâ”€â”€ ValidationErrors: List<string>
```

**State Flow:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CHARACTER CREATION STATE               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  Step 1: Lineage                                    â”‚
â”‚    - Select lineage â†’ Stored in state              â”‚
â”‚    - If Clan-Born: Select flexible attribute       â”‚
â”‚                                                     â”‚
â”‚  Step 2: Background                                 â”‚
â”‚    - Select background â†’ Stored in state           â”‚
â”‚                                                     â”‚
â”‚  Step 3: Attributes                                 â”‚
â”‚    - Simple/Advanced mode selection                â”‚
â”‚    - Point-buy or recommended build                â”‚
â”‚    - Live preview of derived stats                 â”‚
â”‚                                                     â”‚
â”‚  Step 4: Archetype (PERMANENT)                     â”‚
â”‚    - Select archetype â†’ Cannot be undone           â”‚
â”‚    - Determines specialization options             â”‚
â”‚                                                     â”‚
â”‚  Step 5: Specialization                            â”‚
â”‚    - Select from archetype's available options     â”‚
â”‚    - First specialization is free                  â”‚
â”‚                                                     â”‚
â”‚  Step 6: Summary                                    â”‚
â”‚    - Review all choices                            â”‚
â”‚    - Enter character name                          â”‚
â”‚    - Confirm or go back                            â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Configuration (`creation-workflow.json`):**
```json
{
  "workflow": {
    "steps": [
      { "step": "Lineage", "order": 1, "canGoBack": false, "isPermanent": false },
      { "step": "Background", "order": 2, "canGoBack": true, "isPermanent": false },
      { "step": "Attributes", "order": 3, "canGoBack": true, "isPermanent": false },
      { "step": "Archetype", "order": 4, "canGoBack": true, "isPermanent": true },
      { "step": "Specialization", "order": 5, "canGoBack": true, "isPermanent": false },
      { "step": "Summary", "order": 6, "canGoBack": true, "isPermanent": false }
    ]
  }
}
```

**Unit Tests (~3):**
- [ ] CharacterCreationStep enum has 6 values
- [ ] State maintains all selections correctly
- [ ] Navigation preserves previous choices

---

### v0.17.5b - Creation ViewModel

#### CharacterCreationViewModel Value Object
```
CharacterCreationViewModel
â”œâ”€â”€ CurrentStep: CharacterCreationStep
â”œâ”€â”€ // Display Data
â”œâ”€â”€ StepTitle: string
â”œâ”€â”€ StepDescription: string
â”œâ”€â”€ StepNumber: int (1-6)
â”œâ”€â”€ TotalSteps: int (6)
â”œâ”€â”€ // Navigation
â”œâ”€â”€ CanGoBack: bool
â”œâ”€â”€ CanGoForward: bool
â”œâ”€â”€ IsPermanentChoice: bool
â”œâ”€â”€ // Preview Data
â”œâ”€â”€ DerivedStatsPreview: DerivedStats?
â”œâ”€â”€ AbilitiesPreview: List<string>?
â”œâ”€â”€ EquipmentPreview: List<string>?
â”œâ”€â”€ // Validation
â”œâ”€â”€ ValidationErrors: List<string>
â”œâ”€â”€ IsCurrentStepValid: bool
```

**ViewModel Logic:**
```
UpdateViewModel(state):
  1. Set step display info from current step
  2. Calculate CanGoBack (false for step 1)
  3. Calculate CanGoForward (requires step completion)
  4. Calculate IsPermanentChoice (true for Archetype)
  5. Update preview data based on current selections
  6. Run validation for current step
```

**Unit Tests (~2):**
- [ ] ViewModel updates correctly on step change
- [ ] Preview data calculates from current state

---

### v0.17.5c - Name Validation

#### NameValidator Value Object
```
NameValidator
â”œâ”€â”€ MinLength: int (2)
â”œâ”€â”€ MaxLength: int (20)
â”œâ”€â”€ AllowedPattern: Regex (ASCII letters, spaces, hyphens)
â”œâ”€â”€ ProfanityFilter: List<string>
```

#### NameValidationResult Value Object
```
NameValidationResult
â”œâ”€â”€ IsValid: bool
â”œâ”€â”€ ErrorMessage: string?
â”œâ”€â”€ SuggestedName: string? (if invalid)
```

**Validation Rules:**
| Rule | Requirement | Error Message |
|------|-------------|---------------|
| Length | 2-20 characters | "Name must be 2-20 characters" |
| Characters | a-z, A-Z, space, hyphen | "Name can only contain letters, spaces, and hyphens" |
| Profanity | Not in filter list | "Please choose a different name" |
| Starting/Ending | Must start/end with letter | "Name must start and end with a letter" |

**Configuration (`creation-workflow.json` - Name Validation):**
```json
{
  "nameValidation": {
    "minLength": 2,
    "maxLength": 20,
    "allowedPattern": "^[a-zA-Z][a-zA-Z\\s\\-]*[a-zA-Z]$",
    "profanityFilter": ["...", "..."]
  }
}
```

**Unit Tests (~3):**
- [ ] Valid names pass validation
- [ ] Names with special characters fail
- [ ] Names outside length range fail

---

### v0.17.5d - Creation Controller

#### ICharacterCreationController Interface
```csharp
public interface ICharacterCreationController
{
    /// <summary>
    /// Initializes a new character creation session.
    /// </summary>
    CharacterCreationState Initialize();

    /// <summary>
    /// Processes lineage selection (Step 1).
    /// </summary>
    Task<StepResult> SelectLineageAsync(
        Lineage lineage,
        CoreAttribute? flexibleBonus = null);

    /// <summary>
    /// Processes background selection (Step 2).
    /// </summary>
    Task<StepResult> SelectBackgroundAsync(Background background);

    /// <summary>
    /// Processes attribute allocation (Step 3).
    /// </summary>
    Task<StepResult> ConfirmAttributesAsync(AttributeAllocationState attributes);

    /// <summary>
    /// Processes archetype selection (Step 4 - PERMANENT).
    /// </summary>
    Task<StepResult> SelectArchetypeAsync(Archetype archetype);

    /// <summary>
    /// Processes specialization selection (Step 5).
    /// </summary>
    Task<StepResult> SelectSpecializationAsync(SpecializationId specialization);

    /// <summary>
    /// Processes final confirmation with name (Step 6).
    /// </summary>
    Task<CharacterCreationResult> ConfirmCharacterAsync(string name);

    /// <summary>
    /// Navigates back to previous step.
    /// </summary>
    StepResult GoBack();

    /// <summary>
    /// Cancels character creation.
    /// </summary>
    void Cancel();

    /// <summary>
    /// Gets current state and view model.
    /// </summary>
    (CharacterCreationState State, CharacterCreationViewModel ViewModel) GetCurrentState();
}
```

#### StepResult Value Object
```
StepResult
â”œâ”€â”€ Success: bool
â”œâ”€â”€ NextStep: CharacterCreationStep?
â”œâ”€â”€ ValidationErrors: List<string>
â”œâ”€â”€ UpdatedViewModel: CharacterCreationViewModel
```

**Controller Implementation:**
```csharp
public class CharacterCreationController : ICharacterCreationController
{
    private CharacterCreationState _state;
    private readonly ILineageProvider _lineageProvider;
    private readonly IBackgroundProvider _backgroundProvider;
    private readonly IArchetypeProvider _archetypeProvider;
    private readonly ISpecializationProvider _specializationProvider;
    private readonly ICharacterFactory _characterFactory;

    public Task<StepResult> SelectLineageAsync(Lineage lineage, CoreAttribute? flexibleBonus = null)
    {
        // Validate flexible bonus required for Clan-Born
        if (lineage == Lineage.ClanBorn && flexibleBonus == null)
            return ValidationFailure("Clan-Born requires selecting an attribute for +1 bonus");

        _state.SelectedLineage = lineage;
        _state.FlexibleAttributeBonus = flexibleBonus;
        _state.CurrentStep = CharacterCreationStep.Background;

        return SuccessResult(CharacterCreationStep.Background);
    }

    public Task<CharacterCreationResult> ConfirmCharacterAsync(string name)
    {
        // Validate name
        var nameResult = _nameValidator.Validate(name);
        if (!nameResult.IsValid)
            return ValidationFailure(nameResult.ErrorMessage);

        // Create character
        var character = _characterFactory.CreateCharacter(_state, name);

        // Persist to database
        await _characterRepository.SaveAsync(character);

        return new CharacterCreationResult
        {
            Success = true,
            Character = character,
            Message = $"{name} begins their saga"
        };
    }
}
```

**Unit Tests (~4):**
- [ ] Initialize creates valid state
- [ ] Step transitions work correctly
- [ ] GoBack preserves previous selections
- [ ] Cancel clears state

---

### v0.17.5e - Character Factory

#### ICharacterFactory Interface
```csharp
public interface ICharacterFactory
{
    /// <summary>
    /// Creates a character from creation state.
    /// </summary>
    PlayerCharacter CreateCharacter(
        CharacterCreationState state,
        string name);

    /// <summary>
    /// Validates creation state is complete.
    /// </summary>
    ValidationResult ValidateState(CharacterCreationState state);
}
```

#### CharacterCreationResult Value Object
```
CharacterCreationResult
â”œâ”€â”€ Success: bool
â”œâ”€â”€ Character: PlayerCharacter?
â”œâ”€â”€ CharacterId: string?
â”œâ”€â”€ Message: string
â”œâ”€â”€ Errors: List<string>
```

**Factory Implementation:**
```
CreateCharacter(state, name):
  1. Validate state is complete
  2. Create PlayerCharacter entity
  3. Set basic info:
     - Name
     - Lineage
     - Background
     - Archetype
     - Specialization
  4. Apply lineage modifiers:
     - Attribute modifiers
     - Passive bonuses
     - Trauma baseline
     - Register unique trait
  5. Apply background grants:
     - Skills
     - Equipment
  6. Apply attributes:
     - Set base values
     - Apply lineage attribute modifiers
  7. Calculate derived stats:
     - HP (from Sturdiness + Archetype + Lineage)
     - Stamina (from Finesse + Might + Archetype)
     - AP (from Will + Wits + Archetype + Lineage)
  8. Apply archetype:
     - Grant starting abilities (3)
     - Apply resource bonuses
  9. Apply specialization:
     - Grant Tier 1 abilities (3)
     - Initialize special resource
  10. Initialize saga progression:
      - Legend: 0
      - PP: 0
      - Milestone: 0
  11. Set resources to maximum:
      - CurrentHp = MaxHp
      - CurrentStamina = MaxStamina
      - CurrentAp = MaxAp
  12. Set starting location:
      - Generate or assign starting sector
      - Set to sector entrance
  13. Return complete character
```

**Unit Tests (~3):**
- [ ] CreateCharacter produces valid character
- [ ] All modifiers applied correctly
- [ ] Starting resources at maximum

---

### v0.17.5f - TUI Screens

#### Step UI Templates

**Step 1: Lineage Selection**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 1: CHOOSE YOUR LINEAGE                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘  Your bloodline carries echoes of the world before.       â•‘
â•‘                                                           â•‘
â•‘  [1] CLAN-BORN                                            â•‘
â•‘      "Born of the great halls, bound by oath"            â•‘
â•‘      +5 Maximum HP | +1 Social Skill | +1 Any Attribute  â•‘
â•‘                                                           â•‘
â•‘  [2] RUNE-MARKED                                          â•‘
â•‘      "The Aether sang in your blood from birth"          â•‘
â•‘      +5 Maximum Aether Pool | +1 Lore Skill              â•‘
â•‘      +2 WILL | -1 STURDINESS | Starts with 5 Corruption  â•‘
â•‘                                                           â•‘
â•‘  [3] IRON-BLOODED                                         â•‘
â•‘      "Your ancestors forged the old world"               â•‘
â•‘      +2 Soak | +1 Craft Skill                            â•‘
â•‘      +2 STURDINESS | -1 WILL                             â•‘
â•‘                                                           â•‘
â•‘  [4] VARGR-KIN                                            â•‘
â•‘      "The wild runs in your veins"                       â•‘
â•‘      +1 Movement | +1 Survival Skill                     â•‘
â•‘      +1 MIGHT | +1 FINESSE | -1 WILL                     â•‘
â•‘                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Step 3: Attributes (Advanced Mode)**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 3: ALLOCATE ATTRIBUTES           [Advanced Mode]    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘  Points Remaining: 3 / 15                                 â•‘
â•‘                                                           â•‘
â•‘  MIGHT      [âˆ’]  5  [+]      Physical power              â•‘
â•‘  FINESSE    [âˆ’]  4  [+]      Agility, precision          â•‘
â•‘  WITS       [âˆ’]  3  [+]      Perception, knowledge       â•‘
â•‘  WILL       [âˆ’]  2  [+]      Mental fortitude            â•‘
â•‘  STURDINESS [âˆ’]  3  [+]      Endurance, resilience       â•‘
â•‘                                                           â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘  Derived Stats Preview:                                   â•‘
â•‘    Max HP:      80                                        â•‘
â•‘    Max Stamina: 65                                        â•‘
â•‘    Max AP:      35                                        â•‘
â•‘                                                           â•‘
â•‘  [Confirm Attributes] [Reset] [Switch to Simple Mode]    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Step 4: Archetype (with PERMANENT warning)**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 4: CHOOSE YOUR ARCHETYPE                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘  âš  WARNING: This choice is PERMANENT and cannot be       â•‘
â•‘    changed after character creation.                      â•‘
â•‘                                                           â•‘
â•‘  [1] WARRIOR â€” The Unyielding Bulwark                     â•‘
â•‘      âš” 99 HP | 55 Stamina | Melee Focus                  â•‘
â•‘      ğŸ¯ Strike, Defensive Stance, Warrior's Vigor         â•‘
â•‘                                                           â•‘
â•‘  [2] SKIRMISHER â€” Swift as Shadow                         â•‘
â•‘      âš” 80 HP | 55 Stamina | +1 Movement                  â•‘
â•‘      ğŸ¯ Quick Strike, Evasive Stance, Fleet Footed        â•‘
â•‘                                                           â•‘
â•‘  [3] MYSTIC â€” Wielder of Tainted Aether                   â•‘
â•‘      âš” 70 HP | 70 AP | Ranged Aetheric                   â•‘
â•‘      ğŸ¯ Aether Dart, Focus Aether, Aetheric Attunement   â•‘
â•‘                                                           â•‘
â•‘  [4] ADEPT â€” Master of Mundane Arts                       â•‘
â•‘      âš” 80 HP | 50 Stamina | +20% Consumables             â•‘
â•‘      ğŸ¯ Exploit Weakness, Scavenge, Resourceful           â•‘
â•‘                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Step 6: Summary & Confirmation**
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  STEP 6: CONFIRM YOUR SURVIVOR                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                           â•‘
â•‘  NAME: ______________________                             â•‘
â•‘                                                           â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘  LINEAGE:        Clan-Born (+5 HP, +1 Social)             â•‘
â•‘  BACKGROUND:     Village Smith (Craft +2)                 â•‘
â•‘  ARCHETYPE:      Warrior                                  â•‘
â•‘  SPECIALIZATION: Skjaldmaer (Coherent)                    â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘  ATTRIBUTES:                                              â•‘
â•‘    MIGHT 4 | FINESSE 3 | WITS 2 | WILL 2 | STURDINESS 4  â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘  RESOURCES:                                               â•‘
â•‘    HP: 104 (99 base + 5 Clan-Born)                        â•‘
â•‘    Stamina: 55                                            â•‘
â•‘    AP: 10                                                 â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘  ABILITIES:                                               â•‘
â•‘    Strike, Defensive Stance, Warrior's Vigor              â•‘
â•‘    + Skjaldmaer Tier 1: Shield Wall, Guard, Stalwart     â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘  STARTING EQUIPMENT:                                      â•‘
â•‘    Smith's Hammer, Leather Apron                          â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘                                                           â•‘
â•‘  [Confirm & Begin Saga]        [Go Back]        [Cancel]  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Unit Tests (~3):**
- [ ] All 6 step screens render correctly
- [ ] Navigation buttons appear appropriately
- [ ] Permanent warning displays on Archetype step

---

### v0.17.5g - Persistence & Database

#### Character Table Schema
```sql
CREATE TABLE characters (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    account_id UUID NOT NULL REFERENCES accounts(id),
    name VARCHAR(20) NOT NULL,

    -- Creation choices (permanent)
    lineage_id VARCHAR(50) NOT NULL,
    background_id VARCHAR(50) NOT NULL,
    archetype_id INT NOT NULL,
    primary_specialization_id VARCHAR(50) NOT NULL,

    -- Attributes
    might INT NOT NULL CHECK (might BETWEEN 1 AND 15),
    finesse INT NOT NULL CHECK (finesse BETWEEN 1 AND 15),
    wits INT NOT NULL CHECK (wits BETWEEN 1 AND 15),
    will INT NOT NULL CHECK (will BETWEEN 1 AND 15),
    sturdiness INT NOT NULL CHECK (sturdiness BETWEEN 1 AND 15),

    -- Derived stats (calculated)
    max_hp INT NOT NULL,
    max_stamina INT NOT NULL,
    max_ap INT NOT NULL,
    current_hp INT NOT NULL,
    current_stamina INT NOT NULL,
    current_ap INT NOT NULL,

    -- Trauma
    psychic_stress INT NOT NULL DEFAULT 0,
    corruption INT NOT NULL DEFAULT 0,

    -- Saga progression
    legend_points INT NOT NULL DEFAULT 0,
    progression_points INT NOT NULL DEFAULT 0,
    current_milestone INT NOT NULL DEFAULT 0,
    legend_to_next_milestone INT NOT NULL DEFAULT 500,

    -- Location
    current_sector_id VARCHAR(50),
    current_room_id VARCHAR(50),

    -- Timestamps
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_played_at TIMESTAMP
);
```

**Unit Tests (~2):**
- [ ] Character persists to database correctly
- [ ] All fields saved with correct values

---

### Configuration Files

| File | Purpose |
|------|---------|
| `creation-workflow.json` | Step order, navigation rules, name validation |

**Complete Configuration Example:**
```json
{
  "workflow": {
    "steps": [
      {
        "step": "Lineage",
        "order": 1,
        "displayName": "Choose Your Lineage",
        "description": "Your bloodline carries echoes of the world before.",
        "canGoBack": false,
        "isPermanent": false
      },
      {
        "step": "Background",
        "order": 2,
        "displayName": "Choose Your Background",
        "description": "What were you before the world broke?",
        "canGoBack": true,
        "isPermanent": false
      },
      {
        "step": "Attributes",
        "order": 3,
        "displayName": "Allocate Attributes",
        "description": "Define your character's core capabilities.",
        "canGoBack": true,
        "isPermanent": false
      },
      {
        "step": "Archetype",
        "order": 4,
        "displayName": "Choose Your Archetype",
        "description": "Your fundamental approach to survival.",
        "canGoBack": true,
        "isPermanent": true,
        "permanentWarning": "This choice is PERMANENT and cannot be changed after character creation."
      },
      {
        "step": "Specialization",
        "order": 5,
        "displayName": "Choose Your Specialization",
        "description": "Your tactical identity and unique abilities.",
        "canGoBack": true,
        "isPermanent": false
      },
      {
        "step": "Summary",
        "order": 6,
        "displayName": "Confirm Your Survivor",
        "description": "Review your choices and begin your saga.",
        "canGoBack": true,
        "isPermanent": false
      }
    ]
  },
  "nameValidation": {
    "minLength": 2,
    "maxLength": 20,
    "allowedPattern": "^[a-zA-Z][a-zA-Z\\s\\-]*[a-zA-Z]$|^[a-zA-Z]{2}$",
    "profanityFilter": []
  },
  "initialization": {
    "startingLegend": 0,
    "startingPP": 0,
    "startingMilestone": 0,
    "legendToNextMilestone": 500,
    "startingStress": 0,
    "resourcesAtMax": true
  }
}
```

---

### Dependencies

**Requires:**
- v0.17.0: Lineage system
- v0.17.1: Background system
- v0.17.2: Attribute system
- v0.17.3: Archetype system
- v0.17.4: Specialization system
- Database/repository layer

**Provides to:**
- Game start: Initialized character
- Save system: Character persistence
- UI system: Creation wizard screens

---

### Acceptance Criteria

- [ ] CharacterCreationStep enum has 6 values
- [ ] Six-step wizard navigates correctly
- [ ] Back navigation preserves previous choices
- [ ] Cannot go back from Step 1
- [ ] Archetype step shows permanent warning
- [ ] Name validation enforces 2-20 characters
- [ ] Name validation allows only letters, spaces, hyphens
- [ ] Invalid names are rejected with error message
- [ ] All step selections stored in state
- [ ] Derived stats preview updates in real-time
- [ ] Character factory applies all modifiers correctly
- [ ] Starting resources set to maximum
- [ ] Saga progression initialized to 0
- [ ] Character persists to database on confirm
- [ ] Cancel discards all progress
- [ ] TUI screens render correctly for all steps
- [ ] ~20 unit tests pass
