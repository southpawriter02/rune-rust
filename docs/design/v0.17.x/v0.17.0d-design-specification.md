# v0.17.0d Design Specification: Trauma Economy Baseline

**Version:** 0.17.0d  
**Phase Name:** Trauma Economy Baseline  
**Parent Version:** v0.17.0 (Lineage System)  
**Prerequisites:** v0.17.0c Complete (Unique Traits)  
**Estimated Tests:** ~4 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [LineageTraumaBaseline Value Object](#4-lineagetraumabaseline-value-object)
5. [LineageDefinition Extension](#5-lineagedefinition-extension)
6. [Data Model Changes](#6-data-model-changes)
7. [Configuration File Schema Updates](#7-configuration-file-schema-updates)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [User Stories](#11-user-stories)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the Trauma Economy baseline system for lineages, completing the `LineageDefinition` entity with starting trauma values and resistance modifiers. The Trauma Economy is a core mechanical system in Aethelgard where characters accumulate Corruption (from Aether exposure) and Stress (from psychological trauma).

Each lineage has a distinct relationship with the Trauma Economy:

- **Clan-Born** — Baseline humans with no starting trauma or resistance modifiers
- **Rune-Marked** — Start with 5 permanent Corruption, -1 Corruption Resistance (mystical taint)
- **Iron-Blooded** — -1 Stress Resistance (physical focus weakens mental fortitude)
- **Vargr-Kin** — Baseline values (Primal Clarity trait handles Stress reduction separately)

This phase establishes the `LineageTraumaBaseline` value object that defines each lineage's starting Trauma Economy state.

### 1.2 Key Deliverables

| Category          | Items                                                       |
| ----------------- | ----------------------------------------------------------- |
| **Value Objects** | `LineageTraumaBaseline`                                     |
| **Entity Update** | `LineageDefinition` extended with `TraumaBaseline`          |
| **Configuration** | `lineages.json` extended with trauma baseline section       |
| **Schema Update** | `lineages.schema.json` extended with trauma baseline schema |
| **Tests**         | ~4 unit tests                                               |

### 1.3 Architectural Significance

This version completes the **Lineage Pattern** with Trauma Economy integration:

- **Starting Trauma Values**: Characters begin with lineage-determined Corruption/Stress
- **Resistance Modifiers**: Lineage affects difficulty of resisting trauma accumulation
- **Permanent Corruption**: Rune-Marked's starting Corruption cannot be removed
- **Thematic Consistency**: Trauma values reflect how each lineage relates to the Runic Blight
- **Character Creation Integration**: Trauma baselines applied during character finalization

---

## 2. Feature Overview

```
v0.17.0d Trauma Economy Baseline
├── LineageTraumaBaseline Value Object
│   ├── StartingCorruption: int       (permanent Corruption at creation)
│   ├── StartingStress: int           (initial Stress at creation)
│   ├── CorruptionResistanceModifier: int  (bonus/penalty to resist checks)
│   └── StressResistanceModifier: int      (bonus/penalty to resist checks)
└── LineageDefinition Extension
    └── TraumaBaseline: LineageTraumaBaseline
```

### 2.1 Scope Alignment

**In Scope:**

- `LineageTraumaBaseline` value object with four properties
- Extension of `LineageDefinition` entity with `TraumaBaseline` property
- Configuration schema updates for trauma baseline section
- Trauma baseline data for all 4 lineages
- Resistance modifier definitions for Corruption/Stress checks
- Documentation of permanent vs. removable trauma

**Out of Scope:**

- LineageProvider service → v0.17.0e
- LineageApplicationService → v0.17.0f
- Actual Trauma Economy system implementation → v0.18.x or existing
- Trauma accumulation mechanics → Existing Trauma Economy
- Corruption cleansing/healing → Trauma Economy features

---

## 3. Architecture Diagrams

### 3.1 Trauma Economy Baseline Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                TRAUMA ECONOMY BASELINE OVERVIEW                      │
└─────────────────────────────────────────────────────────────────────┘

    LineageDefinition (from v0.17.0a-c)
           │
           │  Contains trauma baseline
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    LineageTraumaBaseline                             │
├─────────────────────────────────────────────────────────────────────┤
│  - StartingCorruption: int       (e.g., 5 for Rune-Marked)          │
│  - StartingStress: int           (e.g., 0 for all lineages)         │
│  - CorruptionResistanceModifier: int  (e.g., -1 for Rune-Marked)    │
│  - StressResistanceModifier: int      (e.g., -1 for Iron-Blooded)   │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  Applied to character at creation
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    Character Trauma State                            │
├─────────────────────────────────────────────────────────────────────┤
│  - CurrentCorruption: int        (starts at StartingCorruption)     │
│  - PermanentCorruption: int      (equals StartingCorruption)        │
│  - CurrentStress: int            (starts at StartingStress)         │
│  - CorruptionResistance: int     (base + modifier)                  │
│  - StressResistance: int         (base + modifier)                  │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  CharacterCreationView (v0.17.5)                                     │
│  └── Displays starting trauma values as warning/info                 │
│                                                                      │
│  CharacterSheetView                                                   │
│  └── Shows Corruption/Stress with lineage baseline indicated         │
│                                                                      │
│  TraumaWarningPanel                                                   │
│  └── Warns player about permanent Corruption for Rune-Marked         │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  TraumaService                                                       │
│  └── Uses resistance modifiers for Corruption/Stress checks          │
│                                                                      │
│  CharacterFactory (v0.17.5)                                          │
│  └── Sets starting Corruption/Stress from lineage baseline           │
│                                                                      │
│  ILineageApplicationService (v0.17.0f)                               │
│  └── Applies trauma baseline to new character                        │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                   LineageDefinition                          │    │
│  │                      (Entity)                                │    │
│  ├─────────────────────────────────────────────────────────────┤    │
│  │ + Id: Guid                                                   │    │
│  │ + LineageId: Lineage                                         │    │
│  │ + AttributeModifiers: LineageAttributeModifiers (v0.17.0a)   │    │
│  │ + PassiveBonuses: LineagePassiveBonuses         (v0.17.0b)   │    │
│  │ + UniqueTrait: LineageTrait                     (v0.17.0c)   │    │
│  │ + TraumaBaseline: LineageTraumaBaseline         ← NEW        │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                            │                                         │
│  ┌─────────────────────────┴───────────────────────────────────┐    │
│  │              LineageTraumaBaseline (Value Object)           │    │
│  ├─────────────────────────────────────────────────────────────┤    │
│  │ StartingCorruption: int        StartingStress: int          │    │
│  │ CorruptionResistanceModifier: int                           │    │
│  │ StressResistanceModifier: int                               │    │
│  └─────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.3 Trauma Baseline Application Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                 TRAUMA BASELINE APPLICATION FLOW                     │
└─────────────────────────────────────────────────────────────────────┘

    Character Creation Complete (Lineage = Rune-Marked)
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    GET LINEAGE DEFINITION                            │
├─────────────────────────────────────────────────────────────────────┤
│  LineageDefinition for Rune-Marked:                                 │
│    TraumaBaseline:                                                   │
│      StartingCorruption: 5                                           │
│      StartingStress: 0                                               │
│      CorruptionResistanceModifier: -1                                │
│      StressResistanceModifier: 0                                     │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    SET STARTING TRAUMA                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Current Corruption:                                                 │
│    StartingCorruption: 5                                             │
│    → Character.CurrentCorruption = 5                                 │
│    → Character.PermanentCorruption = 5 (cannot go below this)        │
│                                                                      │
│  Current Stress:                                                     │
│    StartingStress: 0                                                 │
│    → Character.CurrentStress = 0                                     │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    APPLY RESISTANCE MODIFIERS                        │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Corruption Resistance:                                              │
│    Base (from WILL): WILL × 2 = 4 × 2 = 8                           │
│    + Lineage Modifier: -1                                            │
│    = Final Corruption Resistance: 7                                  │
│                                                                      │
│  Stress Resistance:                                                  │
│    Base (from WILL): WILL × 2 = 4 × 2 = 8                           │
│    + Lineage Modifier: 0                                             │
│    = Final Stress Resistance: 8                                      │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    FINAL CHARACTER STATE                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Corruption: 5 / 100 (5 permanent, starts tainted)                   │
│  Stress: 0 / 100                                                     │
│  Corruption Resistance: 7 (harder to resist than baseline)           │
│  Stress Resistance: 8 (normal)                                       │
│                                                                      │
│  Display: "Born with the All-Rune's echo, 5 permanent Corruption"   │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.4 Trauma Baseline Comparison Matrix

```
┌─────────────────────────────────────────────────────────────────────┐
│                  LINEAGE TRAUMA BASELINE MATRIX                      │
└─────────────────────────────────────────────────────────────────────┘

    ┌─────────────┬────────────┬────────┬───────────────┬─────────────┐
    │   Lineage   │ Start Corr │ Stress │ Corr Resist   │ Stress Resist│
    ├─────────────┼────────────┼────────┼───────────────┼─────────────┤
    │  Clan-Born  │     0      │   0    │      +0       │     +0      │
    ├─────────────┼────────────┼────────┼───────────────┼─────────────┤
    │ Rune-Marked │     5      │   0    │      -1       │     +0      │
    │             │ (perm.)    │        │               │             │
    ├─────────────┼────────────┼────────┼───────────────┼─────────────┤
    │ Iron-Blooded│     0      │   0    │      +0       │     -1      │
    ├─────────────┼────────────┼────────┼───────────────┼─────────────┤
    │  Vargr-Kin  │     0      │   0    │      +0       │     +0      │
    └─────────────┴────────────┴────────┴───────────────┴─────────────┘

    Design Notes:
    ┌─────────────────────────────────────────────────────────────────┐
    │ • Clan-Born: Baseline humans with no trauma vulnerability       │
    │ • Rune-Marked: Mystical taint = permanent Corruption penalty    │
    │ • Iron-Blooded: Mental vulnerability = Stress resistance penalty│
    │ • Vargr-Kin: Primal Clarity trait handles Stress reduction      │
    │                                                                  │
    │ • Starting Corruption is PERMANENT (cannot be cleansed below)   │
    │ • Resistance modifiers apply to ALL checks of that type         │
    │ • Negative resistance = easier to accumulate trauma             │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.5 Corruption Resistance Check Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                 CORRUPTION RESISTANCE CHECK FLOW                     │
└─────────────────────────────────────────────────────────────────────┘

    Character (Rune-Marked) encounters Aether exposure
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    DETERMINE RESISTANCE POOL                         │
├─────────────────────────────────────────────────────────────────────┤
│  1. Get base Corruption Resistance                                   │
│     → Formula: WILL × 2 = 4 × 2 = 8                                 │
│                                                                      │
│  2. Get lineage modifier                                             │
│     → Rune-Marked: CorruptionResistanceModifier = -1                │
│                                                                      │
│  3. Calculate final resistance                                       │
│     → 8 + (-1) = 7                                                  │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    ROLL RESISTANCE CHECK                             │
├─────────────────────────────────────────────────────────────────────┤
│  Dice Pool: 3d10 (from WILL attribute)                              │
│  Target Number: 7 (resistance rating)                                │
│  Difficulty: 8 (from Aether source intensity)                       │
│                                                                      │
│  Roll: 4, 7, 9 → 2 successes (7 and 9 meet/beat target)             │
│  Required: 2 successes                                               │
│  Result: SUCCESS (resisted Corruption)                               │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────┐
    │ Check passed?        │
    └──────────┬───────────┘
               │
        ┌──────┴──────┐
       YES            NO
        │              │
        ▼              ▼
┌───────────────┐  ┌───────────────────────────────────────────────┐
│ No Corruption │  │ Gain Corruption:                               │
│ gained        │  │   Base: 3 points                               │
│               │  │   Current: 5 + 3 = 8                           │
│               │  │   (Permanent minimum: 5)                       │
└───────────────┘  └───────────────────────────────────────────────┘
```

### 3.6 Permanent Corruption Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│                PERMANENT CORRUPTION DECISION TREE                    │
└─────────────────────────────────────────────────────────────────────┘

    Player attempts to cleanse Corruption
           │
           ▼
    ┌──────────────────────────────────────────────────────────────┐
    │               Get character's lineage                         │
    └──────────────────────────┬───────────────────────────────────┘
                               │
                               ▼
    ┌──────────────────────────────────────────────────────────────┐
    │     Get TraumaBaseline.StartingCorruption                     │
    └──────────────────────────┬───────────────────────────────────┘
                               │
                               ▼
               ┌───────────────────────────────┐
               │ StartingCorruption > 0?        │
               └───────────────┬───────────────┘
                        ┌──────┴──────┐
                       YES            NO
                        │              │
                        ▼              ▼
    ┌──────────────────────────┐  ┌──────────────────────────────┐
    │ Permanent Corruption     │  │ No permanent Corruption      │
    │ = StartingCorruption     │  │ Can cleanse to 0             │
    │                          │  │                              │
    │ Example (Rune-Marked):   │  │ Example (Clan-Born):         │
    │ Current: 12              │  │ Current: 12                  │
    │ Permanent: 5             │  │ Permanent: 0                 │
    │ Can cleanse to: 5        │  │ Can cleanse to: 0            │
    └──────────────────────────┘  └──────────────────────────────┘
                        │
                        ▼
    ┌──────────────────────────────────────────────────────────────┐
    │ After cleansing attempt:                                      │
    │   New Corruption = MAX(cleansedAmount, PermanentCorruption)   │
    │                                                                │
    │ Rune-Marked example:                                           │
    │   Attempting to cleanse 10 Corruption                          │
    │   Current: 12 → 12 - 10 = 2                                   │
    │   But Permanent = 5                                            │
    │   Final: MAX(2, 5) = 5                                        │
    │   Display: "Cannot cleanse below permanent Corruption (5)"     │
    └──────────────────────────────────────────────────────────────┘
```

---

## 4. LineageTraumaBaseline Value Object

### 4.1 Purpose

The `LineageTraumaBaseline` value object encapsulates the starting trauma values and resistance modifiers determined by a character's lineage, representing how their bloodline relates to the Trauma Economy.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/LineageTraumaBaseline.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Contains the Trauma Economy baseline values for a lineage.
/// </summary>
/// <remarks>
/// <para>
/// LineageTraumaBaseline defines how a lineage interacts with the Trauma Economy:
/// - StartingCorruption: Permanent Corruption the character begins with
/// - StartingStress: Initial Stress at character creation
/// - CorruptionResistanceModifier: Bonus/penalty to Corruption resistance checks
/// - StressResistanceModifier: Bonus/penalty to Stress resistance checks
/// </para>
/// <para>
/// StartingCorruption is considered PERMANENT and cannot be cleansed below
/// this value. It represents the indelible mark of the Runic Blight on
/// certain bloodlines (particularly Rune-Marked).
/// </para>
/// <para>
/// Resistance modifiers affect the difficulty of resisting trauma accumulation.
/// Negative modifiers make the character MORE vulnerable to that trauma type.
/// </para>
/// </remarks>
/// <param name="StartingCorruption">Permanent Corruption at character creation.</param>
/// <param name="StartingStress">Initial Stress at character creation.</param>
/// <param name="CorruptionResistanceModifier">Modifier to Corruption resistance checks.</param>
/// <param name="StressResistanceModifier">Modifier to Stress resistance checks.</param>
public readonly record struct LineageTraumaBaseline(
    int StartingCorruption,
    int StartingStress,
    int CorruptionResistanceModifier,
    int StressResistanceModifier)
{
    /// <summary>
    /// Gets whether this lineage has permanent starting Corruption.
    /// </summary>
    public bool HasPermanentCorruption => StartingCorruption > 0;

    /// <summary>
    /// Gets whether this lineage has starting Stress.
    /// </summary>
    public bool HasStartingStress => StartingStress > 0;

    /// <summary>
    /// Gets whether this lineage has any Corruption resistance penalty.
    /// </summary>
    public bool HasCorruptionVulnerability => CorruptionResistanceModifier < 0;

    /// <summary>
    /// Gets whether this lineage has any Stress resistance penalty.
    /// </summary>
    public bool HasStressVulnerability => StressResistanceModifier < 0;

    /// <summary>
    /// Gets whether this lineage has any trauma vulnerabilities.
    /// </summary>
    public bool HasAnyVulnerability =>
        HasCorruptionVulnerability || HasStressVulnerability;

    /// <summary>
    /// Gets the permanent Corruption floor (cannot cleanse below this).
    /// </summary>
    public int PermanentCorruptionFloor => StartingCorruption;

    /// <summary>
    /// Creates a new LineageTraumaBaseline with validation.
    /// </summary>
    /// <param name="startingCorruption">Starting Corruption (must be non-negative).</param>
    /// <param name="startingStress">Starting Stress (must be non-negative).</param>
    /// <param name="corruptionResistanceModifier">Corruption resistance modifier.</param>
    /// <param name="stressResistanceModifier">Stress resistance modifier.</param>
    /// <returns>A new LineageTraumaBaseline instance.</returns>
    /// <exception cref="ArgumentOutOfRangeException">
    /// Thrown when starting values are negative.
    /// </exception>
    public static LineageTraumaBaseline Create(
        int startingCorruption,
        int startingStress,
        int corruptionResistanceModifier,
        int stressResistanceModifier)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(startingCorruption);
        ArgumentOutOfRangeException.ThrowIfNegative(startingStress);

        return new LineageTraumaBaseline(
            startingCorruption,
            startingStress,
            corruptionResistanceModifier,
            stressResistanceModifier);
    }

    /// <summary>
    /// Calculates the minimum Corruption after cleansing.
    /// </summary>
    /// <param name="currentCorruption">Current Corruption value.</param>
    /// <param name="amountCleansed">Amount to remove.</param>
    /// <returns>New Corruption value, respecting permanent floor.</returns>
    public int CalculateCorruptionAfterCleanse(int currentCorruption, int amountCleansed)
    {
        var afterCleanse = currentCorruption - amountCleansed;
        return Math.Max(afterCleanse, PermanentCorruptionFloor);
    }

    /// <summary>
    /// Default trauma baseline for Clan-Born lineage.
    /// </summary>
    /// <remarks>
    /// Clan-Born are baseline humans with no inherent trauma or vulnerabilities.
    /// </remarks>
    public static LineageTraumaBaseline ClanBorn => Create(
        startingCorruption: 0,
        startingStress: 0,
        corruptionResistanceModifier: 0,
        stressResistanceModifier: 0);

    /// <summary>
    /// Default trauma baseline for Rune-Marked lineage.
    /// </summary>
    /// <remarks>
    /// Rune-Marked carry the All-Rune's echo: 5 permanent Corruption and
    /// -1 to Corruption resistance, reflecting their mystical taint.
    /// </remarks>
    public static LineageTraumaBaseline RuneMarked => Create(
        startingCorruption: 5,
        startingStress: 0,
        corruptionResistanceModifier: -1,
        stressResistanceModifier: 0);

    /// <summary>
    /// Default trauma baseline for Iron-Blooded lineage.
    /// </summary>
    /// <remarks>
    /// Iron-Blooded have fortified bodies but weaker minds: -1 to Stress
    /// resistance from their physical focus.
    /// </remarks>
    public static LineageTraumaBaseline IronBlooded => Create(
        startingCorruption: 0,
        startingStress: 0,
        corruptionResistanceModifier: 0,
        stressResistanceModifier: -1);

    /// <summary>
    /// Default trauma baseline for Vargr-Kin lineage.
    /// </summary>
    /// <remarks>
    /// Vargr-Kin have no baseline trauma values. Their Stress reduction
    /// comes from the Primal Clarity trait instead.
    /// </remarks>
    public static LineageTraumaBaseline VargrKin => Create(
        startingCorruption: 0,
        startingStress: 0,
        corruptionResistanceModifier: 0,
        stressResistanceModifier: 0);

    /// <summary>
    /// Empty/neutral trauma baseline (no trauma, no modifiers).
    /// </summary>
    public static LineageTraumaBaseline None => Create(0, 0, 0, 0);

    /// <inheritdoc />
    public override string ToString()
    {
        var parts = new List<string>();

        if (StartingCorruption > 0)
            parts.Add($"{StartingCorruption} permanent Corruption");
        if (StartingStress > 0)
            parts.Add($"{StartingStress} starting Stress");
        if (CorruptionResistanceModifier != 0)
            parts.Add($"Corruption Resist {CorruptionResistanceModifier:+#;-#;0}");
        if (StressResistanceModifier != 0)
            parts.Add($"Stress Resist {StressResistanceModifier:+#;-#;0}");

        return parts.Count > 0 ? string.Join(", ", parts) : "No trauma modifiers";
    }
}
```

### 4.3 Trauma Baseline Reference Table

| Lineage      | Start Corruption | Start Stress | Corruption Resist | Stress Resist |
| ------------ | ---------------- | ------------ | ----------------- | ------------- |
| Clan-Born    | 0                | 0            | +0                | +0            |
| Rune-Marked  | 5 (permanent)    | 0            | -1                | +0            |
| Iron-Blooded | 0                | 0            | +0                | -1            |
| Vargr-Kin    | 0                | 0            | +0                | +0            |

---

## 5. LineageDefinition Extension

### 5.1 Purpose

This section documents the final extension of `LineageDefinition` to include the `TraumaBaseline` property, completing the entity.

### 5.2 Updated Implementation

**File:** `src/Core/RuneAndRust.Domain/Entities/LineageDefinition.cs`

```csharp
// Add to existing LineageDefinition entity:

/// <summary>
/// Gets the Trauma Economy baseline values for this lineage.
/// </summary>
/// <remarks>
/// TraumaBaseline defines starting Corruption/Stress and resistance modifiers.
/// StartingCorruption is permanent and cannot be cleansed below that value.
/// </remarks>
public LineageTraumaBaseline TraumaBaseline { get; private set; }

// Update the Create factory method signature:
public static LineageDefinition Create(
    Lineage lineageId,
    string displayName,
    string description,
    string selectionText,
    LineageAttributeModifiers attributeModifiers,
    LineagePassiveBonuses passiveBonuses,
    LineageTrait uniqueTrait,
    LineageTraumaBaseline traumaBaseline,  // ← NEW PARAMETER
    string appearanceNotes,
    string socialRole)
{
    // ... existing validation ...

    return new LineageDefinition
    {
        Id = Guid.NewGuid(),
        LineageId = lineageId,
        DisplayName = displayName,
        Description = description,
        SelectionText = selectionText,
        AttributeModifiers = attributeModifiers,
        PassiveBonuses = passiveBonuses,
        UniqueTrait = uniqueTrait,
        TraumaBaseline = traumaBaseline,  // ← NEW ASSIGNMENT
        AppearanceNotes = appearanceNotes,
        SocialRole = socialRole
    };
}

// Add helper methods:

/// <summary>
/// Gets the permanent Corruption floor for this lineage.
/// </summary>
/// <returns>The minimum Corruption value after cleansing.</returns>
public int GetPermanentCorruptionFloor() =>
    TraumaBaseline.PermanentCorruptionFloor;

/// <summary>
/// Gets whether this lineage has any trauma vulnerabilities.
/// </summary>
/// <returns>True if the lineage has resistance penalties.</returns>
public bool HasTraumaVulnerabilities() =>
    TraumaBaseline.HasAnyVulnerability;

/// <summary>
/// Gets the starting Corruption value for new characters.
/// </summary>
/// <returns>Starting Corruption from lineage.</returns>
public int GetStartingCorruption() =>
    TraumaBaseline.StartingCorruption;

/// <summary>
/// Gets the Corruption resistance modifier for this lineage.
/// </summary>
/// <returns>Modifier to add to Corruption resistance checks.</returns>
public int GetCorruptionResistanceModifier() =>
    TraumaBaseline.CorruptionResistanceModifier;

/// <summary>
/// Gets the Stress resistance modifier for this lineage.
/// </summary>
/// <returns>Modifier to add to Stress resistance checks.</returns>
public int GetStressResistanceModifier() =>
    TraumaBaseline.StressResistanceModifier;
```

### 5.3 Complete LineageDefinition Property Summary

| Property             | Type                        | Added In | Description                  |
| -------------------- | --------------------------- | -------- | ---------------------------- |
| `Id`                 | `Guid`                      | v0.17.0a | Unique identifier            |
| `LineageId`          | `Lineage`                   | v0.17.0a | Enum value for this lineage  |
| `DisplayName`        | `string`                    | v0.17.0a | UI display name              |
| `Description`        | `string`                    | v0.17.0a | Full description             |
| `SelectionText`      | `string`                    | v0.17.0a | Character creation flavor    |
| `AttributeModifiers` | `LineageAttributeModifiers` | v0.17.0a | MIGHT/FINESSE/etc. modifiers |
| `PassiveBonuses`     | `LineagePassiveBonuses`     | v0.17.0b | HP/AP/Soak/Movement/Skills   |
| `UniqueTrait`        | `LineageTrait`              | v0.17.0c | Signature ability            |
| `TraumaBaseline`     | `LineageTraumaBaseline`     | v0.17.0d | Corruption/Stress baseline   |
| `AppearanceNotes`    | `string`                    | v0.17.0a | Physical appearance notes    |
| `SocialRole`         | `string`                    | v0.17.0a | Typical social position      |

---

## 6. Data Model Changes

### 6.1 New Types Summary

| Type                    | Layer  | Category     | Description                    |
| ----------------------- | ------ | ------------ | ------------------------------ |
| `LineageTraumaBaseline` | Domain | Value Object | Trauma Economy starting values |

### 6.2 Updated Types Summary

| Type                | Layer  | Category | Changes                         |
| ------------------- | ------ | -------- | ------------------------------- |
| `LineageDefinition` | Domain | Entity   | Added `TraumaBaseline` property |

### 6.3 File Locations

```
src/Core/RuneAndRust.Domain/
├── Entities/
│   └── LineageDefinition.cs             ← UPDATED (add TraumaBaseline)
└── ValueObjects/
    └── LineageTraumaBaseline.cs         ← NEW

config/
└── lineages.json                        ← UPDATED (add traumaBaseline section)
```

### 6.4 Complete LineageDefinition Relationship Diagram

```
┌──────────────────────────────────────────────────────────────────┐
│                       LineageDefinition                           │
│                          (Entity)                                 │
├──────────────────────────────────────────────────────────────────┤
│ Id: Guid                                                          │
│ LineageId: Lineage ─────────────────────▶ [Lineage Enum]         │
│ DisplayName: string                                               │
│ Description: string                                               │
│ SelectionText: string                                             │
│ AppearanceNotes: string                                           │
│ SocialRole: string                                                │
├──────────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ AttributeModifiers: LineageAttributeModifiers     (v0.17.0a) │ │
│ │   └── MIGHT/FINESSE/WITS/WILL/STURDINESS modifiers          │ │
│ └──────────────────────────────────────────────────────────────┘ │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ PassiveBonuses: LineagePassiveBonuses             (v0.17.0b) │ │
│ │   └── HP/AP/Soak/Movement/Skills bonuses                     │ │
│ └──────────────────────────────────────────────────────────────┘ │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ UniqueTrait: LineageTrait                         (v0.17.0c) │ │
│ │   └── Signature ability with conditions                      │ │
│ └──────────────────────────────────────────────────────────────┘ │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │ TraumaBaseline: LineageTraumaBaseline             (v0.17.0d) │ │
│ │   └── Corruption/Stress starting values & resistance mods   │ │
│ └──────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
```

---

## 7. Configuration File Schema Updates

### 7.1 lineages.json (Extended - Trauma Baseline Section)

**File:** `config/lineages.json` (trauma baseline additions only)

```json
{
    "lineages": [
        {
            "lineageId": "ClanBorn",
            "traumaBaseline": {
                "startingCorruption": 0,
                "startingStress": 0,
                "corruptionResistanceModifier": 0,
                "stressResistanceModifier": 0
            }
        },
        {
            "lineageId": "RuneMarked",
            "traumaBaseline": {
                "startingCorruption": 5,
                "startingStress": 0,
                "corruptionResistanceModifier": -1,
                "stressResistanceModifier": 0
            }
        },
        {
            "lineageId": "IronBlooded",
            "traumaBaseline": {
                "startingCorruption": 0,
                "startingStress": 0,
                "corruptionResistanceModifier": 0,
                "stressResistanceModifier": -1
            }
        },
        {
            "lineageId": "VargrKin",
            "traumaBaseline": {
                "startingCorruption": 0,
                "startingStress": 0,
                "corruptionResistanceModifier": 0,
                "stressResistanceModifier": 0
            }
        }
    ]
}
```

### 7.2 lineages.schema.json (Extended)

**File:** `config/schemas/lineages.schema.json` (additions to `$defs`)

```json
{
    "$defs": {
        "lineageDefinition": {
            "required": [
                "lineageId",
                "displayName",
                "attributeModifiers",
                "passiveBonuses",
                "uniqueTrait",
                "traumaBaseline"
            ],
            "properties": {
                "traumaBaseline": {
                    "$ref": "#/$defs/traumaBaseline"
                }
            }
        },
        "traumaBaseline": {
            "type": "object",
            "description": "Trauma Economy baseline values for this lineage",
            "required": [
                "startingCorruption",
                "startingStress",
                "corruptionResistanceModifier",
                "stressResistanceModifier"
            ],
            "properties": {
                "startingCorruption": {
                    "type": "integer",
                    "description": "Permanent Corruption at character creation",
                    "minimum": 0,
                    "maximum": 50
                },
                "startingStress": {
                    "type": "integer",
                    "description": "Initial Stress at character creation",
                    "minimum": 0,
                    "maximum": 50
                },
                "corruptionResistanceModifier": {
                    "type": "integer",
                    "description": "Modifier to Corruption resistance checks",
                    "minimum": -10,
                    "maximum": 10
                },
                "stressResistanceModifier": {
                    "type": "integer",
                    "description": "Modifier to Stress resistance checks",
                    "minimum": -10,
                    "maximum": 10
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 8. Logging Specifications

### 8.1 Log Levels by Component

| Component               | Level       | Events                                        |
| ----------------------- | ----------- | --------------------------------------------- |
| `LineageTraumaBaseline` | Debug       | Baseline created, cleanse calculation         |
| `TraumaService`         | Information | Permanent Corruption applied, resistance used |
| `TraumaService`         | Warning     | Cleanse blocked by permanent floor            |
| `CharacterFactory`      | Information | Starting trauma applied to new character      |
| `LineageProvider`       | Debug       | Trauma baseline loaded from config            |

### 8.2 Structured Logging Templates

```csharp
// Information - Starting trauma applied
_logger.LogInformation(
    "Lineage trauma baseline applied. CharacterId={CharId}, Lineage={Lineage}, Corruption={Corr}, Stress={Stress}",
    characterId,
    lineage,
    baseline.StartingCorruption,
    baseline.StartingStress);

// Warning - Cleanse blocked by permanent floor
_logger.LogWarning(
    "Corruption cleanse limited by permanent floor. CharacterId={CharId}, Requested={Requested}, Floor={Floor}, Actual={Actual}",
    characterId,
    requestedCleanse,
    permanentFloor,
    actualResult);

// Debug - Resistance modifier applied
_logger.LogDebug(
    "Applying lineage resistance modifier. Type={Type}, BaseResistance={Base}, Modifier={Mod}, Final={Final}",
    resistanceType,
    baseResistance,
    modifier,
    finalResistance);
```

---

## 9. Unit Testing Requirements

### 9.1 Test Count by Feature

| Feature               | Test Count |
| --------------------- | ---------- |
| LineageTraumaBaseline | ~4         |
| **Total**             | **~4**     |

### 9.2 Test Specifications

#### LineageTraumaBaselineTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/LineageTraumaBaselineTests.cs`

```csharp
[TestFixture]
public class LineageTraumaBaselineTests
{
    [Test]
    public void Create_WithValidParameters_CreatesBaseline();

    [Test]
    public void Create_WithNegativeStartingCorruption_ThrowsArgumentOutOfRangeException();

    [Test]
    public void ClanBorn_HasBaselineValues_ReturnsZeros();

    [Test]
    public void RuneMarked_HasPermanentCorruption_ReturnsFiveCorruption();

    [Test]
    public void RuneMarked_HasCorruptionVulnerability_ReturnsNegativeOne();

    [Test]
    public void IronBlooded_HasStressVulnerability_ReturnsNegativeOne();

    [Test]
    public void VargrKin_HasBaselineValues_ReturnsZeros();

    [Test]
    public void HasPermanentCorruption_WhenPositive_ReturnsTrue();

    [Test]
    public void HasPermanentCorruption_WhenZero_ReturnsFalse();

    [Test]
    public void CalculateCorruptionAfterCleanse_RespectsFloor();

    [Test]
    public void CalculateCorruptionAfterCleanse_AllowsCleanseAboveFloor();

    [Test]
    public void HasAnyVulnerability_WithResistancePenalty_ReturnsTrue();

    [Test]
    public void HasAnyVulnerability_WithNoModifiers_ReturnsFalse();
}
```

---

## 10. Use Cases

### UC-001: Display Trauma Warning During Creation

**Actor:** Character Creation UI  
**Flow:** Player selects Rune-Marked → Get trauma baseline → Detect permanent Corruption → Display warning → Player confirms choice

### UC-002: Apply Starting Trauma to New Character

**Actor:** Character Factory  
**Flow:** Create character → Get lineage definition → Get trauma baseline → Set CurrentCorruption = StartingCorruption → Set PermanentCorruption floor

### UC-003: Apply Resistance Modifiers to Check

**Actor:** Trauma Service  
**Flow:** Character resists Corruption → Calculate base resistance → Get lineage modifier → Apply modifier → Perform check

### UC-004: Block Over-Cleansing Permanent Corruption

**Actor:** Corruption Cleansing Service  
**Flow:** Player attempts cleanse → Calculate result → Check permanent floor → Set to floor if below → Display message

---

## 11. User Stories

### US-001: Understand Trauma Consequences

**As a** player selecting a lineage  
**I want to** understand the Trauma Economy implications of each choice  
**So that** I can make an informed decision about my character's vulnerabilities

**Acceptance Criteria:**

- Permanent Corruption clearly labeled as permanent
- Resistance penalties shown as negative modifiers
- Tooltips explain Corruption and Stress mechanics

### US-002: See Lineage Trauma on Character

**As a** player viewing my character sheet  
**I want to** see my lineage's trauma baseline in my stats  
**So that** I understand why my Corruption can't go below a certain value

**Acceptance Criteria:**

- Permanent Corruption floor shown in Corruption tooltip
- Lineage source indicated for resistance modifiers
- Visual distinction between permanent and removable Corruption

### US-003: Receive Cleanse Warning

**As a** player attempting to cleanse Corruption  
**I want to** be warned when I hit my permanent floor  
**So that** I understand I cannot fully cleanse due to my lineage

**Acceptance Criteria:**

- Warning displayed when cleanse is limited
- Permanent floor value shown in message
- Player informed that lineage prevents full cleansing

---

## 12. Deliverable Checklist

### Domain Layer

- [ ] `LineageTraumaBaseline.cs` value object created in `ValueObjects/`
- [ ] `LineageDefinition.cs` updated with `TraumaBaseline` property
- [ ] All types have complete XML documentation

### Configuration Files

- [ ] `config/lineages.json` updated with traumaBaseline for all 4 lineages
- [ ] `config/schemas/lineages.schema.json` updated with traumaBaseline schema
- [ ] Configuration validates against updated schema

### Testing

- [ ] `LineageTraumaBaselineTests.cs` created
- [ ] ~4 unit tests passing

### Documentation

- [ ] `v0.17.0d-changelog.md` created
- [ ] Inline code comments complete

---

## 13. Acceptance Criteria

### Functional

- [ ] `LineageTraumaBaseline` stores all four properties
- [ ] `LineageTraumaBaseline.Create()` validates non-negative starting values
- [ ] `CalculateCorruptionAfterCleanse()` respects permanent floor
- [ ] Clan-Born has all baseline values (0, 0, 0, 0)
- [ ] Rune-Marked has 5 permanent Corruption, -1 Corruption Resistance
- [ ] Iron-Blooded has -1 Stress Resistance
- [ ] Vargr-Kin has baseline values (0, 0, 0, 0)
- [ ] `LineageDefinition.TraumaBaseline` property accessible
- [ ] `HasPermanentCorruption` returns true when StartingCorruption > 0

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~4 unit tests pass
- [ ] Configuration validates against JSON schema
- [ ] All public types have XML documentation

---

## 14. Dependencies

### Required from v0.17.0a-c

| Type                        | Location                           | Usage                         |
| --------------------------- | ---------------------------------- | ----------------------------- |
| `Lineage`                   | `RuneAndRust.Domain/Enums/`        | Referenced by definition      |
| `LineageDefinition`         | `RuneAndRust.Domain/Entities/`     | Extended with trauma baseline |
| `LineageAttributeModifiers` | `RuneAndRust.Domain/ValueObjects/` | Sibling data in definition    |
| `LineagePassiveBonuses`     | `RuneAndRust.Domain/ValueObjects/` | Sibling data in definition    |
| `LineageTrait`              | `RuneAndRust.Domain/ValueObjects/` | Sibling data in definition    |

### Provides to v0.17.0e

| Type                    | Usage                                   |
| ----------------------- | --------------------------------------- |
| `LineageTraumaBaseline` | Component of complete LineageDefinition |

### Provides to v0.17.0f

| Type                    | Usage                                |
| ----------------------- | ------------------------------------ |
| `LineageTraumaBaseline` | Applied by LineageApplicationService |

### Provides to Trauma Economy System

| Type                    | Usage                                                  |
| ----------------------- | ------------------------------------------------------ |
| `LineageTraumaBaseline` | Starting values, resistance modifiers, permanent floor |

---

## 15. Future Considerations

### Deferred to v0.17.0e

- **ILineageProvider Interface**: Access pattern for complete lineage data
- **LineageProvider Implementation**: Configuration loading

### Deferred to v0.17.0f

- **ILineageApplicationService**: Actual application of trauma baseline to character
- **CharacterFactory integration**: Hookup during character creation

### Deferred to Trauma Economy System

- **TraumaService Integration**: Using resistance modifiers in checks
- **Corruption Cleansing**: Enforcing permanent floor
- **Stress Accumulation**: Applying Stress resistance modifiers
- **Primal Clarity Integration**: Connecting trait to Stress reduction

### Out of Scope

- **Positive Resistance Modifiers**: No lineage grants resistance bonuses (by design)
- **Removable Starting Trauma**: All starting Corruption is permanent
- **Dynamic Baselines**: Trauma baselines are fixed at character creation

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_  
_Author: AI Assistant_
