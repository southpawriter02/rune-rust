# v0.8.1c Design Specification: Tooltip Service

**Version:** 0.8.1c
**Parent:** v0.8.1 (Navigation & Information)
**Prerequisites:** v0.8.1b Complete (Quest Log Window)
**Status:** Design Complete
**Estimated Unit Tests:** ~10

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Tooltip Service](#4-tooltip-service)
5. [Tooltip Control](#5-tooltip-control)
6. [Tooltip Content Models](#6-tooltip-content-models)
7. [Attached Properties](#7-attached-properties)
8. [Tooltip Positioning](#8-tooltip-positioning)
9. [Styles](#9-styles)
10. [Data Model Changes](#10-data-model-changes)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)

---

## 1. Overview

### Purpose

Implement a tooltip service that provides hover information for items, abilities, status effects, and UI elements. Tooltips appear after a configurable delay, auto-position to stay on screen, and use consistent styling. The service supports both simple text tooltips and rich content with sections, icons, and colors.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Interfaces** | `ITooltipService` |
| **Services** | `TooltipService` |
| **Controls** | `TooltipControl` |
| **Attached Properties** | `TooltipHelper.Text`, `TooltipHelper.Item`, `TooltipHelper.Ability` |
| **Models** | `TooltipContent`, `TooltipSection`, `TooltipLine` |
| **Styles** | `TooltipStyles.axaml` |
| **Tests** | ~10 unit tests |

### Design Principles

1. **Delayed Appearance**: Tooltips appear after 500ms (configurable)
2. **Auto-Positioning**: Stay on screen, follow cursor
3. **Rich Content**: Support sections, icons, and colored text
4. **Consistency**: Unified styling across all tooltip types
5. **Accessibility**: Can be disabled in settings

---

## 2. Feature Overview

```
v0.8.1c Features
â”œâ”€â”€ ITooltipService Interface
â”‚   â”œâ”€â”€ ShowDelayMs property (default 500)
â”‚   â”œâ”€â”€ IsEnabled property
â”‚   â”œâ”€â”€ ShowItemTooltip(item, target)
â”‚   â”œâ”€â”€ ShowAbilityTooltip(ability, target)
â”‚   â”œâ”€â”€ ShowStatusEffectTooltip(effect, target)
â”‚   â”œâ”€â”€ ShowTextTooltip(text, target)
â”‚   â”œâ”€â”€ ShowTooltip(content, target)
â”‚   â”œâ”€â”€ HideTooltip()
â”‚   â””â”€â”€ OnTooltipChanged event
â”‚
â”œâ”€â”€ TooltipService Implementation
â”‚   â”œâ”€â”€ Delay scheduling (CancellationTokenSource)
â”‚   â”œâ”€â”€ Content builder methods
â”‚   â”œâ”€â”€ Settings integration (enable/disable)
â”‚   â””â”€â”€ Current target tracking
â”‚
â”œâ”€â”€ TooltipControl
â”‚   â”œâ”€â”€ Rich content rendering
â”‚   â”œâ”€â”€ Auto-positioning logic
â”‚   â”œâ”€â”€ Fade in/out animations
â”‚   â””â”€â”€ Screen boundary detection
â”‚
â”œâ”€â”€ TooltipContent Model
â”‚   â”œâ”€â”€ Title (with icon)
â”‚   â”œâ”€â”€ Subtitle
â”‚   â”œâ”€â”€ Sections (stats, effects)
â”‚   â”œâ”€â”€ Description
â”‚   â””â”€â”€ Footer (hints, value)
â”‚
â”œâ”€â”€ Item Tooltips
â”‚   â”œâ”€â”€ Name + type icon
â”‚   â”œâ”€â”€ Category/subcategory
â”‚   â”œâ”€â”€ Stats section (damage, attack, weight)
â”‚   â”œâ”€â”€ Description
â”‚   â””â”€â”€ Value in gold
â”‚
â”œâ”€â”€ Ability Tooltips
â”‚   â”œâ”€â”€ Name + school icon
â”‚   â”œâ”€â”€ Level/school info
â”‚   â”œâ”€â”€ Stats section (damage, range, cost, cooldown)
â”‚   â”œâ”€â”€ Description
â”‚   â””â”€â”€ Hotkey hint
â”‚
â”œâ”€â”€ Status Effect Tooltips
â”‚   â”œâ”€â”€ Name + buff/debuff icon
â”‚   â”œâ”€â”€ Category
â”‚   â”œâ”€â”€ Effect details (damage, duration, source)
â”‚   â””â”€â”€ Description + remedies
â”‚
â”œâ”€â”€ Attached Properties
â”‚   â”œâ”€â”€ TooltipHelper.Text (simple string)
â”‚   â”œâ”€â”€ TooltipHelper.Item (Item binding)
â”‚   â””â”€â”€ TooltipHelper.Ability (AbilityDefinition binding)
â”‚
â””â”€â”€ Settings Integration
    â””â”€â”€ Tooltips can be disabled via settings
```

---

## 3. Architecture

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PRESENTATION LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Services                                                               â”‚
â”‚  â””â”€â”€ ITooltipService                                                   â”‚
â”‚       â”œâ”€â”€ int ShowDelayMs                                              â”‚
â”‚       â”œâ”€â”€ bool IsEnabled                                               â”‚
â”‚       â”œâ”€â”€ ShowItemTooltip(Item, Control)                               â”‚
â”‚       â”œâ”€â”€ ShowAbilityTooltip(AbilityDefinition, Control)               â”‚
â”‚       â”œâ”€â”€ ShowStatusEffectTooltip(StatusEffect, Control)               â”‚
â”‚       â”œâ”€â”€ ShowTextTooltip(string, Control)                             â”‚
â”‚       â”œâ”€â”€ ShowTooltip(TooltipContent, Control)                         â”‚
â”‚       â”œâ”€â”€ HideTooltip()                                                â”‚
â”‚       â””â”€â”€ event OnTooltipChanged(TooltipContent?)                      â”‚
â”‚                                                                         â”‚
â”‚  Controls                                                               â”‚
â”‚  â””â”€â”€ TooltipControl : TemplatedControl                                 â”‚
â”‚       â”œâ”€â”€ TooltipContent? Content                                      â”‚
â”‚       â”œâ”€â”€ PositionTooltip() (auto-positioning)                         â”‚
â”‚       â””â”€â”€ OnContentChanged() (fade animation)                          â”‚
â”‚                                                                         â”‚
â”‚  Attached Properties                                                    â”‚
â”‚  â””â”€â”€ TooltipHelper                                                     â”‚
â”‚       â”œâ”€â”€ AttachedProperty<string> Text                                â”‚
â”‚       â”œâ”€â”€ AttachedProperty<Item> Item                                  â”‚
â”‚       â”œâ”€â”€ AttachedProperty<AbilityDefinition> Ability                  â”‚
â”‚       â””â”€â”€ AttachedProperty<StatusEffect> StatusEffect                  â”‚
â”‚                                                                         â”‚
â”‚  Models                                                                 â”‚
â”‚  â”œâ”€â”€ TooltipContent                                                    â”‚
â”‚  â”‚    â”œâ”€â”€ string Title                                                 â”‚
â”‚  â”‚    â”œâ”€â”€ string? Subtitle                                             â”‚
â”‚  â”‚    â”œâ”€â”€ IReadOnlyList<TooltipSection> Sections                       â”‚
â”‚  â”‚    â”œâ”€â”€ string? Description                                          â”‚
â”‚  â”‚    â””â”€â”€ string? Footer                                               â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ TooltipSection                                                    â”‚
â”‚  â”‚    â”œâ”€â”€ string? Header                                               â”‚
â”‚  â”‚    â””â”€â”€ IReadOnlyList<TooltipLine> Lines                             â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ TooltipLine                                                       â”‚
â”‚       â”œâ”€â”€ string Label                                                 â”‚
â”‚       â”œâ”€â”€ string Value                                                 â”‚
â”‚       â””â”€â”€ Color? ValueColor                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DOMAIN LAYER                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Entities                                                               â”‚
â”‚  â”œâ”€â”€ Item                                                               â”‚
â”‚  â”‚    â”œâ”€â”€ Name, Description, ItemType, Category                        â”‚
â”‚  â”‚    â”œâ”€â”€ Damage, AttackBonus, Weight                                  â”‚
â”‚  â”‚    â””â”€â”€ Value                                                        â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â”œâ”€â”€ AbilityDefinition                                                 â”‚
â”‚  â”‚    â”œâ”€â”€ Name, Description, School, Level                             â”‚
â”‚  â”‚    â”œâ”€â”€ DamageFormula, Range, Cost, Cooldown                         â”‚
â”‚  â”‚    â””â”€â”€ Icon, Hotkey                                                 â”‚
â”‚  â”‚                                                                     â”‚
â”‚  â””â”€â”€ StatusEffect                                                      â”‚
â”‚       â”œâ”€â”€ Name, Description, EffectType                                â”‚
â”‚       â”œâ”€â”€ DamagePerTurn, Duration, Source                              â”‚
â”‚       â””â”€â”€ Remedies                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tooltip Display Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TOOLTIP DISPLAY FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Mouse Enters Control with TooltipHelper attached
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               TooltipHelper.OnPointerEnter()                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Get tooltip data from attached property                            â”‚
â”‚  2. Call appropriate ITooltipService.Show*Tooltip() method             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 TooltipService.ScheduleShow()                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Cancel any existing show timer                                     â”‚
â”‚  2. Check if IsEnabled (respect settings)                              â”‚
â”‚  3. Build TooltipContent from domain object                            â”‚
â”‚  4. Start delay timer (ShowDelayMs)                                    â”‚
â”‚  5. After delay: Fire OnTooltipChanged event                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TooltipControl.OnContentChanged()                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Set Content property                                               â”‚
â”‚  2. Calculate position (near cursor, on screen)                        â”‚
â”‚  3. Make visible with fade-in                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
    Mouse Leaves Control
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                TooltipService.HideTooltip()                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Cancel show timer if pending                                       â”‚
â”‚  2. Fire OnTooltipChanged(null)                                        â”‚
â”‚  3. TooltipControl fades out                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Tooltip Service

### ITooltipService Interface

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/ITooltipService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

/// <summary>
/// Manages tooltip display throughout the application.
/// </summary>
/// <remarks>
/// Provides unified tooltip handling for items, abilities, status effects,
/// and simple text tooltips. Supports configurable delay and settings integration.
/// </remarks>
public interface ITooltipService
{
    /// <summary>
    /// Gets or sets the delay in milliseconds before showing tooltips.
    /// </summary>
    /// <remarks>
    /// Default is 500ms. Set to 0 for instant tooltips.
    /// </remarks>
    int ShowDelayMs { get; set; }

    /// <summary>
    /// Gets or sets whether tooltips are enabled.
    /// </summary>
    /// <remarks>
    /// Integrated with application settings for user preference.
    /// </remarks>
    bool IsEnabled { get; set; }

    /// <summary>
    /// Shows a tooltip for an item.
    /// </summary>
    /// <param name="item">The item to display.</param>
    /// <param name="target">The control that triggered the tooltip.</param>
    void ShowItemTooltip(Item item, Control target);

    /// <summary>
    /// Shows a tooltip for an ability.
    /// </summary>
    /// <param name="ability">The ability to display.</param>
    /// <param name="target">The control that triggered the tooltip.</param>
    void ShowAbilityTooltip(AbilityDefinition ability, Control target);

    /// <summary>
    /// Shows a tooltip for a status effect.
    /// </summary>
    /// <param name="effect">The status effect to display.</param>
    /// <param name="target">The control that triggered the tooltip.</param>
    void ShowStatusEffectTooltip(StatusEffect effect, Control target);

    /// <summary>
    /// Shows a simple text tooltip.
    /// </summary>
    /// <param name="text">The text to display.</param>
    /// <param name="target">The control that triggered the tooltip.</param>
    void ShowTextTooltip(string text, Control target);

    /// <summary>
    /// Shows a tooltip with custom rich content.
    /// </summary>
    /// <param name="content">The tooltip content to display.</param>
    /// <param name="target">The control that triggered the tooltip.</param>
    void ShowTooltip(TooltipContent content, Control target);

    /// <summary>
    /// Hides the current tooltip.
    /// </summary>
    void HideTooltip();

    /// <summary>
    /// Event fired when tooltip content changes.
    /// </summary>
    /// <remarks>
    /// TooltipControl subscribes to this to update display.
    /// Null content indicates tooltip should be hidden.
    /// </remarks>
    event Action<TooltipContent?>? OnTooltipChanged;
}
```

### TooltipService Implementation

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/TooltipService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

/// <summary>
/// Implementation of the tooltip service.
/// </summary>
public class TooltipService : ITooltipService
{
    private readonly ILogger<TooltipService> _logger;
    private CancellationTokenSource? _showCts;
    private Control? _currentTarget;

    public int ShowDelayMs { get; set; } = 500;
    public bool IsEnabled { get; set; } = true;

    public event Action<TooltipContent?>? OnTooltipChanged;

    public TooltipService(ILogger<TooltipService> logger)
    {
        _logger = logger;
    }

    /// <inheritdoc />
    public void ShowItemTooltip(Item item, Control target)
    {
        if (!IsEnabled) return;

        var content = BuildItemTooltip(item);
        ScheduleShow(content, target);
    }

    /// <inheritdoc />
    public void ShowAbilityTooltip(AbilityDefinition ability, Control target)
    {
        if (!IsEnabled) return;

        var content = BuildAbilityTooltip(ability);
        ScheduleShow(content, target);
    }

    /// <inheritdoc />
    public void ShowStatusEffectTooltip(StatusEffect effect, Control target)
    {
        if (!IsEnabled) return;

        var content = BuildStatusEffectTooltip(effect);
        ScheduleShow(content, target);
    }

    /// <inheritdoc />
    public void ShowTextTooltip(string text, Control target)
    {
        if (!IsEnabled) return;

        var content = new TooltipContent(
            Title: text,
            Subtitle: null,
            Sections: Array.Empty<TooltipSection>(),
            Description: null,
            Footer: null
        );
        ScheduleShow(content, target);
    }

    /// <inheritdoc />
    public void ShowTooltip(TooltipContent content, Control target)
    {
        if (!IsEnabled) return;

        ScheduleShow(content, target);
    }

    /// <inheritdoc />
    public void HideTooltip()
    {
        _showCts?.Cancel();
        _showCts = null;
        _currentTarget = null;
        OnTooltipChanged?.Invoke(null);

        _logger.LogDebug("Tooltip hidden");
    }

    private async void ScheduleShow(TooltipContent content, Control target)
    {
        _showCts?.Cancel();
        _showCts = new CancellationTokenSource();
        _currentTarget = target;

        try
        {
            await Task.Delay(ShowDelayMs, _showCts.Token);
            OnTooltipChanged?.Invoke(content);

            _logger.LogDebug("Showing tooltip: {Title}", content.Title);
        }
        catch (TaskCanceledException)
        {
            // Tooltip was cancelled before showing (mouse left)
        }
    }

    private TooltipContent BuildItemTooltip(Item item)
    {
        var statsLines = new List<TooltipLine>();

        if (!string.IsNullOrEmpty(item.Damage))
            statsLines.Add(new TooltipLine("Damage", item.Damage, null));

        if (item.AttackBonus != 0)
            statsLines.Add(new TooltipLine("Attack", $"+{item.AttackBonus}", null));

        if (item.DefenseBonus != 0)
            statsLines.Add(new TooltipLine("Defense", $"+{item.DefenseBonus}", null));

        statsLines.Add(new TooltipLine("Weight", $"{item.Weight} lbs", null));

        var sections = new List<TooltipSection>
        {
            new TooltipSection(null, statsLines)
        };

        return new TooltipContent(
            Title: $"{GetItemIcon(item.Category)} {item.Name.ToUpperInvariant()}",
            Subtitle: $"{item.ItemType} ({item.Category})",
            Sections: sections,
            Description: item.Description,
            Footer: $"Value: {item.Value} gold"
        );
    }

    private TooltipContent BuildAbilityTooltip(AbilityDefinition ability)
    {
        var statsLines = new List<TooltipLine>();

        if (!string.IsNullOrEmpty(ability.DamageFormula))
            statsLines.Add(new TooltipLine("Damage", ability.DamageFormula, null));

        if (ability.Range > 0)
            statsLines.Add(new TooltipLine("Range", $"{ability.Range} cells", null));

        if (ability.Area is not null)
            statsLines.Add(new TooltipLine("Area", ability.Area.ToString(), null));

        statsLines.Add(new TooltipLine("Cost", 
            $"{ability.Cost.Amount} {ability.Cost.ResourceTypeId}", null));

        if (ability.Cooldown > 0)
            statsLines.Add(new TooltipLine("Cooldown", $"{ability.Cooldown} turns", null));

        var sections = new List<TooltipSection>
        {
            new TooltipSection(null, statsLines)
        };

        var footer = ability.Hotkey is not null 
            ? $"[Press {ability.Hotkey} to use]" 
            : null;

        return new TooltipContent(
            Title: $"{ability.Icon} {ability.Name.ToUpperInvariant()}",
            Subtitle: $"{ability.School} â€¢ Level {ability.Level}",
            Sections: sections,
            Description: ability.Description,
            Footer: footer
        );
    }

    private TooltipContent BuildStatusEffectTooltip(StatusEffect effect)
    {
        var statsLines = new List<TooltipLine>();

        if (effect.DamagePerTurn > 0)
            statsLines.Add(new TooltipLine("Effect", 
                $"{effect.DamagePerTurn} damage per turn", Colors.Red));

        if (effect.HealingPerTurn > 0)
            statsLines.Add(new TooltipLine("Effect", 
                $"{effect.HealingPerTurn} healing per turn", Colors.Green));

        statsLines.Add(new TooltipLine("Duration", 
            $"{effect.RemainingDuration} turns remaining", null));

        if (!string.IsNullOrEmpty(effect.Source))
            statsLines.Add(new TooltipLine("Source", effect.Source, null));

        var sections = new List<TooltipSection>
        {
            new TooltipSection(null, statsLines)
        };

        var description = effect.Description;
        if (!string.IsNullOrEmpty(effect.Remedy))
            description += $"\n{effect.Remedy}";

        return new TooltipContent(
            Title: $"{GetEffectIcon(effect.EffectType)} {effect.Name.ToUpperInvariant()}",
            Subtitle: $"{effect.EffectType} â€¢ {effect.Category}",
            Sections: sections,
            Description: description,
            Footer: null
        );
    }

    private static string GetItemIcon(ItemCategory category) => category switch
    {
        ItemCategory.Weapon => "âš”",
        ItemCategory.Armor => "ğŸ›¡",
        ItemCategory.Accessory => "ğŸ’",
        ItemCategory.Consumable => "ğŸ§ª",
        ItemCategory.Quest => "ğŸ“œ",
        ItemCategory.Misc => "ğŸ“¦",
        _ => "â€¢"
    };

    private static string GetEffectIcon(EffectType type) => type switch
    {
        EffectType.Buff => "âœ¨",
        EffectType.Debuff => "ğŸ©¸",
        EffectType.Poison => "â˜ ",
        EffectType.Burning => "ğŸ”¥",
        EffectType.Frozen => "â„",
        EffectType.Stunned => "ğŸ’«",
        _ => "â€¢"
    };
}
```

---

## 5. Tooltip Control

### TooltipControl

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/TooltipControl.cs`

```csharp
namespace RuneAndRust.Avalonia.Controls;

/// <summary>
/// Displays rich tooltip content with auto-positioning.
/// </summary>
/// <remarks>
/// Subscribes to ITooltipService.OnTooltipChanged to update content.
/// Automatically positions itself near the cursor while staying on screen.
/// </remarks>
public class TooltipControl : TemplatedControl
{
    private const double CursorOffsetX = 16;
    private const double CursorOffsetY = 16;
    private const double ScreenMargin = 8;

    public static readonly StyledProperty<TooltipContent?> ContentProperty =
        AvaloniaProperty.Register<TooltipControl, TooltipContent?>(nameof(Content));

    private readonly ITooltipService _tooltipService;

    public TooltipContent? Content
    {
        get => GetValue(ContentProperty);
        set => SetValue(ContentProperty, value);
    }

    public TooltipControl()
    {
        // Will be injected via DI or set manually
        _tooltipService = null!;
        IsVisible = false;
    }

    public TooltipControl(ITooltipService tooltipService)
    {
        _tooltipService = tooltipService;
        _tooltipService.OnTooltipChanged += HandleTooltipChanged;
        IsVisible = false;
    }

    private void HandleTooltipChanged(TooltipContent? content)
    {
        Content = content;
        IsVisible = content is not null;

        if (content is not null)
        {
            PositionTooltip();
        }
    }

    protected override void OnPropertyChanged(AvaloniaPropertyChangedEventArgs change)
    {
        base.OnPropertyChanged(change);

        if (change.Property == ContentProperty && Content is not null)
        {
            PositionTooltip();
        }
    }

    private void PositionTooltip()
    {
        var mousePos = GetMousePosition();
        var screenBounds = GetScreenBounds();

        // Calculate initial position (offset from cursor)
        var x = mousePos.X + CursorOffsetX;
        var y = mousePos.Y + CursorOffsetY;

        // Get tooltip size (after layout)
        Dispatcher.UIThread.Post(() =>
        {
            var tooltipWidth = Bounds.Width;
            var tooltipHeight = Bounds.Height;

            // Keep on screen (right edge)
            if (x + tooltipWidth > screenBounds.Right - ScreenMargin)
            {
                x = mousePos.X - tooltipWidth - ScreenMargin;
            }

            // Keep on screen (bottom edge)
            if (y + tooltipHeight > screenBounds.Bottom - ScreenMargin)
            {
                y = mousePos.Y - tooltipHeight - ScreenMargin;
            }

            // Keep on screen (left edge)
            x = Math.Max(ScreenMargin, x);

            // Keep on screen (top edge)
            y = Math.Max(ScreenMargin, y);

            Canvas.SetLeft(this, x);
            Canvas.SetTop(this, y);
        }, DispatcherPriority.Layout);
    }

    private Point GetMousePosition()
    {
        // Get mouse position relative to screen
        var topLevel = TopLevel.GetTopLevel(this);
        if (topLevel is null) return new Point(0, 0);

        var pointerPosition = topLevel.PointToScreen(
            topLevel.PointerOverElement?.TranslatePoint(new Point(0, 0), topLevel) 
            ?? new Point(0, 0));

        return new Point(pointerPosition.X, pointerPosition.Y);
    }

    private Rect GetScreenBounds()
    {
        var topLevel = TopLevel.GetTopLevel(this);
        if (topLevel is null) return new Rect(0, 0, 1920, 1080);

        return new Rect(0, 0, topLevel.ClientSize.Width, topLevel.ClientSize.Height);
    }

    protected override void OnDetachedFromVisualTree(VisualTreeAttachmentEventArgs e)
    {
        base.OnDetachedFromVisualTree(e);
        
        if (_tooltipService is not null)
            _tooltipService.OnTooltipChanged -= HandleTooltipChanged;
    }
}
```

### TooltipControl Template

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/TooltipControl.axaml`

```xml
<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="using:RuneAndRust.Avalonia.Controls"
                    xmlns:models="using:RuneAndRust.Avalonia.Models">
    
    <ControlTheme x:Key="{x:Type controls:TooltipControl}" 
                  TargetType="controls:TooltipControl">
        
        <Setter Property="MaxWidth" Value="350" />
        
        <Setter Property="Template">
            <ControlTemplate>
                <Border Classes="tooltip-container"
                        Padding="12"
                        IsVisible="{TemplateBinding Content, Converter={x:Static ObjectConverters.IsNotNull}}">
                    <StackPanel DataContext="{TemplateBinding Content}">
                        
                        <!-- Title -->
                        <TextBlock Text="{Binding Title}" 
                                   Classes="tooltip-title" />
                        
                        <!-- Separator -->
                        <Border Classes="tooltip-separator" 
                                Margin="0,6,0,8" />
                        
                        <!-- Subtitle -->
                        <TextBlock Text="{Binding Subtitle}"
                                   Classes="tooltip-subtitle"
                                   IsVisible="{Binding Subtitle, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                   Margin="0,0,0,8" />
                        
                        <!-- Sections -->
                        <ItemsControl ItemsSource="{Binding Sections}"
                                      Margin="0,0,0,8">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="models:TooltipSection">
                                    <Border Classes="tooltip-section" Padding="8" Margin="0,0,0,4">
                                        <StackPanel>
                                            <!-- Section Header -->
                                            <TextBlock Text="{Binding Header}"
                                                       Classes="tooltip-section-header"
                                                       IsVisible="{Binding Header, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                                       Margin="0,0,0,4" />
                                            
                                            <!-- Section Lines -->
                                            <ItemsControl ItemsSource="{Binding Lines}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate DataType="models:TooltipLine">
                                                        <Grid ColumnDefinitions="Auto,*" Margin="0,2">
                                                            <TextBlock Grid.Column="0"
                                                                       Text="{Binding Label}"
                                                                       Classes="tooltip-label"
                                                                       Margin="0,0,12,0" />
                                                            <TextBlock Grid.Column="1"
                                                                       Text="{Binding Value}"
                                                                       Classes="tooltip-value"
                                                                       Foreground="{Binding ValueColor, TargetNullValue={StaticResource ForegroundBrush}}"
                                                                       HorizontalAlignment="Right" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <!-- Description -->
                        <TextBlock Text="{Binding Description}"
                                   Classes="tooltip-description"
                                   TextWrapping="Wrap"
                                   IsVisible="{Binding Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                   Margin="0,0,0,8" />
                        
                        <!-- Footer -->
                        <TextBlock Text="{Binding Footer}"
                                   Classes="tooltip-footer"
                                   IsVisible="{Binding Footer, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                        
                    </StackPanel>
                </Border>
            </ControlTemplate>
        </Setter>
        
    </ControlTheme>
    
</ResourceDictionary>
```

---

## 6. Tooltip Content Models

**File:** `src/Presentation/RuneAndRust.Avalonia/Models/TooltipModels.cs`

```csharp
namespace RuneAndRust.Avalonia.Models;

/// <summary>
/// Rich content for tooltip display.
/// </summary>
/// <param name="Title">The main title (with optional icon).</param>
/// <param name="Subtitle">Secondary information (type, level, etc.).</param>
/// <param name="Sections">Grouped stat sections.</param>
/// <param name="Description">Descriptive text.</param>
/// <param name="Footer">Footer hint (value, hotkey, etc.).</param>
public record TooltipContent(
    string Title,
    string? Subtitle,
    IReadOnlyList<TooltipSection> Sections,
    string? Description,
    string? Footer
);

/// <summary>
/// A section containing grouped lines within a tooltip.
/// </summary>
/// <param name="Header">Optional section header.</param>
/// <param name="Lines">The lines within the section.</param>
public record TooltipSection(
    string? Header,
    IReadOnlyList<TooltipLine> Lines
);

/// <summary>
/// A single line within a tooltip section.
/// </summary>
/// <param name="Label">The label (e.g., "Damage").</param>
/// <param name="Value">The value (e.g., "2d6 + 3").</param>
/// <param name="ValueColor">Optional color for the value text.</param>
public record TooltipLine(
    string Label,
    string Value,
    Color? ValueColor
);
```

---

## 7. Attached Properties

### TooltipHelper

**File:** `src/Presentation/RuneAndRust.Avalonia/Helpers/TooltipHelper.cs`

```csharp
namespace RuneAndRust.Avalonia.Helpers;

/// <summary>
/// Attached properties for adding tooltips to controls.
/// </summary>
/// <remarks>
/// Provides declarative syntax for adding item, ability, or text tooltips
/// to any control via XAML.
/// </remarks>
public static class TooltipHelper
{
    private static ITooltipService? _tooltipService;

    /// <summary>
    /// Initializes the tooltip helper with the service instance.
    /// </summary>
    public static void Initialize(ITooltipService tooltipService)
    {
        _tooltipService = tooltipService;
    }

    #region Text Property

    public static readonly AttachedProperty<string?> TextProperty =
        AvaloniaProperty.RegisterAttached<Control, string?>("Text", typeof(TooltipHelper));

    public static string? GetText(Control element) =>
        element.GetValue(TextProperty);

    public static void SetText(Control element, string? value) =>
        element.SetValue(TextProperty, value);

    #endregion

    #region Item Property

    public static readonly AttachedProperty<Item?> ItemProperty =
        AvaloniaProperty.RegisterAttached<Control, Item?>("Item", typeof(TooltipHelper));

    public static Item? GetItem(Control element) =>
        element.GetValue(ItemProperty);

    public static void SetItem(Control element, Item? value) =>
        element.SetValue(ItemProperty, value);

    #endregion

    #region Ability Property

    public static readonly AttachedProperty<AbilityDefinition?> AbilityProperty =
        AvaloniaProperty.RegisterAttached<Control, AbilityDefinition?>("Ability", typeof(TooltipHelper));

    public static AbilityDefinition? GetAbility(Control element) =>
        element.GetValue(AbilityProperty);

    public static void SetAbility(Control element, AbilityDefinition? value) =>
        element.SetValue(AbilityProperty, value);

    #endregion

    #region StatusEffect Property

    public static readonly AttachedProperty<StatusEffect?> StatusEffectProperty =
        AvaloniaProperty.RegisterAttached<Control, StatusEffect?>("StatusEffect", typeof(TooltipHelper));

    public static StatusEffect? GetStatusEffect(Control element) =>
        element.GetValue(StatusEffectProperty);

    public static void SetStatusEffect(Control element, StatusEffect? value) =>
        element.SetValue(StatusEffectProperty, value);

    #endregion

    static TooltipHelper()
    {
        TextProperty.Changed.AddClassHandler<Control>(OnTextChanged);
        ItemProperty.Changed.AddClassHandler<Control>(OnItemChanged);
        AbilityProperty.Changed.AddClassHandler<Control>(OnAbilityChanged);
        StatusEffectProperty.Changed.AddClassHandler<Control>(OnStatusEffectChanged);
    }

    private static void OnTextChanged(Control control, AvaloniaPropertyChangedEventArgs e)
    {
        AttachEvents(control);
    }

    private static void OnItemChanged(Control control, AvaloniaPropertyChangedEventArgs e)
    {
        AttachEvents(control);
    }

    private static void OnAbilityChanged(Control control, AvaloniaPropertyChangedEventArgs e)
    {
        AttachEvents(control);
    }

    private static void OnStatusEffectChanged(Control control, AvaloniaPropertyChangedEventArgs e)
    {
        AttachEvents(control);
    }

    private static void AttachEvents(Control control)
    {
        control.PointerEntered -= OnPointerEntered;
        control.PointerExited -= OnPointerExited;

        control.PointerEntered += OnPointerEntered;
        control.PointerExited += OnPointerExited;
    }

    private static void OnPointerEntered(object? sender, PointerEventArgs e)
    {
        if (sender is not Control control || _tooltipService is null) return;

        var text = GetText(control);
        if (text is not null)
        {
            _tooltipService.ShowTextTooltip(text, control);
            return;
        }

        var item = GetItem(control);
        if (item is not null)
        {
            _tooltipService.ShowItemTooltip(item, control);
            return;
        }

        var ability = GetAbility(control);
        if (ability is not null)
        {
            _tooltipService.ShowAbilityTooltip(ability, control);
            return;
        }

        var effect = GetStatusEffect(control);
        if (effect is not null)
        {
            _tooltipService.ShowStatusEffectTooltip(effect, control);
        }
    }

    private static void OnPointerExited(object? sender, PointerEventArgs e)
    {
        _tooltipService?.HideTooltip();
    }
}
```

### Usage Examples

```xml
<!-- Simple text tooltip -->
<Button Content="ğŸ’" 
        helpers:TooltipHelper.Text="Toggle Inventory (I)" />

<!-- Item tooltip via binding -->
<controls:ItemSlotControl 
        helpers:TooltipHelper.Item="{Binding Item}" />

<!-- Ability tooltip -->
<controls:AbilityButton 
        helpers:TooltipHelper.Ability="{Binding Ability}" />

<!-- Status effect tooltip -->
<controls:StatusEffectIcon 
        helpers:TooltipHelper.StatusEffect="{Binding Effect}" />
```

---

## 8. Tooltip Positioning

### Positioning Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TOOLTIP POSITIONING LOGIC                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Calculate Initial Position
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Cursor     â”‚
   â”‚      â—â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–º X + 16px offset
   â”‚      â”‚       â”‚
   â”‚      â–¼       â”‚
   â”‚   Y + 16px   â”‚
   â”‚   offset     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Check Screen Boundaries
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                 â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚ â† Right edge: flip to left of cursor
   â”‚    â”‚ Tooltip  â”‚                â”‚
   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
   â”‚                                 â”‚
   â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚ â† Bottom edge: flip above cursor
   â”‚            â”‚ Tooltip  â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Apply Minimum Margins (8px from all edges)

4. Position Priorities
   Preferred: Below-Right of cursor
   Fallback 1: Below-Left (if right edge hit)
   Fallback 2: Above-Right (if bottom edge hit)
   Fallback 3: Above-Left (if both edges hit)
```

---

## 9. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/TooltipStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <!-- Tooltip Container -->
    <Style Selector="Border.tooltip-container">
        <Setter Property="Background" Value="{StaticResource TooltipBackgroundBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource TooltipBorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="CornerRadius" Value="4" />
        <Setter Property="Effect">
            <DropShadowEffect BlurRadius="8" 
                              Opacity="0.5" 
                              OffsetX="2" 
                              OffsetY="2" />
        </Setter>
    </Style>
    
    <!-- Tooltip Title -->
    <Style Selector="TextBlock.tooltip-title">
        <Setter Property="FontSize" Value="14" />
        <Setter Property="FontWeight" Value="Bold" />
        <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
    </Style>
    
    <!-- Tooltip Separator -->
    <Style Selector="Border.tooltip-separator">
        <Setter Property="Height" Value="1" />
        <Setter Property="Background" Value="{StaticResource BorderBrush}" />
    </Style>
    
    <!-- Tooltip Subtitle -->
    <Style Selector="TextBlock.tooltip-subtitle">
        <Setter Property="FontSize" Value="11" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
    </Style>
    
    <!-- Tooltip Section -->
    <Style Selector="Border.tooltip-section">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="CornerRadius" Value="3" />
    </Style>
    
    <!-- Tooltip Section Header -->
    <Style Selector="TextBlock.tooltip-section-header">
        <Setter Property="FontSize" Value="10" />
        <Setter Property="FontWeight" Value="SemiBold" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
        <Setter Property="TextTransform" Value="Uppercase" />
    </Style>
    
    <!-- Tooltip Label -->
    <Style Selector="TextBlock.tooltip-label">
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
    </Style>
    
    <!-- Tooltip Value -->
    <Style Selector="TextBlock.tooltip-value">
        <Setter Property="FontSize" Value="12" />
        <Setter Property="FontWeight" Value="SemiBold" />
    </Style>
    
    <!-- Tooltip Description -->
    <Style Selector="TextBlock.tooltip-description">
        <Setter Property="FontSize" Value="12" />
        <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}" />
        <Setter Property="LineHeight" Value="18" />
    </Style>
    
    <!-- Tooltip Footer -->
    <Style Selector="TextBlock.tooltip-footer">
        <Setter Property="FontSize" Value="11" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
        <Setter Property="FontStyle" Value="Italic" />
    </Style>
    
    <!-- Color Resources -->
    <Style>
        <Style.Resources>
            <SolidColorBrush x:Key="TooltipBackgroundBrush" Color="#1a1a2e" />
            <SolidColorBrush x:Key="TooltipBorderBrush" Color="#3d3d5c" />
        </Style.Resources>
    </Style>
    
</Styles>
```

---

## 10. Data Model Changes

### New Types

| Type | Layer | Description |
|------|-------|-------------|
| `ITooltipService` | Presentation | Tooltip service interface |
| `TooltipService` | Presentation | Tooltip service implementation |
| `TooltipControl` | Presentation | Tooltip display control |
| `TooltipHelper` | Presentation | Attached properties helper |
| `TooltipContent` | Presentation | Rich content model |
| `TooltipSection` | Presentation | Section within tooltip |
| `TooltipLine` | Presentation | Line within section |

### Domain Enums (if not existing)

```csharp
public enum ItemCategory
{
    Weapon,
    Armor,
    Accessory,
    Consumable,
    Quest,
    Misc
}

public enum EffectType
{
    Buff,
    Debuff,
    Poison,
    Burning,
    Frozen,
    Stunned
}
```

---

## 11. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `TooltipService` | Debug | Tooltip shown, hidden |
| `TooltipService` | Debug | Content built for item/ability/effect |
| `TooltipService` | Warning | Tooltip show cancelled (mouse left) |
| `TooltipHelper` | Debug | Attached property changes |

### Log Message Examples

```
Debug: Showing tooltip: âš” IRON SWORD
Debug: Tooltip hidden
Debug: Building item tooltip for: Iron Sword
Debug: Building ability tooltip for: Fireball
Debug: Tooltip show cancelled (mouse left before delay)
```

---

## 12. Unit Testing Requirements

| Feature | Tests |
|---------|-------|
| Show delay timing | 2 |
| Item tooltip content building | 2 |
| Ability tooltip content building | 2 |
| Status effect tooltip content building | 1 |
| Auto-positioning logic | 2 |
| IsEnabled toggle | 1 |
| **Total** | **~10** |

### Test Specifications

**File:** `tests/RuneAndRust.Avalonia.UnitTests/Services/TooltipServiceTests.cs`

```csharp
[TestFixture]
public class TooltipServiceTests
{
    [Test]
    public void ShowTextTooltip_WhenEnabled_FiresOnTooltipChangedAfterDelay();

    [Test]
    public void ShowTextTooltip_WhenDisabled_DoesNotFireEvent();

    [Test]
    public void HideTooltip_CancelsPendingShow();

    [Test]
    public void HideTooltip_FiresOnTooltipChangedWithNull();

    [Test]
    public void BuildItemTooltip_IncludesAllStats();

    [Test]
    public void BuildItemTooltip_FormatsValueCorrectly();

    [Test]
    public void BuildAbilityTooltip_IncludesCostAndCooldown();

    [Test]
    public void BuildAbilityTooltip_IncludesHotkeyInFooter();

    [Test]
    public void BuildStatusEffectTooltip_IncludesDuration();

    [Test]
    public void ShowDelayMs_CanBeModified();
}
```

**File:** `tests/RuneAndRust.Avalonia.UnitTests/Controls/TooltipControlTests.cs`

```csharp
[TestFixture]
public class TooltipControlTests
{
    [Test]
    public void PositionTooltip_StaysWithinRightBoundary();

    [Test]
    public void PositionTooltip_StaysWithinBottomBoundary();
}
```

---

## 13. Use Cases

### UC-081c-001: View Item Tooltip
**Actor:** Player
**Flow:** Player hovers over item in inventory â†’ Waits 500ms â†’ Tooltip appears showing name, stats, description, value
**Postcondition:** Item tooltip visible

### UC-081c-002: View Ability Tooltip
**Actor:** Player
**Flow:** Player hovers over ability button â†’ Waits 500ms â†’ Tooltip shows name, cost, cooldown, effects, hotkey

### UC-081c-003: View Status Effect Tooltip
**Actor:** Player
**Flow:** Player hovers over status effect icon â†’ Tooltip shows effect details, remaining duration, source

### UC-081c-004: View UI Element Tooltip
**Actor:** Player
**Flow:** Player hovers over UI button â†’ Simple text tooltip appears (e.g., "Toggle Inventory (I)")

### UC-081c-005: Tooltip Auto-Positioning
**Actor:** System
**Precondition:** Cursor is near screen edge
**Flow:** Player hovers over element â†’ Tooltip positions to stay on screen

### UC-081c-006: Cancel Tooltip
**Actor:** Player
**Flow:** Player moves mouse away before delay completes â†’ No tooltip appears

### UC-081c-007: Disable Tooltips
**Actor:** Player
**Precondition:** Settings â†’ Gameplay â†’ Tooltips disabled
**Flow:** Player hovers over any element â†’ No tooltips appear

---

## 14. Deliverable Checklist

### Interfaces & Services
- [ ] `Services/ITooltipService.cs` created
- [ ] `Services/TooltipService.cs` created

### Controls
- [ ] `Controls/TooltipControl.cs` created
- [ ] `Controls/TooltipControl.axaml` created

### Models
- [ ] `Models/TooltipModels.cs` created (TooltipContent, TooltipSection, TooltipLine)

### Helpers
- [ ] `Helpers/TooltipHelper.cs` created

### Styles
- [ ] `Styles/TooltipStyles.axaml` created

### Integration
- [ ] TooltipControl added to main window overlay layer
- [ ] TooltipHelper.Initialize called at app startup
- [ ] Settings integration for enable/disable

### Testing
- [ ] ~10 unit tests implemented
- [ ] All tests passing

---

## 15. Acceptance Criteria

### Functional
- [ ] Tooltips appear after 500ms delay
- [ ] Item tooltips show name, type, stats, description, value
- [ ] Ability tooltips show name, cost, cooldown, effects, hotkey
- [ ] Status effect tooltips show effect, duration, source
- [ ] Simple text tooltips work for UI elements
- [ ] Tooltips stay on screen (auto-positioning)
- [ ] Tooltips follow consistent styling
- [ ] Tooltips hide on mouse leave
- [ ] Attached properties work in XAML
- [ ] Tooltips can be disabled in settings

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~10 unit tests pass
- [ ] XML documentation on all public types
- [ ] Styles consistent with application theme

---

## 16. Dependencies

### Required from v0.8.1b
- Quest tooltip patterns (if any)

### Required from v0.8.0b
- Settings integration for tooltips enabled preference

### Required from Domain Layer
- `Item` entity with display properties
- `AbilityDefinition` entity with display properties
- `StatusEffect` entity with display properties
- `ItemCategory` enum
- `EffectType` enum

### Provides to Future Versions
- Unified tooltip infrastructure
- Rich content tooltip patterns
- Attached property patterns for hover content

---

## 17. Future Considerations

### Deferred to Later Versions
- **Interactive Tooltips**: Tooltips with clickable elements
- **Comparison Tooltips**: Show equipped vs. hovered item comparison
- **Tooltip Pinning**: Pin tooltip to stay visible
- **Tooltip History**: View recently shown tooltips
- **Rich Media Tooltips**: Images or animations in tooltips

### Out of Scope
- Video/animation content in tooltips
- Tooltip editing/customization
- Tooltip templates from configuration

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
