# v0.17.2d Design Specification: Derived Stat Calculation

**Version:** 0.17.2d  
**Phase Name:** Derived Stat Calculation  
**Parent Version:** v0.17.2 (Attribute System)  
**Prerequisites:** v0.17.2c Complete (Point-Buy Cost System)  
**Estimated Tests:** ~8 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [DerivedStats Value Object](#4-derivedstats-value-object)
5. [DerivedStatFormula Value Object](#5-derivedstatformula-value-object)
6. [Data Model Changes](#6-data-model-changes)
7. [Configuration File Schemas](#7-configuration-file-schemas)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [User Stories](#11-user-stories)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the `DerivedStats` and `DerivedStatFormula` value objects that calculate secondary character statistics from core attributes. Derived stats include Max HP, Max Stamina, Max Aether Pool, Initiative, Soak, and Movement Speed.

**Key Formulas:**

- Max HP = (STURDINESS × 10) + 50 + ArchetypeBonus + LineageBonus
- Max Stamina = (FINESSE × 5) + (MIGHT × 5) + 20 + ArchetypeBonus
- Max Aether Pool = (WILL × 10) + (WITS × 5) + ArchetypeBonus + LineageBonus

### 1.2 Key Deliverables

| Category          | Items                                    |
| ----------------- | ---------------------------------------- |
| **Value Objects** | `DerivedStats`, `DerivedStatFormula`     |
| **Configuration** | `attributes.json` (derivedStats section) |
| **Tests**         | ~8 unit tests                            |

### 1.3 Architectural Significance

- **Formula-Driven Calculation**: All derived stats computed from configurable formulas
- **Multi-Source Bonuses**: Attributes, archetypes, and lineages all contribute
- **Configuration-Driven**: Formulas loaded from JSON for easy balancing
- **Preview Support**: Stats can be calculated before character finalization

---

## 2. Feature Overview

```
v0.17.2d Derived Stat Calculation
├── DerivedStats Value Object
│   ├── MaxHp: int
│   ├── MaxStamina: int
│   ├── MaxAetherPool: int
│   ├── Initiative: int
│   ├── Soak: int
│   ├── MovementSpeed: int
│   └── CarryingCapacity: int
├── DerivedStatFormula Value Object
│   ├── StatName: string
│   ├── BaseValue: int
│   ├── AttributeScaling: Dictionary<CoreAttribute, float>
│   ├── ArchetypeBonuses: Dictionary<string, int>
│   └── LineageBonuses: Dictionary<string, int>
└── Bonus Tables
    ├── Archetype Bonuses (Warrior, Skirmisher, Mystic, Adept)
    └── Lineage Bonuses (Clan-Born, Rune-Marked, Iron-Blooded, Vargr-Kin)
```

### 2.1 Scope Alignment

**In Scope:**

- `DerivedStats` value object with all 7 derived stat properties
- `DerivedStatFormula` value object with scaling and bonuses
- Archetype bonus definitions (Warrior, Skirmisher, Mystic, Adept)
- Lineage bonus definitions (where applicable)
- Configuration schema for derived stat formulas

**Out of Scope:**

- Provider service implementation → v0.17.2e
- Allocation service integration → v0.17.2f
- Calculator service implementation → v0.17.2g

---

## 3. Architecture Diagrams

### 3.1 Derived Stat Calculation Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│              DERIVED STAT CALCULATION OVERVIEW                       │
└─────────────────────────────────────────────────────────────────────┘

    Character Attributes + Archetype + Lineage
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   FORMULA COMPONENTS                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │
│  │ BASE VALUE   │  │ ATTRIBUTE    │  │ BONUSES      │              │
│  │              │  │ SCALING      │  │              │              │
│  │ e.g., 50    │  │ STURD × 10   │  │ Warrior: +49 │              │
│  │ for Max HP   │  │ for HP       │  │ Clan-Born: +5│              │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘              │
│         │                 │                  │                      │
│         └─────────────────┼──────────────────┘                      │
│                           ▼                                         │
│                    ┌─────────────┐                                  │
│                    │    SUM      │                                  │
│                    └──────┬──────┘                                  │
│                           │                                         │
└───────────────────────────┼─────────────────────────────────────────┘
                            ▼
                 ┌──────────────────────┐
                 │    DerivedStats      │
                 ├──────────────────────┤
                 │ MaxHp: 139           │
                 │ MaxStamina: 60       │
                 │ MaxAetherPool: 30    │
                 │ Initiative: 4        │
                 │ Soak: 2              │
                 │ MovementSpeed: 5     │
                 │ CarryingCapacity: 40 │
                 └──────────────────────┘
```

### 3.2 Formula Application Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                  FORMULA APPLICATION FLOW                            │
└─────────────────────────────────────────────────────────────────────┘

    CalculateDerivedStats(attributes, archetypeId, lineageId)
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ For each derived stat:                                           │
    ├──────────────────────────────────────────────────────────────────┤
    │  1. Start with BaseValue                                         │
    │  2. For each (attribute, scaling) in AttributeScaling:           │
    │       value += attributeValue × scaling                          │
    │  3. If archetypeId in ArchetypeBonuses:                          │
    │       value += ArchetypeBonuses[archetypeId]                     │
    │  4. If lineageId in LineageBonuses:                              │
    │       value += LineageBonuses[lineageId]                         │
    │  5. Apply any multipliers (e.g., Rune-Marked Aether)             │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    Return new DerivedStats(...)
```

### 3.3 Complete Formula Reference

```
┌─────────────────────────────────────────────────────────────────────┐
│                   COMPLETE FORMULA REFERENCE                         │
└─────────────────────────────────────────────────────────────────────┘

    MAX HP
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: (STURDINESS × 10) + 50 + ArchetypeBonus + LineageBonus│
    ├─────────────────────────────────────────────────────────────────┤
    │  Archetype Bonuses:           Lineage Bonuses:                  │
    │    Warrior: +49                 Clan-Born: +5                   │
    │    Skirmisher: +30              Iron-Blooded: —                 │
    │    Mystic: +20                  Rune-Marked: —                  │
    │    Adept: +30                   Vargr-Kin: —                    │
    └─────────────────────────────────────────────────────────────────┘

    MAX STAMINA
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: (FINESSE × 5) + (MIGHT × 5) + 20 + ArchetypeBonus     │
    ├─────────────────────────────────────────────────────────────────┤
    │  Archetype Bonuses:                                             │
    │    Warrior: +5                                                  │
    │    Skirmisher: +5                                               │
    │    Mystic: 0                                                    │
    │    Adept: 0                                                     │
    └─────────────────────────────────────────────────────────────────┘

    MAX AETHER POOL
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: (WILL × 10) + (WITS × 5) + ArchetypeBonus + Lineage   │
    ├─────────────────────────────────────────────────────────────────┤
    │  Archetype Bonuses:           Lineage Bonuses:                  │
    │    Warrior: 0                   Clan-Born: —                    │
    │    Skirmisher: 0                Iron-Blooded: —                 │
    │    Mystic: +20                  Rune-Marked: +5, then ×1.10     │
    │    Adept: 0                     Vargr-Kin: —                    │
    └─────────────────────────────────────────────────────────────────┘

    INITIATIVE
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: FINESSE + (WITS ÷ 2)                                  │
    │  (Uses integer division, rounds down)                           │
    └─────────────────────────────────────────────────────────────────┘

    SOAK
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: (STURDINESS ÷ 2) + LineageBonus                       │
    ├─────────────────────────────────────────────────────────────────┤
    │  Lineage Bonuses:                                               │
    │    Iron-Blooded: +2                                             │
    └─────────────────────────────────────────────────────────────────┘

    MOVEMENT SPEED
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: 5 + LineageBonus                                      │
    ├─────────────────────────────────────────────────────────────────┤
    │  Lineage Bonuses:                                               │
    │    Vargr-Kin: +1                                                │
    └─────────────────────────────────────────────────────────────────┘

    CARRYING CAPACITY
    ┌─────────────────────────────────────────────────────────────────┐
    │  Formula: MIGHT × 10                                            │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.4 Example Calculations

```
┌─────────────────────────────────────────────────────────────────────┐
│                    EXAMPLE CALCULATIONS                              │
└─────────────────────────────────────────────────────────────────────┘

    WARRIOR BUILD: M4, F3, Wi2, Wl2, S4 (Clan-Born lineage)
    ┌─────────────────────────────────────────────────────────────────┐
    │  Max HP = (4 × 10) + 50 + 49 + 5 = 144                          │
    │  Max Stamina = (3 × 5) + (4 × 5) + 20 + 5 = 60                  │
    │  Max Aether Pool = (2 × 10) + (2 × 5) = 30                      │
    │  Initiative = 3 + (2 ÷ 2) = 4                                   │
    │  Soak = (4 ÷ 2) = 2                                             │
    │  Movement Speed = 5                                              │
    │  Carrying Capacity = 4 × 10 = 40                                │
    └─────────────────────────────────────────────────────────────────┘

    MYSTIC BUILD: M2, F3, Wi4, Wl4, S2 (Rune-Marked lineage)
    ┌─────────────────────────────────────────────────────────────────┐
    │  Max HP = (2 × 10) + 50 + 20 = 90                               │
    │  Max Stamina = (3 × 5) + (2 × 5) + 20 + 0 = 45                  │
    │  Max Aether Pool = ((4 × 10) + (4 × 5) + 20 + 5) × 1.10         │
    │                  = (40 + 20 + 20 + 5) × 1.10 = 93               │
    │  Initiative = 3 + (4 ÷ 2) = 5                                   │
    │  Soak = (2 ÷ 2) = 1                                             │
    │  Movement Speed = 5                                              │
    │  Carrying Capacity = 2 × 10 = 20                                │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 4. DerivedStats Value Object

### 4.1 Purpose

The `DerivedStats` value object holds all calculated secondary statistics for a character.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/DerivedStats.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Holds all derived (calculated) statistics for a character.
/// </summary>
/// <remarks>
/// <para>
/// DerivedStats are calculated from core attributes, archetype bonuses,
/// and lineage bonuses. They represent the character's combat and
/// resource capabilities.
/// </para>
/// </remarks>
public readonly record struct DerivedStats
{
    /// <summary>Gets the maximum hit points.</summary>
    public int MaxHp { get; init; }

    /// <summary>Gets the maximum stamina for physical actions.</summary>
    public int MaxStamina { get; init; }

    /// <summary>Gets the maximum Aether pool for magical abilities.</summary>
    public int MaxAetherPool { get; init; }

    /// <summary>Gets the initiative bonus for combat order.</summary>
    public int Initiative { get; init; }

    /// <summary>Gets the soak value (damage reduction).</summary>
    public int Soak { get; init; }

    /// <summary>Gets the base movement speed in units per turn.</summary>
    public int MovementSpeed { get; init; }

    /// <summary>Gets the carrying capacity in weight units.</summary>
    public int CarryingCapacity { get; init; }

    /// <summary>Creates DerivedStats with validation.</summary>
    public static DerivedStats Create(
        int maxHp, int maxStamina, int maxAetherPool,
        int initiative, int soak, int movementSpeed, int carryingCapacity)
    {
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(maxHp);
        ArgumentOutOfRangeException.ThrowIfNegative(maxStamina);
        ArgumentOutOfRangeException.ThrowIfNegative(maxAetherPool);
        ArgumentOutOfRangeException.ThrowIfNegative(soak);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(movementSpeed);

        return new DerivedStats
        {
            MaxHp = maxHp,
            MaxStamina = maxStamina,
            MaxAetherPool = maxAetherPool,
            Initiative = initiative,
            Soak = soak,
            MovementSpeed = movementSpeed,
            CarryingCapacity = carryingCapacity
        };
    }

    /// <summary>Gets a formatted summary for display.</summary>
    public string GetSummary() =>
        $"HP: {MaxHp} | Stamina: {MaxStamina} | AP: {MaxAetherPool} | " +
        $"Init: {Initiative} | Soak: {Soak} | Move: {MovementSpeed}";
}
```

---

## 5. DerivedStatFormula Value Object

### 5.1 Purpose

The `DerivedStatFormula` value object defines how a single derived stat is calculated from attributes and bonuses.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/DerivedStatFormula.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the formula for calculating a single derived stat.
/// </summary>
/// <remarks>
/// <para>
/// Each formula consists of:
/// - A base value added to all calculations
/// - Attribute scaling multipliers
/// - Optional archetype and lineage bonuses
/// - Optional multiplier for special cases (e.g., Rune-Marked Aether)
/// </para>
/// </remarks>
public readonly record struct DerivedStatFormula
{
    /// <summary>Gets the stat name (e.g., "MaxHp").</summary>
    public string StatName { get; init; }

    /// <summary>Gets the base value before scaling.</summary>
    public int BaseValue { get; init; }

    /// <summary>Gets the attribute scaling multipliers.</summary>
    public IReadOnlyDictionary<CoreAttribute, float> AttributeScaling { get; init; }

    /// <summary>Gets the archetype-specific bonuses.</summary>
    public IReadOnlyDictionary<string, int> ArchetypeBonuses { get; init; }

    /// <summary>Gets the lineage-specific bonuses.</summary>
    public IReadOnlyDictionary<string, int> LineageBonuses { get; init; }

    /// <summary>Gets the lineage-specific multipliers (applied after bonuses).</summary>
    public IReadOnlyDictionary<string, float> LineageMultipliers { get; init; }

    /// <summary>Calculates the stat value for given inputs.</summary>
    public int Calculate(
        IReadOnlyDictionary<CoreAttribute, int> attributeValues,
        string? archetypeId,
        string? lineageId)
    {
        float value = BaseValue;

        // Apply attribute scaling
        foreach (var (attr, scale) in AttributeScaling)
        {
            if (attributeValues.TryGetValue(attr, out var attrValue))
                value += attrValue * scale;
        }

        // Apply archetype bonus
        if (archetypeId != null && ArchetypeBonuses.TryGetValue(archetypeId, out var archBonus))
            value += archBonus;

        // Apply lineage bonus
        if (lineageId != null && LineageBonuses.TryGetValue(lineageId, out var lineageBonus))
            value += lineageBonus;

        // Apply lineage multiplier (after bonuses)
        if (lineageId != null && LineageMultipliers.TryGetValue(lineageId, out var multiplier))
            value *= multiplier;

        return (int)value;
    }

    /// <summary>Gets the archetype bonus for a specific archetype.</summary>
    public int GetArchetypeBonus(string archetypeId) =>
        ArchetypeBonuses.TryGetValue(archetypeId, out var bonus) ? bonus : 0;

    /// <summary>Gets the lineage bonus for a specific lineage.</summary>
    public int GetLineageBonus(string lineageId) =>
        LineageBonuses.TryGetValue(lineageId, out var bonus) ? bonus : 0;

    /// <summary>Creates a formula with empty bonus dictionaries.</summary>
    public static DerivedStatFormula Create(
        string statName,
        int baseValue,
        IReadOnlyDictionary<CoreAttribute, float> attributeScaling,
        IReadOnlyDictionary<string, int>? archetypeBonuses = null,
        IReadOnlyDictionary<string, int>? lineageBonuses = null,
        IReadOnlyDictionary<string, float>? lineageMultipliers = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(statName);

        return new DerivedStatFormula
        {
            StatName = statName,
            BaseValue = baseValue,
            AttributeScaling = attributeScaling,
            ArchetypeBonuses = archetypeBonuses ?? new Dictionary<string, int>(),
            LineageBonuses = lineageBonuses ?? new Dictionary<string, int>(),
            LineageMultipliers = lineageMultipliers ?? new Dictionary<string, float>()
        };
    }
}
```

---

## 6. Data Model Changes

### 6.1 New Types Summary

| Type                 | Layer  | Category     | Description                    |
| -------------------- | ------ | ------------ | ------------------------------ |
| `DerivedStats`       | Domain | Value Object | All calculated character stats |
| `DerivedStatFormula` | Domain | Value Object | Formula for one derived stat   |

### 6.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── ValueObjects/
│   ├── AttributeDescription.cs         (v0.17.2a)
│   ├── AttributeAllocationState.cs     (v0.17.2b)
│   ├── PointBuyCost.cs                  (v0.17.2c)
│   ├── PointBuyConfiguration.cs         (v0.17.2c)
│   ├── DerivedStats.cs                  ← NEW
│   └── DerivedStatFormula.cs            ← NEW
```

---

## 7. Configuration File Schemas

### 7.1 attributes.json (Derived Stats Section)

**File:** `config/attributes.json` (extended)

```json
{
    "derivedStats": {
        "maxHp": {
            "baseValue": 50,
            "attributeScaling": { "Sturdiness": 10 },
            "archetypeBonuses": {
                "warrior": 49,
                "skirmisher": 30,
                "mystic": 20,
                "adept": 30
            },
            "lineageBonuses": { "clan-born": 5 }
        },
        "maxStamina": {
            "baseValue": 20,
            "attributeScaling": { "Finesse": 5, "Might": 5 },
            "archetypeBonuses": { "warrior": 5, "skirmisher": 5 }
        },
        "maxAetherPool": {
            "baseValue": 0,
            "attributeScaling": { "Will": 10, "Wits": 5 },
            "archetypeBonuses": { "mystic": 20 },
            "lineageBonuses": { "rune-marked": 5 },
            "lineageMultipliers": { "rune-marked": 1.1 }
        },
        "initiative": {
            "baseValue": 0,
            "attributeScaling": { "Finesse": 1, "Wits": 0.5 }
        },
        "soak": {
            "baseValue": 0,
            "attributeScaling": { "Sturdiness": 0.5 },
            "lineageBonuses": { "iron-blooded": 2 }
        },
        "movementSpeed": {
            "baseValue": 5,
            "lineageBonuses": { "vargr-kin": 1 }
        },
        "carryingCapacity": {
            "baseValue": 0,
            "attributeScaling": { "Might": 10 }
        }
    }
}
```

---

## 8. Logging Specifications

| Event              | Level | Template                                              |
| ------------------ | ----- | ----------------------------------------------------- |
| Stats calculated   | Debug | "Calculated derived stats: {Stats}"                   |
| Formula applied    | Debug | "Formula {StatName}: base={Base}, result={Result}"    |
| Bonus applied      | Debug | "Applied {BonusType} bonus: +{Amount} to {StatName}"  |
| Multiplier applied | Debug | "Applied {Lineage} multiplier: ×{Mult} to {StatName}" |

---

## 9. Unit Testing Requirements

### 9.1 Test Count: ~8 tests

```csharp
[TestFixture]
public class DerivedStatsTests
{
    [Test]
    public void Create_WithValidValues_CreatesDerivedStats()
    {
        var stats = DerivedStats.Create(139, 60, 30, 4, 2, 5, 40);

        stats.MaxHp.Should().Be(139);
        stats.MaxStamina.Should().Be(60);
        stats.MaxAetherPool.Should().Be(30);
    }

    [Test]
    public void Create_WithZeroHp_ThrowsArgumentOutOfRangeException()
    {
        var act = () => DerivedStats.Create(0, 60, 30, 4, 2, 5, 40);
        act.Should().Throw<ArgumentOutOfRangeException>();
    }
}

[TestFixture]
public class DerivedStatFormulaTests
{
    [Test]
    public void Calculate_WarriorMaxHp_Returns139()
    {
        var formula = CreateMaxHpFormula();
        var attributes = CreateWarriorAttributes(); // M4, F3, Wi2, Wl2, S4

        var result = formula.Calculate(attributes, "warrior", null);

        result.Should().Be(139); // (4×10) + 50 + 49 = 139
    }

    [Test]
    public void Calculate_MysticMaxAetherPool_Returns80()
    {
        var formula = CreateMaxAetherPoolFormula();
        var attributes = CreateMysticAttributes(); // M2, F3, Wi4, Wl4, S2

        var result = formula.Calculate(attributes, "mystic", null);

        result.Should().Be(80); // (4×10) + (4×5) + 20 = 80
    }

    [Test]
    public void Calculate_WithLineageBonus_AppliesBonus()
    {
        var formula = CreateMaxHpFormula();
        var attributes = CreateWarriorAttributes();

        var result = formula.Calculate(attributes, "warrior", "clan-born");

        result.Should().Be(144); // 139 + 5 = 144
    }

    [Test]
    public void Calculate_RuneMarkedAether_AppliesMultiplier()
    {
        var formula = CreateMaxAetherPoolFormulaWithMultiplier();
        var attributes = CreateMysticAttributes();

        var result = formula.Calculate(attributes, "mystic", "rune-marked");

        // (40 + 20 + 20 + 5) × 1.10 = 93.5 → 93
        result.Should().Be(93);
    }

    private static Dictionary<CoreAttribute, int> CreateWarriorAttributes() =>
        new() {
            { CoreAttribute.Might, 4 }, { CoreAttribute.Finesse, 3 },
            { CoreAttribute.Wits, 2 }, { CoreAttribute.Will, 2 },
            { CoreAttribute.Sturdiness, 4 }
        };

    private static Dictionary<CoreAttribute, int> CreateMysticAttributes() =>
        new() {
            { CoreAttribute.Might, 2 }, { CoreAttribute.Finesse, 3 },
            { CoreAttribute.Wits, 4 }, { CoreAttribute.Will, 4 },
            { CoreAttribute.Sturdiness, 2 }
        };
}
```

---

## 10. Use Cases

| ID     | Use Case              | Flow                                                            |
| ------ | --------------------- | --------------------------------------------------------------- |
| UC-001 | Preview Derived Stats | Player allocates attributes → Calculate preview → Display stats |
| UC-002 | Apply Archetype Bonus | Select archetype → Look up bonus → Add to calculation           |
| UC-003 | Apply Lineage Bonus   | Character has lineage → Look up bonus → Add/multiply            |

---

## 11. User Stories

**US-001:** As a player, I want to see how my attribute choices affect my HP, Stamina, and AP.

**US-002:** As a Warrior, I want my archetype bonus reflected in my derived stats.

**US-003:** As a Rune-Marked character, I want my enhanced Aether capacity shown correctly.

---

## 12. Deliverable Checklist

- [ ] `DerivedStats` value object created with 7 properties
- [ ] `DerivedStatFormula` value object with Calculate method
- [ ] Archetype and lineage bonus support
- [ ] Lineage multiplier support (for Rune-Marked)
- [ ] Configuration JSON section for derived stats
- [ ] ~8 unit tests implemented and passing
- [ ] XML documentation complete

---

## 13. Acceptance Criteria

### Functional

- [ ] Warrior HP = 139 with standard build (M4, F3, Wi2, Wl2, S4)
- [ ] Mystic AP = 80 with standard build (M2, F3, Wi4, Wl4, S2)
- [ ] Clan-Born adds +5 HP
- [ ] Rune-Marked applies +5 then ×1.10 to Aether Pool
- [ ] Iron-Blooded adds +2 Soak
- [ ] Vargr-Kin adds +1 Movement Speed

### Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~8 unit tests pass
- [ ] XML documentation complete

---

## 14. Dependencies

### Required from Previous Phases

| Type            | Phase    | Usage                      |
| --------------- | -------- | -------------------------- |
| `CoreAttribute` | v0.17.2a | Keys for attribute scaling |

### Provides to Future Phases

| Type                 | Phase    | Usage                        |
| -------------------- | -------- | ---------------------------- |
| `DerivedStats`       | v0.17.2g | Result of calculator service |
| `DerivedStatFormula` | v0.17.2g | Loaded by calculator service |

---

## 15. Future Considerations

### Deferred to v0.17.2g

- Full DerivedStatCalculatorService implementation
- Formula loading from configuration

### Out of Scope for v0.17.2

- Equipment modifiers to derived stats
- Buff/debuff effects on stats
- Level-based stat scaling

---

_Document Version: 1.0_  
_Last Updated: 2025-01-27_
