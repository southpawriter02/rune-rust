# v0.15.4e Changelog - Jury-Rigging System

**Release Date:** 2026-01-23
**Version:** v0.15.4e
**Phase:** System Bypass Skill Expansion (v0.15.x)
**Sub-Phase:** Jury-Rigging System (v0.15.4e)

---

## Summary

Implemented the **Jury-Rigging System**, adding a five-step trial-and-error procedure (Observe → Probe → Pattern → Method Selection → Experiment → Iterate) for bypassing Old World technology through creative improvisation. When finesse fails or keys are lost, characters can still force access to terminals, locks, and mechanisms through percussive maintenance, wire manipulation, or brute disassembly.

This version builds upon v0.15.4a-d (Lockpicking, Terminal Hacking, ICE Countermeasures, Trap Disarmament) and integrates with established patterns including `SkillCheckService`, `DiceService`, and the success-counting dice mechanics from v0.15.0.

---

## Added

### Domain Enums (5 files)

| File | Description |
|------|-------------|
| `BypassMethod.cs` | Six bypass methods: PercussiveMaintenance, WireManipulation, GlitchExploitation, MemorizedSequence, BruteDisassembly, PowerCycling |
| `JuryRigStep.cs` | Six procedure steps: Observe, Probe, Pattern, MethodSelection, Experiment, Iterate |
| `JuryRigStatus.cs` | Six state values: InProgress, Bypassed, Destroyed, MechanismDestroyed, PermanentlyLocked, Abandoned |
| `JuryRigOutcome.cs` | Six outcome categories: Success, CriticalSuccess, Failure, PartialSuccess, Fumble, PermanentLock |
| `ComplicationEffect.cs` | Six complication effects: PermanentLock, AlarmTriggered, SparksFly, Nothing, PartialSuccess, GlitchInFavor |

### Domain Extensions (1 file)

| File | Description |
|------|-------------|
| `BypassMethodExtensions.cs` | Extension methods for DC modifiers, requirements, effects, and display utilities |

### Domain Value Objects (7 files)

| File | Description |
|------|-------------|
| `JuryRigContext.cs` | Record struct providing attempt context with method, tools, and familiarity modifiers |
| `JuryRigResult.cs` | Record struct with factory methods for each outcome (success, critical, failure, fumble, etc.) |
| `ObservationResult.cs` | Record struct for Observe step results with hints and mechanism type |
| `ProbeResult.cs` | Record struct for Probe step results with reactions and glitch detection |
| `PatternResult.cs` | Record struct for Pattern Recognition results with familiarity bonus |
| `MethodOption.cs` | Record struct representing bypass method availability and modifiers |
| `ElectrocutionSaveResult.cs` | Record struct for Wire Manipulation electrocution save outcomes |

### Domain Entity (1 file)

| File | Description |
|------|-------------|
| `JuryRigState.cs` | State machine entity tracking jury-rigging progress with familiarity tracking |

### Domain Interfaces (2 files)

| File | Description |
|------|-------------|
| `IJuryRiggingService.cs` | Service contract for the five-step jury-rigging procedure |
| `IElectrocutionRiskService.cs` | Service contract for Wire Manipulation electrocution risk handling |

### Application Services (2 files)

| File | Description |
|------|-------------|
| `JuryRiggingService.cs` | Full implementation with exhaustive logging and skill integration |
| `ElectrocutionRiskService.cs` | Implementation for electrocution save (FINESSE DC 12, 2d10 lightning) |

### Configuration Files (2 files)

| File | Description |
|------|-------------|
| `config/system-bypass/bypass-methods.json` | Bypass method definitions, DC modifiers, requirements, effects, and narrative text |
| `config/system-bypass/complication-table.json` | Complication table (d10) with consequences and narrative descriptions |

### Unit Tests (1 file)

| File | Description |
|------|-------------|
| `JuryRiggingServiceTests.cs` | 40+ tests covering bypass methods, familiarity, complications, and state transitions |

---

## Bypass Methods

| Method | DC Modifier | Requirements | Effects |
|--------|-------------|--------------|---------|
| Percussive Maintenance | +0 | None | May break mechanism on fumble |
| Wire Manipulation | -2 | None | Electrocution risk (FINESSE DC 12, 2d10 lightning) |
| Glitch Exploitation | -4 | [Glitched] mechanism | Unpredictable, only works on corrupted tech |
| Memorized Sequence | -2 | Familiarity with type | Requires prior successful bypass of this type |
| Brute Disassembly | +2 | None | Destroys mechanism, guarantees salvage |
| Power Cycling | +0 | None | Resets progress, clears lockouts |

---

## Five-Step Procedure

### Step 1: Observe (Optional)

- **Check Type:** WITS check vs. DC 10
- **Success:** Learn mechanism type, reveal potential bypass methods
- **Failure:** No information gained, may proceed

### Step 2: Probe (Automatic)

- **Check Type:** None (automatic)
- **Outcome:** Machine reacts—beeps, lights, sounds, or erratic behavior
- **Effect:** Reveals [Glitched] state if present, enabling Glitch Exploitation

### Step 3: Pattern Recognition (Optional)

- **Check Type:** WITS check vs. DC 12
- **Success + Familiar:** +2d10 bonus dice on experiment
- **Success + Unfamiliar:** Mark mechanism type as "seen" for future
- **Failure:** No recognition, proceed without bonus

### Step 4: Method Selection (Required)

- **Player Choice:** Select from available bypass methods
- **Validation:** MemorizedSequence requires familiarity, GlitchExploitation requires [Glitched]
- **Preparation:** Handle electrocution risk if Wire Manipulation selected

### Step 5: Experiment (Required)

- **Check Type:** System Bypass vs. effective DC
- **Critical Success (net ≥ 5):** Bypass + salvage components
- **Success (net > 0):** Mechanism bypassed
- **Failure (net ≤ 0):** Roll on complication table
- **Fumble (0 successes + botch):** Mechanism destroyed

### Step 6: Iterate (On Failure)

- **DC Reduction:** -1 DC per iteration (minimum DC 4)
- **Method Reset:** May select different approach
- **Loop:** Return to Method Selection

---

## Complication Table (d10)

| Roll | Effect | Description |
|------|--------|-------------|
| 1 | Permanent Lock | Machine locks permanently, session ends |
| 2-3 | Alarm Triggered | Security alerted, reinforcements en route |
| 4-5 | Sparks Fly | 1d6 electrical damage, may retry |
| 6-7 | Nothing | No effect, may retry |
| 8-9 | Partial Success | One function works (light/sound only) |
| 10 | Glitch in Favor | Mechanism bypasses itself, auto-success |

---

## Familiarity System

### Tracking Mechanism Types

- Familiarity is tracked per-session within `JuryRigState` using a `HashSet<string>`
- Known types are passed at session initialization via `knownMechanismTypes` parameter
- Successfully bypassing a mechanism adds its type to the familiar set

### Familiarity Benefits

| Benefit | Description |
|---------|-------------|
| +2d10 Bonus Dice | Applied during Pattern Recognition on experiment roll |
| Memorized Sequence | Unlocks the -2 DC bypass method |
| Future Sessions | Caller retrieves familiar types via `GetFamiliarMechanismTypes()` |

---

## Electrocution Risk (Wire Manipulation)

When Wire Manipulation is selected:

1. **FINESSE Save:** DC 12 check before bypass attempt
2. **Save Success:** Proceed with bypass, no damage
3. **Save Failure:** Take 2d10 lightning damage, then proceed with bypass
4. **Fumble on Save:** Maximum damage (20 lightning), proceed with bypass

---

## Tool Quality Modifiers

| Tool Quality | Modifier | Effect |
|--------------|----------|--------|
| Bare Hands | -2d10 | Severely limited |
| Improvised | +0 | Standard tools |
| Proper (Tinker's Toolkit) | +1d10 | Professional equipment |
| Masterwork | +2d10 | Exceptional craftsmanship |

---

## Salvage Components

Critical success (net successes ≥ 5) during experiment yields salvageable components:

| Mechanism Type | Components |
|----------------|------------|
| Terminal | Circuit Board, Display Unit, Processing Chip |
| Door Lock | Lock Mechanism, Servo Motor, Keycard Reader |
| Security Panel | Sensor Array, Alarm Module, Blighted Power Cell |
| Elevator | Control Board, Cable Spool, Safety Relay |
| Power Junction | Capacitor, Transformer Coil, Power Regulator |
| Vending Machine | Coin Mechanism, Dispensing Motor, Selection Panel |
| Communication | Antenna Array, Signal Processor, Transmitter Module |
| Climate Control | Thermostat, Fan Motor, Filter Housing |
| Jötun Device | Jötun Mechanism Fragment, Ancient Power Core, Rune Circuitry |

---

## JuryRigState Entity

### Properties

| Property | Type | Description |
|----------|------|-------------|
| JuryRigId | string | Unique identifier (GUID) |
| CharacterId | string | Character attempting bypass |
| MechanismType | string | Category of mechanism |
| MechanismName | string | Display name |
| BaseDc | int | Base difficulty class |
| IsGlitched | bool | Whether mechanism exhibits glitched behavior |
| CurrentStep | JuryRigStep | Current procedure step |
| SelectedMethod | BypassMethod? | Currently selected bypass method |
| IterationCount | int | Number of retry iterations |
| ObservationComplete | bool | Whether Observe step completed |
| ProbingComplete | bool | Whether Probe step completed |
| PatternRecognized | bool | Whether pattern was recognized |
| IsFamiliarMechanism | bool | Whether character is familiar with type |
| Status | JuryRigStatus | Current session status |
| RevealedHints | List&lt;string&gt; | Hints revealed during observation |
| PreviousAttempts | List&lt;JuryRigResult&gt; | History of experiment results |

### Computed Properties

| Property | Description |
|----------|-------------|
| GetModifiedDc() | BaseDc - IterationCount + MethodModifier (minimum 4) |
| GetFamiliarMechanismTypes() | Returns copy of familiar types for persistence |
| IsTerminal | Whether session is in a terminal state |
| CanSelectMethod(method) | Whether the given method is valid for context |

---

## Files Created

| Category | Files |
|----------|-------|
| Domain Enums | 5 |
| Domain Extensions | 1 |
| Domain Value Objects | 7 |
| Domain Entity | 1 |
| Domain Interfaces | 2 |
| Application Services | 2 |
| Configuration | 2 |
| Unit Tests | 1 |
| **Total** | **21** |

---

## Key Design Decisions

### 1. Session-Local Familiarity

Since `ICharacterRepository` doesn't exist in the current architecture, familiarity is tracked within `JuryRigState` using a `HashSet<string>`. The caller provides known mechanism types at initialization and can retrieve the updated set via `GetFamiliarMechanismTypes()` to persist between sessions.

### 2. DamageType as String

For consistency with `TrapDisarmResult` and other existing value objects, damage types are represented as strings ("electrical", "lightning", "none") rather than an enum.

### 3. Minimum DC of 4

Even with iteration learning, the DC never drops below 4 to maintain challenge and prevent trivial bypasses.

### 4. Electrocution Risk Separation

A separate `IElectrocutionRiskService` allows callers to handle the FINESSE save and damage before proceeding with the bypass attempt, providing flexibility in UI/game flow.

### 5. Familiarity Propagation

When a mechanism is successfully bypassed, the mechanism type is added to the familiar set automatically. This enables the Memorized Sequence method and +2d10 bonus for future encounters.

---

## Dependencies

| Dependency | Usage |
|------------|-------|
| IDiceService | Dice rolling for checks and damage |
| ILogger&lt;T&gt; | Exhaustive logging at Information/Debug/Warning levels |
| ToolQuality | Tool modifier calculations |

---

## Breaking Changes

None. This version adds new functionality without modifying existing interfaces or contracts.

---

## Acceptance Criteria Status

| Criterion | Status |
|-----------|--------|
| Six bypass methods with correct DC modifiers | ✅ |
| Familiarity bonus (+2d10 for known types) | ✅ |
| Complication table (d10 to effect mapping) | ✅ |
| Method validation (familiarity, glitched) | ✅ |
| Iteration DC reduction (minimum 4) | ✅ |
| Electrocution risk for Wire Manipulation | ✅ |
| Critical success salvage (net ≥ 5) | ✅ |
| Fumble detection (0 successes + botch) | ✅ |
| State machine transitions | ✅ |
| Exhaustive logging | ✅ |
| Comprehensive unit tests | ✅ |
| JSON configuration files | ✅ |

---

## Next Steps

- **v0.15.4f:** Salvage & Component Identification System
- **v0.15.4g:** System Bypass Skill Tree Integration
