# v0.11.1a Changelog: Recipe Definitions

**Version:** 0.11.1a
**Phase:** Recipe Definitions (Crafting Foundation)
**Date:** 2026-01-19
**Status:** ✅ Complete

---

## Summary

Implements the foundational recipe data model for the crafting system. Recipes are data-driven templates loaded from JSON configuration that define what resources are consumed and what items are produced. This version establishes the recipe definition pattern connecting the resource system (v0.11.0a) to the item system.

---

## Added

### Domain Layer - Enums

| Enum | Values | Description |
|------|--------|-------------|
| `RecipeCategory` | Weapon, Armor, Potion, Consumable, Accessory, Tool, Material | Recipe classifications for filtering and UI organization |

### Domain Layer - Value Objects

| Value Object | Description |
|--------------|-------------|
| `RecipeIngredient` | Represents a required resource with quantity |
| `RecipeOutput` | Represents the produced item with optional quality scaling |

#### RecipeIngredient Properties

| Property | Type | Description |
|----------|------|-------------|
| `ResourceId` | `string` | Reference to ResourceDefinition ID (lowercase) |
| `Quantity` | `int` | Number of resources required (minimum 1) |

#### RecipeOutput Properties

| Property | Type | Description |
|----------|------|-------------|
| `ItemId` | `string` | Reference to ItemDefinition ID (lowercase) |
| `Quantity` | `int` | Number of items produced (minimum 1) |
| `QualityFormula` | `string?` | Optional roll-based quality determination |
| `HasQualityScaling` | `bool` | True if quality formula is set |

### Domain Layer - Entities

| Entity | Description |
|--------|-------------|
| `RecipeDefinition` | Data-driven template for crafting recipes |

#### RecipeDefinition Properties

| Property | Type | Description |
|----------|------|-------------|
| `Id` | `Guid` | Unique identifier (IEntity requirement) |
| `RecipeId` | `string` | Lowercase string identifier for lookups |
| `Name` | `string` | Display name |
| `Description` | `string` | Recipe description text |
| `Category` | `RecipeCategory` | Recipe classification |
| `RequiredStationId` | `string` | Required crafting station ID |
| `Ingredients` | `IReadOnlyList<RecipeIngredient>` | Required resources |
| `Output` | `RecipeOutput` | Produced item configuration |
| `DifficultyClass` | `int` | Crafting skill check DC (1-30) |
| `IsDefault` | `bool` | Whether recipe is known by default |
| `CraftingTimeSeconds` | `int` | Time to craft in seconds |
| `IconPath` | `string?` | Optional icon path |

#### RecipeDefinition Methods

| Method | Description |
|--------|-------------|
| `Create(...)` | Factory method with validation |
| `GetTotalIngredientCount()` | Sum of all ingredient quantities |
| `GetIngredient(resourceId)` | Get ingredient by resource ID |
| `RequiresResource(resourceId)` | Check if resource is required |
| `GetDifficultyDescription()` | Human-readable DC description |
| `GetIngredientsDisplay()` | Comma-separated ingredient list |

### Application Layer - Interfaces

| Interface | Description |
|-----------|-------------|
| `IRecipeProvider` | Service interface for recipe definitions |

#### IRecipeProvider Methods

| Method | Description |
|--------|-------------|
| `GetRecipe(id)` | Get by ID (case-insensitive) |
| `GetAllRecipes()` | Get all definitions |
| `GetRecipesByCategory(category)` | Filter by category |
| `GetRecipesForStation(stationId)` | Filter by crafting station |
| `GetDefaultRecipes()` | Get starter recipes only |
| `GetRecipesForItem(itemId)` | Get recipes producing item |
| `Exists(id)` | Check existence |
| `GetRecipeCount()` | Total recipe count |

### Infrastructure Layer - Providers

| Provider | Description |
|----------|-------------|
| `RecipeProvider` | Loads recipes from JSON with lazy loading and multiple indexes |

### Configuration Files

| File | Description |
|------|-------------|
| `config/schemas/recipes.schema.json` | JSON Schema for validation |
| `config/recipes.json` | 15 recipe definitions |

---

## Recipe Definitions

### Weapon Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| iron-sword | Iron Sword | anvil | 12 | Yes |
| steel-sword | Steel Sword | anvil | 14 | No |
| mithril-blade | Mithril Blade | anvil | 18 | No |

### Armor Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| iron-helmet | Iron Helmet | anvil | 12 | Yes |
| iron-chestplate | Iron Chestplate | anvil | 13 | Yes |
| leather-armor | Leather Armor | workbench | 11 | Yes |
| steel-armor | Steel Armor | anvil | 15 | No |

### Potion Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| healing-potion | Healing Potion | alchemy-table | 10 | Yes |
| mana-potion | Mana Potion | alchemy-table | 12 | Yes |
| fire-resistance-potion | Fire Resistance Potion | alchemy-table | 15 | No |
| greater-healing-potion | Greater Healing Potion | alchemy-table | 14 | No |

### Tool Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| iron-pickaxe | Iron Pickaxe | anvil | 11 | Yes |

### Material Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| iron-ingot | Iron Ingot | anvil | 8 | Yes |

### Consumable Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| cooked-meat | Cooked Meat | cooking-fire | 8 | Yes |

### Accessory Recipes

| ID | Name | Station | DC | Default |
|----|------|---------|-----|---------|
| silver-ring | Silver Ring | workbench | 12 | No |

---

## Difficulty Class Scale

| DC Range | Description | Example |
|----------|-------------|---------|
| 1-8 | Trivial | Iron Ingot (DC 8) |
| 9-10 | Easy | Healing Potion (DC 10) |
| 11-12 | Moderate | Iron Sword (DC 12) |
| 13-14 | Challenging | Steel Sword (DC 14) |
| 15-16 | Hard | Fire Resistance Potion (DC 15) |
| 17-18 | Very Hard | Mithril Blade (DC 18) |
| 19+ | Legendary | Mythic items |

---

## Crafting Stations

| Station ID | Recipes |
|------------|---------|
| anvil | Iron Sword, Iron Helmet, Iron Chestplate, Iron Pickaxe, Iron Ingot, Steel Sword, Steel Armor, Mithril Blade |
| alchemy-table | Healing Potion, Mana Potion, Fire Resistance Potion, Greater Healing Potion |
| workbench | Leather Armor, Silver Ring |
| cooking-fire | Cooked Meat |

---

## Unit Tests

### RecipeIngredientTests (~30 tests)

- Valid construction with property assignment
- Resource ID normalization to lowercase
- Invalid resource ID validation (null, empty, whitespace)
- Invalid quantity validation (zero, negative)
- ToString formatting
- Equality tests

### RecipeOutputTests (~30 tests)

- Valid construction with property assignment
- Item ID normalization to lowercase
- Quality formula handling (with/without, null, empty)
- HasQualityScaling computed property
- Invalid item ID validation
- Invalid quantity validation
- ToString formatting with/without quality scaling
- Equality tests

### RecipeDefinitionTests (~33 tests)

- Factory method validation
- ID normalization to lowercase
- Invalid parameter validation
- Query methods (GetTotalIngredientCount, GetIngredient, RequiresResource)
- Difficulty description for all DC ranges
- Display methods (GetIngredientsDisplay)
- Category tests

### RecipeProviderTests (~26 tests)

- Constructor loading from configuration
- GetRecipe by ID (existing, non-existing, case-insensitive)
- GetAllRecipes returns all loaded
- GetRecipesByCategory filtering
- GetRecipesForStation filtering
- GetDefaultRecipes returns only defaults
- GetRecipesForItem filtering
- Exists checks
- Recipe details integration tests
- Missing file handling

---

## Files Created

| Path | Description |
|------|-------------|
| `src/Core/RuneAndRust.Domain/Enums/RecipeCategory.cs` | Recipe category enum |
| `src/Core/RuneAndRust.Domain/ValueObjects/RecipeIngredient.cs` | Ingredient value object |
| `src/Core/RuneAndRust.Domain/ValueObjects/RecipeOutput.cs` | Output value object |
| `src/Core/RuneAndRust.Domain/Definitions/RecipeDefinition.cs` | Recipe entity |
| `src/Core/RuneAndRust.Application/Interfaces/IRecipeProvider.cs` | Provider interface |
| `src/Infrastructure/RuneAndRust.Infrastructure/Providers/RecipeProvider.cs` | JSON provider |
| `config/schemas/recipes.schema.json` | JSON Schema |
| `config/recipes.json` | Recipe definitions |
| `tests/.../ValueObjects/RecipeIngredientTests.cs` | Ingredient tests |
| `tests/.../ValueObjects/RecipeOutputTests.cs` | Output tests |
| `tests/.../Definitions/RecipeDefinitionTests.cs` | Entity tests |
| `tests/.../Providers/RecipeProviderTests.cs` | Provider tests |

---

## API Examples

### Loading Recipes

```csharp
// Provider is initialized with config path
var provider = new RecipeProvider(
    "config/recipes.json",
    logger);

// Get specific recipe
var ironSword = provider.GetRecipe("iron-sword");
Console.WriteLine($"{ironSword.Name}: DC {ironSword.DifficultyClass}");
// Output: Iron Sword: DC 12

// Get all weapon recipes
var weapons = provider.GetRecipesByCategory(RecipeCategory.Weapon);
foreach (var weapon in weapons)
{
    Console.WriteLine($"- {weapon.Name}");
}
```

### Checking Ingredients

```csharp
// Get recipe and check requirements
var recipe = provider.GetRecipe("iron-sword");

// Check total resources needed
var total = recipe.GetTotalIngredientCount();
Console.WriteLine($"Total resources: {total}");
// Output: Total resources: 7

// Check specific resource
if (recipe.RequiresResource("iron-ore"))
{
    var ingredient = recipe.GetIngredient("iron-ore");
    Console.WriteLine($"Needs {ingredient.Quantity} iron ore");
}
// Output: Needs 5 iron ore
```

### Station-Based Filtering

```csharp
// Get recipes available at anvil
var anvilRecipes = provider.GetRecipesForStation("anvil");
foreach (var recipe in anvilRecipes)
{
    Console.WriteLine($"- {recipe.Name} ({recipe.GetDifficultyDescription()})");
}
// Output:
// - Iron Sword (Moderate)
// - Iron Helmet (Moderate)
// - Iron Ingot (Trivial)
// etc.
```

### Quality Scaling Recipes

```csharp
// Check for quality scaling
var mithril = provider.GetRecipe("mithril-blade");
if (mithril.Output.HasQualityScaling)
{
    Console.WriteLine($"Quality formula: {mithril.Output.QualityFormula}");
}
// Output: Quality formula: roll >= 20 ? 'Legendary' : roll >= 15 ? 'Epic' : 'Rare'
```

---

## v0.11.x Progress

| Version | Feature | Status |
|---------|---------|--------|
| v0.11.0a | Resource Definitions | ✅ Complete |
| v0.11.0b | Harvestable Features | ✅ Complete |
| v0.11.0c | Gathering Service | ✅ Complete |
| v0.11.1a | Recipe Definitions | ✅ Complete |
| v0.11.1b | Recipe Book | Pending |
| v0.11.1c | Recipe Discovery | Pending |
| v0.11.2 | Crafting System | Pending |

---

## Dependencies

- Builds on v0.11.0c (Gathering Service)
- Follows `JsonResourceProvider` pattern for JSON loading
- `RecipeDefinition` implements `IEntity` interface
- Ingredients reference `ResourceDefinition` IDs from v0.11.0a
- Outputs reference `ItemDefinition` IDs

---

## Notes

- Recipe IDs use kebab-case (lowercase with hyphens)
- Provider uses case-insensitive dictionary lookups
- Multiple indexes built for efficient queries (by category, station, output item)
- Lazy loading with EnsureLoaded pattern
- 9 default recipes automatically known by new players
- 6 non-default recipes require discovery/scrolls
- Quality formula enables roll-based output quality for high-tier recipes
- DC scale follows standard D&D-style progression
