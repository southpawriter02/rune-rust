# v0.14.1d Changelog: Combat Rules Schema

**Date:** 2026-01-21
**Version:** 0.14.1d
**Scope:** Combat Rules Schema

---

## Summary

Introduced `combat.schema.json` to validate combat mechanics configuration including flanking rules, opportunity attacks, initiative calculation, and death/unconscious behaviors. This completes the v0.14.1 Combat Configuration Schemas series.

---

## Added

### Schema Files
- **`config/schemas/combat.schema.json`** - JSON Schema Draft-07 for combat rules
  - Root properties: `$schema`, `version`, `flanking`, `opportunityAttacks`, `initiative`, `death`
  - `FlankingConfig` definition (enabled, attackBonus, damageBonus, behindAttackBonus, behindDamageBonus)
  - `OpportunityAttackConfig` definition (enabled, requiresMeleeWeapon, oneReactionPerRound, disengage)
  - `DisengageConfig` definition (enabled, consumesAction)
  - `InitiativeConfig` definition (baseAttribute enum, diceExpression, tieBreaker enum, surpriseRoundBonus)
  - `DeathConfig` definition (unconsciousThreshold, deathThreshold, deathSavesEnabled, deathSaveSuccesses, deathSaveFailures)

### Enum Validations
| Enum | Values |
|------|--------|
| baseAttribute | wits, finesse |
| tieBreaker | HigherAttribute, Random, PlayerFirst |

### Range Validations
| Property | Range |
|----------|-------|
| attackBonus, damageBonus | minimum: 0 |
| deathSaveSuccesses, deathSaveFailures | minimum: 1 |
| deathThreshold | integer or null |

### Unit Tests
- **`CombatSchemaTests.cs`** - 6 new tests
  1. `Schema_IsValidJsonSchemaDraft07`
  2. `ExistingCombatJson_ValidatesAgainstSchema`
  3. `TieBreaker_InvalidEnumValue_FailsValidation`
  4. `BaseAttribute_InvalidEnumValue_FailsValidation`
  5. `AttackBonus_NegativeValue_FailsValidation`
  6. `DeathSaveSuccesses_ZeroValue_FailsValidation`

---

## Changed

### Configuration Updates
- **`config/combat.json`** - Major expansion:
  - Added `$schema` reference to `./schemas/combat.schema.json`
  - Added `initiative` section: wits-based, 1d20, HigherAttribute tie breaker, +10 surprise penalty
  - Added `death` section: unconscious at 0 HP, death at -10 HP, death saves disabled

---

## Verification

| Check | Status |
|-------|--------|
| Build (0 errors) | ✅ |
| Build (0 warnings) | ✅ |
| New unit tests (6/6) | ✅ |
| All schema tests | ✅ |
| Flanking validates | ✅ |
| Opportunity attacks validate | ✅ |
| Initiative validates | ✅ |
| Death validates | ✅ |

---

## Dependencies

**Requires:** v0.14.0 (Character Configuration Schemas)
**Completes:** v0.14.1 (Combat Configuration Schemas)
