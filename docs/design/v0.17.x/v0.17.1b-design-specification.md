# v0.17.1b Design Specification: Background Skill Grants

**Version:** 0.17.1b  
**Phase Name:** Background Skill Grants  
**Parent Version:** v0.17.1 (Background System)  
**Prerequisites:** v0.17.1a Complete (Background Enum & Definition)  
**Estimated Tests:** ~8 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [SkillGrantType Enum](#4-skillgranttype-enum)
5. [BackgroundSkillGrant Value Object](#5-backgroundskillgrant-value-object)
6. [BackgroundDefinition Extension](#6-backgrounddefinition-extension)
7. [Data Model Changes](#7-data-model-changes)
8. [Configuration File Schema Updates](#8-configuration-file-schema-updates)
9. [Logging Specifications](#9-logging-specifications)
10. [Unit Testing Requirements](#10-unit-testing-requirements)
11. [Use Cases](#11-use-cases)
12. [User Stories](#12-user-stories)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the skill grant system for backgrounds, extending the `BackgroundDefinition` entity created in v0.17.1a. Skill grants represent professional knowledge and trained abilities from the character's pre-Silence occupation.

Each background provides distinct skill advantages:

- **Village Smith** — Craft +2, Might +1
- **Traveling Healer** — Medicine +2, Herbalism +1
- **Ruin Delver** — Exploration +2, Traps +1
- **Clan Guard** — Combat +2, Vigilance +1
- **Wandering Skald** — Performance +2, Lore +1
- **Outcast Scavenger** — Survival +2, Stealth +1

This phase establishes the `SkillGrantType` enum and `BackgroundSkillGrant` value object that define skill bonuses from professional training.

### 1.2 Key Deliverables

| Category          | Items                                                      |
| ----------------- | ---------------------------------------------------------- |
| **Enums**         | `SkillGrantType`                                           |
| **Value Objects** | `BackgroundSkillGrant`                                     |
| **Entity Update** | `BackgroundDefinition` extended with `SkillGrants`         |
| **Configuration** | `backgrounds.json` extended with skill grants section      |
| **Schema Update** | `backgrounds.schema.json` extended with skill grant schema |
| **Tests**         | ~8 unit tests                                              |

### 1.3 Architectural Significance

This version extends the **Background Pattern** established in v0.17.1a:

- **Grant Type System**: Different grant types (Permanent, StartingBonus, Proficiency) allow flexible skill application
- **Skill Bonus Pattern**: Reuses similar pattern to `SkillBonus` from v0.17.0b for consistency
- **Configuration-Driven**: Skill grants defined in JSON for easy balancing
- **Primary/Secondary Pattern**: Each background grants +2 primary and +1 secondary skill

---

## 2. Feature Overview

```
v0.17.1b Background Skill Grants
├── SkillGrantType Enum
│   ├── Permanent (0) - Added to base skill value permanently
│   ├── StartingBonus (1) - Applied at creation only
│   └── Proficiency (2) - Unlocks skill use without penalty
├── BackgroundSkillGrant Value Object
│   ├── SkillId: string (kebab-case skill identifier)
│   ├── BonusAmount: int (typically +1 or +2)
│   └── GrantType: SkillGrantType
└── BackgroundDefinition Extension
    └── SkillGrants: IReadOnlyList<BackgroundSkillGrant>
```

### 2.1 Scope Alignment

**In Scope:**

- `SkillGrantType` enum with three grant types
- `BackgroundSkillGrant` value object for individual skill modifiers
- Extension of `BackgroundDefinition` entity with `SkillGrants` property
- Configuration schema updates for skill grants section
- Skill grant data for all 6 backgrounds
- Skill application logic hooks

**Out of Scope:**

- Equipment grants → v0.17.1c
- BackgroundProvider service → v0.17.1d
- BackgroundApplicationService → v0.17.1e
- Actual skill system implementation → already exists
- Character creation workflow integration → v0.17.5

---

## 3. Architecture Diagrams

### 3.1 Skill Grant System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                   SKILL GRANT SYSTEM OVERVIEW                        │
└─────────────────────────────────────────────────────────────────────┘

    BackgroundDefinition (from v0.17.1a)
           │
           │  Contains skill grants
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    BackgroundSkillGrant                              │
├─────────────────────────────────────────────────────────────────────┤
│  - SkillId: string         (e.g., "craft", "medicine", "combat")    │
│  - BonusAmount: int        (+2 for primary, +1 for secondary)       │
│  - GrantType: SkillGrantType                                        │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  References grant type
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                      SkillGrantType                                  │
├─────────────────────────────────────────────────────────────────────┤
│  Permanent (0)      - Added to base skill permanently               │
│  StartingBonus (1)  - Applied at creation only                      │
│  Proficiency (2)    - Unlocks skill without penalty                 │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  CharacterCreationView (v0.17.5)                                     │
│  └── Displays skill grants during background selection               │
│                                                                      │
│  CharacterSheetView                                                  │
│  └── Shows skill bonuses with "Background" source label              │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  IBackgroundApplicationService (v0.17.1e)                            │
│  └── Applies skill grants to character during creation               │
│                                                                      │
│  BackgroundPreview                                                   │
│  └── Generates skill grant preview for UI                            │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌────────────────────────────────────┐   │
│  │   SkillGrantType    │  │     BackgroundSkillGrant           │   │
│  │       (Enum)        │  │       (Value Object)               │   │
│  ├─────────────────────┤  ├────────────────────────────────────┤   │
│  │ Permanent = 0       │  │ SkillId: string                    │   │
│  │ StartingBonus = 1   │  │ BonusAmount: int                   │   │
│  │ Proficiency = 2     │  │ GrantType: SkillGrantType          │   │
│  └─────────────────────┘  └────────────────────────────────────┘   │
│                                                                      │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │                    BackgroundDefinition                        │ │
│  │                    (Extended from v0.17.1a)                    │ │
│  ├────────────────────────────────────────────────────────────────┤ │
│  │ + SkillGrants: IReadOnlyList<BackgroundSkillGrant>             │ │
│  │ + HasSkillGrants(): bool                                       │ │
│  │ + GetPrimarySkillGrant(): BackgroundSkillGrant?                │ │
│  │ + GetSkillGrantSummary(): string                               │ │
│  └────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.3 Skill Grant Application Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                  SKILL GRANT APPLICATION FLOW                        │
└─────────────────────────────────────────────────────────────────────┘

    Player Selects Background (e.g., Village Smith)
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  GET SKILL GRANTS FROM DEFINITION                    │
├─────────────────────────────────────────────────────────────────────┤
│  Village Smith Skill Grants:                                        │
│  ┌────────────────────────────────────────────────────────────────┐ │
│  │  { SkillId: "craft", BonusAmount: 2, GrantType: Permanent }    │ │
│  │  { SkillId: "might", BonusAmount: 1, GrantType: Permanent }    │ │
│  └────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  PROCESS EACH SKILL GRANT                            │
├─────────────────────────────────────────────────────────────────────┤
│  For each grant in SkillGrants:                                     │
│                                                                      │
│    ┌──────────────────────┐                                         │
│    │ Check GrantType      │                                         │
│    └──────────┬───────────┘                                         │
│         ┌─────┴─────┬───────────────┐                               │
│         ▼           ▼               ▼                               │
│    ┌─────────┐ ┌─────────────┐ ┌─────────────┐                     │
│    │Permanent│ │StartingBonus│ │ Proficiency │                     │
│    └────┬────┘ └──────┬──────┘ └──────┬──────┘                     │
│         │             │               │                             │
│         ▼             ▼               ▼                             │
│    Add to base   Add to temp    Add to                              │
│    skill value   creation bonus proficient list                     │
└─────────────────────────────────────────────────────────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                  RESULT: VILLAGE SMITH                               │
├─────────────────────────────────────────────────────────────────────┤
│  Character Skills Modified:                                         │
│  • Craft: Base +2 (from Village Smith)                              │
│  • Might: Base +1 (from Village Smith)                              │
│                                                                      │
│  Displayed in character sheet as:                                   │
│  "Craft +2 (Village Smith), Might +1 (Village Smith)"               │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.4 Skill Grant Comparison Matrix

```
┌─────────────────────────────────────────────────────────────────────┐
│                  BACKGROUND SKILL GRANT MATRIX                       │
└─────────────────────────────────────────────────────────────────────┘

    ┌─────────────────┬─────────────────────┬─────────────────────┐
    │    Background   │   Primary (+2)      │   Secondary (+1)    │
    ├─────────────────┼─────────────────────┼─────────────────────┤
    │  Village Smith  │   Craft             │   Might             │
    ├─────────────────┼─────────────────────┼─────────────────────┤
    │Traveling Healer │   Medicine          │   Herbalism         │
    ├─────────────────┼─────────────────────┼─────────────────────┤
    │   Ruin Delver   │   Exploration       │   Traps             │
    ├─────────────────┼─────────────────────┼─────────────────────┤
    │   Clan Guard    │   Combat            │   Vigilance         │
    ├─────────────────┼─────────────────────┼─────────────────────┤
    │ Wandering Skald │   Performance       │   Lore              │
    ├─────────────────┼─────────────────────┼─────────────────────┤
    │Outcast Scavenger│   Survival          │   Stealth           │
    └─────────────────┴─────────────────────┴─────────────────────┘

    Design Notes:
    ┌─────────────────────────────────────────────────────────────────┐
    │ • Each background grants exactly TWO skill bonuses              │
    │ • Primary skill receives +2 (major professional expertise)      │
    │ • Secondary skill receives +1 (related knowledge)               │
    │ • All grants use Permanent type by default                      │
    │ • Skills are kebab-case identifiers matching skill system       │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.5 Grant Type Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│                   GRANT TYPE APPLICATION DECISION                    │
└─────────────────────────────────────────────────────────────────────┘

    Skill Grant Being Applied
           │
           ▼
    ┌──────────────────────┐
    │ What is GrantType?   │
    └──────────┬───────────┘
               │
    ┌──────────┼────────────────────────────────────────┐
    │          │                                        │
    ▼          ▼                                        ▼
┌────────┐ ┌────────────┐                        ┌────────────┐
│Permanent│ │StartingBonus│                       │Proficiency │
└────┬───┘ └─────┬──────┘                        └─────┬──────┘
     │           │                                     │
     ▼           ▼                                     ▼
┌──────────────────────────────────────────────────────────────────┐
│ Add BonusAmount │ Add BonusAmount to   │ Add SkillId to         │
│ to base skill   │ temporary creation   │ ProficientSkills list  │
│ value forever   │ bonus (not stacking) │ (removes untrained     │
│                 │                      │ penalty)               │
└──────────────────────────────────────────────────────────────────┘
     │           │                                     │
     ▼           ▼                                     ▼
┌──────────────────────────────────────────────────────────────────┐
│  Example:      │  Example:            │  Example:               │
│  Craft +2      │  "You start with     │  Can use Traps skill    │
│  added to all  │  bonus Craft ranks"  │  without -2 untrained   │
│  Craft checks  │  (one-time)          │  penalty                │
└──────────────────────────────────────────────────────────────────┘
```

---

## 4. SkillGrantType Enum

### 4.1 Purpose

The `SkillGrantType` enum defines how a skill grant is applied to a character. This allows flexibility for different types of professional knowledge that backgrounds might provide.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/SkillGrantType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines how a skill grant from a background is applied to a character.
/// </summary>
/// <remarks>
/// <para>
/// SkillGrantType determines the mechanical effect of skill bonuses granted by
/// backgrounds. Different grant types allow backgrounds to provide various
/// forms of professional expertise.
/// </para>
/// <para>
/// The three grant types serve distinct purposes:
/// - Permanent: Core professional skills that persist throughout the game
/// - StartingBonus: Initial advantage that doesn't stack with training
/// - Proficiency: Removes untrained penalty for specialized skills
/// </para>
/// </remarks>
public enum SkillGrantType
{
    /// <summary>
    /// Bonus added permanently to the base skill value.
    /// </summary>
    /// <remarks>
    /// Permanent grants represent core professional expertise that never fades.
    /// The bonus is added to all skill checks using this skill and stacks with
    /// other bonuses from training, equipment, or abilities.
    /// Example: Village Smith's Craft +2 applies to all Craft checks.
    /// </remarks>
    Permanent = 0,

    /// <summary>
    /// Bonus applied only at character creation.
    /// </summary>
    /// <remarks>
    /// StartingBonus grants represent initial training that provides a head
    /// start but doesn't stack with later skill development. If the character
    /// later trains the skill, the starting bonus is subsumed.
    /// Example: Starting with 2 ranks instead of 0.
    /// </remarks>
    StartingBonus = 1,

    /// <summary>
    /// Unlocks skill use without untrained penalty.
    /// </summary>
    /// <remarks>
    /// Proficiency grants remove the -2 untrained penalty for skills that
    /// normally require training. The character doesn't gain bonus ranks,
    /// but can attempt the skill without disadvantage.
    /// Example: Ruin Delver can attempt Traps checks without penalty.
    /// </remarks>
    Proficiency = 2
}
```

### 4.3 Grant Type Reference Table

| Grant Type      | Integer | Effect                            | Stacks? |
| --------------- | ------- | --------------------------------- | ------- |
| `Permanent`     | 0       | Added to base skill value forever | Yes     |
| `StartingBonus` | 1       | Applied at creation only          | No      |
| `Proficiency`   | 2       | Removes untrained penalty         | N/A     |

---

## 5. BackgroundSkillGrant Value Object

### 5.1 Purpose

The `BackgroundSkillGrant` value object represents a single skill bonus granted by a background. It pairs a skill identifier with a bonus amount and grant type.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/BackgroundSkillGrant.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents a skill bonus granted by a background.
/// </summary>
/// <remarks>
/// <para>
/// BackgroundSkillGrant is a value object pairing a skill identifier with a bonus
/// amount and grant type. Skills are identified by kebab-case string IDs to support
/// configuration-driven skill systems.
/// </para>
/// <para>
/// Each background typically grants two skill bonuses:
/// - Primary skill (+2): Core professional expertise
/// - Secondary skill (+1): Related knowledge
/// </para>
/// </remarks>
/// <param name="SkillId">The kebab-case skill identifier (e.g., "craft", "medicine").</param>
/// <param name="BonusAmount">The bonus amount to add (typically +1 or +2).</param>
/// <param name="GrantType">How the bonus is applied (Permanent, StartingBonus, Proficiency).</param>
public readonly record struct BackgroundSkillGrant(
    string SkillId,
    int BonusAmount,
    SkillGrantType GrantType)
{
    /// <summary>
    /// Gets whether this is a permanent skill bonus.
    /// </summary>
    public bool IsPermanent => GrantType == SkillGrantType.Permanent;

    /// <summary>
    /// Gets whether this is a starting bonus only.
    /// </summary>
    public bool IsStartingBonus => GrantType == SkillGrantType.StartingBonus;

    /// <summary>
    /// Gets whether this grants proficiency (removes untrained penalty).
    /// </summary>
    public bool IsProficiency => GrantType == SkillGrantType.Proficiency;

    /// <summary>
    /// Gets whether this grant provides a numeric bonus.
    /// </summary>
    public bool HasNumericBonus => BonusAmount > 0;

    /// <summary>
    /// Creates a new BackgroundSkillGrant with validation.
    /// </summary>
    /// <param name="skillId">The skill identifier.</param>
    /// <param name="bonusAmount">The bonus amount.</param>
    /// <param name="grantType">The grant type.</param>
    /// <returns>A new BackgroundSkillGrant instance.</returns>
    /// <exception cref="ArgumentException">Thrown when skillId is null or whitespace.</exception>
    /// <exception cref="ArgumentOutOfRangeException">Thrown when bonusAmount is negative.</exception>
    public static BackgroundSkillGrant Create(
        string skillId,
        int bonusAmount,
        SkillGrantType grantType = SkillGrantType.Permanent)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(skillId);
        ArgumentOutOfRangeException.ThrowIfNegative(bonusAmount);

        return new BackgroundSkillGrant(
            skillId.ToLowerInvariant(),
            bonusAmount,
            grantType);
    }

    /// <summary>
    /// Creates a permanent skill bonus (most common type).
    /// </summary>
    public static BackgroundSkillGrant Permanent(string skillId, int bonusAmount) =>
        Create(skillId, bonusAmount, SkillGrantType.Permanent);

    /// <summary>
    /// Creates a starting bonus skill grant.
    /// </summary>
    public static BackgroundSkillGrant Starting(string skillId, int bonusAmount) =>
        Create(skillId, bonusAmount, SkillGrantType.StartingBonus);

    /// <summary>
    /// Creates a proficiency grant (no numeric bonus, removes penalty).
    /// </summary>
    public static BackgroundSkillGrant Proficient(string skillId) =>
        Create(skillId, 0, SkillGrantType.Proficiency);

    /// <inheritdoc />
    public override string ToString()
    {
        if (GrantType == SkillGrantType.Proficiency)
            return $"{SkillId} (proficient)";

        var sign = BonusAmount >= 0 ? "+" : "";
        var typeLabel = GrantType == SkillGrantType.StartingBonus ? " (starting)" : "";
        return $"{SkillId} {sign}{BonusAmount}{typeLabel}";
    }
}
```

### 5.3 Skill Grant Reference Table

| Background        | Skill ID    | Bonus | Grant Type |
| ----------------- | ----------- | ----- | ---------- |
| Village Smith     | craft       | +2    | Permanent  |
| Village Smith     | might       | +1    | Permanent  |
| Traveling Healer  | medicine    | +2    | Permanent  |
| Traveling Healer  | herbalism   | +1    | Permanent  |
| Ruin Delver       | exploration | +2    | Permanent  |
| Ruin Delver       | traps       | +1    | Permanent  |
| Clan Guard        | combat      | +2    | Permanent  |
| Clan Guard        | vigilance   | +1    | Permanent  |
| Wandering Skald   | performance | +2    | Permanent  |
| Wandering Skald   | lore        | +1    | Permanent  |
| Outcast Scavenger | survival    | +2    | Permanent  |
| Outcast Scavenger | stealth     | +1    | Permanent  |

---

## 6. BackgroundDefinition Extension

### 6.1 Purpose

This section defines the extension to `BackgroundDefinition` to include skill grants. The factory method is updated to accept skill grants, and helper methods are added for skill grant access.

### 6.2 Implementation Changes

**File:** `src/Core/RuneAndRust.Domain/Entities/BackgroundDefinition.cs`

```csharp
// Add to existing BackgroundDefinition class

/// <summary>
/// Gets the skill bonuses granted by this background.
/// </summary>
/// <remarks>
/// Each background typically grants two skill bonuses:
/// - Primary skill (+2): Core professional expertise from pre-Silence work
/// - Secondary skill (+1): Related knowledge gained through the profession
/// </remarks>
public IReadOnlyList<BackgroundSkillGrant> SkillGrants { get; private set; }

// Update private constructor
private BackgroundDefinition()
{
    DisplayName = null!;
    Description = null!;
    SelectionText = null!;
    ProfessionBefore = null!;
    SocialStanding = null!;
    NarrativeHooks = Array.Empty<string>();
    SkillGrants = Array.Empty<BackgroundSkillGrant>();
}

// Update factory method signature
public static BackgroundDefinition Create(
    Background backgroundId,
    string displayName,
    string description,
    string selectionText,
    string professionBefore,
    string socialStanding,
    IReadOnlyList<string>? narrativeHooks = null,
    IReadOnlyList<BackgroundSkillGrant>? skillGrants = null)
{
    ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
    ArgumentException.ThrowIfNullOrWhiteSpace(description);
    ArgumentException.ThrowIfNullOrWhiteSpace(selectionText);
    ArgumentException.ThrowIfNullOrWhiteSpace(professionBefore);
    ArgumentException.ThrowIfNullOrWhiteSpace(socialStanding);

    return new BackgroundDefinition
    {
        Id = Guid.NewGuid(),
        BackgroundId = backgroundId,
        DisplayName = displayName,
        Description = description,
        SelectionText = selectionText,
        ProfessionBefore = professionBefore,
        SocialStanding = socialStanding,
        NarrativeHooks = narrativeHooks ?? Array.Empty<string>(),
        SkillGrants = skillGrants ?? Array.Empty<BackgroundSkillGrant>()
    };
}

/// <summary>
/// Gets whether this background grants any skills.
/// </summary>
public bool HasSkillGrants() => SkillGrants.Count > 0;

/// <summary>
/// Gets the primary skill grant (highest bonus amount).
/// </summary>
/// <returns>The primary skill grant, or null if no grants exist.</returns>
public BackgroundSkillGrant? GetPrimarySkillGrant() =>
    SkillGrants.Count > 0
        ? SkillGrants.OrderByDescending(g => g.BonusAmount).First()
        : null;

/// <summary>
/// Gets the secondary skill grant (second highest bonus amount).
/// </summary>
/// <returns>The secondary skill grant, or null if fewer than 2 grants exist.</returns>
public BackgroundSkillGrant? GetSecondarySkillGrant() =>
    SkillGrants.Count > 1
        ? SkillGrants.OrderByDescending(g => g.BonusAmount).Skip(1).First()
        : null;

/// <summary>
/// Gets a formatted summary of skill grants for display.
/// </summary>
/// <returns>A comma-separated list of skill grants.</returns>
public string GetSkillGrantSummary() =>
    SkillGrants.Count > 0
        ? string.Join(", ", SkillGrants.Select(g => g.ToString()))
        : "No skill bonuses";

/// <summary>
/// Gets the total skill bonus granted by this background.
/// </summary>
public int GetTotalSkillBonus() =>
    SkillGrants.Sum(g => g.BonusAmount);
```

---

## 7. Data Model Changes

### 7.1 New Types Summary

| Type                   | Layer  | Category     | Description                 |
| ---------------------- | ------ | ------------ | --------------------------- |
| `SkillGrantType`       | Domain | Enum         | Grant application type      |
| `BackgroundSkillGrant` | Domain | Value Object | Skill bonus from background |

### 7.2 Modified Types

| Type                   | Change                          | Description                |
| ---------------------- | ------------------------------- | -------------------------- |
| `BackgroundDefinition` | Added `SkillGrants` property    | Collection of skill grants |
| `BackgroundDefinition` | Updated `Create` factory method | Accepts skill grants       |
| `BackgroundDefinition` | Added helper methods            | Skill grant access methods |

### 7.3 File Locations

```
src/Core/RuneAndRust.Domain/
├── Enums/
│   └── SkillGrantType.cs                    ← NEW
├── ValueObjects/
│   └── BackgroundSkillGrant.cs              ← NEW
├── Entities/
│   └── BackgroundDefinition.cs              ← MODIFIED

config/
└── backgrounds.json                         ← MODIFIED (add skillGrants)
└── schemas/
    └── backgrounds.schema.json              ← MODIFIED (add skillGrants schema)
```

---

## 8. Configuration File Schema Updates

### 8.1 backgrounds.json (Extended with Skill Grants)

```json
{
    "$schema": "./schemas/backgrounds.schema.json",
    "backgrounds": [
        {
            "backgroundId": "VillageSmith",
            "displayName": "Village Smith",
            "description": "You worked the forge...",
            "selectionText": "The ring of hammer on anvil...",
            "professionBefore": "Blacksmith and metalworker",
            "socialStanding": "Respected craftsperson...",
            "narrativeHooks": ["Recognize craftsmanship in ruins", "..."],
            "skillGrants": [
                {
                    "skillId": "craft",
                    "bonusAmount": 2,
                    "grantType": "Permanent"
                },
                {
                    "skillId": "might",
                    "bonusAmount": 1,
                    "grantType": "Permanent"
                }
            ]
        },
        {
            "backgroundId": "TravelingHealer",
            "displayName": "Traveling Healer",
            "description": "You walked between settlements...",
            "selectionText": "You learned the old ways...",
            "professionBefore": "Itinerant medicine practitioner",
            "socialStanding": "Welcomed but sometimes distrusted",
            "narrativeHooks": ["Recognize diseases and their cures", "..."],
            "skillGrants": [
                {
                    "skillId": "medicine",
                    "bonusAmount": 2,
                    "grantType": "Permanent"
                },
                {
                    "skillId": "herbalism",
                    "bonusAmount": 1,
                    "grantType": "Permanent"
                }
            ]
        },
        {
            "backgroundId": "RuinDelver",
            "displayName": "Ruin Delver",
            "description": "The old places called to you...",
            "selectionText": "While others feared the dark places...",
            "professionBefore": "Scavenger and explorer",
            "socialStanding": "Useful but looked down upon",
            "narrativeHooks": ["Know ruin layouts and hazards", "..."],
            "skillGrants": [
                {
                    "skillId": "exploration",
                    "bonusAmount": 2,
                    "grantType": "Permanent"
                },
                {
                    "skillId": "traps",
                    "bonusAmount": 1,
                    "grantType": "Permanent"
                }
            ]
        },
        {
            "backgroundId": "ClanGuard",
            "displayName": "Clan Guard",
            "description": "You stood on the walls...",
            "selectionText": "The weight of the shield...",
            "professionBefore": "Warrior and protector",
            "socialStanding": "Honored defender...",
            "narrativeHooks": [
                "Recognize military formations and tactics",
                "..."
            ],
            "skillGrants": [
                {
                    "skillId": "combat",
                    "bonusAmount": 2,
                    "grantType": "Permanent"
                },
                {
                    "skillId": "vigilance",
                    "bonusAmount": 1,
                    "grantType": "Permanent"
                }
            ]
        },
        {
            "backgroundId": "WanderingSkald",
            "displayName": "Wandering Skald",
            "description": "You carried the stories...",
            "selectionText": "In a world that has forgotten...",
            "professionBefore": "Storyteller and historian",
            "socialStanding": "Entertainer, keeper of lore...",
            "narrativeHooks": ["Know old legends that hold clues", "..."],
            "skillGrants": [
                {
                    "skillId": "performance",
                    "bonusAmount": 2,
                    "grantType": "Permanent"
                },
                {
                    "skillId": "lore",
                    "bonusAmount": 1,
                    "grantType": "Permanent"
                }
            ]
        },
        {
            "backgroundId": "OutcastScavenger",
            "displayName": "Outcast Scavenger",
            "description": "Cast out from your clan...",
            "selectionText": "They called you unclean...",
            "professionBefore": "Exile and lone survivor",
            "socialStanding": "Pariah, viewed with suspicion...",
            "narrativeHooks": ["Know the wasteland's secrets", "..."],
            "skillGrants": [
                {
                    "skillId": "survival",
                    "bonusAmount": 2,
                    "grantType": "Permanent"
                },
                {
                    "skillId": "stealth",
                    "bonusAmount": 1,
                    "grantType": "Permanent"
                }
            ]
        }
    ]
}
```

### 8.2 backgrounds.schema.json (Skill Grants Schema Addition)

```json
{
    "$defs": {
        "skillGrant": {
            "type": "object",
            "description": "A skill bonus granted by the background",
            "required": ["skillId", "bonusAmount", "grantType"],
            "properties": {
                "skillId": {
                    "type": "string",
                    "description": "Kebab-case skill identifier",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "bonusAmount": {
                    "type": "integer",
                    "description": "Bonus amount (typically +1 or +2)",
                    "minimum": 0,
                    "maximum": 5
                },
                "grantType": {
                    "type": "string",
                    "description": "How the bonus is applied",
                    "enum": ["Permanent", "StartingBonus", "Proficiency"]
                }
            },
            "additionalProperties": false
        },
        "backgroundDefinition": {
            "properties": {
                "skillGrants": {
                    "type": "array",
                    "description": "Skill bonuses granted by this background",
                    "items": { "$ref": "#/$defs/skillGrant" },
                    "minItems": 0,
                    "maxItems": 5
                }
            }
        }
    }
}
```

---

## 9. Logging Specifications

### 9.1 Log Levels by Component

| Component               | Level       | Events                                   |
| ----------------------- | ----------- | ---------------------------------------- |
| `BackgroundSkillGrant`  | Debug       | Grant created, validation performed      |
| `BackgroundDefinition`  | Debug       | Skill grants accessed, summary generated |
| `BackgroundProvider`    | Information | Skill grants loaded for background       |
| `BackgroundApplication` | Information | Skill grants applied to character        |

### 9.2 Structured Logging Templates

```csharp
// Debug - Skill grant created
_logger.LogDebug(
    "BackgroundSkillGrant created. SkillId={SkillId}, Bonus={Bonus}, Type={GrantType}",
    skillId, bonusAmount, grantType);

// Information - Skill grants applied
_logger.LogInformation(
    "Applied {Count} skill grants from {Background}. Skills: {Skills}",
    count, backgroundId, skillSummary);

// Debug - Primary skill accessed
_logger.LogDebug(
    "Retrieved primary skill grant. Background={Background}, Skill={SkillId}, Bonus={Bonus}",
    backgroundId, skillId, bonus);
```

---

## 10. Unit Testing Requirements

### 10.1 Test Count by Feature

| Feature                     | Test Count |
| --------------------------- | ---------- |
| SkillGrantType enum         | ~2         |
| BackgroundSkillGrant        | ~4         |
| BackgroundDefinition update | ~2         |
| **Total**                   | **~8**     |

### 10.2 Test Specifications

#### SkillGrantTypeTests.cs

```csharp
[TestFixture]
public class SkillGrantTypeTests
{
    [Test]
    public void SkillGrantType_HasThreeValues_CountEquals3();

    [Test]
    public void SkillGrantType_ValuesHaveExpectedIntegers();
}
```

#### BackgroundSkillGrantTests.cs

```csharp
[TestFixture]
public class BackgroundSkillGrantTests
{
    [Test]
    public void Create_WithValidParameters_CreatesGrant();

    [Test]
    public void Create_WithNullSkillId_ThrowsArgumentException();

    [Test]
    public void Create_NormalizesSkillIdToLowercase();

    [Test]
    public void Permanent_CreatesPermanentGrant();

    [Test]
    public void IsPermanent_WithPermanentType_ReturnsTrue();

    [Test]
    public void ToString_FormatsCorrectly();
}
```

#### BackgroundDefinitionSkillGrantTests.cs

```csharp
[TestFixture]
public class BackgroundDefinitionSkillGrantTests
{
    [Test]
    public void Create_WithSkillGrants_StoresGrants();

    [Test]
    public void HasSkillGrants_WithGrants_ReturnsTrue();

    [Test]
    public void GetPrimarySkillGrant_ReturnsHighestBonus();

    [Test]
    public void GetSkillGrantSummary_FormatsCorrectly();

    [Test]
    public void VillageSmith_GrantsCraftPlus2MightPlus1();
}
```

---

## 11. Use Cases

### UC-001: Display Skill Grants During Background Selection

**Actor:** Character Creation UI  
**Flow:** Player views background → Get skill grants → Display formatted summary

### UC-002: Apply Skill Grants to Character

**Actor:** BackgroundApplicationService  
**Flow:** Background selected → Get skill grants → Apply each grant by type → Log results

### UC-003: Show Skill Source in Character Sheet

**Actor:** Character Sheet View  
**Flow:** Display skill → Check source → Show "Background: +2" tooltip

---

## 12. User Stories

### US-001: See Background Skills Before Selection

**As a** player creating a new character  
**I want to** see what skills each background grants  
**So that** I can choose a profession that complements my planned build

### US-002: Receive Professional Skill Training

**As a** player with a selected background  
**I want** my character to receive the appropriate skill bonuses  
**So that** my pre-Silence profession is mechanically meaningful

---

## 13. Deliverable Checklist

### Domain Layer

- [ ] `SkillGrantType.cs` enum created
- [ ] `BackgroundSkillGrant.cs` value object created
- [ ] `BackgroundDefinition.cs` extended with `SkillGrants`
- [ ] All types have complete XML documentation

### Configuration Files

- [ ] `config/backgrounds.json` extended with skill grants
- [ ] `config/schemas/backgrounds.schema.json` extended
- [ ] Configuration validates against schema

### Testing

- [ ] `SkillGrantTypeTests.cs` created
- [ ] `BackgroundSkillGrantTests.cs` created
- [ ] `BackgroundDefinitionSkillGrantTests.cs` created
- [ ] ~8 unit tests passing

---

## 14. Acceptance Criteria

### Functional

- [ ] `SkillGrantType` enum defines Permanent, StartingBonus, Proficiency
- [ ] `BackgroundSkillGrant.Create()` validates skillId and bonusAmount
- [ ] `BackgroundSkillGrant` normalizes skillId to lowercase
- [ ] `BackgroundDefinition.SkillGrants` returns skill grant collection
- [ ] Village Smith grants Craft +2 and Might +1
- [ ] All 6 backgrounds have exactly 2 skill grants defined
- [ ] `GetPrimarySkillGrant()` returns highest bonus grant
- [ ] `GetSkillGrantSummary()` formats grants as readable string

### Quality

- [ ] Build succeeds with 0 errors and 0 warnings
- [ ] ~8 unit tests pass
- [ ] Configuration validates against JSON schema
- [ ] All public types have XML documentation

---

## 15. Dependencies

### Required from Prior Versions

| Type                   | Location | Usage                  |
| ---------------------- | -------- | ---------------------- |
| `Background`           | v0.17.1a | Enum for background ID |
| `BackgroundDefinition` | v0.17.1a | Entity being extended  |

### Provides to v0.17.1c-e

| Type                   | Usage                             |
| ---------------------- | --------------------------------- |
| `BackgroundSkillGrant` | Referenced by application service |
| `SkillGrantType`       | Used in grant application logic   |

---

## 16. Future Considerations

### Deferred to v0.17.1c

- **BackgroundEquipmentGrant** value object
- **Equipment slot and quantity handling**

### Deferred to v0.17.1d-e

- **IBackgroundProvider** interface and implementation
- **IBackgroundApplicationService** for applying grants

### Out of Scope

- Additional grant types beyond the three defined
- Conditional skill grants based on lineage/archetype

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_  
_Author: AI Assistant_
