# v0.19.6 Biome Integration & Transitions - Scope Breakdown

**Version:** 0.19.6
**Theme:** Biome Integration & Transitions
**Prerequisites:** v0.19.5 (Alfheim & Asgard)
**Total Estimated Tests:** ~28 new tests

---

## Executive Summary

v0.19.6 completes the biome system by implementing transition zone generation, property interpolation between realms, sector assignment for dungeons, and route classification. This integration phase ties together all previous realm implementations into a cohesive system.

| Phase    | Name              | Focus                                                   | Est. Tests |
| -------- | ----------------- | ------------------------------------------------------- | ---------- |
| v0.19.6a | Biome Integration | Transitions, interpolation, sectors, routes, validation | ~28        |

---

## Feature Analysis & Categorization

| Feature                                | Complexity | Dependencies           | Assigned Phase |
| -------------------------------------- | ---------- | ---------------------- | -------------- |
| ITransitionZoneGenerator Interface     | High       | All realm configs      | **v0.19.6a**   |
| TransitionZoneGenerator Implementation | High       | BiomeDefinitions       | **v0.19.6a**   |
| Property Interpolation                 | High       | BiomeProperties        | **v0.19.6a**   |
| Sector Assignment Service              | Medium     | DungeonGenerator       | **v0.19.6a**   |
| Route Classification                   | Medium     | IBiomeAdjacencyService | **v0.19.6a**   |
| Biome Validation Service               | Medium     | All biome services     | **v0.19.6a**   |

---

## Phase Definitions

## v0.19.6a: Biome Integration & Transitions

### Scope

**In Scope:**

- `ITransitionZoneGenerator` interface
- `TransitionZoneGenerator` implementation
- Transition zone property interpolation (linear blend)
- Transition zone environmental condition handling
- `ISectorAssignmentService` interface and implementation
- Sector-to-biome mapping for dungeons
- `IRouteClassificationService` for travel routes
- Route safety classification (Safe, Moderate, Dangerous, Extreme)
- `IBiomeValidationService` for configuration validation
- Complete system integration tests

**Out of Scope:**

- Visual transition effects (UI concern)
- Dynamic biome generation (procedural content)
- Weather systems

### Key Deliverables

| Type            | Count | Details                                                                                                  |
| --------------- | ----- | -------------------------------------------------------------------------------------------------------- |
| Interfaces      | 4     | ITransitionZoneGenerator, ISectorAssignmentService, IRouteClassificationService, IBiomeValidationService |
| Implementations | 4     | Corresponding service implementations                                                                    |
| DTOs            | 3     | TransitionZone, RouteClassification, SectorBiomeAssignment                                               |
| Configuration   | 1     | routes.json (trade routes)                                                                               |
| Unit Tests      | ~28   |                                                                                                          |

### Acceptance Criteria

- [ ] Transition zones generate between compatible realms
- [ ] Property interpolation blends values correctly (50% blend)
- [ ] Incompatible realms refuse to generate transition
- [ ] Sector assignment maps dungeon sectors to biomes
- [ ] Route classification calculates safety correctly
- [ ] Validation service catches configuration errors
- [ ] All 9 realms integrate correctly
- [ ] ~28 unit tests pass

---

## Service Specifications

### ITransitionZoneGenerator

```csharp
public interface ITransitionZoneGenerator
{
    TransitionZone? GenerateTransition(RealmId fromRealm, RealmId toRealm);
    IReadOnlyList<TransitionZone> GenerateTransitionSequence(
        RealmId fromRealm, RealmId toRealm, int roomCount);
    BiomeProperties InterpolateProperties(
        BiomeProperties from, BiomeProperties to, float blend);
    bool CanGenerateTransition(RealmId fromRealm, RealmId toRealm);
}
```

### ISectorAssignmentService

```csharp
public interface ISectorAssignmentService
{
    SectorBiomeAssignment AssignBiome(int sectorNumber, int totalSectors);
    RealmId GetPrimaryRealmForSector(int sectorNumber);
    IReadOnlyList<SectorBiomeAssignment> GenerateAssignments(int totalSectors);
}
```

### IRouteClassificationService

```csharp
public interface IRouteClassificationService
{
    RouteClassification ClassifyRoute(RealmId fromRealm, RealmId toRealm);
    RouteSafety GetRouteSafety(RouteClassification classification);
    TimeSpan EstimateTravelTime(RealmId fromRealm, RealmId toRealm);
    IReadOnlyList<RouteClassification> GetAllRoutes();
}
```

### IBiomeValidationService

```csharp
public interface IBiomeValidationService
{
    ValidationResult ValidateAllBiomes();
    ValidationResult ValidateBiome(RealmId realmId);
    ValidationResult ValidateAdjacencyRules();
    ValidationResult ValidateZoneConfiguration(RealmId realmId);
}
```

---

## Transition Zone Mechanics

### Property Interpolation

Transition zones blend properties from adjacent realms:

```
Midgard (Temp: 18°C) → Vanaheim (Temp: 28°C)
Transition Zone: Temp = 18 + (28-18) * 0.5 = 23°C
```

| Property    | Midgard | Vanaheim | Transition (50%) |
| ----------- | ------- | -------- | ---------------- |
| Temperature | 18°C    | 28°C     | 23°C             |
| Aetheric    | 0.3     | 0.5      | 0.4              |
| Humidity    | 60%     | 85%      | 72%              |
| Light       | 0.7     | 0.6      | 0.65             |
| Scale       | 1.0     | 1.0      | 1.0              |
| Corrosion   | 0.2     | 0.4      | 0.3              |

### Transition Environmental Conditions

- **Compatible realms**: No condition in transition
- **RequiresTransition**: Blend conditions or use milder DC
- **Incompatible**: No transition possible

### Transition Room Count

| Compatibility      | Min Rooms | Max Rooms |
| ------------------ | --------- | --------- |
| Compatible         | 0         | 1         |
| RequiresTransition | 1         | 3         |
| Incompatible       | N/A       | N/A       |

---

## Sector Assignment

### Standard Dungeon Layout (9 Sectors)

```
Sector 1: Midgard (Entry)
Sector 2: Transition (Midgard → Secondary)
Sector 3: Secondary Realm
Sector 4: Secondary Realm (Deep)
Sector 5: Transition (Secondary → Tertiary)
Sector 6: Tertiary Realm
Sector 7: Tertiary Realm (Deep)
Sector 8: Transition (Tertiary → Boss)
Sector 9: Boss Realm
```

### Sector-to-Realm Flexibility

| Dungeon Type | Sector 1            | Sectors 2-8      | Sector 9   |
| ------------ | ------------------- | ---------------- | ---------- |
| Standard     | Midgard             | Varies           | Boss Realm |
| Elemental    | Muspelheim/Niflheim | Extreme          | Extreme    |
| Underdark    | Svartalfheim        | Dark realms      | Helheim    |
| Skyward      | Midgard             | Vanaheim/Alfheim | Asgard     |

---

## Route Classification

### Safety Levels

| Level     | Description                          | Environmental DC | Combat Modifier |
| --------- | ------------------------------------ | ---------------- | --------------- |
| Safe      | Well-traveled, no hazards            | None             | 0               |
| Moderate  | Some hazards, occasional combat      | DC 10            | +1              |
| Dangerous | Significant hazards, frequent combat | DC 14            | +2              |
| Extreme   | Severe hazards, constant threat      | DC 18            | +3              |

### Example Route Classifications

| From         | To           | Classification | Notes                        |
| ------------ | ------------ | -------------- | ---------------------------- |
| Midgard      | Vanaheim     | Moderate       | River routes, spore exposure |
| Svartalfheim | Helheim      | Dangerous      | Garm's Watch passage         |
| Muspelheim   | Svartalfheim | Dangerous      | Thermal hazards              |
| Alfheim      | Asgard       | Extreme        | Reality distortion + CPS     |

---

## Dependencies & Prerequisites

```
v0.19.5 (Alfheim & Asgard) - REQUIRED
v0.19.4 (Jötunheim & Vanaheim) - REQUIRED
v0.19.3 (Muspelheim & Niflheim) - REQUIRED
v0.19.2 (Svartalfheim & Helheim) - REQUIRED
v0.19.1 (Midgard) - REQUIRED
v0.19.0 (Core Infrastructure) - REQUIRED
    │
    └── All realm configurations loaded
            │
            ▼
v0.19.6 (Biome Integration)
    │
    ├── ITransitionZoneGenerator
    ├── ISectorAssignmentService
    ├── IRouteClassificationService
    └── IBiomeValidationService
            │
            ▼
v0.20.x (Room Templates & Dungeon Generation)
    │
    └── Uses biome system for content generation
```

---

## Risk Assessment

| Risk                          | Impact | Probability | Mitigation                         |
| ----------------------------- | ------ | ----------- | ---------------------------------- |
| Interpolation edge cases      | Medium | Medium      | Explicit handling for incompatible |
| Sector assignment complexity  | Medium | Low         | Default to Midgard-based dungeons  |
| Route calculation performance | Low    | Low         | Cache route calculations           |
| Validation false positives    | Medium | Medium      | Comprehensive test coverage        |

---

## Design Decisions (Confirmed)

| Decision                 | Value              | Notes                  |
| ------------------------ | ------------------ | ---------------------- |
| Interpolation method     | Linear (50% blend) | Simple and predictable |
| Default transition rooms | 1-3                | Based on adjacency     |
| Sector count             | 9 (standard)       | Matches Nine Realms    |
| Route caching            | Enabled            | Calculate once, reuse  |
| Validation on startup    | Optional           | Flag to enable         |

---

## Unit Testing Requirements (~28 tests)

### TransitionZoneGenerator Tests (~8)

- GenerateTransition returns valid zone for compatible realms
- GenerateTransition returns null for incompatible realms
- InterpolateProperties calculates correctly (50% blend)
- GenerateTransitionSequence returns correct count
- CanGenerateTransition returns false for Fire/Ice
- Transition zone has blended environmental condition
- Edge case: same realm returns null
- Edge case: transition room count respects limits

### SectorAssignmentService Tests (~6)

- AssignBiome returns Midgard for sector 1
- GenerateAssignments returns correct count
- GetPrimaryRealmForSector handles all 9 sectors
- Deep sectors get harder realms
- Boss sector assigned correctly
- Invalid sector throws exception

### RouteClassificationService Tests (~8)

- ClassifyRoute returns correct safety for all pairs
- Midgard-Vanaheim is Moderate
- Alfheim-Asgard is Extreme
- Muspelheim-Niflheim throws (incompatible)
- EstimateTravelTime returns positive duration
- GetAllRoutes returns all valid routes
- Route symmetry (A→B same as B→A)
- Self-route returns zero time

### BiomeValidationService Tests (~6)

- ValidateAllBiomes passes for good config
- ValidateBiome catches missing zones
- ValidateAdjacencyRules passes for default rules
- ValidateAdjacencyRules fails for invalid pair
- ValidateZoneConfiguration catches DC errors
- Validation result includes error messages

---

## Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│              v0.19.6 Biome Integration                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Integration Services                   │   │
│  │                                                          │   │
│  │  ┌──────────────────┐    ┌──────────────────┐          │   │
│  │  │  Transition Zone │    │     Sector       │          │   │
│  │  │    Generator     │    │   Assignment     │          │   │
│  │  │                  │    │    Service       │          │   │
│  │  │ • Interpolation  │    │ • Dungeon layout │          │   │
│  │  │ • Room count     │    │ • Biome mapping  │          │   │
│  │  │ • Compatibility  │    │ • Depth scaling  │          │   │
│  │  └──────────────────┘    └──────────────────┘          │   │
│  │                                                          │   │
│  │  ┌──────────────────┐    ┌──────────────────┐          │   │
│  │  │      Route       │    │      Biome       │          │   │
│  │  │  Classification  │    │   Validation     │          │   │
│  │  │    Service       │    │    Service       │          │   │
│  │  │                  │    │                  │          │   │
│  │  │ • Safety levels  │    │ • Config check   │          │   │
│  │  │ • Travel time    │    │ • Zone verify    │          │   │
│  │  │ • All routes     │    │ • Adjacency test │          │   │
│  │  └──────────────────┘    └──────────────────┘          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│                              ▼                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    All Nine Realms                       │   │
│  │                                                          │   │
│  │   Asgard ─── Alfheim ─── Vanaheim ─── Midgard           │   │
│  │      │         │           │            │                │   │
│  │      └─────────┼───────────┼────────────┤                │   │
│  │                │           │            │                │   │
│  │   Jötunheim ───┘           │    Svartalfheim            │   │
│  │      │                     │        │                    │   │
│  │      │              Niflheim    Helheim                  │   │
│  │      │                     │        │                    │   │
│  │      └────── Muspelheim ───┴────────┘                    │   │
│  │              (Fire ✗ Ice)                                │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## Deliverable Checklist

### Application Layer

- [ ] `ITransitionZoneGenerator` interface
- [ ] `TransitionZoneGenerator` implementation
- [ ] `ISectorAssignmentService` interface
- [ ] `SectorAssignmentService` implementation
- [ ] `IRouteClassificationService` interface
- [ ] `RouteClassificationService` implementation
- [ ] `IBiomeValidationService` interface
- [ ] `BiomeValidationService` implementation

### DTOs

- [ ] `TransitionZone` record
- [ ] `RouteClassification` record
- [ ] `SectorBiomeAssignment` record
- [ ] `ValidationResult` record

### Configuration

- [ ] `routes.json` with all valid routes

### Tests

- [ ] TransitionZoneGenerator tests (~8)
- [ ] SectorAssignmentService tests (~6)
- [ ] RouteClassificationService tests (~8)
- [ ] BiomeValidationService tests (~6)

---

## v0.19.x Completion Summary

With v0.19.6, the complete biome system is implemented:

| Version   | Focus                  | Realms | Tests    |
| --------- | ---------------------- | ------ | -------- |
| v0.19.0   | Core Infrastructure    | —      | ~20      |
| v0.19.1   | Midgard                | 1      | ~18      |
| v0.19.2   | Svartalfheim & Helheim | 2      | ~24      |
| v0.19.3   | Muspelheim & Niflheim  | 2      | ~24      |
| v0.19.4   | Jötunheim & Vanaheim   | 2      | ~22      |
| v0.19.5   | Alfheim & Asgard       | 2      | ~24      |
| v0.19.6   | Integration            | —      | ~28      |
| **Total** | **Complete System**    | **9**  | **~160** |

---

_This scope breakdown completes the v0.19.x biome system with full integration and transition mechanics._
