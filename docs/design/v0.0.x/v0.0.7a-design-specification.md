# v0.0.7a Design Specification: Core Equipment Infrastructure

**Version:** 0.0.7a
**Parent:** v0.0.7 (Equipment System)
**Prerequisites:** v0.0.6 Complete (Enhanced Combat System)
**Status:** Design Complete

---

## Table of Contents

1. [Overview](#overview)
2. [Scope](#scope)
3. [Data Model](#data-model)
4. [Services](#services)
5. [Command Changes](#command-changes)
6. [Rendering Changes](#rendering-changes)
7. [Configuration](#configuration)
8. [Acceptance Criteria](#acceptance-criteria)
9. [Test Specifications](#test-specifications)
10. [Dependencies](#dependencies)

---

## Overview

### Purpose

Establish the foundational equipment system that allows players to equip and unequip items into designated slots. This phase creates the core infrastructure that v0.0.7b (Weapons) and v0.0.7c (Armor) will build upon, including the equipment slot system, player equipment tracking, and basic equip/unequip commands.

### Key Changes

| Area | Current State (v0.0.6) | Target State (v0.0.7a) |
|------|------------------------|------------------------|
| Item Entity | Has `ItemType` enum (Weapon, Armor, etc.) | Adds `EquipmentSlot?` property |
| Player Entity | Has `Inventory` for item storage | Adds `Equipment` dictionary for equipped items |
| Commands | No equipment commands | `equip`, `unequip`, `equipment` commands |
| Item Display | Shows items in inventory | Shows equipped vs inventory items |

### Design Principles

1. **Separation of Concerns**: Equipment is separate from Inventory - equipped items are not in inventory
2. **Slot-Based System**: Each slot can hold exactly one item, preventing conflicts
3. **Type Safety**: Only items with matching `EquipmentSlot` can be equipped to that slot
4. **Extensibility**: Infrastructure supports future weapon dice, armor defense, and stat modifiers

---

## Scope

### In Scope

- `EquipmentSlot` enum (Weapon, Armor, Shield, Helmet, Boots, Ring, Amulet)
- `EquipmentSlot?` property on `Item` entity
- `Equipment` dictionary on `Player` entity
- `Equip()`, `Unequip()`, `GetEquippedItem()`, `IsSlotOccupied()` methods on `Player`
- `EquipmentService` for equip/unequip logic and validation
- `EquipCommand`, `UnequipCommand`, `EquipmentCommand`
- Equipment display rendering
- Basic validation (item has slot, slot not occupied)
- Update existing `Item.CreateSword()` factory to include equipment slot

### Out of Scope (Future Phases)

- Weapon damage dice (v0.0.7b)
- Combat integration (v0.0.7b)
- Armor defense bonuses (v0.0.7c)
- Stat modifiers from equipment (v0.0.7c)
- Equipment requirements (v0.0.7c)
- Two-handed weapons (future)
- Dual-wielding (future)

---

## Data Model

### New: EquipmentSlot (Enum)

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the equipment slots available for equipping items.
/// </summary>
/// <remarks>
/// Each slot can hold exactly one item at a time. Items must have a matching
/// EquipmentSlot property to be equipped to that slot.
/// </remarks>
public enum EquipmentSlot
{
    /// <summary>Primary weapon slot for swords, axes, daggers, staffs, etc.</summary>
    Weapon,

    /// <summary>Body armor slot for chest protection.</summary>
    Armor,

    /// <summary>Off-hand slot for shields or secondary items.</summary>
    Shield,

    /// <summary>Head protection slot for helmets, hoods, etc.</summary>
    Helmet,

    /// <summary>Footwear slot for boots, shoes, etc.</summary>
    Boots,

    /// <summary>Finger accessory slot for rings.</summary>
    Ring,

    /// <summary>Neck accessory slot for amulets, necklaces, etc.</summary>
    Amulet
}
```

### New: EquipResult (Value Object)

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the result of an equip or unequip operation.
/// </summary>
/// <param name="Success">Whether the operation succeeded.</param>
/// <param name="Message">A message describing the result.</param>
/// <param name="UnequippedItem">The item that was unequipped (if any).</param>
/// <param name="EquippedItem">The item that was equipped (if any).</param>
public readonly record struct EquipResult(
    bool Success,
    string Message,
    Item? UnequippedItem = null,
    Item? EquippedItem = null)
{
    /// <summary>
    /// Creates a successful equip result.
    /// </summary>
    public static EquipResult Equipped(Item item, Item? replaced = null) =>
        new(true, $"You equip the {item.Name}.", replaced, item);

    /// <summary>
    /// Creates a successful unequip result.
    /// </summary>
    public static EquipResult Unequipped(Item item) =>
        new(true, $"You unequip the {item.Name}.", item, null);

    /// <summary>
    /// Creates a failure result with the specified message.
    /// </summary>
    public static EquipResult Failure(string message) =>
        new(false, message, null, null);

    /// <summary>
    /// Creates a failure for item not found.
    /// </summary>
    public static EquipResult ItemNotFound(string itemName) =>
        Failure($"You don't have '{itemName}' in your inventory.");

    /// <summary>
    /// Creates a failure for item not equippable.
    /// </summary>
    public static EquipResult NotEquippable(Item item) =>
        Failure($"The {item.Name} cannot be equipped.");

    /// <summary>
    /// Creates a failure for slot empty.
    /// </summary>
    public static EquipResult SlotEmpty(EquipmentSlot slot) =>
        Failure($"Nothing is equipped in the {slot} slot.");

    /// <summary>
    /// Creates a failure for inventory full (can't unequip).
    /// </summary>
    public static EquipResult InventoryFull() =>
        Failure("Your inventory is full. Cannot unequip.");
}
```

### Modified: Item (Entity)

```csharp
// Add to existing Item entity:

/// <summary>
/// Gets the equipment slot this item can be equipped to, or null if not equippable.
/// </summary>
/// <remarks>
/// Items without an equipment slot (consumables, quest items, misc) cannot be equipped.
/// The slot determines which equipment position the item occupies when equipped.
/// </remarks>
public EquipmentSlot? EquipmentSlot { get; private set; }

/// <summary>
/// Gets whether this item can be equipped.
/// </summary>
public bool IsEquippable => EquipmentSlot.HasValue;

// Update constructor to accept equipment slot:
public Item(
    string name,
    string description,
    ItemType type,
    int value = 0,
    ItemEffect effect = ItemEffect.None,
    int effectValue = 0,
    int effectDuration = 0,
    EquipmentSlot? equipmentSlot = null)  // NEW parameter
{
    Id = Guid.NewGuid();
    Name = name ?? throw new ArgumentNullException(nameof(name));
    Description = description ?? throw new ArgumentNullException(nameof(description));
    Type = type;
    Value = value;
    Effect = effect;
    EffectValue = effectValue;
    EffectDuration = effectDuration;
    EquipmentSlot = equipmentSlot;  // NEW
}

// Update factory methods:
public static Item CreateSword() => new(
    "Rusty Sword",
    "An old sword covered in rust. Still sharp enough to cut.",
    ItemType.Weapon,
    value: 5,
    equipmentSlot: Enums.EquipmentSlot.Weapon  // NEW
);

// Add new factory methods for testing:
public static Item CreateLeatherArmor() => new(
    "Leather Armor",
    "Simple armor made of tanned leather. Provides basic protection.",
    ItemType.Armor,
    value: 15,
    equipmentSlot: Enums.EquipmentSlot.Armor
);

public static Item CreateWoodenShield() => new(
    "Wooden Shield",
    "A basic wooden shield. Better than nothing.",
    ItemType.Armor,
    value: 10,
    equipmentSlot: Enums.EquipmentSlot.Shield
);

public static Item CreateIronHelmet() => new(
    "Iron Helmet",
    "A sturdy iron helmet that protects your head.",
    ItemType.Armor,
    value: 20,
    equipmentSlot: Enums.EquipmentSlot.Helmet
);
```

### Modified: Player (Entity)

```csharp
// Add to existing Player entity:

/// <summary>
/// Gets the player's currently equipped items, keyed by equipment slot.
/// </summary>
/// <remarks>
/// Equipped items are separate from inventory. When an item is equipped,
/// it is removed from inventory. When unequipped, it returns to inventory.
/// </remarks>
public Dictionary<EquipmentSlot, Item> Equipment { get; private set; } = new();

/// <summary>
/// Gets the item equipped in the specified slot, or null if empty.
/// </summary>
/// <param name="slot">The equipment slot to check.</param>
/// <returns>The equipped item, or null if the slot is empty.</returns>
public Item? GetEquippedItem(EquipmentSlot slot)
{
    return Equipment.TryGetValue(slot, out var item) ? item : null;
}

/// <summary>
/// Checks whether the specified equipment slot is occupied.
/// </summary>
/// <param name="slot">The equipment slot to check.</param>
/// <returns>True if an item is equipped in the slot.</returns>
public bool IsSlotOccupied(EquipmentSlot slot)
{
    return Equipment.ContainsKey(slot);
}

/// <summary>
/// Equips an item to its designated slot.
/// </summary>
/// <param name="item">The item to equip.</param>
/// <returns>True if the item was equipped successfully.</returns>
/// <exception cref="ArgumentNullException">Thrown when item is null.</exception>
/// <exception cref="InvalidOperationException">Thrown when item has no equipment slot.</exception>
/// <remarks>
/// The item must have an EquipmentSlot defined. If the slot is already occupied,
/// the existing item is returned to inventory first (if space available).
/// </remarks>
public bool TryEquip(Item item)
{
    ArgumentNullException.ThrowIfNull(item);

    if (!item.EquipmentSlot.HasValue)
        throw new InvalidOperationException($"Item '{item.Name}' cannot be equipped (no equipment slot).");

    var slot = item.EquipmentSlot.Value;

    // If slot is occupied, cannot equip (use EquipmentService for swap logic)
    if (IsSlotOccupied(slot))
        return false;

    Equipment[slot] = item;
    return true;
}

/// <summary>
/// Unequips the item from the specified slot.
/// </summary>
/// <param name="slot">The slot to unequip from.</param>
/// <returns>The unequipped item, or null if the slot was empty.</returns>
public Item? Unequip(EquipmentSlot slot)
{
    if (Equipment.TryGetValue(slot, out var item))
    {
        Equipment.Remove(slot);
        return item;
    }
    return null;
}

/// <summary>
/// Gets all currently equipped items.
/// </summary>
/// <returns>A read-only collection of equipped items.</returns>
public IReadOnlyCollection<Item> GetAllEquippedItems()
{
    return Equipment.Values.ToList().AsReadOnly();
}

// Update constructors to initialize Equipment dictionary:
public Player(string name, Stats? stats = null)
{
    // ... existing code ...
    Equipment = new Dictionary<EquipmentSlot, Item>();
}

public Player(
    string name,
    string raceId,
    string backgroundId,
    PlayerAttributes attributes,
    string description = "",
    Stats? stats = null)
{
    // ... existing code ...
    Equipment = new Dictionary<EquipmentSlot, Item>();
}
```

---

## Services

### EquipmentService

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.Services;

/// <summary>
/// Service for managing player equipment operations.
/// </summary>
/// <remarks>
/// Handles the logic for equipping and unequipping items, including validation,
/// inventory management, and slot swapping. This service coordinates between
/// the player's equipment slots and inventory.
/// </remarks>
public class EquipmentService
{
    private readonly ILogger<EquipmentService> _logger;

    /// <summary>
    /// Creates a new EquipmentService instance.
    /// </summary>
    /// <param name="logger">The logger for equipment operations.</param>
    public EquipmentService(ILogger<EquipmentService> logger)
    {
        _logger = logger;
    }

    /// <summary>
    /// Attempts to equip an item from the player's inventory.
    /// </summary>
    /// <param name="player">The player equipping the item.</param>
    /// <param name="itemName">The name of the item to equip.</param>
    /// <returns>The result of the equip operation.</returns>
    /// <remarks>
    /// If the target slot is occupied, the existing item is automatically
    /// swapped back to inventory (if space available).
    /// </remarks>
    public EquipResult TryEquipByName(Player player, string itemName)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentException.ThrowIfNullOrWhiteSpace(itemName);

        _logger.LogDebug("Attempting to equip '{ItemName}' for player {Player}", itemName, player.Name);

        // Find item in inventory
        var item = player.Inventory.GetByName(itemName);
        if (item == null)
        {
            _logger.LogDebug("Item '{ItemName}' not found in inventory", itemName);
            return EquipResult.ItemNotFound(itemName);
        }

        return TryEquip(player, item);
    }

    /// <summary>
    /// Attempts to equip a specific item from the player's inventory.
    /// </summary>
    /// <param name="player">The player equipping the item.</param>
    /// <param name="item">The item to equip.</param>
    /// <returns>The result of the equip operation.</returns>
    public EquipResult TryEquip(Player player, Item item)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentNullException.ThrowIfNull(item);

        // Check if item is equippable
        if (!item.IsEquippable)
        {
            _logger.LogDebug("Item '{ItemName}' is not equippable", item.Name);
            return EquipResult.NotEquippable(item);
        }

        var slot = item.EquipmentSlot!.Value;
        Item? replacedItem = null;

        // Check if slot is occupied
        if (player.IsSlotOccupied(slot))
        {
            // Need to unequip current item first
            var currentItem = player.GetEquippedItem(slot)!;

            // Check if inventory has space for the current item
            if (player.Inventory.IsFull)
            {
                _logger.LogDebug("Cannot swap equipment - inventory is full");
                return EquipResult.InventoryFull();
            }

            // Unequip current item
            player.Unequip(slot);
            player.Inventory.TryAdd(currentItem);
            replacedItem = currentItem;

            _logger.LogDebug("Unequipped '{OldItem}' to make room for '{NewItem}'",
                currentItem.Name, item.Name);
        }

        // Remove item from inventory and equip it
        player.Inventory.Remove(item);
        player.TryEquip(item);

        _logger.LogInformation("Player {Player} equipped '{Item}' to {Slot} slot",
            player.Name, item.Name, slot);

        return EquipResult.Equipped(item, replacedItem);
    }

    /// <summary>
    /// Attempts to unequip an item from the specified slot.
    /// </summary>
    /// <param name="player">The player unequipping the item.</param>
    /// <param name="slot">The slot to unequip from.</param>
    /// <returns>The result of the unequip operation.</returns>
    public EquipResult TryUnequip(Player player, EquipmentSlot slot)
    {
        ArgumentNullException.ThrowIfNull(player);

        _logger.LogDebug("Attempting to unequip from {Slot} slot for player {Player}",
            slot, player.Name);

        // Check if slot has an item
        if (!player.IsSlotOccupied(slot))
        {
            _logger.LogDebug("Slot {Slot} is empty", slot);
            return EquipResult.SlotEmpty(slot);
        }

        // Check inventory space
        if (player.Inventory.IsFull)
        {
            _logger.LogDebug("Cannot unequip - inventory is full");
            return EquipResult.InventoryFull();
        }

        // Unequip and add to inventory
        var item = player.Unequip(slot)!;
        player.Inventory.TryAdd(item);

        _logger.LogInformation("Player {Player} unequipped '{Item}' from {Slot} slot",
            player.Name, item.Name, slot);

        return EquipResult.Unequipped(item);
    }

    /// <summary>
    /// Parses a slot name string to an EquipmentSlot enum value.
    /// </summary>
    /// <param name="slotName">The slot name to parse (case-insensitive).</param>
    /// <param name="slot">The parsed slot value.</param>
    /// <returns>True if parsing succeeded.</returns>
    public static bool TryParseSlot(string? slotName, out EquipmentSlot slot)
    {
        slot = default;

        if (string.IsNullOrWhiteSpace(slotName))
            return false;

        return Enum.TryParse(slotName, ignoreCase: true, out slot);
    }
}
```

### Service Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        EQUIP ITEM FLOW                                       │
└─────────────────────────────────────────────────────────────────────────────┘

    TryEquipByName(player, "Iron Sword")
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                    STEP 1: FIND ITEM IN INVENTORY                            │
├─────────────────────────────────────────────────────────────────────────────┤
│  player.Inventory.GetByName("Iron Sword")                                   │
│  ├── Found? Continue to Step 2                                              │
│  └── Not found? Return ItemNotFound result                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                    STEP 2: CHECK IF EQUIPPABLE                               │
├─────────────────────────────────────────────────────────────────────────────┤
│  item.IsEquippable (has EquipmentSlot?)                                     │
│  ├── Yes? Get slot, continue to Step 3                                      │
│  └── No? Return NotEquippable result                                        │
└─────────────────────────────────────────────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                    STEP 3: CHECK SLOT OCCUPANCY                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  player.IsSlotOccupied(slot)                                                │
│  ├── Yes? Go to Step 3a (swap)                                              │
│  └── No? Go to Step 4 (equip)                                               │
└─────────────────────────────────────────────────────────────────────────────┘
                    │
        ┌───────────┴───────────┐
        ▼                       ▼
┌───────────────────┐   ┌───────────────────────────────────────────────────┐
│   STEP 3a: SWAP   │   │                 STEP 4: EQUIP                      │
├───────────────────┤   ├───────────────────────────────────────────────────┤
│ Check inventory   │   │  1. player.Inventory.Remove(item)                 │
│ space for swap    │   │  2. player.TryEquip(item)                         │
│ ├── Full? Return  │   │  3. Return Equipped result                        │
│ │   InventoryFull │   └───────────────────────────────────────────────────┘
│ └── Space? Unequip│
│     current, add  │
│     to inventory, │
│     continue to 4 │
└───────────────────┘
```

---

## Command Changes

### New: EquipCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to equip an item from the player's inventory.
/// </summary>
/// <param name="ItemName">The name of the item to equip.</param>
public record EquipCommand(string ItemName) : GameCommand;
```

### New: UnequipCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to unequip an item from a specific equipment slot.
/// </summary>
/// <param name="Slot">The equipment slot to unequip from.</param>
public record UnequipCommand(EquipmentSlot Slot) : GameCommand;
```

### New: EquipmentCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to display the player's current equipment.
/// </summary>
public record EquipmentCommand : GameCommand;
```

### Command Parsing Updates

```csharp
// In ConsoleInputHandler.ParseCommand():

"equip" => ParseEquipCommand(argument),
"unequip" => ParseUnequipCommand(argument),
"equipment" or "eq" or "gear" => new EquipmentCommand(),

private GameCommand ParseEquipCommand(string? argument)
{
    if (string.IsNullOrWhiteSpace(argument))
    {
        return new InvalidCommand("Usage: equip <item name>");
    }
    return new EquipCommand(argument.Trim());
}

private GameCommand ParseUnequipCommand(string? argument)
{
    if (string.IsNullOrWhiteSpace(argument))
    {
        return new InvalidCommand("Usage: unequip <slot>\nSlots: weapon, armor, shield, helmet, boots, ring, amulet");
    }

    if (EquipmentService.TryParseSlot(argument.Trim(), out var slot))
    {
        return new UnequipCommand(slot);
    }

    return new InvalidCommand($"Unknown slot '{argument}'. Valid slots: weapon, armor, shield, helmet, boots, ring, amulet");
}
```

### User Commands

| Command | Description | Example |
|---------|-------------|---------|
| `equip <item>` | Equip an item from inventory | `equip Rusty Sword` |
| `unequip <slot>` | Remove equipment from a slot | `unequip weapon` |
| `equipment` | Show all equipped items | `equipment` |
| `eq` | Alias for equipment | `eq` |
| `gear` | Alias for equipment | `gear` |

---

## Rendering Changes

### IGameRenderer Additions

```csharp
/// <summary>
/// Renders the player's current equipment.
/// </summary>
/// <param name="equipment">The equipment data to display.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderEquipmentAsync(EquipmentSlotsDto equipment, CancellationToken ct = default);

/// <summary>
/// Renders the result of an equip or unequip operation.
/// </summary>
/// <param name="result">The equip result to display.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderEquipResultAsync(EquipResultDto result, CancellationToken ct = default);
```

### DTOs

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for displaying an equipped item.
/// </summary>
/// <param name="Slot">The equipment slot.</param>
/// <param name="ItemName">The name of the equipped item, or null if empty.</param>
/// <param name="ItemDescription">The description of the equipped item.</param>
public record EquippedItemDto(
    EquipmentSlot Slot,
    string? ItemName,
    string? ItemDescription);

/// <summary>
/// DTO for displaying all equipment slots.
/// </summary>
/// <param name="Slots">The list of all equipment slots with their items.</param>
public record EquipmentSlotsDto(IReadOnlyList<EquippedItemDto> Slots)
{
    /// <summary>
    /// Creates an EquipmentSlotsDto from a player's equipment.
    /// </summary>
    public static EquipmentSlotsDto FromPlayer(Player player)
    {
        var slots = Enum.GetValues<EquipmentSlot>()
            .Select(slot =>
            {
                var item = player.GetEquippedItem(slot);
                return new EquippedItemDto(
                    slot,
                    item?.Name,
                    item?.Description);
            })
            .ToList();

        return new EquipmentSlotsDto(slots);
    }
}

/// <summary>
/// DTO for displaying an equip/unequip result.
/// </summary>
/// <param name="Success">Whether the operation succeeded.</param>
/// <param name="Message">The result message.</param>
/// <param name="ReplacedItemName">Name of replaced item if swapped.</param>
public record EquipResultDto(
    bool Success,
    string Message,
    string? ReplacedItemName = null)
{
    /// <summary>
    /// Creates a DTO from an EquipResult.
    /// </summary>
    public static EquipResultDto FromResult(EquipResult result) =>
        new(result.Success, result.Message, result.UnequippedItem?.Name);
}
```

### Display Example

**Equipment Command:**
```
> equipment

╭─────────────────────────────────────────╮
│             ⚔ Equipment ⚔               │
├─────────────────────────────────────────┤
│  Weapon:  Rusty Sword                   │
│  Armor:   Leather Armor                 │
│  Shield:  (empty)                       │
│  Helmet:  (empty)                       │
│  Boots:   (empty)                       │
│  Ring:    (empty)                       │
│  Amulet:  (empty)                       │
╰─────────────────────────────────────────╯
```

**Equip Success:**
```
> equip Iron Shield

You equip the Iron Shield.
```

**Equip with Swap:**
```
> equip Steel Sword

You equip the Steel Sword.
(Rusty Sword returned to inventory)
```

**Equip Failure:**
```
> equip Health Potion

The Health Potion cannot be equipped.
```

**Unequip Success:**
```
> unequip weapon

You unequip the Rusty Sword.
```

**Unequip Failure:**
```
> unequip shield

Nothing is equipped in the Shield slot.
```

---

## Configuration

*No configuration files are required for v0.0.7a. Equipment definitions will be added in v0.0.7b (weapons.json) and v0.0.7c (armor.json).*

---

## Acceptance Criteria

### EquipmentSlot Enum
- [ ] `EquipmentSlot` enum contains all 7 slots: Weapon, Armor, Shield, Helmet, Boots, Ring, Amulet
- [ ] Enum values can be parsed from strings (case-insensitive)

### Item Entity
- [ ] Items have nullable `EquipmentSlot` property
- [ ] `IsEquippable` returns true only when `EquipmentSlot` has value
- [ ] `Item.CreateSword()` creates item with `EquipmentSlot.Weapon`
- [ ] Consumables and quest items have null `EquipmentSlot`

### Player Entity
- [ ] Player has `Equipment` dictionary initialized to empty
- [ ] `GetEquippedItem()` returns item or null
- [ ] `IsSlotOccupied()` correctly reports slot status
- [ ] `TryEquip()` adds item to equipment
- [ ] `TryEquip()` throws if item has no equipment slot
- [ ] `Unequip()` removes and returns item from slot
- [ ] `GetAllEquippedItems()` returns all equipped items

### EquipmentService
- [ ] `TryEquipByName()` finds item in inventory and equips it
- [ ] `TryEquipByName()` returns failure if item not in inventory
- [ ] `TryEquip()` returns failure if item not equippable
- [ ] `TryEquip()` removes item from inventory when equipped
- [ ] `TryEquip()` swaps items if slot occupied (returns old to inventory)
- [ ] `TryEquip()` fails if inventory full during swap
- [ ] `TryUnequip()` removes item and adds to inventory
- [ ] `TryUnequip()` fails if slot is empty
- [ ] `TryUnequip()` fails if inventory is full

### Commands
- [ ] `equip <item>` equips item from inventory
- [ ] `unequip <slot>` unequips item to inventory
- [ ] `equipment` shows all slots with items or "(empty)"
- [ ] Invalid commands show helpful error messages

### General
- [ ] ~18 unit tests pass
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings

---

## Test Specifications

### Unit Tests (~18 tests)

#### EquipmentSlotTests.cs
```csharp
[TestFixture]
public class EquipmentSlotTests
{
    [Test]
    public void EquipmentSlot_ContainsAllExpectedValues();

    [Test]
    public void TryParseSlot_ValidSlotName_ReturnsTrue();

    [Test]
    public void TryParseSlot_InvalidSlotName_ReturnsFalse();

    [Test]
    public void TryParseSlot_CaseInsensitive_ReturnsTrue();
}
```

#### ItemEquipmentTests.cs
```csharp
[TestFixture]
public class ItemEquipmentTests
{
    [Test]
    public void CreateSword_HasWeaponEquipmentSlot();

    [Test]
    public void CreateHealthPotion_HasNoEquipmentSlot();

    [Test]
    public void IsEquippable_WithSlot_ReturnsTrue();

    [Test]
    public void IsEquippable_WithoutSlot_ReturnsFalse();
}
```

#### PlayerEquipmentTests.cs
```csharp
[TestFixture]
public class PlayerEquipmentTests
{
    [Test]
    public void NewPlayer_HasEmptyEquipment();

    [Test]
    public void TryEquip_ValidItem_AddsToEquipment();

    [Test]
    public void TryEquip_ItemWithoutSlot_ThrowsException();

    [Test]
    public void TryEquip_SlotOccupied_ReturnsFalse();

    [Test]
    public void Unequip_OccupiedSlot_ReturnsItem();

    [Test]
    public void Unequip_EmptySlot_ReturnsNull();

    [Test]
    public void GetEquippedItem_OccupiedSlot_ReturnsItem();

    [Test]
    public void GetEquippedItem_EmptySlot_ReturnsNull();

    [Test]
    public void IsSlotOccupied_WithItem_ReturnsTrue();

    [Test]
    public void IsSlotOccupied_Empty_ReturnsFalse();
}
```

#### EquipmentServiceTests.cs
```csharp
[TestFixture]
public class EquipmentServiceTests
{
    [Test]
    public void TryEquipByName_ItemInInventory_EquipsItem();

    [Test]
    public void TryEquipByName_ItemNotInInventory_ReturnsFailure();

    [Test]
    public void TryEquip_RemovesItemFromInventory();

    [Test]
    public void TryEquip_SlotOccupied_SwapsItems();

    [Test]
    public void TryEquip_InventoryFullDuringSwap_ReturnsFailure();

    [Test]
    public void TryUnequip_AddsItemToInventory();

    [Test]
    public void TryUnequip_EmptySlot_ReturnsFailure();

    [Test]
    public void TryUnequip_InventoryFull_ReturnsFailure();
}
```

---

## Dependencies

### Required from Previous Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `Item` | `Domain/Entities/Item.cs` | Extended with EquipmentSlot property |
| `Player` | `Domain/Entities/Player.cs` | Extended with Equipment dictionary |
| `Inventory` | `Domain/Entities/Inventory.cs` | Used for item storage and retrieval |
| `ItemType` | `Domain/Enums/ItemType.cs` | Existing enum (Weapon, Armor, etc.) |
| `GameCommand` | `Application/Commands/GameCommand.cs` | Base class for commands |

### Provides to v0.0.7b

| Type | Usage |
|------|-------|
| `EquipmentSlot` | Weapon system uses Weapon slot |
| `Player.GetEquippedItem()` | Combat checks equipped weapon for damage dice |
| `EquipmentService` | Extended for weapon-specific logic |

### Provides to v0.0.7c

| Type | Usage |
|------|-------|
| `EquipmentSlot` | Armor uses Armor, Shield, Helmet, Boots slots |
| `Player.Equipment` | Armor bonuses calculated from equipped items |
| `EquipmentService` | Extended with requirement validation |

---

## Files Summary

### Files to Create (New)

| File | Purpose |
|------|---------|
| `src/Core/RuneAndRust.Domain/Enums/EquipmentSlot.cs` | Equipment slot enum |
| `src/Core/RuneAndRust.Domain/ValueObjects/EquipResult.cs` | Equip operation result |
| `src/Core/RuneAndRust.Domain/Services/EquipmentService.cs` | Equipment service |
| `src/Core/RuneAndRust.Application/DTOs/EquipmentDtos.cs` | Equipment DTOs |
| `tests/RuneAndRust.Domain.UnitTests/Enums/EquipmentSlotTests.cs` | Enum tests |
| `tests/RuneAndRust.Domain.UnitTests/Services/EquipmentServiceTests.cs` | Service tests |

### Files to Modify

| File | Changes |
|------|---------|
| `src/Core/RuneAndRust.Domain/Entities/Item.cs` | Add EquipmentSlot property, update factories |
| `src/Core/RuneAndRust.Domain/Entities/Player.cs` | Add Equipment dictionary and methods |
| `src/Core/RuneAndRust.Application/Interfaces/IInputHandler.cs` | Add equip/unequip command types |
| `src/Presentation/RuneAndRust.Presentation.Tui/Adapters/ConsoleInputHandler.cs` | Parse equip/unequip commands |
| `src/Core/RuneAndRust.Application/Interfaces/IGameRenderer.cs` | Add equipment render methods |
| `src/Presentation/RuneAndRust.Presentation.Tui/Adapters/SpectreGameRenderer.cs` | Implement equipment rendering |
| `src/Core/RuneAndRust.Application/Services/GameSessionService.cs` | Handle equipment commands |
| `tests/RuneAndRust.Domain.UnitTests/Entities/ItemTests.cs` | Add equipment slot tests |
| `tests/RuneAndRust.Domain.UnitTests/Entities/PlayerTests.cs` | Add equipment tests |

---

*This design specification provides the detailed blueprint for implementing v0.0.7a Core Equipment Infrastructure. This phase establishes the foundation that v0.0.7b (Weapon System) and v0.0.7c (Armor & Requirements) will build upon.*
