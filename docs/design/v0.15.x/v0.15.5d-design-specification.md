# v0.15.5d Design Specification: Navigation System

**Version:** 0.15.5d
**Theme:** Navigation System
**Author:** Claude
**Created:** 2026-01-18
**Status:** Draft
**Prerequisites:** v0.15.5a Complete (Extended Tracking System), v0.15.5b Complete (Counter-Tracking System), v0.15.5c Complete (Foraging System)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
   - 3.1 [Navigation Flow Diagram](#31-navigation-flow-diagram)
   - 3.2 [Failure Consequence Flow](#32-failure-consequence-flow)
   - 3.3 [Service Interaction Diagram](#33-service-interaction-diagram)
   - 3.4 [Layer Architecture](#34-layer-architecture)
4. [TerrainType Enum](#4-terraintype-enum)
5. [NavigationContext Value Object](#5-navigationcontext-value-object)
6. [NavigationResult Value Object](#6-navigationresult-value-object)
7. [NavigationService Implementation](#7-navigationservice-implementation)
8. [Navigation Modifiers](#8-navigation-modifiers)
9. [Navigation Failure Consequences](#9-navigation-failure-consequences)
10. [Data Model Changes](#10-data-model-changes)
11. [Configuration Files](#11-configuration-files)
    - 11.1 [terrain-types.json](#111-terrain-typesjson)
    - 11.2 [terrain-types.schema.json](#112-terrain-typesschemajson)
    - 11.3 [Configuration Schema Summary](#113-configuration-schema-summary)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)
19. [Document Metadata](#19-document-metadata)

---

## 1. Executive Summary

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.5d, the Navigation System. This phase implements terrain-based navigation mechanics for the Wasteland Survival skill, enabling characters to traverse the post-collapse landscape with varying degrees of difficulty based on terrain complexity, equipment, and environmental conditions.

Navigation in Aethelgard represents the essential survival skill of finding one's way through the treacherous ruins and wastes. The system accounts for terrain difficulty, equipment bonuses from compasses and maps, familiarity with regions, and environmental hazards like static storms. Failure results in time penalties and potential encounters with dangerous areas.

The system supports five terrain types ranging from open wasteland to glitch-corrupted labyrinths, with modifiers for visibility, equipment, and familiarity.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Enums** | `TerrainType` |
| **Value Objects** | `NavigationContext`, `NavigationResult` |
| **Services** | `INavigationService`, `NavigationService` |
| **Configuration** | `terrain-types.json` |
| **Tests** | ~2 new unit tests |

### 1.3 Architectural Significance

This version establishes the **terrain-based DC resolution pattern** that will be reused for other environmental mechanics:

- **Terrain-based DCs**: Different terrain types impose different base difficulties
- **Cumulative modifiers**: Equipment, familiarity, and conditions stack additively
- **Failure escalation**: Standard failures waste time, fumbles create dangerous situations
- **Environmental integration**: Weather and visibility affect navigation difficulty

---

## 2. Feature Overview

```
v0.15.5d Navigation System
├── Terrain Types
│   ├── OpenWasteland (DC 8)
│   ├── ModerateRuins (DC 12)
│   ├── DenseRuins (DC 16)
│   ├── Labyrinthine (DC 20)
│   └── GlitchedLabyrinth (DC 24)
├── Navigation Context
│   ├── TerrainType (current terrain)
│   ├── Destination (target location)
│   ├── HasCompass (working compass +1d10)
│   ├── FamiliarTerritory (known area +2d10)
│   └── WeatherConditions (visibility modifiers)
├── Navigation Modifiers
│   ├── Good visibility (+1d10)
│   ├── Night without light (-2d10)
│   ├── Static Storm (-4d10)
│   ├── Working compass (+1d10)
│   └── Familiar territory (+2d10)
├── Navigation Result
│   ├── Success (reached destination)
│   ├── PartialSuccess (reached with delay)
│   ├── Failure (got lost, time penalty)
│   └── Fumble (entered dangerous area)
└── Unit Tests (~2)
```

---

## 3. Architecture Diagrams

### 3.1 Navigation Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         NAVIGATION FLOW DIAGRAM                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    Player initiates navigation                                               │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    BUILD NAVIGATION CONTEXT                          │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  • Determine TerrainType from current location                       │  │
│    │  • Set Destination from player input                                 │  │
│    │  • Check inventory for working compass                               │  │
│    │  • Check if territory is familiar (previously visited)               │  │
│    │  • Get current weather conditions                                    │  │
│    └─────────────────────────────────────────────────────────────────────┘  │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    CALCULATE NAVIGATION DC                           │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  Base DC = TerrainType.BaseDc                                        │
│    │                                                                      │
│    │  TerrainType DCs:                                                    │
│    │  ├── OpenWasteland     = DC 8                                        │
│    │  ├── ModerateRuins     = DC 12                                       │
│    │  ├── DenseRuins        = DC 16                                       │
│    │  ├── Labyrinthine      = DC 20                                       │
│    │  └── GlitchedLabyrinth = DC 24                                       │
│    └─────────────────────────────────────────────────────────────────────┘  │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    CALCULATE DICE MODIFIERS                          │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  Base Pool = Character's Wasteland Survival dice                     │
│    │                                                                      │
│    │  Positive Modifiers:                                                 │
│    │  ├── Good visibility      = +1d10                                    │
│    │  ├── Working compass      = +1d10                                    │
│    │  └── Familiar territory   = +2d10                                    │
│    │                                                                      │
│    │  Negative Modifiers:                                                 │
│    │  ├── Night (no light)     = -2d10                                    │
│    │  └── Static Storm         = -4d10                                    │
│    │                                                                      │
│    │  Final Pool = Base + Σ(modifiers), minimum 1d10                      │
│    └─────────────────────────────────────────────────────────────────────┘  │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    PERFORM SKILL CHECK                               │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │  Roll dice pool (success-counting: 8-10 = success, 1 = botch)        │
│    │  Net Successes = Successes - Botches (minimum 0)                     │
│    │                                                                      │
│    │  Check for Fumble: 0 successes AND ≥1 botch                          │
│    │  Check for Critical: Net Successes ≥ 5                               │
│    └─────────────────────────────────────────────────────────────────────┘  │
│           │                                                                  │
│           ├─────────────────────┬─────────────────────┬─────────────────┐   │
│           ▼                     ▼                     ▼                 ▼   │
│    ┌───────────────┐     ┌───────────────┐     ┌───────────────┐     ┌────┐│
│    │   SUCCESS     │     │   PARTIAL     │     │   FAILURE     │     │FMBL││
│    │  Net ≥ DC     │     │ Net ≥ DC-2    │     │  Net < DC-2   │     │0+B ││
│    ├───────────────┤     ├───────────────┤     ├───────────────┤     ├────┤│
│    │ Reach dest    │     │ Reach dest    │     │ Got lost      │     │Dngr││
│    │ on time       │     │ +25% time     │     │ +50% time     │     │area││
│    │               │     │               │     │ Must retry    │     │    ││
│    └───────────────┘     └───────────────┘     └───────────────┘     └────┘│
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Failure Consequence Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      NAVIGATION FAILURE CONSEQUENCES                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    Navigation Check Failed                                                   │
│           │                                                                  │
│           ├─────────────────────────────────┐                               │
│           ▼                                 ▼                               │
│    ┌─────────────────────────┐       ┌─────────────────────────┐            │
│    │    STANDARD FAILURE     │       │       FUMBLE            │            │
│    │   (Net < DC-2, no botch)│       │ (0 successes + ≥1 botch)│            │
│    └───────────┬─────────────┘       └───────────┬─────────────┘            │
│                │                                 │                          │
│                ▼                                 ▼                          │
│    ┌─────────────────────────┐       ┌─────────────────────────┐            │
│    │      GOT LOST           │       │    DANGEROUS AREA       │            │
│    ├─────────────────────────┤       ├─────────────────────────┤            │
│    │ Effects:                │       │ Effects:                │            │
│    │ • +50% travel time      │       │ • Enter hazardous zone  │            │
│    │ • Must attempt again    │       │ • Possible encounter    │            │
│    │ • Same DC applies       │       │ • Environmental hazard  │            │
│    │ • No resource loss      │       │ • Cannot retry easily   │            │
│    └─────────────────────────┘       └───────────┬─────────────┘            │
│                                                  │                          │
│                                                  ▼                          │
│                                      ┌─────────────────────────┐            │
│                                      │   DANGEROUS AREA TABLE  │            │
│                                      ├─────────────────────────┤            │
│                                      │ Roll d6:                │            │
│                                      │ 1-2: Hazard encounter   │            │
│                                      │ 3-4: Hostile territory  │            │
│                                      │ 5-6: Glitch pocket      │            │
│                                      └─────────────────────────┘            │
│                                                                              │
│  TIME PENALTIES:                                                            │
│  ─────────────────────────────────────────────────────────────────────      │
│  │ Outcome        │ Time Modifier │ Example (4 hour trip)    │             │
│  │────────────────│───────────────│──────────────────────────│             │
│  │ Success        │ ×1.0          │ 4 hours                  │             │
│  │ Partial Success│ ×1.25         │ 5 hours                  │             │
│  │ Failure        │ ×1.5          │ 6 hours (+ retry)        │             │
│  │ Fumble         │ Variable      │ Lost + danger            │             │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Interaction Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SERVICE INTERACTION DIAGRAM                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                      COMMAND HANDLER                                 │   │
│   │               (NavigationCommandHandler)                             │   │
│   └─────────────────────────────────┬───────────────────────────────────┘   │
│                                     │                                        │
│                           validates & builds context                        │
│                                     │                                        │
│                                     ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                    NAVIGATION SERVICE                                │   │
│   │                     (INavigationService)                             │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  + AttemptNavigation(player, navigationContext)                      │   │
│   │  + CanNavigate(player, navigationContext)                            │   │
│   │  + GetNavigationBlockedReason(player, navigationContext)             │   │
│   │  + CalculateBaseDc(terrainType)                                      │   │
│   │  + CalculateDiceModifiers(navigationContext)                         │   │
│   └──────────┬──────────────────────────┬───────────────────────────────┘   │
│              │                          │                                    │
│    performs check              creates consequence                          │
│              │                          │                                    │
│              ▼                          ▼                                    │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │   SKILL CHECK SERVICE   │  │ FUMBLE CONSEQUENCE SVC  │                  │
│   │   (ISkillCheckService)  │  │ (IFumbleConsequenceSvc) │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ + PerformCheckWithDC()  │  │ + CreateConsequence()   │                  │
│   │ + CalculateDicePool()   │  │ + HasActiveConsequence()│                  │
│   └──────────┬──────────────┘  └─────────────────────────┘                  │
│              │                                                               │
│       rolls dice                                                            │
│              │                                                               │
│              ▼                                                               │
│   ┌─────────────────────────┐                                               │
│   │     DICE SERVICE        │                                               │
│   │     (IDiceService)      │                                               │
│   ├─────────────────────────┤                                               │
│   │ + RollPool(count)       │                                               │
│   │ + CountSuccesses()      │                                               │
│   └─────────────────────────┘                                               │
│                                                                              │
│   Additional Dependencies:                                                  │
│   ─────────────────────────────────────────────────────────────────────    │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │  LOCATION SERVICE       │  │   WEATHER SERVICE       │                  │
│   │  (ILocationService)     │  │   (IWeatherService)     │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ + GetTerrainType()      │  │ + GetCurrentConditions()│                  │
│   │ + IsFamiliarTerritory() │  │ + GetVisibilityModifier│                  │
│   │ + GetDestination()      │  │ + IsStaticStorm()       │                  │
│   └─────────────────────────┘  └─────────────────────────┘                  │
│                                                                              │
│   Data Flow:                                                                │
│   ─────────────────────────────────────────────────────────────────────    │
│   1. CommandHandler validates destination & creates NavigationContext       │
│   2. NavigationService.AttemptNavigation() orchestrates the attempt         │
│   3. NavigationContext.ToSkillContext() converts navigation-specific data   │
│   4. SkillCheckService executes the check via DiceService                   │
│   5. On fumble: FumbleConsequenceService creates DangerousArea consequence  │
│   6. On failure: Time penalty calculated and applied                        │
│   7. NavigationResult returned with outcome, time modifier, and any hazards │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Enums/                                                              │    │
│  │  ├── TerrainType.cs                                                  │    │
│  │  │   └── OpenWasteland, ModerateRuins, DenseRuins,                  │    │
│  │  │       Labyrinthine, GlitchedLabyrinth                            │    │
│  │  │                                                                   │    │
│  │  ValueObjects/                                                       │    │
│  │  ├── NavigationContext.cs                                           │    │
│  │  │   └── TerrainType, Destination, HasCompass,                      │    │
│  │  │       FamiliarTerritory, WeatherConditions                       │    │
│  │  │                                                                   │    │
│  │  └── NavigationResult.cs                                            │    │
│  │      └── Outcome, TimeModifier, NetSuccesses, HazardEncountered,    │    │
│  │          DangerousAreaType                                          │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                         │    │
│  │  └── INavigationService.cs                                          │    │
│  │      ├── AttemptNavigation(player, context)                         │    │
│  │      ├── CanNavigate(player, context)                               │    │
│  │      ├── GetNavigationBlockedReason(player, context)                │    │
│  │      ├── CalculateBaseDc(terrainType)                               │    │
│  │      └── CalculateDiceModifiers(context)                            │    │
│  │                                                                      │    │
│  │  Services/                                                           │    │
│  │  └── NavigationService.cs                                           │    │
│  │      └── Implements INavigationService                              │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   INFRASTRUCTURE LAYER                               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  config/                                                             │    │
│  │  ├── terrain-types.json                                             │    │
│  │  │   └── Terrain definitions, base DCs, descriptions                │    │
│  │  │                                                                   │    │
│  │  └── schemas/                                                        │    │
│  │      └── terrain-types.schema.json                                  │    │
│  │          └── JSON Schema validation                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. TerrainType Enum

### 4.1 Purpose

The `TerrainType` enum defines the five categories of terrain that affect navigation difficulty. Each terrain type has a base DC that reflects the complexity and hazards of traversing that environment.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/TerrainType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the terrain types that affect navigation difficulty in the Wasteland Survival system.
/// </summary>
/// <remarks>
/// Terrain types establish the base DC for navigation checks. More complex terrain requires
/// higher skill to traverse without getting lost. The DCs follow a progression:
/// - Open areas: Easy to navigate, few obstacles
/// - Ruins: Increasing structural complexity and blocked paths
/// - Labyrinths: Maze-like structures requiring careful navigation
/// - Glitched: Reality-warped areas where directions shift unpredictably
/// </remarks>
public enum TerrainType
{
    /// <summary>
    /// Open wasteland with clear sightlines and few obstacles.
    /// Base DC: 8 - Easy navigation, landmarks visible at distance.
    /// </summary>
    OpenWasteland = 0,

    /// <summary>
    /// Partially collapsed structures with navigable paths.
    /// Base DC: 12 - Moderate difficulty, some route-finding required.
    /// </summary>
    ModerateRuins = 1,

    /// <summary>
    /// Heavily damaged urban areas with many blocked routes.
    /// Base DC: 16 - Challenging navigation, frequent dead ends.
    /// </summary>
    DenseRuins = 2,

    /// <summary>
    /// Maze-like structures requiring careful path tracking.
    /// Base DC: 20 - Difficult navigation, easy to get turned around.
    /// </summary>
    Labyrinthine = 3,

    /// <summary>
    /// Glitch-corrupted labyrinth where paths shift and reality warps.
    /// Base DC: 24 - Extreme difficulty, compass unreliable, landmarks change.
    /// </summary>
    GlitchedLabyrinth = 4
}
```

### 4.3 Terrain Type Summary Table

| TerrainType | Value | Base DC | Description |
|-------------|-------|---------|-------------|
| `OpenWasteland` | 0 | 8 | Clear sightlines, few obstacles, landmarks visible |
| `ModerateRuins` | 1 | 12 | Partially collapsed, navigable paths exist |
| `DenseRuins` | 2 | 16 | Heavily damaged, many blocked routes |
| `Labyrinthine` | 3 | 20 | Maze-like, easy to get turned around |
| `GlitchedLabyrinth` | 4 | 24 | Reality-warped, paths shift unpredictably |

---

## 5. NavigationContext Value Object

### 5.1 Purpose

The `NavigationContext` value object encapsulates all contextual information needed to perform a navigation check, including terrain type, destination, equipment status, territory familiarity, and weather conditions.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/NavigationContext.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Encapsulates the context for a navigation attempt in the Wasteland Survival system.
/// </summary>
/// <remarks>
/// NavigationContext captures all factors that affect navigation difficulty:
/// - Terrain type determines base DC
/// - Equipment (compass) provides dice bonuses
/// - Familiarity with territory provides significant advantage
/// - Weather conditions can impose penalties
///
/// This value object is immutable and can be converted to a SkillContext for
/// integration with the skill check system.
/// </remarks>
/// <param name="TerrainType">The type of terrain being navigated.</param>
/// <param name="Destination">The target location identifier.</param>
/// <param name="HasCompass">Whether the character has a working compass (+1d10).</param>
/// <param name="FamiliarTerritory">Whether the character knows this area (+2d10).</param>
/// <param name="WeatherConditions">Current weather affecting visibility.</param>
public readonly record struct NavigationContext(
    TerrainType TerrainType,
    string Destination,
    bool HasCompass,
    bool FamiliarTerritory,
    WeatherCondition WeatherConditions)
{
    /// <summary>
    /// Gets the base difficulty class for this terrain type.
    /// </summary>
    public int BaseDc => TerrainType switch
    {
        TerrainType.OpenWasteland => 8,
        TerrainType.ModerateRuins => 12,
        TerrainType.DenseRuins => 16,
        TerrainType.Labyrinthine => 20,
        TerrainType.GlitchedLabyrinth => 24,
        _ => 12 // Default to moderate if unknown
    };

    /// <summary>
    /// Gets the total dice modifier from all contextual factors.
    /// </summary>
    /// <remarks>
    /// Modifiers stack additively:
    /// - Working compass: +1d10
    /// - Familiar territory: +2d10
    /// - Good visibility: +1d10
    /// - Night (no light): -2d10
    /// - Static Storm: -4d10
    ///
    /// Note: Compass provides no benefit in GlitchedLabyrinth terrain.
    /// </remarks>
    public int TotalDiceModifier
    {
        get
        {
            int modifier = 0;

            // Compass bonus (not effective in glitched areas)
            if (HasCompass && TerrainType != TerrainType.GlitchedLabyrinth)
            {
                modifier += 1;
            }

            // Familiar territory bonus
            if (FamiliarTerritory)
            {
                modifier += 2;
            }

            // Weather modifiers
            modifier += WeatherConditions switch
            {
                WeatherCondition.Clear => 1,      // Good visibility
                WeatherCondition.Overcast => 0,   // Normal visibility
                WeatherCondition.Night => -2,     // Night without light
                WeatherCondition.StaticStorm => -4, // Static storm
                _ => 0
            };

            return modifier;
        }
    }

    /// <summary>
    /// Gets whether the compass is effective in this context.
    /// </summary>
    /// <remarks>
    /// Compasses do not function properly in glitch-corrupted areas due to
    /// reality distortions affecting magnetic fields.
    /// </remarks>
    public bool CompassEffective => HasCompass && TerrainType != TerrainType.GlitchedLabyrinth;

    /// <summary>
    /// Creates a display string describing the navigation context.
    /// </summary>
    public string ToDisplayString()
    {
        var parts = new List<string>
        {
            $"Terrain: {TerrainType} (DC {BaseDc})",
            $"Destination: {Destination}"
        };

        if (HasCompass)
        {
            parts.Add(CompassEffective ? "Compass: +1d10" : "Compass: Ineffective (glitched area)");
        }

        if (FamiliarTerritory)
        {
            parts.Add("Familiar Territory: +2d10");
        }

        parts.Add($"Weather: {WeatherConditions} ({GetWeatherModifierString()})");

        return string.Join(" | ", parts);
    }

    private string GetWeatherModifierString()
    {
        return WeatherConditions switch
        {
            WeatherCondition.Clear => "+1d10",
            WeatherCondition.Overcast => "+0",
            WeatherCondition.Night => "-2d10",
            WeatherCondition.StaticStorm => "-4d10",
            _ => "+0"
        };
    }
}
```

### 5.3 WeatherCondition Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/WeatherCondition.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines weather conditions that affect navigation and visibility.
/// </summary>
public enum WeatherCondition
{
    /// <summary>
    /// Clear conditions with good visibility (+1d10 to navigation).
    /// </summary>
    Clear = 0,

    /// <summary>
    /// Overcast or hazy conditions with normal visibility (+0).
    /// </summary>
    Overcast = 1,

    /// <summary>
    /// Nighttime without artificial light sources (-2d10 to navigation).
    /// </summary>
    Night = 2,

    /// <summary>
    /// Static storm with severe visibility reduction and interference (-4d10).
    /// </summary>
    StaticStorm = 3
}
```

---

## 6. NavigationResult Value Object

### 6.1 Purpose

The `NavigationResult` value object encapsulates the outcome of a navigation attempt, including the success level, time modifier, and any hazards encountered.

### 6.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/NavigationResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the outcome of a navigation attempt.
/// </summary>
/// <remarks>
/// NavigationResult captures all aspects of a navigation check outcome:
/// - Success level determines whether destination was reached
/// - Time modifier reflects delays from getting lost or finding shortcuts
/// - Hazard information captures dangerous area encounters on fumbles
/// </remarks>
/// <param name="Outcome">The navigation outcome (Success, PartialSuccess, Failure, Fumble).</param>
/// <param name="TimeModifier">Multiplier applied to travel time (1.0 = normal, 1.5 = lost).</param>
/// <param name="NetSuccesses">The net successes from the skill check.</param>
/// <param name="TargetDc">The DC that was attempted.</param>
/// <param name="HazardEncountered">Whether a hazard was encountered (fumble only).</param>
/// <param name="DangerousAreaType">The type of dangerous area entered (fumble only).</param>
public readonly record struct NavigationResult(
    NavigationOutcome Outcome,
    float TimeModifier,
    int NetSuccesses,
    int TargetDc,
    bool HazardEncountered,
    DangerousAreaType? DangerousAreaType)
{
    /// <summary>
    /// Gets whether navigation was successful (reached destination).
    /// </summary>
    public bool ReachedDestination => Outcome is NavigationOutcome.Success or NavigationOutcome.PartialSuccess;

    /// <summary>
    /// Gets whether the character got lost and needs to retry.
    /// </summary>
    public bool GotLost => Outcome == NavigationOutcome.Failure;

    /// <summary>
    /// Gets whether a fumble occurred, entering a dangerous area.
    /// </summary>
    public bool EnteredDangerousArea => Outcome == NavigationOutcome.Fumble;

    /// <summary>
    /// Creates a successful navigation result.
    /// </summary>
    public static NavigationResult Success(int netSuccesses, int targetDc) =>
        new(NavigationOutcome.Success, 1.0f, netSuccesses, targetDc, false, null);

    /// <summary>
    /// Creates a partial success result (reached with delay).
    /// </summary>
    public static NavigationResult PartialSuccess(int netSuccesses, int targetDc) =>
        new(NavigationOutcome.PartialSuccess, 1.25f, netSuccesses, targetDc, false, null);

    /// <summary>
    /// Creates a failure result (got lost, must retry).
    /// </summary>
    public static NavigationResult Failure(int netSuccesses, int targetDc) =>
        new(NavigationOutcome.Failure, 1.5f, netSuccesses, targetDc, false, null);

    /// <summary>
    /// Creates a fumble result (entered dangerous area).
    /// </summary>
    public static NavigationResult Fumble(int netSuccesses, int targetDc, DangerousAreaType areaType) =>
        new(NavigationOutcome.Fumble, 1.0f, netSuccesses, targetDc, true, areaType);

    /// <summary>
    /// Creates a display string describing the navigation outcome.
    /// </summary>
    public string ToDisplayString()
    {
        return Outcome switch
        {
            NavigationOutcome.Success =>
                $"Navigation successful! Reached destination on schedule. ({NetSuccesses} successes vs DC {TargetDc})",
            NavigationOutcome.PartialSuccess =>
                $"Navigation successful with minor delays. Travel time +25%. ({NetSuccesses} successes vs DC {TargetDc})",
            NavigationOutcome.Failure =>
                $"Got lost! Must backtrack and try again. Travel time +50%. ({NetSuccesses} successes vs DC {TargetDc})",
            NavigationOutcome.Fumble =>
                $"Critically lost! Stumbled into {DangerousAreaType}. ({NetSuccesses} successes vs DC {TargetDc})",
            _ => "Unknown navigation outcome"
        };
    }
}

/// <summary>
/// Defines the possible outcomes of a navigation attempt.
/// </summary>
public enum NavigationOutcome
{
    /// <summary>
    /// Full success - reached destination on time.
    /// </summary>
    Success = 0,

    /// <summary>
    /// Partial success - reached destination with minor delays (+25% time).
    /// </summary>
    PartialSuccess = 1,

    /// <summary>
    /// Failure - got lost, must retry (+50% time penalty).
    /// </summary>
    Failure = 2,

    /// <summary>
    /// Fumble - entered a dangerous area.
    /// </summary>
    Fumble = 3
}

/// <summary>
/// Defines the types of dangerous areas that can be encountered on a fumble.
/// </summary>
public enum DangerousAreaType
{
    /// <summary>
    /// Environmental hazard (toxic zone, unstable structure, etc.).
    /// </summary>
    HazardZone = 0,

    /// <summary>
    /// Hostile territory controlled by enemies.
    /// </summary>
    HostileTerritory = 1,

    /// <summary>
    /// Glitch pocket with unpredictable reality effects.
    /// </summary>
    GlitchPocket = 2
}
```

---

## 7. NavigationService Implementation

### 7.1 Purpose

The `NavigationService` orchestrates navigation attempts, coordinating with the skill check system, calculating modifiers, and determining outcomes including fumble consequences.

### 7.2 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/INavigationService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service interface for navigation operations in the Wasteland Survival system.
/// </summary>
public interface INavigationService
{
    /// <summary>
    /// Attempts to navigate to a destination.
    /// </summary>
    /// <param name="player">The player attempting navigation.</param>
    /// <param name="context">The navigation context with terrain and conditions.</param>
    /// <returns>The navigation result with outcome, time modifier, and any hazards.</returns>
    NavigationResult AttemptNavigation(Player player, NavigationContext context);

    /// <summary>
    /// Checks whether the player can attempt navigation.
    /// </summary>
    /// <param name="player">The player to check.</param>
    /// <param name="context">The navigation context.</param>
    /// <returns>True if navigation can be attempted.</returns>
    bool CanNavigate(Player player, NavigationContext context);

    /// <summary>
    /// Gets the reason why navigation is blocked, if any.
    /// </summary>
    /// <param name="player">The player to check.</param>
    /// <param name="context">The navigation context.</param>
    /// <returns>The blocked reason, or null if navigation is allowed.</returns>
    string? GetNavigationBlockedReason(Player player, NavigationContext context);

    /// <summary>
    /// Calculates the base DC for a given terrain type.
    /// </summary>
    /// <param name="terrainType">The terrain type.</param>
    /// <returns>The base difficulty class.</returns>
    int CalculateBaseDc(TerrainType terrainType);

    /// <summary>
    /// Calculates the total dice modifier for a navigation context.
    /// </summary>
    /// <param name="context">The navigation context.</param>
    /// <returns>The total dice modifier (can be negative).</returns>
    int CalculateDiceModifiers(NavigationContext context);
}
```

### 7.3 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/NavigationService.cs`

```csharp
namespace RuneAndRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Implements navigation operations for the Wasteland Survival system.
/// </summary>
/// <remarks>
/// The NavigationService coordinates terrain-based navigation checks:
/// 1. Validates navigation prerequisites
/// 2. Calculates base DC from terrain type
/// 3. Applies dice modifiers for equipment, familiarity, and weather
/// 4. Performs the skill check
/// 5. Determines outcome and consequences
///
/// Outcomes are determined by comparing net successes to DC:
/// - Net ≥ DC: Full success (on time)
/// - Net ≥ DC-2: Partial success (+25% time)
/// - Net &lt; DC-2: Failure (+50% time, retry needed)
/// - 0 successes + botch: Fumble (dangerous area)
/// </remarks>
public class NavigationService : INavigationService
{
    private readonly ISkillCheckService _skillCheckService;
    private readonly IDiceService _diceService;
    private readonly IFumbleConsequenceService _fumbleConsequenceService;
    private readonly ILogger<NavigationService> _logger;

    public NavigationService(
        ISkillCheckService skillCheckService,
        IDiceService diceService,
        IFumbleConsequenceService fumbleConsequenceService,
        ILogger<NavigationService> logger)
    {
        _skillCheckService = skillCheckService;
        _diceService = diceService;
        _fumbleConsequenceService = fumbleConsequenceService;
        _logger = logger;
    }

    /// <inheritdoc />
    public NavigationResult AttemptNavigation(Player player, NavigationContext context)
    {
        _logger.LogInformation(
            "Player {PlayerId} attempting navigation to {Destination} through {TerrainType}",
            player.Id, context.Destination, context.TerrainType);

        // Calculate DC and modifiers
        int baseDc = CalculateBaseDc(context.TerrainType);
        int diceModifier = CalculateDiceModifiers(context);

        _logger.LogDebug(
            "Navigation DC: {BaseDc}, Dice modifier: {DiceModifier}",
            baseDc, diceModifier);

        // Perform the skill check
        var skillContext = new SkillContext(
            SkillType.WastelandSurvival,
            baseDc,
            diceModifier,
            "Navigation attempt");

        var checkResult = _skillCheckService.PerformCheckWithDC(player, skillContext);

        _logger.LogDebug(
            "Navigation check result: {NetSuccesses} successes, {Botches} botches, IsFumble: {IsFumble}",
            checkResult.NetSuccesses, checkResult.Botches, checkResult.IsFumble);

        // Determine outcome
        return DetermineOutcome(checkResult, baseDc, player);
    }

    /// <inheritdoc />
    public bool CanNavigate(Player player, NavigationContext context)
    {
        return GetNavigationBlockedReason(player, context) == null;
    }

    /// <inheritdoc />
    public string? GetNavigationBlockedReason(Player player, NavigationContext context)
    {
        // Check for active fumble consequences that prevent navigation
        if (_fumbleConsequenceService.HasActiveConsequence(player, FumbleConsequenceType.Disoriented))
        {
            return "You are disoriented and cannot navigate until the effect wears off.";
        }

        // Check for valid destination
        if (string.IsNullOrWhiteSpace(context.Destination))
        {
            return "No destination specified.";
        }

        return null;
    }

    /// <inheritdoc />
    public int CalculateBaseDc(TerrainType terrainType)
    {
        return terrainType switch
        {
            TerrainType.OpenWasteland => 8,
            TerrainType.ModerateRuins => 12,
            TerrainType.DenseRuins => 16,
            TerrainType.Labyrinthine => 20,
            TerrainType.GlitchedLabyrinth => 24,
            _ => 12 // Default to moderate
        };
    }

    /// <inheritdoc />
    public int CalculateDiceModifiers(NavigationContext context)
    {
        return context.TotalDiceModifier;
    }

    private NavigationResult DetermineOutcome(SkillCheckResult checkResult, int targetDc, Player player)
    {
        // Check for fumble first
        if (checkResult.IsFumble)
        {
            var dangerousArea = RollDangerousAreaType();

            _logger.LogWarning(
                "Player {PlayerId} fumbled navigation, entering {DangerousAreaType}",
                player.Id, dangerousArea);

            // Create fumble consequence
            _fumbleConsequenceService.CreateConsequence(
                player,
                FumbleConsequenceType.Disoriented,
                "Got critically lost and entered a dangerous area");

            return NavigationResult.Fumble(checkResult.NetSuccesses, targetDc, dangerousArea);
        }

        int netSuccesses = checkResult.NetSuccesses;

        // Full success: Net >= DC
        if (netSuccesses >= targetDc)
        {
            _logger.LogInformation(
                "Player {PlayerId} successfully navigated to destination",
                player.Id);

            return NavigationResult.Success(netSuccesses, targetDc);
        }

        // Partial success: Net >= DC-2
        if (netSuccesses >= targetDc - 2)
        {
            _logger.LogInformation(
                "Player {PlayerId} reached destination with delays",
                player.Id);

            return NavigationResult.PartialSuccess(netSuccesses, targetDc);
        }

        // Failure: Net < DC-2
        _logger.LogInformation(
            "Player {PlayerId} got lost during navigation",
            player.Id);

        return NavigationResult.Failure(netSuccesses, targetDc);
    }

    private DangerousAreaType RollDangerousAreaType()
    {
        // Roll d6 to determine dangerous area type
        int roll = _diceService.RollSingle(6);

        return roll switch
        {
            1 or 2 => DangerousAreaType.HazardZone,
            3 or 4 => DangerousAreaType.HostileTerritory,
            5 or 6 => DangerousAreaType.GlitchPocket,
            _ => DangerousAreaType.HazardZone
        };
    }
}
```

---

## 8. Navigation Modifiers

### 8.1 Modifier Summary

Navigation checks are affected by multiple contextual modifiers that stack additively to the dice pool.

| Modifier | Dice Change | Condition |
|----------|-------------|-----------|
| Good visibility (Clear) | +1d10 | Clear weather conditions |
| Night (no light) | -2d10 | Nighttime without light source |
| Static Storm | -4d10 | During active static storm |
| Working compass | +1d10 | Character has functional compass |
| Familiar territory | +2d10 | Previously visited/explored area |

### 8.2 Modifier Interactions

**Compass in Glitched Areas:**
- Compasses do not function in `GlitchedLabyrinth` terrain
- The +1d10 bonus is not applied even if the character has a compass
- This represents reality distortions affecting magnetic fields

**Stacking Rules:**
- All applicable modifiers stack additively
- Minimum dice pool is 1d10 (cannot go below 1)
- Example: Familiar territory (+2) + Compass (+1) + Night (-2) = +1d10

### 8.3 Modifier Calculation Example

```
Scenario: Navigate through Dense Ruins at night with a compass to familiar territory

Base Pool: 4d10 (Wasteland Survival skill)
Modifiers:
  + Familiar territory: +2d10
  + Working compass:    +1d10
  - Night (no light):   -2d10
  ────────────────────────────
  Net modifier:         +1d10

Final Pool: 5d10
Target DC: 16 (Dense Ruins)
```

---

## 9. Navigation Failure Consequences

### 9.1 Failure Types

| Outcome | Condition | Time Penalty | Additional Effect |
|---------|-----------|--------------|-------------------|
| Success | Net ≥ DC | ×1.0 | None |
| Partial Success | Net ≥ DC-2 | ×1.25 | Minor delays |
| Failure | Net < DC-2 | ×1.5 | Must retry |
| Fumble | 0 successes + ≥1 botch | Variable | Dangerous area |

### 9.2 Dangerous Area Types

When a fumble occurs, roll d6 to determine the type of dangerous area entered:

| Roll | Area Type | Description |
|------|-----------|-------------|
| 1-2 | Hazard Zone | Environmental hazard (toxic, unstable, etc.) |
| 3-4 | Hostile Territory | Area controlled by enemies |
| 5-6 | Glitch Pocket | Reality-warped zone with unpredictable effects |

### 9.3 Fumble Consequence: Disoriented

When a fumble occurs, the `Disoriented` fumble consequence is applied:

- **Duration:** Until rest or successful Wasteland Survival check (DC 12)
- **Effect:** Cannot attempt navigation while disoriented
- **Recovery:** Rest at safe location or successful orientation check

---

## 10. Data Model Changes

### 10.1 New Enums

| Enum | Layer | Description |
|------|-------|-------------|
| `TerrainType` | Domain | Terrain classifications with base DCs |
| `WeatherCondition` | Domain | Weather conditions affecting navigation |
| `NavigationOutcome` | Domain | Navigation attempt outcomes |
| `DangerousAreaType` | Domain | Types of dangerous areas (fumble) |

### 10.2 New Value Objects

| Value Object | Layer | Description |
|--------------|-------|-------------|
| `NavigationContext` | Domain | Context for navigation attempts |
| `NavigationResult` | Domain | Outcome of navigation attempts |

### 10.3 New Interfaces

| Interface | Layer | Description |
|-----------|-------|-------------|
| `INavigationService` | Application | Navigation service contract |

### 10.4 New Services

| Service | Layer | Description |
|---------|-------|-------------|
| `NavigationService` | Application | Navigation service implementation |

---

## 11. Configuration Files

### 11.1 terrain-types.json

**File:** `config/terrain-types.json`

```json
{
    "$schema": "./schemas/terrain-types.schema.json",
    "terrainTypes": [
        {
            "id": "open-wasteland",
            "type": "OpenWasteland",
            "baseDc": 8,
            "displayName": "Open Wasteland",
            "description": "Barren expanses with clear sightlines. Landmarks visible at great distance. Easy terrain for experienced survivors.",
            "travelSpeedMultiplier": 1.0,
            "exampleLocations": ["The Ash Plains", "Windswept Plateau", "Salt Flats"]
        },
        {
            "id": "moderate-ruins",
            "type": "ModerateRuins",
            "baseDc": 12,
            "displayName": "Moderate Ruins",
            "description": "Partially collapsed structures with navigable paths. Some route-finding required to avoid obstacles.",
            "travelSpeedMultiplier": 0.8,
            "exampleLocations": ["Outer Districts", "Industrial Outskirts", "Collapsed Suburbs"]
        },
        {
            "id": "dense-ruins",
            "type": "DenseRuins",
            "baseDc": 16,
            "displayName": "Dense Ruins",
            "description": "Heavily damaged urban areas with many blocked routes. Frequent dead ends and unstable structures.",
            "travelSpeedMultiplier": 0.6,
            "exampleLocations": ["The Old City", "Manufacturing District", "Downtown Core"]
        },
        {
            "id": "labyrinthine",
            "type": "Labyrinthine",
            "baseDc": 20,
            "displayName": "Labyrinthine",
            "description": "Maze-like structures requiring careful path tracking. Easy to get turned around without landmarks.",
            "travelSpeedMultiplier": 0.4,
            "exampleLocations": ["The Undercity", "Sewer Networks", "Collapsed Megastructures"]
        },
        {
            "id": "glitched-labyrinth",
            "type": "GlitchedLabyrinth",
            "baseDc": 24,
            "displayName": "Glitched Labyrinth",
            "description": "Reality-warped maze where paths shift and compasses fail. Only the most skilled can navigate these corrupted zones.",
            "travelSpeedMultiplier": 0.3,
            "compassEffective": false,
            "exampleLocations": ["The Fracture", "Resonance Zones", "Null-Space Pockets"]
        }
    ],
    "weatherModifiers": {
        "Clear": {
            "diceModifier": 1,
            "displayName": "Clear",
            "description": "Good visibility with clear sightlines"
        },
        "Overcast": {
            "diceModifier": 0,
            "displayName": "Overcast",
            "description": "Normal visibility, slightly hazy"
        },
        "Night": {
            "diceModifier": -2,
            "displayName": "Night",
            "description": "Darkness without artificial light"
        },
        "StaticStorm": {
            "diceModifier": -4,
            "displayName": "Static Storm",
            "description": "Severe interference and reduced visibility"
        }
    },
    "equipmentModifiers": {
        "compass": {
            "diceModifier": 1,
            "displayName": "Working Compass",
            "description": "Functional magnetic compass",
            "glitchedEffective": false
        }
    },
    "familiarTerritoryBonus": 2,
    "dangerousAreas": [
        {
            "type": "HazardZone",
            "rollRange": [1, 2],
            "displayName": "Hazard Zone",
            "description": "Environmental hazard such as toxic area or unstable structure"
        },
        {
            "type": "HostileTerritory",
            "rollRange": [3, 4],
            "displayName": "Hostile Territory",
            "description": "Area controlled by hostile factions or creatures"
        },
        {
            "type": "GlitchPocket",
            "rollRange": [5, 6],
            "displayName": "Glitch Pocket",
            "description": "Reality-warped zone with unpredictable effects"
        }
    ],
    "outcomeTimes": {
        "Success": 1.0,
        "PartialSuccess": 1.25,
        "Failure": 1.5
    }
}
```

### 11.2 terrain-types.schema.json

**File:** `config/schemas/terrain-types.schema.json`

```json
{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runeandrust.game/schemas/terrain-types.schema.json",
    "title": "Terrain Types Configuration",
    "description": "Configuration schema for terrain type definitions and navigation modifiers",
    "type": "object",
    "required": ["terrainTypes", "weatherModifiers", "equipmentModifiers", "familiarTerritoryBonus", "dangerousAreas", "outcomeTimes"],
    "properties": {
        "terrainTypes": {
            "type": "array",
            "description": "Array of terrain type definitions",
            "items": {
                "type": "object",
                "required": ["id", "type", "baseDc", "displayName", "description", "travelSpeedMultiplier"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the terrain type"
                    },
                    "type": {
                        "type": "string",
                        "enum": ["OpenWasteland", "ModerateRuins", "DenseRuins", "Labyrinthine", "GlitchedLabyrinth"],
                        "description": "Terrain type enum value"
                    },
                    "baseDc": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30,
                        "description": "Base difficulty class for navigation"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Human-readable name for UI display"
                    },
                    "description": {
                        "type": "string",
                        "description": "Flavor text describing the terrain type"
                    },
                    "travelSpeedMultiplier": {
                        "type": "number",
                        "minimum": 0.1,
                        "maximum": 1.0,
                        "description": "Base travel speed multiplier for this terrain"
                    },
                    "compassEffective": {
                        "type": "boolean",
                        "default": true,
                        "description": "Whether compasses function in this terrain"
                    },
                    "exampleLocations": {
                        "type": "array",
                        "items": { "type": "string" },
                        "description": "Example location names for this terrain type"
                    }
                }
            }
        },
        "weatherModifiers": {
            "type": "object",
            "description": "Weather condition modifiers",
            "additionalProperties": {
                "type": "object",
                "required": ["diceModifier", "displayName", "description"],
                "properties": {
                    "diceModifier": {
                        "type": "integer",
                        "minimum": -10,
                        "maximum": 10,
                        "description": "Dice pool modifier for this weather"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Display name for the weather condition"
                    },
                    "description": {
                        "type": "string",
                        "description": "Description of the weather effects"
                    }
                }
            }
        },
        "equipmentModifiers": {
            "type": "object",
            "description": "Equipment-based modifiers",
            "additionalProperties": {
                "type": "object",
                "required": ["diceModifier", "displayName", "description"],
                "properties": {
                    "diceModifier": {
                        "type": "integer",
                        "minimum": -5,
                        "maximum": 5,
                        "description": "Dice pool modifier for this equipment"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Display name for the equipment"
                    },
                    "description": {
                        "type": "string",
                        "description": "Description of the equipment"
                    },
                    "glitchedEffective": {
                        "type": "boolean",
                        "default": true,
                        "description": "Whether equipment works in glitched areas"
                    }
                }
            }
        },
        "familiarTerritoryBonus": {
            "type": "integer",
            "minimum": 0,
            "maximum": 5,
            "description": "Dice bonus for familiar territory"
        },
        "dangerousAreas": {
            "type": "array",
            "description": "Dangerous area types for fumbles",
            "items": {
                "type": "object",
                "required": ["type", "rollRange", "displayName", "description"],
                "properties": {
                    "type": {
                        "type": "string",
                        "enum": ["HazardZone", "HostileTerritory", "GlitchPocket"],
                        "description": "Dangerous area type enum value"
                    },
                    "rollRange": {
                        "type": "array",
                        "items": { "type": "integer" },
                        "minItems": 2,
                        "maxItems": 2,
                        "description": "D6 roll range for this area type [min, max]"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Display name for the dangerous area"
                    },
                    "description": {
                        "type": "string",
                        "description": "Description of the dangerous area"
                    }
                }
            }
        },
        "outcomeTimes": {
            "type": "object",
            "description": "Time multipliers by outcome",
            "required": ["Success", "PartialSuccess", "Failure"],
            "properties": {
                "Success": {
                    "type": "number",
                    "minimum": 0.5,
                    "maximum": 2.0,
                    "description": "Time multiplier for full success"
                },
                "PartialSuccess": {
                    "type": "number",
                    "minimum": 0.5,
                    "maximum": 2.0,
                    "description": "Time multiplier for partial success"
                },
                "Failure": {
                    "type": "number",
                    "minimum": 0.5,
                    "maximum": 3.0,
                    "description": "Time multiplier for failure"
                }
            }
        }
    }
}
```

### 11.3 Configuration Schema Summary

| Config File | Schema File | Purpose |
|-------------|-------------|---------|
| `terrain-types.json` | `terrain-types.schema.json` | Terrain definitions, DCs, weather/equipment modifiers |

---

## 12. Logging Specifications

### 12.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `NavigationService` | Information | Navigation attempt started, outcome determined |
| `NavigationService` | Debug | DC calculations, modifier applications, dice results |
| `NavigationService` | Warning | Fumble occurred, dangerous area entered |
| `NavigationService` | Error | Invalid context, service failures |

### 12.2 Log Message Examples

```
[Information] Player {PlayerId} attempting navigation to {Destination} through {TerrainType}
[Debug] Navigation DC: {BaseDc}, Dice modifier: {DiceModifier}
[Debug] Navigation check result: {NetSuccesses} successes, {Botches} botches, IsFumble: {IsFumble}
[Information] Player {PlayerId} successfully navigated to destination
[Information] Player {PlayerId} reached destination with delays
[Information] Player {PlayerId} got lost during navigation
[Warning] Player {PlayerId} fumbled navigation, entering {DangerousAreaType}
```

---

## 13. Unit Testing Requirements

### 13.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Terrain type sets correct DC | 1 |
| Equipment and weather modifiers apply correctly | 1 |
| **Total** | **~2** |

### 13.2 Test Specifications

**File:** `tests/RuneAndRust.Tests/Services/NavigationServiceTests.cs`

```csharp
[TestFixture]
public class NavigationServiceTests
{
    [Test]
    [TestCase(TerrainType.OpenWasteland, 8)]
    [TestCase(TerrainType.ModerateRuins, 12)]
    [TestCase(TerrainType.DenseRuins, 16)]
    [TestCase(TerrainType.Labyrinthine, 20)]
    [TestCase(TerrainType.GlitchedLabyrinth, 24)]
    public void CalculateBaseDc_GivenTerrainType_ReturnsCorrectDc(
        TerrainType terrainType,
        int expectedDc);

    [Test]
    public void CalculateDiceModifiers_GivenContextWithAllModifiers_ReturnsCorrectTotal();
}
```

### 13.3 Test Case Details

**Test 1: Terrain DC Calculation**
- Verifies each terrain type returns the correct base DC
- Covers all 5 terrain types
- Uses parameterized test cases

**Test 2: Modifier Calculation**
- Creates context with compass, familiar territory, and weather
- Verifies modifiers stack correctly
- Checks compass ineffective in glitched terrain

---

## 14. Use Cases

### UC-001: Navigate to Known Destination
**Actor:** Player
**Flow:** Select destination → System builds context → Perform navigation check → Receive outcome → Apply time modifier if needed → Arrive or get lost

### UC-002: Navigate in Adverse Conditions
**Actor:** Player
**Flow:** Attempt navigation during storm → System applies weather penalty → Perform check with reduced dice → Determine outcome with higher failure chance

### UC-003: Navigate Familiar Territory
**Actor:** Player
**Flow:** Travel to previously visited area → System recognizes familiar territory → Apply +2d10 bonus → Perform check with advantage

### UC-004: Fumble Navigation
**Actor:** Player
**Flow:** Attempt navigation → Roll 0 successes with botch → System determines fumble → Roll dangerous area type → Enter hazardous zone → Apply Disoriented consequence

---

## 15. Deliverable Checklist

### 15.1 Domain Layer

- [ ] `TerrainType.cs` enum created in `Enums/`
- [ ] `WeatherCondition.cs` enum created in `Enums/`
- [ ] `NavigationOutcome.cs` enum created in `Enums/`
- [ ] `DangerousAreaType.cs` enum created in `Enums/`
- [ ] `NavigationContext.cs` value object created in `ValueObjects/`
- [ ] `NavigationResult.cs` value object created in `ValueObjects/`

### 15.2 Application Layer

- [ ] `INavigationService.cs` interface created in `Interfaces/`
- [ ] `NavigationService.cs` created in `Services/`
- [ ] Service registered in dependency injection

### 15.3 Configuration

- [ ] `config/terrain-types.json` created
- [ ] `config/schemas/terrain-types.schema.json` created
- [ ] Configuration files validate against schemas

### 15.4 Testing

- [ ] `NavigationServiceTests.cs` created (~2 tests)
- [ ] All tests passing

### 15.5 Documentation

- [ ] XML documentation complete on all public members
- [ ] Design specification finalized

---

## 16. Acceptance Criteria

### 16.1 Functional

- [ ] Terrain type correctly determines base DC (8/12/16/20/24)
- [ ] Working compass provides +1d10 bonus (except in glitched terrain)
- [ ] Familiar territory provides +2d10 bonus
- [ ] Weather conditions apply correct modifiers (+1/-2/-4)
- [ ] Compass ineffective in GlitchedLabyrinth terrain
- [ ] Navigation failure applies +50% time penalty
- [ ] Navigation partial success applies +25% time penalty
- [ ] Fumble enters dangerous area and applies Disoriented consequence

### 16.2 Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~2 tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete

---

## 17. Dependencies

### 17.1 Required from Previous Versions

| Type | Version | Usage |
|------|---------|-------|
| `ISkillCheckService` | v0.15.0 | Perform navigation skill checks |
| `IDiceService` | v0.15.0 | Roll dice for dangerous area determination |
| `IFumbleConsequenceService` | v0.15.1 | Apply Disoriented consequence on fumble |
| `SkillContext` | v0.15.1 | Convert navigation context for skill checks |

### 17.2 Provides to Future Versions

| Type | Usage |
|------|-------|
| `TerrainType` | v0.15.5e Hazard Detection terrain-based DCs |
| `NavigationContext` | v0.15.5g Scout Action terrain awareness |
| `INavigationService` | v0.15.5i Exploration Synergies combined checks |

---

## 18. Future Considerations

### 18.1 Deferred to v0.15.5g (Scout Action)

- **Room revelation mechanics**: Scout action reveals adjacent rooms based on successes
- **Enemy detection during scouting**: Detecting hostiles before entering

### 18.2 Deferred to v0.15.5i (Exploration Synergies)

- **Combined navigation + other skill checks**: Finding hidden paths requires Navigation + Acrobatics
- **Navigation as prerequisite for other actions**: Must navigate to area before foraging

### 18.3 Out of Scope

- **Map item implementation**: Physical map items that reveal terrain (future inventory system)
- **Dynamic terrain changes**: Terrain type changing due to events (future world state system)
- **NPC guides**: Hiring guides to assist navigation (future NPC system)

---

## 19. Document Metadata

---

*Document Version: 1.0*
*Last Updated: 2026-01-18*
*Author: Claude*

---

### Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-18 | Claude | Initial design specification |

---

*This design specification provides the detailed blueprint for implementing v0.15.5d Navigation System. This establishes terrain-based navigation mechanics for the Wasteland Survival skill expansion.*
