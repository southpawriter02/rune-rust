# v0.14.4b Design Specification: Room Type Schema

**Version:** 0.14.4b
**Parent:** v0.14.4 (Environment Configuration Schemas)
**Prerequisites:** v0.14.3 Complete (Monster Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Room Type Schema Root Definition](#4-room-type-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [RoomTypeDefinition Schema](#42-roomtypedefinition-schema)
5. [Multiplier Configuration](#5-multiplier-configuration)
   - 5.1 [Monster Spawn Multiplier](#51-monster-spawn-multiplier)
   - 5.2 [Loot Multiplier](#52-loot-multiplier)
   - 5.3 [Experience Multiplier](#53-experience-multiplier)
6. [Description Configuration](#6-description-configuration)
   - 6.1 [Entry Description](#61-entry-description)
   - 6.2 [Indicator Text](#62-indicator-text)
   - 6.3 [Description Pool](#63-description-pool)
7. [Connection Rules Configuration](#7-connection-rules-configuration)
   - 7.1 [ConnectionRules Definition](#71-connectionrules-definition)
   - 7.2 [Allowed Door Types](#72-allowed-door-types)
   - 7.3 [Secret Passage Configuration](#73-secret-passage-configuration)
   - 7.4 [Connection Limits](#74-connection-limits)
8. [Lighting Override Configuration](#8-lighting-override-configuration)
9. [Feature Spawn Rules Configuration](#9-feature-spawn-rules-configuration)
   - 9.1 [FeatureSpawnRule Definition](#91-featurespawnrule-definition)
   - 9.2 [Spawn Conditions](#92-spawn-conditions)
   - 9.3 [Quantity Configuration](#93-quantity-configuration)
10. [Feature Requirements Configuration](#10-feature-requirements-configuration)
    - 10.1 [Required Features](#101-required-features)
    - 10.2 [Forbidden Features](#102-forbidden-features)
11. [Validation Rules](#11-validation-rules)
    - 11.1 [ID Pattern Validation](#111-id-pattern-validation)
    - 11.2 [Range Validation](#112-range-validation)
    - 11.3 [Required Fields](#113-required-fields)
    - 11.4 [Enum Validation](#114-enum-validation)
12. [Configuration Schema](#12-configuration-schema)
13. [Configuration File Updates](#13-configuration-file-updates)
14. [Data Model Changes](#14-data-model-changes)
15. [Logging Specifications](#15-logging-specifications)
16. [Unit Testing Requirements](#16-unit-testing-requirements)
17. [Use Cases](#17-use-cases)
18. [Deliverable Checklist](#18-deliverable-checklist)
19. [Acceptance Criteria](#19-acceptance-criteria)
20. [Dependencies](#20-dependencies)
21. [Future Considerations](#21-future-considerations)

---

## 1. Executive Summary

Version 0.14.4b introduces the **Room Type Schema** (`room-types.schema.json`), which validates room type definitions including entry descriptions, UI indicators, spawn/loot/experience multipliers, rest allowance, description pools, connection rules, lighting overrides, and feature spawn rules. This schema enables full customization of room behavior and characteristics without code changes, supporting modding scenarios such as custom dungeon layouts, specialized encounter rooms, or unique environmental chambers.

The Room Type Schema validates the existing `room-types.json` configuration file which currently defines 6 room types (standard, treasure, trap, boss, safe, shrine). The schema establishes patterns for room-specific configurations that interact with biomes (v0.14.4a), terrain (v0.14.4c), and interactive objects (v0.14.4d).

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `room-types.schema.json` |
| **Schema Definitions** | `RoomTypeDefinition`, `ConnectionRules`, `FeatureSpawnRule` |
| **Configuration Files** | Update `room-types.json` to reference new schema |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version provides:
- **Spawn multiplier validation** - Monster, loot, and experience scaling
- **Description system integration** - Entry text, indicators, description pools
- **Connection rule validation** - Door types, secret passages, connection limits
- **Lighting override validation** - Room-specific lighting conditions
- **Feature spawn validation** - Object and NPC spawning rules
- **Feature requirement validation** - Required and forbidden features

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                  v0.14.4 ENVIRONMENT CONFIGURATION SCHEMAS                   │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.4a: biomes.schema.json                                           │
  │  v0.14.4b: room-types.schema.json ◀── THIS VERSION                      │
  │  v0.14.4c: terrain.schema.json (expansion)                              │
  │  v0.14.4d: interactive-objects.schema.json                              │
  └─────────────────────────────────────────────────────────────────────────┘

  Cross-references:
  • room-types.json → connectionRules.allowedDoorTypes references interactive-objects.json
  • room-types.json → featureSpawnRules[].featureId references interactive-objects.json
  • room-types.json → requiredFeatures references interactive-objects.json
  • room-types.json → forbiddenFeatures references interactive-objects.json

  Shared definitions:
  • ID pattern: ^[a-z][a-z0-9-]*$ (lowercase kebab-case)
  • Schema location: config/schemas/
  • Room types structure: Object map keyed by room type ID
  • Lighting enum: dark, dim, normal, bright (shared with biomes)
```

---

## 2. Feature Overview

```
v0.14.4b Room Type Schema Features
├── room-types.schema.json
│   ├── Root Configuration Properties
│   │   ├── $schema (string, optional)
│   │   ├── version (string, optional)
│   │   └── roomTypes (object map of room type id -> RoomTypeDefinition, required)
│   └── Definitions
│       ├── RoomTypeDefinition
│       │   ├── id (string, kebab-case pattern, required)
│       │   ├── name (string, minLength: 1, required)
│       │   ├── entryDescription (string, shown on entry, optional)
│       │   ├── indicator (string, UI display tag, optional)
│       │   ├── monsterSpawnMultiplier (number, minimum: 0, default: 1.0)
│       │   ├── lootMultiplier (number, minimum: 0, default: 1.0)
│       │   ├── experienceMultiplier (number, minimum: 0, default: 1.0)
│       │   ├── allowsRest (boolean, default: false)
│       │   ├── descriptionPool (array of string, optional)
│       │   ├── connectionRules (ConnectionRules, optional)
│       │   ├── lightingOverride (enum, optional)
│       │   ├── featureSpawnRules (array of FeatureSpawnRule, optional)
│       │   ├── requiredFeatures (array of string, optional)
│       │   ├── forbiddenFeatures (array of string, optional)
│       │   └── sortOrder (integer, minimum: 0, optional)
│       ├── ConnectionRules
│       │   ├── allowedDoorTypes (array of string)
│       │   ├── secretPassageChance (number, 0-1, default: 0)
│       │   ├── minConnections (integer, minimum: 1, default: 1)
│       │   └── maxConnections (integer, minimum: 1, default: 4)
│       └── FeatureSpawnRule
│           ├── featureId (string, required)
│           ├── spawnChance (number, 0-1, required)
│           ├── minQuantity (integer, minimum: 0, default: 0)
│           ├── maxQuantity (integer, minimum: 0, default: 1)
│           └── conditions (SpawnConditions, optional)
├── Validation Rules
│   ├── Room Type ID Pattern Validation (kebab-case)
│   ├── Multiplier Range Validation (>= 0)
│   ├── Lighting Override Enum Validation (4 values)
│   ├── Spawn Chance Range Validation (0-1)
│   ├── Secret Passage Chance Range Validation (0-1)
│   ├── Connection Limits Validation (>= 1)
│   └── Required Fields Enforced
└── Configuration Updates
    └── room-types.json updated with $schema reference
```

---

## 3. Architecture Diagrams

### 3.1 Room Type Definition Structure Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       ROOM TYPE DEFINITION STRUCTURE                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    ROOM TYPE DEFINITION                              │    │
│  │                                                                      │    │
│  │  id: "treasure"                                                      │    │
│  │  name: "Treasure Room"                                               │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  DISPLAY CONFIGURATION                                         │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ entryDescription: "Glittering objects catch your eye..."│  │  │    │
│  │  │  │ indicator: "[Treasure Room]"                            │  │  │    │
│  │  │  │ descriptionPool: [                                      │  │  │    │
│  │  │  │   "Gold coins are scattered...",                        │  │  │    │
│  │  │  │   "An ornate chest sits...",                            │  │  │    │
│  │  │  │   "Precious gems glitter..."                            │  │  │    │
│  │  │  │ ]                                                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  MULTIPLIER CONFIGURATION                                      │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ monsterSpawnMultiplier: 0.5    (50% fewer monsters)     │  │  │    │
│  │  │  │ lootMultiplier: 2.0            (2x loot drops)          │  │  │    │
│  │  │  │ experienceMultiplier: 1.0      (normal XP)              │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  BEHAVIORAL CONFIGURATION                                      │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ allowsRest: false             (cannot rest here)        │  │  │    │
│  │  │  │ lightingOverride: null        (uses biome default)      │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  CONNECTION CONFIGURATION (optional)                           │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ connectionRules: {                                      │  │  │    │
│  │  │  │   allowedDoorTypes: ["iron-door-basic", "wooden-door"], │  │  │    │
│  │  │  │   secretPassageChance: 0.15,                            │  │  │    │
│  │  │  │   minConnections: 1,                                    │  │  │    │
│  │  │  │   maxConnections: 2                                     │  │  │    │
│  │  │  │ }                                                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  │  ┌───────────────────────────────────────────────────────────────┐  │    │
│  │  │  FEATURE SPAWN CONFIGURATION (optional)                        │  │    │
│  │  │  ┌─────────────────────────────────────────────────────────┐  │  │    │
│  │  │  │ featureSpawnRules: [                                    │  │  │    │
│  │  │  │   { featureId: "chest-wooden", spawnChance: 0.8 },      │  │  │    │
│  │  │  │   { featureId: "chest-iron", spawnChance: 0.3 }         │  │  │    │
│  │  │  │ ]                                                       │  │  │    │
│  │  │  │ requiredFeatures: ["treasure-pile"]                     │  │  │    │
│  │  │  │ forbiddenFeatures: ["trap-spike"]                       │  │  │    │
│  │  │  └─────────────────────────────────────────────────────────┘  │  │    │
│  │  └───────────────────────────────────────────────────────────────┘  │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits room-types.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads room-types.schema.json from config/schemas/                        │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "monsterSpawnMultiplier must be >= 0"
                           • "lightingOverride must be one of: dark, dim, ..."
                           • "secretPassageChance must be between 0 and 1"
                           • "minConnections must be >= 1"
```

### 3.3 Room Type Multiplier System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       ROOM TYPE MULTIPLIER SYSTEM                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  MULTIPLIER EFFECTS                                                          │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Room Type    │ Monsters │  Loot  │  XP   │ Rest │ Special             │ │
│  │  ─────────────┼──────────┼────────┼───────┼──────┼─────────────────    │ │
│  │  standard     │   1.0x   │  1.0x  │ 1.0x  │  No  │ Default             │ │
│  │  treasure     │   0.5x   │  2.0x  │ 1.0x  │  No  │ Guaranteed chest    │ │
│  │  trap         │   1.2x   │  1.0x  │ 1.0x  │  No  │ Trap features       │ │
│  │  boss         │   1.0x   │  3.0x  │ 1.0x  │  No  │ Boss spawn point    │ │
│  │  safe         │   0.0x   │  0.5x  │ 1.0x  │ Yes  │ No monsters         │ │
│  │  shrine       │   0.2x   │  1.5x  │ 1.0x  │  No  │ Altar interaction   │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  MULTIPLIER CALCULATION                                                      │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Final Value = Base Value × Room Multiplier                            │ │
│  │                                                                        │ │
│  │  Examples:                                                             │ │
│  │  • Treasure Room: 10 loot drops × 2.0 = 20 loot drops                  │ │
│  │  • Safe Haven: 5 monsters × 0.0 = 0 monsters                           │ │
│  │  • Trap Room: 3 monsters × 1.2 = 3.6 → 4 monsters (rounded)            │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  MULTIPLIER VISUALIZATION                                                    │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Monster Spawn Multiplier                                              │ │
│  │  0.0x        0.5x        1.0x        1.5x        2.0x                  │ │
│  │   ├───────────┼───────────┼───────────┼───────────┤                    │ │
│  │   │ safe      │ treasure  │ standard  │           │ trap               │ │
│  │   │ (none)    │ shrine    │ boss      │           │ (more)             │ │
│  │                                                                        │ │
│  │  Loot Multiplier                                                       │ │
│  │  0.0x        1.0x        2.0x        3.0x        4.0x                  │ │
│  │   ├───────────┼───────────┼───────────┼───────────┤                    │ │
│  │   │ safe      │ standard  │ treasure  │ boss      │                    │ │
│  │   │           │ trap      │           │           │                    │ │
│  │   │           │ shrine    │           │           │                    │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Connection Rules System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        CONNECTION RULES SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  CONNECTION RULES CONFIGURATION                                              │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  connectionRules: {                                                   │   │
│  │    "allowedDoorTypes": ["iron-door-basic", "wooden-door"],            │   │
│  │    "secretPassageChance": 0.10,    // 10% chance of secret exit       │   │
│  │    "minConnections": 1,            // At least 1 exit                 │   │
│  │    "maxConnections": 3             // At most 3 exits                 │   │
│  │  }                                                                    │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ROOM CONNECTION EXAMPLES                                                    │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  minConnections: 1                 minConnections: 2                   │ │
│  │  maxConnections: 1                 maxConnections: 4                   │ │
│  │                                                                        │ │
│  │  ┌───────────┐                    ┌───────────┐                        │ │
│  │  │           │                    │     ▲     │                        │ │
│  │  │   DEAD    ├───▶                │     │     │                        │ │
│  │  │   END     │                  ◀─┤  CROSS    ├─▶                      │ │
│  │  │           │                    │   ROADS   │                        │ │
│  │  └───────────┘                    │     │     │                        │ │
│  │                                   └─────┼─────┘                        │ │
│  │                                         ▼                              │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  SECRET PASSAGE CHANCE                                                       │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  secretPassageChance: 0.15 (15%)                                       │ │
│  │                                                                        │ │
│  │  ┌───────────────────────────────────────────────────────────────┐    │ │
│  │  │                                                               │    │ │
│  │  │  Normal Room Generation (85%)    │  With Secret Passage (15%) │    │ │
│  │  │                                  │                            │    │ │
│  │  │  ┌───────────┐                   │  ┌───────────┐             │    │ │
│  │  │  │           │                   │  │     ░     │             │    │ │
│  │  │  │  ROOM     ├───▶ corridor      │  │  ROOM  ░░░├─▶ hidden    │    │ │
│  │  │  │           │                   │  │           │             │    │ │
│  │  │  └───────────┘                   │  └───────────┘             │    │ │
│  │  │                                  │  ░ = secret passage        │    │ │
│  │  │                                                               │    │ │
│  │  └───────────────────────────────────────────────────────────────┘    │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Feature Spawn Rules System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       FEATURE SPAWN RULES SYSTEM                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  FEATURE SPAWN CONFIGURATION                                                 │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  featureSpawnRules: [                                                 │   │
│  │    {                                                                  │   │
│  │      "featureId": "chest-wooden",                                     │   │
│  │      "spawnChance": 0.80,        // 80% chance to spawn               │   │
│  │      "minQuantity": 1,           // At least 1 if spawns              │   │
│  │      "maxQuantity": 2            // At most 2                         │   │
│  │    },                                                                 │   │
│  │    {                                                                  │   │
│  │      "featureId": "chest-iron",                                       │   │
│  │      "spawnChance": 0.30,        // 30% chance to spawn               │   │
│  │      "minQuantity": 0,           // May not spawn even if triggered   │   │
│  │      "maxQuantity": 1            // At most 1                         │   │
│  │    }                                                                  │   │
│  │  ]                                                                    │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  SPAWN PROBABILITY VISUALIZATION                                             │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  chest-wooden (80% chance, 1-2 quantity)                               │ │
│  │  0%                                                              100%  │ │
│  │  ├────────────────────────────────────────────────────────────┬──────┤ │ │
│  │  │                    SPAWNS (80%)                             │ NO   │ │ │
│  │  ├────────────────────────────────────────────────────────────┴──────┤ │ │
│  │                                                                        │ │
│  │  chest-iron (30% chance, 0-1 quantity)                                 │ │
│  │  0%                                                              100%  │ │
│  │  ├──────────────────┬────────────────────────────────────────────────┤ │ │
│  │  │  SPAWNS (30%)    │                    NO SPAWN (70%)              │ │ │
│  │  ├──────────────────┴────────────────────────────────────────────────┤ │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  REQUIRED VS FORBIDDEN FEATURES                                              │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  requiredFeatures: ["treasure-pile", "torch-wall"]                     │ │
│  │  • Always spawn in this room type                                      │ │
│  │  • 100% spawn chance regardless of rules                               │ │
│  │                                                                        │ │
│  │  forbiddenFeatures: ["trap-spike", "trap-poison"]                      │ │
│  │  • Never spawn in this room type                                       │ │
│  │  • 0% spawn chance even if biome would add them                        │ │
│  │                                                                        │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐  │ │
│  │  │                                                                 │  │ │
│  │  │  TREASURE ROOM                                                  │  │ │
│  │  │  ┌─────────────────────────────────────────────────────────┐   │  │ │
│  │  │  │  ✓ treasure-pile (required)                             │   │  │ │
│  │  │  │  ✓ torch-wall (required)                                │   │  │ │
│  │  │  │  ? chest-wooden (80% chance)                            │   │  │ │
│  │  │  │  ? chest-iron (30% chance)                              │   │  │ │
│  │  │  │  ✗ trap-spike (forbidden)                               │   │  │ │
│  │  │  │  ✗ trap-poison (forbidden)                              │   │  │ │
│  │  │  └─────────────────────────────────────────────────────────┘   │  │ │
│  │  │                                                                 │  │ │
│  │  └─────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 Lighting Override System

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       LIGHTING OVERRIDE SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  LIGHTING LEVELS                                                             │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │     dark ──────────▶ dim ──────────▶ normal ──────────▶ bright        │ │
│  │      🌑                🌘                🌕                ☀️            │ │
│  │  No natural      Minimal light     Standard          Ample light     │ │
│  │    light                           lighting                          │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  LIGHTING OVERRIDE EXAMPLES                                                  │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Biome Default   │ Room Override │ Final Lighting                      │ │
│  │  ────────────────┼───────────────┼───────────────────────────────────  │ │
│  │  dim (dungeon)   │ null          │ dim (uses biome)                    │ │
│  │  dim (dungeon)   │ bright        │ bright (torch room)                 │ │
│  │  bright (desert) │ dark          │ dark (underground cave)             │ │
│  │  dark (cave)     │ normal        │ normal (lit chamber)                │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  VISIBILITY EFFECT                                                           │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  Lighting │ Visibility Range │ Perception Modifier                     │ │
│  │  ─────────┼──────────────────┼─────────────────────────────────────    │ │
│  │  dark     │ Adjacent only    │ -4 to perception checks                 │ │
│  │  dim      │ Half range       │ -2 to perception checks                 │ │
│  │  normal   │ Full range       │ No modifier                             │ │
│  │  bright   │ Extended range   │ +2 to perception checks                 │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.7 Room Type by Use Case

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        ROOM TYPE BY USE CASE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                        │ │
│  │  STANDARD ROOM                      TREASURE ROOM                      │ │
│  │  ┌─────────────────┐                ┌─────────────────┐                │ │
│  │  │ ░ ░ ░ M ░ ░ ░   │                │ ░ ░ $ ░ $ ░ ░   │                │ │
│  │  │ ░ ░ ░ ░ ░ ░ ░   │                │ ░ ░ ░ C ░ ░ ░   │                │ │
│  │  │ ░ ░ M ░ ░ M ░   │                │ ░ $ ░ ░ ░ $ ░   │                │ │
│  │  │ ░ ░ ░ ░ ░ ░ ░   │                │ ░ ░ ░ ░ ░ ░ ░   │                │ │
│  │  └─────────────────┘                └─────────────────┘                │ │
│  │  M = monster (1.0x)                 $ = loot (2.0x)                    │ │
│  │  Default encounter room             C = chest (required)               │ │
│  │                                     Fewer monsters (0.5x)              │ │
│  │                                                                        │ │
│  │  TRAP ROOM                          BOSS CHAMBER                       │ │
│  │  ┌─────────────────┐                ┌─────────────────┐                │ │
│  │  │ ^ ░ ^ ░ ^ ░ ^   │                │ ░ ░ ░ ░ ░ ░ ░   │                │ │
│  │  │ ░ M ░ M ░ M ░   │                │ ░ ░ ░ B ░ ░ ░   │                │ │
│  │  │ ^ ░ ^ ░ ^ ░ ^   │                │ ░ ░ ░ ░ ░ ░ ░   │                │ │
│  │  │ ░ ░ ░ ░ ░ ░ ░   │                │ ░ $ $ $ $ $ ░   │                │ │
│  │  └─────────────────┘                └─────────────────┘                │ │
│  │  ^ = trap feature                   B = boss spawn                     │ │
│  │  More monsters (1.2x)               Massive loot (3.0x)                │ │
│  │                                                                        │ │
│  │  SAFE HAVEN                         SHRINE                             │ │
│  │  ┌─────────────────┐                ┌─────────────────┐                │ │
│  │  │ ░ ░ ░ ░ ░ ░ ░   │                │ ░ ░ ░ A ░ ░ ░   │                │ │
│  │  │ ░ F ░ ~ ░ B ░   │                │ ░ ░ ░ ░ ░ ░ ░   │                │ │
│  │  │ ░ ░ ░ ░ ░ ░ ░   │                │ ░ ░ m ░ ░ ░ ░   │                │ │
│  │  │ ░ ░ ░ ░ ░ ░ ░   │                │ ░ ░ ░ $ ░ ░ ░   │                │ │
│  │  └─────────────────┘                └─────────────────┘                │ │
│  │  F = fire, ~ = water, B = bed       A = altar                          │ │
│  │  No monsters (0.0x)                 m = rare monster (0.2x)            │ │
│  │  Allows resting                     Better loot (1.5x)                 │ │
│  │                                                                        │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.8 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── room-types.json ◀───────────────────────┐                              │
│  │   {                                        │ references                   │
│  │     "$schema": "./schemas/room-types.schema.json",                        │
│  │     "version": "1.0",                      │                              │
│  │     "roomTypes": {                         │                              │
│  │       "treasure": {                        │                              │
│  │         "id": "treasure",                  │                              │
│  │         "name": "Treasure Room",           │                              │
│  │         "entryDescription": "...",         │                              │
│  │         "indicator": "[Treasure Room]",    │                              │
│  │         "monsterSpawnMultiplier": 0.5,     │                              │
│  │         "lootMultiplier": 2.0,             │                              │
│  │         "allowsRest": false,               │                              │
│  │         "descriptionPool": [...]           │                              │
│  │       },                                   │                              │
│  │       ...                                  │                              │
│  │     }                                      │                              │
│  │   }                                        │                              │
│  │                                            │                              │
│  ├── interactive-objects.json (provides door type targets)                   │
│  │                                            │                              │
│  └── schemas/                                 │                              │
│      └── room-types.schema.json ─────────────┘                              │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {                                                  │
│              "RoomTypeDefinition": {...},                                    │
│              "ConnectionRules": {...},                                       │
│              "FeatureSpawnRule": {...}                                       │
│            }                                                                 │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Room Type Schema Root Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/room-types.schema.json`

The room type schema follows JSON Schema Draft-07 specification, providing comprehensive validation for room type configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Room Type Configuration",
    "description": "Schema for room type definitions including multipliers, descriptions, connection rules, and feature spawning.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "roomTypes": {
            "type": "object",
            "description": "Map of room type IDs to room type definitions",
            "additionalProperties": {
                "$ref": "#/definitions/RoomTypeDefinition"
            },
            "minProperties": 1
        }
    },
    "required": ["roomTypes"],
    "additionalProperties": false,
    "definitions": {
        "RoomTypeDefinition": { ... },
        "ConnectionRules": { ... },
        "FeatureSpawnRule": { ... }
    }
}
```

### 4.2 RoomTypeDefinition Schema

The `RoomTypeDefinition` object defines a complete room type with all its behavioral properties.

```json
"RoomTypeDefinition": {
    "type": "object",
    "description": "A room type definition with multipliers, descriptions, and spawn rules",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the room type (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "entryDescription": {
            "type": "string",
            "description": "Text displayed when player first enters this room type"
        },
        "indicator": {
            "type": "string",
            "description": "Short UI indicator tag displayed in room header"
        },
        "monsterSpawnMultiplier": {
            "type": "number",
            "description": "Multiplier for monster spawn count (0 = no monsters)",
            "minimum": 0,
            "default": 1.0
        },
        "lootMultiplier": {
            "type": "number",
            "description": "Multiplier for loot drop quantity",
            "minimum": 0,
            "default": 1.0
        },
        "experienceMultiplier": {
            "type": "number",
            "description": "Multiplier for experience points gained",
            "minimum": 0,
            "default": 1.0
        },
        "allowsRest": {
            "type": "boolean",
            "description": "Whether player can rest in this room type",
            "default": false
        },
        "descriptionPool": {
            "type": "array",
            "description": "Pool of descriptions randomly selected for variety",
            "items": {
                "type": "string",
                "minLength": 1
            }
        },
        "connectionRules": {
            "$ref": "#/definitions/ConnectionRules",
            "description": "Rules for room connections and passages"
        },
        "lightingOverride": {
            "type": "string",
            "description": "Override biome lighting for this room type",
            "enum": ["dark", "dim", "normal", "bright"]
        },
        "featureSpawnRules": {
            "type": "array",
            "description": "Rules for spawning interactive objects and NPCs",
            "items": {
                "$ref": "#/definitions/FeatureSpawnRule"
            }
        },
        "requiredFeatures": {
            "type": "array",
            "description": "Features that always spawn in this room type",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9-]*$"
            }
        },
        "forbiddenFeatures": {
            "type": "array",
            "description": "Features that never spawn in this room type",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9-]*$"
            }
        },
        "sortOrder": {
            "type": "integer",
            "description": "Order for display sorting (lower values first)",
            "minimum": 0
        }
    },
    "required": ["id", "name"],
    "additionalProperties": false
}
```

---

## 5. Multiplier Configuration

### 5.1 Monster Spawn Multiplier

The `monsterSpawnMultiplier` field scales the number of monsters spawned in a room.

```json
"monsterSpawnMultiplier": {
    "type": "number",
    "description": "Multiplier for monster spawn count (0 = no monsters)",
    "minimum": 0,
    "default": 1.0
}
```

| Value | Effect | Example Usage |
|-------|--------|---------------|
| `0.0` | No monsters spawn | Safe Haven, Rest Areas |
| `0.2` | 20% of normal | Shrine, Sacred Places |
| `0.5` | Half monsters | Treasure Room |
| `1.0` | Normal spawn rate | Standard Room |
| `1.2` | 20% more monsters | Trap Room, Ambush |
| `2.0` | Double monsters | Horde Room |

**Calculation:**
```
Final Monster Count = floor(Base Count × monsterSpawnMultiplier)
```

### 5.2 Loot Multiplier

The `lootMultiplier` field scales the quantity and/or quality of loot dropped.

```json
"lootMultiplier": {
    "type": "number",
    "description": "Multiplier for loot drop quantity",
    "minimum": 0,
    "default": 1.0
}
```

| Value | Effect | Example Usage |
|-------|--------|---------------|
| `0.0` | No loot drops | Empty Room |
| `0.5` | Half loot | Safe Haven |
| `1.0` | Normal loot | Standard Room |
| `1.5` | 50% more loot | Shrine |
| `2.0` | Double loot | Treasure Room |
| `3.0` | Triple loot | Boss Chamber |

**Calculation:**
```
Final Loot Quantity = round(Base Quantity × lootMultiplier)
```

### 5.3 Experience Multiplier

The `experienceMultiplier` field scales experience points earned from combat.

```json
"experienceMultiplier": {
    "type": "number",
    "description": "Multiplier for experience points gained",
    "minimum": 0,
    "default": 1.0
}
```

| Value | Effect | Example Usage |
|-------|--------|---------------|
| `0.0` | No XP gained | Practice/Tutorial |
| `0.5` | Half XP | Easy Encounters |
| `1.0` | Normal XP | Standard Room |
| `1.5` | 50% bonus XP | Challenge Room |
| `2.0` | Double XP | Elite Encounter |

**Note:** The existing room-types.json does not include `experienceMultiplier`, but it is defined in the scope for future use. The schema supports it as an optional field with default value 1.0.

---

## 6. Description Configuration

### 6.1 Entry Description

The `entryDescription` field provides flavor text when the player first enters a room of this type.

```json
"entryDescription": {
    "type": "string",
    "description": "Text displayed when player first enters this room type"
}
```

**Examples by Room Type:**
| Room Type | Entry Description |
|-----------|-------------------|
| `treasure` | "Glittering objects catch your eye among the shadows." |
| `trap` | "Something feels off about this place..." |
| `boss` | "An ominous presence fills the chamber." |
| `safe` | "You feel safe here. The dangers of the dungeon seem distant." |
| `shrine` | "Ancient symbols glow softly on a weathered altar." |

**Usage:**
- Displayed once when player enters the room
- Empty string means no special entry message
- Can reference room-specific elements

### 6.2 Indicator Text

The `indicator` field provides a short UI tag displayed in the room header.

```json
"indicator": {
    "type": "string",
    "description": "Short UI indicator tag displayed in room header"
}
```

**Examples by Room Type:**
| Room Type | Indicator |
|-----------|-----------|
| `standard` | (empty) |
| `treasure` | "[Treasure Room]" |
| `trap` | "[Trap Room]" |
| `boss` | "[Boss Chamber]" |
| `safe` | "[Safe Haven]" |
| `shrine` | "[Shrine]" |

**Usage:**
- Displayed in room title/header area
- Empty string means no indicator shown
- Helps player quickly identify room purpose

### 6.3 Description Pool

The `descriptionPool` array contains multiple descriptions randomly selected for variety.

```json
"descriptionPool": {
    "type": "array",
    "description": "Pool of descriptions randomly selected for variety",
    "items": {
        "type": "string",
        "minLength": 1
    }
}
```

**Example Configuration:**
```json
{
    "descriptionPool": [
        "Gold coins are scattered across the floor.",
        "An ornate chest sits in the corner.",
        "Precious gems glitter from a pile of treasure."
    ]
}
```

**Usage:**
- One description randomly selected per room instance
- Empty array means no additional description
- Can be combined with entry description
- Provides replay variety within same room type

---

## 7. Connection Rules Configuration

### 7.1 ConnectionRules Definition

The `ConnectionRules` object defines rules for room connections and passages.

```json
"ConnectionRules": {
    "type": "object",
    "description": "Rules for room connections and passages",
    "properties": {
        "allowedDoorTypes": {
            "type": "array",
            "description": "List of door object IDs that can spawn in connections",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9-]*$"
            }
        },
        "secretPassageChance": {
            "type": "number",
            "description": "Probability of a secret passage (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1,
            "default": 0
        },
        "minConnections": {
            "type": "integer",
            "description": "Minimum number of exits from this room",
            "minimum": 1,
            "default": 1
        },
        "maxConnections": {
            "type": "integer",
            "description": "Maximum number of exits from this room",
            "minimum": 1,
            "default": 4
        }
    },
    "additionalProperties": false
}
```

### 7.2 Allowed Door Types

The `allowedDoorTypes` array specifies which door objects can appear in this room type's connections.

```json
{
    "allowedDoorTypes": ["iron-door-basic", "wooden-door", "reinforced-door"]
}
```

**Usage:**
- References door IDs from interactive-objects.json
- Empty array or omitted means all door types allowed
- Restricts door variety for thematic consistency

**Example Configurations:**
| Room Type | Allowed Doors | Rationale |
|-----------|---------------|-----------|
| `treasure` | iron-door-basic, reinforced-door | Secure storage |
| `boss` | boss-gate, iron-door-heavy | Grand entrances |
| `safe` | wooden-door, unlocked-gate | Easy access |

### 7.3 Secret Passage Configuration

The `secretPassageChance` field defines the probability of hidden exits.

```json
{
    "secretPassageChance": 0.15
}
```

| Value | Probability | Typical Usage |
|-------|-------------|---------------|
| `0.0` | Never | Standard rooms |
| `0.05` | 5% | Occasional secrets |
| `0.10` | 10% | Moderate secrets |
| `0.15` | 15% | Treasure rooms |
| `0.25` | 25% | Mystery rooms |
| `0.50` | 50% | Secret-focused rooms |

### 7.4 Connection Limits

The `minConnections` and `maxConnections` fields constrain room topology.

```json
{
    "minConnections": 1,
    "maxConnections": 3
}
```

**Typical Configurations:**
| Room Type | Min | Max | Description |
|-----------|-----|-----|-------------|
| `standard` | 1 | 4 | Flexible layout |
| `treasure` | 1 | 2 | Limited access |
| `boss` | 1 | 2 | Single approach |
| `safe` | 1 | 3 | Accessible refuge |

**Constraints:**
- `minConnections` >= 1 (room must be reachable)
- `maxConnections` >= `minConnections`
- Generator respects these limits during map creation

---

## 8. Lighting Override Configuration

The `lightingOverride` field allows room types to override biome lighting.

```json
"lightingOverride": {
    "type": "string",
    "description": "Override biome lighting for this room type",
    "enum": ["dark", "dim", "normal", "bright"]
}
```

| Lighting | Description | Visibility Effect |
|----------|-------------|-------------------|
| `dark` | No natural light | Severely reduced sight |
| `dim` | Minimal light | Reduced sight range |
| `normal` | Standard lighting | Normal visibility |
| `bright` | Ample light | Extended sight range |

**Usage:**
- Omitted or null: Uses biome default lighting
- Specified value: Overrides biome lighting

**Example Configurations:**
| Room Type | Biome Default | Override | Final |
|-----------|---------------|----------|-------|
| `safe` | dim (dungeon) | bright | bright (well-lit haven) |
| `trap` | normal (ruins) | dark | dark (hidden dangers) |
| `shrine` | dim (cave) | normal | normal (magical glow) |

---

## 9. Feature Spawn Rules Configuration

### 9.1 FeatureSpawnRule Definition

The `FeatureSpawnRule` object defines spawning rules for interactive objects and NPCs.

```json
"FeatureSpawnRule": {
    "type": "object",
    "description": "Rule for spawning a feature in this room type",
    "properties": {
        "featureId": {
            "type": "string",
            "description": "Reference to interactive object or NPC ID",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "spawnChance": {
            "type": "number",
            "description": "Probability of this feature spawning (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1
        },
        "minQuantity": {
            "type": "integer",
            "description": "Minimum quantity if spawn succeeds",
            "minimum": 0,
            "default": 0
        },
        "maxQuantity": {
            "type": "integer",
            "description": "Maximum quantity if spawn succeeds",
            "minimum": 0,
            "default": 1
        },
        "conditions": {
            "$ref": "#/definitions/SpawnConditions",
            "description": "Additional conditions for spawning"
        }
    },
    "required": ["featureId", "spawnChance"],
    "additionalProperties": false
}
```

### 9.2 Spawn Conditions

The optional `conditions` field allows for conditional spawning based on game state.

```json
"SpawnConditions": {
    "type": "object",
    "description": "Conditions that must be met for feature to spawn",
    "properties": {
        "minDepth": {
            "type": "integer",
            "description": "Minimum dungeon depth for spawn",
            "minimum": 1
        },
        "maxDepth": {
            "type": "integer",
            "description": "Maximum dungeon depth for spawn",
            "minimum": 1
        },
        "requiredBiome": {
            "type": "string",
            "description": "Biome ID required for spawn",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "excludedBiomes": {
            "type": "array",
            "description": "Biome IDs that prevent spawn",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9-]*$"
            }
        }
    },
    "additionalProperties": false
}
```

**Example with Conditions:**
```json
{
    "featureId": "ice-chest",
    "spawnChance": 0.5,
    "minQuantity": 1,
    "maxQuantity": 1,
    "conditions": {
        "requiredBiome": "frozen",
        "minDepth": 3
    }
}
```

### 9.3 Quantity Configuration

The `minQuantity` and `maxQuantity` fields control how many instances spawn.

**Spawn Algorithm:**
1. Roll against `spawnChance`
2. If successful, roll quantity between `minQuantity` and `maxQuantity`
3. Place features in valid room positions

**Example Configurations:**
| Feature | Chance | Min | Max | Expected |
|---------|--------|-----|-----|----------|
| chest-wooden | 0.8 | 1 | 2 | Often 1-2 chests |
| chest-iron | 0.3 | 0 | 1 | Rare, 0-1 chest |
| torch-wall | 1.0 | 2 | 4 | Always 2-4 torches |
| trap-spike | 0.6 | 1 | 3 | Often 1-3 traps |

---

## 10. Feature Requirements Configuration

### 10.1 Required Features

The `requiredFeatures` array lists features that always spawn in this room type.

```json
"requiredFeatures": {
    "type": "array",
    "description": "Features that always spawn in this room type",
    "items": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$"
    }
}
```

**Example:**
```json
{
    "requiredFeatures": ["treasure-pile", "torch-wall"]
}
```

**Behavior:**
- 100% spawn chance regardless of other rules
- Spawns at least one instance
- Overrides biome restrictions
- Used for defining room identity

### 10.2 Forbidden Features

The `forbiddenFeatures` array lists features that never spawn in this room type.

```json
"forbiddenFeatures": {
    "type": "array",
    "description": "Features that never spawn in this room type",
    "items": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$"
    }
}
```

**Example:**
```json
{
    "forbiddenFeatures": ["trap-spike", "trap-poison", "trap-arrow"]
}
```

**Behavior:**
- 0% spawn chance regardless of other rules
- Overrides biome additions
- Overrides feature spawn rules
- Used for safety (no traps in safe rooms)

---

## 11. Validation Rules

### 11.1 ID Pattern Validation

| Property | Pattern | Description |
|----------|---------|-------------|
| `RoomTypeDefinition.id` | `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| `featureId` | `^[a-z][a-z0-9-]*$` | Interactive object reference |
| `allowedDoorTypes[]` | `^[a-z][a-z0-9-]*$` | Door object reference |
| `requiredFeatures[]` | `^[a-z][a-z0-9-]*$` | Feature reference |
| `forbiddenFeatures[]` | `^[a-z][a-z0-9-]*$` | Feature reference |

### 11.2 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `monsterSpawnMultiplier` | >= 0 | "monsterSpawnMultiplier must be >= 0" |
| `lootMultiplier` | >= 0 | "lootMultiplier must be >= 0" |
| `experienceMultiplier` | >= 0 | "experienceMultiplier must be >= 0" |
| `secretPassageChance` | 0-1 | "secretPassageChance must be between 0 and 1" |
| `spawnChance` | 0-1 | "spawnChance must be between 0 and 1" |
| `minConnections` | >= 1 | "minConnections must be >= 1" |
| `maxConnections` | >= 1 | "maxConnections must be >= 1" |
| `minQuantity` | >= 0 | "minQuantity must be >= 0" |
| `maxQuantity` | >= 0 | "maxQuantity must be >= 0" |
| `sortOrder` | >= 0 | "sortOrder must be >= 0" |

### 11.3 Required Fields

| Definition | Required Fields |
|------------|-----------------|
| `RoomTypeDefinition` | id, name |
| `FeatureSpawnRule` | featureId, spawnChance |

### 11.4 Enum Validation

| Enum | Values |
|------|--------|
| `lightingOverride` | dark, dim, normal, bright |

---

## 12. Configuration Schema

### Complete Room Types Schema File

**File:** `config/schemas/room-types.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Room Type Configuration",
    "description": "Schema for room type definitions including multipliers, descriptions, connection rules, and feature spawning.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "roomTypes": {
            "type": "object",
            "description": "Map of room type IDs to room type definitions",
            "additionalProperties": {
                "$ref": "#/definitions/RoomTypeDefinition"
            },
            "minProperties": 1
        }
    },
    "required": ["roomTypes"],
    "additionalProperties": false,
    "definitions": {
        "RoomTypeDefinition": {
            "type": "object",
            "description": "A room type definition with multipliers, descriptions, and spawn rules",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the room type (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "entryDescription": {
                    "type": "string",
                    "description": "Text displayed when player first enters this room type"
                },
                "indicator": {
                    "type": "string",
                    "description": "Short UI indicator tag displayed in room header"
                },
                "monsterSpawnMultiplier": {
                    "type": "number",
                    "description": "Multiplier for monster spawn count (0 = no monsters)",
                    "minimum": 0,
                    "default": 1.0
                },
                "lootMultiplier": {
                    "type": "number",
                    "description": "Multiplier for loot drop quantity",
                    "minimum": 0,
                    "default": 1.0
                },
                "experienceMultiplier": {
                    "type": "number",
                    "description": "Multiplier for experience points gained",
                    "minimum": 0,
                    "default": 1.0
                },
                "allowsRest": {
                    "type": "boolean",
                    "description": "Whether player can rest in this room type",
                    "default": false
                },
                "descriptionPool": {
                    "type": "array",
                    "description": "Pool of descriptions randomly selected for variety",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "connectionRules": {
                    "$ref": "#/definitions/ConnectionRules",
                    "description": "Rules for room connections and passages"
                },
                "lightingOverride": {
                    "type": "string",
                    "description": "Override biome lighting for this room type",
                    "enum": ["dark", "dim", "normal", "bright"]
                },
                "featureSpawnRules": {
                    "type": "array",
                    "description": "Rules for spawning interactive objects and NPCs",
                    "items": {
                        "$ref": "#/definitions/FeatureSpawnRule"
                    }
                },
                "requiredFeatures": {
                    "type": "array",
                    "description": "Features that always spawn in this room type",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$"
                    }
                },
                "forbiddenFeatures": {
                    "type": "array",
                    "description": "Features that never spawn in this room type",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$"
                    }
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Order for display sorting (lower values first)",
                    "minimum": 0
                }
            },
            "required": ["id", "name"],
            "additionalProperties": false
        },
        "ConnectionRules": {
            "type": "object",
            "description": "Rules for room connections and passages",
            "properties": {
                "allowedDoorTypes": {
                    "type": "array",
                    "description": "List of door object IDs that can spawn in connections",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$"
                    }
                },
                "secretPassageChance": {
                    "type": "number",
                    "description": "Probability of a secret passage (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0
                },
                "minConnections": {
                    "type": "integer",
                    "description": "Minimum number of exits from this room",
                    "minimum": 1,
                    "default": 1
                },
                "maxConnections": {
                    "type": "integer",
                    "description": "Maximum number of exits from this room",
                    "minimum": 1,
                    "default": 4
                }
            },
            "additionalProperties": false
        },
        "FeatureSpawnRule": {
            "type": "object",
            "description": "Rule for spawning a feature in this room type",
            "properties": {
                "featureId": {
                    "type": "string",
                    "description": "Reference to interactive object or NPC ID",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "spawnChance": {
                    "type": "number",
                    "description": "Probability of this feature spawning (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1
                },
                "minQuantity": {
                    "type": "integer",
                    "description": "Minimum quantity if spawn succeeds",
                    "minimum": 0,
                    "default": 0
                },
                "maxQuantity": {
                    "type": "integer",
                    "description": "Maximum quantity if spawn succeeds",
                    "minimum": 0,
                    "default": 1
                },
                "conditions": {
                    "$ref": "#/definitions/SpawnConditions",
                    "description": "Additional conditions for spawning"
                }
            },
            "required": ["featureId", "spawnChance"],
            "additionalProperties": false
        },
        "SpawnConditions": {
            "type": "object",
            "description": "Conditions that must be met for feature to spawn",
            "properties": {
                "minDepth": {
                    "type": "integer",
                    "description": "Minimum dungeon depth for spawn",
                    "minimum": 1
                },
                "maxDepth": {
                    "type": "integer",
                    "description": "Maximum dungeon depth for spawn",
                    "minimum": 1
                },
                "requiredBiome": {
                    "type": "string",
                    "description": "Biome ID required for spawn",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "excludedBiomes": {
                    "type": "array",
                    "description": "Biome IDs that prevent spawn",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$"
                    }
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 13. Configuration File Updates

### Updated room-types.json

Update the existing `room-types.json` to include the schema reference.

**File:** `config/room-types.json`

```json
{
    "$schema": "./schemas/room-types.schema.json",
    "version": "1.0",
    "roomTypes": {
        "standard": {
            "id": "standard",
            "name": "Standard Room",
            "entryDescription": "",
            "indicator": "",
            "monsterSpawnMultiplier": 1.0,
            "lootMultiplier": 1.0,
            "allowsRest": false,
            "descriptionPool": []
        },
        "treasure": {
            "id": "treasure",
            "name": "Treasure Room",
            "entryDescription": "Glittering objects catch your eye among the shadows.",
            "indicator": "[Treasure Room]",
            "monsterSpawnMultiplier": 0.5,
            "lootMultiplier": 2.0,
            "allowsRest": false,
            "descriptionPool": [
                "Gold coins are scattered across the floor.",
                "An ornate chest sits in the corner.",
                "Precious gems glitter from a pile of treasure."
            ]
        },
        "trap": {
            "id": "trap",
            "name": "Trap Room",
            "entryDescription": "Something feels off about this place...",
            "indicator": "[Trap Room]",
            "monsterSpawnMultiplier": 1.2,
            "lootMultiplier": 1.0,
            "allowsRest": false,
            "descriptionPool": [
                "Suspicious pressure plates line the floor.",
                "You notice thin wires stretched across the passage.",
                "The walls have small holes that could hide dart traps."
            ]
        },
        "boss": {
            "id": "boss",
            "name": "Boss Chamber",
            "entryDescription": "An ominous presence fills the chamber.",
            "indicator": "[Boss Chamber]",
            "monsterSpawnMultiplier": 1.0,
            "lootMultiplier": 3.0,
            "allowsRest": false,
            "descriptionPool": [
                "The air crackles with dark energy.",
                "Bones of previous challengers litter the ground.",
                "A massive throne dominates the far end of the chamber."
            ]
        },
        "safe": {
            "id": "safe",
            "name": "Safe Haven",
            "entryDescription": "You feel safe here. The dangers of the dungeon seem distant.",
            "indicator": "[Safe Haven]",
            "monsterSpawnMultiplier": 0.0,
            "lootMultiplier": 0.5,
            "allowsRest": true,
            "descriptionPool": [
                "A warm fire crackles in a hearth.",
                "Soft cushions and blankets offer a place to rest.",
                "Clean water flows from a fountain."
            ]
        },
        "shrine": {
            "id": "shrine",
            "name": "Shrine",
            "entryDescription": "Ancient symbols glow softly on a weathered altar.",
            "indicator": "[Shrine]",
            "monsterSpawnMultiplier": 0.2,
            "lootMultiplier": 1.5,
            "allowsRest": false,
            "descriptionPool": [
                "Incense smoke curls around ancient statues.",
                "Offerings of coin and food lie at the altar's base.",
                "Faded murals depict forgotten gods."
            ]
        }
    }
}
```

---

## 14. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file and updates the configuration file reference. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file added, one config file updated with $schema reference |

### Schema as Documentation

The schema serves as:
- **Validation contract** for room type configuration
- **IDE documentation** via description fields
- **Modding reference** for custom room type creation
- **Design specification** for room mechanics

---

## 15. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 16. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Multiplier Validation | ~1 |
| Lighting Override Enum Validation | ~1 |
| Connection Rules Validation | ~1 |
| Configuration File Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### RoomTypesSchemaTests.cs

```csharp
[TestFixture]
public class RoomTypesSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the room-types.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void RoomTypesJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies monsterSpawnMultiplier must be non-negative.
    /// </summary>
    [Test]
    public void MonsterSpawnMultiplier_Negative_FailsValidation();

    /// <summary>
    /// Verifies lightingOverride must be one of the valid enum values.
    /// </summary>
    [Test]
    public void LightingOverride_InvalidEnum_FailsValidation();

    /// <summary>
    /// Verifies secretPassageChance must be between 0 and 1.
    /// </summary>
    [Test]
    public void SecretPassageChance_OutOfRange_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 17. Use Cases

### UC-001: Load Room Type Configuration

**Actor:** Game System
**Flow:** System starts -> Loads `room-types.json` -> Schema validates content -> Room types available for level generation

### UC-002: Edit Room Types in IDE

**Actor:** Developer/Modder
**Flow:** Opens `room-types.json` in VS Code -> IDE loads schema -> Autocomplete suggests properties -> Validation errors shown inline

### UC-003: Add New Room Type

**Actor:** Modder
**Flow:** Adds new room type key to `roomTypes` object -> Sets id, name -> Configures multipliers -> Defines descriptionPool -> IDE validates structure

### UC-004: Configure Feature Spawning

**Actor:** Modder
**Flow:** Adds featureSpawnRules to room type -> Defines entries with featureId and spawnChance -> Sets quantity range -> IDE validates spawn chances 0-1

### UC-005: Invalid Multiplier Value

**Actor:** Modder
**Flow:** Sets monsterSpawnMultiplier to -0.5 (invalid) -> IDE shows error "monsterSpawnMultiplier must be >= 0" -> Modder corrects to valid value

### UC-006: Configure Connection Rules

**Actor:** Modder
**Flow:** Adds connectionRules to room type -> Sets minConnections and maxConnections -> Configures secretPassageChance -> IDE validates ranges

---

## 18. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/room-types.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all 4 definitions (RoomTypeDefinition, ConnectionRules, FeatureSpawnRule, SpawnConditions)

### Validation Rules
- [ ] Room type ID pattern validation: `^[a-z][a-z0-9-]*$`
- [ ] Monster spawn multiplier validation (>= 0)
- [ ] Loot multiplier validation (>= 0)
- [ ] Experience multiplier validation (>= 0)
- [ ] Lighting override enum validation (4 values)
- [ ] Secret passage chance validation (0-1)
- [ ] Spawn chance validation (0-1)
- [ ] Connection limits validation (>= 1)
- [ ] Required fields enforced for all definitions

### Configuration Files
- [ ] `room-types.json` updated with $schema reference
- [ ] All 6 existing room types validate against schema

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 19. Acceptance Criteria

### Functional
- [ ] `room-types.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `room-types.json` without errors
- [ ] Entry description validated as optional string
- [ ] Indicator validated as optional string
- [ ] Monster spawn multiplier validated (>= 0)
- [ ] Loot multiplier validated (>= 0)
- [ ] Experience multiplier validated (>= 0)
- [ ] Allows rest validated as boolean
- [ ] Description pool validated as string array
- [ ] Connection rules validated with door types
- [ ] Lighting override validated with enum
- [ ] Feature spawn rules validated with chances
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 20. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| None | N/A | Room type schema has no required dependencies |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `room-types.schema.json` | Validates room type configuration |
| Room Type IDs | Referenced by level generation and biome integration |
| Lighting enum | Shared with biomes.schema.json |

### Implementation Order Note

**v0.14.4b can be implemented in parallel with v0.14.4a, v0.14.4c, and v0.14.4d** as they have no internal dependencies within v0.14.4.

---

## 21. Future Considerations

### Deferred to Future Versions

- **Cross-reference validation**: Validating featureId exists in interactive-objects.json
- **Cross-reference validation**: Validating allowedDoorTypes exists in interactive-objects.json
- **Room generation logic**: Runtime room creation using room type config
- **Multiplier effects**: Actual scaling calculations (runtime concern)
- **Connection validation**: minConnections <= maxConnections constraint

### Out of Scope

- **Biome schema** (v0.14.4a) - Biomes that may reference room types
- **Terrain schema expansion** (v0.14.4c) - Terrain types in rooms
- **Interactive object schema** (v0.14.4d) - Objects referenced by feature rules
- **Runtime room application**: Application-level generation (domain logic)
- **Room balance tuning**: Specific multiplier values (design decisions)

### Potential Future Enhancements

If the room type system expands, consider adding to the schema:

**Room Size Configuration:**
```json
"sizeConstraints": {
    "type": "object",
    "description": "Size limits for this room type",
    "properties": {
        "minWidth": { "type": "integer", "minimum": 3 },
        "maxWidth": { "type": "integer", "minimum": 3 },
        "minHeight": { "type": "integer", "minimum": 3 },
        "maxHeight": { "type": "integer", "minimum": 3 }
    }
}
```

**Environmental Effects:**
```json
"environmentalEffects": {
    "type": "array",
    "description": "Status effects applied while in this room",
    "items": {
        "type": "object",
        "properties": {
            "effectId": { "type": "string" },
            "intensity": { "type": "number" }
        }
    }
}
```

**Music Override:**
```json
"musicOverride": {
    "type": "string",
    "description": "Music theme to play in this room type",
    "pattern": "^[a-z][a-z0-9-]*$"
}
```

**Tile Decorations:**
```json
"tileDecorations": {
    "type": "array",
    "description": "Visual decorations scattered on floor tiles",
    "items": {
        "type": "object",
        "properties": {
            "decorationId": { "type": "string" },
            "density": { "type": "number", "minimum": 0, "maximum": 1 }
        }
    }
}
```

**Room Events:**
```json
"roomEvents": {
    "type": "array",
    "description": "Events that can trigger in this room type",
    "items": {
        "type": "object",
        "properties": {
            "eventId": { "type": "string" },
            "triggerChance": { "type": "number" },
            "triggerCondition": { "type": "string" }
        }
    }
}
```

**NPC Spawning:**
```json
"npcSpawnRules": {
    "type": "array",
    "description": "Rules for spawning friendly NPCs",
    "items": {
        "type": "object",
        "properties": {
            "npcId": { "type": "string" },
            "spawnChance": { "type": "number" },
            "dialogueSetId": { "type": "string" }
        }
    }
}
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
