# v0.13.2b Changelog: Node Display & States

## Overview

Implemented the `TreeNodeRenderer` and `NodeStateRenderer` components for the Ability Tree UI. This version adds state-specific styling, indicators, and progress display for ability tree nodes.

---

## Added

### Enums

- **NodeState.cs** — Enum for node unlock states (Locked, Available, Unlocked)

### DTOs

- **NodeStateDtos.cs**
  - `NodeStateDisplayDto` — Node display data (ID, name, state, rank, cost, tier, branch)
  - `NodeRankDisplayDto` — Rank progress display with `ProgressString` property

### Configuration

- **NodeStateDisplayConfig.cs**
  - `NodeStateDisplayConfig` — Main config (node dimensions, spacing)
  - `NodeStateIndicators` — State indicators ("[x]", "( )", "[L]")
  - `NodeStateColors` — Console colors for each state
- **config/node-state-display.json** — Default configuration
- **config/schemas/node-state-display.schema.json** — JSON schema for validation

### Renderers

- **NodeStateRenderer.cs** — State formatting renderer
  - `GetStateIndicator(NodeState)` — Returns visual indicator
  - `GetStateColor(NodeState)` — Returns console color
  - `FormatNodeContent(NodeStateDisplayDto)` — Format node content
  - `FormatRankProgress(int, int)` — Format rank progress for multi-rank nodes
  - `TruncateName(string, int)` — Truncate long node names

### UI Components

- **TreeNodeRenderer.cs** — Node rendering UI component
  - `DetermineNodeState(AbilityTreeNode, Player, ...)` — State determination logic
  - `RenderNode(NodeStateDisplayDto, int, int)` — Render node at position
  - `SetHighlight(string, bool)` — Toggle node highlight
  - `GetNodeScreenPosition(string)` — Get rendered node position
  - `GetNodeScreenBounds(string)` — Get node bounds for line drawing
  - `CreateNodeDisplayDto(...)` — Create DTO from node definition

### Unit Tests

- **NodeStateRendererTests.cs** — 18 tests covering indicators, colors, formatting
- **TreeNodeRendererTests.cs** — 15 tests covering state determination, highlighting, position tracking

---

## Visual Examples

### Node States

```
[x] Frenzy 2/3    ← Unlocked (Green), multi-rank progress
( ) Power Strike  ← Available (Yellow), can be unlocked
[L] Rage          ← Locked (DarkGray), prerequisites not met
```

### State Determination Flow

```
┌─────────────────────────────────────┐
│ Has ranks > 0?                      │
│   Yes → Unlocked                    │
│   No  → Check Prerequisites         │
│          Met → Available            │
│          Not Met → Locked           │
└─────────────────────────────────────┘
```

---

## Dependencies

| Component | Usage |
|-----------|-------|
| `IPrerequisiteValidator` | Validate node prerequisites |
| `ITalentPointService` | Optional talent point operations |
| `ITerminalService` | Terminal output (WriteColoredAt) |
| `AbilityTreeNode` | Node definition with prerequisites |

---

## Test Results

```
Test summary: total: 39, failed: 0, succeeded: 39, skipped: 0
- NodeStateRendererTests: 18 passed
- TreeNodeRendererTests: 15 passed
- Related tests: 6 passed
```

---

## Files Created

| Category | File |
|----------|------|
| Enum | `Enums/NodeState.cs` |
| DTOs | `DTOs/NodeStateDtos.cs` |
| Configuration | `Configuration/NodeStateDisplayConfig.cs` |
| Renderer | `Renderers/NodeStateRenderer.cs` |
| UI | `UI/TreeNodeRenderer.cs` |
| Config | `config/node-state-display.json` |
| Schema | `config/schemas/node-state-display.schema.json` |
| Tests | `Renderers/NodeStateRendererTests.cs` |
| Tests | `UI/TreeNodeRendererTests.cs` |
