# v0.0.11b Changelog - Combat & Ability Descriptors

**Release Date:** 2026-01-08
**Focus:** Weapon-specific combat descriptions, damage tiers, death descriptions, and ability effects

## Summary

This release adds rich combat and ability descriptor services that generate varied, engaging narrative text based on weapon types, damage severity, creature categories, and ability effects. Combat descriptions now change dynamically based on the weapon used, how much damage is dealt, and what type of creature is being fought.

## New Features

### DamageTier System
- **6 damage severity tiers** defined:
  - Glancing (0-15%) - "barely scratching", "grazing"
  - Light (15-30%) - "finding purchase", "wounding"
  - Solid (30-50%) - "striking true", "biting deep"
  - Heavy (50-75%) - "crashing into", "rending"
  - Devastating (75-90%) - "devastating", "tearing through"
  - Lethal (90-100%+) - "cleaving through", "annihilating"

### Weapon-Type Hit Descriptors
- **8 weapon pools** defined: sword, axe, bow, staff, dagger, fist, mace, spear
- Each pool contains 4-5 unique hit descriptions
- Damage-based filtering for high-damage descriptors (e.g., "cleaves through" only at 50%+ damage)

### Critical Hit & Miss Descriptors
- **Critical hit pool** - "lands a devastating strike", "finds a critical weakness"
- **Miss pool** - "swings wide", "is deflected", "is dodged", "is parried"
- **Fumble pool** - "stumbles badly", "overextends", "weapon slips"

### Death Descriptors by Creature Category
- **6 creature categories**: humanoid, undead, beast, construct, elemental, demon
- Each category has unique death descriptions matching creature type
- **Critical kill flair** - "With a devastating blow,", "In a single, brutal stroke,"
- **Player death** - Template-based with {player} and {killer} placeholders
- **Near-death warnings** - At 25% and 10% health thresholds

### CombatDescriptorContext
- Captures all combat descriptor requirements:
  - `WeaponType`, `DamageType`, `DamagePercent`
  - `IsCritical`, `IsFumble`
  - `AttackerName`, `TargetName`, `TargetTags`
  - `Environment` for biome-aware descriptors
- `GetDamageTier()` method calculates tier from damage percentage

### DeathDescriptorContext
- Captures death descriptor requirements:
  - `CreatureName`, `CreatureTags`
  - `WasCriticalKill`, `KillingDamageType`, `KillingWeaponType`
  - `IsPlayerDeath` for special player death handling
- `GetPrimaryCategory()` determines creature type with priority ordering

### CombatDescriptorService
- `GetHitDescription()` - Weapon-specific attack descriptions with damage tier
- `GetMissDescription()` - Miss/fumble descriptions
- `GetDeathDescription()` - Category-based death descriptions with critical flair
- `GetPlayerDeathDescription()` - Template-based player death
- `GetNearDeathDescription()` - Health warnings at low HP

### AbilityDescriptorContext
- Captures ability descriptor requirements:
  - `AbilityId`, `DamageType`, `AbilityTags`
  - `TargetType`, `CasterName`, `TargetName`
  - `AppliedEffects` for aftermath descriptions
  - `Environment` for biome-aware descriptors

### AbilityDescriptorService
- `GetActivationDescription()` - Casting/channeling phase descriptions
- `GetImpactDescription()` - Effect hitting target descriptions
- `GetAftermathDescription()` - Lingering effect descriptions
- `GetCompleteAbilityNarrative()` - Combined activation + impact + aftermath
- `GetStatusEffectAppliedDescription()` - Effect application text
- `GetStatusEffectRemovedDescription()` - Effect removal text

### Descriptor Configuration Extensions
- **New properties** on Descriptor class:
  - `WeaponTypes` - Filter by weapon type
  - `DamageTypes` - Filter by damage type
  - `CreatureCategories` - Filter by creature category
  - `CriticalOnly` - Only for critical hits
  - `MissOnly` - Only for misses/fumbles

## Files Created

### Application Services
- `src/Core/RuneAndRust.Application/Services/CombatDescriptorService.cs`
- `src/Core/RuneAndRust.Application/Services/AbilityDescriptorService.cs`

### Configuration Files
- `config/descriptors/combat-hits.json`
- `config/descriptors/combat-deaths.json`
- `config/descriptors/damage-tiers.json`

### Unit Tests
- `tests/RuneAndRust.Application.UnitTests/Services/CombatDescriptorServiceTests.cs` (9 tests)
- `tests/RuneAndRust.Application.UnitTests/Services/AbilityDescriptorServiceTests.cs` (7 tests)

## Files Modified

- `src/Core/RuneAndRust.Application/Configuration/DescriptorConfiguration.cs` - Added combat filtering properties
- `src/Infrastructure/RuneAndRust.Infrastructure/DependencyInjection.cs` - Registered CombatDescriptorService and AbilityDescriptorService

## Test Results

- **16 new tests** added (exceeded estimated ~15)
- **All 835 tests pass** (build verified)
- **0 warnings**

## Breaking Changes

None. All changes are additive and backwards compatible.

## Dependencies

- Requires v0.0.11a (Descriptor Framework Expansion) complete
- No new NuGet package dependencies

## Usage Example

```csharp
// Generate combat hit description
var context = new CombatDescriptorContext
{
    WeaponType = "sword",
    DamagePercent = 0.45,
    IsCritical = false,
    AttackerName = "Thorin",
    TargetName = "Goblin"
};
var description = combatDescriptorService.GetHitDescription(context);
// Returns: "Thorin slashes across the Goblin, striking true!"

// Generate death description
var deathContext = new DeathDescriptorContext
{
    CreatureName = "Skeleton",
    CreatureTags = ["undead", "monster"],
    WasCriticalKill = true
};
var deathDesc = combatDescriptorService.GetDeathDescription(deathContext);
// Returns: "With a devastating blow, Skeleton collapses into a heap of bones"

// Generate ability narrative
var abilityContext = new AbilityDescriptorContext
{
    AbilityId = "fireball",
    DamageType = "fire",
    CasterName = "Wizard",
    TargetName = "Orc",
    AppliedEffects = ["burning"]
};
var narrative = abilityDescriptorService.GetCompleteAbilityNarrative(abilityContext);
// Returns: "Wizard gathers flames in their palm Fire engulfs Orc! The effects linger."
```

## Descriptor Pool Summary

| Pool Category | Pool Count | Descriptor Count |
|---------------|------------|------------------|
| Weapon hits | 8 | 34 |
| Critical/miss | 3 | 13 |
| Deaths | 6 | 27 |
| Player warnings | 3 | 12 |
| Damage tiers | 6 | 24 |
| **Total** | **26** | **110** |

## Next Steps

- **v0.0.11c**: Environmental & Sensory Descriptors (lighting, sounds, smells, temperature)
- **v0.0.11d**: Interactive Objects & Polish (object descriptions, ambient events, caching)
