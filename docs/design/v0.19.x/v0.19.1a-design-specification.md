# v0.19.1a Design Specification: Midgard Implementation

**Version:** 0.19.1a
**Theme:** Midgard — Deck 04: The Tamed Ruin
**Parent:** v0.19.1 (Midgard Implementation)
**Prerequisites:** v0.19.0a (Core Biome Infrastructure)
**Status:** Design Complete
**Estimated Unit Tests:** ~18

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Midgard BiomeDefinition Configuration](#5-midgard-biomedefinition-configuration)
6. [Zone Specifications](#6-zone-specifications)
7. [Faction Spawn Pool Configuration](#7-faction-spawn-pool-configuration)
8. [Environmental Condition Integration](#8-environmental-condition-integration)
9. [Property Override Mechanics](#9-property-override-mechanics)
10. [JSON Schema Compliance](#10-json-schema-compliance)
11. [Decision Tree / Flowcharts](#11-decision-tree--flowcharts)
12. [C# Implementation Examples](#12-c-implementation-examples)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Integration Points](#15-integration-points)
16. [Inline Documentation Requirements](#16-inline-documentation-requirements)
17. [Deliverable Checklist](#17-deliverable-checklist)
18. [Acceptance Criteria](#18-acceptance-criteria)
19. [Dependencies](#19-dependencies)
20. [Future Considerations & Deferrals](#20-future-considerations--deferrals)

---

## 1. Executive Summary

v0.19.1a implements **Midgard**, the foundational realm of Aethelgard and the starting area for all players. This design specification defines:

- **Complete Midgard BiomeDefinition** with base environmental properties
- **Four Sub-zones** representing distinct regions: The Greatwood, Sun Fields, Iron Marches, The Veil Edge
- **Faction Spawn Pools** per zone (Einherjar, Fenris Brood, Rustkin, Clockwork Remnants)
- **Environmental Conditions** with two light hazards (MutagenicSpores DC 8, RealityFlux DC 10)
- **Configuration File** (midgard.json) that fully integrates with v0.19.0a infrastructure

Midgard serves as the **baseline realm** against which all other realms (v0.19.2–v0.19.6) are measured and balanced. Its temperate climate, agricultural abundance, and relatively safe conditions make it the ideal entry point for adventurers into the Nine Realms.

### Key Facts

| Property | Value |
|----------|-------|
| **Deck Number** | 04 |
| **Pre-Glitch Function** | Civilian Habitation & Agricultural Production |
| **Post-Glitch State** | Agricultural heartland; most populous realm |
| **Primary Condition** | None (safe starting area) |
| **Vertical Range** | Z 0 (Ground Level) to Z +1 (Lower Trunk) |
| **Base Temperature** | 18°C (temperate) |
| **Base Light Level** | 0.7 (well-lit, daylight cycle preserved) |
| **Base Aetheric Intensity** | 0.3 (low, stable magic) |
| **Number of Zones** | 4 |
| **Number of Factions** | 4 |
| **Flavor Quote** | "The Wall is the soul of the Hold." |
| **Color Palette** | green-brown-grey-amber |

---

## 2. Feature Overview

```
v0.19.1a Features
└── Midgard Implementation (Deck 04)
    │
    ├── BiomeDefinition
    │   ├── Id: Midgard
    │   ├── Name: "Midgard"
    │   ├── Subtitle: "The Tamed Ruin"
    │   ├── BaseProperties (Temp 18°C, Light 0.7, Aether 0.3, Scale 1.0)
    │   ├── PrimaryCondition: None
    │   ├── VerticalRange: Z 0 to Z +1
    │   ├── FlavorQuote & ColorPalette
    │   └── Lore Integration
    │
    ├── Zone 1: The Greatwood
    │   ├── Light Level Override: 0.4 (canopy coverage)
    │   ├── Humidity Override: 75% (forest moisture)
    │   ├── Environmental Condition: MutagenicSpores (DC 8)
    │   ├── Faction Pools: Fenris Brood, Rustkin
    │   └── Vertical Range: Z 0 to Z +1
    │
    ├── Zone 2: Sun Fields
    │   ├── Override Properties: None (baseline zone)
    │   ├── Environmental Condition: None
    │   ├── Faction Pools: Einherjar, Clockwork Remnants
    │   └── Vertical Range: Z 0 only
    │
    ├── Zone 3: Iron Marches
    │   ├── Corrosion Override: 0.4 (rusted machinery)
    │   ├── Humidity Override: 45% (drier industrial)
    │   ├── Environmental Condition: None
    │   ├── Faction Pools: Clockwork Remnants, Rustkin
    │   └── Vertical Range: Z 0 to Z +1
    │
    ├── Zone 4: The Veil Edge
    │   ├── Aetheric Intensity Override: 0.5 (border effects)
    │   ├── Light Level Override: 0.5 (distortions)
    │   ├── Environmental Condition: RealityFlux (DC 10)
    │   ├── Faction Pools: Fenris Brood
    │   └── Vertical Range: Z 0 to Z +1
    │
    └── Faction Spawn Pools
        ├── Einherjar (30% weight) — Level 1–5
        ├── Fenris Brood (25% weight) — Level 2–6
        ├── Rustkin (25% weight) — Level 1–4
        └── Clockwork Remnants (20% weight) — Level 3–7
```

---

## 3. Architecture Diagrams

### 3.1 Midgard Realm Structure

```
┌──────────────────────────────────────────────────────────────────────┐
│                       MIDGARD REALM (Deck 04)                        │
│                     The Tamed Ruin (Starting Area)                   │
├──────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌────────────────────────────────────────────────────────────────┐  │
│  │              ZONE 1: THE GREATWOOD (NW)                        │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │ Env. Condition: MutagenicSpores (DC 8)                   │  │  │
│  │  │ Light: 0.4 (canopy) | Humidity: 75%                     │  │  │
│  │  │ Factions: Fenris Brood (corrupted wolves)                │  │  │
│  │  │           Rustkin (scavenger clans)                      │  │  │
│  │  │ Vertical: Z 0 → Z +1 (ground to lower trunk)             │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────┘  │
│                                                                       │
│  ┌────────────────────────────────────────────────────────────────┐  │
│  │              ZONE 2: SUN FIELDS (SW) — BASELINE              │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │ Env. Condition: None (safe agricultural heartland)       │  │  │
│  │  │ Properties: Base (Temp 18°C, Light 0.7, Aether 0.3)      │  │  │
│  │  │ Factions: Einherjar (the chosen dead)                    │  │  │
│  │  │           Clockwork Remnants (malfunctioning)            │  │  │
│  │  │ Vertical: Z 0 only (ground level)                        │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────┘  │
│                                                                       │
│  ┌────────────────────────────────────────────────────────────────┐  │
│  │              ZONE 3: IRON MARCHES (SE)                        │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │ Env. Condition: None (scavenger territory)               │  │  │
│  │  │ Corrosion: 0.4 (increased decay) | Humidity: 45%         │  │  │
│  │  │ Factions: Clockwork Remnants (machinery failures)         │  │  │
│  │  │           Rustkin (salvage operations)                   │  │  │
│  │  │ Vertical: Z 0 → Z +1 (ground to lower structures)         │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────┘  │
│                                                                       │
│  ┌────────────────────────────────────────────────────────────────┐  │
│  │              ZONE 4: THE VEIL EDGE (NE)                       │  │
│  │  ┌──────────────────────────────────────────────────────────┐  │  │
│  │  │ Env. Condition: RealityFlux (DC 10) — border effect      │  │  │
│  │  │ Aetheric: 0.5 (elevated) | Light: 0.5 (distorted)        │  │  │
│  │  │ Factions: Fenris Brood (attracted to aetheric)            │  │  │
│  │  │ Vertical: Z 0 → Z +1 (ground to lower structures)         │  │  │
│  │  │ Gateway to Alfheim (reality-warped border)                │  │  │
│  │  └──────────────────────────────────────────────────────────┘  │  │
│  └────────────────────────────────────────────────────────────────┘  │
│                                                                       │
└──────────────────────────────────────────────────────────────────────┘

FACTION SPAWN DISTRIBUTION:
┌───────────────────────────────────────────────────────────────┐
│ Einherjar (30%)           [★★★★★]                            │
│ Fenris Brood (25%)        [★★★★☆]                            │
│ Rustkin (25%)             [★★★★☆]                            │
│ Clockwork Remnants (20%)  [★★★☆☆]                            │
└───────────────────────────────────────────────────────────────┘
```

### 3.2 Property Override Flow

```
           ┌─────────────────────────┐
           │  Base Midgard Props     │
           │ ┌─────────────────────┐ │
           │ │ Temp: 18°C          │ │
           │ │ Light: 0.7          │ │
           │ │ Aether: 0.3         │ │
           │ │ Humidity: 60%       │ │
           │ │ Corrosion: 0.2      │ │
           │ │ Scale: 1.0          │ │
           │ └─────────────────────┘ │
           └────┬────────────────────┘
                │
        ┌───────┴───────┬─────────────┬─────────────┬──────────┐
        │               │             │             │          │
        ▼               ▼             ▼             ▼          ▼
   ┌─────────┐  ┌─────────────┐ ┌───────────┐ ┌──────────┐ ┌──────────┐
   │Greatwood│  │ Sun Fields  │ │Iron March │ │Veil Edge │ │ NO ZONE  │
   └─┬───────┘  └─┬───────────┘ └─┬─────────┘ └────┬─────┘ └──────────┘
     │           │                │                │
     │ Override  │ NO overrides   │ Override       │ Override
     │ Light→0.4 │ (baseline)     │ Corr→0.4       │ Aether→0.5
     │ Humidity→ │                │ Humidity→45%   │ Light→0.5
     │ 75%       │                │                │
     │           │                │                │
     ▼           ▼                ▼                ▼
   EFFECTIVE PROPERTIES AT EACH ZONE

   Greatwood:           Sun Fields:          Iron Marches:       Veil Edge:
   Temp: 18° (base)     Temp: 18°            Temp: 18°           Temp: 18°
   Light: 0.4 ◄──OVR    Light: 0.7           Light: 0.7          Light: 0.5 ◄──OVR
   Aether: 0.3          Aether: 0.3          Aether: 0.3         Aether: 0.5 ◄──OVR
   Humidity: 75% ◄──OVR Humidity: 60%        Humidity: 45% ◄─OVR Humidity: 60%
   Corrosion: 0.2       Corrosion: 0.2       Corrosion: 0.4 ◄─OVR Corrosion: 0.2
   Scale: 1.0           Scale: 1.0           Scale: 1.0          Scale: 1.0
```

### 3.3 Environmental Condition DC Calculation

```
CONDITION DC FORMULA:
DC = BaseDC + ConditionDcModifier

GREATWOOD: MutagenicSpores
├── BaseDC: 12 (from EnvironmentalConditionType.MutagenicSpores)
├── ConditionDcModifier: -4 (Midgard-Greatwood override)
└── EFFECTIVE DC: 12 + (-4) = 8 ✓ (LIGHT hazard)

SUN FIELDS: None
├── No environmental hazard condition
└── DC: N/A (no checks required)

IRON MARCHES: None
├── No environmental hazard condition
└── DC: N/A (no checks required)

VEIL EDGE: RealityFlux
├── BaseDC: 12 (from EnvironmentalConditionType.RealityFlux)
├── ConditionDcModifier: -2 (Midgard-Veil Edge override)
└── EFFECTIVE DC: 12 + (-2) = 10 ✓ (LIGHT hazard)
```

### 3.4 Integration Architecture

```
┌──────────────────────────────────────────────────────────────────┐
│                  v0.19.0a Infrastructure                          │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ IBiomeProvider         IEnvironmentConditionService         │  │
│  │ ├─ GetBiome()         ├─ GetCondition()                     │  │
│  │ ├─ GetZone()          ├─ ApplyCondition()                   │  │
│  │ └─ GetZonesForRealm() └─ CalculateDC()                      │  │
│  └────────────────────────────────────────────────────────────┘  │
└─────────────────────┬──────────────────────────────────────────────┘
                      │
                      ▼
         ┌────────────────────────────┐
         │   loads midgard.json       │
         │   during startup           │
         └────────────────┬───────────┘
                          │
        ┌─────────────────┴──────────────────┐
        ▼                                    ▼
   MIDGARD LOADED                 ZONES LOADED
   ├─ BiomeDefinition             ├─ The Greatwood
   ├─ Base Properties             ├─ Sun Fields
   ├─ Primary Condition: None      ├─ Iron Marches
   └─ Vertical Range: Z 0→Z +1     └─ The Veil Edge
                                        │
                                        ▼
                                   FACTION POOLS AVAILABLE
                                   ├─ Einherjar
                                   ├─ Fenris Brood
                                   ├─ Rustkin
                                   └─ Clockwork Remnants
```

---

## 4. User Stories

### Story 1: Player Enters Midgard

```gherkin
GIVEN a new player character
WHEN they load into the starting realm
THEN Midgard is initialized with all four zones
AND Midgard's base properties are applied (Temp 18°C, Light 0.7, Aether 0.3)
AND no primary condition affects the entire realm
AND the player can safely explore the Sun Fields (baseline zone)
```

### Story 2: Environmental Hazard in Greatwood

```gherkin
GIVEN a player character in The Greatwood zone
WHEN they rest or spend time in that zone
THEN a MutagenicSpores condition check occurs
AND the DC is 8 (base 12, minus 4 modifier)
AND on a failed check, light mutagenic damage is applied
AND the hazard is survivable for new characters (relatively safe)
```

### Story 3: Reality Distortion at Veil Edge

```gherkin
GIVEN a player character at The Veil Edge
WHEN they attempt to navigate or interact with their surroundings
THEN a RealityFlux condition check occurs
AND the DC is 10 (base 12, minus 2 modifier)
AND on a failed check, they become disoriented or confused
AND the hazard hints at the dangers of Alfheim (the next realm)
```

### Story 4: Faction Encounters by Zone

```gherkin
GIVEN a player exploring a specific Midgard zone
WHEN they encounter random faction members
THEN the spawned faction matches that zone's faction pool
EXAMPLES:
  | Zone         | Possible Factions                 |
  | Greatwood    | Fenris Brood, Rustkin             |
  | Sun Fields   | Einherjar, Clockwork Remnants     |
  | Iron Marches | Clockwork Remnants, Rustkin       |
  | Veil Edge    | Fenris Brood (only)               |
```

### Story 5: Game Designer Configures Midgard

```gherkin
GIVEN a game designer with access to midgard.json
WHEN they adjust zone properties or faction weights
THEN the changes propagate automatically to all zones
AND property overrides correctly merge with base values
AND faction spawn weights affect encounter frequency
AND the configuration validates against biomes.schema.json
```

---

## 5. Midgard BiomeDefinition Configuration

### 5.1 Complete BiomeDefinition Entity

```csharp
/// <summary>
/// Represents the Midgard realm (Deck 04: The Tamed Ruin).
/// Serves as the baseline realm and starting area for all players.
///
/// Midgard is characterized by:
/// - Temperate climate (18°C baseline)
/// - Agricultural heartland with scattered ruins
/// - Relatively safe compared to other realms
/// - Four distinct sub-zones with unique properties and hazards
/// - Four dominant factions with varying threat levels
/// </summary>
public class BiomeDefinition
{
    /// <summary>
    /// Unique identifier: RealmId.Midgard (value: 4, corresponding to Deck 04)
    /// </summary>
    public RealmId Id { get; set; } = RealmId.Midgard;

    /// <summary>
    /// Display name: "Midgard" (Norse mythology: realm of humans)
    /// </summary>
    public string Name { get; set; } = "Midgard";

    /// <summary>
    /// Subtitle: "The Tamed Ruin"
    /// Reflects post-Glitch state: civilization's stabilization in ruins
    /// </summary>
    public string Subtitle { get; set; } = "The Tamed Ruin";

    /// <summary>
    /// Deck number: 4 (physical deck in tarot-like system)
    /// </summary>
    public int DeckNumber { get; set; } = 4;

    /// <summary>
    /// Pre-Glitch function: "Civilian Habitation & Agricultural Production"
    /// Describes original purpose before catastrophic event
    /// </summary>
    public string PreGlitchFunction { get; set; } =
        "Civilian Habitation & Agricultural Production";

    /// <summary>
    /// Post-Glitch state: "Agricultural heartland; most populous realm;
    /// foundation of post-Glitch civilization"
    /// Describes current state and role in Aethelgard
    /// </summary>
    public string PostGlitchState { get; set; } =
        "Agricultural heartland; most populous realm; foundation of post-Glitch civilization";

    /// <summary>
    /// Base environmental properties applied to all zones (unless overridden)
    /// These represent Midgard's temperate, stable baseline conditions
    /// </summary>
    public BiomeProperties BaseProperties { get; set; } = new BiomeProperties
    {
        TemperatureCelsius = 18,      // Temperate baseline
        AethericIntensity = 0.3f,     // Low, stable magic
        HumidityPercent = 60,          // Moderate moisture
        LightLevel = 0.7f,             // Well-lit (daylight preserved)
        ScaleFactor = 1.0f,            // Human-scale baseline
        CorrosionRate = 0.2f           // Low decay rate
    };

    /// <summary>
    /// Primary environmental condition affecting the entire realm.
    /// Midgard has no primary condition (safe starting area).
    /// Individual zones may have their own override conditions.
    /// </summary>
    public EnvironmentalConditionType PrimaryCondition { get; set; } =
        EnvironmentalConditionType.None;

    /// <summary>
    /// Minimum vertical zone: GroundLevel (Z = 0)
    /// Players can explore ground-level rooms
    /// </summary>
    public VerticalZone MinVerticalZone { get; set; } = VerticalZone.GroundLevel;

    /// <summary>
    /// Maximum vertical zone: LowerTrunk (Z = +1)
    /// Players can access lower structural levels (buildings, trees, ruins)
    /// </summary>
    public VerticalZone MaxVerticalZone { get; set; } = VerticalZone.LowerTrunk;

    /// <summary>
    /// Cultural flavor quote capturing Midgard's essence
    /// Reference to "The Wall" (fortifications that define Hold identity)
    /// </summary>
    public string FlavorQuote { get; set; } = "The Wall is the soul of the Hold.";

    /// <summary>
    /// Color palette: "green-brown-grey-amber"
    /// Green: vegetation, forests (The Greatwood)
    /// Brown: earth, natural tones
    /// Grey: stone, ruins, decay
    /// Amber: warmth, agriculture, civilization
    /// </summary>
    public string ColorPalette { get; set; } = "green-brown-grey-amber";

    /// <summary>
    /// Collection of four sub-zones, each with distinct characteristics
    /// </summary>
    public IList<BiomeZone> Zones { get; set; } = new List<BiomeZone>();
}
```

### 5.2 JSON Configuration (midgard.json)

```json
{
  "biome": {
    "id": "Midgard",
    "name": "Midgard",
    "subtitle": "The Tamed Ruin",
    "deckNumber": 4,
    "preGlitchFunction": "Civilian Habitation & Agricultural Production",
    "postGlitchState": "Agricultural heartland; most populous realm; foundation of post-Glitch civilization",
    "baseProperties": {
      "temperatureCelsius": 18,
      "aethericIntensity": 0.3,
      "humidityPercent": 60,
      "lightLevel": 0.7,
      "scaleFactor": 1.0,
      "corrosionRate": 0.2
    },
    "primaryCondition": "None",
    "minVerticalZone": 0,
    "maxVerticalZone": 1,
    "flavorQuote": "The Wall is the soul of the Hold.",
    "colorPalette": "green-brown-grey-amber",
    "zones": [
      {
        "id": "greatwood",
        "name": "The Greatwood",
        "description": "Ancient forest with bio-engineered remnants from Vanaheim. Canopy coverage reduces light, humidity increases. Light mutagenic spore presence poses minimal threat to prepared adventurers.",
        "overrideProperties": {
          "lightLevel": 0.4,
          "humidityPercent": 75
        },
        "overrideCondition": "MutagenicSpores",
        "conditionDcModifier": -4,
        "factionPools": ["fenris-brood", "rustkin"],
        "minVerticalZone": 0,
        "maxVerticalZone": 1
      },
      {
        "id": "sun-fields",
        "name": "The Sun Fields",
        "description": "Agricultural heartland of Midgard. Golden wheat fields stretch between scattered ruins. Well-patrolled by Hold militias, relatively safe for new explorers.",
        "overrideProperties": null,
        "overrideCondition": null,
        "conditionDcModifier": 0,
        "factionPools": ["einherjar", "clockwork-remnants"],
        "minVerticalZone": 0,
        "maxVerticalZone": 0
      },
      {
        "id": "iron-marches",
        "name": "The Iron Marches",
        "description": "Industrial ruins from the pre-Glitch era. Rusted machinery, collapsed factories, and scavenger camps dominate the landscape. Higher corrosion rates damage equipment over time.",
        "overrideProperties": {
          "corrosionRate": 0.4,
          "humidityPercent": 45
        },
        "overrideCondition": null,
        "conditionDcModifier": 0,
        "factionPools": ["clockwork-remnants", "rustkin"],
        "minVerticalZone": 0,
        "maxVerticalZone": 1
      },
      {
        "id": "veil-edge",
        "name": "The Veil Edge",
        "description": "Border zone approaching Alfheim. Reality begins to warp, colors shift, and the air tastes of ozone. Light reality distortions affect navigation and perception. Gateway to the Glimmering Wound.",
        "overrideProperties": {
          "aethericIntensity": 0.5,
          "lightLevel": 0.5
        },
        "overrideCondition": "RealityFlux",
        "conditionDcModifier": -2,
        "factionPools": ["fenris-brood"],
        "minVerticalZone": 0,
        "maxVerticalZone": 1
      }
    ]
  },
  "factionSpawnPools": {
    "einherjar": {
      "factionId": "einherjar",
      "displayName": "Einherjar",
      "description": "The Chosen Dead - warriors chosen by fate to defend Midgard's holds",
      "baseSpawnWeight": 30,
      "threatLevel": "low-to-medium",
      "levelRange": {
        "min": 1,
        "max": 5
      },
      "monsterIds": [
        "einherjar-warrior",
        "einherjar-scout",
        "einherjar-captain"
      ]
    },
    "fenris-brood": {
      "factionId": "fenris-brood",
      "displayName": "Fenris Brood",
      "description": "Corrupted wolves attracted to aetheric disturbances; dangerous pack hunters",
      "baseSpawnWeight": 25,
      "threatLevel": "medium",
      "levelRange": {
        "min": 2,
        "max": 6
      },
      "monsterIds": [
        "fenris-whelp",
        "fenris-hunter",
        "fenris-alpha"
      ]
    },
    "rustkin": {
      "factionId": "rustkin",
      "displayName": "Rustkin",
      "description": "Scavenger clans of humanoid creatures salvaging pre-Glitch technology",
      "baseSpawnWeight": 25,
      "threatLevel": "low",
      "levelRange": {
        "min": 1,
        "max": 4
      },
      "monsterIds": [
        "rustkin-scavenger",
        "rustkin-tinker",
        "rustkin-chieftain"
      ]
    },
    "clockwork-remnants": {
      "factionId": "clockwork-remnants",
      "displayName": "Clockwork Remnants",
      "description": "Malfunctioning automatons from pre-Glitch industry; unpredictable and dangerous",
      "baseSpawnWeight": 20,
      "threatLevel": "medium-to-high",
      "levelRange": {
        "min": 3,
        "max": 7
      },
      "monsterIds": [
        "clockwork-drone",
        "clockwork-sentinel",
        "clockwork-overseer"
      ]
    }
  }
}
```

---

## 6. Zone Specifications

### 6.1 Zone 1: The Greatwood

| Property | Value | Notes |
|----------|-------|-------|
| **Zone ID** | `greatwood` | Unique identifier within Midgard |
| **Display Name** | The Greatwood | Player-facing name |
| **Parent Realm** | Midgard | Always Midgard for this implementation |
| **Description** | Ancient forest with bio-engineered remnants from Vanaheim | Thematic/flavor text |
| **Light Level Override** | 0.4 | Canopy blocks 60% of light (0.7 → 0.4) |
| **Humidity Override** | 75% | Forest moisture increases from 60% base |
| **Aetheric Intensity** | 0.3 (base) | No override; uses base value |
| **Temperature** | 18°C (base) | No override; temperate |
| **Corrosion Rate** | 0.2 (base) | No override; minimal decay |
| **Environmental Condition** | MutagenicSpores | Light hazard; flora-based danger |
| **Condition DC Modifier** | -4 | DC = 12 - 4 = 8 (light difficulty) |
| **Faction Pools** | Fenris Brood, Rustkin | Pack hunters + scavengers |
| **Vertical Range** | Z 0 → Z +1 | Ground level to lower trunk (trees) |
| **Threat Level** | Low-Medium | Suitable for new characters with caution |

**Lore Notes:**
- Spillover from Vanaheim's bio-engineering labs (three decks higher in aetheric intensity)
- Fenris Brood attracted to elevated aetheric levels relative to baseline
- Rustkin harvest forest resources and fallen creatures
- MutagenicSpores are "light" (DC 8) because Vanaheim's main (primary) condition is much harsher

**Property Merge Example:**
```json
{
  "temperatureCelsius": 18,
  "aethericIntensity": 0.3,
  "humidityPercent": 75,        // ◄ OVERRIDDEN
  "lightLevel": 0.4,             // ◄ OVERRIDDEN
  "scaleFactor": 1.0,
  "corrosionRate": 0.2
}
```

### 6.2 Zone 2: Sun Fields

| Property | Value | Notes |
|----------|-------|-------|
| **Zone ID** | `sun-fields` | Unique identifier within Midgard |
| **Display Name** | The Sun Fields | Player-facing name |
| **Parent Realm** | Midgard | Always Midgard for this implementation |
| **Description** | Agricultural heartland of the realm | Thematic/flavor text |
| **Light Level** | 0.7 (base) | Full daylight; no override |
| **Humidity** | 60% (base) | Temperate moisture; no override |
| **Aetheric Intensity** | 0.3 (base) | Low, stable magic; no override |
| **Temperature** | 18°C (base) | Temperate; no override |
| **Corrosion Rate** | 0.2 (base) | Low decay; no override |
| **Environmental Condition** | None | Completely safe zone |
| **Condition DC Modifier** | 0 | No hazard |
| **Faction Pools** | Einherjar, Clockwork Remnants | Warriors + machines |
| **Vertical Range** | Z 0 only | Ground level (no structures) |
| **Threat Level** | Very Low | Safest zone; ideal for low-level players |

**Lore Notes:**
- Baseline zone representing Midgard at its most stable and civilized
- Einherjar maintain order and protect agricultural infrastructure
- Clockwork Remnants may be present due to pre-Glitch automated farming systems
- Primary setting for Hold economies and trade

**Property Merge Example:**
```json
{
  "temperatureCelsius": 18,
  "aethericIntensity": 0.3,
  "humidityPercent": 60,
  "lightLevel": 0.7,
  "scaleFactor": 1.0,
  "corrosionRate": 0.2
  // NO OVERRIDES — ALL BASE VALUES
}
```

### 6.3 Zone 3: Iron Marches

| Property | Value | Notes |
|----------|-------|-------|
| **Zone ID** | `iron-marches` | Unique identifier within Midgard |
| **Display Name** | The Iron Marches | Player-facing name |
| **Parent Realm** | Midgard | Always Midgard for this implementation |
| **Description** | Industrial ruins from pre-Glitch era | Thematic/flavor text |
| **Light Level** | 0.7 (base) | No shadows from structures; no override |
| **Humidity** | 45% | Drier than base (60% → 45%); industrial environment |
| **Aetheric Intensity** | 0.3 (base) | No override; low magic |
| **Temperature** | 18°C (base) | No override; temperate |
| **Corrosion Rate** | 0.4 | DOUBLED from base (0.2 → 0.4) due to rust |
| **Environmental Condition** | None | Industrial hazard (rust/decay) not governed by condition system |
| **Condition DC Modifier** | 0 | No environmental condition |
| **Faction Pools** | Clockwork Remnants, Rustkin | Machines + scavengers |
| **Vertical Range** | Z 0 → Z +1 | Ground + lower structures (buildings, ruins) |
| **Threat Level** | Low-Medium | Equipment damage a concern |

**Lore Notes:**
- Pre-Glitch factories and manufacturing plants
- High corrosion represents rust and machinery decay
- Clockwork Remnants may still operate damaged automated systems
- Rustkin extract valuable salvage from industrial ruins
- Players' equipment takes increased damage in this zone

**Property Merge Example:**
```json
{
  "temperatureCelsius": 18,
  "aethericIntensity": 0.3,
  "humidityPercent": 45,        // ◄ OVERRIDDEN
  "lightLevel": 0.7,
  "scaleFactor": 1.0,
  "corrosionRate": 0.4           // ◄ OVERRIDDEN
}
```

### 6.4 Zone 4: The Veil Edge

| Property | Value | Notes |
|----------|-------|-------|
| **Zone ID** | `veil-edge` | Unique identifier within Midgard |
| **Display Name** | The Veil Edge | Player-facing name |
| **Parent Realm** | Midgard | Always Midgard for this implementation |
| **Description** | Border zone approaching Alfheim; reality warps | Thematic/flavor text |
| **Light Level** | 0.5 | REDUCED due to distortions (0.7 → 0.5) |
| **Humidity** | 60% (base) | No override; normal moisture |
| **Aetheric Intensity** | 0.5 | INCREASED from base (0.3 → 0.5); Alfheim spillover |
| **Temperature** | 18°C (base) | No override; still temperate |
| **Corrosion Rate** | 0.2 (base) | No override; standard decay |
| **Environmental Condition** | RealityFlux | Aetheric distortions; light hazard |
| **Condition DC Modifier** | -2 | DC = 12 - 2 = 10 (light difficulty) |
| **Faction Pools** | Fenris Brood (only) | Pack hunters attracted to aetheric disturbances |
| **Vertical Range** | Z 0 → Z +1 | Ground + lower structures |
| **Threat Level** | Medium | Hazard escalation; hints at higher-realm dangers |

**Lore Notes:**
- Border between Midgard and Alfheim (Deck 02)
- Elevated aetheric intensity (0.5) halfway to Alfheim's level
- Reality distortions make navigation and perception difficult
- Only Fenris Brood spawns here (they thrive in aetheric chaos)
- Gateway zone preparing players for realm transitions

**Property Merge Example:**
```json
{
  "temperatureCelsius": 18,
  "aethericIntensity": 0.5,      // ◄ OVERRIDDEN
  "humidityPercent": 60,
  "lightLevel": 0.5,              // ◄ OVERRIDDEN
  "scaleFactor": 1.0,
  "corrosionRate": 0.2
}
```

---

## 7. Faction Spawn Pool Configuration

### 7.1 Faction Pool: Einherjar

```json
{
  "factionId": "einherjar",
  "displayName": "Einherjar",
  "description": "The Chosen Dead - warriors of legend chosen by fate to defend Midgard's holds",
  "baseSpawnWeight": 30,
  "threatLevel": "low-to-medium",
  "levelRange": {
    "min": 1,
    "max": 5
  },
  "monsterIds": [
    "einherjar-warrior",
    "einherjar-scout",
    "einherjar-captain"
  ]
}
```

**Characteristics:**
- Highest spawn weight (30%) — most common faction in Midgard
- Level range: 1–5 (suitable for progression from novice to intermediate)
- Threat: Low-to-Medium (trained warriors but outnumbered players have a chance)
- Primary zones: Sun Fields (safe baseline area)
- Lore: Chosen dead warriors who defend civilization; generally ordered and tactical

### 7.2 Faction Pool: Fenris Brood

```json
{
  "factionId": "fenris-brood",
  "displayName": "Fenris Brood",
  "description": "Corrupted wolves attracted to aetheric disturbances; dangerous pack hunters",
  "baseSpawnWeight": 25,
  "threatLevel": "medium",
  "levelRange": {
    "min": 2,
    "max": 6
  },
  "monsterIds": [
    "fenris-whelp",
    "fenris-hunter",
    "fenris-alpha"
  ]
}
```

**Characteristics:**
- Spawn weight: 25% (common, but less than Einherjar)
- Level range: 2–6 (slightly higher baseline than Einherjar)
- Threat: Medium (pack tactics, unpredictable)
- Primary zones: The Greatwood (elevated humidity/mist), The Veil Edge (aetheric spillover)
- Lore: Corrupted by Glitch fallout; attracted to aetheric disturbances; hunt in packs

### 7.3 Faction Pool: Rustkin

```json
{
  "factionId": "rustkin",
  "displayName": "Rustkin",
  "description": "Scavenger clans of humanoid creatures salvaging pre-Glitch technology",
  "baseSpawnWeight": 25,
  "threatLevel": "low",
  "levelRange": {
    "min": 1,
    "max": 4
  },
  "monsterIds": [
    "rustkin-scavenger",
    "rustkin-tinker",
    "rustkin-chieftain"
  ]
}
```

**Characteristics:**
- Spawn weight: 25% (equal to Fenris Brood)
- Level range: 1–4 (slightly lower than other factions; less dangerous overall)
- Threat: Low (scavengers; usually non-hostile unless provoked)
- Primary zones: The Greatwood (forest resources), Iron Marches (salvage operations)
- Lore: Humanoid scavengers focused on harvesting pre-Glitch technology and resources; tribal structure

### 7.4 Faction Pool: Clockwork Remnants

```json
{
  "factionId": "clockwork-remnants",
  "displayName": "Clockwork Remnants",
  "description": "Malfunctioning automatons from pre-Glitch industry; unpredictable and dangerous",
  "baseSpawnWeight": 20,
  "threatLevel": "medium-to-high",
  "levelRange": {
    "min": 3,
    "max": 7
  },
  "monsterIds": [
    "clockwork-drone",
    "clockwork-sentinel",
    "clockwork-overseer"
  ]
}
```

**Characteristics:**
- Spawn weight: 20% (lowest of the four; rarest encounters)
- Level range: 3–7 (highest average level; most dangerous)
- Threat: Medium-to-High (unpredictable AI, potentially lethal)
- Primary zones: Sun Fields (automated farming systems), Iron Marches (active machinery)
- Lore: Pre-Glitch automatons running degraded or corrupted programming; increasingly dangerous as they malfunction

### 7.5 Faction Distribution by Zone

```
ZONE                FACTIONS                              TOTAL WEIGHT
────────────────────────────────────────────────────────────────────────
The Greatwood       Fenris Brood (25%) + Rustkin (25%)     50 weight
Sun Fields          Einherjar (30%) + Clockwork (20%)      50 weight
Iron Marches        Clockwork (20%) + Rustkin (25%)        45 weight
The Veil Edge       Fenris Brood (25%) only                25 weight*

*Veil Edge has lower total weight because only one faction spawns there.
 When normalizing within-zone probabilities, Fenris would have 100% chance
 in Veil Edge specifically.
```

---

## 8. Environmental Condition Integration

### 8.1 MutagenicSpores (Greatwood)

**Condition Definition (from v0.19.0a):**
```csharp
public class EnvironmentalCondition
{
    public EnvironmentalConditionType Type { get; set; } =
        EnvironmentalConditionType.MutagenicSpores;
    public string DisplayName { get; set; } = "Mutagenic Spores";
    public string Description { get; set; } =
        "Light exposure to bio-engineered spores from Vanaheim spillover. " +
        "Causes minor mutations and physical distress.";
    public DiceResult DamageRoll { get; set; } = new DiceResult(1, 6); // 1d6
    public DamageType DamageType { get; set; } = DamageType.Poison;
    public int BaseDc { get; set; } = 12;
    public string CheckAttribute { get; set; } = "Constitution";
    public ConditionFrequency Frequency { get; set; } = ConditionFrequency.PerRest;
}
```

**Midgard Override (DC Adjustment):**
```
BaseDC: 12 (from condition definition)
ConditionDcModifier: -4 (Midgard-Greatwood zone override)
────────────────────────
EFFECTIVE DC: 8
────────────────────────
DIFFICULTY: Light (CR ≈ 1/8)
```

**Mechanical Effect:**
- Player makes Constitution check (DC 8) when resting in The Greatwood
- **Success:** No damage; spores don't affect the character
- **Failure:** Takes 1d6 poison damage; minor mutations (cosmetic, temporary)
- **Frequency:** Once per rest period (not per turn)

**Narrative Effect:**
- Vision sharpens slightly (spore-induced neural enhancement)
- Skin develops temporary iridescent sheen
- Character may experience mild itching or numbness
- Effects wear off after 1d4 hours of rest outside the zone

---

### 8.2 RealityFlux (The Veil Edge)

**Condition Definition (from v0.19.0a):**
```csharp
public class EnvironmentalCondition
{
    public EnvironmentalConditionType Type { get; set; } =
        EnvironmentalConditionType.RealityFlux;
    public string DisplayName { get; set; } = "Reality Flux";
    public string Description { get; set; } =
        "Aetheric distortions warp perception and navigation. " +
        "Reality seems fluid and malleable at the Alfheim border.";
    public DiceResult DamageRoll { get; set; } = new DiceResult(1, 4); // 1d4
    public DamageType DamageType { get; set; } = DamageType.Psychic;
    public int BaseDc { get; set; } = 12;
    public string CheckAttribute { get; set; } = "Wisdom";
    public ConditionFrequency Frequency { get; set; } = ConditionFrequency.PerTurn;
}
```

**Midgard Override (DC Adjustment):**
```
BaseDC: 12 (from condition definition)
ConditionDcModifier: -2 (Midgard-Veil Edge zone override)
────────────────────────
EFFECTIVE DC: 10
────────────────────────
DIFFICULTY: Light (CR ≈ 1/4)
```

**Mechanical Effect:**
- Player makes Wisdom check (DC 10) at the start of their turn in The Veil Edge
- **Success:** Character remains oriented; can act normally
- **Failure:** Takes 1d4 psychic damage; becomes disoriented (disadvantage on navigation checks)
- **Frequency:** Once per turn (active during exploration)

**Narrative Effect:**
- Colors shift and shimmer unpredictably (reds becoming blues)
- Distances appear compressed or stretched
- Character may experience dizziness or vertigo
- Shadows move independently of their sources
- Disorientation can cause "wrong turns" or unexpected encounters

---

## 9. Property Override Mechanics

### 9.1 Property Merge Algorithm

```csharp
/// <summary>
/// Merges base biome properties with zone-specific overrides.
/// Zone overrides take precedence over base values.
/// Properties not specified in zone override use base values.
/// </summary>
public BiomeProperties GetEffectiveProperties(
    BiomeDefinition biome,
    BiomeZone zone)
{
    var baseProps = biome.BaseProperties;
    var zoneOverrides = zone.OverrideProperties;

    // If zone has no overrides, return base as-is
    if (zoneOverrides == null)
    {
        return baseProps;
    }

    // Merge: overrides take precedence
    return new BiomeProperties
    {
        TemperatureCelsius = zoneOverrides.TemperatureCelsius ?? baseProps.TemperatureCelsius,
        AethericIntensity = zoneOverrides.AethericIntensity ?? baseProps.AethericIntensity,
        HumidityPercent = zoneOverrides.HumidityPercent ?? baseProps.HumidityPercent,
        LightLevel = zoneOverrides.LightLevel ?? baseProps.LightLevel,
        ScaleFactor = zoneOverrides.ScaleFactor ?? baseProps.ScaleFactor,
        CorrosionRate = zoneOverrides.CorrosionRate ?? baseProps.CorrosionRate
    };
}
```

### 9.2 Property Override Examples

**EXAMPLE 1: The Greatwood (Light & Humidity Override)**
```
Base Properties:                Zone Override:
├─ Temp: 18°C                   ├─ Light: 0.4 (canopy block)
├─ Light: 0.7                   └─ Humidity: 75% (forest)
├─ Aether: 0.3
├─ Humidity: 60%                Result (Merged):
├─ Scale: 1.0                   ├─ Temp: 18° (base, no override)
└─ Corrosion: 0.2               ├─ Light: 0.4 (overridden)
                                ├─ Aether: 0.3 (base, no override)
                                ├─ Humidity: 75% (overridden)
                                ├─ Scale: 1.0 (base, no override)
                                └─ Corrosion: 0.2 (base, no override)
```

**EXAMPLE 2: Sun Fields (No Overrides)**
```
Base Properties:                Zone Override:
├─ Temp: 18°C                   └─ null (no overrides)
├─ Light: 0.7
├─ Aether: 0.3                  Result (Merged):
├─ Humidity: 60%                ├─ Temp: 18° (base)
├─ Scale: 1.0                   ├─ Light: 0.7 (base)
└─ Corrosion: 0.2               ├─ Aether: 0.3 (base)
                                ├─ Humidity: 60% (base)
                                ├─ Scale: 1.0 (base)
                                └─ Corrosion: 0.2 (base)
```

**EXAMPLE 3: Iron Marches (Corrosion & Humidity Override)**
```
Base Properties:                Zone Override:
├─ Temp: 18°C                   ├─ Corrosion: 0.4 (rust increase)
├─ Light: 0.7                   └─ Humidity: 45% (industrial dry)
├─ Aether: 0.3
├─ Humidity: 60%                Result (Merged):
├─ Scale: 1.0                   ├─ Temp: 18° (base, no override)
└─ Corrosion: 0.2               ├─ Light: 0.7 (base, no override)
                                ├─ Aether: 0.3 (base, no override)
                                ├─ Humidity: 45% (overridden)
                                ├─ Scale: 1.0 (base, no override)
                                └─ Corrosion: 0.4 (overridden)
```

**EXAMPLE 4: The Veil Edge (Aether & Light Override)**
```
Base Properties:                Zone Override:
├─ Temp: 18°C                   ├─ Aether: 0.5 (Alfheim spillover)
├─ Light: 0.7                   └─ Light: 0.5 (distortion)
├─ Aether: 0.3
├─ Humidity: 60%                Result (Merged):
├─ Scale: 1.0                   ├─ Temp: 18° (base, no override)
└─ Corrosion: 0.2               ├─ Light: 0.5 (overridden)
                                ├─ Aether: 0.5 (overridden)
                                ├─ Humidity: 60% (base, no override)
                                ├─ Scale: 1.0 (base, no override)
                                └─ Corrosion: 0.2 (base, no override)
```

### 9.3 Condition DC Modifier Calculation

```csharp
/// <summary>
/// Calculates the effective Difficulty Class for an environmental condition
/// within a specific zone. Zone modifiers adjust the base DC to reflect
/// local conditions that mitigate or exacerbate the hazard.
/// </summary>
public int CalculateEffectiveDC(
    EnvironmentalCondition condition,
    BiomeZone zone)
{
    int baseDC = condition.BaseDc;  // Typically 12
    int modifier = zone.ConditionDcModifier;  // Negative = easier, Positive = harder

    return baseDC + modifier;

    // Examples:
    // Greatwood MutagenicSpores: 12 + (-4) = 8 (light hazard)
    // Veil Edge RealityFlux: 12 + (-2) = 10 (light hazard)
}
```

**Modifier Rationale:**
- **Greatwood (-4):** Midgard's lower aetheric intensity significantly reduces Vanaheim spillover
- **Veil Edge (-2):** Alfheim's reality distortions are present but not overwhelming in border regions
- **Sun Fields (0):** No condition; modifier irrelevant
- **Iron Marches (0):** Corrosion is environmental, not a "condition" in the game sense

---

## 10. JSON Schema Compliance

### 10.1 Schema Validation Rules

The `midgard.json` configuration must validate against `biomes.schema.json` (from v0.19.0a).

**Key Schema Requirements:**

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "biome": {
      "type": "object",
      "required": ["id", "name", "subtitle", "deckNumber", "baseProperties", "zones"],
      "properties": {
        "id": { "type": "string", "enum": ["Asgard", "Alfheim", "Vanaheim", "Midgard", ...] },
        "name": { "type": "string" },
        "subtitle": { "type": "string" },
        "deckNumber": { "type": "integer", "minimum": 1, "maximum": 9 },
        "baseProperties": {
          "type": "object",
          "required": ["temperatureCelsius", "aethericIntensity", "humidityPercent", "lightLevel", "scaleFactor", "corrosionRate"],
          "properties": {
            "temperatureCelsius": { "type": "integer" },
            "aethericIntensity": { "type": "number", "minimum": 0, "maximum": 1 },
            "humidityPercent": { "type": "integer", "minimum": 0, "maximum": 100 },
            "lightLevel": { "type": "number", "minimum": 0, "maximum": 1 },
            "scaleFactor": { "type": "number", "minimum": 0.1, "maximum": 10 },
            "corrosionRate": { "type": "number", "minimum": 0, "maximum": 1 }
          }
        },
        "zones": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["id", "name", "factionPools"],
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" },
              "overrideProperties": { "type": ["object", "null"] },
              "overrideCondition": { "type": ["string", "null"] },
              "conditionDcModifier": { "type": "integer" },
              "factionPools": { "type": "array", "items": { "type": "string" } }
            }
          }
        }
      }
    },
    "factionSpawnPools": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "required": ["factionId", "displayName", "baseSpawnWeight", "monsterIds"],
        "properties": {
          "factionId": { "type": "string" },
          "displayName": { "type": "string" },
          "baseSpawnWeight": { "type": "integer", "minimum": 1 },
          "monsterIds": { "type": "array", "items": { "type": "string" } }
        }
      }
    }
  }
}
```

### 10.2 Validation Checklist

Before deployment, `midgard.json` must pass:

- [ ] All required fields present (id, name, subtitle, deckNumber, baseProperties, zones)
- [ ] DeckNumber = 4 (Midgard is Deck 04)
- [ ] BaseProperties all within valid ranges:
  - [ ] TemperatureCelsius: valid integer (18°C ✓)
  - [ ] AethericIntensity: 0.0–1.0 (0.3 ✓)
  - [ ] HumidityPercent: 0–100 (60% ✓)
  - [ ] LightLevel: 0.0–1.0 (0.7 ✓)
  - [ ] ScaleFactor: ≥0.1 (1.0 ✓)
  - [ ] CorrosionRate: 0.0–1.0 (0.2 ✓)
- [ ] PrimaryCondition: "None" (not a list; Midgard has no realm-wide hazard)
- [ ] VerticalZone range: MinVerticalZone ≤ MaxVerticalZone (0 ≤ 1 ✓)
- [ ] Exactly 4 zones with unique IDs: [greatwood, sun-fields, iron-marches, veil-edge]
- [ ] Each zone has valid overrideProperties (null or object, no invalid types)
- [ ] Each zone has valid overrideCondition ("None", "MutagenicSpores", "RealityFlux", or null)
- [ ] Each zone has valid ConditionDcModifier (integer)
- [ ] Each zone has valid factionPools array (non-empty, valid faction IDs)
- [ ] All factionSpawnPools referenced in zones exist in the pools section
- [ ] Spawn weights for factions sum to reasonable total (100 in this case)

---

## 11. Decision Tree / Flowcharts

### 11.1 Zone Selection Flowchart

```
┌─────────────────────────────────────────┐
│   Player Enters Midgard                  │
└────────────┬────────────────────────────┘
             │
             ▼
    ┌─────────────────────┐
    │ Which Zone?         │
    └────┬┬────┬┬────────┘
         ││    ││
    ┌────┘│    │└─────┐       ┌─────────┐
    │     │    │      │       │         │
    ▼     ▼    ▼      ▼       ▼         ▼
  ┌──────────────────────┐ ┌──────────────────┐
  │ Greatwood, Iron, etc │ │  Sun Fields      │
  │ has override props   │ │  (no overrides)  │
  └──┬──────────────────┘ └────┬─────────────┘
     │                         │
     ▼                         ▼
  Apply Zone         Use Base Properties
  Overrides          ├─ Temp: 18°
  ├─ Greatwood:     ├─ Light: 0.7
  │  Light: 0.4     ├─ Aether: 0.3
  │  Humidity: 75   ├─ Humidity: 60
  ├─ Iron Marches:  ├─ Scale: 1.0
  │  Corrosion: 0.4 └─ Corrosion: 0.2
  │  Humidity: 45
  ├─ Veil Edge:
  │  Aether: 0.5
  │  Light: 0.5
  └─ Iron Marches: (continue...)

              │                  │
              └─────────┬────────┘
                        │
                        ▼
            ┌──────────────────────┐
            │ Has Environmental    │
            │ Condition?           │
            └───┬────────────┬─────┘
                │            │
            YES │            │ NO
                ▼            ▼
        ┌──────────────┐  ┌───────┐
        │ Apply        │  │  Safe │
        │ Condition:   │  │  Zone │
        │ MutagenicS.. │  └───────┘
        │ or Reality.. │
        └──────────────┘
```

### 11.2 Environmental Hazard Resolution

```
┌──────────────────────────────────────────────┐
│ Character Spends Time in Hazardous Zone      │
│ (Greatwood OR Veil Edge)                     │
└────────────────┬─────────────────────────────┘
                 │
         ┌───────┴────────┐
         │                │
    GREATWOOD          VEIL EDGE
    │                  │
    ▼                  ▼
MUTAGENIC SPORES   REALITY FLUX
├─ Check Attr:     ├─ Check Attr:
│  Constitution    │  Wisdom
├─ DC: 8           ├─ DC: 10
├─ Damage: 1d6     ├─ Damage: 1d4
│  poison          │  psychic
└─ Freq: Per Rest  └─ Freq: Per Turn
    │                  │
    ├─Success?         ├─Success?
    │ ├─ YES: Safe     │ ├─ YES: Normal action
    │ └─ NO:  1d6 DMG  │ └─ NO:  1d4 DMG +
    │                  │        Disoriented
    └──────┬───────────┘
           │
           ▼
    Apply Condition:
    ├─ Gain condition
    │  (temporary)
    ├─ Update HP
    └─ Continue exploring
```

### 11.3 Faction Spawn Decision Tree

```
┌────────────────────────────┐
│ Determine Encounter Zone   │
└────┬───────────┬───────┬───┬─────────┐
     │           │       │   │         │
  GREATWOOD   SUN FIELDS IRON VEIL  NO ZONE
     │           │     MARCHES│        │
     ▼           ▼       ▼    ▼        ▼
┌─────────────────────────────────────────┐
│ Look Up Zone Faction Pool               │
├─────────────────────────────────────────┤
│ Greatwood → [fenris-brood, rustkin]     │
│ Sun Fields → [einherjar, clockwork-...]  │
│ Iron Marches → [clockwork, rustkin]     │
│ Veil Edge → [fenris-brood] (mono)       │
│ No Zone → [all factions] (error)        │
└────┬────────────────────────────────────┘
     │
     ▼
┌─────────────────────────────────────────┐
│ Roll Encounter Creature Type            │
│ (Roll d100 against spawn weights)       │
├─────────────────────────────────────────┤
│ Sun Fields Example:                     │
│ ├─ 1–30: Einherjar (30%)                │
│ ├─ 31–50: Clockwork Rem. (20%)          │
│ └─ 51–100: [weighted toward first]      │
└────┬────────────────────────────────────┘
     │
     ▼
┌─────────────────────────────────────────┐
│ Select Specific Monster                 │
│ (Roll within faction pool)              │
├─────────────────────────────────────────┤
│ Einherjar Pool:                         │
│ ├─ einherjar-warrior (1–3)              │
│ ├─ einherjar-scout (4–6)                │
│ └─ einherjar-captain (7–10)             │
└────┬────────────────────────────────────┘
     │
     ▼
┌─────────────────────────────────────────┐
│ Generate Monster Instance               │
│ ├─ Level: Within zone range             │
│ ├─ Stats: Faction base + variance       │
│ └─ Spawn in zone                        │
└─────────────────────────────────────────┘
```

---

## 12. C# Implementation Examples

### 12.1 BiomeProvider Service (Loading midgard.json)

```csharp
/// <summary>
/// Service responsible for loading biome configurations from JSON files
/// and providing access to realm definitions and zones.
///
/// This implementation loads all realms from disk once at startup and
/// caches them for efficient access during gameplay.
/// </summary>
public class BiomeProvider : IBiomeProvider
{
    private readonly ILogger<BiomeProvider> _logger;
    private readonly string _biomesConfigPath;
    private readonly Dictionary<RealmId, BiomeDefinition> _biomeCache;
    private readonly Dictionary<RealmId, List<BiomeZone>> _zoneCache;

    public BiomeProvider(
        ILogger<BiomeProvider> logger,
        string biomesConfigPath = "config/biomes/midgard.json")
    {
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _biomesConfigPath = biomesConfigPath ?? throw new ArgumentNullException(nameof(biomesConfigPath));
        _biomeCache = new Dictionary<RealmId, BiomeDefinition>();
        _zoneCache = new Dictionary<RealmId, List<BiomeZone>>();
    }

    /// <summary>
    /// Loads all biome configurations from disk at application startup.
    /// Must be called before any biome queries.
    ///
    /// For v0.19.1a, this loads:
    /// - midgard.json (Deck 04)
    ///
    /// For v0.19.2+, this will load additional realm configs.
    /// </summary>
    public async Task InitializeAsync()
    {
        try
        {
            _logger.LogInformation(
                "BiomeProvider initializing. Loading biome configurations from {ConfigPath}",
                _biomesConfigPath);

            if (!File.Exists(_biomesConfigPath))
            {
                throw new FileNotFoundException(
                    $"Biome configuration file not found: {_biomesConfigPath}");
            }

            var json = await File.ReadAllTextAsync(_biomesConfigPath);
            var config = JsonConvert.DeserializeObject<BiomeConfiguration>(json);

            if (config?.Biome == null)
            {
                throw new InvalidOperationException(
                    "Biome configuration is null or missing 'biome' property");
            }

            // Validate biome
            ValidateBiomeDefinition(config.Biome);

            // Cache biome and zones
            _biomeCache[config.Biome.Id] = config.Biome;
            _zoneCache[config.Biome.Id] = config.Biome.Zones?.ToList() ?? new List<BiomeZone>();

            _logger.LogInformation(
                "Successfully loaded biome '{BiomeName}' (Deck {DeckNumber}) with {ZoneCount} zones",
                config.Biome.Name,
                config.Biome.DeckNumber,
                config.Biome.Zones?.Count ?? 0);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex,
                "Failed to initialize BiomeProvider from {ConfigPath}",
                _biomesConfigPath);
            throw;
        }
    }

    /// <summary>
    /// Retrieves a biome definition by realm ID.
    /// Returns null if the realm has not been loaded.
    /// </summary>
    /// <param name="realmId">The realm identifier (e.g., RealmId.Midgard)</param>
    /// <returns>BiomeDefinition or null</returns>
    public BiomeDefinition GetBiome(RealmId realmId)
    {
        if (_biomeCache.TryGetValue(realmId, out var biome))
        {
            _logger.LogDebug("Retrieved cached biome for realm {RealmId}", realmId);
            return biome;
        }

        _logger.LogWarning("Biome not found for realm {RealmId}", realmId);
        return null;
    }

    /// <summary>
    /// Retrieves a specific zone within a biome.
    /// </summary>
    /// <param name="realmId">The realm ID</param>
    /// <param name="zoneId">The zone ID (e.g., "greatwood")</param>
    /// <returns>BiomeZone or null</returns>
    public BiomeZone GetZone(RealmId realmId, string zoneId)
    {
        if (!_zoneCache.TryGetValue(realmId, out var zones))
        {
            _logger.LogWarning(
                "No zones found for realm {RealmId} (zone lookup: {ZoneId})",
                realmId, zoneId);
            return null;
        }

        var zone = zones.FirstOrDefault(z => z.Id == zoneId);
        if (zone == null)
        {
            _logger.LogWarning(
                "Zone '{ZoneId}' not found in realm {RealmId}",
                zoneId, realmId);
        }

        return zone;
    }

    /// <summary>
    /// Retrieves all zones for a given biome/realm.
    /// </summary>
    /// <param name="realmId">The realm ID</param>
    /// <returns>List of BiomeZone, or empty list if realm not found</returns>
    public IList<BiomeZone> GetZonesForRealm(RealmId realmId)
    {
        if (_zoneCache.TryGetValue(realmId, out var zones))
        {
            _logger.LogDebug(
                "Retrieved {ZoneCount} zones for realm {RealmId}",
                zones.Count, realmId);
            return zones.AsReadOnly();
        }

        _logger.LogWarning("Realm {RealmId} has no zones loaded", realmId);
        return new List<BiomeZone>();
    }

    /// <summary>
    /// Validates a biome definition for completeness and consistency.
    /// Throws InvalidOperationException if validation fails.
    /// </summary>
    private void ValidateBiomeDefinition(BiomeDefinition biome)
    {
        if (biome == null)
            throw new ArgumentNullException(nameof(biome));

        if (string.IsNullOrWhiteSpace(biome.Name))
            throw new InvalidOperationException("Biome must have a Name");

        if (biome.DeckNumber < 1 || biome.DeckNumber > 9)
            throw new InvalidOperationException(
                $"Biome DeckNumber must be 1–9 (got {biome.DeckNumber})");

        if (biome.BaseProperties == null)
            throw new InvalidOperationException("Biome must have BaseProperties");

        // Validate property ranges
        ValidateProperties(biome.BaseProperties, "base");

        if (biome.Zones == null || biome.Zones.Count == 0)
            throw new InvalidOperationException("Biome must have at least one zone");

        // Validate each zone
        foreach (var zone in biome.Zones)
        {
            if (string.IsNullOrWhiteSpace(zone.Id))
                throw new InvalidOperationException("Zone must have an Id");

            if (zone.OverrideProperties != null)
            {
                ValidateProperties(zone.OverrideProperties, $"zone '{zone.Id}'");
            }

            if (zone.FactionPools == null || zone.FactionPools.Count == 0)
                throw new InvalidOperationException(
                    $"Zone '{zone.Id}' must have at least one faction pool");
        }

        _logger.LogInformation(
            "BiomeDefinition '{BiomeName}' validation passed", biome.Name);
    }

    /// <summary>
    /// Validates property ranges (aetheric intensity, light level, etc.)
    /// </summary>
    private void ValidateProperties(BiomeProperties props, string context)
    {
        if (props == null) return;

        if (props.AethericIntensity < 0f || props.AethericIntensity > 1f)
            throw new InvalidOperationException(
                $"AethericIntensity in {context} must be 0.0–1.0 " +
                $"(got {props.AethericIntensity})");

        if (props.LightLevel < 0f || props.LightLevel > 1f)
            throw new InvalidOperationException(
                $"LightLevel in {context} must be 0.0–1.0 (got {props.LightLevel})");

        if (props.HumidityPercent < 0 || props.HumidityPercent > 100)
            throw new InvalidOperationException(
                $"HumidityPercent in {context} must be 0–100 " +
                $"(got {props.HumidityPercent})");

        if (props.CorrosionRate < 0f || props.CorrosionRate > 1f)
            throw new InvalidOperationException(
                $"CorrosionRate in {context} must be 0.0–1.0 " +
                $"(got {props.CorrosionRate})");

        if (props.ScaleFactor < 0.1f)
            throw new InvalidOperationException(
                $"ScaleFactor in {context} must be ≥0.1 (got {props.ScaleFactor})");
    }
}

/// <summary>
/// Container class for deserializing the biome configuration file.
/// </summary>
public class BiomeConfiguration
{
    [JsonProperty("biome")]
    public BiomeDefinition Biome { get; set; }

    [JsonProperty("factionSpawnPools")]
    public Dictionary<string, FactionSpawnPool> FactionSpawnPools { get; set; }
}

/// <summary>
/// Represents a faction spawn pool configuration.
/// </summary>
public class FactionSpawnPool
{
    [JsonProperty("factionId")]
    public string FactionId { get; set; }

    [JsonProperty("displayName")]
    public string DisplayName { get; set; }

    [JsonProperty("baseSpawnWeight")]
    public int BaseSpawnWeight { get; set; }

    [JsonProperty("levelRange")]
    public LevelRange LevelRange { get; set; }

    [JsonProperty("monsterIds")]
    public List<string> MonsterIds { get; set; }
}

/// <summary>
/// Represents the level range for a faction.
/// </summary>
public class LevelRange
{
    [JsonProperty("min")]
    public int Min { get; set; }

    [JsonProperty("max")]
    public int Max { get; set; }
}
```

### 12.2 Environmental Condition Service

```csharp
/// <summary>
/// Service for applying environmental conditions and calculating damage
/// based on zone-specific hazards.
///
/// This service integrates with the EnvironmentalConditionType enum
/// and zone property overrides to determine condition severity and effects.
/// </summary>
public class EnvironmentalConditionService : IEnvironmentalConditionService
{
    private readonly ILogger<EnvironmentalConditionService> _logger;
    private readonly IBiomeProvider _biomeProvider;
    private readonly IDiceRoller _diceRoller;
    private readonly Dictionary<EnvironmentalConditionType, EnvironmentalCondition> _conditionDefinitions;

    public EnvironmentalConditionService(
        ILogger<EnvironmentalConditionService> logger,
        IBiomeProvider biomeProvider,
        IDiceRoller diceRoller)
    {
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _biomeProvider = biomeProvider ?? throw new ArgumentNullException(nameof(biomeProvider));
        _diceRoller = diceRoller ?? throw new ArgumentNullException(nameof(diceRoller));
        _conditionDefinitions = new Dictionary<EnvironmentalConditionType, EnvironmentalCondition>();

        InitializeConditions();
    }

    /// <summary>
    /// Initializes condition definitions from the domain.
    /// This maps condition types to their mechanical effects.
    /// </summary>
    private void InitializeConditions()
    {
        _conditionDefinitions[EnvironmentalConditionType.MutagenicSpores] = new EnvironmentalCondition
        {
            Type = EnvironmentalConditionType.MutagenicSpores,
            DisplayName = "Mutagenic Spores",
            Description = "Light exposure to bio-engineered spores from Vanaheim spillover.",
            CheckAttribute = "Constitution",
            BaseDc = 12,
            DamageRoll = new DiceResult(1, 6),
            DamageType = DamageType.Poison,
            Frequency = ConditionFrequency.PerRest
        };

        _conditionDefinitions[EnvironmentalConditionType.RealityFlux] = new EnvironmentalCondition
        {
            Type = EnvironmentalConditionType.RealityFlux,
            DisplayName = "Reality Flux",
            Description = "Aetheric distortions warp perception and navigation.",
            CheckAttribute = "Wisdom",
            BaseDc = 12,
            DamageRoll = new DiceResult(1, 4),
            DamageType = DamageType.Psychic,
            Frequency = ConditionFrequency.PerTurn
        };

        _logger.LogInformation(
            "EnvironmentalConditionService initialized with {ConditionCount} condition definitions",
            _conditionDefinitions.Count);
    }

    /// <summary>
    /// Calculates the effective DC for a condition in a specific zone.
    /// Formula: BaseDC + ZoneConditionDcModifier
    /// </summary>
    public int CalculateEffectiveDC(
        RealmId realmId,
        string zoneId,
        EnvironmentalConditionType conditionType)
    {
        if (!_conditionDefinitions.TryGetValue(conditionType, out var condition))
        {
            _logger.LogWarning(
                "Condition type {ConditionType} not defined", conditionType);
            return 12;  // Default DC
        }

        var zone = _biomeProvider.GetZone(realmId, zoneId);
        if (zone == null)
        {
            _logger.LogWarning(
                "Zone {ZoneId} not found in realm {RealmId}", zoneId, realmId);
            return condition.BaseDc;
        }

        int effectiveDC = condition.BaseDc + zone.ConditionDcModifier;

        _logger.LogDebug(
            "Calculated effective DC for {ConditionType} in zone {ZoneId}: " +
            "{BaseDC} + {Modifier} = {EffectiveDC}",
            conditionType, zoneId, condition.BaseDc, zone.ConditionDcModifier, effectiveDC);

        return effectiveDC;
    }

    /// <summary>
    /// Applies an environmental condition to a character and determines damage.
    /// Returns EnvironmentalDamageResult with check outcome and damage amount.
    /// </summary>
    public EnvironmentalDamageResult ApplyCondition(
        Character character,
        RealmId realmId,
        string zoneId,
        EnvironmentalConditionType conditionType)
    {
        if (character == null)
            throw new ArgumentNullException(nameof(character));

        if (conditionType == EnvironmentalConditionType.None)
        {
            _logger.LogDebug(
                "No environmental condition in zone {ZoneId} for character {CharacterId}",
                zoneId, character.Id);
            return new EnvironmentalDamageResult { Damage = 0, Success = true };
        }

        if (!_conditionDefinitions.TryGetValue(conditionType, out var condition))
        {
            _logger.LogWarning(
                "Unknown environmental condition type: {ConditionType}", conditionType);
            return new EnvironmentalDamageResult { Damage = 0, Success = true };
        }

        // Get character's relevant ability score
        int abilityModifier = GetAbilityModifier(character, condition.CheckAttribute);
        int effectiveDC = CalculateEffectiveDC(realmId, zoneId, conditionType);

        // Roll check (1d20 + modifier)
        int roll = _diceRoller.Roll(1, 20) + abilityModifier;
        bool success = roll >= effectiveDC;

        int damage = 0;
        if (!success)
        {
            // Roll damage (e.g., 1d6 poison)
            damage = _diceRoller.Roll(condition.DamageRoll.DiceCount, condition.DamageRoll.DiceSides);

            _logger.LogInformation(
                "Character {CharacterId} failed {ConditionType} save (DC {DC}) and takes {Damage} {DamageType} damage",
                character.Id, conditionType, effectiveDC, damage, condition.DamageType);
        }

        return new EnvironmentalDamageResult
        {
            ConditionType = conditionType,
            CheckAttribute = condition.CheckAttribute,
            Dc = effectiveDC,
            Roll = roll,
            Success = success,
            Damage = damage,
            DamageType = condition.DamageType,
            DisplayName = condition.DisplayName,
            Description = condition.Description
        };
    }

    /// <summary>
    /// Converts ability name (e.g., "Constitution") to modifier.
    /// </summary>
    private int GetAbilityModifier(Character character, string abilityName)
    {
        return abilityName switch
        {
            "Strength" => character.Strength.Modifier,
            "Dexterity" => character.Dexterity.Modifier,
            "Constitution" => character.Constitution.Modifier,
            "Intelligence" => character.Intelligence.Modifier,
            "Wisdom" => character.Wisdom.Modifier,
            "Charisma" => character.Charisma.Modifier,
            _ => 0
        };
    }
}

/// <summary>
/// Result of applying an environmental condition to a character.
/// </summary>
public class EnvironmentalDamageResult
{
    public EnvironmentalConditionType ConditionType { get; set; }
    public string DisplayName { get; set; }
    public string Description { get; set; }
    public string CheckAttribute { get; set; }
    public int Dc { get; set; }
    public int Roll { get; set; }
    public bool Success { get; set; }
    public int Damage { get; set; }
    public DamageType DamageType { get; set; }
}
```

---

## 13. Logging Specifications

### 13.1 Structured Logging Requirements

All logging must use structured fields for queryability.

**BiomeProvider Logging:**

| Level | Event | Fields | Message Template |
|-------|-------|--------|------------------|
| INFO | BiomeProvider Initializing | ConfigPath | "BiomeProvider initializing. Loading biome configurations from {ConfigPath}" |
| ERROR | Biome Config Load Failed | ConfigPath, Exception | "Failed to initialize BiomeProvider from {ConfigPath}" |
| INFO | Biome Loaded | BiomeName, DeckNumber, ZoneCount | "Successfully loaded biome '{BiomeName}' (Deck {DeckNumber}) with {ZoneCount} zones" |
| DEBUG | Biome Cache Hit | RealmId | "Retrieved cached biome for realm {RealmId}" |
| WARN | Biome Not Found | RealmId | "Biome not found for realm {RealmId}" |
| DEBUG | Zone Cache Hit | ZoneCount, RealmId | "Retrieved {ZoneCount} zones for realm {RealmId}" |
| WARN | Zone Not Found | ZoneId, RealmId | "Zone '{ZoneId}' not found in realm {RealmId}" |

**EnvironmentalConditionService Logging:**

| Level | Event | Fields | Message Template |
|-------|-------|--------|------------------|
| INFO | Service Initialized | ConditionCount | "EnvironmentalConditionService initialized with {ConditionCount} condition definitions" |
| DEBUG | DC Calculated | ConditionType, ZoneId, BaseDC, Modifier, EffectiveDC | "Calculated effective DC for {ConditionType} in zone {ZoneId}: {BaseDC} + {Modifier} = {EffectiveDC}" |
| INFO | Condition Applied | CharacterId, ConditionType, DC, Damage | "Character {CharacterId} failed {ConditionType} save (DC {DC}) and takes {Damage} {DamageType} damage" |
| DEBUG | Condition Skipped | CharacterId, ZoneId | "No environmental condition in zone {ZoneId} for character {CharacterId}" |

### 13.2 Log Correlation

All environment condition checks should include a correlation ID:

```csharp
public async Task<EnvironmentalDamageResult> ApplyConditionWithLoggingAsync(
    Character character,
    RealmId realmId,
    string zoneId)
{
    var correlationId = Guid.NewGuid().ToString();
    using (_logger.BeginScope(new { CorrelationId = correlationId, CharacterId = character.Id }))
    {
        _logger.LogInformation(
            "Starting environment condition check in zone {ZoneId}",
            zoneId);

        // ... condition application ...

        _logger.LogInformation(
            "Completed environment condition check. Result: {Success}",
            result.Success);

        return result;
    }
}
```

---

## 14. Unit Testing Requirements

### 14.1 Test Categories

#### Category A: BiomeDefinition Tests (~6 tests)

```csharp
[TestFixture]
public class MidgardBiomeDefinitionTests
{
    private IBiomeProvider _biomeProvider;
    private ILogger<BiomeProvider> _logger;

    [SetUp]
    public void Setup()
    {
        _logger = new MockLogger<BiomeProvider>();
        _biomeProvider = new BiomeProvider(_logger, "config/biomes/midgard.json");
        _biomeProvider.InitializeAsync().Wait();
    }

    [Test]
    public void GetBiome_Midgard_ReturnsValidDefinition()
    {
        // ARRANGE (implicit: setup loaded midgard.json)

        // ACT
        var biome = _biomeProvider.GetBiome(RealmId.Midgard);

        // ASSERT
        Assert.NotNull(biome);
        Assert.AreEqual(RealmId.Midgard, biome.Id);
        Assert.AreEqual("Midgard", biome.Name);
        Assert.AreEqual("The Tamed Ruin", biome.Subtitle);
    }

    [Test]
    public void GetBiome_Midgard_HasCorrectBaseProperties()
    {
        // ARRANGE
        var biome = _biomeProvider.GetBiome(RealmId.Midgard);
        var props = biome.BaseProperties;

        // ACT & ASSERT
        Assert.AreEqual(18, props.TemperatureCelsius);
        Assert.AreEqual(0.7f, props.LightLevel);
        Assert.AreEqual(0.3f, props.AethericIntensity);
        Assert.AreEqual(60, props.HumidityPercent);
        Assert.AreEqual(1.0f, props.ScaleFactor);
        Assert.AreEqual(0.2f, props.CorrosionRate);
    }

    [Test]
    public void GetBiome_Midgard_HasNoPrimaryCondition()
    {
        // ARRANGE
        var biome = _biomeProvider.GetBiome(RealmId.Midgard);

        // ACT & ASSERT
        Assert.AreEqual(EnvironmentalConditionType.None, biome.PrimaryCondition);
    }

    [Test]
    public void GetBiome_Midgard_HasCorrectVerticalRange()
    {
        // ARRANGE
        var biome = _biomeProvider.GetBiome(RealmId.Midgard);

        // ACT & ASSERT
        Assert.AreEqual(VerticalZone.GroundLevel, biome.MinVerticalZone);
        Assert.AreEqual(VerticalZone.LowerTrunk, biome.MaxVerticalZone);
    }

    [Test]
    public void GetBiome_Midgard_HasFlavorQuote()
    {
        // ARRANGE
        var biome = _biomeProvider.GetBiome(RealmId.Midgard);

        // ACT & ASSERT
        Assert.NotNull(biome.FlavorQuote);
        Assert.AreEqual("The Wall is the soul of the Hold.", biome.FlavorQuote);
    }

    [Test]
    public void GetBiome_Midgard_HasColorPalette()
    {
        // ARRANGE
        var biome = _biomeProvider.GetBiome(RealmId.Midgard);

        // ACT & ASSERT
        Assert.NotNull(biome.ColorPalette);
        Assert.AreEqual("green-brown-grey-amber", biome.ColorPalette);
    }
}
```

#### Category B: Zone Tests (~8 tests)

```csharp
[TestFixture]
public class MidgardZoneTests
{
    private IBiomeProvider _biomeProvider;

    [SetUp]
    public void Setup()
    {
        var logger = new MockLogger<BiomeProvider>();
        _biomeProvider = new BiomeProvider(logger, "config/biomes/midgard.json");
        _biomeProvider.InitializeAsync().Wait();
    }

    [Test]
    public void GetZonesForRealm_Midgard_ReturnsFourZones()
    {
        // ACT
        var zones = _biomeProvider.GetZonesForRealm(RealmId.Midgard);

        // ASSERT
        Assert.AreEqual(4, zones.Count);
        var zoneIds = zones.Select(z => z.Id).ToList();
        CollectionAssert.Contains(zoneIds, "greatwood");
        CollectionAssert.Contains(zoneIds, "sun-fields");
        CollectionAssert.Contains(zoneIds, "iron-marches");
        CollectionAssert.Contains(zoneIds, "veil-edge");
    }

    [Test]
    public void GetZone_Greatwood_HasLightOverride()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "greatwood");

        // ASSERT
        Assert.NotNull(zone);
        Assert.NotNull(zone.OverrideProperties);
        Assert.AreEqual(0.4f, zone.OverrideProperties.LightLevel);
    }

    [Test]
    public void GetZone_Greatwood_HasSporeCondition()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "greatwood");

        // ASSERT
        Assert.NotNull(zone);
        Assert.AreEqual(EnvironmentalConditionType.MutagenicSpores, zone.OverrideCondition);
        Assert.AreEqual(-4, zone.ConditionDcModifier);
    }

    [Test]
    public void GetZone_SunFields_HasNoOverrides()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "sun-fields");

        // ASSERT
        Assert.NotNull(zone);
        Assert.Null(zone.OverrideProperties);
        Assert.Null(zone.OverrideCondition);
    }

    [Test]
    public void GetZone_IronMarches_HasCorrosionOverride()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "iron-marches");

        // ASSERT
        Assert.NotNull(zone);
        Assert.NotNull(zone.OverrideProperties);
        Assert.AreEqual(0.4f, zone.OverrideProperties.CorrosionRate);
    }

    [Test]
    public void GetZone_VeilEdge_HasAethericOverride()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "veil-edge");

        // ASSERT
        Assert.NotNull(zone);
        Assert.NotNull(zone.OverrideProperties);
        Assert.AreEqual(0.5f, zone.OverrideProperties.AethericIntensity);
    }

    [Test]
    public void GetZone_VeilEdge_HasRealityFlux()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "veil-edge");

        // ASSERT
        Assert.NotNull(zone);
        Assert.AreEqual(EnvironmentalConditionType.RealityFlux, zone.OverrideCondition);
        Assert.AreEqual(-2, zone.ConditionDcModifier);
    }

    [Test]
    public void GetZone_InvalidZone_ReturnsNull()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "nonexistent");

        // ASSERT
        Assert.Null(zone);
    }
}
```

#### Category C: Faction Pool Tests (~4 tests)

```csharp
[TestFixture]
public class MidgardFactionPoolTests
{
    private IBiomeProvider _biomeProvider;

    [SetUp]
    public void Setup()
    {
        var logger = new MockLogger<BiomeProvider>();
        _biomeProvider = new BiomeProvider(logger, "config/biomes/midgard.json");
        _biomeProvider.InitializeAsync().Wait();
    }

    [Test]
    public void GetFactionPool_Greatwood_ReturnsFenrisRustkin()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "greatwood");

        // ASSERT
        Assert.NotNull(zone?.FactionPools);
        Assert.AreEqual(2, zone.FactionPools.Count);
        CollectionAssert.Contains(zone.FactionPools, "fenris-brood");
        CollectionAssert.Contains(zone.FactionPools, "rustkin");
    }

    [Test]
    public void GetFactionPool_SunFields_ReturnsEinherjarClockwork()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "sun-fields");

        // ASSERT
        Assert.NotNull(zone?.FactionPools);
        Assert.AreEqual(2, zone.FactionPools.Count);
        CollectionAssert.Contains(zone.FactionPools, "einherjar");
        CollectionAssert.Contains(zone.FactionPools, "clockwork-remnants");
    }

    [Test]
    public void GetFactionPool_IronMarches_ReturnsClockworkRustkin()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "iron-marches");

        // ASSERT
        Assert.NotNull(zone?.FactionPools);
        Assert.AreEqual(2, zone.FactionPools.Count);
        CollectionAssert.Contains(zone.FactionPools, "clockwork-remnants");
        CollectionAssert.Contains(zone.FactionPools, "rustkin");
    }

    [Test]
    public void GetFactionPool_VeilEdge_ReturnsFenrisOnly()
    {
        // ACT
        var zone = _biomeProvider.GetZone(RealmId.Midgard, "veil-edge");

        // ASSERT
        Assert.NotNull(zone?.FactionPools);
        Assert.AreEqual(1, zone.FactionPools.Count);
        CollectionAssert.Contains(zone.FactionPools, "fenris-brood");
    }
}
```

---

## 15. Integration Points

### 15.1 Dependencies from v0.19.0a

```
v0.19.0a Infrastructure (REQUIRED):
├── RealmId enum (with Midgard = 4)
├── BiomeDefinition entity
├── BiomeZone entity
├── BiomeProperties value object
├── EnvironmentalConditionType enum
│   ├── MutagenicSpores (for Greatwood)
│   └── RealityFlux (for Veil Edge)
├── EnvironmentalCondition entity
├── IBiomeProvider interface
├── IEnvironmentalConditionService interface
└── biomes.schema.json (JSON Schema validation)
```

### 15.2 Dependencies from Existing Systems

```
Faction System (REQUIRED):
├── Faction entity
├── IFactionService interface
└── Spawn weight algorithms

Character System (REQUIRED):
├── Character entity
├── Ability score system
│   ├── Constitution (for MutagenicSpores saves)
│   └── Wisdom (for RealityFlux saves)
└── HP/Damage system

Dice System (REQUIRED):
└── IDiceRoller interface (v0.6.x)
```

### 15.3 Configuration Loading Pipeline

```
Startup Sequence:
1. DI Container created
   ├── Register IBiomeProvider (BiomeProvider)
   ├── Register IEnvironmentalConditionService
   └── Register IDiceRoller
2. BiomeProvider.InitializeAsync() called
   └── Loads midgard.json from disk
   └── Validates against biomes.schema.json
   └── Populates _biomeCache and _zoneCache
3. Application ready for realm loading
4. Player enters Midgard
   └── BiomeProvider.GetBiome(RealmId.Midgard) returns definition
   └── Player spawned in Sun Fields (safest zone)
```

---

## 16. Inline Documentation Requirements

All C# classes, properties, and methods must include XML documentation comments:

```csharp
/// <summary>
/// [1-2 sentences describing the class/method purpose]
/// </summary>
/// <remarks>
/// [Optional: Detailed explanation of behavior, context, or design decisions]
/// </remarks>
/// <param name="paramName">[Description of parameter]</param>
/// <returns>[Description of return value]</returns>
/// <exception cref="ExceptionType">[When thrown and why]</exception>
/// <example>
/// <code>
/// // Code example showing usage
/// </code>
/// </example>
```

**Examples:**

```csharp
/// <summary>
/// Loads biome definitions from JSON configuration files and caches them for efficient access.
/// </summary>
/// <remarks>
/// The BiomeProvider is responsible for loading all realm definitions (biomes) from the
/// configuration directory at application startup. It maintains an internal cache to avoid
/// repeated disk I/O during gameplay. For v0.19.1a, this loads the Midgard realm with its
/// four sub-zones. Subsequent versions (v0.19.2–v0.19.6) will expand this to load additional
/// realms while maintaining the same interface.
/// </remarks>
public class BiomeProvider : IBiomeProvider { ... }

/// <summary>
/// Retrieves a biome definition by its realm identifier.
/// </summary>
/// <param name="realmId">The unique realm identifier (e.g., RealmId.Midgard)</param>
/// <returns>The BiomeDefinition if loaded; null if not found or not yet initialized</returns>
/// <remarks>
/// This method performs a cache lookup and does not access the filesystem.
/// If the realm has not been initialized via InitializeAsync(), this will return null.
/// Callers should always null-check the result.
/// </remarks>
public BiomeDefinition GetBiome(RealmId realmId) { ... }
```

---

## 17. Deliverable Checklist

### Configuration Files

- [ ] `midgard.json` created with complete biome definition
  - [ ] Biome metadata (id, name, subtitle, deck number)
  - [ ] Base properties (all 6 properties defined)
  - [ ] Primary condition: None
  - [ ] Vertical zone range: Z 0 to Z +1
  - [ ] Flavor quote and color palette
  - [ ] All four zones defined

- [ ] Zone definitions (all 4 zones)
  - [ ] The Greatwood (light & humidity overrides, MutagenicSpores DC 8)
  - [ ] Sun Fields (no overrides, no condition)
  - [ ] Iron Marches (corrosion & humidity overrides, no condition)
  - [ ] The Veil Edge (aetheric & light overrides, RealityFlux DC 10)

- [ ] Faction spawn pools (all 4 factions)
  - [ ] Einherjar (30% weight, level 1–5)
  - [ ] Fenris Brood (25% weight, level 2–6)
  - [ ] Rustkin (25% weight, level 1–4)
  - [ ] Clockwork Remnants (20% weight, level 3–7)

- [ ] JSON validates against biomes.schema.json

### Code Implementation

- [ ] BiomeProvider updated to load midgard.json
  - [ ] InitializeAsync() method
  - [ ] GetBiome(RealmId.Midgard) returns valid definition
  - [ ] GetZone(RealmId.Midgard, zoneId) returns valid zone
  - [ ] GetZonesForRealm(RealmId.Midgard) returns list of 4 zones

- [ ] EnvironmentalConditionService updated
  - [ ] MutagenicSpores condition support
  - [ ] RealityFlux condition support
  - [ ] DC calculation with zone modifiers
  - [ ] Damage rolling and application

- [ ] All XML documentation complete
  - [ ] BiomeProvider class and methods
  - [ ] EnvironmentalConditionService class and methods
  - [ ] Helper classes and DTOs

### Unit Tests

- [ ] BiomeDefinition tests (6 tests) all passing
- [ ] Zone tests (8 tests) all passing
- [ ] Faction pool tests (4 tests) all passing
- [ ] Total: ~18 tests, all green

### Documentation

- [ ] Design specification complete (this document)
- [ ] Architecture diagrams included
- [ ] User stories defined
- [ ] Property override examples documented
- [ ] DC calculation examples documented
- [ ] Logging specifications defined
- [ ] Integration points documented

---

## 18. Acceptance Criteria

All items must be satisfied before v0.19.1a is considered complete:

### Functional Acceptance Criteria

- [ ] Midgard BiomeDefinition loads successfully on application startup
- [ ] All four zones (Greatwood, Sun Fields, Iron Marches, Veil Edge) are accessible
- [ ] Zone property overrides correctly merge with base properties:
  - [ ] Greatwood: Light 0.4, Humidity 75%
  - [ ] Sun Fields: All base (no overrides)
  - [ ] Iron Marches: Corrosion 0.4, Humidity 45%
  - [ ] Veil Edge: Aetheric 0.5, Light 0.5
- [ ] Environmental conditions apply with correct DCs:
  - [ ] Greatwood: MutagenicSpores DC 8
  - [ ] Veil Edge: RealityFlux DC 10
  - [ ] Sun Fields & Iron Marches: No condition
- [ ] Faction spawn pools assign correctly per zone
- [ ] IBiomeProvider.GetBiome(RealmId.Midgard) returns valid definition
- [ ] IBiomeProvider.GetZonesForRealm(RealmId.Midgard) returns exactly 4 zones
- [ ] JSON configuration file validates against biomes.schema.json

### Quality Acceptance Criteria

- [ ] All unit tests pass (18 tests)
- [ ] Code coverage ≥ 90% for public APIs
- [ ] All XML documentation complete and accurate
- [ ] Logging implemented per specifications
- [ ] No compiler warnings
- [ ] All PR code reviews approved

### Documentation Acceptance Criteria

- [ ] This design specification complete and approved
- [ ] Architecture diagrams accurate and clear
- [ ] Code examples compile and run
- [ ] Test names clearly describe what they test

---

## 19. Dependencies

### Required (Blocking)

| Dependency | Version | Status | Notes |
|------------|---------|--------|-------|
| v0.19.0a (Core Biome Infrastructure) | 0.19.0a | Required | RealmId enum, BiomeDefinition entity, IBiomeProvider interface |
| Dice System | v0.6.x | Required | IDiceRoller for condition damage rolls |
| Character System | Current | Required | Ability scores, HP/damage tracking |
| Faction System | Current | Required | Faction definitions, spawn pool integration |

### Optional (Enhancement)

| Dependency | Version | Status | Notes |
|------------|---------|--------|-------|
| Lore System | TBD | Enhancement | Flavor text, descriptions, color palettes |
| Quest System | TBD | Future | Could integrate Midgard-specific quests |

---

## 20. Future Considerations & Deferrals

### Deferrals from v0.19.1a Scope

1. **Room Template Assignment (v0.20.x)**
   - Specific room templates will be assigned to Midgard zones
   - Greatwood rooms will use forest/woodland templates
   - Iron Marches rooms will use industrial/ruin templates
   - Currently: zones exist, but no room generation

2. **NPC Placement Logic (v0.20.x)**
   - NPCs will be placed in rooms according to zone characteristics
   - Faction members will spawn in thematic locations
   - Currently: faction pools defined, but no NPC instantiation

3. **Travel Mechanics (v0.19.6)**
   - Player movement between zones and realms
   - Transition rooms for incompatible realm adjacencies
   - Currently: zones exist, but no traversal logic

4. **Lore Integration v0.20.x+**
   - Environmental descriptions will be integrated into room/zone flavor text
   - NPCs will reference Midgard's history and role
   - Currently: color palette and quotes defined, but not used in game text

5. **Condition Severity Scaling (v0.20.x+)**
   - Conditions may become harder/easier based on character progression
   - Seasonal effects on conditions (e.g., spores worse in summer)
   - Currently: DCs are static per zone

### Future Enhancement Opportunities

1. **Sub-zones Within Zones**
   - Greatwood could have Sacred Grove, Twisted Copse, etc.
   - Would add granularity without changing core implementation

2. **Dynamic Environmental Properties**
   - Properties could shift based on in-game events
   - Example: Iron Marches corrosion increases if machines activate

3. **Faction Relationship Modifiers**
   - Faction reputation could affect spawn weights in zones
   - Factions might avoid zones where player has high standing

4. **Seasonal Variations**
   - Base properties could shift seasonally
   - Example: Winter increases Greatwood humidity (fog/frost)

5. **Cross-Realm Migration**
   - Factions might move between realms based on events
   - Seasonal creature migrations

---

**END OF DESIGN SPECIFICATION**

---

**Document Metadata:**

| Field | Value |
|-------|-------|
| **Version** | 0.19.1a |
| **Status** | Design Complete |
| **Last Updated** | 2026-01-28 |
| **Author** | System Design |
| **Approver** | [PENDING REVIEW] |
| **Total Sections** | 20 |
| **Lines of Code (Spec)** | 1200+ |
| **Test Cases** | ~18 |

