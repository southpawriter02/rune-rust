# v0.17.5f Design Specification: TUI Screens

**Version:** 0.17.5f
**Theme:** TUI Screens
**Author:** Claude
**Created:** 2026-01-28
**Status:** Draft
**Prerequisites:** v0.17.5a-e Complete

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Screen Components](#4-screen-components)
5. [Step Screen Implementations](#5-step-screen-implementations)
6. [Shared UI Components](#6-shared-ui-components)
7. [Input Handling](#7-input-handling)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [Deliverable Checklist](#11-deliverable-checklist)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Future Considerations](#13-future-considerations)
14. [Document Metadata](#14-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document specifies v0.17.5f, the TUI Screens phase implementing the six-step character creation wizard interface.

Key components:

1. **ICreationScreen Interface**: Contract for step screens with render/input methods.
2. **Six Step Screens**: LineageScreen, BackgroundScreen, AttributeScreen, ArchetypeScreen, SpecializationScreen, SummaryScreen.
3. **CreationWizardView**: Orchestrates screen transitions and controller integration.
4. **Shared Components**: StepHeader, OptionList, PreviewPanel, NavigationBar.

### 1.2 Scope

**In Scope:**

- 6 step screen implementations
- Shared UI components
- Input handling and navigation
- Controller integration
- Unit tests (~3 tests)

**Out of Scope:**

- Database persistence - v0.17.5g
- Animation effects

### 1.3 Key Deliverables

| Type       | Count | Details                                      |
| ---------- | ----- | -------------------------------------------- |
| Interfaces | 1     | `ICreationScreen`                            |
| Views      | 7     | CreationWizardView + 6 step screens          |
| Components | 4     | StepHeader, OptionList, PreviewPanel, NavBar |
| Unit Tests | ~3    | Screen rendering, navigation                 |

---

## 2. Dependencies

### 2.1 Required from v0.17.5a-e

| Component                      | Usage in v0.17.5f        |
| ------------------------------ | ------------------------ |
| `CharacterCreationStep`        | Step identification      |
| `CharacterCreationState`       | State display            |
| `CharacterCreationViewModel`   | Display data source      |
| `ICharacterCreationController` | User action handling     |
| `ICharacterFactory`            | Final character creation |

### 2.2 Required from TUI Framework

| Component           | Usage              |
| ------------------- | ------------------ |
| `ITerminalService`  | Terminal rendering |
| `ScreenLayout`      | Responsive layout  |
| `ColorThemeService` | Semantic colors    |
| `IInputHandler`     | Keyboard input     |

---

## 3. Architecture Diagrams

### 3.1 Screen Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CREATION WIZARD FLOW                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  CreationWizardView                                              â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€ [1] LineageScreen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ SelectLineageAsync()    â”‚
â”‚       â”‚       â€¢ Display 4 lineage options                       â”‚
â”‚       â”‚       â€¢ Clan-Born: show attribute selector              â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€ [2] BackgroundScreen â”€â”€â”€â”€â”€â”€â”€â–¶ SelectBackgroundAsync() â”‚
â”‚       â”‚       â€¢ Display 6 background options                    â”‚
â”‚       â”‚       â€¢ Show skills/equipment preview                   â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€ [3] AttributeScreen â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ConfirmAttributesAsync()â”‚
â”‚       â”‚       â€¢ Simple/Advanced mode toggle                     â”‚
â”‚       â”‚       â€¢ Point-buy controls                              â”‚
â”‚       â”‚       â€¢ Live derived stats preview                      â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€ [4] ArchetypeScreen â”€â”€â”€â”€â”€â”€â”€â”€â–¶ SelectArchetypeAsync()  â”‚
â”‚       â”‚       â€¢ Display 4 archetype options                     â”‚
â”‚       â”‚       â€¢ âš  PERMANENT warning banner                      â”‚
â”‚       â”‚                                                          â”‚
â”‚       â”œâ”€â”€ [5] SpecializationScreen â”€â”€â–¶ SelectSpecAsync()        â”‚
â”‚       â”‚       â€¢ Filtered by archetype                           â”‚
â”‚       â”‚       â€¢ Path type indicator                             â”‚
â”‚       â”‚                                                          â”‚
â”‚       â””â”€â”€ [6] SummaryScreen â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ConfirmCharacterAsync()  â”‚
â”‚               â€¢ Full character summary                          â”‚
â”‚               â€¢ Name input field                                â”‚
â”‚               â€¢ Final confirmation                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Component Hierarchy

```
CreationWizardView
â”œâ”€â”€ StepHeader
â”‚   â”œâ”€â”€ Step number (1-6)
â”‚   â”œâ”€â”€ Step title
â”‚   â””â”€â”€ Progress indicator
â”œâ”€â”€ CurrentStepScreen (ICreationScreen)
â”‚   â”œâ”€â”€ OptionList OR Custom content
â”‚   â””â”€â”€ PreviewPanel
â”œâ”€â”€ NavigationBar
â”‚   â”œâ”€â”€ [Back] button (if canGoBack)
â”‚   â”œâ”€â”€ [Cancel] button
â”‚   â””â”€â”€ [Continue/Confirm] button
â””â”€â”€ ValidationErrorDisplay
```

---

## 4. Screen Components

### 4.1 ICreationScreen Interface

**File:** `src/Presentation/RuneAndRust.TUI/Interfaces/ICreationScreen.cs`

```csharp
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.TUI.Interfaces;

/// <summary>
/// Contract for character creation step screens.
/// </summary>
public interface ICreationScreen
{
    /// <summary>
    /// Gets the step this screen handles.
    /// </summary>
    CharacterCreationStep Step { get; }

    /// <summary>
    /// Renders the screen with current ViewModel data.
    /// </summary>
    void Render(CharacterCreationViewModel viewModel);

    /// <summary>
    /// Handles keyboard input, returns true if input consumed.
    /// </summary>
    bool HandleInput(ConsoleKeyInfo key);

    /// <summary>
    /// Gets the currently selected value (for controller).
    /// </summary>
    object? GetSelection();

    /// <summary>
    /// Resets screen state for fresh display.
    /// </summary>
    void Reset();
}
```

### 4.2 CreationWizardView

**File:** `src/Presentation/RuneAndRust.TUI/Views/CreationWizardView.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.TUI.Interfaces;

namespace RuneAndRust.TUI.Views;

/// <summary>
/// Orchestrates the 6-step character creation wizard.
/// </summary>
public class CreationWizardView
{
    private readonly ICharacterCreationController _controller;
    private readonly ITerminalService _terminal;
    private readonly Dictionary<CharacterCreationStep, ICreationScreen> _screens;
    private readonly ILogger<CreationWizardView> _logger;

    private CharacterCreationViewModel _viewModel = null!;
    private bool _isRunning;

    public CreationWizardView(
        ICharacterCreationController controller,
        IEnumerable<ICreationScreen> screens,
        ITerminalService terminal,
        ILogger<CreationWizardView> logger)
    {
        _controller = controller;
        _terminal = terminal;
        _logger = logger;
        _screens = screens.ToDictionary(s => s.Step);
    }

    /// <summary>
    /// Starts the creation wizard and returns created character or null.
    /// </summary>
    public async Task<Player?> RunAsync()
    {
        _controller.Initialize();
        _isRunning = true;
        _logger.LogInformation("Character creation wizard started");

        while (_isRunning)
        {
            var (state, viewModel) = _controller.GetCurrentState();
            _viewModel = viewModel;

            RenderCurrentStep();
            await HandleInputAsync();
        }

        return null; // Cancelled
    }

    private void RenderCurrentStep()
    {
        _terminal.Clear();
        RenderStepHeader();

        if (_screens.TryGetValue(_viewModel.CurrentStep, out var screen))
        {
            screen.Render(_viewModel);
        }

        RenderNavigationBar();
        RenderValidationErrors();
    }

    private void RenderStepHeader()
    {
        var header = $"  STEP {_viewModel.StepNumber} OF {_viewModel.TotalSteps}: " +
                     $"{_viewModel.StepTitle.ToUpperInvariant()}  ";

        _terminal.WriteLineAt(0, 0, "â•”" + new string('â•', header.Length) + "â•—");
        _terminal.WriteLineAt(0, 1, "â•‘" + header + "â•‘");
        _terminal.WriteLineAt(0, 2, "â•š" + new string('â•', header.Length) + "â•");

        if (_viewModel.IsPermanentChoice)
        {
            _terminal.SetForeground(ConsoleColor.Yellow);
            _terminal.WriteLineAt(0, 4,
                "  âš  WARNING: This choice is PERMANENT and cannot be changed.");
            _terminal.ResetColors();
        }
    }

    private void RenderNavigationBar()
    {
        var y = _terminal.Height - 2;
        var nav = new List<string>();

        if (_viewModel.CanGoBack)
            nav.Add("[B]ack");
        nav.Add("[C]ancel");
        if (_viewModel.IsCurrentStepValid)
            nav.Add(_viewModel.CurrentStep == CharacterCreationStep.Summary
                ? "[Enter] Confirm" : "[Enter] Continue");

        _terminal.WriteLineAt(0, y, string.Join("  |  ", nav));
    }

    private async Task HandleInputAsync()
    {
        var key = Console.ReadKey(true);
        var screen = _screens[_viewModel.CurrentStep];

        // Let screen handle input first
        if (screen.HandleInput(key))
            return;

        // Global navigation
        switch (key.Key)
        {
            case ConsoleKey.Escape:
            case ConsoleKey.C when key.Modifiers == 0:
                _controller.Cancel();
                _isRunning = false;
                _logger.LogInformation("Creation cancelled by user");
                break;

            case ConsoleKey.B when _viewModel.CanGoBack:
                _controller.GoBack();
                _logger.LogDebug("Navigated back to previous step");
                break;

            case ConsoleKey.Enter when _viewModel.IsCurrentStepValid:
                await ProcessStepAsync(screen);
                break;
        }
    }

    private async Task ProcessStepAsync(ICreationScreen screen)
    {
        var selection = screen.GetSelection();

        var result = _viewModel.CurrentStep switch
        {
            CharacterCreationStep.Lineage =>
                await ProcessLineageAsync(selection),
            CharacterCreationStep.Background =>
                await _controller.SelectBackgroundAsync((Background)selection!),
            CharacterCreationStep.Attributes =>
                await _controller.ConfirmAttributesAsync(
                    (AttributeAllocationState)selection!),
            CharacterCreationStep.Archetype =>
                await _controller.SelectArchetypeAsync((Archetype)selection!),
            CharacterCreationStep.Specialization =>
                await _controller.SelectSpecializationAsync(
                    (SpecializationId)selection!),
            CharacterCreationStep.Summary =>
                await ProcessSummaryAsync(selection),
            _ => throw new InvalidOperationException()
        };

        if (!result.Success)
        {
            _logger.LogDebug("Step failed: {Errors}",
                string.Join(", ", result.ValidationErrors));
        }
    }
}
```

---

## 5. Step Screen Implementations

### 5.1 LineageScreen

**File:** `src/Presentation/RuneAndRust.TUI/Screens/LineageScreen.cs`

```csharp
namespace RuneAndRust.TUI.Screens;

/// <summary>
/// Step 1: Lineage selection screen.
/// </summary>
public class LineageScreen : ICreationScreen
{
    public CharacterCreationStep Step => CharacterCreationStep.Lineage;

    private int _selectedIndex;
    private CoreAttribute? _flexibleBonus;
    private bool _selectingFlexible;

    private static readonly Lineage[] Lineages =
    {
        Lineage.ClanBorn, Lineage.RuneMarked,
        Lineage.IronBlooded, Lineage.VargrKin
    };

    public void Render(CharacterCreationViewModel viewModel)
    {
        // Render lineage options with descriptions
        for (int i = 0; i < Lineages.Length; i++)
        {
            var selected = i == _selectedIndex;
            var prefix = selected ? "â–¶ " : "  ";
            var lineage = Lineages[i];

            Console.WriteLine($"{prefix}[{i + 1}] {GetLineageName(lineage)}");
            Console.WriteLine($"      {GetLineageDescription(lineage)}");
            Console.WriteLine($"      {GetLineageBonuses(lineage)}");
            Console.WriteLine();
        }

        // Clan-Born flexible attribute selector
        if (Lineages[_selectedIndex] == Lineage.ClanBorn)
        {
            RenderFlexibleAttributeSelector();
        }
    }

    public bool HandleInput(ConsoleKeyInfo key)
    {
        if (_selectingFlexible)
            return HandleFlexibleInput(key);

        switch (key.Key)
        {
            case ConsoleKey.UpArrow:
                _selectedIndex = Math.Max(0, _selectedIndex - 1);
                return true;
            case ConsoleKey.DownArrow:
                _selectedIndex = Math.Min(Lineages.Length - 1, _selectedIndex + 1);
                return true;
            case ConsoleKey.D1: case ConsoleKey.D2:
            case ConsoleKey.D3: case ConsoleKey.D4:
                _selectedIndex = (int)key.Key - (int)ConsoleKey.D1;
                return true;
            case ConsoleKey.Tab when Lineages[_selectedIndex] == Lineage.ClanBorn:
                _selectingFlexible = true;
                return true;
        }
        return false;
    }

    public object? GetSelection() =>
        (Lineages[_selectedIndex], _flexibleBonus);

    public void Reset()
    {
        _selectedIndex = 0;
        _flexibleBonus = null;
        _selectingFlexible = false;
    }
}
```

### 5.2 AttributeScreen (Advanced Mode)

```csharp
namespace RuneAndRust.TUI.Screens;

/// <summary>
/// Step 3: Attribute allocation screen.
/// </summary>
public class AttributeScreen : ICreationScreen
{
    public CharacterCreationStep Step => CharacterCreationStep.Attributes;

    private AttributeAllocationState _allocation = null!;
    private int _selectedAttribute;
    private bool _advancedMode = true;

    private static readonly CoreAttribute[] Attributes =
    {
        CoreAttribute.Might, CoreAttribute.Finesse,
        CoreAttribute.Wits, CoreAttribute.Will, CoreAttribute.Sturdiness
    };

    public void Render(CharacterCreationViewModel viewModel)
    {
        var mode = _advancedMode ? "[Advanced Mode]" : "[Simple Mode]";
        Console.WriteLine($"  {mode}  Press [M] to toggle\n");
        Console.WriteLine($"  Points Remaining: {_allocation.PointsRemaining} / " +
                          $"{_allocation.TotalPoints}\n");

        // Render each attribute with +/- controls
        for (int i = 0; i < Attributes.Length; i++)
        {
            var attr = Attributes[i];
            var value = _allocation.GetValue(attr);
            var selected = i == _selectedAttribute;
            var prefix = selected ? "â–¶ " : "  ";

            Console.WriteLine(
                $"{prefix}{attr,-12} [âˆ’]  {value,2}  [+]    {GetAttrDescription(attr)}");
        }

        // Derived stats preview
        Console.WriteLine("\n  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
        Console.WriteLine("  Derived Stats Preview:");
        Console.WriteLine($"    Max HP:      {viewModel.DerivedStatsPreview?.MaxHealth ?? 0}");
        Console.WriteLine($"    Max Stamina: {viewModel.DerivedStatsPreview?.MaxStamina ?? 0}");
        Console.WriteLine($"    Max AP:      {viewModel.DerivedStatsPreview?.MaxAetherPool ?? 0}");
    }

    public bool HandleInput(ConsoleKeyInfo key)
    {
        switch (key.Key)
        {
            case ConsoleKey.UpArrow:
                _selectedAttribute = Math.Max(0, _selectedAttribute - 1);
                return true;
            case ConsoleKey.DownArrow:
                _selectedAttribute = Math.Min(4, _selectedAttribute + 1);
                return true;
            case ConsoleKey.LeftArrow:
            case ConsoleKey.OemMinus:
                _allocation = _allocation.Decrease(Attributes[_selectedAttribute]);
                return true;
            case ConsoleKey.RightArrow:
            case ConsoleKey.OemPlus:
                _allocation = _allocation.Increase(Attributes[_selectedAttribute]);
                return true;
            case ConsoleKey.M:
                _advancedMode = !_advancedMode;
                return true;
            case ConsoleKey.R:
                _allocation = AttributeAllocationState.CreateDefault();
                return true;
        }
        return false;
    }

    public object? GetSelection() => _allocation;
    public void Reset() => _allocation = AttributeAllocationState.CreateDefault();
}
```

### 5.3 ArchetypeScreen (with PERMANENT warning)

```csharp
namespace RuneAndRust.TUI.Screens;

/// <summary>
/// Step 4: Archetype selection (PERMANENT choice).
/// </summary>
public class ArchetypeScreen : ICreationScreen
{
    public CharacterCreationStep Step => CharacterCreationStep.Archetype;

    private int _selectedIndex;

    private static readonly Archetype[] Archetypes =
    {
        Archetype.Warrior, Archetype.Skirmisher,
        Archetype.Mystic, Archetype.Adept
    };

    public void Render(CharacterCreationViewModel viewModel)
    {
        for (int i = 0; i < Archetypes.Length; i++)
        {
            var arch = Archetypes[i];
            var selected = i == _selectedIndex;
            var prefix = selected ? "â–¶ " : "  ";

            Console.WriteLine($"{prefix}[{i + 1}] {arch.ToString().ToUpperInvariant()}");
            Console.WriteLine($"      {GetArchetypeTagline(arch)}");
            Console.WriteLine($"      âš” {GetArchetypeStats(arch)}");
            Console.WriteLine($"      ğŸ¯ {GetArchetypeAbilities(arch)}");
            Console.WriteLine();
        }
    }

    public bool HandleInput(ConsoleKeyInfo key)
    {
        switch (key.Key)
        {
            case ConsoleKey.UpArrow:
                _selectedIndex = Math.Max(0, _selectedIndex - 1);
                return true;
            case ConsoleKey.DownArrow:
                _selectedIndex = Math.Min(3, _selectedIndex + 1);
                return true;
            case ConsoleKey.D1: case ConsoleKey.D2:
            case ConsoleKey.D3: case ConsoleKey.D4:
                _selectedIndex = (int)key.Key - (int)ConsoleKey.D1;
                return true;
        }
        return false;
    }

    public object? GetSelection() => Archetypes[_selectedIndex];
    public void Reset() => _selectedIndex = 0;
}
```

### 5.4 SummaryScreen (with name input)

```csharp
namespace RuneAndRust.TUI.Screens;

/// <summary>
/// Step 6: Summary and confirmation screen.
/// </summary>
public class SummaryScreen : ICreationScreen
{
    public CharacterCreationStep Step => CharacterCreationStep.Summary;

    private string _characterName = "";
    private bool _nameFieldActive = true;

    public void Render(CharacterCreationViewModel viewModel)
    {
        // Name input
        Console.WriteLine($"  NAME: {_characterName}_\n");
        Console.WriteLine("  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        // Character summary
        Console.WriteLine($"  LINEAGE:        {viewModel.SelectedLineage}");
        Console.WriteLine($"  BACKGROUND:     {viewModel.SelectedBackground}");
        Console.WriteLine($"  ARCHETYPE:      {viewModel.SelectedArchetype}");
        Console.WriteLine($"  SPECIALIZATION: {viewModel.SelectedSpecialization}");
        Console.WriteLine("  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        // Attributes
        Console.WriteLine("  ATTRIBUTES:");
        Console.WriteLine($"    MIGHT {viewModel.Attributes?.Might} | " +
                          $"FINESSE {viewModel.Attributes?.Finesse} | " +
                          $"WITS {viewModel.Attributes?.Wits} | " +
                          $"WILL {viewModel.Attributes?.Will} | " +
                          $"STURDINESS {viewModel.Attributes?.Sturdiness}");
        Console.WriteLine("  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        // Resources
        Console.WriteLine("  RESOURCES:");
        Console.WriteLine($"    HP: {viewModel.DerivedStatsPreview?.MaxHealth}");
        Console.WriteLine($"    Stamina: {viewModel.DerivedStatsPreview?.MaxStamina}");
        Console.WriteLine($"    AP: {viewModel.DerivedStatsPreview?.MaxAetherPool}");
        Console.WriteLine("  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        // Abilities
        Console.WriteLine("  ABILITIES:");
        foreach (var ability in viewModel.AbilitiesPreview ?? [])
            Console.WriteLine($"    â€¢ {ability}");
        Console.WriteLine("  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");

        // Equipment
        Console.WriteLine("  STARTING EQUIPMENT:");
        foreach (var item in viewModel.EquipmentPreview ?? [])
            Console.WriteLine($"    â€¢ {item}");
    }

    public bool HandleInput(ConsoleKeyInfo key)
    {
        if (!_nameFieldActive) return false;

        if (key.Key == ConsoleKey.Backspace && _characterName.Length > 0)
        {
            _characterName = _characterName[..^1];
            return true;
        }

        if (char.IsLetterOrDigit(key.KeyChar) ||
            key.KeyChar == ' ' || key.KeyChar == '-')
        {
            if (_characterName.Length < 20)
                _characterName += key.KeyChar;
            return true;
        }

        return false;
    }

    public object? GetSelection() => _characterName;
    public void Reset() => _characterName = "";
}
```

---

## 6. Shared UI Components

### 6.1 OptionListRenderer

```csharp
/// <summary>
/// Renders a selectable list of options with descriptions.
/// </summary>
public static class OptionListRenderer
{
    public static void Render<T>(
        IReadOnlyList<T> options,
        int selectedIndex,
        Func<T, string> getName,
        Func<T, string> getDescription)
    {
        for (int i = 0; i < options.Count; i++)
        {
            var selected = i == selectedIndex;
            var prefix = selected ? "â–¶ " : "  ";
            var item = options[i];

            if (selected)
                Console.ForegroundColor = ConsoleColor.Cyan;

            Console.WriteLine($"{prefix}[{i + 1}] {getName(item)}");
            Console.ResetColor();
            Console.WriteLine($"      {getDescription(item)}");
            Console.WriteLine();
        }
    }
}
```

---

## 7. Input Handling

### 7.1 Key Bindings

| Key          | Context      | Action                    |
| ------------ | ------------ | ------------------------- |
| `â†‘` / `â†“`    | All screens  | Navigate options          |
| `1-9`        | Option lists | Quick select by number    |
| `â†` / `â†’`    | Attributes   | Decrease/Increase value   |
| `Enter`      | All screens  | Confirm and continue      |
| `B`          | Steps 2-6    | Go back to previous step  |
| `Escape`/`C` | All screens  | Cancel creation           |
| `M`          | Attributes   | Toggle Simple/Advanced    |
| `R`          | Attributes   | Reset to defaults         |
| `Tab`        | Lineage      | Select flexible attribute |

---

## 8. Logging Specifications

| Level       | Usage                              |
| ----------- | ---------------------------------- |
| Debug       | Input handling, screen transitions |
| Information | Wizard start/complete/cancel       |
| Warning     | Invalid input attempts             |

---

## 9. Unit Testing Requirements

### 9.1 Test Summary

| Test # | Test Name                               | Description                   |
| ------ | --------------------------------------- | ----------------------------- |
| 1      | `LineageScreen_Renders_AllOptions`      | All 4 lineages displayed      |
| 2      | `AttributeScreen_PointBuy_UpdatesLive`  | Point changes reflect preview |
| 3      | `ArchetypeScreen_ShowsPermanentWarning` | Warning banner displayed      |

**File:** `tests/RuneAndRust.TUI.UnitTests/Screens/CreationScreenTests.cs`

---

## 10. Use Cases

### UC-01: Complete Creation Flow

**Actor:** Player
**Flow:** Start â†’ Lineage â†’ Background â†’ Attributes â†’ Archetype â†’ Specialization â†’ Summary â†’ Confirm

### UC-02: Navigate Back to Change Selection

**Actor:** Player
**Flow:** At Step 4 â†’ Press B â†’ Returns to Step 3 â†’ Modify attributes â†’ Continue

### UC-03: Cancel Mid-Creation

**Actor:** Player
**Flow:** At any step â†’ Press Escape â†’ Confirm cancel â†’ Return to main menu

---

## 11. Deliverable Checklist

### Interfaces

- [ ] `ICreationScreen` - TUI/Interfaces/

### Views

- [ ] `CreationWizardView` - TUI/Views/

### Screens

- [ ] `LineageScreen` - TUI/Screens/
- [ ] `BackgroundScreen` - TUI/Screens/
- [ ] `AttributeScreen` - TUI/Screens/
- [ ] `ArchetypeScreen` - TUI/Screens/
- [ ] `SpecializationScreen` - TUI/Screens/
- [ ] `SummaryScreen` - TUI/Screens/

### Components

- [ ] `OptionListRenderer` - TUI/Components/
- [ ] `StepHeaderRenderer` - TUI/Components/

### Unit Tests

- [ ] `CreationScreenTests` (~3 tests)

---

## 12. Acceptance Criteria

### Functional

- [ ] All 6 step screens render correctly
- [ ] Navigation (Back/Cancel/Continue) functions correctly
- [ ] Archetype step displays PERMANENT warning
- [ ] Attribute point-buy updates derived stats live
- [ ] Clan-Born shows flexible attribute selector
- [ ] Summary displays all selections
- [ ] Name input enforces validation rules

### Non-Functional

- [ ] All screens have consistent visual style
- [ ] Keyboard navigation intuitive
- [ ] All public members have XML documentation
- [ ] All unit tests pass

---

## 13. Future Considerations

### Deferred to v0.17.5g

- Database persistence after confirm

### Out of Scope

- Mouse input support
- Screen animations
- Sound effects

---

## 14. Document Metadata

| Field              | Value       |
| ------------------ | ----------- |
| Version            | 0.17.5f     |
| Status             | Draft       |
| Prerequisites      | v0.17.5a-e  |
| Dependent Versions | v0.17.5g    |
| Est. Complexity    | Medium-High |
| Est. Test Count    | ~3          |

---

_Document Version: 1.0_
_Last Updated: 2026-01-28_
_Author: Claude_
