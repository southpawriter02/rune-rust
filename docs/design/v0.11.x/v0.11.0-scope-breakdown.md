# v0.11.0 Resources & Gathering - Scope Breakdown

**Version:** 0.11.0
**Theme:** Resources & Gathering
**Prerequisites:** v0.10.4c Complete (Advanced Encounters - Monster Groups)
**Total Estimated Tests:** ~25 new tests

---

## Executive Summary

The Resources & Gathering sub-version implements the resource item system including different resource types (ore, herbs, leather, gems, wood, cloth), harvestable room features, and the gathering mechanic with dice checks. Players can harvest resources from environmental features they discover in rooms, with success determined by dice rolls modified by gathering skills.

Key focus areas:
- **Resource Definitions**: Resource types, categories, quality tiers
- **Harvestable Features**: Room features that yield resources
- **Gathering Mechanics**: Dice checks, skill modifiers, quantity rolls

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.11.0a | Resource Definitions | ResourceDefinition, categories, quality, config | ~8 |
| v0.11.0b | Harvestable Features | HarvestableFeature, room integration | ~8 |
| v0.11.0c | Gathering Service | GatheringService, dice checks, gather command | ~9 |

---

## Existing Infrastructure

### Already Implemented (from prior versions)

| Feature | Location | Notes |
|---------|----------|-------|
| Item | `Domain/Entities/Item.cs` | Base item entity |
| ItemDefinition | `Domain/Definitions/ItemDefinition.cs` | Item templates |
| Inventory | `Domain/Entities/Inventory.cs` | Item storage |
| Room | `Domain/Entities/Room.cs` | Room with features |
| RoomFeature | `Domain/Entities/RoomFeature.cs` | Interactable features |
| DiceService | `Application/Services/DiceService.cs` | Dice rolling |
| Player | `Domain/Entities/Player.cs` | Player entity |
| Skills | `Domain/ValueObjects/Skills.cs` | Skill system |

### Needs Implementation (v0.11.0)

| Feature | Part | Notes |
|---------|------|-------|
| ResourceDefinition | v0.11.0a | Resource types |
| ResourceCategory | v0.11.0a | Category enum |
| ResourceQuality | v0.11.0a | Quality tiers |
| IResourceProvider | v0.11.0a | Config loading |
| HarvestableFeature | v0.11.0b | Room feature |
| HarvestableFeatureDefinition | v0.11.0b | Feature templates |
| IGatheringService | v0.11.0c | Service interface |
| GatheringService | v0.11.0c | Gathering logic |
| GatherCommand | v0.11.0c | Player command |

---

## Feature Analysis & Categorization

### Resource Definition Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| ResourceDefinition entity | Medium | Domain | **v0.11.0a** |
| ResourceCategory enum | Low | Domain | **v0.11.0a** |
| ResourceQuality enum | Low | Domain | **v0.11.0a** |
| IResourceProvider interface | Low | Config | **v0.11.0a** |
| ResourceProvider impl | Medium | JSON loading | **v0.11.0a** |
| resources.json config | Medium | Configuration | **v0.11.0a** |

### Harvestable Feature Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| HarvestableFeatureDefinition | Medium | Domain | **v0.11.0b** |
| HarvestableFeature entity | Medium | Room features | **v0.11.0b** |
| Feature-resource linking | Low | Resources | **v0.11.0b** |
| Room feature spawning | Medium | Room generation | **v0.11.0b** |
| Quantity range | Low | Config | **v0.11.0b** |
| Replenishment timing | Medium | Turn tracking | **v0.11.0b** |

### Gathering Service Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| IGatheringService interface | Low | Application | **v0.11.0c** |
| GatheringService impl | High | Features, dice | **v0.11.0c** |
| Dice check calculation | Medium | DiceService | **v0.11.0c** |
| Skill modifier application | Medium | Skills | **v0.11.0c** |
| GatherCommand | Medium | Commands | **v0.11.0c** |
| GatherResult | Low | Results | **v0.11.0c** |

---

## Part Definitions

---

## v0.11.0a: Resource Definitions

[v0.11.0a Design Specification](v0.11.0a-design-specification.md)

### Overview

Define the resource data model including resource definitions, categories, and quality tiers. Resources are loaded from JSON configuration and extend the item system with stacking and category classification.

### Scope

**In Scope:**
- `ResourceDefinition` entity
- `ResourceCategory` enum (ore, herb, leather, gem, wood, cloth)
- `ResourceQuality` enum (common, fine, rare, legendary)
- Resource stacking behavior
- Resource base values
- `IResourceProvider` interface
- `ResourceProvider` implementation
- `resources.json` configuration
- Resource icons

**Out of Scope:**
- Harvestable features (v0.11.0b)
- Gathering mechanics (v0.11.0c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 1 | `ResourceDefinition` |
| Domain Enums | 2 | `ResourceCategory`, `ResourceQuality` |
| Interfaces | 1 | `IResourceProvider` |
| Infrastructure | 1 | `ResourceProvider` |
| Configuration | 1 | `resources.json` |
| Unit Tests | ~8 | Definition loading, validation |

### Resource Definition Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  RESOURCE DEFINITION ARCHITECTURE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Configuration                        Domain
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€

   resources.json                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚     ResourceDefinition      â”‚
   â”‚ {                â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚   "id": "iron-", â”‚  â”€â”€â”€â”€â”€â–¶   â”‚ + ResourceId: string        â”‚
   â”‚   "name": ...,   â”‚           â”‚ + Name: string              â”‚
   â”‚   "category":...,â”‚           â”‚ + Description: string       â”‚
   â”‚   "quality": ... â”‚           â”‚ + Category: ResourceCategoryâ”‚
   â”‚ }                â”‚           â”‚ + Quality: ResourceQuality  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ + BaseValue: int            â”‚
                                  â”‚ + StackSize: int            â”‚
                                  â”‚ + IconPath: string?         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    RESOURCE CATEGORIES
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ORE             HERB            LEATHER         GEM
    â”€â”€â”€             â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”
    â”‚ ï¿½ite â”‚        â”‚ ğŸŒ¿  â”‚         â”‚ ğŸ¦Œ  â”‚        â”‚ ğŸ’  â”‚
    â”‚ Ore â”‚        â”‚Herb â”‚         â”‚Hide â”‚        â”‚ Gem â”‚
    â””â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”˜
    
    â€¢ Iron Ore     â€¢ Healing Herb  â€¢ Leather       â€¢ Ruby
    â€¢ Copper Ore   â€¢ Mana Leaf     â€¢ Thick Hide    â€¢ Sapphire
    â€¢ Gold Ore     â€¢ Poison Root   â€¢ Dragon Scale  â€¢ Emerald
    â€¢ Mithril Ore  â€¢ Firebloom     â€¢ Demon Hide    â€¢ Diamond
    
    WOOD            CLOTH
    â”€â”€â”€â”€            â”€â”€â”€â”€â”€
    â”Œâ”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”
    â”‚ ğŸªµ  â”‚        â”‚ ğŸ§µ  â”‚
    â”‚Wood â”‚        â”‚Clothâ”‚
    â””â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”˜
    
    â€¢ Oak Wood     â€¢ Linen
    â€¢ Ash Wood     â€¢ Silk
    â€¢ Ironwood     â€¢ Enchanted Silk


    QUALITY TIERS
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Quality  â”‚ Modifier  â”‚ Value Mult   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Common   â”‚ +0        â”‚ 1.0x         â”‚
    â”‚ Fine     â”‚ +1        â”‚ 1.5x         â”‚
    â”‚ Rare     â”‚ +2        â”‚ 3.0x         â”‚
    â”‚ Legendaryâ”‚ +3        â”‚ 10.0x        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ResourceDefinition Entity

```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a resource type that can be gathered and used in crafting.
/// </summary>
public class ResourceDefinition : IEntity
{
    public Guid Id { get; private set; }
    public string ResourceId { get; private set; } = null!;
    public string Name { get; private set; } = null!;
    public string Description { get; private set; } = null!;
    public ResourceCategory Category { get; private set; }
    public ResourceQuality Quality { get; private set; }
    public int BaseValue { get; private set; }
    public int StackSize { get; private set; }
    public string? IconPath { get; private set; }
    
    private ResourceDefinition() { }
    
    public static ResourceDefinition Create(
        string resourceId,
        string name,
        string description,
        ResourceCategory category,
        ResourceQuality quality,
        int baseValue,
        int stackSize = 20)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(resourceId);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(baseValue);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(stackSize);
        
        return new ResourceDefinition
        {
            Id = Guid.NewGuid(),
            ResourceId = resourceId.ToLowerInvariant(),
            Name = name,
            Description = description,
            Category = category,
            Quality = quality,
            BaseValue = baseValue,
            StackSize = stackSize
        };
    }
    
    /// <summary>Gets the actual value based on quality.</summary>
    public int GetActualValue()
    {
        return (int)(BaseValue * Quality.GetValueMultiplier());
    }
    
    /// <summary>Checks if this resource can stack with another.</summary>
    public bool CanStackWith(ResourceDefinition other)
    {
        return ResourceId == other.ResourceId;
    }
}
```

### Resource Enums

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories of gatherable resources.
/// </summary>
public enum ResourceCategory
{
    Ore,      // Mined from rock
    Herb,     // Gathered from plants
    Leather,  // Harvested from creatures
    Gem,      // Found in veins or drops
    Wood,     // Cut from trees
    Cloth     // Crafted or found
}

/// <summary>
/// Quality tiers for resources.
/// </summary>
public enum ResourceQuality
{
    Common,    // Standard quality
    Fine,      // Above average
    Rare,      // Valuable
    Legendary  // Exceptional
}

/// <summary>
/// Extension methods for ResourceQuality.
/// </summary>
public static class ResourceQualityExtensions
{
    public static float GetValueMultiplier(this ResourceQuality quality) => quality switch
    {
        ResourceQuality.Common => 1.0f,
        ResourceQuality.Fine => 1.5f,
        ResourceQuality.Rare => 3.0f,
        ResourceQuality.Legendary => 10.0f,
        _ => 1.0f
    };
    
    public static int GetCraftingBonus(this ResourceQuality quality) => quality switch
    {
        ResourceQuality.Common => 0,
        ResourceQuality.Fine => 1,
        ResourceQuality.Rare => 2,
        ResourceQuality.Legendary => 3,
        _ => 0
    };
}
```

### IResourceProvider Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Provides resource definitions.
/// </summary>
public interface IResourceProvider
{
    /// <summary>Gets a resource by ID.</summary>
    ResourceDefinition? GetResource(string resourceId);
    
    /// <summary>Gets all resources.</summary>
    IReadOnlyList<ResourceDefinition> GetAllResources();
    
    /// <summary>Gets resources by category.</summary>
    IReadOnlyList<ResourceDefinition> GetResourcesByCategory(ResourceCategory category);
    
    /// <summary>Gets resources by quality.</summary>
    IReadOnlyList<ResourceDefinition> GetResourcesByQuality(ResourceQuality quality);
    
    /// <summary>Checks if a resource exists.</summary>
    bool Exists(string resourceId);
}
```

### Resource Configuration

```json
{
  "$schema": "./schemas/resources.schema.json",
  "resources": [
    {
      "id": "iron-ore",
      "name": "Iron Ore",
      "description": "Raw iron ore, can be smelted into iron ingots",
      "category": "Ore",
      "quality": "Common",
      "baseValue": 5,
      "stackSize": 20,
      "icon": "icons/resources/iron_ore.png"
    },
    {
      "id": "copper-ore",
      "name": "Copper Ore",
      "description": "Soft copper ore, useful for basic crafting",
      "category": "Ore",
      "quality": "Common",
      "baseValue": 3,
      "stackSize": 20,
      "icon": "icons/resources/copper_ore.png"
    },
    {
      "id": "gold-ore",
      "name": "Gold Ore",
      "description": "Valuable gold ore for fine crafting",
      "category": "Ore",
      "quality": "Fine",
      "baseValue": 25,
      "stackSize": 20,
      "icon": "icons/resources/gold_ore.png"
    },
    {
      "id": "mithril-ore",
      "name": "Mithril Ore",
      "description": "Legendary metal of ancient origin",
      "category": "Ore",
      "quality": "Rare",
      "baseValue": 100,
      "stackSize": 10,
      "icon": "icons/resources/mithril_ore.png"
    },
    {
      "id": "healing-herb",
      "name": "Healing Herb",
      "description": "A herb with restorative properties",
      "category": "Herb",
      "quality": "Common",
      "baseValue": 3,
      "stackSize": 50,
      "icon": "icons/resources/healing_herb.png"
    },
    {
      "id": "mana-leaf",
      "name": "Mana Leaf",
      "description": "A leaf infused with arcane energy",
      "category": "Herb",
      "quality": "Fine",
      "baseValue": 10,
      "stackSize": 50,
      "icon": "icons/resources/mana_leaf.png"
    },
    {
      "id": "firebloom",
      "name": "Firebloom",
      "description": "A rare flower that radiates warmth",
      "category": "Herb",
      "quality": "Rare",
      "baseValue": 40,
      "stackSize": 30,
      "icon": "icons/resources/firebloom.png"
    },
    {
      "id": "leather",
      "name": "Leather",
      "description": "Tanned leather from common creatures",
      "category": "Leather",
      "quality": "Common",
      "baseValue": 8,
      "stackSize": 20,
      "icon": "icons/resources/leather.png"
    },
    {
      "id": "thick-hide",
      "name": "Thick Hide",
      "description": "Sturdy hide from tough creatures",
      "category": "Leather",
      "quality": "Fine",
      "baseValue": 20,
      "stackSize": 15,
      "icon": "icons/resources/thick_hide.png"
    },
    {
      "id": "dragon-scale",
      "name": "Dragon Scale",
      "description": "A scale from a mighty dragon",
      "category": "Leather",
      "quality": "Rare",
      "baseValue": 150,
      "stackSize": 5,
      "icon": "icons/resources/dragon_scale.png"
    },
    {
      "id": "ruby",
      "name": "Ruby",
      "description": "A brilliant red gemstone",
      "category": "Gem",
      "quality": "Rare",
      "baseValue": 100,
      "stackSize": 10,
      "icon": "icons/resources/ruby.png"
    },
    {
      "id": "sapphire",
      "name": "Sapphire",
      "description": "A deep blue gemstone",
      "category": "Gem",
      "quality": "Rare",
      "baseValue": 100,
      "stackSize": 10,
      "icon": "icons/resources/sapphire.png"
    },
    {
      "id": "oak-wood",
      "name": "Oak Wood",
      "description": "Sturdy oak wood for crafting",
      "category": "Wood",
      "quality": "Common",
      "baseValue": 4,
      "stackSize": 20,
      "icon": "icons/resources/oak_wood.png"
    },
    {
      "id": "ironwood",
      "name": "Ironwood",
      "description": "Incredibly dense and strong wood",
      "category": "Wood",
      "quality": "Fine",
      "baseValue": 30,
      "stackSize": 15,
      "icon": "icons/resources/ironwood.png"
    },
    {
      "id": "linen",
      "name": "Linen",
      "description": "Basic cloth material",
      "category": "Cloth",
      "quality": "Common",
      "baseValue": 5,
      "stackSize": 30,
      "icon": "icons/resources/linen.png"
    },
    {
      "id": "silk",
      "name": "Silk",
      "description": "Fine silk cloth",
      "category": "Cloth",
      "quality": "Fine",
      "baseValue": 25,
      "stackSize": 20,
      "icon": "icons/resources/silk.png"
    }
  ]
}
```

### Acceptance Criteria

- [ ] ResourceDefinition loads from JSON
- [ ] All 6 categories represented
- [ ] Quality tiers affect value
- [ ] Stack sizes configured per resource
- [ ] GetResource returns correct definition
- [ ] GetResourcesByCategory filters correctly
- [ ] GetResourcesByQuality filters correctly
- [ ] Quality multipliers calculate correctly
- [ ] ~8 unit tests pass

---

## v0.11.0b: Harvestable Features

[v0.11.0b Design Specification](v0.11.0b-design-specification.md)

### Overview

Implement harvestable room features that yield resources when gathered. Features are placed in rooms and define what resources they provide, difficulty class, quantity ranges, and replenishment behavior.

### Scope

**In Scope:**
- `HarvestableFeatureDefinition` entity
- `HarvestableFeature` room feature
- Resource linking (feature â†’ resource)
- Quantity range (min/max)
- Difficulty class for gathering
- Required tool (optional)
- Replenishment timer
- Feature descriptions
- Room integration
- `harvestable-features.json` configuration

**Out of Scope:**
- Resource definitions (v0.11.0a)
- Gathering mechanics (v0.11.0c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Entities | 2 | `HarvestableFeatureDefinition`, `HarvestableFeature` |
| Room Updates | 1 | Feature integration |
| Configuration | 1 | `harvestable-features.json` |
| Unit Tests | ~8 | Feature definition, room tests |

### Harvestable Feature Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 HARVESTABLE FEATURE ARCHITECTURE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Configuration                        Domain
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€

   harvestable-features.json     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚HarvestableFeatureDefinition â”‚
   â”‚ {                â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚   "id": "ore-",  â”‚  â”€â”€â”€â”€â”€â–¶   â”‚ + FeatureId: string         â”‚
   â”‚   "resourceId":..,           â”‚ + Name: string              â”‚
   â”‚   "minQty": 1,  â”‚           â”‚ + Description: string       â”‚
   â”‚   "maxQty": 5   â”‚           â”‚ + ResourceId: string        â”‚
   â”‚ }                â”‚           â”‚ + MinQuantity: int          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ + MaxQuantity: int          â”‚
                                  â”‚ + DifficultyClass: int      â”‚
                                  â”‚ + RequiredToolId: string?   â”‚
                                  â”‚ + ReplenishTurns: int       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â”‚ creates
                                                 â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚     HarvestableFeature      â”‚
                                  â”‚     (Room instance)         â”‚
                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                  â”‚ + Id: Guid                  â”‚
                                  â”‚ + DefinitionId: string      â”‚
                                  â”‚ + RemainingQuantity: int    â”‚
                                  â”‚ + IsDeplete: bool           â”‚
                                  â”‚ + ReplenishAt: int?         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    ROOM WITH HARVESTABLE FEATURES
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  DARK CAVE                                                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                                  â”‚
    â”‚  You enter a damp cave. Water drips from stalactites above.     â”‚
    â”‚                                                                  â”‚
    â”‚  FEATURES:                                                       â”‚
    â”‚  â”œâ”€ [Ore Vein] A vein of iron ore in the wall                   â”‚
    â”‚  â”‚             DC: 12 | Est. yield: 1-5 Iron Ore                â”‚
    â”‚  â”‚                                                               â”‚
    â”‚  â”œâ”€ [Herb Patch] Healing herbs grow near a dim light source     â”‚
    â”‚  â”‚               DC: 10 | Est. yield: 2-6 Healing Herb          â”‚
    â”‚  â”‚                                                               â”‚
    â”‚  â””â”€ [Gem Cluster] Sparkling gems embedded in rock (needs pick)  â”‚
    â”‚                   DC: 16 | Est. yield: 1-2 Ruby | Tool: Pickaxe â”‚
    â”‚                                                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HarvestableFeatureDefinition Entity

```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a harvestable feature type that appears in rooms.
/// </summary>
public class HarvestableFeatureDefinition : IEntity
{
    public Guid Id { get; private set; }
    public string FeatureId { get; private set; } = null!;
    public string Name { get; private set; } = null!;
    public string Description { get; private set; } = null!;
    public string ResourceId { get; private set; } = null!;
    public int MinQuantity { get; private set; }
    public int MaxQuantity { get; private set; }
    public int DifficultyClass { get; private set; }
    public string? RequiredToolId { get; private set; }
    public int ReplenishTurns { get; private set; }
    public string? IconPath { get; private set; }
    
    private HarvestableFeatureDefinition() { }
    
    public static HarvestableFeatureDefinition Create(
        string featureId,
        string name,
        string description,
        string resourceId,
        int minQuantity,
        int maxQuantity,
        int difficultyClass,
        string? requiredToolId = null,
        int replenishTurns = 0)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(featureId);
        ArgumentException.ThrowIfNullOrWhiteSpace(resourceId);
        ArgumentOutOfRangeException.ThrowIfNegative(minQuantity);
        ArgumentOutOfRangeException.ThrowIfLessThan(maxQuantity, minQuantity);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(difficultyClass);
        
        return new HarvestableFeatureDefinition
        {
            Id = Guid.NewGuid(),
            FeatureId = featureId.ToLowerInvariant(),
            Name = name,
            Description = description,
            ResourceId = resourceId.ToLowerInvariant(),
            MinQuantity = minQuantity,
            MaxQuantity = maxQuantity,
            DifficultyClass = difficultyClass,
            RequiredToolId = requiredToolId?.ToLowerInvariant(),
            ReplenishTurns = replenishTurns
        };
    }
    
    /// <summary>Whether this feature requires a tool to harvest.</summary>
    public bool RequiresTool => RequiredToolId is not null;
    
    /// <summary>Whether this feature replenishes over time.</summary>
    public bool Replenishes => ReplenishTurns > 0;
}
```

### HarvestableFeature Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// An instance of a harvestable feature in a room.
/// </summary>
public class HarvestableFeature : RoomFeature
{
    public string DefinitionId { get; private set; } = null!;
    public int RemainingQuantity { get; private set; }
    public int? ReplenishAtTurn { get; private set; }
    
    private HarvestableFeature() : base() { }
    
    public static HarvestableFeature Create(
        HarvestableFeatureDefinition definition,
        int initialQuantity)
    {
        return new HarvestableFeature
        {
            Id = Guid.NewGuid(),
            DefinitionId = definition.FeatureId,
            Name = definition.Name,
            Description = definition.Description,
            RemainingQuantity = initialQuantity,
            IsInteractable = true,
            InteractionVerb = "gather"
        };
    }
    
    /// <summary>Whether this feature has been depleted.</summary>
    public bool IsDepleted => RemainingQuantity <= 0;
    
    /// <summary>Reduces quantity by amount harvested.</summary>
    public void Harvest(int amount)
    {
        RemainingQuantity = Math.Max(0, RemainingQuantity - amount);
    }
    
    /// <summary>Sets the replenish timer.</summary>
    public void SetReplenishTimer(int currentTurn, int replenishTurns)
    {
        if (replenishTurns > 0)
        {
            ReplenishAtTurn = currentTurn + replenishTurns;
        }
    }
    
    /// <summary>Replenishes the feature to initial quantity.</summary>
    public void Replenish(int quantity)
    {
        RemainingQuantity = quantity;
        ReplenishAtTurn = null;
    }
    
    /// <summary>Checks if the feature should replenish this turn.</summary>
    public bool ShouldReplenish(int currentTurn)
    {
        return ReplenishAtTurn.HasValue && currentTurn >= ReplenishAtTurn.Value;
    }
}
```

### Harvestable Features Configuration

```json
{
  "$schema": "./schemas/harvestable-features.schema.json",
  "harvestableFeatures": [
    {
      "id": "iron-ore-vein",
      "name": "Iron Ore Vein",
      "description": "A vein of iron ore in the rock wall",
      "resourceId": "iron-ore",
      "minQuantity": 1,
      "maxQuantity": 5,
      "difficultyClass": 12,
      "requiredTool": null,
      "replenishTurns": 0,
      "icon": "icons/features/ore_vein.png"
    },
    {
      "id": "copper-ore-vein",
      "name": "Copper Ore Vein",
      "description": "A soft copper vein, easy to mine",
      "resourceId": "copper-ore",
      "minQuantity": 2,
      "maxQuantity": 6,
      "difficultyClass": 10,
      "requiredTool": null,
      "replenishTurns": 0
    },
    {
      "id": "gold-ore-vein",
      "name": "Gold Ore Vein",
      "description": "A precious gold vein gleaming in the dark",
      "resourceId": "gold-ore",
      "minQuantity": 1,
      "maxQuantity": 3,
      "difficultyClass": 15,
      "requiredTool": "pickaxe",
      "replenishTurns": 0
    },
    {
      "id": "herb-patch",
      "name": "Herb Patch",
      "description": "A patch of healing herbs growing in the shade",
      "resourceId": "healing-herb",
      "minQuantity": 2,
      "maxQuantity": 6,
      "difficultyClass": 10,
      "requiredTool": null,
      "replenishTurns": 100,
      "icon": "icons/features/herb_patch.png"
    },
    {
      "id": "mana-leaf-cluster",
      "name": "Mana Leaf Cluster",
      "description": "Glowing leaves infused with arcane power",
      "resourceId": "mana-leaf",
      "minQuantity": 1,
      "maxQuantity": 4,
      "difficultyClass": 13,
      "requiredTool": null,
      "replenishTurns": 150
    },
    {
      "id": "leather-source",
      "name": "Fallen Creature",
      "description": "A creature's remains that can be harvested for leather",
      "resourceId": "leather",
      "minQuantity": 1,
      "maxQuantity": 3,
      "difficultyClass": 11,
      "requiredTool": "skinning-knife",
      "replenishTurns": 0
    },
    {
      "id": "gem-cluster",
      "name": "Gem Cluster",
      "description": "Sparkling gems embedded in the rock",
      "resourceId": "ruby",
      "minQuantity": 1,
      "maxQuantity": 2,
      "difficultyClass": 16,
      "requiredTool": "pickaxe",
      "replenishTurns": 0
    },
    {
      "id": "fallen-tree",
      "name": "Fallen Tree",
      "description": "A fallen oak tree that can be harvested for wood",
      "resourceId": "oak-wood",
      "minQuantity": 3,
      "maxQuantity": 8,
      "difficultyClass": 10,
      "requiredTool": "axe",
      "replenishTurns": 0
    }
  ]
}
```

### Acceptance Criteria

- [ ] HarvestableFeatureDefinition loads from JSON
- [ ] Features link to resource IDs
- [ ] Quantity ranges defined (min/max)
- [ ] Difficulty class specified
- [ ] Required tools optional
- [ ] Replenish turns optional
- [ ] HarvestableFeature tracks remaining quantity
- [ ] IsDepleted returns true when empty
- [ ] Replenishment timer works
- [ ] ~8 unit tests pass

---

## v0.11.0c: Gathering Service

[v0.11.0c Design Specification](v0.11.0c-design-specification.md)

### Overview

Implement the gathering service that handles the mechanics of harvesting resources from features. This includes dice checks, skill modifiers, quantity determination, and the gather player command.

### Scope

**In Scope:**
- `IGatheringService` interface
- `GatheringService` implementation
- Gather dice check (d20 + skill vs DC)
- Survival skill modifier
- Success/failure determination
- Quantity rolled on success
- Quality chance rolls (higher DC = rare chance)
- Tool checking
- Resource addition to inventory
- Feature depletion
- `GatherCommand` implementation
- `GatherResult` record
- `GatherValidation` for pre-checks
- Gathering events

**Out of Scope:**
- Resource definitions (v0.11.0a)
- Harvestable features (v0.11.0b)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Interfaces | 1 | `IGatheringService` |
| Services | 1 | `GatheringService` |
| Commands | 1 | `GatherCommand` |
| Results | 2 | `GatherResult`, `GatherValidation` |
| Events | 2 | `GatherAttemptedEvent`, `ResourceGatheredEvent` |
| Unit Tests | ~9 | Dice checks, gathering tests |

### Gathering Service Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GATHERING SERVICE ARCHITECTURE                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚      GatherCommand         â”‚
                      â”‚   > gather ore-vein        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    IGatheringService       â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ + CanGather(player, feat) â”‚
                      â”‚ + Gather(player, feat)    â”‚
                      â”‚ + GetFeatures(room)       â”‚
                      â”‚ + GetGatherDC(feature)    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚      GatheringService      â”‚
                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                      â”‚ - _resourceProvider       â”‚
                      â”‚ - _featureProvider        â”‚
                      â”‚ - _diceService            â”‚
                      â”‚                           â”‚
                      â”‚ + CheckToolRequirement    â”‚
                      â”‚ + RollGatherCheck         â”‚
                      â”‚ + DetermineQuantity       â”‚
                      â”‚ + DetermineQuality        â”‚
                      â”‚ + AddToInventory          â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    GATHER CHECK FLOW
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    > gather ore-vein
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 1. Validate                          â”‚
    â”‚    â€¢ Feature exists in room? âœ“       â”‚
    â”‚    â€¢ Has required tool? âœ“            â”‚
    â”‚    â€¢ Feature not depleted? âœ“         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 2. Roll gather check                 â”‚
    â”‚    Roll: 1d20 + 3 (Survival) = 16   â”‚
    â”‚    DC: 12                            â”‚
    â”‚    Result: SUCCESS (16 >= 12)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 3. Determine quantity                â”‚
    â”‚    Range: 1-5                        â”‚
    â”‚    Roll: 1d5 = 3                     â”‚
    â”‚    Quantity: 3                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 4. Add to inventory                  â”‚
    â”‚    + Iron Ore x3 (Common)            â”‚
    â”‚                                      â”‚
    â”‚ 5. Update feature                    â”‚
    â”‚    Remaining: 2 â†’ depleted next time â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### IGatheringService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Service for gathering resources from harvestable features.
/// </summary>
public interface IGatheringService
{
    /// <summary>Gets all harvestable features in a room.</summary>
    IReadOnlyList<HarvestableFeature> GetHarvestableFeatures(Room room);
    
    /// <summary>Validates if player can gather from a feature.</summary>
    GatherValidation CanGather(Player player, HarvestableFeature feature);
    
    /// <summary>Attempts to gather resources from a feature.</summary>
    GatherResult Gather(Player player, HarvestableFeature feature);
    
    /// <summary>Gets the difficulty class for a feature.</summary>
    int GetGatherDC(HarvestableFeature feature);
    
    /// <summary>Gets the skill modifier for gathering.</summary>
    int GetGatherModifier(Player player);
    
    /// <summary>Processes replenishment for all features in a room.</summary>
    void ProcessReplenishment(Room room, int currentTurn);
}
```

### GatheringService Implementation

```csharp
namespace RuneAndRust.Application.Services;

public class GatheringService : IGatheringService
{
    private readonly IResourceProvider _resourceProvider;
    private readonly IHarvestableFeatureProvider _featureProvider;
    private readonly IDiceService _diceService;
    private readonly IInventoryService _inventoryService;
    private readonly IEventBus _eventBus;
    private readonly ILogger<GatheringService> _logger;
    
    private const string GatherSkill = "survival";
    
    public GatheringService(
        IResourceProvider resourceProvider,
        IHarvestableFeatureProvider featureProvider,
        IDiceService diceService,
        IInventoryService inventoryService,
        IEventBus eventBus,
        ILogger<GatheringService> logger)
    {
        _resourceProvider = resourceProvider;
        _featureProvider = featureProvider;
        _diceService = diceService;
        _inventoryService = inventoryService;
        _eventBus = eventBus;
        _logger = logger;
    }
    
    public IReadOnlyList<HarvestableFeature> GetHarvestableFeatures(Room room)
    {
        return room.Features
            .OfType<HarvestableFeature>()
            .Where(f => !f.IsDepleted)
            .ToList();
    }
    
    public GatherValidation CanGather(Player player, HarvestableFeature feature)
    {
        if (feature.IsDepleted)
        {
            return GatherValidation.Failed("This resource has been depleted.");
        }
        
        var definition = _featureProvider.GetFeature(feature.DefinitionId);
        if (definition is null)
        {
            return GatherValidation.Failed("Unknown feature type.");
        }
        
        // Check for required tool
        if (definition.RequiresTool)
        {
            var hasTool = player.Inventory.HasItem(definition.RequiredToolId!);
            if (!hasTool)
            {
                return GatherValidation.Failed(
                    $"You need a {definition.RequiredToolId} to gather this resource.");
            }
        }
        
        return GatherValidation.Success(definition.DifficultyClass);
    }
    
    public GatherResult Gather(Player player, HarvestableFeature feature)
    {
        var validation = CanGather(player, feature);
        if (!validation.IsValid)
        {
            return GatherResult.ValidationFailed(validation.FailureReason!);
        }
        
        var definition = _featureProvider.GetFeature(feature.DefinitionId)!;
        var resource = _resourceProvider.GetResource(definition.ResourceId)!;
        
        // Roll gather check
        var modifier = GetGatherModifier(player);
        var roll = _diceService.Roll("1d20");
        var total = roll + modifier;
        var dc = definition.DifficultyClass;
        
        _eventBus.Publish(new GatherAttemptedEvent(
            player.Id, feature.Id, roll, modifier, total, dc));
        
        if (total < dc)
        {
            _logger.LogDebug("{Player} failed gather check: {Total} vs DC {DC}",
                player.Name, total, dc);
            
            return GatherResult.Failed(roll, modifier, total, dc);
        }
        
        // Determine quantity
        var maxAvailable = Math.Min(feature.RemainingQuantity, definition.MaxQuantity);
        var minGather = Math.Min(definition.MinQuantity, maxAvailable);
        var quantityRoll = _diceService.Roll($"1d{maxAvailable - minGather + 1}") + minGather - 1;
        var quantity = Math.Min(quantityRoll, maxAvailable);
        
        // Determine quality (higher rolls can find better quality)
        var quality = DetermineQuality(total, dc, resource.Quality);
        
        // Add to inventory
        _inventoryService.AddResource(player.Inventory, resource.ResourceId, quantity);
        
        // Update feature
        feature.Harvest(quantity);
        if (feature.IsDepleted && definition.Replenishes)
        {
            feature.SetReplenishTimer(_currentTurn, definition.ReplenishTurns);
        }
        
        _logger.LogInformation("{Player} gathered {Qty} {Resource} ({Quality})",
            player.Name, quantity, resource.Name, quality);
        
        _eventBus.Publish(new ResourceGatheredEvent(
            player.Id, resource.ResourceId, quantity, quality));
        
        return GatherResult.Success(
            roll, modifier, total, dc,
            resource.ResourceId, resource.Name, quantity, quality,
            feature.IsDepleted);
    }
    
    public int GetGatherModifier(Player player)
    {
        return player.Skills.GetModifier(GatherSkill);
    }
    
    private ResourceQuality DetermineQuality(int roll, int dc, ResourceQuality baseQuality)
    {
        var margin = roll - dc;
        
        // Natural 20 or roll 10+ over DC: chance for upgrade
        if (margin >= 10)
        {
            return (ResourceQuality)Math.Min((int)baseQuality + 1, (int)ResourceQuality.Legendary);
        }
        
        return baseQuality;
    }
}
```

### GatherResult and GatherValidation

```csharp
namespace RuneAndRust.Application.Results;

public record GatherValidation(bool IsValid, int? DifficultyClass, string? FailureReason)
{
    public static GatherValidation Success(int dc) => new(true, dc, null);
    public static GatherValidation Failed(string reason) => new(false, null, reason);
}

public record GatherResult(
    bool IsSuccess,
    int Roll,
    int Modifier,
    int Total,
    int DifficultyClass,
    string? ResourceId,
    string? ResourceName,
    int Quantity,
    ResourceQuality? Quality,
    bool FeatureDepleted,
    string? FailureReason)
{
    public static GatherResult Success(
        int roll, int modifier, int total, int dc,
        string resourceId, string resourceName, int quantity, 
        ResourceQuality quality, bool depleted)
        => new(true, roll, modifier, total, dc, 
            resourceId, resourceName, quantity, quality, depleted, null);
    
    public static GatherResult Failed(int roll, int modifier, int total, int dc)
        => new(false, roll, modifier, total, dc, 
            null, null, 0, null, false, "Gathering check failed");
    
    public static GatherResult ValidationFailed(string reason)
        => new(false, 0, 0, 0, 0, null, null, 0, null, false, reason);
}
```

### GatherCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to gather resources from a harvestable feature.
/// </summary>
public class GatherCommand : IGameCommand
{
    private readonly IGatheringService _gatheringService;
    private readonly IGameSessionService _sessionService;
    
    public string Name => "gather";
    public string Description => "Gather resources from a harvestable feature";
    public string Usage => "gather <feature-name>";
    
    public GatherCommand(
        IGatheringService gatheringService,
        IGameSessionService sessionService)
    {
        _gatheringService = gatheringService;
        _sessionService = sessionService;
    }
    
    public CommandResult Execute(Player player, string[] args)
    {
        if (args.Length == 0)
        {
            // List available features
            var room = _sessionService.GetCurrentRoom(player);
            var features = _gatheringService.GetHarvestableFeatures(room);
            
            if (features.Count == 0)
            {
                return CommandResult.Info("There is nothing to gather here.");
            }
            
            return CommandResult.List("Harvestable features:", features.Select(f => 
                $"[{f.Name}] - {f.Description}"));
        }
        
        var featureName = string.Join(" ", args).ToLowerInvariant();
        var room = _sessionService.GetCurrentRoom(player);
        var feature = _gatheringService.GetHarvestableFeatures(room)
            .FirstOrDefault(f => f.Name.ToLowerInvariant().Contains(featureName) ||
                                  f.DefinitionId.Contains(featureName));
        
        if (feature is null)
        {
            return CommandResult.Error($"No harvestable feature '{featureName}' found.");
        }
        
        var result = _gatheringService.Gather(player, feature);
        
        if (!result.IsSuccess)
        {
            return CommandResult.Failure(
                $"Gathering Check (DC {result.DifficultyClass}): " +
                $"1d20 ({result.Roll}) + {result.Modifier} = {result.Total}\n" +
                $"âœ— {result.FailureReason}");
        }
        
        var message = 
            $"Gathering Check (DC {result.DifficultyClass}): " +
            $"1d20 ({result.Roll}) + {result.Modifier} = {result.Total}\n" +
            $"âœ“ Success!\n\n" +
            $"You gather:\n" +
            $"  â€¢ {result.ResourceName} x{result.Quantity} ({result.Quality} quality)";
        
        if (result.FeatureDepleted)
        {
            message += "\n\nThe resource has been depleted.";
        }
        
        return CommandResult.Success(message);
    }
}
```

### Acceptance Criteria

- [ ] GetHarvestableFeatures lists room features
- [ ] CanGather validates tool requirements
- [ ] CanGather checks depleted state
- [ ] Gather rolls d20 + skill vs DC
- [ ] Success adds resources to inventory
- [ ] Failure yields nothing
- [ ] Quantity rolled within min/max
- [ ] High rolls can upgrade quality
- [ ] Feature quantity decreases
- [ ] Depleted features marked
- [ ] GatherCommand works
- [ ] Events fire (attempted, gathered)
- [ ] ~9 unit tests pass

---

## Dependencies & Prerequisites

```
v0.10.4c (Monster Groups) - REQUIRED
    â”‚
    â””â”€â”€ Advanced Combat complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
v0.11.0 (Resources & Gathering)                                           â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.11.0a: Resource Definitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: Domain, Configuration                           â”‚
    â”‚       Provides: ResourceDefinition, categories, quality             â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.11.0b: Harvestable Features â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: v0.11.0a (resources), Room system               â”‚
    â”‚       Provides: HarvestableFeature, room integration                â”‚
    â”‚                                                                     â”‚
    â””â”€â”€ v0.11.0c: Gathering Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: v0.11.0a, v0.11.0b, DiceService, Skills
            Provides: IGatheringService, GatherCommand
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.11.0a | ~4 | ~1 | ~8 | Medium |
| v0.11.0b | ~3 | ~2 | ~8 | Medium |
| v0.11.0c | ~4 | ~2 | ~9 | Medium-High |
| **Total** | **~11** | **~5** | **~25** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Resource economy balance | Medium | Medium | Configurable spawn rates |
| Stack overflow | Low | Low | Stack size limits |
| Tool requirement confusion | Low | Medium | Clear error messages |
| Replenishment timing | Low | Low | Thorough testing |

---

## Design Decisions (Confirmed)

### Resources

| Decision | Value | Notes |
|----------|-------|-------|
| **Categories** | 6 types | Ore, herb, leather, gem, wood, cloth |
| **Quality Tiers** | 4 | Common, fine, rare, legendary |
| **Stack Sizes** | Per-resource | Herbs 50, ore 20, gems 10 |

### Harvestable Features

| Decision | Value | Notes |
|----------|-------|-------|
| **DC Range** | 10-18 | Easy to hard |
| **Quantity** | Min/max per feature | Configurable |
| **Replenishment** | Turn-based | 0 = never |

### Gathering

| Decision | Value | Notes |
|----------|-------|-------|
| **Skill** | Survival | Existing skill |
| **Roll** | d20 + modifier | Standard check |
| **Quality Upgrade** | Margin 10+ | Chance for better |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.11.0a Design Spec** - Create detailed design for Resource Definitions
3. **v0.11.0a Implementation** - Build resource system
4. **v0.11.0b Design Spec** - Create specification for Harvestable Features
5. **v0.11.0b Implementation** - Build feature system
6. **v0.11.0c Design Spec** - Create specification for Gathering Service
7. **v0.11.0c Implementation** - Build gathering mechanics

---

*This scope breakdown provides a structured approach to implementing v0.11.0 Resources & Gathering. The foundation for the crafting system starts with robust resource definitions, harvestable features, and skill-based gathering mechanics.*
