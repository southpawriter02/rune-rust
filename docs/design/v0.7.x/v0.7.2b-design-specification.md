# v0.7.2b Design Specification: Context Menus

**Version:** 0.7.2b
**Parent:** v0.7.2 (Interactive Panels)
**Prerequisites:** v0.7.2a Complete (Inventory Panel)
**Status:** Design Complete
**Estimated Unit Tests:** ~10

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Context Menu Service Interface](#4-context-menu-service-interface)
5. [Context Menu Service Implementation](#5-context-menu-service-implementation)
6. [Menu Definitions](#6-menu-definitions)
7. [Integration Points](#7-integration-points)
8. [Menu Actions](#8-menu-actions)
9. [Styles](#9-styles)
10. [Data Model Changes](#10-data-model-changes)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)

---

## 1. Overview

### Purpose

This phase implements context menu functionality for right-click actions on items, equipment, and entities. Context menus provide quick access to common actions (Use, Equip, Drop, Attack, Talk, Examine) without requiring typed commands. These menus integrate with the InventoryPanel from v0.7.2a and the RoomDisplayPanel from v0.7.1a.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Interfaces** | `IContextMenuService` |
| **Services** | `ContextMenuService` |
| **Menu Types** | Item, Consumable, Weapon, Equipped, Monster, NPC, Ground Item |
| **Actions** | Use, Equip, Unequip, Drop, Take, Attack, Talk, Examine |
| **Styles** | `ContextMenuStyles.axaml` |
| **Tests** | ~10 unit tests |

### Design Principles

1. **Contextual Actions**: Show only relevant actions for each target type
2. **Command Integration**: Execute commands through existing CommandHandler
3. **Visual Consistency**: Match existing Fluent theme styling
4. **Discoverability**: Clear icons and labels for all actions

---

## 2. Feature Overview

```
v0.7.2b Features
â”œâ”€â”€ Context Menu Service
â”‚   â”œâ”€â”€ IContextMenuService interface
â”‚   â”œâ”€â”€ ContextMenuService implementation
â”‚   â”œâ”€â”€ Menu factory methods
â”‚   â””â”€â”€ Action execution
â”œâ”€â”€ Item Menus
â”‚   â”œâ”€â”€ Generic item (Examine, Drop)
â”‚   â”œâ”€â”€ Consumable (Use, Examine, Drop)
â”‚   â”œâ”€â”€ Weapon/Armor (Equip, Examine, Drop)
â”‚   â””â”€â”€ Equipped item (Unequip, Examine)
â”œâ”€â”€ Entity Menus
â”‚   â”œâ”€â”€ Monster (Attack, Examine)
â”‚   â””â”€â”€ NPC (Talk, Examine)
â”œâ”€â”€ Environment Menus
â”‚   â””â”€â”€ Ground item (Take, Examine)
â”œâ”€â”€ Menu Actions
â”‚   â”œâ”€â”€ Use action
â”‚   â”œâ”€â”€ Equip/Unequip actions
â”‚   â”œâ”€â”€ Drop/Take actions
â”‚   â”œâ”€â”€ Attack action
â”‚   â”œâ”€â”€ Talk action
â”‚   â””â”€â”€ Examine action
â””â”€â”€ Styles
    â””â”€â”€ ContextMenuStyles.axaml
```

---

## 3. Architecture

### Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       PRESENTATION LAYER                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  SERVICES                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    IContextMenuService                             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ + CreateItemMenu(item, isEquipped): ContextMenu                   â”‚ â”‚
â”‚  â”‚ + CreateMonsterMenu(monster): ContextMenu                         â”‚ â”‚
â”‚  â”‚ + CreateNpcMenu(npc): ContextMenu                                 â”‚ â”‚
â”‚  â”‚ + CreateGroundItemMenu(item): ContextMenu                         â”‚ â”‚
â”‚  â”‚ + ShowMenu(menu, target, position): void                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                              â”‚
â”‚                          â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    ContextMenuService                              â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ - _gameSession: IGameSessionService                               â”‚ â”‚
â”‚  â”‚ - _logger: ILogger<ContextMenuService>                            â”‚ â”‚
â”‚  â”‚ + CreateItemMenu(item, isEquipped): ContextMenu                   â”‚ â”‚
â”‚  â”‚ + CreateMonsterMenu(monster): ContextMenu                         â”‚ â”‚
â”‚  â”‚ + CreateNpcMenu(npc): ContextMenu                                 â”‚ â”‚
â”‚  â”‚ + CreateGroundItemMenu(item): ContextMenu                         â”‚ â”‚
â”‚  â”‚ - CreateMenuItem(header, action): MenuItem                        â”‚ â”‚
â”‚  â”‚ - ExecuteCommand(command): void                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  INTEGRATION POINTS                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    InventoryPanel                                  â”‚ â”‚
â”‚  â”‚                         â”‚                                          â”‚ â”‚
â”‚  â”‚     OnSlotRightClick â”€â”€â”€â”¼â”€â”€â–º CreateItemMenu(item, isEquipped)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    RoomDisplayPanel                                â”‚ â”‚
â”‚  â”‚                         â”‚                                          â”‚ â”‚
â”‚  â”‚   OnMonsterRightClick â”€â”€â”¼â”€â”€â–º CreateMonsterMenu(monster)           â”‚ â”‚
â”‚  â”‚   OnItemRightClick â”€â”€â”€â”€â”€â”¼â”€â”€â–º CreateGroundItemMenu(item)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APPLICATION LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      IGameSessionService                           â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ + ExecuteCommand(command): void                                    â”‚â”‚
â”‚  â”‚ + IsEquipped(item): bool                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Menu Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CONTEXT MENU FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Right-click on target (item, monster, NPC)
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Panel.OnRightClick(sender, e)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Determine target type                                              â”‚
â”‚  2. Call appropriate CreateXxxMenu method                              â”‚
â”‚  3. Show menu at mouse position                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ContextMenuService.CreateXxxMenu(target)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Create ContextMenu                                                 â”‚
â”‚  2. Add header with target name/icon                                   â”‚
â”‚  3. Add type-specific action items                                     â”‚
â”‚  4. Add Cancel item                                                    â”‚
â”‚  5. Return menu                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User clicks menu item                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ExecuteCommand("action target")                                       â”‚
â”‚  Menu closes automatically                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Context Menu Service Interface

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/IContextMenuService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

using global::Avalonia;
using global::Avalonia.Controls;
using RuneAndRust.Domain.Entities;

/// <summary>
/// Creates and manages context menus for game elements.
/// </summary>
public interface IContextMenuService
{
    /// <summary>
    /// Creates a context menu for an inventory item.
    /// </summary>
    /// <param name="item">The item to create a menu for.</param>
    /// <param name="isEquipped">Whether the item is currently equipped.</param>
    /// <returns>A context menu with appropriate actions.</returns>
    ContextMenu CreateItemMenu(Item item, bool isEquipped = false);

    /// <summary>
    /// Creates a context menu for a monster.
    /// </summary>
    /// <param name="monster">The monster to create a menu for.</param>
    /// <returns>A context menu with attack and examine options.</returns>
    ContextMenu CreateMonsterMenu(Monster monster);

    /// <summary>
    /// Creates a context menu for an NPC.
    /// </summary>
    /// <param name="npc">The NPC to create a menu for.</param>
    /// <returns>A context menu with talk and examine options.</returns>
    ContextMenu CreateNpcMenu(Npc npc);

    /// <summary>
    /// Creates a context menu for an item on the ground.
    /// </summary>
    /// <param name="item">The ground item to create a menu for.</param>
    /// <returns>A context menu with take and examine options.</returns>
    ContextMenu CreateGroundItemMenu(Item item);

    /// <summary>
    /// Shows a context menu at the specified location.
    /// </summary>
    /// <param name="menu">The menu to display.</param>
    /// <param name="target">The control that triggered the menu.</param>
    /// <param name="position">The position relative to the target.</param>
    void ShowMenu(ContextMenu menu, Control target, Point position);
}
```

---

## 5. Context Menu Service Implementation

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/ContextMenuService.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

using global::Avalonia;
using global::Avalonia.Controls;
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;

/// <summary>
/// Creates and manages context menus for game elements.
/// </summary>
public class ContextMenuService : IContextMenuService
{
    private readonly IGameSessionService _gameSession;
    private readonly ILogger<ContextMenuService> _logger;

    public ContextMenuService(
        IGameSessionService gameSession,
        ILogger<ContextMenuService> logger)
    {
        _gameSession = gameSession;
        _logger = logger;
    }

    /// <inheritdoc />
    public ContextMenu CreateItemMenu(Item item, bool isEquipped = false)
    {
        var menu = new ContextMenu();
        
        // Header
        var equippedIndicator = isEquipped ? " [E]" : "";
        menu.Items.Add(CreateHeader($"{item.GetCategoryIcon()} {item.Name}{equippedIndicator}"));
        menu.Items.Add(new Separator());

        // Examine (always available)
        menu.Items.Add(CreateMenuItem("ğŸ” Examine", () => ExecuteCommand($"examine {item.Id}")));

        // Type-specific actions
        if (isEquipped)
        {
            menu.Items.Add(CreateMenuItem("â¬†ï¸ Unequip", () => ExecuteCommand($"unequip {item.Id}")));
        }
        else
        {
            if (item.IsConsumable)
            {
                menu.Items.Add(CreateMenuItem("âœ‹ Use", () => ExecuteCommand($"use {item.Id}")));
            }

            if (item.IsEquippable)
            {
                menu.Items.Add(CreateMenuItem("âš” Equip", () => ExecuteCommand($"equip {item.Id}")));
            }

            menu.Items.Add(CreateMenuItem("â¬‡ï¸ Drop", () => ExecuteCommand($"drop {item.Id}")));
        }

        // Cancel
        menu.Items.Add(new Separator());
        menu.Items.Add(CreateMenuItem("âŒ Cancel", () => menu.Close()));

        _logger.LogDebug("Created item menu for {ItemName}", item.Name);
        return menu;
    }

    /// <inheritdoc />
    public ContextMenu CreateMonsterMenu(Monster monster)
    {
        var menu = new ContextMenu();

        // Header
        menu.Items.Add(CreateHeader($"â˜  {monster.Name}"));
        menu.Items.Add(new Separator());

        // Actions
        menu.Items.Add(CreateMenuItem("ğŸ” Examine", () => ExecuteCommand($"examine {monster.Id}")));
        menu.Items.Add(CreateMenuItem("âš” Attack", () => ExecuteCommand($"attack {monster.Id}")));

        // Cancel
        menu.Items.Add(new Separator());
        menu.Items.Add(CreateMenuItem("âŒ Cancel", () => menu.Close()));

        _logger.LogDebug("Created monster menu for {MonsterName}", monster.Name);
        return menu;
    }

    /// <inheritdoc />
    public ContextMenu CreateNpcMenu(Npc npc)
    {
        var menu = new ContextMenu();

        // Header
        menu.Items.Add(CreateHeader($"ğŸ‘¤ {npc.Name}"));
        menu.Items.Add(new Separator());

        // Actions
        menu.Items.Add(CreateMenuItem("ğŸ” Examine", () => ExecuteCommand($"examine {npc.Id}")));
        menu.Items.Add(CreateMenuItem("ğŸ’¬ Talk", () => ExecuteCommand($"talk {npc.Id}")));

        // Cancel
        menu.Items.Add(new Separator());
        menu.Items.Add(CreateMenuItem("âŒ Cancel", () => menu.Close()));

        _logger.LogDebug("Created NPC menu for {NpcName}", npc.Name);
        return menu;
    }

    /// <inheritdoc />
    public ContextMenu CreateGroundItemMenu(Item item)
    {
        var menu = new ContextMenu();

        // Header
        menu.Items.Add(CreateHeader($"{item.GetCategoryIcon()} {item.Name} [Ground]"));
        menu.Items.Add(new Separator());

        // Actions
        menu.Items.Add(CreateMenuItem("ğŸ” Examine", () => ExecuteCommand($"examine {item.Id}")));
        menu.Items.Add(CreateMenuItem("âœ‹ Take", () => ExecuteCommand($"take {item.Id}")));

        // Cancel
        menu.Items.Add(new Separator());
        menu.Items.Add(CreateMenuItem("âŒ Cancel", () => menu.Close()));

        _logger.LogDebug("Created ground item menu for {ItemName}", item.Name);
        return menu;
    }

    /// <inheritdoc />
    public void ShowMenu(ContextMenu menu, Control target, Point position)
    {
        menu.PlacementTarget = target;
        menu.Placement = global::Avalonia.Controls.PlacementMode.Pointer;
        menu.Open(target);
        
        _logger.LogDebug("Showing context menu at ({X}, {Y})", position.X, position.Y);
    }

    private static MenuItem CreateHeader(string text)
    {
        return new MenuItem
        {
            Header = text,
            IsEnabled = false,
            Classes = { "menu-header" }
        };
    }

    private MenuItem CreateMenuItem(string header, Action action)
    {
        var item = new MenuItem { Header = header };
        item.Click += (_, _) =>
        {
            action();
        };
        return item;
    }

    private void ExecuteCommand(string command)
    {
        _logger.LogInformation("Executing context menu command: {Command}", command);
        _gameSession.ExecuteCommand(command);
    }
}
```

---

## 6. Menu Definitions

### Visual Layouts

```
GENERIC ITEM MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’ Red Gem           â”‚ (header, disabled)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ â¬‡ï¸ Drop              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CONSUMABLE MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§ª Healing Potion    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ âœ‹ Use               â”‚
â”‚ â¬‡ï¸ Drop              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

WEAPON/ARMOR MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš” Iron Sword         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ âš” Equip             â”‚
â”‚ â¬‡ï¸ Drop              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EQUIPPED ITEM MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš” Iron Sword [E]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ â¬†ï¸ Unequip           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MONSTER MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜  Skeleton           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ âš” Attack            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NPC MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ Shopkeeper        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ ğŸ’¬ Talk              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GROUND ITEM MENU:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’ Red Gem [Ground]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Examine           â”‚
â”‚ âœ‹ Take              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âŒ Cancel            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Menu Action Matrix

| Target Type | Examine | Use | Equip | Unequip | Drop | Take | Attack | Talk |
|-------------|---------|-----|-------|---------|------|------|--------|------|
| Generic Item | âœ… | âŒ | âŒ | âŒ | âœ… | âŒ | âŒ | âŒ |
| Consumable | âœ… | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ | âŒ |
| Weapon/Armor | âœ… | âŒ | âœ… | âŒ | âœ… | âŒ | âŒ | âŒ |
| Equipped | âœ… | âŒ | âŒ | âœ… | âŒ | âŒ | âŒ | âŒ |
| Monster | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âœ… | âŒ |
| NPC | âœ… | âŒ | âŒ | âŒ | âŒ | âŒ | âŒ | âœ… |
| Ground Item | âœ… | âŒ | âŒ | âŒ | âŒ | âœ… | âŒ | âŒ |

---

## 7. Integration Points

### Inventory Panel Integration

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/InventoryPanel.axaml.cs` (additions)

```csharp
public partial class InventoryPanel : UserControl
{
    private readonly IContextMenuService? _contextMenuService;

    public InventoryPanel()
    {
        InitializeComponent();
    }

    public InventoryPanel(IContextMenuService contextMenuService) : this()
    {
        _contextMenuService = contextMenuService;
    }

    private void OnSlotPointerPressed(object? sender, PointerPressedEventArgs e)
    {
        if (sender is not ItemSlotControl control ||
            DataContext is not InventoryPanelViewModel vm)
            return;

        var point = e.GetCurrentPoint(control);

        if (point.Properties.IsLeftButtonPressed)
        {
            // Left-click: select
            if (control.DataContext is ItemSlotViewModel slotVm)
            {
                vm.SelectSlotCommand.Execute(slotVm);
            }
        }
        else if (point.Properties.IsRightButtonPressed)
        {
            // Right-click: context menu
            if (control.DataContext is ItemSlotViewModel { Item: not null } slotVm)
            {
                ShowItemContextMenu(slotVm.Item, control, e.GetPosition(control));
            }
        }
    }

    private void ShowItemContextMenu(Item item, Control target, Point position)
    {
        if (_contextMenuService is null)
            return;

        var isEquipped = DataContext is InventoryPanelViewModel vm && 
                         vm.IsItemEquipped(item);
        
        var menu = _contextMenuService.CreateItemMenu(item, isEquipped);
        _contextMenuService.ShowMenu(menu, target, position);
    }
}
```

### Room Display Panel Integration

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/RoomDisplayPanel.axaml.cs` (additions)

```csharp
public partial class RoomDisplayPanel : UserControl
{
    private readonly IContextMenuService? _contextMenuService;

    public RoomDisplayPanel()
    {
        InitializeComponent();
    }

    public RoomDisplayPanel(IContextMenuService contextMenuService) : this()
    {
        _contextMenuService = contextMenuService;
    }

    private void OnMonsterPointerPressed(object? sender, PointerPressedEventArgs e)
    {
        if (e.GetCurrentPoint(this).Properties.IsRightButtonPressed &&
            sender is Control { DataContext: EntityViewModel entityVm } control)
        {
            ShowMonsterContextMenu(entityVm, control, e.GetPosition(control));
        }
    }

    private void OnItemPointerPressed(object? sender, PointerPressedEventArgs e)
    {
        if (e.GetCurrentPoint(this).Properties.IsRightButtonPressed &&
            sender is Control { DataContext: ItemViewModel itemVm } control)
        {
            ShowGroundItemContextMenu(itemVm, control, e.GetPosition(control));
        }
    }

    private void ShowMonsterContextMenu(EntityViewModel entity, Control target, Point position)
    {
        if (_contextMenuService is null || 
            DataContext is not RoomDisplayViewModel vm)
            return;

        // Get actual Monster from game session
        var monster = vm.GetMonsterByName(entity.Name);
        if (monster is null) return;

        var menu = _contextMenuService.CreateMonsterMenu(monster);
        _contextMenuService.ShowMenu(menu, target, position);
    }

    private void ShowGroundItemContextMenu(ItemViewModel itemVm, Control target, Point position)
    {
        if (_contextMenuService is null ||
            DataContext is not RoomDisplayViewModel vm)
            return;

        // Get actual Item from game session
        var item = vm.GetItemByName(itemVm.Name);
        if (item is null) return;

        var menu = _contextMenuService.CreateGroundItemMenu(item);
        _contextMenuService.ShowMenu(menu, target, position);
    }
}
```

### XAML Updates for Right-Click

**File:** `src/Presentation/RuneAndRust.Avalonia/Controls/RoomDisplayPanel.axaml` (additions)

```xml
<!-- Monsters with right-click -->
<ItemsControl ItemsSource="{Binding VisibleMonsters}">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal" 
                        Margin="8,2"
                        PointerPressed="OnMonsterPointerPressed"
                        Cursor="Hand">
                <TextBlock Text="{Binding Symbol}"
                           Foreground="{StaticResource DamageColor}"
                           Margin="0,0,8,0" />
                <TextBlock Text="{Binding DisplayText}"
                           Classes="body" />
            </StackPanel>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl>

<!-- Items with right-click -->
<ItemsControl ItemsSource="{Binding VisibleItems}">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <StackPanel Orientation="Horizontal" 
                        Margin="8,2"
                        PointerPressed="OnItemPointerPressed"
                        Cursor="Hand">
                <TextBlock Text="{Binding Symbol}"
                           Foreground="{StaticResource AccentBrush}"
                           Margin="0,0,8,0" />
                <TextBlock Text="{Binding Name}"
                           Classes="body" />
            </StackPanel>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl>
```

---

## 8. Menu Actions

### Action Command Mapping

| Action | Icon | Command Format | Example |
|--------|------|----------------|---------|
| Examine | ğŸ” | `examine {id}` | `examine item_123` |
| Use | âœ‹ | `use {id}` | `use potion_456` |
| Equip | âš” | `equip {id}` | `equip sword_789` |
| Unequip | â¬†ï¸ | `unequip {id}` | `unequip sword_789` |
| Drop | â¬‡ï¸ | `drop {id}` | `drop gem_012` |
| Take | âœ‹ | `take {id}` | `take key_345` |
| Attack | âš” | `attack {id}` | `attack skeleton_678` |
| Talk | ğŸ’¬ | `talk {id}` | `talk shopkeeper_901` |
| Cancel | âŒ | *(closes menu)* | *(no command)* |

### Action Helper Class

**File:** `src/Presentation/RuneAndRust.Avalonia/Services/MenuAction.cs`

```csharp
namespace RuneAndRust.Avalonia.Services;

/// <summary>
/// Static class containing menu action definitions.
/// </summary>
public static class MenuActions
{
    public const string ExamineIcon = "ğŸ”";
    public const string UseIcon = "âœ‹";
    public const string EquipIcon = "âš”";
    public const string UnequipIcon = "â¬†ï¸";
    public const string DropIcon = "â¬‡ï¸";
    public const string TakeIcon = "âœ‹";
    public const string AttackIcon = "âš”";
    public const string TalkIcon = "ğŸ’¬";
    public const string CancelIcon = "âŒ";

    public static string Examine(string label = "Examine") => $"{ExamineIcon} {label}";
    public static string Use(string label = "Use") => $"{UseIcon} {label}";
    public static string Equip(string label = "Equip") => $"{EquipIcon} {label}";
    public static string Unequip(string label = "Unequip") => $"{UnequipIcon} {label}";
    public static string Drop(string label = "Drop") => $"{DropIcon} {label}";
    public static string Take(string label = "Take") => $"{TakeIcon} {label}";
    public static string Attack(string label = "Attack") => $"{AttackIcon} {label}";
    public static string Talk(string label = "Talk") => $"{TalkIcon} {label}";
    public static string Cancel(string label = "Cancel") => $"{CancelIcon} {label}";
}
```

---

## 9. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/ContextMenuStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    
    <!-- Context Menu Base -->
    <Style Selector="ContextMenu">
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
        <Setter Property="BorderThickness" Value="1" />
        <Setter Property="CornerRadius" Value="4" />
        <Setter Property="Padding" Value="4" />
        <Setter Property="MinWidth" Value="150" />
    </Style>
    
    <!-- Menu Item -->
    <Style Selector="ContextMenu > MenuItem">
        <Setter Property="Padding" Value="8,6" />
        <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}" />
    </Style>
    
    <Style Selector="ContextMenu > MenuItem:pointerover">
        <Setter Property="Background" Value="{StaticResource PrimaryBrush}" />
    </Style>
    
    <!-- Menu Header (disabled, styled differently) -->
    <Style Selector="MenuItem.menu-header">
        <Setter Property="FontWeight" Value="SemiBold" />
        <Setter Property="Foreground" Value="{StaticResource TextAccentBrush}" />
        <Setter Property="IsHitTestVisible" Value="False" />
    </Style>
    
    <Style Selector="MenuItem.menu-header:disabled">
        <Setter Property="Opacity" Value="1" />
    </Style>
    
    <!-- Separator -->
    <Style Selector="ContextMenu > Separator">
        <Setter Property="Background" Value="{StaticResource BorderBrush}" />
        <Setter Property="Height" Value="1" />
        <Setter Property="Margin" Value="4,4" />
    </Style>
    
    <!-- Cancel Item (subtle styling) -->
    <Style Selector="MenuItem:contains('Cancel')">
        <Setter Property="Foreground" Value="{StaticResource TextMutedBrush}" />
    </Style>
    
    <!-- Dangerous actions (drop, attack) -->
    <Style Selector="MenuItem:contains('Drop')">
        <Setter Property="Foreground" Value="{StaticResource WarningColor}" />
    </Style>
    
    <Style Selector="MenuItem:contains('Attack')">
        <Setter Property="Foreground" Value="{StaticResource DamageColor}" />
    </Style>
    
</Styles>
```

---

## 10. Data Model Changes

### New Types

| Type | Layer | Description |
|------|-------|-------------|
| `IContextMenuService` | Presentation | Menu service interface |
| `ContextMenuService` | Presentation | Menu service implementation |
| `MenuActions` | Presentation | Static action helpers |

### ViewModel Extensions

| Type | Method | Description |
|------|--------|-------------|
| `InventoryPanelViewModel` | `IsItemEquipped(item)` | Checks equipped status |
| `RoomDisplayViewModel` | `GetMonsterByName(name)` | Gets Monster entity |
| `RoomDisplayViewModel` | `GetItemByName(name)` | Gets ground Item entity |

### DI Registration

**File:** `src/Presentation/RuneAndRust.Avalonia/App.axaml.cs` (additions)

```csharp
// In ConfigureServices
services.AddSingleton<IContextMenuService, ContextMenuService>();
```

---

## 11. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| `ContextMenuService` | Debug | Menu creation |
| `ContextMenuService` | Information | Command execution |
| `ContextMenuService` | Debug | Menu display position |

---

## 12. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| ContextMenuService | ~6 |
| Menu action mapping | ~2 |
| Integration helpers | ~2 |
| **Total** | **~10** |

### Test Specifications

**File:** `tests/RuneAndRust.Avalonia.UnitTests/Services/ContextMenuServiceTests.cs`

```csharp
[TestFixture]
public class ContextMenuServiceTests
{
    private Mock<IGameSessionService> _gameSessionMock;
    private Mock<ILogger<ContextMenuService>> _loggerMock;
    private ContextMenuService _service;

    [SetUp]
    public void Setup()
    {
        _gameSessionMock = new Mock<IGameSessionService>();
        _loggerMock = new Mock<ILogger<ContextMenuService>>();
        _service = new ContextMenuService(_gameSessionMock.Object, _loggerMock.Object);
    }

    [Test]
    public void CreateItemMenu_ForGenericItem_HasExamineAndDrop()
    {
        // Arrange
        var item = new Item { Name = "Red Gem", ItemType = "treasure" };

        // Act
        var menu = _service.CreateItemMenu(item);

        // Assert
        menu.Items.Should().HaveCountGreaterThan(3);
        // Verify Examine and Drop are present
    }

    [Test]
    public void CreateItemMenu_ForConsumable_HasUseOption()
    {
        // Arrange
        var item = new Item { Name = "Health Potion", IsConsumable = true };

        // Act
        var menu = _service.CreateItemMenu(item);

        // Assert
        // Verify Use option is present
    }

    [Test]
    public void CreateItemMenu_ForEquippable_HasEquipOption()
    {
        // Arrange
        var item = new Item { Name = "Iron Sword", IsEquippable = true };

        // Act
        var menu = _service.CreateItemMenu(item);

        // Assert
        // Verify Equip option is present
    }

    [Test]
    public void CreateItemMenu_WhenEquipped_HasUnequipOption()
    {
        // Arrange
        var item = new Item { Name = "Iron Sword", IsEquippable = true };

        // Act
        var menu = _service.CreateItemMenu(item, isEquipped: true);

        // Assert
        // Verify Unequip option is present, Equip and Drop are NOT
    }

    [Test]
    public void CreateMonsterMenu_HasExamineAndAttack()
    {
        // Arrange
        var monster = new Monster { Name = "Skeleton" };

        // Act
        var menu = _service.CreateMonsterMenu(monster);

        // Assert
        // Verify Examine and Attack are present
    }

    [Test]
    public void CreateNpcMenu_HasExamineAndTalk()
    {
        // Arrange
        var npc = new Npc { Name = "Shopkeeper" };

        // Act
        var menu = _service.CreateNpcMenu(npc);

        // Assert
        // Verify Examine and Talk are present
    }
}
```

---

## 13. Use Cases

### UC-072b-001: Right-Click Inventory Item
**Actor:** Player
**Flow:** Right-click item in inventory â†’ Context menu appears â†’ Select action â†’ Command executes

### UC-072b-002: Use Consumable
**Actor:** Player
**Flow:** Right-click potion â†’ Select "Use" â†’ Potion consumed â†’ Effects applied

### UC-072b-003: Equip Weapon
**Actor:** Player
**Flow:** Right-click weapon â†’ Select "Equip" â†’ Weapon equipped â†’ Status updates

### UC-072b-004: Unequip Item
**Actor:** Player
**Flow:** Right-click equipped item (shows [E]) â†’ Select "Unequip" â†’ Item returns to inventory

### UC-072b-005: Attack Monster
**Actor:** Player
**Flow:** Right-click monster in room â†’ Select "Attack" â†’ Combat begins

### UC-072b-006: Talk to NPC
**Actor:** Player
**Flow:** Right-click NPC â†’ Select "Talk" â†’ Dialogue begins

### UC-072b-007: Take Ground Item
**Actor:** Player
**Flow:** Right-click item in room â†’ Select "Take" â†’ Item added to inventory

### UC-072b-008: Cancel Menu
**Actor:** Player
**Flow:** Right-click target â†’ Select "Cancel" â†’ Menu closes, no action

---

## 14. Deliverable Checklist

### Interfaces
- [ ] `Services/IContextMenuService.cs` created

### Services
- [ ] `Services/ContextMenuService.cs` created
- [ ] `Services/MenuActions.cs` created

### Styles
- [ ] `Styles/ContextMenuStyles.axaml` created

### Integration
- [ ] `InventoryPanel.axaml.cs` updated with right-click handling
- [ ] `RoomDisplayPanel.axaml.cs` updated with right-click handling
- [ ] `RoomDisplayPanel.axaml` updated with PointerPressed handlers
- [ ] DI registration added for IContextMenuService

### ViewModel Extensions
- [ ] `InventoryPanelViewModel.IsItemEquipped()` added
- [ ] `RoomDisplayViewModel.GetMonsterByName()` added
- [ ] `RoomDisplayViewModel.GetItemByName()` added

### Testing
- [ ] ~10 unit tests implemented
- [ ] All tests passing

---

## 15. Acceptance Criteria

### Item Menus
- [ ] Right-click on inventory item shows menu
- [ ] Generic items show Examine and Drop
- [ ] Consumables show Use option
- [ ] Equipment shows Equip option
- [ ] Equipped items show [E] and Unequip option

### Entity Menus
- [ ] Right-click on monster shows menu
- [ ] Monster menu has Attack and Examine
- [ ] Right-click on NPC shows menu
- [ ] NPC menu has Talk and Examine

### Ground Item Menus
- [ ] Right-click on room item shows menu
- [ ] Ground item shows [Ground] indicator
- [ ] Menu has Take and Examine

### Action Execution
- [ ] Clicking action executes command
- [ ] Command format is correct
- [ ] Cancel closes menu without action

### Styling
- [ ] Menu matches Fluent theme
- [ ] Header is styled and disabled
- [ ] Hover highlights menu items
- [ ] Dangerous actions have warning colors

### Quality
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] ~10 unit tests pass
- [ ] No memory leaks from menu handlers

---

## 16. Dependencies

### Required from v0.7.2a

| Type | Location | Usage |
|------|----------|-------|
| `InventoryPanel` | `Controls/InventoryPanel.axaml` | Integration point |
| `ItemSlotControl` | `Controls/ItemSlotControl.cs` | Right-click target |
| `Item.GetCategoryIcon()` | Extension method | Icon display |

### Required from v0.7.1a

| Type | Location | Usage |
|------|----------|-------|
| `RoomDisplayPanel` | `Controls/RoomDisplayPanel.axaml` | Integration point |
| `EntityViewModel` | `ViewModels/EntityViewModel.cs` | Monster context |
| `ItemViewModel` | `ViewModels/ItemViewModel.cs` | Ground item context |

### Required from Application Layer

| Type | Location | Usage |
|------|----------|-------|
| `IGameSessionService` | Application layer | Command execution |
| `Item`, `Monster`, `Npc` | Domain layer | Entity data |

### Provides to v0.7.2c

| Type | Usage |
|------|-------|
| `IContextMenuService` | Available for command input suggestions |
| Command patterns | Reference for command input |

---

## 17. Future Considerations

### Deferred to v0.7.2c
- **Command Input Panel**: Text-based command input

### Deferred to v0.8.0
- **Shop context menu**: Buy/Sell actions
- **Container context menu**: Open/Close/Lock actions
- **Skill context menu**: Use skill on target

### Deferred to v0.9.0
- **Keyboard shortcuts**: Hotkeys for common actions
- **Custom actions**: Plugin-based menu extensions

### Out of Scope
- **Nested submenus**: Single-level menus only
- **Drag from menu**: No drag-to-equip from menu

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
*Author: Assistant*
