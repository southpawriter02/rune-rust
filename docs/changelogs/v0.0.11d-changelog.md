# v0.0.11d Changelog - Interactive Objects & Ambient Events

**Release Date:** 2026-01-08
**Focus:** State-based object descriptions, ambient atmospheric events, and descriptor caching

## Summary

This release completes the v0.0.11 Descriptors & Ambience milestone by implementing interactive object descriptions with state-awareness, ambient event generation for atmospheric immersion, and a caching layer for performance optimization. This provides the final building blocks for rich environmental storytelling.

## New Features

### InteractiveObjectType Enum
- **8 object types** defined:
  - Door - passages and gates
  - Chest - containers that can be opened
  - Lever - switches and mechanisms
  - Statue - decorative or magical figures
  - Altar - religious or magical shrines
  - LightSource - torches, braziers, crystals
  - Inscription - written messages or plaques
  - WaterFeature - fountains, pools, wells

### ObjectState Enum
- **21 states** covering all object types:
  - General: Normal, Broken, Destroyed
  - Door/Chest: Closed, Open, Locked, Barred
  - Container: Empty, Trapped
  - Lever: Up, Down, Stuck
  - Altar/Statue: Active, Inactive, Desecrated, Blessed, Damaged, Defaced
  - Light Source: Lit, Unlit, Flickering

### ExaminationDepth Enum
- **3 examination levels**:
  - Glance - brief description on room entry
  - Look - standard look command
  - Examine - detailed examination

### AmbientEventType Enum
- **4 event categories**:
  - Sound - auditory events (distant screams, footsteps)
  - Visual - visual events (shadow movement, light flicker)
  - Creature - small creature events (rats, bats, insects)
  - Environmental - environmental events (dust, drafts, creaks)

### AmbientEventTrigger Enum
- **5 trigger conditions**:
  - Exploration - random during exploration
  - Periodic - time-based triggers
  - Combat - triggered by combat
  - RoomEntry - triggered on entering a room
  - PlayerAction - triggered by player actions

### InteractiveObjectDescriptor Value Object
- Progressive description based on examination depth
- `GetDescription(ExaminationDepth)` returns appropriate detail level
- `InteractionHint` for contextual interaction suggestions
- Combines GlanceDescription, LookDescription, ExamineDescription

### AmbientEvent Value Object
- `EventType` - category of the event
- `Description` - event description text
- `Intensity` - 0.0 to 1.0 for UI emphasis
- `IsInterruptive` - whether event interrupts current action
- `None` static property for empty events
- `HasEvent` property for validation

### ObjectDescriptorContext Record
- Captures context for object description generation:
  - ObjectType and State
  - ExaminationDepth
  - Optional EnvironmentContext for coherent descriptions
  - Optional Material and Age modifiers
  - Additional filtering Tags

### AmbientEventContext Record
- Captures context for ambient event generation:
  - Required EnvironmentContext from v0.0.11a
  - Optional SensoryContext from v0.0.11c
  - AmbientEventTrigger type
  - InCombat flag
  - TimeSinceLastEvent for cooldown
  - TurnsInRoom for probability scaling

### ObjectDescriptorService
- `GenerateDescriptor()` - complete state-based descriptor
- `GetDescription()` - appropriate depth description
- `GetGlanceDescription()` - brief room entry description
- Environment-aware tag building
- Material and age detail additions
- State-specific interaction hints

### AmbientEventService
- `TryGenerateEvent()` - probability-based event generation
- `ForceGenerateEvent()` - guaranteed event generation
- `GetEventOfType()` - specific type event generation
- 30-second cooldown between events
- Combat suppression for non-combat events
- Biome-specific pool selection
- Weighted event type selection based on biome

### CachedDescriptorService
- IMemoryCache-based caching decorator
- 5-minute sliding expiration
- Cache key includes pool path and tags
- Context-sensitive requests bypass cache
- `InvalidatePool()` for targeted invalidation
- `ClearCache()` for full cache clearing

### Configuration Classes
- **ObjectDescriptorConfiguration** - object type definitions with valid states
- **AmbientEventConfiguration** - event pool definitions with biome and trigger associations

### Configuration JSON Files
- **objects.json** - 45 pools with state-based descriptors for all object types
- **ambient-events.json** - 15 event pools with biome-specific ambient events

## Files Created

### Domain Enums
- `src/Core/RuneAndRust.Domain/Enums/InteractiveObjectType.cs`
- `src/Core/RuneAndRust.Domain/Enums/ObjectState.cs`
- `src/Core/RuneAndRust.Domain/Enums/ExaminationDepth.cs`
- `src/Core/RuneAndRust.Domain/Enums/AmbientEventType.cs`
- `src/Core/RuneAndRust.Domain/Enums/AmbientEventTrigger.cs`

### Domain Value Objects
- `src/Core/RuneAndRust.Domain/ValueObjects/InteractiveObjectDescriptor.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/AmbientEvent.cs`

### Application Context Classes
- `src/Core/RuneAndRust.Application/Services/ObjectDescriptorContext.cs`
- `src/Core/RuneAndRust.Application/Services/AmbientEventContext.cs`

### Application Configuration
- `src/Core/RuneAndRust.Application/Configuration/ObjectDescriptorConfiguration.cs`
- `src/Core/RuneAndRust.Application/Configuration/AmbientEventConfiguration.cs`

### Application Services
- `src/Core/RuneAndRust.Application/Services/ObjectDescriptorService.cs`
- `src/Core/RuneAndRust.Application/Services/AmbientEventService.cs`
- `src/Core/RuneAndRust.Application/Services/CachedDescriptorService.cs`

### Configuration Files
- `config/descriptors/ambient-events.json`

### Unit Tests
- `tests/RuneAndRust.Application.UnitTests/Services/ObjectDescriptorServiceTests.cs` (11 tests)
- `tests/RuneAndRust.Application.UnitTests/Services/AmbientEventServiceTests.cs` (12 tests)
- `tests/RuneAndRust.Application.UnitTests/Services/CachedDescriptorServiceTests.cs` (10 tests)

## Files Modified

- `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs` - Added `GetObjectDescriptorConfiguration()` and `GetAmbientEventConfiguration()` methods
- `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs` - Implemented new configuration methods with defaults
- `src/Infrastructure/RuneAndRust.Infrastructure/DependencyInjection.cs` - Registered ObjectDescriptorService and AmbientEventService
- `tests/RuneAndRust.TestUtilities/Mocks/MockConfigurationProvider.cs` - Added new configuration implementations
- `config/descriptors/objects.json` - Extended with state-based descriptor pools
- `src/Core/RuneAndRust.Application/RuneAndRust.Application.csproj` - Added Microsoft.Extensions.Caching.Memory reference

## Test Results

- **33 new tests** added
- **All 893 tests pass** (600 Domain + 285 Application + 8 Architecture)
- **0 warnings**

## Breaking Changes

None. All changes are additive and backwards compatible.

## Dependencies

- Requires v0.0.11a (Descriptor Framework Expansion) complete
- Requires v0.0.11b (Combat & Ability Descriptors) complete
- Requires v0.0.11c (Environmental & Sensory Descriptors) complete
- Added: Microsoft.Extensions.Caching.Memory 8.0.1

## Usage Example

```csharp
// Generate object description
var objectContext = new ObjectDescriptorContext
{
    ObjectType = InteractiveObjectType.Door,
    State = ObjectState.Locked,
    Depth = ExaminationDepth.Examine,
    Material = "iron",
    Age = "ancient"
};

var descriptor = objectDescriptorService.GenerateDescriptor(objectContext);
// descriptor.GlanceDescription = "A locked door bars your path"
// descriptor.LookDescription = "A heavy wooden door reinforced with iron bands. It looks sturdy"
// descriptor.ExamineDescription = "The door is a heavy slab of blackened iron... It is crafted from iron. It appears ancient."
// descriptor.InteractionHint = "It might be opened with the right key."

var examineText = descriptor.GetDescription(ExaminationDepth.Examine);
// Returns full examine description with interaction hint

// Generate ambient event
var eventContext = new AmbientEventContext
{
    Environment = new EnvironmentContext(
        new Dictionary<string, string>
        {
            ["biome"] = "cave",
            ["climate"] = "cold",
            ["lighting"] = "dim"
        },
        ["underground", "natural"]),
    Trigger = AmbientEventTrigger.Exploration,
    TimeSinceLastEvent = TimeSpan.FromMinutes(2),
    InCombat = false,
    TurnsInRoom = 5
};

var ambientEvent = ambientEventService.TryGenerateEvent(eventContext);
if (ambientEvent.HasEvent)
{
    // ambientEvent.EventType = AmbientEventType.Sound
    // ambientEvent.Description = "A single drop of water falls, its echo multiplying into a chorus"
    // ambientEvent.Intensity = 0.4f
}

// Force specific event type
var creatureEvent = ambientEventService.GetEventOfType(AmbientEventType.Creature, eventContext);
// creatureEvent.Description = "Tiny eyes reflect your light from the darkness, then blink out"
```

## Object Descriptor Pool Summary

| Object Type | State Pools | Look/Examine Pools | Total Descriptors |
|-------------|-------------|-------------------|-------------------|
| Door | 4 | 2 | ~25 |
| Chest | 5 | 2 | ~30 |
| Lever | 4 | 2 | ~20 |
| Statue | 3 | 2 | ~20 |
| Altar | 3 | 2 | ~20 |
| LightSource | 4 | 1 | ~20 |
| Inscription | 1 | 1 | ~10 |
| WaterFeature | 1 | 1 | ~10 |
| **Total** | **25** | **13** | **~155** |

## Ambient Event Pool Summary

| Category | Generic Pool | Biome-Specific Pools | Descriptors |
|----------|--------------|---------------------|-------------|
| Sound | 1 | 4 (cave, dungeon, forest) | ~25 |
| Visual | 1 | 2 (volcanic, ruins) | ~15 |
| Creature | 1 | 3 (cave, swamp, forest) | ~25 |
| Environmental | 1 | 3 (frozen, volcanic, swamp) | ~25 |
| **Total** | **4** | **12** | **~90** |

## v0.0.11 Milestone Complete

With v0.0.11d, the full v0.0.11 Descriptors & Ambience milestone is complete:

| Sub-Version | Focus | Status |
|-------------|-------|--------|
| v0.0.11a | Descriptor Framework Expansion | ✅ Complete |
| v0.0.11b | Combat & Ability Descriptors | ✅ Complete |
| v0.0.11c | Environmental & Sensory Descriptors | ✅ Complete |
| v0.0.11d | Interactive Objects & Ambient Events | ✅ Complete |

## Next Steps

- **v0.0.12**: Combat Mechanics Expansion (to be planned)
