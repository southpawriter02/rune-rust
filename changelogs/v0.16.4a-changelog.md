# v0.16.4a Changelog — Container Type System

**Version:** 0.16.4a  
**Date:** 2026-01-29  
**Phase:** Container Loot Generation

---

## Summary

Adds the foundational container type system for loot generation. Provides `ContainerType` enum for 10 container categories, `ContainerFlags` flags enum for special behaviors, and `ContainerTypeDefinition` value object for complete loot specifications. Includes configuration file and JSON schema for data-driven container definitions.

---

## Added

### Domain Layer

- **`ContainerType`** enum — 10 distinct container categories with explicit integer values
    - `SmallChest` (0) — Items 1-2, Tier 0-1, Currency 10-30
    - `MediumChest` (1) — Items 2-4, Tier 1-2, Currency 25-75
    - `LargeChest` (2) — Items 3-5, Tier 2-3, Currency 50-150
    - `BossChest` (3) — Items 4-6, Tier 3-4, Currency 100-300, Myth-Forged chance
    - `HiddenCache` (4) — Items 1-3, Tier 1-3, Currency 50-200, DC 14 discovery
    - `Corpse` (5) — Items 0-2, Tier 0-1, Currency 5-20, may be empty
    - `Locker` (6) — Items 1-3, Tier 0-2, Currency 15-50
    - `SupplyCrate` (7) — Items 2-3, Tier 0-1, consumables only
    - `WeaponRack` (8) — Items 1-2, Tier 1-3, weapons only
    - `ArmorStand` (9) — Items 1, Tier 1-3, armor only
- **`ContainerFlags`** flags enum — Special behavior modifiers
    - `None` (0) — Standard container
    - `MayBeEmpty` (1) — Can generate 0 items
    - `MythForgedChance` (2) — Can spawn tier 4 items
    - `RequiresDiscovery` (4) — Needs Perception check
- **`ContainerTypeDefinition`** value object — Immutable loot specifications
    - `Create()` factory with full validation
    - `CreateSimple()` convenience factory
    - Computed properties: `CanBeEmpty`, `HasMythForgedChance`, `RequiresDiscovery`, `HasCategoryFilter`, `AwardsCurrency`, `AverageItemCount`, `AverageCurrency`
    - Validation methods: `IsValidItemCount()`, `IsValidTier()`, `IsValidCurrency()`
    - Category filter normalized to lowercase

### Configuration

- **`config/container-types.json`** — Container type definitions configuration
    - All 10 container types with complete specifications
    - Schema reference for validation
- **`config/schemas/container-types.schema.json`** — JSON Schema (Draft-07)
    - Type validation for all properties
    - Enum constraints for container types and flags
    - Min/max range validation for tiers (0-4)

### Unit Tests

- **`ContainerTypeDefinitionTests.cs`** — 25 tests covering:
    - Factory method validation (7 tests)
    - Computed properties (8 tests)
    - Validation methods (6 tests)
    - ToString formatting (2 tests)
    - CreateSimple factory (1 test)
    - Average calculations (3 tests)

---

## Container Type Reference

| Type        | Items | Tier | Currency | Special            |
| ----------- | ----- | ---- | -------- | ------------------ |
| SmallChest  | 1-2   | 0-1  | 10-30    | —                  |
| MediumChest | 2-4   | 1-2  | 25-75    | —                  |
| LargeChest  | 3-5   | 2-3  | 50-150   | —                  |
| BossChest   | 4-6   | 3-4  | 100-300  | Myth-Forged chance |
| HiddenCache | 1-3   | 1-3  | 50-200   | DC 14 discovery    |
| Corpse      | 0-2   | 0-1  | 5-20     | May be empty       |
| Locker      | 1-3   | 0-2  | 15-50    | —                  |
| SupplyCrate | 2-3   | 0-1  | —        | Consumables only   |
| WeaponRack  | 1-2   | 1-3  | —        | Weapons only       |
| ArmorStand  | 1     | 1-3  | —        | Armor only         |

---

## Dependencies

- Requires: v0.16.0 (QualityTier enum for tier 0-4 scale)
- Requires: v0.16.3a-e (Smart loot system context)
- Enables: v0.16.4b (ContainerLootTable entity)

---

## Verification

- **Build:** 0 errors, 0 warnings
- **Tests:** 25/25 pass
