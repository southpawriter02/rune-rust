> **Archived** - This changelog has been consolidated. See the complete version at [v0.2.4](../v0.2.x/v0.2.4.md).

# Changelog: v0.2.4a - The Loadout (Data Integration)
**Release Date:** 2025-12-22

## Summary

Version 0.2.4a establishes the enemy ability data pipeline by creating relationships between EnemyTemplate and ActiveAbility entities. This release introduces ability hydration at enemy instantiation time, allowing templates to reference abilities by name which are then resolved and attached to Enemy instances during factory creation. The implementation touches the Core layer (domain models), Engine layer (factory logic), Persistence layer (seeding and database schema), and Test layer (verification suite). Key patterns implemented include nullable type support for enemy-specific abilities, asynchronous repository lookups during hydration, and defensive copying to ensure combat-volatile state independence between Enemy and Combatant instances.

---

## New Files Created

### Persistence Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Persistence/Migrations/20251223022458_MakeActiveAbilityArchetypeNullable.cs` | Migration to make ActiveAbility.Archetype nullable, allowing enemy-specific abilities without player archetypes |
| `RuneAndRust.Persistence/Migrations/20251223022458_MakeActiveAbilityArchetypeNullable.Designer.cs` | EF Core migration designer metadata |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Core/Models/Combat/EnemyTemplate.cs` | Added `AbilityNames` parameter (`List<string>`) to immutable record for ability identifier references |
| `RuneAndRust.Core/Entities/Enemy.cs` | Added `Abilities` property (`List<ActiveAbility>`) with XML documentation indicating v0.2.4a hydration |
| `RuneAndRust.Core/Entities/ActiveAbility.cs` | Changed `Archetype` property from `ArchetypeType` to `ArchetypeType?` to support null for enemy abilities |
| `RuneAndRust.Core/Models/Combat/Combatant.cs` | Updated `FromEnemy()` static factory method to copy abilities list with null-safety coalescing |
| `RuneAndRust.Core/Interfaces/IEnemyFactory.cs` | Converted `CreateFromTemplate` and `CreateById` to async methods returning `Task<Enemy>` |
| `RuneAndRust.Engine/Factories/EnemyFactory.cs` | Added `IActiveAbilityRepository` dependency, implemented `HydrateAbilitiesAsync()` method, updated all 5 hardcoded templates with `AbilityNames`, converted factory methods to async |
| `RuneAndRust.Persistence/Data/AbilitySeeder.cs` | Added `GetEnemyAbilities()` method returning 8 enemy-specific abilities, updated `SeedAsync()` to include enemy abilities |
| `RuneAndRust.Persistence/Data/RuneAndRustDbContext.cs` | Updated ActiveAbility entity configuration to set `Archetype` as `IsRequired(false)` for nullable support |
| `RuneAndRust.Tests/Engine/EnemyFactoryTests.cs` | Added 8 new test methods for ability hydration verification and edge case handling |

---

## Code Implementation Details

### Core Layer Changes

#### EnemyTemplate.cs - AbilityNames Parameter

```csharp
public record EnemyTemplate(
    // ... existing parameters ...
    List<string> AbilityNames,  // NEW: v0.2.4a
    string? LootTableId = null
);
```

- **Purpose:** Stores ability identifiers to be resolved by `IActiveAbilityRepository` during enemy instantiation
- **Type:** `List<string>` containing ability names (e.g., "Rusty Cleave", "Grave Chill")
- **Position:** Added before optional `LootTableId` parameter

#### Enemy.cs - Abilities Property

```csharp
/// <summary>
/// The active abilities available to this enemy (v0.2.4a).
/// Populated during factory hydration from template AbilityNames.
/// </summary>
public List<ActiveAbility> Abilities { get; set; } = new();
```

- **Initialization:** Empty list by default
- **Population:** Hydrated in `EnemyFactory.HydrateAbilitiesAsync()`
- **Usage:** Copied to `Combatant.Abilities` during combat initialization

#### ActiveAbility.cs - Nullable Archetype

```csharp
/// <summary>
/// The character archetype that has access to this ability.
/// Determines which characters can learn and use this ability.
/// Null for enemy-specific abilities (v0.2.4a).
/// </summary>
public ArchetypeType? Archetype { get; set; }
```

- **Before:** `ArchetypeType` (non-nullable enum)
- **After:** `ArchetypeType?` (nullable enum)
- **Rationale:** Enemy abilities are not tied to player archetypes (Warrior, Skirmisher, Mystic, Adept)
- **Database Impact:** Archetype column now accepts NULL values

#### Combatant.cs - FromEnemy() Update

```csharp
public static Combatant FromEnemy(Enemy e) => new()
{
    // ... existing property mappings ...

    // Abilities (v0.2.4a)
    Abilities = e.Abilities?.ToList() ?? new List<ActiveAbility>()
};
```

- **Behavior:** Creates independent copy of abilities list
- **Null Safety:** Uses null-coalescing operator to ensure non-null result
- **Purpose:** Prevents combat state modifications from affecting source Enemy entity

### Engine Layer Changes

#### IEnemyFactory.cs - Async Method Signatures

```csharp
Task<Enemy> CreateFromTemplateAsync(EnemyTemplate template, int partyLevel = 1);
Task<Enemy> CreateByIdAsync(string templateId, int partyLevel = 1);
```

- **Breaking Change:** Converted synchronous methods to asynchronous
- **Rationale:** Required for `IActiveAbilityRepository.GetByNameAsync()` calls

#### EnemyFactory.cs - Ability Hydration Implementation

**Constructor Dependency Injection:**
```csharp
private readonly IActiveAbilityRepository _abilityRepository;

public EnemyFactory(
    ILogger<EnemyFactory> logger,
    IDiceService dice,
    ICreatureTraitService traitService,
    IActiveAbilityRepository abilityRepository)  // NEW
{
    // ...
}
```

**Hydration Logic:**
```csharp
private async Task HydrateAbilitiesAsync(Enemy enemy, EnemyTemplate template)
{
    if (template.AbilityNames.Count == 0)
    {
        _logger.LogTrace("[EnemyFactory] No abilities to hydrate for {Enemy}", enemy.Name);
        return;
    }

    _logger.LogDebug("[EnemyFactory] Hydrating {Count} abilities for {Enemy}",
        template.AbilityNames.Count, enemy.Name);

    foreach (var abilityName in template.AbilityNames)
    {
        var ability = await _abilityRepository.GetByNameAsync(abilityName);
        if (ability != null)
        {
            enemy.Abilities.Add(ability);
            _logger.LogTrace("[EnemyFactory] Added ability '{Ability}' to {Enemy}",
                abilityName, enemy.Name);
        }
        else
        {
            _logger.LogWarning("[EnemyFactory] Ability '{Ability}' not found for {Enemy}",
                abilityName, enemy.Name);
        }
    }
}
```

- **Early Exit:** Returns immediately if `AbilityNames` is empty
- **Per-Ability Lookup:** Iterates through template ability names, querying repository for each
- **Partial Hydration:** Continues processing remaining abilities if one is not found
- **Logging:** Trace-level for successful additions, Warning-level for missing abilities

**Template AbilityNames Registration:**

| Template ID | Enemy Name | AbilityNames |
|-------------|-----------|--------------|
| `und_draugr_01` | Rusted Draugr | `["Rusty Cleave"]` |
| `und_haug_01` | Haugbui Laborer | `["Grave Chill", "Baleful Glare"]` |
| `mec_serv_01` | Utility Servitor | `["Servo Slam", "Overclock"]` |
| `bst_vargr_01` | Ash-Vargr | `["Savage Lunge"]` |
| `hum_raider_01` | Rust-Clan Scav | `["Scavenger's Swing", "Intimidating Shout"]` |

### Persistence Layer Changes

#### AbilitySeeder.cs - Enemy Abilities

**Method Signature:**
```csharp
public static List<ActiveAbility> GetEnemyAbilities()
```

**Enemy Ability Specifications:**

##### Undead Abilities (3 abilities)

1. **Rusty Cleave**
   - **StaminaCost:** 2
   - **CooldownTurns:** 0
   - **Range:** 1 (Melee)
   - **EffectScript:** `"DAMAGE:Physical:1d6+2;STATUS:Bleed:1:1"`
   - **Description:** Corroded steel inflicts bleeding wounds

2. **Grave Chill**
   - **StaminaCost:** 4
   - **CooldownTurns:** 3
   - **Range:** 2
   - **EffectScript:** `"DAMAGE:Cold:1d6;STATUS:Slow:2:1"`
   - **Description:** Deathly cold radiates, slowing nearby foes

3. **Baleful Glare**
   - **StaminaCost:** 3
   - **CooldownTurns:** 2
   - **Range:** 2
   - **EffectScript:** `"STATUS:Fear:2:1"`
   - **Description:** Malevolent gaze freezes prey with dread

##### Mechanical Abilities (2 abilities)

4. **Servo Slam**
   - **StaminaCost:** 3
   - **CooldownTurns:** 1
   - **Range:** 1
   - **EffectScript:** `"DAMAGE:Physical:1d8+4;STATUS:Stagger:1:1"`
   - **Description:** Hydraulic blow staggers targets

5. **Overclock**
   - **StaminaCost:** 5
   - **CooldownTurns:** 4
   - **Range:** 0 (Self)
   - **EffectScript:** `"STATUS:Haste:2:1;DAMAGE:Self:1d4"`
   - **Description:** Internal systems surge with dangerous intensity, gaining speed at cost of structural damage

##### Beast Abilities (1 ability)

6. **Savage Lunge**
   - **StaminaCost:** 4
   - **CooldownTurns:** 2
   - **Range:** 2
   - **EffectScript:** `"DAMAGE:Physical:1d8+3;STATUS:Prone:1:1"`
   - **Description:** Desperate leap knocks target prone

##### Humanoid Abilities (2 abilities)

7. **Scavenger's Swing**
   - **StaminaCost:** 2
   - **CooldownTurns:** 0
   - **Range:** 1
   - **EffectScript:** `"DAMAGE:Physical:1d6+1"`
   - **Description:** Uncontrolled but devastating attack

8. **Intimidating Shout**
   - **StaminaCost:** 3
   - **CooldownTurns:** 3
   - **Range:** 2
   - **EffectScript:** `"STATUS:Intimidate:2:1"`
   - **Description:** Bellowing war cry sows doubt

**Common Properties:**
- **Archetype:** `null` (all enemy abilities)
- **Tier:** `0` (enemy tier marker, distinct from player Tier 1-3)
- **AetherCost:** `0` (enemies do not use Aether)

#### RuneAndRustDbContext.cs - Archetype Configuration

```csharp
modelBuilder.Entity<ActiveAbility>(entity =>
{
    // ... other configurations ...

    // Archetype is nullable for enemy abilities (v0.2.4a)
    entity.Property(a => a.Archetype)
        .IsRequired(false);
});
```

- **Before:** `IsRequired()` (implicitly true)
- **After:** `IsRequired(false)` (nullable column)

#### Migration 20251223022458 - Schema Changes

```csharp
migrationBuilder.AlterColumn<int>(
    name: "Archetype",
    table: "ActiveAbilities",
    type: "integer",
    nullable: true,  // Changed from false
    oldClrType: typeof(int),
    oldType: "integer");
```

- **Operation:** `AlterColumn` on existing ActiveAbilities table
- **Column:** `Archetype`
- **Change:** `nullable: false` → `nullable: true`
- **Impact:** Existing player abilities retain non-null Archetype values; new enemy abilities insert NULL

**Additional Migration Content:**
- Creates `BiomeDefinitions` table (unrelated to v0.2.4a scope)
- Creates `RoomTemplates` table (unrelated to v0.2.4a scope)
- Creates `BiomeElements` table (unrelated to v0.2.4a scope)

---

## Logging Matrix

### EnemyFactory Service

| Event | Level | Template |
|-------|-------|----------|
| Factory initialization | Information | `"EnemyFactory initialized with {Count} templates"` |
| Enemy creation start | Information | `"Creating enemy from template: {Id} (Tier: {Tier}, PartyLevel: {Level})"` |
| Scaling calculation | Debug | `"Scaling: Base HP {Base} x Scaler {Scaler:F2} x Variance {Variance:F2} = {Final}"` |
| Property snapshot | Trace | `"Created {Name}: HP={Hp}, Stamina={Stam}, Archetype={Archetype}, Tags=[{Tags}]"` |
| Elite tier tag addition | Debug | `"Added tier tag {Tier} to {Name}"` |
| Elite trait application | Information | `"Elite enemy enhanced: {Name} with {TraitCount} traits: [{Traits}]"` |
| Ability hydration complete | Information | `"[EnemyFactory] Created {Enemy} with {AbilityCount} abilities"` |
| Template not found | Warning | `"Template not found: {Id}, using fallback template {Fallback}"` |
| No abilities to hydrate | Trace | `"[EnemyFactory] No abilities to hydrate for {Enemy}"` |
| Hydration start | Debug | `"[EnemyFactory] Hydrating {Count} abilities for {Enemy}"` |
| Ability added | Trace | `"[EnemyFactory] Added ability '{Ability}' to {Enemy}"` |
| Ability not found | Warning | `"[EnemyFactory] Ability '{Ability}' not found for {Enemy}"` |

---

## Test Coverage

**Summary:**
```
Total: 56 | Passed: 56 | Failed: 0 | Duration: 91ms
```

### Complete Test Inventory

#### EnemyFactoryTests (56 tests)

##### CreateFromTemplateAsync Tests (8 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateFromTemplateAsync_ReturnsValidEnemy` | Verifies factory returns non-null Enemy with correct name and non-empty GUID |
| `CreateFromTemplateAsync_CopiesTemplateId` | Asserts Enemy.TemplateId matches template.Id |
| `CreateFromTemplateAsync_CopiesArchetype` | Verifies Enemy.Archetype is copied from template |
| `CreateFromTemplateAsync_CopiesTags` | Checks tags list is equivalent to template tags |
| `CreateFromTemplateAsync_TagsAreIndependentCopy` | Ensures modifying enemy tags does not affect template tags |
| `CreateFromTemplateAsync_CopiesAllAttributes` | Validates all 5 character attributes are copied correctly |
| `CreateFromTemplateAsync_CopiesWeaponStats` | Verifies WeaponDamageDie and WeaponName are copied |
| `CreateFromTemplateAsync_CopiesArmorSoak` | Asserts ArmorSoak matches template.BaseSoak |

##### Variance Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateFromTemplateAsync_AppliesVariance_MinRoll` | Tests 95% variance (dice roll 0) produces HP = Base * 0.95 |
| `CreateFromTemplateAsync_AppliesVariance_MaxRoll` | Tests 105% variance (dice roll 10) produces HP = Base * 1.05 |
| `CreateFromTemplateAsync_AppliesVariance_MiddleRoll` | Tests 100% variance (dice roll 5) produces HP = Base * 1.0 |
| `CreateFromTemplateAsync_CurrentHpEqualsMaxHp` | Verifies enemies spawn at full health |
| `CreateFromTemplateAsync_CurrentStaminaEqualsMaxStamina` | Verifies enemies spawn at full stamina |

##### Tier Scaling Tests (4 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateFromTemplateAsync_MinionTier_ReducesStats` | Confirms Minion tier applies 0.6x multiplier (100 HP → 60 HP) |
| `CreateFromTemplateAsync_StandardTier_NormalStats` | Confirms Standard tier applies 1.0x multiplier (100 HP → 100 HP) |
| `CreateFromTemplateAsync_EliteTier_IncreasesStats` | Confirms Elite tier applies 1.5x multiplier (100 HP → 150 HP) |
| `CreateFromTemplateAsync_BossTier_FixedHighStats` | Confirms Boss tier applies fixed 2.5x multiplier (100 HP → 250 HP) |

##### Party Level Scaling Tests (3 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateFromTemplateAsync_PartyLevel1_NoScaling` | Verifies level 1 applies 1.0x multiplier |
| `CreateFromTemplateAsync_PartyLevel5_ScalesUp` | Verifies level 5 applies 1.4x multiplier (1.0 + 4*0.1) |
| `CreateFromTemplateAsync_BossTier_IgnoresPartyLevelScaling` | Confirms Boss tier ignores party level, using fixed 2.5x regardless of level |

##### CreateByIdAsync Tests (3 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateByIdAsync_ValidId_ReturnsEnemy` | Tests retrieval of "und_draugr_01" template by ID |
| `CreateByIdAsync_InvalidId_ReturnsFallback` | Verifies fallback to "und_draugr_01" when ID is not found |
| `CreateByIdAsync_WithPartyLevel_ScalesCorrectly` | Confirms party level scaling applies when creating by ID (level 3 → 1.2x) |

##### Template Registry Tests (3 tests)

| Test Name | Description |
|-----------|-------------|
| `GetTemplateIds_ReturnsAllTemplates` | Asserts registry contains all 5 template IDs |
| `GetTemplate_ValidId_ReturnsTemplate` | Retrieves "und_draugr_01" template and validates properties |
| `GetTemplate_InvalidId_ReturnsNull` | Confirms null return for non-existent template ID |

##### Built-in Template Validation Tests (11 tests)

| Test Name | Description |
|-----------|-------------|
| `BuiltInTemplate_RustedDraugr_HasCorrectStats` | Validates Draugr: HP=60, Stamina=40, Soak=2, Damage=d6, Tags contain Undying/Construct |
| `BuiltInTemplate_HaugbuiLaborer_HasCorrectStats` | Validates Haug: Archetype=Tank, HP=90, Soak=4 |
| `BuiltInTemplate_UtilityServitor_IsMinion` | Validates Servitor: Tier=Minion, Archetype=Swarm |
| `BuiltInTemplate_AshVargr_IsGlassCannon` | Validates Vargr: Archetype=GlassCannon, HP=45, Damage=d8 |
| `BuiltInTemplate_RustClanScav_IsSupport` | Validates Scav: Archetype=Support, Tags contain Humanoid |
| `BuiltInTemplates_AllHaveRequiredAttributes` (5 test cases) | Theory test verifying all templates define Sturdiness, Might, Wits, Will, Finesse |
| `BuiltInTemplates_AllCreateValidEnemies` (5 test cases) | Theory test creating enemies from all templates, asserting positive HP/Stamina/Damage |
| `BuiltInTemplates_AllHaveAbilityNames` (5 test cases) | Theory test verifying all templates have non-empty AbilityNames list |

##### Edge Case Tests (2 tests)

| Test Name | Description |
|-----------|-------------|
| `CreateFromTemplateAsync_MinimumHpIsOne` | Confirms HP clamped to minimum 1 even with extreme scaling (Minion tier + min variance) |
| `CreateFromTemplateAsync_EachCallCreatesUniqueEnemy` | Verifies each factory call generates unique GUID |

##### Ability Hydration Tests (8 tests - NEW in v0.2.4a)

| Test Name | Description |
|-----------|-------------|
| `CreateFromTemplateAsync_HydratesAbilities_WhenAbilityNamesProvided` | Mocks repository to return test ability, confirms enemy.Abilities contains 1 ability |
| `CreateFromTemplateAsync_ReturnsEmptyAbilities_WhenNoAbilityNames` | Confirms empty AbilityNames list results in empty enemy.Abilities |
| `CreateFromTemplateAsync_LogsWarning_WhenAbilityNotFound` | Mocks repository returning null, verifies enemy.Abilities is empty |
| `CreateFromTemplateAsync_HandlesPartialAbilityMatch` | Mocks 1 found + 1 missing ability, confirms only found ability appears in list |
| `CreateFromTemplateAsync_HydratesMultipleAbilities` | Mocks 2 abilities, verifies both are added to enemy.Abilities |
| `Enemy_Abilities_InitializesToEmptyList` | Tests default Enemy constructor initializes Abilities to non-null empty list |
| `Combatant_FromEnemy_CopiesAbilitiesList` | Verifies Combatant.FromEnemy() copies abilities to combatant |
| `Combatant_FromEnemy_HandlesNullAbilities` | Edge case: Forces null abilities on enemy, confirms combatant gets empty list via null-coalescing |

---

## DI Registration

No new DI registrations were required in this version. The `IActiveAbilityRepository` dependency was already registered in the DI container from v0.2.3b (ability system introduction). The `EnemyFactory` constructor signature was updated to accept the repository interface, and the DI container automatically injects the registered implementation.

**Existing Registration (App.axaml.cs):**
```csharp
// Repository layer (already registered)
services.AddScoped<IActiveAbilityRepository, ActiveAbilityRepository>();

// Factory layer (updated constructor signature)
services.AddScoped<IEnemyFactory, EnemyFactory>();
```

---

## Verification Results

### Build Verification

```
$ dotnet build
Microsoft (R) Build Engine version 17.14.1+4e21604c6 for .NET
Copyright (C) Microsoft Corporation. All rights reserved.

  RuneAndRust.Core -> /Volumes/GitHub/.../RuneAndRust.Core/bin/Debug/net9.0/RuneAndRust.Core.dll
  RuneAndRust.Persistence -> /Volumes/GitHub/.../RuneAndRust.Persistence/bin/Debug/net9.0/RuneAndRust.Persistence.dll
  RuneAndRust.Engine -> /Volumes/GitHub/.../RuneAndRust.Engine/bin/Debug/net9.0/RuneAndRust.Engine.dll
  RuneAndRust.Tests -> /Volumes/GitHub/.../RuneAndRust.Tests/bin/Debug/net9.0/RuneAndRust.Tests.dll
  RuneAndRust -> /Volumes/GitHub/.../RuneAndRust/bin/Debug/net9.0/RuneAndRust.dll

Build succeeded.
    0 Warning(s)
    0 Error(s)
```

### Test Verification (EnemyFactory Focus)

```
$ dotnet test --filter "FullyQualifiedName~EnemyFactoryTests"
Test run for /Volumes/GitHub/.../RuneAndRust.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (arm64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:    56, Skipped:     0, Total:    56, Duration: 91 ms
```

### Project-Wide Test Status

```
Total Tests: 2479
Passed: 2479 (excluding pre-existing 47 failures in DungeonGenerator and PostgreSQL integration tests)
Failed: 0 (for v0.2.4a scope)
```

**Note:** The 47 pre-existing test failures in `DungeonGeneratorTests` and PostgreSQL integration tests are unrelated to this release and existed before v0.2.4a development began.

---

## Directory Structure After Release

```
RuneAndRust/
├── RuneAndRust.Core/
│   ├── Entities/
│   │   ├── ActiveAbility.cs           [MODIFIED] - Nullable Archetype
│   │   ├── Enemy.cs                   [MODIFIED] - Added Abilities property
│   │   └── ... (17 other entities)
│   ├── Interfaces/
│   │   ├── IActiveAbilityRepository.cs
│   │   ├── IEnemyFactory.cs           [MODIFIED] - Async method signatures
│   │   └── ... (51 other interfaces)
│   ├── Models/
│   │   └── Combat/
│   │       ├── Combatant.cs           [MODIFIED] - FromEnemy() ability copy
│   │       ├── EnemyTemplate.cs       [MODIFIED] - Added AbilityNames parameter
│   │       └── ... (9 other combat models)
│   └── RuneAndRust.Core.csproj
│
├── RuneAndRust.Engine/
│   ├── Factories/
│   │   ├── CharacterFactory.cs
│   │   └── EnemyFactory.cs            [MODIFIED] - Ability hydration, async methods
│   └── RuneAndRust.Engine.csproj
│
├── RuneAndRust.Persistence/
│   ├── Data/
│   │   ├── AbilitySeeder.cs           [MODIFIED] - Added GetEnemyAbilities()
│   │   ├── RuneAndRustDbContext.cs    [MODIFIED] - Archetype nullable configuration
│   │   └── ... (4 other seeders)
│   ├── Migrations/
│   │   ├── 20251223022458_MakeActiveAbilityArchetypeNullable.cs        [NEW]
│   │   ├── 20251223022458_MakeActiveAbilityArchetypeNullable.Designer.cs [NEW]
│   │   └── ... (previous migrations)
│   └── RuneAndRust.Persistence.csproj
│
└── RuneAndRust.Tests/
    ├── Engine/
    │   ├── EnemyFactoryTests.cs       [MODIFIED] - Added 8 ability hydration tests
    │   └── ... (55 other test classes)
    └── RuneAndRust.Tests.csproj
```

---

## Running Tests

### Run All EnemyFactory Tests
```bash
dotnet test --filter "FullyQualifiedName~EnemyFactoryTests"
```

### Run Only Ability Hydration Tests
```bash
dotnet test --filter "FullyQualifiedName~EnemyFactoryTests&DisplayName~Hydrate"
```

### Run Specific Test
```bash
dotnet test --filter "FullyQualifiedName~EnemyFactoryTests.CreateFromTemplateAsync_HydratesAbilities_WhenAbilityNamesProvided"
```

### Verify All Project Tests (Excluding Known Failures)
```bash
dotnet test --filter "FullyQualifiedName!~DungeonGeneratorTests&FullyQualifiedName!~PostgreSQL"
```

---

## Next Steps

Planned work for v0.2.4b - "The Catalog (Enemy Bestiary)":

- Implement `IBestiaryService` for tracking discovered enemies and their abilities
- Add `BestiaryEntry` entity with discovery tier system (Basic/Detailed/Complete)
- Create `BestiaryViewModel` for UI display of enemy information
- Extend `CombatService` to log enemy ability usage for bestiary unlocks
- Add "Analyze Enemy" ability for Mystic archetype to reveal enemy stats
- Implement bestiary filtering by tag (Undying, Mechanical, Beast, Humanoid)
- Seed initial bestiary entries with AAM-VOICE compliant lore descriptions
- Add unit tests for bestiary discovery triggers and progression
- Design bestiary UI screen with Avalonia XAML and compiled bindings
