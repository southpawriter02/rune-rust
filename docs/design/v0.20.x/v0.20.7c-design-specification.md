# Design Specification: v0.20.7c - Veiðimaðr Tier 3 Abilities & Capstone

**Version:** v0.20.7c
**Status:** Design Phase
**Last Updated:** 2026-01-28
**Target Tests:** ~7 unit and integration tests
**Specialization:** Veiðimaðr (Hunter)
**Path Type:** Coherent (NO Corruption Risk)
**Archetype:** Skirmisher

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Tier 3 Overview](#2-tier-3-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Domain Model Specifications](#4-domain-model-specifications)
5. [Apex Predator Ability Specification](#5-apex-predator-ability-specification)
6. [Crippling Shot Ability Specification](#6-crippling-shot-ability-specification)
7. [The Perfect Hunt Ability Specification (Capstone)](#7-the-perfect-hunt-ability-specification-capstone)
8. [User Stories](#8-user-stories)
9. [Application Service Layer](#9-application-service-layer)
10. [Configuration Specifications](#10-configuration-specifications)
11. [Code Examples & Implementation](#11-code-examples--implementation)
12. [Synergy Mechanics](#12-synergy-mechanics)
13. [Specialization Capstone Theory](#13-specialization-capstone-theory)
14. [Logging Specifications](#14-logging-specifications)
15. [Unit Testing Requirements](#15-unit-testing-requirements)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies & Prerequisites](#18-dependencies--prerequisites)
19. [Design Decisions & Rationale](#19-design-decisions--rationale)
20. [Complete Veiðimaðr Progression Matrix](#20-complete-veiðimaðr-progression-matrix)

---

## 1. Executive Summary

Version 0.20.7c introduces **Tier 3 Abilities and the Capstone** for the Veiðimaðr specialization, completing the hunter's arsenal. This phase focuses on:

- **Apex Predator:** Passive ability denying concealment to marked targets
- **Crippling Shot:** Active ability that halves target's movement for 2 turns
- **The Perfect Hunt (Capstone):** Ultimate ability granting automatic critical hit on marked quarry (once per long rest)

### Key Deliverables

| Category | Count | Details |
|----------|-------|---------|
| **Domain Value Objects** | 3 | ApexPredatorResult, CripplingCallResult, PerfectHuntResult |
| **Domain Enums** | 1 | ConcealmentType |
| **Application Services** | 1 | CapstoneAbilityService |
| **Ability Implementations** | 3 | Apex Predator, Crippling Shot, The Perfect Hunt |
| **Configuration Files** | 2 | abilities.json (Tier 3 & Capstone), capstone-registry.json |
| **Unit Tests** | ~7 | Comprehensive coverage of endgame mechanics |

### Complete Veiðimaðr Specialization

| Tier | Abilities | Focus | Total Bonuses |
|------|-----------|-------|---------------|
| **T1** | Mark Quarry, Keen Senses, Read the Signs | Foundation | +2 to marked targets |
| **T2** | Hunter's Eye, Trap Mastery, Predator's Patience | Tactics | +3 stance, ignore cover |
| **T3** | Apex Predator, Crippling Shot | Marked exploitation | Disable concealment |
| **Cap** | The Perfect Hunt | Ultimate | Auto-crit once/long rest |

---

## 2. Tier 3 Overview

### 2.1 Thematic Integration

Tier 3 represents the apex hunter who has:
- **Hunted extensively:** Knows prey cannot hide from their senses
- **Mastered the kill shot:** Can disable fleeing prey
- **Achieved transcendence:** One perfect hunt per day (long rest)

### 2.2 Action Economy at Tier 3

| Ability | Type | AP | Cost | Duration | Key Mechanic |
|---------|------|----|----|----------|--------------|
| Apex Predator | Passive | — | — | Permanent | Marked targets lose concealment |
| Crippling Shot | Active | 1 AP | 1 mark | 2 turns | Halve movement speed |
| The Perfect Hunt | Ultimate | 3 AP | 1 mark + resource | Instant | Auto-crit on marked target |

### 2.3 Tier 3 Design Principles

1. **Mark Payoff:** T3 abilities heavily reward having marks active
2. **Escalating Power:** Each tier adds layer of synergy
3. **Capstone Closure:** Ultimate ability is satisfying finishing move
4. **Limited Frequency:** Capstone uses long-rest resource (once per rest)
5. **No Corruption:** All abilities remain Coherent path

---

## 3. Architecture Diagrams

### 3.1 Tier 3 Domain Extensions

```
┌────────────────────────────────────────────────────────┐
│      v0.20.7c - Domain Model Extensions                │
├────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────────┐  ┌───────────────────────────┐ │
│  │ApexPredatorResult  │  │CripplingCallResult       │ │
│  │(Value Object)      │  │(Value Object)            │ │
│  ├────────────────────┤  ├───────────────────────────┤ │
│  │+ HunterId: Guid    │  │+ HunterId: Guid          │ │
│  │+ TargetId: Guid    │  │+ TargetId: Guid          │ │
│  │+ TargetName: string│  │+ TargetName: string      │ │
│  │+ WasConcealmentOn  │  │+ OriginalMovementCost: int  │
│  │+ ConcealmentRemoved│  │+ NewMovementCost: int    │ │
│  │+ Explained: string │  │+ DurationTurns: int      │ │
│  ├────────────────────┤  │+ Success: bool           │ │
│  │+ GetDescription()  │  │+ Message: string         │ │
│  │+ IsConcealmentLost()  │├───────────────────────────┤ │
│  └────────────────────┘  │+ GetDescription()        │ │
│                           │+ GetDurationText()       │ │
│                           └───────────────────────────┘ │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │ PerfectHuntResult (Value Object)                   │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ + HunterId: Guid                                   │ │
│  │ + TargetId: Guid                                   │ │
│  │ + TargetName: string                               │ │
│  │ + AttackRoll: int (always 20+ due to auto-crit)   │ │
│  │ + DamageRoll: int (rolled damage)                 │ │
│  │ + IsCriticalHit: bool (always true)               │ │
│  │ + CriticalMultiplier: int (2x or 3x damage)       │ │
│  │ + TotalDamage: int (computed)                      │ │
│  │ + MarkConsumed: bool                               │ │
│  │ + CapstoneResourceUsed: bool                       │ │
│  │ + TargetDefeated: bool?                            │ │
│  ├────────────────────────────────────────────────────┤ │
│  │ + GetDescription(): string                         │ │
│  │ + GetDamageBreakdown(): string                     │ │
│  │ + WasTargetKilled(): bool                          │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌─────────────────────────────────────────────────────┐ │
│  │ ConcealmentType (Enum)                              │ │
│  ├─────────────────────────────────────────────────────┤ │
│  │ - None (no concealment)                             │ │
│  │ - LightObscurement (shadows, dim light)             │ │
│  │ - Invisibility (magical, potion-based)              │ │
│  │ - MagicalCamo (spells, enchantments)                │ │
│  │ - Hidden (stealth, behind cover)                    │ │
│  └─────────────────────────────────────────────────────┘ │
│                                                          │
└────────────────────────────────────────────────────────┘
```

### 3.2 Service Layer Architecture (Tier 3 & Capstone)

```
┌───────────────────────────────────────────────────────────┐
│    v0.20.7c - Service Layer (Complete Specialization)     │
├───────────────────────────────────────────────────────────┤
│                                                             │
│  IVeiðimaðrAbilityService (Complete v0.20.7a+b+c)        │
│  ├─ [v0.20.7a methods]                                   │
│  ├─ [v0.20.7b methods]                                   │
│  └─ [NEW v0.20.7c methods]:                              │
│     ├─ ApplyConcealmentDenieal()                         │
│     ├─ ExecuteCripplingShot()                            │
│     ├─ ExecutePerfectHunt()                              │
│     └─ CanExecuteCapstone()                              │
│                                                             │
│  ┌────────────────────────────────────────────────────┐   │
│  │ ICapstoneAbilityService (NEW)                      │   │
│  ├────────────────────────────────────────────────────┤   │
│  │ + ExecuteCapstoneAsync()                           │   │
│  │ + HasCapstoneResourceAsync()                       │   │
│  │ + ConsumeCapstoneResourceAsync()                   │   │
│  │ + GetCapstoneDescriptionAsync()                    │   │
│  │ + IsTargetValidForCapstoneAsync()                  │   │
│  │ + GetTimeUntilCapstoneResetAsync()                 │   │
│  └────────────────────────────────────────────────────┘   │
│                                                             │
└───────────────────────────────────────────────────────────┘
```

### 3.3 Perfect Hunt Activation Flow

```
                    ┌─────────────────────┐
                    │ Perfect Hunt Check  │
                    └──────────┬──────────┘
                               │
                    ┌──────────▼──────────┐
                    │ Requirements Met?   │
                    ├─────────┬──────────┤
                    │         │          │
              Yes   │         │ No       │
                    ▼         ▼          │
            ┌──────────────┐ │          │
            │ 1. Marked?   │ │ Fail &   │
            │ 2. 3 AP?     │ │ Display  │
            │ 3. Capstone  │ │ Reason   │
            │    Slot?     │ │          │
            └──────┬───────┘ │          │
                   │         │          │
              Yes  │         │          │
                   ▼         │          │
          ┌───────────────┐  │          │
          │ EXECUTE       │  │          │
          │ AUTO-CRIT     │  │          │
          │ ATTACK        │  │          │
          └───┬───────────┘  │          │
              │              │          │
              ▼              ▼          ▼
      ┌──────────────┐  ┌──────────────────┐
      │ Roll Damage  │  │ Error Message    │
      │ (with 2x)    │  │ "Cannot execute" │
      │ Apply to     │  │                  │
      │ Target       │  │                  │
      └──┬───────────┘  └──────────────────┘
         │
         ▼
    ┌────────────────┐
    │ Consume Mark   │
    │ Consume        │
    │ Capstone Slot  │
    │ Log Result     │
    └────────────────┘
```

---

## 4. Domain Model Specifications

### 4.1 ApexPredatorResult (Value Object)

**Purpose:** Encapsulates the result of Apex Predator passive applying to a target.

**Properties:**

```csharp
/// <summary>
/// Result of Apex Predator passive application to marked target.
/// </summary>
public sealed record ApexPredatorResult
{
    /// <summary>ID of the hunter.</summary>
    public Guid HunterId { get; init; }

    /// <summary>ID of the marked target.</summary>
    public Guid TargetId { get; init; }

    /// <summary>Name of target (for UI).</summary>
    public string TargetName { get; init; } = string.Empty;

    /// <summary>Was concealment active before Apex Predator applied?</summary>
    public bool WasConcealmentOn { get; init; }

    /// <summary>What type of concealment was removed?</summary>
    public ConcealmentType ConcealmentRemoved { get; init; }

    /// <summary>Whether concealment was successfully removed.</summary>
    public bool ConcealmentRemovalSuccessful { get; init; }

    /// <summary>Explanation of what was lost (for UI).</summary>
    public string Explanation { get; init; } = string.Empty;

    /// <summary>When this was evaluated.</summary>
    public DateTime EvaluatedAt { get; init; } = DateTime.UtcNow;
}
```

**Methods:**

| Method | Returns | Purpose |
|--------|---------|---------|
| GetDescription | `string` | Narrative result |
| IsConcealmentLost | `bool` | True if concealment was removed |

### 4.2 CripplingCallResult (Value Object)

**Purpose:** Encapsulates the result of Crippling Shot ability.

**Properties:**

```csharp
/// <summary>
/// Result of Crippling Shot ability execution.
/// </summary>
public sealed record CripplingCallResult
{
    /// <summary>ID of the hunter who cast.</summary>
    public Guid HunterId { get; init; }

    /// <summary>ID of the target hit.</summary>
    public Guid TargetId { get; init; }

    /// <summary>Name of target (for UI).</summary>
    public string TargetName { get; init; } = string.Empty;

    /// <summary>Original movement cost (before crippling).</summary>
    public int OriginalMovementCost { get; init; }

    /// <summary>New movement cost (after crippling).</summary>
    public int NewMovementCost { get; init; }

    /// <summary>Number of turns crippling lasts (always 2).</summary>
    public int DurationTurns { get; init; } = 2;

    /// <summary>Was the attack successful?</summary>
    public bool Success { get; init; }

    /// <summary>Human-readable message for player.</summary>
    public string Message { get; init; } = string.Empty;

    /// <summary>When the shot was executed.</summary>
    public DateTime ExecutedAt { get; init; } = DateTime.UtcNow;
}
```

**Methods:**

| Method | Returns | Purpose |
|--------|---------|---------|
| GetDescription | `string` | Narrative result |
| GetDurationText | `string` | "2 turns" or similar |

### 4.3 PerfectHuntResult (Value Object)

**Purpose:** Encapsulates the complete result of The Perfect Hunt capstone ability.

**Properties:**

```csharp
/// <summary>
/// Result of The Perfect Hunt capstone ability.
/// Represents the ultimate culmination of the hunt.
/// </summary>
public sealed record PerfectHuntResult
{
    /// <summary>ID of the hunter executing capstone.</summary>
    public Guid HunterId { get; init; }

    /// <summary>ID of the marked target (now being hunted).</summary>
    public Guid TargetId { get; init; }

    /// <summary>Name of the target (for UI).</summary>
    public string TargetName { get; init; } = string.Empty;

    /// <summary>The attack roll (always 20+ due to auto-crit).</summary>
    public int AttackRoll { get; init; }

    /// <summary>Base damage roll before critical multiplier.</summary>
    public int BaseDamageRoll { get; init; }

    /// <summary>Whether this attack is a critical hit (always true).</summary>
    public bool IsCriticalHit { get; init; } = true;

    /// <summary>Critical damage multiplier (2x or 3x).</summary>
    public int CriticalMultiplier { get; init; } = 2; // 2x for 1d8, 3x for 1d6

    /// <summary>Total damage after critical application.</summary>
    public int TotalDamage { get; init; }

    /// <summary>Whether a mark was consumed.</summary>
    public bool MarkConsumed { get; init; }

    /// <summary>Whether capstone resource slot was consumed.</summary>
    public bool CapstoneResourceUsed { get; init; }

    /// <summary>Whether the target was defeated by this attack (null if unknown).</summary>
    public bool? TargetDefeated { get; init; }

    /// <summary>Narrative description of the perfect hunt.</summary>
    public string NarrativeDescription { get; init; } = string.Empty;

    /// <summary>When the perfect hunt occurred.</summary>
    public DateTime ExecutedAt { get; init; } = DateTime.UtcNow;
}
```

**Methods:**

| Method | Returns | Purpose |
|--------|---------|---------|
| GetDescription | `string` | Narrative result |
| GetDamageBreakdown | `string` | "Base 6 + (crit×2) = 12 damage" |
| WasTargetKilled | `bool` | True if target was defeated |

---

## 5. Apex Predator Ability Specification

### 5.1 Mechanics

**Ability ID:** `VeiðimaðrAbilityId.ApexPredator`

**Type:** Passive (always active)

**Action Economy:**
- **Cost:** 0 AP (passive)
- **Range:** Self
- **Duration:** Permanent
- **Trigger:** When making attack against marked target with concealment

**Mechanical Effects:**

```
Effect: Marked targets cannot use concealment against you
├─ Applies to:
│  ├─ Light obscurement (shadows, dim light, fog)
│  ├─ Invisibility (magical or from items)
│  ├─ Camouflage (spells, natural blending)
│  └─ Stealth (hidden behind cover)
│
├─ DOES NOT apply to:
│  └─ Full cover (behind wall, sealed vault)
│
├─ Resolution:
│  1. Target is marked (via Mark Quarry)
│  2. Target attempts to use concealment
│  3. Apex Predator removes concealment effect
│  4. Attack roll proceeds without concealment penalty
│
├─ Interaction with Hunter's Eye:
│  • Hunter's Eye: Removes cover penalties
│  • Apex Predator: Removes concealment effects
│  • Combined: Marked target has no hiding place
```

**Application Rules:**

When making an attack against a concealed marked target:

```
Without Apex Predator:
Roll = 1d20 + [Dex mod] - [Concealment penalty]

With Apex Predator (on marked target):
Roll = 1d20 + [Dex mod] + 0 (no concealment penalty)

Example:
- Marked target hiding in shadows (-2 to hit)
- Apex Predator active: shadows ignored
- Result: No -2 penalty applied
```

**Implementation:**

```csharp
public class ApexPredatorAbility : IPassiveAbility
{
    public bool ShouldIgnoreConcealmentFor(Guid hunterId, Guid targetId)
    {
        // Check if target is marked
        var isMarked = _quarryService.HasMarkAsync(hunterId, targetId).Result;
        return isMarked;
    }

    public int GetConcealmentPenalty(ConcealmentType concealmentType, bool targetIsMarked)
    {
        if (!targetIsMarked)
        {
            // Standard concealment penalties apply
            return concealmentType switch
            {
                ConcealmentType.LightObscurement => -2,
                ConcealmentType.Invisibility => -5,
                ConcealmentType.MagicalCamo => -3,
                ConcealmentType.Hidden => -4,
                _ => 0
            };
        }

        // If marked, no penalty
        return 0;
    }
}
```

**User-Facing Message:**

```
> attack hidden_shadow_creature with bow (marked)
> [Apex Predator: The marked target's concealment is meaningless]
> [Target loses hiding advantage]
> [1d20 + 4 (Dex) + 2 (Mark) = 18 vs AC 14]
> [Hit! Dealing 2d6+2 = 9 damage]
```

---

## 5.2 Design Rationale

**Why is this passive and not active?**

Narrative consistency: The apex hunter's mastery is *always* in effect. Marked prey cannot hide. This is passive expression of achieved mastery.

**Why only marked targets?**

Balance: Unmarked targets can still use concealment. Encourages consistent use of Mark Quarry for maximum effectiveness.

---

## 6. Crippling Shot Ability Specification

### 6.1 Mechanics

**Ability ID:** `VeiðimaðrAbilityId.CripplingShot`

**Type:** Active (ranged attack variant)

**Action Economy:**
- **Cost:** 1 AP
- **Resource:** 1 Quarry Mark (must consume a mark)
- **Range:** 12 spaces
- **Target:** Single marked enemy
- **Resolution:** Instant (no attack roll required; mark guarantees hit)

**Mechanical Effects:**

```
Effect: Ranged attack that halves movement speed for 2 turns
├─ Requirements:
│  ├─ 1 AP
│  ├─ Must have active mark on target
│  ├─ Within 12 spaces range
│  └─ Within line of sight
│
├─ Execution:
│  1. Consumes 1 Quarry Mark (mark is removed from target)
│  2. Applies "Crippled" debuff for 2 turns
│  3. Target's movement speed halved (5 spaces → 2.5 spaces)
│  4. No attack roll required (mark guarantees effect)
│
├─ Duration:
│  • 2 turns of crippled state
│  • Movement costs doubled
│  • Cannot be bypassed (no save/check)
│
├─ Stack Behavior:
│  • If target already crippled, duration extends (doesn't stack)
│  • Multiple marks = multiple chances to cripple
```

**Movement Resolution Example:**

```
Normal movement: 5 spaces per move action
Crippled: 2-3 spaces per move action

Example:
Turn 1:
> crippling-shot corrupted_wolf (marked)
> [Shot strikes Wolf's leg]
> [Corrupted Wolf is CRIPPLED for 2 turns (-50% movement)]

Turn 2:
> wolf move toward hunter (1 action)
> [Can only move 2 spaces (normally 5)]

Turn 3:
> wolf move again
> [Can move 2 spaces]

Turn 4:
> [Crippling effect ends; wolf can move 5 spaces again]
```

**Ability Cannot Miss:**

Crippling Shot always applies its effect because:
1. Requires active mark (verified before use)
2. Mark guarantees special ability effects (established in Tier 1)
3. No attack roll resolution (like Mark Quarry itself)

**Implementation:**

```csharp
public class CripplingCallAbility : IAbility
{
    public async Task<CripplingCallResult> ExecuteAsync(
        Guid hunterId,
        Guid targetId,
        string targetName)
    {
        // Verify mark exists
        var mark = await _quarryService.GetMarkForAsync(hunterId, targetId);
        if (mark == null)
            throw new InvalidOperationException("Target not marked");

        // Apply cripple debuff
        var crippleEffect = new BuffEffect
        {
            EffectType = BuffType.Crippled,
            Magnitude = 0.5m, // 50% movement reduction
            DurationTurns = 2,
            Source = "CripplingCall",
            AppliedAt = DateTime.UtcNow
        };

        await _buffService.ApplyBuffAsync(targetId, crippleEffect);

        // Remove mark (consumed by ability)
        await _quarryService.RemoveMarkAsync(hunterId, targetId);

        _logger.LogInformation(
            "Crippling Call executed: {HunterId} on {TargetId}, movement halved for 2 turns",
            hunterId, targetId);

        return new CripplingCallResult
        {
            HunterId = hunterId,
            TargetId = targetId,
            TargetName = targetName,
            OriginalMovementCost = 5,
            NewMovementCost = 2,
            DurationTurns = 2,
            Success = true,
            Message = $"Your shot strikes {targetName}'s leg, crippling it for 2 turns!"
        };
    }
}
```

---

## 7. The Perfect Hunt Ability Specification (Capstone)

### 7.1 Mechanics

**Ability ID:** `VeiðimaðrAbilityId.ThePerfectHunt`

**Type:** Ultimate Capstone (once per long rest)

**Action Economy:**
- **Cost:** 3 AP
- **Resource:** 1 Quarry Mark (consumed) + 1 Capstone Slot (long rest resource)
- **Range:** 12 spaces
- **Target:** Single marked enemy
- **Resolution:** Automatic critical hit (no attack roll)
- **Damage:** 2× critical multiplier on weapon damage
- **Frequency:** Once per long rest (limited resource)

**Mechanical Effects:**

```
Effect: Ultimate attack that automatically scores critical hit on marked target
├─ Prerequisites:
│  ├─ 3 AP available
│  ├─ 1 active Quarry Mark on target
│  ├─ Capstone slot available (resets at long rest)
│  ├─ Line of sight to target
│  └─ Target within 12 spaces
│
├─ Execution:
│  1. Verifies all requirements met
│  2. Automatically hits (attack roll = 20+)
│  3. Rolls weapon damage
│  4. Applies 2× critical multiplier
│  5. Deals total damage to target
│  6. Consumes mark
│  7. Consumes capstone slot (resets on long rest)
│
├─ Damage Resolution:
│  • Base weapon damage (2d6, 1d8, etc.)
│  • ×2 critical multiplier
│  • Example: 1d8+2 weapon → (1d8+2)×2 = 2d16+4 damage
│
├─ Resource Management:
│  └─ Capstone Slot: 1 per character, resets on 8-hour rest
│
├─ Special Properties:
│  ├─ Always hits (no miss)
│  ├─ Always critical (2× damage)
│  ├─ No defense/save possible
│  ├─ Cannot be redirected
│  └─ Satisfying narrative moment
```

**Perfect Hunt Workflow:**

```
1. Hunter has marked target in active encounter
2. Hunter spends 3 AP to activate Perfect Hunt
3. System checks:
   ✓ AP available
   ✓ Mark active on target
   ✓ Capstone slot unused today
4. Attack automatically hits (20+)
5. Damage rolled with 2× multiplier
6. Damage applied to target
7. Mark consumed
8. Capstone slot consumed (unavailable until long rest)
9. Log entry: "Perfect Hunt achieved"
10. Result message shows critical hit and damage

Example Output:
> perfect-hunt corrupted_wolf (marked)
> [The Perfect Hunt begins...]
> [Your shot finds the mark perfectly]
> [CRITICAL HIT! 2d8+4 = 16 damage!]
> [The Corrupted Wolf falls]
> [Your Perfect Hunt is complete. You may hunt again after a long rest.]
```

**Capstone Resource Reset:**

```
Long Rest (8 hours):
- Capstone Slot resets to "available"
- Can use Perfect Hunt again
- Happens automatically with rest mechanics
- Logged: "Perfect Hunt capability restored"
```

### 7.2 Advanced Mechanics

**Interaction with Other Bonuses:**

Perfect Hunt's 2× multiplier applies to **base weapon damage only**:

```
Weapon: 1d8+2 (Long Bow)
Bonuses from:
• Dexterity: +4
• Magic Item: +1
• Bard Song: +1

Perfect Hunt Calculation:
Base damage: 1d8+2 → Roll = 6, result = 8
×2 multiplier: 8 × 2 = 16
Add bonuses: 16 + 4 + 1 + 1 = 22 total damage
(Bonuses are applied after critical multiplication)
```

**Cannot be Used Without a Mark:**

```
Attempt without mark:
> perfect-hunt corrupted_wolf
> [Error: Corrupted Wolf is not marked]
> [Mark a target with Mark Quarry before using Perfect Hunt]

Attempt with insufficient AP:
> perfect-hunt corrupted_wolf
> [Error: Requires 3 AP, you have 2 AP]

Attempt without capstone slot:
> perfect-hunt corrupted_wolf
> [Error: Perfect Hunt already used today]
> [Your Perfect Hunt will be available after your next long rest]
```

### 7.3 Implementation

```csharp
/// <summary>
/// Capstone ability service for Perfect Hunt.
/// </summary>
public class CapstoneAbilityService : ICapstoneAbilityService
{
    private readonly IQuarryMarksService _quarryService;
    private readonly ICharacterRepository _characterRepository;
    private readonly IDiceRoller _diceRoller;
    private readonly ILogger<CapstoneAbilityService> _logger;

    public CapstoneAbilityService(
        IQuarryMarksService quarryService,
        ICharacterRepository characterRepository,
        IDiceRoller diceRoller,
        ILogger<CapstoneAbilityService> logger)
    {
        _quarryService = quarryService ?? throw new ArgumentNullException(nameof(quarryService));
        _characterRepository = characterRepository ?? throw new ArgumentNullException(nameof(characterRepository));
        _diceRoller = diceRoller ?? throw new ArgumentNullException(nameof(diceRoller));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public async Task<PerfectHuntResult> ExecuteCapstoneAsync(
        Guid hunterId,
        Guid targetId,
        string targetName,
        int baseWeaponDamage)
    {
        // 1. Verify capstone slot available
        var character = await _characterRepository.GetByIdAsync(hunterId);
        if (!character.HasCapstoneSlotAvailable())
        {
            throw new InvalidOperationException(
                "Perfect Hunt already used today. Available after long rest.");
        }

        // 2. Verify mark exists
        var mark = await _quarryService.GetMarkForAsync(hunterId, targetId);
        if (mark == null)
        {
            throw new InvalidOperationException($"Target {targetName} is not marked.");
        }

        // 3. Calculate critical hit damage (2×)
        const int criticalMultiplier = 2;
        int baseDamageRoll = baseWeaponDamage;
        int totalDamage = baseDamageRoll * criticalMultiplier;

        // 4. Remove mark
        await _quarryService.RemoveMarkAsync(hunterId, targetId);

        // 5. Consume capstone slot
        character.ConsumeCapstoneSlot();
        await _characterRepository.SaveAsync(character);

        // 6. Create result
        var result = new PerfectHuntResult
        {
            HunterId = hunterId,
            TargetId = targetId,
            TargetName = targetName,
            AttackRoll = 20, // Always hits
            BaseDamageRoll = baseDamageRoll,
            IsCriticalHit = true,
            CriticalMultiplier = criticalMultiplier,
            TotalDamage = totalDamage,
            MarkConsumed = true,
            CapstoneResourceUsed = true,
            ExecutedAt = DateTime.UtcNow,
            NarrativeDescription = GenerateNarrative(targetName, totalDamage)
        };

        _logger.LogInformation(
            "Perfect Hunt executed: {HunterId} on {TargetId} ({TargetName}). " +
            "Damage: {TotalDamage}. Capstone slot consumed.",
            hunterId, targetId, targetName, totalDamage);

        return result;
    }

    public async Task<bool> HasCapstoneResourceAsync(Guid hunterId)
    {
        var character = await _characterRepository.GetByIdAsync(hunterId);
        return character.HasCapstoneSlotAvailable();
    }

    public async Task<DateTime?> GetCapstoneResetTimeAsync(Guid hunterId)
    {
        var character = await _characterRepository.GetByIdAsync(hunterId);
        return character.GetCapstoneResetTime();
    }

    private string GenerateNarrative(string targetName, int damage)
    {
        return damage switch
        {
            _ when damage >= 30 =>
                $"Your perfect shot tears through {targetName} with devastating force!",
            _ when damage >= 20 =>
                $"Your shot strikes {targetName} at the exact moment of vulnerability!",
            _ when damage >= 10 =>
                $"Your shot finds {targetName} in a perfect moment!",
            _ =>
                $"Your shot lands on {targetName}!"
        };
    }
}
```

---

## 8. User Stories

### User Story 1: Marked Prey Cannot Hide

**As a** Veiðimaðr player at high level,
**I want to** negate concealment penalties against marked targets,
**So that** my prey has nowhere to hide once marked.

**Acceptance Criteria:**
- [ ] Apex Predator applies only to marked targets
- [ ] Light obscurement concealment removed
- [ ] Invisibility concealment removed
- [ ] Magical camouflage removed
- [ ] Full cover still cannot be bypassed
- [ ] Passive (always active, no AP cost)

### User Story 2: Crippling the Quarry

**As a** Veiðimaðr player,
**I want to** use a mark to cripple an enemy's movement,
**So that** fleeing prey is caught and controlled.

**Acceptance Criteria:**
- [ ] Crippling Shot costs 1 AP
- [ ] Crippling Shot consumes 1 mark
- [ ] Crippling Shot halves movement for 2 turns
- [ ] Works on any marked target in range
- [ ] Cannot be resisted (no save)
- [ ] Duration clearly displayed

### User Story 3: The Perfect Hunt

**As a** Veiðimaðr player,
**I want to** execute a capstone ability that guarantees a critical hit on my marked prey,
**So that** I have one perfect moment to strike with maximum power.

**Acceptance Criteria:**
- [ ] The Perfect Hunt costs 3 AP
- [ ] The Perfect Hunt requires marked target
- [ ] The Perfect Hunt automatically hits
- [ ] The Perfect Hunt deals 2× damage (critical)
- [ ] Can be used once per long rest
- [ ] Capstone slot visible in character sheet
- [ ] Cooldown timer shows until next reset
- [ ] Satisfying victory message on use

---

## 9. Application Service Layer

### 9.1 Extended IVeiðimaðrAbilityService (Complete)

```csharp
/// <summary>
/// Complete Veiðimaðr ability service with all tier methods.
/// </summary>
public interface IVeiðimaðrAbilityService
{
    // [v0.20.7a methods]
    Task<MarkQuarryResult> ExecuteMarkQuarryAsync(...);
    int ApplyKeenSenses(Guid hunterId);
    Task<ReadTheSignsResult> ExecuteReadTheSignsAsync(...);

    // [v0.20.7b methods]
    bool ShouldIgnoreCover(CoverType coverType);
    Task<TrapMasteryResult> PlaceTrapAsync(...);
    Task<TrapMasteryResult> DetectNearbyTrapsAsync(...);
    Task<bool> ActivatePredatorsPatienceAsync(Guid hunterId);
    Task<bool> DeactivatePredatorsPatienceAsync(Guid hunterId);

    // [NEW v0.20.7c methods]

    /// <summary>
    /// Applies Apex Predator passive (removes concealment from marked targets).
    /// </summary>
    Task<ApexPredatorResult> ApplyConcealmentDenialAsync(
        Guid hunterId,
        Guid targetId,
        ConcealmentType concealmentType);

    /// <summary>
    /// Executes Crippling Shot ability.
    /// </summary>
    Task<CripplingCallResult> ExecuteCripplingCallAsync(
        Guid hunterId,
        Guid targetId,
        string targetName);

    /// <summary>
    /// Executes The Perfect Hunt capstone ability.
    /// </summary>
    Task<PerfectHuntResult> ExecutePerfectHuntAsync(
        Guid hunterId,
        Guid targetId,
        string targetName,
        int baseWeaponDamage);

    /// <summary>
    /// Checks if Perfect Hunt can be executed.
    /// </summary>
    Task<(bool CanExecute, string? Reason)> CanExecutePerfectHuntAsync(
        Guid hunterId,
        Guid targetId);
}
```

### 9.2 ICapstoneAbilityService Interface

```csharp
/// <summary>
/// Service for managing capstone ability execution and resources.
/// </summary>
public interface ICapstoneAbilityService
{
    /// <summary>
    /// Executes The Perfect Hunt capstone on a marked target.
    /// </summary>
    Task<PerfectHuntResult> ExecuteCapstoneAsync(
        Guid hunterId,
        Guid targetId,
        string targetName,
        int baseWeaponDamage);

    /// <summary>
    /// Checks if capstone slot is available.
    /// </summary>
    Task<bool> HasCapstoneResourceAsync(Guid hunterId);

    /// <summary>
    /// Consumes capstone slot (happens during execute).
    /// </summary>
    Task ConsumeCapstoneResourceAsync(Guid hunterId);

    /// <summary>
    /// Gets description of capstone ability.
    /// </summary>
    string GetCapstoneDescription();

    /// <summary>
    /// Checks if target is valid for capstone (marked, in range).
    /// </summary>
    Task<bool> IsTargetValidForCapstoneAsync(Guid hunterId, Guid targetId);

    /// <summary>
    /// Gets time until capstone resets.
    /// </summary>
    Task<TimeSpan?> GetTimeUntilCapstoneResetAsync(Guid hunterId);
}
```

---

## 10. Configuration Specifications

### 10.1 abilities.json Tier 3 & Capstone Entries

```json
[
  {
    "id": "apex-predator",
    "displayName": "Apex Predator",
    "abilityType": "Passive",
    "tier": 3,
    "specialization": "veiðimaðr",
    "description": "Always active. Marked targets lose all concealment benefits.",
    "actionPointCost": 0,
    "resourceCost": null,
    "range": 0,
    "rangeType": "Self",
    "targetType": "Self",
    "resolution": "Passive",
    "effects": [
      {
        "type": "PassiveAbility",
        "mechanic": "DenyConcealmentOnMarked",
        "applicableTo": ["LightObscurement", "Invisibility", "MagicalCamo", "Hidden"],
        "modifierApplied": 0
      }
    ],
    "corruptionRisk": 0,
    "tags": ["passive", "marked-target", "concealment-denial", "coherent"],
    "prerequisites": ["tier2-completed"],
    "notes": "Only affects marked targets. Full cover still cannot be bypassed."
  },
  {
    "id": "crippling-call",
    "displayName": "Crippling Shot",
    "abilityType": "Active",
    "tier": 3,
    "specialization": "veiðimaðr",
    "description": "Ranged attack on marked target that halves movement for 2 turns.",
    "actionPointCost": 1,
    "resourceCost": {
      "type": "QuarryMark",
      "amount": 1
    },
    "range": 12,
    "rangeType": "spaces",
    "targetType": "SingleMarkedEnemy",
    "resolution": "Instant",
    "effects": [
      {
        "type": "ApplyDebuff",
        "debuff": "Crippled",
        "durationTurns": 2,
        "movementReduction": 0.5
      }
    ],
    "corruptionRisk": 0,
    "tags": ["active", "marked-target", "debuff", "control", "coherent"],
    "prerequisites": ["tier2-completed"],
    "notes": "Requires marked target. No attack roll (guaranteed). Consumes mark."
  },
  {
    "id": "the-perfect-hunt",
    "displayName": "The Perfect Hunt",
    "abilityType": "Ultimate",
    "tier": "Capstone",
    "specialization": "veiðimaðr",
    "description": "Ultimate attack on marked target that automatically scores a critical hit. Once per long rest.",
    "actionPointCost": 3,
    "resourceCost": {
      "type": "QuarryMark",
      "amount": 1,
      "description": "Consumes mark"
    },
    "capstoneResource": {
      "type": "PerfectHuntSlot",
      "maxPerRest": 1,
      "resetOn": "LongRest",
      "durationHours": 8
    },
    "range": 12,
    "rangeType": "spaces",
    "targetType": "SingleMarkedEnemy",
    "resolution": "AutomaticCriticalHit",
    "effects": [
      {
        "type": "ApplyDamage",
        "damageMultiplier": 2,
        "baseDamage": "WeaponDamage",
        "note": "Always hits, 2x critical multiplier"
      }
    ],
    "frequency": "OncePerLongRest",
    "corruptionRisk": 0,
    "tags": ["capstone", "ultimate", "auto-crit", "marked-target", "resource-limited", "coherent"],
    "prerequisites": ["tier3-completed"],
    "notes": "Requires marked target within range and 3 AP. Automatically hits and crits. Resets on long rest."
  }
]
```

### 10.2 capstone-registry.json Entry

```json
{
  "capstoneAbilities": [
    {
      "id": "the-perfect-hunt",
      "specialization": "veiðimaðr",
      "displayName": "The Perfect Hunt",
      "tier": "Capstone",
      "description": "Ultimate attack that automatically scores a critical hit on marked prey.",
      "apCost": 3,
      "markCost": 1,
      "capstoneSlots": 1,
      "damageMultiplier": 2,
      "frequency": {
        "maxPerDay": 1,
        "resetType": "LongRest",
        "resetDurationHours": 8
      },
      "requirements": {
        "hasMarkedTarget": true,
        "inRange": true,
        "hasCapstoneSlot": true,
        "hasAP": 3
      },
      "narrativeTemplate": "Your perfect shot tears through {targetName}!",
      "themeKeywords": ["hunt", "perfection", "culmination", "mastery"],
      "versionIntroduced": "0.20.7c"
    }
  ]
}
```

---

## 11. Code Examples & Implementation

### 11.1 ApexPredatorAbility Implementation

```csharp
/// <summary>
/// Apex Predator passive ability implementation.
/// Marked targets lose concealment benefits.
/// </summary>
public class ApexPredatorAbility : IPassiveAbility
{
    private readonly IQuarryMarksService _quarryService;
    private readonly ILogger<ApexPredatorAbility> _logger;

    public ApexPredatorAbility(
        IQuarryMarksService quarryService,
        ILogger<ApexPredatorAbility> logger)
    {
        _quarryService = quarryService ?? throw new ArgumentNullException(nameof(quarryService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    public VeiðimaðrAbilityId AbilityId => VeiðimaðrAbilityId.ApexPredator;

    /// <summary>
    /// Checks if concealment should be applied to an attack.
    /// Returns false (concealment denied) if target is marked.
    /// </summary>
    public async Task<bool> ShouldApplyConcealmentAsync(
        Guid hunterId,
        Guid targetId,
        ConcealmentType concealmentType)
    {
        // Check if target is marked
        bool isMarked = await _quarryService.HasActiveMark(hunterId, targetId);

        if (!isMarked)
        {
            // Non-marked targets keep concealment
            return true;
        }

        // Marked targets lose concealment
        _logger.LogInformation(
            "Apex Predator: Concealment denied to marked target {TargetId}",
            targetId);

        return false;
    }

    /// <summary>
    /// Gets concealment penalty modifier.
    /// Returns 0 (no penalty) for marked targets.
    /// </summary>
    public async Task<int> GetConcealmentPenaltyAsync(
        Guid hunterId,
        Guid targetId,
        ConcealmentType concealmentType)
    {
        bool isMarked = await _quarryService.HasActiveMark(hunterId, targetId);

        if (isMarked)
            return 0; // No penalty

        // Non-marked target penalties
        return concealmentType switch
        {
            ConcealmentType.LightObscurement => -2,
            ConcealmentType.Invisibility => -5,
            ConcealmentType.MagicalCamo => -3,
            ConcealmentType.Hidden => -4,
            _ => 0
        };
    }

    public string GetDescription() =>
        "Marked targets cannot use concealment benefits against your attacks.";
}
```

### 11.2 Perfect Hunt Capstone Flow

```csharp
/// <summary>
/// Complete execution flow for The Perfect Hunt capstone.
/// </summary>
public class PerfectHuntCapstoneExecutor
{
    public async Task<PerfectHuntResult> ExecuteAsync(
        Guid hunterId,
        Guid targetId,
        string targetName,
        ICharacter hunter,
        IWeapon weapon)
    {
        // 1. Validation Phase
        var validationResult = await ValidateExecutionAsync(hunterId, targetId, hunter);
        if (!validationResult.IsValid)
            throw new InvalidOperationException(validationResult.Error);

        // 2. Resource Consumption Phase
        await hunter.ConsumeAPAsync(3);
        await _quarryService.RemoveMarkAsync(hunterId, targetId);
        hunter.ConsumeCapstoneSlot();

        // 3. Damage Calculation Phase
        int baseDamage = weapon.RollDamage(); // Roll weapon damage
        int criticalDamage = baseDamage * 2;  // 2× critical multiplier

        // 4. Result Creation Phase
        var result = new PerfectHuntResult
        {
            HunterId = hunterId,
            TargetId = targetId,
            TargetName = targetName,
            AttackRoll = 20,
            BaseDamageRoll = baseDamage,
            IsCriticalHit = true,
            CriticalMultiplier = 2,
            TotalDamage = criticalDamage,
            MarkConsumed = true,
            CapstoneResourceUsed = true,
            ExecutedAt = DateTime.UtcNow,
            NarrativeDescription = GenerateNarrative(targetName, criticalDamage)
        };

        // 5. Logging Phase
        _logger.LogInformation(
            "Perfect Hunt executed by {HunterId} on {TargetId}. " +
            "Base damage: {BaseDamage}, Critical: {CriticalDamage}",
            hunterId, targetId, baseDamage, criticalDamage);

        // 6. Persistence Phase
        await _characterRepository.SaveAsync(hunter);

        return result;
    }

    private async Task<(bool IsValid, string? Error)> ValidateExecutionAsync(
        Guid hunterId,
        Guid targetId,
        ICharacter hunter)
    {
        // Check AP
        if (hunter.CurrentAP < 3)
            return (false, "Requires 3 AP");

        // Check mark
        var mark = await _quarryService.GetMarkForAsync(hunterId, targetId);
        if (mark == null)
            return (false, "Target is not marked");

        // Check capstone slot
        if (!hunter.HasCapstoneSlotAvailable())
            return (false, "Perfect Hunt already used today");

        return (true, null);
    }

    private string GenerateNarrative(string targetName, int damage)
    {
        if (damage >= 30)
            return $"Your perfect shot shatters {targetName} with overwhelming force!";
        else if (damage >= 20)
            return $"Your shot strikes {targetName} at the perfect moment!";
        else
            return $"Your perfect shot connects with {targetName}!";
    }
}
```

---

## 12. Synergy Mechanics

### 12.1 Complete Ability Stack Analysis

**Maximum Bonus Stack (All Abilities Active):**

```
Base Attack: 1d20 + [Dex Mod 4]

+ Quarry Mark (T1): +2
+ Keen Senses (T1): +1 (to perception check for detection)
+ Hunter's Eye (T2): Ignores cover (0 penalty instead of -2 to -5)
+ Predator's Patience (T2): +3 (stance bonus)
+ Apex Predator (T3): Denies concealment (0 penalty instead of -2 to -5)

Perfect Hunt (Capstone): 2× damage multiplier

EXAMPLE COMBAT SEQUENCE:
Turn 1: Mark Quarry (1 AP) → Quarry Wolf marked (+2 to hit)
Turn 2: Toggle Predator's Patience (1 AP) → +3 to hit (now +5 total)
Turn 3: Attack (1 AP) → 1d20 + 4 + 2 + 3 = Rolls 16, total 25
        (vs AC 15) → HIT!
        → Wolf is both marked and shadowed by patience
        → If concealed: Apex Predator denies it
        → Damage: Normal roll + bonuses

Later...
Turn N: Perfect Hunt (3 AP) → 2× damage, auto-hit, capstone consumed
        → Mark gone, but capstone satisfied
        → Victory
```

### 12.2 Synergy Tree

```
Tier 1 Foundation
├─ Mark Quarry: +2 to hit (base)
├─ Keen Senses: +1 perception
└─ Read the Signs: +4 investigation bonus

↓ ENABLES ↓

Tier 2 Tactics
├─ Hunter's Eye: Ignore cover
├─ Trap Mastery: Control field
└─ Predator's Patience: +3 stance (must stay still)

↓ REQUIRES ↓

Tier 3 Exploitation
├─ Apex Predator: Deny concealment (passive, marked only)
├─ Crippling Shot: Halve movement (consumes mark)
└─ Perfect Hunt: Auto-crit capstone (consumes mark)

SYNERGY BREAKDOWN:
• Marks → Enable T2/T3 abilities
• Hunter's Eye + Apex Predator → No escape (cover+concealment)
• Traps + Patience → Control while dealing damage
• Patience + Marks → Maximum bonus stack
• Perfect Hunt → Reward for maintaining marks
```

---

## 13. Specialization Capstone Theory

### 13.1 Why The Perfect Hunt is Satisfying

**Power Crescendo:**
- Tier 1: Foundation (basic hunter)
- Tier 2: Competent (tactical hunter)
- Tier 3: Master (apex hunter)
- Capstone: Legend (one perfect moment per day)

**Narrative Payoff:**
The Perfect Hunt represents the culmination of the hunt storyline:
1. *You mark your prey* (Tier 1)
2. *You position perfectly* (Tier 2)
3. *Your prey cannot escape* (Tier 3)
4. *The hunt concludes* (Capstone)

**Mechanical Payoff:**
- 3 AP cost (significant commitment)
- 2× damage multiplier (substantial reward)
- Guaranteed critical (no randomness)
- Limited frequency (once per long rest = special moment)

### 13.2 Capstone vs Other Specializations

Veiðimaðr capstone is thematic and powerful but not broken:

| Specialization | Capstone | Frequency | Cost | Payoff |
|---|---|---|---|---|
| Veiðimaðr | Perfect Hunt (2× damage) | Once/long rest | 3 AP + mark | High damage |
| Myrk-gengr | Eclipse (placeholder) | TBD | TBD | TBD |
| Future | TBD | TBD | TBD | TBD |

---

## 14. Logging Specifications

```csharp
// INFO: Apex Predator applied
_logger.LogInformation(
    "Apex Predator: Concealment denied to marked target {TargetId}. " +
    "Concealment type: {ConcealmentType}",
    targetId, concealmentType);

// INFO: Crippling Shot executed
_logger.LogInformation(
    "Crippling Shot: {HunterId} disabled {TargetId} ({TargetName}) movement for 2 turns",
    hunterId, targetId, targetName);

// INFO: Perfect Hunt executed
_logger.LogInformation(
    "Perfect Hunt capstone executed: {HunterId} on {TargetId} ({TargetName}). " +
    "Base damage: {BaseDamage}, Critical ×2: {CriticalDamage}. " +
    "Mark consumed. Capstone slot consumed (resets on long rest).",
    hunterId, targetId, targetName, baseDamage, criticalDamage);

// WARN: Perfect Hunt rejected
_logger.LogWarning(
    "Perfect Hunt rejected for {HunterId}: {Reason}",
    hunterId, reason);
```

---

## 15. Unit Testing Requirements

### 15.1 Test Classes

```csharp
public class ApexPredatorAbilityTests
{
    [Fact]
    public async Task ApplyConcealmentDenial_MarkedTarget_RemovesConcealmentPenalty()

    [Fact]
    public async Task ApplyConcealmentDenial_UnmarkedTarget_KeepsConcealmentPenalty()

    [Theory]
    [InlineData(ConcealmentType.LightObscurement, -2)]
    [InlineData(ConcealmentType.Invisibility, -5)]
    public async Task GetConcealmentPenalty_UnmarkedTarget_ReturnsCorrectPenalty(
        ConcealmentType concealmentType, int expectedPenalty)
}

public class CripplingCallAbilityTests
{
    [Fact]
    public async Task ExecuteCripplingCall_MarkedTarget_HalvesMovement()

    [Fact]
    public async Task ExecuteCripplingCall_ConsumesMarkOnExecution()

    [Fact]
    public async Task ExecuteCripplingCall_AppliesDuration2Turns()

    [Fact]
    public async Task ExecuteCripplingCall_UnmarkedTarget_Fails()
}

public class PerfectHuntCapstoneTests
{
    [Fact]
    public async Task ExecuteCapstone_MarkedTarget_AutomaticallyCrits()

    [Fact]
    public async Task ExecuteCapstone_RollsDamageWith2xMultiplier()

    [Fact]
    public async Task ExecuteCapstone_ConsumesCapstoneSlot()

    [Fact]
    public async Task ExecuteCapstone_WithoutCapstoneSlot_Fails()

    [Fact]
    public async Task ExecuteCapstone_WithoutMark_Fails()

    [Fact]
    public async Task ExecuteCapstone_WithInsufficientAP_Fails()
}

public class CapstoneResourceTests
{
    [Fact]
    public async Task HasCapstoneSlot_AfterLongRest_ReturnsTrue()

    [Fact]
    public async Task HasCapstoneSlot_AfterUsing_ReturnsFalse()

    [Fact]
    public async Task GetResetTime_CalculatesCorrectDuration()
}
```

---

## 16. Deliverable Checklist

- [ ] **Domain Value Objects**
  - [ ] ApexPredatorResult implemented
  - [ ] CripplingCallResult implemented
  - [ ] PerfectHuntResult implemented with narrative generation

- [ ] **Domain Enums**
  - [ ] ConcealmentType enum (5+ types)

- [ ] **Application Services**
  - [ ] ICapstoneAbilityService interface
  - [ ] CapstoneAbilityService implementation
  - [ ] IVeiðimaðrAbilityService extended with T3 methods

- [ ] **Ability Implementations**
  - [ ] Apex Predator passive
  - [ ] Crippling Shot active
  - [ ] The Perfect Hunt capstone

- [ ] **Configuration**
  - [ ] abilities.json entries for all 3 T3 abilities + capstone
  - [ ] capstone-registry.json entry

- [ ] **Tests**
  - [ ] ~7 unit tests covering all abilities
  - [ ] Apex Predator concealment denial tests
  - [ ] Crippling Shot execution tests
  - [ ] Perfect Hunt capstone tests
  - [ ] Capstone resource management tests

---

## 17. Acceptance Criteria

- [ ] Apex Predator denies concealment to marked targets only
- [ ] Apex Predator does NOT affect full cover
- [ ] Crippling Shot costs 1 AP + 1 mark
- [ ] Crippling Shot halves movement for 2 turns (guaranteed, no save)
- [ ] The Perfect Hunt costs 3 AP + 1 mark + 1 capstone slot
- [ ] The Perfect Hunt automatically hits and crits (2× damage)
- [ ] The Perfect Hunt resets on long rest (8-hour sleep)
- [ ] All abilities have zero corruption risk
- [ ] Tier 3 abilities stack with Tier 1 & Tier 2 abilities
- [ ] Capstone slot visible in character sheet UI
- [ ] Reset timer/cooldown displayed to player
- [ ] All code follows established patterns
- [ ] XML documentation complete
- [ ] Unit tests cover all code paths
- [ ] Satisfying narrative descriptions for perfect hunt

---

## 18. Dependencies & Prerequisites

- v0.20.7a (Tier 1 framework with Quarry Marks)
- v0.20.7b (Tier 2 abilities and mechanics)
- v0.17.4 Specialization Framework
- Combat system (for attack resolution)
- Character sheet system (for capstone resource display)
- Long rest system (for capstone reset)
- Concealment system (for Apex Predator interaction)

---

## 19. Design Decisions & Rationale

### Decision 1: Capstone Limitation (Once Per Long Rest)

**Decision:** The Perfect Hunt can be used only once per 8-hour rest.

**Rationale:**
- Prevents capstone spam in extended battles
- Creates meaningful resource management
- Makes capstone feel "special" not "standard"
- Encourages players to save capstone for climactic moments

### Decision 2: 2× Critical Multiplier (Not 3×)

**Decision:** Perfect Hunt deals 2× damage, not 3× or higher.

**Rationale:**
- 2× is powerful but not game-breaking
- Scales reasonably (1d8 → ~8 damage becomes ~16)
- Matches D&D standard critical damage
- Doesn't create one-shot kills on bosses

### Decision 3: 3 AP Cost for Capstone

**Decision:** The Perfect Hunt costs all 3 APs in a standard turn.

**Rationale:**
- Significant commitment (entire turn of actions)
- Prevents combo exploitation
- Forces tactical planning (use now or wait?)
- Makes it feel important

### Decision 4: Apex Predator as Passive (Not Active)

**Decision:** Concealment denial is always-on passive, not activated ability.

**Rationale:**
- Thematic: Master hunters always see prey
- Mechanical: Passive effects are "earned" abilities at T3
- Balance: Doesn't consume AP, but only affects marks
- Design: Creates layer of mastery progression

---

## 20. Complete Veiðimaðr Progression Matrix

### 20.1 Tier Progression Overview

```
VEIÐIMAÐR PROGRESSION (Coherent Path)

Tier 1: The Foundation
├─ Mark Quarry: Designate targets (+2 hit)
├─ Keen Senses: Passive +1 perception
└─ Read the Signs: Investigate tracks (+4 bonus)

GAMEPLAY FEEL: "I'm learning to hunt"
MECHANICS: Basic targeting, passive bonuses, skill checks
POWER LEVEL: Moderate (+2 to marked targets)

Tier 2: The Tactics
├─ Hunter's Eye: Ignore partial cover (passive)
├─ Trap Mastery: Place/detect traps (2 AP)
└─ Predator's Patience: Stance +3 to hit (1 AP)

GAMEPLAY FEEL: "I'm mastering the environment"
MECHANICS: Tactical positioning, environmental control, stance management
POWER LEVEL: High (+5 potential bonus stack)
SYNERGY: Marks enable T2 mechanics

Tier 3: The Mastery
├─ Apex Predator: No concealment on marked targets (passive)
├─ Crippling Shot: Halve movement (1 AP, consumes mark)
└─ [Reserved for Capstone]

GAMEPLAY FEEL: "I'm becoming the apex predator"
MECHANICS: Marked target exploitation, movement denial
POWER LEVEL: Very High (permanent bonuses + control)
SYNERGY: All T1 abilities feed into T3

Capstone: The Perfect Hunt
└─ The Perfect Hunt: Auto-crit on marked target (3 AP, once/long rest)

GAMEPLAY FEEL: "I've achieved perfection"
MECHANICS: Capstone resource, climactic payoff
POWER LEVEL: Extreme (guaranteed 2× damage at key moment)
SYNERGY: Culmination of entire specialization
```

### 20.2 Resource Economy

```
AP (Action Points):
- T1: Mark Quarry (1 AP), Read the Signs (1 AP) = 2 AP typical
- T2: Hunter's Eye (0 AP passive), Trap Mastery (2 AP), Patience toggle (1 AP)
- T3: Crippling Shot (1 AP), Perfect Hunt (3 AP all-in)

Quarry Marks:
- T1: Spend 1 mark to create (max 3 active)
- T2: Traps don't consume marks; Patience doesn't consume marks
- T3: Crippling Shot consumes 1 mark; Perfect Hunt consumes 1 mark

Capstone Resource:
- 1 slot per character
- Resets on long rest (8 hours)
- Consumed by The Perfect Hunt
- Visible in character sheet UI
```

### 20.3 Synergy Web

```
Mark Quarry (T1 foundation)
    ↓ Enables ↓
Hunter's Eye (T2) + Predator's Patience (T2)
    ↓ Enables ↓
Apex Predator (T3) + Crippling Shot (T3)
    ↓ Culminates in ↓
The Perfect Hunt (Capstone)

Additional Interactions:
• Keen Senses (T1) → All perception checks
• Read the Signs (T1) → All investigation checks
• Trap Mastery (T2) → Field control + detection
• Patience (T2) + Marks (T1) → +5 hit bonus (max stack)
• Hunter's Eye (T2) + Apex Predator (T3) → No escape (cover + concealment)
```

---

## 21. Final Notes

### Implementation Order

1. Create domain value objects (ApexPredatorResult, CripplingCallResult, PerfectHuntResult)
2. Create ConcealmentType enum
3. Implement ApexPredatorAbility (simplest, passive only)
4. Implement CripplingCallAbility (requires mark consumption)
5. Implement CapstoneAbilityService and PerfectHuntAbility (most complex)
6. Create configuration entries
7. Write and validate unit tests
8. Integration testing with full Veiðimaðr specialization

### Testing Priority

1. **High Priority:** Capstone resource management (prevents exploits)
2. **High Priority:** Concealment denial mechanics (ensures passive works correctly)
3. **Medium Priority:** Crippling shot movement reduction (gameplay feel)
4. **Medium Priority:** Stacking with other bonuses (balance verification)
5. **Low Priority:** Narrative generation (QoL, doesn't affect mechanics)

### Known Limitations & Future Work

- Capstone resets on long rest only (not on combat end)
- Perfect Hunt doesn't support conditional targeting (always on marked target)
- Concealment system is abstracted (actual concealment implementation TBD)
- Future specializations should follow this progression model

---

**End of v0.20.7c Design Specification**
