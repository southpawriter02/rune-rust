# v0.8.0a Design Specification: Character Creation Wizard

**Version:** 0.8.0a
**Parent:** v0.8.0 (Character & Settings)
**Prerequisites:** v0.7.3c Complete (Combat UI Components)
**Status:** Design Complete
**Estimated Unit Tests:** ~12

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Character Creation Wizard Window](#4-character-creation-wizard-window)
5. [Wizard ViewModel](#5-wizard-viewmodel)
6. [Step ViewModels](#6-step-viewmodels)
7. [Step Controls](#7-step-controls)
8. [Styles](#8-styles)
9. [Data Model Changes](#9-data-model-changes)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Overview

### Purpose

Implement a multi-step character creation wizard guiding players through name entry, race selection, class selection, stat allocation, appearance/portrait selection, and final review. Each step provides previews and validation before progression.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Windows** | `CharacterCreationWizard` |
| **ViewModels** | `WizardViewModel` + 6 step VMs |
| **User Controls** | 6 step controls |
| **Styles** | `WizardStyles.axaml` |
| **Tests** | ~12 unit tests |

### Design Principles

1. **Guided Flow**: Clear step-by-step progression
2. **Validation**: Each step validates before Next
3. **Preview**: Show selection details before committing
4. **Reversible**: Back button allows corrections

---

## 2. Feature Overview

```
v0.8.0a Features
├── CharacterCreationWizard (Window)
│   ├── Header with title and step indicator
│   ├── Content area for current step
│   ├── Progress indicator (● ○ ○ ○ ○ ○)
│   └── Back/Next navigation buttons
│
├── Step 1: NameEntryStep
│   ├── Text input for character name
│   ├── Validation rules display
│   └── Real-time validation feedback
│
├── Step 2: RaceSelectionStep
│   ├── Race list (Human, Elf, Dwarf, etc.)
│   ├── Race details preview panel
│   ├── Stat bonuses display
│   └── Racial traits display
│
├── Step 3: ClassSelectionStep
│   ├── Class list (Warrior, Mage, Rogue, etc.)
│   ├── Class details preview panel
│   ├── Starting abilities display
│   └── Starting equipment preview
│
├── Step 4: StatAllocationStep
│   ├── Point-buy system
│   ├── Points remaining counter
│   ├── +/- buttons per stat
│   ├── Racial bonus display
│   └── Modifier calculation
│
├── Step 5: AppearanceStep
│   ├── Portrait grid selection
│   └── Preview of selected portrait
│
└── Step 6: ReviewStep
    ├── Character summary
    ├── Portrait, name, race, class
    ├── Final stats with modifiers
    ├── Traits and abilities list
    └── Create Character button
```

---

## 3. Architecture

### Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       PRESENTATION LAYER                                │
├─────────────────────────────────────────────────────────────────────────┤
│  CharacterCreationWizard (Window)                                       │
│  └── WizardViewModel                                                    │
│       ├── CurrentStep: int                                              │
│       ├── CurrentStepViewModel: WizardStepViewModelBase                 │
│       ├── CreationData: CharacterCreationData                           │
│       ├── GoBackCommand                                                 │
│       └── GoNextCommand                                                 │
│                                                                         │
│  Step ViewModels (inherit WizardStepViewModelBase)                      │
│  ├── NameEntryStepViewModel                                             │
│  ├── RaceSelectionStepViewModel                                         │
│  ├── ClassSelectionStepViewModel                                        │
│  ├── StatAllocationStepViewModel                                        │
│  ├── AppearanceStepViewModel                                            │
│  └── ReviewStepViewModel                                                │
└────────────────────────────────────┬────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│  ICharacterCreationService.CreateCharacterAsync(data)                   │
│  IRaceDefinitionService.GetAllRaces()                                   │
│  IClassDefinitionService.GetAllClasses()                                │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Character Creation Wizard Window

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/CharacterCreationWizard.axaml`

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RuneAndRust.Avalonia.ViewModels.Wizard"
        x:Class="RuneAndRust.Avalonia.Views.CharacterCreationWizard"
        x:DataType="vm:WizardViewModel"
        Title="Character Creation"
        Width="800" Height="600"
        WindowStartupLocation="CenterScreen">
    
    <Grid RowDefinitions="Auto,*,Auto,Auto">
        
        <!-- Header -->
        <Border Grid.Row="0" Classes="wizard-header" Padding="16">
            <StackPanel HorizontalAlignment="Center">
                <TextBlock Text="CHARACTER CREATION" Classes="title" />
                <TextBlock Classes="subtitle">
                    <Run Text="Step " />
                    <Run Text="{Binding CurrentStep}" />
                    <Run Text=" of " />
                    <Run Text="{Binding TotalSteps}" />
                    <Run Text=": " />
                    <Run Text="{Binding CurrentStepTitle}" />
                </TextBlock>
            </StackPanel>
        </Border>
        
        <!-- Step Content -->
        <ContentControl Grid.Row="1" 
                        Content="{Binding CurrentStepViewModel}"
                        Margin="16" />
        
        <!-- Progress Indicator -->
        <Border Grid.Row="2" Padding="16,8">
            <ItemsControl ItemsSource="{Binding StepIndicators}"
                          HorizontalAlignment="Center">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Ellipse Width="12" Height="12"
                                 Fill="{Binding Fill}"
                                 Stroke="{StaticResource BorderBrush}" />
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>
        
        <!-- Navigation Buttons -->
        <Border Grid.Row="3" Classes="wizard-footer" Padding="16">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <Button Grid.Column="1"
                        Content="‹ Back"
                        Command="{Binding GoBackCommand}"
                        IsVisible="{Binding CanGoBack}"
                        Margin="0,0,8,0" />
                <Button Grid.Column="2"
                        Content="{Binding NextButtonText}"
                        Command="{Binding GoNextCommand}"
                        Classes="primary" />
            </Grid>
        </Border>
        
    </Grid>
</Window>
```

---

## 5. Wizard ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/Wizard/WizardViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels.Wizard;

public partial class WizardViewModel : ViewModelBase
{
    private readonly ICharacterCreationService _creationService;
    private readonly INavigationService _navigation;
    private readonly List<WizardStepViewModelBase> _steps;

    [ObservableProperty] private int _currentStep = 1;
    [ObservableProperty] private int _totalSteps = 6;
    [ObservableProperty] private WizardStepViewModelBase _currentStepViewModel;
    [ObservableProperty] private CharacterCreationData _creationData = new();
    [ObservableProperty] private bool _canGoBack;
    [ObservableProperty] private bool _isLastStep;

    public string CurrentStepTitle => CurrentStepViewModel?.StepTitle ?? "";
    public string NextButtonText => IsLastStep ? "Create Character" : "Next ›";
    public ObservableCollection<StepIndicator> StepIndicators { get; } = new();

    public WizardViewModel(
        ICharacterCreationService creationService,
        INavigationService navigation,
        IRaceDefinitionService raceService,
        IClassDefinitionService classService)
    {
        _creationService = creationService;
        _navigation = navigation;

        _steps = new()
        {
            new NameEntryStepViewModel(CreationData),
            new RaceSelectionStepViewModel(CreationData, raceService),
            new ClassSelectionStepViewModel(CreationData, classService),
            new StatAllocationStepViewModel(CreationData),
            new AppearanceStepViewModel(CreationData),
            new ReviewStepViewModel(CreationData)
        };

        for (int i = 0; i < _totalSteps; i++)
            StepIndicators.Add(new StepIndicator(i + 1, i == 0));

        CurrentStepViewModel = _steps[0];
        UpdateNavigationState();
    }

    [RelayCommand]
    private void GoBack()
    {
        if (CurrentStep > 1)
        {
            CurrentStep--;
            CurrentStepViewModel = _steps[CurrentStep - 1];
            UpdateNavigationState();
        }
    }

    [RelayCommand]
    private async Task GoNextAsync()
    {
        if (!CurrentStepViewModel.Validate())
            return;

        if (IsLastStep)
        {
            await CreateCharacterAsync();
        }
        else
        {
            CurrentStep++;
            CurrentStepViewModel = _steps[CurrentStep - 1];
            UpdateNavigationState();
        }
    }

    private async Task CreateCharacterAsync()
    {
        var player = await _creationService.CreateCharacterAsync(CreationData);
        _navigation.NavigateTo<GameWindow>(player);
    }

    private void UpdateNavigationState()
    {
        CanGoBack = CurrentStep > 1;
        IsLastStep = CurrentStep == TotalSteps;
        
        for (int i = 0; i < StepIndicators.Count; i++)
            StepIndicators[i].IsActive = i < CurrentStep;

        OnPropertyChanged(nameof(CurrentStepTitle));
        OnPropertyChanged(nameof(NextButtonText));
    }
}

public partial class StepIndicator : ObservableObject
{
    public int StepNumber { get; }
    [ObservableProperty] private bool _isActive;
    public IBrush Fill => IsActive ? Brushes.Gold : Brushes.Transparent;

    public StepIndicator(int step, bool active)
    {
        StepNumber = step;
        IsActive = active;
    }
}
```

---

## 6. Step ViewModels

### Base Class

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/Wizard/WizardStepViewModelBase.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels.Wizard;

public abstract partial class WizardStepViewModelBase : ViewModelBase
{
    protected CharacterCreationData Data { get; }
    public abstract string StepTitle { get; }
    [ObservableProperty] private bool _isValid;
    [ObservableProperty] private string? _validationMessage;

    protected WizardStepViewModelBase(CharacterCreationData data) => Data = data;
    public abstract bool Validate();
}
```

### NameEntryStepViewModel

```csharp
public partial class NameEntryStepViewModel : WizardStepViewModelBase
{
    public override string StepTitle => "Choose Your Name";

    [ObservableProperty] private string _characterName = "";

    public NameEntryStepViewModel(CharacterCreationData data) : base(data) { }

    public override bool Validate()
    {
        if (string.IsNullOrWhiteSpace(CharacterName) || CharacterName.Length < 2)
        {
            ValidationMessage = "Name must be at least 2 characters";
            return IsValid = false;
        }
        if (CharacterName.Length > 20)
        {
            ValidationMessage = "Name must be 20 characters or less";
            return IsValid = false;
        }
        Data.Name = CharacterName;
        return IsValid = true;
    }

    partial void OnCharacterNameChanged(string value) => Validate();
}
```

### RaceSelectionStepViewModel

```csharp
public partial class RaceSelectionStepViewModel : WizardStepViewModelBase
{
    public override string StepTitle => "Choose Race";
    
    [ObservableProperty] private ObservableCollection<RaceDefinition> _races = new();
    [ObservableProperty] private RaceDefinition? _selectedRace;

    public RaceSelectionStepViewModel(CharacterCreationData data, IRaceDefinitionService raceService) 
        : base(data)
    {
        foreach (var race in raceService.GetAllRaces())
            Races.Add(race);
    }

    public override bool Validate()
    {
        if (SelectedRace is null)
        {
            ValidationMessage = "Please select a race";
            return IsValid = false;
        }
        Data.RaceId = SelectedRace.RaceId;
        return IsValid = true;
    }

    partial void OnSelectedRaceChanged(RaceDefinition? value) => Validate();
}
```

### StatAllocationStepViewModel

```csharp
public partial class StatAllocationStepViewModel : WizardStepViewModelBase
{
    public override string StepTitle => "Allocate Stats";
    private const int TotalPoints = 27;
    private static readonly int[] PointCosts = { 0, 1, 2, 3, 4, 5, 7, 9 }; // 8-15

    [ObservableProperty] private int _pointsRemaining = 27;
    [ObservableProperty] private ObservableCollection<StatAllocationViewModel> _stats = new();

    public StatAllocationStepViewModel(CharacterCreationData data) : base(data)
    {
        Stats.Add(new StatAllocationViewModel("Strength", 10, this));
        Stats.Add(new StatAllocationViewModel("Dexterity", 10, this));
        Stats.Add(new StatAllocationViewModel("Constitution", 10, this));
        Stats.Add(new StatAllocationViewModel("Intelligence", 10, this));
        Stats.Add(new StatAllocationViewModel("Wisdom", 10, this));
        Stats.Add(new StatAllocationViewModel("Charisma", 10, this));
        RecalculatePoints();
    }

    public void RecalculatePoints()
    {
        var spent = Stats.Sum(s => GetPointCost(s.BaseValue));
        PointsRemaining = TotalPoints - spent;
    }

    private static int GetPointCost(int value) => value >= 8 && value <= 15 ? PointCosts[value - 8] : 0;

    public override bool Validate()
    {
        if (PointsRemaining < 0)
        {
            ValidationMessage = "You've spent too many points";
            return IsValid = false;
        }
        foreach (var stat in Stats)
            Data.Stats[stat.StatName] = stat.BaseValue;
        return IsValid = true;
    }
}

public partial class StatAllocationViewModel : ObservableObject
{
    private readonly StatAllocationStepViewModel _parent;
    public string StatName { get; }
    [ObservableProperty] private int _baseValue;
    public int RacialBonus { get; set; }
    public int Total => BaseValue + RacialBonus;
    public int Modifier => (Total - 10) / 2;

    public StatAllocationViewModel(string name, int baseVal, StatAllocationStepViewModel parent)
    {
        StatName = name;
        _baseValue = baseVal;
        _parent = parent;
    }

    [RelayCommand]
    private void Increment()
    {
        if (BaseValue < 15) { BaseValue++; _parent.RecalculatePoints(); }
    }

    [RelayCommand]
    private void Decrement()
    {
        if (BaseValue > 8) { BaseValue--; _parent.RecalculatePoints(); }
    }
}
```

---

## 7. Step Controls

Step controls are DataTemplates that display based on ViewModel type:

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/Wizard/WizardStepTemplates.axaml`

```xml
<ResourceDictionary>
    <!-- Name Entry Step -->
    <DataTemplate DataType="vm:NameEntryStepViewModel">
        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Width="400">
            <TextBlock Text="Enter your character's name:" Margin="0,0,0,16" />
            <TextBox Text="{Binding CharacterName}" Watermark="Character Name" />
            <TextBlock Text="{Binding ValidationMessage}" Classes="error" 
                       IsVisible="{Binding !IsValid}" Margin="0,8,0,0" />
        </StackPanel>
    </DataTemplate>

    <!-- Race Selection Step -->
    <DataTemplate DataType="vm:RaceSelectionStepViewModel">
        <Grid ColumnDefinitions="*,*">
            <ListBox Grid.Column="0" ItemsSource="{Binding Races}" 
                     SelectedItem="{Binding SelectedRace}">
                <ListBox.ItemTemplate>
                    <DataTemplate><TextBlock Text="{Binding Name}" /></DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <Border Grid.Column="1" Classes="panel" Margin="16,0,0,0" Padding="16"
                    IsVisible="{Binding SelectedRace, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel DataContext="{Binding SelectedRace}">
                    <TextBlock Text="{Binding Name}" Classes="title" />
                    <TextBlock Text="{Binding Description}" TextWrapping="Wrap" />
                    <TextBlock Text="Stat Bonuses:" FontWeight="Bold" Margin="0,16,0,4" />
                    <ItemsControl ItemsSource="{Binding StatBonuses}" />
                </StackPanel>
            </Border>
        </Grid>
    </DataTemplate>

    <!-- Stat Allocation Step -->
    <DataTemplate DataType="vm:StatAllocationStepViewModel">
        <StackPanel>
            <TextBlock Margin="0,0,0,16">
                <Run Text="Points Remaining: " />
                <Run Text="{Binding PointsRemaining}" FontWeight="Bold" />
            </TextBlock>
            <ItemsControl ItemsSource="{Binding Stats}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="120,Auto,60,Auto,60,60" Margin="0,4">
                            <TextBlock Grid.Column="0" Text="{Binding StatName}" />
                            <Button Grid.Column="1" Content="-" Command="{Binding DecrementCommand}" />
                            <TextBlock Grid.Column="2" Text="{Binding BaseValue}" HorizontalAlignment="Center" />
                            <Button Grid.Column="3" Content="+" Command="{Binding IncrementCommand}" />
                            <TextBlock Grid.Column="4" Text="{Binding Total}" HorizontalAlignment="Center" />
                            <TextBlock Grid.Column="5" HorizontalAlignment="Center">
                                <Run Text="(" /><Run Text="{Binding Modifier, StringFormat='+#;-#;+0'}" /><Run Text=")" />
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </DataTemplate>
</ResourceDictionary>
```

---

## 8. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/WizardStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui">
    <Style Selector="Border.wizard-header">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
    </Style>
    <Style Selector="Border.wizard-footer">
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
        <Setter Property="BorderThickness" Value="0,1,0,0" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    <Style Selector="TextBlock.title">
        <Setter Property="FontSize" Value="24" />
        <Setter Property="FontWeight" Value="Bold" />
    </Style>
    <Style Selector="TextBlock.subtitle">
        <Setter Property="FontSize" Value="14" />
        <Setter Property="Foreground" Value="{StaticResource MutedBrush}" />
    </Style>
</Styles>
```

---

## 9. Data Model Changes

### CharacterCreationData

**File:** `src/Presentation/RuneAndRust.Avalonia/Models/CharacterCreationData.cs`

```csharp
namespace RuneAndRust.Avalonia.Models;

public class CharacterCreationData
{
    public string Name { get; set; } = "";
    public string RaceId { get; set; } = "";
    public string ClassId { get; set; } = "";
    public Dictionary<string, int> Stats { get; } = new();
    public string PortraitId { get; set; } = "";
}
```

---

## 10. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| WizardViewModel | Information | Step navigation, character creation |
| Step ViewModels | Debug | Validation results |

---

## 11. Unit Testing Requirements

| Feature | Tests |
|---------|-------|
| Name validation | 3 |
| Race selection | 2 |
| Class selection | 2 |
| Stat allocation | 3 |
| Navigation | 2 |
| **Total** | **~12** |

---

## 12. Use Cases

- **UC-080a-001**: Enter valid character name
- **UC-080a-002**: Select race and view details
- **UC-080a-003**: Select class and view abilities
- **UC-080a-004**: Allocate stat points
- **UC-080a-005**: Select portrait
- **UC-080a-006**: Review and create character

---

## 13. Deliverable Checklist

- [ ] `Views/CharacterCreationWizard.axaml` created
- [ ] `ViewModels/Wizard/WizardViewModel.cs` created
- [ ] 6 step ViewModels created
- [ ] `WizardStepTemplates.axaml` created
- [ ] `WizardStyles.axaml` created
- [ ] `CharacterCreationData.cs` created
- [ ] ~12 unit tests implemented

---

## 14. Acceptance Criteria

- [ ] Wizard opens from main menu "New Game"
- [ ] Name step validates 2-20 characters
- [ ] Race/class steps show selection previews
- [ ] Stat allocation tracks points correctly
- [ ] Review step shows complete character
- [ ] Create Character starts new game
- [ ] Back/Next navigation works
- [ ] ~12 unit tests pass

---

## 15. Dependencies

### Required from v0.7.x
- `MainMenuWindow`, `NavigationService`, `BaseTheme`

### Required from Application Layer
- `ICharacterCreationService`, `IRaceDefinitionService`, `IClassDefinitionService`

### Provides to v0.8.0b
- Wizard patterns, step navigation

---

## 16. Future Considerations

### Deferred to v0.9.0
- Custom portrait uploads
- Backstory entry step
- Difficulty selection in wizard

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
