# v0.14.2a Changelog - Weapon Schema

**Release Date:** 2026-01-21  
**Version:** 0.14.2a  
**Theme:** Equipment Configuration Schemas

---

## Summary

Introduces the Weapon Schema (`weapons.schema.json`) for validating weapon configuration. This schema validates damage dice expressions, weapon types, attack modifiers, stat bonuses, weapon properties, proficiency categories, material types, and quality tiers.

---

## Added

### Schema Files

- **`config/schemas/weapons.schema.json`** - JSON Schema Draft-07 for weapon definitions
  - `WeaponDefinition` - Complete weapon properties including id, name, description, weaponType, damageDice, damageType, attackModifier, statBonuses, properties, proficiency, material, quality, range, isTwoHanded, value, sortOrder
  - `StatBonuses` - Attribute bonuses (might, fortitude, will, wits, finesse) with support for custom stats
  - `WeaponRange` - Range parameters for ranged weapons (minimum, optimal, maximum)

### Validation Rules

- **Damage dice pattern**: `^\d+d\d+([+-]\d+)?$` - Validates expressions like "1d8", "2d6+3", "1d4-1"
- **Weapon type enum**: Sword, Axe, Dagger, Staff, Bow, Mace, Spear, Hammer, Crossbow, Wand
- **Proficiency enum**: Simple, Martial, Exotic
- **Quality tier enum**: Common, Uncommon, Rare, Epic, Legendary
- **Material type enum**: Wood, Iron, Steel, Mithril, Adamantine
- **Weapon properties enum**: finesse, versatile, reach, thrown, two-handed, light, heavy, loading
- **ID pattern**: `^[a-z][a-z0-9_]*$` (lowercase with underscores)

### Unit Tests

- **`WeaponsSchemaTests.cs`** - 5 new tests
  - `Schema_IsValidJsonSchemaDraft07` - Validates schema structure and definitions
  - `ExistingWeaponsJson_ValidatesAgainstSchema` - Backwards compatibility with 9 existing weapons
  - `DamageDice_ValidPattern_PassesValidation` - Tests valid dice expressions
  - `DamageDice_InvalidPattern_FailsValidation` - Tests invalid dice expressions
  - `WeaponType_InvalidEnumValue_FailsValidation` - Tests invalid weapon type enum

---

## Changed

### Configuration Files

- **`config/weapons.json`** - Updated `$schema` reference from `"weapons.schema.json"` to `"./schemas/weapons.schema.json"` for proper schema discovery

---

## Technical Notes

- Schema follows JSON Schema Draft-07 specification
- All 9 existing weapons validate successfully against the new schema
- Schema provides IDE autocomplete and inline validation in VS Code
- StatBonuses allows additionalProperties for custom stats beyond the core five

---

## Dependencies

- **v0.14.1c** (Damage Types Schema) - `damageType` field references damage type IDs

---

## Testing

```bash
# Run weapon schema tests
dotnet test tests/RuneAndRust.Infrastructure.IntegrationTests --filter "WeaponsSchemaTests"

# Run all tests
dotnet test
```

---

*Part 1 of 4 in the v0.14.2 Equipment Configuration Schemas series.*
