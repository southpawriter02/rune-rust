# v0.14.3a Changelog - Monster Schema

## Summary

Implemented `monsters.schema.json` with comprehensive validation for monster definitions, including stat blocks, AI behavior patterns, resistance configurations, tier/trait references, name generation rules, and embedded loot tables. This schema enables full customization of monsters without code changes, supporting modding scenarios like sci-fi enemies, undead hordes, alien creatures, or fantasy beasts.

## Added

### Schema Files
- **[config/schemas/monsters.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/monsters.schema.json)** - JSON Schema Draft-07 for monster configuration
  - `MonsterDefinition` - Complete monster with stats, behavior, tags, resistances, tier/trait refs
  - `NameGenerator` - Procedural name generation with prefixes, suffixes, and title format
  - `EmbeddedLootTable` - Inline loot table with entries and currency drops
  - `LootEntry` - Single item drop with weight, quantity, and drop chance
  - `CurrencyDrop` - Currency (gold) drop with amount range and drop chance
  - `LevelRange` - Spawn level restrictions (min/max player level)

### AI Behavior Patterns
| Behavior | Description | Target Selection |
|----------|-------------|------------------|
| `Aggressive` | Attacks strongest target, pursues relentlessly | Highest threat/damage |
| `Defensive` | Protects allies, uses defensive abilities | Closest ally in danger |
| `Cowardly` | Flees when low HP, avoids strong enemies | Weakest or none (flee) |
| `Support` | Heals allies, buffs, stays behind front line | Lowest HP ally |
| `Chaotic` | Random target selection, unpredictable | Random |
| `Tactical` | Prioritizes weak targets, uses abilities strategically | Lowest HP enemy |

### Validation Rules
| Property | Constraint | Description |
|----------|------------|-------------|
| `id` | `^[a-z][a-z0-9_]*$` | Lowercase with underscores |
| `baseHealth` | >= 1 | Minimum 1 hit point |
| `baseAttack` | >= 0 | Non-negative attack power |
| `baseDefense` | >= 0 | Non-negative defense value |
| `experienceValue` | >= 0 | Non-negative XP reward |
| `behavior` | Enum | 6 AI behavior patterns |
| `tags` | Array (minItems: 1) | At least one type tag |
| `baseResistances.*` | -100 to 100 | Weakness to immunity range |
| `possibleTiers` | Array (minItems: 1) | At least one tier reference |
| `dropChance` | 0.0-1.0 | Probability range |
| `weight` | >= 1 | Positive selection weight |
| `minQuantity/maxQuantity` | >= 1 | Positive quantity |

### Configuration Updates
- **[config/monsters.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/monsters.json)** - Added `$schema` reference
  - Existing 5 monsters validate successfully:
    - `goblin` - Cowardly humanoid with basic loot
    - `skeleton` - Aggressive undead with resistances (poison immune, fire weak)
    - `orc` - Aggressive humanoid with better loot
    - `goblin_shaman` - Support humanoid with healing ability
    - `slime` - Chaotic ooze with physical resistance

### Unit Tests
- **[MonstersSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/MonstersSchemaTests.cs)** - 7 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (6 definitions)
  - `ExistingMonstersJson_ValidatesAgainstSchema` - Backwards compatibility (5 monsters)
  - `BaseHealth_LessThanOne_FailsValidation` - Health range validation
  - `Behavior_InvalidEnumValue_FailsValidation` - Behavior enum validation
  - `Resistance_OutOfRange_FailsValidation` - Resistance range validation
  - `EmbeddedLootTable_ValidStructure_PassesValidation` - Loot table structure
  - `LootEntry_DropChanceOutOfRange_FailsValidation` - Drop chance range validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/monsters.schema.json` | Added |
| `config/monsters.json` | Modified (added $schema reference) |
| `tests/.../Schemas/MonstersSchemaTests.cs` | Added |
| `changelogs/v0.14.3a-changelog.md` | Added |

## Test Results

```
Test summary: total: 7, failed: 0, succeeded: 7, skipped: 0
Build succeeded with 0 errors
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Add new monster types by adding entries to `monsters.json`
- Configure AI behavior patterns without code changes
- Set up damage resistances and weaknesses per monster
- Define custom name generation rules for variety
- Create embedded loot tables with weighted drops
- Restrict monster spawns by player level range
- Reference abilities, biomes, tiers, and traits by ID

---

*Part of v0.14.3 Monster Configuration Schemas series. See also: v0.14.3b (Trait Schema), v0.14.3c (Tier Schema), v0.14.3d (Boss Schema).*
