# v0.3.0a Design Specification: Quest Entity & Objectives

## Overview

**Version:** 0.3.0a
**Parent:** v0.3.0 (Quest Foundation)
**Prerequisites:** v0.2.2 Complete (Merchant System)
**Status:** Design Complete
**Estimated Unit Tests:** ~25

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Data Models](#5-data-models)
6. [Configuration Schemas](#6-configuration-schemas)
7. [Service Specifications](#7-service-specifications)
8. [User-Facing Changes](#8-user-facing-changes)
9. [Logging Requirements](#9-logging-requirements)
10. [Unit Test Specifications](#10-unit-test-specifications)
11. [Use Cases](#11-use-cases)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

This phase establishes the foundational quest data model that enables players to accept, track, and complete objectives. The Quest and QuestObjective entities form the core of the quest system, with QuestDefinition providing data-driven quest templates loaded from configuration files.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Entities** | Quest, QuestObjective |
| **Definitions** | QuestDefinition, ObjectiveDefinition |
| **Value Objects** | ObjectiveTarget, ObjectiveProgress |
| **Enums** | QuestStatus, ObjectiveType |
| **Player Updates** | ActiveQuests, CompletedQuests collections |
| **Configuration** | quests.json, quests.schema.json |
| **Tests** | ~25 new unit tests |

### Architectural Significance

This version establishes the **quest tracking pattern** that will be extended throughout future versions:
- Quests as player-owned entities with objectives and status
- Definition-based quest creation from configuration
- Objective-based progress tracking with counts
- Foundation for quest journal (v0.3.0b), progress tracking (v0.3.0c), and rewards (v0.3.1)

---

## 2. Feature Overview

```
v0.3.0a Features
├── Quest Entity
│   ├── Identity (Id, DefinitionId, Name)
│   ├── Status tracking (QuestStatus enum)
│   ├── Objective collection
│   ├── NPC references (GiverNpcId, TurnInNpcId)
│   └── Timestamps (AcceptedAt, CompletedAt)
├── QuestObjective Entity
│   ├── Type classification (ObjectiveType enum)
│   ├── Target specification (ObjectiveTarget)
│   ├── Progress tracking (CurrentCount, RequiredCount)
│   └── Optional/Hidden flags
├── Quest Configuration
│   ├── QuestDefinition entity
│   ├── ObjectiveDefinition entity
│   ├── quests.json configuration file
│   └── quests.schema.json validation schema
└── Player Integration
    ├── ActiveQuests collection
    ├── CompletedQuests collection
    ├── AcceptQuest method
    ├── CompleteQuest method
    ├── GetQuest method
    └── HasQuest method
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRESENTATION LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  [No changes in v0.3.0a - Journal UI in v0.3.0b]                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    IConfigurationProvider (updated)              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + LoadQuestDefinitions() : IReadOnlyList<QuestDefinition>       │   │
│  │ + GetQuestDefinition(id) : QuestDefinition?                     │   │
│  │ + GetQuestDefinitions() : IReadOnlyList<QuestDefinition>        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ENTITIES                                                               │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │         Quest          │  │    QuestObjective      │                │
│  ├────────────────────────┤  ├────────────────────────┤                │
│  │ + Id: Guid             │  │ + Id: Guid             │                │
│  │ + DefinitionId: string │  │ + QuestId: Guid        │                │
│  │ + Name: string         │  │ + Type: ObjectiveType  │                │
│  │ + Description: string  │  │ + Description: string  │                │
│  │ + Status: QuestStatus  │  │ + Target: ObjectiveTgt │                │
│  │ + PlayerId: Guid       │  │ + RequiredCount: int   │                │
│  │ + Objectives: List     │  │ + CurrentCount: int    │                │
│  │ + GiverNpcId: string?  │  │ + IsComplete: bool     │                │
│  │ + TurnInNpcId: string? │  │ + IsOptional: bool     │                │
│  │ + AcceptedAt: DateTime?│  │ + IsHidden: bool       │                │
│  │ + CompletedAt: DateTime│  │ + Order: int           │                │
│  │ + Hint: string?        │  └────────────────────────┘                │
│  └────────────────────────┘                                            │
│                                                                         │
│  DEFINITIONS                                                            │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │    QuestDefinition     │  │  ObjectiveDefinition   │                │
│  ├────────────────────────┤  ├────────────────────────┤                │
│  │ + Id: string           │  │ + Type: ObjectiveType  │                │
│  │ + Name: string         │  │ + Description: string  │                │
│  │ + Description: string  │  │ + Target: ObjectiveTgt │                │
│  │ + Objectives: List     │  │ + RequiredCount: int   │                │
│  │ + GiverNpcId: string?  │  │ + IsOptional: bool     │                │
│  │ + TurnInNpcId: string? │  │ + IsHidden: bool       │                │
│  │ + Hint: string?        │  │ + Order: int           │                │
│  │ + AutoActivate: bool   │  └────────────────────────┘                │
│  └────────────────────────┘                                            │
│                                                                         │
│  ENUMS                                                                  │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │      QuestStatus       │  │    ObjectiveType       │                │
│  ├────────────────────────┤  ├────────────────────────┤                │
│  │ Available              │  │ Kill                   │                │
│  │ Active                 │  │ Collect                │                │
│  │ Completed              │  │ Explore                │                │
│  │ Failed                 │  │ Talk                   │                │
│  └────────────────────────┘  │ Deliver                │                │
│                              │ Use                    │                │
│                              │ Custom                 │                │
│                              └────────────────────────┘                │
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌────────────────────────┐                                            │
│  │    ObjectiveTarget     │                                            │
│  ├────────────────────────┤                                            │
│  │ + TargetId: string     │                                            │
│  │ + DisplayName: string  │                                            │
│  │ + LocationHint: string?│                                            │
│  │ + AnyOfType: bool      │                                            │
│  │ + TargetType: string?  │                                            │
│  └────────────────────────┘                                            │
│                                                                         │
│  PLAYER UPDATES                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                          Player                                  │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + ActiveQuests: IReadOnlyList<Quest>                // NEW      │   │
│  │ + CompletedQuests: IReadOnlyList<Quest>             // NEW      │   │
│  │ + AcceptQuest(Quest quest): bool                    // NEW      │   │
│  │ + CompleteQuest(Guid questId): Quest?               // NEW      │   │
│  │ + GetQuest(Guid questId): Quest?                    // NEW      │   │
│  │ + GetActiveQuestCount(): int                        // NEW      │   │
│  │ + HasQuest(string definitionId): bool               // NEW      │   │
│  │ + HasActiveQuest(string definitionId): bool         // NEW      │   │
│  │ + FailQuest(Guid questId): bool                     // NEW      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                IConfigurationProvider (updated)                  │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + LoadQuestDefinitions() : IReadOnlyList<QuestDefinition>       │   │
│  │ + GetQuestDefinition(string id) : QuestDefinition?              │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Configuration Files:                                                   │
│  ├── config/quests.json                                                │
│  └── config/schemas/quests.schema.json                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Quest Creation Flow

```
┌───────────────────┐
│ QuestDefinition   │
│ (from config)     │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐      ┌───────────────────┐
│   Quest.Create()  │─────▶│   Quest Entity    │
│   Factory Method  │      │   (new instance)  │
└───────────────────┘      └─────────┬─────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    │                │                │
                    ▼                ▼                ▼
           ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
           │ Objective 1 │  │ Objective 2 │  │ Objective N │
           │ (from def)  │  │ (from def)  │  │ (from def)  │
           └─────────────┘  └─────────────┘  └─────────────┘
```

### 3.3 Quest Status Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        QUEST STATUS FLOW                                │
└─────────────────────────────────────────────────────────────────────────┘

    Quest Created
         │
         ▼
┌─────────────────┐
│    Available    │ ◄── Initial state when quest is offered
└────────┬────────┘
         │
         │ Accept()
         ▼
┌─────────────────┐
│     Active      │ ◄── Player is working on quest
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌────────┐
│Complete│ │ Fail() │
│  ()    │ └────┬───┘
└────┬───┘      │
     │          ▼
     │    ┌──────────┐
     │    │  Failed  │ ◄── Quest cannot be completed
     │    └──────────┘
     ▼
┌──────────┐
│Completed │ ◄── All objectives done, quest turned in
└──────────┘
```

### 3.4 Player-Quest Relationship

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              PLAYER                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Existing Collections:                                                  │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │  Resources   │  │  Abilities   │  │   Currency   │                  │
│  │Dict<str,Pool>│  │Dict<str,Abil>│  │Dict<str,int> │                  │
│  └──────────────┘  └──────────────┘  └──────────────┘                  │
│                                                                         │
│  NEW Collections:                                                       │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                        ActiveQuests                               │  │
│  │                      List<Quest>                                  │  │
│  ├──────────────────────────────────────────────────────────────────┤  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                           │  │
│  │  │  Quest  │  │  Quest  │  │  Quest  │                           │  │
│  │  │ Goblin  │  │ Heirloom│  │ Mapping │                           │  │
│  │  │  Menace │  │  Lost   │  │ Depths  │                           │  │
│  │  │  60%    │  │  100%   │  │  33%    │                           │  │
│  │  └─────────┘  └─────────┘  └─────────┘                           │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                       CompletedQuests                             │  │
│  │                      List<Quest>                                  │  │
│  ├──────────────────────────────────────────────────────────────────┤  │
│  │  ┌─────────┐  ┌─────────┐                                        │  │
│  │  │  Quest  │  │  Quest  │                                        │  │
│  │  │  Intro  │  │ Cleared │                                        │  │
│  │  │ Quest   │  │ Entrance│                                        │  │
│  │  └─────────┘  └─────────┘                                        │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
│  Methods:                                                               │
│  ├── AcceptQuest(Quest quest): bool                                    │
│  ├── CompleteQuest(Guid questId): Quest?                               │
│  ├── GetQuest(Guid questId): Quest?                                    │
│  ├── GetActiveQuestCount(): int                                        │
│  ├── HasQuest(string definitionId): bool                               │
│  ├── HasActiveQuest(string definitionId): bool                         │
│  └── FailQuest(Guid questId): bool                                     │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. User Stories

### US-3.0a-1: Create Quest from Definition
**As a** game system
**I want to** create quest instances from definitions
**So that** quests can be data-driven and configurable

**Acceptance Criteria:**
- Quest can be created from QuestDefinition
- All objectives are created from ObjectiveDefinitions
- Quest starts in Available status
- Quest stores player ID and giver NPC ID

### US-3.0a-2: Track Objective Progress
**As a** game system
**I want to** track progress on quest objectives
**So that** the game knows when objectives are complete

**Acceptance Criteria:**
- Objectives have current and required counts
- IncrementProgress() increases current count
- IsComplete is true when current >= required
- Progress cannot exceed required count

### US-3.0a-3: Accept Quest
**As a** player
**I want to** accept quests from NPCs
**So that** I can track my objectives

**Acceptance Criteria:**
- Quest status changes from Available to Active
- AcceptedAt timestamp is set
- Player's ActiveQuests collection is updated
- Cannot accept an already active quest

### US-3.0a-4: Complete Quest
**As a** player
**I want to** complete quests when all objectives are done
**So that** I can receive rewards

**Acceptance Criteria:**
- Quest can only complete when all non-optional objectives are done
- Quest status changes from Active to Completed
- CompletedAt timestamp is set
- Quest moves from ActiveQuests to CompletedQuests

### US-3.0a-5: Configure Quests via JSON
**As a** game designer
**I want to** define quests in configuration files
**So that** I can create and modify quests without code changes

**Acceptance Criteria:**
- Quests can be defined in quests.json
- Objectives can be configured with types and targets
- Invalid configuration produces clear error messages

---

## 5. Data Models

### 5.1 Quest Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a quest that the player can undertake.
/// </summary>
/// <remarks>
/// Quests are created from QuestDefinition templates and track the player's
/// progress toward completing objectives. Each quest instance is unique to
/// a player and maintains its own status and objective progress.
/// </remarks>
public class Quest : IEntity
{
    /// <summary>
    /// Gets the unique identifier for this quest instance.
    /// </summary>
    public Guid Id { get; private set; }

    /// <summary>
    /// Gets the quest's definition ID for configuration lookup.
    /// </summary>
    /// <example>"goblin-menace", "lost-heirloom"</example>
    public string DefinitionId { get; private set; } = string.Empty;

    /// <summary>
    /// Gets the quest's display name.
    /// </summary>
    /// <example>"The Goblin Menace", "The Lost Heirloom"</example>
    public string Name { get; private set; } = string.Empty;

    /// <summary>
    /// Gets the quest's description.
    /// </summary>
    /// <remarks>
    /// A narrative description of the quest's backstory and purpose.
    /// </remarks>
    public string Description { get; private set; } = string.Empty;

    /// <summary>
    /// Gets the current status of the quest.
    /// </summary>
    public QuestStatus Status { get; private set; }

    /// <summary>
    /// Gets the player who owns this quest instance.
    /// </summary>
    public Guid PlayerId { get; private set; }

    /// <summary>
    /// Backing field for objectives collection.
    /// </summary>
    private readonly List<QuestObjective> _objectives = [];

    /// <summary>
    /// Gets the objectives for this quest.
    /// </summary>
    public IReadOnlyList<QuestObjective> Objectives => _objectives.AsReadOnly();

    /// <summary>
    /// Gets the NPC ID who gave this quest.
    /// </summary>
    /// <remarks>
    /// Null if the quest was auto-assigned or started by event.
    /// </remarks>
    public string? GiverNpcId { get; private set; }

    /// <summary>
    /// Gets the NPC ID to turn in this quest.
    /// </summary>
    /// <remarks>
    /// Defaults to GiverNpcId if not specified. Null for auto-complete quests.
    /// </remarks>
    public string? TurnInNpcId { get; private set; }

    /// <summary>
    /// Gets when the quest was accepted.
    /// </summary>
    /// <remarks>
    /// Null if the quest is still in Available status.
    /// </remarks>
    public DateTime? AcceptedAt { get; private set; }

    /// <summary>
    /// Gets when the quest was completed.
    /// </summary>
    /// <remarks>
    /// Null if the quest has not been completed.
    /// </remarks>
    public DateTime? CompletedAt { get; private set; }

    /// <summary>
    /// Gets brief instructions or hints for the quest.
    /// </summary>
    /// <remarks>
    /// Provides guidance to the player on where to go or what to do.
    /// </remarks>
    public string? Hint { get; private set; }

    /// <summary>
    /// Private constructor for EF Core.
    /// </summary>
    private Quest() { }

    /// <summary>
    /// Creates a new quest from a definition.
    /// </summary>
    /// <param name="definition">The quest definition to create from.</param>
    /// <param name="playerId">The player who will own this quest.</param>
    /// <param name="giverNpcId">Optional NPC ID who gave the quest.</param>
    /// <returns>A new Quest instance.</returns>
    /// <exception cref="ArgumentNullException">Thrown if definition is null.</exception>
    public static Quest Create(
        QuestDefinition definition,
        Guid playerId,
        string? giverNpcId = null)
    {
        ArgumentNullException.ThrowIfNull(definition);

        var quest = new Quest
        {
            Id = Guid.NewGuid(),
            DefinitionId = definition.Id,
            Name = definition.Name,
            Description = definition.Description,
            Status = QuestStatus.Available,
            PlayerId = playerId,
            GiverNpcId = giverNpcId ?? definition.GiverNpcId,
            TurnInNpcId = definition.TurnInNpcId ?? giverNpcId ?? definition.GiverNpcId,
            Hint = definition.Hint
        };

        // Create objectives from definition
        foreach (var objectiveDef in definition.Objectives)
        {
            var objective = QuestObjective.Create(objectiveDef, quest.Id);
            quest._objectives.Add(objective);
        }

        return quest;
    }

    /// <summary>
    /// Accepts the quest, changing status to Active.
    /// </summary>
    /// <returns>True if the quest was accepted, false if it cannot be accepted.</returns>
    /// <remarks>
    /// Quest can only be accepted if it is in Available status.
    /// </remarks>
    public bool Accept()
    {
        if (Status != QuestStatus.Available)
            return false;

        Status = QuestStatus.Active;
        AcceptedAt = DateTime.UtcNow;
        return true;
    }

    /// <summary>
    /// Checks if all required objectives are complete.
    /// </summary>
    /// <returns>True if all non-optional objectives are complete.</returns>
    public bool AreAllObjectivesComplete()
    {
        return _objectives
            .Where(o => !o.IsOptional)
            .All(o => o.IsComplete);
    }

    /// <summary>
    /// Checks if the quest can be turned in.
    /// </summary>
    /// <returns>True if the quest is active and all objectives are complete.</returns>
    public bool CanTurnIn()
    {
        return Status == QuestStatus.Active && AreAllObjectivesComplete();
    }

    /// <summary>
    /// Completes the quest.
    /// </summary>
    /// <returns>True if the quest was completed, false if it cannot be completed.</returns>
    /// <remarks>
    /// Quest can only be completed if it is Active and all objectives are done.
    /// </remarks>
    public bool Complete()
    {
        if (Status != QuestStatus.Active)
            return false;

        if (!AreAllObjectivesComplete())
            return false;

        Status = QuestStatus.Completed;
        CompletedAt = DateTime.UtcNow;
        return true;
    }

    /// <summary>
    /// Fails the quest.
    /// </summary>
    /// <param name="reason">Optional reason for failure (for logging).</param>
    /// <returns>True if the quest was failed, false if already completed.</returns>
    /// <remarks>
    /// Completed quests cannot be failed.
    /// </remarks>
    public bool Fail(string? reason = null)
    {
        if (Status == QuestStatus.Completed)
            return false;

        Status = QuestStatus.Failed;
        return true;
    }

    /// <summary>
    /// Gets the overall progress percentage.
    /// </summary>
    /// <returns>Progress as 0-100 integer.</returns>
    /// <remarks>
    /// Calculated as average of all non-optional objective progress.
    /// </remarks>
    public int GetProgressPercent()
    {
        var requiredObjectives = _objectives.Where(o => !o.IsOptional).ToList();
        if (requiredObjectives.Count == 0) return 100;

        var totalProgress = requiredObjectives.Sum(o => o.GetProgressPercent());
        return totalProgress / requiredObjectives.Count;
    }

    /// <summary>
    /// Gets an objective by ID.
    /// </summary>
    /// <param name="objectiveId">The objective ID to find.</param>
    /// <returns>The objective, or null if not found.</returns>
    public QuestObjective? GetObjective(Guid objectiveId)
    {
        return _objectives.FirstOrDefault(o => o.Id == objectiveId);
    }

    /// <summary>
    /// Gets an objective by its order index.
    /// </summary>
    /// <param name="order">The order index.</param>
    /// <returns>The objective, or null if not found.</returns>
    public QuestObjective? GetObjectiveByOrder(int order)
    {
        return _objectives.FirstOrDefault(o => o.Order == order);
    }

    /// <summary>
    /// Gets all incomplete objectives.
    /// </summary>
    /// <returns>Enumerable of incomplete objectives.</returns>
    public IEnumerable<QuestObjective> GetIncompleteObjectives()
    {
        return _objectives.Where(o => !o.IsComplete && !o.IsHidden);
    }

    /// <summary>
    /// Gets the count of completed objectives.
    /// </summary>
    /// <returns>Number of completed objectives.</returns>
    public int GetCompletedObjectiveCount()
    {
        return _objectives.Count(o => o.IsComplete);
    }
}
```

### 5.2 QuestStatus Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the current status of a quest.
/// </summary>
/// <remarks>
/// Quests progress through these states: Available → Active → Completed/Failed.
/// </remarks>
public enum QuestStatus
{
    /// <summary>
    /// Quest is available to accept but not yet started.
    /// </summary>
    /// <remarks>
    /// The player has been offered the quest but hasn't committed to it.
    /// </remarks>
    Available,

    /// <summary>
    /// Quest has been accepted and is in progress.
    /// </summary>
    /// <remarks>
    /// The player is actively working on the quest objectives.
    /// </remarks>
    Active,

    /// <summary>
    /// Quest has been completed successfully.
    /// </summary>
    /// <remarks>
    /// All required objectives were completed and the quest was turned in.
    /// </remarks>
    Completed,

    /// <summary>
    /// Quest has failed and cannot be completed.
    /// </summary>
    /// <remarks>
    /// The quest failed due to a time limit, event, or player action.
    /// Failed quests may or may not be restartable depending on the quest.
    /// </remarks>
    Failed
}
```

### 5.3 QuestObjective Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a single objective within a quest.
/// </summary>
/// <remarks>
/// Objectives track progress toward specific goals such as killing monsters,
/// collecting items, or visiting locations. Each objective has a required
/// count and tracks current progress.
/// </remarks>
public class QuestObjective : IEntity
{
    /// <summary>
    /// Gets the unique identifier for this objective.
    /// </summary>
    public Guid Id { get; private set; }

    /// <summary>
    /// Gets the parent quest ID.
    /// </summary>
    public Guid QuestId { get; private set; }

    /// <summary>
    /// Gets the objective type.
    /// </summary>
    public ObjectiveType Type { get; private set; }

    /// <summary>
    /// Gets the objective's description.
    /// </summary>
    /// <example>"Defeat goblins", "Find the Golden Locket"</example>
    public string Description { get; private set; } = string.Empty;

    /// <summary>
    /// Gets the target for this objective.
    /// </summary>
    /// <remarks>
    /// Specifies what the player needs to interact with (monster, item, location, NPC).
    /// </remarks>
    public ObjectiveTarget Target { get; private set; }

    /// <summary>
    /// Gets the required count to complete this objective.
    /// </summary>
    /// <remarks>
    /// For single-target objectives (explore, talk), this is typically 1.
    /// For kill/collect objectives, this may be higher.
    /// </remarks>
    public int RequiredCount { get; private set; }

    /// <summary>
    /// Gets the current progress count.
    /// </summary>
    public int CurrentCount { get; private set; }

    /// <summary>
    /// Gets whether this objective is complete.
    /// </summary>
    public bool IsComplete => CurrentCount >= RequiredCount;

    /// <summary>
    /// Gets whether this objective is optional.
    /// </summary>
    /// <remarks>
    /// Optional objectives do not need to be completed to turn in the quest.
    /// They may provide bonus rewards.
    /// </remarks>
    public bool IsOptional { get; private set; }

    /// <summary>
    /// Gets whether this objective is hidden until discovered.
    /// </summary>
    /// <remarks>
    /// Hidden objectives are not shown in the journal until revealed
    /// by game events or partial progress.
    /// </remarks>
    public bool IsHidden { get; private set; }

    /// <summary>
    /// Gets the display order for this objective.
    /// </summary>
    /// <remarks>
    /// Objectives are displayed in ascending order. Use this to control
    /// the narrative flow of quest steps.
    /// </remarks>
    public int Order { get; private set; }

    /// <summary>
    /// Private constructor for EF Core.
    /// </summary>
    private QuestObjective() { }

    /// <summary>
    /// Creates an objective from a definition.
    /// </summary>
    /// <param name="definition">The objective definition.</param>
    /// <param name="questId">The parent quest ID.</param>
    /// <returns>A new QuestObjective instance.</returns>
    /// <exception cref="ArgumentNullException">Thrown if definition is null.</exception>
    public static QuestObjective Create(
        ObjectiveDefinition definition,
        Guid questId)
    {
        ArgumentNullException.ThrowIfNull(definition);

        return new QuestObjective
        {
            Id = Guid.NewGuid(),
            QuestId = questId,
            Type = definition.Type,
            Description = definition.Description,
            Target = definition.Target,
            RequiredCount = definition.RequiredCount,
            CurrentCount = 0,
            IsOptional = definition.IsOptional,
            IsHidden = definition.IsHidden,
            Order = definition.Order
        };
    }

    /// <summary>
    /// Increments progress toward this objective.
    /// </summary>
    /// <param name="amount">The amount to increment (default 1).</param>
    /// <returns>True if progress was made, false if already complete.</returns>
    /// <remarks>
    /// Progress is capped at RequiredCount.
    /// </remarks>
    public bool IncrementProgress(int amount = 1)
    {
        if (IsComplete) return false;

        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(amount);

        CurrentCount = Math.Min(CurrentCount + amount, RequiredCount);
        return true;
    }

    /// <summary>
    /// Sets the progress to a specific value.
    /// </summary>
    /// <param name="count">The count to set.</param>
    /// <remarks>
    /// Useful for objectives that can decrease (e.g., collected items that can be lost).
    /// Value is clamped between 0 and RequiredCount.
    /// </remarks>
    public void SetProgress(int count)
    {
        CurrentCount = Math.Clamp(count, 0, RequiredCount);
    }

    /// <summary>
    /// Reveals a hidden objective.
    /// </summary>
    /// <remarks>
    /// Once revealed, an objective cannot be hidden again.
    /// </remarks>
    public void Reveal()
    {
        IsHidden = false;
    }

    /// <summary>
    /// Gets the progress percentage.
    /// </summary>
    /// <returns>Progress as 0-100 integer.</returns>
    public int GetProgressPercent()
    {
        if (RequiredCount == 0) return 100;
        return (CurrentCount * 100) / RequiredCount;
    }

    /// <summary>
    /// Gets a formatted progress string.
    /// </summary>
    /// <returns>A display string like "(3/5)" or "[Complete]".</returns>
    public string GetProgressString()
    {
        if (RequiredCount == 1)
            return IsComplete ? "[Complete]" : "[Incomplete]";

        return $"({CurrentCount}/{RequiredCount})";
    }

    /// <summary>
    /// Gets a full display string including description.
    /// </summary>
    /// <returns>A display string like "Defeat goblins (3/5)".</returns>
    public string ToDisplayString()
    {
        var checkmark = IsComplete ? "\u2713 " : "\u2022 ";
        return $"{checkmark}{Description} {GetProgressString()}";
    }
}
```

### 5.4 ObjectiveType Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the types of quest objectives.
/// </summary>
/// <remarks>
/// Objective types determine what game events trigger progress updates.
/// </remarks>
public enum ObjectiveType
{
    /// <summary>
    /// Defeat a specific number of enemies.
    /// </summary>
    /// <remarks>
    /// Triggered when a monster matching the target is defeated.
    /// </remarks>
    Kill,

    /// <summary>
    /// Collect specific items.
    /// </summary>
    /// <remarks>
    /// Triggered when an item matching the target is picked up.
    /// </remarks>
    Collect,

    /// <summary>
    /// Visit a specific location.
    /// </summary>
    /// <remarks>
    /// Triggered when the player enters a room matching the target.
    /// </remarks>
    Explore,

    /// <summary>
    /// Talk to a specific NPC.
    /// </summary>
    /// <remarks>
    /// Triggered when dialogue is completed with an NPC matching the target.
    /// </remarks>
    Talk,

    /// <summary>
    /// Deliver an item to an NPC.
    /// </summary>
    /// <remarks>
    /// Triggered when a specific item is given to a specific NPC.
    /// Requires both item and NPC to match.
    /// </remarks>
    Deliver,

    /// <summary>
    /// Use a specific item or ability.
    /// </summary>
    /// <remarks>
    /// Triggered when the target item is used or ability is activated.
    /// </remarks>
    Use,

    /// <summary>
    /// Custom objective with manual completion.
    /// </summary>
    /// <remarks>
    /// Progress is set programmatically by game events.
    /// Used for complex objectives that don't fit other types.
    /// </remarks>
    Custom
}
```

### 5.5 ObjectiveTarget Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines the target for a quest objective.
/// </summary>
/// <remarks>
/// Targets can be specific (a particular monster, item, or location) or
/// generic (any monster of a type). This supports both "Kill Gornak the Troll"
/// and "Kill 5 goblins" style objectives.
/// </remarks>
public readonly record struct ObjectiveTarget
{
    /// <summary>
    /// Gets the specific target ID.
    /// </summary>
    /// <remarks>
    /// For specific targets: monster ID, item ID, room ID, NPC ID.
    /// Empty for "any of type" targets.
    /// </remarks>
    /// <example>"goblin-chief", "item-golden-locket", "room-grand-hall"</example>
    public string TargetId { get; init; }

    /// <summary>
    /// Gets the display name for the target.
    /// </summary>
    /// <example>"Goblins", "Golden Locket", "Grand Hall"</example>
    public string DisplayName { get; init; }

    /// <summary>
    /// Gets an optional location hint.
    /// </summary>
    /// <remarks>
    /// Provides guidance on where to find the target.
    /// </remarks>
    /// <example>"Last seen in the storage rooms"</example>
    public string? LocationHint { get; init; }

    /// <summary>
    /// Gets whether any target of the type counts.
    /// </summary>
    /// <remarks>
    /// When true, any entity matching TargetType counts toward progress.
    /// When false, only the specific TargetId matches.
    /// </remarks>
    public bool AnyOfType { get; init; }

    /// <summary>
    /// Gets the target type for "any of type" matching.
    /// </summary>
    /// <remarks>
    /// Used when AnyOfType is true. Matches against entity type/category.
    /// </remarks>
    /// <example>"goblin", "undead", "potion"</example>
    public string? TargetType { get; init; }

    /// <summary>
    /// Creates a target for a specific entity.
    /// </summary>
    /// <param name="id">The entity ID.</param>
    /// <param name="displayName">Display name for the target.</param>
    /// <param name="locationHint">Optional location hint.</param>
    /// <returns>A new ObjectiveTarget for a specific entity.</returns>
    public static ObjectiveTarget Specific(string id, string displayName, string? locationHint = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);

        return new ObjectiveTarget
        {
            TargetId = id.ToLowerInvariant(),
            DisplayName = displayName,
            LocationHint = locationHint,
            AnyOfType = false,
            TargetType = null
        };
    }

    /// <summary>
    /// Creates a target for any entity of a type.
    /// </summary>
    /// <param name="targetType">The entity type to match.</param>
    /// <param name="displayName">Display name for the target type.</param>
    /// <returns>A new ObjectiveTarget for any entity of the type.</returns>
    public static ObjectiveTarget Any(string targetType, string displayName)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(targetType);
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);

        return new ObjectiveTarget
        {
            TargetId = string.Empty,
            DisplayName = displayName,
            AnyOfType = true,
            TargetType = targetType.ToLowerInvariant(),
            LocationHint = null
        };
    }

    /// <summary>
    /// Creates an empty target for custom objectives.
    /// </summary>
    /// <param name="displayName">Display name for the objective.</param>
    /// <returns>A new ObjectiveTarget with no specific target.</returns>
    public static ObjectiveTarget None(string displayName)
    {
        return new ObjectiveTarget
        {
            TargetId = string.Empty,
            DisplayName = displayName,
            AnyOfType = false,
            TargetType = null,
            LocationHint = null
        };
    }

    /// <summary>
    /// Checks if a given entity matches this target.
    /// </summary>
    /// <param name="id">The entity ID to check.</param>
    /// <param name="type">Optional entity type for "any of type" matching.</param>
    /// <returns>True if the entity matches this target.</returns>
    public bool Matches(string id, string? type = null)
    {
        if (AnyOfType)
        {
            return !string.IsNullOrEmpty(type) &&
                   TargetType?.Equals(type, StringComparison.OrdinalIgnoreCase) == true;
        }

        return !string.IsNullOrEmpty(TargetId) &&
               TargetId.Equals(id, StringComparison.OrdinalIgnoreCase);
    }
}
```

### 5.6 QuestDefinition Entity

```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Configuration template for creating quests.
/// </summary>
/// <remarks>
/// QuestDefinitions are loaded from configuration files and used as templates
/// to create Quest instances. They define the base properties, objectives,
/// and metadata for a quest type.
/// </remarks>
public class QuestDefinition
{
    /// <summary>
    /// Gets the unique identifier.
    /// </summary>
    /// <example>"goblin-menace", "lost-heirloom", "dungeon-survey"</example>
    public string Id { get; private set; } = string.Empty;

    /// <summary>
    /// Gets the quest's display name.
    /// </summary>
    /// <example>"The Goblin Menace"</example>
    public string Name { get; private set; } = string.Empty;

    /// <summary>
    /// Gets the quest's description.
    /// </summary>
    /// <remarks>
    /// A narrative description shown in the quest journal.
    /// </remarks>
    public string Description { get; private set; } = string.Empty;

    /// <summary>
    /// Backing field for objectives collection.
    /// </summary>
    private readonly List<ObjectiveDefinition> _objectives = [];

    /// <summary>
    /// Gets the objective definitions.
    /// </summary>
    public IReadOnlyList<ObjectiveDefinition> Objectives => _objectives.AsReadOnly();

    /// <summary>
    /// Gets the NPC ID who gives this quest.
    /// </summary>
    /// <remarks>
    /// Null if the quest can be obtained multiple ways.
    /// </remarks>
    public string? GiverNpcId { get; private set; }

    /// <summary>
    /// Gets the NPC ID for turn-in.
    /// </summary>
    /// <remarks>
    /// Defaults to GiverNpcId if not specified. Null for auto-complete quests.
    /// </remarks>
    public string? TurnInNpcId { get; private set; }

    /// <summary>
    /// Gets hints or instructions.
    /// </summary>
    /// <remarks>
    /// Guidance shown in the quest journal.
    /// </remarks>
    public string? Hint { get; private set; }

    /// <summary>
    /// Gets whether this quest auto-activates on acceptance.
    /// </summary>
    /// <remarks>
    /// When true, quest goes directly to Active status.
    /// When false, quest stays in Available until explicitly activated.
    /// </remarks>
    public bool AutoActivate { get; private set; } = true;

    /// <summary>
    /// Private constructor for deserialization.
    /// </summary>
    private QuestDefinition() { }

    /// <summary>
    /// Creates a quest definition.
    /// </summary>
    /// <param name="id">Unique identifier.</param>
    /// <param name="name">Display name.</param>
    /// <param name="description">Quest description.</param>
    /// <param name="objectives">Objective definitions.</param>
    /// <param name="giverNpcId">Optional giver NPC ID.</param>
    /// <param name="turnInNpcId">Optional turn-in NPC ID.</param>
    /// <param name="hint">Optional hint text.</param>
    /// <param name="autoActivate">Whether to auto-activate (default true).</param>
    /// <returns>A new QuestDefinition instance.</returns>
    /// <exception cref="ArgumentException">Thrown if required fields are null or empty.</exception>
    public static QuestDefinition Create(
        string id,
        string name,
        string description,
        IEnumerable<ObjectiveDefinition> objectives,
        string? giverNpcId = null,
        string? turnInNpcId = null,
        string? hint = null,
        bool autoActivate = true)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);
        ArgumentNullException.ThrowIfNull(objectives);

        var definition = new QuestDefinition
        {
            Id = id.ToLowerInvariant(),
            Name = name,
            Description = description,
            GiverNpcId = giverNpcId?.ToLowerInvariant(),
            TurnInNpcId = turnInNpcId?.ToLowerInvariant(),
            Hint = hint,
            AutoActivate = autoActivate
        };

        definition._objectives.AddRange(objectives);

        return definition;
    }
}
```

### 5.7 ObjectiveDefinition Entity

```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Configuration template for quest objectives.
/// </summary>
/// <remarks>
/// ObjectiveDefinitions are contained within QuestDefinitions and describe
/// the goals the player must achieve to complete the quest.
/// </remarks>
public class ObjectiveDefinition
{
    /// <summary>
    /// Gets the objective type.
    /// </summary>
    public ObjectiveType Type { get; init; }

    /// <summary>
    /// Gets the objective's description.
    /// </summary>
    /// <example>"Defeat goblins", "Find the Golden Locket"</example>
    public string Description { get; init; } = string.Empty;

    /// <summary>
    /// Gets the target specification.
    /// </summary>
    public ObjectiveTarget Target { get; init; }

    /// <summary>
    /// Gets the required count to complete.
    /// </summary>
    /// <remarks>
    /// Default is 1 for single-target objectives.
    /// </remarks>
    public int RequiredCount { get; init; } = 1;

    /// <summary>
    /// Gets whether this objective is optional.
    /// </summary>
    public bool IsOptional { get; init; }

    /// <summary>
    /// Gets whether this objective starts hidden.
    /// </summary>
    public bool IsHidden { get; init; }

    /// <summary>
    /// Gets the display order.
    /// </summary>
    public int Order { get; init; }

    /// <summary>
    /// Creates an objective definition.
    /// </summary>
    public static ObjectiveDefinition Create(
        ObjectiveType type,
        string description,
        ObjectiveTarget target,
        int requiredCount = 1,
        bool isOptional = false,
        bool isHidden = false,
        int order = 0)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(description);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(requiredCount);

        return new ObjectiveDefinition
        {
            Type = type,
            Description = description,
            Target = target,
            RequiredCount = requiredCount,
            IsOptional = isOptional,
            IsHidden = isHidden,
            Order = order
        };
    }
}
```

### 5.8 Player Entity Updates

```csharp
// Additions to existing Player class in RuneAndRust.Domain.Entities

/// <summary>
/// Backing field for active quests collection.
/// </summary>
private readonly List<Quest> _activeQuests = [];

/// <summary>
/// Backing field for completed quests collection.
/// </summary>
private readonly List<Quest> _completedQuests = [];

/// <summary>
/// Gets the player's active quests.
/// </summary>
public IReadOnlyList<Quest> ActiveQuests => _activeQuests.AsReadOnly();

/// <summary>
/// Gets the player's completed quests.
/// </summary>
public IReadOnlyList<Quest> CompletedQuests => _completedQuests.AsReadOnly();

/// <summary>
/// Accepts a quest, adding it to active quests.
/// </summary>
/// <param name="quest">The quest to accept.</param>
/// <returns>True if the quest was accepted, false otherwise.</returns>
/// <exception cref="ArgumentNullException">Thrown if quest is null.</exception>
/// <exception cref="InvalidOperationException">Thrown if quest doesn't belong to this player.</exception>
public bool AcceptQuest(Quest quest)
{
    ArgumentNullException.ThrowIfNull(quest);

    if (quest.PlayerId != Id)
    {
        throw new InvalidOperationException("Quest does not belong to this player.");
    }

    if (HasQuest(quest.DefinitionId))
    {
        return false; // Already have this quest
    }

    if (!quest.Accept())
    {
        return false; // Quest couldn't be accepted
    }

    _activeQuests.Add(quest);
    return true;
}

/// <summary>
/// Completes a quest, moving it from active to completed.
/// </summary>
/// <param name="questId">The ID of the quest to complete.</param>
/// <returns>The completed quest, or null if not found or couldn't complete.</returns>
public Quest? CompleteQuest(Guid questId)
{
    var quest = _activeQuests.FirstOrDefault(q => q.Id == questId);
    if (quest == null)
    {
        return null;
    }

    if (!quest.Complete())
    {
        return null; // Quest couldn't be completed
    }

    _activeQuests.Remove(quest);
    _completedQuests.Add(quest);
    return quest;
}

/// <summary>
/// Fails a quest, removing it from active quests.
/// </summary>
/// <param name="questId">The ID of the quest to fail.</param>
/// <returns>True if the quest was failed, false if not found or already completed.</returns>
public bool FailQuest(Guid questId)
{
    var quest = _activeQuests.FirstOrDefault(q => q.Id == questId);
    if (quest == null)
    {
        return false;
    }

    if (!quest.Fail())
    {
        return false; // Quest couldn't be failed
    }

    _activeQuests.Remove(quest);
    return true;
}

/// <summary>
/// Gets a quest by ID from active or completed quests.
/// </summary>
/// <param name="questId">The quest ID to find.</param>
/// <returns>The quest, or null if not found.</returns>
public Quest? GetQuest(Guid questId)
{
    return _activeQuests.FirstOrDefault(q => q.Id == questId)
           ?? _completedQuests.FirstOrDefault(q => q.Id == questId);
}

/// <summary>
/// Gets an active quest by definition ID.
/// </summary>
/// <param name="definitionId">The quest definition ID.</param>
/// <returns>The active quest, or null if not found.</returns>
public Quest? GetActiveQuestByDefinition(string definitionId)
{
    return _activeQuests.FirstOrDefault(q =>
        q.DefinitionId.Equals(definitionId, StringComparison.OrdinalIgnoreCase));
}

/// <summary>
/// Gets the count of active quests.
/// </summary>
/// <returns>Number of active quests.</returns>
public int GetActiveQuestCount()
{
    return _activeQuests.Count;
}

/// <summary>
/// Checks if the player has a quest (active or completed).
/// </summary>
/// <param name="definitionId">The quest definition ID.</param>
/// <returns>True if the player has this quest.</returns>
public bool HasQuest(string definitionId)
{
    ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);

    return _activeQuests.Any(q =>
               q.DefinitionId.Equals(definitionId, StringComparison.OrdinalIgnoreCase))
           || _completedQuests.Any(q =>
               q.DefinitionId.Equals(definitionId, StringComparison.OrdinalIgnoreCase));
}

/// <summary>
/// Checks if the player has an active quest.
/// </summary>
/// <param name="definitionId">The quest definition ID.</param>
/// <returns>True if the player has this quest active.</returns>
public bool HasActiveQuest(string definitionId)
{
    ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);

    return _activeQuests.Any(q =>
        q.DefinitionId.Equals(definitionId, StringComparison.OrdinalIgnoreCase));
}

/// <summary>
/// Checks if the player has completed a quest.
/// </summary>
/// <param name="definitionId">The quest definition ID.</param>
/// <returns>True if the player has completed this quest.</returns>
public bool HasCompletedQuest(string definitionId)
{
    ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);

    return _completedQuests.Any(q =>
        q.DefinitionId.Equals(definitionId, StringComparison.OrdinalIgnoreCase));
}

/// <summary>
/// Gets all quests ready to turn in.
/// </summary>
/// <returns>Enumerable of completable quests.</returns>
public IEnumerable<Quest> GetCompletableQuests()
{
    return _activeQuests.Where(q => q.CanTurnIn());
}
```

---

## 6. Configuration Schemas

### 6.1 quests.json

```json
{
  "$schema": "../schemas/quests.schema.json",
  "quests": [
    {
      "id": "goblin-menace",
      "name": "The Goblin Menace",
      "description": "The dungeon entrance is overrun with goblins. Clear them out to make the area safe for other adventurers.",
      "giverNpcId": "guard-captain",
      "turnInNpcId": "guard-captain",
      "hint": "Goblins are commonly found in the upper dungeon levels.",
      "autoActivate": true,
      "objectives": [
        {
          "type": "Kill",
          "description": "Defeat goblins",
          "target": {
            "targetType": "goblin",
            "displayName": "Goblins",
            "anyOfType": true
          },
          "requiredCount": 5,
          "isOptional": false,
          "isHidden": false,
          "order": 1
        }
      ]
    },
    {
      "id": "lost-heirloom",
      "name": "The Lost Heirloom",
      "description": "A merchant has lost a family heirloom somewhere in the dungeon. Find and return it.",
      "giverNpcId": "grimbold-trader",
      "turnInNpcId": "grimbold-trader",
      "hint": "The locket was last seen in the storage rooms.",
      "autoActivate": true,
      "objectives": [
        {
          "type": "Collect",
          "description": "Find the Golden Locket",
          "target": {
            "targetId": "item-golden-locket",
            "displayName": "Golden Locket",
            "locationHint": "Last seen in the storage rooms"
          },
          "requiredCount": 1,
          "isOptional": false,
          "isHidden": false,
          "order": 1
        },
        {
          "type": "Talk",
          "description": "Return the locket to Grimbold",
          "target": {
            "targetId": "grimbold-trader",
            "displayName": "Grimbold"
          },
          "requiredCount": 1,
          "isOptional": false,
          "isHidden": false,
          "order": 2
        }
      ]
    },
    {
      "id": "dungeon-survey",
      "name": "Mapping the Depths",
      "description": "The Adventurer's Guild needs updated maps. Explore the key areas of the dungeon.",
      "giverNpcId": "guild-cartographer",
      "turnInNpcId": "guild-cartographer",
      "hint": "Find the Grand Hall, Underground Lake, and Ancient Library.",
      "autoActivate": true,
      "objectives": [
        {
          "type": "Explore",
          "description": "Visit the Grand Hall",
          "target": {
            "targetId": "room-grand-hall",
            "displayName": "Grand Hall"
          },
          "requiredCount": 1,
          "isOptional": false,
          "isHidden": false,
          "order": 1
        },
        {
          "type": "Explore",
          "description": "Visit the Underground Lake",
          "target": {
            "targetId": "room-underground-lake",
            "displayName": "Underground Lake"
          },
          "requiredCount": 1,
          "isOptional": false,
          "isHidden": false,
          "order": 2
        },
        {
          "type": "Explore",
          "description": "Visit the Ancient Library",
          "target": {
            "targetId": "room-ancient-library",
            "displayName": "Ancient Library"
          },
          "requiredCount": 1,
          "isOptional": false,
          "isHidden": false,
          "order": 3
        },
        {
          "type": "Explore",
          "description": "Discover the Hidden Treasury",
          "target": {
            "targetId": "room-hidden-treasury",
            "displayName": "Hidden Treasury"
          },
          "requiredCount": 1,
          "isOptional": true,
          "isHidden": true,
          "order": 4
        }
      ]
    },
    {
      "id": "rat-problem",
      "name": "A Small Problem",
      "description": "Giant rats have infested the cellar. Exterminate them.",
      "giverNpcId": "tavern-keeper",
      "turnInNpcId": "tavern-keeper",
      "hint": "Check the cellar beneath the tavern.",
      "autoActivate": true,
      "objectives": [
        {
          "type": "Kill",
          "description": "Defeat giant rats",
          "target": {
            "targetType": "giant-rat",
            "displayName": "Giant Rats",
            "anyOfType": true
          },
          "requiredCount": 3,
          "isOptional": false,
          "isHidden": false,
          "order": 1
        }
      ]
    },
    {
      "id": "herb-gathering",
      "name": "Healer's Request",
      "description": "The local healer needs rare herbs that grow in the dungeon depths.",
      "giverNpcId": "village-healer",
      "turnInNpcId": "village-healer",
      "hint": "Cave moss grows near underground water sources.",
      "autoActivate": true,
      "objectives": [
        {
          "type": "Collect",
          "description": "Gather Cave Moss",
          "target": {
            "targetId": "item-cave-moss",
            "displayName": "Cave Moss",
            "locationHint": "Grows near underground water"
          },
          "requiredCount": 3,
          "isOptional": false,
          "isHidden": false,
          "order": 1
        },
        {
          "type": "Collect",
          "description": "Gather Glowcap Mushrooms",
          "target": {
            "targetId": "item-glowcap",
            "displayName": "Glowcap Mushrooms",
            "locationHint": "Found in dark corners"
          },
          "requiredCount": 2,
          "isOptional": false,
          "isHidden": false,
          "order": 2
        }
      ]
    }
  ]
}
```

### 6.2 quests.schema.json

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Quest Configuration",
  "description": "Defines quests and their objectives for the game",
  "type": "object",
  "required": ["quests"],
  "properties": {
    "quests": {
      "type": "array",
      "description": "List of quest definitions",
      "items": {
        "$ref": "#/definitions/questDefinition"
      }
    }
  },
  "definitions": {
    "questDefinition": {
      "type": "object",
      "required": ["id", "name", "description", "objectives"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique identifier (lowercase, alphanumeric with hyphens)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Display name of the quest"
        },
        "description": {
          "type": "string",
          "minLength": 10,
          "maxLength": 1000,
          "description": "Narrative description of the quest"
        },
        "giverNpcId": {
          "type": ["string", "null"],
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "NPC who gives this quest"
        },
        "turnInNpcId": {
          "type": ["string", "null"],
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "NPC to turn in the quest (defaults to giver)"
        },
        "hint": {
          "type": ["string", "null"],
          "maxLength": 500,
          "description": "Hint text shown in journal"
        },
        "autoActivate": {
          "type": "boolean",
          "default": true,
          "description": "Whether quest auto-activates on acceptance"
        },
        "objectives": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/objectiveDefinition"
          },
          "description": "Quest objectives"
        }
      }
    },
    "objectiveDefinition": {
      "type": "object",
      "required": ["type", "description", "target"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["Kill", "Collect", "Explore", "Talk", "Deliver", "Use", "Custom"],
          "description": "Type of objective"
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "description": "Display description of the objective"
        },
        "target": {
          "$ref": "#/definitions/objectiveTarget"
        },
        "requiredCount": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Number required to complete objective"
        },
        "isOptional": {
          "type": "boolean",
          "default": false,
          "description": "Whether objective is optional for quest completion"
        },
        "isHidden": {
          "type": "boolean",
          "default": false,
          "description": "Whether objective is hidden until discovered"
        },
        "order": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Display order (ascending)"
        }
      }
    },
    "objectiveTarget": {
      "type": "object",
      "properties": {
        "targetId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Specific target ID (for specific targets)"
        },
        "displayName": {
          "type": "string",
          "minLength": 1,
          "description": "Display name for the target"
        },
        "locationHint": {
          "type": ["string", "null"],
          "description": "Hint about where to find the target"
        },
        "anyOfType": {
          "type": "boolean",
          "default": false,
          "description": "Whether any entity of the type counts"
        },
        "targetType": {
          "type": ["string", "null"],
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Entity type for 'any of type' matching"
        }
      },
      "required": ["displayName"]
    }
  }
}
```

---

## 7. Service Specifications

### 7.1 IConfigurationProvider Updates

```csharp
// Additions to IConfigurationProvider interface

/// <summary>
/// Loads all quest definitions from configuration.
/// </summary>
/// <returns>List of quest definitions.</returns>
IReadOnlyList<QuestDefinition> LoadQuestDefinitions();

/// <summary>
/// Gets all quest definitions.
/// </summary>
/// <returns>List of all quest definitions.</returns>
IReadOnlyList<QuestDefinition> GetQuestDefinitions();

/// <summary>
/// Gets a specific quest definition by ID.
/// </summary>
/// <param name="id">The definition ID.</param>
/// <returns>The definition, or null if not found.</returns>
QuestDefinition? GetQuestDefinition(string id);
```

### 7.2 Configuration Loading

```csharp
// In JsonConfigurationProvider or similar

/// <summary>
/// Loads quest definitions from quests.json.
/// </summary>
public IReadOnlyList<QuestDefinition> LoadQuestDefinitions()
{
    _logger.LogDebug("Loading quest definitions from configuration");

    var questsPath = Path.Combine(_configPath, "quests.json");
    if (!File.Exists(questsPath))
    {
        _logger.LogWarning("Quest configuration not found: {Path}", questsPath);
        return Array.Empty<QuestDefinition>();
    }

    var json = File.ReadAllText(questsPath);
    var dto = JsonSerializer.Deserialize<QuestsConfigDto>(json, _jsonOptions);

    if (dto?.Quests == null)
    {
        _logger.LogWarning("No quests found in configuration");
        return Array.Empty<QuestDefinition>();
    }

    var definitions = new List<QuestDefinition>();

    foreach (var questDto in dto.Quests)
    {
        var objectives = questDto.Objectives
            .Select(o => ObjectiveDefinition.Create(
                Enum.Parse<ObjectiveType>(o.Type),
                o.Description,
                CreateTarget(o.Target),
                o.RequiredCount,
                o.IsOptional,
                o.IsHidden,
                o.Order))
            .ToList();

        var definition = QuestDefinition.Create(
            questDto.Id,
            questDto.Name,
            questDto.Description,
            objectives,
            questDto.GiverNpcId,
            questDto.TurnInNpcId,
            questDto.Hint,
            questDto.AutoActivate);

        definitions.Add(definition);

        _logger.LogDebug(
            "Loaded quest definition: {QuestId} ({QuestName}) with {ObjectiveCount} objectives",
            definition.Id, definition.Name, definition.Objectives.Count);
    }

    _logger.LogInformation(
        "Loaded {QuestCount} quest definitions from configuration",
        definitions.Count);

    return definitions;
}

private ObjectiveTarget CreateTarget(ObjectiveTargetDto dto)
{
    if (dto.AnyOfType && !string.IsNullOrEmpty(dto.TargetType))
    {
        return ObjectiveTarget.Any(dto.TargetType, dto.DisplayName);
    }
    else if (!string.IsNullOrEmpty(dto.TargetId))
    {
        return ObjectiveTarget.Specific(dto.TargetId, dto.DisplayName, dto.LocationHint);
    }
    else
    {
        return ObjectiveTarget.None(dto.DisplayName);
    }
}
```

---

## 8. User-Facing Changes

### 8.1 Overview

v0.3.0a establishes the data model foundation. Direct user-facing features (journal UI, commands) are implemented in v0.3.0b. However, the underlying quest tracking is in place.

### 8.2 Gameplay Impact

**Quest creation and tracking:**
- Quests can be created from definitions
- Objectives track progress automatically
- Player maintains active and completed quest lists

**This phase enables v0.3.0b features:**
- Quest journal display
- `quests` and `journal` commands
- Quest detail view

---

## 9. Logging Requirements

### 9.1 Log Events

| Event | Level | Message Template | Properties |
|-------|-------|------------------|------------|
| Config Load | Information | "Loaded {QuestCount} quest definitions from configuration" | QuestCount |
| Definition Loaded | Debug | "Loaded quest definition: {QuestId} ({QuestName}) with {ObjectiveCount} objectives" | QuestId, QuestName, ObjectiveCount |
| Quest Created | Information | "Quest '{QuestName}' ({QuestId}) created for player {PlayerId}" | QuestName, QuestId, PlayerId |
| Quest Accepted | Information | "Player {PlayerId} accepted quest '{QuestName}'" | PlayerId, QuestName |
| Quest Completed | Information | "Player {PlayerId} completed quest '{QuestName}'" | PlayerId, QuestName |
| Quest Failed | Information | "Player {PlayerId} failed quest '{QuestName}': {Reason}" | PlayerId, QuestName, Reason |
| Objective Progress | Debug | "Quest '{QuestName}' objective '{ObjectiveDesc}': {Current}/{Required}" | QuestName, ObjectiveDesc, Current, Required |
| Objective Complete | Debug | "Quest '{QuestName}' objective '{ObjectiveDesc}' completed" | QuestName, ObjectiveDesc |
| Config Error | Error | "Failed to load quest definitions: {ErrorMessage}" | ErrorMessage |
| Invalid Definition | Warning | "Invalid quest definition: {QuestId} - {ErrorMessage}" | QuestId, ErrorMessage |

### 9.2 Example Log Output

```
[2024-01-20 14:30:15 INF] Loaded 5 quest definitions from configuration
[2024-01-20 14:30:15 DBG] Loaded quest definition: goblin-menace (The Goblin Menace) with 1 objectives
[2024-01-20 14:30:15 DBG] Loaded quest definition: lost-heirloom (The Lost Heirloom) with 2 objectives
[2024-01-20 14:30:15 DBG] Loaded quest definition: dungeon-survey (Mapping the Depths) with 4 objectives
[2024-01-20 14:32:45 INF] Quest 'The Goblin Menace' (a1b2c3d4-...) created for player e5f6g7h8-...
[2024-01-20 14:32:45 INF] Player e5f6g7h8-... accepted quest 'The Goblin Menace'
[2024-01-20 14:35:12 DBG] Quest 'The Goblin Menace' objective 'Defeat goblins': 1/5
[2024-01-20 14:37:30 DBG] Quest 'The Goblin Menace' objective 'Defeat goblins': 5/5
[2024-01-20 14:37:30 DBG] Quest 'The Goblin Menace' objective 'Defeat goblins' completed
[2024-01-20 14:40:00 INF] Player e5f6g7h8-... completed quest 'The Goblin Menace'
```

---

## 10. Unit Test Specifications

### 10.1 Quest Entity Tests (~8 tests)

```csharp
namespace RuneAndRust.Domain.Tests.Entities;

[TestFixture]
public class QuestTests
{
    private QuestDefinition _testDefinition;
    private Guid _playerId;

    [SetUp]
    public void Setup()
    {
        _playerId = Guid.NewGuid();
        _testDefinition = QuestDefinition.Create(
            "test-quest",
            "Test Quest",
            "A test quest for unit testing.",
            new[]
            {
                ObjectiveDefinition.Create(
                    ObjectiveType.Kill,
                    "Defeat test enemies",
                    ObjectiveTarget.Any("test-enemy", "Test Enemies"),
                    5),
                ObjectiveDefinition.Create(
                    ObjectiveType.Explore,
                    "Visit test location",
                    ObjectiveTarget.Specific("test-room", "Test Room"),
                    1)
            });
    }

    [Test]
    public void Create_WithValidDefinition_ReturnsQuest()
    {
        var quest = Quest.Create(_testDefinition, _playerId);

        quest.Should().NotBeNull();
        quest.Id.Should().NotBe(Guid.Empty);
        quest.Name.Should().Be("Test Quest");
        quest.Status.Should().Be(QuestStatus.Available);
        quest.PlayerId.Should().Be(_playerId);
        quest.Objectives.Should().HaveCount(2);
    }

    [Test]
    public void Create_WithNullDefinition_ThrowsArgumentNullException()
    {
        var act = () => Quest.Create(null!, _playerId);

        act.Should().Throw<ArgumentNullException>();
    }

    [Test]
    public void Accept_WhenAvailable_ChangesStatusToActive()
    {
        var quest = Quest.Create(_testDefinition, _playerId);

        var result = quest.Accept();

        result.Should().BeTrue();
        quest.Status.Should().Be(QuestStatus.Active);
        quest.AcceptedAt.Should().NotBeNull();
    }

    [Test]
    public void Accept_WhenAlreadyActive_ReturnsFalse()
    {
        var quest = Quest.Create(_testDefinition, _playerId);
        quest.Accept();

        var result = quest.Accept();

        result.Should().BeFalse();
    }

    [Test]
    public void Complete_WhenAllObjectivesComplete_ChangesStatusToCompleted()
    {
        var quest = Quest.Create(_testDefinition, _playerId);
        quest.Accept();
        foreach (var obj in quest.Objectives)
        {
            obj.SetProgress(obj.RequiredCount);
        }

        var result = quest.Complete();

        result.Should().BeTrue();
        quest.Status.Should().Be(QuestStatus.Completed);
        quest.CompletedAt.Should().NotBeNull();
    }

    [Test]
    public void Complete_WhenObjectivesIncomplete_ReturnsFalse()
    {
        var quest = Quest.Create(_testDefinition, _playerId);
        quest.Accept();

        var result = quest.Complete();

        result.Should().BeFalse();
        quest.Status.Should().Be(QuestStatus.Active);
    }

    [Test]
    public void GetProgressPercent_ReturnsCorrectPercentage()
    {
        var quest = Quest.Create(_testDefinition, _playerId);
        quest.Objectives[0].SetProgress(3); // 3/5 = 60%
        quest.Objectives[1].SetProgress(1); // 1/1 = 100%

        var progress = quest.GetProgressPercent();

        progress.Should().Be(80); // (60 + 100) / 2
    }

    [Test]
    public void Fail_WhenActive_ChangesStatusToFailed()
    {
        var quest = Quest.Create(_testDefinition, _playerId);
        quest.Accept();

        var result = quest.Fail();

        result.Should().BeTrue();
        quest.Status.Should().Be(QuestStatus.Failed);
    }
}
```

### 10.2 QuestObjective Tests (~7 tests)

```csharp
[TestFixture]
public class QuestObjectiveTests
{
    private ObjectiveDefinition _testDefinition;
    private Guid _questId;

    [SetUp]
    public void Setup()
    {
        _questId = Guid.NewGuid();
        _testDefinition = ObjectiveDefinition.Create(
            ObjectiveType.Kill,
            "Defeat test enemies",
            ObjectiveTarget.Any("goblin", "Goblins"),
            5);
    }

    [Test]
    public void Create_WithValidDefinition_ReturnsObjective()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);

        objective.Should().NotBeNull();
        objective.QuestId.Should().Be(_questId);
        objective.Type.Should().Be(ObjectiveType.Kill);
        objective.RequiredCount.Should().Be(5);
        objective.CurrentCount.Should().Be(0);
        objective.IsComplete.Should().BeFalse();
    }

    [Test]
    public void IncrementProgress_IncreasesCurrentCount()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);

        objective.IncrementProgress(2);

        objective.CurrentCount.Should().Be(2);
    }

    [Test]
    public void IncrementProgress_CapsAtRequiredCount()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);

        objective.IncrementProgress(10);

        objective.CurrentCount.Should().Be(5);
        objective.IsComplete.Should().BeTrue();
    }

    [Test]
    public void IncrementProgress_WhenComplete_ReturnsFalse()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);
        objective.SetProgress(5);

        var result = objective.IncrementProgress();

        result.Should().BeFalse();
    }

    [Test]
    public void SetProgress_ClampsToValidRange()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);

        objective.SetProgress(-5);
        objective.CurrentCount.Should().Be(0);

        objective.SetProgress(100);
        objective.CurrentCount.Should().Be(5);
    }

    [Test]
    public void GetProgressPercent_ReturnsCorrectPercentage()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);
        objective.SetProgress(3);

        var percent = objective.GetProgressPercent();

        percent.Should().Be(60);
    }

    [Test]
    public void GetProgressString_FormatsCorrectly()
    {
        var objective = QuestObjective.Create(_testDefinition, _questId);
        objective.SetProgress(3);

        var progress = objective.GetProgressString();

        progress.Should().Be("(3/5)");
    }
}
```

### 10.3 ObjectiveTarget Tests (~5 tests)

```csharp
[TestFixture]
public class ObjectiveTargetTests
{
    [Test]
    public void Specific_CreatesSpecificTarget()
    {
        var target = ObjectiveTarget.Specific("goblin-chief", "Goblin Chief");

        target.TargetId.Should().Be("goblin-chief");
        target.DisplayName.Should().Be("Goblin Chief");
        target.AnyOfType.Should().BeFalse();
    }

    [Test]
    public void Any_CreatesAnyOfTypeTarget()
    {
        var target = ObjectiveTarget.Any("goblin", "Goblins");

        target.TargetType.Should().Be("goblin");
        target.DisplayName.Should().Be("Goblins");
        target.AnyOfType.Should().BeTrue();
    }

    [Test]
    public void Matches_WithSpecificTarget_MatchesExactId()
    {
        var target = ObjectiveTarget.Specific("goblin-chief", "Goblin Chief");

        target.Matches("goblin-chief").Should().BeTrue();
        target.Matches("goblin").Should().BeFalse();
    }

    [Test]
    public void Matches_WithAnyOfType_MatchesType()
    {
        var target = ObjectiveTarget.Any("goblin", "Goblins");

        target.Matches("goblin-1", "goblin").Should().BeTrue();
        target.Matches("orc-1", "orc").Should().BeFalse();
    }

    [Test]
    public void Matches_IsCaseInsensitive()
    {
        var target = ObjectiveTarget.Specific("Goblin-Chief", "Goblin Chief");

        target.Matches("goblin-chief").Should().BeTrue();
        target.Matches("GOBLIN-CHIEF").Should().BeTrue();
    }
}
```

### 10.4 Player Quest Methods Tests (~5 tests)

```csharp
[TestFixture]
public class PlayerQuestTests
{
    private Player _player;
    private QuestDefinition _questDefinition;

    [SetUp]
    public void Setup()
    {
        _player = Player.Create("Test Player");
        _questDefinition = QuestDefinition.Create(
            "test-quest",
            "Test Quest",
            "A test quest.",
            new[]
            {
                ObjectiveDefinition.Create(
                    ObjectiveType.Kill,
                    "Defeat enemies",
                    ObjectiveTarget.Any("enemy", "Enemies"),
                    1)
            });
    }

    [Test]
    public void AcceptQuest_AddsToActiveQuests()
    {
        var quest = Quest.Create(_questDefinition, _player.Id);

        var result = _player.AcceptQuest(quest);

        result.Should().BeTrue();
        _player.ActiveQuests.Should().Contain(quest);
        _player.GetActiveQuestCount().Should().Be(1);
    }

    [Test]
    public void AcceptQuest_WhenAlreadyHasQuest_ReturnsFalse()
    {
        var quest1 = Quest.Create(_questDefinition, _player.Id);
        var quest2 = Quest.Create(_questDefinition, _player.Id);
        _player.AcceptQuest(quest1);

        var result = _player.AcceptQuest(quest2);

        result.Should().BeFalse();
    }

    [Test]
    public void CompleteQuest_MovesToCompletedQuests()
    {
        var quest = Quest.Create(_questDefinition, _player.Id);
        _player.AcceptQuest(quest);
        quest.Objectives[0].SetProgress(1);

        var completed = _player.CompleteQuest(quest.Id);

        completed.Should().NotBeNull();
        _player.ActiveQuests.Should().BeEmpty();
        _player.CompletedQuests.Should().Contain(quest);
    }

    [Test]
    public void HasQuest_ReturnsTrueForActiveQuest()
    {
        var quest = Quest.Create(_questDefinition, _player.Id);
        _player.AcceptQuest(quest);

        _player.HasQuest("test-quest").Should().BeTrue();
        _player.HasActiveQuest("test-quest").Should().BeTrue();
    }

    [Test]
    public void HasQuest_ReturnsTrueForCompletedQuest()
    {
        var quest = Quest.Create(_questDefinition, _player.Id);
        _player.AcceptQuest(quest);
        quest.Objectives[0].SetProgress(1);
        _player.CompleteQuest(quest.Id);

        _player.HasQuest("test-quest").Should().BeTrue();
        _player.HasCompletedQuest("test-quest").Should().BeTrue();
        _player.HasActiveQuest("test-quest").Should().BeFalse();
    }
}
```

---

## 11. Use Cases

### UC-001: Create Quest from Definition
**Actor:** Game System
**Flow:** Load QuestDefinition → Quest.Create() → Quest with Objectives created → Return Quest instance

### UC-002: Accept Quest
**Actor:** Player (via game system)
**Flow:** Player receives Quest → Quest.Accept() → Status changes to Active → Quest added to ActiveQuests

### UC-003: Track Objective Progress
**Actor:** Game System
**Flow:** Game event occurs → Find matching objective → IncrementProgress() → Check IsComplete

### UC-004: Complete Quest
**Actor:** Player (via game system)
**Flow:** All objectives complete → Player.CompleteQuest() → Quest moves to CompletedQuests

### UC-005: Fail Quest
**Actor:** Game System
**Flow:** Failure condition met → Quest.Fail() → Status changes to Failed → Quest removed from ActiveQuests

---

## 12. Acceptance Criteria

### AC-3.0a-1: Quest Entity
- [ ] Quest entity can be created from QuestDefinition
- [ ] Quest stores Id, DefinitionId, Name, Description, Status, PlayerId
- [ ] Quest tracks GiverNpcId and TurnInNpcId
- [ ] Quest.Accept() changes status from Available to Active
- [ ] Quest.Complete() requires all non-optional objectives complete
- [ ] Quest.Fail() changes status to Failed
- [ ] Quest.GetProgressPercent() returns correct percentage

### AC-3.0a-2: QuestObjective Entity
- [ ] QuestObjective can be created from ObjectiveDefinition
- [ ] Objective tracks Type, Target, RequiredCount, CurrentCount
- [ ] IncrementProgress() increases CurrentCount
- [ ] IsComplete is true when CurrentCount >= RequiredCount
- [ ] Progress is capped at RequiredCount
- [ ] Hidden objectives can be revealed

### AC-3.0a-3: QuestStatus Enum
- [ ] QuestStatus has 4 values: Available, Active, Completed, Failed
- [ ] All values have XML documentation

### AC-3.0a-4: ObjectiveType Enum
- [ ] ObjectiveType has 7 values: Kill, Collect, Explore, Talk, Deliver, Use, Custom
- [ ] All values have XML documentation

### AC-3.0a-5: ObjectiveTarget Value Object
- [ ] Supports specific targets (by ID)
- [ ] Supports "any of type" targets
- [ ] Matches() correctly identifies matching entities
- [ ] Case-insensitive matching

### AC-3.0a-6: Player Quest Collections
- [ ] Player.ActiveQuests returns readonly list
- [ ] Player.CompletedQuests returns readonly list
- [ ] AcceptQuest() adds quest to ActiveQuests
- [ ] CompleteQuest() moves quest to CompletedQuests
- [ ] HasQuest() checks both active and completed
- [ ] HasActiveQuest() checks only active quests

### AC-3.0a-7: Configuration
- [ ] Quests can be defined in quests.json
- [ ] quests.schema.json validates configuration
- [ ] All objective types are configurable
- [ ] Invalid configuration produces clear error messages

### AC-3.0a-8: Unit Tests
- [ ] ~25 unit tests implemented
- [ ] All tests pass
- [ ] Tests cover happy path and error cases

---

## 13. Deliverable Checklist

### Domain Layer
- [ ] `Entities/Quest.cs`
- [ ] `Entities/QuestObjective.cs`
- [ ] `Definitions/QuestDefinition.cs`
- [ ] `Definitions/ObjectiveDefinition.cs`
- [ ] `Enums/QuestStatus.cs`
- [ ] `Enums/ObjectiveType.cs`
- [ ] `ValueObjects/ObjectiveTarget.cs`
- [ ] `Entities/Player.cs` updates (quest collections and methods)

### Application Layer
- [ ] `Configuration/QuestsConfigDto.cs`
- [ ] `Configuration/QuestDto.cs`
- [ ] `Configuration/ObjectiveDto.cs`
- [ ] `Configuration/ObjectiveTargetDto.cs`
- [ ] `Interfaces/IConfigurationProvider.cs` updates

### Infrastructure Layer
- [ ] `Configuration/JsonConfigurationProvider.cs` updates (LoadQuestDefinitions)

### Configuration Files
- [ ] `config/quests.json`
- [ ] `config/schemas/quests.schema.json`

### Tests
- [ ] `Domain.Tests/Entities/QuestTests.cs`
- [ ] `Domain.Tests/Entities/QuestObjectiveTests.cs`
- [ ] `Domain.Tests/ValueObjects/ObjectiveTargetTests.cs`
- [ ] `Domain.Tests/Entities/PlayerQuestTests.cs`

### Documentation
- [ ] XML documentation on all public members
- [ ] JSON schema documentation

---

## 14. Dependencies

### Required from Previous Versions
- Player entity (from v0.0.3)
- IConfigurationProvider interface (from v0.0.4a)
- NPC entity (from v0.2.0a) - for GiverNpcId/TurnInNpcId references
- Item entity (from v0.0.4a) - for Collect objective target references
- Room entity (from early version) - for Explore objective target references
- Monster entity (from v0.0.3) - for Kill objective target references

### Provided to v0.3.0b (Quest Journal)
- Quest entity with objectives and status
- QuestStatus enum for filtering
- Player quest collections for display
- Objective progress methods for journal display

### Provided to v0.3.0c (Progress Tracking)
- QuestObjective.IncrementProgress() for event handling
- ObjectiveTarget.Matches() for event matching
- ObjectiveType for determining which events to track

### Provided to v0.3.1 (Quest Rewards)
- Quest entity ready for reward attachment
- Quest.Complete() flow for reward distribution

---

## 15. Future Considerations

### Deferred to v0.3.0b
- **Quest Journal UI**: TUI display of quests and objectives
- **`quests` Command**: View active quests
- **`journal` Command**: Alias for quests
- **Quest Detail View**: View individual quest details
- **Progress Formatting**: Visual progress bars

### Deferred to v0.3.0c
- **Kill Progress Tracking**: Update on monster defeat
- **Collect Progress Tracking**: Update on item pickup
- **Explore Progress Tracking**: Update on room entry
- **Talk Progress Tracking**: Update on dialogue completion
- **Dialogue Quest Acceptance**: Start quests via dialogue

### Deferred to v0.3.1
- **Quest Rewards**: XP, gold, items on completion
- **Quest Prerequisites**: Require other quests to be completed
- **Reputation Requirements**: Require faction standing
- **Level Requirements**: Require minimum player level

### Deferred to v0.3.2
- **Quest Chains**: Quests that lead to other quests
- **Time Limits**: Quests that fail after a time
- **Branching Quests**: Multiple paths through objectives
- **Repeatable Quests**: Daily/weekly quest reset

### Out of Scope
- **Procedural Quests**: Dynamically generated quests
- **Group Quests**: Multi-player quest objectives
- **PvP Objectives**: Player vs player quest goals

---

*Document Version: 1.0*
*Last Updated: 2024-01-20*
*Author: Claude Code*
