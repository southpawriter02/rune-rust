# v0.14.2c Design Specification: Item Schema

**Version:** 0.14.2c
**Parent:** v0.14.2 (Equipment Configuration Schemas)
**Prerequisites:** v0.14.2b Complete (Armor Schema)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Item Schema Definition](#4-item-schema-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [ItemDefinition Definition](#42-itemdefinition-definition)
   - 4.3 [ConsumableEffect Definition](#43-consumableeffect-definition)
   - 4.4 [UseRequirement Definition](#44-userequirement-definition)
   - 4.5 [VendorPrices Definition](#45-vendorprices-definition)
5. [Item Category Configuration](#5-item-category-configuration)
   - 5.1 [Category Definitions](#51-category-definitions)
   - 5.2 [Category Examples](#52-category-examples)
6. [Consumable Effect Configuration](#6-consumable-effect-configuration)
   - 6.1 [Effect Type Definitions](#61-effect-type-definitions)
   - 6.2 [Effect Value Usage](#62-effect-value-usage)
   - 6.3 [Cleanse Integration](#63-cleanse-integration)
7. [Rarity and Value Configuration](#7-rarity-and-value-configuration)
   - 7.1 [Rarity Tiers](#71-rarity-tiers)
   - 7.2 [Vendor Prices](#72-vendor-prices)
8. [Stack and Weight Configuration](#8-stack-and-weight-configuration)
   - 8.1 [Stack Limits](#81-stack-limits)
   - 8.2 [Weight System](#82-weight-system)
9. [Validation Rules](#9-validation-rules)
   - 9.1 [Enum Validation](#91-enum-validation)
   - 9.2 [Range Validation](#92-range-validation)
   - 9.3 [Required Fields](#93-required-fields)
   - 9.4 [Pattern Validation](#94-pattern-validation)
   - 9.5 [Conditional Validation](#95-conditional-validation)
10. [Configuration Schema](#10-configuration-schema)
11. [Configuration File Updates](#11-configuration-file-updates)
12. [Data Model Changes](#12-data-model-changes)
13. [Logging Specifications](#13-logging-specifications)
14. [Unit Testing Requirements](#14-unit-testing-requirements)
15. [Use Cases](#15-use-cases)
16. [Deliverable Checklist](#16-deliverable-checklist)
17. [Acceptance Criteria](#17-acceptance-criteria)
18. [Dependencies](#18-dependencies)
19. [Future Considerations](#19-future-considerations)

---

## 1. Executive Summary

Version 0.14.2c introduces the **Item Schema** (`items.schema.json`), which validates general item configuration including consumable effects, item categories, stack limits, rarity tiers, vendor prices, weight values, and use requirements. This schema covers all items that are not weapons or armor—potions, scrolls, crafting materials, quest items, and miscellaneous goods.

The Item Schema integrates with the existing `cleanse-items.json` pattern for cure effects while providing a comprehensive framework for all item types. It validates item categories (Consumable, Material, QuestItem, Key, Miscellaneous), consumable effect definitions (Heal, RestoreMana, Buff, Cure), stack limits (1-999), rarity tiers (Common through Legendary), and vendor buy/sell prices.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `items.schema.json` |
| **Schema Definitions** | `ItemDefinition`, `ConsumableEffect`, `UseRequirement`, `VendorPrices` |
| **Configuration Files** | Create `items.json` with example items |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version provides:
- **Item category system** - Enumeration of all general item types
- **Consumable effect framework** - Heal, restore, buff, cure, damage, utility effects
- **Stack limit validation** - Inventory management constraints (1-999)
- **Rarity tier system** - Shared with weapons and armor schemas
- **Vendor economy** - Buy and sell price definitions
- **Weight/encumbrance** - Item weight for inventory limits
- **Use requirements** - Level, class, and stat restrictions
- **Cleanse integration** - Compatible with existing cleanse-items.json pattern

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    v0.14.2 EQUIPMENT CONFIGURATION SCHEMAS                   │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────────────┐
  │  v0.14.2a: weapons.schema.json                                          │
  │  v0.14.2b: armor.schema.json                                            │
  │  v0.14.2c: items.schema.json ◀── THIS VERSION                           │
  │  v0.14.2d: loot-tables.schema.json                                      │
  └─────────────────────────────────────────────────────────────────────────┘

  Cross-references:
  • status-effects.json → statusEffect field references effect IDs
  • loot-tables.json → itemId references item IDs
  • cleanse-items.json → cleanseType pattern integrated
  • vendors.json (future) → inventory references item IDs

  Shared definitions:
  • Rarity tier enumeration (Common through Legendary)
  • ID pattern: ^[a-z][a-z0-9_]*$ (underscore convention)
  • Schema location: config/schemas/
  • Quality tiers aligned with weapons and armor
```

---

## 2. Feature Overview

```
v0.14.2c Item Schema Features
├── items.schema.json
│   ├── Root Configuration Properties
│   │   ├── $schema (string, optional)
│   │   ├── version (string, optional)
│   │   └── items (array of ItemDefinition, required)
│   └── Definitions
│       ├── ItemDefinition
│       │   ├── id (string, underscore pattern, required)
│       │   ├── name (string, minLength: 1, required)
│       │   ├── description (string, required)
│       │   ├── category (enum: Consumable, Material, QuestItem, Key, Miscellaneous, required)
│       │   ├── rarity (enum, default: Common)
│       │   ├── stackLimit (integer, 1-999, default: 1)
│       │   ├── weight (number, minimum: 0, default: 0)
│       │   ├── vendorPrices (VendorPrices, optional)
│       │   ├── consumableEffect (ConsumableEffect, optional)
│       │   ├── useRequirements (UseRequirement, optional)
│       │   ├── isQuestItem (boolean, default: false)
│       │   ├── isSellable (boolean, default: true)
│       │   ├── tags (array of string, optional)
│       │   └── sortOrder (integer, minimum: 0, optional)
│       ├── ConsumableEffect
│       │   ├── type (enum: Heal, RestoreMana, RestoreStamina, Buff, Cure, Damage, Utility)
│       │   ├── value (integer, optional)
│       │   ├── percentage (number, 0-1, optional)
│       │   ├── duration (integer, optional)
│       │   ├── statusEffect (string, optional)
│       │   ├── cleanseType (enum, optional)
│       │   └── specificEffect (string, optional)
│       ├── UseRequirement
│       │   ├── minLevel (integer, minimum: 1, optional)
│       │   ├── classIds (array of string, optional)
│       │   └── statRequirements (StatRequirements, optional)
│       └── VendorPrices
│           ├── buyPrice (integer, minimum: 0)
│           └── sellPrice (integer, minimum: 0)
├── Validation Rules
│   ├── Item Category Enum Validation
│   ├── Rarity Tier Enum Validation
│   ├── Stack Limit Range Validation (1-999)
│   ├── Weight Non-Negative Validation
│   ├── Vendor Price Non-Negative Validation
│   ├── Consumable Effect Type Enum Validation
│   ├── Cleanse Type Enum Validation
│   └── ID Pattern Validation (underscore)
└── Configuration Updates
    └── items.json created with example items
```

---

## 3. Architecture Diagrams

### 3.1 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits items.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads items.schema.json from config/schemas/                             │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "category must be one of: Consumable, Material, ..."
                           • "stackLimit must be between 1 and 999"
                           • "id must match pattern ^[a-z][a-z0-9_]*$"
                           • "vendorPrices.buyPrice must be >= 0"
```

### 3.2 Item Schema Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          items.schema.json                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"                         │
│  title: "Item Configuration"                                                 │
│  type: object                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  properties:                                                                 │
│  ┌─────────────────────────┬─────────────────────────────────────────────┐  │
│  │ $schema                 │ type: string (optional)                     │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ version                 │ type: string (optional)                     │  │
│  ├─────────────────────────┼─────────────────────────────────────────────┤  │
│  │ items                   │ type: array, items: $ref ItemDefinition     │  │
│  └─────────────────────────┴─────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────────────────┤
│  definitions:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ ItemDefinition                                                      │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ id                    │ string, pattern: ^[a-z][a-z0-9_]*$    │   │    │
│  │ │ name                  │ string, minLength: 1                   │   │    │
│  │ │ description           │ string                                 │   │    │
│  │ │ category              │ enum: Consumable, Material, ...        │   │    │
│  │ │ rarity                │ enum: Common, Uncommon, ...            │   │    │
│  │ │ stackLimit            │ integer, min: 1, max: 999              │   │    │
│  │ │ weight                │ number, minimum: 0                     │   │    │
│  │ │ vendorPrices          │ $ref VendorPrices (optional)           │   │    │
│  │ │ consumableEffect      │ $ref ConsumableEffect (optional)       │   │    │
│  │ │ useRequirements       │ $ref UseRequirement (optional)         │   │    │
│  │ │ isQuestItem           │ boolean, default: false                │   │    │
│  │ │ isSellable            │ boolean, default: true                 │   │    │
│  │ │ tags                  │ array of string (optional)             │   │    │
│  │ │ sortOrder             │ integer, minimum: 0 (optional)         │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ ConsumableEffect                                                    │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ type                  │ enum: Heal, RestoreMana, Buff, ...    │   │    │
│  │ │ value                 │ integer (optional)                     │   │    │
│  │ │ percentage            │ number, 0-1 (optional)                 │   │    │
│  │ │ duration              │ integer (optional)                     │   │    │
│  │ │ statusEffect          │ string (optional)                      │   │    │
│  │ │ cleanseType           │ enum (optional)                        │   │    │
│  │ │ specificEffect        │ string (optional)                      │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ UseRequirement                                                      │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ minLevel              │ integer, minimum: 1 (optional)        │   │    │
│  │ │ classIds              │ array of string (optional)            │   │    │
│  │ │ statRequirements      │ $ref StatRequirements (optional)      │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ VendorPrices                                                        │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ buyPrice              │ integer, minimum: 0                    │   │    │
│  │ │ sellPrice             │ integer, minimum: 0                    │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ StatRequirements (reused from armor.schema.json)                    │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ minMight              │ integer (optional)                     │   │    │
│  │ │ minFortitude          │ integer (optional)                     │   │    │
│  │ │ minWill               │ integer (optional)                     │   │    │
│  │ │ minWits               │ integer (optional)                     │   │    │
│  │ │ minFinesse            │ integer (optional)                     │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Item Category Hierarchy Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         ITEM CATEGORY HIERARCHY                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         CONSUMABLE                                   │    │
│  │  Items that are used and destroyed when activated                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Examples:                                                           │    │
│  │  • Health Potion - Restores HP                                       │    │
│  │  • Mana Elixir - Restores mana                                       │    │
│  │  • Antidote - Cures poison                                           │    │
│  │  • Scroll of Fireball - Casts spell                                  │    │
│  │  Requires: consumableEffect definition                               │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         MATERIAL                                     │    │
│  │  Crafting components and resource items                              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Examples:                                                           │    │
│  │  • Iron Ore - Metal crafting material                                │    │
│  │  • Leather Strip - Armor crafting material                           │    │
│  │  • Magic Dust - Enchanting component                                 │    │
│  │  • Dragon Scale - Rare crafting material                             │    │
│  │  Note: Typically stackable with high stack limits                    │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                         QUEST ITEM                                   │    │
│  │  Story-related items required for quests                             │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Examples:                                                           │    │
│  │  • Ancient Tome - Required for quest progression                     │    │
│  │  • Royal Seal - Proof of authority                                   │    │
│  │  • Dragon's Heart - Boss drop for quest                              │    │
│  │  Note: isQuestItem=true, isSellable=false typically                  │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                            KEY                                       │    │
│  │  Items that unlock doors, chests, or passages                        │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Examples:                                                           │    │
│  │  • Dungeon Key - Opens specific dungeon door                         │    │
│  │  • Master Key - Opens multiple locks                                 │    │
│  │  • Skeleton Key - Opens basic locks                                  │    │
│  │  Note: Often consumed on use, non-stackable                          │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                       MISCELLANEOUS                                  │    │
│  │  General utility items that don't fit other categories               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │  Examples:                                                           │    │
│  │  • Torch - Provides light                                            │    │
│  │  • Rope - Utility for climbing/tying                                 │    │
│  │  • Map - Shows dungeon layout                                        │    │
│  │  • Lockpick - Used for lock picking attempts                         │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Consumable Effect System Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       CONSUMABLE EFFECT SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  EFFECT TYPES AND VALUE USAGE                                                │
│                                                                              │
│  ┌────────────────┬────────────────────────────────────────────────────┐    │
│  │ Effect Type    │ Value Fields Used                                  │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Heal           │ value = HP restored                                │    │
│  │                │ percentage = % of max HP (optional alternative)    │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ RestoreMana    │ value = mana restored                              │    │
│  │                │ percentage = % of max mana (optional alternative)  │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ RestoreStamina │ value = stamina restored                           │    │
│  │                │ percentage = % of max stamina (optional)           │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Buff           │ statusEffect = buff ID to apply                    │    │
│  │                │ duration = turns the buff lasts                    │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Cure           │ cleanseType = type of cleanse                      │    │
│  │                │ specificEffect = specific effect ID to cure        │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Damage         │ value = damage dealt                               │    │
│  │                │ (for thrown items like bombs)                      │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Utility        │ Custom handling based on item                      │    │
│  │                │ tags field for specific behavior                   │    │
│  └────────────────┴────────────────────────────────────────────────────┘    │
│                                                                              │
│  CLEANSE TYPES (from cleanse-items.json pattern)                             │
│                                                                              │
│  ┌────────────────┬────────────────────────────────────────────────────┐    │
│  │ Cleanse Type   │ Behavior                                           │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Specific       │ Removes one specific status effect                 │    │
│  │                │ specificEffect field required                      │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ AllNegative    │ Removes all negative status effects                │    │
│  │                │ specificEffect = null                              │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Magical        │ Removes all magical status effects                 │    │
│  │                │ (charm, confusion, fear, etc.)                     │    │
│  ├────────────────┼────────────────────────────────────────────────────┤    │
│  │ Elemental      │ Removes all elemental status effects               │    │
│  │                │ (burning, frozen, shocked, etc.)                   │    │
│  └────────────────┴────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Vendor Economy Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         VENDOR ECONOMY SYSTEM                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  PRICE STRUCTURE                                                             │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  vendorPrices: {                                                     │   │
│  │    "buyPrice": 100,   // Player pays this to buy from vendor         │   │
│  │    "sellPrice": 25    // Player receives this when selling           │   │
│  │  }                                                                   │   │
│  │                                                                      │   │
│  │  Common ratio: sellPrice = buyPrice × 0.25 (25% return)              │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  RARITY MODIFIERS                                                            │
│                                                                              │
│  ┌────────────────┬──────────────┬───────────────────────────────────────┐  │
│  │ Rarity         │ Value Mult.  │ Typical Base Price Range              │  │
│  ├────────────────┼──────────────┼───────────────────────────────────────┤  │
│  │ Common         │ 1.0x         │ 1-50 gold                             │  │
│  │ Uncommon       │ 2.0x         │ 25-150 gold                           │  │
│  │ Rare           │ 5.0x         │ 100-500 gold                          │  │
│  │ Epic           │ 20.0x        │ 500-2000 gold                         │  │
│  │ Legendary      │ 100.0x       │ 2000+ gold                            │  │
│  └────────────────┴──────────────┴───────────────────────────────────────┘  │
│                                                                              │
│  SELLABILITY RULES                                                           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  isSellable: true  → Item can be sold to vendors                     │   │
│  │  isSellable: false → Item cannot be sold (quest items, keys)         │   │
│  │                                                                      │   │
│  │  Quest items: isQuestItem=true, isSellable=false                     │   │
│  │  Keys: isSellable=false (consumed on use)                            │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 Stack and Weight System Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        STACK AND WEIGHT SYSTEM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  STACK LIMITS                                                                │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  stackLimit: integer (1-999)                                         │   │
│  │                                                                      │   │
│  │  Typical values by category:                                         │   │
│  │  • Consumables: 20-99 (potions stack, scrolls may not)              │   │
│  │  • Materials: 99-999 (crafting materials stack high)                │   │
│  │  • Quest Items: 1 (unique, non-stackable)                           │   │
│  │  • Keys: 1 (unique per lock)                                        │   │
│  │  • Miscellaneous: varies by item                                    │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  WEIGHT SYSTEM                                                               │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  weight: number (minimum: 0, default: 0)                             │   │
│  │                                                                      │   │
│  │  Weight units (for encumbrance calculation):                         │   │
│  │  • 0.0 - Weightless (scrolls, keys, small gems)                     │   │
│  │  • 0.1-0.5 - Light (potions, small items)                           │   │
│  │  • 0.5-2.0 - Medium (torches, tools)                                │   │
│  │  • 2.0+ - Heavy (large materials, ore)                              │   │
│  │                                                                      │   │
│  │  Total weight = sum(item.weight × item.quantity)                     │   │
│  │  Encumbrance threshold = character's carry capacity                  │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  VALIDATION RANGES                                                           │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  stackLimit:                                                         │   │
│  │    minimum: 1   (at least one item per stack)                       │   │
│  │    maximum: 999 (reasonable inventory limit)                        │   │
│  │                                                                      │   │
│  │  weight:                                                             │   │
│  │    minimum: 0   (weightless allowed)                                │   │
│  │    no maximum   (heavy items possible)                              │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.7 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── items.json ◀──────────────────────────────┐                            │
│  │   {                                          │ references                │
│  │     "$schema": "./schemas/items.schema.json",│                            │
│  │     "items": [                               │                            │
│  │       {                                      │                            │
│  │         "id": "health_potion",               │                            │
│  │         "name": "Health Potion",             │                            │
│  │         "category": "Consumable",            │                            │
│  │         "consumableEffect": {                │                            │
│  │           "type": "Heal",                    │                            │
│  │           "value": 50                        │                            │
│  │         },                                   │                            │
│  │         "stackLimit": 20,                    │                            │
│  │         "vendorPrices": {                    │                            │
│  │           "buyPrice": 50,                    │                            │
│  │           "sellPrice": 12                    │                            │
│  │         }                                    │                            │
│  │       },                                     │                            │
│  │       ...                                    │                            │
│  │     ]                                        │                            │
│  │   }                                          │                            │
│  │                                              │                            │
│  ├── cleanse-items.json                         │                            │
│  │   (existing, pattern referenced)             │                            │
│  │                                              │                            │
│  └── schemas/                                   │                            │
│      └── items.schema.json ─────────────────────┘                            │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": {                                                  │
│              "ItemDefinition": {...},                                        │
│              "ConsumableEffect": {...},                                      │
│              "UseRequirement": {...},                                        │
│              "VendorPrices": {...},                                          │
│              "StatRequirements": {...}                                       │
│            }                                                                 │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Item Schema Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/items.schema.json`

The item schema follows JSON Schema Draft-07 specification, providing comprehensive validation for general item configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Item Configuration",
    "description": "Schema for general item definitions. Defines all items that are not weapons or armor, including consumables, materials, quest items, keys, and miscellaneous goods.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "items": {
            "type": "array",
            "description": "List of item definitions",
            "items": {
                "$ref": "#/definitions/ItemDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["items"],
    "additionalProperties": false,
    "definitions": {
        "ItemDefinition": { ... },
        "ConsumableEffect": { ... },
        "UseRequirement": { ... },
        "VendorPrices": { ... },
        "StatRequirements": { ... }
    }
}
```

### 4.2 ItemDefinition Definition

The `ItemDefinition` object defines a complete item with all its properties.

```json
"ItemDefinition": {
    "type": "object",
    "description": "A general item that can be held in inventory",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the item (lowercase with underscores)",
            "pattern": "^[a-z][a-z0-9_]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "Full description of the item",
            "minLength": 1
        },
        "category": {
            "type": "string",
            "description": "The type category of item",
            "enum": ["Consumable", "Material", "QuestItem", "Key", "Miscellaneous"]
        },
        "rarity": {
            "type": "string",
            "description": "Rarity tier affecting drop rates and value",
            "enum": ["Common", "Uncommon", "Rare", "Epic", "Legendary"],
            "default": "Common"
        },
        "stackLimit": {
            "type": "integer",
            "description": "Maximum number of this item per inventory stack",
            "minimum": 1,
            "maximum": 999,
            "default": 1
        },
        "weight": {
            "type": "number",
            "description": "Weight per unit for encumbrance calculation",
            "minimum": 0,
            "default": 0
        },
        "vendorPrices": {
            "$ref": "#/definitions/VendorPrices"
        },
        "consumableEffect": {
            "$ref": "#/definitions/ConsumableEffect"
        },
        "useRequirements": {
            "$ref": "#/definitions/UseRequirement"
        },
        "isQuestItem": {
            "type": "boolean",
            "description": "Whether this item is required for quest progression",
            "default": false
        },
        "isSellable": {
            "type": "boolean",
            "description": "Whether this item can be sold to vendors",
            "default": true
        },
        "tags": {
            "type": "array",
            "description": "Optional tags for categorization and filtering",
            "items": {
                "type": "string"
            }
        },
        "sortOrder": {
            "type": "integer",
            "description": "Order for display sorting (lower values first)",
            "minimum": 0,
            "default": 0
        }
    },
    "required": ["id", "name", "description", "category"],
    "additionalProperties": false
}
```

### 4.3 ConsumableEffect Definition

The `ConsumableEffect` object defines what happens when a consumable item is used.

```json
"ConsumableEffect": {
    "type": "object",
    "description": "The effect triggered when a consumable item is used",
    "properties": {
        "type": {
            "type": "string",
            "description": "The type of effect this consumable provides",
            "enum": ["Heal", "RestoreMana", "RestoreStamina", "Buff", "Cure", "Damage", "Utility"]
        },
        "value": {
            "type": "integer",
            "description": "Numeric value for the effect (HP restored, damage dealt, etc.)",
            "minimum": 0
        },
        "percentage": {
            "type": "number",
            "description": "Percentage-based effect (0.0 to 1.0 for 0% to 100%)",
            "minimum": 0,
            "maximum": 1
        },
        "duration": {
            "type": "integer",
            "description": "Duration in turns for buff effects",
            "minimum": 1
        },
        "statusEffect": {
            "type": "string",
            "description": "Reference to status effect ID for Buff type",
            "pattern": "^[a-z][a-z0-9_-]*$"
        },
        "cleanseType": {
            "type": "string",
            "description": "Type of cleansing for Cure type effects",
            "enum": ["Specific", "AllNegative", "Magical", "Elemental"]
        },
        "specificEffect": {
            "type": ["string", "null"],
            "description": "Specific status effect ID to cleanse (for Specific cleanseType)",
            "pattern": "^[a-z][a-z0-9_-]*$"
        }
    },
    "required": ["type"],
    "additionalProperties": false
}
```

### 4.4 UseRequirement Definition

The `UseRequirement` object defines prerequisites for using an item.

```json
"UseRequirement": {
    "type": "object",
    "description": "Requirements that must be met to use this item",
    "properties": {
        "minLevel": {
            "type": "integer",
            "description": "Minimum character level required to use",
            "minimum": 1
        },
        "classIds": {
            "type": "array",
            "description": "List of class IDs that can use this item (empty = all classes)",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9_-]*$"
            }
        },
        "statRequirements": {
            "$ref": "#/definitions/StatRequirements"
        }
    },
    "additionalProperties": false
}
```

### 4.5 VendorPrices Definition

The `VendorPrices` object defines buying and selling prices.

```json
"VendorPrices": {
    "type": "object",
    "description": "Prices for buying and selling this item at vendors",
    "properties": {
        "buyPrice": {
            "type": "integer",
            "description": "Price the player pays to buy this item",
            "minimum": 0
        },
        "sellPrice": {
            "type": "integer",
            "description": "Price the player receives when selling this item",
            "minimum": 0
        }
    },
    "required": ["buyPrice", "sellPrice"],
    "additionalProperties": false
}
```

---

## 5. Item Category Configuration

### 5.1 Category Definitions

Item categories classify items by their primary purpose and behavior.

| Category | Description | Typical Properties | Stack Limit |
|----------|-------------|-------------------|-------------|
| `Consumable` | Used and destroyed | consumableEffect required | 10-99 |
| `Material` | Crafting components | High stack, no effect | 99-999 |
| `QuestItem` | Story progression | isQuestItem=true, isSellable=false | 1 |
| `Key` | Unlocks doors/chests | isSellable=false | 1 |
| `Miscellaneous` | General utility | Varies | Varies |

### 5.2 Category Examples

**Consumable Example:**
```json
{
    "id": "health_potion",
    "name": "Health Potion",
    "description": "A red potion that restores health when consumed.",
    "category": "Consumable",
    "rarity": "Common",
    "stackLimit": 20,
    "weight": 0.5,
    "vendorPrices": {
        "buyPrice": 50,
        "sellPrice": 12
    },
    "consumableEffect": {
        "type": "Heal",
        "value": 50
    }
}
```

**Material Example:**
```json
{
    "id": "iron_ore",
    "name": "Iron Ore",
    "description": "Raw iron ore that can be smelted into iron ingots.",
    "category": "Material",
    "rarity": "Common",
    "stackLimit": 99,
    "weight": 2.0,
    "vendorPrices": {
        "buyPrice": 5,
        "sellPrice": 2
    },
    "tags": ["metal", "crafting", "smithing"]
}
```

**Quest Item Example:**
```json
{
    "id": "ancient_tome",
    "name": "Ancient Tome",
    "description": "A dusty book containing forbidden knowledge. The wizard seeks this.",
    "category": "QuestItem",
    "rarity": "Rare",
    "stackLimit": 1,
    "weight": 1.0,
    "isQuestItem": true,
    "isSellable": false
}
```

**Key Example:**
```json
{
    "id": "dungeon_key_01",
    "name": "Iron Dungeon Key",
    "description": "A rusty iron key that opens the first dungeon door.",
    "category": "Key",
    "rarity": "Common",
    "stackLimit": 1,
    "weight": 0.1,
    "isSellable": false,
    "tags": ["dungeon", "floor1"]
}
```

**Miscellaneous Example:**
```json
{
    "id": "torch",
    "name": "Torch",
    "description": "A wooden torch that provides light in dark areas.",
    "category": "Miscellaneous",
    "rarity": "Common",
    "stackLimit": 10,
    "weight": 0.5,
    "vendorPrices": {
        "buyPrice": 5,
        "sellPrice": 1
    },
    "tags": ["light", "utility"]
}
```

---

## 6. Consumable Effect Configuration

### 6.1 Effect Type Definitions

Consumable effect types define the behavior when an item is used.

| Effect Type | Description | Required Fields | Optional Fields |
|-------------|-------------|-----------------|-----------------|
| `Heal` | Restores health points | type | value, percentage |
| `RestoreMana` | Restores mana points | type | value, percentage |
| `RestoreStamina` | Restores stamina points | type | value, percentage |
| `Buff` | Applies positive status effect | type, statusEffect | duration |
| `Cure` | Removes negative status effects | type, cleanseType | specificEffect |
| `Damage` | Deals damage (thrown items) | type, value | - |
| `Utility` | Special effect | type | tags for handling |

### 6.2 Effect Value Usage

**Heal Effect:**
```json
{
    "consumableEffect": {
        "type": "Heal",
        "value": 100
    }
}
```

**Percentage-Based Heal:**
```json
{
    "consumableEffect": {
        "type": "Heal",
        "percentage": 0.5
    }
}
```

**Buff Effect:**
```json
{
    "consumableEffect": {
        "type": "Buff",
        "statusEffect": "strength_boost",
        "duration": 10
    }
}
```

**Damage Effect (Thrown Bomb):**
```json
{
    "consumableEffect": {
        "type": "Damage",
        "value": 30
    }
}
```

### 6.3 Cleanse Integration

The Cure effect type integrates with the existing `cleanse-items.json` pattern.

**Specific Cleanse:**
```json
{
    "consumableEffect": {
        "type": "Cure",
        "cleanseType": "Specific",
        "specificEffect": "poisoned"
    }
}
```

**All Negative Cleanse:**
```json
{
    "consumableEffect": {
        "type": "Cure",
        "cleanseType": "AllNegative",
        "specificEffect": null
    }
}
```

**Magical Cleanse:**
```json
{
    "consumableEffect": {
        "type": "Cure",
        "cleanseType": "Magical",
        "specificEffect": null
    }
}
```

**Elemental Cleanse:**
```json
{
    "consumableEffect": {
        "type": "Cure",
        "cleanseType": "Elemental",
        "specificEffect": null
    }
}
```

---

## 7. Rarity and Value Configuration

### 7.1 Rarity Tiers

Rarity tiers are shared with weapons and armor schemas for consistency.

| Rarity | Color | Drop Modifier | Value Modifier | Typical Examples |
|--------|-------|---------------|----------------|------------------|
| `Common` | White | 1.0x | 1.0x | Health Potion, Iron Ore |
| `Uncommon` | Green | 0.5x | 2.0x | Greater Health Potion, Steel Ingot |
| `Rare` | Blue | 0.2x | 5.0x | Superior Health Potion, Mithril Ore |
| `Epic` | Purple | 0.05x | 20.0x | Elixir of Life, Dragon Scale |
| `Legendary` | Orange | 0.01x | 100.0x | Panacea, Phoenix Feather |

### 7.2 Vendor Prices

Vendor prices define the economy for each item.

**Standard Pricing Example:**
```json
{
    "vendorPrices": {
        "buyPrice": 100,
        "sellPrice": 25
    }
}
```

**Price Guidelines by Rarity:**

| Rarity | Typical Buy Price | Sell Ratio | Example |
|--------|-------------------|------------|---------|
| Common | 10-50 gold | 25% | Buy: 50, Sell: 12 |
| Uncommon | 50-200 gold | 25% | Buy: 150, Sell: 37 |
| Rare | 200-1000 gold | 25% | Buy: 500, Sell: 125 |
| Epic | 1000-5000 gold | 25% | Buy: 2000, Sell: 500 |
| Legendary | 5000+ gold | 25% | Buy: 10000, Sell: 2500 |

---

## 8. Stack and Weight Configuration

### 8.1 Stack Limits

Stack limits control inventory management.

| Category | Typical Stack Limit | Reasoning |
|----------|---------------------|-----------|
| Consumable | 10-99 | Balance usage vs inventory space |
| Material | 99-999 | Crafting requires many materials |
| QuestItem | 1 | Unique story items |
| Key | 1 | One key per lock |
| Miscellaneous | 1-99 | Varies by utility |

**Stack Validation:**
- Minimum: 1 (at least one item per stack)
- Maximum: 999 (reasonable inventory limit)
- Default: 1 (non-stackable by default)

### 8.2 Weight System

Weight values for encumbrance calculation.

| Weight Range | Category | Examples |
|--------------|----------|----------|
| 0.0 | Weightless | Scrolls, keys, gems |
| 0.1-0.5 | Light | Potions, small items |
| 0.5-2.0 | Medium | Torches, tools, books |
| 2.0+ | Heavy | Ore, large materials |

**Weight Validation:**
- Minimum: 0 (weightless allowed)
- No maximum (heavy items possible)
- Default: 0 (weightless by default)

---

## 9. Validation Rules

### 9.1 Enum Validation

| Property | Valid Values | Validation Error |
|----------|--------------|------------------|
| `category` | `Consumable`, `Material`, `QuestItem`, `Key`, `Miscellaneous` | "category must be one of: Consumable, Material, ..." |
| `rarity` | `Common`, `Uncommon`, `Rare`, `Epic`, `Legendary` | "rarity must be one of: Common, Uncommon, ..." |
| `consumableEffect.type` | `Heal`, `RestoreMana`, `RestoreStamina`, `Buff`, `Cure`, `Damage`, `Utility` | "type must be one of: Heal, RestoreMana, ..." |
| `consumableEffect.cleanseType` | `Specific`, `AllNegative`, `Magical`, `Elemental` | "cleanseType must be one of: Specific, AllNegative, ..." |

### 9.2 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `stackLimit` | 1-999 | "stackLimit must be between 1 and 999" |
| `weight` | >= 0 | "weight must be >= 0" |
| `vendorPrices.buyPrice` | >= 0 | "buyPrice must be >= 0" |
| `vendorPrices.sellPrice` | >= 0 | "sellPrice must be >= 0" |
| `consumableEffect.value` | >= 0 | "value must be >= 0" |
| `consumableEffect.percentage` | 0-1 | "percentage must be between 0 and 1" |
| `consumableEffect.duration` | >= 1 | "duration must be >= 1" |
| `useRequirements.minLevel` | >= 1 | "minLevel must be >= 1" |
| `sortOrder` | >= 0 | "sortOrder must be >= 0" |

### 9.3 Required Fields

#### ItemDefinition Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `id` | Must be present and match pattern | "missing required property 'id'" |
| `name` | Must be present and non-empty | "missing required property 'name'" |
| `description` | Must be present | "missing required property 'description'" |
| `category` | Must be present and valid enum | "missing required property 'category'" |

#### VendorPrices Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `buyPrice` | Must be present and >= 0 | "missing required property 'buyPrice'" |
| `sellPrice` | Must be present and >= 0 | "missing required property 'sellPrice'" |

#### ConsumableEffect Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `type` | Must be present and valid enum | "missing required property 'type'" |

### 9.4 Pattern Validation

| Property | Pattern | Validation Error |
|----------|---------|------------------|
| `id` | `^[a-z][a-z0-9_]*$` | "id must match pattern ^[a-z][a-z0-9_]*$" |
| `version` | `^[0-9]+\.[0-9]+\.[0-9]+$` | "version must match pattern (e.g., '1.0.0')" |
| `consumableEffect.statusEffect` | `^[a-z][a-z0-9_-]*$` | "statusEffect must match pattern" |
| `consumableEffect.specificEffect` | `^[a-z][a-z0-9_-]*$` | "specificEffect must match pattern" |

### 9.5 Conditional Validation

Certain fields are conditionally required based on other values:

| Condition | Required Field | Notes |
|-----------|----------------|-------|
| `category: "Consumable"` | `consumableEffect` | Should have effect definition |
| `consumableEffect.type: "Buff"` | `statusEffect` | Must specify which buff |
| `consumableEffect.type: "Cure"` | `cleanseType` | Must specify cleanse type |
| `cleanseType: "Specific"` | `specificEffect` | Must specify effect to cure |

---

## 10. Configuration Schema

### Complete Items Schema File

**File:** `config/schemas/items.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Item Configuration",
    "description": "Schema for general item definitions. Defines all items that are not weapons or armor, including consumables, materials, quest items, keys, and miscellaneous goods.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
        },
        "items": {
            "type": "array",
            "description": "List of item definitions",
            "items": {
                "$ref": "#/definitions/ItemDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["items"],
    "additionalProperties": false,
    "definitions": {
        "ItemDefinition": {
            "type": "object",
            "description": "A general item that can be held in inventory",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the item (lowercase with underscores)",
                    "pattern": "^[a-z][a-z0-9_]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "description": {
                    "type": "string",
                    "description": "Full description of the item",
                    "minLength": 1
                },
                "category": {
                    "type": "string",
                    "description": "The type category of item",
                    "enum": ["Consumable", "Material", "QuestItem", "Key", "Miscellaneous"]
                },
                "rarity": {
                    "type": "string",
                    "description": "Rarity tier affecting drop rates and value",
                    "enum": ["Common", "Uncommon", "Rare", "Epic", "Legendary"],
                    "default": "Common"
                },
                "stackLimit": {
                    "type": "integer",
                    "description": "Maximum number of this item per inventory stack",
                    "minimum": 1,
                    "maximum": 999,
                    "default": 1
                },
                "weight": {
                    "type": "number",
                    "description": "Weight per unit for encumbrance calculation",
                    "minimum": 0,
                    "default": 0
                },
                "vendorPrices": {
                    "$ref": "#/definitions/VendorPrices"
                },
                "consumableEffect": {
                    "$ref": "#/definitions/ConsumableEffect"
                },
                "useRequirements": {
                    "$ref": "#/definitions/UseRequirement"
                },
                "isQuestItem": {
                    "type": "boolean",
                    "description": "Whether this item is required for quest progression",
                    "default": false
                },
                "isSellable": {
                    "type": "boolean",
                    "description": "Whether this item can be sold to vendors",
                    "default": true
                },
                "tags": {
                    "type": "array",
                    "description": "Optional tags for categorization and filtering",
                    "items": {
                        "type": "string"
                    }
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Order for display sorting (lower values first)",
                    "minimum": 0,
                    "default": 0
                }
            },
            "required": ["id", "name", "description", "category"],
            "additionalProperties": false
        },
        "ConsumableEffect": {
            "type": "object",
            "description": "The effect triggered when a consumable item is used",
            "properties": {
                "type": {
                    "type": "string",
                    "description": "The type of effect this consumable provides",
                    "enum": ["Heal", "RestoreMana", "RestoreStamina", "Buff", "Cure", "Damage", "Utility"]
                },
                "value": {
                    "type": "integer",
                    "description": "Numeric value for the effect (HP restored, damage dealt, etc.)",
                    "minimum": 0
                },
                "percentage": {
                    "type": "number",
                    "description": "Percentage-based effect (0.0 to 1.0 for 0% to 100%)",
                    "minimum": 0,
                    "maximum": 1
                },
                "duration": {
                    "type": "integer",
                    "description": "Duration in turns for buff effects",
                    "minimum": 1
                },
                "statusEffect": {
                    "type": "string",
                    "description": "Reference to status effect ID for Buff type",
                    "pattern": "^[a-z][a-z0-9_-]*$"
                },
                "cleanseType": {
                    "type": "string",
                    "description": "Type of cleansing for Cure type effects",
                    "enum": ["Specific", "AllNegative", "Magical", "Elemental"]
                },
                "specificEffect": {
                    "type": ["string", "null"],
                    "description": "Specific status effect ID to cleanse (for Specific cleanseType)",
                    "pattern": "^[a-z][a-z0-9_-]*$"
                }
            },
            "required": ["type"],
            "additionalProperties": false
        },
        "UseRequirement": {
            "type": "object",
            "description": "Requirements that must be met to use this item",
            "properties": {
                "minLevel": {
                    "type": "integer",
                    "description": "Minimum character level required to use",
                    "minimum": 1
                },
                "classIds": {
                    "type": "array",
                    "description": "List of class IDs that can use this item (empty = all classes)",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9_-]*$"
                    }
                },
                "statRequirements": {
                    "$ref": "#/definitions/StatRequirements"
                }
            },
            "additionalProperties": false
        },
        "VendorPrices": {
            "type": "object",
            "description": "Prices for buying and selling this item at vendors",
            "properties": {
                "buyPrice": {
                    "type": "integer",
                    "description": "Price the player pays to buy this item",
                    "minimum": 0
                },
                "sellPrice": {
                    "type": "integer",
                    "description": "Price the player receives when selling this item",
                    "minimum": 0
                }
            },
            "required": ["buyPrice", "sellPrice"],
            "additionalProperties": false
        },
        "StatRequirements": {
            "type": "object",
            "description": "Minimum stat requirements for using the item",
            "properties": {
                "minMight": {
                    "type": "integer",
                    "description": "Minimum Might required to use"
                },
                "minFortitude": {
                    "type": "integer",
                    "description": "Minimum Fortitude required to use"
                },
                "minWill": {
                    "type": "integer",
                    "description": "Minimum Will required to use"
                },
                "minWits": {
                    "type": "integer",
                    "description": "Minimum Wits required to use"
                },
                "minFinesse": {
                    "type": "integer",
                    "description": "Minimum Finesse required to use"
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 11. Configuration File Updates

### New items.json

Create a new `items.json` configuration file with example items covering all categories.

**File:** `config/items.json`

```json
{
    "$schema": "./schemas/items.schema.json",
    "items": [
        {
            "id": "health_potion",
            "name": "Health Potion",
            "description": "A red potion that restores health when consumed.",
            "category": "Consumable",
            "rarity": "Common",
            "stackLimit": 20,
            "weight": 0.5,
            "vendorPrices": {
                "buyPrice": 50,
                "sellPrice": 12
            },
            "consumableEffect": {
                "type": "Heal",
                "value": 50
            }
        },
        {
            "id": "greater_health_potion",
            "name": "Greater Health Potion",
            "description": "A larger red potion that restores significant health.",
            "category": "Consumable",
            "rarity": "Uncommon",
            "stackLimit": 10,
            "weight": 0.5,
            "vendorPrices": {
                "buyPrice": 150,
                "sellPrice": 37
            },
            "consumableEffect": {
                "type": "Heal",
                "value": 150
            }
        },
        {
            "id": "mana_potion",
            "name": "Mana Potion",
            "description": "A blue potion that restores mana when consumed.",
            "category": "Consumable",
            "rarity": "Common",
            "stackLimit": 20,
            "weight": 0.5,
            "vendorPrices": {
                "buyPrice": 75,
                "sellPrice": 18
            },
            "consumableEffect": {
                "type": "RestoreMana",
                "value": 40
            }
        },
        {
            "id": "antidote",
            "name": "Antidote",
            "description": "Cures poison afflictions.",
            "category": "Consumable",
            "rarity": "Common",
            "stackLimit": 10,
            "weight": 0.3,
            "vendorPrices": {
                "buyPrice": 30,
                "sellPrice": 7
            },
            "consumableEffect": {
                "type": "Cure",
                "cleanseType": "Specific",
                "specificEffect": "poisoned"
            }
        },
        {
            "id": "panacea",
            "name": "Panacea",
            "description": "A miracle cure for all ailments.",
            "category": "Consumable",
            "rarity": "Rare",
            "stackLimit": 5,
            "weight": 0.5,
            "vendorPrices": {
                "buyPrice": 500,
                "sellPrice": 125
            },
            "consumableEffect": {
                "type": "Cure",
                "cleanseType": "AllNegative",
                "specificEffect": null
            }
        },
        {
            "id": "strength_elixir",
            "name": "Elixir of Strength",
            "description": "Temporarily increases physical power.",
            "category": "Consumable",
            "rarity": "Uncommon",
            "stackLimit": 10,
            "weight": 0.5,
            "vendorPrices": {
                "buyPrice": 200,
                "sellPrice": 50
            },
            "consumableEffect": {
                "type": "Buff",
                "statusEffect": "strength_boost",
                "duration": 10
            }
        },
        {
            "id": "iron_ore",
            "name": "Iron Ore",
            "description": "Raw iron ore that can be smelted into iron ingots.",
            "category": "Material",
            "rarity": "Common",
            "stackLimit": 99,
            "weight": 2.0,
            "vendorPrices": {
                "buyPrice": 5,
                "sellPrice": 2
            },
            "tags": ["metal", "crafting", "smithing"]
        },
        {
            "id": "leather_strip",
            "name": "Leather Strip",
            "description": "A strip of tanned leather used in crafting.",
            "category": "Material",
            "rarity": "Common",
            "stackLimit": 99,
            "weight": 0.2,
            "vendorPrices": {
                "buyPrice": 3,
                "sellPrice": 1
            },
            "tags": ["leather", "crafting"]
        },
        {
            "id": "magic_dust",
            "name": "Magic Dust",
            "description": "Shimmering dust used for enchanting items.",
            "category": "Material",
            "rarity": "Uncommon",
            "stackLimit": 50,
            "weight": 0.1,
            "vendorPrices": {
                "buyPrice": 25,
                "sellPrice": 6
            },
            "tags": ["magic", "crafting", "enchanting"]
        },
        {
            "id": "dragon_scale",
            "name": "Dragon Scale",
            "description": "A scale from a slain dragon. Extremely valuable for crafting.",
            "category": "Material",
            "rarity": "Epic",
            "stackLimit": 20,
            "weight": 1.0,
            "vendorPrices": {
                "buyPrice": 1000,
                "sellPrice": 250
            },
            "tags": ["dragon", "crafting", "rare"]
        },
        {
            "id": "ancient_tome",
            "name": "Ancient Tome",
            "description": "A dusty book containing forbidden knowledge. The wizard seeks this.",
            "category": "QuestItem",
            "rarity": "Rare",
            "stackLimit": 1,
            "weight": 1.0,
            "isQuestItem": true,
            "isSellable": false,
            "tags": ["quest", "wizard"]
        },
        {
            "id": "royal_seal",
            "name": "Royal Seal",
            "description": "An official seal of the kingdom. Proof of royal authority.",
            "category": "QuestItem",
            "rarity": "Rare",
            "stackLimit": 1,
            "weight": 0.5,
            "isQuestItem": true,
            "isSellable": false,
            "tags": ["quest", "kingdom"]
        },
        {
            "id": "dungeon_key_01",
            "name": "Iron Dungeon Key",
            "description": "A rusty iron key that opens the first dungeon door.",
            "category": "Key",
            "rarity": "Common",
            "stackLimit": 1,
            "weight": 0.1,
            "isSellable": false,
            "tags": ["dungeon", "floor1"]
        },
        {
            "id": "master_key",
            "name": "Master Key",
            "description": "A master key that opens many common locks.",
            "category": "Key",
            "rarity": "Rare",
            "stackLimit": 1,
            "weight": 0.1,
            "isSellable": false,
            "tags": ["universal"]
        },
        {
            "id": "torch",
            "name": "Torch",
            "description": "A wooden torch that provides light in dark areas.",
            "category": "Miscellaneous",
            "rarity": "Common",
            "stackLimit": 10,
            "weight": 0.5,
            "vendorPrices": {
                "buyPrice": 5,
                "sellPrice": 1
            },
            "tags": ["light", "utility"]
        },
        {
            "id": "rope",
            "name": "Rope",
            "description": "A length of sturdy rope. Useful for climbing and tying.",
            "category": "Miscellaneous",
            "rarity": "Common",
            "stackLimit": 5,
            "weight": 1.0,
            "vendorPrices": {
                "buyPrice": 10,
                "sellPrice": 2
            },
            "tags": ["utility", "climbing"]
        },
        {
            "id": "lockpick",
            "name": "Lockpick",
            "description": "A set of lockpicks for opening locks without keys.",
            "category": "Miscellaneous",
            "rarity": "Common",
            "stackLimit": 20,
            "weight": 0.1,
            "vendorPrices": {
                "buyPrice": 15,
                "sellPrice": 3
            },
            "useRequirements": {
                "minLevel": 1,
                "statRequirements": {
                    "minFinesse": 8
                }
            },
            "tags": ["thief", "utility"]
        }
    ]
}
```

### Compatibility with cleanse-items.json

The new items.json schema is designed to be compatible with the existing `cleanse-items.json` pattern. Items from `cleanse-items.json` can be migrated to `items.json` with the Consumable category and Cure effect type.

**Migration Example:**

From `cleanse-items.json`:
```json
{
    "id": "antidote",
    "name": "Antidote",
    "description": "Cures poison afflictions.",
    "cleanseType": "Specific",
    "specificEffect": "poisoned"
}
```

To `items.json`:
```json
{
    "id": "antidote",
    "name": "Antidote",
    "description": "Cures poison afflictions.",
    "category": "Consumable",
    "rarity": "Common",
    "stackLimit": 10,
    "weight": 0.3,
    "vendorPrices": {
        "buyPrice": 30,
        "sellPrice": 7
    },
    "consumableEffect": {
        "type": "Cure",
        "cleanseType": "Specific",
        "specificEffect": "poisoned"
    }
}
```

---

## 12. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file and configuration file. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file added, one config file created |

### Schema as Documentation

The schema serves as:
- **Validation contract** for item configuration
- **IDE documentation** via description fields
- **Modding reference** for custom item systems
- **Design specification** for item mechanics

---

## 13. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 14. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Item Category Enum Validation | ~1 |
| Stack Limit Range Validation | ~1 |
| Consumable Effect Validation | ~1 |
| Configuration File Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### ItemsSchemaTests.cs

```csharp
[TestFixture]
public class ItemsSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the items.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void ItemsJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies category must be a valid enum value.
    /// </summary>
    [Test]
    public void Category_InvalidEnumValue_FailsValidation();

    /// <summary>
    /// Verifies stackLimit must be between 1 and 999.
    /// </summary>
    [Test]
    public void StackLimit_OutOfRange_FailsValidation();

    /// <summary>
    /// Verifies consumableEffect.type must be a valid enum value.
    /// </summary>
    [Test]
    public void ConsumableEffectType_InvalidEnumValue_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 15. Use Cases

### UC-001: Load Item Configuration

**Actor:** Game System
**Flow:** System starts -> Loads `items.json` -> Schema validates content -> Items available for inventory system

### UC-002: Edit Items in IDE

**Actor:** Developer/Modder
**Flow:** Opens `items.json` in VS Code -> IDE loads schema -> Autocomplete suggests properties -> Validation errors shown inline

### UC-003: Add New Consumable

**Actor:** Modder
**Flow:** Adds new item to `items` array -> Sets category to "Consumable" -> Adds consumableEffect -> Sets stackLimit and vendorPrices -> IDE validates structure

### UC-004: Add Quest Item

**Actor:** Modder
**Flow:** Adds new item -> Sets category to "QuestItem" -> Sets isQuestItem=true, isSellable=false -> IDE validates structure

### UC-005: Invalid Stack Limit

**Actor:** Modder
**Flow:** Sets stackLimit to 1000 (over limit) -> IDE shows error "stackLimit must be <= 999" -> Modder corrects to 999

### UC-006: Create Cure Item

**Actor:** Modder
**Flow:** Adds consumable item -> Sets consumableEffect.type to "Cure" -> Sets cleanseType and specificEffect -> IDE validates structure

---

## 16. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/items.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all defined properties
- [ ] Schema includes definitions section (ItemDefinition, ConsumableEffect, UseRequirement, VendorPrices, StatRequirements)

### Validation Rules
- [ ] Item category enum validation: Consumable, Material, QuestItem, Key, Miscellaneous
- [ ] Rarity tier enum validation: Common, Uncommon, Rare, Epic, Legendary
- [ ] Consumable effect type enum validation: Heal, RestoreMana, RestoreStamina, Buff, Cure, Damage, Utility
- [ ] Cleanse type enum validation: Specific, AllNegative, Magical, Elemental
- [ ] ID pattern validation: `^[a-z][a-z0-9_]*$`
- [ ] Stack limit range validation (1-999)
- [ ] Weight non-negative validation
- [ ] Vendor prices non-negative validation
- [ ] Required fields enforced
- [ ] Optional fields have defaults

### Configuration Files
- [ ] `items.json` created with example items
- [ ] Items cover all categories (Consumable, Material, QuestItem, Key, Miscellaneous)
- [ ] Items.json validates against schema

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 17. Acceptance Criteria

### Functional
- [ ] `items.schema.json` created in `config/schemas/` directory
- [ ] Schema validates with sample items
- [ ] Item category enum validated
- [ ] Rarity tier enum validated
- [ ] Stack limit range validated (1-999)
- [ ] Consumable effect structure validated when category is Consumable
- [ ] Vendor prices validated as non-negative
- [ ] Weight validated as non-negative
- [ ] Use requirements validated as optional object
- [ ] Compatible with existing cleanse-items.json pattern
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 18. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `cleanse-items.json` | `config/cleanse-items.json` | Pattern reference for Cure effects |
| Schema patterns | `config/schemas/*.schema.json` | Reference for schema structure |
| StatRequirements pattern | `armor.schema.json` (v0.14.2b) | Shared definition structure |
| Rarity tier enum | `weapons.schema.json` (v0.14.2a) | Shared enumeration |
| Quality tier enum | `armor.schema.json` (v0.14.2b) | Shared enumeration |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `items.schema.json` | Validates item configuration |
| ItemDefinition pattern | Used by loot-tables.json for item references |
| ConsumableEffect definition | Reference for consumable mechanics |
| VendorPrices definition | Reference for economy systems |
| Item categories | Referenced by inventory and loot systems |

### Implementation Order Note

**v0.14.2c can be implemented in parallel with v0.14.2a and v0.14.2b** as they have no internal dependencies.

v0.14.2d (Loot Tables) should be implemented last as it references weapon, armor, and item IDs.

---

## 19. Future Considerations

### Deferred to Future Versions

- **Cross-reference validation**: Validating statusEffect references exist in status-effects.json
- **Crafting recipe system**: Using materials to create items (v0.14.5)
- **Item enchantment system**: Magical properties and upgrades
- **Item set bonuses**: Bonuses for collecting matching items
- **Item durability**: Degradation and repair mechanics

### Out of Scope

- **Runtime schema validation**: Application-level validation at load time (handled by existing provider patterns)
- **Schema versioning migration**: Automatic migration between schema versions
- **Inventory management logic**: Runtime mechanics for item stacking (domain logic, not schema)
- **UI item display**: How items are shown to players (presentation concern)
- **Balance tuning**: Specific values and prices (design decisions)
- **Cleanse-items.json migration**: Existing file remains for backwards compatibility

### Potential Future Enhancements

If the item system expands, consider adding to the schema:

**Crafting Recipe Reference:**
```json
"craftingRecipe": {
    "type": "object",
    "properties": {
        "recipeId": { "type": "string" },
        "outputQuantity": { "type": "integer", "minimum": 1 }
    }
}
```

**Item Set Reference:**
```json
"setId": {
    "type": "string",
    "description": "Reference to item set for set bonus calculation",
    "pattern": "^[a-z][a-z0-9_]*$"
}
```

**Durability System:**
```json
"durability": {
    "type": "object",
    "properties": {
        "maxDurability": { "type": "integer", "minimum": 1 },
        "degradeOnUse": { "type": "boolean", "default": false }
    }
}
```

**Cooldown System:**
```json
"cooldown": {
    "type": "object",
    "properties": {
        "turns": { "type": "integer", "minimum": 1 },
        "sharedCooldownGroup": { "type": "string" }
    }
}
```

**Multiple Effects:**
```json
"consumableEffects": {
    "type": "array",
    "description": "Multiple effects for items that do more than one thing",
    "items": { "$ref": "#/definitions/ConsumableEffect" }
}
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
