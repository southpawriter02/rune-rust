# v0.13.1 Boss & Monster UI - Scope Breakdown

**Version:** 0.13.1
**Theme:** Boss & Monster UI
**Prerequisites:** v0.13.0 Complete (Combat UI), v0.10.4x Services Complete
**Total Estimated Tests:** ~20 new tests

---

## Executive Summary

The Boss & Monster UI version implements all boss encounter and monster group presentation layer components that were deferred during v0.10.4x development. This includes boss health bars with phase markers, phase transition effects, enrage timers, vulnerability windows, and monster group displays with composition views, tactic indicators, and leader designation. These components visualize the boss encounter and monster group state introduced in v0.10.4x without introducing any new domain logic or business rules.

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.1a | Boss Health Bar | Health bar with phase markers, damage animation | ~6 |
| v0.13.1b | Boss Status Display | Phase info, enrage timer, vulnerability window | ~6 |
| v0.13.1c | Monster Group Display | Composition view, tactic indicators, leader badge | ~8 |

---

## Feature Analysis & Categorization

### From v0.13.0-overview.md - Boss Encounter Display (v0.10.4x)

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Boss Health Bar | Medium | IBossEncounterService | **v0.13.1a** |
| Phase Markers | Medium | BossDefinition phases | **v0.13.1a** |
| Damage Animation | Low | Health change events | **v0.13.1a** |
| Phase Transition Effects | Medium | Phase change events | **v0.13.1b** |
| Enrage Timer Display | Low | BossEncounterState | **v0.13.1b** |
| Vulnerability Window Indicator | Low | BossEncounterState | **v0.13.1b** |

### From v0.13.0-overview.md - Monster Group Display (v0.10.4x)

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Group Composition View | Medium | MonsterGroupDefinition | **v0.13.1c** |
| Tactic Indicators | Medium | GroupTactic data | **v0.13.1c** |
| Leader Designation | Low | Leader identification | **v0.13.1c** |

---

## Existing Infrastructure

### From v0.10.4x (Required Services)

| Component | Location | Purpose for v0.13.1 |
|-----------|----------|---------------------|
| `IBossEncounterService` | `Application/Interfaces/IBossEncounterService.cs` | Retrieve boss encounter state |
| `BossDefinition` | `Domain/Entities/BossDefinition.cs` | Boss template with phases |
| `BossPhase` | `Domain/Entities/BossPhase.cs` | Phase configuration |
| `BossEncounterState` | `Domain/Entities/BossEncounterState.cs` | Runtime boss state |
| `MonsterGroupDefinition` | `Domain/Entities/MonsterGroupDefinition.cs` | Group template with composition |
| `GroupTactic` | `Domain/Entities/GroupTactic.cs` | Coordinated behavior definitions |

### From v0.7.x-v0.8.x (Existing UI Infrastructure)

| Component | Location | Purpose for v0.13.1 |
|-----------|----------|---------------------|
| `CombatView` | `Presentation.Tui/Views/CombatView.cs` | Integration point for new components |
| `HealthBar` | `Presentation.Tui/UI/HealthBar.cs` | Pattern reference for bar rendering |
| `ITerminalService` | `Presentation.Tui/Services/ITerminalService.cs` | Terminal output abstraction |

---

## Phase Definitions

---

## v0.13.1a: Boss Health Bar

[v0.13.1a Design Specification](v0.13.1a-design-specification.md)

### Overview

Implement the boss health bar with phase markers and damage animation. The boss health bar is a prominent display that shows the boss's current health, maximum health, and phase threshold markers indicating when the boss will transition to different phases.

### Scope

**In Scope:**
- Boss health bar with percentage display
- Phase markers at threshold positions
- Damage animation when boss takes damage
- Health bar color changes based on percentage
- Boss name header display

**Out of Scope:**
- Phase transition effects (v0.13.1b)
- Enrage timer display (v0.13.1b)
- Vulnerability window indicator (v0.13.1b)
- Monster group display (v0.13.1c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 1 | `BossHealthBar` |
| Renderers | 1 | `BossHealthBarRenderer` |
| View Updates | 1 | `CombatView` integration |
| Unit Tests | ~6 | Health bar, phase markers, animation tests |

### Data Model Changes

```
NEW: BossHealthBar (UI Component)
|-- RenderBar(BossEncounterState): void
|-- ShowPhaseMarkers(IEnumerable<BossPhase>): void
|-- AnimateDamage(int, int): void
+-- UpdateHealth(int, int): void

NEW: BossHealthBarRenderer (Renderer)
|-- FormatHealthText(int, int): string
|-- GetHealthColor(double): ConsoleColor
|-- RenderPhaseMarker(double): string
+-- GetDamageFlashColor(): ConsoleColor
```

### User-Facing Changes

**Boss Health Bar Display Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│                    <<  SKELETON KING  >>                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│   HP: 2,847 / 5,000                                                  │
│   +============================================================+    │
│   |############################................................|    │
│   +============================================================+    │
│                    |                |                |               │
│                 Phase 2          Phase 3          Phase 4            │
│                  (75%)            (50%)            (25%)             │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**Damage Animation:**
```
Boss takes 150 damage!
HP: 2,997 -> 2,847 [-150]
```

### Acceptance Criteria

- [x] Boss health bar displays with correct percentage
- [x] Health text shows current/max HP
- [x] Phase markers show at correct threshold positions
- [x] Damage animation triggers on health change
- [x] Health bar color changes based on percentage
- [x] Boss name displays in header
- [x] ~6 unit tests pass (27 tests implemented and passing)

---

## v0.13.1b: Boss Status Display

[v0.13.1b Design Specification](v0.13.1b-design-specification.md)

### Overview

Implement boss status display components including phase information, phase transition visual effects, enrage timer countdown, and vulnerability window indicator. These components provide critical information about the boss's current state during the encounter.

### Scope

**In Scope:**
- Current phase indicator with phase name
- Phase transition visual effects
- Enrage timer countdown display
- Vulnerability window indicator
- Phase-specific ability hints

**Out of Scope:**
- Boss health bar (v0.13.1a)
- Monster group display (v0.13.1c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 3 | `PhaseIndicator`, `EnrageTimer`, `VulnerabilityWindow` |
| Renderers | 1 | `BossStatusRenderer` |
| View Updates | 1 | `CombatView` integration |
| Unit Tests | ~6 | Phase, enrage, vulnerability tests |

### Data Model Changes

```
NEW: PhaseIndicator (UI Component)
|-- RenderPhase(BossPhase, int): void
|-- ShowTransitionEffect(BossPhase, BossPhase): void
+-- GetPhaseDescription(BossPhase): string

NEW: EnrageTimer (UI Component)
|-- RenderTimer(int): void
|-- ShowEnrageWarning(int): void
+-- ShowEnrageActive(): void

NEW: VulnerabilityWindow (UI Component)
|-- RenderWindow(int): void
|-- ShowWindowOpen(int): void
+-- ShowWindowClosed(): void

NEW: BossStatusRenderer (Renderer)
|-- FormatPhaseText(string, int): string
|-- FormatEnrageTimer(int): string
|-- FormatVulnerabilityWindow(int): string
+-- GetWarningColor(int): ConsoleColor
```

### User-Facing Changes

**Phase Display Example:**
```
Phase: 2 - EMPOWERED
  |-- Increased damage output
  |-- Summons skeleton minions
  +-- Watch for AoE attacks
```

**Phase Transition Effect:**
```
+=====================================================+
|  [!]  PHASE TRANSITION                              |
+=====================================================+
|                                                     |
|  SKELETON KING enters Phase 2: EMPOWERED            |
|                                                     |
|  "Rise, my minions!"                                |
|                                                     |
+=====================================================+
```

**Enrage Timer Display:**
```
[!] Enrage in: 5 turns
```

**Enrage Active Display:**
```
[!!!] ENRAGED - +50% damage, +25% attack speed
```

**Vulnerability Window Display:**
```
[!] VULNERABILITY WINDOW OPEN (2 turns) - Deal +50% damage!
```

### Acceptance Criteria

- [ ] Phase indicator shows current phase name and number
- [ ] Phase transition effect displays on phase change
- [ ] Phase description hints show phase-specific behaviors
- [ ] Enrage timer counts down correctly
- [ ] Enrage warning shows when timer is low
- [ ] Enrage active indicator shows when enraged
- [ ] Vulnerability window indicator shows when active
- [ ] Vulnerability bonus displays correctly
- [ ] ~6 unit tests pass

---

## v0.13.1c: Monster Group Display

[v0.13.1c Design Specification](v0.13.1c-design-specification.md)

### Overview

Implement monster group display showing the composition of grouped enemies, their tactical behaviors, and leader designation. This provides players with strategic information about enemy groups and their coordinated tactics.

### Scope

**In Scope:**
- Group composition view showing all members
- Individual member health bars
- Tactic indicators for coordinated behaviors
- Leader designation badge
- Group morale effects communication

**Out of Scope:**
- Boss health bar (v0.13.1a)
- Boss status display (v0.13.1b)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 3 | `MonsterGroupView`, `TacticIndicator`, `LeaderBadge` |
| Renderers | 1 | `MonsterGroupRenderer` |
| View Updates | 1 | `CombatView` integration |
| Unit Tests | ~8 | Composition, tactic, leader tests |

### Data Model Changes

```
NEW: MonsterGroupView (UI Component)
|-- RenderGroup(MonsterGroupDefinition, IEnumerable<Monster>): void
|-- ShowMemberHealth(Monster): void
|-- HighlightLeader(Monster): void
+-- ShowMoraleEffect(string): void

NEW: TacticIndicator (UI Component)
|-- RenderTactic(GroupTactic): void
|-- ShowTacticDetails(GroupTactic): void
+-- HighlightActiveTactic(): void

NEW: LeaderBadge (UI Component)
|-- RenderBadge(Monster): void
|-- ShowLeaderBonus(IEnumerable<StatModifier>): void
+-- ShowLeaderDefeated(): void

NEW: MonsterGroupRenderer (Renderer)
|-- FormatMemberCard(Monster, bool): string
|-- FormatTacticDescription(GroupTactic): string
|-- GetMemberHealthColor(double): ConsoleColor
+-- GetLeaderBadgeSymbol(): string
```

### User-Facing Changes

**Monster Group Display Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│                      GOBLIN WARBAND                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │
│   │ [*] LEADER  │  │   Goblin    │  │   Goblin    │                 │
│   │   Goblin    │  │   Archer    │  │   Shaman    │                 │
│   │   Chief     │  │             │  │             │                 │
│   │ HP: 45/45   │  │ HP: 20/20   │  │ HP: 25/25   │                 │
│   └─────────────┘  └─────────────┘  └─────────────┘                 │
│                                                                      │
│   TACTIC: Flanking Assault                                           │
│   |-- Archers attack from range                                      │
│   |-- Chief engages in melee                                         │
│   +-- Shaman provides support                                        │
│                                                                      │
│   Kill the Chief to break morale!                                    │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**Leader Defeated Effect:**
```
+=====================================================+
|  [!]  LEADER DEFEATED                               |
+=====================================================+
|                                                     |
|  Goblin Chief has fallen!                           |
|                                                     |
|  Group morale broken:                               |
|  |-- -25% attack for all remaining goblins          |
|  +-- 50% chance to flee on each turn                |
|                                                     |
+=====================================================+
```

**Tactic Change Display:**
```
TACTIC CHANGE: Flanking Assault -> Desperate Defense
  Previous: Aggressive coordinated attacks
  Current: Defensive formation, protecting wounded
```

### Acceptance Criteria

- [ ] Monster group composition displays all members
- [ ] Individual member health bars show correctly
- [ ] Leader designation highlights group leader with badge
- [ ] Tactic indicators show coordinated behaviors
- [ ] Tactic details explain role assignments
- [ ] Group morale effects are communicated
- [ ] Leader defeated effect shows morale impact
- [ ] Tactic changes display when tactics shift
- [ ] ~8 unit tests pass

---

## Dependencies & Prerequisites

```
v0.10.4x (Boss & Monster Systems) - REQUIRED
    |
    |-- v0.10.4a: Boss Definitions ─────────────────────┐
    |       Provides: BossDefinition                     |
    |       Provides: BossPhase                          |
    |                                                    |
    |-- v0.10.4b: Boss Encounter Runtime ───────────────┤
    |       Provides: IBossEncounterService              |
    |       Provides: BossEncounterState                 |
    |                                                    |
    |-- v0.10.4c: Monster Groups ───────────────────────┘
            Provides: MonsterGroupDefinition
            Provides: GroupTactic
                                    |
                                    v
v0.13.1 (Boss & Monster UI)
    |
    |-- v0.13.1a: Boss Health Bar ───────────────────────┐
    |       Dependencies: IBossEncounterService          |
    |       Provides: BossHealthBar                      |
    |                                                    |
    |-- v0.13.1b: Boss Status Display ───────────────────┤
    |       Dependencies: IBossEncounterService          |
    |       Provides: PhaseIndicator, EnrageTimer,       |
    |                 VulnerabilityWindow                |
    |                                                    |
    +-- v0.13.1c: Monster Group Display ─────────────────┘
            Dependencies: MonsterGroupDefinition
            Provides: MonsterGroupView, TacticIndicator,
                      LeaderBadge
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.13.1a | ~3 | ~1 | ~6 | Medium |
| v0.13.1b | ~4 | ~1 | ~6 | Medium |
| v0.13.1c | ~4 | ~1 | ~8 | Medium |
| **Total** | **~11** | **~3** | **~20** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Boss service interfaces differ from expected | Medium | Low | Review v0.10.4x design specs before implementation |
| Phase marker positioning accuracy | Low | Medium | Calculate percentages carefully, test edge cases |
| Animation timing consistency | Low | Medium | Use consistent timing approach from v0.13.0 |
| Group display layout complexity | Medium | Low | Use flexible card-based layout |

---

## Design Decisions (Confirmed)

### Boss Health Bar

| Decision | Value | Notes |
|----------|-------|-------|
| **Bar Width** | 60 characters | Prominent display for boss fights |
| **Phase Marker Format** | `|` with label | Vertical bar at threshold position |
| **Health Color Thresholds** | 75/50/25% | Green/Yellow/Orange/Red |
| **Damage Animation** | Flash + delta | Brief color flash, show HP change |

### Boss Status Display

| Decision | Value | Notes |
|----------|-------|-------|
| **Phase Format** | `Phase #: NAME` | Number and descriptive name |
| **Enrage Warning** | 3 turns | Warning starts at 3 turns remaining |
| **Vulnerability Format** | `[!] WINDOW OPEN (# turns)` | Clear call-to-action |
| **Transition Effect** | Box with message | Prominent but brief |

### Monster Group Display

| Decision | Value | Notes |
|----------|-------|-------|
| **Member Card Layout** | Side-by-side | Horizontal arrangement |
| **Leader Badge** | `[*]` | Asterisk symbol for leader |
| **Tactic Format** | Title + bullet points | Clear role breakdown |
| **Morale Communication** | Box notification | Important strategic info |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.13.1a Design Spec** - Create detailed design for Boss Health Bar
3. **v0.13.1a Implementation** - Build BossHealthBar, BossHealthBarRenderer
4. **v0.13.1b Design Spec** - Create detailed design for Boss Status Display
5. **v0.13.1b Implementation** - Build PhaseIndicator, EnrageTimer, VulnerabilityWindow
6. **v0.13.1c Design Spec** - Create detailed design for Monster Group Display
7. **v0.13.1c Implementation** - Build MonsterGroupView, TacticIndicator, LeaderBadge

---

*This scope breakdown provides a structured approach to implementing v0.13.1 Boss & Monster UI. Each sub-part builds incrementally, with v0.13.1a-b focusing on boss encounter display and v0.13.1c handling monster group visualization. All sub-parts integrate with the existing CombatView.*
