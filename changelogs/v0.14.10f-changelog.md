# v0.14.10f Changelog - Combat Stance Schema

**Release Date:** 2026-01-22
**Version:** 0.14.10f
**Parent:** v0.14.10 (Game Systems Configuration Schemas)
**Prerequisites:** v0.14.1 (Combat Schema), abilities.schema.json

---

## Overview

This version updates the **Combat Stance Schema** (`stances.schema.json`) to a comprehensive JSON Schema Draft-07 specification for validating combat stance configurations. The schema enables definition of stance configurations including stat modifiers, ability restrictions/grants, switching rules, AI behavior patterns, and visual/audio feedback references.

The Combat Stance Schema supports:
- **8 Modifiable Stats**: Attack, Defense, Speed, Accuracy, Evasion, CriticalChance, CriticalDamage, DamageReduction
- **4 Action Costs**: Free, Swift, Standard, Full
- **7 Switch Condition Types**: HealthAbove, HealthBelow, HasStatus, NotHasStatus, InCombat, OutOfCombat, TurnNumber
- **6 Trigger Effect Types**: Heal, Damage, ApplyStatus, RemoveStatus, Buff, Debuff
- **7 AI Condition Types**: HealthBelow, HealthAbove, EnemyCount, AllyCount, StatusActive, TargetWeak, OutNumbered
- **5 Unlock Condition Types**: Level, Quest, Skill, Item, Achievement
- **3 Ability Restriction Types**: Category, Specific, Tag

---

## Changed

### Schema File
- `config/schemas/stances.schema.json` - Updated to comprehensive JSON Schema Draft-07 with 13 definitions

### Schema Definitions (13 Total)

| Definition | Description |
|------------|-------------|
| **CombatStance** | Core stance with modifiers, restrictions, and switching rules |
| **StatModifier** | Stat bonus/penalty with flat or percentage type |
| **AbilityRestriction** | Ability limitations by category, specific ability, or tag |
| **SwitchingRule** | Stance transition costs, cooldowns, and conditions |
| **SwitchCondition** | Requirements for switching stances |
| **TriggerEffect** | Effects triggered on stance switch |
| **AIBehavior** | AI decision-making configuration |
| **AICondition** | Conditions for AI stance evaluation |
| **UnlockCondition** | Stance unlock requirements |
| **ModifiableStat** | Enum of 8 modifiable combat stats |
| **ActionCost** | Enum of 4 action economy costs |
| **AIConditionType** | Enum of 7 AI condition types |
| **UnlockConditionType** | Enum of 5 unlock types |

### Modifiable Stats (8 Stats)

| Stat | Description | Typical Range |
|------|-------------|---------------|
| `attack` | Damage dealt | ±10% to ±40% |
| `defense` | Damage resistance | ±10% to ±35% |
| `speed` | Turn order/movement | ±10% to ±20% |
| `accuracy` | Hit chance | ±10% to ±25% |
| `evasion` | Dodge chance | ±10% to ±30% |
| `criticalChance` | Crit probability | ±5% to ±20% |
| `criticalDamage` | Crit multiplier | ±10% to ±50% |
| `damageReduction` | Flat damage absorbed | ±2 to ±10 |

### Action Cost Types (4 Types)

| Action Cost | Description | Turn Impact |
|-------------|-------------|-------------|
| `Free` | No action required | No turn spent |
| `Swift` | Minor/bonus action | Uses bonus action |
| `Standard` | Main action | Uses main action |
| `Full` | Entire turn | Ends turn immediately |

### Configuration File
- `config/stances.json` - Updated to 6 comprehensive stances:
  - **Balanced**: Neutral stance with no modifiers (default)
  - **Aggressive**: +20% attack, -20% defense, grants power-attack
  - **Defensive**: +25% defense, -15% attack, +3 damage reduction
  - **Evasive**: +30% evasion, +15% speed, -10% defense
  - **Focused**: +20% accuracy, +15% crit chance, +25% crit damage
  - **Reckless**: +40% attack, +20% crit chance, -35% defense (unlock required)

### Unit Tests
- `tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/StanceSchemaTests.cs`
- 73 unit tests covering:
  - STN-001: Schema loads and contains 13 definitions
  - STN-002: Stance identity validation (ID patterns)
  - STN-003: Stat modifier validation (8 stats, 2 types)
  - STN-004: Switching rule validation (4 costs, 7 conditions, 6 effects)
  - STN-005: AI behavior validation (7 conditions, priority, stickiness)
  - STN-006: Unlock conditions and ability restrictions

---

## Technical Details

### Schema Patterns

| Pattern | Convention | Example |
|---------|------------|---------|
| Stance ID | `[a-z][a-z0-9-]*` | `balanced`, `aggressive` |
| Color | `#[0-9A-Fa-f]{6}` | `#CC3333`, `#3366CC` |
| Ability ID | `[a-z][a-z0-9-]*` | `power-attack`, `shield-wall` |

### Schema Constraints

| Field | Constraint |
|-------|------------|
| `stance.id` | Pattern: `^[a-z][a-z0-9-]*$` |
| `stance.name` | minLength: 1, maxLength: 30 |
| `stance.description` | minLength: 1, maxLength: 200 |
| `aiBehavior.priority` | minimum: 0, maximum: 100 |
| `aiBehavior.stickiness` | minimum: 0.0, maximum: 1.0 |
| `aiBehavior.useWhen` | minItems: 1 |
| `stances` | minItems: 1 |
| `switchingRule.cooldown` | minimum: 0 |

### CombatStance Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `id` | string | Yes | Unique identifier (kebab-case) |
| `name` | string | Yes | Display name (1-30 chars) |
| `description` | string | Yes | Tooltip explanation (1-200 chars) |
| `iconId` | string | No | Icon asset reference |
| `color` | string | No | UI highlight color |
| `statModifiers` | array | No | Stat bonuses/penalties |
| `abilityRestrictions` | array | No | Disabled abilities |
| `abilityGrants` | array | No | Enabled ability IDs |
| `switchingRule` | object | No | Switching configuration |
| `incompatibleStances` | array | No | Mutually exclusive stances |
| `aiBehavior` | object | No | AI decision rules |
| `visualEffectId` | string | No | Visual effect on enter |
| `soundEffectId` | string | No | Sound effect on enter |
| `isDefault` | boolean | No | Starting stance option |
| `requiresUnlock` | boolean | No | Needs unlock |
| `unlockCondition` | object | No | Unlock requirements |
| `tags` | array | No | Searchable tags |
| `sortOrder` | integer | No | UI display order |

---

## Test Results

```
Test summary: total: 73, failed: 0, succeeded: 73, skipped: 0
Build succeeded with 0 errors
```

---

## Files Changed

| File | Change Type | Description |
|------|-------------|-------------|
| `config/schemas/stances.schema.json` | Updated | Comprehensive schema with 13 definitions |
| `config/stances.json` | Updated | 6 stances with full features |
| `tests/.../Schemas/StanceSchemaTests.cs` | Added | 73 unit tests |
| `docs/design/v0.14.x/v0.14.10-scope-breakdown.md` | To Update | Mark v0.14.10f criteria |
| `docs/design/v0.14.x/v0.14.x-overview.md` | To Update | Mark stance schema complete |
| `changelogs/v0.14.10f-changelog.md` | Added | This changelog |

---

## Integration Points

The Combat Stance Schema provides configuration for runtime systems:

```
Combat Stance Schema (v0.14.10f)
├── Provides To v0.15.x:
│   ├── Stance System - Runtime stance management
│   ├── Combat AI - Stance selection logic
│   ├── Combat UI - Stance selector display
│   ├── Ability System - Grant/restrict ability access
│   └── Effect System - Visual/audio feedback
```

---

## v0.14.10 Completion Summary

With v0.14.10f complete, all 6 sub-versions of the Game Systems Configuration Schemas are now implemented:

| Version | Schema | Tests | Status |
|---------|--------|-------|--------|
| v0.14.10a | Item Prefixes | 49 | ✅ Complete |
| v0.14.10b | Item Suffixes | 50 | ✅ Complete |
| v0.14.10c | Codex Entries | 52 | ✅ Complete |
| v0.14.10d | Commands | 62 | ✅ Complete |
| v0.14.10e | Glossary | 49 | ✅ Complete |
| **v0.14.10f** | **Stances** | **73** | ✅ Complete |
| **Total** | **6 Schemas** | **335 Tests** | ✅ **All Complete** |

---

*End of v0.14.10f Changelog*
