# v0.16.1c Design Specification: Archetype Proficiency Matrix

**Version:** 0.16.1c  
**Phase Name:** Archetype Proficiency Matrix  
**Parent Version:** v0.16.1 (Weapon Proficiency System)  
**Prerequisites:** v0.16.1a Complete (Proficiency Level Enum), v0.16.1b Complete (Weapon Category System)  
**Estimated Tests:** ~4 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [ArchetypeProficiencySet Entity](#4-archetypeproficiencyset-entity)
5. [IArchetypeProficiencyProvider Interface](#5-iarchetypeproficiencyprovider-interface)
6. [Data Model Changes](#6-data-model-changes)
7. [Configuration File Schemas](#7-configuration-file-schemas)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [Deliverable Checklist](#11-deliverable-checklist)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Dependencies](#13-dependencies)
14. [Future Considerations](#14-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the archetype proficiency matrix, establishing which weapon categories each character archetype is naturally proficient with. This creates archetype identity through distinct combat capabilities without requiring individual weapon-by-weapon proficiency tracking.

The four archetypes have distinctive weapon access:

- **Warrior**: Master of arms, proficient with all weapons and shields
- **Skirmisher**: Light weapons specialist (Daggers, Bows, Crossbows, light melee)
- **Mystic**: Arcane weapons only (Daggers, Staves, ArcaneImplements)
- **Adept**: Hybrid combatant (Daggers, Staves, Hammers, Crossbows)

### 1.2 Key Deliverables

| Category          | Items                                                                 |
| ----------------- | --------------------------------------------------------------------- |
| **Entities**      | `ArchetypeProficiencySet`                                             |
| **Interfaces**    | `IArchetypeProficiencyProvider`                                       |
| **Configuration** | `archetype-proficiencies.json`, `archetype-proficiencies.schema.json` |
| **Tests**         | ~4 unit tests                                                         |

### 1.3 Architectural Significance

This version establishes the **Archetype-Driven Proficiency Pattern**:

- **Matrix-Based Lookup**: Archetype + Category → Proficiency Level
- **Starting Proficiency Rules**: Archetypes start Proficient in listed categories, NonProficient elsewhere
- **Configuration-Driven Design**: Matrix can be adjusted without code changes
- **Provider Pattern**: `IArchetypeProficiencyProvider` centralizes matrix access

---

## 2. Feature Overview

```
v0.16.1c Archetype Proficiency Matrix
├── ArchetypeProficiencySet Entity
│   ├── ArchetypeId: string (e.g., "warrior", "mystic")
│   ├── DisplayName: string (e.g., "Warrior")
│   ├── Description: string
│   ├── ProficientCategories: IReadOnlyList<WeaponCategory>
│   └── IsProficientWith(category): bool
├── IArchetypeProficiencyProvider Interface
│   ├── GetProficiencySet(archetypeId): ArchetypeProficiencySet
│   ├── GetAllProficiencySets(): IReadOnlyList<ArchetypeProficiencySet>
│   ├── IsProficient(archetypeId, category): bool
│   ├── GetStartingProficiencyLevel(archetypeId, category): WeaponProficiencyLevel
│   └── ValidateConfiguration(): bool
└── Configuration: archetype-proficiencies.json
    ├── Warrior → All 11 categories
    ├── Skirmisher → 5 categories (Daggers, Swords, Axes, Bows, Crossbows)
    ├── Mystic → 3 categories (Daggers, Staves, ArcaneImplements)
    └── Adept → 4 categories (Daggers, Staves, Hammers, Crossbows)
```

### 2.1 Scope Alignment

**In Scope:**

- `ArchetypeProficiencySet` domain entity
- `IArchetypeProficiencyProvider` application interface
- `archetype-proficiencies.json` configuration file
- `archetype-proficiencies.schema.json` validation schema
- Starting proficiency level determination (Proficient vs NonProficient)
- Matrix validation logic

**Out of Scope:**

- Character-level tracking (v0.16.1d)
- Proficiency acquisition methods (v0.16.1e)
- Combat modifier application (v0.16.1f)
- Dynamic proficiency changes during gameplay (v0.16.1e)

---

## 3. Architecture Diagrams

### 3.1 Archetype Proficiency System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│              ARCHETYPE PROFICIENCY SYSTEM OVERVIEW                   │
└─────────────────────────────────────────────────────────────────────┘

    Character Creation
         │
         │  Select archetype (Warrior, Skirmisher, Mystic, Adept)
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│                 IArchetypeProficiencyProvider                        │
├─────────────────────────────────────────────────────────────────────┤
│  + GetProficiencySet(archetypeId): ArchetypeProficiencySet          │
│  + GetStartingProficiencyLevel(archetypeId, category): Level        │
│  + IsProficient(archetypeId, category): bool                        │
└─────────────────────────────────────────────────────────────────────┘
         │
         │  Load archetype matrix from configuration
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   ArchetypeProficiencySet                            │
├─────────────────────────────────────────────────────────────────────┤
│  ArchetypeId: string                                                 │
│  DisplayName: string                                                 │
│  Description: string                                                 │
│  ProficientCategories: IReadOnlyList<WeaponCategory>                 │
│                                                                      │
│  + IsProficientWith(category): bool                                 │
│  + GetStartingLevel(category): WeaponProficiencyLevel               │
└─────────────────────────────────────────────────────────────────────┘
         │
         │  Return starting proficiency levels
         ▼
┌─────────────────────────────────────────────────────────────────────┐
│               Character Proficiency Initialization                   │
│                      (v0.16.1d)                                      │
├─────────────────────────────────────────────────────────────────────┤
│  For each weapon category:                                           │
│    IF archetype is proficient → WeaponProficiencyLevel.Proficient   │
│    ELSE → WeaponProficiencyLevel.NonProficient                       │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Archetype Matrix Lookup Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                  ARCHETYPE PROFICIENCY LOOKUP FLOW                   │
└─────────────────────────────────────────────────────────────────────┘

    Character Created (e.g., Warrior)
         │
         ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  1. GET ARCHETYPE PROFICIENCY SET                                 │
    ├──────────────────────────────────────────────────────────────────┤
    │  archetypeId = "warrior"                                          │
    │  proficiencySet = provider.GetProficiencySet(archetypeId)        │
    └──────────────────────────────────────────────────────────────────┘
         │
         ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  2. INITIALIZE CHARACTER PROFICIENCIES                            │
    ├──────────────────────────────────────────────────────────────────┤
    │  For each WeaponCategory:                                         │
    │    ├─ Axes?       → proficiencySet.IsProficientWith(Axes)        │
    │    │               → TRUE → Proficient                            │
    │    ├─ Swords?     → proficiencySet.IsProficientWith(Swords)      │
    │    │               → TRUE → Proficient                            │
    │    ├─ Hammers?    → TRUE → Proficient                            │
    │    ├─ Daggers?    → TRUE → Proficient                            │
    │    ├─ Polearms?   → TRUE → Proficient                            │
    │    ├─ Staves?     → TRUE → Proficient                            │
    │    ├─ Bows?       → TRUE → Proficient                            │
    │    ├─ Crossbows?  → TRUE → Proficient                            │
    │    ├─ Shields?    → TRUE → Proficient                            │
    │    ├─ Firearms?   → TRUE → Proficient (requires special training)│
    │    └─ ArcaneImpl? → TRUE → Proficient                            │
    │                                                                   │
    │  Result: Warrior is Proficient with ALL categories                │
    └──────────────────────────────────────────────────────────────────┘
         │
         ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │  3. EXAMPLE: MYSTIC ARCHETYPE                                     │
    ├──────────────────────────────────────────────────────────────────┤
    │  archetypeId = "mystic"                                           │
    │  proficiencySet.ProficientCategories = [Daggers, Staves,          │
    │                                         ArcaneImplements]          │
    │                                                                   │
    │  For each WeaponCategory:                                         │
    │    ├─ Axes?       → FALSE → NonProficient (-3 attack, -2 damage) │
    │    ├─ Swords?     → FALSE → NonProficient                         │
    │    ├─ Hammers?    → FALSE → NonProficient                         │
    │    ├─ Daggers?    → TRUE → Proficient                            │
    │    ├─ Polearms?   → FALSE → NonProficient                         │
    │    ├─ Staves?     → TRUE → Proficient                            │
    │    ├─ Bows?       → FALSE → NonProficient                         │
    │    ├─ Crossbows?  → FALSE → NonProficient                         │
    │    ├─ Shields?    → FALSE → NonProficient                         │
    │    ├─ Firearms?   → FALSE → NonProficient                         │
    │    └─ ArcaneImpl? → TRUE → Proficient                            │
    └──────────────────────────────────────────────────────────────────┘
```

### 3.3 Archetype Matrix Visualization

```
┌─────────────────────────────────────────────────────────────────────┐
│                   ARCHETYPE PROFICIENCY MATRIX                       │
└─────────────────────────────────────────────────────────────────────┘

Category          │ Warrior │ Skirmisher │ Mystic │ Adept │
──────────────────┼─────────┼────────────┼────────┼───────┤
Axes              │   ✓     │     ✓      │   ✗    │  ✗    │
Swords            │   ✓     │     ✓      │   ✗    │  ✗    │
Hammers           │   ✓     │     ✗      │   ✗    │  ✓    │
Daggers           │   ✓     │     ✓      │   ✓    │  ✓    │
Polearms          │   ✓     │     ✗      │   ✗    │  ✗    │
Staves            │   ✓     │     ✗      │   ✓    │  ✓    │
Bows              │   ✓     │     ✓      │   ✗    │  ✗    │
Crossbows         │   ✓     │     ✓      │   ✗    │  ✓    │
Shields           │   ✓     │     ✗      │   ✗    │  ✗    │
Firearms          │   ✓     │     ✗      │   ✗    │  ✗    │
ArcaneImplements  │   ✓     │     ✗      │   ✓    │  ✗    │
──────────────────┼─────────┼────────────┼────────┼───────┤
Total Proficient  │   11    │      5     │   3    │   4   │


✓ = Proficient (starts with Proficient level)
✗ = NonProficient (starts with NonProficient level, -3 attack, -2 damage)

NOTES:
- Warrior: Master of arms, proficient with everything
- Skirmisher: Light weapons (Daggers, Swords, Axes, Bows, Crossbows)
- Mystic: Arcane focus only (Daggers, Staves, ArcaneImplements)
- Adept: Hybrid combatant (Daggers, Staves, Hammers, Crossbows)
```

### 3.4 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  CharacterCreationView                                               │
│  └── Displays archetype proficiency preview                         │
│                                                                      │
│  CharacterSheet                                                      │
│  └── Shows proficiency matrix for current archetype                 │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │           ArchetypeProficiencyProvider                         │  │
│  │       (implements IArchetypeProficiencyProvider)               │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  + GetProficiencySet(archetypeId): ArchetypeProficiencySet    │  │
│  │  + GetAllProficiencySets(): IReadOnlyList                     │  │
│  │  + IsProficient(archetypeId, category): bool                  │  │
│  │  + GetStartingProficiencyLevel(id, cat): Level                │  │
│  │  + ValidateConfiguration(): bool                              │  │
│  │                                                               │  │
│  │  - LoadConfiguration(): void (from JSON)                      │  │
│  │  - _proficiencySets: Dictionary<string, ProficiencySet>       │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  CharacterCreationService (v0.16.1d)                                 │
│  └── Uses provider to initialize character proficiencies            │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │              ArchetypeProficiencySet                         │   │
│  │                    (Entity)                                  │   │
│  ├─────────────────────────────────────────────────────────────┤   │
│  │  Id: Guid                                                    │   │
│  │  ArchetypeId: string                                         │   │
│  │  DisplayName: string                                         │   │
│  │  Description: string                                         │   │
│  │  ProficientCategories: IReadOnlyList<WeaponCategory>         │   │
│  │                                                              │   │
│  │  + IsProficientWith(category): bool                         │   │
│  │  + GetStartingLevel(category): WeaponProficiencyLevel       │   │
│  │  + GetProficientCategoryCount(): int                        │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. ArchetypeProficiencySet Entity

### 4.1 Purpose

The `ArchetypeProficiencySet` entity represents the proficiency matrix for a single archetype. It defines which weapon categories the archetype starts with proficiency in.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Entities/ArchetypeProficiencySet.cs`

```csharp
namespace RuneAndRust.Domain.Entities;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.Interfaces;

/// <summary>
/// Defines weapon category proficiencies for a character archetype.
/// </summary>
/// <remarks>
/// <para>
/// ArchetypeProficiencySet determines which weapon categories a character
/// is naturally proficient with based on their archetype choice. Characters
/// start with Proficient level in listed categories and NonProficient in
/// all others.
/// </para>
/// <para>
/// This entity is loaded from configuration and is immutable after creation.
/// </para>
/// </remarks>
public class ArchetypeProficiencySet : IEntity
{
    private readonly List<WeaponCategory> _proficientCategories;

    /// <summary>
    /// Gets the unique identifier for this proficiency set.
    /// </summary>
    public Guid Id { get; private set; }

    /// <summary>
    /// Gets the archetype identifier (e.g., "warrior", "mystic").
    /// </summary>
    /// <remarks>
    /// This should match the archetype ID in the character creation system.
    /// </remarks>
    public string ArchetypeId { get; private set; }

    /// <summary>
    /// Gets the human-readable archetype name (e.g., "Warrior").
    /// </summary>
    public string DisplayName { get; private set; }

    /// <summary>
    /// Gets the description of this archetype's combat style.
    /// </summary>
    public string Description { get; private set; }

    /// <summary>
    /// Gets the weapon categories this archetype is proficient with.
    /// </summary>
    public IReadOnlyList<WeaponCategory> ProficientCategories =>
        _proficientCategories.AsReadOnly();

    // Private constructor for EF Core
    private ArchetypeProficiencySet()
    {
        ArchetypeId = null!;
        DisplayName = null!;
        Description = null!;
        _proficientCategories = new List<WeaponCategory>();
    }

    /// <summary>
    /// Creates a new ArchetypeProficiencySet.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier.</param>
    /// <param name="displayName">The display name.</param>
    /// <param name="description">The archetype description.</param>
    /// <param name="proficientCategories">Categories the archetype is proficient with.</param>
    /// <returns>A new ArchetypeProficiencySet instance.</returns>
    /// <exception cref="ArgumentException">Thrown when string parameters are null or empty.</exception>
    /// <exception cref="ArgumentNullException">Thrown when proficientCategories is null.</exception>
    public static ArchetypeProficiencySet Create(
        string archetypeId,
        string displayName,
        string description,
        IEnumerable<WeaponCategory> proficientCategories)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(archetypeId);
        ArgumentException.ThrowIfNullOrWhiteSpace(displayName);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);
        ArgumentNullException.ThrowIfNull(proficientCategories);

        var categoriesList = proficientCategories.ToList();
        if (categoriesList.Count == 0)
        {
            throw new ArgumentException(
                "Archetype must be proficient with at least one category.",
                nameof(proficientCategories));
        }

        return new ArchetypeProficiencySet
        {
            Id = Guid.NewGuid(),
            ArchetypeId = archetypeId.ToLowerInvariant(),
            DisplayName = displayName,
            Description = description,
            _proficientCategories = categoriesList
        };
    }

    /// <summary>
    /// Checks if this archetype is proficient with a weapon category.
    /// </summary>
    /// <param name="category">The weapon category to check.</param>
    /// <returns>True if proficient, false otherwise.</returns>
    public bool IsProficientWith(WeaponCategory category)
    {
        return _proficientCategories.Contains(category);
    }

    /// <summary>
    /// Gets the starting proficiency level for a weapon category.
    /// </summary>
    /// <param name="category">The weapon category.</param>
    /// <returns>
    /// Proficient if the archetype is proficient with the category,
    /// NonProficient otherwise.
    /// </returns>
    public WeaponProficiencyLevel GetStartingLevel(WeaponCategory category)
    {
        return IsProficientWith(category)
            ? WeaponProficiencyLevel.Proficient
            : WeaponProficiencyLevel.NonProficient;
    }

    /// <summary>
    /// Gets the count of categories this archetype is proficient with.
    /// </summary>
    public int GetProficientCategoryCount() => _proficientCategories.Count;

    /// <summary>
    /// Gets whether this is a versatile archetype (proficient with 7+ categories).
    /// </summary>
    public bool IsVersatile => GetProficientCategoryCount() >= 7;

    /// <summary>
    /// Gets whether this is a specialist archetype (proficient with 3 or fewer categories).
    /// </summary>
    public bool IsSpecialist => GetProficientCategoryCount() <= 3;

    /// <summary>
    /// Gets whether this archetype is proficient with all weapon categories.
    /// </summary>
    public bool IsProficientWithAllWeapons =>
        GetProficientCategoryCount() == Enum.GetValues<WeaponCategory>().Length;

    /// <summary>
    /// Creates a display string for debug/logging purposes.
    /// </summary>
    public override string ToString() =>
        $"{DisplayName} ({ArchetypeId}): {GetProficientCategoryCount()} proficiencies";
}
```

---

## 5. IArchetypeProficiencyProvider Interface

### 5.1 Purpose

The `IArchetypeProficiencyProvider` interface abstracts access to archetype proficiency data, enabling configuration-driven matrix definitions.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Application/Interfaces/IArchetypeProficiencyProvider.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;

/// <summary>
/// Provides access to archetype proficiency matrix data.
/// </summary>
/// <remarks>
/// <para>
/// This interface abstracts the source of archetype proficiency data,
/// allowing it to be loaded from configuration files, databases, or
/// hardcoded defaults.
/// </para>
/// <para>
/// Implementations should cache loaded proficiency sets for performance
/// and validate that all archetypes have corresponding entries.
/// </para>
/// </remarks>
public interface IArchetypeProficiencyProvider
{
    /// <summary>
    /// Gets the proficiency set for a specific archetype.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier (e.g., "warrior").</param>
    /// <returns>The archetype's proficiency set.</returns>
    /// <exception cref="ArgumentException">Thrown when archetype is not found.</exception>
    ArchetypeProficiencySet GetProficiencySet(string archetypeId);

    /// <summary>
    /// Gets proficiency sets for all archetypes.
    /// </summary>
    /// <returns>All archetype proficiency sets.</returns>
    IReadOnlyList<ArchetypeProficiencySet> GetAllProficiencySets();

    /// <summary>
    /// Checks if an archetype is proficient with a weapon category.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier.</param>
    /// <param name="category">The weapon category.</param>
    /// <returns>True if proficient, false otherwise.</returns>
    bool IsProficient(string archetypeId, WeaponCategory category);

    /// <summary>
    /// Gets the starting proficiency level for an archetype and category.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier.</param>
    /// <param name="category">The weapon category.</param>
    /// <returns>
    /// Proficient if archetype is proficient with category,
    /// NonProficient otherwise.
    /// </returns>
    WeaponProficiencyLevel GetStartingProficiencyLevel(
        string archetypeId,
        WeaponCategory category);

    /// <summary>
    /// Gets all categories an archetype is proficient with.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier.</param>
    /// <returns>List of proficient weapon categories.</returns>
    IReadOnlyList<WeaponCategory> GetProficientCategories(string archetypeId);

    /// <summary>
    /// Gets all categories an archetype is NOT proficient with.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier.</param>
    /// <returns>List of non-proficient weapon categories.</returns>
    IReadOnlyList<WeaponCategory> GetNonProficientCategories(string archetypeId);

    /// <summary>
    /// Gets the count of categories an archetype is proficient with.
    /// </summary>
    /// <param name="archetypeId">The archetype identifier.</param>
    /// <returns>Number of proficient categories.</returns>
    int GetProficientCategoryCount(string archetypeId);

    /// <summary>
    /// Validates that all required archetypes have proficiency sets.
    /// </summary>
    /// <returns>True if all archetypes are configured, false otherwise.</returns>
    bool ValidateConfiguration();
}
```

### 5.3 Usage Examples

```csharp
// Get proficiency set for Warrior
var warriorSet = _proficiencyProvider.GetProficiencySet("warrior");
Console.WriteLine($"{warriorSet.DisplayName}: {warriorSet.GetProficientCategoryCount()} proficiencies");
// Output: "Warrior: 11 proficiencies"

// Check if Mystic is proficient with Swords
var isMysticProficientWithSwords = _proficiencyProvider.IsProficient("mystic", WeaponCategory.Swords);
Console.WriteLine($"Mystic proficient with Swords: {isMysticProficientWithSwords}");
// Output: "Mystic proficient with Swords: False"

// Get starting level for Skirmisher with Bows
var startingLevel = _proficiencyProvider.GetStartingProficiencyLevel("skirmisher", WeaponCategory.Bows);
Console.WriteLine($"Skirmisher Bow proficiency: {startingLevel}");
// Output: "Skirmisher Bow proficiency: Proficient"

// Initialize character proficiencies
var archetypeId = "adept";
var characterProficiencies = new Dictionary<WeaponCategory, WeaponProficiencyLevel>();

foreach (var category in Enum.GetValues<WeaponCategory>())
{
    var level = _proficiencyProvider.GetStartingProficiencyLevel(archetypeId, category);
    characterProficiencies[category] = level;
}
// Adept will have Proficient for Daggers, Staves, Hammers, Crossbows
// and NonProficient for all others
```

---

## 6. Data Model Changes

### 6.1 New Types Summary

| Type                            | Layer       | Category  | Description                          |
| ------------------------------- | ----------- | --------- | ------------------------------------ |
| `ArchetypeProficiencySet`       | Domain      | Entity    | Proficiency matrix for one archetype |
| `IArchetypeProficiencyProvider` | Application | Interface | Matrix data access abstraction       |

### 6.2 File Locations

```
src/Core/RuneAndRust.Domain/
└── Entities/
    └── ArchetypeProficiencySet.cs       ← NEW

src/Core/RuneAndRust.Application/
└── Interfaces/
    └── IArchetypeProficiencyProvider.cs ← NEW

config/
├── archetype-proficiencies.json         ← NEW
└── schemas/
    └── archetype-proficiencies.schema.json ← NEW
```

### 6.3 Entity Relationships

```
┌───────────────────────────────┐
│  ArchetypeProficiencySet      │
│         (Entity)              │
├───────────────────────────────┤
│  ArchetypeId: string          │
│  DisplayName: string          │
│  ProficientCategories: List   │
└────────────┬──────────────────┘
             │
             │ contains
             ▼
┌───────────────────────────────┐         ┌─────────────────────────┐
│     WeaponCategory            │◄────────│  WeaponProficiencyLevel │
│         (Enum)                │  maps to│         (Enum)          │
└───────────────────────────────┘         └─────────────────────────┘
             │                                         ▲
             │                                         │
             │                                         │ returns
             ▼                                         │
┌───────────────────────────────────────────────────────────────────┐
│              IArchetypeProficiencyProvider                         │
│                      (Interface)                                   │
└───────────────────────────────────────────────────────────────────┘
```

---

## 7. Configuration File Schemas

### 7.1 archetype-proficiencies.json

**File:** `config/archetype-proficiencies.json`

```json
{
    "$schema": "./schemas/archetype-proficiencies.schema.json",
    "archetypes": [
        {
            "archetypeId": "warrior",
            "displayName": "Warrior",
            "description": "Master of arms, proficient with all weapons and armor. Warriors excel in direct combat and can effectively wield any weapon they find.",
            "proficientCategories": [
                "Axes",
                "Swords",
                "Hammers",
                "Daggers",
                "Polearms",
                "Staves",
                "Bows",
                "Crossbows",
                "Shields",
                "Firearms",
                "ArcaneImplements"
            ]
        },
        {
            "archetypeId": "skirmisher",
            "displayName": "Skirmisher",
            "description": "Light weapons specialist favoring speed and precision. Skirmishers excel with finesse weapons and ranged combat, avoiding heavy armor and two-handed melee weapons.",
            "proficientCategories": [
                "Daggers",
                "Swords",
                "Axes",
                "Bows",
                "Crossbows"
            ]
        },
        {
            "archetypeId": "mystic",
            "displayName": "Mystic",
            "description": "Arcane practitioner who channels magical energies. Mystics are proficient only with weapons that complement spellcasting, relying on magic rather than martial prowess.",
            "proficientCategories": ["Daggers", "Staves", "ArcaneImplements"]
        },
        {
            "archetypeId": "adept",
            "displayName": "Adept",
            "description": "Hybrid combatant blending martial and mystical techniques. Adepts are proficient with select melee and ranged weapons that support their versatile fighting style.",
            "proficientCategories": [
                "Daggers",
                "Staves",
                "Hammers",
                "Crossbows"
            ]
        }
    ]
}
```

### 7.2 archetype-proficiencies.schema.json

**File:** `config/schemas/archetype-proficiencies.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "archetype-proficiencies.schema.json",
    "title": "Archetype Proficiencies Configuration",
    "description": "Defines weapon category proficiencies for each character archetype",
    "type": "object",
    "required": ["archetypes"],
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON schema reference"
        },
        "archetypes": {
            "type": "array",
            "description": "Array of archetype proficiency definitions",
            "minItems": 4,
            "items": {
                "$ref": "#/$defs/archetypeProficiency"
            }
        }
    },
    "$defs": {
        "archetypeProficiency": {
            "type": "object",
            "description": "Proficiency definition for a single archetype",
            "required": [
                "archetypeId",
                "displayName",
                "description",
                "proficientCategories"
            ],
            "properties": {
                "archetypeId": {
                    "type": "string",
                    "description": "Unique identifier for the archetype",
                    "pattern": "^[a-z]+$",
                    "enum": ["warrior", "skirmisher", "mystic", "adept"]
                },
                "displayName": {
                    "type": "string",
                    "description": "Human-readable archetype name",
                    "minLength": 1,
                    "maxLength": 50
                },
                "description": {
                    "type": "string",
                    "description": "Flavor text describing the archetype's combat style",
                    "minLength": 20,
                    "maxLength": 500
                },
                "proficientCategories": {
                    "type": "array",
                    "description": "Weapon categories the archetype is proficient with",
                    "minItems": 1,
                    "items": {
                        "type": "string",
                        "enum": [
                            "Axes",
                            "Swords",
                            "Hammers",
                            "Daggers",
                            "Polearms",
                            "Staves",
                            "Bows",
                            "Crossbows",
                            "Shields",
                            "Firearms",
                            "ArcaneImplements"
                        ]
                    },
                    "uniqueItems": true
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 8. Logging Specifications

### 8.1 Log Levels by Component

| Component                      | Level       | Events                                     |
| ------------------------------ | ----------- | ------------------------------------------ |
| `ArchetypeProficiencyProvider` | Information | Configuration loaded, validation complete  |
| `ArchetypeProficiencyProvider` | Debug       | Proficiency lookup, category query         |
| `ArchetypeProficiencyProvider` | Warning     | Missing archetype, invalid archetype ID    |
| `ArchetypeProficiencyProvider` | Error       | Configuration file not found, invalid JSON |

### 8.2 Structured Logging Templates

```csharp
// Information - Configuration loaded
_logger.LogInformation(
    "Archetype proficiencies loaded. ArchetypeCount={Count}",
    archetypes.Count);

// Information - Validation complete
_logger.LogInformation(
    "Archetype proficiencies validated. AllArchetypesPresent={AllPresent}, " +
    "TotalProficiencies={TotalCount}",
    allPresent,
    totalProficiencies);

// Debug - Proficiency retrieved
_logger.LogDebug(
    "Proficiency checked. ArchetypeId={ArchetypeId}, Category={Category}, " +
    "IsProficient={IsProficient}",
    archetypeId,
    category,
    isProficient);

// Warning - Missing archetype
_logger.LogWarning(
    "Archetype not found in configuration. ArchetypeId={ArchetypeId}",
    archetypeId);

// Error - Configuration failure
_logger.LogError(
    "Failed to load archetype proficiencies. FilePath={FilePath}, Error={Error}",
    filePath,
    exception.Message);
```

---

## 9. Unit Testing Requirements

### 9.1 Test Count by Feature

| Feature                        | Test Count |
| ------------------------------ | ---------- |
| ArchetypeProficiencySet entity | ~2         |
| IArchetypeProficiencyProvider  | ~2         |
| **Total**                      | **~4**     |

### 9.2 Test Specifications

#### ArchetypeProficiencySetTests.cs

**File:** `tests/RuneAndRust.Domain.UnitTests/Entities/ArchetypeProficiencySetTests.cs`

```csharp
[TestFixture]
public class ArchetypeProficiencySetTests
{
    [Test]
    public void Create_WithValidParameters_CreatesProficiencySet();

    [Test]
    public void Create_WithNullArchetypeId_ThrowsArgumentException();

    [Test]
    public void Create_WithEmptyProficientCategories_ThrowsArgumentException();

    [Test]
    public void IsProficientWith_WhenCategoryInList_ReturnsTrue();

    [Test]
    public void IsProficientWith_WhenCategoryNotInList_ReturnsFalse();

    [Test]
    public void GetStartingLevel_ForProficientCategory_ReturnsProficient();

    [Test]
    public void GetStartingLevel_ForNonProficientCategory_ReturnsNonProficient();

    [Test]
    public void IsProficientWithAllWeapons_ForWarriorWith11Categories_ReturnsTrue();

    [Test]
    public void IsProficientWithAllWeapons_ForMysticWith3Categories_ReturnsFalse();

    [Test]
    public void IsSpecialist_ForMysticWith3Categories_ReturnsTrue();

    [Test]
    public void IsVersatile_ForWarriorWith11Categories_ReturnsTrue();
}
```

#### IArchetypeProficiencyProviderTests.cs

**File:** `tests/RuneAndRust.Application.UnitTests/Interfaces/IArchetypeProficiencyProviderTests.cs`

```csharp
[TestFixture]
public class ArchetypeProficiencyProviderTests
{
    private IArchetypeProficiencyProvider _provider;

    [SetUp]
    public void SetUp()
    {
        // Load test configuration or use mock
        _provider = new ArchetypeProficiencyProvider(/* test config */);
    }

    [Test]
    public void GetProficiencySet_ForWarrior_ReturnsWarriorSet();

    [Test]
    public void GetProficiencySet_ForInvalidArchetype_ThrowsArgumentException();

    [Test]
    public void IsProficient_WarriorWithAxes_ReturnsTrue();

    [Test]
    public void IsProficient_MysticWithSwords_ReturnsFalse();

    [Test]
    public void GetStartingProficiencyLevel_SkirmisherWithBows_ReturnsProficient();

    [Test]
    public void GetStartingProficiencyLevel_AdeptWithPolearms_ReturnsNonProficient();

    [Test]
    public void GetProficientCategories_ForMystic_Returns3Categories();

    [Test]
    public void GetNonProficientCategories_ForWarrior_Returns0Categories();

    [Test]
    public void GetProficientCategoryCount_ForSkirmisher_Returns5();

    [Test]
    public void ValidateConfiguration_WithAllArchetypes_ReturnsTrue();
}
```

---

## 10. Use Cases

### UC-001: Initialize Character Proficiencies

**Actor:** Character Creation Service  
**Flow:** Select archetype → Get proficiency set → For each category, assign Proficient or NonProficient level → Store in character entity

### UC-002: Display Archetype Proficiency Preview

**Actor:** Character Creation UI  
**Flow:** Get proficiency set for archetype → Display proficient categories with checkmarks → Display non-proficient categories with warnings

### UC-003: Validate Archetype Matrix on Startup

**Actor:** Application Startup  
**Flow:** Load configuration → Parse archetype proficiency sets → Validate all 4 archetypes present → Log validation result

### UC-004: Check Weapon Restrictions

**Actor:** Equipment Service  
**Flow:** Get equipped weapon category → Get character archetype → Check if archetype is proficient → Apply proficiency effects if non-proficient

---

## 11. Deliverable Checklist

### Domain Layer

- [ ] `ArchetypeProficiencySet.cs` entity created in `src/Core/RuneAndRust.Domain/Entities/`
- [ ] Entity has complete XML documentation
- [ ] Factory method `Create()` with validation

### Application Layer

- [ ] `IArchetypeProficiencyProvider.cs` interface created in `src/Core/RuneAndRust.Application/Interfaces/`
- [ ] Interface has complete XML documentation

### Configuration Files

- [ ] `config/archetype-proficiencies.json` created with all 4 archetypes
- [ ] `config/schemas/archetype-proficiencies.schema.json` created
- [ ] Configuration validates against schema

### Testing

- [ ] `ArchetypeProficiencySetTests.cs` created
- [ ] `ArchetypeProficiencyProviderTests.cs` created (or mock tests)
- [ ] ~4 unit tests passing

### Documentation

- [ ] `v0.16.1c-changelog.md` created
- [ ] Inline code comments complete

---

## 12. Acceptance Criteria

### Functional

- [ ] `ArchetypeProficiencySet` entity correctly stores archetype ID and proficient categories
- [ ] Warrior proficient with all 11 weapon categories
- [ ] Skirmisher proficient with Daggers, Swords, Axes, Bows, Crossbows (5 categories)
- [ ] Mystic proficient with Daggers, Staves, ArcaneImplements (3 categories)
- [ ] Adept proficient with Daggers, Staves, Hammers, Crossbows (4 categories)
- [ ] `IsProficientWith()` returns correct boolean for each archetype/category combination
- [ ] `GetStartingLevel()` returns Proficient for proficient categories
- [ ] `GetStartingLevel()` returns NonProficient for non-proficient categories
- [ ] `IArchetypeProficiencyProvider.GetProficiencySet()` returns correct set for each archetype
- [ ] `IArchetypeProficiencyProvider.ValidateConfiguration()` returns true when all archetypes present

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~4 unit tests pass
- [ ] Configuration validates against JSON schema
- [ ] All public types have XML documentation

---

## 13. Dependencies

### Required from v0.16.1a

| Type                     | Usage                              |
| ------------------------ | ---------------------------------- |
| `WeaponProficiencyLevel` | Return type for GetStartingLevel() |

### Required from v0.16.1b

| Type             | Usage                             |
| ---------------- | --------------------------------- |
| `WeaponCategory` | Used in ProficientCategories list |

### Provides to v0.16.1d

| Type                            | Usage                                      |
| ------------------------------- | ------------------------------------------ |
| `ArchetypeProficiencySet`       | Used to initialize character proficiencies |
| `IArchetypeProficiencyProvider` | Character creation queries matrix          |

### Provides to v0.16.1f

| Type                            | Usage                                 |
| ------------------------------- | ------------------------------------- |
| `IArchetypeProficiencyProvider` | Combat checks archetype proficiencies |

---

## 14. Future Considerations

### Deferred to v0.16.1d

- **CharacterProficiencies Entity**: Per-character proficiency state storage
- **ProficiencyProgress Value Object**: Experience tracking per category

### Deferred to v0.16.1e

- **IProficiencyAcquisitionService**: Training and experience logic to advance from NonProficient → Proficient
- **Dynamic proficiency changes**: Archetypes can gain new proficiencies through gameplay

### Out of Scope

- **Per-Weapon Proficiency**: Proficiency is category-based, not individual weapons
- **Archetype Subclasses**: Single archetype definition per type
- **Proficiency Prerequisites**: All categories are independently trainable
- **Restricted Categories**: All categories available to learn (though some start NonProficient)

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_  
_Author: AI Assistant_
