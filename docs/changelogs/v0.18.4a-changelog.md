# v0.18.4a Changelog — Rage System (Berserker)

**Release Date:** 2026-02-01  
**Version:** 0.18.4a

## Summary

Implements the Domain Layer Foundation for the **Rage System** — a volatile combat resource for the Berserker specialization powered by violence and pain. This establishes the core enums, entity, and value objects for rage management.

---

## Added

### Domain Layer — Enums

- **RageThreshold.cs** — 5-value enum representing rage intensity tiers:
    - `Calm` (0-20 rage) — No significant bonuses
    - `Simmering` (21-40 rage) — Building power
    - `Burning` (41-60 rage) — Significant aggression
    - `BerserkFury` (61-80 rage) — Overwhelming power
    - `FrenzyBeyondReason` (81-100 rage) — Ultimate fury with consequences

- **RageSource.cs** — 5-value enum representing rage generation sources:
    - `TakingDamage` — floor(damage/5) rage
    - `DealingDamage` — floor(damage/10) rage
    - `AllyDamaged` — 5 rage per ally damaged
    - `EnemyKill` — 15 rage per kill
    - `RageMaintenance` — 5 rage per turn at FrenzyBeyondReason

### Domain Layer — Entity

- **RageState.cs** — Core domain entity tracking Berserker rage status:
    - `Create()` factory method with threshold computation
    - `DetermineThreshold()` static method for threshold lookup
    - `DamageBonus` — floor(rage/10), ranges 0-10
    - `DamageTakenReduction` — floor(rage/20) \* 5%, ranges 0-25%
    - `SoakBonus` — 0-4 scaling by threshold
    - `FearImmune` — true only at FrenzyBeyondReason
    - `MustAttackNearest` — true at BerserkFury and above
    - `PartyStressReduction` — 10 at FrenzyBeyondReason
    - Constants for all threshold boundaries

### Domain Layer — Value Objects

- **RageGainResult.cs** — Immutable record for rage gain transactions:
    - Tracks previous/new rage, amount gained, source
    - Threshold change detection
    - `CappedAtMaximum` and `IsCriticalGain` computed properties

- **RageDecayResult.cs** — Immutable record for rage decay transactions:
    - Tracks previous/new rage, amount decayed
    - Threshold change detection
    - `ZeroedOut` and `ExitedFrenzy` computed properties

### Tests

- **RageStateTests.cs** — 60 unit tests covering:
    - Factory method creation (valid and invalid)
    - Threshold boundary tests (parameterized)
    - Damage bonus calculations
    - Soak bonus scaling
    - Damage taken reduction
    - Special effects (FearImmune, MustAttackNearest, PartyStressReduction)
    - Edge cases (clamping, negative values, over-max)
    - ToString formatting

---

## Verification

```
dotnet build → 0 errors, 0 warnings
dotnet test RageStateTests → 60/60 passed
dotnet test (full suite) → 4034+ passed
```

---

## Files Added

| Path                                                            | Description                   |
| --------------------------------------------------------------- | ----------------------------- |
| `src/Core/RuneAndRust.Domain/Enums/RageThreshold.cs`            | Rage intensity threshold enum |
| `src/Core/RuneAndRust.Domain/Enums/RageSource.cs`               | Rage generation source enum   |
| `src/Core/RuneAndRust.Domain/Entities/RageState.cs`             | Core rage state entity        |
| `src/Core/RuneAndRust.Domain/ValueObjects/RageGainResult.cs`    | Rage gain transaction record  |
| `src/Core/RuneAndRust.Domain/ValueObjects/RageDecayResult.cs`   | Rage decay transaction record |
| `tests/RuneAndRust.Domain.UnitTests/Entities/RageStateTests.cs` | Unit tests for RageState      |

---

## Dependencies

- **Prerequisite:** v0.17.4 (Specialization System), v0.18.0 (Psychic Stress)
- **Next Phase:** v0.18.4b (Momentum System) or v0.18.4d (Service Interfaces)
