# v0.9.0 Audio Foundation - Scope Breakdown

**Version:** 0.9.0
**Theme:** Audio Foundation
**Prerequisites:** v0.8.3c Complete (GUI Polish - Combat Summary)
**Total Estimated Tests:** ~20 new tests

---

## Executive Summary

The Audio Foundation sub-version establishes the core audio infrastructure that all audio features will build upon. This includes the core audio service for playing and managing audio files, audio configuration with volume controls per channel, integration with the settings window, and TUI console bell support for important events.

Key focus areas:
- **Core Audio Service**: IAudioService with play, pause, volume, and mute
- **Audio Configuration**: Settings persistence and channel management
- **TUI Bell Integration**: Console beep patterns for TUI events

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.9.0a | Core Audio Service | IAudioService, AudioService, file loading, channels | ~8 |
| v0.9.0b | Audio Settings Integration | Settings tab, volume controls, persistence | ~6 |
| v0.9.0c | TUI Bell Service | ITuiBellService, bell patterns, event triggers | ~6 |

---

## Existing Infrastructure

### Already Implemented (from v0.8.x)

| Feature | Location | Notes |
|---------|----------|-------|
| SettingsWindow | `Views/SettingsWindow.axaml` | Settings UI |
| SettingsService | `Services/SettingsService.cs` | Settings storage |
| AudioSettingsTab | `Views/AudioSettingsTab.axaml` | Placeholder UI |
| EventBus | `Services/EventBus.cs` | Event system |

### Already Implemented (from prior versions)

| Feature | Location | Notes |
|---------|----------|-------|
| GameStateService | `Services/GameStateService.cs` | State tracking |
| SettingsConfiguration | `config/settings.json` | Settings storage |
| TUI Renderer | `Presentation/TUI/TuiRenderer.cs` | Console output |

### Needs Implementation (v0.9.0)

| Feature | Part | Notes |
|---------|------|-------|
| IAudioService | v0.9.0a | Audio interface |
| AudioService | v0.9.0a | Core audio player |
| AudioCache | v0.9.0a | File caching |
| AudioSettingsViewModel | v0.9.0b | Settings binding |
| Audio config in settings.json | v0.9.0b | Persistence |
| ITuiBellService | v0.9.0c | Bell interface |
| TuiBellService | v0.9.0c | Console beep |
| BellType enum | v0.9.0c | Bell patterns |

---

## Feature Analysis & Categorization

### Core Audio Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Audio playback | High | NAudio library | **v0.9.0a** |
| Audio channels | Medium | Service design | **v0.9.0a** |
| File loading | Medium | File system | **v0.9.0a** |
| Audio caching | Medium | Memory management | **v0.9.0a** |
| Volume control | Low | Audio service | **v0.9.0a** |
| Mute functionality | Low | Audio service | **v0.9.0a** |

### Settings Integration Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Audio settings UI | Medium | XAML + VM | **v0.9.0b** |
| Volume sliders | Low | Settings binding | **v0.9.0b** |
| Mute checkbox | Low | Settings binding | **v0.9.0b** |
| Settings persistence | Medium | SettingsService | **v0.9.0b** |
| Real-time preview | Low | Audio service | **v0.9.0b** |

### TUI Bell Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Console beep | Low | Console API | **v0.9.0c** |
| Bell patterns | Low | Timing | **v0.9.0c** |
| Event triggers | Medium | EventBus | **v0.9.0c** |
| Enable/disable | Low | Settings | **v0.9.0c** |

---

## Part Definitions

---

## v0.9.0a: Core Audio Service

[v0.9.0a Design Specification](v0.9.0a-design-specification.md)

### Overview

Implement the core audio service that provides audio playback capabilities for the entire application. This includes the IAudioService interface, AudioService implementation using NAudio (or similar cross-platform library), audio channel management for separate volume control, and audio file caching for efficient reuse.

### Scope

**In Scope:**
- `IAudioService` interface definition
- `AudioService` implementation
- Audio channel enum (Master, Music, Effects, UI, Voice)
- Play/stop/pause/resume methods
- Volume control per channel
- Master volume affecting all channels
- Mute per channel and global mute
- `AudioCache` for loaded files
- Preload capability for performance
- File format support (OGG, WAV, MP3)
- Cross-fade helper (for music system)
- Disposal and cleanup

**Out of Scope:**
- Settings UI (v0.9.0b)
- TUI bells (v0.9.0c)
- Music themes (v0.9.1)
- Sound effects mapping (v0.9.2)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Interfaces | 1 | `IAudioService` |
| Services | 1 | `AudioService` |
| Support Classes | 2 | `AudioCache`, `AudioChannel` |
| Configuration | 1 | `audio.json` schema |
| Unit Tests | ~8 | Playback, volume, cache tests |

### Audio Service Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                       AUDIO SERVICE ARCHITECTURE                     │
└─────────────────────────────────────────────────────────────────────┘

                        ┌───────────────────────────┐
                        │       Application          │
                        │  (Game Services, UI, etc.) │
                        └─────────────┬─────────────┘
                                      │
                                      ▼
                        ┌───────────────────────────┐
                        │      IAudioService         │
                        │  - Play(path, channel)     │
                        │  - Stop(channel)           │
                        │  - SetVolume(channel, vol) │
                        │  - SetMuted(channel, mute) │
                        └─────────────┬─────────────┘
                                      │
                        ┌─────────────┴─────────────┐
                        │        AudioService        │
                        ├───────────────────────────┤
                        │ + Channels:               │
                        │   - Master (affects all)  │
                        │   - Music                 │
                        │   - Effects               │
                        │   - UI                    │
                        │   - Voice                 │
                        │                           │
                        │ + AudioCache              │
                        │   - Loaded file cache     │
                        │   - LRU eviction          │
                        └─────────────┬─────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    ▼                 ▼                 ▼
          ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
          │   NAudio/Bass   │ │    File Loader   │ │   AudioPlayer   │
          │   (Backend)     │ │   (OGG/WAV/MP3)  │ │   (Channels)    │
          └─────────────────┘ └─────────────────┘ └─────────────────┘
```

### IAudioService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Core audio playback service for the application.
/// </summary>
public interface IAudioService : IDisposable
{
    /// <summary>Plays an audio file on a channel.</summary>
    /// <param name="audioPath">Path to the audio file.</param>
    /// <param name="channel">Channel to play on.</param>
    /// <param name="volume">Volume multiplier (0.0-1.0).</param>
    /// <param name="loop">Whether to loop the audio.</param>
    /// <returns>Playback ID for control.</returns>
    Guid Play(string audioPath, AudioChannel channel, float volume = 1.0f, bool loop = false);
    
    /// <summary>Stops playback by ID.</summary>
    void Stop(Guid playbackId);
    
    /// <summary>Stops all playback on a channel.</summary>
    void StopChannel(AudioChannel channel);
    
    /// <summary>Stops all playback.</summary>
    void StopAll();
    
    /// <summary>Pauses playback by ID.</summary>
    void Pause(Guid playbackId);
    
    /// <summary>Pauses all playback on a channel.</summary>
    void PauseChannel(AudioChannel channel);
    
    /// <summary>Resumes paused playback by ID.</summary>
    void Resume(Guid playbackId);
    
    /// <summary>Resumes all paused playback on a channel.</summary>
    void ResumeChannel(AudioChannel channel);
    
    /// <summary>Sets volume for a channel (0.0-1.0).</summary>
    void SetChannelVolume(AudioChannel channel, float volume);
    
    /// <summary>Gets current volume for a channel.</summary>
    float GetChannelVolume(AudioChannel channel);
    
    /// <summary>Sets mute state for a channel.</summary>
    void SetChannelMuted(AudioChannel channel, bool muted);
    
    /// <summary>Gets mute state for a channel.</summary>
    bool IsChannelMuted(AudioChannel channel);
    
    /// <summary>Preloads audio files into cache.</summary>
    Task PreloadAsync(IEnumerable<string> audioPaths, CancellationToken ct = default);
    
    /// <summary>Clears the audio cache.</summary>
    void ClearCache();
    
    /// <summary>Gets whether audio is currently enabled.</summary>
    bool IsEnabled { get; }
    
    /// <summary>Enables or disables all audio.</summary>
    void SetEnabled(bool enabled);
}
```

### AudioChannel Enum

```csharp
namespace RuneAndRust.Application.Enums;

/// <summary>
/// Audio channels for separate volume control.
/// </summary>
public enum AudioChannel
{
    /// <summary>Master volume affecting all channels.</summary>
    Master,
    
    /// <summary>Background music.</summary>
    Music,
    
    /// <summary>Combat and game sound effects.</summary>
    Effects,
    
    /// <summary>UI interaction sounds.</summary>
    UI,
    
    /// <summary>Voice/dialogue audio (future).</summary>
    Voice
}
```

### AudioService Implementation

```csharp
namespace RuneAndRust.Infrastructure.Services;

public class AudioService : IAudioService
{
    private readonly ILogger<AudioService> _logger;
    private readonly AudioCache _cache;
    private readonly Dictionary<AudioChannel, float> _channelVolumes;
    private readonly Dictionary<AudioChannel, bool> _channelMuted;
    private readonly Dictionary<Guid, AudioPlayback> _activePlaybacks;
    private bool _isEnabled = true;
    
    public AudioService(ILogger<AudioService> logger)
    {
        _logger = logger;
        _cache = new AudioCache(maxSize: 50);
        _channelVolumes = InitializeDefaultVolumes();
        _channelMuted = InitializeDefaultMutes();
        _activePlaybacks = new Dictionary<Guid, AudioPlayback>();
    }
    
    public bool IsEnabled => _isEnabled;
    
    public Guid Play(string audioPath, AudioChannel channel, float volume = 1.0f, bool loop = false)
    {
        if (!_isEnabled || _channelMuted[channel] || _channelMuted[AudioChannel.Master])
        {
            _logger.LogDebug("Audio disabled or muted, skipping: {Path}", audioPath);
            return Guid.Empty;
        }
        
        var audioData = _cache.GetOrLoad(audioPath);
        if (audioData is null)
        {
            _logger.LogWarning("Failed to load audio: {Path}", audioPath);
            return Guid.Empty;
        }
        
        var effectiveVolume = CalculateEffectiveVolume(channel, volume);
        var playbackId = Guid.NewGuid();
        
        var playback = new AudioPlayback(playbackId, audioData, effectiveVolume, loop);
        _activePlaybacks[playbackId] = playback;
        
        playback.Start();
        
        _logger.LogDebug("Playing audio: {Path} on {Channel} at {Volume}", 
            audioPath, channel, effectiveVolume);
        
        return playbackId;
    }
    
    public void SetChannelVolume(AudioChannel channel, float volume)
    {
        volume = Math.Clamp(volume, 0.0f, 1.0f);
        _channelVolumes[channel] = volume;
        
        // Update active playbacks on this channel
        UpdateActivePlaybackVolumes(channel);
        
        _logger.LogDebug("Set {Channel} volume to {Volume}", channel, volume);
    }
    
    public float GetChannelVolume(AudioChannel channel)
    {
        return _channelVolumes.GetValueOrDefault(channel, 1.0f);
    }
    
    private float CalculateEffectiveVolume(AudioChannel channel, float baseVolume)
    {
        var masterVolume = _channelVolumes[AudioChannel.Master];
        var channelVolume = _channelVolumes[channel];
        return masterVolume * channelVolume * baseVolume;
    }
    
    private Dictionary<AudioChannel, float> InitializeDefaultVolumes()
    {
        return new Dictionary<AudioChannel, float>
        {
            [AudioChannel.Master] = 0.8f,
            [AudioChannel.Music] = 0.6f,
            [AudioChannel.Effects] = 0.8f,
            [AudioChannel.UI] = 0.7f,
            [AudioChannel.Voice] = 0.9f
        };
    }
    
    public void Dispose()
    {
        StopAll();
        _cache.Clear();
    }
}
```

### AudioCache

```csharp
namespace RuneAndRust.Infrastructure.Services;

/// <summary>
/// Caches loaded audio files for efficient reuse.
/// </summary>
public class AudioCache
{
    private readonly int _maxSize;
    private readonly Dictionary<string, CachedAudio> _cache;
    private readonly LinkedList<string> _accessOrder;
    
    public AudioCache(int maxSize = 50)
    {
        _maxSize = maxSize;
        _cache = new Dictionary<string, CachedAudio>();
        _accessOrder = new LinkedList<string>();
    }
    
    public CachedAudio? GetOrLoad(string path)
    {
        if (_cache.TryGetValue(path, out var cached))
        {
            // Move to front (most recently used)
            _accessOrder.Remove(path);
            _accessOrder.AddFirst(path);
            return cached;
        }
        
        // Load and cache
        var audio = LoadAudioFile(path);
        if (audio is null) return null;
        
        // Evict oldest if full
        while (_cache.Count >= _maxSize)
        {
            var oldest = _accessOrder.Last!.Value;
            _accessOrder.RemoveLast();
            _cache.Remove(oldest);
        }
        
        _cache[path] = audio;
        _accessOrder.AddFirst(path);
        
        return audio;
    }
    
    private CachedAudio? LoadAudioFile(string path)
    {
        // Implementation depends on audio library
        // NAudio: new AudioFileReader(path)
        // Returns decoded audio data
    }
    
    public void Clear()
    {
        _cache.Clear();
        _accessOrder.Clear();
    }
}
```

### Acceptance Criteria

- [ ] AudioService can play audio files
- [ ] Playback returns a controllable ID
- [ ] Stop/pause/resume work correctly
- [ ] Multiple channels are supported
- [ ] Volume control works per channel
- [ ] Master volume affects all channels
- [ ] Mute works per channel and globally
- [ ] Audio files are cached after first load
- [ ] LRU eviction works for cache
- [ ] Preload loads files into cache
- [ ] Service disposes cleanly
- [ ] ~8 unit tests pass

---

## v0.9.0b: Audio Settings Integration

[v0.9.0b Design Specification](v0.9.0b-design-specification.md)

### Overview

Integrate the audio service with the settings window, making the audio tab fully functional. This includes binding volume sliders to actual audio channels, mute checkboxes, and persistence of audio settings across sessions.

### Scope

**In Scope:**
- `AudioSettingsViewModel` with channel bindings
- Master volume slider
- Music volume slider
- Effects volume slider
- UI volume slider
- Mute All checkbox
- Enable Audio checkbox
- Real-time volume preview
- Settings persistence to JSON
- Load settings on startup
- Apply settings on change

**Out of Scope:**
- Core audio service (v0.9.0a)
- TUI bells (v0.9.0c)
- Audio file selection (not needed)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| ViewModels | 1 | `AudioSettingsViewModel` |
| XAML Updates | 1 | `AudioSettingsTab.axaml` bindings |
| Configuration | 1 | Audio section in `settings.json` |
| Unit Tests | ~6 | Settings binding, persistence tests |

### Audio Settings Tab Design

```
┌─────────────────────────────────────────────────────────────────────┐
│                         SETTINGS                                     │
├────────────┬────────────────────────────────────────────────────────┤
│            │                                                         │
│  [Audio]   │  AUDIO SETTINGS                                        │
│   Display  │  ══════════════════════════════════════════════════    │
│   Gameplay │                                                         │
│   Controls │  ☑ Enable Audio                                        │
│            │                                                         │
│            │  ┌───────────────────────────────────────────────────┐ │
│            │  │ Master Volume                                      │ │
│            │  │ ├────────────────────●──────────────┤  80%        │ │
│            │  │                                                    │ │
│            │  │ Music Volume                                       │ │
│            │  │ ├──────────────●────────────────────┤  60%        │ │
│            │  │                                                    │ │
│            │  │ Sound Effects                                      │ │
│            │  │ ├────────────────────●──────────────┤  80%        │ │
│            │  │                                                    │ │
│            │  │ UI Sounds                                          │ │
│            │  │ ├───────────────────●───────────────┤  70%        │ │
│            │  └───────────────────────────────────────────────────┘ │
│            │                                                         │
│            │  ☐ Mute All Audio                                       │
│            │                                                         │
│            │  ──────────────────────────────────────────────────    │
│            │  TUI OPTIONS (Console Mode)                            │
│            │  ☑ Enable Console Bells                                │
│            │                                                         │
├────────────┴────────────────────────────────────────────────────────┤
│                      [ Apply ]  [ Cancel ]  [ OK ]                   │
└─────────────────────────────────────────────────────────────────────┘
```

### AudioSettingsViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class AudioSettingsViewModel : ViewModelBase
{
    private readonly IAudioService _audioService;
    private readonly ISettingsService _settingsService;
    
    [ObservableProperty]
    private bool _isAudioEnabled = true;
    
    [ObservableProperty]
    private float _masterVolume = 0.8f;
    
    [ObservableProperty]
    private float _musicVolume = 0.6f;
    
    [ObservableProperty]
    private float _effectsVolume = 0.8f;
    
    [ObservableProperty]
    private float _uiVolume = 0.7f;
    
    [ObservableProperty]
    private bool _isMuted;
    
    [ObservableProperty]
    private bool _tuiBellEnabled = true;
    
    public AudioSettingsViewModel(IAudioService audioService, ISettingsService settingsService)
    {
        _audioService = audioService;
        _settingsService = settingsService;
        
        LoadSettings();
    }
    
    partial void OnIsAudioEnabledChanged(bool value)
    {
        _audioService.SetEnabled(value);
    }
    
    partial void OnMasterVolumeChanged(float value)
    {
        _audioService.SetChannelVolume(AudioChannel.Master, value);
        // Play preview sound
        PlayPreviewSound();
    }
    
    partial void OnMusicVolumeChanged(float value)
    {
        _audioService.SetChannelVolume(AudioChannel.Music, value);
    }
    
    partial void OnEffectsVolumeChanged(float value)
    {
        _audioService.SetChannelVolume(AudioChannel.Effects, value);
        PlayPreviewSound();
    }
    
    partial void OnUiVolumeChanged(float value)
    {
        _audioService.SetChannelVolume(AudioChannel.UI, value);
        PlayPreviewSound();
    }
    
    partial void OnIsMutedChanged(bool value)
    {
        _audioService.SetChannelMuted(AudioChannel.Master, value);
    }
    
    private void PlayPreviewSound()
    {
        // Play a short UI click to preview volume
        _audioService.Play("audio/sfx/ui/click.ogg", AudioChannel.UI);
    }
    
    private void LoadSettings()
    {
        var settings = _settingsService.GetAudioSettings();
        
        IsAudioEnabled = settings.Enabled;
        MasterVolume = settings.MasterVolume;
        MusicVolume = settings.MusicVolume;
        EffectsVolume = settings.EffectsVolume;
        UiVolume = settings.UiVolume;
        IsMuted = settings.Muted;
        TuiBellEnabled = settings.TuiBellEnabled;
    }
    
    public void SaveSettings()
    {
        var settings = new AudioSettings
        {
            Enabled = IsAudioEnabled,
            MasterVolume = MasterVolume,
            MusicVolume = MusicVolume,
            EffectsVolume = EffectsVolume,
            UiVolume = UiVolume,
            Muted = IsMuted,
            TuiBellEnabled = TuiBellEnabled
        };
        
        _settingsService.SaveAudioSettings(settings);
    }
}
```

### Audio Settings Configuration

```json
{
  "audio": {
    "enabled": true,
    "masterVolume": 0.8,
    "musicVolume": 0.6,
    "effectsVolume": 0.8,
    "uiVolume": 0.7,
    "muted": false,
    "tuiBellEnabled": true
  }
}
```

### Acceptance Criteria

- [ ] Audio tab shows all volume sliders
- [ ] Enable Audio checkbox works
- [ ] Master volume slider adjusts all audio
- [ ] Music volume slider adjusts music
- [ ] Effects volume slider adjusts SFX
- [ ] UI volume slider adjusts UI sounds
- [ ] Mute All checkbox mutes everything
- [ ] Volume changes preview with sound
- [ ] Settings persist after closing
- [ ] Settings load on startup
- [ ] TUI Bells checkbox present
- [ ] ~6 unit tests pass

---

## v0.9.0c: TUI Bell Service

[v0.9.0c Design Specification](v0.9.0c-design-specification.md)

### Overview

Implement a TUI bell service that provides console beep notifications for important events when running in terminal mode. Different bell patterns indicate different event types (info, warning, combat, level-up, etc.).

### Scope

**In Scope:**
- `ITuiBellService` interface
- `TuiBellService` implementation
- `BellType` enum for patterns
- Bell patterns using Console.Beep
- Info bell (single short beep)
- Warning bell (double beep)
- Error bell (long beep)
- Combat bell (quick triple beep)
- Level-up bell (ascending tones)
- Quest complete bell (celebratory pattern)
- Enable/disable toggle
- Event subscriptions for triggers
- Cross-platform fallback (no beep if unsupported)

**Out of Scope:**
- Core audio service (v0.9.0a)
- Settings UI (v0.9.0b, but uses TUI setting)
- GUI sound effects (v0.9.2)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Interfaces | 1 | `ITuiBellService` |
| Services | 1 | `TuiBellService` |
| Enums | 1 | `BellType` |
| Event Handlers | 1 | `TuiBellEventHandler` |
| Unit Tests | ~6 | Bell pattern, enable/disable tests |

### TUI Bell Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                       TUI BELL ARCHITECTURE                          │
└─────────────────────────────────────────────────────────────────────┘

     Game Events                    TUI Bell Service         Console
     ───────────                    ────────────────         ───────
     
     [LevelUp] ──────────────────▶  Bell(LevelUp)  ──────▶  ♪ ♪ ♪
                                         │                  (ascending)
     [CombatStart] ──────────────▶  Bell(Combat)   ──────▶  ♪♪♪
                                         │                  (quick triple)
     [QuestComplete] ────────────▶  Bell(Quest)    ──────▶  ♪ ♫ ♪
                                         │                  (celebratory)
     [Warning] ──────────────────▶  Bell(Warning)  ──────▶  ♪ ♪
                                         │                  (double)
     [Error] ────────────────────▶  Bell(Error)    ──────▶  ♪───
                                                            (long)
```

### ITuiBellService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Provides console beep notifications for TUI mode.
/// </summary>
public interface ITuiBellService
{
    /// <summary>Plays a bell pattern for the specified type.</summary>
    void Bell(BellType type);
    
    /// <summary>Plays a custom bell pattern.</summary>
    void BellCustom(int frequency, int durationMs);
    
    /// <summary>Gets whether bells are enabled.</summary>
    bool IsEnabled { get; }
    
    /// <summary>Enables or disables bell sounds.</summary>
    void SetEnabled(bool enabled);
}

/// <summary>
/// Bell pattern types for different events.
/// </summary>
public enum BellType
{
    /// <summary>Single short beep for general info.</summary>
    Info,
    
    /// <summary>Double beep for warnings.</summary>
    Warning,
    
    /// <summary>Long beep for errors.</summary>
    Error,
    
    /// <summary>Quick triple beep for combat start.</summary>
    Combat,
    
    /// <summary>Ascending tones for level up.</summary>
    LevelUp,
    
    /// <summary>Celebratory pattern for quest completion.</summary>
    QuestComplete,
    
    /// <summary>Danger pattern for low health.</summary>
    LowHealth,
    
    /// <summary>Simple notification beep.</summary>
    Notification
}
```

### TuiBellService Implementation

```csharp
namespace RuneAndRust.Infrastructure.Services;

public class TuiBellService : ITuiBellService
{
    private readonly ILogger<TuiBellService> _logger;
    private bool _isEnabled = true;
    
    public bool IsEnabled => _isEnabled;
    
    public TuiBellService(ILogger<TuiBellService> logger)
    {
        _logger = logger;
    }
    
    public void SetEnabled(bool enabled)
    {
        _isEnabled = enabled;
        _logger.LogDebug("TUI bells {State}", enabled ? "enabled" : "disabled");
    }
    
    public void Bell(BellType type)
    {
        if (!_isEnabled) return;
        
        try
        {
            switch (type)
            {
                case BellType.Info:
                    PlayPattern(new[] { (800, 100) });
                    break;
                    
                case BellType.Warning:
                    PlayPattern(new[] { (600, 100), (600, 100) });
                    break;
                    
                case BellType.Error:
                    PlayPattern(new[] { (400, 500) });
                    break;
                    
                case BellType.Combat:
                    PlayPattern(new[] { (1000, 50), (1000, 50), (1000, 50) });
                    break;
                    
                case BellType.LevelUp:
                    PlayPattern(new[] { (400, 100), (600, 100), (800, 100), (1000, 200) });
                    break;
                    
                case BellType.QuestComplete:
                    PlayPattern(new[] { (800, 100), (1000, 100), (800, 100), (1200, 200) });
                    break;
                    
                case BellType.LowHealth:
                    PlayPattern(new[] { (300, 200), (300, 200) });
                    break;
                    
                case BellType.Notification:
                    PlayPattern(new[] { (700, 150) });
                    break;
            }
            
            _logger.LogDebug("Played bell: {Type}", type);
        }
        catch (PlatformNotSupportedException)
        {
            _logger.LogDebug("Console.Beep not supported on this platform");
        }
    }
    
    public void BellCustom(int frequency, int durationMs)
    {
        if (!_isEnabled) return;
        
        try
        {
            Console.Beep(frequency, durationMs);
        }
        catch (PlatformNotSupportedException)
        {
            // Silently ignore on unsupported platforms
        }
    }
    
    private void PlayPattern((int frequency, int durationMs)[] pattern)
    {
        foreach (var (freq, duration) in pattern)
        {
            Console.Beep(freq, duration);
            Thread.Sleep(50); // Brief pause between beeps
        }
    }
}
```

### TuiBellEventHandler

```csharp
namespace RuneAndRust.Application.EventHandlers;

/// <summary>
/// Subscribes to game events and triggers TUI bells.
/// </summary>
public class TuiBellEventHandler : IDisposable
{
    private readonly ITuiBellService _bellService;
    private readonly IEventBus _eventBus;
    private readonly List<IDisposable> _subscriptions = new();
    
    public TuiBellEventHandler(ITuiBellService bellService, IEventBus eventBus)
    {
        _bellService = bellService;
        _eventBus = eventBus;
        
        RegisterSubscriptions();
    }
    
    private void RegisterSubscriptions()
    {
        _subscriptions.Add(_eventBus.Subscribe<CombatStartedEvent>(
            _ => _bellService.Bell(BellType.Combat)));
        
        _subscriptions.Add(_eventBus.Subscribe<LevelUpEvent>(
            _ => _bellService.Bell(BellType.LevelUp)));
        
        _subscriptions.Add(_eventBus.Subscribe<QuestCompletedEvent>(
            _ => _bellService.Bell(BellType.QuestComplete)));
        
        _subscriptions.Add(_eventBus.Subscribe<LowHealthEvent>(
            _ => _bellService.Bell(BellType.LowHealth)));
        
        _subscriptions.Add(_eventBus.Subscribe<ErrorEvent>(
            _ => _bellService.Bell(BellType.Error)));
        
        _subscriptions.Add(_eventBus.Subscribe<WarningEvent>(
            _ => _bellService.Bell(BellType.Warning)));
    }
    
    public void Dispose()
    {
        foreach (var sub in _subscriptions)
        {
            sub.Dispose();
        }
    }
}
```

### Acceptance Criteria

- [ ] TuiBellService plays console beeps
- [ ] Info bell is single short beep
- [ ] Warning bell is double beep
- [ ] Error bell is long beep
- [ ] Combat bell is quick triple beep
- [ ] Level-up bell is ascending tones
- [ ] Quest complete bell is celebratory
- [ ] Bells can be enabled/disabled
- [ ] Settings toggle affects bells
- [ ] Unsupported platforms don't crash
- [ ] Event subscriptions trigger bells
- [ ] ~6 unit tests pass

---

## Dependencies & Prerequisites

```
v0.8.3c (Combat Summary) - REQUIRED
    │
    └── GUI Polish complete ──────────────────────────────────────────────┐
                                                                          │
v0.9.0 (Audio Foundation)                                                 │
    │                                                                     │
    ├── v0.9.0a: Core Audio Service ──────────────────────────────────────┤
    │       Dependencies: NAudio or similar library                       │
    │       Provides: IAudioService, AudioCache                           │
    │                                                                     │
    ├── v0.9.0b: Audio Settings Integration ──────────────────────────────┤
    │       Dependencies: v0.9.0a (audio service), SettingsService        │
    │       Provides: AudioSettingsViewModel, persistence                 │
    │                                                                     │
    └── v0.9.0c: TUI Bell Service ────────────────────────────────────────┘
            Dependencies: Console API, EventBus
            Provides: ITuiBellService, bell patterns
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.9.0a | ~4 | ~1 | ~8 | High |
| v0.9.0b | ~2 | ~2 | ~6 | Medium |
| v0.9.0c | ~3 | ~1 | ~6 | Low |
| **Total** | **~9** | **~4** | **~20** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| NAudio compatibility | High | Medium | Test on all platforms early |
| Audio file format issues | Medium | Low | Standardize on OGG |
| Console.Beep unsupported | Low | Medium | Graceful fallback |
| Audio latency | Medium | Low | Preload common sounds |

---

## Design Decisions (Confirmed)

### Audio Service

| Decision | Value | Notes |
|----------|-------|-------|
| **Library** | NAudio (Windows) / OpenAL (cross) | Platform support |
| **Channels** | 5 (Master, Music, Effects, UI, Voice) | Separate control |
| **Cache Size** | 50 files LRU | Memory balance |

### Settings Integration

| Decision | Value | Notes |
|----------|-------|-------|
| **Preview** | On slider change | Immediate feedback |
| **Persistence** | JSON in settings.json | Consistent with other settings |

### TUI Bells

| Decision | Value | Notes |
|----------|-------|-------|
| **Patterns** | 8 types | Cover major events |
| **Fallback** | Silent on unsupported | No crashes |
| **Default** | Enabled | User can disable |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **Audio Library Research** - Evaluate NAudio vs OpenAL
3. **v0.9.0a Design Spec** - Create detailed design for Core Audio Service
4. **v0.9.0a Implementation** - Build audio playback infrastructure
5. **v0.9.0b Design Spec** - Create specification for Settings Integration
6. **v0.9.0b Implementation** - Connect settings to audio service
7. **v0.9.0c Design Spec** - Create specification for TUI Bell Service
8. **v0.9.0c Implementation** - Build console bell patterns

---

*This scope breakdown provides a structured approach to implementing v0.9.0 Audio Foundation. The core audio service establishes infrastructure that music (v0.9.1) and sound effects (v0.9.2) will build upon.*
