# v0.13.3b Design Specification: Crafting Station Interface

**Version:** 0.13.3b
**Parent:** v0.13.3 (Crafting UI)
**Prerequisites:** v0.13.3a Complete (Resource Inventory Panel), v0.11.x Complete (Crafting & Resources Services)
**Status:** Design Complete
**Estimated Unit Tests:** ~8

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Crafting Station Menu Component](#4-crafting-station-menu-component)
   - 4.1 [CraftingStationMenu Class](#41-craftingstationmenu-class)
   - 4.2 [Station Display](#42-station-display)
   - 4.3 [Recipe Selection](#43-recipe-selection)
5. [Material Availability Display Component](#5-material-availability-display-component)
   - 5.1 [MaterialAvailabilityDisplay Class](#51-materialavailabilitydisplay-class)
   - 5.2 [Availability Indicators](#52-availability-indicators)
   - 5.3 [Missing Material Highlighting](#53-missing-material-highlighting)
6. [Crafting Progress Renderer](#6-crafting-progress-renderer)
   - 6.1 [CraftingProgressRenderer Class](#61-craftingprogressrenderer-class)
   - 6.2 [Progress Bar Rendering](#62-progress-bar-rendering)
   - 6.3 [Completion Display](#63-completion-display)
7. [Data Model Changes](#7-data-model-changes)
8. [Configuration File Schemas](#8-configuration-file-schemas)
9. [Room Interaction Integration](#9-room-interaction-integration)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

This version implements the crafting station interface showing station-specific recipe lists, material availability highlighting, and crafting progress feedback. Players interact with crafting stations in rooms to view available recipes, see which recipes they can craft based on owned materials, and receive visual feedback during the crafting process. The component integrates with the ResourceInventoryPanel from v0.13.3a for consistent resource display.

### Key Deliverables

| Category | Items |
|----------|-------|
| **UI Components** | `CraftingStationMenu`, `MaterialAvailabilityDisplay` |
| **Renderers** | `CraftingProgressRenderer` |
| **DTOs** | `CraftingStationDisplayDto`, `StationRecipeDisplayDto`, `MaterialRequirementDto`, `CraftingProgressDto` |
| **View Updates** | Room interaction integration |
| **Configuration** | `crafting-station.json` |
| **Tests** | ~8 unit tests |

### Architectural Significance

This version establishes the **Crafting Station Pattern** for crafting-related UI:
- Station menus display station name and available recipes
- Craftability indicators (`[x]`/`[ ]`) show at-a-glance recipe availability
- Material requirements compare owned quantities to required amounts
- Progress bar provides visual feedback during crafting
- The pattern coordinates with ResourceInventoryPanel for consistent resource display
- The pattern supports recipe details and discovery tracking (v0.13.3c)

---

## 2. Feature Overview

```
v0.13.3b Features
├── CraftingStationMenu (UI Component)
│   ├── RenderStation(CraftingStation)
│   ├── RenderRecipeList(IEnumerable<RecipeDefinition>)
│   ├── SelectRecipe(RecipeDefinition)
│   └── ShowCraftingProgress(float)
│
├── MaterialAvailabilityDisplay (UI Component)
│   ├── RenderMaterials(IEnumerable<RecipeMaterial>, IEnumerable<PlayerResource>)
│   ├── GetAvailabilityIndicator(RecipeMaterial, int)
│   ├── HighlightMissing(RecipeMaterial)
│   └── IsCraftable(RecipeDefinition, IEnumerable<PlayerResource>)
│
├── CraftingProgressRenderer (Renderer)
│   ├── RenderProgress(float)
│   ├── AnimateProgress(float, float)
│   └── ShowComplete()
│
├── Craftability Indicators
│   ├── [x] Can craft (have all materials)
│   └── [ ] Cannot craft (missing materials)
│
├── Material Display
│   ├── Side Panel Layout
│   ├── Required vs Owned Comparison
│   └── Missing Material Highlighting
│
└── Room Interaction Integration
    ├── Station Detection
    ├── Menu Activation
    └── Crafting Action Handling
```

### Scope Verification

| Feature | Source | Included |
|---------|--------|----------|
| Crafting station menu with station name | v0.13.3-scope-breakdown.md | Yes |
| Station-specific recipe list | v0.13.3-scope-breakdown.md | Yes |
| Material availability highlighting (owned vs needed) | v0.13.3-scope-breakdown.md | Yes |
| Crafting progress feedback during creation | v0.13.3-scope-breakdown.md | Yes |
| Resource inventory panel | v0.13.3-scope-breakdown.md | No (v0.13.3a) |
| Recipe search/filter | v0.13.3-scope-breakdown.md | No (v0.13.3c) |
| Gathering display | v0.13.3-scope-breakdown.md | No (v0.13.3d) |

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          PRESENTATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │      RoomView           │      │   CraftingStationMenu   │               │
│  │    (existing)           │◄────▶│   (NEW)                 │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderRoom()          │      │ - RenderStation()       │               │
│  │ - HandleInteraction()   │      │ - RenderRecipeList()    │               │
│  │ - ShowStationMenu()     │      │ - SelectRecipe()        │               │
│  └─────────────────────────┘      │ - ShowCraftingProgress()│               │
│                                    └───────────┬─────────────┘               │
│                                                │                             │
│  ┌─────────────────────────┐                   │                             │
│  │ MaterialAvailability    │◄──────────────────┤                             │
│  │ Display (NEW)           │                   │                             │
│  ├─────────────────────────┤                   │                             │
│  │ - RenderMaterials()     │                   │                             │
│  │ - GetAvailability()     │                   │                             │
│  │ - HighlightMissing()    │                   │                             │
│  │ - IsCraftable()         │                   │                             │
│  └─────────────────────────┘                   │                             │
│                                                │                             │
│  ┌─────────────────────────┐      ┌────────────┴────────────┐               │
│  │ ResourceStackRenderer   │      │ CraftingProgressRenderer│               │
│  │ (v0.13.3a)              │      │ (NEW)                   │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - FormatStack()         │      │ - RenderProgress()      │               │
│  │ - GetTypeIcon()         │      │ - AnimateProgress()     │               │
│  │ - FormatQuantity()      │      │ - ShowComplete()        │               │
│  └─────────────────────────┘      └─────────────────────────┘               │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          APPLICATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    ICraftingService (existing v0.11.x)              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetRecipesForStation(stationId) : IReadOnlyList<RecipeDefinition> │    │
│  │ + GetRecipe(recipeId) : RecipeDefinition?                           │    │
│  │ + CanCraft(player, recipeId) : bool                                 │    │
│  │ + CraftItem(player, recipeId) : CraftingResult                      │    │
│  │ + GetCraftingProgress(player) : CraftingProgressDto?                │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IResourceService (existing v0.11.x)              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetPlayerResources(player) : IReadOnlyList<ResourcePoolDto>       │    │
│  │ + GetResourceQuantity(player, resourceId) : int                     │    │
│  │ + HasResources(player, requirements) : bool                         │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │    CraftingStation      │      │    RecipeDefinition     │               │
│  │   (existing v0.11.x)    │      │   (existing v0.11.x)    │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + Id: string            │      │ + Id: string            │               │
│  │ + Name: string          │      │ + Name: string          │               │
│  │ + Description: string   │      │ + Description: string   │               │
│  │ + StationType: enum     │      │ + StationTypeRequired   │               │
│  │ + AllowedRecipeIds: list│      │ + Materials: list       │               │
│  │ + SkillRequired: string │      │ + OutputItemId: string  │               │
│  └─────────────────────────┘      │ + OutputQuantity: int   │               │
│                                    │ + CraftingTime: float   │               │
│                                    │ + RequiredSkillLevel    │               │
│                                    └─────────────────────────┘               │
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │     RecipeMaterial      │      │     CraftingResult      │               │
│  │   (existing v0.11.x)    │      │   (existing v0.11.x)    │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + MaterialId: string    │      │ + Success: bool         │               │
│  │ + Quantity: int         │      │ + CraftedItem: Item?    │               │
│  │ + IsOptional: bool      │      │ + ResultType: enum      │               │
│  └─────────────────────────┘      │ + Message: string?      │               │
│                                    └─────────────────────────┘               │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Crafting Station Menu Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CRAFTING STATION MENU FLOW                                │
└─────────────────────────────────────────────────────────────────────────────┘

    Player Interacts with Crafting Station in Room
           │
           ▼
┌─────────────────────────┐
│       RoomView          │
│  HandleInteraction()    │
└───────────┬─────────────┘
            │
            │ 1. Detect crafting station
            ▼
┌─────────────────────────────────────────────────────────────┐
│    CraftingStationMenu                                       │
│                                                              │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ GetStationInfo()  │  │ GetRecipes()      │               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
│            │                      │                          │
│            │ 2. Load station data and recipes               │
│            ▼                      ▼                          │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ RenderStation()   │  │ RenderRecipeList()│               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
│            │                      │                          │
│            │ 3. Display station menu with recipes           │
└────────────┼──────────────────────┼─────────────────────────┘
             │                      │
             │ 4. For each recipe, check craftability
             ▼                      ▼
┌─────────────────────────────────────────────────────────────┐
│ MaterialAvailabilityDisplay                                  │
│                                                              │
│ - GetPlayerResources() from IResourceService                │
│ - Compare to recipe.Materials                               │
│ - Return [x] if all owned >= required                       │
│ - Return [ ] if any missing                                 │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 5. Display craftability indicators
            ▼
┌─────────────────────────┐
│   ITerminalService      │
│   WriteAt(x, y, text)   │
│   WriteColoredAt(...)   │
└─────────────────────────┘
```

### 3.3 Crafting Action Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CRAFTING ACTION FLOW                                      │
└─────────────────────────────────────────────────────────────────────────────┘

    Player Selects Recipe and Presses [C] to Craft
           │
           ▼
┌─────────────────────────┐
│  CraftingStationMenu    │
│  HandleCraftInput()     │
└───────────┬─────────────┘
            │
            │ 1. Verify recipe is selected
            ▼
┌─────────────────────────────────────────────────────────────┐
│  MaterialAvailabilityDisplay                                 │
│                                                              │
│  IsCraftable(recipe, playerResources)?                      │
│                                                              │
│  ├─── false ───► Display "Insufficient materials" message  │
│  │                                                           │
│  └─── true ───► Continue to crafting                        │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 2. Call crafting service
            ▼
┌─────────────────────────┐
│   ICraftingService      │
│   CraftItem(player,     │
│     recipeId)           │
└───────────┬─────────────┘
            │
            │ 3. Begin crafting (if instant, skip progress)
            ▼
┌─────────────────────────────────────────────────────────────┐
│  CraftingProgressRenderer                                    │
│                                                              │
│  RenderProgress(progress: 0.0 -> 1.0)                       │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ Crafting: Steel Blade                                   ││
│  │ [##########....................] 35%                    ││
│  └─────────────────────────────────────────────────────────┘│
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 4. On completion
            ▼
┌─────────────────────────────────────────────────────────────┐
│  CraftingProgressRenderer                                    │
│                                                              │
│  ShowComplete()                                              │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ [x] Crafting Complete!                                  ││
│  │ Created: Steel Blade                                    ││
│  └─────────────────────────────────────────────────────────┘│
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 5. Update player inventory & refresh display
            ▼
┌─────────────────────────┐
│  RoomView/StationMenu   │
│  RefreshDisplay()       │
└─────────────────────────┘
```

---

## 4. Crafting Station Menu Component

### 4.1 CraftingStationMenu Class

**Purpose:** Displays the crafting station interface with station name, available recipes, and crafting controls.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/CraftingStationMenu.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays the crafting station interface with recipes and crafting controls.
/// </summary>
/// <remarks>
/// Shows station-specific recipes with craftability indicators, material requirements,
/// and provides crafting progress feedback during item creation.
/// </remarks>
public class CraftingStationMenu
{
    private readonly ICraftingService _craftingService;
    private readonly IResourceService _resourceService;
    private readonly MaterialAvailabilityDisplay _materialDisplay;
    private readonly CraftingProgressRenderer _progressRenderer;
    private readonly ITerminalService _terminalService;
    private readonly CraftingStationConfig _config;
    private readonly ILogger<CraftingStationMenu> _logger;

    private CraftingStationDisplayDto? _currentStation;
    private IReadOnlyList<StationRecipeDisplayDto> _recipes = Array.Empty<StationRecipeDisplayDto>();
    private int _selectedIndex;
    private bool _isCrafting;
    private (int X, int Y) _menuPosition;

    /// <summary>
    /// Gets whether the menu is currently visible.
    /// </summary>
    public bool IsVisible { get; private set; }

    /// <summary>
    /// Gets the currently selected recipe index.
    /// </summary>
    public int SelectedIndex => _selectedIndex;

    /// <summary>
    /// Gets the current station being displayed.
    /// </summary>
    public CraftingStationDisplayDto? CurrentStation => _currentStation;

    /// <summary>
    /// Creates a new instance of the CraftingStationMenu component.
    /// </summary>
    /// <param name="craftingService">The crafting service.</param>
    /// <param name="resourceService">The resource service.</param>
    /// <param name="materialDisplay">The material availability display component.</param>
    /// <param name="progressRenderer">The crafting progress renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for station menu display.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public CraftingStationMenu(
        ICraftingService craftingService,
        IResourceService resourceService,
        MaterialAvailabilityDisplay materialDisplay,
        CraftingProgressRenderer progressRenderer,
        ITerminalService terminalService,
        CraftingStationConfig config,
        ILogger<CraftingStationMenu> logger)
    {
        _craftingService = craftingService ?? throw new ArgumentNullException(nameof(craftingService));
        _resourceService = resourceService ?? throw new ArgumentNullException(nameof(resourceService));
        _materialDisplay = materialDisplay ?? throw new ArgumentNullException(nameof(materialDisplay));
        _progressRenderer = progressRenderer ?? throw new ArgumentNullException(nameof(progressRenderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the menu position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _menuPosition = (x, y);
    }

    /// <summary>
    /// Renders the crafting station menu.
    /// </summary>
    /// <param name="station">The crafting station to display.</param>
    /// <param name="playerResources">The player's current resources.</param>
    public void RenderStation(CraftingStationDisplayDto station, IEnumerable<ResourceStackDisplayDto> playerResources)
    {
        _currentStation = station;
        IsVisible = true;

        // Clear menu area
        ClearMenu();

        // Render station header
        RenderHeader(station.Name);

        // Load recipes for this station
        var recipes = _craftingService.GetRecipesForStation(station.StationId);
        _recipes = CreateRecipeDisplayDtos(recipes, playerResources);

        // Render recipe list
        RenderRecipeList();

        // Render material panel for selected recipe
        if (_recipes.Count > 0)
        {
            RenderMaterialPanel(_recipes[_selectedIndex], playerResources);
        }

        // Render controls hint
        RenderControls();

        _logger.LogDebug(
            "Rendered crafting station {StationName} with {RecipeCount} recipes",
            station.Name,
            _recipes.Count);
    }

    /// <summary>
    /// Renders the list of available recipes.
    /// </summary>
    public void RenderRecipeList()
    {
        var listY = _menuPosition.Y + 4;
        var listWidth = _config.RecipeListWidth;

        // Column headers
        _terminalService.WriteAt(_menuPosition.X + 2, listY, "AVAILABLE RECIPES");
        _terminalService.WriteAt(_menuPosition.X + 2, listY + 1, new string('─', 17));

        // Recipe entries
        var displayCount = Math.Min(_recipes.Count, _config.MaxVisibleRecipes);
        var startIndex = Math.Max(0, _selectedIndex - displayCount / 2);
        startIndex = Math.Min(startIndex, Math.Max(0, _recipes.Count - displayCount));

        for (var i = 0; i < displayCount; i++)
        {
            var recipeIndex = startIndex + i;
            var recipe = _recipes[recipeIndex];
            var isSelected = recipeIndex == _selectedIndex;

            var entryY = listY + 3 + i;
            RenderRecipeEntry(recipe, entryY, isSelected);
        }

        // Scroll indicators
        if (startIndex > 0)
        {
            _terminalService.WriteAt(_menuPosition.X + listWidth - 4, listY + 2, "▲");
        }
        if (startIndex + displayCount < _recipes.Count)
        {
            _terminalService.WriteAt(_menuPosition.X + listWidth - 4, listY + 3 + displayCount, "▼");
        }
    }

    /// <summary>
    /// Selects a recipe by index.
    /// </summary>
    /// <param name="index">The recipe index to select.</param>
    public void SelectRecipe(int index)
    {
        if (index < 0 || index >= _recipes.Count)
        {
            return;
        }

        _selectedIndex = index;
        _logger.LogDebug("Selected recipe at index {Index}: {RecipeName}",
            index, _recipes[index].Name);
    }

    /// <summary>
    /// Selects the previous recipe in the list.
    /// </summary>
    public void SelectPrevious()
    {
        if (_recipes.Count == 0) return;

        _selectedIndex = (_selectedIndex - 1 + _recipes.Count) % _recipes.Count;
        RefreshRecipeDisplay();
    }

    /// <summary>
    /// Selects the next recipe in the list.
    /// </summary>
    public void SelectNext()
    {
        if (_recipes.Count == 0) return;

        _selectedIndex = (_selectedIndex + 1) % _recipes.Count;
        RefreshRecipeDisplay();
    }

    /// <summary>
    /// Gets the currently selected recipe.
    /// </summary>
    /// <returns>The selected recipe, or null if none.</returns>
    public StationRecipeDisplayDto? GetSelectedRecipe()
    {
        if (_recipes.Count == 0 || _selectedIndex < 0 || _selectedIndex >= _recipes.Count)
        {
            return null;
        }

        return _recipes[_selectedIndex];
    }

    /// <summary>
    /// Shows crafting progress.
    /// </summary>
    /// <param name="progress">The progress value (0.0 to 1.0).</param>
    public void ShowCraftingProgress(float progress)
    {
        _isCrafting = true;
        var progressY = _menuPosition.Y + _config.MenuHeight - 3;

        var selectedRecipe = GetSelectedRecipe();
        var recipeName = selectedRecipe?.Name ?? "Unknown";

        var progressLine = _progressRenderer.RenderProgress(progress, recipeName);
        _terminalService.WriteAt(_menuPosition.X + 2, progressY, progressLine);

        if (progress >= 1.0f)
        {
            _isCrafting = false;
            _progressRenderer.ShowComplete(_menuPosition.X + 2, progressY + 1, _terminalService);
        }
    }

    /// <summary>
    /// Hides the crafting station menu.
    /// </summary>
    public void Hide()
    {
        if (!IsVisible) return;

        ClearMenu();
        IsVisible = false;
        _currentStation = null;
        _recipes = Array.Empty<StationRecipeDisplayDto>();
        _selectedIndex = 0;

        _logger.LogDebug("Crafting station menu hidden");
    }

    /// <summary>
    /// Handles keyboard input for the menu.
    /// </summary>
    /// <param name="key">The pressed key.</param>
    /// <returns>True if the input was handled.</returns>
    public bool HandleInput(ConsoleKey key)
    {
        if (_isCrafting)
        {
            return false; // Ignore input while crafting
        }

        return key switch
        {
            ConsoleKey.UpArrow or ConsoleKey.W => HandleNavigateUp(),
            ConsoleKey.DownArrow or ConsoleKey.S => HandleNavigateDown(),
            ConsoleKey.C => HandleCraftAction(),
            ConsoleKey.Escape => HandleClose(),
            _ => false
        };
    }

    #region Private Methods

    private void ClearMenu()
    {
        var blankLine = new string(' ', _config.MenuWidth);
        for (var y = 0; y < _config.MenuHeight; y++)
        {
            _terminalService.WriteAt(_menuPosition.X, _menuPosition.Y + y, blankLine);
        }
    }

    private void RenderHeader(string stationName)
    {
        var headerY = _menuPosition.Y;
        var width = _config.MenuWidth;

        // Top border
        var topBorder = $"┌{new string('─', width - 2)}┐";
        _terminalService.WriteAt(_menuPosition.X, headerY, topBorder);

        // Station name (centered)
        var title = stationName.ToUpperInvariant();
        var titlePadding = (width - 2 - title.Length) / 2;
        var titleLine = $"│{new string(' ', titlePadding)}{title}{new string(' ', width - 2 - titlePadding - title.Length)}│";
        _terminalService.WriteColoredAt(_menuPosition.X, headerY + 1, titleLine, _config.HeaderColor);

        // Separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_menuPosition.X, headerY + 2, separator);
    }

    private void RenderRecipeEntry(StationRecipeDisplayDto recipe, int y, bool isSelected)
    {
        var indicator = recipe.IsCraftable ? "[x]" : "[ ]";
        var indicatorColor = recipe.IsCraftable ? _config.CraftableColor : _config.NotCraftableColor;

        var entryText = $" {recipe.Name}";
        var maxNameWidth = _config.RecipeListWidth - 10;
        if (entryText.Length > maxNameWidth)
        {
            entryText = entryText.Substring(0, maxNameWidth - 2) + "..";
        }

        // Clear entry line
        var clearLine = new string(' ', _config.RecipeListWidth);
        _terminalService.WriteAt(_menuPosition.X + 2, y, clearLine);

        // Highlight if selected
        if (isSelected)
        {
            _terminalService.WriteColoredAt(_menuPosition.X + 2, y, "►", _config.SelectionColor);
        }

        // Craftability indicator
        _terminalService.WriteColoredAt(_menuPosition.X + 4, y, indicator, indicatorColor);

        // Recipe name
        var nameColor = isSelected ? _config.SelectionColor : ConsoleColor.White;
        _terminalService.WriteColoredAt(_menuPosition.X + 8, y, entryText, nameColor);

        // Material summary
        var materialSummary = FormatMaterialSummary(recipe.Materials);
        _terminalService.WriteColoredAt(
            _menuPosition.X + _config.RecipeListWidth - materialSummary.Length - 2,
            y,
            materialSummary,
            ConsoleColor.DarkGray);
    }

    private void RenderMaterialPanel(StationRecipeDisplayDto recipe, IEnumerable<ResourceStackDisplayDto> playerResources)
    {
        var panelX = _menuPosition.X + _config.RecipeListWidth + 2;
        var panelY = _menuPosition.Y + 4;

        _materialDisplay.SetPosition(panelX, panelY);
        _materialDisplay.RenderMaterials(recipe.Materials, playerResources);
    }

    private void RenderControls()
    {
        var controlsY = _menuPosition.Y + _config.MenuHeight - 2;
        var width = _config.MenuWidth;

        // Bottom separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_menuPosition.X, controlsY - 1, separator);

        // Controls hint
        var controls = "│  [↑/↓] Navigate   [C] Craft   [Esc] Close";
        var padding = width - controls.Length - 1;
        _terminalService.WriteAt(_menuPosition.X, controlsY, controls + new string(' ', padding) + "│");

        // Bottom border
        var bottomBorder = $"└{new string('─', width - 2)}┘";
        _terminalService.WriteAt(_menuPosition.X, controlsY + 1, bottomBorder);
    }

    private void RefreshRecipeDisplay()
    {
        RenderRecipeList();

        if (_recipes.Count > 0 && _currentStation != null)
        {
            var playerResources = GetPlayerResourcesAsDto();
            RenderMaterialPanel(_recipes[_selectedIndex], playerResources);
        }
    }

    private IReadOnlyList<StationRecipeDisplayDto> CreateRecipeDisplayDtos(
        IEnumerable<RecipeDefinition> recipes,
        IEnumerable<ResourceStackDisplayDto> playerResources)
    {
        var resourceDict = playerResources.ToDictionary(r => r.ResourceId, r => r.Quantity);

        return recipes.Select(recipe =>
        {
            var materials = recipe.Materials
                .Select(m => new MaterialRequirementDto(
                    MaterialId: m.MaterialId,
                    MaterialName: GetMaterialName(m.MaterialId),
                    RequiredQuantity: m.Quantity,
                    OwnedQuantity: resourceDict.GetValueOrDefault(m.MaterialId, 0),
                    IsOptional: m.IsOptional))
                .ToList();

            var isCraftable = materials
                .Where(m => !m.IsOptional)
                .All(m => m.OwnedQuantity >= m.RequiredQuantity);

            return new StationRecipeDisplayDto(
                RecipeId: recipe.Id,
                Name: recipe.Name,
                Description: recipe.Description,
                Materials: materials,
                OutputItemId: recipe.OutputItemId,
                OutputItemName: GetItemName(recipe.OutputItemId),
                OutputQuantity: recipe.OutputQuantity,
                IsCraftable: isCraftable);
        }).ToList();
    }

    private string FormatMaterialSummary(IReadOnlyList<MaterialRequirementDto> materials)
    {
        var count = materials.Count(m => !m.IsOptional);
        return $"[{count} mat]";
    }

    private IEnumerable<ResourceStackDisplayDto> GetPlayerResourcesAsDto()
    {
        // This would typically get resources from the service
        // For now, return empty - actual implementation depends on game state access
        return Array.Empty<ResourceStackDisplayDto>();
    }

    private string GetMaterialName(string materialId)
    {
        // Lookup from resource service - placeholder
        return materialId.Replace("-", " ")
            .Split(' ')
            .Select(w => char.ToUpper(w[0]) + w.Substring(1))
            .Aggregate((a, b) => $"{a} {b}");
    }

    private string GetItemName(string itemId)
    {
        // Lookup from item service - placeholder
        return itemId.Replace("-", " ")
            .Split(' ')
            .Select(w => char.ToUpper(w[0]) + w.Substring(1))
            .Aggregate((a, b) => $"{a} {b}");
    }

    private bool HandleNavigateUp()
    {
        SelectPrevious();
        return true;
    }

    private bool HandleNavigateDown()
    {
        SelectNext();
        return true;
    }

    private bool HandleCraftAction()
    {
        var recipe = GetSelectedRecipe();
        if (recipe == null)
        {
            return false;
        }

        if (!recipe.IsCraftable)
        {
            ShowMessage("Insufficient materials!", ConsoleColor.Red);
            return true;
        }

        // Initiate crafting
        _logger.LogInformation("Crafting recipe: {RecipeName}", recipe.Name);
        // Actual crafting logic would be handled by the service
        return true;
    }

    private bool HandleClose()
    {
        Hide();
        return true;
    }

    private void ShowMessage(string message, ConsoleColor color)
    {
        var messageY = _menuPosition.Y + _config.MenuHeight - 4;
        var clearLine = new string(' ', _config.MenuWidth - 4);
        _terminalService.WriteAt(_menuPosition.X + 2, messageY, clearLine);
        _terminalService.WriteColoredAt(_menuPosition.X + 2, messageY, message, color);
    }

    #endregion
}
```

### 4.2 Station Display

**Purpose:** Display the crafting station header with station name.

**Station Display Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│                    BLACKSMITH FORGE                                  │
├─────────────────────────────────────────────────────────────────────┤
```

**Station Types (from v0.11.x):**

| Station Type | Display Name | Description |
|--------------|--------------|-------------|
| Forge | BLACKSMITH FORGE | Metal weapons and armor |
| Workbench | WORKBENCH | General crafting |
| Alchemy | ALCHEMY TABLE | Potions and elixirs |
| Enchanting | ENCHANTING ALTAR | Magical enhancements |
| Cooking | COOKING FIRE | Food and provisions |
| Tanning | TANNING RACK | Leather processing |

### 4.3 Recipe Selection

**Purpose:** Navigate and select recipes from the station's recipe list.

**Navigation:**
- `↑` / `W` - Select previous recipe
- `↓` / `S` - Select next recipe
- `C` - Craft selected recipe
- `Esc` - Close station menu

**Selection Visual:**
```
  AVAILABLE RECIPES
  ─────────────────

  ► [x] Iron Sword          [2 mat]
    [x] Iron Shield         [3 mat]
    [x] Steel Blade         [2 mat]
    [ ] Silver Ring         [2 mat]
    [ ] Mithril Armor       [5 mat]
```

**Selection Indicator:**
- `►` marks the currently selected recipe
- Selected recipe highlighted with selection color
- Craftable recipes show `[x]`, non-craftable show `[ ]`

---

## 5. Material Availability Display Component

### 5.1 MaterialAvailabilityDisplay Class

**Purpose:** Displays material requirements with owned vs needed quantities and highlights missing materials.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/MaterialAvailabilityDisplay.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays material requirements with availability indicators.
/// </summary>
/// <remarks>
/// Shows required materials compared to owned quantities, highlighting
/// materials the player has insufficient quantities of.
/// </remarks>
public class MaterialAvailabilityDisplay
{
    private readonly ResourceStackRenderer _resourceRenderer;
    private readonly ITerminalService _terminalService;
    private readonly CraftingStationConfig _config;
    private readonly ILogger<MaterialAvailabilityDisplay> _logger;

    private (int X, int Y) _position;

    /// <summary>
    /// Creates a new instance of the MaterialAvailabilityDisplay component.
    /// </summary>
    /// <param name="resourceRenderer">The resource stack renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public MaterialAvailabilityDisplay(
        ResourceStackRenderer resourceRenderer,
        ITerminalService terminalService,
        CraftingStationConfig config,
        ILogger<MaterialAvailabilityDisplay> logger)
    {
        _resourceRenderer = resourceRenderer ?? throw new ArgumentNullException(nameof(resourceRenderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the display position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _position = (x, y);
    }

    /// <summary>
    /// Renders material requirements with availability indicators.
    /// </summary>
    /// <param name="materials">The required materials.</param>
    /// <param name="playerResources">The player's current resources.</param>
    public void RenderMaterials(
        IEnumerable<MaterialRequirementDto> materials,
        IEnumerable<ResourceStackDisplayDto> playerResources)
    {
        var materialList = materials.ToList();
        var resourceDict = playerResources.ToDictionary(r => r.ResourceId, r => r.Quantity);

        // Clear material panel
        ClearPanel();

        // Header
        _terminalService.WriteAt(_position.X, _position.Y, "YOUR MATERIALS");
        _terminalService.WriteAt(_position.X, _position.Y + 1, new string('─', 14));

        // Render each material
        var y = _position.Y + 3;
        foreach (var material in materialList)
        {
            var owned = resourceDict.GetValueOrDefault(material.MaterialId, 0);
            RenderMaterialRow(material, owned, y);
            y++;
        }

        _logger.LogDebug("Rendered {Count} material requirements", materialList.Count);
    }

    /// <summary>
    /// Gets the availability indicator for a material.
    /// </summary>
    /// <param name="material">The material requirement.</param>
    /// <param name="ownedQuantity">The quantity owned by the player.</param>
    /// <returns>The availability indicator string.</returns>
    public string GetAvailabilityIndicator(MaterialRequirementDto material, int ownedQuantity)
    {
        if (ownedQuantity >= material.RequiredQuantity)
        {
            return "[x]";
        }

        return "[ ]";
    }

    /// <summary>
    /// Highlights a missing material.
    /// </summary>
    /// <param name="material">The material to highlight.</param>
    public void HighlightMissing(MaterialRequirementDto material)
    {
        // Visual feedback for missing material
        // This could flash or animate the material row
        _logger.LogDebug("Highlighted missing material: {MaterialId}", material.MaterialId);
    }

    /// <summary>
    /// Checks if a recipe is craftable with current resources.
    /// </summary>
    /// <param name="materials">The recipe's material requirements.</param>
    /// <param name="playerResources">The player's current resources.</param>
    /// <returns>True if all required materials are available.</returns>
    public bool IsCraftable(
        IEnumerable<MaterialRequirementDto> materials,
        IEnumerable<ResourceStackDisplayDto> playerResources)
    {
        var resourceDict = playerResources.ToDictionary(r => r.ResourceId, r => r.Quantity);

        return materials
            .Where(m => !m.IsOptional)
            .All(m => resourceDict.GetValueOrDefault(m.MaterialId, 0) >= m.RequiredQuantity);
    }

    #region Private Methods

    private void ClearPanel()
    {
        var blankLine = new string(' ', _config.MaterialPanelWidth);
        for (var y = 0; y < _config.MaxMaterialsVisible + 4; y++)
        {
            _terminalService.WriteAt(_position.X, _position.Y + y, blankLine);
        }
    }

    private void RenderMaterialRow(MaterialRequirementDto material, int ownedQuantity, int y)
    {
        var isSufficient = ownedQuantity >= material.RequiredQuantity;
        var indicator = GetAvailabilityIndicator(material, ownedQuantity);

        // Material name
        var maxNameWidth = _config.MaterialPanelWidth - 20;
        var name = material.MaterialName;
        if (name.Length > maxNameWidth)
        {
            name = name.Substring(0, maxNameWidth - 2) + "..";
        }

        // Quantity display: "owned/required"
        var quantityText = $"{ownedQuantity}/{material.RequiredQuantity}";

        // Color based on sufficiency
        var nameColor = isSufficient ? ConsoleColor.White : _config.MissingMaterialColor;
        var indicatorColor = isSufficient ? _config.SufficientMaterialColor : _config.MissingMaterialColor;

        // Render row
        _terminalService.WriteColoredAt(_position.X, y, name, nameColor);
        _terminalService.WriteAt(_position.X + maxNameWidth + 2, y, quantityText);
        _terminalService.WriteColoredAt(
            _position.X + _config.MaterialPanelWidth - 4,
            y,
            indicator,
            indicatorColor);

        // Optional indicator
        if (material.IsOptional)
        {
            _terminalService.WriteColoredAt(
                _position.X + _config.MaterialPanelWidth - 8,
                y,
                "(opt)",
                ConsoleColor.DarkGray);
        }
    }

    #endregion
}
```

### 5.2 Availability Indicators

**Purpose:** Show at-a-glance whether materials are available.

**Indicator Definitions:**

| Indicator | Meaning | Color |
|-----------|---------|-------|
| `[x]` | Have enough materials | Green |
| `[ ]` | Missing materials | Red |

**Display Format:**
```
YOUR MATERIALS
──────────────

Iron Ore       24/2  [x]
Silver Ore     12/3  [x]
Coal           8/1   [x]
Ruby           5/2   [x]
Mithril Ore    0/5   [ ]
```

### 5.3 Missing Material Highlighting

**Purpose:** Visually emphasize materials the player doesn't have enough of.

**Highlighting Rules:**
- Insufficient materials display in red/warning color
- Material name and quantity both highlighted
- `[ ]` indicator shows in red
- Optional materials show "(opt)" suffix in gray

**Example with Missing:**
```
Iron Ore       24/2  [x]     (white, sufficient)
Mithril Ore    0/5   [ ]     (red, insufficient)
Dragon Scale   1/2   [ ]     (red, insufficient)
Magic Dust     5/1   [x] (opt)  (white with gray opt)
```

---

## 6. Crafting Progress Renderer

### 6.1 CraftingProgressRenderer Class

**Purpose:** Renders crafting progress bar and completion feedback.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Renderers/CraftingProgressRenderer.cs`

```csharp
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.Renderers;

/// <summary>
/// Renders crafting progress bars and completion feedback.
/// </summary>
/// <remarks>
/// Displays progress during item crafting with animated progress bar
/// and completion message.
/// </remarks>
public class CraftingProgressRenderer
{
    private readonly CraftingStationConfig _config;

    /// <summary>
    /// Creates a new instance of the CraftingProgressRenderer.
    /// </summary>
    /// <param name="config">Configuration for progress display.</param>
    public CraftingProgressRenderer(CraftingStationConfig config)
    {
        _config = config ?? throw new ArgumentNullException(nameof(config));
    }

    /// <summary>
    /// Renders the crafting progress bar.
    /// </summary>
    /// <param name="progress">The progress value (0.0 to 1.0).</param>
    /// <param name="recipeName">The name of the recipe being crafted.</param>
    /// <returns>The formatted progress line.</returns>
    public string RenderProgress(float progress, string recipeName)
    {
        var clampedProgress = Math.Clamp(progress, 0f, 1f);
        var percentage = (int)(clampedProgress * 100);

        var barWidth = _config.ProgressBarWidth;
        var filledWidth = (int)(barWidth * clampedProgress);
        var emptyWidth = barWidth - filledWidth;

        var filledBar = new string(_config.ProgressFilledChar, filledWidth);
        var emptyBar = new string(_config.ProgressEmptyChar, emptyWidth);

        return $"Crafting: {recipeName}\n[{filledBar}{emptyBar}] {percentage}%";
    }

    /// <summary>
    /// Animates progress from one value to another.
    /// </summary>
    /// <param name="fromProgress">Starting progress value.</param>
    /// <param name="toProgress">Ending progress value.</param>
    /// <param name="recipeName">The name of the recipe.</param>
    /// <param name="terminalService">The terminal service for output.</param>
    /// <param name="x">X position for rendering.</param>
    /// <param name="y">Y position for rendering.</param>
    public void AnimateProgress(
        float fromProgress,
        float toProgress,
        string recipeName,
        ITerminalService terminalService,
        int x,
        int y)
    {
        var steps = _config.ProgressAnimationSteps;
        var increment = (toProgress - fromProgress) / steps;

        for (var i = 0; i <= steps; i++)
        {
            var currentProgress = fromProgress + (increment * i);
            var progressLine = RenderProgress(currentProgress, recipeName);

            // Clear previous line
            var clearLine = new string(' ', _config.ProgressBarWidth + 30);
            terminalService.WriteAt(x, y, clearLine);
            terminalService.WriteAt(x, y + 1, clearLine);

            // Write new progress
            var lines = progressLine.Split('\n');
            terminalService.WriteAt(x, y, lines[0]);
            terminalService.WriteColoredAt(x, y + 1, lines[1], _config.ProgressBarColor);

            Thread.Sleep(_config.ProgressAnimationDelay);
        }
    }

    /// <summary>
    /// Shows the completion message.
    /// </summary>
    /// <param name="x">X position for rendering.</param>
    /// <param name="y">Y position for rendering.</param>
    /// <param name="terminalService">The terminal service for output.</param>
    public void ShowComplete(int x, int y, ITerminalService terminalService)
    {
        var completeMessage = "[x] Crafting Complete!";
        terminalService.WriteColoredAt(x, y, completeMessage, _config.CompletionColor);
    }

    /// <summary>
    /// Formats a progress bar string.
    /// </summary>
    /// <param name="progress">The progress value (0.0 to 1.0).</param>
    /// <returns>The formatted progress bar string.</returns>
    public string FormatProgressBar(float progress)
    {
        var clampedProgress = Math.Clamp(progress, 0f, 1f);
        var barWidth = _config.ProgressBarWidth;
        var filledWidth = (int)(barWidth * clampedProgress);
        var emptyWidth = barWidth - filledWidth;

        var filledBar = new string(_config.ProgressFilledChar, filledWidth);
        var emptyBar = new string(_config.ProgressEmptyChar, emptyWidth);

        return $"[{filledBar}{emptyBar}]";
    }
}
```

### 6.2 Progress Bar Rendering

**Purpose:** Display visual progress during crafting.

**Progress Bar Format:**
```
Crafting: Steel Blade
[##########....................] 35%
```

**Progress Bar Characters:**
- `#` - Filled portion (configurable)
- `.` - Empty portion (configurable)
- Default width: 30 characters

**Progress States:**
```
[..............................] 0%    (Starting)
[##############................] 50%   (Halfway)
[##############################] 100%  (Complete)
```

### 6.3 Completion Display

**Purpose:** Show completion feedback when crafting finishes.

**Completion Message:**
```
[x] Crafting Complete!
Created: Steel Blade
```

**Completion Colors:**
- Success indicator `[x]` in green
- "Crafting Complete!" in bright color
- Item name in white

---

## 7. Data Model Changes

### 7.1 New DTOs

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/CraftingDisplayDtos.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Data transfer object for crafting station display.
/// </summary>
/// <param name="StationId">The station's unique identifier.</param>
/// <param name="Name">The display name of the station.</param>
/// <param name="Description">The station description.</param>
/// <param name="StationType">The type of crafting station.</param>
/// <param name="SkillRequired">The skill required to use this station.</param>
public record CraftingStationDisplayDto(
    string StationId,
    string Name,
    string Description,
    string StationType,
    string? SkillRequired);

/// <summary>
/// Data transfer object for station recipe display.
/// </summary>
/// <param name="RecipeId">The recipe's unique identifier.</param>
/// <param name="Name">The display name of the recipe.</param>
/// <param name="Description">The recipe description.</param>
/// <param name="Materials">The required materials.</param>
/// <param name="OutputItemId">The ID of the output item.</param>
/// <param name="OutputItemName">The display name of the output item.</param>
/// <param name="OutputQuantity">The quantity produced.</param>
/// <param name="IsCraftable">Whether the player can craft this recipe.</param>
public record StationRecipeDisplayDto(
    string RecipeId,
    string Name,
    string Description,
    IReadOnlyList<MaterialRequirementDto> Materials,
    string OutputItemId,
    string OutputItemName,
    int OutputQuantity,
    bool IsCraftable);

/// <summary>
/// Data transfer object for material requirements.
/// </summary>
/// <param name="MaterialId">The material's unique identifier.</param>
/// <param name="MaterialName">The display name of the material.</param>
/// <param name="RequiredQuantity">The quantity required.</param>
/// <param name="OwnedQuantity">The quantity owned by the player.</param>
/// <param name="IsOptional">Whether the material is optional.</param>
public record MaterialRequirementDto(
    string MaterialId,
    string MaterialName,
    int RequiredQuantity,
    int OwnedQuantity,
    bool IsOptional);

/// <summary>
/// Data transfer object for crafting progress.
/// </summary>
/// <param name="RecipeId">The recipe being crafted.</param>
/// <param name="RecipeName">The display name of the recipe.</param>
/// <param name="Progress">The progress value (0.0 to 1.0).</param>
/// <param name="IsComplete">Whether crafting is complete.</param>
public record CraftingProgressDto(
    string RecipeId,
    string RecipeName,
    float Progress,
    bool IsComplete);
```

### 7.2 Configuration Classes

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Configuration/CraftingStationConfig.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.Configuration;

/// <summary>
/// Configuration for crafting station menu display settings.
/// </summary>
public class CraftingStationConfig
{
    /// <summary>
    /// Width of the crafting station menu.
    /// </summary>
    public int MenuWidth { get; set; } = 70;

    /// <summary>
    /// Height of the crafting station menu.
    /// </summary>
    public int MenuHeight { get; set; } = 20;

    /// <summary>
    /// Width of the recipe list panel.
    /// </summary>
    public int RecipeListWidth { get; set; } = 35;

    /// <summary>
    /// Width of the material panel.
    /// </summary>
    public int MaterialPanelWidth { get; set; } = 30;

    /// <summary>
    /// Maximum visible recipes in the list.
    /// </summary>
    public int MaxVisibleRecipes { get; set; } = 8;

    /// <summary>
    /// Maximum visible materials in the panel.
    /// </summary>
    public int MaxMaterialsVisible { get; set; } = 6;

    /// <summary>
    /// Width of the progress bar.
    /// </summary>
    public int ProgressBarWidth { get; set; } = 30;

    /// <summary>
    /// Character for filled progress bar portion.
    /// </summary>
    public char ProgressFilledChar { get; set; } = '#';

    /// <summary>
    /// Character for empty progress bar portion.
    /// </summary>
    public char ProgressEmptyChar { get; set; } = '.';

    /// <summary>
    /// Number of animation steps for progress.
    /// </summary>
    public int ProgressAnimationSteps { get; set; } = 10;

    /// <summary>
    /// Delay between animation steps in milliseconds.
    /// </summary>
    public int ProgressAnimationDelay { get; set; } = 100;

    /// <summary>
    /// Color for station header.
    /// </summary>
    public ConsoleColor HeaderColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>
    /// Color for craftable recipe indicators.
    /// </summary>
    public ConsoleColor CraftableColor { get; set; } = ConsoleColor.Green;

    /// <summary>
    /// Color for non-craftable recipe indicators.
    /// </summary>
    public ConsoleColor NotCraftableColor { get; set; } = ConsoleColor.Red;

    /// <summary>
    /// Color for selected recipe.
    /// </summary>
    public ConsoleColor SelectionColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>
    /// Color for sufficient material indicators.
    /// </summary>
    public ConsoleColor SufficientMaterialColor { get; set; } = ConsoleColor.Green;

    /// <summary>
    /// Color for missing material highlighting.
    /// </summary>
    public ConsoleColor MissingMaterialColor { get; set; } = ConsoleColor.Red;

    /// <summary>
    /// Color for progress bar.
    /// </summary>
    public ConsoleColor ProgressBarColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>
    /// Color for completion message.
    /// </summary>
    public ConsoleColor CompletionColor { get; set; } = ConsoleColor.Green;
}
```

---

## 8. Configuration File Schemas

### 8.1 crafting-station.json

**File:** `config/crafting-station.json`

```json
{
  "$schema": "./schemas/crafting-station.schema.json",
  "menuWidth": 70,
  "menuHeight": 20,
  "recipeListWidth": 35,
  "materialPanelWidth": 30,
  "maxVisibleRecipes": 8,
  "maxMaterialsVisible": 6,
  "progressBarWidth": 30,
  "progressFilledChar": "#",
  "progressEmptyChar": ".",
  "progressAnimationSteps": 10,
  "progressAnimationDelay": 100,
  "headerColor": "Yellow",
  "craftableColor": "Green",
  "notCraftableColor": "Red",
  "selectionColor": "Cyan",
  "sufficientMaterialColor": "Green",
  "missingMaterialColor": "Red",
  "progressBarColor": "Cyan",
  "completionColor": "Green"
}
```

### 8.2 crafting-station.schema.json

**File:** `config/schemas/crafting-station.schema.json`

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "crafting-station.schema.json",
  "title": "Crafting Station Configuration",
  "description": "Configuration for crafting station menu display",
  "type": "object",
  "properties": {
    "menuWidth": {
      "type": "integer",
      "description": "Width of the crafting station menu",
      "minimum": 50,
      "maximum": 120,
      "default": 70
    },
    "menuHeight": {
      "type": "integer",
      "description": "Height of the crafting station menu",
      "minimum": 15,
      "maximum": 40,
      "default": 20
    },
    "recipeListWidth": {
      "type": "integer",
      "description": "Width of the recipe list panel",
      "minimum": 25,
      "maximum": 50,
      "default": 35
    },
    "materialPanelWidth": {
      "type": "integer",
      "description": "Width of the material panel",
      "minimum": 20,
      "maximum": 40,
      "default": 30
    },
    "maxVisibleRecipes": {
      "type": "integer",
      "description": "Maximum visible recipes in the list",
      "minimum": 3,
      "maximum": 15,
      "default": 8
    },
    "maxMaterialsVisible": {
      "type": "integer",
      "description": "Maximum visible materials in the panel",
      "minimum": 3,
      "maximum": 10,
      "default": 6
    },
    "progressBarWidth": {
      "type": "integer",
      "description": "Width of the progress bar",
      "minimum": 10,
      "maximum": 50,
      "default": 30
    },
    "progressFilledChar": {
      "type": "string",
      "description": "Character for filled progress portion",
      "minLength": 1,
      "maxLength": 1,
      "default": "#"
    },
    "progressEmptyChar": {
      "type": "string",
      "description": "Character for empty progress portion",
      "minLength": 1,
      "maxLength": 1,
      "default": "."
    },
    "progressAnimationSteps": {
      "type": "integer",
      "description": "Number of animation steps",
      "minimum": 1,
      "maximum": 50,
      "default": 10
    },
    "progressAnimationDelay": {
      "type": "integer",
      "description": "Delay between animation steps in milliseconds",
      "minimum": 10,
      "maximum": 500,
      "default": 100
    },
    "headerColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Yellow"
    },
    "craftableColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Green"
    },
    "notCraftableColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Red"
    },
    "selectionColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Cyan"
    },
    "sufficientMaterialColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Green"
    },
    "missingMaterialColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Red"
    },
    "progressBarColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Cyan"
    },
    "completionColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Green"
    }
  },
  "$defs": {
    "consoleColor": {
      "type": "string",
      "enum": [
        "Black", "DarkBlue", "DarkGreen", "DarkCyan",
        "DarkRed", "DarkMagenta", "DarkYellow", "Gray",
        "DarkGray", "Blue", "Green", "Cyan",
        "Red", "Magenta", "Yellow", "White"
      ]
    }
  },
  "additionalProperties": false
}
```

---

## 9. Room Interaction Integration

### 9.1 Integration Points

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Views/RoomView.cs` (modifications)

```csharp
// Add to RoomView class

private readonly CraftingStationMenu _craftingStationMenu;
private readonly ICraftingService _craftingService;
private readonly IResourceService _resourceService;

/// <summary>
/// Handles interaction with a crafting station in the room.
/// </summary>
/// <param name="station">The crafting station to interact with.</param>
private void HandleCraftingStationInteraction(CraftingStation station)
{
    var player = _gameState.CurrentPlayer;
    if (player == null)
    {
        _logger.LogWarning("Cannot interact with station - no current player");
        return;
    }

    // Convert station to display DTO
    var stationDto = new CraftingStationDisplayDto(
        StationId: station.Id,
        Name: station.Name,
        Description: station.Description,
        StationType: station.StationType.ToString(),
        SkillRequired: station.SkillRequired);

    // Get player resources
    var playerResources = GetPlayerResourceDisplayDtos(player);

    // Show crafting station menu
    _craftingStationMenu.SetPosition(_config.StationMenuX, _config.StationMenuY);
    _craftingStationMenu.RenderStation(stationDto, playerResources);

    _logger.LogDebug("Opened crafting station menu: {StationName}", station.Name);
}

/// <summary>
/// Converts player resources to display DTOs.
/// </summary>
/// <param name="player">The player entity.</param>
/// <returns>List of resource display DTOs.</returns>
private IEnumerable<ResourceStackDisplayDto> GetPlayerResourceDisplayDtos(Player player)
{
    var resources = _resourceService.GetPlayerResources(player);

    return resources.Select(pool => new ResourceStackDisplayDto(
        ResourceId: pool.ResourceTypeId,
        DisplayName: pool.DisplayName,
        Description: "",
        Category: MapToResourceCategory(pool.Category),
        Quantity: pool.Current));
}

/// <summary>
/// Handles keyboard input when crafting station menu is open.
/// </summary>
/// <param name="key">The pressed key.</param>
/// <returns>True if the input was handled.</returns>
private bool HandleCraftingStationInput(ConsoleKey key)
{
    if (!_craftingStationMenu.IsVisible)
    {
        return false;
    }

    return _craftingStationMenu.HandleInput(key);
}

/// <summary>
/// Detects crafting stations in the current room.
/// </summary>
/// <returns>List of crafting stations in the room.</returns>
private IReadOnlyList<CraftingStation> GetRoomCraftingStations()
{
    var room = _gameState.CurrentRoom;
    if (room == null)
    {
        return Array.Empty<CraftingStation>();
    }

    return room.CraftingStations;
}
```

### 9.2 Station Detection

**Crafting Station Detection:**
- Rooms contain a list of `CraftingStations`
- Each station has a type, name, and available recipes
- Stations are displayed in room description
- Player can interact with `interact` or `use` command

**Room Display with Station:**
```
BLACKSMITH'S WORKSHOP

A sturdy stone building filled with the smell of hot metal
and the sound of hammering. A large forge dominates the center.

Crafting Stations:
  [1] Blacksmith Forge - For metalworking

Commands: [1] Use Forge   [L]ook   [I]nventory
```

### 9.3 Command Handling

**Crafting Commands:**

| Command | Description |
|---------|-------------|
| `use forge` / `1` | Open crafting station menu |
| `craft [recipe]` | Quick craft a known recipe |
| `recipes` | List all known recipes |

---

## 10. Logging Specifications

### 10.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `CraftingStationMenu` | Information | Station opened, crafting started, crafting complete |
| `CraftingStationMenu` | Debug | Recipe selection, menu rendering, input handling |
| `CraftingStationMenu` | Warning | No recipes available, crafting failed |
| `MaterialAvailabilityDisplay` | Debug | Materials rendered, availability checks |
| `CraftingProgressRenderer` | Debug | Progress updates, animation steps |
| `RoomView` | Debug | Station interaction, menu opened/closed |
| `RoomView` | Warning | No current player, station not found |

### 10.2 Log Message Examples

```
[INF] CraftingStationMenu: Opened crafting station: Blacksmith Forge
[INF] CraftingStationMenu: Started crafting: Steel Blade
[INF] CraftingStationMenu: Crafting complete: Steel Blade
[DBG] CraftingStationMenu: Rendered crafting station Blacksmith Forge with 5 recipes
[DBG] CraftingStationMenu: Selected recipe at index 2: Steel Blade
[WRN] CraftingStationMenu: Cannot craft - insufficient materials
[DBG] MaterialAvailabilityDisplay: Rendered 3 material requirements
[DBG] CraftingProgressRenderer: Progress updated to 50%
[DBG] RoomView: Opened crafting station menu: Blacksmith Forge
[WRN] RoomView: Cannot interact with station - no current player
```

---

## 11. Unit Testing Requirements

### 11.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| CraftingStationMenu | ~3 |
| MaterialAvailabilityDisplay | ~3 |
| CraftingProgressRenderer | ~2 |
| **Total** | **~8** |

### 11.2 Test Specifications

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/CraftingStationMenuTests.cs`

```csharp
[TestFixture]
public class CraftingStationMenuTests
{
    private Mock<ICraftingService> _mockCraftingService;
    private Mock<IResourceService> _mockResourceService;
    private Mock<MaterialAvailabilityDisplay> _mockMaterialDisplay;
    private Mock<CraftingProgressRenderer> _mockProgressRenderer;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<ILogger<CraftingStationMenu>> _mockLogger;
    private CraftingStationConfig _config;
    private CraftingStationMenu _menu;

    [SetUp]
    public void Setup()
    {
        _config = new CraftingStationConfig();
        _mockCraftingService = new Mock<ICraftingService>();
        _mockResourceService = new Mock<IResourceService>();
        _mockMaterialDisplay = new Mock<MaterialAvailabilityDisplay>();
        _mockProgressRenderer = new Mock<CraftingProgressRenderer>(_config);
        _mockTerminal = new Mock<ITerminalService>();
        _mockLogger = new Mock<ILogger<CraftingStationMenu>>();

        _menu = new CraftingStationMenu(
            _mockCraftingService.Object,
            _mockResourceService.Object,
            _mockMaterialDisplay.Object,
            _mockProgressRenderer.Object,
            _mockTerminal.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    public void SelectNext_WithRecipes_AdvancesSelection()
    {
        // Arrange
        SetupRecipes(3);

        // Act
        _menu.SelectNext();

        // Assert
        Assert.That(_menu.SelectedIndex, Is.EqualTo(1));
    }

    [Test]
    public void SelectPrevious_AtFirstRecipe_WrapsToLast()
    {
        // Arrange
        SetupRecipes(3);

        // Act
        _menu.SelectPrevious();

        // Assert
        Assert.That(_menu.SelectedIndex, Is.EqualTo(2));
    }

    [Test]
    public void HandleInput_EscapeKey_HidesMenu()
    {
        // Arrange
        var station = CreateStationDto("forge-1", "Test Forge");
        _menu.RenderStation(station, Array.Empty<ResourceStackDisplayDto>());

        // Act
        var handled = _menu.HandleInput(ConsoleKey.Escape);

        // Assert
        Assert.That(handled, Is.True);
        Assert.That(_menu.IsVisible, Is.False);
    }

    #region Test Helpers

    private void SetupRecipes(int count)
    {
        var recipes = Enumerable.Range(0, count)
            .Select(i => new RecipeDefinition { Id = $"recipe-{i}", Name = $"Recipe {i}" })
            .ToList();

        _mockCraftingService.Setup(s => s.GetRecipesForStation(It.IsAny<string>()))
            .Returns(recipes);

        var station = CreateStationDto("test-station", "Test Station");
        _menu.RenderStation(station, Array.Empty<ResourceStackDisplayDto>());
    }

    private static CraftingStationDisplayDto CreateStationDto(string id, string name)
    {
        return new CraftingStationDisplayDto(
            StationId: id,
            Name: name,
            Description: "Test description",
            StationType: "Forge",
            SkillRequired: null);
    }

    #endregion
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/MaterialAvailabilityDisplayTests.cs`

```csharp
[TestFixture]
public class MaterialAvailabilityDisplayTests
{
    private Mock<ResourceStackRenderer> _mockRenderer;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<ILogger<MaterialAvailabilityDisplay>> _mockLogger;
    private CraftingStationConfig _config;
    private MaterialAvailabilityDisplay _display;

    [SetUp]
    public void Setup()
    {
        _config = new CraftingStationConfig();
        _mockRenderer = new Mock<ResourceStackRenderer>();
        _mockTerminal = new Mock<ITerminalService>();
        _mockLogger = new Mock<ILogger<MaterialAvailabilityDisplay>>();

        _display = new MaterialAvailabilityDisplay(
            _mockRenderer.Object,
            _mockTerminal.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    [TestCase(10, 5, "[x]")]
    [TestCase(5, 5, "[x]")]
    [TestCase(4, 5, "[ ]")]
    [TestCase(0, 5, "[ ]")]
    public void GetAvailabilityIndicator_WithQuantities_ReturnsCorrectIndicator(
        int owned, int required, string expected)
    {
        // Arrange
        var material = new MaterialRequirementDto(
            MaterialId: "test",
            MaterialName: "Test Material",
            RequiredQuantity: required,
            OwnedQuantity: owned,
            IsOptional: false);

        // Act
        var result = _display.GetAvailabilityIndicator(material, owned);

        // Assert
        Assert.That(result, Is.EqualTo(expected));
    }

    [Test]
    public void IsCraftable_WithSufficientMaterials_ReturnsTrue()
    {
        // Arrange
        var materials = new[]
        {
            CreateMaterial("iron-ore", 2, false),
            CreateMaterial("coal", 1, false)
        };

        var resources = new[]
        {
            CreateResource("iron-ore", 10),
            CreateResource("coal", 5)
        };

        // Act
        var result = _display.IsCraftable(materials, resources);

        // Assert
        Assert.That(result, Is.True);
    }

    [Test]
    public void IsCraftable_WithMissingMaterials_ReturnsFalse()
    {
        // Arrange
        var materials = new[]
        {
            CreateMaterial("iron-ore", 2, false),
            CreateMaterial("mithril-ore", 5, false)
        };

        var resources = new[]
        {
            CreateResource("iron-ore", 10),
            CreateResource("mithril-ore", 2)
        };

        // Act
        var result = _display.IsCraftable(materials, resources);

        // Assert
        Assert.That(result, Is.False);
    }

    #region Test Helpers

    private static MaterialRequirementDto CreateMaterial(string id, int required, bool optional)
    {
        return new MaterialRequirementDto(
            MaterialId: id,
            MaterialName: id.Replace("-", " "),
            RequiredQuantity: required,
            OwnedQuantity: 0,
            IsOptional: optional);
    }

    private static ResourceStackDisplayDto CreateResource(string id, int quantity)
    {
        return new ResourceStackDisplayDto(
            ResourceId: id,
            DisplayName: id.Replace("-", " "),
            Description: "",
            Category: ResourceCategory.Ore,
            Quantity: quantity);
    }

    #endregion
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/Renderers/CraftingProgressRendererTests.cs`

```csharp
[TestFixture]
public class CraftingProgressRendererTests
{
    private CraftingStationConfig _config;
    private CraftingProgressRenderer _renderer;

    [SetUp]
    public void Setup()
    {
        _config = new CraftingStationConfig { ProgressBarWidth = 20 };
        _renderer = new CraftingProgressRenderer(_config);
    }

    [Test]
    [TestCase(0f, "[....................]")]
    [TestCase(0.5f, "[##########..........]")]
    [TestCase(1f, "[####################]")]
    public void FormatProgressBar_WithProgress_ReturnsCorrectFormat(
        float progress, string expected)
    {
        // Act
        var result = _renderer.FormatProgressBar(progress);

        // Assert
        Assert.That(result, Is.EqualTo(expected));
    }

    [Test]
    public void RenderProgress_WithRecipeName_IncludesName()
    {
        // Act
        var result = _renderer.RenderProgress(0.5f, "Steel Blade");

        // Assert
        Assert.That(result, Does.Contain("Steel Blade"));
        Assert.That(result, Does.Contain("50%"));
    }
}
```

---

## 12. Use Cases

### UC-001: Open Crafting Station

**Actor:** Player
**Flow:** Enter room with crafting station → Use interact command → Crafting station menu opens → View available recipes → Understand craftable options

### UC-002: View Recipe Requirements

**Actor:** Player
**Flow:** Open crafting station → Select recipe → View material panel → See required vs owned quantities → Determine if materials are sufficient

### UC-003: Craft Item with Sufficient Materials

**Actor:** Player
**Flow:** Select craftable recipe (marked `[x]`) → Press `C` to craft → View crafting progress → Receive completion message → Item added to inventory

### UC-004: Attempt Craft with Missing Materials

**Actor:** Player
**Flow:** Select non-craftable recipe (marked `[ ]`) → Press `C` to craft → See "Insufficient materials" message → View missing materials highlighted in red → Gather needed resources

### UC-005: Navigate Recipe List

**Actor:** Player
**Flow:** Open crafting station → Use ↑/↓ to navigate → See selection indicator move → Material panel updates for selected recipe → Choose desired recipe

### UC-006: Close Crafting Station

**Actor:** Player
**Flow:** Open crafting station → View recipes → Press Escape → Menu closes → Return to room view

---

## 13. Deliverable Checklist

### UI Components
- [ ] `CraftingStationMenu` class implemented
- [ ] `RenderStation()` method renders station header and recipes
- [ ] `RenderRecipeList()` method displays recipe entries
- [ ] `SelectRecipe()`, `SelectPrevious()`, `SelectNext()` navigation methods
- [ ] `ShowCraftingProgress()` method displays progress bar
- [ ] `HandleInput()` method processes keyboard input
- [ ] `MaterialAvailabilityDisplay` class implemented
- [ ] `RenderMaterials()` method displays material requirements
- [ ] `GetAvailabilityIndicator()` returns correct indicators
- [ ] `IsCraftable()` checks material availability

### Renderers
- [ ] `CraftingProgressRenderer` class implemented
- [ ] `RenderProgress()` formats progress display
- [ ] `FormatProgressBar()` creates progress bar string
- [ ] `ShowComplete()` displays completion message

### DTOs
- [ ] `CraftingStationDisplayDto` record created
- [ ] `StationRecipeDisplayDto` record created
- [ ] `MaterialRequirementDto` record created
- [ ] `CraftingProgressDto` record created

### Configuration
- [ ] `CraftingStationConfig` class created
- [ ] `config/crafting-station.json` created
- [ ] `config/schemas/crafting-station.schema.json` created

### View Integration
- [ ] `RoomView` updated with `HandleCraftingStationInteraction()`
- [ ] Station detection implemented
- [ ] Input handling for crafting menu
- [ ] Resource display DTO conversion

### Testing
- [ ] ~8 unit tests implemented
- [ ] All tests passing

---

## 14. Acceptance Criteria

### Functional
- [ ] Crafting station menu shows station name
- [ ] Station-specific recipes display correctly
- [ ] Craftable recipes marked with `[x]`
- [ ] Non-craftable recipes marked with `[ ]`
- [ ] Material availability highlights owned vs needed
- [ ] Missing materials highlighted in red
- [ ] Recipe navigation with ↑/↓ arrows works
- [ ] Selected recipe highlighted with indicator
- [ ] Crafting progress shows during creation
- [ ] Completion message displays on finish
- [ ] Menu closes with Escape key
- [ ] Material panel updates when selection changes

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~8 unit tests pass
- [ ] Configuration file validates against schema
- [ ] XML documentation complete on all public members
- [ ] No hardcoded values (all configurable)

---

## 15. Dependencies

### Required from v0.11.x

| Type | Location | Usage in v0.13.3b |
|------|----------|-------------------|
| `ICraftingService` | `Application/Interfaces/` | Get recipes, craft items |
| `IResourceService` | `Application/Interfaces/` | Get player resources |
| `CraftingStation` | `Domain/Entities/` | Station information |
| `RecipeDefinition` | `Domain/Entities/` | Recipe data |
| `RecipeMaterial` | `Domain/ValueObjects/` | Material requirements |
| `CraftingResult` | `Domain/ValueObjects/` | Crafting outcome |

### Required from v0.13.3a

| Type | Location | Usage in v0.13.3b |
|------|----------|-------------------|
| `ResourceStackDisplayDto` | `Presentation.Tui/DTOs/` | Resource display |
| `ResourceStackRenderer` | `Presentation.Tui/Renderers/` | Resource formatting |
| `ResourceCategory` | `Presentation.Tui/DTOs/` | Category mapping |

### Required from Existing Infrastructure

| Type | Location | Usage in v0.13.3b |
|------|----------|-------------------|
| `ITerminalService` | `Presentation.Tui/Services/` | Terminal output |
| `RoomView` | `Presentation.Tui/Views/` | Integration point |
| `Player` | `Domain/Entities/` | Player resources |

### Provides to v0.13.3c

| Type | Usage |
|------|-------|
| `StationRecipeDisplayDto` | Recipe browser display |
| `MaterialRequirementDto` | Recipe details view |
| `CraftingProgressRenderer` | Shared progress rendering |

---

## 16. Future Considerations

### Deferred to v0.13.3c

- **Recipe Browser**: Search and filter recipes across all stations
- **Recipe Details View**: Full recipe information with output preview
- **Recipe Book**: Discovered recipes collection
- **Quality Result Display**: Show crafted item quality tier
- **Recipe Discovery Notification**: Alert on new recipe learned

### Deferred to v0.13.3d

- **Gathering Display**: Harvestable resource indicators
- **Dice Check Display**: Gathering roll visualization
- **Yield Display**: Gathered resource feedback

### Out of Scope

- **Crafting Queue**: Queue multiple items for crafting
- **Bulk Crafting**: Craft multiple of same item at once
- **Crafting Skill Effects**: Skill bonuses to crafting
- **Station Upgrades**: Improve crafting stations
- **Material Substitution**: Use alternative materials
- **Crafting Failure**: Chance-based crafting failure
- **Salvaging**: Break down items into materials

### Potential Enhancements (Future Versions)

- **Recipe Favorites**: Pin frequently used recipes
- **Material Shortcuts**: Quick access to common materials
- **Crafting History**: Track recently crafted items
- **Station Customization**: Personalize station appearance
- **Recipe Comparison**: Compare recipes side by side
- **Auto-Craft**: Automatically craft when materials gathered

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
*Author: Claude (AI Assistant)*
