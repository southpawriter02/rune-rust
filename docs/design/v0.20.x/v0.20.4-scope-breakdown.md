# v0.20.4 Scope Breakdown: Myrk-gengr (Shadow-Walker)

**Version:** 0.20.4
**Theme:** Myrk-gengr Specialization Implementation
**Prerequisites:** v0.20.3 Complete (Jötun-Reader Specialization)
**Total Estimated Tests:** ~25 new tests

---

## Executive Summary

v0.20.4 implements the **Myrk-gengr (Shadow-Walker)** specialization — the stealth and shadow-magic ability tree for the Skirmisher archetype. The Myrk-gengr is the **first Heretical path specialization** in the v0.20.x series, introducing Corruption risk mechanics tied to shadow abilities. These assassins have learned to merge with darkness itself, trading their connection to stable reality for power drawn from the void between light and shadow.

> *"The shadows are not where we hide. They are what we become."*

The work is divided into **3 sub-phases**:

| Phase | Name | Focus | Est. Tests |
|-------|------|-------|------------|
| v0.20.4a | Framework & Tier 1 Abilities | Shadow Essence resource, Shadow Step, Cloak of Night, Dark-Adapted | ~10 |
| v0.20.4b | Tier 2 Abilities | Umbral Strike, Shadow Clone, Void Touched | ~8 |
| v0.20.4c | Tier 3 Abilities & Capstone | Merge with Darkness, Shadow Snare, Eclipse | ~7 |

---

## Specialization Profile

### Myrk-gengr Identity

| Attribute | Value |
|-----------|-------|
| **Display Name** | Myrk-gengr |
| **Pronunciation** | MIRK-gen-gur |
| **Translation** | Shadow-Walker / Darkness-Goer |
| **Archetype** | Skirmisher |
| **Path Type** | Heretical |
| **Role** | Stealth / Assassination / Shadow Magic |
| **Special Resource** | Shadow Essence (Max 50) |
| **Tagline** | "One with the Darkness" |

### Thematic Elements

The Myrk-gengr walks a dangerous path, having touched the void between light and shadow. In Aethelgard, shadows are not merely the absence of light — they are a liminal space where reality grows thin and the Glitch seeps through. The Myrk-gengr has learned to draw power from this dangerous boundary, becoming more shadow than flesh. Their abilities let them slip between spaces, strike from darkness, and eventually merge completely with the void.

**Design Principles:**
1. **Heretical Risk**: Shadow abilities carry Corruption risk, especially in bright light
2. **Darkness Dependency**: Power increases in shadow, penalties in bright light
3. **Mobility Focus**: Teleportation and phasing for tactical repositioning
4. **Assassination Mastery**: High burst damage from stealth
5. **First Heretical Specialization**: Establishes Corruption integration patterns for v0.20.5+

### Heretical Path — Corruption Mechanics

As the first Heretical specialization, the Myrk-gengr establishes patterns for Corruption risk:

| Trigger | Corruption Risk |
|---------|-----------------|
| Using shadow abilities in bright light | +1 Corruption per ability |
| Targeting Coherent-aligned creatures | +1 Corruption per attack |
| Using Capstone (Eclipse) | +2 Corruption |
| Remaining in shadow form extended periods | +1 Corruption per 10 turns |

---

## Feature Analysis & Categorization

### From v0.20.x-overview.md — Ability Tier Structure

| Ability | Tier | Type | Complexity | Assigned Phase |
|---------|------|------|------------|----------------|
| Shadow Step | T1 | Active | High | **v0.20.4a** |
| Cloak of Night | T1 | Stance | Medium | **v0.20.4a** |
| Dark-Adapted | T1 | Passive | Low | **v0.20.4a** |
| Umbral Strike | T2 | Attack | Medium | **v0.20.4b** |
| Shadow Clone | T2 | Active | High | **v0.20.4b** |
| Void Touched | T2 | Passive | Low | **v0.20.4b** |
| Merge with Darkness | T3 | Active | High | **v0.20.4c** |
| Shadow Snare | T3 | Active | Medium | **v0.20.4c** |
| Eclipse | Cap | Ultimate | High | **v0.20.4c** |

### From v0.20.x-overview.md — Special Resource

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Shadow Essence (Max 50) | Medium | Resource System (Core) | **v0.20.4a** |
| Shadow Essence generation (darkness) | Medium | Lighting System | **v0.20.4a** |
| Shadow Essence spending | Low | Ability execution | **v0.20.4a** |
| Corruption risk integration | High | CorruptionService (v0.18.x) | **v0.20.4a** |

---

## Phase Definitions

---

## v0.20.4a: Framework & Tier 1 Abilities

[v0.20.4a Design Specification](v0.20.4a-design-specification.md)

### Overview

This phase establishes the Myrk-gengr specialization framework including the Shadow Essence special resource, Corruption risk integration, and implements the three Tier 1 abilities that define the core shadow-walker identity.

### Scope

**In Scope:**
- `MyrkgengrSpecialization` registration with v0.17.4 framework
- `ShadowEssenceResource` special resource implementation
- Shadow Essence generation in darkness/shadows
- Corruption risk integration for Heretical path
- Shadow Step active ability (teleport to shadow)
- Cloak of Night stance ability (+3 Stealth, silent movement)
- Dark-Adapted passive ability (no dim light penalties)
- Light level detection for ability effects
- Ability slot initialization for Myrk-gengr
- Configuration entries in `specializations.json` and `abilities.json`

**Out of Scope:**
- Tier 2 abilities (v0.20.4b)
- Tier 3 abilities and Capstone (v0.20.4c)
- Other specialization implementations (v0.20.5+)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Value Objects | 4 | `ShadowEssenceResource`, `ShadowPosition`, `LightLevel`, `CorruptionRiskResult` |
| Domain Enums | 3 | `MyrkgengrAbilityId`, `LightLevelType`, `ShadowAbilityType` |
| Application Services | 3 | `ShadowEssenceService`, `MyrkgengrAbilityService`, `ShadowCorruptionService` |
| Ability Implementations | 3 | Shadow Step, Cloak of Night, Dark-Adapted |
| Configuration | 2 | `specializations.json` updates, `abilities.json` updates |
| Unit Tests | ~10 | |

### Data Model Changes

```
NEW: ShadowEssenceResource (Value Object)
├── CurrentEssence: int (0-50)
├── MaxEssence: int (default 50)
├── LastGeneratedAt: DateTime?
├── GenerationRate: int (per turn in darkness)
└── Methods:
    ├── Spend(int amount): bool
    ├── Generate(int amount): void
    ├── GenerateFromDarkness(LightLevelType lightLevel): void
    ├── GetCurrentValue(): int
    └── IsInDarkness(LightLevelType lightLevel): bool

NEW: ShadowPosition (Value Object)
├── PositionId: Guid
├── X: int
├── Y: int
├── LightLevel: LightLevelType
├── IsShadow: bool
├── IsValidTeleportTarget: bool
└── Methods:
    ├── DistanceTo(ShadowPosition other): int
    ├── IsWithinRange(ShadowPosition origin, int range): bool
    └── GetShadowQuality(): int

NEW: LightLevel (Value Object)
├── CurrentLevel: LightLevelType
├── SourceType: string
├── Intensity: int (0-100)
├── AffectedArea: int
└── Methods:
    ├── IsDarkness(): bool
    ├── IsDimLight(): bool
    ├── IsBrightLight(): bool
    └── GetShadowEssenceMultiplier(): float

NEW: CorruptionRiskResult (Value Object)
├── RiskTriggered: bool
├── CorruptionGained: int
├── Reason: string
├── AbilityUsed: string
├── LightCondition: LightLevelType
└── Methods:
    ├── GetDescription(): string
    └── WasInBrightLight(): bool

NEW: LightLevelType (Enum)
├── Darkness - No light, full shadow power
├── DimLight - Partial shadow, reduced penalties
├── NormalLight - Standard lighting
├── BrightLight - Full light, Corruption risk
└── MagicalLight - Aetheric light sources

NEW: MyrkgengrAbilityId (Enum)
├── ShadowStep
├── CloakOfNight
├── DarkAdapted
├── UmbralStrike
├── ShadowClone
├── VoidTouched
├── MergeWithDarkness
├── ShadowSnare
└── Eclipse

NEW: ShadowAbilityType (Enum)
├── Teleportation - Movement through shadow
├── Concealment - Stealth enhancement
├── Attack - Shadow-empowered strikes
├── Illusion - Shadow duplicates
├── Transformation - Becoming shadow
└── AreaEffect - Shadow manipulation

MODIFY: Character (Entity)
├── ADD: ShadowEssence: ShadowEssenceResource?
├── ADD: IsInShadowForm: bool
├── ADD: CurrentLightLevel: LightLevelType
└── ADD: ShadowClones: IReadOnlyList<ShadowClone>
```

### Tier 1 Ability Specifications

#### Shadow Step (Active)

| Property | Value |
|----------|-------|
| **ID** | `shadow-step` |
| **Type** | Active |
| **AP Cost** | 2 AP |
| **Shadow Essence Cost** | 10 |
| **Range** | 6 spaces |
| **Effect** | Teleport to shadow within range |
| **Corruption Risk** | +1 if used in bright light |

**Mechanics:**
- Instantly teleport to any space within 6 spaces that contains shadow
- Destination must have LightLevel of Darkness or DimLight
- Cannot teleport into occupied spaces
- Cannot teleport into bright light
- Line of sight not required (can teleport through walls to shadows)
- Generates 5 Shadow Essence if arriving in Darkness
- Triggers Corruption check if originating from bright light

**Targeting Validation:**
| Condition | Valid Target? |
|-----------|---------------|
| Darkness | Yes |
| Dim Light | Yes |
| Normal Light | No |
| Bright Light | No |
| Occupied | No |
| Within 6 spaces | Required |

#### Cloak of Night (Stance)

| Property | Value |
|----------|-------|
| **ID** | `cloak-of-night` |
| **Type** | Stance |
| **AP Cost** | 1 AP to enter |
| **Shadow Essence Cost** | 5 (per turn to maintain) |
| **Effect** | +3 Stealth, movement in shadows is silent |
| **Corruption Risk** | +1 per turn if maintained in bright light |

**Mechanics:**
- While active, gain +3 to all Stealth checks
- Movement in shadows (Darkness or DimLight) makes no sound
- Enemies suffer -2 to Perception checks to detect you
- Costs 5 Shadow Essence per turn to maintain
- Automatically ends if Shadow Essence depleted
- In bright light: -1 Stealth penalty instead of +3, Corruption risk

**Stance Effects by Light Level:**
| Light Level | Stealth Bonus | Silent Movement | Essence Cost |
|-------------|---------------|-----------------|--------------|
| Darkness | +3 | Yes | 5/turn |
| Dim Light | +3 | Yes | 5/turn |
| Normal Light | +1 | No | 5/turn |
| Bright Light | -1 | No | 5/turn + Corruption |

#### Dark-Adapted (Passive)

| Property | Value |
|----------|-------|
| **ID** | `dark-adapted` |
| **Type** | Passive |
| **Effect** | No penalties in dim light |
| **Corruption Risk** | None (passive ability) |

**Mechanics:**
- Removes all penalties normally associated with dim light
- Can see normally in dim light (no disadvantage on Perception)
- Attack rolls unaffected by dim light
- Skill checks unaffected by dim light
- Does not grant darkvision (true Darkness still imposes penalties)
- Passively generates 2 Shadow Essence per turn when in Darkness

**Dim Light Penalty Removal:**
| Penalty Type | Normal Effect | With Dark-Adapted |
|--------------|---------------|-------------------|
| Perception | -2 | No penalty |
| Attack Rolls | -1 | No penalty |
| Skill Checks | -1 | No penalty |
| Movement | Half speed | Normal speed |

### User-Facing Changes

**Commands:**
```
> ability shadow-step <position>   # Teleport to shadow
> stance cloak-of-night            # Enter shadow cloak stance
> stance end                       # End current stance
> status                           # Shows Shadow Essence: 50/50
```

**Output Example:**
```
╔══════════════════════════════════════════════════════════════╗
║  MYRK-GENGR - Ragnhild Shadowborn                            ║
╠══════════════════════════════════════════════════════════════╣
║  HP: 22/22    Defense: 13    AP: 7/7                         ║
║  Shadow Essence: ██████████████████████████ 50/50            ║
║  Corruption: ░░░░░░░░░░ 0/10                                 ║
║                                                              ║
║  Current Light: Dim Light                                    ║
║  Stance: [Cloak of Night] Active - Silent movement           ║
║                                                              ║
║  [Dark-Adapted] No dim light penalties                       ║
║  [HERETICAL] Shadow abilities risk Corruption in bright light║
╚══════════════════════════════════════════════════════════════╝

> shadow-step E4

You dissolve into shadow and emerge 5 spaces away.
Shadow Essence: 40/50 (-10)
Arrived in Darkness: +5 Shadow Essence → 45/50
```

### Acceptance Criteria

- [ ] Myrk-gengr specialization registered in SpecializationDefinition
- [ ] Shadow Essence initializes to 50/50 on character creation/selection
- [ ] Shadow Essence generates when in Darkness (2/turn passive, variable on actions)
- [ ] Shadow Step teleports to valid shadow locations within 6 spaces
- [ ] Shadow Step triggers Corruption check when used in bright light
- [ ] Cloak of Night grants +3 Stealth and silent movement
- [ ] Cloak of Night costs 5 Shadow Essence per turn
- [ ] Dark-Adapted removes dim light penalties
- [ ] Heretical path Corruption integration functional
- [ ] Ability slots correctly show Tier 1 abilities as unlocked
- [ ] ~10 unit tests pass

---

## v0.20.4b: Tier 2 Abilities

[v0.20.4b Design Specification](v0.20.4b-design-specification.md)

### Overview

This phase implements the three Tier 2 abilities that expand the Myrk-gengr's offensive capabilities with shadow-empowered attacks, illusory duplicates, and Aetheric damage resistance.

### Scope

**In Scope:**
- Umbral Strike attack ability (+2d6 damage from shadow)
- Shadow Clone active ability (create illusory duplicate)
- Void Touched passive ability (resistance to Aetheric damage)
- Tier 2 unlock validation (requires 8 PP invested in tree)
- PP cost enforcement (4 PP per Tier 2 ability)
- Enhanced Corruption mechanics for offensive abilities

**Out of Scope:**
- Tier 3 abilities and Capstone (v0.20.4c)
- Shadow Essence modifications (established in v0.20.4a)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Value Objects | 2 | `ShadowClone`, `UmbralStrikeResult` |
| Domain Enums | 1 | `CloneBehavior` |
| Ability Implementations | 3 | Umbral Strike, Shadow Clone, Void Touched |
| Combat Integration | 2 | Shadow damage bonus, Aetheric resistance |
| Unit Tests | ~8 | |

### Tier 2 Ability Specifications

#### Umbral Strike (Attack)

| Property | Value |
|----------|-------|
| **ID** | `umbral-strike` |
| **Type** | Attack |
| **AP Cost** | 3 AP |
| **Shadow Essence Cost** | 15 |
| **Effect** | Attack from shadow deals +2d6 damage |
| **PP Cost** | 4 PP to unlock |
| **Prerequisite** | 8 PP invested in Myrk-gengr tree |
| **Corruption Risk** | +1 if target is Coherent-aligned |

**Mechanics:**
- Must be in shadow (Darkness or DimLight) to use
- Attack automatically gains surprise if target unaware
- Deals weapon damage + 2d6 shadow damage
- Shadow damage bypasses non-magical armor
- On critical hit, additional +1d6 shadow damage
- Consuming a Shadow Clone for this attack grants advantage

**Damage Calculation:**
| Component | Damage |
|-----------|--------|
| Base Weapon | Weapon damage |
| Shadow Bonus | +2d6 |
| Critical Bonus | +1d6 |
| Surprise Attack | Automatic critical threat |

#### Shadow Clone (Active)

| Property | Value |
|----------|-------|
| **ID** | `shadow-clone` |
| **Type** | Active |
| **AP Cost** | 2 AP |
| **Shadow Essence Cost** | 20 |
| **Duration** | 1 minute or until destroyed |
| **Effect** | Create illusory duplicate |
| **PP Cost** | 4 PP to unlock |
| **Prerequisite** | 8 PP invested in Myrk-gengr tree |
| **Corruption Risk** | +1 if created in bright light |

**Mechanics:**
- Create shadow duplicate within 3 spaces
- Clone appears identical to caster
- Clone can move (4 spaces/turn) but cannot attack
- Clone has 1 HP (destroyed by any damage)
- Enemies must succeed DC 14 Perception to identify clone
- Maximum 2 clones active at once
- Clone can be consumed for Umbral Strike advantage

**Clone Behaviors:**
| Behavior | Description |
|----------|-------------|
| Mirror | Copies caster's movements |
| Independent | Moves randomly within 6 spaces |
| Decoy | Moves toward nearest enemy |
| Static | Remains in place |

**Clone Stats:**
| Stat | Value |
|------|-------|
| HP | 1 |
| Defense | Equal to caster |
| Movement | 4 spaces |
| Attacks | Cannot attack |
| Detection DC | 14 |

#### Void Touched (Passive)

| Property | Value |
|----------|-------|
| **ID** | `void-touched` |
| **Type** | Passive |
| **Effect** | Resistance to Aetheric damage |
| **PP Cost** | 4 PP to unlock |
| **Prerequisite** | 8 PP invested in Myrk-gengr tree |
| **Corruption Risk** | None (passive ability) |

**Mechanics:**
- Take half damage from Aetheric damage sources
- Aetheric effects have -2 to hit you
- Advantage on saves against Aetheric effects
- Does not protect against Corruption (Corruption is metaphysical, not damage)
- Extends to magical effects with Aetheric origin

**Damage Reduction:**
| Aetheric Source | Normal Damage | With Void Touched |
|-----------------|---------------|-------------------|
| Seiðr Bolt | 2d6 | 1d6 |
| Aether Storm | 4d6 | 2d6 |
| Glitch Discharge | 3d6 | Rounded down (1d6+1) |

### Data Model Changes

```
NEW: ShadowClone (Value Object)
├── CloneId: Guid
├── OwnerId: Guid
├── Position: Position
├── CurrentHp: int (1)
├── Defense: int (matches owner)
├── Behavior: CloneBehavior
├── CreatedAt: DateTime
├── ExpiresAt: DateTime
├── IsDestroyed: bool
└── Methods:
    ├── TakeDamage(int damage): bool (returns true if destroyed)
    ├── Move(Position newPosition): void
    ├── SetBehavior(CloneBehavior behavior): void
    ├── IsExpired(): bool
    └── Consume(): void

NEW: UmbralStrikeResult (Value Object)
├── AttackRoll: int
├── BaseDamage: int
├── ShadowDamage: int (2d6)
├── CriticalDamage: int (1d6 if crit)
├── TotalDamage: int
├── WasSurprise: bool
├── ConsumedClone: bool
├── CorruptionTriggered: bool
└── Methods:
    ├── GetDamageBreakdown(): string
    └── IsCritical(): bool

NEW: CloneBehavior (Enum)
├── Mirror - Copies caster movements
├── Independent - Moves randomly
├── Decoy - Moves toward enemies
└── Static - Remains stationary
```

### Acceptance Criteria

- [ ] Tier 2 abilities locked until 8 PP invested in tree
- [ ] Each Tier 2 ability costs 4 PP to unlock
- [ ] Umbral Strike deals +2d6 shadow damage from shadow
- [ ] Umbral Strike requires being in Darkness or DimLight
- [ ] Shadow Clone creates illusory duplicate with correct stats
- [ ] Shadow Clone maximum 2 active at once
- [ ] Shadow Clone detection DC is 14
- [ ] Void Touched grants resistance to Aetheric damage
- [ ] Corruption triggers appropriately for Heretical abilities
- [ ] ~8 unit tests pass

---

## v0.20.4c: Tier 3 Abilities & Capstone

[v0.20.4c Design Specification](v0.20.4c-design-specification.md)

### Overview

This phase implements the two Tier 3 abilities and the Capstone ultimate that represent the pinnacle of shadow mastery, including becoming incorporeal, binding enemies in their own shadows, and the devastating Eclipse ability that extinguishes all light.

### Scope

**In Scope:**
- Merge with Darkness active ability (become incorporeal)
- Shadow Snare active ability (root enemy in their shadow)
- Eclipse ultimate ability (extinguish all light, full concealment)
- Tier 3 unlock validation (requires 16 PP invested in tree)
- Capstone unlock validation (requires 24 PP invested in tree)
- PP cost enforcement (5 PP per Tier 3, 6 PP for Capstone)
- Enhanced Corruption mechanics for Capstone

**Out of Scope:**
- Other specialization implementations (v0.20.5+)
- Berserkr (v0.20.5)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Value Objects | 3 | `IncorporealState`, `ShadowSnareEffect`, `EclipseZone` |
| Domain Enums | 1 | `IncorporealRestriction` |
| Ability Implementations | 3 | Merge with Darkness, Shadow Snare, Eclipse |
| Area Effect System | 1 | Light extinguishing mechanics |
| Unit Tests | ~7 | |

### Tier 3 & Capstone Ability Specifications

#### Merge with Darkness (Active)

| Property | Value |
|----------|-------|
| **ID** | `merge-with-darkness` |
| **Type** | Active |
| **AP Cost** | 3 AP |
| **Shadow Essence Cost** | 25 |
| **Duration** | 1 turn |
| **Effect** | Become incorporeal |
| **PP Cost** | 5 PP to unlock |
| **Prerequisite** | 16 PP invested in Myrk-gengr tree |
| **Corruption Risk** | +1 per turn if extended beyond duration |

**Mechanics:**
- Become incorporeal shadow for 1 turn
- Cannot be targeted by physical attacks
- Can move through solid objects (walls, enemies)
- Cannot attack or interact with physical objects
- Immune to opportunity attacks
- Vulnerable to magical light (takes 2d6 damage from light spells)
- Can extend duration by spending 25 additional Shadow Essence (+1 Corruption)

**Incorporeal Restrictions:**
| Action | Allowed? |
|--------|----------|
| Movement | Yes (through objects) |
| Physical Attacks | No |
| Shadow Abilities | Limited (Shadow Step only) |
| Receiving Physical Damage | Immune |
| Receiving Magical Light Damage | 2d6 vulnerability |
| Ending in Solid Object | Forced out, takes 3d6 |

#### Shadow Snare (Active)

| Property | Value |
|----------|-------|
| **ID** | `shadow-snare` |
| **Type** | Active |
| **AP Cost** | 2 AP |
| **Shadow Essence Cost** | 20 |
| **Range** | 6 spaces |
| **Duration** | 2 turns |
| **Effect** | Root enemy in their own shadow |
| **PP Cost** | 5 PP to unlock |
| **Prerequisite** | 16 PP invested in Myrk-gengr tree |
| **Corruption Risk** | +1 if target is Coherent-aligned |

**Mechanics:**
- Target's shadow becomes animate and grasps them
- Target is Rooted (cannot move) for 2 turns
- Target can attack and use abilities normally
- Save (DC 14) at end of each turn to escape
- Only works if target has a shadow (fails in total darkness or if target shadowless)
- Break conditions: target enters bright light, or successful save

**Save Modifiers:**
| Condition | Modifier |
|-----------|----------|
| Target in Dim Light | +0 |
| Target in Normal Light | -2 to DC |
| Target has Shadow resistance | Advantage on save |
| Target is Undead | Immune (no shadow) |

#### Eclipse (Ultimate/Capstone)

| Property | Value |
|----------|-------|
| **ID** | `eclipse` |
| **Type** | Ultimate |
| **AP Cost** | 5 AP |
| **Shadow Essence Cost** | 40 |
| **Range** | Self (8-space radius) |
| **Duration** | 3 turns |
| **Effect** | Extinguish all light in area, gain full concealment |
| **Cooldown** | Once per combat |
| **PP Cost** | 6 PP to unlock |
| **Prerequisite** | 24 PP invested in Myrk-gengr tree |
| **Corruption Risk** | +2 (always triggers) |

**Mechanics:**
- Create zone of absolute darkness in 8-space radius
- All light sources in area extinguished (magical lights get save DC 16)
- You gain full concealment (50% miss chance against you)
- You can see normally within the Eclipse zone
- Allies cannot see (treat as blinded unless they have darkvision)
- Regenerate 10 Shadow Essence per turn while Eclipse active
- Cannot be dispelled by non-Aetheric means

**Eclipse Zone Effects:**
| Effect | Description |
|--------|-------------|
| All Light Extinguished | Non-magical automatic, magical DC 16 |
| Caster Concealment | 50% miss chance |
| Caster Vision | Normal within zone |
| Ally Vision | Blinded (no darkvision) |
| Enemy Vision | Blinded |
| Shadow Essence Regen | +10/turn to caster |
| Duration | 3 turns |
| Corruption | +2 guaranteed |

**Light Interaction:**
| Light Type | Effect |
|------------|--------|
| Torches/Mundane | Automatically extinguished |
| Magical (low power) | Save DC 16 or extinguished |
| Magical (high power) | Save DC 16, creates dim light bubble |
| Divine/Aetheric | May pierce Eclipse (GM discretion) |

### Data Model Changes

```
NEW: IncorporealState (Value Object)
├── StateId: Guid
├── CharacterId: Guid
├── StartedAt: DateTime
├── EndsAt: DateTime
├── TurnsRemaining: int
├── WasExtended: bool
├── ExtensionCount: int
├── CorruptionAccrued: int
└── Methods:
    ├── Extend(int essenceCost): bool
    ├── Tick(): void
    ├── IsActive(): bool
    ├── GetCorruptionTotal(): int
    └── CanPassThrough(Position target): bool

NEW: ShadowSnareEffect (Value Object)
├── EffectId: Guid
├── CasterId: Guid
├── TargetId: Guid
├── StartedAt: DateTime
├── TurnsRemaining: int
├── SaveDc: int (14)
├── HasEscaped: bool
├── EscapeMethod: string?
└── Methods:
    ├── Tick(): void
    ├── AttemptEscape(int saveRoll): bool
    ├── BreakOnBrightLight(): void
    ├── IsActive(): bool
    └── GetDescription(): string

NEW: EclipseZone (Value Object)
├── ZoneId: Guid
├── CasterId: Guid
├── CenterPosition: Position
├── Radius: int (8)
├── TurnsRemaining: int
├── ExtinguishedLights: IReadOnlyList<Guid>
├── EssenceGenerated: int
├── CorruptionGenerated: int
├── CreatedAt: DateTime
└── Methods:
    ├── Tick(): void
    ├── IsPositionInZone(Position pos): bool
    ├── ExtinguishLight(Guid lightId, bool isMagical): bool
    ├── GenerateEssence(): int
    ├── IsActive(): bool
    └── GetAffectedPositions(): IReadOnlyList<Position>

NEW: IncorporealRestriction (Enum)
├── CannotAttack - Physical attacks forbidden
├── CannotInteract - Cannot manipulate objects
├── VulnerableToLight - Takes damage from light magic
├── ShadowAbilitiesOnly - Only shadow abilities work
└── NoEndingInSolid - Must exit solid objects
```

### Acceptance Criteria

- [ ] Tier 3 abilities locked until 16 PP invested in tree
- [ ] Capstone locked until 24 PP invested in tree
- [ ] Tier 3 abilities cost 5 PP each to unlock
- [ ] Capstone costs 6 PP to unlock
- [ ] Merge with Darkness grants incorporeal state for 1 turn
- [ ] Merge with Darkness allows movement through solid objects
- [ ] Shadow Snare roots enemy for 2 turns (DC 14 save)
- [ ] Shadow Snare only works on targets with shadows
- [ ] Eclipse extinguishes all light in 8-space radius
- [ ] Eclipse grants 50% concealment to caster
- [ ] Eclipse always triggers +2 Corruption
- [ ] Eclipse usable once per combat
- [ ] ~7 unit tests pass

---

## Dependencies & Prerequisites

```
v0.17.3 (Archetype System) - REQUIRED
    │
    └── Skirmisher archetype foundation
                                    │
                                    ▼
v0.17.4 (Specialization Framework) - REQUIRED
    │
    ├── SpecializationDefinition entity
    ├── SpecializationPathType enum (includes Heretical)
    ├── SpecializationId enum (includes Myrkgengr)
    ├── SpecialResourceDefinition
    └── Tier unlock mechanics (8/16/24 PP)
                                    │
                                    ▼
v0.18.x (Corruption System) - REQUIRED
    │
    ├── CorruptionService
    ├── Corruption tracking
    ├── Corruption thresholds
    └── Corruption effects
                                    │
                                    ▼
v0.20.0 (Legacy Class Removal) - REQUIRED
    │
    ├── IAbilitySlotService
    ├── ISpecializationPrerequisiteService
    └── Migration infrastructure
                                    │
                                    ▼
v0.20.1-v0.20.3 (Prior Specializations) - REQUIRED
    │
    └── Establish specialization ability patterns
                                    │
                                    ▼
v0.20.4 (Myrk-gengr)
    │
    ├── v0.20.4a: Framework & Tier 1 ──────────────────┐
    │       ├── ShadowEssenceResource                   │
    │       ├── Corruption integration (FIRST HERETICAL)│
    │       ├── Shadow Step                             │
    │       ├── Cloak of Night                          │
    │       └── Dark-Adapted                            │
    │                                                   │
    ├── v0.20.4b: Tier 2 Abilities ────────────────────┤
    │       Dependencies: v0.20.4a                      │
    │       ├── Umbral Strike                           │
    │       ├── Shadow Clone                            │
    │       └── Void Touched                            │
    │                                                   │
    └── v0.20.4c: Tier 3 & Capstone ───────────────────┘
            Dependencies: v0.20.4a, v0.20.4b
            ├── Merge with Darkness
            ├── Shadow Snare
            └── Eclipse
```

---

## Shadow Essence Resource

### Resource Specification

```csharp
/// <summary>
/// Special resource for Myrk-gengr specialization.
/// Shadow Essence is drawn from darkness and powers shadow abilities.
/// </summary>
public sealed record ShadowEssenceResource
{
    /// <summary>Current Shadow Essence points (0-50).</summary>
    public int CurrentEssence { get; private set; }

    /// <summary>Maximum Shadow Essence (default 50).</summary>
    public int MaxEssence { get; init; } = 50;

    /// <summary>When essence was last generated.</summary>
    public DateTime? LastGeneratedAt { get; private set; }

    /// <summary>
    /// Spends the specified amount of Shadow Essence.
    /// </summary>
    /// <returns>True if essence was available and spent.</returns>
    public bool Spend(int amount)
    {
        if (amount <= 0 || CurrentEssence < amount)
            return false;

        CurrentEssence -= amount;
        return true;
    }

    /// <summary>
    /// Generates the specified amount of Shadow Essence.
    /// </summary>
    public void Generate(int amount)
    {
        CurrentEssence = Math.Min(CurrentEssence + amount, MaxEssence);
        LastGeneratedAt = DateTime.UtcNow;
    }

    /// <summary>
    /// Generates Shadow Essence based on current light level.
    /// More essence generated in darker conditions.
    /// </summary>
    public void GenerateFromDarkness(LightLevelType lightLevel)
    {
        var amount = lightLevel switch
        {
            LightLevelType.Darkness => 5,
            LightLevelType.DimLight => 2,
            LightLevelType.NormalLight => 0,
            LightLevelType.BrightLight => 0,
            LightLevelType.MagicalLight => 0,
            _ => 0
        };

        if (amount > 0)
            Generate(amount);
    }

    /// <summary>
    /// Checks if the given light level qualifies as darkness for abilities.
    /// </summary>
    public bool IsInDarkness(LightLevelType lightLevel)
    {
        return lightLevel == LightLevelType.Darkness ||
               lightLevel == LightLevelType.DimLight;
    }
}
```

### Resource Generation & Consumption

| Action | Effect |
|--------|--------|
| Start turn in Darkness | Generate 5 Shadow Essence |
| Start turn in Dim Light | Generate 2 Shadow Essence |
| Dark-Adapted passive (Darkness) | Generate 2 Shadow Essence/turn |
| Shadow Step arrival in Darkness | Generate 5 Shadow Essence |
| Eclipse active | Generate 10 Shadow Essence/turn |
| Rest (short) | Generate 10 Shadow Essence |
| Rest (long) | Restore all Shadow Essence to 50 |
| Shadow Step (Tier 1) | Spend 10 Shadow Essence |
| Cloak of Night (Tier 1) | Spend 5 Shadow Essence/turn |
| Umbral Strike (Tier 2) | Spend 15 Shadow Essence |
| Shadow Clone (Tier 2) | Spend 20 Shadow Essence |
| Merge with Darkness (Tier 3) | Spend 25 Shadow Essence |
| Shadow Snare (Tier 3) | Spend 20 Shadow Essence |
| Eclipse (Capstone) | Spend 40 Shadow Essence |

---

## Corruption Integration

### Heretical Path Mechanics

As the first Heretical specialization, Myrk-gengr establishes Corruption patterns:

```csharp
/// <summary>
/// Service for handling Myrk-gengr Corruption risks.
/// </summary>
public interface IShadowCorruptionService
{
    /// <summary>
    /// Evaluates Corruption risk for a shadow ability.
    /// </summary>
    CorruptionRiskResult EvaluateRisk(
        MyrkgengrAbilityId ability,
        LightLevelType lightLevel,
        bool targetIsCoherent = false);

    /// <summary>
    /// Applies Corruption from a shadow ability use.
    /// </summary>
    void ApplyCorruption(Guid characterId, CorruptionRiskResult risk);
}
```

### Corruption Trigger Table

| Ability | Base Risk | Bright Light | Coherent Target | Max Corruption |
|---------|-----------|--------------|-----------------|----------------|
| Shadow Step | 0 | +1 | N/A | 1 |
| Cloak of Night | 0/turn | +1/turn | N/A | 1/turn |
| Umbral Strike | 0 | +1 | +1 | 2 |
| Shadow Clone | 0 | +1 | N/A | 1 |
| Merge with Darkness | 0 | N/A (can't use) | N/A | 1/extension |
| Shadow Snare | 0 | N/A | +1 | 1 |
| Eclipse | +2 | N/A (creates dark) | N/A | 2 |

---

## Ability Type Classification

### Ability Types Used

| Type | Description | Examples in Myrk-gengr |
|------|-------------|------------------------|
| **Active** | Standard ability with AP cost | Shadow Step, Shadow Clone, Merge with Darkness, Shadow Snare |
| **Stance** | Maintained effect with ongoing cost | Cloak of Night |
| **Passive** | Always-on effect | Dark-Adapted, Void Touched |
| **Attack** | Damage-dealing ability | Umbral Strike |
| **Ultimate** | Powerful ability with cooldown | Eclipse |

### Light Level Requirements

| Ability | Darkness | Dim Light | Normal | Bright |
|---------|----------|-----------|--------|--------|
| Shadow Step (destination) | Yes | Yes | No | No |
| Cloak of Night | Full effect | Full effect | Reduced | Penalty + Corruption |
| Dark-Adapted | Bonus gen | No penalty | Normal | Normal |
| Umbral Strike | Required | Required | No | No |
| Shadow Clone | Yes | Yes | Yes + risk | Yes + Corruption |
| Merge with Darkness | Yes | Yes | No | No |
| Shadow Snare | Yes | Yes | Yes | Yes |
| Eclipse | Creates | Creates | Creates | Creates |

---

## Configuration Updates

### specializations.json

```json
{
  "specializations": [
    {
      "specializationId": "Myrkgengr",
      "displayName": "Myrk-gengr",
      "tagline": "One with the Darkness",
      "description": "The Myrk-gengr has touched the void between light and shadow, learning to draw power from the dangerous boundary where reality grows thin. They become more shadow than flesh, slipping between spaces and striking from darkness.",
      "selectionText": "The shadows are not where we hide. They are what we become. Step into the darkness with me.",
      "parentArchetype": "Skirmisher",
      "pathType": "Heretical",
      "corruptionRisk": {
        "brightLightAbility": 1,
        "coherentTarget": 1,
        "capstoneUse": 2,
        "extendedShadowForm": 1
      },
      "specialResource": {
        "resourceId": "shadow-essence",
        "resourceName": "Shadow Essence",
        "description": "Power drawn from darkness. Generated in shadows, spent to fuel shadow abilities.",
        "maxValue": 50,
        "startingValue": 50,
        "generationMethod": "Generate 5 in Darkness, 2 in Dim Light per turn; bonus from specific abilities",
        "consumptionMethod": "Spent by shadow and stealth abilities"
      },
      "unlockCost": 0,
      "abilityTiers": [
        {
          "tier": 1,
          "ppRequirement": 0,
          "abilityCost": 0,
          "abilities": ["shadow-step", "cloak-of-night", "dark-adapted"]
        },
        {
          "tier": 2,
          "ppRequirement": 8,
          "abilityCost": 4,
          "abilities": ["umbral-strike", "shadow-clone", "void-touched"]
        },
        {
          "tier": 3,
          "ppRequirement": 16,
          "abilityCost": 5,
          "abilities": ["merge-with-darkness", "shadow-snare"]
        },
        {
          "tier": "capstone",
          "ppRequirement": 24,
          "abilityCost": 6,
          "abilities": ["eclipse"]
        }
      ]
    }
  ]
}
```

### abilities.json (Myrk-gengr Section)

```json
{
  "abilities": [
    {
      "abilityId": "shadow-step",
      "displayName": "Shadow Step",
      "specializationId": "Myrkgengr",
      "tier": 1,
      "type": "Active",
      "apCost": 2,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 10
      },
      "range": 6,
      "rangeUnit": "Spaces",
      "description": "Instantly teleport to any shadow within 6 spaces. Destination must be in Darkness or Dim Light. Generates 5 Shadow Essence if arriving in Darkness.",
      "requirements": {
        "destinationLightLevel": ["Darkness", "DimLight"],
        "destinationUnoccupied": true
      },
      "effects": [
        {
          "type": "Teleport",
          "range": 6,
          "lineOfSight": false
        },
        {
          "type": "ConditionalEssenceGeneration",
          "condition": "ArrivalInDarkness",
          "amount": 5
        }
      ],
      "corruptionRisk": {
        "trigger": "OriginInBrightLight",
        "amount": 1
      }
    },
    {
      "abilityId": "cloak-of-night",
      "displayName": "Cloak of Night",
      "specializationId": "Myrkgengr",
      "tier": 1,
      "type": "Stance",
      "apCost": 1,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 5,
        "recurring": true,
        "recurringPeriod": "Turn"
      },
      "description": "Enter a stance of shadow concealment. Gain +3 Stealth and move silently in shadows. Costs 5 Shadow Essence per turn to maintain.",
      "effects": [
        {
          "type": "StealthBonus",
          "value": 3,
          "condition": "InDarknessOrDimLight"
        },
        {
          "type": "SilentMovement",
          "condition": "InDarknessOrDimLight"
        },
        {
          "type": "PerceptionPenalty",
          "targets": "Enemies",
          "value": -2
        }
      ],
      "corruptionRisk": {
        "trigger": "MaintainedInBrightLight",
        "amount": 1,
        "recurring": true
      }
    },
    {
      "abilityId": "dark-adapted",
      "displayName": "Dark-Adapted",
      "specializationId": "Myrkgengr",
      "tier": 1,
      "type": "Passive",
      "description": "Your eyes have adjusted to the darkness. You suffer no penalties in dim light and passively generate 2 Shadow Essence per turn when in Darkness.",
      "effects": [
        {
          "type": "RemoveLightPenalty",
          "lightLevel": "DimLight"
        },
        {
          "type": "PassiveEssenceGeneration",
          "condition": "InDarkness",
          "amount": 2,
          "period": "Turn"
        }
      ]
    },
    {
      "abilityId": "umbral-strike",
      "displayName": "Umbral Strike",
      "specializationId": "Myrkgengr",
      "tier": 2,
      "type": "Attack",
      "apCost": 3,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 15
      },
      "description": "Strike from the shadows with devastating force. Deals weapon damage +2d6 shadow damage. Must be in Darkness or Dim Light. On critical hit, +1d6 additional shadow damage.",
      "requirements": {
        "casterLightLevel": ["Darkness", "DimLight"]
      },
      "effects": [
        {
          "type": "WeaponAttack"
        },
        {
          "type": "BonusDamage",
          "dice": "2d6",
          "damageType": "Shadow"
        },
        {
          "type": "CriticalBonusDamage",
          "dice": "1d6",
          "damageType": "Shadow"
        },
        {
          "type": "ConsumeCloneForAdvantage"
        }
      ],
      "corruptionRisk": {
        "trigger": "TargetIsCoherent",
        "amount": 1
      }
    },
    {
      "abilityId": "shadow-clone",
      "displayName": "Shadow Clone",
      "specializationId": "Myrkgengr",
      "tier": 2,
      "type": "Active",
      "apCost": 2,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 20
      },
      "range": 3,
      "rangeUnit": "Spaces",
      "duration": 1,
      "durationUnit": "Minutes",
      "description": "Create an illusory shadow duplicate within 3 spaces. Clone has 1 HP and cannot attack. Enemies must succeed DC 14 Perception to identify as illusion. Maximum 2 clones active.",
      "effects": [
        {
          "type": "CreateClone",
          "hp": 1,
          "movement": 4,
          "detectionDc": 14,
          "maxActive": 2
        }
      ],
      "corruptionRisk": {
        "trigger": "CreatedInBrightLight",
        "amount": 1
      }
    },
    {
      "abilityId": "void-touched",
      "displayName": "Void Touched",
      "specializationId": "Myrkgengr",
      "tier": 2,
      "type": "Passive",
      "description": "Your connection to the void grants resistance to Aetheric damage. Take half damage from Aetheric sources and gain advantage on saves against Aetheric effects.",
      "effects": [
        {
          "type": "DamageResistance",
          "damageType": "Aetheric",
          "multiplier": 0.5
        },
        {
          "type": "SaveAdvantage",
          "saveType": "Aetheric"
        },
        {
          "type": "AttackPenalty",
          "source": "Aetheric",
          "value": -2
        }
      ]
    },
    {
      "abilityId": "merge-with-darkness",
      "displayName": "Merge with Darkness",
      "specializationId": "Myrkgengr",
      "tier": 3,
      "type": "Active",
      "apCost": 3,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 25
      },
      "duration": 1,
      "durationUnit": "Turns",
      "description": "Become an incorporeal shadow for 1 turn. Physical attacks cannot target you, and you can move through solid objects. Cannot attack while incorporeal. Vulnerable to magical light (2d6 damage).",
      "requirements": {
        "casterLightLevel": ["Darkness", "DimLight"]
      },
      "effects": [
        {
          "type": "GrantIncorporeal",
          "duration": 1
        },
        {
          "type": "PhysicalImmunity"
        },
        {
          "type": "Phasing",
          "canPassSolid": true
        },
        {
          "type": "Vulnerability",
          "damageType": "MagicalLight",
          "dice": "2d6"
        }
      ],
      "extension": {
        "cost": 25,
        "corruptionPerExtension": 1
      }
    },
    {
      "abilityId": "shadow-snare",
      "displayName": "Shadow Snare",
      "specializationId": "Myrkgengr",
      "tier": 3,
      "type": "Active",
      "apCost": 2,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 20
      },
      "range": 6,
      "rangeUnit": "Spaces",
      "duration": 2,
      "durationUnit": "Turns",
      "description": "Animate the target's shadow to grasp and root them. Target is Rooted for 2 turns (DC 14 save at end of each turn to escape). Fails if target has no shadow.",
      "requirements": {
        "targetHasShadow": true
      },
      "effects": [
        {
          "type": "ApplyCondition",
          "condition": "Rooted",
          "duration": 2,
          "saveDc": 14,
          "saveFrequency": "EndOfTurn"
        }
      ],
      "corruptionRisk": {
        "trigger": "TargetIsCoherent",
        "amount": 1
      }
    },
    {
      "abilityId": "eclipse",
      "displayName": "Eclipse",
      "specializationId": "Myrkgengr",
      "tier": "capstone",
      "type": "Ultimate",
      "apCost": 5,
      "resourceCost": {
        "resourceId": "shadow-essence",
        "amount": 40
      },
      "range": 8,
      "rangeType": "Radius",
      "duration": 3,
      "durationUnit": "Turns",
      "cooldown": "Combat",
      "description": "Call forth absolute darkness in an 8-space radius. All light is extinguished (magical lights save DC 16). You gain 50% concealment and can see normally within the zone. Regenerate 10 Shadow Essence per turn. Always triggers +2 Corruption.",
      "effects": [
        {
          "type": "CreateDarknessZone",
          "radius": 8,
          "duration": 3
        },
        {
          "type": "ExtinguishLights",
          "magicalSaveDc": 16
        },
        {
          "type": "GrantConcealment",
          "missChance": 50,
          "targetsSelf": true
        },
        {
          "type": "GrantVision",
          "condition": "WithinZone",
          "targetsSelf": true
        },
        {
          "type": "EssenceRegeneration",
          "amount": 10,
          "period": "Turn"
        }
      ],
      "corruptionRisk": {
        "trigger": "Always",
        "amount": 2
      }
    }
  ]
}
```

---

## Estimated Effort Summary

| Phase | New Files | Modified Files | Est. Tests | Complexity |
|-------|-----------|----------------|------------|------------|
| v0.20.4a | ~8 | ~4 | ~10 | High |
| v0.20.4b | ~4 | ~2 | ~8 | Medium |
| v0.20.4c | ~4 | ~2 | ~7 | High |
| **Total** | **~16** | **~8** | **~25** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Corruption integration complexity | High | Medium | Follow v0.18.x patterns, thorough testing |
| Light level tracking performance | Medium | Medium | Cache light levels, update on change |
| Teleportation exploit potential | High | Low | Strict destination validation |
| Eclipse zone management | Medium | Medium | Clear zone boundaries, tick system |
| Shadow Clone AI behavior | Medium | Low | Simple behavior patterns, no complex AI |
| Incorporeal state edge cases | High | Medium | Clear restrictions, forced ejection |

---

## Design Decisions (Confirmed)

### Shadow Essence

| Decision | Value | Notes |
|----------|-------|-------|
| **Max Essence** | 50 | Higher pool for combat mobility |
| **Generation Method** | Darkness + actions | Encourages fighting in shadows |
| **Darkness Generation** | 5/turn | Primary resource income |
| **Dim Light Generation** | 2/turn | Reduced but functional |

### Corruption Balance

| Decision | Value | Notes |
|----------|-------|-------|
| **Bright Light Penalty** | +1 per use | Discourages fighting in light |
| **Coherent Target Penalty** | +1 per attack | Moral dimension to combat |
| **Capstone Penalty** | +2 always | Power has consequences |
| **Extension Penalty** | +1 per extension | Risk/reward for duration |

### Ability Balance

| Decision | Value | Notes |
|----------|-------|-------|
| **Shadow Step Range** | 6 spaces | Good mobility, not unlimited |
| **Umbral Strike Damage** | +2d6 | Significant but requires positioning |
| **Clone Detection DC** | 14 | Moderate challenge |
| **Eclipse Radius** | 8 spaces | Large but manageable |
| **Concealment Chance** | 50% | Powerful but not invincible |

---

## Unit Test Specifications

### v0.20.4a Tests (~10 tests)

#### ShadowEssenceResourceTests.cs

```csharp
[TestFixture]
public class ShadowEssenceResourceTests
{
    [Test]
    public void Create_InitializesWithMaxEssence();

    [Test]
    public void Spend_SufficientEssence_ReturnsTrue();

    [Test]
    public void Spend_InsufficientEssence_ReturnsFalse();

    [Test]
    public void GenerateFromDarkness_InDarkness_GeneratesFive();

    [Test]
    public void GenerateFromDarkness_InDimLight_GeneratesTwo();

    [Test]
    public void GenerateFromDarkness_InBrightLight_GeneratesZero();
}
```

#### MyrkgengrAbilityServiceTests.cs

```csharp
[TestFixture]
public class MyrkgengrAbilityServiceTests
{
    [Test]
    public void ShadowStep_ValidShadowDestination_Teleports();

    [Test]
    public void ShadowStep_BrightLightDestination_Fails();

    [Test]
    public void ShadowStep_InBrightLight_TriggersCorruption();

    [Test]
    public void CloakOfNight_GrantsStealthBonus();
}
```

### v0.20.4b Tests (~8 tests)

#### Tier2AbilityTests.cs

```csharp
[TestFixture]
public class Tier2AbilityTests
{
    [Test]
    public void UmbralStrike_FromShadow_DealsExtraDamage();

    [Test]
    public void UmbralStrike_NotInShadow_Fails();

    [Test]
    public void ShadowClone_CreatesWithCorrectStats();

    [Test]
    public void ShadowClone_MaxTwoActive();

    [Test]
    public void ShadowClone_DetectionDcIsFourteen();

    [Test]
    public void VoidTouched_GrantsAethericResistance();

    [Test]
    public void VoidTouched_HalvesAethericDamage();

    [Test]
    public void Tier2_LockedUntil8PPInvested();
}
```

### v0.20.4c Tests (~7 tests)

#### Tier3AndCapstoneTests.cs

```csharp
[TestFixture]
public class Tier3AndCapstoneTests
{
    [Test]
    public void MergeWithDarkness_GrantsIncorporeal();

    [Test]
    public void MergeWithDarkness_AllowsWallPhasing();

    [Test]
    public void ShadowSnare_RootsTargetForTwoTurns();

    [Test]
    public void ShadowSnare_FailsOnShadowlessTarget();

    [Test]
    public void Eclipse_ExtinguishesAllLight();

    [Test]
    public void Eclipse_GrantsFiftyPercentConcealment();

    [Test]
    public void Eclipse_AlwaysTriggersTwoCorruption();
}
```

---

## Integration Points

### With v0.20.3 Systems

| System | Integration Point |
|--------|-------------------|
| Specialization ability patterns | Follows established structure |
| Special resource patterns | ShadowEssence follows LoreInsight pattern |

### With Core Systems

| System | Integration Point |
|--------|-------------------|
| Corruption System (v0.18.x) | First Heretical specialization integration |
| Lighting System | Light level detection and effects |
| Combat System | Shadow damage, concealment |
| Stealth System | Cloak of Night integration |
| Movement System | Shadow Step teleportation, phasing |

### Provides to Future Versions

| Provides | Consumer |
|----------|----------|
| Heretical Corruption patterns | v0.20.5 Berserkr, v0.20.8 Seiðkona |
| Shadow damage type | Future shadow abilities |
| Incorporeal state mechanics | Other transformation abilities |
| Light-dependent abilities | Future light/dark systems |
| Clone entity pattern | Other summoning abilities |

---

## Deliverable Checklist

### Domain Layer

- [ ] `ShadowEssenceResource` value object
- [ ] `ShadowPosition` value object
- [ ] `LightLevel` value object
- [ ] `CorruptionRiskResult` value object
- [ ] `ShadowClone` value object
- [ ] `UmbralStrikeResult` value object
- [ ] `IncorporealState` value object
- [ ] `ShadowSnareEffect` value object
- [ ] `EclipseZone` value object
- [ ] `MyrkgengrAbilityId` enum
- [ ] `LightLevelType` enum
- [ ] `ShadowAbilityType` enum
- [ ] `CloneBehavior` enum
- [ ] `IncorporealRestriction` enum

### Application Layer

- [ ] `ShadowEssenceService` implementation
- [ ] `MyrkgengrAbilityService` implementation
- [ ] `ShadowCorruptionService` implementation
- [ ] Shadow Step ability handler
- [ ] Cloak of Night stance handler
- [ ] Dark-Adapted passive integration
- [ ] Umbral Strike ability handler
- [ ] Shadow Clone ability handler
- [ ] Void Touched passive integration
- [ ] Merge with Darkness ability handler
- [ ] Shadow Snare ability handler
- [ ] Eclipse ability handler

### Infrastructure Layer

- [ ] `specializations.json` Myrk-gengr entry
- [ ] `abilities.json` Myrk-gengr abilities (9 total)

### Tests

- [ ] ShadowEssenceResourceTests.cs (~6 tests)
- [ ] MyrkgengrAbilityServiceTests.cs (~4 tests)
- [ ] Tier2AbilityTests.cs (~8 tests)
- [ ] Tier3AndCapstoneTests.cs (~7 tests)

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown with stakeholders
2. **v0.20.4a Design Spec** - Create detailed design specification for Tier 1
3. **Implement v0.20.4a** - Build Shadow Essence, Corruption integration, and Tier 1 abilities
4. **v0.20.4b Design Spec** - Create detailed design specification for Tier 2
5. **Implement v0.20.4b** - Build Tier 2 abilities
6. **v0.20.4c Design Spec** - Create detailed design specification for Tier 3 & Capstone
7. **Implement v0.20.4c** - Build Tier 3 abilities and Eclipse
8. **Proceed to v0.20.5** - Berserkr specialization (second Heretical path)

---

*This scope breakdown provides a structured approach to implementing the Myrk-gengr specialization — the first Heretical path in v0.20.x. As the inaugural Corruption-risk specialization, Myrk-gengr establishes patterns that will be reused for Berserkr (v0.20.5) and Seiðkona (v0.20.8). Each sub-phase builds on the previous, allowing for incremental development and testing of the shadow-assassin archetype.*
