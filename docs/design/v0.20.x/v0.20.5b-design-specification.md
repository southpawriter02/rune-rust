# v0.20.5b Design Specification: Tier 2 Abilities

**Version:** 0.20.5b
**Phase Name:** Tier 2 Abilities
**Parent Version:** v0.20.5 (Berserkr Specialization)
**Prerequisites:** v0.20.5a Complete (Framework & Tier 1)
**Estimated Tests:** ~8 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Overview](#3-architecture-overview)
4. [RecklessAssaultState Value Object](#4-recklessassaultstate-value-object)
5. [UnstoppableEffect Value Object](#5-unstoppableeffect-value-object)
6. [IntimidationEffect Value Object](#6-intimidationeffect-value-object)
7. [MovementPenaltyType Enum](#7-movementpenaltytype-enum)
8. [SaveResistance Mechanics](#8-saveresistance-mechanics)
9. [Tier 2 Ability Specifications](#9-tier-2-ability-specifications)
10. [Combat Integration Points](#10-combat-integration-points)
11. [Stance System Implementation](#11-stance-system-implementation)
12. [Fear Effect & Immunity Mechanics](#12-fear-effect--immunity-mechanics)
13. [Data Model Changes](#13-data-model-changes)
14. [Configuration Updates](#14-configuration-updates)
15. [Corruption Risk Evaluation](#15-corruption-risk-evaluation)
16. [Combat Flow Examples](#16-combat-flow-examples)
17. [Logging Specifications](#17-logging-specifications)
18. [Unit Testing Requirements](#18-unit-testing-requirements)
19. [Acceptance Criteria](#19-acceptance-criteria)
20. [Integration with v0.20.5a](#20-integration-with-v020-5a)

---

## 1. Executive Summary

### 1.1 Purpose

This specification details the three Tier 2 abilities for the Berserkr specialization, expanding combat options beyond Tier 1. These abilities require 8 Personality Points invested in the Berserkr tree and cost 4 PP each to unlock:

- **Reckless Assault**: Offensive stance granting +4 Attack at cost of -2 Defense
- **Unstoppable**: Active ability that ignores all movement penalties for 2 turns
- **Intimidating Presence**: Fear-based crowd control affecting all enemies in range

These abilities introduce intermediate-level mechanics including stance systems, movement utilities, and save-based effects, while maintaining the Heretical Corruption risk at high Rage levels.

### 1.2 Key Deliverables

| Category | Count | Items |
|----------|-------|-------|
| **Domain Value Objects** | 3 | RecklessAssaultState, UnstoppableEffect, IntimidationEffect |
| **Domain Enums** | 1 | MovementPenaltyType |
| **Application Services** | 1 | Tier2AbilityService (or extend BerserkrAbilityService) |
| **Ability Implementations** | 3 | Reckless Assault, Unstoppable, Intimidating Presence |
| **Upgrade Validation** | 2 | Tier 2 unlock (8 PP), individual ability costs (4 PP each) |
| **Corruption Integration** | 2 | High Rage checks, Coherent target detection |
| **Tests** | ~8 | Unit tests across all mechanics |

### 1.3 Architectural Significance

This version introduces:

- **Stance System**: Persistent character state that modifies attack and defense
- **Duration-Based Effects**: Time-limited buffs/debuffs that tick down
- **Save DC Scaling**: Abilities whose difficulty increases with Rage
- **Crowd Control Integration**: Fear-based effects with immunity tracking
- **Per-Turn Corruption**: Abilities that generate Corruption on sustained use

---

## 2. Feature Overview

```
v0.20.5b Tier 2 Abilities
├── RecklessAssaultState (Value Object)
│   ├── Active: bool
│   ├── AttackBonus: int (4 + Rage/20)
│   ├── DefensePenalty: int (-2)
│   ├── TurnsActive: int
│   ├── CorruptionAccrued: int
│   └── Methods: Tick(), End(), IsActive()
├── UnstoppableEffect (Value Object)
│   ├── Active: bool
│   ├── TurnsRemaining: int (2)
│   ├── MovementPenaltiesIgnored: List<MovementPenaltyType>
│   └── Methods: Tick(), IsActive()
├── IntimidationEffect (Value Object)
│   ├── CasterId: Guid
│   ├── TargetId: Guid
│   ├── SaveDc: int (12 + Rage/20)
│   ├── SaveResult: int?
│   ├── DidSave: bool
│   ├── TurnsRemaining: int (3)
│   ├── AttackPenalty: int (-2)
│   └── Methods: ApplySaveResult(), Tick()
├── MovementPenaltyType (Enum)
│   ├── DifficultTerrain
│   ├── Slow
│   ├── Root
│   ├── Water
│   ├── Entangle
│   └── ForcedMovement
├── Tier 2 Abilities
│   ├── Reckless Assault (Stance)
│   │   ├── 1 AP to enter
│   │   ├── +4 Attack, -2 Defense
│   │   ├── Scales with Rage (+1 per 20)
│   │   ├── +1 Corruption/turn at 80+ Rage
│   │   └── Requires 8 PP in tree, 4 PP per ability
│   ├── Unstoppable (Active)
│   │   ├── 1 AP, 15 Rage cost
│   │   ├── Lasts 2 turns
│   │   ├── Ignores movement penalties
│   │   ├── Advantage on forced movement saves
│   │   ├── +1 Corruption at 80+ Rage
│   │   └── Requires 8 PP in tree, 4 PP per ability
│   └── Intimidating Presence (Active)
│       ├── 2 AP, 10 Rage cost
│       ├── 4 space radius
│       ├── Force Will save (DC 12 + Rage/20)
│       ├── On fail: -2 Attack for 3 turns
│       ├── On success: Immunity for 24 hours
│       ├── +1 Corruption if target Coherent
│       └── Requires 8 PP in tree, 4 PP per ability
└── Integration
    ├── Tier unlock validation (8 PP)
    ├── Corruption checks (high Rage, Coherent targets)
    └── Effect tracking & cleanup
```

---

## 3. Architecture Overview

### 3.1 Layered Integration

```
┌────────────────────────────────────────────────────────┐
│        v0.20.5b Tier 2 Ability Integration              │
├────────────────────────────────────────────────────────┤
│  Presentation Layer                                    │
│  > ability reckless-assault               (toggle)     │
│  > ability unstoppable                    (active)     │
│  > ability intimidating-presence <target> (save-based) │
└────────────────────┬─────────────────────────────────────┘
                     │
┌────────────────────▼─────────────────────────────────────┐
│  Application Layer                                       │
│  ┌──────────────────────────┐ ┌─────────────────────┐   │
│  │ Tier2AbilityService      │ │ StanceService       │   │
│  │                          │ │                     │   │
│  │ - ExecuteReckless()      │ │ - IsInStance()      │   │
│  │ - ExecuteUnstoppable()   │ │ - GetBonuses()      │   │
│  │ - ExecuteIntimidating()  │ │ - EndStance()       │   │
│  └──────┬───────────────────┘ └──────┬──────────────┘   │
│         │                            │                   │
│         └───────────┬────────────────┘                   │
│                     │                                    │
│         Uses IRageService (v0.20.5a)                    │
│         Uses IBerserkrCorruptionService                 │
│         Uses ICombatService for save mechanics          │
└─────────────────────┬────────────────────────────────────┘
                      │
┌─────────────────────▼────────────────────────────────────┐
│  Domain Layer                                            │
│  ┌────────────────┐ ┌──────────────┐ ┌──────────────┐   │
│  │ RecklessAssault│ │Unstoppable   │ │Intimidation  │   │
│  │ State          │ │Effect        │ │Effect        │   │
│  └────────────────┘ └──────────────┘ └──────────────┘   │
│                                                          │
│  ┌────────────────┐                                      │
│  │Movement        │                                      │
│  │Penalty Type    │                                      │
│  └────────────────┘                                      │
└────────────────────────────────────────────────────────────┘

Character state modifications:
├─ RecklessAssault: Modifies attack/defense for duration
├─ Unstoppable: Adds immunity list to character
└─ Intimidating Presence: Applies save-based effect to targets
```

### 3.2 Tier 2 Ability Service Flow

```
ExecuteRecklessAssault(characterId)
├─ Check: Tier 2 unlocked? (8 PP)
├─ Check: AP available? (1 AP)
├─ Check: Already in stance?
│  ├─ If yes: Exit stance (free action)
│  └─ If no: Enter stance
├─ Create RecklessAssaultState
├─ Apply bonuses to character
├─ Track state until end of combat
└─ Check Corruption: Per turn at 80+ Rage

ExecuteUnstoppable(characterId)
├─ Check: Tier 2 unlocked? (8 PP)
├─ Check: AP available? (1 AP)
├─ Check: Rage available? (15)
├─ Spend 15 Rage
├─ Create UnstoppableEffect (2 turns)
├─ Add immunity list to character
├─ Check Corruption: If at 80+ Rage → +1
└─ Effect ends automatically after 2 turns

ExecuteIntimidatingPresence(characterId, targetArea)
├─ Check: Tier 2 unlocked? (8 PP)
├─ Check: AP available? (2 AP)
├─ Check: Rage available? (10)
├─ Spend 10 Rage
├─ For each enemy in range:
│  ├─ Create IntimidationEffect
│  ├─ Calculate Save DC (12 + Rage/20)
│  ├─ Force Will save
│  ├─ On fail: Apply -2 Attack penalty (3 turns)
│  ├─ On success: Grant 24h immunity
│  └─ Check Corruption: If target Coherent → +1
└─ Apply effects to all affected enemies
```

---

## 4. RecklessAssaultState Value Object

### 4.1 Definition

```csharp
/// <summary>
/// Represents the Reckless Assault stance state for a Berserkr character.
/// </summary>
public sealed record RecklessAssaultState
{
    /// <summary>
    /// Unique identifier for this state instance.
    /// </summary>
    public Guid StateId { get; init; } = Guid.NewGuid();

    /// <summary>
    /// Character who has entered the stance.
    /// </summary>
    public Guid CharacterId { get; init; }

    /// <summary>
    /// DateTime when stance was activated.
    /// </summary>
    public DateTime StartedAt { get; init; }

    /// <summary>
    /// Current number of turns the stance has been active.
    /// </summary>
    public int TurnsActive { get; private set; }

    /// <summary>
    /// Base attack bonus from stance (+4).
    /// </summary>
    public int BaseAttackBonus => 4;

    /// <summary>
    /// Defense penalty from stance (-2).
    /// </summary>
    public int DefensePenalty => -2;

    /// <summary>
    /// Cumulative Corruption gained while in this stance.
    /// </summary>
    public int CorruptionAccrued { get; private set; }

    /// <summary>
    /// Gets the total attack bonus including Rage scaling.
    /// </summary>
    /// <param name="currentRage">Current Rage value.</param>
    /// <returns>Total attack bonus (4 + 1 per 20 Rage).</returns>
    public int GetCurrentAttackBonus(int currentRage)
    {
        int rageBonus = currentRage / 20; // 1 per 20 Rage
        return BaseAttackBonus + rageBonus;
    }

    /// <summary>
    /// Checks if stance would generate Corruption at current Rage.
    /// </summary>
    /// <param name="currentRage">Current Rage value.</param>
    /// <returns>True if Rage >= 80 (Enraged).</returns>
    public bool GeneratesCorruptionThisTurn(int currentRage) => currentRage >= 80;

    /// <summary>
    /// Marks one turn has passed while in stance.
    /// </summary>
    /// <param name="corruptionGenerated">Corruption generated this turn (if any).</param>
    public void Tick(int corruptionGenerated = 0)
    {
        TurnsActive++;
        CorruptionAccrued += corruptionGenerated;
    }

    /// <summary>
    /// Ends the stance early.
    /// </summary>
    public void End()
    {
        // No special logic needed; state is simply discarded
    }

    /// <summary>
    /// Checks if stance is currently active.
    /// </summary>
    public bool IsActive() => true; // Always true while held

    /// <summary>
    /// Gets description of the stance and its effects.
    /// </summary>
    public string GetDescription(int currentRage)
    {
        var attackBonus = GetCurrentAttackBonus(currentRage);
        var corruptionRisk = GeneratesCorruptionThisTurn(currentRage) ? " [Corruption Risk]" : "";
        return $"Reckless Assault: +{attackBonus} Attack, -2 Defense{corruptionRisk}";
    }
}
```

---

## 5. UnstoppableEffect Value Object

### 5.1 Definition

```csharp
/// <summary>
/// Represents the Unstoppable active ability effect.
/// Grants immunity to movement penalties for its duration.
/// </summary>
public sealed record UnstoppableEffect
{
    /// <summary>
    /// Unique identifier for this effect.
    /// </summary>
    public Guid EffectId { get; init; } = Guid.NewGuid();

    /// <summary>
    /// Character affected by Unstoppable.
    /// </summary>
    public Guid CharacterId { get; init; }

    /// <summary>
    /// DateTime when effect was applied.
    /// </summary>
    public DateTime StartedAt { get; init; }

    /// <summary>
    /// Turns remaining before effect expires (2).
    /// </summary>
    public int TurnsRemaining { get; private set; } = 2;

    /// <summary>
    /// List of movement penalty types this effect ignores.
    /// </summary>
    public IReadOnlyList<MovementPenaltyType> MovementPenaltiesIgnored { get; init; }
        = new[]
        {
            MovementPenaltyType.DifficultTerrain,
            MovementPenaltyType.Slow,
            MovementPenaltyType.Root,
            MovementPenaltyType.Water,
            MovementPenaltyType.Entangle,
            MovementPenaltyType.ForcedMovement
        };

    /// <summary>
    /// Ticks down the effect duration.
    /// </summary>
    public void Tick()
    {
        TurnsRemaining = Math.Max(0, TurnsRemaining - 1);
    }

    /// <summary>
    /// Checks if effect is still active.
    /// </summary>
    public bool IsActive() => TurnsRemaining > 0;

    /// <summary>
    /// Checks if a specific penalty type is ignored.
    /// </summary>
    public bool IgnoresPenalty(MovementPenaltyType penalty)
        => MovementPenaltiesIgnored.Contains(penalty);

    /// <summary>
    /// Gets description of the effect.
    /// </summary>
    public string GetDescription()
    {
        var penalties = string.Join(", ", MovementPenaltiesIgnored);
        return $"Unstoppable ({TurnsRemaining} turns): Ignores {penalties}";
    }
}
```

---

## 6. IntimidationEffect Value Object

### 6.1 Definition

```csharp
/// <summary>
/// Represents the Intimidating Presence crowd control effect.
/// Tracks save results and penalty application per target.
/// </summary>
public sealed record IntimidationEffect
{
    /// <summary>
    /// Unique identifier for this effect.
    /// </summary>
    public Guid EffectId { get; init; } = Guid.NewGuid();

    /// <summary>
    /// Character who cast Intimidating Presence.
    /// </summary>
    public Guid CasterId { get; init; }

    /// <summary>
    /// Target affected by this fear effect.
    /// </summary>
    public Guid TargetId { get; init; }

    /// <summary>
    /// Name of target for display.
    /// </summary>
    public string TargetName { get; init; }

    /// <summary>
    /// Save DC the target had to beat.
    /// </summary>
    public int SaveDc { get; init; }

    /// <summary>
    /// The save roll result (1-20 + modifiers).
    /// </summary>
    public int? SaveRoll { get; private set; }

    /// <summary>
    /// Whether target successfully saved.
    /// </summary>
    public bool DidSave => SaveRoll.HasValue && SaveRoll.Value >= SaveDc;

    /// <summary>
    /// Turns remaining for penalty (3 if failed, 0 if saved).
    /// </summary>
    public int TurnsRemaining { get; private set; } = 3;

    /// <summary>
    /// Attack penalty if target failed save (-2).
    /// </summary>
    public int AttackPenalty => -2;

    /// <summary>
    /// DateTime when immunity expires (if target saved).
    /// Null if target did not save or immunity not yet applied.
    /// </summary>
    public DateTime? ImmuneUntil { get; private set; }

    /// <summary>
    /// Duration of 24-hour immunity on successful save.
    /// </summary>
    public static readonly TimeSpan ImmunityDuration = TimeSpan.FromHours(24);

    /// <summary>
    /// Records the save result for this target.
    /// </summary>
    /// <param name="saveRoll">The save roll (1-20 + modifiers).</param>
    public void ApplySaveResult(int saveRoll)
    {
        SaveRoll = saveRoll;

        if (DidSave)
        {
            ImmuneUntil = DateTime.UtcNow.Add(ImmunityDuration);
            TurnsRemaining = 0; // Effect ends immediately on successful save
        }
    }

    /// <summary>
    /// Marks one turn has passed.
    /// </summary>
    public void Tick()
    {
        if (TurnsRemaining > 0)
            TurnsRemaining--;
    }

    /// <summary>
    /// Checks if effect is currently active.
    /// </summary>
    public bool IsActive() => !DidSave && TurnsRemaining > 0;

    /// <summary>
    /// Checks if target is immune to this effect.
    /// </summary>
    public bool IsImmune() => ImmuneUntil.HasValue && DateTime.UtcNow < ImmuneUntil;

    /// <summary>
    /// Gets description of the effect result.
    /// </summary>
    public string GetDescription()
    {
        if (!SaveRoll.HasValue)
            return $"{TargetName}: Save pending (DC {SaveDc})";

        if (DidSave)
            return $"{TargetName}: SAVED (immune 24h)";

        return $"{TargetName}: FAILED ({TurnsRemaining} turns remaining, -2 Attack)";
    }
}
```

---

## 7. MovementPenaltyType Enum

### 7.1 Definition

```csharp
/// <summary>
/// Enumeration of movement penalty types that Unstoppable can ignore.
/// </summary>
public enum MovementPenaltyType
{
    /// <summary>Rough terrain, debris, obstacles (half speed or skip).</summary>
    DifficultTerrain = 1,

    /// <summary>Speed reduction effect (e.g., from spell or ability).</summary>
    Slow = 2,

    /// <summary>Unable to move at all (immobilized).</summary>
    Root = 3,

    /// <summary>Wading through water or other fluids.</summary>
    Water = 4,

    /// <summary>Vines, webs, chains (mobility reduced).</summary>
    Entangle = 5,

    /// <summary>Pushed, pulled, or otherwise forcibly moved.</summary>
    ForcedMovement = 6
}
```

---

## 8. Save Resistance Mechanics

### 8.1 Save Calculation for Intimidating Presence

```csharp
public class SaveMechanics
{
    /// <summary>
    /// Calculates the save DC for Intimidating Presence.
    /// Base DC 12, increases by 1 per 20 Rage.
    /// </summary>
    public static int CalculateSaveDc(int currentRage)
    {
        int baseDc = 12;
        int rageBonus = currentRage / 20; // +1 per 20 Rage
        return baseDc + rageBonus;
    }

    /// <summary>
    /// Examples of save DC at different Rage levels:
    /// 0-19 Rage: DC 12
    /// 20-39 Rage: DC 13
    /// 40-59 Rage: DC 14
    /// 60-79 Rage: DC 15
    /// 80-99 Rage: DC 16
    /// 100 Rage: DC 17
    /// </summary>
}

// DC Progression Table
var dcTable = new Dictionary<RageLevel, int>
{
    { RageLevel.Calm, 12 },
    { RageLevel.Irritated, 13 },
    { RageLevel.Angry, 14 },
    { RageLevel.Furious, 15 },
    { RageLevel.Enraged, 16 },
    { RageLevel.Berserk, 17 }
};
```

### 8.2 Save Logic

```csharp
// Target saves against Intimidating Presence
public void ResolveSave(IntimidationEffect effect, Character target)
{
    // Roll Will save (1d20 + Will modifier)
    int saveRoll = DiceRoller.Roll(1, 20) + target.WillModifier;

    effect.ApplySaveResult(saveRoll);

    if (effect.DidSave)
    {
        // Target successfully resisted fear
        // Becomes immune for 24 hours
        logger.LogInformation(
            "{TargetName} saved against Intimidating Presence: {SaveRoll} vs DC {SaveDc}",
            target.Name, saveRoll, effect.SaveDc);
    }
    else
    {
        // Target failed; apply -2 Attack penalty
        logger.LogWarning(
            "{TargetName} failed Intimidating Presence save: {SaveRoll} vs DC {SaveDc}",
            target.Name, saveRoll, effect.SaveDc);
    }
}
```

---

## 9. Tier 2 Ability Specifications

### 9.1 Reckless Assault (Stance)

**Specifications:**

| Property | Value |
|----------|-------|
| **ID** | `reckless-assault` |
| **Type** | Stance |
| **Tier** | 2 |
| **AP Cost** | 1 AP to enter/exit |
| **Rage Cost** | 0 (no cost) |
| **Duration** | Until manually exited or combat ends |
| **PP Requirement** | 8 PP in tree to unlock Tier 2 |
| **PP Cost** | 4 PP to learn ability |
| **Corruption Risk** | +1 per turn at 80+ Rage (recurring) |

**Mechanics:**

- Enter stance as 1 AP action (costs no Rage)
- While active, gain +4 to all attack rolls
- While active, suffer -2 to Defense
- Attack bonus scales: +1 additional per 20 Rage (max +5 at 100 Rage)
- Can exit stance at any time as free action
- Each turn in stance while at 80+ Rage generates +1 Corruption
- Can chain attacks; stance persists across turns
- No cooldown or limit to duration

**Attack Bonus by Rage:**

| Rage Level | Base (+4) | Rage Bonus | Total |
|-----------|-----------|-----------|-------|
| 0-19 | +4 | +0 | +4 |
| 20-39 | +4 | +1 | +5 |
| 40-59 | +4 | +2 | +6 |
| 60-79 | +4 | +3 | +7 |
| 80-99 | +4 | +4 | +8 (+1 Corruption) |
| 100 | +4 | +5 | +9 (+1 Corruption) |

**Usage Example:**

```
> ability reckless-assault

You enter a stance of reckless aggression!
You gain +4 Attack but suffer -2 Defense.
Reckless Assault: Active

> attack Draugr Warrior
Attack Roll: 14 + 4 (stance) = 18 (Hit!)
Damage: 12
Draugr HP: 30 → 18/30

=== Turn End ===
Rage: 65/100 (safe, no Corruption this turn)

=== Enemy Turn ===
Draugr attacks you!
Defense: 10 - 2 (Reckless) = 8
Attack Roll: 16 (Hit!)
You take 8 damage

> ability reckless-assault

You exit the reckless stance.
Stance: Inactive
Defense: 10 (normal)
```

### 9.2 Unstoppable (Active)

**Specifications:**

| Property | Value |
|----------|-------|
| **ID** | `unstoppable` |
| **Type** | Active |
| **Tier** | 2 |
| **AP Cost** | 1 AP |
| **Rage Cost** | 15 |
| **Duration** | 2 turns |
| **PP Requirement** | 8 PP in tree to unlock Tier 2 |
| **PP Cost** | 4 PP to learn ability |
| **Corruption Risk** | +1 if activated at 80+ Rage |

**Mechanics:**

- Costs 1 AP and 15 Rage to activate
- Lasts for 2 turns from activation
- For duration, ignore all movement penalties:
  - Difficult terrain (move at full speed)
  - Slow effects (ignore speed reduction)
  - Root attempts (can resist/break)
  - Water/fluid terrain
  - Entanglement (vines, webs, etc.)
  - Forced movement (push/pull) – gain advantage on save
- Activation at 80+ Rage triggers +1 Corruption
- Can charge through any terrain
- Effect ends after 2 turns automatically
- Cannot be used again until effect expires

**Movement Penalties Ignored:**

| Penalty | Effect | Behavior |
|---------|--------|----------|
| Difficult Terrain | Rough ground | Move at full speed |
| Slow | Speed reduction | Ignore reduction |
| Root | Cannot move | Can still move freely |
| Water | Wading terrain | Move at normal pace |
| Entangle | Vines/webs | Can move through |
| Forced Movement | Push/pull | Advantage on save to resist |

**Usage Example:**

```
> ability unstoppable

You become unstoppable, charging through any obstacle!
Effect: Ignore movement penalties for 2 turns
Rage: 50 → 35/100 (-15)

> move through muddy terrain

Normally you'd be slowed, but...
Unstoppable active: Moving at full speed!
Distance moved: 4 spaces (normal speed)

=== Turn 1 Complete ===
Unstoppable: 1 turn remaining

=== Enemy Turn ===
Draugr casts Root on you!
You gain advantage on save to resist.
Save Roll: 15 + 2 (bonus) = 17 vs DC 14
Saved! You remain free to move.

=== Turn 2 Complete ===
Unstoppable: 0 turns remaining (expires)

=== Turn 3 ===
Draugr casts Root on you again!
Normal save: 12 + 2 = 14 vs DC 14 (Just makes it!)
```

### 9.3 Intimidating Presence (Active)

**Specifications:**

| Property | Value |
|----------|-------|
| **ID** | `intimidating-presence` |
| **Type** | Active |
| **Tier** | 2 |
| **AP Cost** | 2 AP |
| **Rage Cost** | 10 |
| **Range** | 4 spaces (all enemies) |
| **Duration** | 3 turns (on failed save) |
| **PP Requirement** | 8 PP in tree to unlock Tier 2 |
| **PP Cost** | 4 PP to learn ability |
| **Corruption Risk** | +1 if target is Coherent-aligned |
| **Save Type** | Will (Fear-based) |

**Mechanics:**

- Costs 2 AP and 10 Rage to activate
- All enemies within 4 spaces must make Will save
- Save DC = 12 + (Rage / 20)
  - 0-19 Rage: DC 12
  - 20-39 Rage: DC 13
  - 40-59 Rage: DC 14
  - 60-79 Rage: DC 15
  - 80-99 Rage: DC 16
  - 100 Rage: DC 17
- On failed save: -2 to Attack rolls for 3 turns
- On successful save: Immunity to this ability for 24 hours
- Mindless creatures are immune (no Will)
- Fear immunity negates effect
- Using against Coherent-aligned target triggers +1 Corruption

**Save DC by Rage:**

| Rage Level | Base | Rage Bonus | Total | Corruption Risk |
|-----------|------|-----------|-------|-----------------|
| 0-19 | 12 | +0 | 12 | No |
| 20-39 | 12 | +1 | 13 | No |
| 40-59 | 12 | +2 | 14 | No |
| 60-79 | 12 | +3 | 15 | No |
| 80-99 | 12 | +4 | 16 | Yes (if Coherent) |
| 100 | 12 | +5 | 17 | Yes (if Coherent) |

**Usage Example:**

```
> ability intimidating-presence

Your fury terrifies your enemies! All enemies within 4 spaces must save!
Rage: 45 → 35/100 (-10)
Save DC: 12 + (45/20) = 12 + 2 = 14

=== Enemy Saves ===

Draugr Warrior 1:
Will Save: 10 + 2 = 12 vs DC 14 (FAILED)
Effect: -2 Attack for 3 turns

Draugr Warrior 2:
Will Save: 18 + 1 = 19 vs DC 14 (SAVED!)
Immune to Intimidating Presence for 24 hours

Skeleton Archer (mindless):
No Will save possible (immune)

=== Results ===
[Intimidating Presence] 1 enemy affected, 1 saved, 1 immune
Affected enemies: -2 Attack penalty (3 turns)
```

---

## 10. Combat Integration Points

### 10.1 Attack Resolution

```csharp
// When calculating attack bonus
public int CalculateAttackRoll(Character attacker, Character target)
{
    int baseRoll = Roll1d20();
    int modifier = attacker.StrengthModifier; // or DEX

    // Check for Reckless Assault
    if (attacker.IsInRecklessAssault)
    {
        var bonus = attacker.BerserkrState.RecklessAssault
            .GetCurrentAttackBonus(attacker.Rage.CurrentRage);
        modifier += bonus;
    }

    // Check if target affected by Intimidating Presence
    if (target.HasIntimidationPenalty)
    {
        modifier -= 2; // -2 Attack
    }

    return baseRoll + modifier;
}
```

### 10.2 Defense Calculation

```csharp
// When calculating target's defense
public int CalculateDefense(Character target)
{
    int baseDefense = target.BaseDefense;

    // Check for Reckless Assault (attacker's perspective already handled)
    // This affects the DEFENDER's defense
    if (target.IsInRecklessAssault)
    {
        baseDefense -= 2; // Penalty to defense
    }

    return baseDefense;
}
```

### 10.3 Movement Resolution

```csharp
// When character attempts to move
public bool CanMove(Character character, MovementPenaltyType terrain)
{
    // Check for Unstoppable effect
    if (character.HasUnstoppableActive)
    {
        var effect = character.UnstoppableEffect;
        if (effect.IgnoresPenalty(terrain))
        {
            return true; // Can move through any obstacle
        }
    }

    // Normal movement restriction
    return terrain != MovementPenaltyType.Root;
}
```

---

## 11. Stance System Implementation

### 11.1 Stance Service Interface

```csharp
/// <summary>
/// Service for managing stance abilities.
/// </summary>
public interface IStanceService
{
    /// <summary>
    /// Gets the current stance for a character.
    /// </summary>
    RecklessAssaultState? GetActiveStance(Guid characterId);

    /// <summary>
    /// Enters a stance.
    /// </summary>
    void EnterStance(Guid characterId, RecklessAssaultState stance);

    /// <summary>
    /// Exits the current stance.
    /// </summary>
    void ExitStance(Guid characterId);

    /// <summary>
    /// Checks if character is in a specific stance.
    /// </summary>
    bool IsInStance(Guid characterId, string stanceId);

    /// <summary>
    /// Gets stance bonuses to apply to character.
    /// </summary>
    StanceBonus? GetStanceBonus(Guid characterId, int currentRage);

    /// <summary>
    /// Ticks all active stances (end of turn).
    /// </summary>
    void TickActiveStances();
}
```

### 11.2 Stance Bonus Application

```csharp
public sealed record StanceBonus
{
    public int AttackBonus { get; init; }
    public int DefenseBonus { get; init; }
    public int? CorruptionThisTurn { get; init; }
}

// Usage
var bonus = stanceService.GetStanceBonus(characterId, rageValue);
if (bonus != null)
{
    attackRoll += bonus.AttackBonus;
    defense += bonus.DefenseBonus;

    if (bonus.CorruptionThisTurn.HasValue)
    {
        corruptionService.AddCorruption(characterId, bonus.CorruptionThisTurn.Value);
    }
}
```

---

## 12. Fear Effect & Immunity Mechanics

### 12.1 Fear Effect Application

```csharp
/// <summary>
/// Applies Intimidating Presence fear effect to a target.
/// </summary>
public void ApplyFearEffect(Character target, IntimidationEffect effect)
{
    // Check immunity conditions
    if (target.IsMindless)
        return; // Mindless creatures immune

    if (target.HasFearImmunity)
        return; // Immunity to fear

    if (effect.IsImmune())
        return; // 24-hour immunity from previous save

    // Add effect to target's active effects
    target.ActiveEffects.Add(effect);

    logger.LogWarning(
        "Intimidating Presence applied to {TargetName}: -2 Attack for {Turns} turns",
        target.Name, effect.TurnsRemaining);
}
```

### 12.2 Fear Immunity Tracking

```csharp
public sealed record FearImmunityTracker
{
    public Dictionary<Guid, DateTime> ImmuneTargets { get; init; }
        = new Dictionary<Guid, DateTime>();

    /// <summary>
    /// Checks if target is currently immune to fear.
    /// </summary>
    public bool IsImmune(Guid targetId)
    {
        if (!ImmuneTargets.TryGetValue(targetId, out var immuneUntil))
            return false;

        if (DateTime.UtcNow >= immuneUntil)
        {
            ImmuneTargets.Remove(targetId);
            return false;
        }

        return true;
    }

    /// <summary>
    /// Grants immunity for 24 hours.
    /// </summary>
    public void GrantImmunity(Guid targetId)
    {
        ImmuneTargets[targetId] = DateTime.UtcNow.AddHours(24);
    }
}
```

---

## 13. Data Model Changes

### 13.1 Character Entity Modifications

```csharp
MODIFY: Character (Entity)
├── ADD: RecklessAssaultState? (current stance)
├── ADD: UnstoppableEffect? (current effect)
├── ADD: IntimidationEffects: List<IntimidationEffect> (multiple targets)
├── ADD: IsInRecklessAssault: bool (computed)
├── ADD: HasUnstoppableActive: bool (computed)
├── ADD: CanIgnoreMovementPenalty(penalty) → bool
├── ADD: GetIntimidationPenalty() → int (-2 if affected)
└── ADD: TickEffects() → void
```

### 13.2 BerserkrState Extension

```csharp
public class BerserkrState
{
    public Guid CharacterId { get; init; }

    // v0.20.5a
    public RageResource Rage { get; private set; }

    // v0.20.5b
    public RecklessAssaultState? RecklessAssault { get; set; }
    public UnstoppableEffect? Unstoppable { get; set; }
    public List<IntimidationEffect> IntimidationEffects { get; } = new();

    // Methods
    public void TickEffects()
    {
        RecklessAssault?.Tick();
        Unstoppable?.Tick();

        foreach (var effect in IntimidationEffects.ToList())
        {
            effect.Tick();
            if (!effect.IsActive())
                IntimidationEffects.Remove(effect);
        }
    }
}
```

---

## 14. Configuration Updates

### 14.1 abilities.json (Tier 2 Abilities)

```json
{
  "abilities": [
    {
      "abilityId": "reckless-assault",
      "displayName": "Reckless Assault",
      "specializationId": "Berserkr",
      "tier": 2,
      "type": "Stance",
      "apCost": 1,
      "resourceCost": null,
      "description": "Enter a stance of reckless aggression. Gain +4 Attack but suffer -2 Defense. Attack bonus increases by +1 per 20 Rage (maximum +9 at 100 Rage). Maintain this stance as long as desired, but using abilities while at 80+ Rage risks +1 Corruption per turn.",
      "shortDescription": "Stance: +4 Attack, -2 Defense, scales with Rage",
      "requirements": {
        "ppInTree": 8,
        "ppCost": 4
      },
      "effects": [
        {
          "type": "StanceAttackBonus",
          "baseBonus": 4,
          "scaling": {
            "per": 20,
            "resource": "rage",
            "bonus": 1,
            "max": 5
          }
        },
        {
          "type": "StanceDefensePenalty",
          "value": -2
        }
      ],
      "corruptionRisk": {
        "trigger": "MaintainedWhileEnraged",
        "minimumRage": 80,
        "corruptionAmount": 1,
        "recurring": true,
        "description": "Maintaining Reckless Assault while at 80+ Rage risks +1 Corruption per turn"
      }
    },
    {
      "abilityId": "unstoppable",
      "displayName": "Unstoppable",
      "specializationId": "Berserkr",
      "tier": 2,
      "type": "Active",
      "apCost": 1,
      "resourceCost": {
        "resourceId": "rage",
        "amount": 15
      },
      "duration": 2,
      "durationUnit": "Turns",
      "description": "Nothing can slow your advance. For 2 turns, ignore all movement penalties including difficult terrain, slow effects, and root attempts. You gain advantage on saves to resist forced movement.",
      "shortDescription": "Active: Ignore movement penalties for 2 turns",
      "requirements": {
        "ppInTree": 8,
        "ppCost": 4
      },
      "effects": [
        {
          "type": "IgnoreMovementPenalties",
          "penalties": [
            "DifficultTerrain",
            "Slow",
            "Root",
            "Water",
            "Entangle",
            "ForcedMovement"
          ]
        },
        {
          "type": "SaveAdvantage",
          "saveType": "ForcedMovement"
        }
      ],
      "corruptionRisk": {
        "trigger": "ActivatedWhileEnraged",
        "minimumRage": 80,
        "corruptionAmount": 1,
        "description": "Activating Unstoppable while at 80+ Rage risks +1 Corruption"
      }
    },
    {
      "abilityId": "intimidating-presence",
      "displayName": "Intimidating Presence",
      "specializationId": "Berserkr",
      "tier": 2,
      "type": "Active",
      "apCost": 2,
      "resourceCost": {
        "resourceId": "rage",
        "amount": 10
      },
      "range": 4,
      "rangeUnit": "Spaces",
      "areaType": "Radius",
      "duration": 3,
      "durationUnit": "Turns",
      "description": "Your fury terrifies your enemies. All enemies within 4 spaces must save (DC 12 + Rage/20) or suffer -2 Attack for 3 turns. Enemies that save are immune for 24 hours.",
      "shortDescription": "Active: Force fear save, -2 Attack if failed",
      "requirements": {
        "ppInTree": 8,
        "ppCost": 4
      },
      "effects": [
        {
          "type": "ForceSave",
          "saveType": "Will",
          "baseDc": 12,
          "dcScaling": {
            "per": 20,
            "resource": "rage",
            "bonus": 1
          }
        },
        {
          "type": "OnFailedSave",
          "effect": "AttackPenalty",
          "value": -2,
          "duration": 3
        },
        {
          "type": "OnSuccessfulSave",
          "effect": "Immunity",
          "duration": "24h"
        }
      ],
      "immunities": ["Mindless", "FearImmune"],
      "corruptionRisk": {
        "trigger": "TargetIsCoherent",
        "corruptionAmount": 1,
        "description": "Using Intimidating Presence against Coherent-aligned target risks +1 Corruption"
      }
    }
  ]
}
```

---

## 15. Corruption Risk Evaluation

### 15.1 Corruption Triggers for Tier 2

```csharp
public CorruptionRiskResult EvaluateTier2Risk(
    BerserkrAbilityId abilityId,
    int currentRage,
    bool targetIsCoherent = false)
{
    return abilityId switch
    {
        BerserkrAbilityId.RecklessAssault =>
            currentRage >= 80
                ? new CorruptionRiskResult
                {
                    CorruptionAmount = 1,
                    Trigger = BerserkrCorruptionTrigger.RecklessAssaultEnraged,
                    Reason = "Maintaining Reckless Assault while Enraged (+1 per turn)"
                }
                : new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Safe" },

        BerserkrAbilityId.Unstoppable =>
            currentRage >= 80
                ? new CorruptionRiskResult
                {
                    CorruptionAmount = 1,
                    Trigger = BerserkrCorruptionTrigger.UnstoppableWhileEnraged,
                    Reason = "Used Unstoppable while Enraged (80+ Rage)"
                }
                : new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Safe" },

        BerserkrAbilityId.IntimidatingPresence =>
            targetIsCoherent
                ? new CorruptionRiskResult
                {
                    CorruptionAmount = 1,
                    Trigger = BerserkrCorruptionTrigger.IntimidatingCoherentTarget,
                    Reason = "Used Intimidating Presence against Coherent target"
                }
                : new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Safe" },

        _ => new CorruptionRiskResult { CorruptionAmount = 0, Reason = "Unknown" }
    };
}
```

---

## 16. Combat Flow Examples

### 16.1 Extended Combat Scenario (Reckless + Intimidation)

```
TURN 1: Berserkr enters combat with 45 Rage

Berserkr's Turn:
├─ Ability: Enter Reckless Assault (1 AP)
├─ Status: +4 Attack, -2 Defense
├─ Rage: 45/100 (safe, no Corruption)
└─ Attack: 14 + 4 (stance) = 18 (Hit!), 10 damage

Enemy Turn:
├─ Draugr attacks Berserkr
├─ Defense: 10 - 2 (Reckless) = 8
└─ Attack: 15 (Hit!), 7 damage

TURN 2: Berserkr gains Rage from damage

[Pain is Fuel] +5 Rage
Rage: 45 → 50/100

Berserkr's Turn:
├─ Ability: Intimidating Presence (2 AP, 10 Rage)
│  ├─ All enemies in 4 spaces must save
│  ├─ Save DC: 12 + (50/20) = 12 + 2 = 14
│  └─ Rage: 50 → 40/100
├─ Draugr Warrior 1: Save 12 vs 14 (FAILED) → -2 Attack
├─ Draugr Warrior 2: Save 16 vs 14 (SAVED) → 24h immunity
└─ Status: Still in Reckless Assault (+4 Attack, -2 Defense)

Enemy Turn:
├─ Draugr Warrior 1: -2 Attack penalty active
├─ Attacks Berserkr: 14 - 2 + 1 = 13 (Miss!)
└─ Draugr Warrior 2: Attacks normally

TURN 3: More damage, Rage climbing

[Pain is Fuel] +5 Rage (from hits)
Rage: 40 → 45/100

Berserkr's Turn:
├─ Status: Still in Reckless Assault
├─ Attack Bonus: 4 + (45/20) = 4 + 2 = +6 total
├─ Attack: 12 + 6 = 18 (Hit!), 14 damage
└─ Rage: 45/100 (still safe)

TURN 4: Rage climbs to Enraged

Enemy deals 10 damage
[Pain is Fuel] +5 Rage
Rage: 45 → 50 → 55 → ... → 85/100 (ENRAGED!)

Berserkr's Turn:
├─ Still in Reckless Assault
├─ Check Corruption: 85 Rage >= 80 → +1 Corruption/turn
├─ [HERETICAL] +1 Corruption (maintaining stance while Enraged)
├─ Attack Bonus: 4 + (85/20) = 4 + 4 = +8
└─ Attack: 12 + 8 = 20 (Hit!), 18 damage

Berserkr can now:
├─ Exit stance (free action) to reduce Corruption
├─ Use Unstoppable (15 Rage, 2 turns of movement freedom)
├─ Use Fury Strike (20 Rage, massive damage but +1 Corruption)
└─ Or stay in stance for +1 Corruption/turn risk for +8 Attack
```

### 16.2 Unstoppable Movement Example

```
Terrain: Swamp (difficult terrain)
Normal move: 2 spaces (half speed)
Unstoppable move: 4 spaces (full speed!)

Berserkr's Turn:
├─ Ability: Unstoppable (1 AP, 15 Rage)
├─ Effect: 2 turns of ignoring movement penalties
├─ Rage: 55 → 40/100
└─ Status: Ignore movement penalties

Movement Phase:
├─ Move 4 spaces through swamp
├─ Normal swamp: would be 2 spaces
├─ Unstoppable: "Muddy terrain cannot slow you!"
├─ Reach enemy across swamp, set up next turn attack
└─ Position gained!

Turn 2 of Unstoppable:
├─ Enemy tries to Root you
├─ Normal: Fail save = immobilized
├─ Unstoppable active: Advantage on save
│  ├─ Roll 1: 10 + 2 = 12 (failed)
│  ├─ Roll 2: 14 + 2 = 16 (success!)
│  └─ Break free!
└─ Can still move freely

Turn 3 (Unstoppable expires):
├─ Difficult terrain affects you again
├─ Move only 2 spaces instead of 4
└─ Back to normal movement
```

---

## 17. Logging Specifications

### 17.1 Key Log Events

**Information Level:**
```
[INFO] Character 123e entered Reckless Assault stance
[INFO] Reckless Assault attack bonus: +4 (base) +2 (rage) = +6
[INFO] Character 123e activated Unstoppable for 2 turns
[INFO] Unstoppable: Character 123e ignores movement penalties
[INFO] Character 123e forced Intimidating Presence save on 3 enemies (DC 14)
[INFO] Draugr Warrior 1 failed save: 10 vs DC 14 (-2 Attack penalty)
[INFO] Draugr Warrior 2 successful save: 16 vs DC 14 (24h immunity)
```

**Warning Level:**
```
[WARN] Reckless Assault: +1 Corruption/turn at 85 Rage!
[WARN] Intimidating Presence used against Coherent target: +1 Corruption
[WARN] Character 123e insufficient Rage for Unstoppable (10/15)
```

---

## 18. Unit Testing Requirements

### 18.1 RecklessAssaultTests.cs (~3 tests)

```csharp
[TestFixture]
public class RecklessAssaultTests
{
    [Test]
    public void EnterStance_GrantsAttackBonus()
    {
        var state = new RecklessAssaultState { CharacterId = Guid.NewGuid() };
        var bonus = state.GetCurrentAttackBonus(currentRage: 40);
        Assert.That(bonus, Is.EqualTo(6)); // 4 + 2 (40/20)
    }

    [Test]
    public void ExitStance_RemovesBonuses()
    {
        var state = new RecklessAssaultState { CharacterId = Guid.NewGuid() };
        state.End();
        Assert.That(state.IsActive(), Is.True); // No logic needed
    }

    [Test]
    public void GeneratesCorruption_AtEightyRage()
    {
        var state = new RecklessAssaultState { CharacterId = Guid.NewGuid() };
        var generates = state.GeneratesCorruptionThisTurn(currentRage: 85);
        Assert.That(generates, Is.True);
    }
}
```

### 18.2 UnstoppableTests.cs (~2 tests)

```csharp
[TestFixture]
public class UnstoppableTests
{
    [Test]
    public void IgnoresPenalty_ForKnownTypes()
    {
        var effect = new UnstoppableEffect { CharacterId = Guid.NewGuid() };
        Assert.That(effect.IgnoresPenalty(MovementPenaltyType.DifficultTerrain), Is.True);
        Assert.That(effect.IgnoresPenalty(MovementPenaltyType.Root), Is.True);
    }

    [Test]
    public void Tick_ReducesTurnsRemaining()
    {
        var effect = new UnstoppableEffect { CharacterId = Guid.NewGuid(), TurnsRemaining = 2 };
        effect.Tick();
        Assert.That(effect.TurnsRemaining, Is.EqualTo(1));
        effect.Tick();
        Assert.That(effect.TurnsRemaining, Is.EqualTo(0));
        Assert.That(effect.IsActive(), Is.False);
    }
}
```

### 18.3 IntimidatingPresenceTests.cs (~3 tests)

```csharp
[TestFixture]
public class IntimidatingPresenceTests
{
    [Test]
    public void FailedSave_AppliesPenalty()
    {
        var effect = new IntimidationEffect
        {
            CasterId = Guid.NewGuid(),
            TargetId = Guid.NewGuid(),
            TargetName = "Draugr",
            SaveDc = 14
        };

        effect.ApplySaveResult(saveRoll: 12); // Failed
        Assert.That(effect.DidSave, Is.False);
        Assert.That(effect.AttackPenalty, Is.EqualTo(-2));
        Assert.That(effect.TurnsRemaining, Is.EqualTo(3));
    }

    [Test]
    public void SuccessfulSave_GrantsImmunity()
    {
        var effect = new IntimidationEffect
        {
            SaveDc = 14
        };

        effect.ApplySaveResult(saveRoll: 16); // Succeeded
        Assert.That(effect.DidSave, Is.True);
        Assert.That(effect.ImmuneUntil, Is.Not.Null);
    }

    [Test]
    public void SaveDcScalesWithRage()
    {
        var dcTable = new Dictionary<int, int>
        {
            { 0, 12 },
            { 20, 13 },
            { 40, 14 },
            { 60, 15 },
            { 80, 16 },
            { 100, 17 }
        };

        foreach (var kvp in dcTable)
        {
            int dc = 12 + (kvp.Key / 20);
            Assert.That(dc, Is.EqualTo(kvp.Value));
        }
    }
}
```

---

## 19. Acceptance Criteria

- [ ] Tier 2 abilities locked until 8 PP invested in Berserkr tree
- [ ] Each Tier 2 ability costs 4 PP to unlock
- [ ] Reckless Assault grants +4 Attack base bonus
- [ ] Reckless Assault grants -2 Defense penalty
- [ ] Reckless Assault attack bonus scales (+1 per 20 Rage, max +5)
- [ ] Reckless Assault generates +1 Corruption per turn at 80+ Rage
- [ ] Unstoppable costs 1 AP and 15 Rage
- [ ] Unstoppable lasts 2 turns
- [ ] Unstoppable ignores all movement penalties
- [ ] Unstoppable grants advantage on forced movement saves
- [ ] Unstoppable triggers +1 Corruption if used at 80+ Rage
- [ ] Intimidating Presence costs 2 AP and 10 Rage
- [ ] Intimidating Presence affects all enemies within 4 spaces
- [ ] Intimidating Presence save DC scales with Rage (12 + Rage/20)
- [ ] Intimidating Presence -2 Attack penalty lasts 3 turns
- [ ] Intimidating Presence grants 24h immunity on successful save
- [ ] Intimidating Presence triggers +1 Corruption against Coherent targets
- [ ] All ~8 unit tests pass
- [ ] Configuration files updated and valid

---

## 20. Integration with v0.20.5a

### 20.1 Service Dependencies

| Service | Purpose | v0.20.5a |
|---------|---------|----------|
| `IRageService` | Spending/checking Rage | Required ✓ |
| `IBerserkrCorruptionService` | Corruption risk checks | Required ✓ |
| `ICombatService` | Attack/save resolution | Required (external) |
| `IStanceService` | Stance management | New in v0.20.5b |

### 20.2 Resource Consumption

| Resource | Tier 1 | Tier 2 | Total |
|----------|--------|--------|-------|
| Rage (per ability) | 20, 0, 0 | 15, 0, 10 | Variable |
| Corruption Risk | Low | Medium | Escalating |
| PP Cost | 0 | 12 (4 each) | 12 |

### 20.3 Character State Tracking

```
Character (v0.20.5a base)
├── Rage: RageResource
├── Specialization: Berserkr
└── [New in v0.20.5b]
    ├── RecklessAssaultState?
    ├── UnstoppableEffect?
    └── IntimidationEffects: List<>
```

---

_This specification provides comprehensive detail for v0.20.5b: Tier 2 Abilities. It introduces intermediate combat mechanics including stances, movement utilities, and save-based crowd control while maintaining Heretical Corruption risk integration._
