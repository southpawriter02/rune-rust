# v0.15.2c Design Specification: Fall Damage System

**Version:** 0.15.2c
**Theme:** Fall Damage System
**Author:** Claude
**Created:** 2026-01-17
**Status:** Draft
**Prerequisites:** v0.15.2a Complete (Climbing System with FallResult, FallSource), v0.15.2b Complete (Leaping System)

---

## Table of Contents

1. [Overview](#1-overview)
2. [Dependencies](#2-dependencies)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [FallDamage Value Object](#4-falldamage-value-object)
5. [CrashLandingResult Value Object](#5-crashlandingresult-value-object)
6. [IFallDamageService Interface](#6-ifalldamageservice-interface)
7. [FallDamageService Implementation](#7-falldamageservice-implementation)
8. [Integration with FallResult](#8-integration-with-fallresult)
9. [Configuration](#9-configuration)
10. [Commands](#10-commands)
11. [User-Facing Changes](#11-user-facing-changes)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Future Considerations](#17-future-considerations)
18. [Implementation Notes](#18-implementation-notes)
19. [Document Metadata](#19-document-metadata)

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.2c, the Fall Damage System phase. This part introduces height-based damage calculation and the Crash Landing mechanic that allows skilled characters to reduce fall damage. The key components are:

1. **FallDamage Value Object**: Encapsulates fall damage calculation including height-to-dice conversion, damage type, and Crash Landing eligibility.

2. **CrashLandingResult Value Object**: Captures the result of a Crash Landing attempt, including DC, successes, damage reduction, and final damage.

3. **FallDamageService**: Orchestrates fall damage processing, handling Crash Landing attempts and applying damage to characters.

This infrastructure completes the fall mechanics triggered by climbing fumbles (v0.15.2a) and leaping failures (v0.15.2b), providing a consistent damage calculation system.

### 1.2 Current vs. Target Implementation

| Aspect | Current Implementation | Target Implementation |
|--------|------------------------|----------------------|
| **Fall Damage** | Narrative only | Height-based dice calculation (1d10 per 10ft) |
| **Damage Cap** | N/A | Maximum 10d10 (100+ feet) |
| **Crash Landing** | Not implemented | Skill check to reduce damage dice |
| **Crash DC Scaling** | N/A | DC = 12 + (Height / 10) → DC = 2 + (Height / 10) successes |
| **Damage Reduction** | N/A | Each excess success reduces damage by 1d10 |
| **Integration** | N/A | Consumes `FallResult` from v0.15.2a/b |

### 1.3 Scope

**In Scope:**
- Define `FallDamage` value object for damage calculation
- Define `CrashLandingResult` value object for damage reduction attempts
- Create `IFallDamageService` interface for fall damage operations
- Implement `FallDamageService` with damage and Crash Landing logic
- Integration with `FallResult` from v0.15.2a
- Configuration file `fall-damage.json`
- Unit tests for fall damage mechanics (~4 tests)

**Out of Scope:**
- Stealth movement - v0.15.2d
- Chase sequences - v0.15.2e
- Balance checks - v0.15.2f
- Specialization integration (Gantry-Runner `[Featherfall]`) - v0.15.2g

### 1.4 Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Value Objects | 2 | `FallDamage`, `CrashLandingResult` |
| Interfaces | 1 | `IFallDamageService` |
| Services | 1 | `FallDamageService` |
| Configuration | 1 | `fall-damage.json` |
| Unit Tests | ~4 | Damage dice calculation, cap enforcement, Crash Landing reduction, DC scaling |

---

## 2. Dependencies

### 2.1 Required from v0.15.0 (Dice Pool Refactor)

| Component | Location | Usage in v0.15.2c |
|-----------|----------|-------------------|
| `DiceRollResult` | `Domain/ValueObjects/DiceRollResult.cs` | Provides `NetSuccesses` for Crash Landing checks |
| `DiceConstants` | `Domain/Constants/DiceConstants.cs` | Success threshold (8), botch value (1) |
| `IDiceRollerService` | `Application/Interfaces/IDiceRollerService.cs` | Rolls damage dice and Crash Landing checks |

### 2.2 Required from v0.15.1a (Skill Context & Modifiers)

| Component | Location | Usage in v0.15.2c |
|-----------|----------|-------------------|
| `SkillContext` | `Domain/ValueObjects/SkillContext.cs` | Passed to Crash Landing attempts |
| `SkillContextBuilder` | `Application/Services/SkillContextBuilder.cs` | Builds context for Crash Landing |

### 2.3 Required from v0.15.1b (Outcome Classification)

| Component | Location | Usage in v0.15.2c |
|-----------|----------|-------------------|
| `SkillOutcome` | `Domain/Enums/SkillOutcome.cs` | Crash Landing result classification |

### 2.4 Required from v0.15.2a (Climbing System)

| Component | Location | Usage in v0.15.2c |
|-----------|----------|-------------------|
| `FallResult` | `Domain/ValueObjects/FallResult.cs` | Input for damage calculation |
| `FallSource` | `Domain/Enums/FallSource.cs` | Identifies fall origin for narrative |

### 2.5 Required from v0.15.2b (Leaping System)

| Component | Location | Usage in v0.15.2c |
|-----------|----------|-------------------|
| `LeapResult` | `Domain/ValueObjects/LeapResult.cs` | Contains `FallResult` when leap fails |

### 2.6 Provides to Future Versions

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.2e | Chase Sequences | Fall damage from chase obstacles |
| v0.15.2f | Balance Checks | Fall damage from balance failures |
| v0.15.2g | Gantry-Runner | `[Featherfall]` auto-succeeds Crash Landing DC ≤ 3 |

---

## 3. Architecture Diagrams

### 3.1 Fall Damage Processing Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       FALL DAMAGE PROCESSING FLOW                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  FALL TRIGGERED                                                             │
│  Source: Climbing fumble, Leap failure, Balance failure                     │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    RECEIVE FALL RESULT                              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  FallResult from v0.15.2a/v0.15.2b                                  │    │
│  │  ├── FallHeight: 30ft                                               │    │
│  │  ├── Source: Climbing                                               │    │
│  │  ├── DamageDice: 3 (pre-calculated)                                 │    │
│  │  ├── CrashLandingDc: 15 (legacy, will be converted)                 │    │
│  │  ├── CanAttemptCrashLanding: true                                   │    │
│  │  ├── TriggeredByFumble: true                                        │    │
│  │  └── BonusDamage: 0                                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    CALCULATE FALL DAMAGE                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Height: 30ft                                                       │    │
│  │                                                                      │    │
│  │  Damage Calculation:                                                │    │
│  │  ├── Base Dice = Height / 10 = 3d10                                 │    │
│  │  ├── Maximum = 10d10 (100+ feet)                                    │    │
│  │  └── Damage Type = Bludgeoning                                      │    │
│  │                                                                      │    │
│  │  FallDamage                                                         │    │
│  │  ├── FallHeight: 30ft                                               │    │
│  │  ├── DamageDice: 3                                                  │    │
│  │  ├── DamageType: Bludgeoning                                        │    │
│  │  └── CanCrashLand: true (height >= 10ft)                            │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │               CAN ATTEMPT CRASH LANDING?                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Requirements:                                                      │    │
│  │  ├── Height >= 10ft (yes: 30ft)                                     │    │
│  │  ├── Character is conscious (assumed yes)                           │    │
│  │  └── Not incapacitated (assumed yes)                                │    │
│  │                                                                      │    │
│  │  Result: YES - Crash Landing available                              │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    CRASH LANDING ATTEMPT                            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Crash Landing DC Calculation (Success-Counting):                   │    │
│  │  ├── Base DC = 2 (baseline for any crash landing)                   │    │
│  │  ├── Height Factor = Height / 10 = 3                                │    │
│  │  └── Final DC = 2 + 3 = 5 successes needed                          │    │
│  │                                                                      │    │
│  │  Roll: 5d10 (Acrobatics 3 + Finesse 2)                              │    │
│  │  Result: [9, 8, 10, 4, 6] → 3 successes, 0 botches                  │    │
│  │  Net Successes: 3                                                   │    │
│  │                                                                      │    │
│  │  Margin: 3 - 5 = -2 (failure)                                       │    │
│  │                                                                      │    │
│  │  Damage Reduction: 0 dice (margin < 0)                              │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLY FINAL DAMAGE                               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Original Damage: 3d10                                              │    │
│  │  Crash Landing Reduction: 0d10                                      │    │
│  │  Bonus Damage (fumble): 0d10                                        │    │
│  │  ────────────────────────                                           │    │
│  │  Final Damage: 3d10 Bludgeoning                                     │    │
│  │                                                                      │    │
│  │  Roll Damage: [7, 3, 8] = 18 damage                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│           │                                                                  │
│           ▼                                                                  │
│  OUTPUT: Character takes 18 Bludgeoning damage                              │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Fall Damage Scaling Table

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       FALL DAMAGE SCALING TABLE                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  HEIGHT (ft)    DAMAGE DICE    CRASH LANDING DC    AVG DAMAGE    MAX DMG   │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                              │
│      < 10           0              N/A                 0           0        │
│  ─────────────────────────────────────────────────────────────────────────  │
│       10           1d10            DC 3               5.5         10        │
│       20           2d10            DC 4               11          20        │
│       30           3d10            DC 5               16.5        30        │
│       40           4d10            DC 6               22          40        │
│       50           5d10            DC 7               27.5        50        │
│  ─────────────────────────────────────────────────────────────────────────  │
│       60           6d10            DC 8               33          60        │
│       70           7d10            DC 9               38.5        70        │
│       80           8d10            DC 10              44          80        │
│       90           9d10            DC 11              49.5        90        │
│      100          10d10            DC 12              55         100        │
│  ─────────────────────────────────────────────────────────────────────────  │
│      150          10d10 (cap)      DC 17              55         100        │
│      200          10d10 (cap)      DC 22              55         100        │
│                                                                              │
│  NOTE: Crash Landing DC uses success-counting system:                       │
│        DC = 2 + (Height / 10) successes needed                              │
│        Original formula DC = 12 + (Height / 10) was sum-based              │
│                                                                              │
│  DAMAGE REDUCTION:                                                          │
│  Each success above DC reduces damage by 1d10                               │
│  Minimum damage = 0d10 (if reduction >= original dice)                      │
│                                                                              │
│  EXAMPLE - 50ft fall with Crash Landing:                                    │
│  ├── Base Damage: 5d10                                                      │
│  ├── Crash DC: 7 successes                                                  │
│  ├── Character rolls 9 successes                                            │
│  ├── Margin: 9 - 7 = +2                                                     │
│  ├── Reduction: 2d10                                                        │
│  └── Final Damage: 3d10                                                     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        FALL DAMAGE LAYER ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  ValueObjects/                                                      │    │
│  │  ├── FallResult.cs              ←── FROM v0.15.2a                   │    │
│  │  ├── FallDamage.cs              ←── NEW                             │    │
│  │  └── CrashLandingResult.cs      ←── NEW                             │    │
│  │                                                                      │    │
│  │  Enums/                                                             │    │
│  │  └── FallSource.cs              ←── FROM v0.15.2a                   │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                        │    │
│  │  └── IFallDamageService.cs          ←── NEW                         │    │
│  │                                                                      │    │
│  │  Services/                                                          │    │
│  │  └── FallDamageService.cs           ←── NEW                         │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                  │                                           │
│                                  │ uses                                      │
│                                  ▼                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                  INFRASTRUCTURE LAYER                                │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Configuration/                                                     │    │
│  │  └── fall-damage.json               ←── NEW                         │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. FallDamage Value Object

### 4.1 Class Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/FallDamage.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the calculated damage from a fall.
/// </summary>
/// <remarks>
/// <para>
/// Fall damage is calculated as 1d10 per 10 feet fallen, capped at 10d10 for
/// falls of 100 feet or more. This value object encapsulates the damage
/// calculation and provides Crash Landing eligibility information.
/// </para>
/// <para>
/// Damage Formula:
/// <list type="bullet">
///   <item><description>Damage Dice = Height / 10 (rounded down)</description></item>
///   <item><description>Maximum Damage Dice = 10</description></item>
///   <item><description>Damage Type = Bludgeoning</description></item>
///   <item><description>Crash Landing available if Height >= 10ft</description></item>
/// </list>
/// </para>
/// </remarks>
/// <param name="FallHeight">The height fallen in feet.</param>
/// <param name="DamageDice">The number of d10 damage dice (1 per 10ft, max 10).</param>
/// <param name="DamageType">The damage type (always Bludgeoning for falls).</param>
/// <param name="CanCrashLand">Whether a Crash Landing attempt is possible.</param>
/// <param name="BonusDamageDice">Additional damage dice from fumble effects.</param>
/// <param name="Source">The source of the fall for narrative purposes.</param>
public readonly record struct FallDamage(
    int FallHeight,
    int DamageDice,
    string DamageType,
    bool CanCrashLand,
    int BonusDamageDice = 0,
    FallSource Source = FallSource.Environmental)
{
    /// <summary>
    /// Maximum damage dice from falling (10d10 at 100+ feet).
    /// </summary>
    public const int MaxDamageDice = 10;

    /// <summary>
    /// Minimum height in feet to cause damage.
    /// </summary>
    public const int MinDamageHeight = 10;

    /// <summary>
    /// Height increment for each damage die.
    /// </summary>
    public const int HeightPerDie = 10;

    /// <summary>
    /// Base DC component for Crash Landing (success-counting system).
    /// </summary>
    public const int CrashLandingBaseDc = 2;

    /// <summary>
    /// Gets the total damage dice including any bonus dice.
    /// </summary>
    public int TotalDamageDice => DamageDice + BonusDamageDice;

    /// <summary>
    /// Gets a value indicating whether the fall causes damage.
    /// </summary>
    public bool CausesDamage => TotalDamageDice > 0;

    /// <summary>
    /// Gets the Crash Landing DC for this fall (success-counting system).
    /// </summary>
    /// <remarks>
    /// DC = BaseDC + (Height / 10) = 2 + (Height / 10) successes needed.
    /// </remarks>
    public int CrashLandingDc => CanCrashLand
        ? CrashLandingBaseDc + (FallHeight / HeightPerDie)
        : 0;

    /// <summary>
    /// Gets the average expected damage (5.5 per d10).
    /// </summary>
    public double AverageDamage => TotalDamageDice * 5.5;

    /// <summary>
    /// Gets the maximum possible damage.
    /// </summary>
    public int MaximumDamage => TotalDamageDice * 10;

    /// <summary>
    /// Gets the minimum possible damage (1 per die, or 0 if no damage).
    /// </summary>
    public int MinimumDamage => CausesDamage ? TotalDamageDice : 0;

    /// <summary>
    /// Creates a FallDamage from a height in feet.
    /// </summary>
    /// <param name="heightFeet">The height fallen in feet.</param>
    /// <param name="source">The source of the fall.</param>
    /// <param name="bonusDice">Additional damage dice from fumble effects.</param>
    /// <returns>A new FallDamage with calculated parameters.</returns>
    /// <exception cref="ArgumentOutOfRangeException">
    /// Thrown when heightFeet is negative.
    /// </exception>
    public static FallDamage FromHeight(
        int heightFeet,
        FallSource source = FallSource.Environmental,
        int bonusDice = 0)
    {
        if (heightFeet < 0)
        {
            throw new ArgumentOutOfRangeException(
                nameof(heightFeet),
                "Fall height cannot be negative.");
        }

        var damageDice = Math.Min(MaxDamageDice, heightFeet / HeightPerDie);
        var canCrashLand = heightFeet >= MinDamageHeight;

        return new FallDamage(
            FallHeight: heightFeet,
            DamageDice: damageDice,
            DamageType: "Bludgeoning",
            CanCrashLand: canCrashLand,
            BonusDamageDice: bonusDice,
            Source: source);
    }

    /// <summary>
    /// Creates a FallDamage from an existing FallResult.
    /// </summary>
    /// <param name="fallResult">The fall result from climbing or leaping.</param>
    /// <returns>A new FallDamage with parameters derived from the FallResult.</returns>
    public static FallDamage FromFallResult(FallResult fallResult)
    {
        return new FallDamage(
            FallHeight: fallResult.FallHeight,
            DamageDice: fallResult.DamageDice,
            DamageType: fallResult.DamageType,
            CanCrashLand: fallResult.CanAttemptCrashLanding,
            BonusDamageDice: fallResult.BonusDamage,
            Source: fallResult.Source);
    }

    /// <summary>
    /// Creates a FallDamage with reduced dice after Crash Landing.
    /// </summary>
    /// <param name="diceReduction">Number of dice to reduce.</param>
    /// <returns>A new FallDamage with reduced damage dice (minimum 0).</returns>
    public FallDamage WithDiceReduction(int diceReduction)
    {
        var newDamageDice = Math.Max(0, DamageDice - diceReduction);
        return this with { DamageDice = newDamageDice };
    }

    /// <summary>
    /// Gets a description of the fall damage for display.
    /// </summary>
    /// <returns>A human-readable damage description.</returns>
    public string ToDescription()
    {
        if (!CausesDamage)
        {
            return $"Fell {FallHeight}ft (no damage - below {MinDamageHeight}ft threshold)";
        }

        var diceStr = TotalDamageDice == DamageDice
            ? $"{DamageDice}d10"
            : $"{DamageDice}d10 + {BonusDamageDice}d10 bonus";

        var crashStr = CanCrashLand
            ? $" (Crash Landing DC {CrashLandingDc})"
            : "";

        return $"Fell {FallHeight}ft - {diceStr} {DamageType} damage{crashStr}";
    }

    /// <summary>
    /// Gets a compact summary for log output.
    /// </summary>
    /// <returns>A compact damage summary string.</returns>
    public string ToSummary()
    {
        if (!CausesDamage)
        {
            return $"{FallHeight}ft (safe)";
        }

        return $"{FallHeight}ft → {TotalDamageDice}d10";
    }

    /// <inheritdoc/>
    public override string ToString() => ToDescription();
}
```

### 4.2 Static Factory Extensions

```csharp
// Additional extension methods for FallDamage creation

/// <summary>
/// Creates a FallDamage for [The Long Fall] fumble with bonus damage.
/// </summary>
/// <param name="heightFeet">The height fallen in feet.</param>
/// <returns>A new FallDamage with +1d10 bonus damage.</returns>
public static FallDamage TheLongFall(int heightFeet)
{
    return FromHeight(heightFeet, FallSource.Leaping, bonusDice: 1);
}

/// <summary>
/// Creates a FallDamage for [The Slip] fumble from climbing.
/// </summary>
/// <param name="heightFeet">The height fallen in feet.</param>
/// <returns>A new FallDamage from climbing source.</returns>
public static FallDamage TheSlip(int heightFeet)
{
    return FromHeight(heightFeet, FallSource.Climbing);
}
```

---

## 5. CrashLandingResult Value Object

### 5.1 Class Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/CrashLandingResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the result of a Crash Landing attempt to reduce fall damage.
/// </summary>
/// <remarks>
/// <para>
/// Crash Landing allows a skilled character to reduce fall damage by making
/// an Acrobatics check. Each success above the DC reduces damage by 1d10.
/// </para>
/// <para>
/// Success-Counting DC Formula:
/// <list type="bullet">
///   <item><description>DC = 2 + (Height / 10) successes needed</description></item>
///   <item><description>Each success above DC reduces damage by 1d10</description></item>
///   <item><description>Cannot reduce damage below 0d10</description></item>
/// </list>
/// </para>
/// </remarks>
/// <param name="CrashDc">The DC for the Crash Landing attempt (successes needed).</param>
/// <param name="Successes">The number of successes rolled.</param>
/// <param name="Margin">The margin of success or failure (Successes - DC).</param>
/// <param name="DiceReduced">The number of damage dice reduced (equals margin if positive).</param>
/// <param name="OriginalDamageDice">The original damage dice before reduction.</param>
/// <param name="FinalDamageDice">The final damage dice after reduction.</param>
/// <param name="Outcome">The skill outcome classification.</param>
/// <param name="WasAttempted">Whether a Crash Landing was attempted.</param>
public readonly record struct CrashLandingResult(
    int CrashDc,
    int Successes,
    int Margin,
    int DiceReduced,
    int OriginalDamageDice,
    int FinalDamageDice,
    SkillOutcome Outcome,
    bool WasAttempted = true)
{
    /// <summary>
    /// Gets a value indicating whether the Crash Landing succeeded.
    /// </summary>
    public bool Succeeded => Margin >= 0 && WasAttempted;

    /// <summary>
    /// Gets a value indicating whether any damage was reduced.
    /// </summary>
    public bool ReducedDamage => DiceReduced > 0;

    /// <summary>
    /// Gets a value indicating whether all damage was negated.
    /// </summary>
    public bool NegatedAllDamage => FinalDamageDice <= 0;

    /// <summary>
    /// Gets the percentage of damage reduced.
    /// </summary>
    public double ReductionPercentage => OriginalDamageDice > 0
        ? (double)DiceReduced / OriginalDamageDice * 100
        : 0;

    /// <summary>
    /// Creates a CrashLandingResult for a successful attempt.
    /// </summary>
    /// <param name="crashDc">The DC that was met or exceeded.</param>
    /// <param name="successes">The number of successes rolled.</param>
    /// <param name="originalDamageDice">The original damage dice.</param>
    /// <param name="outcome">The skill outcome classification.</param>
    /// <returns>A new CrashLandingResult with calculated reduction.</returns>
    public static CrashLandingResult FromRoll(
        int crashDc,
        int successes,
        int originalDamageDice,
        SkillOutcome outcome)
    {
        var margin = successes - crashDc;
        var diceReduced = Math.Max(0, margin);
        var finalDice = Math.Max(0, originalDamageDice - diceReduced);

        return new CrashLandingResult(
            CrashDc: crashDc,
            Successes: successes,
            Margin: margin,
            DiceReduced: diceReduced,
            OriginalDamageDice: originalDamageDice,
            FinalDamageDice: finalDice,
            Outcome: outcome,
            WasAttempted: true);
    }

    /// <summary>
    /// Creates a CrashLandingResult when no attempt was made.
    /// </summary>
    /// <param name="originalDamageDice">The original damage dice (unchanged).</param>
    /// <returns>A CrashLandingResult indicating no attempt.</returns>
    public static CrashLandingResult NoAttempt(int originalDamageDice)
    {
        return new CrashLandingResult(
            CrashDc: 0,
            Successes: 0,
            Margin: 0,
            DiceReduced: 0,
            OriginalDamageDice: originalDamageDice,
            FinalDamageDice: originalDamageDice,
            Outcome: SkillOutcome.Failure,
            WasAttempted: false);
    }

    /// <summary>
    /// Creates a CrashLandingResult for [Featherfall] auto-success.
    /// </summary>
    /// <param name="crashDc">The DC that was auto-succeeded.</param>
    /// <param name="originalDamageDice">The original damage dice.</param>
    /// <returns>A CrashLandingResult with maximum possible reduction.</returns>
    /// <remarks>
    /// [Featherfall] from Gantry-Runner specialization auto-succeeds
    /// Crash Landing DCs of 3 or less, treating the roll as exactly meeting DC.
    /// </remarks>
    public static CrashLandingResult Featherfall(int crashDc, int originalDamageDice)
    {
        return new CrashLandingResult(
            CrashDc: crashDc,
            Successes: crashDc, // Exactly meets DC
            Margin: 0,
            DiceReduced: 0, // No reduction, but no damage from meeting DC
            OriginalDamageDice: originalDamageDice,
            FinalDamageDice: originalDamageDice, // Full damage still applies
            Outcome: SkillOutcome.MarginalSuccess,
            WasAttempted: true);
    }

    /// <summary>
    /// Gets a description of the Crash Landing result.
    /// </summary>
    /// <returns>A human-readable result description.</returns>
    public string ToDescription()
    {
        if (!WasAttempted)
        {
            return $"No Crash Landing attempted - {OriginalDamageDice}d10 damage";
        }

        var outcomeStr = Outcome switch
        {
            SkillOutcome.CriticalSuccess => "PERFECT LANDING",
            SkillOutcome.ExceptionalSuccess => "Exceptional Landing",
            SkillOutcome.FullSuccess => "Successful Landing",
            SkillOutcome.MarginalSuccess => "Marginal Landing",
            SkillOutcome.Failure => "Failed Landing",
            SkillOutcome.CriticalFailure => "DISASTROUS LANDING",
            _ => Outcome.ToString()
        };

        if (NegatedAllDamage)
        {
            return $"Crash Landing: {outcomeStr} - All damage negated! " +
                   $"({Successes} successes vs DC {CrashDc})";
        }

        if (ReducedDamage)
        {
            return $"Crash Landing: {outcomeStr} - Reduced {DiceReduced}d10 damage. " +
                   $"({Successes} successes vs DC {CrashDc}, {OriginalDamageDice}d10 → {FinalDamageDice}d10)";
        }

        return $"Crash Landing: {outcomeStr} - No damage reduction. " +
               $"({Successes} successes vs DC {CrashDc}, {FinalDamageDice}d10 damage)";
    }

    /// <summary>
    /// Gets a compact summary for log output.
    /// </summary>
    /// <returns>A compact result summary.</returns>
    public string ToSummary()
    {
        if (!WasAttempted)
        {
            return "No attempt";
        }

        if (NegatedAllDamage)
        {
            return $"Perfect ({Successes} vs DC {CrashDc})";
        }

        if (ReducedDamage)
        {
            return $"Reduced -{DiceReduced}d10 ({Successes} vs DC {CrashDc})";
        }

        return $"Failed ({Successes} vs DC {CrashDc})";
    }

    /// <inheritdoc/>
    public override string ToString() => ToDescription();
}
```

---

## 6. IFallDamageService Interface

### 6.1 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/IFallDamageService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service for processing fall damage and Crash Landing attempts.
/// </summary>
/// <remarks>
/// <para>
/// The fall damage service handles the complete fall damage workflow:
/// <list type="bullet">
///   <item><description>Calculate damage from fall height</description></item>
///   <item><description>Process Crash Landing attempts to reduce damage</description></item>
///   <item><description>Roll final damage dice</description></item>
///   <item><description>Apply damage to character</description></item>
/// </list>
/// </para>
/// </remarks>
public interface IFallDamageService
{
    /// <summary>
    /// Calculates fall damage parameters from a height.
    /// </summary>
    /// <param name="heightFeet">The height fallen in feet.</param>
    /// <param name="source">The source of the fall.</param>
    /// <param name="bonusDice">Additional damage dice from fumble effects.</param>
    /// <returns>A FallDamage with calculated parameters.</returns>
    FallDamage CalculateFallDamage(
        int heightFeet,
        FallSource source = FallSource.Environmental,
        int bonusDice = 0);

    /// <summary>
    /// Calculates fall damage from an existing FallResult.
    /// </summary>
    /// <param name="fallResult">The fall result from climbing or leaping.</param>
    /// <returns>A FallDamage with parameters derived from the FallResult.</returns>
    FallDamage CalculateFallDamage(FallResult fallResult);

    /// <summary>
    /// Attempts a Crash Landing to reduce fall damage.
    /// </summary>
    /// <param name="characterId">The ID of the falling character.</param>
    /// <param name="fallDamage">The fall damage to potentially reduce.</param>
    /// <param name="context">Optional skill context with modifiers.</param>
    /// <returns>A CrashLandingResult with the attempt outcome.</returns>
    CrashLandingResult AttemptCrashLanding(
        string characterId,
        FallDamage fallDamage,
        SkillContext? context = null);

    /// <summary>
    /// Rolls the final damage dice after Crash Landing.
    /// </summary>
    /// <param name="damageDice">The number of d10 to roll.</param>
    /// <returns>The total damage rolled.</returns>
    int RollDamage(int damageDice);

    /// <summary>
    /// Processes a complete fall with optional Crash Landing.
    /// </summary>
    /// <param name="characterId">The ID of the falling character.</param>
    /// <param name="fallResult">The fall result from climbing or leaping.</param>
    /// <param name="attemptCrashLanding">Whether to attempt Crash Landing.</param>
    /// <param name="context">Optional skill context with modifiers.</param>
    /// <returns>A FallDamageResult with complete fall outcome.</returns>
    FallDamageResult ProcessFall(
        string characterId,
        FallResult fallResult,
        bool attemptCrashLanding = true,
        SkillContext? context = null);

    /// <summary>
    /// Gets the Crash Landing DC for a given fall height.
    /// </summary>
    /// <param name="heightFeet">The fall height in feet.</param>
    /// <returns>The DC in successes needed for Crash Landing.</returns>
    int GetCrashLandingDc(int heightFeet);
}
```

### 6.2 FallDamageResult Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/FallDamageResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the complete result of fall damage processing.
/// </summary>
/// <remarks>
/// This aggregates the FallDamage, CrashLandingResult, and final damage
/// into a single result object for the complete fall sequence.
/// </remarks>
/// <param name="FallDamage">The calculated fall damage parameters.</param>
/// <param name="CrashLanding">The Crash Landing attempt result.</param>
/// <param name="FinalDamageDice">The final damage dice after reduction.</param>
/// <param name="DamageRolled">The actual damage rolled.</param>
/// <param name="DamageType">The damage type applied.</param>
/// <param name="CharacterId">The ID of the character who fell.</param>
public readonly record struct FallDamageResult(
    FallDamage FallDamage,
    CrashLandingResult CrashLanding,
    int FinalDamageDice,
    int DamageRolled,
    string DamageType,
    string CharacterId)
{
    /// <summary>
    /// Gets a value indicating whether any damage was taken.
    /// </summary>
    public bool TookDamage => DamageRolled > 0;

    /// <summary>
    /// Gets a value indicating whether Crash Landing helped.
    /// </summary>
    public bool CrashLandingHelped => CrashLanding.ReducedDamage;

    /// <summary>
    /// Gets the amount of damage avoided through Crash Landing.
    /// </summary>
    /// <remarks>
    /// Estimated as 5.5 average per die reduced.
    /// </remarks>
    public double EstimatedDamageAvoided => CrashLanding.DiceReduced * 5.5;

    /// <summary>
    /// Creates a FallDamageResult for a fall that caused no damage.
    /// </summary>
    /// <param name="fallDamage">The fall damage (no damage dice).</param>
    /// <param name="characterId">The character ID.</param>
    /// <returns>A result indicating no damage taken.</returns>
    public static FallDamageResult NoDamage(FallDamage fallDamage, string characterId)
    {
        return new FallDamageResult(
            FallDamage: fallDamage,
            CrashLanding: CrashLandingResult.NoAttempt(0),
            FinalDamageDice: 0,
            DamageRolled: 0,
            DamageType: "Bludgeoning",
            CharacterId: characterId);
    }

    /// <summary>
    /// Gets a description of the complete fall damage result.
    /// </summary>
    /// <returns>A multi-line description of the fall outcome.</returns>
    public string ToDescription()
    {
        var lines = new List<string>
        {
            $"=== FALL DAMAGE RESULT ===",
            $"Character: {CharacterId}",
            FallDamage.ToDescription()
        };

        if (CrashLanding.WasAttempted)
        {
            lines.Add(CrashLanding.ToDescription());
        }

        if (TookDamage)
        {
            lines.Add($"DAMAGE TAKEN: {DamageRolled} {DamageType}");
        }
        else
        {
            lines.Add("NO DAMAGE TAKEN");
        }

        return string.Join(Environment.NewLine, lines);
    }

    /// <inheritdoc/>
    public override string ToString() =>
        $"Fall {FallDamage.FallHeight}ft: {DamageRolled} damage ({CharacterId})";
}
```

---

## 7. FallDamageService Implementation

### 7.1 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/FallDamageService.cs`

```csharp
namespace RuneAndRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Implementation of <see cref="IFallDamageService"/> for processing fall damage.
/// </summary>
/// <remarks>
/// <para>
/// Handles the complete fall damage workflow including:
/// <list type="bullet">
///   <item><description>Damage dice calculation from height</description></item>
///   <item><description>Crash Landing skill checks</description></item>
///   <item><description>Damage dice rolling</description></item>
///   <item><description>Result aggregation</description></item>
/// </list>
/// </para>
/// </remarks>
public sealed class FallDamageService : IFallDamageService
{
    private readonly IDiceRollerService _diceRoller;
    private readonly ISkillCheckService _skillCheck;
    private readonly ILogger<FallDamageService> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="FallDamageService"/> class.
    /// </summary>
    /// <param name="diceRoller">The dice roller service.</param>
    /// <param name="skillCheck">The skill check service.</param>
    /// <param name="logger">The logger instance.</param>
    public FallDamageService(
        IDiceRollerService diceRoller,
        ISkillCheckService skillCheck,
        ILogger<FallDamageService> logger)
    {
        _diceRoller = diceRoller ?? throw new ArgumentNullException(nameof(diceRoller));
        _skillCheck = skillCheck ?? throw new ArgumentNullException(nameof(skillCheck));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc/>
    public FallDamage CalculateFallDamage(
        int heightFeet,
        FallSource source = FallSource.Environmental,
        int bonusDice = 0)
    {
        _logger.LogDebug(
            "Calculating fall damage for {Height}ft fall from {Source}",
            heightFeet, source);

        var fallDamage = FallDamage.FromHeight(heightFeet, source, bonusDice);

        _logger.LogInformation(
            "Fall damage calculated: {Damage}",
            fallDamage.ToSummary());

        return fallDamage;
    }

    /// <inheritdoc/>
    public FallDamage CalculateFallDamage(FallResult fallResult)
    {
        _logger.LogDebug(
            "Calculating fall damage from FallResult: {FallResult}",
            fallResult.ToDescription());

        return FallDamage.FromFallResult(fallResult);
    }

    /// <inheritdoc/>
    public CrashLandingResult AttemptCrashLanding(
        string characterId,
        FallDamage fallDamage,
        SkillContext? context = null)
    {
        if (!fallDamage.CanCrashLand)
        {
            _logger.LogDebug(
                "Crash Landing not available for {Height}ft fall",
                fallDamage.FallHeight);

            return CrashLandingResult.NoAttempt(fallDamage.TotalDamageDice);
        }

        var crashDc = fallDamage.CrashLandingDc;

        _logger.LogInformation(
            "Character {CharacterId} attempting Crash Landing (DC {Dc}) for {Height}ft fall",
            characterId, crashDc, fallDamage.FallHeight);

        // Build context for Acrobatics check if not provided
        var skillContext = context ?? SkillContext.Create(
            skillName: "Acrobatics",
            baseDice: 4, // Default pool, actual would come from character
            dc: crashDc);

        // Perform the skill check
        var checkResult = _skillCheck.PerformCheck(characterId, skillContext);

        var crashResult = CrashLandingResult.FromRoll(
            crashDc: crashDc,
            successes: checkResult.NetSuccesses,
            originalDamageDice: fallDamage.TotalDamageDice,
            outcome: checkResult.Outcome);

        _logger.LogInformation(
            "Crash Landing result: {Result}",
            crashResult.ToSummary());

        return crashResult;
    }

    /// <inheritdoc/>
    public int RollDamage(int damageDice)
    {
        if (damageDice <= 0)
        {
            _logger.LogDebug("No damage dice to roll");
            return 0;
        }

        _logger.LogDebug("Rolling {Dice}d10 damage", damageDice);

        var total = 0;
        for (var i = 0; i < damageDice; i++)
        {
            var roll = _diceRoller.RollD10();
            total += roll;
        }

        _logger.LogInformation(
            "Damage rolled: {Dice}d10 = {Total}",
            damageDice, total);

        return total;
    }

    /// <inheritdoc/>
    public FallDamageResult ProcessFall(
        string characterId,
        FallResult fallResult,
        bool attemptCrashLanding = true,
        SkillContext? context = null)
    {
        _logger.LogInformation(
            "Processing fall for character {CharacterId}: {FallResult}",
            characterId, fallResult.ToDescription());

        // Step 1: Calculate base fall damage
        var fallDamage = CalculateFallDamage(fallResult);

        // Step 2: Check for no-damage fall
        if (!fallDamage.CausesDamage)
        {
            _logger.LogInformation(
                "Fall from {Height}ft causes no damage (below threshold)",
                fallDamage.FallHeight);

            return FallDamageResult.NoDamage(fallDamage, characterId);
        }

        // Step 3: Attempt Crash Landing if requested and available
        CrashLandingResult crashResult;
        int finalDamageDice;

        if (attemptCrashLanding && fallDamage.CanCrashLand)
        {
            crashResult = AttemptCrashLanding(characterId, fallDamage, context);
            finalDamageDice = crashResult.FinalDamageDice;
        }
        else
        {
            crashResult = CrashLandingResult.NoAttempt(fallDamage.TotalDamageDice);
            finalDamageDice = fallDamage.TotalDamageDice;
        }

        // Step 4: Roll final damage
        var damageRolled = RollDamage(finalDamageDice);

        // Step 5: Create result
        var result = new FallDamageResult(
            FallDamage: fallDamage,
            CrashLanding: crashResult,
            FinalDamageDice: finalDamageDice,
            DamageRolled: damageRolled,
            DamageType: fallDamage.DamageType,
            CharacterId: characterId);

        _logger.LogInformation(
            "Fall damage processed: {Character} takes {Damage} damage from {Height}ft fall",
            characterId, damageRolled, fallDamage.FallHeight);

        return result;
    }

    /// <inheritdoc/>
    public int GetCrashLandingDc(int heightFeet)
    {
        if (heightFeet < FallDamage.MinDamageHeight)
        {
            return 0; // No Crash Landing needed for safe falls
        }

        return FallDamage.CrashLandingBaseDc + (heightFeet / FallDamage.HeightPerDie);
    }
}
```

---

## 8. Integration with FallResult

### 8.1 Integration Flow

The Fall Damage System integrates with existing `FallResult` from v0.15.2a:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     FALLRESULT INTEGRATION FLOW                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  CLIMBING FUMBLE (v0.15.2a)                                                 │
│  └── ClimbingService.AttemptStage()                                         │
│      └── Returns ClimbStageResult with FallTriggered = true                 │
│          └── FallResult.FromHeight(currentHeight, FallSource.Climbing)      │
│                                                                              │
│  LEAPING FAILURE (v0.15.2b)                                                 │
│  └── LeapingService.AttemptLeap()                                           │
│      └── Returns LeapResult with FallTriggered = true                       │
│          └── FallResult.FromHeight(gapDepth, FallSource.Leaping)            │
│          └── FallResult.TheLongFall(gapDepth) for fumbles                   │
│                                                                              │
│                          │                                                   │
│                          ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    FALL DAMAGE PROCESSING                           │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  FallDamageService.ProcessFall(characterId, fallResult)             │    │
│  │  │                                                                   │    │
│  │  ├── 1. FallDamage.FromFallResult(fallResult)                       │    │
│  │  │       → Extracts height, dice, source, bonus                     │    │
│  │  │                                                                   │    │
│  │  ├── 2. AttemptCrashLanding() if eligible                           │    │
│  │  │       → Skill check vs DC = 2 + (height/10)                      │    │
│  │  │       → Reduce dice by margin if successful                      │    │
│  │  │                                                                   │    │
│  │  ├── 3. RollDamage(finalDamageDice)                                 │    │
│  │  │       → Roll Nd10 for final damage                               │    │
│  │  │                                                                   │    │
│  │  └── 4. Return FallDamageResult                                     │    │
│  │           → Complete result with all details                        │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                          │                                                   │
│                          ▼                                                   │
│  DAMAGE APPLICATION                                                         │
│  └── Character.TakeDamage(result.DamageRolled, result.DamageType)          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 8.2 Usage Examples

```csharp
// Example 1: Processing a climbing fall
var climbResult = await _climbingService.AttemptStage(climbId);

if (climbResult.FallTriggered)
{
    var fallResult = FallResult.FromHeight(
        climbResult.FallHeight,
        FallSource.Climbing,
        triggeredByFumble: climbResult.Outcome == SkillOutcome.CriticalFailure);

    var damageResult = _fallDamageService.ProcessFall(
        characterId,
        fallResult,
        attemptCrashLanding: true);

    if (damageResult.TookDamage)
    {
        await _characterService.ApplyDamage(
            characterId,
            damageResult.DamageRolled,
            damageResult.DamageType);
    }
}

// Example 2: Processing a leaping fall with The Long Fall
var leapResult = await _leapingService.AttemptLeap(characterId, leapContext);

if (!leapResult.Landed && leapResult.FallTriggered)
{
    var fallResult = leapResult.Outcome == SkillOutcome.CriticalFailure
        ? FallResult.TheLongFall(leapResult.FallDepth)
        : FallResult.FromHeight(leapResult.FallDepth, FallSource.Leaping);

    var damageResult = _fallDamageService.ProcessFall(
        characterId,
        fallResult);

    // The Long Fall also applies +2 Stress and [Disoriented] 2 rounds
    if (leapResult.Outcome == SkillOutcome.CriticalFailure)
    {
        await _stressService.ApplyStress(characterId, 2);
        await _statusEffectService.Apply(characterId, StatusEffect.Disoriented, 2);
    }
}
```

---

## 9. Configuration

### 9.1 fall-damage.json

**File:** `src/Presentation/RuneAndRust.Console/Configuration/fall-damage.json`

```json
{
  "$schema": "./fall-damage.schema.json",
  "version": "0.15.2c",
  "fallDamage": {
    "damagePerTenFeet": 1,
    "damageDieType": "d10",
    "maxDamageDice": 10,
    "minDamageHeight": 10,
    "damageType": "Bludgeoning"
  },
  "crashLanding": {
    "baseDc": 2,
    "dcPerTenFeet": 1,
    "skill": "Acrobatics",
    "attribute": "Finesse",
    "reductionPerSuccess": 1
  },
  "heightTable": [
    {
      "height": 10,
      "damageDice": 1,
      "crashLandingDc": 3,
      "description": "Short fall"
    },
    {
      "height": 20,
      "damageDice": 2,
      "crashLandingDc": 4,
      "description": "Moderate fall"
    },
    {
      "height": 30,
      "damageDice": 3,
      "crashLandingDc": 5,
      "description": "Significant fall"
    },
    {
      "height": 40,
      "damageDice": 4,
      "crashLandingDc": 6,
      "description": "Dangerous fall"
    },
    {
      "height": 50,
      "damageDice": 5,
      "crashLandingDc": 7,
      "description": "Severe fall"
    },
    {
      "height": 60,
      "damageDice": 6,
      "crashLandingDc": 8,
      "description": "Very severe fall"
    },
    {
      "height": 70,
      "damageDice": 7,
      "crashLandingDc": 9,
      "description": "Critical fall"
    },
    {
      "height": 80,
      "damageDice": 8,
      "crashLandingDc": 10,
      "description": "Extreme fall"
    },
    {
      "height": 90,
      "damageDice": 9,
      "crashLandingDc": 11,
      "description": "Near-fatal fall"
    },
    {
      "height": 100,
      "damageDice": 10,
      "crashLandingDc": 12,
      "description": "Maximum fall"
    }
  ],
  "fumbleEffects": {
    "theSlip": {
      "source": "Climbing",
      "bonusDamage": 0,
      "description": "Fall from current height due to climbing fumble"
    },
    "theLongFall": {
      "source": "Leaping",
      "bonusDamage": 1,
      "stressApplied": 2,
      "statusEffect": "Disoriented",
      "statusDuration": 2,
      "description": "Catastrophic leap failure with additional consequences"
    }
  }
}
```

### 9.2 fall-damage.schema.json

**File:** `src/Presentation/RuneAndRust.Console/Configuration/fall-damage.schema.json`

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "fall-damage.schema.json",
  "title": "Fall Damage Configuration",
  "description": "Configuration for fall damage calculation and Crash Landing mechanics",
  "type": "object",
  "required": ["version", "fallDamage", "crashLanding"],
  "properties": {
    "$schema": {
      "type": "string"
    },
    "version": {
      "type": "string",
      "description": "Schema version"
    },
    "fallDamage": {
      "type": "object",
      "required": ["damagePerTenFeet", "damageDieType", "maxDamageDice", "minDamageHeight", "damageType"],
      "properties": {
        "damagePerTenFeet": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of damage dice per 10 feet fallen"
        },
        "damageDieType": {
          "type": "string",
          "pattern": "^d\\d+$",
          "description": "Die type for damage (e.g., d10)"
        },
        "maxDamageDice": {
          "type": "integer",
          "minimum": 1,
          "description": "Maximum number of damage dice"
        },
        "minDamageHeight": {
          "type": "integer",
          "minimum": 1,
          "description": "Minimum height in feet to cause damage"
        },
        "damageType": {
          "type": "string",
          "description": "Type of damage dealt by falls"
        }
      }
    },
    "crashLanding": {
      "type": "object",
      "required": ["baseDc", "dcPerTenFeet", "skill", "reductionPerSuccess"],
      "properties": {
        "baseDc": {
          "type": "integer",
          "minimum": 0,
          "description": "Base DC for Crash Landing attempts"
        },
        "dcPerTenFeet": {
          "type": "integer",
          "minimum": 0,
          "description": "DC increase per 10 feet fallen"
        },
        "skill": {
          "type": "string",
          "description": "Skill used for Crash Landing checks"
        },
        "attribute": {
          "type": "string",
          "description": "Attribute used for Crash Landing checks"
        },
        "reductionPerSuccess": {
          "type": "integer",
          "minimum": 1,
          "description": "Damage dice reduced per success above DC"
        }
      }
    },
    "heightTable": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["height", "damageDice", "crashLandingDc"],
        "properties": {
          "height": {
            "type": "integer",
            "minimum": 0
          },
          "damageDice": {
            "type": "integer",
            "minimum": 0
          },
          "crashLandingDc": {
            "type": "integer",
            "minimum": 0
          },
          "description": {
            "type": "string"
          }
        }
      }
    },
    "fumbleEffects": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "source": {
            "type": "string"
          },
          "bonusDamage": {
            "type": "integer",
            "minimum": 0
          },
          "stressApplied": {
            "type": "integer",
            "minimum": 0
          },
          "statusEffect": {
            "type": "string"
          },
          "statusDuration": {
            "type": "integer",
            "minimum": 0
          },
          "description": {
            "type": "string"
          }
        }
      }
    }
  }
}
```

---

## 10. Commands

### 10.1 Command Changes

No new commands are introduced in v0.15.2c. Fall damage processing is triggered automatically by:

1. **Climbing fumbles** (v0.15.2a) - `climb` command with fumble result
2. **Leaping failures** (v0.15.2b) - `leap` / `jump` command with failure result
3. **Balance failures** (v0.15.2f future) - `balance` command with failure result

### 10.2 Internal Command Flow

```csharp
// The climb/leap commands trigger fall damage processing internally:

// In ClimbCommandHandler:
if (result.FallTriggered)
{
    var fallDamageResult = await _fallDamageService.ProcessFall(
        characterId: command.CharacterId,
        fallResult: FallResult.FromHeight(result.FallHeight, FallSource.Climbing),
        attemptCrashLanding: true);

    await _renderer.RenderFallDamageAsync(fallDamageResult);
}

// In LeapCommandHandler:
if (result.FallTriggered)
{
    var fallDamageResult = await _fallDamageService.ProcessFall(
        characterId: command.CharacterId,
        fallResult: result.FallResult!,
        attemptCrashLanding: true);

    await _renderer.RenderFallDamageAsync(fallDamageResult);
}
```

---

## 11. User-Facing Changes

### 11.1 Fall Damage Display

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        FALL DAMAGE DISPLAY                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Example 1: Successful Crash Landing                                        │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                              │
│  ╔═══════════════════════════════════════════════════════════════════════╗  │
│  ║  FALL!                                                                 ║  │
│  ║  You fall 30 feet from the crumbling ledge!                           ║  │
│  ║                                                                        ║  │
│  ║  Fall Damage: 3d10 Bludgeoning                                        ║  │
│  ║                                                                        ║  │
│  ║  ┌─────────────────────────────────────────────────────────────────┐  ║  │
│  ║  │  CRASH LANDING ATTEMPT                                          │  ║  │
│  ║  │  Acrobatics check vs DC 5                                       │  ║  │
│  ║  │  Roll: [8, 10, 9, 4, 6] = 3 successes                          │  ║  │
│  ║  │  Result: FAILURE (needed 5, got 3)                              │  ║  │
│  ║  │  Damage Reduction: None                                         │  ║  │
│  ║  └─────────────────────────────────────────────────────────────────┘  ║  │
│  ║                                                                        ║  │
│  ║  Final Damage: 3d10 = [7, 3, 8] = 18 Bludgeoning                      ║  │
│  ║                                                                        ║  │
│  ║  Kira takes 18 damage! (HP: 45 → 27)                                  ║  │
│  ╚═══════════════════════════════════════════════════════════════════════╝  │
│                                                                              │
│                                                                              │
│  Example 2: Reduced Damage via Crash Landing                                │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                              │
│  ╔═══════════════════════════════════════════════════════════════════════╗  │
│  ║  FALL!                                                                 ║  │
│  ║  You tumble into the gap below!                                       ║  │
│  ║                                                                        ║  │
│  ║  Fall Damage: 5d10 Bludgeoning (50ft fall)                            ║  │
│  ║                                                                        ║  │
│  ║  ┌─────────────────────────────────────────────────────────────────┐  ║  │
│  ║  │  CRASH LANDING ATTEMPT                                          │  ║  │
│  ║  │  Acrobatics check vs DC 7                                       │  ║  │
│  ║  │  Roll: [9, 8, 10, 8, 9, 10] = 6 successes                      │  ║  │
│  ║  │  Result: FAILURE by 1 (needed 7, got 6)                         │  ║  │
│  ║  │  Damage Reduction: None                                         │  ║  │
│  ║  └─────────────────────────────────────────────────────────────────┘  ║  │
│  ║                                                                        ║  │
│  ║  Final Damage: 5d10 = [4, 7, 9, 2, 8] = 30 Bludgeoning                ║  │
│  ║                                                                        ║  │
│  ║  Theron takes 30 damage! (HP: 52 → 22)                                ║  │
│  ╚═══════════════════════════════════════════════════════════════════════╝  │
│                                                                              │
│                                                                              │
│  Example 3: Perfect Crash Landing                                           │
│  ─────────────────────────────────────────────────────────────────────────  │
│                                                                              │
│  ╔═══════════════════════════════════════════════════════════════════════╗  │
│  ║  FALL!                                                                 ║  │
│  ║  You slip from the ladder and fall!                                   ║  │
│  ║                                                                        ║  │
│  ║  Fall Damage: 2d10 Bludgeoning (20ft fall)                            ║  │
│  ║                                                                        ║  │
│  ║  ┌─────────────────────────────────────────────────────────────────┐  ║  │
│  ║  │  CRASH LANDING ATTEMPT                                          │  ║  │
│  ║  │  Acrobatics check vs DC 4                                       │  ║  │
│  ║  │  Roll: [10, 8, 9, 8, 10] = 5 successes                         │  ║  │
│  ║  │  Result: SUCCESS! (+1 margin)                                   │  ║  │
│  ║  │  Damage Reduction: -1d10                                        │  ║  │
│  ║  └─────────────────────────────────────────────────────────────────┘  ║  │
│  ║                                                                        ║  │
│  ║  Final Damage: 1d10 = [6] = 6 Bludgeoning                             ║  │
│  ║                                                                        ║  │
│  ║  Elara takes 6 damage! (HP: 38 → 32)                                  ║  │
│  ║  "You tuck and roll, absorbing most of the impact!"                   ║  │
│  ╚═══════════════════════════════════════════════════════════════════════╝  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 12. Logging Specifications

### 12.1 Log Levels

| Level | Usage |
|-------|-------|
| `Debug` | Damage calculation steps, DC calculations |
| `Information` | Fall events, Crash Landing attempts, damage applied |
| `Warning` | Near-fatal falls, maximum damage reached |
| `Error` | Invalid fall parameters, calculation errors |

### 12.2 Log Messages

```csharp
// Debug level
_logger.LogDebug(
    "Calculating fall damage for {Height}ft fall from {Source}",
    heightFeet, source);

_logger.LogDebug(
    "Crash Landing DC calculated: {Dc} (base {Base} + {HeightFactor} from height)",
    crashDc, baseDc, heightFactor);

// Information level
_logger.LogInformation(
    "Character {CharacterId} fell {Height}ft from {Source}",
    characterId, height, source);

_logger.LogInformation(
    "Crash Landing: {CharacterId} rolled {Successes} vs DC {Dc} - {Outcome}",
    characterId, successes, dc, outcome);

_logger.LogInformation(
    "Fall damage result: {CharacterId} takes {Damage} {DamageType} damage",
    characterId, damage, damageType);

// Warning level
_logger.LogWarning(
    "Near-fatal fall: {CharacterId} took {Damage} damage from {Height}ft fall",
    characterId, damage, height);

_logger.LogWarning(
    "Maximum fall damage applied: {CharacterId} fell {Height}ft (capped at 10d10)",
    characterId, height);
```

---

## 13. Unit Testing Requirements

### 13.1 Test Specifications (~4 tests)

#### FallDamageTests.cs

```csharp
[TestFixture]
public class FallDamageTests
{
    /// <summary>
    /// Tests that fall height correctly calculates damage dice.
    /// </summary>
    /// <remarks>
    /// Damage = Height / 10 (rounded down).
    /// 30ft = 3d10, 45ft = 4d10, 100ft = 10d10.
    /// </remarks>
    [Test]
    [TestCase(10, 1)]
    [TestCase(20, 2)]
    [TestCase(30, 3)]
    [TestCase(45, 4)]
    [TestCase(50, 5)]
    [TestCase(99, 9)]
    [TestCase(100, 10)]
    public void FromHeight_VariousHeights_CalculatesCorrectDamageDice(
        int height, int expectedDice);

    /// <summary>
    /// Tests that damage dice cap at 10d10 for falls over 100ft.
    /// </summary>
    [Test]
    [TestCase(100, 10)]
    [TestCase(150, 10)]
    [TestCase(200, 10)]
    [TestCase(1000, 10)]
    public void FromHeight_ExtremeHeights_CapsAtMaxDamage(
        int height, int expectedDice);
}
```

#### CrashLandingTests.cs

```csharp
[TestFixture]
public class CrashLandingTests
{
    /// <summary>
    /// Tests that Crash Landing reduces damage when successes exceed DC.
    /// </summary>
    /// <remarks>
    /// If DC = 5 and character rolls 7 successes, margin = +2,
    /// so damage is reduced by 2d10.
    /// </remarks>
    [Test]
    public void AttemptCrashLanding_ExceedsDc_ReducesDamage();

    /// <summary>
    /// Tests that Crash Landing DC scales correctly with height.
    /// </summary>
    /// <remarks>
    /// DC = 2 + (Height / 10):
    /// 10ft = DC 3, 30ft = DC 5, 50ft = DC 7, 100ft = DC 12.
    /// </remarks>
    [Test]
    [TestCase(10, 3)]
    [TestCase(20, 4)]
    [TestCase(30, 5)]
    [TestCase(50, 7)]
    [TestCase(100, 12)]
    public void GetCrashLandingDc_VariousHeights_ReturnsCorrectDc(
        int height, int expectedDc);
}
```

### 13.2 Test Coverage Matrix

| Component | Test Category | Tests |
|-----------|---------------|-------|
| `FallDamage` | Dice Calculation | Height-to-dice conversion |
| `FallDamage` | Cap Enforcement | Maximum 10d10 at 100+ feet |
| `CrashLandingResult` | Damage Reduction | Margin reduces dice |
| `FallDamageService` | DC Scaling | DC increases with height |

---

## 14. Use Cases

### 14.1 Use Case: Climbing Fumble Fall

**Actor:** Character
**Trigger:** Climbing stage attempt results in fumble (0 successes + botch)
**Preconditions:** Character is mid-climb at known height

**Flow:**
1. Climbing service detects fumble, creates `FallResult` with current height
2. Game engine calls `FallDamageService.ProcessFall()`
3. Service calculates `FallDamage` from height
4. If eligible, service attempts `CrashLanding`
5. Service rolls final damage dice
6. Engine applies damage to character

**Postconditions:** Character takes Bludgeoning damage, climb ends

### 14.2 Use Case: Leap Failure with The Long Fall

**Actor:** Character
**Trigger:** Leap attempt results in fumble
**Preconditions:** Character attempting leap over gap with depth

**Flow:**
1. Leaping service detects fumble, creates `FallResult.TheLongFall()`
2. Game engine calls `FallDamageService.ProcessFall()`
3. Service calculates `FallDamage` with +1d10 bonus
4. Service attempts `CrashLanding`
5. Service rolls final damage dice
6. Engine applies damage, +2 Stress, [Disoriented] 2 rounds

**Postconditions:** Character takes bonus damage plus fumble effects

### 14.3 Use Case: Expert Crash Landing

**Actor:** Skilled Acrobat character
**Trigger:** Fall from moderate height (30ft)
**Preconditions:** Character has high Acrobatics skill

**Flow:**
1. Fall triggered from any source
2. `FallDamageService.ProcessFall()` calculates 3d10 damage, DC 5
3. Character rolls 8 successes on Crash Landing
4. Margin = 3, damage reduced by 3d10 → 0d10
5. No damage taken

**Postconditions:** Character lands safely, no damage

### 14.4 Use Case: Maximum Height Fall

**Actor:** Character
**Trigger:** Fall from 150+ feet
**Preconditions:** None

**Flow:**
1. `FallDamageService.CalculateFallDamage(150)` returns 10d10 (capped)
2. Crash Landing DC = 17 (2 + 15)
3. Character unlikely to succeed at DC 17
4. Full 10d10 damage rolled

**Postconditions:** Character takes severe damage (likely fatal for most)

### 14.5 Use Case: Short Safe Fall

**Actor:** Character
**Trigger:** Fall from < 10 feet
**Preconditions:** None

**Flow:**
1. `FallDamageService.CalculateFallDamage(8)` returns 0d10
2. No Crash Landing needed (height < 10ft)
3. `ProcessFall` returns `NoDamage` result

**Postconditions:** Character lands safely, no damage

---

## 15. Deliverable Checklist

### 15.1 Domain Layer

| Item | Status | File |
|------|--------|------|
| `FallDamage` value object | [ ] | `Domain/ValueObjects/FallDamage.cs` |
| `CrashLandingResult` value object | [ ] | `Domain/ValueObjects/CrashLandingResult.cs` |
| `FallDamageResult` value object | [ ] | `Domain/ValueObjects/FallDamageResult.cs` |

### 15.2 Application Layer

| Item | Status | File |
|------|--------|------|
| `IFallDamageService` interface | [ ] | `Application/Interfaces/IFallDamageService.cs` |
| `FallDamageService` implementation | [ ] | `Application/Services/FallDamageService.cs` |

### 15.3 Infrastructure Layer

| Item | Status | File |
|------|--------|------|
| `fall-damage.json` configuration | [ ] | `Configuration/fall-damage.json` |
| `fall-damage.schema.json` schema | [ ] | `Configuration/fall-damage.schema.json` |

### 15.4 Test Layer

| Item | Status | File |
|------|--------|------|
| `FallDamageTests` | [ ] | `Tests/FallDamageTests.cs` |
| `CrashLandingTests` | [ ] | `Tests/CrashLandingTests.cs` |
| `FallDamageServiceTests` | [ ] | `Tests/FallDamageServiceTests.cs` |

---

## 16. Acceptance Criteria

### 16.1 Functional Requirements

- [ ] Fall height correctly calculates damage dice (1d10 per 10ft)
- [ ] Damage caps at 10d10 for 100+ foot falls
- [ ] Falls below 10ft cause no damage
- [ ] Crash Landing is available for falls >= 10ft
- [ ] Crash Landing DC = 2 + (height / 10) successes
- [ ] Each success above DC reduces damage by 1d10
- [ ] Damage cannot be reduced below 0
- [ ] `FallResult` from v0.15.2a/b integrates correctly
- [ ] Bonus damage from fumbles (The Long Fall) is applied
- [ ] Damage type is always Bludgeoning

### 16.2 Quality Requirements

- [ ] ~4 unit tests pass
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] All public methods have XML documentation
- [ ] Logging covers all significant operations

---

## 17. Future Considerations

### 17.1 Deferred to v0.15.2g

- **[Featherfall]** ability: Auto-succeed Crash Landing DC ≤ 3
- Gantry-Runner specialization bonuses to Crash Landing

### 17.2 Potential Enhancements

- Water landing damage reduction
- Soft surface (hay, snow) damage reduction
- Fall damage resistance from armor/abilities
- Momentum transfer on landing (knockdown)

---

## 18. Implementation Notes

### 18.1 Success-Counting DC Conversion

The original scope breakdown specified DCs like "DC 13" for 10ft falls. This has been converted to the success-counting system:

| Original (Sum-Based) | Converted (Success-Counting) |
|---------------------|------------------------------|
| DC 13 (10ft) | DC 3 (2 + 1) |
| DC 14 (20ft) | DC 4 (2 + 2) |
| DC 15 (30ft) | DC 5 (2 + 3) |
| DC 17 (50ft) | DC 7 (2 + 5) |
| DC 22 (100ft) | DC 12 (2 + 10) |

### 18.2 Integration Points

The Fall Damage Service must be registered in the DI container and injected into:
- `ClimbingService` (v0.15.2a)
- `LeapingService` (v0.15.2b)
- `BalanceService` (v0.15.2f, future)
- `ChaseService` (v0.15.2e, future)

### 18.3 Renderer Integration

The game renderer should be updated to display fall damage results. See Section 11 for display format examples.

---

## 19. Document Metadata

| Property | Value |
|----------|-------|
| **Version** | 0.15.2c |
| **Theme** | Fall Damage System |
| **Created** | 2026-01-17 |
| **Author** | Claude |
| **Status** | Draft |
| **Parent** | v0.15.2 (Acrobatics Skill Expansion) |
| **Dependencies** | v0.15.2a (Climbing), v0.15.2b (Leaping) |
| **Provides To** | v0.15.2e (Chase), v0.15.2f (Balance), v0.15.2g (Specialization) |

---

*End of v0.15.2c Design Specification*
