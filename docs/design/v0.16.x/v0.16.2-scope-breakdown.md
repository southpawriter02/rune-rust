## v0.16.2 - Armor Proficiency System

**Focus:** Armor proficiency levels, category definitions, penalty mechanics, and Galdr interference

**Source Specification:** [proficiencies.md](../../aethelgard/design/resources/items/armor/proficiencies.md)

### Overview

This version implements the armor proficiency system that determines how effectively characters can wear different armor types. Wearing armor without proficiency doubles all penalties and blocks special properties. Mystics face special restrictions as medium and heavy armor interfere with Galdr channeling.

---

### Deliverables Summary

| Category | Items | Estimated Tests |
|----------|-------|-----------------|
| Enums | 2 | 3 |
| Value Objects | 4 | 5 |
| Entities | 1 | 3 |
| Services | 2 | 4 |
| **Total** | **9** | **~15** |

---

### v0.16.2a - Armor Proficiency Level Enum

#### ArmorProficiencyLevel Enum
```
ArmorProficiencyLevel
├── NonProficient (0) - Penalties doubled, -2 attack, no special properties
├── Proficient (1) - Normal penalties and function
├── Expert (2) - Penalties reduced by one tier
├── Master (3) - Penalties reduced, +1 Defense, maintenance halved
```

#### ArmorProficiencyEffect Value Object
```
ArmorProficiencyEffect
├── Level: ArmorProficiencyLevel
├── PenaltyMultiplier: float (2.0 for NonProficient, 1.0 for Proficient)
├── AttackPenalty: int (only for NonProficient)
├── DefenseBonus: int (only for Master)
├── TierReduction: int (0, 0, 1, 1 for each level)
├── MaintenanceMultiplier: float (1.0, 1.0, 1.0, 0.5)
├── CanUseSpecialProperties: bool
```

**Proficiency Effects:**
| Level | Penalty Mult | Attack | Defense | Tier Reduction |
|-------|--------------|--------|---------|----------------|
| NonProficient | 2.0x | -2 | 0 | 0 |
| Proficient | 1.0x | 0 | 0 | 0 |
| Expert | 1.0x | 0 | 0 | 1 (Heavy→Medium) |
| Master | 1.0x | 0 | +1 | 1 (Heavy→Medium) |

**Unit Tests (~3):**
- [ ] NonProficient doubles penalties
- [ ] Expert reduces tier by 1
- [ ] Master grants +1 Defense

---

### v0.16.2b - Armor Category System

#### ArmorCategory Enum
```
ArmorCategory
├── LightArmor - Cloth, padded, leather, hide, studded leather
├── MediumArmor - Chain mail, scale mail, ring mail, brigandine, splint
├── HeavyArmor - Half plate, full plate, fortress armor
├── Shields - Bucklers, round shields, kite shields, tower shields
├── Specialized - Servitor shell, symbiotic carapace
```

#### ArmorCategoryDefinition Value Object
```
ArmorCategoryDefinition
├── Category: ArmorCategory
├── DisplayName: string
├── Description: string
├── ExampleArmors: List<string>
├── BasePenalties: ArmorPenalties
├── RequiresSpecialTraining: bool
```

#### ArmorPenalties Value Object
```
ArmorPenalties
├── AgilityDicePenalty: int (dice removed from pool)
├── StaminaCostIncrease: int (extra stamina per action)
├── MovementReduction: int (feet per turn)
├── StealthDisadvantage: bool
├── SwimDisadvantage: bool
```

**Category Penalties:**
| Category | Agility | Stamina | Movement | Stealth | Swim |
|----------|---------|---------|----------|---------|------|
| Light | 0 | 0 | 0 | No | No |
| Medium | -1d10 | +2 | -5 ft | Yes | Yes |
| Heavy | -2d10 | +5 | -10 ft | Yes | Yes |
| Shields | 0 | +1 | 0 | No | No |
| Specialized | Varies | Varies | Varies | Varies | Varies |

**Configuration (`armor-categories.json`):**
```json
{
  "categories": [
    {
      "category": "LightArmor",
      "displayName": "Light Armor",
      "description": "Flexible protection that doesn't impede movement",
      "examples": ["Cloth Armor", "Padded Armor", "Leather Armor", "Hide Armor", "Studded Leather"],
      "basePenalties": {
        "agilityDicePenalty": 0,
        "staminaCostIncrease": 0,
        "movementReduction": 0,
        "stealthDisadvantage": false,
        "swimDisadvantage": false
      },
      "requiresSpecialTraining": false
    },
    {
      "category": "HeavyArmor",
      "displayName": "Heavy Armor",
      "description": "Maximum protection at the cost of mobility",
      "examples": ["Half Plate", "Full Plate", "Fortress Armor"],
      "basePenalties": {
        "agilityDicePenalty": 2,
        "staminaCostIncrease": 5,
        "movementReduction": 10,
        "stealthDisadvantage": true,
        "swimDisadvantage": true
      },
      "requiresSpecialTraining": false
    }
  ]
}
```

**Unit Tests (~2):**
- [ ] Light armor has no penalties
- [ ] Heavy armor has -2d10 Agility, +5 Stamina

---

### v0.16.2c - Archetype Armor Matrix

#### ArchetypeArmorProficiencySet Value Object
```
ArchetypeArmorProficiencySet
├── Archetype: string
├── ProficientCategories: List<ArmorCategory>
├── NonProficientCategories: List<ArmorCategory>
├── SpecialRestrictions: List<ArmorRestriction>
```

#### ArmorRestriction Value Object
```
ArmorRestriction
├── Category: ArmorCategory
├── RestrictionType: ArmorRestrictionType enum
├── Effect: string
├── Severity: int
```

#### ArmorRestrictionType Enum
```
ArmorRestrictionType
├── GaldrInterference - Mystic Galdr penalties
├── WitsImpairment - Adept analysis penalties
├── MovementBlock - Cannot use certain abilities
├── ChannelingBlock - Complete ability lockout
```

**Archetype Matrix:**
| Archetype | Proficient | Non-Proficient | Restrictions |
|-----------|------------|----------------|--------------|
| Warrior | Light, Medium, Heavy, Shields | None | None |
| Skirmisher | Light, Medium | Heavy, Tower Shields | — |
| Mystic | Light only | Medium, Heavy | Galdr interference |
| Adept | Light only | Medium, Heavy | WITS impairment |

**Galdr Channeling Interference (Mystic-specific):**
| Armor | Effect |
|-------|--------|
| Light | No interference |
| Medium | -2 to all Galdr checks |
| Heavy | Cannot cast Galdr abilities |

**Configuration (`archetype-armor-proficiencies.json`):**
```json
{
  "archetypes": [
    {
      "archetype": "Mystic",
      "proficientCategories": ["LightArmor"],
      "nonProficientCategories": ["MediumArmor", "HeavyArmor", "Shields"],
      "specialRestrictions": [
        {
          "category": "MediumArmor",
          "restrictionType": "GaldrInterference",
          "effect": "-2 to all Galdr checks",
          "severity": 2
        },
        {
          "category": "HeavyArmor",
          "restrictionType": "ChannelingBlock",
          "effect": "Cannot cast Galdr abilities",
          "severity": 10
        }
      ]
    }
  ]
}
```

**Unit Tests (~3):**
- [ ] Warrior proficient with all armor
- [ ] Mystic gets -2 Galdr in Medium armor
- [ ] Mystic cannot cast Galdr in Heavy armor

---

### v0.16.2d - Non-Proficiency Penalty Calculation

#### IArmorPenaltyService Interface
```csharp
public interface IArmorPenaltyService
{
    /// <summary>
    /// Calculates effective penalties for character wearing armor.
    /// </summary>
    EffectiveArmorPenalties CalculatePenalties(
        string characterId,
        ArmorDefinition armor);

    /// <summary>
    /// Checks if character can cast Galdr in current armor.
    /// </summary>
    GaldrRestriction CheckGaldrRestriction(
        string characterId,
        ArmorDefinition armor);

    /// <summary>
    /// Gets the penalty tier after proficiency adjustments.
    /// </summary>
    ArmorCategory GetEffectivePenaltyTier(
        string characterId,
        ArmorDefinition armor);
}
```

#### EffectiveArmorPenalties Value Object
```
EffectiveArmorPenalties
├── AgilityDicePenalty: int
├── StaminaCostIncrease: int
├── MovementReduction: int
├── AttackPenalty: int (from non-proficiency)
├── StealthDisadvantage: bool
├── SwimDisadvantage: bool
├── ProficiencyLevel: ArmorProficiencyLevel
├── IsNonProficient: bool
```

#### GaldrRestriction Value Object
```
GaldrRestriction
├── CanCastGaldr: bool
├── GaldrPenalty: int
├── RestrictionReason: string
├── ArmorCausing: ArmorCategory
```

**Non-Proficiency Penalty Examples:**
| Situation | Normal Penalty | Non-Proficient |
|-----------|---------------|----------------|
| Mystic in Medium | -1d10 Agility, +2 Stamina | -2d10 Agility, +4 Stamina |
| Skirmisher in Heavy | -2d10 Agility, +5 Stamina | -4d10 Agility, +10 Stamina |
| Mystic in Heavy | -2d10 Agility, +5 Stamina | -4d10 Agility, +10 Stamina, cannot cast Galdr |

**Penalty Calculation Logic:**
```
CalculatePenalties(characterId, armor):
  1. Get base penalties from armor category
  2. Get character's proficiency level
  3. If NonProficient:
     - Double all numeric penalties
     - Add -2 attack penalty
     - Block special properties
  4. If Expert or Master:
     - Apply tier reduction (Heavy → Medium penalties)
  5. If Master:
     - Add +1 Defense
  6. Check Galdr restrictions for Mystic
```

**Unit Tests (~3):**
- [ ] NonProficient doubles penalties correctly
- [ ] Expert applies Heavy as Medium penalties
- [ ] Attack penalty of -2 applied for NonProficient

---

### v0.16.2e - Proficiency Acquisition

#### ArmorProficiencyAcquisition Value Object
```
ArmorProficiencyAcquisition
├── Method: AcquisitionMethod enum
├── Category: ArmorCategory
├── Cost: int? (PS or PP)
├── Duration: TimeSpan?
├── RequiredCombats: int?
├── Prerequisites: List<string>?
```

**Acquisition Methods:**
| Method | PS Cost | PP Cost | Time | Combats |
|--------|---------|---------|------|---------|
| Archetype | Free | — | Instant | — |
| Specialization | Free | — | Instant | — |
| NPC Training | 100-400 | — | 2-6 weeks | — |
| Combat Experience | — | — | — | 15 |
| Progression Point | — | 3 | Instant | — |

**Note:** Armor proficiency costs more than weapon proficiency (3 PP vs 2 PP, 100-400 PS vs 50-200 PS) because armor affects all combat actions, not just attacks with a specific weapon.

**Combat Experience Tracking:**
```
OnCombatEnd(characterId, armorWorn):
  1. Get current proficiency level for armor category
  2. If NonProficient:
     - Increment combat counter for category
     - If counter >= 15: Grant Proficient level
  3. Combat experience only grants Proficient (not Expert/Master)
```

**Unit Tests (~2):**
- [ ] 15 combats grants proficiency
- [ ] PP cost is 3 (higher than weapons)

---

### v0.16.2f - Combat Integration

#### IArmorCombatIntegration Interface
```csharp
public interface IArmorCombatIntegration
{
    /// <summary>
    /// Modifies attack roll based on armor proficiency.
    /// </summary>
    int GetAttackModifier(string characterId);

    /// <summary>
    /// Modifies stamina cost based on armor penalties.
    /// </summary>
    int GetStaminaCostModifier(string characterId, string actionType);

    /// <summary>
    /// Gets dice pool reduction for Agility-based checks.
    /// </summary>
    int GetAgilityDiceReduction(string characterId);

    /// <summary>
    /// Checks if character can use armor's special properties.
    /// </summary>
    bool CanUseArmorProperties(string characterId);

    /// <summary>
    /// Records combat for proficiency tracking.
    /// </summary>
    void RecordArmorCombat(string characterId);
}
```

**Integration Points:**
```
On Any Action:
  1. Get equipped armor
  2. Calculate effective penalties
  3. Apply stamina cost increase
  4. Apply Agility dice reduction if applicable

On Galdr Cast (Mystic):
  1. Check armor restriction
  2. If Medium: Apply -2 penalty
  3. If Heavy: Block cast entirely

On Combat End:
  1. Record armor worn for proficiency tracking
  2. Check if proficiency gained
```

**Unit Tests (~2):**
- [ ] Stamina cost modified by armor
- [ ] Galdr blocked in Heavy armor for Mystic

---

### Configuration Files

| File | Purpose |
|------|---------|
| `armor-categories.json` | Category definitions with base penalties |
| `archetype-armor-proficiencies.json` | Starting proficiency matrix |
| `armor-restrictions.json` | Galdr/WITS interference rules |
| `armor-training.json` | NPC training costs/times |

---

### Dependencies

**Requires:**
- v0.16.1: Weapon proficiency pattern (reuse structure)
- Character/archetype system
- Combat resolution system
- Galdr/ability system (for Mystic restrictions)

**Provides to:**
- Combat system: Penalty modifiers
- Galdr system: Casting restrictions
- Character sheet: Armor status display

---

### Acceptance Criteria

- [ ] ArmorProficiencyLevel enum has 4 values
- [ ] ArmorCategory enum has 5 categories
- [ ] NonProficient doubles all penalties
- [ ] NonProficient adds -2 attack penalty
- [ ] Expert reduces effective tier by 1
- [ ] Master grants +1 Defense
- [ ] Mystic gets -2 Galdr in Medium armor
- [ ] Mystic cannot cast Galdr in Heavy armor
- [ ] Adept gets WITS impairment in Heavy armor
- [ ] 15 combats grants proficiency from NonProficient
- [ ] PP cost is 3 per category
- [ ] Special properties blocked for NonProficient
- [ ] ~15 unit tests pass
