# v0.14.0d Design Specification: Skill & Archetype Schemas

**Version:** 0.14.0d
**Parent:** v0.14.0 (Character Configuration Schemas)
**Prerequisites:** v0.13.5 Complete (UI Standardization)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Skills Schema Definition](#4-skills-schema-definition)
   - 4.1 [Schema Structure](#41-schema-structure)
   - 4.2 [SkillDefinition Object](#42-skilldefinition-object)
5. [Archetypes Schema Definition](#5-archetypes-schema-definition)
   - 5.1 [Schema Structure](#51-schema-structure)
   - 5.2 [ArchetypeDefinition Object](#52-archetypedefinition-object)
6. [Validation Rules](#6-validation-rules)
   - 6.1 [ID Pattern Validation](#61-id-pattern-validation)
   - 6.2 [Attribute Enum Validation](#62-attribute-enum-validation)
   - 6.3 [Category Enum Validation](#63-category-enum-validation)
   - 6.4 [Stat Tendency Enum Validation](#64-stat-tendency-enum-validation)
   - 6.5 [Required Fields](#65-required-fields)
7. [Configuration Schemas](#7-configuration-schemas)
8. [Configuration File Updates](#8-configuration-file-updates)
9. [Data Model Changes](#9-data-model-changes)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

Version 0.14.0d introduces two JSON Schema specifications: **Skills Schema** (`skills.schema.json`) and **Archetypes Schema** (`archetypes.schema.json`). These schemas validate skill definitions with attribute links, categories, and trained/untrained mechanics, as well as archetype definitions with playstyle metadata and stat tendencies.

The Skills Schema enables IDE autocomplete and validation for skill definitions, ensuring primary and secondary attributes are valid enum values, skill categories match defined options, and untrained penalties are non-negative. The Archetypes Schema validates archetype definitions that classes reference, ensuring stat tendencies and playstyle summaries are properly defined.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `skills.schema.json`, `archetypes.schema.json` |
| **Schema Definitions** | `SkillDefinition`, `ArchetypeDefinition` |
| **Configuration Updates** | Update `skills.json` and `archetypes.json` schema references |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version continues the **JSON Schema validation pattern** established in v0.14.0a and provides:
- **Archetype schema as dependency** for v0.14.0b (Class Schema) - classes reference archetypeId
- **Skill attribute enum** - establishes the canonical attribute list (might, fortitude, will, wits, finesse)
- **Category enumeration pattern** - demonstrates multi-category validation (5 skill categories, 3 stat tendencies)
- **Optional field handling** - shows how to handle optional fields like secondaryAttribute

### Relationship to Other Schemas

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                     SCHEMA DEPENDENCY GRAPH                                  │
└─────────────────────────────────────────────────────────────────────────────┘

  v0.14.0d (This Version)
  ├── archetypes.schema.json ──────────────────────┐
  │   • ArchetypeDefinition                        │
  │   • statTendency enum                          │
  │                                                ▼
  └── skills.schema.json                     v0.14.0b (Class Schema)
      • SkillDefinition                      ├── classes.schema.json
      • primaryAttribute enum ◀──────────────│   • archetypeId references
      • category enum                        │     archetypes.json
      • tags array                           └────────────────────────

Note: v0.14.0d should be implemented BEFORE v0.14.0b due to archetype reference
```

---

## 2. Feature Overview

```
v0.14.0d Skill & Archetype Schema Features
├── skills.schema.json
│   ├── Root Object Properties
│   │   ├── $schema (string, optional)
│   │   └── skills (array of SkillDefinition, required)
│   └── Definitions
│       └── SkillDefinition
│           ├── id (string, kebab-case pattern)
│           ├── name (string, minLength: 1)
│           ├── description (string)
│           ├── primaryAttribute (enum: might, fortitude, will, wits, finesse)
│           ├── secondaryAttribute (enum, optional)
│           ├── baseDicePool (string, dice pattern)
│           ├── allowUntrained (boolean, default: true)
│           ├── untrainedPenalty (integer, minimum: 0, default: 0)
│           ├── category (enum: Physical, Mental, Social, Knowledge, Specialty)
│           ├── tags (array of string)
│           └── sortOrder (integer, minimum: 0)
├── archetypes.schema.json
│   ├── Root Object Properties
│   │   ├── $schema (string, optional)
│   │   └── archetypes (array of ArchetypeDefinition, required)
│   └── Definitions
│       └── ArchetypeDefinition
│           ├── id (string, kebab-case pattern)
│           ├── name (string, minLength: 1)
│           ├── description (string)
│           ├── playstyleSummary (string)
│           ├── statTendency (enum: offensive, defensive, balanced)
│           └── sortOrder (integer, minimum: 0)
├── Validation Rules
│   ├── ID Pattern Enforcement
│   ├── Attribute Enum Validation
│   ├── Category Enum Validation
│   ├── Stat Tendency Enum Validation
│   └── Required Field Enforcement
└── Configuration Updates
    ├── skills.json $schema reference update
    └── archetypes.json $schema reference added
```

---

## 3. Architecture Diagrams

### 3.1 Schema Validation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SCHEMA VALIDATION FLOW                               │
└─────────────────────────────────────────────────────────────────────────────┘

    User edits skills.json OR archetypes.json
           │
           ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          IDE/EDITOR                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Reads $schema property from config file                                  │
│  2. Loads corresponding schema from config/schemas/                          │
│  3. Validates content against schema                                         │
└─────────────────────────────────────────────────────────────────────────────┘
           │
           ├─── Valid ───▶ Green checkmark, autocomplete works
           │
           └─── Invalid ─▶ Error underlines with messages:
                           • "primaryAttribute must be one of: might, fortitude, will, wits, finesse"
                           • "category must be one of: Physical, Mental, Social, Knowledge, Specialty"
                           • "statTendency must be one of: offensive, defensive, balanced"
                           • "untrainedPenalty must be >= 0"
```

### 3.2 Skills Schema Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         skills.schema.json                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"                         │
│  title: "Skills Configuration"                                               │
│  type: object                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  properties:                                                                 │
│  ┌─────────────────┬───────────────────────────────────────────────────┐    │
│  │ $schema         │ type: string (optional)                           │    │
│  ├─────────────────┼───────────────────────────────────────────────────┤    │
│  │ skills          │ type: array, items: $ref SkillDefinition          │    │
│  └─────────────────┴───────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────────────────┤
│  definitions:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ SkillDefinition                                                      │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ id                    │ string, pattern: ^[a-z][a-z0-9-]*$    │   │    │
│  │ │ name                  │ string, minLength: 1                  │   │    │
│  │ │ description           │ string                                │   │    │
│  │ │ primaryAttribute      │ enum: [might, fortitude, will,        │   │    │
│  │ │                       │        wits, finesse]                 │   │    │
│  │ │ secondaryAttribute    │ enum (same as above), optional        │   │    │
│  │ │ baseDicePool          │ string, pattern: ^\d+d\d+$            │   │    │
│  │ │ allowUntrained        │ boolean, default: true                │   │    │
│  │ │ untrainedPenalty      │ integer, minimum: 0, default: 0       │   │    │
│  │ │ category              │ enum: [Physical, Mental, Social,      │   │    │
│  │ │                       │        Knowledge, Specialty]          │   │    │
│  │ │ tags                  │ array of string                       │   │    │
│  │ │ sortOrder             │ integer, minimum: 0                   │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Archetypes Schema Structure Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         archetypes.schema.json                               │
├─────────────────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"                         │
│  title: "Archetypes Configuration"                                           │
│  type: object                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  properties:                                                                 │
│  ┌─────────────────┬───────────────────────────────────────────────────┐    │
│  │ $schema         │ type: string (optional)                           │    │
│  ├─────────────────┼───────────────────────────────────────────────────┤    │
│  │ archetypes      │ type: array, items: $ref ArchetypeDefinition      │    │
│  └─────────────────┴───────────────────────────────────────────────────┘    │
├─────────────────────────────────────────────────────────────────────────────┤
│  definitions:                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │ ArchetypeDefinition                                                  │    │
│  │ ┌───────────────────────┬───────────────────────────────────────┐   │    │
│  │ │ id                    │ string, pattern: ^[a-z][a-z0-9-]*$    │   │    │
│  │ │ name                  │ string, minLength: 1                  │   │    │
│  │ │ description           │ string                                │   │    │
│  │ │ playstyleSummary      │ string                                │   │    │
│  │ │ statTendency          │ enum: [offensive, defensive, balanced]│   │    │
│  │ │ sortOrder             │ integer, minimum: 0                   │   │    │
│  │ └───────────────────────┴───────────────────────────────────────┘   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Skill Categories Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SKILL CATEGORIES                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │
│  │    PHYSICAL     │  │     MENTAL      │  │     SOCIAL      │              │
│  │  (Body-based)   │  │   (Mind-based)  │  │ (Interaction)   │              │
│  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤              │
│  │ • Athletics     │  │ • Perception    │  │ • Intimidation  │              │
│  │ • Acrobatics    │  │ • Investigation │  │ • Persuasion    │              │
│  │ • Stealth       │  └─────────────────┘  └─────────────────┘              │
│  │ • Endurance     │                                                        │
│  └─────────────────┘                                                        │
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐                                   │
│  │   KNOWLEDGE     │  │   SPECIALTY     │                                   │
│  │   (Learned)     │  │ (Trained-only)  │                                   │
│  ├─────────────────┤  ├─────────────────┤                                   │
│  │ • Arcana        │  │ • Lockpicking   │                                   │
│  │                 │  │                 │                                   │
│  │ allowUntrained: │  │ allowUntrained: │                                   │
│  │ false (penalty) │  │ false (penalty) │                                   │
│  └─────────────────┘  └─────────────────┘                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Archetype Stat Tendencies Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      ARCHETYPE STAT TENDENCIES                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐                                                │
│  │       OFFENSIVE         │                                                │
│  │  (Attack-focused)       │                                                │
│  ├─────────────────────────┤                                                │
│  │ • Skirmisher            │  "High damage dealer with mobility focus"      │
│  │ • Mystic                │  "Spellcaster with powerful abilities"         │
│  │                         │                                                │
│  │ Classes prioritize:     │                                                │
│  │ - Attack stat           │                                                │
│  │ - Damage output         │                                                │
│  └─────────────────────────┘                                                │
│                                                                              │
│  ┌─────────────────────────┐                                                │
│  │       DEFENSIVE         │                                                │
│  │  (Survivability-focus)  │                                                │
│  ├─────────────────────────┤                                                │
│  │ • Warrior               │  "Frontline fighter with high survivability"   │
│  │                         │                                                │
│  │ Classes prioritize:     │                                                │
│  │ - MaxHealth stat        │                                                │
│  │ - Defense stat          │                                                │
│  └─────────────────────────┘                                                │
│                                                                              │
│  ┌─────────────────────────┐                                                │
│  │       BALANCED          │                                                │
│  │  (Versatile)            │                                                │
│  ├─────────────────────────┤                                                │
│  │ • Adept                 │  "Versatile utility class with gadgets"        │
│  │                         │                                                │
│  │ Classes prioritize:     │                                                │
│  │ - Even stat spread      │                                                │
│  │ - Utility abilities     │                                                │
│  └─────────────────────────┘                                                │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.6 File Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            CONFIG LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  config/                                                                     │
│  ├── skills.json ◀───────────────────────────┐                              │
│  │   {                                        │ references                   │
│  │     "$schema": "./schemas/skills.schema.json",                           │
│  │     "skills": [...]                        │                              │
│  │   }                                        │                              │
│  │                                            │                              │
│  ├── archetypes.json ◀───────────────────────┼──────────────┐               │
│  │   {                                        │              │ references    │
│  │     "$schema": "./schemas/archetypes.schema.json",       │               │
│  │     "archetypes": [...]                    │              │               │
│  │   }                                        │              │               │
│  │                                            │              │               │
│  └── schemas/                                 │              │               │
│      ├── skills.schema.json ──────────────────┘              │               │
│      │   {                                                   │               │
│      │     "$schema": "http://json-schema.org/draft-07/schema#",            │
│      │     "definitions": { "SkillDefinition": {...} }       │               │
│      │   }                                                   │               │
│      │                                                       │               │
│      └── archetypes.schema.json ─────────────────────────────┘               │
│          {                                                                   │
│            "$schema": "http://json-schema.org/draft-07/schema#",            │
│            "definitions": { "ArchetypeDefinition": {...} }                  │
│          }                                                                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Skills Schema Definition

### 4.1 Schema Structure

**File:** `config/schemas/skills.schema.json`

The skills schema follows JSON Schema Draft-07 specification, providing comprehensive validation for skill configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Skills Configuration",
    "description": "Schema for skill definitions. Skills represent character abilities that can be used for checks, with attribute links and category classifications.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "skills": {
            "type": "array",
            "description": "List of skill definitions",
            "items": {
                "$ref": "#/definitions/SkillDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["skills"],
    "additionalProperties": false,
    "definitions": {
        "SkillDefinition": { ... }
    }
}
```

### 4.2 SkillDefinition Object

The `SkillDefinition` object represents a single skill with attribute links, category, and trained/untrained mechanics.

```json
"SkillDefinition": {
    "type": "object",
    "description": "A single skill definition with attribute links and mechanics",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the skill (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name for the skill shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "Description of what the skill represents and when it's used",
            "minLength": 1,
            "maxLength": 500
        },
        "primaryAttribute": {
            "type": "string",
            "description": "The main attribute that modifies this skill's checks",
            "enum": ["might", "fortitude", "will", "wits", "finesse"]
        },
        "secondaryAttribute": {
            "type": "string",
            "description": "Optional secondary attribute that can also modify checks",
            "enum": ["might", "fortitude", "will", "wits", "finesse"]
        },
        "baseDicePool": {
            "type": "string",
            "description": "The base dice pool for skill checks (e.g., '1d10', '2d6')",
            "pattern": "^\\d+d\\d+$"
        },
        "allowUntrained": {
            "type": "boolean",
            "description": "Whether characters can attempt this skill without training",
            "default": true
        },
        "untrainedPenalty": {
            "type": "integer",
            "description": "Penalty applied to untrained skill checks (0 = no penalty)",
            "minimum": 0,
            "default": 0
        },
        "category": {
            "type": "string",
            "description": "The category this skill belongs to for organization and filtering",
            "enum": ["Physical", "Mental", "Social", "Knowledge", "Specialty"]
        },
        "tags": {
            "type": "array",
            "description": "Searchable tags for filtering and grouping skills",
            "items": {
                "type": "string",
                "minLength": 1
            },
            "uniqueItems": true
        },
        "sortOrder": {
            "type": "integer",
            "description": "Display order in skill lists (lower = earlier)",
            "minimum": 0,
            "default": 0
        }
    },
    "required": [
        "id",
        "name",
        "description",
        "primaryAttribute",
        "baseDicePool",
        "allowUntrained",
        "category",
        "tags"
    ],
    "additionalProperties": false
}
```

---

## 5. Archetypes Schema Definition

### 5.1 Schema Structure

**File:** `config/schemas/archetypes.schema.json`

The archetypes schema follows JSON Schema Draft-07 specification, providing validation for archetype definitions that classes reference.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Archetypes Configuration",
    "description": "Schema for class archetype definitions. Archetypes group classes by playstyle and stat tendencies.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "archetypes": {
            "type": "array",
            "description": "List of archetype definitions",
            "items": {
                "$ref": "#/definitions/ArchetypeDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["archetypes"],
    "additionalProperties": false,
    "definitions": {
        "ArchetypeDefinition": { ... }
    }
}
```

### 5.2 ArchetypeDefinition Object

The `ArchetypeDefinition` object represents a class grouping with playstyle metadata.

```json
"ArchetypeDefinition": {
    "type": "object",
    "description": "A single archetype definition with playstyle and stat tendency metadata",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the archetype (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name for the archetype shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "Description of the archetype's role and characteristics",
            "minLength": 1,
            "maxLength": 1000
        },
        "playstyleSummary": {
            "type": "string",
            "description": "Brief summary of the archetype's playstyle for character creation UI",
            "minLength": 1,
            "maxLength": 200
        },
        "statTendency": {
            "type": "string",
            "description": "The general stat distribution tendency of classes in this archetype",
            "enum": ["offensive", "defensive", "balanced"]
        },
        "sortOrder": {
            "type": "integer",
            "description": "Display order in archetype lists (lower = earlier)",
            "minimum": 0,
            "default": 0
        }
    },
    "required": [
        "id",
        "name",
        "description",
        "playstyleSummary",
        "statTendency",
        "sortOrder"
    ],
    "additionalProperties": false
}
```

---

## 6. Validation Rules

### 6.1 ID Pattern Validation

All identifier fields use kebab-case pattern validation to ensure consistency across configuration files.

| Field | Pattern | Valid Examples | Invalid Examples |
|-------|---------|----------------|------------------|
| `id` (skill) | `^[a-z][a-z0-9-]*$` | `athletics`, `lock-picking`, `arcana` | `Athletics`, `lock_picking`, `123skill` |
| `id` (archetype) | `^[a-z][a-z0-9-]*$` | `warrior`, `mystic`, `skirmisher` | `Warrior`, `my_stic` |

### 6.2 Attribute Enum Validation

The `primaryAttribute` and `secondaryAttribute` fields accept exactly five values:

| Value | Description | Example Skills |
|-------|-------------|----------------|
| `might` | Physical power | Athletics, Intimidation |
| `fortitude` | Physical resilience | Endurance |
| `will` | Mental fortitude | Persuasion, Arcana |
| `wits` | Mental acuity | Perception, Investigation, Stealth |
| `finesse` | Dexterity | Acrobatics, Stealth, Lockpicking |

**Validation Error Examples:**
```
Error: skills[0].primaryAttribute must be one of: might, fortitude, will, wits, finesse
Error: skills[1].secondaryAttribute "strength" is not a valid enum value
```

### 6.3 Category Enum Validation

The `category` field accepts exactly five values:

| Category | Description | Examples from skills.json |
|----------|-------------|---------------------------|
| `Physical` | Body-based skills | Athletics, Acrobatics, Stealth, Endurance |
| `Mental` | Mind-based skills | Perception, Investigation |
| `Social` | Interaction skills | Intimidation, Persuasion |
| `Knowledge` | Learned skills | Arcana |
| `Specialty` | Trained-only skills | Lockpicking |

**Validation Error Examples:**
```
Error: skills[0].category must be one of: Physical, Mental, Social, Knowledge, Specialty
Error: skills[1].category "Combat" is not a valid enum value
```

### 6.4 Stat Tendency Enum Validation

The `statTendency` field accepts exactly three values:

| Value | Description | Archetypes |
|-------|-------------|------------|
| `offensive` | Attack-focused stat distribution | Skirmisher, Mystic |
| `defensive` | Survivability-focused stat distribution | Warrior |
| `balanced` | Even stat spread | Adept |

**Validation Error Examples:**
```
Error: archetypes[0].statTendency must be one of: offensive, defensive, balanced
Error: archetypes[1].statTendency "aggressive" is not a valid enum value
```

### 6.5 Required Fields

#### Skills Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `id` | Must be present and non-empty | "missing required property 'id'" |
| `name` | Must be present with minLength 1 | "missing required property 'name'" |
| `description` | Must be present with minLength 1 | "missing required property 'description'" |
| `primaryAttribute` | Must be present and valid enum | "missing required property 'primaryAttribute'" |
| `baseDicePool` | Must be present and match pattern | "missing required property 'baseDicePool'" |
| `allowUntrained` | Must be present | "missing required property 'allowUntrained'" |
| `category` | Must be present and valid enum | "missing required property 'category'" |
| `tags` | Must be present (may be empty array) | "missing required property 'tags'" |

**Optional Fields (Skills):**
- `secondaryAttribute` - Optional secondary attribute link
- `untrainedPenalty` - Defaults to `0`
- `sortOrder` - Defaults to `0`

#### Archetypes Required Fields

| Field | Requirement | Error on Missing |
|-------|-------------|------------------|
| `id` | Must be present and non-empty | "missing required property 'id'" |
| `name` | Must be present with minLength 1 | "missing required property 'name'" |
| `description` | Must be present with minLength 1 | "missing required property 'description'" |
| `playstyleSummary` | Must be present | "missing required property 'playstyleSummary'" |
| `statTendency` | Must be present and valid enum | "missing required property 'statTendency'" |
| `sortOrder` | Must be present | "missing required property 'sortOrder'" |

---

## 7. Configuration Schemas

### Complete Skills Schema File

**File:** `config/schemas/skills.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Skills Configuration",
    "description": "Schema for skill definitions. Skills represent character abilities that can be used for checks, with attribute links and category classifications.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "skills": {
            "type": "array",
            "description": "List of skill definitions",
            "items": {
                "$ref": "#/definitions/SkillDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["skills"],
    "additionalProperties": false,
    "definitions": {
        "SkillDefinition": {
            "type": "object",
            "description": "A single skill definition with attribute links and mechanics",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the skill (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name for the skill shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "description": {
                    "type": "string",
                    "description": "Description of what the skill represents and when it's used",
                    "minLength": 1,
                    "maxLength": 500
                },
                "primaryAttribute": {
                    "type": "string",
                    "description": "The main attribute that modifies this skill's checks",
                    "enum": ["might", "fortitude", "will", "wits", "finesse"]
                },
                "secondaryAttribute": {
                    "type": "string",
                    "description": "Optional secondary attribute that can also modify checks",
                    "enum": ["might", "fortitude", "will", "wits", "finesse"]
                },
                "baseDicePool": {
                    "type": "string",
                    "description": "The base dice pool for skill checks (e.g., '1d10', '2d6')",
                    "pattern": "^\\d+d\\d+$"
                },
                "allowUntrained": {
                    "type": "boolean",
                    "description": "Whether characters can attempt this skill without training",
                    "default": true
                },
                "untrainedPenalty": {
                    "type": "integer",
                    "description": "Penalty applied to untrained skill checks (0 = no penalty)",
                    "minimum": 0,
                    "default": 0
                },
                "category": {
                    "type": "string",
                    "description": "The category this skill belongs to for organization and filtering",
                    "enum": ["Physical", "Mental", "Social", "Knowledge", "Specialty"]
                },
                "tags": {
                    "type": "array",
                    "description": "Searchable tags for filtering and grouping skills",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    },
                    "uniqueItems": true
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Display order in skill lists (lower = earlier)",
                    "minimum": 0,
                    "default": 0
                }
            },
            "required": [
                "id",
                "name",
                "description",
                "primaryAttribute",
                "baseDicePool",
                "allowUntrained",
                "category",
                "tags"
            ],
            "additionalProperties": false
        }
    }
}
```

### Complete Archetypes Schema File

**File:** `config/schemas/archetypes.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Archetypes Configuration",
    "description": "Schema for class archetype definitions. Archetypes group classes by playstyle and stat tendencies.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "archetypes": {
            "type": "array",
            "description": "List of archetype definitions",
            "items": {
                "$ref": "#/definitions/ArchetypeDefinition"
            },
            "minItems": 1
        }
    },
    "required": ["archetypes"],
    "additionalProperties": false,
    "definitions": {
        "ArchetypeDefinition": {
            "type": "object",
            "description": "A single archetype definition with playstyle and stat tendency metadata",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the archetype (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name for the archetype shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "description": {
                    "type": "string",
                    "description": "Description of the archetype's role and characteristics",
                    "minLength": 1,
                    "maxLength": 1000
                },
                "playstyleSummary": {
                    "type": "string",
                    "description": "Brief summary of the archetype's playstyle for character creation UI",
                    "minLength": 1,
                    "maxLength": 200
                },
                "statTendency": {
                    "type": "string",
                    "description": "The general stat distribution tendency of classes in this archetype",
                    "enum": ["offensive", "defensive", "balanced"]
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Display order in archetype lists (lower = earlier)",
                    "minimum": 0,
                    "default": 0
                }
            },
            "required": [
                "id",
                "name",
                "description",
                "playstyleSummary",
                "statTendency",
                "sortOrder"
            ],
            "additionalProperties": false
        }
    }
}
```

---

## 8. Configuration File Updates

### Updated skills.json

The existing `skills.json` already has a `$schema` reference but needs to be updated to point to the correct path.

**File:** `config/skills.json`

Current `$schema` reference (needs update):
```json
{
    "$schema": "skills.schema.json",  // Current: relative without path
    "skills": [...]
}
```

Updated `$schema` reference:
```json
{
    "$schema": "./schemas/skills.schema.json",  // Updated: correct relative path
    "skills": [...]
}
```

### Validation Confirmation (Skills)

The existing ten skills validate successfully:

| Skill | Category | Primary Attr | Secondary Attr | Allow Untrained |
|-------|----------|--------------|----------------|-----------------|
| Athletics | Physical | might | fortitude | true |
| Acrobatics | Physical | finesse | - | true |
| Stealth | Physical | finesse | wits | true |
| Perception | Mental | wits | - | true |
| Endurance | Physical | fortitude | - | true |
| Intimidation | Social | might | will | true |
| Persuasion | Social | will | - | true |
| Lockpicking | Specialty | finesse | - | false (penalty: 5) |
| Arcana | Knowledge | will | wits | false (penalty: 3) |
| Investigation | Mental | wits | - | true |

### Updated archetypes.json

The existing `archetypes.json` does not have a `$schema` reference. It needs to be added.

**File:** `config/archetypes.json`

Current (no schema):
```json
{
    "archetypes": [...]
}
```

Updated with schema reference:
```json
{
    "$schema": "./schemas/archetypes.schema.json",
    "archetypes": [...]
}
```

### Validation Confirmation (Archetypes)

The existing four archetypes validate successfully:

| Archetype | Stat Tendency | Playstyle Summary |
|-----------|---------------|-------------------|
| Warrior | defensive | Frontline fighter with high survivability |
| Skirmisher | offensive | High damage dealer with mobility focus |
| Adept | balanced | Versatile utility class with gadgets and tricks |
| Mystic | offensive | Spellcaster with powerful abilities |

---

## 9. Data Model Changes

### No Domain Changes Required

This phase creates only JSON Schema files for validation. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | Two schema files added, two config files updated |

### Schema as Documentation

The schemas serve as:
- **Validation contracts** for configuration files
- **IDE documentation** via description fields
- **Modding reference** for custom skill and archetype creation
- **Dependency for Class Schema** - archetypeId references validated archetypes

---

## 10. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 11. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Skills Schema Valid Structure | ~1 |
| Skills Attribute Enum Validation | ~1 |
| Skills Category Enum Validation | ~1 |
| Archetypes Schema Valid Structure | ~1 |
| Archetypes Stat Tendency Enum Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### SkillSchemaTests.cs

```csharp
[TestFixture]
public class SkillSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the existing skills.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void ExistingSkillsJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies primaryAttribute must be a valid enum value.
    /// </summary>
    [Test]
    public void PrimaryAttribute_InvalidEnumValue_FailsValidation();

    /// <summary>
    /// Verifies category must be a valid enum value.
    /// </summary>
    [Test]
    public void Category_InvalidEnumValue_FailsValidation();
}
```

#### ArchetypeSchemaTests.cs

```csharp
[TestFixture]
public class ArchetypeSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the existing archetypes.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void ExistingArchetypesJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies statTendency must be a valid enum value.
    /// </summary>
    [Test]
    public void StatTendency_InvalidEnumValue_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 12. Use Cases

### UC-001: Load Skill Configuration

**Actor:** Game System
**Flow:** System starts → Loads `skills.json` → Schema validates content → Skills available for character skill checks

### UC-002: Edit Skill in IDE

**Actor:** Developer/Modder
**Flow:** Opens `skills.json` in VS Code → IDE loads schema → Autocomplete suggests properties → Validation errors shown inline

### UC-003: Create Custom Skill

**Actor:** Modder
**Flow:** Adds new skill object to `skills.json` → IDE validates against schema → Errors shown for missing fields → Modder corrects errors → Skill validates successfully

### UC-004: Invalid Attribute Value

**Actor:** Modder
**Flow:** Sets `primaryAttribute: "strength"` in skill definition → IDE shows error "must be one of: might, fortitude, will, wits, finesse" → Modder corrects to valid attribute

### UC-005: Load Archetype Configuration

**Actor:** Game System
**Flow:** System starts → Loads `archetypes.json` → Schema validates content → Archetypes available for class categorization

### UC-006: Create Custom Archetype

**Actor:** Modder
**Flow:** Adds new archetype to `archetypes.json` → IDE validates against schema → Errors shown for invalid statTendency → Modder corrects to "offensive", "defensive", or "balanced"

### UC-007: Reference Archetype from Class

**Actor:** Class Schema
**Flow:** Class definition references `archetypeId: "warrior"` → Archetype schema validates warrior exists → Cross-reference maintained

---

## 13. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/skills.schema.json` created
- [ ] `config/schemas/archetypes.schema.json` created
- [ ] Both schemas follow JSON Schema Draft-07 format
- [ ] Both schemas include all defined properties
- [ ] Both schemas include definitions section

### Validation Rules
- [ ] ID pattern validation: `^[a-z][a-z0-9-]*$`
- [ ] Attribute enum validation: might, fortitude, will, wits, finesse
- [ ] Category enum validation: Physical, Mental, Social, Knowledge, Specialty
- [ ] Stat tendency enum validation: offensive, defensive, balanced
- [ ] Untrained penalty minimum: 0
- [ ] Required fields enforced
- [ ] Optional fields have defaults

### Configuration Updates
- [ ] `skills.json` $schema reference updated to `./schemas/skills.schema.json`
- [ ] `archetypes.json` $schema reference added as `./schemas/archetypes.schema.json`
- [ ] Existing `skills.json` validates against schema
- [ ] Existing `archetypes.json` validates against schema

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 14. Acceptance Criteria

### Functional
- [ ] `skills.schema.json` created in `config/schemas/` directory
- [ ] `archetypes.schema.json` created in `config/schemas/` directory
- [ ] Skills schema validates existing `skills.json` without errors
- [ ] Archetypes schema validates existing `archetypes.json` without errors
- [ ] Attribute enum validated (might, fortitude, will, wits, finesse)
- [ ] Skill category enum validated (Physical, Mental, Social, Knowledge, Specialty)
- [ ] Stat tendency enum validated (offensive, defensive, balanced)
- [ ] ID pattern enforced (lowercase kebab-case)
- [ ] VS Code provides autocomplete when schemas linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Both schema files are valid JSON
- [ ] All schema properties have descriptions

---

## 15. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `skills.json` | `config/skills.json` | Validated by new schema |
| `archetypes.json` | `config/archetypes.json` | Validated by new schema |
| Schema patterns | `config/schemas/races.schema.json` | Reference for schema structure |

### Provides to v0.14.0b (Class Schema)

| Type | Usage |
|------|-------|
| `archetypes.schema.json` | Classes reference archetypeId which must be a valid archetype |
| Attribute enum pattern | Same attribute names (might, fortitude, will, wits, finesse) used in classes |
| ID validation pattern | Same `^[a-z][a-z0-9-]*$` pattern reused |

### Implementation Order Note

**v0.14.0d should be implemented BEFORE v0.14.0b** because:
- Classes reference `archetypeId` which should validate against known archetypes
- The archetype schema establishes the canonical list of valid archetype IDs
- Cross-reference validation in v0.14.2 will verify archetypeId exists in archetypes.json

---

## 16. Future Considerations

### Deferred to v0.14.2 (Cross-Reference Validation)

- **archetypeId validation**: Cross-reference from classes.json to archetypes.json to verify archetype IDs exist
- **Skill proficiency grants**: Cross-reference from backgrounds to skills to verify skill IDs exist

### Out of Scope

- **Runtime schema validation**: Application-level validation at load time (handled by existing provider patterns)
- **Schema versioning migration**: Automatic migration between schema versions
- **Difficulty class references**: Linking skills to DC definitions (mentioned in v0.14.x-overview but deferred to future version)
- **Skill progression/leveling**: Skill rank increases and proficiency bonuses (game mechanics, not schema)
- **Archetype ability grants**: Automatic abilities from archetypes (game mechanics, not schema)

### Potential Future Enhancements

If the skill/archetype system expands, consider adding:
- `skillRanks` - Proficiency levels (Novice, Journeyman, Expert, Master)
- `synergies` - Skills that benefit from each other
- `archetypeAbilities` - Special abilities granted by archetype selection

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
