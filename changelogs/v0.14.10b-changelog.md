# v0.14.10b Changelog - Quest Schema

**Release Date:** 2026-01-22
**Version:** 0.14.10b
**Parent:** v0.14.10 (Game Systems Configuration Schemas)
**Prerequisites:** v0.14.10a (Faction Schema) Complete

---

## Overview

This version introduces the **Quest Schema** (`quests.schema.json`), a comprehensive JSON Schema Draft-07 specification for validating quest definitions. The schema enables full customization of quest structure, objectives, stages, prerequisites, rewards, branching paths, and failure conditions—all without code changes.

The Quest Schema integrates with:
- **Faction Schema (v0.14.10a)** - Reputation rewards reference faction IDs
- **Dialogue Schema (v0.14.9a)** - QuestStart/QuestUpdate outcomes trigger quests

---

## Added

### Schema File
- `config/schemas/quests.schema.json` - JSON Schema Draft-07 with 12 definitions

### Schema Definitions

| Definition | Description |
|------------|-------------|
| **Quest** | Complete quest definition with identity, stages, prerequisites, rewards, branches |
| **QuestStage** | Single stage with objectives and next stage reference |
| **Objective** | Task within a stage (12 types: Kill, Collect, Talk, Explore, etc.) |
| **ObjectiveCondition** | Conditions for objective visibility/completion |
| **Prerequisite** | Requirements to accept a quest (9 types) |
| **Reward** | Completion rewards (8 types: XP, Gold, Item, Reputation, etc.) |
| **QuestBranch** | Branching path with condition and target stage |
| **BranchCondition** | Trigger condition for branch (6 types) |
| **FailureCondition** | Condition causing quest failure (6 types) |
| **Consequence** | Effect when quest fails (6 types) |
| **StageAction** | Action triggered on stage completion (6 types) |
| **QuestGiver** | NPC configuration for quest offer and turn-in |

### Quest Categories (8 Types)

| Category | Description | Repeatable |
|----------|-------------|------------|
| `MainStory` | Primary narrative quests | No |
| `SideQuest` | Optional character stories | No |
| `FactionQuest` | Faction-specific tasks | Some |
| `Bounty` | Kill target quests | Yes |
| `Exploration` | Discover locations | No |
| `Crafting` | Create items | Yes |
| `Daily` | Repeatable dailies | Yes |
| `Event` | Limited-time quests | No |

### Objective Types (12 Types)

| Type | Description | Target |
|------|-------------|--------|
| `Kill` | Defeat enemies | Enemy ID |
| `Collect` | Gather items | Item ID |
| `Talk` | Speak with NPC | NPC ID |
| `Explore` | Visit location | Location ID |
| `Escort` | Protect NPC to destination | NPC ID |
| `Defend` | Hold location for duration | Location ID |
| `Craft` | Create specific item | Item ID |
| `Discover` | Find lore/knowledge | Codex Entry ID |
| `Deliver` | Bring item to NPC | Item + NPC ID |
| `Use` | Interact with object | Object ID |
| `Survive` | Stay alive for duration | Duration |
| `Reach` | Arrive at destination | Location ID |

### Prerequisite Types (9 Types)

| Type | Description |
|------|-------------|
| `Level` | Player level requirement |
| `QuestComplete` | Completed quest requirement |
| `QuestActive` | Active quest requirement |
| `FactionReputation` | Minimum faction standing |
| `HasItem` | Item in inventory |
| `HasAbility` | Unlocked ability |
| `HasFlag` | World state flag set |
| `ClassIs` | Player class requirement |
| `RaceIs` | Player race requirement |

### Reward Types (8 Types)

| Type | Description | Faction Integration |
|------|-------------|---------------------|
| `Experience` | XP/Legend points | - |
| `Gold` | Currency reward | - |
| `Item` | Inventory item | - |
| `Reputation` | Faction standing | References v0.14.10a |
| `Ability` | Unlock ability | - |
| `Title` | Grant title | - |
| `Unlock` | Unlock content | - |
| `Flag` | Set world state flag | - |

### Configuration File
- `config/quests.json` - 7 example quests demonstrating all categories:
  - `iron-path` - MainStory quest with prerequisites and 4 stages
  - `lost-tools` - SideQuest with Collect and Deliver objectives
  - `patrol-route` - Repeatable Bounty quest
  - `rusted-heart` - MainStory with modular objectives and branching
  - `salvage-run-daily` - Daily repeatable quest
  - `hidden-cache` - Hidden Exploration quest
  - `escort-scholar` - FactionQuest with failure conditions

### Unit Tests
- `tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/QuestsSchemaTests.cs`
- 48 unit tests covering:
  - QST-001: Schema loads and contains 12 definitions
  - QST-002: Quest identity validation (kebab-case ID, name)
  - QST-003: Quest category validation (8 PascalCase enums)
  - QST-004: Stage sequence validation (minItems, nextStageId)
  - QST-005: Objective type validation (12 PascalCase enums)
  - QST-006: Reward type validation (8 types)
  - Additional tests for prerequisites, failure conditions, branches, quest givers

---

## Technical Details

### Schema Patterns

| Pattern | Convention | Example |
|---------|------------|---------|
| ID fields | lowercase kebab-case | `iron-path`, `speak-kjartan` |
| Enum values | PascalCase | `MainStory`, `Kill`, `Experience` |
| Property names | camelCase | `questGiver`, `nextStageId` |
| Version | semver | `1.0.0` |

### Schema Constraints

| Field | Constraint |
|-------|------------|
| `quest.id` | Pattern: `^[a-z][a-z0-9-]*$`, minLength: 2 |
| `quest.name` | minLength: 1 |
| `quest.description` | minLength: 10 |
| `quest.stages` | minItems: 1 |
| `stage.objectives` | minItems: 1 |
| `objective.description` | minLength: 5 |
| `quest.level` | 1-100 or null |
| `quest.timeLimit` | minimum: 1 or null |
| `objective.quantity` | minimum: 1 |

### Integration Points

```
Dialogue Schema (v0.14.9a)
├── Outcome.Type: "QuestStart" → initiates quest by ID
├── Outcome.Type: "QuestUpdate" → advances quest stage
└── Outcome.Data: "quest-id:stage-id" format

Faction Schema (v0.14.10a)
├── Reward.Type: "Reputation" → target is faction ID
├── Prerequisite.Type: "FactionReputation" → target is faction ID
└── FailureConsequence.Type: "Reputation" → target is faction ID
```

---

## Test Results

```
Test summary: total: 48, failed: 0, succeeded: 48, skipped: 0
Build succeeded with 0 errors
```

---

## Files Changed

| File | Change Type | Description |
|------|-------------|-------------|
| `config/schemas/quests.schema.json` | Added | Quest schema with 12 definitions |
| `config/quests.json` | Added | 7 example quests |
| `tests/.../Schemas/QuestsSchemaTests.cs` | Added | 48 unit tests |
| `docs/design/v0.14.x/v0.14.10-scope-breakdown.md` | Updated | Mark v0.14.10b criteria |
| `docs/design/v0.14.x/v0.14.x-overview.md` | Updated | Mark quest schema complete |
| `changelogs/v0.14.10b-changelog.md` | Added | This changelog |

---

## Next Steps

- **v0.14.10c** - Codex Schema (journal/bestiary entries)
- **v0.14.10d** - Commands Schema (command syntax)
- **v0.14.10e** - Glossary Schema (game terminology)
- **v0.14.10f** - Stances Schema (combat stances)

---

*End of v0.14.10b Changelog*
