# v0.0.9 Implementation Specification: Monster Variety & Loot

**Version:** 0.0.9
**Implementation Date:** 2026-01-08
**Design Specification:** [v0.0.9-scope-breakdown.md](../v0.0.9-scope-breakdown.md)
**Changelogs:** [v0.0.9a](../../changelogs/v0.0.9a-changelog.md), [v0.0.9b](../../changelogs/v0.0.9b-changelog.md), [v0.0.9c](../../changelogs/v0.0.9c-changelog.md), [v0.0.9d](../../changelogs/v0.0.9d-changelog.md)

---

## 1. Overview

### 1.1 Summary

v0.0.9 expands monster variety with data-driven definitions, damage types with resistances, tier-based difficulty scaling with traits, and a complete loot system with currency and item drops.

### 1.2 Key Features

- **Monster Definitions**: Data-driven monsters from JSON
- **Damage Types**: Physical, Fire, Ice, Lightning, Poison, Holy, Dark
- **Resistances**: Per-monster resistance/immunity/vulnerability
- **Monster Tiers**: Common, Named, Elite, Boss with stat multipliers
- **Monster Traits**: Special abilities and modifiers
- **Loot Tables**: Configurable item and currency drops
- **Currency System**: Gold tracking and display

### 1.3 Deviations from Design

None significant; implementation matches design specification.

---

## 2. Architecture

### 2.1 Layer Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                        â”‚
â”‚  GameView â†’ Combat with loot drops                          â”‚
â”‚  SpectreGameRenderer â†’ RenderLootDropAsync                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Application Layer                         â”‚
â”‚  GameSessionService, LootService                            â”‚
â”‚  LootDropDto, CurrencyAmountDto                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Domain Layer                            â”‚
â”‚  MonsterDefinition, TierDefinition, TraitDefinition         â”‚
â”‚  DamageType, DamageResistance, LootTable                    â”‚
â”‚  CurrencyDefinition, LootDrop, DroppedItem                  â”‚
â”‚  DamageCalculationService                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                       â”‚
â”‚  config/monsters.json, config/tiers.json                    â”‚
â”‚  config/traits.json, config/currency.json                   â”‚
â”‚  JsonConfigurationProvider                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Key Patterns

- **Definition Pattern**: Immutable monster/tier/trait configurations
- **Factory Pattern**: Monster spawning from definitions
- **Strategy Pattern**: Damage calculation with resistances
- **Composite Pattern**: Loot tables with multiple entries

### 2.3 Dependencies

- v0.0.7: Weapon damage types
- v0.0.6: Monster AI behaviors
- v0.0.8: XP values for monsters

---

## 3. Data Model

### 3.1 Monster Definitions

| Property | Type | Description |
|----------|------|-------------|
| `Id` | string | Unique identifier |
| `Name` | string | Display name |
| `Description` | string | Flavor text |
| `BaseHealth` | int | Base HP before tier |
| `BaseAttack` | int | Base attack value |
| `BaseDefense` | int | Base defense value |
| `BaseXP` | int | XP reward |
| `AIBehavior` | AIBehavior | AI type |
| `Resistances` | Dictionary | Damage resistances |
| `TraitPool` | List | Possible traits |
| `LootTable` | LootTable | Drop configuration |

### 3.2 Tiers

| Tier | Health | Attack | Defense | XP | Loot |
|------|--------|--------|---------|-----|------|
| Common | 1.0x | 1.0x | 1.0x | 1.0x | 1.0x |
| Named | 1.5x | 1.25x | 1.25x | 1.75x | 2.0x |
| Elite | 2.0x | 1.5x | 1.5x | 2.5x | 3.0x |
| Boss | 3.0x | 2.0x | 2.0x | 5.0x | 5.0x |

### 3.3 Damage Types & Resistances

| Damage Type | Common Sources |
|-------------|----------------|
| Physical | Weapons, basic attacks |
| Fire | Fire spells, fire monsters |
| Ice | Ice spells |
| Lightning | Storm spells |
| Poison | Poison abilities |
| Holy | Paladin abilities |
| Dark | Necromancy |

| Resistance Level | Effect |
|------------------|--------|
| Vulnerable | 150% damage |
| Normal | 100% damage |
| Resistant | 50% damage |
| Immune | 0% damage |

### 3.4 Loot System

| Component | Description |
|-----------|-------------|
| `LootTable` | Collection of entries and currency drops |
| `LootEntry` | ItemId, Weight, MinQty, MaxQty, DropChance |
| `CurrencyDrop` | CurrencyId, MinAmount, MaxAmount, DropChance |
| `LootDrop` | Generated result with items and currency |
| `DroppedItem` | Instantiated item with quantity |

---

## 4. Services

### 4.1 MonsterService

```csharp
SpawnMonster(definitionId, tier, room) â†’ Monster
GetMonsterDefinition(id) â†’ MonsterDefinition
ApplyTier(monster, tierDefinition) â†’ void
RollTraits(monster, traitPool) â†’ IReadOnlyList<Trait>
```

### 4.2 DamageCalculationService

```csharp
Calculate(baseDamage, damageType, target) â†’ DamageResult
GetResistanceModifier(target, damageType) â†’ float
IsImmune(target, damageType) â†’ bool
IsVulnerable(target, damageType) â†’ bool
```

### 4.3 LootService

```csharp
GenerateLoot(monster) â†’ LootDrop
GenerateLoot(definition, multiplier) â†’ LootDrop
CollectLoot(player, room) â†’ CollectResult
GetCurrency(currencyId) â†’ CurrencyDefinition
GetAllCurrencies() â†’ IReadOnlyList<CurrencyDefinition>
```

### 4.4 Player Extensions

```csharp
Currency { get; } â†’ IReadOnlyDictionary<string, int>
GetCurrency(currencyId) â†’ int
AddCurrency(currencyId, amount) â†’ void
RemoveCurrency(currencyId, amount) â†’ bool
CanAfford(currencyId, amount) â†’ bool
```

### 4.5 Room Extensions

```csharp
DroppedItems { get; } â†’ IReadOnlyList<DroppedItem>
DroppedCurrency { get; } â†’ IReadOnlyDictionary<string, int>
HasDroppedLoot { get; } â†’ bool
AddLoot(lootDrop) â†’ void
CollectAllLoot() â†’ LootDrop
ClearDroppedLoot() â†’ void
```

---

## 5. Configuration

### 5.1 JSON Files

| File | Content |
|------|---------|
| `monsters.json` | Monster definitions with loot tables |
| `tiers.json` | Tier multipliers |
| `traits.json` | Trait definitions |
| `currency.json` | Currency definitions |

### 5.2 Monster Example

```json
{
  "id": "goblin-warrior",
  "name": "Goblin Warrior",
  "baseHealth": 30,
  "baseAttack": 8,
  "baseDefense": 3,
  "baseXP": 25,
  "aiBehavior": "Aggressive",
  "resistances": {
    "fire": 0,
    "ice": 0,
    "physical": 0
  },
  "lootTable": {
    "entries": [
      { "itemId": "rusty-dagger", "chance": 0.05 },
      { "itemId": "health-potion", "chance": 0.15 }
    ],
    "currencyDrops": [
      { "currencyId": "gold", "min": 5, "max": 15, "chance": 0.8 }
    ]
  }
}
```

### 5.3 Currency Example

```json
{
  "currencies": [
    {
      "id": "gold",
      "name": "Gold",
      "pluralName": "Gold",
      "symbol": "G",
      "color": "yellow"
    }
  ]
}
```

---

## 6. Commands & Rendering

### 6.1 Loot Display

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚          ğŸ’° LOOT COLLECTED ğŸ’°       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  From: Goblin Warrior               â”‚
â”‚                                     â”‚
â”‚  ITEMS:                             â”‚
â”‚    [Common] Rusty Dagger            â”‚
â”‚    [Uncommon] Health Potion         â”‚
â”‚                                     â”‚
â”‚  CURRENCY:                          â”‚
â”‚    Gold: +15                        â”‚
â”‚                                     â”‚
â”‚  Total Gold: 150 â†’ 165              â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

### 6.2 Monster Display with Tier

```
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚  âš ï¸ An ELITE Goblin Warchief âš ï¸    â”‚
â”‚                                     â”‚
â”‚  Health: 60 (Elite: 2.0x)           â”‚
â”‚  Traits: Armored, Battle Cry        â”‚
â”‚                                     â”‚
â”‚  Resistances:                       â”‚
â”‚    Physical: 25%                    â”‚
â”‚    Fire: Vulnerable                 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
```

---

## 7. Use Cases

### 7.1 Primary Use Cases

- [UC-014: Collect Loot](../../use-cases/player/UC-014-collect-loot.md)
- [UC-106: Generate Loot](../../use-cases/system/UC-106-generate-loot.md)
- [UC-107: Calculate Damage](../../use-cases/system/UC-107-calculate-damage.md)
- [UC-110: Spawn Monster](../../use-cases/system/UC-110-spawn-monster.md)

### 7.2 Edge Cases

- Monster immune to attack's damage type
- All loot rolls fail
- Tier multiplier applied to loot
- Multiple trait interactions

---

## 8. Testing

### 8.1 Test Coverage

| Phase | Tests | Areas |
|-------|-------|-------|
| v0.0.9a | ~40 | Monster definitions |
| v0.0.9b | ~35 | Damage types, resistances |
| v0.0.9c | ~30 | Tiers, traits |
| v0.0.9d | ~50 | Loot, currency |
| **Total** | **734** | +115 from v0.0.8 |

### 8.2 Key Test Scenarios

- Monster spawning with tiers
- Damage calculation with resistances
- Trait application
- Loot generation randomness
- Currency tracking
- Room loot storage
- Loot collection

---

## 9. Known Limitations

### 9.1 Current Limitations

- No item quality tiers (commonâ†’legendary)
- No loot rarity weighting by dungeon level
- No unique/named item drops
- No loot sharing in multiplayer

### 9.2 Future Improvements

- Item quality system
- Dungeon-level loot scaling
- Unique boss drops
- Loot filters

---

## 10. Related Documentation

- **ADRs**: [ADR-002](../../architecture/ADR-002-json-configuration.md) (monster/loot config)
- **Use Cases**: UC-014, UC-106, UC-107, UC-110
- **Integration**: v0.0.7 (weapon damage types), v0.0.8 (XP), v0.0.6 (AI)
