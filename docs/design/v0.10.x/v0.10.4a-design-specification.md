# v0.10.4a Design Specification: Boss Definitions

**Version:** 0.10.4a
**Parent:** v0.10.4 (Advanced Encounters)
**Prerequisites:** v0.10.3c Complete (Zone Control)
**Status:** Design Complete
**Estimated Unit Tests:** ~12

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [BossBehavior Enum](#4-bossbehavior-enum)
5. [SummonConfiguration Value Object](#5-summonconfiguration-value-object)
6. [BossLootEntry Value Object](#6-bosslootentry-value-object)
7. [BossPhase Entity](#7-bossphase-entity)
8. [BossDefinition Entity](#8-bossdefinition-entity)
9. [IBossProvider Interface](#9-ibossprovider-interface)
10. [BossProvider Implementation](#10-bossprovider-implementation)
11. [Configuration Schema](#11-configuration-schema)
12. [Configuration File](#12-configuration-file)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)

---

## 1. Executive Summary

### Purpose

This version introduces boss encounter definitions with multi-phase mechanics. Bosses are special monsters that transition through distinct phases as their health decreases, each phase featuring different abilities, behaviors, and stat modifiers. The `BossDefinition` entity serves as a data-driven template loaded from JSON configuration, establishing the foundation for the boss mechanics service in v0.10.4b.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Domain Entities** | `BossDefinition`, `BossPhase` |
| **Domain Enums** | `BossBehavior` |
| **Value Objects** | `SummonConfiguration`, `BossLootEntry` |
| **Interfaces** | `IBossProvider` |
| **Infrastructure** | `BossProvider` |
| **Configuration** | `bosses.json`, `bosses.schema.json` |
| **Tests** | ~12 unit tests |

### Architectural Significance

This version establishes the **Definition-Phase Pattern** for boss encounters:

- Bosses extend the monster system with health-threshold-based phase mechanics
- Phases define distinct ability sets, behaviors, and stat modifications
- Transition configuration (text, effects) enables dramatic phase change moments
- Summon configuration supports boss minion mechanics
- The pattern mirrors `StatusEffectDefinition` for consistency

---

## 2. Feature Overview

```
v0.10.4a Features
├── BossDefinition Entity
│   ├── BossId (string key, kebab-case)
│   ├── Name, Description
│   ├── BaseMonsterDefinitionId (reference)
│   ├── TitleText (boss announcement)
│   ├── Phases (List<BossPhase>)
│   │   └── Ordered by descending HealthThreshold
│   ├── Loot (List<BossLootEntry>)
│   ├── IconPath (optional)
│   ├── GetPhaseForHealth(percent) method
│   ├── GetStartingPhase() method
│   └── PhaseCount property
│
├── BossPhase Entity
│   ├── PhaseNumber (int, 1-based)
│   ├── Name (e.g., "Rise", "Legion", "Fury")
│   ├── Description (optional)
│   ├── HealthThreshold (percentage, 100-0)
│   ├── AbilityIds (List<string>)
│   ├── Behavior (BossBehavior enum)
│   ├── StatModifiers (Dictionary<string, float>)
│   │   └── Keys: "damage", "defense", "attackSpeed", etc.
│   ├── TransitionText (optional announcement)
│   ├── TransitionEffectId (optional effect trigger)
│   ├── SummonConfig (optional SummonConfiguration)
│   ├── IconPath (optional phase icon)
│   ├── GetStatModifier(statId) method
│   └── HasTransition property
│
├── BossBehavior Enum
│   ├── Aggressive (focus damage)
│   ├── Tactical (strategic ability use)
│   ├── Defensive (self-preservation)
│   ├── Enraged (all-out attack)
│   └── Summoner (minion focus)
│
├── SummonConfiguration Value Object
│   ├── MonsterDefinitionId
│   ├── Count (per summon)
│   ├── IntervalTurns (between summons)
│   └── MaxActive (summon cap)
│
├── BossLootEntry Value Object
│   ├── ItemId
│   ├── Amount (optional, for stackables)
│   ├── Chance (0.0-1.0)
│   └── IsGuaranteed property
│
├── IBossProvider Interface
│   ├── GetBoss(bossId)
│   ├── GetAllBosses()
│   ├── GetBossIds()
│   ├── BossExists(bossId)
│   └── GetBossesByPhaseCount(count)
│
├── BossProvider Implementation
│   ├── JSON loading from bosses.json
│   ├── Phase validation (thresholds, ordering)
│   ├── Definition caching
│   └── Diagnostic logging
│
└── Configuration
    ├── bosses.json (3-5 example bosses)
    │   ├── skeleton-king (3 phases)
    │   ├── volcanic-wyrm (3 phases)
    │   ├── shadow-lich (2 phases)
    │   └── orc-warlord (2 phases)
    └── bosses.schema.json (validation)
```

---

## 3. Architecture Diagrams

### 3.1 Boss Definition Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    BOSS DEFINITION ARCHITECTURE                          │
└─────────────────────────────────────────────────────────────────────────┘

     Configuration                        Domain
     ─────────────                        ──────

   bosses.json                   ┌──────────────────────────────┐
   ┌─────────────────┐           │       BossDefinition         │
   │ {                │           ├──────────────────────────────┤
   │   "bossId":      │  ─────▶   │ + BossId: string             │
   │     "skeleton-   │           │ + Name: string               │
   │      king",      │           │ + Description: string        │
   │   "name": "...", │           │ + BaseMonsterDefinitionId    │
   │   "baseMonster": │           │ + TitleText: string?         │
   │     "skeleton-   │           │ + Phases: List<BossPhase>    │
   │      lord",      │           │ + Loot: List<BossLootEntry>  │
   │   "phases": [...],          │ + IconPath: string?          │
   │   "loot": [...]  │           ├──────────────────────────────┤
   │ }                │           │ + GetPhaseForHealth(%)       │
   └─────────────────┘           │ + GetStartingPhase()         │
                                  │ + PhaseCount                 │
                                  └──────────────┬───────────────┘
                                                 │ contains 1..*
                                                 ▼
                                  ┌──────────────────────────────┐
                                  │         BossPhase            │
                                  ├──────────────────────────────┤
                                  │ + PhaseNumber: int           │
                                  │ + Name: string               │
                                  │ + Description: string?       │
                                  │ + HealthThreshold: int       │
                                  │ + AbilityIds: List<string>   │
                                  │ + Behavior: BossBehavior     │
                                  │ + StatModifiers: Dict        │
                                  │ + TransitionText: string?    │
                                  │ + TransitionEffectId: string?│
                                  │ + SummonConfig?              │
                                  │ + IconPath: string?          │
                                  ├──────────────────────────────┤
                                  │ + GetStatModifier(statId)    │
                                  │ + HasTransition              │
                                  └──────────────────────────────┘
```

### 3.2 Phase Health Threshold Flow

```
    BOSS PHASE HEALTH THRESHOLDS
    ════════════════════════════════════════════════════════════════════

    Boss: SKELETON KING
    ───────────────────

    HP: 100%              HP: 66%              HP: 33%              HP: 0%
    ┌───────────┐        ┌───────────┐        ┌───────────┐        ┌─────┐
    │  PHASE 1  │   ──▶  │  PHASE 2  │   ──▶  │  PHASE 3  │   ──▶  │DEAD │
    │  "Rise"   │        │  "Legion" │        │  "Fury"   │        │     │
    │thresh:100 │        │ thresh:66 │        │ thresh:33 │        │     │
    └───────────┘        └───────────┘        └───────────┘        └─────┘


    GetPhaseForHealth() Algorithm:
    ──────────────────────────────

    Input: currentHealthPercent = 50%

    Phases (ordered by descending threshold):
      Phase 1: threshold 100  →  100 >= 50? YES, but continue checking
      Phase 2: threshold 66   →   66 >= 50? YES, but continue checking
      Phase 3: threshold 33   →   33 >= 50? NO

    Result: Return Phase 2 (first phase where threshold >= health)


    THRESHOLD EXAMPLES:
    ┌────────────────────┬─────────────────┬────────────────────────────┐
    │ Health %           │ Returns Phase   │ Reason                     │
    ├────────────────────┼─────────────────┼────────────────────────────┤
    │ 100%               │ Phase 1 (Rise)  │ 100 <= 100                 │
    │ 85%                │ Phase 1 (Rise)  │ 85 <= 100, 85 > 66         │
    │ 66%                │ Phase 2 (Legion)│ 66 <= 66 (exact threshold) │
    │ 50%                │ Phase 2 (Legion)│ 50 <= 66, 50 > 33          │
    │ 33%                │ Phase 3 (Fury)  │ 33 <= 33 (exact threshold) │
    │ 10%                │ Phase 3 (Fury)  │ 10 <= 33                   │
    └────────────────────┴─────────────────┴────────────────────────────┘
```

### 3.3 Clean Architecture Layers

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      CLEAN ARCHITECTURE LAYERS                           │
└─────────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                        PRESENTATION                              │
    │  (No changes in v0.10.4a - definitions only)                    │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                        APPLICATION                               │
    │  ┌─────────────────────────────────────────────────────────┐    │
    │  │ Interfaces/                                              │    │
    │  │ └── IBossProvider.cs  [NEW]                             │    │
    │  └─────────────────────────────────────────────────────────┘    │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                          DOMAIN                                  │
    │  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐  │
    │  │ Definitions/     │  │ ValueObjects/    │  │ Enums/       │  │
    │  │ ├── BossDef.cs   │  │ ├── SummonCfg.cs │  │ └── Boss-    │  │
    │  │ │    [NEW]       │  │ │    [NEW]       │  │     Behavior │  │
    │  │ └── BossPhase.cs │  │ └── BossLoot.cs  │  │     .cs [NEW]│  │
    │  │      [NEW]       │  │      [NEW]       │  │              │  │
    │  └──────────────────┘  └──────────────────┘  └──────────────┘  │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                      INFRASTRUCTURE                              │
    │  ┌─────────────────────────────────────────────────────────┐    │
    │  │ Providers/                                               │    │
    │  │ └── BossProvider.cs  [NEW]                              │    │
    │  └─────────────────────────────────────────────────────────┘    │
    │  ┌─────────────────────────────────────────────────────────┐    │
    │  │ config/                                                  │    │
    │  │ ├── bosses.json  [NEW]                                  │    │
    │  │ └── schemas/                                            │    │
    │  │     └── bosses.schema.json  [NEW]                       │    │
    │  └─────────────────────────────────────────────────────────┘    │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.4 Skeleton King Phase Diagram

```
    SKELETON KING - PHASE BREAKDOWN
    ════════════════════════════════════════════════════════════════════

    ┌─────────────────────────────────────────────────────────────────┐
    │                    PHASE 1: "RISE"                               │
    │                    Threshold: 100%                               │
    ├─────────────────────────────────────────────────────────────────┤
    │  Behavior: Aggressive                                           │
    │                                                                 │
    │  Abilities:                                                     │
    │  • bone-strike (melee attack)                                   │
    │  • soul-drain (life steal)                                      │
    │                                                                 │
    │  Stat Modifiers: (none - base stats)                            │
    │                                                                 │
    │  Transition: (none - starting phase)                            │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HP drops to 66% or below
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                    PHASE 2: "LEGION"                             │
    │                    Threshold: 66%                                │
    ├─────────────────────────────────────────────────────────────────┤
    │  Behavior: Summoner                                             │
    │                                                                 │
    │  Abilities:                                                     │
    │  • bone-strike (melee attack)                                   │
    │  • summon-skeletons (calls minions)                             │
    │  • dark-shield (defensive buff)                                 │
    │                                                                 │
    │  Summon Config:                                                 │
    │  • Monster: skeleton-warrior                                    │
    │  • Count: 2 per summon                                          │
    │  • Interval: every 2 turns                                      │
    │  • Max Active: 4                                                │
    │                                                                 │
    │  Transition Text: "The Skeleton King raises his arms!           │
    │                    Bones rise from the ground!"                 │
    │  Transition Effect: knockback-all-2                             │
    └─────────────────────────────────────────────────────────────────┘
                                    │
                                    │ HP drops to 33% or below
                                    ▼
    ┌─────────────────────────────────────────────────────────────────┐
    │                    PHASE 3: "FURY"                               │
    │                    Threshold: 33%                                │
    ├─────────────────────────────────────────────────────────────────┤
    │  Behavior: Enraged                                              │
    │                                                                 │
    │  Abilities:                                                     │
    │  • bone-strike (melee attack)                                   │
    │  • soul-drain (life steal)                                      │
    │  • death-nova (AoE damage)                                      │
    │                                                                 │
    │  Stat Modifiers:                                                │
    │  • damage: 1.5x (+50%)                                          │
    │  • attackSpeed: 1.25x (+25%)                                    │
    │  • defense: 0.75x (-25%)                                        │
    │                                                                 │
    │  Transition Text: "The Skeleton King's eyes blaze               │
    │                    with unholy fury!"                           │
    │  Transition Effect: (none)                                      │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 4. BossBehavior Enum

**File:** `src/Core/RuneAndRust.Domain/Enums/BossBehavior.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Behavior patterns for boss AI during different phases.
/// </summary>
/// <remarks>
/// Boss behavior influences AI decision-making:
/// - Ability selection priority
/// - Target selection criteria
/// - Defensive vs offensive balance
/// </remarks>
public enum BossBehavior
{
    /// <summary>
    /// Focus on dealing maximum damage to targets.
    /// Prioritizes high-damage abilities and vulnerable targets.
    /// </summary>
    Aggressive,

    /// <summary>
    /// Use abilities strategically, balancing offense and defense.
    /// Considers cooldowns, positioning, and target priority.
    /// </summary>
    Tactical,

    /// <summary>
    /// Prioritize self-preservation and defensive abilities.
    /// Uses shields, heals, and escape abilities when available.
    /// </summary>
    Defensive,

    /// <summary>
    /// All-out attack mode, ignoring defense.
    /// Typically used in final phases with increased damage but reduced defense.
    /// </summary>
    Enraged,

    /// <summary>
    /// Focus on summoning and supporting minions.
    /// Prioritizes summon abilities and minion-buffing effects.
    /// </summary>
    Summoner
}
```

---

## 5. SummonConfiguration Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SummonConfiguration.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Configuration for boss summoning abilities during a phase.
/// </summary>
/// <remarks>
/// Defines how a boss summons minions:
/// - What monster type to summon
/// - How many per summon attempt
/// - How often summons occur
/// - Maximum active summons allowed
/// </remarks>
public readonly record struct SummonConfiguration
{
    /// <summary>
    /// The monster definition ID to summon.
    /// </summary>
    /// <example>skeleton-warrior, goblin-minion</example>
    public string MonsterDefinitionId { get; init; }

    /// <summary>
    /// Number of monsters to summon per interval.
    /// </summary>
    public int Count { get; init; }

    /// <summary>
    /// Turns between summon attempts.
    /// </summary>
    /// <remarks>
    /// A value of 2 means the boss summons every other turn.
    /// </remarks>
    public int IntervalTurns { get; init; }

    /// <summary>
    /// Maximum number of active summons allowed.
    /// </summary>
    /// <remarks>
    /// Boss will not summon if this limit is reached.
    /// </remarks>
    public int MaxActive { get; init; }

    /// <summary>
    /// Creates a summon configuration with specified parameters.
    /// </summary>
    /// <param name="monsterId">The monster definition ID to summon.</param>
    /// <param name="count">Number per summon (default 1).</param>
    /// <param name="interval">Turns between summons (default 2).</param>
    /// <param name="maxActive">Maximum active summons (default 4).</param>
    /// <returns>A new SummonConfiguration.</returns>
    public static SummonConfiguration Create(
        string monsterId,
        int count = 1,
        int interval = 2,
        int maxActive = 4)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(monsterId);
        ArgumentOutOfRangeException.ThrowIfLessThan(count, 1);
        ArgumentOutOfRangeException.ThrowIfLessThan(interval, 1);
        ArgumentOutOfRangeException.ThrowIfLessThan(maxActive, 1);

        return new SummonConfiguration
        {
            MonsterDefinitionId = monsterId.ToLowerInvariant(),
            Count = count,
            IntervalTurns = interval,
            MaxActive = maxActive
        };
    }

    /// <summary>
    /// Gets whether this is a valid summon configuration.
    /// </summary>
    public bool IsValid => !string.IsNullOrWhiteSpace(MonsterDefinitionId)
                           && Count > 0
                           && IntervalTurns > 0
                           && MaxActive > 0;

    /// <inheritdoc />
    public override string ToString()
        => $"Summon {Count}x {MonsterDefinitionId} every {IntervalTurns} turns (max {MaxActive})";
}
```

---

## 6. BossLootEntry Value Object

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/BossLootEntry.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// A loot entry for boss drops with chance and optional quantity.
/// </summary>
/// <remarks>
/// Bosses have special loot tables with:
/// - Unique items with drop chances
/// - Currency with fixed amounts
/// - Guaranteed drops (chance = 1.0)
/// </remarks>
public readonly record struct BossLootEntry
{
    /// <summary>
    /// The item definition ID to drop.
    /// </summary>
    public string ItemId { get; init; }

    /// <summary>
    /// Fixed amount for currency/stackable items.
    /// </summary>
    /// <remarks>
    /// Null for single non-stackable items.
    /// </remarks>
    public int? Amount { get; init; }

    /// <summary>
    /// Drop chance as decimal (1.0 = guaranteed, 0.25 = 25%).
    /// </summary>
    public float Chance { get; init; }

    /// <summary>
    /// Gets whether this drop is guaranteed.
    /// </summary>
    public bool IsGuaranteed => Chance >= 1.0f;

    /// <summary>
    /// Creates a loot entry with item and chance.
    /// </summary>
    /// <param name="itemId">The item definition ID.</param>
    /// <param name="chance">Drop chance (0.0-1.0).</param>
    /// <param name="amount">Optional amount for stackables.</param>
    /// <returns>A new BossLootEntry.</returns>
    public static BossLootEntry Create(string itemId, float chance, int? amount = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(itemId);

        return new BossLootEntry
        {
            ItemId = itemId.ToLowerInvariant(),
            Chance = Math.Clamp(chance, 0f, 1f),
            Amount = amount
        };
    }

    /// <summary>
    /// Creates a guaranteed drop.
    /// </summary>
    /// <param name="itemId">The item definition ID.</param>
    /// <param name="amount">Optional amount for stackables.</param>
    /// <returns>A new guaranteed BossLootEntry.</returns>
    public static BossLootEntry Guaranteed(string itemId, int? amount = null)
        => Create(itemId, 1.0f, amount);

    /// <inheritdoc />
    public override string ToString()
        => Amount.HasValue
            ? $"{ItemId} x{Amount} ({Chance:P0})"
            : $"{ItemId} ({Chance:P0})";
}
```

---

## 7. BossPhase Entity

**File:** `src/Core/RuneAndRust.Domain/Definitions/BossPhase.cs`

```csharp
namespace RuneAndRust.Domain.Definitions;

using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// A single phase in a boss fight.
/// </summary>
/// <remarks>
/// Boss phases define:
/// - When the phase activates (health threshold)
/// - What abilities are available
/// - How the boss behaves (AI pattern)
/// - Stat modifications (enrage, vulnerability)
/// - Transition effects (announcements, environmental changes)
/// - Summoning configuration (if applicable)
/// </remarks>
public class BossPhase
{
    /// <summary>
    /// The phase number (1-based, ascending as boss health decreases).
    /// </summary>
    public int PhaseNumber { get; private set; }

    /// <summary>
    /// The display name for this phase.
    /// </summary>
    /// <example>Rise, Legion, Fury</example>
    public string Name { get; private set; } = null!;

    /// <summary>
    /// Optional description of this phase.
    /// </summary>
    public string? Description { get; private set; }

    /// <summary>
    /// Health percentage threshold for this phase (100 = full, 0 = death).
    /// </summary>
    /// <remarks>
    /// Phase activates when boss health percentage is at or below this threshold.
    /// Phase 1 typically has threshold 100 (always active at start).
    /// </remarks>
    public int HealthThreshold { get; private set; }

    /// <summary>
    /// Ability IDs available during this phase.
    /// </summary>
    public IReadOnlyList<string> AbilityIds { get; private set; } = [];

    /// <summary>
    /// AI behavior pattern for this phase.
    /// </summary>
    public BossBehavior Behavior { get; private set; } = BossBehavior.Aggressive;

    /// <summary>
    /// Stat multipliers for this phase.
    /// </summary>
    /// <remarks>
    /// Keys: "damage", "defense", "attackSpeed", etc.
    /// Values: Multipliers (1.0 = no change, 1.5 = +50%, 0.75 = -25%)
    /// </remarks>
    public IReadOnlyDictionary<string, float> StatModifiers { get; private set; }
        = new Dictionary<string, float>();

    /// <summary>
    /// Text displayed when transitioning to this phase.
    /// </summary>
    public string? TransitionText { get; private set; }

    /// <summary>
    /// Effect ID to trigger on phase transition.
    /// </summary>
    /// <example>knockback-all-2, create-lava-zones</example>
    public string? TransitionEffectId { get; private set; }

    /// <summary>
    /// Summon configuration for this phase (if boss summons minions).
    /// </summary>
    public SummonConfiguration? SummonConfig { get; private set; }

    /// <summary>
    /// Optional icon path for this phase.
    /// </summary>
    public string? IconPath { get; private set; }

    // Private constructor for JSON deserialization
    private BossPhase() { }

    /// <summary>
    /// Creates a new boss phase.
    /// </summary>
    /// <param name="phaseNumber">Phase number (1-based).</param>
    /// <param name="name">Display name.</param>
    /// <param name="healthThreshold">Health percentage threshold (0-100).</param>
    /// <param name="behavior">AI behavior pattern.</param>
    /// <returns>A new BossPhase instance.</returns>
    public static BossPhase Create(
        int phaseNumber,
        string name,
        int healthThreshold,
        BossBehavior behavior = BossBehavior.Aggressive)
    {
        ArgumentOutOfRangeException.ThrowIfLessThan(phaseNumber, 1);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentOutOfRangeException.ThrowIfLessThan(healthThreshold, 0);
        ArgumentOutOfRangeException.ThrowIfGreaterThan(healthThreshold, 100);

        return new BossPhase
        {
            PhaseNumber = phaseNumber,
            Name = name,
            HealthThreshold = healthThreshold,
            Behavior = behavior
        };
    }

    /// <summary>
    /// Sets the description for this phase.
    /// </summary>
    public BossPhase WithDescription(string description)
    {
        Description = description;
        return this;
    }

    /// <summary>
    /// Sets the abilities available in this phase.
    /// </summary>
    public BossPhase WithAbilities(IReadOnlyList<string> abilityIds)
    {
        AbilityIds = abilityIds;
        return this;
    }

    /// <summary>
    /// Sets stat modifiers for this phase.
    /// </summary>
    public BossPhase WithStatModifiers(IReadOnlyDictionary<string, float> modifiers)
    {
        StatModifiers = modifiers;
        return this;
    }

    /// <summary>
    /// Sets transition text for this phase.
    /// </summary>
    public BossPhase WithTransition(string? text, string? effectId = null)
    {
        TransitionText = text;
        TransitionEffectId = effectId;
        return this;
    }

    /// <summary>
    /// Sets summon configuration for this phase.
    /// </summary>
    public BossPhase WithSummonConfig(SummonConfiguration config)
    {
        SummonConfig = config;
        return this;
    }

    /// <summary>
    /// Sets the icon path for this phase.
    /// </summary>
    public BossPhase WithIcon(string iconPath)
    {
        IconPath = iconPath;
        return this;
    }

    /// <summary>
    /// Gets the stat modifier for a specific stat.
    /// </summary>
    /// <param name="statId">The stat ID (e.g., "damage", "defense").</param>
    /// <returns>The multiplier value, or 1.0 if not specified.</returns>
    public float GetStatModifier(string statId)
    {
        if (string.IsNullOrWhiteSpace(statId))
            return 1.0f;

        return StatModifiers.TryGetValue(statId.ToLowerInvariant(), out var modifier)
            ? modifier
            : 1.0f;
    }

    /// <summary>
    /// Gets whether this phase has transition effects.
    /// </summary>
    public bool HasTransition => TransitionText is not null || TransitionEffectId is not null;

    /// <summary>
    /// Gets whether this phase has summon configuration.
    /// </summary>
    public bool HasSummons => SummonConfig.HasValue && SummonConfig.Value.IsValid;
}
```

---

## 8. BossDefinition Entity

**File:** `src/Core/RuneAndRust.Domain/Definitions/BossDefinition.cs`

```csharp
namespace RuneAndRust.Domain.Definitions;

using RuneAndRust.Domain.Interfaces;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Data-driven boss encounter template loaded from configuration.
/// </summary>
/// <remarks>
/// Boss definitions extend the monster system with:
/// - Multi-phase encounters with health thresholds
/// - Phase-specific abilities and behaviors
/// - Transition effects and announcements
/// - Special loot tables
///
/// Bosses are spawned as enhanced monsters with phase tracking.
/// </remarks>
public class BossDefinition : IEntity
{
    /// <summary>
    /// Unique identifier for the entity.
    /// </summary>
    public Guid Id { get; private set; }

    /// <summary>
    /// Unique string identifier for this boss (kebab-case).
    /// </summary>
    /// <example>skeleton-king, volcanic-wyrm</example>
    public string BossId { get; private set; } = null!;

    /// <summary>
    /// Display name for the boss.
    /// </summary>
    public string Name { get; private set; } = null!;

    /// <summary>
    /// Description of the boss.
    /// </summary>
    public string Description { get; private set; } = null!;

    /// <summary>
    /// The base monster definition ID this boss is built upon.
    /// </summary>
    /// <remarks>
    /// Boss inherits base stats, appearance, etc. from this monster.
    /// </remarks>
    public string BaseMonsterDefinitionId { get; private set; } = null!;

    /// <summary>
    /// Title text displayed when the boss encounter begins.
    /// </summary>
    /// <example>"The Skeleton King Awakens!"</example>
    public string? TitleText { get; private set; }

    /// <summary>
    /// Phases for this boss, ordered by descending health threshold.
    /// </summary>
    public IReadOnlyList<BossPhase> Phases { get; private set; } = [];

    /// <summary>
    /// Loot table for this boss.
    /// </summary>
    public IReadOnlyList<BossLootEntry> Loot { get; private set; } = [];

    /// <summary>
    /// Optional icon path for the boss.
    /// </summary>
    public string? IconPath { get; private set; }

    // Private constructor for JSON deserialization
    private BossDefinition() { }

    /// <summary>
    /// Creates a new boss definition.
    /// </summary>
    /// <param name="bossId">Unique boss ID (kebab-case).</param>
    /// <param name="name">Display name.</param>
    /// <param name="description">Boss description.</param>
    /// <param name="baseMonsterDefinitionId">Base monster to inherit from.</param>
    /// <param name="phases">Boss phases (at least one required).</param>
    /// <returns>A new BossDefinition instance.</returns>
    /// <exception cref="ArgumentException">If required parameters are invalid.</exception>
    public static BossDefinition Create(
        string bossId,
        string name,
        string description,
        string baseMonsterDefinitionId,
        IEnumerable<BossPhase> phases)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(bossId);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentException.ThrowIfNullOrWhiteSpace(baseMonsterDefinitionId);

        var phaseList = phases?.ToList() ?? [];
        if (phaseList.Count == 0)
        {
            throw new ArgumentException("Boss must have at least one phase", nameof(phases));
        }

        // Validate phase numbers are unique
        var phaseNumbers = phaseList.Select(p => p.PhaseNumber).ToHashSet();
        if (phaseNumbers.Count != phaseList.Count)
        {
            throw new ArgumentException("Phase numbers must be unique", nameof(phases));
        }

        return new BossDefinition
        {
            Id = Guid.NewGuid(),
            BossId = bossId.ToLowerInvariant(),
            Name = name,
            Description = description,
            BaseMonsterDefinitionId = baseMonsterDefinitionId.ToLowerInvariant(),
            // Order phases by descending health threshold for lookup
            Phases = phaseList.OrderByDescending(p => p.HealthThreshold).ToList()
        };
    }

    /// <summary>
    /// Sets the title text for boss encounter start.
    /// </summary>
    public BossDefinition WithTitleText(string titleText)
    {
        TitleText = titleText;
        return this;
    }

    /// <summary>
    /// Sets the loot table for this boss.
    /// </summary>
    public BossDefinition WithLoot(IReadOnlyList<BossLootEntry> loot)
    {
        Loot = loot;
        return this;
    }

    /// <summary>
    /// Sets the icon path for this boss.
    /// </summary>
    public BossDefinition WithIcon(string iconPath)
    {
        IconPath = iconPath;
        return this;
    }

    /// <summary>
    /// Gets the appropriate phase for a given health percentage.
    /// </summary>
    /// <param name="healthPercent">Current health as percentage (0-100).</param>
    /// <returns>The active phase for this health level.</returns>
    /// <remarks>
    /// Returns the first phase where healthPercent is at or below the threshold.
    /// Since phases are ordered by descending threshold, this finds the correct phase.
    /// </remarks>
    public BossPhase GetPhaseForHealth(int healthPercent)
    {
        // Clamp to valid range
        healthPercent = Math.Clamp(healthPercent, 0, 100);

        // Find the first phase where health is at or below threshold
        // Phases are ordered descending by threshold: [100, 66, 33]
        // For health=50: 100 >= 50 (skip), 66 >= 50 (yes!) -> return phase 2
        foreach (var phase in Phases)
        {
            if (healthPercent <= phase.HealthThreshold)
            {
                // Continue to find the lowest applicable threshold
                continue;
            }
            else
            {
                // We've passed this threshold, return the previous one
                var index = Phases.ToList().IndexOf(phase);
                return index > 0 ? Phases[index - 1] : Phases[0];
            }
        }

        // Health is at or below lowest threshold, return last phase
        return Phases[^1];
    }

    /// <summary>
    /// Gets the starting phase (highest health threshold).
    /// </summary>
    /// <returns>The first phase of the boss fight.</returns>
    public BossPhase GetStartingPhase()
    {
        // Phases are ordered descending, so first is highest threshold
        return Phases[0];
    }

    /// <summary>
    /// Gets the total number of phases.
    /// </summary>
    public int PhaseCount => Phases.Count;

    /// <summary>
    /// Gets guaranteed loot drops.
    /// </summary>
    public IReadOnlyList<BossLootEntry> GetGuaranteedLoot()
        => Loot.Where(l => l.IsGuaranteed).ToList();

    /// <summary>
    /// Checks if this boss has a specific phase.
    /// </summary>
    /// <param name="phaseNumber">The phase number to check.</param>
    /// <returns>True if the phase exists.</returns>
    public bool HasPhase(int phaseNumber)
        => Phases.Any(p => p.PhaseNumber == phaseNumber);
}
```

---

## 9. IBossProvider Interface

**File:** `src/Core/RuneAndRust.Application/Interfaces/IBossProvider.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Definitions;

/// <summary>
/// Provides access to boss definitions from configuration.
/// </summary>
public interface IBossProvider
{
    /// <summary>
    /// Gets a boss definition by ID.
    /// </summary>
    /// <param name="bossId">The boss ID (case-insensitive).</param>
    /// <returns>The boss definition, or null if not found.</returns>
    BossDefinition? GetBoss(string bossId);

    /// <summary>
    /// Gets all boss definitions.
    /// </summary>
    /// <returns>All loaded boss definitions.</returns>
    IReadOnlyList<BossDefinition> GetAllBosses();

    /// <summary>
    /// Gets all available boss IDs.
    /// </summary>
    /// <returns>List of boss IDs.</returns>
    IReadOnlyList<string> GetBossIds();

    /// <summary>
    /// Checks if a boss definition exists.
    /// </summary>
    /// <param name="bossId">The boss ID to check.</param>
    /// <returns>True if the boss exists.</returns>
    bool BossExists(string bossId);

    /// <summary>
    /// Gets bosses with a specific number of phases.
    /// </summary>
    /// <param name="phaseCount">Number of phases to filter by.</param>
    /// <returns>Bosses matching the phase count.</returns>
    IReadOnlyList<BossDefinition> GetBossesByPhaseCount(int phaseCount);
}
```

---

## 10. BossProvider Implementation

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Providers/BossProvider.cs`

```csharp
namespace RuneAndRust.Infrastructure.Providers;

using System.Text.Json;
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Definitions;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Provides boss definitions from JSON configuration.
/// </summary>
public class BossProvider : IBossProvider
{
    private readonly Dictionary<string, BossDefinition> _bosses = new(StringComparer.OrdinalIgnoreCase);
    private readonly ILogger<BossProvider> _logger;

    /// <summary>
    /// Creates a new BossProvider.
    /// </summary>
    /// <param name="configPath">Path to configuration directory.</param>
    /// <param name="logger">Logger instance.</param>
    public BossProvider(string configPath, ILogger<BossProvider> logger)
    {
        _logger = logger;
        LoadBosses(configPath);
    }

    private void LoadBosses(string configPath)
    {
        var filePath = Path.Combine(configPath, "bosses.json");

        if (!File.Exists(filePath))
        {
            _logger.LogWarning("Boss configuration file not found: {Path}", filePath);
            return;
        }

        try
        {
            var json = File.ReadAllText(filePath);
            var config = JsonSerializer.Deserialize<BossesConfigDto>(json, new JsonSerializerOptions
            {
                PropertyNameCaseInsensitive = true
            });

            if (config?.Bosses is null)
            {
                _logger.LogWarning("No bosses found in configuration");
                return;
            }

            foreach (var bossDto in config.Bosses)
            {
                try
                {
                    var definition = MapToDefinition(bossDto);
                    _bosses[definition.BossId] = definition;
                }
                catch (Exception ex)
                {
                    _logger.LogWarning(ex, "Failed to load boss: {BossId}", bossDto.BossId);
                }
            }

            _logger.LogInformation("Loaded {Count} boss definitions", _bosses.Count);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "Failed to load boss configuration from {Path}", filePath);
        }
    }

    private static BossDefinition MapToDefinition(BossDto dto)
    {
        var phases = dto.Phases.Select(MapPhase).ToList();

        var definition = BossDefinition.Create(
            dto.BossId,
            dto.Name,
            dto.Description,
            dto.BaseMonsterDefinitionId,
            phases);

        if (!string.IsNullOrEmpty(dto.TitleText))
            definition.WithTitleText(dto.TitleText);

        if (dto.Loot?.Count > 0)
        {
            var lootEntries = dto.Loot.Select(l => BossLootEntry.Create(
                l.ItemId,
                l.Chance,
                l.Amount)).ToList();
            definition.WithLoot(lootEntries);
        }

        if (!string.IsNullOrEmpty(dto.Icon))
            definition.WithIcon(dto.Icon);

        return definition;
    }

    private static BossPhase MapPhase(BossPhaseDto dto)
    {
        var behavior = Enum.TryParse<BossBehavior>(dto.Behavior, true, out var b)
            ? b
            : BossBehavior.Aggressive;

        var phase = BossPhase.Create(
            dto.PhaseNumber,
            dto.Name,
            dto.HealthThreshold,
            behavior);

        if (!string.IsNullOrEmpty(dto.Description))
            phase.WithDescription(dto.Description);

        if (dto.AbilityIds?.Count > 0)
            phase.WithAbilities(dto.AbilityIds);

        if (dto.StatModifiers?.Count > 0)
            phase.WithStatModifiers(dto.StatModifiers);

        if (!string.IsNullOrEmpty(dto.TransitionText) || !string.IsNullOrEmpty(dto.TransitionEffectId))
            phase.WithTransition(dto.TransitionText, dto.TransitionEffectId);

        if (dto.SummonConfig is not null)
        {
            var summonConfig = SummonConfiguration.Create(
                dto.SummonConfig.MonsterDefinitionId,
                dto.SummonConfig.Count,
                dto.SummonConfig.IntervalTurns,
                dto.SummonConfig.MaxActive);
            phase.WithSummonConfig(summonConfig);
        }

        if (!string.IsNullOrEmpty(dto.Icon))
            phase.WithIcon(dto.Icon);

        return phase;
    }

    /// <inheritdoc />
    public BossDefinition? GetBoss(string bossId)
    {
        if (string.IsNullOrWhiteSpace(bossId))
            return null;

        return _bosses.GetValueOrDefault(bossId);
    }

    /// <inheritdoc />
    public IReadOnlyList<BossDefinition> GetAllBosses()
        => _bosses.Values.ToList();

    /// <inheritdoc />
    public IReadOnlyList<string> GetBossIds()
        => _bosses.Keys.ToList();

    /// <inheritdoc />
    public bool BossExists(string bossId)
        => !string.IsNullOrWhiteSpace(bossId) && _bosses.ContainsKey(bossId);

    /// <inheritdoc />
    public IReadOnlyList<BossDefinition> GetBossesByPhaseCount(int phaseCount)
        => _bosses.Values.Where(b => b.PhaseCount == phaseCount).ToList();

    #region DTOs

    private class BossesConfigDto
    {
        public List<BossDto> Bosses { get; set; } = [];
    }

    private class BossDto
    {
        public string BossId { get; set; } = null!;
        public string Name { get; set; } = null!;
        public string Description { get; set; } = null!;
        public string BaseMonsterDefinitionId { get; set; } = null!;
        public string? TitleText { get; set; }
        public List<BossPhaseDto> Phases { get; set; } = [];
        public List<LootEntryDto>? Loot { get; set; }
        public string? Icon { get; set; }
    }

    private class BossPhaseDto
    {
        public int PhaseNumber { get; set; }
        public string Name { get; set; } = null!;
        public string? Description { get; set; }
        public int HealthThreshold { get; set; }
        public List<string>? AbilityIds { get; set; }
        public string Behavior { get; set; } = "Aggressive";
        public Dictionary<string, float>? StatModifiers { get; set; }
        public string? TransitionText { get; set; }
        public string? TransitionEffectId { get; set; }
        public SummonConfigDto? SummonConfig { get; set; }
        public string? Icon { get; set; }
    }

    private class SummonConfigDto
    {
        public string MonsterDefinitionId { get; set; } = null!;
        public int Count { get; set; } = 1;
        public int IntervalTurns { get; set; } = 2;
        public int MaxActive { get; set; } = 4;
    }

    private class LootEntryDto
    {
        public string ItemId { get; set; } = null!;
        public int? Amount { get; set; }
        public float Chance { get; set; } = 1.0f;
    }

    #endregion
}
```

---

## 11. Configuration Schema

**File:** `config/schemas/bosses.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Boss Definitions",
  "description": "Schema for boss encounter definitions",
  "type": "object",
  "required": ["bosses"],
  "properties": {
    "$schema": {
      "type": "string"
    },
    "bosses": {
      "type": "array",
      "description": "Array of boss definitions",
      "items": {
        "$ref": "#/definitions/boss"
      }
    }
  },
  "definitions": {
    "boss": {
      "type": "object",
      "required": ["bossId", "name", "description", "baseMonsterDefinitionId", "phases"],
      "properties": {
        "bossId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique boss identifier (kebab-case)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Display name"
        },
        "description": {
          "type": "string",
          "description": "Boss description"
        },
        "baseMonsterDefinitionId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Base monster definition ID"
        },
        "titleText": {
          "type": "string",
          "description": "Text shown when encounter starts"
        },
        "phases": {
          "type": "array",
          "minItems": 1,
          "description": "Boss phases",
          "items": {
            "$ref": "#/definitions/phase"
          }
        },
        "loot": {
          "type": "array",
          "description": "Loot table",
          "items": {
            "$ref": "#/definitions/lootEntry"
          }
        },
        "icon": {
          "type": "string",
          "description": "Icon path"
        }
      }
    },
    "phase": {
      "type": "object",
      "required": ["phaseNumber", "name", "healthThreshold"],
      "properties": {
        "phaseNumber": {
          "type": "integer",
          "minimum": 1,
          "description": "Phase number (1-based)"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Phase name"
        },
        "description": {
          "type": "string",
          "description": "Phase description"
        },
        "healthThreshold": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Health percentage threshold"
        },
        "abilityIds": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Abilities available in this phase"
        },
        "behavior": {
          "type": "string",
          "enum": ["Aggressive", "Tactical", "Defensive", "Enraged", "Summoner"],
          "default": "Aggressive",
          "description": "AI behavior pattern"
        },
        "statModifiers": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          },
          "description": "Stat multipliers (e.g., damage: 1.5)"
        },
        "transitionText": {
          "type": "string",
          "description": "Text shown on phase transition"
        },
        "transitionEffectId": {
          "type": "string",
          "description": "Effect to trigger on transition"
        },
        "summonConfig": {
          "$ref": "#/definitions/summonConfig"
        },
        "icon": {
          "type": "string",
          "description": "Phase icon path"
        }
      }
    },
    "summonConfig": {
      "type": "object",
      "required": ["monsterDefinitionId"],
      "properties": {
        "monsterDefinitionId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Monster type to summon"
        },
        "count": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Number per summon"
        },
        "intervalTurns": {
          "type": "integer",
          "minimum": 1,
          "default": 2,
          "description": "Turns between summons"
        },
        "maxActive": {
          "type": "integer",
          "minimum": 1,
          "default": 4,
          "description": "Maximum active summons"
        }
      }
    },
    "lootEntry": {
      "type": "object",
      "required": ["itemId", "chance"],
      "properties": {
        "itemId": {
          "type": "string",
          "description": "Item definition ID"
        },
        "amount": {
          "type": "integer",
          "minimum": 1,
          "description": "Amount for stackables"
        },
        "chance": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Drop chance (0.0-1.0)"
        }
      }
    }
  }
}
```

---

## 12. Configuration File

**File:** `config/bosses.json`

```json
{
  "$schema": "./schemas/bosses.schema.json",
  "bosses": [
    {
      "bossId": "skeleton-king",
      "name": "Skeleton King",
      "description": "The undead lord of the crypt, awakened from eternal slumber.",
      "baseMonsterDefinitionId": "skeleton-lord",
      "titleText": "The Skeleton King Awakens!",
      "phases": [
        {
          "phaseNumber": 1,
          "name": "Rise",
          "description": "The king awakens from his slumber",
          "healthThreshold": 100,
          "abilityIds": ["bone-strike", "soul-drain"],
          "behavior": "Aggressive"
        },
        {
          "phaseNumber": 2,
          "name": "Legion",
          "description": "The king calls forth his minions",
          "healthThreshold": 66,
          "abilityIds": ["bone-strike", "summon-skeletons", "dark-shield"],
          "behavior": "Summoner",
          "summonConfig": {
            "monsterDefinitionId": "skeleton-warrior",
            "count": 2,
            "intervalTurns": 2,
            "maxActive": 4
          },
          "transitionText": "The Skeleton King raises his arms! Bones rise from the ground!",
          "transitionEffectId": "knockback-all-2"
        },
        {
          "phaseNumber": 3,
          "name": "Fury",
          "description": "The king enters a rage",
          "healthThreshold": 33,
          "abilityIds": ["bone-strike", "soul-drain", "death-nova"],
          "behavior": "Enraged",
          "statModifiers": {
            "damage": 1.5,
            "attackSpeed": 1.25,
            "defense": 0.75
          },
          "transitionText": "The Skeleton King's eyes blaze with unholy fury!"
        }
      ],
      "loot": [
        { "itemId": "crown-of-bones", "chance": 0.25 },
        { "itemId": "soul-gem", "chance": 0.5 },
        { "itemId": "gold", "amount": 500, "chance": 1.0 }
      ],
      "icon": "icons/bosses/skeleton-king.png"
    },
    {
      "bossId": "volcanic-wyrm",
      "name": "Volcanic Wyrm",
      "description": "An ancient dragon of fire that dwells in the mountain depths.",
      "baseMonsterDefinitionId": "fire-dragon",
      "titleText": "The Wyrm Descends!",
      "phases": [
        {
          "phaseNumber": 1,
          "name": "Descent",
          "description": "The wyrm descends from the volcanic peaks",
          "healthThreshold": 100,
          "abilityIds": ["fire-breath", "claw-attack", "wing-buffet"],
          "behavior": "Aggressive"
        },
        {
          "phaseNumber": 2,
          "name": "Inferno",
          "description": "The wyrm unleashes volcanic fury",
          "healthThreshold": 50,
          "abilityIds": ["fire-breath", "meteor-storm", "lava-pool"],
          "behavior": "Tactical",
          "transitionText": "The Wyrm roars! The ground cracks with molten fury!",
          "transitionEffectId": "create-lava-zones"
        },
        {
          "phaseNumber": 3,
          "name": "Desperation",
          "description": "The wyrm fights with desperate fury",
          "healthThreshold": 20,
          "abilityIds": ["fire-breath", "meteor-storm", "supernova"],
          "behavior": "Enraged",
          "statModifiers": {
            "damage": 2.0,
            "defense": 0.5
          },
          "transitionText": "The Wyrm prepares to unleash its final fury!"
        }
      ],
      "loot": [
        { "itemId": "dragon-scale", "chance": 0.75 },
        { "itemId": "fire-heart", "chance": 0.33 },
        { "itemId": "gold", "amount": 750, "chance": 1.0 }
      ],
      "icon": "icons/bosses/volcanic-wyrm.png"
    },
    {
      "bossId": "shadow-lich",
      "name": "Shadow Lich",
      "description": "A powerful undead sorcerer commanding dark magic.",
      "baseMonsterDefinitionId": "lich",
      "titleText": "The Shadow Lich Emerges!",
      "phases": [
        {
          "phaseNumber": 1,
          "name": "Arcane",
          "description": "The lich wields devastating arcane power",
          "healthThreshold": 100,
          "abilityIds": ["shadow-bolt", "curse-of-weakness", "dark-barrier"],
          "behavior": "Tactical"
        },
        {
          "phaseNumber": 2,
          "name": "Necrotic",
          "description": "The lich calls upon forbidden death magic",
          "healthThreshold": 40,
          "abilityIds": ["shadow-bolt", "soul-siphon", "raise-dead", "death-coil"],
          "behavior": "Summoner",
          "summonConfig": {
            "monsterDefinitionId": "shadow-wraith",
            "count": 1,
            "intervalTurns": 3,
            "maxActive": 2
          },
          "statModifiers": {
            "damage": 1.3
          },
          "transitionText": "The Lich's form shifts into pure shadow! Death magic surges forth!"
        }
      ],
      "loot": [
        { "itemId": "lich-phylactery", "chance": 0.15 },
        { "itemId": "tome-of-shadows", "chance": 0.4 },
        { "itemId": "shadow-essence", "amount": 3, "chance": 1.0 }
      ],
      "icon": "icons/bosses/shadow-lich.png"
    },
    {
      "bossId": "orc-warlord",
      "name": "Grimjaw the Warlord",
      "description": "A brutal orc chieftain who has never known defeat.",
      "baseMonsterDefinitionId": "orc-chieftain",
      "titleText": "Grimjaw Challenges You!",
      "phases": [
        {
          "phaseNumber": 1,
          "name": "Challenge",
          "description": "The warlord tests your strength",
          "healthThreshold": 100,
          "abilityIds": ["cleave", "battle-cry", "shield-bash"],
          "behavior": "Aggressive"
        },
        {
          "phaseNumber": 2,
          "name": "Bloodrage",
          "description": "Wounded pride fuels unstoppable rage",
          "healthThreshold": 35,
          "abilityIds": ["cleave", "whirlwind", "execute"],
          "behavior": "Enraged",
          "statModifiers": {
            "damage": 1.75,
            "attackSpeed": 1.5,
            "defense": 0.6
          },
          "transitionText": "Grimjaw bellows with rage! BLOOD FOR THE WARBAND!"
        }
      ],
      "loot": [
        { "itemId": "warlord-axe", "chance": 0.3 },
        { "itemId": "battle-trophy", "chance": 0.6 },
        { "itemId": "gold", "amount": 400, "chance": 1.0 }
      ],
      "icon": "icons/bosses/orc-warlord.png"
    }
  ]
}
```

---

## 13. Unit Testing Requirements

### Test Count by Feature

| Feature | Tests |
|---------|-------|
| BossDefinition.Create validation | 3 |
| BossDefinition.GetPhaseForHealth | 3 |
| BossPhase.GetStatModifier | 2 |
| BossPhase.HasTransition | 1 |
| BossProvider methods | 3 |
| **Total** | **~12** |

### Test Specifications

**File:** `tests/RuneAndRust.Domain.UnitTests/Definitions/BossDefinitionTests.cs`

```csharp
[TestFixture]
public class BossDefinitionTests
{
    // ===== Factory Method Validation Tests =====

    [Test]
    public void Create_WithValidParameters_ReturnsBossDefinition()
    {
        // Arrange
        var phases = new[] { BossPhase.Create(1, "Phase 1", 100) };

        // Act
        var boss = BossDefinition.Create(
            "test-boss",
            "Test Boss",
            "A test boss",
            "base-monster",
            phases);

        // Assert
        boss.Should().NotBeNull();
        boss.BossId.Should().Be("test-boss");
        boss.Name.Should().Be("Test Boss");
        boss.BaseMonsterDefinitionId.Should().Be("base-monster");
        boss.PhaseCount.Should().Be(1);
    }

    [Test]
    public void Create_WithEmptyBossId_ThrowsArgumentException()
    {
        // Arrange
        var phases = new[] { BossPhase.Create(1, "Phase 1", 100) };

        // Act
        var act = () => BossDefinition.Create("", "Test", "Desc", "base", phases);

        // Assert
        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void Create_WithNoPhases_ThrowsArgumentException()
    {
        // Act
        var act = () => BossDefinition.Create(
            "test-boss", "Test", "Desc", "base",
            Enumerable.Empty<BossPhase>());

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*at least one phase*");
    }

    // ===== GetPhaseForHealth Tests =====

    [Test]
    public void GetPhaseForHealth_AtFullHealth_ReturnsFirstPhase()
    {
        // Arrange
        var phases = new[]
        {
            BossPhase.Create(1, "Phase 1", 100),
            BossPhase.Create(2, "Phase 2", 50)
        };
        var boss = BossDefinition.Create("test", "Test", "Desc", "base", phases);

        // Act
        var phase = boss.GetPhaseForHealth(100);

        // Assert
        phase.PhaseNumber.Should().Be(1);
        phase.Name.Should().Be("Phase 1");
    }

    [Test]
    public void GetPhaseForHealth_AtExactThreshold_ReturnsCorrectPhase()
    {
        // Arrange
        var phases = new[]
        {
            BossPhase.Create(1, "Phase 1", 100),
            BossPhase.Create(2, "Phase 2", 50)
        };
        var boss = BossDefinition.Create("test", "Test", "Desc", "base", phases);

        // Act
        var phase = boss.GetPhaseForHealth(50);

        // Assert
        phase.PhaseNumber.Should().Be(2);
    }

    [Test]
    public void GetPhaseForHealth_BelowLowestThreshold_ReturnsLastPhase()
    {
        // Arrange
        var phases = new[]
        {
            BossPhase.Create(1, "Phase 1", 100),
            BossPhase.Create(2, "Phase 2", 66),
            BossPhase.Create(3, "Phase 3", 33)
        };
        var boss = BossDefinition.Create("test", "Test", "Desc", "base", phases);

        // Act
        var phase = boss.GetPhaseForHealth(10);

        // Assert
        phase.PhaseNumber.Should().Be(3);
        phase.Name.Should().Be("Phase 3");
    }
}
```

**File:** `tests/RuneAndRust.Domain.UnitTests/Definitions/BossPhaseTests.cs`

```csharp
[TestFixture]
public class BossPhaseTests
{
    // ===== GetStatModifier Tests =====

    [Test]
    public void GetStatModifier_WithConfiguredValue_ReturnsValue()
    {
        // Arrange
        var phase = BossPhase.Create(1, "Fury", 33, BossBehavior.Enraged)
            .WithStatModifiers(new Dictionary<string, float>
            {
                { "damage", 1.5f },
                { "defense", 0.75f }
            });

        // Act & Assert
        phase.GetStatModifier("damage").Should().Be(1.5f);
        phase.GetStatModifier("defense").Should().Be(0.75f);
    }

    [Test]
    public void GetStatModifier_WithMissingKey_ReturnsDefaultOne()
    {
        // Arrange
        var phase = BossPhase.Create(1, "Phase 1", 100);

        // Act
        var modifier = phase.GetStatModifier("damage");

        // Assert
        modifier.Should().Be(1.0f);
    }

    // ===== HasTransition Tests =====

    [Test]
    public void HasTransition_WithTransitionText_ReturnsTrue()
    {
        // Arrange
        var phase = BossPhase.Create(2, "Phase 2", 50)
            .WithTransition("Boss enters rage mode!", null);

        // Act & Assert
        phase.HasTransition.Should().BeTrue();
    }
}
```

**File:** `tests/RuneAndRust.Infrastructure.UnitTests/Providers/BossProviderTests.cs`

```csharp
[TestFixture]
public class BossProviderTests
{
    private BossProvider _provider = null!;

    [SetUp]
    public void Setup()
    {
        var logger = new Mock<ILogger<BossProvider>>().Object;
        _provider = new BossProvider("config", logger);
    }

    [Test]
    public void GetBoss_WithValidId_ReturnsDefinition()
    {
        // Act
        var boss = _provider.GetBoss("skeleton-king");

        // Assert
        boss.Should().NotBeNull();
        boss!.Name.Should().Be("Skeleton King");
    }

    [Test]
    public void GetBoss_WithInvalidId_ReturnsNull()
    {
        // Act
        var boss = _provider.GetBoss("nonexistent-boss");

        // Assert
        boss.Should().BeNull();
    }

    [Test]
    public void GetAllBosses_ReturnsLoadedBosses()
    {
        // Act
        var bosses = _provider.GetAllBosses();

        // Assert
        bosses.Should().NotBeEmpty();
        bosses.Should().Contain(b => b.BossId == "skeleton-king");
    }
}
```

---

## 14. Use Cases

### UC-001: Load Boss Configuration

**Actor:** System (startup)
**Flow:** Application starts → BossProvider instantiated → Reads bosses.json → Parses boss definitions → Validates phases (threshold ordering, unique numbers) → Caches definitions in dictionary → Logs loaded count

### UC-002: Retrieve Boss Definition

**Actor:** BossMechanicsService (v0.10.4b)
**Flow:** Service requests boss by ID → IBossProvider.GetBoss(bossId) called → Case-insensitive lookup in cache → Returns BossDefinition or null if not found

### UC-003: Determine Current Phase by Health

**Actor:** BossMechanicsService (v0.10.4b)
**Flow:** Boss takes damage → Calculate health percentage → Call BossDefinition.GetPhaseForHealth(percent) → Returns appropriate BossPhase based on thresholds

### UC-004: Get Phase Abilities

**Actor:** AI Service
**Flow:** Need boss abilities for AI decision → Get current BossPhase → Read AbilityIds list → Filter by cooldowns/availability → Select ability for execution

### UC-005: Get Phase Transition Info

**Actor:** Combat Renderer (v0.10.4b)
**Flow:** Phase changes detected → Check BossPhase.HasTransition → Read TransitionText for display → Read TransitionEffectId for effect execution → Display announcement and trigger effects

---

## 15. Deliverable Checklist

### Domain Layer

- [ ] `BossBehavior` enum created at `src/Core/RuneAndRust.Domain/Enums/BossBehavior.cs`
- [ ] `SummonConfiguration` value object created at `src/Core/RuneAndRust.Domain/ValueObjects/SummonConfiguration.cs`
- [ ] `BossLootEntry` value object created at `src/Core/RuneAndRust.Domain/ValueObjects/BossLootEntry.cs`
- [ ] `BossPhase` entity created at `src/Core/RuneAndRust.Domain/Definitions/BossPhase.cs`
- [ ] `BossDefinition` entity created at `src/Core/RuneAndRust.Domain/Definitions/BossDefinition.cs`
- [ ] All entities have complete XML documentation

### Application Layer

- [ ] `IBossProvider` interface created at `src/Core/RuneAndRust.Application/Interfaces/IBossProvider.cs`
- [ ] Interface has 5 methods (GetBoss, GetAllBosses, GetBossIds, BossExists, GetBossesByPhaseCount)

### Infrastructure Layer

- [ ] `BossProvider` implementation created at `src/Infrastructure/RuneAndRust.Infrastructure/Providers/BossProvider.cs`
- [ ] JSON loading and parsing implemented
- [ ] Phase validation implemented
- [ ] Logging integrated

### Configuration

- [ ] `config/bosses.json` created with 4 example bosses
- [ ] `config/schemas/bosses.schema.json` created
- [ ] JSON validates against schema
- [ ] Example bosses cover different phase counts (2-3 phases)
- [ ] Example bosses cover different behaviors (Aggressive, Tactical, Summoner, Enraged)

### Testing

- [ ] `BossDefinitionTests.cs` created (~6 tests)
- [ ] `BossPhaseTests.cs` created (~3 tests)
- [ ] `BossProviderTests.cs` created (~3 tests)
- [ ] All ~12 tests passing

### Documentation

- [ ] Design specification complete (this document)
- [ ] All code snippets include file paths

---

## 16. Acceptance Criteria

### Functional

- [ ] BossDefinition loads from JSON configuration file
- [ ] BossDefinition requires at least one phase (validation)
- [ ] BossDefinition.BossId is normalized to lowercase
- [ ] BossPhase defines health threshold as percentage (0-100)
- [ ] Phases are ordered by descending health threshold internally
- [ ] GetPhaseForHealth returns correct phase for any health value (0-100)
- [ ] GetPhaseForHealth handles exact threshold values correctly
- [ ] GetStartingPhase returns highest threshold phase
- [ ] Phase abilities specified as list of ability IDs
- [ ] Phase behaviors define AI pattern via BossBehavior enum
- [ ] StatModifiers dictionary supports any stat key with float multipliers
- [ ] TransitionText is optional per phase
- [ ] TransitionEffectId is optional per phase
- [ ] SummonConfiguration is optional per phase
- [ ] SummonConfiguration specifies monster ID, count, interval, and max active
- [ ] Loot table defines item drops with chances (0.0-1.0)
- [ ] Base monster definition referenced by ID (not validated in this version)
- [ ] IBossProvider.GetBoss returns definition or null (case-insensitive)
- [ ] IBossProvider.GetAllBosses returns all loaded definitions
- [ ] IBossProvider.BossExists returns correct boolean

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~12 unit tests pass
- [ ] bosses.json validates against bosses.schema.json
- [ ] XML documentation complete on all public members
- [ ] Follows existing Definition pattern (StatusEffectDefinition)
- [ ] Private constructors for JSON deserialization
- [ ] Static Create factory methods with validation
- [ ] Fluent With* methods for optional properties

---

## 17. Dependencies

### Required From

| Layer | Dependency | Usage |
|-------|------------|-------|
| Domain | `IEntity` interface | BossDefinition implements |
| Infrastructure | File system access | JSON loading |
| Infrastructure | `System.Text.Json` | JSON parsing |
| Infrastructure | `ILogger<T>` | Diagnostic logging |

### Provides To

| Consumer | Dependency | Usage |
|----------|------------|-------|
| v0.10.4b | `IBossProvider` | Boss mechanics service |
| v0.10.4b | `BossDefinition` | Phase transition logic |
| v0.10.4b | `BossPhase` | Ability and behavior lookup |
| Future | Boss spawning | Encounter room integration |

---

## 18. Future Considerations

### Deferred to v0.10.4b

- **Phase Transition Logic**: Actual execution of phase changes when boss health drops below threshold
- **IBossMechanicsService**: Service for managing active boss state and transitions
- **Enrage Mechanics**: Time-based or phase-based automatic enrage activation
- **Vulnerability Windows**: Timing windows where boss takes increased damage
- **Transition Effect Execution**: Knockback, summon, environmental effect implementation

### Out of Scope for v0.10.4

- **Boss Spawning Integration**: Encounter room boss spawning mechanics
- **Boss AI Enhancement**: Complex multi-phase decision trees
- **Boss Audio/Visual**: Boss-specific sound effects and visual effects
- **Boss Difficulty Scaling**: Dynamic difficulty adjustment for bosses

### Potential Enhancements (Future Versions)

- **Phase Interrupts**: Abilities that can skip or reverse phases
- **Multi-Boss Encounters**: Multiple bosses with shared phase mechanics
- **Boss Immunities**: Phase-specific damage immunities
- **Boss Dialogue**: Phase-specific voice lines or dialogue

---

## Logging Specifications

### Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `BossProvider` | Information | Loaded boss count |
| `BossProvider` | Warning | Configuration file not found |
| `BossProvider` | Warning | Individual boss parse failure |
| `BossProvider` | Error | Configuration load failure |

### Log Message Examples

```
[Information] Loaded 4 boss definitions
[Warning] Boss configuration file not found: config/bosses.json
[Warning] Failed to load boss: skeleton-king - Invalid phase configuration
[Error] Failed to load boss configuration from config/bosses.json
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
