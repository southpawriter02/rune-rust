# v0.13.3 Crafting UI - Scope Breakdown

**Version:** 0.13.3
**Theme:** Crafting UI
**Prerequisites:** v0.13.2 Complete (Ability Tree UI), v0.11.x Crafting Services Complete
**Total Estimated Tests:** ~25 new tests

---

## Executive Summary

The Crafting UI version implements all crafting-related UI components that were deferred during v0.11.x development. This includes resource inventory panel, crafting station interface, recipe browser with search/filter, recipe discovery tracking, and gathering display for harvestable resources. These components visualize the crafting and resource systems introduced in v0.11.x without introducing any new domain logic or business rules.

The work is divided into **four sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.3a | Resource Inventory Panel | Resource display, stacks, type icons, filtering | ~6 |
| v0.13.3b | Crafting Station Interface | Station menu, recipe list, material availability | ~8 |
| v0.13.3c | Recipe Browser & Details | Search, filter, recipe details, quality display | ~6 |
| v0.13.3d | Gathering Display | Harvestable indicators, dice check, yield display | ~5 |

---

## Feature Analysis & Categorization

### From v0.13.0-overview.md - v0.11.x Crafting & Resources UI

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Resource Inventory Panel | Medium | IResourceService | **v0.13.3a** |
| Resource Stack Display | Low | Resource data | **v0.13.3a** |
| Resource Type Icons | Low | ResourceType enum | **v0.13.3a** |
| Crafting Station Menu | Medium | ICraftingService | **v0.13.3b** |
| Recipe Browser | Medium | RecipeDefinition | **v0.13.3c** |
| Recipe Details View | Medium | RecipeDefinition | **v0.13.3c** |
| Material Availability | Low | IResourceService | **v0.13.3b** |
| Crafting Progress | Low | ICraftingService | **v0.13.3b** |
| Quality Result Display | Low | CraftingResult | **v0.13.3c** |
| Recipe Book | Medium | Recipe discovery data | **v0.13.3c** |
| New Recipe Notification | Low | Discovery events | **v0.13.3c** |
| Recipe Unlock Progress | Low | Discovery progress | **v0.13.3c** |
| Harvestable Indicators | Medium | IGatheringService | **v0.13.3d** |
| Gathering Dice Check Display | Medium | Dice roll data | **v0.13.3d** |
| Yield Display | Low | Gathering result | **v0.13.3d** |

---

## Existing Infrastructure

### From v0.11.x (Required Services)

| Component | Location | Purpose for v0.13.3 |
|-----------|----------|---------------------|
| `IResourceService` | `Application/Interfaces/IResourceService.cs` | Retrieve player resources and quantities |
| `ICraftingService` | `Application/Interfaces/ICraftingService.cs` | Retrieve recipes, craft items |
| `IGatheringService` | `Application/Interfaces/IGatheringService.cs` | Retrieve harvestables, perform gathering |
| `ResourceDefinition` | `Domain/Entities/ResourceDefinition.cs` | Resource templates with type and properties |
| `RecipeDefinition` | `Domain/Entities/RecipeDefinition.cs` | Recipe templates with materials and output |

### From v0.7.x-v0.8.x (Existing UI Infrastructure)

| Component | Location | Purpose for v0.13.3 |
|-----------|----------|---------------------|
| `InventoryView` | `Presentation.Tui/Views/InventoryView.cs` | Integration point for resource panel |
| `RoomView` | `Presentation.Tui/Views/RoomView.cs` | Integration point for gathering display |
| `ITerminalService` | `Presentation.Tui/Services/ITerminalService.cs` | Terminal output abstraction |

---

## Phase Definitions

---

## v0.13.3a: Resource Inventory Panel

[v0.13.3a Design Specification](v0.13.3a-design-specification.md)

### Overview

Implement the resource inventory panel showing the player's collected resources organized by type. The panel displays resource stacks with quantities, type icons, and filtering capabilities.

### Scope

**In Scope:**
- Resource inventory panel with categorized display
- Resource stack display with quantities
- Resource type icons (ore, herb, leather, gem, misc)
- Filter tabs for resource types

**Out of Scope:**
- Crafting station interface (v0.13.3b)
- Recipe browser (v0.13.3c)
- Gathering display (v0.13.3d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 1 | `ResourceInventoryPanel` |
| Renderers | 1 | `ResourceStackRenderer` |
| View Updates | 1 | `InventoryView` integration |
| Unit Tests | ~6 | Panel display, filtering, stack tests |

### Data Model Changes

```
NEW: ResourceInventoryPanel (UI Component)
|-- RenderResources(IEnumerable<PlayerResource>): void
|-- RenderResourcesByType(ResourceType): void
|-- SetFilter(ResourceType?): void
+-- ShowResourceDetails(PlayerResource): void

NEW: ResourceStackRenderer (Renderer)
|-- FormatStack(PlayerResource): string
|-- GetTypeIcon(ResourceType): string
|-- GetTypeColor(ResourceType): ConsoleColor
+-- FormatQuantity(int): string
```

### User-Facing Changes

**Resource Panel Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│                       RESOURCES                                      │
├─────────────────────────────────────────────────────────────────────┤
│  Filter: [All] [Ore] [Herb] [Leather] [Gem] [Misc]                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ORE                     HERBS                   LEATHER            │
│  ───                     ─────                   ───────            │
│  [O] Iron Ore      x24   [H] Healing Herb   x15  [L] Leather     x8 │
│  [O] Silver Ore    x12   [H] Mana Bloom     x7   [L] Thick Hide  x5 │
│  [O] Gold Ore      x3    [H] Fire Blossom   x4   [L] Dragon Scale x1│
│                          [H] Frost Lily     x2                       │
│                                                                      │
│  GEMS                    MISC                                        │
│  ────                    ────                                        │
│  [G] Ruby           x5   [M] Enchanting Dust x12                     │
│  [G] Sapphire       x3   [M] Magic Essence   x8                      │
│  [G] Emerald        x2                                               │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**Type Icons:**
- `[O]` Ore (gray/brown)
- `[H]` Herb (green)
- `[L]` Leather (brown)
- `[G]` Gem (cyan)
- `[M]` Misc (white)

### Acceptance Criteria

- [ ] Resource inventory panel displays all resources
- [ ] Resources grouped by type
- [ ] Resource stacks show correct quantities
- [ ] Resource type icons display correctly
- [ ] Filter tabs filter by resource type
- [ ] ~6 unit tests pass

---

## v0.13.3b: Crafting Station Interface

[v0.13.3b Design Specification](v0.13.3b-design-specification.md)

### Overview

Implement the crafting station interface showing station-specific recipe lists, material availability highlighting, and crafting progress feedback.

### Scope

**In Scope:**
- Crafting station menu with station name
- Station-specific recipe list
- Material availability highlighting (owned vs needed)
- Crafting progress feedback during creation

**Out of Scope:**
- Resource panel (v0.13.3a)
- Recipe search/filter (v0.13.3c)
- Gathering display (v0.13.3d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 2 | `CraftingStationMenu`, `MaterialAvailabilityDisplay` |
| Renderers | 1 | `CraftingProgressRenderer` |
| View Updates | 1 | Room interaction integration |
| Unit Tests | ~8 | Station menu, availability, progress tests |

### Data Model Changes

```
NEW: CraftingStationMenu (UI Component)
|-- RenderStation(CraftingStation): void
|-- RenderRecipeList(IEnumerable<RecipeDefinition>): void
|-- SelectRecipe(RecipeDefinition): void
+-- ShowCraftingProgress(float): void

NEW: MaterialAvailabilityDisplay (UI Component)
|-- RenderMaterials(IEnumerable<RecipeMaterial>, IEnumerable<PlayerResource>): void
|-- GetAvailabilityIndicator(RecipeMaterial, int): string
|-- HighlightMissing(RecipeMaterial): void
+-- IsCraftable(RecipeDefinition, IEnumerable<PlayerResource>): bool

NEW: CraftingProgressRenderer (Renderer)
|-- RenderProgress(float): string
|-- AnimateProgress(float, float): void
+-- ShowComplete(): void
```

### User-Facing Changes

**Crafting Station Menu Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│                    BLACKSMITH FORGE                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  AVAILABLE RECIPES                           YOUR MATERIALS          │
│  ─────────────────                           ──────────────          │
│                                                                      │
│  [x] Iron Sword          [2 Iron Ore]        Iron Ore: 24 [x]       │
│  [x] Iron Shield         [3 Iron Ore]        Silver Ore: 12 [x]     │
│  [x] Steel Blade         [2 Iron, 1 Coal]    Coal: 8 [x]            │
│  [ ] Silver Ring         [2 Silver, 1 Gem]   Ruby: 5                │
│  [ ] Mithril Armor       [5 Mithril Ore]     Mithril Ore: 0 [ ]     │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**Craftability Indicators:**
- `[x]` Can craft (have all materials)
- `[ ]` Cannot craft (missing materials)

**Crafting Progress:**
```
Crafting: Steel Blade
[##########....................] 35%
```

### Acceptance Criteria

- [ ] Crafting station menu shows station name
- [ ] Station-specific recipes display correctly
- [ ] Craftable recipes marked with `[x]`
- [ ] Non-craftable recipes marked with `[ ]`
- [ ] Material availability highlights owned vs needed
- [ ] Crafting progress shows during creation
- [ ] ~8 unit tests pass

---

## v0.13.3c: Recipe Browser & Details

[v0.13.3c Design Specification](v0.13.3c-design-specification.md)

### Overview

Implement the recipe browser with search and filter capabilities, recipe details view showing materials and output, recipe book for collected recipes, and recipe discovery notifications.

### Scope

**In Scope:**
- Recipe browser with search functionality
- Recipe filter by category
- Recipe details view (materials, expected output)
- Quality result display after crafting
- Recipe book panel for collected recipes
- New recipe notification on discovery
- Recipe unlock progress (discovered/total)

**Out of Scope:**
- Resource panel (v0.13.3a)
- Crafting station menu (v0.13.3b)
- Gathering display (v0.13.3d)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 3 | `RecipeBrowser`, `RecipeDetails`, `RecipeBook` |
| Notifications | 2 | `RecipeDiscoveryNotification`, `CraftingResultNotification` |
| Commands | 1 | `RecipesCommand` |
| View Updates | 1 | Inventory integration |
| Unit Tests | ~6 | Search, filter, details, notification tests |

### Data Model Changes

```
NEW: RecipeBrowser (UI Component)
|-- RenderRecipes(IEnumerable<RecipeDefinition>): void
|-- Search(string): IEnumerable<RecipeDefinition>
|-- FilterByCategory(RecipeCategory): void
+-- SelectRecipe(RecipeDefinition): void

NEW: RecipeDetails (UI Component)
|-- RenderRecipe(RecipeDefinition): void
|-- ShowMaterials(IEnumerable<RecipeMaterial>): void
|-- ShowExpectedOutput(ItemDefinition, QualityRange): void
+-- ShowQualityResult(ItemQuality): void

NEW: RecipeBook (UI Component)
|-- RenderDiscoveredRecipes(IEnumerable<RecipeDefinition>): void
|-- ShowUnlockProgress(int, int): void
|-- HighlightNew(RecipeDefinition): void
+-- FilterByStation(CraftingStation): void

NEW: RecipeDiscoveryNotification (Notification)
|-- ShowDiscovery(RecipeDefinition): void
+-- GetDuration(): TimeSpan

NEW: CraftingResultNotification (Notification)
|-- ShowResult(CraftedItem): void
|-- ShowQualityTier(ItemQuality): void
+-- GetDuration(): TimeSpan
```

### User-Facing Changes

**Recipe Browser Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│                       RECIPE BROWSER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  Search: [____________]    Filter: [All] [Weapons] [Armor] [Potions]│
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  WEAPONS                               ARMOR                         │
│  ───────                               ─────                         │
│  Iron Sword                            Iron Shield                   │
│  Steel Blade                           Steel Armor                   │
│  Silver Dagger                         Leather Armor                 │
│                                                                      │
│  POTIONS                                                             │
│  ───────                                                             │
│  Health Potion                                                       │
│  Mana Potion                                                         │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**Recipe Details Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│ STEEL BLADE                                      Quality: ***       │
│ A finely crafted blade of hardened steel                            │
│                                                                      │
│ Required Materials:           You Have:                             │
│ |-- Iron Ore x2               24 [x]                                │
│ +-- Coal x1                   8 [x]                                 │
│                                                                      │
│ Output: Steel Blade (Common-Rare based on skill)                    │
│                                                                      │
│ [C]raft                                                              │
└─────────────────────────────────────────────────────────────────────┘
```

**Recipe Book Progress:**
```
Recipes Discovered: 12 / 35 (34%)
```

**New Recipe Notification:**
```
+=====================================================+
|  [!]  NEW RECIPE DISCOVERED!                        |
+=====================================================+
|                                                     |
|  STEEL BLADE                                        |
|  Forge at: Blacksmith                               |
|                                                     |
+=====================================================+
```

**Quality Result Display:**
```
+=====================================================+
|  CRAFTING COMPLETE!                                 |
+=====================================================+
|                                                     |
|  Steel Blade                                        |
|  Quality: RARE (★★★)                               |
|                                                     |
+=====================================================+
```

### Acceptance Criteria

- [ ] Recipe browser displays all recipes
- [ ] Search filters recipes by name
- [ ] Category filter works correctly
- [ ] Recipe details show materials and output
- [ ] Material requirements show owned quantities
- [ ] Quality result displays after crafting
- [ ] Recipe book shows collected recipes
- [ ] New recipe notification displays on discovery
- [ ] Recipe unlock progress shows discovered/total
- [ ] ~6 unit tests pass

---

## v0.13.3d: Gathering Display

[v0.13.3d Design Specification](v0.13.3d-design-specification.md)

### Overview

Implement the gathering display showing harvestable resource indicators in rooms, gathering dice check visualization, and yield display for gathered resources.

### Scope

**In Scope:**
- Harvestable indicators in room view
- Gathering dice check display with roll visualization
- Yield display showing gathered resources
- Gathering action prompt

**Out of Scope:**
- Resource panel (v0.13.3a)
- Crafting station interface (v0.13.3b)
- Recipe browser (v0.13.3c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 2 | `HarvestableIndicators`, `GatheringDisplay` |
| Renderers | 1 | `DiceCheckRenderer` |
| Commands | 1 | `GatherCommand` |
| View Updates | 1 | `RoomView` integration |
| Unit Tests | ~5 | Indicator, dice check, yield tests |

### Data Model Changes

```
NEW: HarvestableIndicators (UI Component)
|-- RenderHarvestables(IEnumerable<HarvestableNode>): void
|-- GetNodeIcon(ResourceType): string
|-- ShowGatherPrompt(HarvestableNode): void
+-- HighlightSelected(HarvestableNode): void

NEW: GatheringDisplay (UI Component)
|-- ShowDiceCheck(DiceRoll, int): void
|-- ShowResult(bool, int): void
|-- ShowYield(IEnumerable<GatheredResource>): void
+-- AnimateGathering(): void

NEW: DiceCheckRenderer (Renderer)
|-- FormatRoll(DiceRoll): string
|-- FormatModifiers(IEnumerable<int>): string
|-- FormatDC(int): string
+-- FormatResult(bool): string
```

### User-Facing Changes

**Harvestable Indicators in Room:**
```
┌─────────────────────────────────────────────────────────────────────┐
│  FOREST CLEARING                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Harvestable Resources:                                              │
│  ┌─────────────────────────────────────────────────────────────────┐│
│  │  [H] Healing Herbs (x3)     DC 10  [G]ather                     ││
│  │  [M] Cave Mushrooms (x2)    DC 12  [G]ather                     ││
│  └─────────────────────────────────────────────────────────────────┘│
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

**Gathering Dice Check Display:**
```
GATHERING: Healing Herbs
─────────────────────────
Skill Check: Herbalism (DC 10)

Rolling: 1d20 + 3 (Herbalism)
Result: [14] + 3 = 17  [x] SUCCESS!

Yield: [H] Healing Herb x2
```

**Gathering Failure:**
```
GATHERING: Cave Mushrooms
─────────────────────────
Skill Check: Herbalism (DC 12)

Rolling: 1d20 + 3 (Herbalism)
Result: [6] + 3 = 9  [ ] FAILED

No resources gathered.
```

### Acceptance Criteria

- [ ] Harvestable indicators show in rooms
- [ ] Harvestable nodes display resource type icon
- [ ] DC (difficulty) displays for each node
- [ ] Gathering dice check displays roll
- [ ] Roll modifiers display correctly
- [ ] Success/failure result shows clearly
- [ ] Yield display shows gathered resources on success
- [ ] ~5 unit tests pass

---

## Dependencies & Prerequisites

```
v0.11.x (Crafting & Resources) - REQUIRED
    |
    |-- v0.11.x: Resources ────────────────────────┐
    |       Provides: IResourceService              |
    |       Provides: ResourceDefinition            |
    |                                               |
    |-- v0.11.x: Crafting ─────────────────────────┤
    |       Provides: ICraftingService              |
    |       Provides: RecipeDefinition              |
    |                                               |
    +-- v0.11.x: Gathering ────────────────────────┤
            Provides: IGatheringService             |
            Provides: HarvestableNode               |
                                                    |
                                    v
v0.13.3 (Crafting UI)
    |
    |-- v0.13.3a: Resource Inventory Panel ────────┐
    |       Dependencies: IResourceService          |
    |       Provides: ResourceInventoryPanel        |
    |                                               |
    |-- v0.13.3b: Crafting Station Interface ──────┤
    |       Dependencies: ICraftingService          |
    |       Provides: CraftingStationMenu           |
    |                                               |
    |-- v0.13.3c: Recipe Browser & Details ────────┤
    |       Dependencies: ICraftingService          |
    |       Provides: RecipeBrowser, RecipeDetails, |
    |                 RecipeBook                    |
    |                                               |
    +-- v0.13.3d: Gathering Display ───────────────┘
            Dependencies: IGatheringService
            Provides: HarvestableIndicators,
                      GatheringDisplay, GatherCommand
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.13.3a | ~3 | ~1 | ~6 | Medium |
| v0.13.3b | ~4 | ~1 | ~8 | Medium-High |
| v0.13.3c | ~6 | ~1 | ~6 | Medium-High |
| v0.13.3d | ~4 | ~1 | ~5 | Medium |
| **Total** | **~17** | **~4** | **~25** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Large resource lists performance | Medium | Low | Implement pagination/scrolling |
| Recipe search complexity | Low | Low | Simple substring matching |
| Dice check animation timing | Low | Medium | Simple text-based animation |
| Station-specific recipe filtering | Low | Low | Use existing service methods |

---

## Design Decisions (Confirmed)

### Resource Panel

| Decision | Value | Notes |
|----------|-------|-------|
| **Layout** | Categorized columns | Resources grouped by type |
| **Type Icons** | `[O]`, `[H]`, `[L]`, `[G]`, `[M]` | Single letter abbreviations |
| **Filter** | Tab-based | Filter by resource type |
| **Quantity Format** | `x##` | Right-aligned quantities |

### Crafting Station

| Decision | Value | Notes |
|----------|-------|-------|
| **Craftability Indicator** | `[x]` / `[ ]` | Check mark for craftable |
| **Material Display** | Side panel | Show required vs owned |
| **Progress Display** | Text progress bar | `[####....]` format |
| **Action Key** | `[C]` | Clear craft action |

### Recipe Browser

| Decision | Value | Notes |
|----------|-------|-------|
| **Search** | Text input | Substring matching |
| **Filter** | Category tabs | Weapons, Armor, Potions, etc. |
| **Quality Display** | Star rating | `★★★` format |
| **Discovery Notification** | 5 second popup | Auto-dismiss |

### Gathering Display

| Decision | Value | Notes |
|----------|-------|-------|
| **Node Indicator** | Type icon + quantity | `[H] Healing Herbs (x3)` |
| **DC Display** | `DC ##` | Difficulty class |
| **Roll Format** | `[##] + # = ##` | Clear breakdown |
| **Success/Failure** | `[x]` / `[ ]` | Check mark indicator |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.13.3a Design Spec** - Create detailed design for Resource Inventory Panel
3. **v0.13.3a Implementation** - Build ResourceInventoryPanel, ResourceStackRenderer
4. **v0.13.3b Design Spec** - Create detailed design for Crafting Station Interface
5. **v0.13.3b Implementation** - Build CraftingStationMenu, MaterialAvailabilityDisplay
6. **v0.13.3c Design Spec** - Create detailed design for Recipe Browser & Details
7. **v0.13.3c Implementation** - Build RecipeBrowser, RecipeDetails, RecipeBook, notifications
8. **v0.13.3d Design Spec** - Create detailed design for Gathering Display
9. **v0.13.3d Implementation** - Build HarvestableIndicators, GatheringDisplay, GatherCommand

---

*This scope breakdown provides a structured approach to implementing v0.13.3 Crafting UI. Each sub-part builds incrementally, with v0.13.3a establishing resource display, v0.13.3b adding crafting station interaction, v0.13.3c providing recipe browsing and discovery, and v0.13.3d completing gathering visualization. All sub-parts integrate with existing views (InventoryView, RoomView).*
