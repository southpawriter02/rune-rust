> **Archived** - This plan has been consolidated. See the complete version at [v0.3.24](../v0.3.x/v0.3.24.md).

Here is the comprehensive implementation plan for v0.3.24b: The Golden Master (Alpha Packaging).
This sub-version finalizes the build pipeline, establishing the versioning authority, configuring production-grade logging, and consolidating the database schema into a clean baseline for the v0.4.0 Alpha release.

v0.3.24b: The Golden Master
Goal: Establish a stable "Gold" state by finalizing version metadata, configuring release-mode logging, consolidating database migrations, and creating deployment scripts.
1. Architecture & Data Flow
	•	Centralized Versioning: The BuildInfo static class becomes the single source of truth for version data, used by the Title Screen, Save System (for compatibility checks), and Crash Reporter.
	•	Environment-Aware Logging: The application now detects whether it is running in DEBUG or RELEASE mode.
	◦	Debug: Logs Verbose to Console and File.
	◦	Release: Logs Information to File; Warning to Console (to keep the TUI clean).
	•	Schema Baseline: All previous EF Core migrations (v0.0.1 to v0.3.23) are deleted and replaced by a single Initial_v0_4_0 migration. This creates a clean slate for the Saga expansion.
Data Flow: The Startup Sequence (Release Mode)
	1	Launch: User runs RuneAndRust.exe.
	2	Configuration: Program.cs checks #if DEBUG.
	◦	Result: Configures Serilog for minimal console output (Warnings only) to prevent "log spam" from breaking the TUI layout.
	3	Versioning: TitleScreenService reads BuildInfo.Version ("0.4.0-alpha").
	4	Display: Renders "Rune & Rust - The Saga (Alpha)" on the main menu.
	5	Save Validation: When "Load Game" is selected, the SaveManager compares SaveGame.GameVersion vs BuildInfo.Version.
	◦	Mismatch: Flags save as "Incompatible (Legacy)".

2. Logic Decision Trees
A. Save Compatibility Logic Input: SaveGame Metadata, Current BuildInfo
	1	Parse Versions: Extract Major.Minor from SaveGame.Version and BuildInfo.Version.
	2	Compare:
	◦	Save.Major < Build.Major: Incompatible (Breaking changes).
	◦	Save.Minor < Build.Minor: Compatible (Run Migrations if needed).
	◦	Save == Build: Compatible.
	3	Specific Check: Is Save from v0.3.x?
	◦	Yes: Reject. (The v0.4.0 DB Consolidation invalidates old saves).
	4	Result: Return LoadResult.Success or LoadResult.Incompatible.
B. Logging Configuration Logic Input: Preprocessor Directives
	1	#if DEBUG defined?
	◦	Yes: Set MinimumLevel = Verbose. Write to Console + File.
	◦	No: Set MinimumLevel = Information. Write to File. Console restricted to Warning.

3. Code Implementation
A. BuildInfo (Version Authority) File: RuneAndRust.Core/Constants/BuildInfo.cs
public static class BuildInfo
{
    public const string Version = "0.4.0";
    public const string Codename = "The Saga";
    public const string BuildDate = "2026-03-XX"; // Auto-update in CI/CD ideally

    public static bool IsDebug =>
#if DEBUG
        true;
#else
        false;
#endif
}
B. Production Logging (Program.cs) File: RuneAndRust.Terminal/Program.cs
var logConfig = new LoggerConfiguration()
    .Enrich.FromLogContext();

#if DEBUG
    // Dev Mode: See everything, debug issues
    logConfig.MinimumLevel.Verbose()
             .WriteTo.Console()
             .WriteTo.File("logs/dev_run.log", rollingInterval: RollingInterval.Day);
#else
    // Release Mode: Clean UI, detailed audit trail on disk
    logConfig.MinimumLevel.Information()
             .WriteTo.Console(restrictedToMinimumLevel: LogEventLevel.Warning)
             .WriteTo.File("logs/game.log", rollingInterval: RollingInterval.Day);
#endif

Log.Logger = logConfig.CreateLogger();
C. Save Version Stamp (SaveManager) File: RuneAndRust.Engine/Services/SaveManager.cs
// Inside SaveGameAsync
var save = new SaveGame
{
    // ... existing props
    GameVersion = BuildInfo.Version,
    BuildDate = DateTime.UtcNow
};

4. Workflows & Operations
The Migration Squash Workflow (Manual Dev Task) To create the clean baseline for v0.4.0:
	1	Delete: Delete the Migrations/ folder in RuneAndRust.Persistence.
	2	Drop: Drop the local development database (runeandrust).
	3	Regenerate:dotnet ef migrations add Initial_v0_4_0_Alpha --project RuneAndRust.Persistence --startup-project RuneAndRust.Terminal
	4	
	5	Apply:dotnet ef database update --project RuneAndRust.Persistence --startup-project RuneAndRust.Terminal
	6	
The Release Build Workflow
	1	Publish:dotnet publish RuneAndRust.Terminal -c Release -r win-x64 --self-contained -p:PublishSingleFile=true -o ./dist/v0.4.0-win
	2	

5. Deliverable Checklist (v0.3.24b)
	•	Configuration:
	◦	[ ] Create BuildInfo.cs in Core.
	◦	[ ] Update Program.cs logging logic [Source 1541, 1689].
	◦	[ ] Update SaveGame entity to include GameVersion string.
	•	Database:
	◦	[ ] CRITICAL: Perform Migration Squash (Delete old migrations, create Initial_v0_4_0).
	◦	[ ] Verify database generates correctly from empty state.
	•	UI:
	◦	[ ] Update TitleScreenService to display BuildInfo.Codename [Source 2581].
	◦	[ ] Update LoadScreenRenderer to show version mismatch warnings.
	•	Packaging:
	◦	[ ] Create publish.bat / publish.sh scripts.

6. Logging Requirements
Reference: logging.md
System
Event
Level
Message Template
Properties
System
Boot
Info
"Rune & Rust v{Version} ({Codename}) Started. Debug: {IsDebug}"
Version, Codename, IsDebug
Save
Version Check
Warn
"Loaded save from version {SaveVer}, current is {CurrVer}."
SaveVer, CurrVer

7. Testing Strategy
Unit Tests (VersioningTests.cs):
	•	Version_Parsing: Verify 0.4.0 parses correctly.
	•	Save_Compatibility:
	◦	Input: Save Version 0.3.5.
	◦	Assert: IsCompatible returns False.
Manual QA (Release Candidate):
	•	The "Clean Slate" Test:
	1	Delete local database.
	2	Delete all logs/ and data/ files.
	3	Run Release build.
	4	Verify: Game boots, DB is created automatically, no debug text "spam" in the console.

8. Draft Changelog (v0.3.24b)
# Changelog: v0.3.24b - The Golden Master

**Release Date:** 2026-03-XX

## Summary
"The Golden Master" marks the completion of the Pre-Saga engineering phase. This release establishes the production baseline for v0.4.0, including a consolidated database schema, version-aware save systems, and optimized release logging.

## Changes
- **Architecture:** Consolidated all database migrations into `Initial_v0_4_0`.
- **System:** Added `BuildInfo` to track game version and codename ("The Saga").
- **Persistence:** Save files now stamp the game version. Loading older saves will trigger a compatibility warning.
- **Logging:** Configured "Quiet Mode" for Release builds to prevent console clutter while maintaining detailed file logs.
- **UI:** Title screen now displays the correct Alpha version and Codename.

## Breaking Changes
- **WIPE:** Due to the migration squash, all saves from v0.3.x are formally invalidated. Please start a New Game.