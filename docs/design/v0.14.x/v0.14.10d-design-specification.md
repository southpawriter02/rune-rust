# v0.14.10d Design Specification: Command Schema

## Document Information

| Field | Value |
|-------|-------|
| **Version** | v0.14.10d |
| **Feature** | Command Schema |
| **Status** | Draft |
| **Created** | 2026-01-17 |
| **Depends On** | None |
| **Provides To** | v0.15.x (Command Parser), Text Interface System |

---

## 1. Executive Summary

### 1.1 Overview

This specification defines the Command Schema for configuring text-based interface commands in Aethelgard. The schema enables definition of command syntax, argument patterns, context restrictions, help text, and shorthand aliases for the game's text adventure interface.

The schema enables:
- **Command Identity**: Name, aliases, and shorthand notations
- **Argument Patterns**: Required, optional, and variadic arguments with type validation
- **Context Restrictions**: Commands valid only in specific game contexts (combat, exploration, etc.)
- **Help System**: Usage patterns, examples, and cross-references
- **Command Categories**: Logical grouping for organization and discovery
- **Chaining Rules**: Commands that can combine with others

### 1.2 Deliverables

| Deliverable | Layer | Description |
|-------------|-------|-------------|
| `commands.schema.json` | Configuration | JSON Schema Draft-07 validation schema |
| `commands.json` | Configuration | Command definitions |
| `Command` | Schema Definition | Core command structure |
| `CommandArgument` | Schema Definition | Argument with type and validation |
| `ArgumentType` | Schema Definition | 10 argument type classifications |
| `CommandContext` | Schema Definition | 9 valid context restrictions |
| `CommandHelp` | Schema Definition | Help text structure with examples |
| `CommandAlias` | Schema Definition | Global shorthand mappings |
| ~6 Unit Tests | Testing | Schema validation and loading tests |

### 1.3 Architectural Significance

The Command Schema serves as the configuration layer for the text interface parser:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      COMMAND SCHEMA INTEGRATION                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────┐                       ┌────────────────────────┐  │
│  │   Player Input   │                       │    Game Systems        │  │
│  │                  │                       │                        │  │
│  │  "attack goblin" │                       │  ├─ Combat             │  │
│  │  "l north"       │                       │  ├─ Movement           │  │
│  │  "inv"           │                       │  ├─ Inventory          │  │
│  └────────┬─────────┘                       │  └─ Interaction        │  │
│           │                                 └────────────▲───────────┘  │
│           ▼                                              │              │
│  ┌──────────────────┐     ┌───────────────────────┐     │              │
│  │  Command Parser  │────▶│    Command Schema     │─────┘              │
│  │   (v0.15.x)      │     │    (v0.14.10d)        │                    │
│  │                  │     │                       │                    │
│  │  - Tokenize      │     │  - commands.json      │                    │
│  │  - Validate      │     │  - Argument types     │                    │
│  │  - Execute       │     │  - Context rules      │                    │
│  └──────────────────┘     │  - Help text          │                    │
│                           └───────────────────────┘                    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Feature Overview

```
v0.14.10d Command Schema
├── Schema Definitions
│   ├── Command
│   │   ├── id (kebab-case identifier)
│   │   ├── name (primary command word)
│   │   ├── aliases[] (alternative names)
│   │   ├── category (8 command categories)
│   │   ├── description (brief description)
│   │   ├── arguments[] (typed arguments)
│   │   ├── contexts[] (where command is valid)
│   │   ├── help (usage, examples, notes)
│   │   ├── isHidden (debug command flag)
│   │   ├── requiresTarget (needs target selection)
│   │   ├── canChain (combinable with others)
│   │   └── cooldown (turns between uses)
│   │
│   ├── CommandArgument
│   │   ├── name (argument identifier)
│   │   ├── type (10 argument types)
│   │   ├── description (help text)
│   │   ├── isRequired (mandatory flag)
│   │   ├── isVariadic (accepts multiple values)
│   │   ├── defaultValue (fallback value)
│   │   ├── validValues[] (enum restriction)
│   │   └── pattern (regex validation)
│   │
│   ├── ArgumentType (enum: 10 types)
│   │   ├── String, Number, Direction
│   │   ├── Target, Item, Ability
│   │   ├── NPC, Location, Quantity
│   │   └── Boolean
│   │
│   ├── CommandCategory (enum: 8 categories)
│   │   ├── Movement, Combat, Interaction
│   │   ├── Inventory, Information, Social
│   │   └── System, Debug
│   │
│   ├── CommandContext (enum: 9 contexts)
│   │   ├── Exploration, Combat, Dialogue
│   │   ├── Inventory, Menu, Rest
│   │   ├── Crafting, Trading, Any
│   │   └── (restrictions define validity)
│   │
│   ├── CommandHelp
│   │   ├── usage (syntax pattern)
│   │   ├── examples[] (input/description pairs)
│   │   ├── notes (additional information)
│   │   └── seeAlso[] (related command IDs)
│   │
│   └── GlobalAliases
│       └── shorthand → command mappings
│
├── Configuration Files
│   ├── commands.schema.json (validation schema)
│   └── commands.json (command definitions)
│
└── Unit Tests (~6 tests)
    ├── CMD-001: Valid schema loads successfully
    ├── CMD-002: Invalid command ID rejected
    ├── CMD-003: Argument type validation
    ├── CMD-004: Context restriction validation
    ├── CMD-005: Alias uniqueness enforcement
    └── CMD-006: Help structure validation
```

---

## 3. Architecture Diagrams

### 3.1 Command Data Structure

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        COMMAND SCHEMA STRUCTURE                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  commands.json                                                           │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                                                                    │  │
│  │  globalAliases                    commands[]                       │  │
│  │  ┌─────────────────────┐         ┌─────────────────────────────┐  │  │
│  │  │ Shorthand Mappings  │         │ Command                     │  │  │
│  │  │                     │         │                             │  │  │
│  │  │ "l" → "look"        │         │ ├─ id: "look"               │  │  │
│  │  │ "x" → "examine"     │         │ ├─ name: "look"             │  │  │
│  │  │ "n" → "north"       │         │ ├─ aliases: ["l", "examine"]│  │  │
│  │  │ "s" → "south"       │         │ ├─ category: "Interaction"  │  │  │
│  │  │ "i" → "inventory"   │         │ ├─ arguments[]              │  │  │
│  │  │ "a" → "attack"      │         │ │   └─ {target, optional}   │  │  │
│  │  └─────────────────────┘         │ ├─ contexts: ["Exploration"]│  │  │
│  │                                  │ └─ help: {usage, examples}  │  │  │
│  │                                  └─────────────────────────────┘  │  │
│  │                                                                    │  │
│  │                                  ┌─────────────────────────────┐  │  │
│  │                                  │ Command                     │  │  │
│  │                                  │                             │  │  │
│  │                                  │ ├─ id: "attack"             │  │  │
│  │                                  │ ├─ name: "attack"           │  │  │
│  │                                  │ ├─ category: "Combat"       │  │  │
│  │                                  │ ├─ contexts: ["Combat"]     │  │  │
│  │                                  │ └─ requiresTarget: true     │  │  │
│  │                                  └─────────────────────────────┘  │  │
│  │                                                                    │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Command Processing Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        COMMAND PROCESSING FLOW                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Player Input: "attack goblin with sword"                               │
│         │                                                                │
│         ▼                                                                │
│  ┌──────────────────┐                                                   │
│  │  1. Tokenize     │  ["attack", "goblin", "with", "sword"]           │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐    ┌─────────────────────────────────────────┐   │
│  │  2. Resolve      │───▶│ commands.json                           │   │
│  │     Command      │    │                                         │   │
│  │                  │    │  "attack" → Command {                   │   │
│  │  Check aliases   │    │    id: "attack",                        │   │
│  │  Check globals   │    │    arguments: [                         │   │
│  └────────┬─────────┘    │      {name: "target", type: "Target"},  │   │
│           │              │      {name: "weapon", type: "Item"}     │   │
│           │              │    ]                                    │   │
│           │              │  }                                      │   │
│           │              └─────────────────────────────────────────┘   │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │  3. Validate     │  Context: Combat ✓                               │
│  │     Context      │  (command.contexts includes "Combat")            │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │  4. Parse        │  target = "goblin" (type: Target) ✓              │
│  │     Arguments    │  weapon = "sword" (type: Item) ✓                 │
│  │                  │  (skip prepositions like "with")                  │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │  5. Execute      │  → Combat System: Attack(target, weapon)         │
│  └──────────────────┘                                                   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Argument Type Resolution

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        ARGUMENT TYPE RESOLUTION                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                    ARGUMENT TYPES (10)                           │    │
│  │                                                                  │    │
│  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐            │    │
│  │  │   String    │   │   Number    │   │  Direction  │            │    │
│  │  │             │   │             │   │             │            │    │
│  │  │ Free text   │   │ Integer     │   │ n/s/e/w     │            │    │
│  │  │ "hello"     │   │ "5", "100"  │   │ up/down     │            │    │
│  │  └─────────────┘   └─────────────┘   └─────────────┘            │    │
│  │                                                                  │    │
│  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐            │    │
│  │  │   Target    │   │    Item     │   │   Ability   │            │    │
│  │  │             │   │             │   │             │            │    │
│  │  │ Enemy/NPC   │   │ Inventory   │   │ Skill/Spell │            │    │
│  │  │ "goblin"    │   │ "sword"     │   │ "fireball"  │            │    │
│  │  └─────────────┘   └─────────────┘   └─────────────┘            │    │
│  │                                                                  │    │
│  │  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐            │    │
│  │  │     NPC     │   │  Location   │   │  Quantity   │            │    │
│  │  │             │   │             │   │             │            │    │
│  │  │ Character   │   │ Place name  │   │ Amount      │            │    │
│  │  │ "bjorn"     │   │ "town"      │   │ "3", "all"  │            │    │
│  │  └─────────────┘   └─────────────┘   └─────────────┘            │    │
│  │                                                                  │    │
│  │  ┌─────────────┐                                                 │    │
│  │  │   Boolean   │   Validation Strategy:                         │    │
│  │  │             │   - Direction: Match against cardinal list     │    │
│  │  │ on/off      │   - Target: Query visible entities             │    │
│  │  │ yes/no      │   - Item: Query inventory                      │    │
│  │  └─────────────┘   - NPC: Query known characters                │    │
│  │                     - Ability: Query available abilities         │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Context Restriction System

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      CONTEXT RESTRICTION SYSTEM                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Current Game Context                                                    │
│         │                                                                │
│         ▼                                                                │
│  ┌──────────────────────────────────────────────────────────────────┐   │
│  │                       CONTEXTS (9)                                │   │
│  │                                                                   │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐ │   │
│  │  │Exploration │  │  Combat    │  │ Dialogue   │  │ Inventory  │ │   │
│  │  │            │  │            │  │            │  │            │ │   │
│  │  │ look, go   │  │ attack     │  │ say, ask   │  │ equip      │ │   │
│  │  │ examine    │  │ defend     │  │ greet      │  │ drop       │ │   │
│  │  │ take       │  │ cast       │  │ farewell   │  │ use        │ │   │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘ │   │
│  │                                                                   │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐ │   │
│  │  │   Menu     │  │   Rest     │  │ Crafting   │  │  Trading   │ │   │
│  │  │            │  │            │  │            │  │            │ │   │
│  │  │ settings   │  │ sleep      │  │ craft      │  │ buy        │ │   │
│  │  │ save       │  │ meditate   │  │ repair     │  │ sell       │ │   │
│  │  │ quit       │  │ camp       │  │ dismantle  │  │ trade      │ │   │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘ │   │
│  │                                                                   │   │
│  │  ┌────────────────────────────────────────────────────────────┐  │   │
│  │  │                         Any                                 │  │   │
│  │  │                                                             │  │   │
│  │  │  help, status, inventory, quit (available everywhere)       │  │   │
│  │  └────────────────────────────────────────────────────────────┘  │   │
│  │                                                                   │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  Context Resolution:                                                     │
│    command.contexts.includes(currentContext) OR                          │
│    command.contexts.includes("Any")                                      │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.5 Configuration Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      CONFIGURATION LAYER PLACEMENT                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ PRESENTATION LAYER                                                 │  │
│  │                                                                    │  │
│  │  Text Interface ─────────────────────────────────────────────────▶│  │
│  │    │ Displays prompts, accepts input, shows results               │  │
│  │    │ Renders help text and command suggestions                    │  │
│  └────┼──────────────────────────────────────────────────────────────┘  │
│       │                                                                  │
│  ┌────▼──────────────────────────────────────────────────────────────┐  │
│  │ APPLICATION LAYER (v0.15.x - Future)                              │  │
│  │                                                                    │  │
│  │  ICommandParser                                                    │  │
│  │    │ ├─ Parse(inputString) → ParsedCommand                        │  │
│  │    │ ├─ GetHelp(commandId) → CommandHelp                          │  │
│  │    │ ├─ GetSuggestions(partial) → string[]                        │  │
│  │    │ ├─ ValidateContext(command, context) → bool                  │  │
│  │    │ └─ ResolveAlias(alias) → string                              │  │
│  └────┼──────────────────────────────────────────────────────────────┘  │
│       │                                                                  │
│  ┌────▼──────────────────────────────────────────────────────────────┐  │
│  │ INFRASTRUCTURE LAYER                                               │  │
│  │                                                                    │  │
│  │  CommandProvider (v0.15.x - Future)                               │  │
│  │    │ ├─ LoadFromJson(path)                                        │  │
│  │    │ ├─ ValidateAgainstSchema()                                   │  │
│  │    │ ├─ BuildAliasIndex()                                         │  │
│  │    │ └─ GetCommandById(id) → Command                              │  │
│  └────┼──────────────────────────────────────────────────────────────┘  │
│       │                                                                  │
│  ┌────▼──────────────────────────────────────────────────────────────┐  │
│  │ CONFIGURATION LAYER ◀─────────────────── v0.14.10d (This Version) │  │
│  │                                                                    │  │
│  │  commands.schema.json                                             │  │
│  │    │ JSON Schema Draft-07 validation                              │  │
│  │    │                                                              │  │
│  │  commands.json                                                    │  │
│  │    ├─ globalAliases ─── Shorthand mappings                        │  │
│  │    └─ commands[] ────── Command definitions                       │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Schema Root Definition

### 4.1 Root Object

The root object defines the commands configuration file structure.

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "commands.schema.json",
  "title": "Command Configuration Schema",
  "description": "Defines text-based interface commands, arguments, and help text",
  "type": "object",
  "required": ["version", "commands"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver format)",
      "examples": ["1.0.0"]
    },
    "globalAliases": {
      "type": "object",
      "description": "Global shorthand mappings (single-char to command)",
      "additionalProperties": { "type": "string" },
      "examples": [{ "l": "look", "x": "examine", "n": "north" }]
    },
    "ignoredWords": {
      "type": "array",
      "description": "Filler words to ignore in parsing (the, to, at, with)",
      "items": { "type": "string" }
    },
    "categories": {
      "type": "array",
      "description": "Command category definitions for organization",
      "items": { "$ref": "#/definitions/CommandCategoryDefinition" }
    },
    "commands": {
      "type": "array",
      "description": "Command definitions",
      "minItems": 1,
      "items": { "$ref": "#/definitions/Command" }
    }
  }
}
```

### 4.2 Root Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `version` | string | Yes | Schema version in semver format |
| `globalAliases` | object | No | Single-character shorthand mappings |
| `ignoredWords` | array | No | Filler words to skip in parsing |
| `categories` | array | No | Category metadata definitions |
| `commands` | array | Yes | Command definitions (min 1) |

---

## 5. Command Definition

### 5.1 Command Schema

```json
{
  "Command": {
    "type": "object",
    "description": "A text interface command definition",
    "required": ["id", "name", "category", "description"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$",
        "description": "Unique command identifier",
        "examples": ["look", "attack", "go-north"]
      },
      "name": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9]*$",
        "minLength": 1,
        "maxLength": 20,
        "description": "Primary command word (no spaces or hyphens)"
      },
      "aliases": {
        "type": "array",
        "description": "Alternative names for the command",
        "items": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9]*$",
          "minLength": 1
        },
        "uniqueItems": true
      },
      "category": {
        "$ref": "#/definitions/CommandCategory",
        "description": "Command category for organization"
      },
      "description": {
        "type": "string",
        "minLength": 1,
        "maxLength": 200,
        "description": "Brief command description"
      },
      "arguments": {
        "type": "array",
        "description": "Command arguments (ordered)",
        "items": { "$ref": "#/definitions/CommandArgument" }
      },
      "contexts": {
        "type": "array",
        "description": "Valid game contexts for this command",
        "items": { "$ref": "#/definitions/CommandContext" },
        "minItems": 1,
        "default": ["Any"]
      },
      "help": {
        "$ref": "#/definitions/CommandHelp",
        "description": "Detailed help information"
      },
      "isHidden": {
        "type": "boolean",
        "default": false,
        "description": "If true, hidden from help listings (debug commands)"
      },
      "requiresTarget": {
        "type": "boolean",
        "default": false,
        "description": "If true, requires target selection if no target argument"
      },
      "canChain": {
        "type": "boolean",
        "default": false,
        "description": "If true, can combine with other commands via 'then'"
      },
      "cooldown": {
        "type": "integer",
        "minimum": 0,
        "description": "Turns between uses (0 = no cooldown)"
      },
      "priority": {
        "type": "integer",
        "default": 0,
        "description": "Resolution priority when commands conflict (higher = preferred)"
      },
      "tags": {
        "type": "array",
        "description": "Searchable tags for command discovery",
        "items": { "type": "string" }
      }
    }
  }
}
```

### 5.2 Command Properties Reference

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `id` | string | Yes | - | Unique identifier (kebab-case) |
| `name` | string | Yes | - | Primary command word (lowercase, no spaces) |
| `aliases` | array | No | - | Alternative command names |
| `category` | enum | Yes | - | Command category |
| `description` | string | Yes | - | Brief description (1-200 chars) |
| `arguments` | array | No | - | Ordered argument definitions |
| `contexts` | array | No | `["Any"]` | Valid game contexts |
| `help` | object | No | - | Detailed help structure |
| `isHidden` | boolean | No | `false` | Hidden from help |
| `requiresTarget` | boolean | No | `false` | Needs target selection |
| `canChain` | boolean | No | `false` | Combinable via "then" |
| `cooldown` | integer | No | - | Turns between uses |
| `priority` | integer | No | `0` | Conflict resolution priority |
| `tags` | array | No | - | Searchable tags |

---

## 6. CommandArgument Definition

### 6.1 Argument Schema

```json
{
  "CommandArgument": {
    "type": "object",
    "description": "A command argument with type and validation",
    "required": ["name", "type"],
    "additionalProperties": false,
    "properties": {
      "name": {
        "type": "string",
        "pattern": "^[a-z][a-zA-Z0-9]*$",
        "description": "Argument identifier (camelCase)"
      },
      "type": {
        "$ref": "#/definitions/ArgumentType",
        "description": "Argument type for validation"
      },
      "description": {
        "type": "string",
        "maxLength": 200,
        "description": "Argument description for help text"
      },
      "isRequired": {
        "type": "boolean",
        "default": true,
        "description": "If true, argument must be provided"
      },
      "isVariadic": {
        "type": "boolean",
        "default": false,
        "description": "If true, accepts multiple values (must be last argument)"
      },
      "defaultValue": {
        "type": "string",
        "description": "Default value if not provided"
      },
      "validValues": {
        "type": "array",
        "description": "Enum-like restriction to specific values",
        "items": { "type": "string" },
        "minItems": 1
      },
      "pattern": {
        "type": "string",
        "description": "Regex pattern for validation"
      },
      "displayHint": {
        "type": "string",
        "description": "Placeholder text for usage display (e.g., '<target>')"
      },
      "autocomplete": {
        "type": "boolean",
        "default": true,
        "description": "If true, enable autocomplete for this argument"
      }
    }
  }
}
```

### 6.2 Argument Properties Reference

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `name` | string | Yes | - | Argument identifier (camelCase) |
| `type` | enum | Yes | - | Argument type |
| `description` | string | No | - | Help text (max 200 chars) |
| `isRequired` | boolean | No | `true` | Mandatory flag |
| `isVariadic` | boolean | No | `false` | Accepts multiple values |
| `defaultValue` | string | No | - | Fallback value |
| `validValues` | array | No | - | Enum restriction |
| `pattern` | string | No | - | Regex validation |
| `displayHint` | string | No | - | Usage placeholder |
| `autocomplete` | boolean | No | `true` | Enable autocomplete |

---

## 7. ArgumentType Definition

### 7.1 ArgumentType Enum Schema

```json
{
  "ArgumentType": {
    "type": "string",
    "description": "Classification of argument for parsing and validation",
    "enum": [
      "String",
      "Number",
      "Direction",
      "Target",
      "Item",
      "Ability",
      "NPC",
      "Location",
      "Quantity",
      "Boolean"
    ]
  }
}
```

### 7.2 Argument Types Reference

| Type | Description | Example Values | Validation |
|------|-------------|----------------|------------|
| `String` | Free text | "hello world", "message" | Length limits only |
| `Number` | Integer value | "5", "100", "-1" | Parse as integer |
| `Direction` | Cardinal/relative direction | "north", "up", "in" | Match direction list |
| `Target` | Enemy, object, or entity | "goblin", "door", "chest" | Query visible entities |
| `Item` | Inventory item | "sword", "potion", "key" | Query player inventory |
| `Ability` | Skill or spell | "fireball", "heal", "sneak" | Query available abilities |
| `NPC` | Character name | "bjorn", "merchant", "guard" | Query known NPCs |
| `Location` | Place name | "town", "forest", "cave" | Query known locations |
| `Quantity` | Amount | "3", "all", "half" | Parse as quantity |
| `Boolean` | Toggle value | "on", "off", "yes", "no", "true" | Parse as boolean |

### 7.3 Direction Values

The following values are recognized for the `Direction` argument type:

```
Cardinal:  north (n), south (s), east (e), west (w)
Diagonal:  northeast (ne), northwest (nw), southeast (se), southwest (sw)
Vertical:  up (u), down (d)
Relative:  in, out, enter, exit, left (l), right (r), back, forward
```

---

## 8. CommandCategory Definition

### 8.1 Category Enum Schema

```json
{
  "CommandCategory": {
    "type": "string",
    "description": "Logical category for command organization",
    "enum": [
      "Movement",
      "Combat",
      "Interaction",
      "Inventory",
      "Information",
      "Social",
      "System",
      "Debug"
    ]
  }
}
```

### 8.2 Category Definitions Schema

```json
{
  "CommandCategoryDefinition": {
    "type": "object",
    "description": "Metadata for a command category",
    "required": ["id", "name"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "$ref": "#/definitions/CommandCategory",
        "description": "Category identifier"
      },
      "name": {
        "type": "string",
        "description": "Display name"
      },
      "description": {
        "type": "string",
        "description": "Category description"
      },
      "sortOrder": {
        "type": "integer",
        "default": 0,
        "description": "Display ordering in help"
      },
      "icon": {
        "type": "string",
        "description": "Icon asset reference"
      }
    }
  }
}
```

### 8.3 Categories Reference

| Category | Description | Example Commands |
|----------|-------------|------------------|
| `Movement` | Navigation and travel | go, north, south, enter, exit, climb |
| `Combat` | Battle actions | attack, defend, use, cast, flee, stance |
| `Interaction` | Object/NPC interaction | look, examine, talk, take, open, push |
| `Inventory` | Item management | inventory, equip, drop, use, inspect |
| `Information` | Status and information | status, map, quest, codex, time |
| `Social` | Communication | say, shout, whisper, gesture, emote |
| `System` | Meta commands | save, load, settings, quit, help |
| `Debug` | Developer commands | teleport, spawn, godmode, reveal |

---

## 9. CommandContext Definition

### 9.1 Context Enum Schema

```json
{
  "CommandContext": {
    "type": "string",
    "description": "Game context where command is valid",
    "enum": [
      "Exploration",
      "Combat",
      "Dialogue",
      "Inventory",
      "Menu",
      "Rest",
      "Crafting",
      "Trading",
      "Any"
    ]
  }
}
```

### 9.2 Contexts Reference

| Context | Description | Active During |
|---------|-------------|---------------|
| `Exploration` | World navigation | Overworld movement, dungeon exploration |
| `Combat` | Battle encounters | Turn-based combat, enemy engagement |
| `Dialogue` | NPC conversations | Speaking with characters |
| `Inventory` | Item management screen | Inventory UI open |
| `Menu` | System menus | Settings, save/load screens |
| `Rest` | Resting/camping | Campsite, inn rest sequences |
| `Crafting` | Item creation | Workbench, forge interfaces |
| `Trading` | Merchant interactions | Buy/sell with vendors |
| `Any` | Always available | Universal commands (help, status) |

---

## 10. CommandHelp Definition

### 10.1 Help Schema

```json
{
  "CommandHelp": {
    "type": "object",
    "description": "Detailed help information for a command",
    "required": ["usage"],
    "additionalProperties": false,
    "properties": {
      "usage": {
        "type": "string",
        "description": "Syntax pattern showing arguments",
        "examples": ["look [target]", "attack <target> [with <weapon>]"]
      },
      "examples": {
        "type": "array",
        "description": "Example command usages",
        "items": { "$ref": "#/definitions/CommandExample" }
      },
      "notes": {
        "type": "string",
        "description": "Additional usage notes or tips"
      },
      "seeAlso": {
        "type": "array",
        "description": "Related command IDs",
        "items": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        }
      }
    }
  }
}
```

### 10.2 CommandExample Schema

```json
{
  "CommandExample": {
    "type": "object",
    "description": "An example command usage",
    "required": ["input", "description"],
    "additionalProperties": false,
    "properties": {
      "input": {
        "type": "string",
        "description": "Example command input"
      },
      "description": {
        "type": "string",
        "description": "What the command does"
      }
    }
  }
}
```

### 10.3 Usage Pattern Syntax

| Symbol | Meaning | Example |
|--------|---------|---------|
| `<arg>` | Required argument | `attack <target>` |
| `[arg]` | Optional argument | `look [direction]` |
| `[<arg>]` | Optional typed argument | `give [<quantity>] <item>` |
| `...` | Variadic (multiple values) | `say <message>...` |
| `|` | Alternatives | `go <north|south|east|west>` |

---

## 11. Configuration Schema

### 11.1 Complete JSON Schema (commands.schema.json)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "commands.schema.json",
  "title": "Command Configuration Schema",
  "description": "Defines text-based interface commands, arguments, and help text for Aethelgard",
  "type": "object",
  "required": ["version", "commands"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver format)"
    },
    "globalAliases": {
      "type": "object",
      "description": "Global shorthand mappings",
      "additionalProperties": { "type": "string" }
    },
    "ignoredWords": {
      "type": "array",
      "description": "Filler words to ignore in parsing",
      "items": { "type": "string" }
    },
    "categories": {
      "type": "array",
      "description": "Command category definitions",
      "items": { "$ref": "#/definitions/CommandCategoryDefinition" }
    },
    "commands": {
      "type": "array",
      "description": "Command definitions",
      "minItems": 1,
      "items": { "$ref": "#/definitions/Command" }
    }
  },
  "definitions": {
    "CommandCategory": {
      "type": "string",
      "enum": [
        "Movement",
        "Combat",
        "Interaction",
        "Inventory",
        "Information",
        "Social",
        "System",
        "Debug"
      ]
    },
    "CommandCategoryDefinition": {
      "type": "object",
      "required": ["id", "name"],
      "additionalProperties": false,
      "properties": {
        "id": { "$ref": "#/definitions/CommandCategory" },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "sortOrder": { "type": "integer", "default": 0 },
        "icon": { "type": "string" }
      }
    },
    "ArgumentType": {
      "type": "string",
      "enum": [
        "String",
        "Number",
        "Direction",
        "Target",
        "Item",
        "Ability",
        "NPC",
        "Location",
        "Quantity",
        "Boolean"
      ]
    },
    "CommandContext": {
      "type": "string",
      "enum": [
        "Exploration",
        "Combat",
        "Dialogue",
        "Inventory",
        "Menu",
        "Rest",
        "Crafting",
        "Trading",
        "Any"
      ]
    },
    "Command": {
      "type": "object",
      "required": ["id", "name", "category", "description"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9]*$",
          "minLength": 1,
          "maxLength": 20
        },
        "aliases": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9]*$"
          },
          "uniqueItems": true
        },
        "category": { "$ref": "#/definitions/CommandCategory" },
        "description": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200
        },
        "arguments": {
          "type": "array",
          "items": { "$ref": "#/definitions/CommandArgument" }
        },
        "contexts": {
          "type": "array",
          "items": { "$ref": "#/definitions/CommandContext" },
          "minItems": 1,
          "default": ["Any"]
        },
        "help": { "$ref": "#/definitions/CommandHelp" },
        "isHidden": { "type": "boolean", "default": false },
        "requiresTarget": { "type": "boolean", "default": false },
        "canChain": { "type": "boolean", "default": false },
        "cooldown": { "type": "integer", "minimum": 0 },
        "priority": { "type": "integer", "default": 0 },
        "tags": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "CommandArgument": {
      "type": "object",
      "required": ["name", "type"],
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-zA-Z0-9]*$"
        },
        "type": { "$ref": "#/definitions/ArgumentType" },
        "description": { "type": "string", "maxLength": 200 },
        "isRequired": { "type": "boolean", "default": true },
        "isVariadic": { "type": "boolean", "default": false },
        "defaultValue": { "type": "string" },
        "validValues": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "pattern": { "type": "string" },
        "displayHint": { "type": "string" },
        "autocomplete": { "type": "boolean", "default": true }
      }
    },
    "CommandHelp": {
      "type": "object",
      "required": ["usage"],
      "additionalProperties": false,
      "properties": {
        "usage": { "type": "string" },
        "examples": {
          "type": "array",
          "items": { "$ref": "#/definitions/CommandExample" }
        },
        "notes": { "type": "string" },
        "seeAlso": {
          "type": "array",
          "items": { "type": "string", "pattern": "^[a-z][a-z0-9-]*$" }
        }
      }
    },
    "CommandExample": {
      "type": "object",
      "required": ["input", "description"],
      "additionalProperties": false,
      "properties": {
        "input": { "type": "string" },
        "description": { "type": "string" }
      }
    }
  }
}
```

---

## 12. Example Configuration File

### 12.1 commands.json Example

```json
{
  "$schema": "./commands.schema.json",
  "version": "1.0.0",
  "globalAliases": {
    "l": "look",
    "x": "examine",
    "n": "north",
    "s": "south",
    "e": "east",
    "w": "west",
    "u": "up",
    "d": "down",
    "i": "inventory",
    "a": "attack",
    "h": "help",
    "q": "quit"
  },
  "ignoredWords": ["the", "a", "an", "to", "at", "with", "on", "in", "from", "and"],
  "categories": [
    {
      "id": "Movement",
      "name": "Movement",
      "description": "Commands for navigating the world",
      "sortOrder": 1,
      "icon": "icon-movement"
    },
    {
      "id": "Combat",
      "name": "Combat",
      "description": "Commands for battle and conflict",
      "sortOrder": 2,
      "icon": "icon-combat"
    },
    {
      "id": "Interaction",
      "name": "Interaction",
      "description": "Commands for examining and interacting with the world",
      "sortOrder": 3,
      "icon": "icon-interaction"
    },
    {
      "id": "Inventory",
      "name": "Inventory",
      "description": "Commands for managing items and equipment",
      "sortOrder": 4,
      "icon": "icon-inventory"
    },
    {
      "id": "Information",
      "name": "Information",
      "description": "Commands for viewing status and information",
      "sortOrder": 5,
      "icon": "icon-info"
    },
    {
      "id": "Social",
      "name": "Social",
      "description": "Commands for communication",
      "sortOrder": 6,
      "icon": "icon-social"
    },
    {
      "id": "System",
      "name": "System",
      "description": "Meta commands and settings",
      "sortOrder": 7,
      "icon": "icon-system"
    },
    {
      "id": "Debug",
      "name": "Debug",
      "description": "Developer and testing commands",
      "sortOrder": 99,
      "icon": "icon-debug"
    }
  ],
  "commands": [
    {
      "id": "look",
      "name": "look",
      "aliases": ["examine", "inspect", "view"],
      "category": "Interaction",
      "description": "Examine your surroundings or a specific target",
      "arguments": [
        {
          "name": "target",
          "type": "Target",
          "description": "What to look at",
          "isRequired": false,
          "displayHint": "[target]"
        }
      ],
      "contexts": ["Exploration", "Combat", "Inventory"],
      "help": {
        "usage": "look [target]",
        "examples": [
          { "input": "look", "description": "Describe your current location" },
          { "input": "look door", "description": "Examine the door in detail" },
          { "input": "look goblin", "description": "Study the goblin before you" },
          { "input": "l north", "description": "Look to the north" }
        ],
        "notes": "Without a target, describes your current location. Use 'examine' for more detailed inspection.",
        "seeAlso": ["examine", "search"]
      },
      "tags": ["observation", "exploration", "basic"]
    },
    {
      "id": "go",
      "name": "go",
      "aliases": ["move", "walk", "travel"],
      "category": "Movement",
      "description": "Move in a direction or to a location",
      "arguments": [
        {
          "name": "direction",
          "type": "Direction",
          "description": "Direction to move",
          "isRequired": true,
          "displayHint": "<direction>"
        }
      ],
      "contexts": ["Exploration"],
      "help": {
        "usage": "go <direction>",
        "examples": [
          { "input": "go north", "description": "Move north" },
          { "input": "go up", "description": "Climb upward" },
          { "input": "n", "description": "Shorthand for 'go north'" }
        ],
        "notes": "Cardinal directions (n/s/e/w) can be typed directly without 'go'.",
        "seeAlso": ["north", "south", "east", "west", "enter", "exit"]
      },
      "tags": ["movement", "navigation", "basic"]
    },
    {
      "id": "north",
      "name": "north",
      "aliases": [],
      "category": "Movement",
      "description": "Move north",
      "contexts": ["Exploration"],
      "help": {
        "usage": "north",
        "examples": [
          { "input": "north", "description": "Move north" },
          { "input": "n", "description": "Shorthand" }
        ]
      },
      "tags": ["movement", "direction"]
    },
    {
      "id": "south",
      "name": "south",
      "aliases": [],
      "category": "Movement",
      "description": "Move south",
      "contexts": ["Exploration"],
      "help": {
        "usage": "south",
        "examples": [
          { "input": "south", "description": "Move south" },
          { "input": "s", "description": "Shorthand" }
        ]
      },
      "tags": ["movement", "direction"]
    },
    {
      "id": "east",
      "name": "east",
      "aliases": [],
      "category": "Movement",
      "description": "Move east",
      "contexts": ["Exploration"],
      "help": { "usage": "east" },
      "tags": ["movement", "direction"]
    },
    {
      "id": "west",
      "name": "west",
      "aliases": [],
      "category": "Movement",
      "description": "Move west",
      "contexts": ["Exploration"],
      "help": { "usage": "west" },
      "tags": ["movement", "direction"]
    },
    {
      "id": "attack",
      "name": "attack",
      "aliases": ["hit", "strike", "fight"],
      "category": "Combat",
      "description": "Attack a target with your equipped weapon",
      "arguments": [
        {
          "name": "target",
          "type": "Target",
          "description": "Enemy to attack",
          "isRequired": true,
          "displayHint": "<target>"
        },
        {
          "name": "weapon",
          "type": "Item",
          "description": "Weapon to use (default: equipped)",
          "isRequired": false,
          "displayHint": "[with <weapon>]"
        }
      ],
      "contexts": ["Combat"],
      "requiresTarget": true,
      "help": {
        "usage": "attack <target> [with <weapon>]",
        "examples": [
          { "input": "attack goblin", "description": "Attack the goblin with equipped weapon" },
          { "input": "attack goblin with dagger", "description": "Attack using your dagger" },
          { "input": "a goblin", "description": "Shorthand attack" }
        ],
        "notes": "If only one enemy is present, the target can be omitted.",
        "seeAlso": ["defend", "cast", "use", "flee"]
      },
      "tags": ["combat", "offensive", "basic"]
    },
    {
      "id": "defend",
      "name": "defend",
      "aliases": ["block", "guard"],
      "category": "Combat",
      "description": "Take a defensive stance, reducing incoming damage",
      "contexts": ["Combat"],
      "help": {
        "usage": "defend",
        "examples": [
          { "input": "defend", "description": "Raise your guard" }
        ],
        "notes": "Reduces damage from the next attack against you. Effect ends when you take another action.",
        "seeAlso": ["attack", "stance"]
      },
      "tags": ["combat", "defensive"]
    },
    {
      "id": "cast",
      "name": "cast",
      "aliases": ["spell", "invoke"],
      "category": "Combat",
      "description": "Cast a spell or invoke an ability",
      "arguments": [
        {
          "name": "ability",
          "type": "Ability",
          "description": "Spell or ability to use",
          "isRequired": true,
          "displayHint": "<spell>"
        },
        {
          "name": "target",
          "type": "Target",
          "description": "Target of the spell",
          "isRequired": false,
          "displayHint": "[at <target>]"
        }
      ],
      "contexts": ["Combat", "Exploration"],
      "help": {
        "usage": "cast <spell> [at <target>]",
        "examples": [
          { "input": "cast fireball at goblin", "description": "Hurl a fireball at the goblin" },
          { "input": "cast heal", "description": "Cast heal on yourself" },
          { "input": "cast light", "description": "Illuminate the area" }
        ],
        "notes": "Some spells require targets, others affect self or area. Check your spellbook for details.",
        "seeAlso": ["attack", "abilities"]
      },
      "tags": ["combat", "magic", "abilities"]
    },
    {
      "id": "take",
      "name": "take",
      "aliases": ["get", "grab", "pick", "pickup"],
      "category": "Interaction",
      "description": "Pick up an item from the environment",
      "arguments": [
        {
          "name": "quantity",
          "type": "Quantity",
          "description": "How many to take",
          "isRequired": false,
          "defaultValue": "1",
          "displayHint": "[quantity]"
        },
        {
          "name": "item",
          "type": "Item",
          "description": "Item to take",
          "isRequired": true,
          "displayHint": "<item>"
        }
      ],
      "contexts": ["Exploration"],
      "help": {
        "usage": "take [quantity] <item>",
        "examples": [
          { "input": "take sword", "description": "Pick up the sword" },
          { "input": "take 3 potions", "description": "Take three potions" },
          { "input": "take all coins", "description": "Take all available coins" },
          { "input": "get key", "description": "Alias for take" }
        ],
        "notes": "Use 'all' to take everything of that type. Items go to your inventory.",
        "seeAlso": ["drop", "inventory", "look"]
      },
      "tags": ["items", "interaction", "basic"]
    },
    {
      "id": "drop",
      "name": "drop",
      "aliases": ["discard", "throw"],
      "category": "Inventory",
      "description": "Drop an item from your inventory",
      "arguments": [
        {
          "name": "quantity",
          "type": "Quantity",
          "description": "How many to drop",
          "isRequired": false,
          "defaultValue": "1"
        },
        {
          "name": "item",
          "type": "Item",
          "description": "Item to drop",
          "isRequired": true,
          "displayHint": "<item>"
        }
      ],
      "contexts": ["Exploration", "Inventory"],
      "help": {
        "usage": "drop [quantity] <item>",
        "examples": [
          { "input": "drop sword", "description": "Drop the sword" },
          { "input": "drop 5 arrows", "description": "Drop five arrows" }
        ],
        "seeAlso": ["take", "inventory"]
      },
      "tags": ["items", "inventory"]
    },
    {
      "id": "inventory",
      "name": "inventory",
      "aliases": ["inv", "items", "bag", "backpack"],
      "category": "Inventory",
      "description": "View your inventory",
      "contexts": ["Any"],
      "help": {
        "usage": "inventory",
        "examples": [
          { "input": "inventory", "description": "List all items you carry" },
          { "input": "i", "description": "Shorthand" }
        ],
        "notes": "Shows all items, their quantities, and equipped status.",
        "seeAlso": ["equip", "drop", "use"]
      },
      "tags": ["items", "information", "basic"]
    },
    {
      "id": "equip",
      "name": "equip",
      "aliases": ["wear", "wield", "don"],
      "category": "Inventory",
      "description": "Equip an item from your inventory",
      "arguments": [
        {
          "name": "item",
          "type": "Item",
          "description": "Item to equip",
          "isRequired": true,
          "displayHint": "<item>"
        }
      ],
      "contexts": ["Exploration", "Inventory"],
      "help": {
        "usage": "equip <item>",
        "examples": [
          { "input": "equip sword", "description": "Wield the sword" },
          { "input": "wear armor", "description": "Put on armor" }
        ],
        "notes": "Replaces currently equipped item in that slot.",
        "seeAlso": ["unequip", "inventory"]
      },
      "tags": ["items", "equipment"]
    },
    {
      "id": "talk",
      "name": "talk",
      "aliases": ["speak", "converse", "greet"],
      "category": "Interaction",
      "description": "Start a conversation with an NPC",
      "arguments": [
        {
          "name": "npc",
          "type": "NPC",
          "description": "Character to talk to",
          "isRequired": true,
          "displayHint": "<character>"
        }
      ],
      "contexts": ["Exploration"],
      "help": {
        "usage": "talk [to] <character>",
        "examples": [
          { "input": "talk bjorn", "description": "Speak with Bjorn" },
          { "input": "talk to merchant", "description": "Approach the merchant" }
        ],
        "notes": "Opens dialogue mode with the NPC.",
        "seeAlso": ["say", "ask"]
      },
      "tags": ["social", "dialogue", "npc"]
    },
    {
      "id": "say",
      "name": "say",
      "aliases": ["speak"],
      "category": "Social",
      "description": "Say something aloud",
      "arguments": [
        {
          "name": "message",
          "type": "String",
          "description": "What to say",
          "isRequired": true,
          "isVariadic": true,
          "displayHint": "<message>"
        }
      ],
      "contexts": ["Dialogue", "Exploration"],
      "help": {
        "usage": "say <message>",
        "examples": [
          { "input": "say hello there", "description": "Say 'hello there' aloud" }
        ],
        "notes": "NPCs nearby may react to what you say.",
        "seeAlso": ["talk", "whisper", "shout"]
      },
      "tags": ["social", "dialogue"]
    },
    {
      "id": "status",
      "name": "status",
      "aliases": ["stats", "character", "char"],
      "category": "Information",
      "description": "View your character status",
      "contexts": ["Any"],
      "help": {
        "usage": "status",
        "examples": [
          { "input": "status", "description": "View health, stats, and conditions" },
          { "input": "stats", "description": "Alias for status" }
        ],
        "seeAlso": ["inventory", "abilities", "quest"]
      },
      "tags": ["information", "character", "basic"]
    },
    {
      "id": "help",
      "name": "help",
      "aliases": ["commands", "hint"],
      "category": "System",
      "description": "Get help on commands",
      "arguments": [
        {
          "name": "command",
          "type": "String",
          "description": "Command to get help for",
          "isRequired": false,
          "displayHint": "[command]"
        }
      ],
      "contexts": ["Any"],
      "help": {
        "usage": "help [command]",
        "examples": [
          { "input": "help", "description": "List all commands" },
          { "input": "help attack", "description": "Get help on the attack command" },
          { "input": "h look", "description": "Shorthand help for look" }
        ],
        "notes": "Without arguments, shows command categories. With a command name, shows detailed help."
      },
      "tags": ["system", "meta", "basic"]
    },
    {
      "id": "save",
      "name": "save",
      "aliases": [],
      "category": "System",
      "description": "Save your current game",
      "arguments": [
        {
          "name": "slotName",
          "type": "String",
          "description": "Save slot name",
          "isRequired": false,
          "defaultValue": "quicksave",
          "displayHint": "[slot]"
        }
      ],
      "contexts": ["Exploration", "Menu"],
      "help": {
        "usage": "save [slot]",
        "examples": [
          { "input": "save", "description": "Quick save" },
          { "input": "save mysave", "description": "Save to slot 'mysave'" }
        ],
        "notes": "Cannot save during combat.",
        "seeAlso": ["load", "quit"]
      },
      "tags": ["system", "save"]
    },
    {
      "id": "quit",
      "name": "quit",
      "aliases": ["exit", "bye"],
      "category": "System",
      "description": "Quit the game",
      "contexts": ["Any"],
      "help": {
        "usage": "quit",
        "examples": [
          { "input": "quit", "description": "Exit the game" }
        ],
        "notes": "You will be prompted to save if there are unsaved changes."
      },
      "tags": ["system", "exit"]
    },
    {
      "id": "teleport",
      "name": "teleport",
      "aliases": ["tp", "goto"],
      "category": "Debug",
      "description": "Teleport to a location",
      "arguments": [
        {
          "name": "location",
          "type": "Location",
          "description": "Destination location ID",
          "isRequired": true,
          "displayHint": "<location>"
        }
      ],
      "contexts": ["Any"],
      "isHidden": true,
      "help": {
        "usage": "teleport <location>",
        "examples": [
          { "input": "teleport town-square", "description": "Teleport to town square" }
        ],
        "notes": "Debug command. May break quest states if used carelessly."
      },
      "tags": ["debug", "movement"]
    }
  ]
}
```

---

## 13. Logging Specifications

### 13.1 Log Categories

| Category | Level | Description |
|----------|-------|-------------|
| `Command.Load` | Info | Schema loading and parsing events |
| `Command.Parse` | Debug | Command parsing and tokenization |
| `Command.Validate` | Warning/Error | Validation failures |
| `Command.Execute` | Info | Command execution events |
| `Command.Context` | Debug | Context restriction checks |

### 13.2 Log Message Formats

```
[INFO] Command.Load: Loaded {count} commands in {categories} categories
[INFO] Command.Load: Built alias index with {aliasCount} mappings
[DEBUG] Command.Parse: Tokenized input "{input}" → [{tokens}]
[DEBUG] Command.Parse: Resolved "{alias}" → "{command}"
[WARN] Command.Validate: Unknown command "{input}"
[WARN] Command.Validate: Command "{command}" not valid in context "{context}"
[ERROR] Command.Validate: Missing required argument "{argName}" for "{command}"
[INFO] Command.Execute: Executing {command} with args [{args}]
[DEBUG] Command.Context: Context check: {command} in {context} = {allowed}
```

---

## 14. Unit Testing Requirements

### 14.1 Test Matrix

| Test ID | Test Name | Description | Expected Result |
|---------|-----------|-------------|-----------------|
| CMD-001 | ValidSchemaLoads | Load valid commands.json against schema | Loads without errors |
| CMD-002 | InvalidCommandIdRejected | Command ID not matching pattern | Validation error |
| CMD-003 | ArgumentTypeValidation | All 10 argument types parse correctly | Types recognized |
| CMD-004 | ContextRestrictionValidation | Context restrictions enforced | Invalid contexts rejected |
| CMD-005 | AliasUniquenessEnforcement | Duplicate aliases rejected | Validation error |
| CMD-006 | HelpStructureValidation | Help with usage and examples validates | Help parsed correctly |

### 14.2 Test Specifications

#### CMD-001: ValidSchemaLoads

```
GIVEN a valid commands.json file
WHEN validated against commands.schema.json
THEN validation succeeds
AND all commands are parsed
AND alias index is built
AND category list is populated
```

#### CMD-002: InvalidCommandIdRejected

```
GIVEN a command with id "Invalid_ID"
WHEN validated against schema
THEN validation fails
AND error message indicates pattern mismatch
AND error specifies the invalid ID
```

#### CMD-003: ArgumentTypeValidation

```
GIVEN commands with each of the 10 argument types
WHEN parsed and validated
THEN each argument type is recognized
AND type-specific validation rules apply
AND autocomplete flags are respected
```

#### CMD-004: ContextRestrictionValidation

```
GIVEN a command with contexts ["Combat"]
WHEN current context is "Exploration"
THEN command is marked as invalid for context
AND appropriate error is returned

GIVEN a command with contexts ["Any"]
WHEN current context is any value
THEN command is valid
```

#### CMD-005: AliasUniquenessEnforcement

```
GIVEN two commands with overlapping aliases
WHEN validated
THEN validation fails
AND error identifies the duplicate alias
AND both conflicting commands are named
```

#### CMD-006: HelpStructureValidation

```
GIVEN a command with complete help structure
WHEN parsed
THEN usage string is extracted
AND examples are parsed as input/description pairs
AND seeAlso references are validated as command IDs
```

---

## 15. Use Cases

### 15.1 Load Command Configuration

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Load Command Configuration                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: CommandProvider, Configuration System                           │
│ Trigger: Game initialization or configuration reload                     │
│                                                                          │
│ Main Flow:                                                               │
│   1. CommandProvider locates commands.json and commands.schema.json     │
│   2. JSON content is parsed                                              │
│   3. Content is validated against schema                                 │
│   4. Global aliases are indexed                                          │
│   5. Commands are indexed by id and name                                 │
│   6. Alias-to-command mappings are built                                 │
│   7. Category metadata is populated                                      │
│   8. Configuration is cached for runtime access                          │
│                                                                          │
│ Alternate Flow (Validation Failure):                                     │
│   3a. Schema validation fails                                            │
│   3b. Error logged with specific validation failure                      │
│   3c. System falls back to cached configuration or fails startup         │
│                                                                          │
│ Postconditions:                                                          │
│   - All commands accessible by ID or name                                │
│   - Aliases resolve to commands                                          │
│   - Help text available for all commands                                 │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.2 Parse Player Input

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Parse Player Input                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Player, Command Parser                                          │
│ Trigger: Player enters text command                                      │
│                                                                          │
│ Main Flow:                                                               │
│   1. Input string received (e.g., "attack goblin with sword")           │
│   2. String tokenized into words                                         │
│   3. Ignored words filtered out (the, to, with, etc.)                   │
│   4. First token checked against:                                        │
│      a. Global aliases (single-char shortcuts)                          │
│      b. Command names                                                    │
│      c. Command aliases                                                  │
│   5. Command identified                                                  │
│   6. Remaining tokens matched to argument definitions                    │
│   7. Argument types validated                                            │
│   8. ParsedCommand object returned                                       │
│                                                                          │
│ Alternate Flow (Unknown Command):                                        │
│   4a. No matching command found                                          │
│   4b. Suggestions generated from similar names                           │
│   4c. Error returned with suggestions                                    │
│                                                                          │
│ Alternate Flow (Invalid Arguments):                                      │
│   7a. Argument fails type validation                                     │
│   7b. Error returned with expected type/format                           │
│                                                                          │
│ Postconditions:                                                          │
│   - Parsed command ready for execution                                   │
│   - Arguments typed and validated                                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.3 Validate Command Context

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Validate Command in Context                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Command Parser, Game State                                      │
│ Trigger: Command parsed successfully                                     │
│                                                                          │
│ Main Flow:                                                               │
│   1. Current game context retrieved (Exploration, Combat, etc.)         │
│   2. Command's allowed contexts checked                                  │
│   3. If contexts includes "Any" → valid                                  │
│   4. If contexts includes current context → valid                        │
│   5. Command marked as valid for execution                               │
│                                                                          │
│ Alternate Flow (Context Mismatch):                                       │
│   3a. Current context not in allowed contexts                            │
│   3b. Error generated: "You can't {command} right now"                  │
│   3c. Hint provided about when command is valid                          │
│                                                                          │
│ Context Examples:                                                        │
│   - "attack" in Exploration → "You're not in combat"                    │
│   - "save" in Combat → "Cannot save during battle"                      │
│   - "help" anywhere → Always valid                                       │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.4 Display Command Help

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Display Command Help                                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Player, Help System                                             │
│ Trigger: Player enters "help" or "help <command>"                       │
│                                                                          │
│ Main Flow (No Argument):                                                 │
│   1. Group commands by category                                          │
│   2. Filter out hidden commands (isHidden = true)                       │
│   3. Sort categories by sortOrder                                        │
│   4. Display category headers with descriptions                          │
│   5. List commands with brief descriptions                               │
│                                                                          │
│ Main Flow (With Command):                                                │
│   1. Resolve command by name/alias                                       │
│   2. Display command name and aliases                                    │
│   3. Display description                                                 │
│   4. Display usage pattern from help.usage                               │
│   5. Display examples with input/description                             │
│   6. Display notes if present                                            │
│   7. Display "See Also" links to related commands                        │
│                                                                          │
│ Example Output:                                                          │
│   ATTACK - Attack a target with your equipped weapon                     │
│   Aliases: hit, strike, fight, a                                        │
│   Usage: attack <target> [with <weapon>]                                │
│                                                                          │
│   Examples:                                                              │
│     attack goblin - Attack the goblin with equipped weapon              │
│     attack goblin with dagger - Attack using your dagger                │
│                                                                          │
│   See also: defend, cast, flee                                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.5 Autocomplete Suggestions

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Provide Autocomplete Suggestions                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Player, Autocomplete System                                     │
│ Trigger: Player types partial input                                      │
│                                                                          │
│ Main Flow (Command Completion):                                          │
│   1. Player types "att"                                                  │
│   2. Search command names and aliases starting with "att"               │
│   3. Return matches: ["attack"]                                         │
│   4. Display suggestion to player                                        │
│                                                                          │
│ Main Flow (Argument Completion):                                         │
│   1. Player types "attack g"                                             │
│   2. Command identified as "attack"                                      │
│   3. Current argument identified as "target" (type: Target)             │
│   4. Query visible targets starting with "g"                            │
│   5. Return matches: ["goblin", "guard"]                                │
│   6. Display suggestions to player                                       │
│                                                                          │
│ Argument Type Completion Sources:                                        │
│   - Target: Visible entities (enemies, objects)                          │
│   - Item: Player inventory                                               │
│   - Ability: Available abilities/spells                                  │
│   - NPC: Known character names                                           │
│   - Location: Discovered locations                                       │
│   - Direction: Cardinal directions                                       │
│                                                                          │
│ Postconditions:                                                          │
│   - Relevant suggestions displayed                                       │
│   - Player can complete with Tab or select                               │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 16. Deliverable Checklist

### Configuration Files

| Item | Status | Notes |
|------|--------|-------|
| `commands.schema.json` | Pending | JSON Schema Draft-07 validation |
| `commands.json` | Pending | Command definitions |

### Schema Definitions

| Item | Status | Notes |
|------|--------|-------|
| `Command` | Defined | Section 5 |
| `CommandArgument` | Defined | Section 6 |
| `ArgumentType` (10 types) | Defined | Section 7 |
| `CommandCategory` (8 categories) | Defined | Section 8 |
| `CommandContext` (9 contexts) | Defined | Section 9 |
| `CommandHelp` | Defined | Section 10 |

### Unit Tests

| Item | Status | Notes |
|------|--------|-------|
| CMD-001: ValidSchemaLoads | Pending | Schema validation |
| CMD-002: InvalidCommandIdRejected | Pending | ID pattern enforcement |
| CMD-003: ArgumentTypeValidation | Pending | All 10 types |
| CMD-004: ContextRestrictionValidation | Pending | Context checking |
| CMD-005: AliasUniquenessEnforcement | Pending | Duplicate detection |
| CMD-006: HelpStructureValidation | Pending | Help parsing |

---

## 17. Acceptance Criteria

### Functional Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| AC-01 | Schema validates Command definitions | Run test CMD-001 |
| AC-02 | Command IDs follow kebab-case pattern | Run test CMD-002 |
| AC-03 | All 10 argument types supported | Run test CMD-003 |
| AC-04 | All 8 command categories defined | Inspect configuration |
| AC-05 | All 9 context restrictions defined | Inspect configuration |
| AC-06 | Aliases are unique across commands | Run test CMD-005 |
| AC-07 | Help structure includes usage and examples | Run test CMD-006 |
| AC-08 | Global aliases map to valid commands | Inspect configuration |
| AC-09 | Hidden commands excluded from help listings | Inspect isHidden behavior |
| AC-10 | Variadic arguments only at end of list | Schema validation |

### Quality Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| QC-01 | Schema follows JSON Schema Draft-07 | Schema linter validation |
| QC-02 | All properties have descriptions | Manual inspection |
| QC-03 | Examples provided for usage patterns | Manual inspection |
| QC-04 | Default values documented | Manual inspection |
| QC-05 | Consistent naming conventions | Manual inspection |

---

## 18. Dependencies

### Required From

| Version | Component | Usage |
|---------|-----------|-------|
| None | - | Command Schema has no external dependencies |

### Provides To

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.x | Command Parser | Runtime parsing and execution |
| v0.15.x | Help System | Command documentation display |
| v0.15.x | Autocomplete | Suggestion generation |
| v0.15.x | Context Manager | Context restriction validation |

---

## 19. Future Considerations

### Deferred to Future Versions

| Feature | Rationale |
|---------|-----------|
| Command macros | Runtime complexity beyond schema scope |
| Conditional commands | Scripting system not yet defined |
| Localized commands | Localization system separate concern |
| Voice command mapping | Input system beyond current scope |
| Command history | Runtime feature |

### Extension Points

| Extension | Mechanism |
|-----------|-----------|
| Custom argument types | Additional entries in ArgumentType enum |
| New command categories | Extend CommandCategory enum |
| Additional contexts | Extend CommandContext enum |
| Command plugins | Metadata extensibility via tags |
| Chaining rules | canChain flag with custom separator |

---

## 20. Appendix

### A. ID Pattern Reference

| Entity | Pattern | Example |
|--------|---------|---------|
| Command ID | `[a-z][a-z0-9-]*` | `look`, `go-north`, `attack` |
| Argument Name | `[a-z][a-zA-Z0-9]*` | `target`, `itemName`, `quantity` |
| Category | `CommandCategory` enum | `Movement`, `Combat` |
| Context | `CommandContext` enum | `Exploration`, `Combat` |

### B. Standard Shorthand Aliases

| Alias | Command | Notes |
|-------|---------|-------|
| `l` | look | View surroundings |
| `x` | examine | Detailed inspection |
| `n` | north | Move north |
| `s` | south | Move south |
| `e` | east | Move east |
| `w` | west | Move west |
| `u` | up | Climb up |
| `d` | down | Descend |
| `i` | inventory | View items |
| `a` | attack | Basic attack |
| `h` | help | Get help |
| `q` | quit | Exit game |

### C. Direction Values Reference

```
Primary Cardinals:
  north (n), south (s), east (e), west (w)

Diagonals:
  northeast (ne), northwest (nw), southeast (se), southwest (sw)

Vertical:
  up (u), down (d)

Relative:
  in, out, enter, exit, leave
  left (l), right (r)
  back, forward, ahead
```

### D. Example Parse Flow

```
Input: "attack the goblin with my sword"

Step 1: Tokenize
  ["attack", "the", "goblin", "with", "my", "sword"]

Step 2: Filter ignored words
  ["attack", "goblin", "sword"]
  (removed: "the", "with", "my")

Step 3: Identify command
  "attack" → Command { id: "attack", ... }

Step 4: Match arguments
  Argument 1 (target): "goblin" → Target
  Argument 2 (weapon): "sword" → Item

Step 5: Validate context
  Current: Combat ✓
  Command contexts: ["Combat"] ✓

Step 6: Return ParsedCommand
  {
    command: "attack",
    arguments: {
      target: "goblin",
      weapon: "sword"
    },
    valid: true
  }
```

---

*End of v0.14.10d Design Specification*
