{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Abilities Configuration",
  "description": "Schema for ability definitions in Rune & Rust. Supports combo chains, prerequisites, AoE parameters, and charge-based abilities.",
  "type": "object",
  "required": [
    "abilities"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to the JSON schema file for validation"
    },
    "abilities": {
      "type": "array",
      "description": "List of ability definitions",
      "items": {
        "$ref": "#/definitions/Ability"
      },
      "minItems": 1
    }
  },
  "additionalProperties": false,
  "definitions": {
    "Ability": {
      "type": "object",
      "description": "A single ability definition",
      "required": [
        "id",
        "name",
        "description",
        "classIds",
        "targetType"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique identifier for the ability (lowercase, kebab-case)",
          "minLength": 1,
          "maxLength": 50
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Display name shown to players"
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "maxLength": 500,
          "description": "Full description of the ability"
        },
        "classIds": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "minItems": 1,
          "description": "Classes that can use this ability"
        },
        "costResource": {
          "type": "string",
          "description": "Resource type for the cost (e.g., mana, rage, energy, focus, faith)"
        },
        "costAmount": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Amount of resource required"
        },
        "cooldown": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Turns between uses (0 = no cooldown). Ignored if charges is defined."
        },
        "targetType": {
          "type": "string",
          "enum": [
            "Self",
            "SingleEnemy",
            "SingleAlly",
            "AllEnemies",
            "AllAllies",
            "Area",
            "Cone",
            "Line",
            "None"
          ],
          "description": "Valid target type for this ability"
        },
        "unlockLevel": {
          "type": "integer",
          "minimum": 1,
          "default": 1,
          "description": "Level required to unlock this ability"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "uniqueItems": true,
          "description": "Tags for categorization and filtering"
        },
        "effects": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Effect"
          },
          "description": "Effects applied when the ability is used"
        },
        "comboChain": {
          "$ref": "#/definitions/ComboChain",
          "description": "Configuration for chaining this ability into another"
        },
        "prerequisites": {
          "$ref": "#/definitions/Prerequisites",
          "description": "Requirements that must be met to unlock or use this ability"
        },
        "aoeParameters": {
          "$ref": "#/definitions/AoEParameters",
          "description": "Parameters for area-of-effect abilities"
        },
        "charges": {
          "$ref": "#/definitions/ChargeConfig",
          "description": "Configuration for charge-based abilities"
        }
      },
      "additionalProperties": false,
      "allOf": [
        {
          "if": {
            "properties": {
              "targetType": {
                "const": "Area"
              }
            }
          },
          "then": {
            "required": [
              "aoeParameters"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "targetType": {
                "const": "Cone"
              }
            }
          },
          "then": {
            "required": [
              "aoeParameters"
            ],
            "properties": {
              "aoeParameters": {
                "properties": {
                  "shape": {
                    "const": "Cone"
                  }
                },
                "required": [
                  "coneAngle"
                ]
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "targetType": {
                "const": "Line"
              }
            }
          },
          "then": {
            "required": [
              "aoeParameters"
            ],
            "properties": {
              "aoeParameters": {
                "properties": {
                  "shape": {
                    "const": "Line"
                  }
                },
                "required": [
                  "lineLength"
                ]
              }
            }
          }
        }
      ]
    },
    "Effect": {
      "type": "object",
      "description": "An effect applied by an ability",
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "Damage",
            "Heal",
            "Buff",
            "Debuff",
            "DamageOverTime",
            "HealOverTime",
            "Shield",
            "ResourceGain",
            "CooldownReset",
            "Taunt",
            "Stun",
            "Summon",
            "Teleport"
          ],
          "description": "The type of effect"
        },
        "value": {
          "type": "integer",
          "default": 0,
          "description": "Base value for the effect (damage, heal amount, etc.)"
        },
        "duration": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Duration in turns (0 = instant)"
        },
        "statusEffect": {
          "type": "string",
          "description": "Status effect to apply (e.g., poison, stun, slow)"
        },
        "chance": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 1.0,
          "description": "Success chance (0.0 to 1.0)"
        },
        "scalingStat": {
          "type": "string",
          "enum": [
            "attack",
            "defense",
            "might",
            "fortitude",
            "will",
            "wits",
            "finesse"
          ],
          "description": "Stat that scales the effect value"
        },
        "scalingMultiplier": {
          "type": "number",
          "default": 0,
          "description": "Multiplier for stat scaling"
        },
        "description": {
          "type": "string",
          "description": "Override description for the effect"
        }
      },
      "additionalProperties": false
    },
    "ComboChain": {
      "type": "object",
      "description": "Configuration for chaining this ability into another",
      "properties": {
        "nextAbilityId": {
          "type": "string",
          "description": "ID of the ability that can follow this one in the combo chain",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "comboWindowTurns": {
          "type": "integer",
          "description": "Number of turns the player has to use the next ability",
          "minimum": 1,
          "default": 1
        },
        "comboBonusDamage": {
          "type": "number",
          "description": "Percentage bonus damage when combo continues (0.25 = +25%)",
          "minimum": 0,
          "maximum": 2.0,
          "default": 0
        }
      },
      "additionalProperties": false
    },
    "Prerequisites": {
      "type": "object",
      "description": "Requirements that must be met to unlock or use this ability",
      "properties": {
        "requiredLevel": {
          "type": "integer",
          "description": "Minimum character level required",
          "minimum": 1
        },
        "requiredClassIds": {
          "type": "array",
          "description": "List of class IDs that can use this ability (OR logic)",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "minItems": 1
        },
        "requiredAbilityIds": {
          "type": "array",
          "description": "Abilities that must be learned first (AND logic)",
          "items": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "minItems": 1
        },
        "requiredArchetypeId": {
          "type": "string",
          "description": "Archetype that must match the character's class archetype",
          "pattern": "^[a-z][a-z0-9-]*$"
        }
      },
      "additionalProperties": false
    },
    "AoEParameters": {
      "type": "object",
      "description": "Parameters for area-of-effect abilities",
      "properties": {
        "radius": {
          "type": "integer",
          "description": "Radius of the effect in grid tiles",
          "minimum": 1,
          "maximum": 10
        },
        "shape": {
          "type": "string",
          "description": "Shape of the area of effect",
          "enum": [
            "Circle",
            "Square",
            "Cone",
            "Line"
          ]
        },
        "coneAngle": {
          "type": "integer",
          "description": "Angle of the cone in degrees (for Cone shape)",
          "minimum": 15,
          "maximum": 180
        },
        "lineLength": {
          "type": "integer",
          "description": "Length of the line in tiles (for Line shape)",
          "minimum": 1,
          "maximum": 20
        },
        "includeOrigin": {
          "type": "boolean",
          "description": "Whether the caster's tile is included in the effect",
          "default": false
        }
      },
      "required": [
        "shape"
      ],
      "additionalProperties": false
    },
    "ChargeConfig": {
      "type": "object",
      "description": "Configuration for charge-based abilities",
      "properties": {
        "maxCharges": {
          "type": "integer",
          "description": "Maximum number of charges this ability can hold",
          "minimum": 1,
          "maximum": 10
        },
        "chargeRegenTurns": {
          "type": "integer",
          "description": "Number of turns to regenerate one charge",
          "minimum": 1
        },
        "startingCharges": {
          "type": "integer",
          "description": "Charges available at combat start (defaults to maxCharges)",
          "minimum": 0
        }
      },
      "required": [
        "maxCharges",
        "chargeRegenTurns"
      ],
      "additionalProperties": false
    }
  }
}