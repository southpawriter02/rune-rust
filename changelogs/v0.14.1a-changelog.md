# v0.14.1a Changelog - Ability Schema Expansion

**Version:** 0.14.1a
**Date:** 2026-01-21
**Theme:** Combat Configuration Schemas - Ability Schema Expansion

---

## Overview

This version expands `abilities.schema.json` to support advanced ability mechanics: combo chains, prerequisites, area-of-effect parameters, and charge-based abilities. All new fields are optional, maintaining full backwards compatibility with existing `abilities.json`.

---

## Added

### Schema Definitions
- **`ComboChain`** - Configuration for chaining abilities together
  - `nextAbilityId` (string, kebab-case) - ID of the next ability in chain
  - `comboWindowTurns` (integer, min: 1, default: 1) - Turns to continue combo
  - `comboBonusDamage` (number, 0-2.0, default: 0) - Bonus damage multiplier

- **`Prerequisites`** - Requirements for unlocking/using abilities
  - `requiredLevel` (integer, min: 1) - Minimum character level
  - `requiredClassIds` (array) - Class requirements (OR logic)
  - `requiredAbilityIds` (array) - Ability requirements (AND logic)
  - `requiredArchetypeId` (string) - Archetype requirement

- **`AoEParameters`** - Area-of-effect configuration
  - `radius` (integer, 1-10) - Effect radius in tiles
  - `shape` (enum: Circle, Square, Cone, Line) - Effect shape
  - `coneAngle` (integer, 15-180) - Cone angle in degrees
  - `lineLength` (integer, 1-20) - Line length in tiles
  - `includeOrigin` (boolean, default: false) - Include caster's tile

- **`ChargeConfig`** - Charge-based ability configuration
  - `maxCharges` (integer, 1-10) - Maximum charges
  - `chargeRegenTurns` (integer, min: 1) - Turns per charge regeneration
  - `startingCharges` (integer, default: maxCharges) - Initial charges

### Target Type Expansion
- Added `Cone` and `Line` to `targetType` enum
- Conditional validation: Cone/Line require `aoeParameters`

### Unit Tests
- **`AbilitySchemaExpansionTests.cs`** - 6 tests
  - `Schema_IsValidJsonSchemaDraft07` - Validates schema structure
  - `ExistingAbilitiesJson_ValidatesAgainstExpandedSchema` - Backwards compatibility
  - `ComboChain_ValidConfiguration_PassesValidation` - Combo chain validation
  - `Prerequisites_ValidConfiguration_PassesValidation` - Prerequisites validation
  - `ConeAbility_WithValidAoEParameters_PassesValidation` - AoE validation
  - `ChargeConfig_ValidConfiguration_PassesValidation` - Charge config validation

---

## Technical Details

### Schema Structure
```
abilities.schema.json
├── definitions/
│   ├── Ability (restructured with $ref)
│   ├── Effect (renamed from 'effect')
│   ├── ComboChain (NEW)
│   ├── Prerequisites (NEW)
│   ├── AoEParameters (NEW)
│   └── ChargeConfig (NEW)
```

### Expanded Target Types
| Type | Description | Requires |
|------|-------------|----------|
| `Cone` | Cone from caster | aoeParameters with coneAngle |
| `Line` | Line from caster | aoeParameters with lineLength |

---

## Verification

- Build: ✅ 0 errors, 0 warnings
- Ability Schema Tests: ✅ 6/6 passing
- All Schema Tests: ✅ 28/28 passing
- Backwards Compatibility: ✅ Existing abilities.json validates
