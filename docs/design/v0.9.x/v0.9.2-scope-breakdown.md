# v0.9.2 UI & Interaction Sounds - Scope Breakdown

**Version:** 0.9.2
**Theme:** Sound Effects
**Prerequisites:** v0.9.1c Complete (Music System - Theme Transitions)
**Total Estimated Tests:** ~20 new tests

---

## Executive Summary

The Sound Effects sub-version implements sound effects (SFX) for combat, UI interactions, items, puzzles, and movement. Sound effects are triggered by game events and provide immediate audio feedback for player actions. The system supports multiple simultaneous effects, randomized variations, and configurable volume.

Key focus areas:
- **Sound Effect Service**: ISoundEffectService with categorized playback
- **Combat & Ability Sounds**: Attack, damage, death, and spell effects
- **UI & Interaction Sounds**: Buttons, items, puzzles, movement

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.9.2a | Sound Effect Service | ISoundEffectService, SoundEffectService, categories | ~8 |
| v0.9.2b | Combat & Ability Sounds | Attack, damage, death, ability effects | ~6 |
| v0.9.1c | UI & Interaction Sounds | UI clicks, items, puzzles, movement, triggers | ~6 |

---

## Existing Infrastructure

### Already Implemented (from v0.9.2)

| Feature | Location | Notes |
|---------|----------|-------|
| IAudioService | `Application/Interfaces/IAudioService.cs` | Core playback |
| AudioService | `Infrastructure/Services/AudioService.cs` | Audio player |
| AudioChannel.Effects | `Application/Enums/AudioChannel.cs` | SFX channel |
| IMusicService | `Application/Interfaces/IMusicService.cs` | Music (separate) |

### Already Implemented (from prior versions)

| Feature | Location | Notes |
|---------|----------|-------|
| EventBus | `Application/Services/EventBus.cs` | Event system |
| CombatService | `Application/Services/CombatService.cs` | Combat events |
| InventoryService | `Application/Services/InventoryService.cs` | Item events |
| PuzzleService | `Application/Services/PuzzleService.cs` | Puzzle events |

### Needs Implementation (v0.9.2)

| Feature | Part | Notes |
|---------|------|-------|
| ISoundEffectService | v0.9.2a | SFX interface |
| SoundEffectService | v0.9.2a | SFX player |
| SoundEffectConfig | v0.9.2a | Sound definitions |
| CombatSoundHandler | v0.9.2b | Combat event triggers |
| AbilitySoundHandler | v0.9.2b | Ability event triggers |
| UISoundHandler | v0.9.1c | UI event triggers |
| InteractionSoundHandler | v0.9.1c | Item/puzzle triggers |

---

## Feature Analysis & Categorization

### Core SFX Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| SFX playback | Medium | AudioService | **v0.9.2a** |
| Category management | Low | Config | **v0.9.2a** |
| Randomized variations | Low | Random | **v0.9.2a** |
| Volume per category | Low | Settings | **v0.9.2a** |
| Concurrent sounds | Medium | Audio mixing | **v0.9.2a** |
| Preload categories | Low | Cache | **v0.9.2a** |

### Combat & Ability Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Attack hit sounds | Low | Combat events | **v0.9.2b** |
| Attack miss sounds | Low | Combat events | **v0.9.2b** |
| Critical hit sounds | Low | Combat events | **v0.9.2b** |
| Damage type sounds | Medium | Damage config | **v0.9.2b** |
| Death sounds | Low | Combat events | **v0.9.2b** |
| Ability cast sounds | Medium | Ability events | **v0.9.2b** |

### UI & Interaction Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Button clicks | Low | UI events | **v0.9.1c** |
| Menu open/close | Low | UI events | **v0.9.1c** |
| Item pickup | Low | Item events | **v0.9.1c** |
| Item equip/use | Low | Item events | **v0.9.1c** |
| Puzzle feedback | Medium | Puzzle events | **v0.9.1c** |
| Movement sounds | Low | Movement events | **v0.9.1c** |

---

## Part Definitions

---

## v0.9.2a: Sound Effect Service

[v0.9.2a Design Specification](v0.9.2a-design-specification.md)

### Overview

Implement the core sound effect service that manages SFX playback across the application. This includes the ISoundEffectService interface, SoundEffectService implementation, category-based organization, randomized sound variations, and configuration loading.

### Scope

**In Scope:**
- `ISoundEffectService` interface definition
- `SoundEffectService` implementation
- Play by effect ID
- Play random from category
- Stop all effects
- Volume control (via AudioChannel.Effects)
- Sound effect categories (combat, ui, items, puzzle, movement, ability)
- Randomized sound selection
- `sound-effects.json` configuration
- Effect definition with multiple files
- Preload by category
- Max simultaneous sounds limit

**Out of Scope:**
- Combat/ability sounds (v0.9.2b)
- UI/interaction sounds (v0.9.1c)
- Spatial audio (future enhancement)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Interfaces | 1 | `ISoundEffectService` |
| Services | 1 | `SoundEffectService` |
| Configuration | 1 | `sound-effects.json` |
| Unit Tests | ~8 | Playback, randomization tests |

### Sound Effect Service Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOUND EFFECT SERVICE ARCHITECTURE                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚      Game Systems          â”‚
                        â”‚   (Combat, UI, Items)      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ISoundEffectService      â”‚
                        â”‚  - Play(effectId)          â”‚
                        â”‚  - PlayRandom(category)    â”‚
                        â”‚  - SetVolume(vol)          â”‚
                        â”‚  - Preload(category)       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    SoundEffectService      â”‚
                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”‚ + Categories:             â”‚
                        â”‚   - combat                â”‚
                        â”‚   - ui                    â”‚
                        â”‚   - items                 â”‚
                        â”‚   - puzzle                â”‚
                        â”‚   - movement              â”‚
                        â”‚   - ability               â”‚
                        â”‚                           â”‚
                        â”‚ + EffectConfig            â”‚
                        â”‚   - Effect definitions    â”‚
                        â”‚   - Randomization         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚      IAudioService         â”‚
                        â”‚   (AudioChannel.Effects)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ISoundEffectService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Manages sound effect playback across the application.
/// </summary>
public interface ISoundEffectService
{
    /// <summary>Plays a sound effect by its ID.</summary>
    /// <param name="effectId">The effect ID (e.g., "attack-hit", "button-click").</param>
    /// <param name="volume">Optional volume multiplier (0.0-1.0).</param>
    void Play(string effectId, float volume = 1.0f);
    
    /// <summary>Plays a random sound from a category.</summary>
    /// <param name="category">The category (e.g., "combat", "ui").</param>
    /// <param name="volume">Optional volume multiplier.</param>
    void PlayRandom(string category, float volume = 1.0f);
    
    /// <summary>Plays a sound at a grid position (for spatial mixing).</summary>
    /// <param name="effectId">The effect ID.</param>
    /// <param name="position">Grid position for spatial calculation.</param>
    /// <param name="volume">Optional volume multiplier.</param>
    void PlayAt(string effectId, GridPosition position, float volume = 1.0f);
    
    /// <summary>Stops all currently playing effects.</summary>
    void StopAll();
    
    /// <summary>Sets the global effects volume.</summary>
    void SetVolume(float volume);
    
    /// <summary>Gets the global effects volume.</summary>
    float GetVolume();
    
    /// <summary>Preloads all effects in a category.</summary>
    Task PreloadCategoryAsync(string category, CancellationToken ct = default);
    
    /// <summary>Gets all available effect IDs.</summary>
    IReadOnlyList<string> GetAvailableEffects();
    
    /// <summary>Gets all categories.</summary>
    IReadOnlyList<string> GetCategories();
}
```

### SoundEffectService Implementation

```csharp
namespace RuneAndRust.Infrastructure.Services;

public class SoundEffectService : ISoundEffectService
{
    private readonly IAudioService _audioService;
    private readonly ISoundEffectConfig _config;
    private readonly ILogger<SoundEffectService> _logger;
    private readonly Random _random = new();
    private readonly List<Guid> _activePlaybacks = new();
    
    private const int MaxSimultaneousSounds = 8;
    
    public SoundEffectService(
        IAudioService audioService, 
        ISoundEffectConfig config,
        ILogger<SoundEffectService> logger)
    {
        _audioService = audioService;
        _config = config;
        _logger = logger;
    }
    
    public void Play(string effectId, float volume = 1.0f)
    {
        var effect = _config.GetEffect(effectId);
        if (effect is null)
        {
            _logger.LogWarning("Sound effect not found: {EffectId}", effectId);
            return;
        }
        
        // Enforce max simultaneous sounds
        CleanupFinishedPlaybacks();
        if (_activePlaybacks.Count >= MaxSimultaneousSounds)
        {
            _logger.LogDebug("Max simultaneous sounds reached, skipping: {EffectId}", effectId);
            return;
        }
        
        // Select file (random if multiple)
        var file = effect.Files.Count > 1 && effect.Randomize
            ? effect.Files[_random.Next(effect.Files.Count)]
            : effect.Files[0];
        
        var effectiveVolume = effect.Volume * volume;
        var playbackId = _audioService.Play(file, AudioChannel.Effects, effectiveVolume, loop: false);
        
        if (playbackId != Guid.Empty)
        {
            _activePlaybacks.Add(playbackId);
        }
        
        _logger.LogDebug("Playing SFX: {EffectId} -> {File}", effectId, file);
    }
    
    public void PlayRandom(string category, float volume = 1.0f)
    {
        var effects = _config.GetEffectsInCategory(category);
        if (effects.Count == 0)
        {
            _logger.LogWarning("No effects in category: {Category}", category);
            return;
        }
        
        var effectId = effects[_random.Next(effects.Count)];
        Play(effectId, volume);
    }
    
    public void PlayAt(string effectId, GridPosition position, float volume = 1.0f)
    {
        // Simple spatial: adjust volume based on distance from player
        // For now, just play normally (spatial is optional enhancement)
        Play(effectId, volume);
    }
    
    public void StopAll()
    {
        foreach (var id in _activePlaybacks)
        {
            _audioService.Stop(id);
        }
        _activePlaybacks.Clear();
        
        _logger.LogDebug("Stopped all sound effects");
    }
    
    public void SetVolume(float volume)
    {
        _audioService.SetChannelVolume(AudioChannel.Effects, Math.Clamp(volume, 0f, 1f));
    }
    
    public float GetVolume()
    {
        return _audioService.GetChannelVolume(AudioChannel.Effects);
    }
    
    public async Task PreloadCategoryAsync(string category, CancellationToken ct = default)
    {
        var effects = _config.GetEffectsInCategory(category);
        var files = effects.SelectMany(e => _config.GetEffect(e)?.Files ?? Enumerable.Empty<string>());
        
        await _audioService.PreloadAsync(files, ct);
        _logger.LogDebug("Preloaded category: {Category}", category);
    }
    
    public IReadOnlyList<string> GetAvailableEffects()
    {
        return _config.GetAllEffectIds();
    }
    
    public IReadOnlyList<string> GetCategories()
    {
        return _config.GetAllCategories();
    }
    
    private void CleanupFinishedPlaybacks()
    {
        _activePlaybacks.RemoveAll(id => !_audioService.IsPlaying(id));
    }
}
```

### Sound Effects Configuration

```json
{
  "$schema": "./schemas/sound-effects.schema.json",
  "categories": {
    "combat": {
      "effects": {
        "attack-hit": {
          "files": [
            "audio/sfx/combat/hit_01.ogg",
            "audio/sfx/combat/hit_02.ogg",
            "audio/sfx/combat/hit_03.ogg"
          ],
          "volume": 0.8,
          "randomize": true
        },
        "attack-miss": {
          "files": ["audio/sfx/combat/whoosh.ogg"],
          "volume": 0.6,
          "randomize": false
        },
        "attack-critical": {
          "files": ["audio/sfx/combat/critical_hit.ogg"],
          "volume": 1.0,
          "randomize": false
        },
        "attack-blocked": {
          "files": ["audio/sfx/combat/block_01.ogg", "audio/sfx/combat/block_02.ogg"],
          "volume": 0.7,
          "randomize": true
        },
        "damage-fire": {
          "files": ["audio/sfx/combat/fire_damage.ogg"],
          "volume": 0.8,
          "randomize": false
        },
        "damage-ice": {
          "files": ["audio/sfx/combat/ice_damage.ogg"],
          "volume": 0.8,
          "randomize": false
        },
        "damage-lightning": {
          "files": ["audio/sfx/combat/lightning_damage.ogg"],
          "volume": 0.9,
          "randomize": false
        },
        "death-player": {
          "files": ["audio/sfx/combat/player_death.ogg"],
          "volume": 1.0,
          "randomize": false
        },
        "death-monster": {
          "files": ["audio/sfx/combat/monster_death_01.ogg", "audio/sfx/combat/monster_death_02.ogg"],
          "volume": 0.9,
          "randomize": true
        }
      }
    },
    "ability": {
      "effects": {
        "ability-cast": {
          "files": ["audio/sfx/ability/cast_generic.ogg"],
          "volume": 0.7,
          "randomize": false
        },
        "ability-fire": {
          "files": ["audio/sfx/ability/fire_cast.ogg"],
          "volume": 0.8,
          "randomize": false
        },
        "ability-ice": {
          "files": ["audio/sfx/ability/ice_cast.ogg"],
          "volume": 0.8,
          "randomize": false
        },
        "ability-heal": {
          "files": ["audio/sfx/ability/heal_cast.ogg"],
          "volume": 0.7,
          "randomize": false
        },
        "ability-buff": {
          "files": ["audio/sfx/ability/buff_apply.ogg"],
          "volume": 0.6,
          "randomize": false
        }
      }
    },
    "ui": {
      "effects": {
        "button-click": {
          "files": ["audio/sfx/ui/click.ogg"],
          "volume": 0.5,
          "randomize": false
        },
        "button-hover": {
          "files": ["audio/sfx/ui/hover.ogg"],
          "volume": 0.3,
          "randomize": false
        },
        "menu-open": {
          "files": ["audio/sfx/ui/menu_open.ogg"],
          "volume": 0.4,
          "randomize": false
        },
        "menu-close": {
          "files": ["audio/sfx/ui/menu_close.ogg"],
          "volume": 0.4,
          "randomize": false
        },
        "notification": {
          "files": ["audio/sfx/ui/notification.ogg"],
          "volume": 0.6,
          "randomize": false
        },
        "error": {
          "files": ["audio/sfx/ui/error.ogg"],
          "volume": 0.7,
          "randomize": false
        }
      }
    },
    "items": {
      "effects": {
        "item-pickup": {
          "files": ["audio/sfx/items/pickup.ogg"],
          "volume": 0.7,
          "randomize": false
        },
        "item-drop": {
          "files": ["audio/sfx/items/drop.ogg"],
          "volume": 0.6,
          "randomize": false
        },
        "item-equip": {
          "files": ["audio/sfx/items/equip.ogg"],
          "volume": 0.7,
          "randomize": false
        },
        "item-use": {
          "files": ["audio/sfx/items/use_potion.ogg"],
          "volume": 0.7,
          "randomize": false
        },
        "gold-coins": {
          "files": ["audio/sfx/items/coins.ogg"],
          "volume": 0.6,
          "randomize": false
        }
      }
    },
    "puzzle": {
      "effects": {
        "puzzle-correct": {
          "files": ["audio/sfx/puzzle/correct.ogg"],
          "volume": 0.8,
          "randomize": false
        },
        "puzzle-incorrect": {
          "files": ["audio/sfx/puzzle/incorrect.ogg"],
          "volume": 0.7,
          "randomize": false
        },
        "puzzle-complete": {
          "files": ["audio/sfx/puzzle/fanfare.ogg"],
          "volume": 1.0,
          "randomize": false
        },
        "puzzle-hint": {
          "files": ["audio/sfx/puzzle/hint.ogg"],
          "volume": 0.6,
          "randomize": false
        },
        "lever-pull": {
          "files": ["audio/sfx/puzzle/lever.ogg"],
          "volume": 0.7,
          "randomize": false
        }
      }
    },
    "movement": {
      "effects": {
        "footstep-stone": {
          "files": [
            "audio/sfx/movement/step_stone_01.ogg",
            "audio/sfx/movement/step_stone_02.ogg",
            "audio/sfx/movement/step_stone_03.ogg"
          ],
          "volume": 0.4,
          "randomize": true
        },
        "footstep-wood": {
          "files": [
            "audio/sfx/movement/step_wood_01.ogg",
            "audio/sfx/movement/step_wood_02.ogg"
          ],
          "volume": 0.4,
          "randomize": true
        },
        "door-open": {
          "files": ["audio/sfx/movement/door_open.ogg"],
          "volume": 0.6,
          "randomize": false
        },
        "door-close": {
          "files": ["audio/sfx/movement/door_close.ogg"],
          "volume": 0.5,
          "randomize": false
        },
        "chest-open": {
          "files": ["audio/sfx/movement/chest_open.ogg"],
          "volume": 0.7,
          "randomize": false
        }
      }
    }
  },
  "settings": {
    "maxSimultaneous": 8,
    "defaultVolume": 0.8
  }
}
```

### Acceptance Criteria

- [ ] SoundEffectService can play effects by ID
- [ ] PlayRandom selects from category
- [ ] Randomized files cycle through options
- [ ] Max simultaneous sounds enforced
- [ ] Volume control works
- [ ] Categories are loaded from config
- [ ] Preload caches category files
- [ ] GetAvailableEffects lists all IDs
- [ ] Missing effects log warning
- [ ] StopAll stops all active effects
- [ ] ~8 unit tests pass

---

## v0.9.2b: Combat & Ability Sounds

[v0.9.2b Design Specification](v0.9.2b-design-specification.md)

### Overview

Implement event handlers that trigger combat and ability sound effects. Combat sounds include attack hits, misses, criticals, damage types, and deaths. Ability sounds include casting effects for different spell schools.

### Scope

**In Scope:**
- `CombatSoundHandler` event handler
- Attack hit sounds (with variations)
- Attack miss sounds
- Critical hit sounds
- Blocked attack sounds
- Damage type sounds (fire, ice, lightning)
- Player death sound
- Monster death sounds (with variations)
- `AbilitySoundHandler` event handler
- Generic ability cast sound
- School-specific cast sounds (fire, ice, heal, buff)
- Ability effect sounds
- Ability end/expire sounds

**Out of Scope:**
- Core SFX service (v0.9.2a)
- UI/interaction sounds (v0.9.1c)
- Boss-specific sounds (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Event Handlers | 2 | `CombatSoundHandler`, `AbilitySoundHandler` |
| Sound Mappings | ~15 | Combat and ability effects |
| Unit Tests | ~6 | Combat and ability trigger tests |

### Combat Sound Event Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     COMBAT SOUND EVENT FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Combat Events                  Sound Effect           Audio
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€

     [AttackHitEvent] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  attack-hit      â”€â”€â”€â–¶  ğŸ”Š *thwack*
          â”‚                         (randomized)
          â”‚ isCritical?
          â–¼
     [CriticalHitEvent] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  attack-critical â”€â”€â”€â–¶  ğŸ”Š *CRACK!*

     [AttackMissEvent] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  attack-miss     â”€â”€â”€â–¶  ğŸ”Š *whoosh*

     [AttackBlockedEvent] â”€â”€â”€â”€â”€â”€â”€â–¶  attack-blocked  â”€â”€â”€â–¶  ğŸ”Š *CLANG*

     [DamageReceivedEvent] â”€â”€â”€â”€â”€â”€â–¶  damage-{type}   â”€â”€â”€â–¶  ğŸ”Š *sizzle/crack*
          â”‚
          â”œâ”€ Fire â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  damage-fire
          â”œâ”€ Ice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  damage-ice
          â””â”€ Lightning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  damage-lightning

     [MonsterDeathEvent] â”€â”€â”€â”€â”€â”€â”€â”€â–¶  death-monster   â”€â”€â”€â–¶  ğŸ”Š *death cry*
                                    (randomized)

     [PlayerDeathEvent] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  death-player    â”€â”€â”€â–¶  ğŸ”Š *collapse*
```

### CombatSoundHandler

```csharp
namespace RuneAndRust.Application.EventHandlers;

/// <summary>
/// Subscribes to combat events and triggers sound effects.
/// </summary>
public class CombatSoundHandler : IDisposable
{
    private readonly ISoundEffectService _sfx;
    private readonly IEventBus _eventBus;
    private readonly ILogger<CombatSoundHandler> _logger;
    private readonly List<IDisposable> _subscriptions = new();
    
    public CombatSoundHandler(
        ISoundEffectService sfx, 
        IEventBus eventBus,
        ILogger<CombatSoundHandler> logger)
    {
        _sfx = sfx;
        _eventBus = eventBus;
        _logger = logger;
        
        RegisterSubscriptions();
    }
    
    private void RegisterSubscriptions()
    {
        // Attack hit (check for critical)
        _subscriptions.Add(_eventBus.Subscribe<AttackHitEvent>(e =>
        {
            if (e.IsCritical)
            {
                _sfx.Play("attack-critical");
            }
            else
            {
                _sfx.Play("attack-hit");
            }
        }));
        
        // Attack miss
        _subscriptions.Add(_eventBus.Subscribe<AttackMissEvent>(_ =>
        {
            _sfx.Play("attack-miss");
        }));
        
        // Attack blocked
        _subscriptions.Add(_eventBus.Subscribe<AttackBlockedEvent>(_ =>
        {
            _sfx.Play("attack-blocked");
        }));
        
        // Damage received with type
        _subscriptions.Add(_eventBus.Subscribe<DamageReceivedEvent>(e =>
        {
            var effectId = e.DamageType?.ToLowerInvariant() switch
            {
                "fire" => "damage-fire",
                "ice" or "cold" => "damage-ice",
                "lightning" or "electric" => "damage-lightning",
                _ => null // No special sound for physical
            };
            
            if (effectId is not null)
            {
                _sfx.Play(effectId);
            }
        }));
        
        // Monster death
        _subscriptions.Add(_eventBus.Subscribe<MonsterDeathEvent>(_ =>
        {
            _sfx.Play("death-monster");
        }));
        
        // Player death
        _subscriptions.Add(_eventBus.Subscribe<PlayerDeathEvent>(_ =>
        {
            _sfx.Play("death-player");
        }));
        
        _logger.LogDebug("CombatSoundHandler registered {Count} subscriptions", _subscriptions.Count);
    }
    
    public void Dispose()
    {
        foreach (var sub in _subscriptions)
        {
            sub.Dispose();
        }
    }
}
```

### AbilitySoundHandler

```csharp
namespace RuneAndRust.Application.EventHandlers;

/// <summary>
/// Subscribes to ability events and triggers sound effects.
/// </summary>
public class AbilitySoundHandler : IDisposable
{
    private readonly ISoundEffectService _sfx;
    private readonly IEventBus _eventBus;
    private readonly ILogger<AbilitySoundHandler> _logger;
    private readonly List<IDisposable> _subscriptions = new();
    
    public AbilitySoundHandler(
        ISoundEffectService sfx,
        IEventBus eventBus,
        ILogger<AbilitySoundHandler> logger)
    {
        _sfx = sfx;
        _eventBus = eventBus;
        _logger = logger;
        
        RegisterSubscriptions();
    }
    
    private void RegisterSubscriptions()
    {
        // Ability cast
        _subscriptions.Add(_eventBus.Subscribe<AbilityCastEvent>(e =>
        {
            // Try school-specific sound first
            var effectId = e.AbilitySchool?.ToLowerInvariant() switch
            {
                "fire" or "evocation" => "ability-fire",
                "ice" or "cold" => "ability-ice",
                "healing" or "restoration" => "ability-heal",
                "buff" or "enhancement" => "ability-buff",
                _ => "ability-cast" // Generic fallback
            };
            
            _sfx.Play(effectId);
        }));
        
        // Ability effect applied (e.g., buff applied to target)
        _subscriptions.Add(_eventBus.Subscribe<AbilityEffectAppliedEvent>(e =>
        {
            if (e.EffectType == "buff")
            {
                _sfx.Play("ability-buff");
            }
        }));
        
        // Ability end (optional, for long-duration effects)
        _subscriptions.Add(_eventBus.Subscribe<AbilityEndedEvent>(e =>
        {
            // Could play expire sound if needed
        }));
        
        _logger.LogDebug("AbilitySoundHandler registered {Count} subscriptions", _subscriptions.Count);
    }
    
    public void Dispose()
    {
        foreach (var sub in _subscriptions)
        {
            sub.Dispose();
        }
    }
}
```

### Acceptance Criteria

- [ ] Attack hits play hit sounds
- [ ] Critical hits play critical sound
- [ ] Attack misses play whoosh
- [ ] Blocked attacks play block sound
- [ ] Fire damage plays fire sound
- [ ] Ice damage plays ice sound
- [ ] Lightning damage plays lightning sound
- [ ] Monster death plays death sound
- [ ] Player death plays death sound
- [ ] Ability casts play cast sounds
- [ ] School-specific sounds work
- [ ] ~6 unit tests pass

---

## v0.9.1c: UI & Interaction Sounds

[v0.9.1c Design Specification](v0.9.1c-design-specification.md)

### Overview

Implement event handlers that trigger UI and interaction sound effects. UI sounds include button clicks, menu transitions, and notifications. Interaction sounds include item actions, puzzle feedback, and movement sounds.

### Scope

**In Scope:**
- `UISoundHandler` for GUI events
- Button click sounds
- Button hover sounds (optional)
- Menu open/close sounds
- Notification sounds
- Error sounds
- `InteractionSoundHandler` for game interactions
- Item pickup sounds
- Item drop sounds
- Item equip sounds
- Item use sounds
- Gold/coins sounds
- Puzzle correct/incorrect sounds
- Puzzle complete sound
- Lever pull sounds
- Door open/close sounds
- Chest open sounds
- Footstep sounds (surface-based)

**Out of Scope:**
- Core SFX service (v0.9.2a)
- Combat/ability sounds (v0.9.2b)
- Ambient sounds (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Event Handlers | 2 | `UISoundHandler`, `InteractionSoundHandler` |
| Sound Mappings | ~15 | UI and interaction effects |
| XAML Triggers | 1 | Button sound behavior |
| Unit Tests | ~6 | UI and interaction trigger tests |

### UI & Interaction Sound Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 UI & INTERACTION SOUND FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     UI EVENTS                      Sound Effect           Audio
     â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€

     [ButtonClick] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  button-click    â”€â”€â”€â–¶  ğŸ”Š *click*

     [MenuOpened] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  menu-open       â”€â”€â”€â–¶  ğŸ”Š *swoosh*

     [MenuClosed] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  menu-close      â”€â”€â”€â–¶  ğŸ”Š *swoosh*

     [NotificationShown] â”€â”€â”€â”€â”€â”€â”€â”€â–¶  notification    â”€â”€â”€â–¶  ğŸ”Š *ding*

     [ErrorOccurred] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  error           â”€â”€â”€â–¶  ğŸ”Š *buzz*


     ITEM EVENTS                    Sound Effect           Audio
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€

     [ItemPickedUp] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  item-pickup     â”€â”€â”€â–¶  ğŸ”Š *grab*

     [ItemDropped] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  item-drop       â”€â”€â”€â–¶  ğŸ”Š *thud*

     [ItemEquipped] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  item-equip      â”€â”€â”€â–¶  ğŸ”Š *clank*

     [ItemUsed] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  item-use        â”€â”€â”€â–¶  ğŸ”Š *gulp*

     [GoldReceived] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  gold-coins      â”€â”€â”€â–¶  ğŸ”Š *jingle*


     PUZZLE EVENTS                  Sound Effect           Audio
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€

     [PuzzlePieceCorrect] â”€â”€â”€â”€â”€â”€â”€â–¶  puzzle-correct  â”€â”€â”€â–¶  ğŸ”Š *ding!*

     [PuzzlePieceIncorrect] â”€â”€â”€â”€â”€â–¶  puzzle-incorrect â”€â”€â–¶  ğŸ”Š *buzz*

     [PuzzleSolved] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  puzzle-complete â”€â”€â”€â–¶  ğŸ”Š *fanfare*

     [LeverPulled] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  lever-pull      â”€â”€â”€â–¶  ğŸ”Š *clunk*


     MOVEMENT EVENTS                Sound Effect           Audio
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€

     [PlayerMoved] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  footstep-{surface} â”€â–¶  ğŸ”Š *step*
          â”‚
          â”œâ”€ Stone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  footstep-stone
          â””â”€ Wood â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  footstep-wood

     [DoorOpened] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  door-open       â”€â”€â”€â–¶  ğŸ”Š *creak*

     [ChestOpened] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  chest-open      â”€â”€â”€â–¶  ğŸ”Š *creak*
```

### UISoundHandler

```csharp
namespace RuneAndRust.Application.EventHandlers;

/// <summary>
/// Triggers sound effects for UI events.
/// </summary>
public class UISoundHandler : IDisposable
{
    private readonly ISoundEffectService _sfx;
    private readonly IEventBus _eventBus;
    private readonly ILogger<UISoundHandler> _logger;
    private readonly List<IDisposable> _subscriptions = new();
    
    public UISoundHandler(
        ISoundEffectService sfx,
        IEventBus eventBus,
        ILogger<UISoundHandler> logger)
    {
        _sfx = sfx;
        _eventBus = eventBus;
        _logger = logger;
        
        RegisterSubscriptions();
    }
    
    private void RegisterSubscriptions()
    {
        // Button click
        _subscriptions.Add(_eventBus.Subscribe<ButtonClickedEvent>(_ =>
        {
            _sfx.Play("button-click");
        }));
        
        // Menu open
        _subscriptions.Add(_eventBus.Subscribe<MenuOpenedEvent>(_ =>
        {
            _sfx.Play("menu-open");
        }));
        
        // Menu close
        _subscriptions.Add(_eventBus.Subscribe<MenuClosedEvent>(_ =>
        {
            _sfx.Play("menu-close");
        }));
        
        // Notification
        _subscriptions.Add(_eventBus.Subscribe<NotificationShownEvent>(_ =>
        {
            _sfx.Play("notification");
        }));
        
        // Error
        _subscriptions.Add(_eventBus.Subscribe<ErrorDisplayedEvent>(_ =>
        {
            _sfx.Play("error");
        }));
        
        _logger.LogDebug("UISoundHandler registered {Count} subscriptions", _subscriptions.Count);
    }
    
    public void Dispose()
    {
        foreach (var sub in _subscriptions)
        {
            sub.Dispose();
        }
    }
}
```

### InteractionSoundHandler

```csharp
namespace RuneAndRust.Application.EventHandlers;

/// <summary>
/// Triggers sound effects for item, puzzle, and movement interactions.
/// </summary>
public class InteractionSoundHandler : IDisposable
{
    private readonly ISoundEffectService _sfx;
    private readonly IEventBus _eventBus;
    private readonly ILogger<InteractionSoundHandler> _logger;
    private readonly List<IDisposable> _subscriptions = new();
    
    public InteractionSoundHandler(
        ISoundEffectService sfx,
        IEventBus eventBus,
        ILogger<InteractionSoundHandler> logger)
    {
        _sfx = sfx;
        _eventBus = eventBus;
        _logger = logger;
        
        RegisterSubscriptions();
    }
    
    private void RegisterSubscriptions()
    {
        // Item events
        _subscriptions.Add(_eventBus.Subscribe<ItemPickedUpEvent>(_ =>
            _sfx.Play("item-pickup")));
        
        _subscriptions.Add(_eventBus.Subscribe<ItemDroppedEvent>(_ =>
            _sfx.Play("item-drop")));
        
        _subscriptions.Add(_eventBus.Subscribe<ItemEquippedEvent>(_ =>
            _sfx.Play("item-equip")));
        
        _subscriptions.Add(_eventBus.Subscribe<ItemUsedEvent>(_ =>
            _sfx.Play("item-use")));
        
        _subscriptions.Add(_eventBus.Subscribe<GoldReceivedEvent>(_ =>
            _sfx.Play("gold-coins")));
        
        // Puzzle events
        _subscriptions.Add(_eventBus.Subscribe<PuzzlePieceCorrectEvent>(_ =>
            _sfx.Play("puzzle-correct")));
        
        _subscriptions.Add(_eventBus.Subscribe<PuzzlePieceIncorrectEvent>(_ =>
            _sfx.Play("puzzle-incorrect")));
        
        _subscriptions.Add(_eventBus.Subscribe<PuzzleSolvedEvent>(_ =>
            _sfx.Play("puzzle-complete")));
        
        _subscriptions.Add(_eventBus.Subscribe<LeverPulledEvent>(_ =>
            _sfx.Play("lever-pull")));
        
        // Movement events
        _subscriptions.Add(_eventBus.Subscribe<PlayerMovedEvent>(e =>
        {
            var effectId = e.SurfaceType?.ToLowerInvariant() switch
            {
                "wood" => "footstep-wood",
                _ => "footstep-stone" // Default to stone
            };
            _sfx.Play(effectId);
        }));
        
        _subscriptions.Add(_eventBus.Subscribe<DoorOpenedEvent>(_ =>
            _sfx.Play("door-open")));
        
        _subscriptions.Add(_eventBus.Subscribe<ChestOpenedEvent>(_ =>
            _sfx.Play("chest-open")));
        
        _logger.LogDebug("InteractionSoundHandler registered {Count} subscriptions", _subscriptions.Count);
    }
    
    public void Dispose()
    {
        foreach (var sub in _subscriptions)
        {
            sub.Dispose();
        }
    }
}
```

### XAML Button Sound Behavior

```xml
<!-- In Button styles -->
<Style Selector="Button">
    <Setter Property="local:SoundBehavior.ClickSound" Value="button-click" />
</Style>

<!-- Attached behavior for sound -->
<local:SoundBehavior.ClickSound>button-click</local:SoundBehavior.ClickSound>
```

```csharp
/// <summary>
/// Attached behavior for UI element sounds.
/// </summary>
public static class SoundBehavior
{
    public static readonly AttachedProperty<string?> ClickSoundProperty =
        AvaloniaProperty.RegisterAttached<Button, string?>("ClickSound", typeof(SoundBehavior));
    
    static SoundBehavior()
    {
        ClickSoundProperty.Changed.AddClassHandler<Button>(OnClickSoundChanged);
    }
    
    private static void OnClickSoundChanged(Button button, AvaloniaPropertyChangedEventArgs e)
    {
        if (e.NewValue is string soundId)
        {
            button.Click += (s, args) =>
            {
                var sfx = App.GetService<ISoundEffectService>();
                sfx?.Play(soundId);
            };
        }
    }
}
```

### Acceptance Criteria

- [ ] Button clicks play click sound
- [ ] Menu open plays open sound
- [ ] Menu close plays close sound
- [ ] Notifications play notification sound
- [ ] Errors play error sound
- [ ] Item pickup plays pickup sound
- [ ] Item equip plays equip sound
- [ ] Gold plays coins sound
- [ ] Puzzle correct plays correct sound
- [ ] Puzzle incorrect plays incorrect sound
- [ ] Puzzle complete plays fanfare
- [ ] Movement plays footsteps
- [ ] Door open plays door sound
- [ ] Chest open plays chest sound
- [ ] ~6 unit tests pass

---

## Dependencies & Prerequisites

```
v0.9.1c (Theme Transitions) - REQUIRED
    â”‚
    â””â”€â”€ Music System complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
v0.9.2 (Sound Effects)                                                    â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.9.2a: Sound Effect Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: IAudioService (v0.9.1a)                         â”‚
    â”‚       Provides: ISoundEffectService, config loading                 â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.9.2b: Combat & Ability Sounds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: v0.9.2a (SFX service), EventBus                 â”‚
    â”‚       Provides: CombatSoundHandler, AbilitySoundHandler             â”‚
    â”‚                                                                     â”‚
    â””â”€â”€ v0.9.1c: UI & Interaction Sounds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: v0.9.2a (SFX service), EventBus
            Provides: UISoundHandler, InteractionSoundHandler
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.9.2a | ~4 | ~1 | ~8 | Medium |
| v0.9.2b | ~2 | ~0 | ~6 | Low |
| v0.9.1c | ~3 | ~1 | ~6 | Low |
| **Total** | **~9** | **~2** | **~20** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Missing sound files | Low | Medium | Graceful silence, log warning |
| Sound overlap issues | Low | Low | Max simultaneous limit |
| Event timing | Low | Low | Async playback |
| Large config file | Low | Low | Lazy loading by category |

---

## Design Decisions (Confirmed)

### Sound Effect Service

| Decision | Value | Notes |
|----------|-------|-------|
| **Max Simultaneous** | 8 | Prevent audio overload |
| **Randomization** | Per effect setting | Variety option |
| **Categories** | 6 | combat, ability, ui, items, puzzle, movement |

### Combat Sounds

| Decision | Value | Notes |
|----------|-------|-------|
| **Hit Variations** | 3 files | Randomized selection |
| **Damage Types** | Fire, Ice, Lightning | Special sounds |
| **Death Variations** | 2 files | Monster variety |

### UI Sounds

| Decision | Value | Notes |
|----------|-------|-------|
| **Button Sound** | Attached behavior | XAML integration |
| **Volume** | Lower than combat | Subtle feedback |
| **Footsteps** | Surface-based | Stone/wood variants |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.9.2a Design Spec** - Create detailed design for Sound Effect Service
3. **v0.9.2a Implementation** - Build SFX infrastructure
4. **v0.9.2b Design Spec** - Create specification for Combat & Ability Sounds
5. **v0.9.2b Implementation** - Build combat event handlers
6. **v0.9.1c Design Spec** - Create specification for UI & Interaction Sounds
7. **v0.9.1c Implementation** - Build UI and interaction handlers

---

*This scope breakdown completes the v0.9.0 Audio & Atmosphere series. Sound effects provide immediate tactile feedback for all player actions, from combat hits to puzzle interactions, creating a rich audio experience.*
