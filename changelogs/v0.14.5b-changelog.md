# v0.14.5b Changelog - Resource Schema

## Summary

Introduced the comprehensive **Resource Schema** (`resources.schema.json`) which validates class resource definitions including regeneration rules, maximum calculations, depletion effects, and visual representation. This schema enables full customization of class resource mechanics without code changes, supporting modding scenarios such as alternative magic systems, stamina-based combat, combo-building mechanics, or faith-based divine powers. The schema validates the existing 6 resource definitions (health, mana, rage, energy, faith, focus). This is the second schema in the v0.14.5 Economy Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/resources.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/resources.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (4 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `ResourceDefinition` | Core resource with mechanics and display | id, displayName, abbreviation, description, color, defaultMax, sortOrder |
| `MaxCalculation` | Formula for calculating maximum | baseValue |
| `AttributeScaling` | Attribute-based scaling | attribute, multiplier |
| `DepletionEffect` | Effects when resource reaches zero | (all optional) |

### ResourceDefinition Properties
| Property | Type | Constraint | Description |
|----------|------|------------|-------------|
| `id` | string | kebab-case | Unique identifier |
| `displayName` | string | minLength: 1 | UI display name |
| `abbreviation` | string | 1-4 chars | Compact display (HP, MP) |
| `description` | string | required | Flavor text |
| `color` | string | #RRGGBB hex | UI bar color |
| `defaultMax` | integer | >= 1 | Base maximum value |
| `maxCalculation` | object | (optional) | Level/attribute formula |
| `regenPerTurn` | integer | >= 0, default: 0 | Regeneration rate |
| `regenOutOfCombatOnly` | boolean | default: false | Combat-gated regen |
| `decayPerTurn` | integer | >= 0, default: 0 | Decay rate |
| `decayOnlyOutOfCombat` | boolean | default: false | Combat-gated decay |
| `buildOnDamageDealt` | integer | >= 1 (optional) | Gain on damage |
| `buildOnDamageTaken` | integer | >= 1 (optional) | Gain on taking damage |
| `buildOnHeal` | integer | >= 1 (optional) | Gain on healing |
| `buildOnKill` | integer | >= 1 (optional) | Gain on kill |
| `buildOnCritical` | integer | >= 1 (optional) | Gain on crit |
| `isUniversal` | boolean | default: false | All classes have |
| `startsAtZero` | boolean | default: false | Starts empty |
| `depletionEffect` | object | (optional) | Zero-resource effects |
| `iconId` | string | kebab-case (optional) | Icon reference |
| `sortOrder` | integer | >= 0 | Display order |

### Attribute Enumeration (5 values)
| Attribute | Description |
|-----------|-------------|
| `might` | Strength, physical power |
| `fortitude` | Constitution, endurance |
| `will` | Wisdom, willpower |
| `wits` | Intelligence, perception |
| `finesse` | Dexterity, agility |

### Unit Tests
- **[ResourcesSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/ResourcesSchemaTests.cs)** - 11 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (4 definitions)
  - `ResourcesJson_ValidatesAgainstSchema` - Backwards compatibility (6 resources)
  - `Abbreviation_TooLong_FailsValidation` - Abbreviation 1-4 chars
  - `Color_InvalidHexPattern_FailsValidation` - Hex color #RRGGBB pattern
  - `DefaultMax_LessThanOne_FailsValidation` - DefaultMax >= 1 validation
  - `AttributeScaling_InvalidAttribute_FailsValidation` - Attribute enum (5 values)
  - `BuildOnTrigger_LessThanOne_FailsValidation` - Build triggers >= 1
  - `ResourceId_InvalidPattern_FailsValidation` - Kebab-case pattern
  - `RequiredFields_Missing_FailsValidation` - Required fields check
  - `RegenPerTurn_Negative_FailsValidation` - Regen >= 0 validation
  - `MaxCalculationBaseValue_LessThanOne_FailsValidation` - BaseValue >= 1

## Changed

### Configuration Files
- **[config/resources.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/resources.json)** - Added `$schema` reference

### Schema Replacement
- **[config/schemas/resources.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/resources.schema.json)** - Replaced previous gatherable resources schema with class resource schema as per design specification

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/resources.schema.json` | Replaced |
| `config/resources.json` | Modified ($schema added) |
| `tests/.../Schemas/ResourcesSchemaTests.cs` | Added |
| `changelogs/v0.14.5b-changelog.md` | Added |

## Test Results

```
Test summary: total: 11, failed: 0, succeeded: 11, skipped: 0
Build succeeded with 0 errors
```

## Backward Compatibility

The schema validates all 6 existing resources without modification:
- `health` - Vitality (HP) - Universal resource, no regen
- `mana` - Arcane Power (MP) - Regenerating pool, 10/turn
- `rage` - Fury (RG) - Combat builder, builds on damage, decays out of combat
- `energy` - Stamina (EN) - Fast regen, 20/turn
- `faith` - Divine Favor (FTH) - Hybrid, builds on heal, slow regen
- `focus` - Concentration (FOC) - Moderate regen, 8/turn

## Resource Behavior Patterns

```
┌───────────────────────────────────────────────────────────────────┐
│  PATTERN A: MANA (Regenerating Pool)                              │
│  ████████████████████░░░░░░░░░░  80/100 MP                       │
│  startsAtZero: false, regenPerTurn: 10, decayPerTurn: 0          │
├───────────────────────────────────────────────────────────────────┤
│  PATTERN B: RAGE (Combat Builder)                                 │
│  ██████████░░░░░░░░░░░░░░░░░░░░  35/100 RG                       │
│  startsAtZero: true, buildOnDamageDealt: 10,                     │
│  buildOnDamageTaken: 15, decayPerTurn: 10, decayOnlyOutOfCombat  │
├───────────────────────────────────────────────────────────────────┤
│  PATTERN C: ENERGY (Fast Regeneration)                            │
│  ██████████████████████████████  100/100 EN                      │
│  startsAtZero: false, regenPerTurn: 20, decayPerTurn: 0          │
├───────────────────────────────────────────────────────────────────┤
│  PATTERN D: FAITH (Hybrid Builder/Regen)                          │
│  ████████████████████████░░░░░░  75/100 FTH                      │
│  startsAtZero: false, regenPerTurn: 5, buildOnHeal: 15           │
└───────────────────────────────────────────────────────────────────┘
```

## Maximum Calculation System

```
┌───────────────────────────────────────────────────────────────────┐
│  FORMULA                                                          │
│                                                                   │
│  Max = (classOverride or baseValue)                               │
│      + (level × perLevelBonus)                                    │
│      + (attribute × multiplier)                                   │
│                                                                   │
│  EXAMPLE (Level 5 Galdr-Caster with 18 Will):                    │
│  maxCalculation: {                                                │
│    baseValue: 50,                                                 │
│    perLevelBonus: 5,                                              │
│    attributeScaling: { attribute: "will", multiplier: 3.0 },     │
│    classOverrides: { "galdr-caster": 80 }                        │
│  }                                                                │
│                                                                   │
│  Result: 80 + (5×5) + (18×3.0) = 80 + 25 + 54 = 159 max mana     │
└───────────────────────────────────────────────────────────────────┘
```

## Build-On Trigger System

| Trigger | Event | Example |
|---------|-------|---------|
| `buildOnDamageDealt` | Dealing damage | +10 Rage per hit |
| `buildOnDamageTaken` | Taking damage | +15 Rage per hit |
| `buildOnHeal` | Healing any target | +15 Faith per heal |
| `buildOnKill` | Killing blow | +25 Energy per kill |
| `buildOnCritical` | Critical hit | +10 Focus per crit |

## Modding Scenarios Enabled

After this implementation, modders can:
- Define new class resources with custom mechanics
- Configure regeneration and decay per turn
- Set combat-context flags for regen/decay
- Create build-on triggers for various combat events
- Use attribute scaling for resource maximums
- Set class-specific base value overrides
- Configure depletion effects (status, prevent actions, message)
- Support patterns: mana pools, rage builders, combo points, faith

---

*Second entry in v0.14.5 Economy Configuration Schemas series. See also: v0.14.5a (Currency Schema), v0.14.5c (Recipes Schema), v0.14.5d (Vendors Schema).*
