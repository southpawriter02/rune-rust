# v0.17.3b Design Specification: Resource Bonuses

**Version:** 0.17.3b  
**Phase Name:** Resource Bonuses  
**Parent Version:** v0.17.3 (Archetype System)  
**Prerequisites:** v0.17.3a Complete (Archetype Enum & Definition)  
**Estimated Tests:** ~8 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [ArchetypeResourceBonuses Value Object](#4-archetyperesourcebonuses-value-object)
5. [ArchetypeSpecialBonus Value Object](#5-archetypespecialbonus-value-object)
6. [Data Model Changes](#6-data-model-changes)
7. [Configuration File Schemas](#7-configuration-file-schemas)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [User Stories](#11-user-stories)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the `ArchetypeResourceBonuses` and `ArchetypeSpecialBonus` value objects that encapsulate the resource pool bonuses each archetype provides. These bonuses directly affect derived statistics and are core to archetype differentiation.

The resource bonuses per archetype are:

| Archetype  | HP Bonus | Stamina Bonus | AP Bonus | Movement | Special          |
| ---------- | -------- | ------------- | -------- | -------- | ---------------- |
| Warrior    | +49      | +5            | 0        | 0        | —                |
| Skirmisher | +30      | +5            | 0        | +1       | —                |
| Mystic     | +20      | 0             | +20      | 0        | —                |
| Adept      | +30      | 0             | 0        | 0        | +20% Consumables |

This phase establishes the value objects that the `DerivedStatCalculator` and character creation workflow will use to apply archetype-specific bonuses.

### 1.2 Key Deliverables

| Category          | Items                                               |
| ----------------- | --------------------------------------------------- |
| **Value Objects** | `ArchetypeResourceBonuses`, `ArchetypeSpecialBonus` |
| **Configuration** | `archetypes.json` (resourceBonuses section)         |
| **Tests**         | ~8 unit tests                                       |

### 1.3 Architectural Significance

This version establishes the **Resource Bonus Pattern** used throughout character progression:

- **Immutable Bonus Values**: Resource bonuses are fixed per archetype
- **Special Bonus Abstraction**: `ArchetypeSpecialBonus` allows unique effects (Adept's consumable bonus)
- **Derived Stat Integration**: Bonuses feed directly into `DerivedStatCalculator` (v0.17.2g)
- **Clear Differentiation**: Each archetype has distinct resource profile
- **Movement as Resource**: Skirmisher's +1 Movement treated as resource bonus

---

## 2. Feature Overview

```
v0.17.3b Resource Bonuses
├── ArchetypeResourceBonuses Value Object
│   ├── MaxHpBonus: int (+49, +30, +20, +30)
│   ├── MaxStaminaBonus: int (+5, +5, 0, 0)
│   ├── MaxAetherPoolBonus: int (0, 0, +20, 0)
│   ├── MovementBonus: int (0, +1, 0, 0)
│   └── SpecialBonus: ArchetypeSpecialBonus?
├── ArchetypeSpecialBonus Value Object
│   ├── BonusType: string (e.g., "ConsumableEffectiveness")
│   ├── BonusValue: float (e.g., 0.20 for +20%)
│   └── Description: string
└── Configuration Files
    └── archetypes.json (resourceBonuses section)
```

### 2.1 Scope Alignment

**In Scope:**

- `ArchetypeResourceBonuses` value object with HP, Stamina, AP, Movement bonuses
- `ArchetypeSpecialBonus` value object for unique archetype effects
- Configuration schema extension for resource bonuses section
- Adept's +20% consumable effectiveness special bonus
- Helper methods for bonus application

**Out of Scope:**

- Starting abilities → v0.17.3c
- Specialization mappings → v0.17.3d
- Archetype provider service → v0.17.3e
- Archetype application service → v0.17.3f
- Integration with derived stat calculator → v0.17.3e/f

---

## 3. Architecture Diagrams

### 3.1 Resource Bonus System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                   RESOURCE BONUS SYSTEM OVERVIEW                     │
└─────────────────────────────────────────────────────────────────────┘

    ArchetypeDefinition (v0.17.3a)
           │
           │  has-a (composition)
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   ArchetypeResourceBonuses                           │
├─────────────────────────────────────────────────────────────────────┤
│  - MaxHpBonus: int           (e.g., Warrior: +49)                   │
│  - MaxStaminaBonus: int      (e.g., Warrior: +5)                    │
│  - MaxAetherPoolBonus: int   (e.g., Mystic: +20)                    │
│  - MovementBonus: int        (e.g., Skirmisher: +1)                 │
│  - SpecialBonus: ArchetypeSpecialBonus?                             │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  optional (null for most archetypes)
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    ArchetypeSpecialBonus                             │
├─────────────────────────────────────────────────────────────────────┤
│  - BonusType: string         (e.g., "ConsumableEffectiveness")      │
│  - BonusValue: float         (e.g., 0.20 for +20%)                  │
│  - Description: string       (e.g., "+20% effectiveness...")        │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Bonus Application Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                    BONUS APPLICATION FLOW                            │
└─────────────────────────────────────────────────────────────────────┘

    Character Creation: Apply Archetype
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 1. Get ArchetypeResourceBonuses for selected archetype          │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 2. Apply numeric bonuses to derived stats:                       │
    │    FinalMaxHp = BaseMaxHp + MaxHpBonus                          │
    │    FinalMaxStamina = BaseMaxStamina + MaxStaminaBonus           │
    │    FinalMaxAetherPool = BaseMaxAP + MaxAetherPoolBonus          │
    │    FinalMovement = BaseMovement + MovementBonus                 │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 3. Check for SpecialBonus:                                       │
    │    IF SpecialBonus != null:                                      │
    │       Register special effect on character                       │
    │       (e.g., ConsumableEffectiveness × 1.20)                     │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    Character stats updated with archetype bonuses
```

### 3.3 Resource Bonus Comparison

```
┌─────────────────────────────────────────────────────────────────────┐
│                  RESOURCE BONUS COMPARISON BY ARCHETYPE              │
└─────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                         WARRIOR                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │  HP Bonus:      ████████████████████████████████████████ +49    │
    │  Stamina Bonus: █████ +5                                        │
    │  AP Bonus:      0                                               │
    │  Movement:      0                                               │
    │  Special:       None                                            │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                        SKIRMISHER                                │
    ├─────────────────────────────────────────────────────────────────┤
    │  HP Bonus:      █████████████████████████ +30                   │
    │  Stamina Bonus: █████ +5                                        │
    │  AP Bonus:      0                                               │
    │  Movement:      █ +1                                            │
    │  Special:       None                                            │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                          MYSTIC                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │  HP Bonus:      ████████████████ +20                            │
    │  Stamina Bonus: 0                                               │
    │  AP Bonus:      ████████████████ +20                            │
    │  Movement:      0                                               │
    │  Special:       None                                            │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                           ADEPT                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │  HP Bonus:      █████████████████████████ +30                   │
    │  Stamina Bonus: 0                                               │
    │  AP Bonus:      0                                               │
    │  Movement:      0                                               │
    │  Special:       ★ ConsumableEffectiveness +20%                  │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.4 SpecialBonus Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│                   SPECIAL BONUS DECISION TREE                        │
└─────────────────────────────────────────────────────────────────────┘

    Get ArchetypeResourceBonuses
           │
           ▼
    ┌──────────────────────┐
    │ Has SpecialBonus?    │
    └──────────┬───────────┘
               │
        ┌──────┴──────┐
       YES            NO
        │              │
        ▼              ▼
    ┌────────────┐  ┌────────────────────────────────────────────────┐
    │ Process    │  │ No special processing required                 │
    │ Special    │  │ (Warrior, Skirmisher, Mystic)                  │
    │ Bonus      │  └────────────────────────────────────────────────┘
    └──────┬─────┘
           │
           ▼
    ┌──────────────────────┐
    │ BonusType?           │
    └──────────┬───────────┘
               │
    ┌──────────┴──────────────────────────────────────────────────────┐
    │                                                                  │
    ▼                                                                  ▼
┌────────────────────────┐                        ┌────────────────────┐
│ ConsumableEffectiveness│                        │ [Future Types]     │
├────────────────────────┤                        │ (not in scope)     │
│ Register multiplier:   │                        └────────────────────┘
│ consumableEffect *=    │
│ (1 + BonusValue)       │
│                        │
│ Display in UI:         │
│ "+20% Consumables"     │
└────────────────────────┘
```

### 3.5 Layer Integration

```
┌─────────────────────────────────────────────────────────────────────┐
│                         LAYER INTEGRATION                            │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │           DerivedStatCalculator (v0.17.2g)                    │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  Uses ArchetypeResourceBonuses to add:                        │  │
│  │  - MaxHpBonus to calculated MaxHp                             │  │
│  │  - MaxStaminaBonus to calculated MaxStamina                   │  │
│  │  - MaxAetherPoolBonus to calculated MaxAetherPool             │  │
│  │  - MovementBonus to calculated MovementSpeed                  │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │         IArchetypeApplicationService (v0.17.3f)               │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  Uses ArchetypeSpecialBonus to register:                      │  │
│  │  - Character modifiers (ConsumableEffectiveness)              │  │
│  │  - Future special effects                                     │  │
│  └───────────────────────────────────────────────────────────────┘  │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────┐  ┌─────────────────────────────┐   │
│  │ ArchetypeResourceBonuses   │  │   ArchetypeSpecialBonus     │   │
│  │     (Value Object)         │  │     (Value Object)          │   │
│  ├────────────────────────────┤  ├─────────────────────────────┤   │
│  │ MaxHpBonus: int            │  │ BonusType: string           │   │
│  │ MaxStaminaBonus: int       │  │ BonusValue: float           │   │
│  │ MaxAetherPoolBonus: int    │──│ Description: string         │   │
│  │ MovementBonus: int         │  └─────────────────────────────┘   │
│  │ SpecialBonus: ...?         │                                    │
│  └────────────────────────────┘                                    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. ArchetypeResourceBonuses Value Object

### 4.1 Purpose

The `ArchetypeResourceBonuses` value object encapsulates all resource pool bonuses provided by an archetype. This immutable record provides type-safe access to HP, Stamina, AP, and Movement bonuses.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ArchetypeResourceBonuses.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Encapsulates the resource pool bonuses provided by an archetype.
/// </summary>
/// <remarks>
/// <para>
/// ArchetypeResourceBonuses is an immutable value object that defines how an
/// archetype modifies a character's resource pools. These bonuses are applied
/// during character creation and affect derived statistics.
/// </para>
/// <para>
/// Four archetypes have distinct bonus profiles:
/// - Warrior: Highest HP (+49), moderate Stamina (+5)
/// - Skirmisher: Moderate HP (+30), Stamina (+5), Movement (+1)
/// - Mystic: Lower HP (+20), highest Aether Pool (+20)
/// - Adept: Moderate HP (+30), unique special bonus (+20% Consumables)
/// </para>
/// </remarks>
/// <param name="MaxHpBonus">Bonus added to maximum HP calculation.</param>
/// <param name="MaxStaminaBonus">Bonus added to maximum Stamina calculation.</param>
/// <param name="MaxAetherPoolBonus">Bonus added to maximum Aether Pool calculation.</param>
/// <param name="MovementBonus">Bonus added to base movement speed.</param>
/// <param name="SpecialBonus">Optional unique bonus for special effects.</param>
public readonly record struct ArchetypeResourceBonuses(
    int MaxHpBonus,
    int MaxStaminaBonus,
    int MaxAetherPoolBonus,
    int MovementBonus,
    ArchetypeSpecialBonus? SpecialBonus = null)
{
    /// <summary>
    /// Gets whether this archetype has any HP bonus.
    /// </summary>
    public bool HasHpBonus => MaxHpBonus > 0;

    /// <summary>
    /// Gets whether this archetype has any Stamina bonus.
    /// </summary>
    public bool HasStaminaBonus => MaxStaminaBonus > 0;

    /// <summary>
    /// Gets whether this archetype has any Aether Pool bonus.
    /// </summary>
    public bool HasAetherPoolBonus => MaxAetherPoolBonus > 0;

    /// <summary>
    /// Gets whether this archetype has any Movement bonus.
    /// </summary>
    public bool HasMovementBonus => MovementBonus > 0;

    /// <summary>
    /// Gets whether this archetype has a special bonus.
    /// </summary>
    public bool HasSpecialBonus => SpecialBonus.HasValue;

    /// <summary>
    /// Gets the total resource points allocated (HP + Stamina + AP).
    /// </summary>
    /// <remarks>
    /// Useful for balance comparison. Movement and Special are not included
    /// as they represent different value types.
    /// </remarks>
    public int TotalResourceBonus => MaxHpBonus + MaxStaminaBonus + MaxAetherPoolBonus;

    /// <summary>
    /// An empty resource bonus with all values at zero.
    /// </summary>
    public static ArchetypeResourceBonuses None => new(0, 0, 0, 0, null);

    /// <summary>
    /// Creates resource bonuses for the Warrior archetype.
    /// </summary>
    public static ArchetypeResourceBonuses Warrior => new(49, 5, 0, 0, null);

    /// <summary>
    /// Creates resource bonuses for the Skirmisher archetype.
    /// </summary>
    public static ArchetypeResourceBonuses Skirmisher => new(30, 5, 0, 1, null);

    /// <summary>
    /// Creates resource bonuses for the Mystic archetype.
    /// </summary>
    public static ArchetypeResourceBonuses Mystic => new(20, 0, 20, 0, null);

    /// <summary>
    /// Creates resource bonuses for the Adept archetype.
    /// </summary>
    public static ArchetypeResourceBonuses Adept => new(
        30, 0, 0, 0,
        new ArchetypeSpecialBonus(
            "ConsumableEffectiveness",
            0.20f,
            "+20% effectiveness from all consumable items"));

    /// <summary>
    /// Creates a custom resource bonus configuration.
    /// </summary>
    /// <param name="maxHpBonus">HP bonus value.</param>
    /// <param name="maxStaminaBonus">Stamina bonus value.</param>
    /// <param name="maxAetherPoolBonus">Aether Pool bonus value.</param>
    /// <param name="movementBonus">Movement bonus value.</param>
    /// <param name="specialBonus">Optional special bonus.</param>
    /// <returns>A new ArchetypeResourceBonuses instance.</returns>
    /// <exception cref="ArgumentOutOfRangeException">Thrown when bonus values are negative.</exception>
    public static ArchetypeResourceBonuses Create(
        int maxHpBonus,
        int maxStaminaBonus,
        int maxAetherPoolBonus,
        int movementBonus,
        ArchetypeSpecialBonus? specialBonus = null)
    {
        ArgumentOutOfRangeException.ThrowIfNegative(maxHpBonus);
        ArgumentOutOfRangeException.ThrowIfNegative(maxStaminaBonus);
        ArgumentOutOfRangeException.ThrowIfNegative(maxAetherPoolBonus);
        ArgumentOutOfRangeException.ThrowIfNegative(movementBonus);

        return new ArchetypeResourceBonuses(
            maxHpBonus,
            maxStaminaBonus,
            maxAetherPoolBonus,
            movementBonus,
            specialBonus);
    }

    /// <summary>
    /// Gets a formatted summary of the bonuses for display.
    /// </summary>
    /// <returns>A multi-line summary string.</returns>
    public string GetDisplaySummary()
    {
        var parts = new List<string>();

        if (HasHpBonus)
            parts.Add($"+{MaxHpBonus} HP");
        if (HasStaminaBonus)
            parts.Add($"+{MaxStaminaBonus} Stamina");
        if (HasAetherPoolBonus)
            parts.Add($"+{MaxAetherPoolBonus} Aether Pool");
        if (HasMovementBonus)
            parts.Add($"+{MovementBonus} Movement");
        if (HasSpecialBonus)
            parts.Add(SpecialBonus!.Value.Description);

        return parts.Count > 0 ? string.Join(", ", parts) : "No bonuses";
    }

    /// <summary>
    /// Gets the special bonus description if present.
    /// </summary>
    /// <returns>The special bonus description or null.</returns>
    public string? GetSpecialBonusDescription() =>
        SpecialBonus?.Description;

    /// <inheritdoc />
    public override string ToString() =>
        $"HP+{MaxHpBonus}, Stam+{MaxStaminaBonus}, AP+{MaxAetherPoolBonus}, Mov+{MovementBonus}" +
        (HasSpecialBonus ? $", Special: {SpecialBonus!.Value.BonusType}" : "");
}
```

### 4.3 Resource Bonuses Reference Table

| Archetype  | MaxHpBonus | MaxStaminaBonus | MaxAetherPoolBonus | MovementBonus | SpecialBonus                 |
| ---------- | ---------- | --------------- | ------------------ | ------------- | ---------------------------- |
| Warrior    | 49         | 5               | 0                  | 0             | None                         |
| Skirmisher | 30         | 5               | 0                  | 1             | None                         |
| Mystic     | 20         | 0               | 20                 | 0             | None                         |
| Adept      | 30         | 0               | 0                  | 0             | +20% ConsumableEffectiveness |

---

## 5. ArchetypeSpecialBonus Value Object

### 5.1 Purpose

The `ArchetypeSpecialBonus` value object encapsulates unique archetype effects that don't fit into the standard resource bonus model. Currently, only Adept uses this for the +20% consumable effectiveness bonus.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ArchetypeSpecialBonus.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a unique special bonus provided by an archetype.
/// </summary>
/// <remarks>
/// <para>
/// ArchetypeSpecialBonus captures archetype-specific effects that cannot be
/// expressed as simple numeric bonuses to resource pools. These effects
/// modify game mechanics in unique ways.
/// </para>
/// <para>
/// Currently implemented special bonuses:
/// - ConsumableEffectiveness: Multiplier applied to all consumable item effects
/// </para>
/// <para>
/// The BonusValue is a float representing a multiplier or percentage:
/// - 0.20 = +20% (multiply by 1.20)
/// - 0.50 = +50% (multiply by 1.50)
/// </para>
/// </remarks>
/// <param name="BonusType">The type identifier for this bonus (e.g., "ConsumableEffectiveness").</param>
/// <param name="BonusValue">The numeric value of the bonus (e.g., 0.20 for +20%).</param>
/// <param name="Description">Human-readable description for UI display.</param>
public readonly record struct ArchetypeSpecialBonus(
    string BonusType,
    float BonusValue,
    string Description)
{
    /// <summary>
    /// The bonus type for consumable effectiveness multiplier.
    /// </summary>
    public const string ConsumableEffectivenessType = "ConsumableEffectiveness";

    /// <summary>
    /// Gets whether this is a consumable effectiveness bonus.
    /// </summary>
    public bool IsConsumableEffectiveness =>
        BonusType.Equals(ConsumableEffectivenessType, StringComparison.OrdinalIgnoreCase);

    /// <summary>
    /// Gets the multiplier to apply (1 + BonusValue).
    /// </summary>
    /// <remarks>
    /// For a +20% bonus (BonusValue = 0.20), returns 1.20.
    /// </remarks>
    public float Multiplier => 1f + BonusValue;

    /// <summary>
    /// Gets the bonus as a percentage for display.
    /// </summary>
    /// <remarks>
    /// For BonusValue = 0.20, returns 20.
    /// </remarks>
    public int PercentageValue => (int)(BonusValue * 100);

    /// <summary>
    /// Creates a consumable effectiveness bonus.
    /// </summary>
    /// <param name="percentageBonus">The percentage bonus (e.g., 20 for +20%).</param>
    /// <returns>A new ArchetypeSpecialBonus for consumable effectiveness.</returns>
    public static ArchetypeSpecialBonus CreateConsumableEffectiveness(int percentageBonus)
    {
        var bonusValue = percentageBonus / 100f;
        return new ArchetypeSpecialBonus(
            ConsumableEffectivenessType,
            bonusValue,
            $"+{percentageBonus}% effectiveness from all consumable items");
    }

    /// <summary>
    /// Creates a special bonus with validation.
    /// </summary>
    /// <param name="bonusType">The bonus type identifier.</param>
    /// <param name="bonusValue">The bonus value.</param>
    /// <param name="description">The description.</param>
    /// <returns>A new ArchetypeSpecialBonus instance.</returns>
    /// <exception cref="ArgumentException">Thrown when required strings are null or whitespace.</exception>
    public static ArchetypeSpecialBonus Create(
        string bonusType,
        float bonusValue,
        string description)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(bonusType);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);

        return new ArchetypeSpecialBonus(bonusType, bonusValue, description);
    }

    /// <summary>
    /// Applies this bonus to a base value and returns the modified value.
    /// </summary>
    /// <param name="baseValue">The original value to modify.</param>
    /// <returns>The modified value with bonus applied.</returns>
    public int ApplyTo(int baseValue) =>
        (int)(baseValue * Multiplier);

    /// <summary>
    /// Applies this bonus to a base value and returns the modified value.
    /// </summary>
    /// <param name="baseValue">The original value to modify.</param>
    /// <returns>The modified value with bonus applied.</returns>
    public float ApplyTo(float baseValue) =>
        baseValue * Multiplier;

    /// <summary>
    /// Gets a short display format for UI.
    /// </summary>
    public string GetShortDisplay() =>
        $"+{PercentageValue}% {BonusType}";

    /// <inheritdoc />
    public override string ToString() =>
        $"{BonusType}: +{PercentageValue}%";
}
```

### 5.3 Special Bonus Types Reference

| BonusType               | Archetype | BonusValue | Effect                                    |
| ----------------------- | --------- | ---------- | ----------------------------------------- |
| ConsumableEffectiveness | Adept     | 0.20       | All consumable effects multiplied by 1.20 |

---

## 6. Data Model Changes

### 6.1 New Types Summary

| Type                       | Layer  | Category     | Description                       |
| -------------------------- | ------ | ------------ | --------------------------------- |
| `ArchetypeResourceBonuses` | Domain | Value Object | HP, Stamina, AP, Movement bonuses |
| `ArchetypeSpecialBonus`    | Domain | Value Object | Unique archetype effects          |

### 6.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── ValueObjects/
│   ├── ArchetypeResourceBonuses.cs              ← NEW
│   └── ArchetypeSpecialBonus.cs                 ← NEW

config/
└── archetypes.json                              ← UPDATED (resourceBonuses section)
```

### 6.3 Type Relationships

```
┌─────────────────────────┐
│  ArchetypeDefinition    │
│      (v0.17.3a)         │
└───────────┬─────────────┘
            │ has-a (future integration in v0.17.3e)
            ▼
┌─────────────────────────┐       ┌─────────────────────────┐
│ArchetypeResourceBonuses │──────▶│  ArchetypeSpecialBonus  │
│    (Value Object)       │ 0..1  │    (Value Object)       │
├─────────────────────────┤       ├─────────────────────────┤
│ MaxHpBonus              │       │ BonusType               │
│ MaxStaminaBonus         │       │ BonusValue              │
│ MaxAetherPoolBonus      │       │ Description             │
│ MovementBonus           │       └─────────────────────────┘
│ SpecialBonus?           │
└─────────────────────────┘
```

---

## 7. Configuration File Schemas

### 7.1 archetypes.json (Resource Bonuses Section)

**File:** `config/archetypes.json` (updated with resourceBonuses)

```json
{
    "$schema": "./schemas/archetypes.schema.json",
    "archetypes": [
        {
            "archetypeId": "Warrior",
            "displayName": "Warrior",
            "tagline": "The Unyielding Bulwark",
            "resourceBonuses": {
                "maxHpBonus": 49,
                "maxStaminaBonus": 5,
                "maxAetherPoolBonus": 0,
                "movementBonus": 0,
                "specialBonus": null
            }
        },
        {
            "archetypeId": "Skirmisher",
            "displayName": "Skirmisher",
            "tagline": "Swift as Shadow",
            "resourceBonuses": {
                "maxHpBonus": 30,
                "maxStaminaBonus": 5,
                "maxAetherPoolBonus": 0,
                "movementBonus": 1,
                "specialBonus": null
            }
        },
        {
            "archetypeId": "Mystic",
            "displayName": "Mystic",
            "tagline": "Wielder of Tainted Aether",
            "resourceBonuses": {
                "maxHpBonus": 20,
                "maxStaminaBonus": 0,
                "maxAetherPoolBonus": 20,
                "movementBonus": 0,
                "specialBonus": null
            }
        },
        {
            "archetypeId": "Adept",
            "displayName": "Adept",
            "tagline": "Master of Mundane Arts",
            "resourceBonuses": {
                "maxHpBonus": 30,
                "maxStaminaBonus": 0,
                "maxAetherPoolBonus": 0,
                "movementBonus": 0,
                "specialBonus": {
                    "bonusType": "ConsumableEffectiveness",
                    "bonusValue": 0.2,
                    "description": "+20% effectiveness from all consumable items"
                }
            }
        }
    ]
}
```

### 7.2 Schema Extension for Resource Bonuses

**File:** `config/schemas/archetypes.schema.json` (resourceBonuses section)

```json
{
    "$defs": {
        "resourceBonuses": {
            "type": "object",
            "description": "Resource pool bonuses provided by the archetype",
            "required": [
                "maxHpBonus",
                "maxStaminaBonus",
                "maxAetherPoolBonus",
                "movementBonus"
            ],
            "properties": {
                "maxHpBonus": {
                    "type": "integer",
                    "description": "Bonus to maximum HP",
                    "minimum": 0,
                    "maximum": 100
                },
                "maxStaminaBonus": {
                    "type": "integer",
                    "description": "Bonus to maximum Stamina",
                    "minimum": 0,
                    "maximum": 50
                },
                "maxAetherPoolBonus": {
                    "type": "integer",
                    "description": "Bonus to maximum Aether Pool",
                    "minimum": 0,
                    "maximum": 50
                },
                "movementBonus": {
                    "type": "integer",
                    "description": "Bonus to movement speed",
                    "minimum": 0,
                    "maximum": 5
                },
                "specialBonus": {
                    "oneOf": [
                        { "type": "null" },
                        { "$ref": "#/$defs/specialBonus" }
                    ]
                }
            }
        },
        "specialBonus": {
            "type": "object",
            "description": "A unique special bonus effect",
            "required": ["bonusType", "bonusValue", "description"],
            "properties": {
                "bonusType": {
                    "type": "string",
                    "description": "Type identifier for the bonus",
                    "enum": ["ConsumableEffectiveness"]
                },
                "bonusValue": {
                    "type": "number",
                    "description": "Numeric value (e.g., 0.20 for +20%)",
                    "minimum": 0,
                    "maximum": 1
                },
                "description": {
                    "type": "string",
                    "description": "Human-readable description",
                    "minLength": 1,
                    "maxLength": 200
                }
            }
        }
    }
}
```

---

## 8. Logging Specifications

### 8.1 Log Levels by Component

| Component                  | Level       | Events                                   |
| -------------------------- | ----------- | ---------------------------------------- |
| `ArchetypeResourceBonuses` | Debug       | Bonus creation, property access          |
| `ArchetypeResourceBonuses` | Warning     | Validation warnings (e.g., zero bonuses) |
| `ArchetypeSpecialBonus`    | Debug       | Bonus creation, application              |
| `ArchetypeSpecialBonus`    | Information | Special bonus applied to character       |

### 8.2 Logging Rules

- **Debug**: Bonus object creation and lookup
- **Information**: Special bonus registration on character
- **Warning**: Unexpected but valid edge cases (all bonuses zero)
- **Error**: Invalid bonus configurations

---

## 9. Unit Testing Requirements

### 9.1 Test Count: ~8 tests

```csharp
[TestFixture]
public class ArchetypeResourceBonusesTests
{
    [Test]
    public void Warrior_HasCorrectBonuses()
    {
        // Arrange & Act
        var bonuses = ArchetypeResourceBonuses.Warrior;

        // Assert
        bonuses.MaxHpBonus.Should().Be(49);
        bonuses.MaxStaminaBonus.Should().Be(5);
        bonuses.MaxAetherPoolBonus.Should().Be(0);
        bonuses.MovementBonus.Should().Be(0);
        bonuses.HasSpecialBonus.Should().BeFalse();
    }

    [Test]
    public void Skirmisher_HasMovementBonus()
    {
        // Arrange & Act
        var bonuses = ArchetypeResourceBonuses.Skirmisher;

        // Assert
        bonuses.MovementBonus.Should().Be(1);
        bonuses.HasMovementBonus.Should().BeTrue();
    }

    [Test]
    public void Mystic_HasAetherPoolBonus()
    {
        // Arrange & Act
        var bonuses = ArchetypeResourceBonuses.Mystic;

        // Assert
        bonuses.MaxAetherPoolBonus.Should().Be(20);
        bonuses.HasAetherPoolBonus.Should().BeTrue();
        bonuses.HasStaminaBonus.Should().BeFalse();
    }

    [Test]
    public void Adept_HasSpecialBonus()
    {
        // Arrange & Act
        var bonuses = ArchetypeResourceBonuses.Adept;

        // Assert
        bonuses.HasSpecialBonus.Should().BeTrue();
        bonuses.SpecialBonus!.Value.BonusType.Should().Be("ConsumableEffectiveness");
        bonuses.SpecialBonus!.Value.BonusValue.Should().Be(0.20f);
    }

    [Test]
    public void Create_WithNegativeHpBonus_ThrowsArgumentOutOfRangeException()
    {
        // Arrange
        Action act = () => ArchetypeResourceBonuses.Create(-10, 0, 0, 0);

        // Assert
        act.Should().Throw<ArgumentOutOfRangeException>();
    }

    [Test]
    public void GetDisplaySummary_ReturnsFormattedString()
    {
        // Arrange
        var bonuses = ArchetypeResourceBonuses.Warrior;

        // Act
        var summary = bonuses.GetDisplaySummary();

        // Assert
        summary.Should().Contain("+49 HP");
        summary.Should().Contain("+5 Stamina");
    }
}

[TestFixture]
public class ArchetypeSpecialBonusTests
{
    [Test]
    public void CreateConsumableEffectiveness_CreatesCorrectBonus()
    {
        // Arrange & Act
        var bonus = ArchetypeSpecialBonus.CreateConsumableEffectiveness(20);

        // Assert
        bonus.BonusType.Should().Be("ConsumableEffectiveness");
        bonus.BonusValue.Should().Be(0.20f);
        bonus.PercentageValue.Should().Be(20);
    }

    [Test]
    public void ApplyTo_MultipliesCorrectly()
    {
        // Arrange
        var bonus = ArchetypeSpecialBonus.CreateConsumableEffectiveness(20);

        // Act
        var result = bonus.ApplyTo(100);

        // Assert
        result.Should().Be(120);
    }
}
```

---

## 10. Use Cases

### UC-001: View Archetype Resource Bonuses

**Actor:** Player  
**Precondition:** Player is viewing archetype details in Step 4  
**Flow:** Select archetype → Load ArchetypeResourceBonuses → Display HP, Stamina, AP, Movement bonuses → Show special bonus if present  
**Postcondition:** Player sees resource bonus breakdown

### UC-002: Apply Archetype Bonuses

**Actor:** System  
**Precondition:** Player has confirmed archetype selection  
**Flow:** Get resource bonuses → Add to derived stats → Register special bonus if present → Update character  
**Postcondition:** Character has archetype bonuses applied

### UC-003: Calculate Derived Stats with Archetype

**Actor:** System  
**Precondition:** Character has attributes and archetype selected  
**Flow:** Calculate base stats from attributes → Add archetype resource bonuses → Return final derived stats  
**Postcondition:** Derived stats include archetype bonuses

---

## 11. User Stories

**US-001:** As a player choosing Warrior, I want to see that I get +49 HP so I know I'll be the tankiest option.

**US-002:** As a player choosing Skirmisher, I want to see the +1 Movement bonus so I understand my mobility advantage.

**US-003:** As a player choosing Mystic, I want to see +20 Aether Pool so I know I'll have more magical resources.

**US-004:** As a player choosing Adept, I want to understand the +20% consumable effectiveness bonus and how it helps my support role.

---

## 12. Deliverable Checklist

### Value Objects

- [ ] `ArchetypeResourceBonuses` value object
- [ ] All properties: MaxHpBonus, MaxStaminaBonus, MaxAetherPoolBonus, MovementBonus, SpecialBonus
- [ ] Static factory properties (Warrior, Skirmisher, Mystic, Adept)
- [ ] `Create()` factory method with validation
- [ ] Helper methods (GetDisplaySummary, HasXBonus properties)
- [ ] Full XML documentation

- [ ] `ArchetypeSpecialBonus` value object
- [ ] All properties: BonusType, BonusValue, Description
- [ ] `CreateConsumableEffectiveness()` factory method
- [ ] `ApplyTo()` methods for int and float
- [ ] Multiplier and PercentageValue computed properties
- [ ] Full XML documentation

### Configuration Files

- [ ] `archetypes.json` updated with resourceBonuses section
- [ ] Schema extended with resourceBonuses and specialBonus definitions
- [ ] All 4 archetypes have correct bonus values

### Testing

- [ ] ~8 unit tests implemented
- [ ] All tests passing
- [ ] Edge cases covered (negative values, special bonus application)

---

## 13. Acceptance Criteria

### Functional

- [ ] Warrior has MaxHpBonus = 49, MaxStaminaBonus = 5
- [ ] Skirmisher has MovementBonus = 1
- [ ] Mystic has MaxAetherPoolBonus = 20
- [ ] Adept has SpecialBonus with ConsumableEffectiveness = 0.20
- [ ] `ArchetypeResourceBonuses.Create()` rejects negative values
- [ ] `ArchetypeSpecialBonus.ApplyTo(100)` returns 120 for +20% bonus
- [ ] `GetDisplaySummary()` returns formatted string with all bonuses
- [ ] Configuration loads correctly with schema validation

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~8 unit tests pass
- [ ] XML documentation complete for all public types

---

## 14. Dependencies

### Required from Previous Phases

| Type                  | Phase    | Usage                              |
| --------------------- | -------- | ---------------------------------- |
| `Archetype`           | v0.17.3a | Archetype identification           |
| `ArchetypeDefinition` | v0.17.3a | Will compose with resource bonuses |

### Provides to Future Phases

| Type                       | Phase    | Usage                                   |
| -------------------------- | -------- | --------------------------------------- |
| `ArchetypeResourceBonuses` | v0.17.3e | Provider returns bonuses                |
| `ArchetypeResourceBonuses` | v0.17.3f | Application service applies bonuses     |
| `ArchetypeResourceBonuses` | v0.17.2g | DerivedStatCalculator uses for formulas |
| `ArchetypeSpecialBonus`    | v0.17.3f | Applied to character during creation    |

---

## 15. Future Considerations

### Deferred to v0.17.3c

- Starting abilities (ArchetypeAbilityGrant)
- Ability type enum (Active, Passive, Stance)

### Deferred to v0.17.3d

- Specialization mappings per archetype

### Deferred to v0.17.3e

- Provider service integration with resource bonuses

### Deferred to v0.17.3f

- Application service for applying bonuses to characters
- ArchetypeApplicationResult with final stat values

### Out of Scope for v0.17.3

- Temporary resource bonus modifications
- Equipment-based resource bonuses
- Level-scaling resource bonuses
- Additional special bonus types beyond ConsumableEffectiveness

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_
