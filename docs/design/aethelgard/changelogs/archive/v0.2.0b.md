> **Archived** - This changelog has been consolidated. See the complete version at [v0.2.0](../v0.2.x/v0.2.0.md).

# Changelog: v0.2.0b - The Exchange (Actions & Resolution)

**Release Date:** 2025-12-19

## Summary

This release implements the combat attack resolution system for Rune & Rust, transforming the turn-based infrastructure from v0.2.0a into a functional combat engine. The implementation introduces a Static Defense system using the formula `Defense Score = 10 + FINESSE - Stress` converted to `Success Threshold = Defense / 5`, a stamina-based action economy with variable costs per attack type, and a five-tier outcome classification system (Fumble, Miss, Glancing, Solid, Critical). The Core Layer gained attack-related enums and models, the Engine Layer received the AttackResolutionService and extended CombatService with attack execution, and the Test Layer added 28 comprehensive tests validating attack mechanics. Key architectural patterns employed include the Service Delegation Pattern for attack resolution, static lookup dictionaries for stamina costs and weapon dice, and defender-wins-ties tie resolution.

---

## New Files Created

### Core Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/AttackOutcome.cs` | Enum defining hit quality classification (Fumble, Miss, Glancing, Solid, Critical) with damage modifier semantics |
| `RuneAndRust.Core/Enums/AttackType.cs` | Enum defining attack types (Light, Standard, Heavy) with associated stamina costs and weapon dice |
| `RuneAndRust.Core/Models/Combat/AttackResult.cs` | Record encapsulating attack resolution output including outcome, net successes, raw damage, final damage, and hit status |
| `RuneAndRust.Core/Interfaces/IAttackResolutionService.cs` | Contract defining attack resolution operations including melee attacks, stamina costs, defense calculation, and success thresholds |

### Engine Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Engine/Services/AttackResolutionService.cs` | Implements attack mechanics including hit determination, damage calculation with outcome modifiers, and soak reduction |

### Test Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Tests/Engine/AttackResolutionServiceTests.cs` | Contains 28 tests validating stamina costs, defense calculations, attack outcomes, damage modifiers, and edge cases |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Core/Entities/Enemy.cs` | Added `MaxStamina` and `CurrentStamina` properties with default value 35 for enemy stamina parity |
| `RuneAndRust.Core/Models/Combat/Combatant.cs` | Updated `FromEnemy` factory method to copy stamina values from Enemy source |
| `RuneAndRust.Core/Interfaces/ICombatService.cs` | Extended with `ExecutePlayerAttack`, `RemoveDefeatedCombatant`, `CheckVictoryCondition`, and `GetCombatStatus` methods |
| `RuneAndRust.Engine/Services/CombatService.cs` | Added IAttackResolutionService dependency; implemented attack execution, combatant removal, victory checking, and status display; added message builder methods |
| `RuneAndRust.Engine/Services/CommandParser.cs` | Added attack command parsing (`attack`, `light`, `heavy`, `status`, `end`) with target resolution and attack type routing |
| `RuneAndRust.Terminal/Program.cs` | Registered `IAttackResolutionService` as Singleton in DI container |
| `RuneAndRust.Tests/Engine/CombatServiceTests.cs` | Added mock for IAttackResolutionService; added 18 new tests for ExecutePlayerAttack, RemoveDefeatedCombatant, CheckVictoryCondition, and GetCombatStatus |
| `RuneAndRust.Tests/Engine/CommandParserTests.cs` | Added mock ICombatService to fix flee command tests with proper EndCombat callback |
| `RuneAndRust.Engine/Services/TextRedactor.cs` | Fixed pseudo-random visibility algorithm to properly distribute word redaction using improved formula |

---

## Code Implementation Details

### AttackOutcome Enum

**File:** `RuneAndRust.Core/Enums/AttackOutcome.cs`

```csharp
public enum AttackOutcome
{
    Fumble = 0,    // 0 successes AND 1+ botches
    Miss = 1,      // Net successes <= 0 (defender wins ties)
    Glancing = 2,  // Net successes 1-2 (half damage)
    Solid = 3,     // Net successes 3-4 (full damage)
    Critical = 4   // Net successes 5+ (double damage)
}
```

**Semantic Mapping:**
- `Fumble`: Critical failure with potential negative consequences
- `Miss`: Attack failed to connect, no damage dealt
- `Glancing`: Weak hit, deals half damage after modifiers
- `Solid`: Clean hit, deals full damage
- `Critical`: Devastating hit, deals double damage

### AttackType Enum

**File:** `RuneAndRust.Core/Enums/AttackType.cs`

```csharp
public enum AttackType
{
    Light = 0,     // 15 stamina, d4 damage, +1 to hit
    Standard = 1,  // 25 stamina, d6 damage, no modifier
    Heavy = 2      // 40 stamina, d8 damage, -1 to hit
}
```

**Attack Type Properties:**

| Type | Stamina Cost | Weapon Die | Hit Modifier |
|------|--------------|------------|--------------|
| Light | 15 | d4 | +1 |
| Standard | 25 | d6 | 0 |
| Heavy | 40 | d8 | -1 |

### AttackResult Record

**File:** `RuneAndRust.Core/Models/Combat/AttackResult.cs`

```csharp
public record AttackResult(
    AttackOutcome Outcome,
    int NetSuccesses,
    int RawDamage,
    int FinalDamage,
    bool IsHit
);
```

**Properties:**
- `Outcome`: The quality classification of the attack roll
- `NetSuccesses`: Attacker's successes minus defender's threshold
- `RawDamage`: Damage before soak reduction, after outcome modifiers
- `FinalDamage`: Final damage after soak, minimum 1 on hit, 0 on miss
- `IsHit`: Boolean indicating whether damage should be applied

### IAttackResolutionService Interface

**File:** `RuneAndRust.Core/Interfaces/IAttackResolutionService.cs`

**Contract Methods:**
- `AttackResult ResolveMeleeAttack(Combatant attacker, Combatant defender, AttackType attackType)` - Resolves a complete melee attack
- `int GetStaminaCost(AttackType attackType)` - Returns stamina cost for attack type
- `bool CanAffordAttack(Combatant combatant, AttackType attackType)` - Checks stamina availability
- `int CalculateDefenseScore(Combatant defender)` - Calculates 10 + FINESSE - Stress
- `int GetSuccessThreshold(int defenseScore)` - Converts Defense Score to threshold via Defense / 5

### AttackResolutionService Implementation

**File:** `RuneAndRust.Engine/Services/AttackResolutionService.cs`

**Dependencies:**
- `IDiceService` - For attack dice pool rolls and weapon damage rolls
- `ILogger<AttackResolutionService>` - For structured logging

**Static Configuration Dictionaries:**
```csharp
private static readonly Dictionary<AttackType, int> StaminaCosts = new()
{
    { AttackType.Light, 15 },
    { AttackType.Standard, 25 },
    { AttackType.Heavy, 40 }
};

private static readonly Dictionary<AttackType, int> WeaponDice = new()
{
    { AttackType.Light, 4 },    // d4
    { AttackType.Standard, 6 }, // d6
    { AttackType.Heavy, 8 }     // d8
};

private static readonly Dictionary<AttackType, int> HitModifiers = new()
{
    { AttackType.Light, 1 },    // +1 to hit
    { AttackType.Standard, 0 }, // No modifier
    { AttackType.Heavy, -1 }    // -1 to hit
};
```

**Method: ResolveMeleeAttack**

Attack Resolution Algorithm:
1. Calculate attack pool = `Might + HitModifier`, minimum 1 die
2. Roll attack pool as d10 dice pool (8+ = success, 1 = botch)
3. Calculate Defense Score = `10 + FINESSE - Stress` (Stress defaults to 0)
4. Calculate Success Threshold = `DefenseScore / 5` (rounded down)
5. Calculate Net Successes = `Roll.Successes - Threshold`
6. Determine Outcome:
   - Fumble: 0 successes AND 1+ botches
   - Miss: Net Successes <= 0 (defender wins ties)
   - Glancing: Net Successes 1-2
   - Solid: Net Successes 3-4
   - Critical: Net Successes 5+
7. If hit, calculate Raw Damage = `Might + WeaponDie roll`
8. Apply outcome modifier:
   - Glancing: Raw / 2
   - Critical: Raw * 2
   - Solid: No modifier
9. Calculate Soak = `Sturdiness` (armor future expansion)
10. Calculate Final Damage = `Max(1, ModifiedDamage - Soak)` on hit, 0 on miss

**Defense Calculation Examples:**
| Finesse | Stress | Defense Score | Threshold |
|---------|--------|---------------|-----------|
| 3 | 0 | 13 | 2 |
| 5 | 0 | 15 | 3 |
| 10 | 0 | 20 | 4 |

### Extended CombatService

**File:** `RuneAndRust.Engine/Services/CombatService.cs`

**New Dependency:**
- `IAttackResolutionService` - For attack resolution delegation

**Method: ExecutePlayerAttack**
```csharp
string ExecutePlayerAttack(string targetName, AttackType attackType)
```
- Validates combat state is active
- Validates it's the player's turn (`IsPlayerTurn` property)
- Finds target by partial name match (case-insensitive)
- Checks stamina affordability via IAttackResolutionService
- Deducts stamina cost from attacker
- Resolves attack via `_attackResolution.ResolveMeleeAttack`
- Applies damage to target on hit
- Checks for death (HP <= 0) and removes defeated combatant
- Checks victory condition (no enemies remain)
- Returns narrative message describing attack result

**Method: RemoveDefeatedCombatant**
```csharp
void RemoveDefeatedCombatant(Combatant combatant)
```
- Removes combatant from TurnOrder list
- Adjusts TurnIndex if removed combatant was before current position
- Wraps TurnIndex to 0 if current position exceeds new list length

**Method: CheckVictoryCondition**
```csharp
bool CheckVictoryCondition()
```
- Returns true if no combatants with `IsPlayer = false` remain in TurnOrder

**Method: GetCombatStatus**
```csharp
string GetCombatStatus()
```
- Formats multi-line combat status string
- Shows round number, all combatants with HP/Stamina, active turn marker

**Message Builder Methods:**
- `BuildHitMessage` - Formats hit messages with outcome text and damage
- `BuildMissMessage` - Formats miss/fumble messages
- `BuildDeathMessage` - Formats fatal blow messages
- `BuildVictoryMessage` - Formats victory messages when last enemy dies

### Enemy Stamina Addition

**File:** `RuneAndRust.Core/Entities/Enemy.cs`

**New Properties:**
```csharp
public int MaxStamina { get; set; } = 35;
public int CurrentStamina { get; set; } = 35;
```

**Default Value Rationale:**
- Based on formula: 20 + (Finesse * 3) + (Sturdiness * 2)
- With default Finesse=3, Sturdiness=5: 20 + 9 + 10 = 39, rounded to 35

### Combatant.FromEnemy Update

**File:** `RuneAndRust.Core/Models/Combat/Combatant.cs`

**Change:** Updated factory method to copy stamina values:
```csharp
public static Combatant FromEnemy(Enemy e) => new()
{
    Name = e.Name,
    IsPlayer = false,
    EnemySource = e,
    CurrentHp = e.CurrentHp,
    MaxHp = e.MaxHp,
    CurrentStamina = e.CurrentStamina,  // NEW
    MaxStamina = e.MaxStamina           // NEW
};
```

### CommandParser Attack Commands

**File:** `RuneAndRust.Engine/Services/CommandParser.cs`

**New Combat Commands:**

| Command | Aliases | Description |
|---------|---------|-------------|
| `attack <target>` | `hit`, `strike` | Standard attack (25 stamina, d6) |
| `light <target>` | `quick`, `fast` | Light attack (15 stamina, d4, +1 hit) |
| `heavy <target>` | `power`, `strong` | Heavy attack (40 stamina, d8, -1 hit) |
| `status` | - | Display combat status |
| `end` | `pass`, `wait` | End combat (flee) |

**Target Resolution:**
- Partial name match, case-insensitive
- Example: `attack dummy` matches "Training Dummy"

### TextRedactor Algorithm Fix

**File:** `RuneAndRust.Engine/Services/TextRedactor.cs`

**Problem:** Original formula `((i * 7 + 13) % 100)` clustered values too low for small word counts, causing all words to be visible even at 50% completion.

**Solution:** Changed to `((i * 37 + 13) % 97 * 100 / 97)` which:
- Uses larger prime multiplier (37) for better spread
- Uses modulo 97 (prime) for more uniform distribution
- Scales back to 0-99 range

---

## Logging Matrix

### AttackResolutionService

| Event | Level | Template |
|-------|-------|----------|
| Attack resolution start | Information | `"Resolving {AttackType} attack: {Attacker} vs {Defender}"` |
| Attack pool calculation | Debug | `"Attack pool: Base {Base} + Modifier {Mod} = {Pool}"` |
| Roll vs defense | Debug | `"{Attacker} rolled {Successes} successes (Botches: {Botches}) vs Defense {Defense} (Threshold: {Threshold})"` |
| Net successes outcome | Debug | `"Net successes: {Net}, Outcome: {Outcome}, IsHit: {IsHit}"` |
| Raw damage calculation | Debug | `"Raw damage: Might {Might} + d{Die} ({Roll}) = {Raw}"` |
| Final damage calculation | Debug | `"Damage calc: Raw {Raw} - Soak {Soak} = Final {Final}"` |
| Attack resolved | Information | `"Attack resolved: {Outcome} - {Attacker} dealt {Damage} damage to {Defender}"` |
| Defense calculation | Trace | `"Defense calculation for {Defender}: 10 + Finesse({Finesse}) - Stress({Stress}) = {Defense}"` |

### CombatService (Extended)

| Event | Level | Template |
|-------|-------|----------|
| No combat active (attack) | Warning | `"ExecutePlayerAttack called but no combat is active"` |
| Not player's turn | Debug | `"Attack attempted but it is not the player's turn"` |
| Target not found | Debug | `"Target '{TargetName}' not found in combat"` |
| Insufficient stamina | Debug | `"{Attacker} cannot afford {AttackType} attack. Stamina: {Current}/{Cost}"` |
| Stamina spent | Debug | `"{Attacker} spent {Cost} stamina. Remaining: {Current}/{Max}"` |
| Attack executed | Information | `"{Attacker} attacks {Target} ({AttackType}): {Outcome}"` |
| Damage applied | Debug | `"{Target} took {Damage} damage. HP: {Current}/{Max}"` |
| Target slain | Warning | `"{Target} was slain! HP: 0/{Max}"` |
| Combatant removed | Debug | `"Removed {Name} from turn order"` |
| Combat victory | Information | `"Combat Victory! All enemies defeated."` |

---

## Test Coverage

```
Total: 1257 | Passed: 1257 | Failed: 0 | Duration: 537ms
```

**New Tests Added:** 46 tests (28 AttackResolutionServiceTests + 18 CombatServiceTests extensions)

### AttackResolutionServiceTests (28 tests)

#### GetStaminaCost Tests

| Test Name | Description |
|-----------|-------------|
| `GetStaminaCost_ReturnsCorrectCost` [Theory] | Validates Light=15, Standard=25, Heavy=40 stamina costs |

#### CanAffordAttack Tests

| Test Name | Description |
|-----------|-------------|
| `CanAffordAttack_WithSufficientStamina_ReturnsTrue` | Validates 60 stamina can afford 25 cost |
| `CanAffordAttack_WithExactStamina_ReturnsTrue` | Validates 25 stamina can afford 25 cost |
| `CanAffordAttack_WithInsufficientStamina_ReturnsFalse` | Validates 24 stamina cannot afford 25 cost |
| `CanAffordAttack_HeavyAttack_RequiresMoreStamina` | Validates 39 stamina cannot afford 40 cost |

#### CalculateDefenseScore Tests

| Test Name | Description |
|-----------|-------------|
| `CalculateDefenseScore_ReturnsCorrectValue` [Theory] | Validates Finesse 1→11, 5→15, 10→20 defense scores |

#### GetSuccessThreshold Tests

| Test Name | Description |
|-----------|-------------|
| `GetSuccessThreshold_ReturnsCorrectValue` [Theory] | Validates Defense 10→2, 11→2, 15→3, 20→4, 5→1 thresholds |

#### ResolveMeleeAttack - Outcome Tests

| Test Name | Description |
|-----------|-------------|
| `ResolveMeleeAttack_WhenMiss_ReturnsNoDamage` | Validates 2 successes vs threshold 3 = Miss with 0 damage |
| `ResolveMeleeAttack_WhenFumble_ReturnsNoDamage` | Validates 0 successes + 2 botches = Fumble with 0 damage |
| `ResolveMeleeAttack_DefenderWinsTies_IsMiss` | Validates 3 successes vs threshold 3 = Miss (net = 0) |
| `ResolveMeleeAttack_GlancingBlow_HalvesDamage` | Validates net 2 = Glancing with half damage |
| `ResolveMeleeAttack_SolidHit_FullDamage` | Validates net 3 = Solid with full damage |
| `ResolveMeleeAttack_CriticalHit_DoublesDamage` | Validates net 6 = Critical with double damage |

#### ResolveMeleeAttack - Attack Type Modifiers

| Test Name | Description |
|-----------|-------------|
| `ResolveMeleeAttack_LightAttack_UsesD4AndBonusToHit` | Validates d4 weapon die and Might+1 pool |
| `ResolveMeleeAttack_HeavyAttack_UsesD8AndPenaltyToHit` | Validates d8 weapon die and Might-1 pool |
| `ResolveMeleeAttack_StandardAttack_UsesD6AndNoModifier` | Validates d6 weapon die and Might pool |

#### ResolveMeleeAttack - Soak and Minimum Damage

| Test Name | Description |
|-----------|-------------|
| `ResolveMeleeAttack_MinimumOneDamage_WhenHit` | Validates minimum 1 damage on hit even with high soak |
| `ResolveMeleeAttack_SoakReducesDamage` | Validates Sturdiness 5 reduces damage by 5 |

#### ResolveMeleeAttack - Edge Cases

| Test Name | Description |
|-----------|-------------|
| `ResolveMeleeAttack_LowMightWithHeavyPenalty_MinimumOneDie` | Validates Might 1 + Heavy (-1) still rolls 1 die minimum |

### CombatServiceTests - New Tests (18 tests)

#### ExecutePlayerAttack Tests

| Test Name | Description |
|-----------|-------------|
| `ExecutePlayerAttack_WhenNoCombat_ReturnsNotInCombatMessage` | Validates error message when CombatState is null |
| `ExecutePlayerAttack_WhenNotPlayerTurn_ReturnsNotYourTurnMessage` | Validates error message when enemy's turn |
| `ExecutePlayerAttack_TargetNotFound_ReturnsTargetNotFoundMessage` | Validates error message for invalid target name |
| `ExecutePlayerAttack_InsufficientStamina_ReturnsNotEnoughStaminaMessage` | Validates error message when stamina too low |
| `ExecutePlayerAttack_SuccessfulHit_DeductsStamina` | Validates stamina reduced by attack cost |
| `ExecutePlayerAttack_Hit_AppliesDamageToTarget` | Validates target HP reduced by FinalDamage |
| `ExecutePlayerAttack_Miss_DoesNotApplyDamage` | Validates target HP unchanged on miss |
| `ExecutePlayerAttack_KillsEnemy_RemovesFromTurnOrder` | Validates dead enemy removed from TurnOrder |
| `ExecutePlayerAttack_KillsLastEnemy_ReturnsVictoryMessage` | Validates VICTORY message when last enemy dies |
| `ExecutePlayerAttack_PartialMatch_FindsTarget` | Validates "dummy" matches "Training Dummy" |

#### RemoveDefeatedCombatant Tests

| Test Name | Description |
|-----------|-------------|
| `RemoveDefeatedCombatant_RemovesCombatantFromTurnOrder` | Validates combatant removed from list |
| `RemoveDefeatedCombatant_AdjustsTurnIndex_WhenRemovedBeforeCurrent` | Validates TurnIndex decremented when earlier combatant removed |
| `RemoveDefeatedCombatant_DoesNotAdjustTurnIndex_WhenRemovedAfterCurrent` | Validates TurnIndex unchanged when later combatant removed |
| `RemoveDefeatedCombatant_WhenNoCombat_DoesNotThrow` | Validates safe no-op when CombatState is null |

#### CheckVictoryCondition Tests

| Test Name | Description |
|-----------|-------------|
| `CheckVictoryCondition_WhenNoEnemiesRemain_ReturnsTrue` | Validates true when only player in TurnOrder |
| `CheckVictoryCondition_WhenEnemiesRemain_ReturnsFalse` | Validates false when enemies still in TurnOrder |
| `CheckVictoryCondition_WhenNoCombat_ReturnsFalse` | Validates false when CombatState is null |

#### GetCombatStatus Tests

| Test Name | Description |
|-----------|-------------|
| `GetCombatStatus_WhenNoCombat_ReturnsNoActiveCombatMessage` | Validates "No active combat" message |
| `GetCombatStatus_IncludesRoundNumber` | Validates "Round 3" appears in output |
| `GetCombatStatus_IncludesAllCombatants` | Validates player and enemy names appear |
| `GetCombatStatus_ShowsHpAndStamina` | Validates "HP 75/100" and "Stamina 40/60" format |

---

## DI Registration

**File:** `RuneAndRust.Terminal/Program.cs`

```csharp
// Register Attack Resolution Service
services.AddSingleton<IAttackResolutionService, AttackResolutionService>();
```

**Justification for Singleton Lifetime:**
- Service is stateless (all state passed via parameters)
- Depends only on IDiceService (Singleton) and ILogger
- Static configuration dictionaries are readonly
- Thread-safe for concurrent combat scenarios

---

## Verification Results

### Build Output

```
Build succeeded.

    1 Warning(s)
    0 Error(s)

Time Elapsed 00:00:00.84
```

**Note:** Warning MSB3277 regarding EntityFrameworkCore.Relational version conflict is pre-existing and does not affect combat implementation.

### Test Output

```
Passed!  - Failed:     0, Passed:  1257, Skipped:     0, Total:  1257, Duration: 537 ms
```

**New Tests:**
- AttackResolutionServiceTests: 28/28 passed
- CombatServiceTests (new): 18/18 passed
- TextRedactorTests: 19/19 passed (2 previously failing now fixed)

---

## Directory Structure After Release

```
RuneAndRust.Core/
├── Entities/
│   ├── Character.cs
│   ├── CodexEntry.cs
│   ├── DataCapture.cs
│   ├── Enemy.cs [MODIFIED]
│   ├── InteractableObject.cs
│   ├── Room.cs
│   └── SaveGame.cs
├── Enums/
│   ├── Attribute.cs
│   ├── AttackOutcome.cs [NEW]
│   ├── AttackType.cs [NEW]
│   ├── Direction.cs
│   ├── EquipmentSlot.cs
│   ├── GamePhase.cs
│   ├── ItemRarity.cs
│   ├── ObjectState.cs
│   ├── ObjectType.cs
│   └── PendingGameAction.cs
├── Interfaces/
│   ├── IAttackResolutionService.cs [NEW]
│   ├── ICharacterRepository.cs
│   ├── ICodexEntryRepository.cs
│   ├── ICombatService.cs [MODIFIED]
│   ├── IDataCaptureRepository.cs
│   ├── IDataCaptureService.cs
│   ├── IDescriptorEngine.cs
│   ├── IDiceService.cs
│   ├── IGameService.cs
│   ├── IInitiativeService.cs
│   └── (other interfaces)
├── Models/
│   ├── Combat/
│   │   ├── AttackResult.cs [NEW]
│   │   └── Combatant.cs [MODIFIED]
│   ├── CombatState.cs
│   ├── GameState.cs
│   └── (other model files)

RuneAndRust.Engine/
├── Services/
│   ├── AttackResolutionService.cs [NEW]
│   ├── CombatService.cs [MODIFIED]
│   ├── CommandParser.cs [MODIFIED]
│   ├── DataCaptureService.cs
│   ├── DescriptorEngine.cs
│   ├── DiceService.cs
│   ├── GameService.cs
│   ├── InitiativeService.cs
│   ├── InteractionService.cs
│   ├── JournalService.cs
│   ├── NavigationService.cs
│   ├── SaveManager.cs
│   ├── StatCalculationService.cs
│   └── TextRedactor.cs [MODIFIED]
├── Factories/
│   └── (factory files)
└── (other directories)

RuneAndRust.Tests/
├── Engine/
│   ├── AttackResolutionServiceTests.cs [NEW]
│   ├── CombatServiceTests.cs [MODIFIED]
│   ├── CommandParserTests.cs [MODIFIED]
│   ├── DataCaptureServiceTests.cs
│   ├── DescriptorEngineTests.cs
│   ├── DiceServiceTests.cs
│   ├── InitiativeServiceTests.cs
│   ├── InteractionServiceTests.cs
│   ├── JournalServiceTests.cs
│   ├── NavigationServiceTests.cs
│   ├── StatCalculationServiceTests.cs
│   └── TextRedactorTests.cs
└── (other directories)

RuneAndRust.Terminal/
├── Program.cs [MODIFIED]
└── Services/
    ├── CharacterCreationController.cs
    └── TerminalInputHandler.cs
```

---

## Running Tests

### Run All Tests
```bash
dotnet test
```

### Run Attack Resolution Tests Only
```bash
dotnet test --filter "FullyQualifiedName~AttackResolutionServiceTests"
```

### Run Combat Tests (Full Suite)
```bash
dotnet test --filter "FullyQualifiedName~CombatServiceTests|FullyQualifiedName~AttackResolutionServiceTests"
```

### Run TextRedactor Tests (Fixed)
```bash
dotnet test --filter "FullyQualifiedName~TextRedactorTests"
```

---

## Next Steps

**Planned for v0.2.0c:**
- Implement enemy AI attack actions during enemy turns
- Add stamina regeneration between rounds
- Implement flee mechanics with FINESSE + WITS check
- Add combat action feedback with colored output
- Implement blocking/defensive stance mechanics

**Planned for v0.2.1:**
- Add status effects (Bleeding, Stunned, Fortified)
- Implement weapon equipment affecting attack type and damage
- Create combat victory rewards (XP, loot drops)
- Add defeat handling (death, respawn, load save)
- Implement multi-target combat encounters

**Planned for v0.2.2:**
- Expand Enemy entity with AI behavior patterns
- Add enemy type definitions (Automaton, Revenant, Beast)
- Implement surprise round mechanics
- Create bestiary entries for Codex system
- Add combat encounter triggers in Exploration phase
