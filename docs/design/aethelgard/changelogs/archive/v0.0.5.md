> **Archived** - This changelog has been consolidated. See the complete version at [v0.0.5](../v0.0.x/v0.0.5.md).

# v0.0.5 Changelog: The Spatial Core

**Release Date:** December 18, 2025
**Total Tests:** 410 (177 new tests added)

---

## Summary

Version 0.0.5 implements the **spatial navigation system** with a 3D coordinate grid, room entities, and movement commands. This release transitions the application from a static menu loop into a navigable world where players can move between discrete rooms mapped to a coordinate system supporting vertical traversal.

---

## New Features

### 3D Coordinate System
- **Coordinate Value Object**: Immutable record type with X, Y, Z axes
- **Origin**: Designated (0, 0, 0) as starting point
- **Offset Operations**: Support for calculating new positions

### Direction System
- **Six Cardinal Directions**: North, South, East, West, Up, Down
- **Full 3D Navigation**: Supports vertical movement for multi-level dungeons

### Room Entity
- **Room Entity**: Persistent game world locations with name, description, and position
- **Exit Dictionary**: Maps directions to connected room IDs
- **Starting Room Flag**: Designates spawn point for new games

### Navigation System
- **NavigationService**: Validates exits, updates game state, provides room descriptions
- **Movement Commands**: `n/s/e/w/u/d` shortcuts and `go <direction>` syntax
- **Look Command**: Enhanced to show room name, description, and available exits

### Dungeon Generation
- **DungeonGenerator**: Creates connected room graphs
- **Test Map**: 5-room starter dungeon with bidirectional connections
- **Room Clearing**: Supports world regeneration on new game

---

## Files Created

### Core Layer

#### `RuneAndRust.Core/ValueObjects/Coordinate.cs`
3D position record type:
```csharp
public record Coordinate(int X, int Y, int Z)
{
    public static Coordinate Origin => new(0, 0, 0);
    public Coordinate Offset(int deltaX, int deltaY, int deltaZ);
}
```

#### `RuneAndRust.Core/Enums/Direction.cs`
Navigation directions:
```csharp
public enum Direction
{
    North = 0, South = 1, East = 2, West = 3, Up = 4, Down = 5
}
```

#### `RuneAndRust.Core/Entities/Room.cs`
Game world location:
```csharp
public class Room
{
    public Guid Id { get; set; }
    public string Name { get; set; }
    public string Description { get; set; }
    public Coordinate Position { get; set; }
    public Dictionary<Direction, Guid> Exits { get; set; }
    public bool IsStartingRoom { get; set; }
}
```

#### `RuneAndRust.Core/Interfaces/INavigationService.cs`
Navigation contract:
```csharp
public interface INavigationService
{
    Task<string> MoveAsync(Direction direction);
    Task<string> LookAsync();
    Task<Room?> GetCurrentRoomAsync();
    Task<IEnumerable<Direction>> GetAvailableExitsAsync();
}
```

#### `RuneAndRust.Core/Interfaces/IRoomRepository.cs`
Room-specific repository:
- `GetByPositionAsync(Coordinate position)` - Find room by coordinates
- `GetStartingRoomAsync()` - Get spawn point
- `PositionExistsAsync(Coordinate position)` - Check occupancy
- `GetAllRoomsAsync()` - Retrieve all rooms ordered by position
- `ClearAllRoomsAsync()` - Remove all rooms
- `AddRangeAsync(IEnumerable<Room> rooms)` - Bulk insert

### Persistence Layer

#### `RuneAndRust.Persistence/Repositories/RoomRepository.cs`
Room repository implementation with:
- Position-based queries
- Starting room lookup
- Bulk operations with logging

### Engine Layer

#### `RuneAndRust.Engine/Services/DungeonGenerator.cs`
World generation:
```csharp
public class DungeonGenerator
{
    Task<Guid> GenerateTestMapAsync();
    static Direction GetOppositeDirection(Direction direction);
}
```

**Test Map Layout:**
```
                [Rusted Corridor]
                      (0,1,0)
                        |
                        N
                        |
[Collapsed] W -- [Entry Hall] -- E [Storage Chamber]
  (-1,0,0)        (0,0,0)          (1,0,0)
                        |
                        D
                        |
                    [The Pit]
                     (0,0,-1)
```

#### `RuneAndRust.Engine/Services/NavigationService.cs`
Movement handling:
```csharp
public class NavigationService : INavigationService
{
    Task<string> MoveAsync(Direction direction);
    Task<string> LookAsync();
    Task<Room?> GetCurrentRoomAsync();
    Task<IEnumerable<Direction>> GetAvailableExitsAsync();
}
```

#### `RuneAndRust.Engine/Services/CommandParser.cs` (Updated)
New ParseResult class and movement handling:
```csharp
public class ParseResult
{
    public bool RequiresNavigation { get; set; }
    public Direction? NavigationDirection { get; set; }
    public bool RequiresLook { get; set; }
}
```

### Test Layer

#### `RuneAndRust.Tests/Core/CoordinateTests.cs`
Coordinate validation (23 tests):
- Constructor and Origin tests
- Equality and GetHashCode tests
- ToString formatting tests
- Offset operation tests
- Record semantics tests

#### `RuneAndRust.Tests/Core/DirectionTests.cs`
Direction enum validation (26 tests):
- Value existence and count tests
- Numeric value tests
- ToString and Parse tests
- Default value tests

#### `RuneAndRust.Tests/Core/RoomTests.cs`
Room entity validation (23 tests):
- Default value tests
- Property setter tests
- Exits dictionary tests
- Object initializer tests
- Unique ID tests

#### `RuneAndRust.Tests/Engine/NavigationServiceTests.cs`
Navigation logic (19 tests):
- MoveAsync scenarios (valid, invalid, edge cases)
- LookAsync formatting
- GetCurrentRoomAsync
- GetAvailableExitsAsync

#### `RuneAndRust.Tests/Engine/DungeonGeneratorTests.cs`
Generation validation (22 tests):
- Room count and uniqueness
- Starting room configuration
- Exit bidirectionality
- Position validation
- GetOppositeDirection tests

#### `RuneAndRust.Tests/Integration/RoomPersistenceTests.cs`
Room persistence (27 tests):
- CRUD operations
- Position-based queries
- Starting room queries
- Bulk operations

---

## Files Modified

### `RuneAndRust.Core/Models/GameState.cs`
Added CurrentRoomId property:
```csharp
public Guid? CurrentRoomId { get; set; }
```
- Reset() now clears CurrentRoomId to null

### `RuneAndRust.Persistence/Data/RuneAndRustDbContext.cs`
Added Rooms DbSet:
```csharp
public DbSet<Room> Rooms { get; set; }
```
- Coordinate mapped as owned type (PositionX, PositionY, PositionZ columns)
- Exits dictionary stored as JSONB

### `RuneAndRust.Engine/Services/CommandParser.cs`
Major updates:
- ParseAndExecute now returns ParseResult
- Added direction parsing (n/s/e/w/u/d shortcuts)
- Added `go <direction>` command format
- Added `exits` command
- Updated help text with movement commands
- Menu command now clears CurrentRoomId

### `RuneAndRust.Terminal/Program.cs`
New DI registrations:
```csharp
services.AddScoped<IRoomRepository, RoomRepository>();
services.AddScoped<DungeonGenerator>();
services.AddScoped<INavigationService, NavigationService>();
```
- Version bumped to v0.0.5

### `RuneAndRust.Tests/Core/GameStateTests.cs`
Added 4 new tests:
- DefaultCurrentRoomId test
- CurrentRoomId setter tests
- Reset CurrentRoomId test
- Updated Reset_ShouldResetAllProperties test

### `RuneAndRust.Tests/Engine/CommandParserTests.cs`
Added 33 new tests:
- Direction alias tests (12 directions)
- Go command tests (6 directions)
- Invalid direction error test
- Exits command test
- Menu clears CurrentRoomId test
- Start/Flee RequiresLook tests
- EmptyInput returns None test

---

## Complete Test Inventory

### Core/CoordinateTests.cs (23 tests)
| Test Name | Description |
|-----------|-------------|
| `Coordinate_Constructor_ShouldSetXYZ` | Constructor sets all values |
| `Coordinate_Constructor_CanHandleNegativeValues` | Negative coordinate support |
| `Coordinate_Constructor_CanHandleZeroValues` | Zero coordinate support |
| `Coordinate_Origin_ShouldBeZeroZeroZero` | Origin is (0,0,0) |
| `Coordinate_Origin_ShouldEqualNewZeroCoordinate` | Origin equality |
| `Coordinate_EqualCoordinates_ShouldBeEqual` | Value equality |
| `Coordinate_DifferentCoordinates_ShouldNotBeEqual` | Inequality |
| `Coordinate_DifferentX_ShouldNotBeEqual` | X component inequality |
| `Coordinate_DifferentY_ShouldNotBeEqual` | Y component inequality |
| `Coordinate_DifferentZ_ShouldNotBeEqual` | Z component inequality |
| `Coordinate_GetHashCode_SameForEqualCoordinates` | Hash code consistency |
| `Coordinate_ToString_ReturnsFormattedString` | String format |
| `Coordinate_ToString_HandlesNegativeValues` | Negative formatting |
| `Coordinate_ToString_Origin` | Origin formatting |
| `Coordinate_Offset_ReturnsNewCoordinate` | Offset creates new coordinate |
| `Coordinate_Offset_DoesNotModifyOriginal` | Immutability |
| `Coordinate_Offset_HandlesNegativeOffset` | Negative offset |
| `Coordinate_Offset_ZeroOffset_ReturnsSameValues` | Zero offset |
| `Coordinate_Offset_CardinalDirections` | All 6 direction offsets (Theory) |
| `Coordinate_WithExpression_CreatesModifiedCopy` | Record with-expression |

### Core/DirectionTests.cs (26 tests)
| Test Name | Description |
|-----------|-------------|
| `Direction_ShouldHaveExactlySixValues` | Enum count |
| `Direction_ShouldContain_*` | Each direction exists (6 tests) |
| `Direction_*_ShouldBe*` | Numeric values (6 tests) |
| `Direction_EnumValues_ShouldBeSequential` | Sequential ordering |
| `Direction_ToString_ReturnsExpectedName` | ToString (Theory, 6 cases) |
| `Direction_Parse_ReturnsCorrectDirection` | Parsing (Theory, 6 cases) |
| `Direction_Parse_IsCaseInsensitive` | Case insensitivity |
| `Direction_TryParse_InvalidValue_ReturnsFalse` | Invalid parse |
| `Direction_HorizontalDirections_AreNorthSouthEastWest` | Grouping |
| `Direction_VerticalDirections_AreUpDown` | Vertical grouping |
| `Direction_DefaultValue_ShouldBeNorth` | Default value |

### Core/RoomTests.cs (23 tests)
| Test Name | Description |
|-----------|-------------|
| `Room_Default*` | Default value tests (6 tests) |
| `Room_*_CanBeSet` | Property setter tests (5 tests) |
| `Room_Exits_Can*` | Exit operations (8 tests) |
| `Room_ObjectInitializer_SetsAllProperties` | Full initialization |
| `Room_MultipleInstances_HaveUniqueIds` | Unique ID generation |

### Engine/NavigationServiceTests.cs (19 tests)
| Test Name | Description |
|-----------|-------------|
| `MoveAsync_NoCurrentRoom_ReturnsErrorMessage` | Null room handling |
| `MoveAsync_CurrentRoomNotInDatabase_ReturnsErrorMessage` | Missing room |
| `MoveAsync_NoExitInDirection_ReturnsCannotGoMessage` | Blocked exit |
| `MoveAsync_ValidExit_UpdatesCurrentRoomId` | State update |
| `MoveAsync_ValidExit_IncrementsTurnCount` | Turn increment |
| `MoveAsync_ValidExit_ReturnsRoomDescription` | Output format |
| `MoveAsync_ExitLeadsToNonexistentRoom_ReturnsErrorMessage` | Broken link |
| `MoveAsync_AllDirections_FormatsDirectionCorrectly` | Direction formatting (Theory) |
| `LookAsync_NoCurrentRoom_ReturnsVoidMessage` | Null handling |
| `LookAsync_ValidRoom_ReturnsFormattedDescription` | Description format |
| `LookAsync_RoomWithNoExits_ShowsNoObviousExits` | Empty exits |
| `GetCurrentRoomAsync_*` | Room retrieval (2 tests) |
| `GetAvailableExitsAsync_*` | Exit listing (2 tests) |

### Engine/DungeonGeneratorTests.cs (22 tests)
| Test Name | Description |
|-----------|-------------|
| `GenerateTestMapAsync_ClearsExistingRooms` | Pre-generation cleanup |
| `GenerateTestMapAsync_CreatesAtLeastTwoRooms` | Minimum rooms |
| `GenerateTestMapAsync_CreatesFiveRooms` | Expected count |
| `GenerateTestMapAsync_HasExactlyOneStartingRoom` | Single start |
| `GenerateTestMapAsync_StartingRoomIsAtOrigin` | Origin placement |
| `GenerateTestMapAsync_ReturnsStartingRoomId` | Return value |
| `GenerateTestMapAsync_AllRoomsHaveUniqueIds` | ID uniqueness |
| `GenerateTestMapAsync_AllRoomsHaveUniquePositions` | Position uniqueness |
| `GenerateTestMapAsync_AllRoomsHaveNonEmptyNames` | Name validation |
| `GenerateTestMapAsync_AllRoomsHaveNonEmptyDescriptions` | Description validation |
| `GenerateTestMapAsync_StartingRoomHasMultipleExits` | Exit count |
| `GenerateTestMapAsync_ExitsAreBidirectional` | Two-way connections |
| `GenerateTestMapAsync_ExitsPointToValidRooms` | Link integrity |
| `GenerateTestMapAsync_SavesChangesToDatabase` | Persistence |
| `GenerateTestMapAsync_IncludesVerticalRoom` | 3D support |
| `GenerateTestMapAsync_*Named` | Named room tests (3 tests) |
| `GetOppositeDirection_ReturnsCorrectOpposite` | Opposite mapping (Theory) |
| `GetOppositeDirection_IsSymmetric` | Symmetry validation |

### Integration/RoomPersistenceTests.cs (27 tests)
| Test Name | Description |
|-----------|-------------|
| `AddAsync_ShouldPersistRoom` | Basic persistence |
| `AddAsync_ShouldPersistCoordinate` | Coordinate storage |
| `AddAsync_ShouldPersistExits` | Exit dictionary storage |
| `GetByIdAsync_*` | ID lookup (2 tests) |
| `GetByPositionAsync_*` | Position queries (3 tests) |
| `GetStartingRoomAsync_*` | Starting room (2 tests) |
| `PositionExistsAsync_*` | Existence checks (2 tests) |
| `GetAllRoomsAsync_*` | Full retrieval (3 tests) |
| `ClearAllRoomsAsync_*` | Clear operations (2 tests) |
| `AddRangeAsync_*` | Bulk insert (2 tests) |
| `UpdateAsync_*` | Updates (2 tests) |
| `DeleteAsync_*` | Deletion (2 tests) |
| `Room_DefaultValues_AreSetCorrectly` | Entity defaults |

---

## Logging Matrix (v0.0.5)

| System | Event | Level | Template |
|--------|-------|-------|----------|
| NavigationService | Move Success | Info | `"Player moved {Direction} to '{RoomName}' ({RoomId})"` |
| NavigationService | Move Blocked | Debug | `"Invalid move: No exit {Direction} from {RoomName}"` |
| NavigationService | No Current Room | Warning | `"Move attempted with no current room set"` |
| NavigationService | Room Not Found | Error | `"Current room ID {RoomId} not found in database"` |
| NavigationService | Look | Debug | `"Player looking at current room"` |
| DungeonGenerator | Map Start | Info | `"Generating test dungeon map..."` |
| DungeonGenerator | Map Complete | Info | `"Generated dungeon with {Count} rooms. Starting room: {Name} ({Id})"` |
| DungeonGenerator | Room Creation | Debug | `"Created {Count} room entities"` |
| DungeonGenerator | Room Linking | Debug | `"Linking rooms together..."`, `"Room linking complete"` |
| RoomRepository | Position Query | Debug | `"Fetching room at position {Position}"` |
| RoomRepository | Starting Room | Debug | `"Fetching starting room"` |
| RoomRepository | No Starting Room | Warning | `"No starting room found in database"` |
| RoomRepository | Position Check | Debug | `"Checking if room exists at position {Position}"` |
| RoomRepository | Clear | Info | `"Clearing all rooms from database"`, `"Cleared {Count} rooms"` |
| RoomRepository | Add Range | Debug | `"Adding {Count} rooms to database"` |
| CommandParser | Direction | Debug | `"Movement command: {Direction}"`, `"Go command: {Direction}"` |

---

## Test Summary by Category

| Category | Test Count |
|----------|------------|
| Core/AttributeTests | 12 |
| Core/CharacterTests | 10 |
| Core/CoordinateTests | 23 |
| Core/DirectionTests | 26 |
| Core/GamePhaseTests | 9 |
| Core/GameStateTests | 33 |
| Core/PendingGameActionTests | 7 |
| Core/RoomTests | 23 |
| Engine/CommandParserTests | 72 |
| Engine/DiceServiceTests | 24 |
| Engine/DungeonGeneratorTests | 22 |
| Engine/GameLoopTests | 18 |
| Engine/GameServiceTests | 5 |
| Engine/NavigationServiceTests | 19 |
| Engine/SaveManagerTests | 19 |
| Engine/StatCalculationServiceTests | 35 |
| Integration/PersistenceTests | 17 |
| Integration/RoomPersistenceTests | 27 |
| **Total** | **410** |

---

## Build Verification

```
Build succeeded.
    1 Warning(s) (EF Core version conflict - benign)
    0 Error(s)

Test run:
  Passed: 410
  Failed: 0
  Skipped: 0
```

---

## Directory Structure After v0.0.5

```
RuneAndRust/
├── RuneAndRust.Core/
│   ├── Entities/
│   │   ├── Room.cs               # NEW
│   │   └── SaveGame.cs
│   ├── Enums/
│   │   ├── Attribute.cs
│   │   ├── Direction.cs          # NEW
│   │   ├── GamePhase.cs
│   │   └── PendingGameAction.cs
│   ├── Interfaces/
│   │   ├── IDiceService.cs
│   │   ├── IGameService.cs
│   │   ├── IInputHandler.cs
│   │   ├── INavigationService.cs # NEW
│   │   ├── IRepository.cs
│   │   ├── IRoomRepository.cs    # NEW
│   │   ├── ISaveGameRepository.cs
│   │   └── IStatCalculationService.cs
│   ├── Models/
│   │   ├── Character.cs
│   │   └── GameState.cs          # MODIFIED
│   └── ValueObjects/
│       └── Coordinate.cs         # NEW
├── RuneAndRust.Engine/
│   └── Services/
│       ├── CommandParser.cs      # MODIFIED
│       ├── DiceService.cs
│       ├── DungeonGenerator.cs   # NEW
│       ├── GameService.cs
│       ├── NavigationService.cs  # NEW
│       ├── SaveManager.cs
│       └── StatCalculationService.cs
├── RuneAndRust.Persistence/
│   ├── Data/
│   │   └── RuneAndRustDbContext.cs # MODIFIED
│   └── Repositories/
│       ├── GenericRepository.cs
│       ├── RoomRepository.cs     # NEW
│       └── SaveGameRepository.cs
├── RuneAndRust.Terminal/
│   ├── Program.cs                # MODIFIED
│   └── Services/
│       └── TerminalInputHandler.cs
├── RuneAndRust.Tests/
│   ├── Core/
│   │   ├── AttributeTests.cs
│   │   ├── CharacterTests.cs
│   │   ├── CoordinateTests.cs    # NEW
│   │   ├── DirectionTests.cs     # NEW
│   │   ├── GamePhaseTests.cs
│   │   ├── GameStateTests.cs     # MODIFIED
│   │   ├── PendingGameActionTests.cs
│   │   └── RoomTests.cs          # NEW
│   ├── Engine/
│   │   ├── CommandParserTests.cs # MODIFIED
│   │   ├── DiceServiceTests.cs
│   │   ├── DungeonGeneratorTests.cs # NEW
│   │   ├── GameLoopTests.cs
│   │   ├── GameServiceTests.cs
│   │   ├── NavigationServiceTests.cs # NEW
│   │   ├── SaveManagerTests.cs
│   │   └── StatCalculationServiceTests.cs
│   └── Integration/
│       ├── PersistenceTests.cs
│       └── RoomPersistenceTests.cs # NEW
└── docs/
    └── changelogs/
        ├── v0.0.2.md
        ├── v0.0.3.md
        ├── v0.0.4.md
        └── v0.0.5.md             # NEW
```

---

## Database Schema

### Rooms Table
```sql
CREATE TABLE "Rooms" (
    "Id" uuid NOT NULL PRIMARY KEY,
    "Name" character varying(200) NOT NULL,
    "Description" character varying(2000) NOT NULL,
    "PositionX" integer NOT NULL,
    "PositionY" integer NOT NULL,
    "PositionZ" integer NOT NULL,
    "IsStartingRoom" boolean NOT NULL,
    "Exits" jsonb NOT NULL
);
```

---

## Commands Reference (Updated)

### MainMenu Phase
```
start, new, play  - Begin a new game session
load              - Load a saved game
quit, exit, q     - Exit the application
help, ?           - Display available commands
```

### Exploration Phase
```
Movement:
  n, s, e, w       - Move north, south, east, or west
  u, d             - Move up or down
  go <direction>   - Move in a direction

Actions:
  look, l          - Examine your surroundings
  exits            - Show available exits
  status, stats    - Display current game status
  save             - Save your progress
  load             - Load a saved game
  menu, mainmenu   - Return to main menu
  help, ?          - Display available commands
  quit, exit, q    - Exit the application
```

---

## Migration Instructions

### Apply Migrations
```bash
# From solution root
dotnet ef migrations add AddRooms --project RuneAndRust.Persistence --startup-project RuneAndRust.Terminal
dotnet ef database update --project RuneAndRust.Persistence --startup-project RuneAndRust.Terminal
```

---

## Next Steps (v0.1.0: Character Creation)

Potential features for the next release:
- Character creation wizard
- Attribute point allocation
- Starting equipment selection
- Character persistence with save games
