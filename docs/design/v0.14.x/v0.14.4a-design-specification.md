# v0.14.4a Design Specification: Biome Schema

**Version:** 0.14.4a
**Parent:** v0.14.4 (Environment Configuration Schemas)
**Prerequisites:** v0.14.3 Complete (Monster Configuration Schemas)
**Status:** Design Complete

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Biome Schema Root Definition](#4-biome-schema-root-definition)
   - 4.1 [Root Configuration Properties](#41-root-configuration-properties)
   - 4.2 [BiomeDefinition Schema](#42-biomedefinition-schema)
5. [Default Category Values](#5-default-category-values)
   - 5.1 [Climate Enumeration](#51-climate-enumeration)
   - 5.2 [Lighting Enumeration](#52-lighting-enumeration)
   - 5.3 [Era Enumeration](#53-era-enumeration)
   - 5.4 [Condition Enumeration](#54-condition-enumeration)
6. [Descriptor Configuration](#6-descriptor-configuration)
   - 6.1 [Implied Tags](#61-implied-tags)
   - 6.2 [Descriptor Pool Overrides](#62-descriptor-pool-overrides)
   - 6.3 [Emphasized Terms](#63-emphasized-terms)
   - 6.4 [Excluded Terms](#64-excluded-terms)
7. [Monster Spawn Table Configuration](#7-monster-spawn-table-configuration)
   - 7.1 [SpawnTable Definition](#71-spawntable-definition)
   - 7.2 [SpawnEntry Definition](#72-spawnentry-definition)
   - 7.3 [Depth-Based Spawning](#73-depth-based-spawning)
8. [Terrain Distribution Configuration](#8-terrain-distribution-configuration)
   - 8.1 [TerrainDistribution Definition](#81-terraindistribution-definition)
   - 8.2 [Percentage Validation](#82-percentage-validation)
9. [Hazard Frequency Configuration](#9-hazard-frequency-configuration)
   - 9.1 [HazardFrequency Definition](#91-hazardfrequency-definition)
   - 9.2 [Depth Scaling](#92-depth-scaling)
10. [Audio Configuration](#10-audio-configuration)
    - 10.1 [Music Theme Association](#101-music-theme-association)
    - 10.2 [Ambient Sound Association](#102-ambient-sound-association)
11. [Validation Rules](#11-validation-rules)
    - 11.1 [ID Pattern Validation](#111-id-pattern-validation)
    - 11.2 [Range Validation](#112-range-validation)
    - 11.3 [Required Fields](#113-required-fields)
    - 11.4 [Enum Validation](#114-enum-validation)
12. [Configuration Schema](#12-configuration-schema)
13. [Configuration File Updates](#13-configuration-file-updates)
14. [Data Model Changes](#14-data-model-changes)
15. [Logging Specifications](#15-logging-specifications)
16. [Unit Testing Requirements](#16-unit-testing-requirements)
17. [Use Cases](#17-use-cases)
18. [Deliverable Checklist](#18-deliverable-checklist)
19. [Acceptance Criteria](#19-acceptance-criteria)
20. [Dependencies](#20-dependencies)
21. [Future Considerations](#21-future-considerations)

---

## 1. Executive Summary

Version 0.14.4a introduces the **Biome Schema** (`biomes.schema.json`), which validates biome definitions including default environmental categories, descriptor pool overrides, term filters, monster spawn tables, terrain distributions, hazard frequencies, and audio associations. This schema enables full customization of biome environments without code changes, supporting modding scenarios such as sci-fi space stations, underwater caverns, haunted mansions, or procedurally generated wilderness areas.

The Biome Schema validates the existing `biomes.json` configuration file which currently defines 8 biomes (cave, dungeon, volcanic, frozen, swamp, ruins, forest, desert). The schema establishes patterns for environment-specific configurations that will be extended by room types (v0.14.4b), terrain (v0.14.4c), and interactive objects (v0.14.4d).

### Key Deliverables

| Category | Items |
|----------|-------|
| **Schema Files** | `biomes.schema.json` |
| **Schema Definitions** | `BiomeDefinition`, `DefaultCategories`, `SpawnTable`, `SpawnEntry`, `TerrainDistribution`, `TerrainEntry`, `HazardFrequency` |
| **Configuration Files** | Update `biomes.json` to reference new schema |
| **Tests** | ~5 new unit tests |

### Architectural Significance

This version provides:
- **Environmental category validation** - Climate, lighting, era, condition enumerations
- **Descriptor system integration** - Pool overrides, implied tags, term filters
- **Monster spawn tables** - Weighted spawn entries with depth restrictions
- **Terrain distribution** - Percentage-based terrain type allocation
- **Hazard frequency** - Base chance with depth scaling
- **Audio associations** - Music theme and ambient sound references

### Relationship to Other Schemas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  v0.14.4 ENVIRONMENT CONFIGURATION SCHEMAS                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  v0.14.4a: biomes.schema.json â—€â”€â”€ THIS VERSION                          â”‚
  â”‚  v0.14.4b: room-types.schema.json                                       â”‚
  â”‚  v0.14.4c: terrain.schema.json (expansion)                              â”‚
  â”‚  v0.14.4d: interactive-objects.schema.json                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Cross-references:
  â€¢ biomes.json â†’ monsterSpawnTable.entries[].monsterId references monsters.json
  â€¢ biomes.json â†’ terrainDistribution.entries[].terrainId references terrain.json
  â€¢ biomes.json â†’ hazardFrequency.hazardTypes references terrain.json hazards
  â€¢ biomes.json â†’ musicThemeId references music-themes.json
  â€¢ biomes.json â†’ ambientSoundId references sound-effects.json

  Shared definitions:
  â€¢ ID pattern: ^[a-z][a-z0-9-]*$ (lowercase kebab-case)
  â€¢ Schema location: config/schemas/
  â€¢ Biomes structure: Object map keyed by biome ID
```

---

## 2. Feature Overview

```
v0.14.4a Biome Schema Features
â”œâ”€â”€ biomes.schema.json
â”‚   â”œâ”€â”€ Root Configuration Properties
â”‚   â”‚   â”œâ”€â”€ $schema (string, optional)
â”‚   â”‚   â”œâ”€â”€ version (string, optional)
â”‚   â”‚   â””â”€â”€ biomes (object map of biome id -> BiomeDefinition, required)
â”‚   â””â”€â”€ Definitions
â”‚       â”œâ”€â”€ BiomeDefinition
â”‚       â”‚   â”œâ”€â”€ id (string, kebab-case pattern, required)
â”‚       â”‚   â”œâ”€â”€ name (string, minLength: 1, required)
â”‚       â”‚   â”œâ”€â”€ description (string, required)
â”‚       â”‚   â”œâ”€â”€ defaultCategoryValues (DefaultCategories, required)
â”‚       â”‚   â”œâ”€â”€ impliedTags (array of string, required)
â”‚       â”‚   â”œâ”€â”€ descriptorPoolOverrides (object, required)
â”‚       â”‚   â”œâ”€â”€ emphasizedTerms (array of string, required)
â”‚       â”‚   â”œâ”€â”€ excludedTerms (array of string, required)
â”‚       â”‚   â”œâ”€â”€ monsterSpawnTable (SpawnTable, optional)
â”‚       â”‚   â”œâ”€â”€ terrainDistribution (TerrainDistribution, optional)
â”‚       â”‚   â”œâ”€â”€ hazardFrequency (HazardFrequency, optional)
â”‚       â”‚   â”œâ”€â”€ musicThemeId (string, optional)
â”‚       â”‚   â”œâ”€â”€ ambientSoundId (string, optional)
â”‚       â”‚   â””â”€â”€ sortOrder (integer, minimum: 0, optional)
â”‚       â”œâ”€â”€ DefaultCategories
â”‚       â”‚   â”œâ”€â”€ climate (enum, required)
â”‚       â”‚   â”œâ”€â”€ lighting (enum, required)
â”‚       â”‚   â”œâ”€â”€ era (enum, optional)
â”‚       â”‚   â””â”€â”€ condition (enum, optional)
â”‚       â”œâ”€â”€ SpawnTable
â”‚       â”‚   â”œâ”€â”€ entries (array of SpawnEntry)
â”‚       â”‚   â””â”€â”€ levelModifier (integer, optional)
â”‚       â”œâ”€â”€ SpawnEntry
â”‚       â”‚   â”œâ”€â”€ monsterId (string, required)
â”‚       â”‚   â”œâ”€â”€ weight (integer, minimum: 1, default: 100)
â”‚       â”‚   â”œâ”€â”€ minDepth (integer, optional)
â”‚       â”‚   â””â”€â”€ maxDepth (integer, optional)
â”‚       â”œâ”€â”€ TerrainDistribution
â”‚       â”‚   â””â”€â”€ entries (array of TerrainEntry)
â”‚       â”œâ”€â”€ TerrainEntry
â”‚       â”‚   â”œâ”€â”€ terrainId (string, required)
â”‚       â”‚   â””â”€â”€ percentage (number, 0-100, required)
â”‚       â””â”€â”€ HazardFrequency
â”‚           â”œâ”€â”€ baseChance (number, 0-1, default: 0.1)
â”‚           â”œâ”€â”€ hazardTypes (array of string)
â”‚           â””â”€â”€ depthScaling (number, optional)
â”œâ”€â”€ Validation Rules
â”‚   â”œâ”€â”€ Biome ID Pattern Validation (kebab-case)
â”‚   â”œâ”€â”€ Climate Enum Validation (6 values)
â”‚   â”œâ”€â”€ Lighting Enum Validation (4 values)
â”‚   â”œâ”€â”€ Era Enum Validation (4 values)
â”‚   â”œâ”€â”€ Condition Enum Validation (6 values)
â”‚   â”œâ”€â”€ Spawn Weight Range Validation (>= 1)
â”‚   â”œâ”€â”€ Terrain Percentage Range Validation (0-100)
â”‚   â”œâ”€â”€ Hazard Base Chance Range Validation (0-1)
â”‚   â””â”€â”€ Required Fields Enforced
â””â”€â”€ Configuration Updates
    â””â”€â”€ biomes.json updated with $schema reference
```

---

## 3. Architecture Diagrams

### 3.1 Biome Definition Structure Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BIOME DEFINITION STRUCTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      BIOME DEFINITION                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  id: "volcanic"                                                      â”‚    â”‚
â”‚  â”‚  name: "Volcanic"                                                    â”‚    â”‚
â”‚  â”‚  description: "Areas of active or dormant volcanic activity"         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  DEFAULT CATEGORY VALUES                                       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ climate: "scorching"    (6 options)                     â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ lighting: "dim"          (4 options)                    â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ era: null                (4 options, optional)          â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ condition: null          (6 options, optional)          â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  DESCRIPTOR CONFIGURATION                                      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ impliedTags: ["volcanic", "heat", "danger", "fire"]     â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ descriptorPoolOverrides: {                              â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   "environmental.lighting": "...volcanic",              â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   "environmental.temperature": "...volcanic",           â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   "environmental.smells": "...volcanic"                 â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ }                                                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ emphasizedTerms: ["lava", "sulfur", "heat", "glow"]     â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ excludedTerms: ["cold", "ice", "frost", "chill"]        â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  SPAWN CONFIGURATION (optional)                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ monsterSpawnTable: {                                    â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   entries: [{monsterId: "fire_elemental", weight: 50}], â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   levelModifier: 2                                      â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ }                                                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ terrainDistribution: {                                  â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   entries: [{terrainId: "lava", percentage: 15}]        â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ }                                                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ hazardFrequency: {                                      â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   baseChance: 0.2,                                      â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚   hazardTypes: ["lava_pool", "fire_geyser"]             â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ }                                                       â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  AUDIO CONFIGURATION (optional)                                â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ musicThemeId: "volcanic_cavern"                         â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ ambientSoundId: "lava_bubbling"                         â”‚  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Schema Validation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SCHEMA VALIDATION FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    User edits biomes.json
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          IDE/EDITOR                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. Reads $schema property from config file                                  â”‚
â”‚  2. Loads biomes.schema.json from config/schemas/                            â”‚
â”‚  3. Validates content against schema                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€ Valid â”€â”€â”€â–¶ Green checkmark, autocomplete works
           â”‚
           â””â”€â”€â”€ Invalid â”€â–¶ Error underlines with messages:
                           â€¢ "climate must be one of: freezing, cold, ..."
                           â€¢ "id must match pattern ^[a-z][a-z0-9-]*$"
                           â€¢ "percentage must be between 0 and 100"
                           â€¢ "baseChance must be between 0 and 1"
```

### 3.3 Biome Category System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BIOME CATEGORY SYSTEM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  CLIMATE (Required)                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ freezing â”€â”€â–¶ cold â”€â”€â–¶ temperate â”€â”€â–¶ warm â”€â”€â–¶ hot â”€â”€â–¶ scorching        â”‚ â”‚
â”‚  â”‚    â„ï¸         â„ï¸          ğŸŒ¤ï¸          â˜€ï¸        ğŸ”¥        ğŸŒ‹             â”‚ â”‚
â”‚  â”‚  Extreme    Chilly    Comfortable   Heated    Very      Extreme       â”‚ â”‚
â”‚  â”‚   cold                              warm                 heat         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  LIGHTING (Required)                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     dark â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ dim â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ normal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ bright        â”‚ â”‚
â”‚  â”‚      ğŸŒ‘                ğŸŒ˜                ğŸŒ•                â˜€ï¸            â”‚ â”‚
â”‚  â”‚  No natural      Minimal light     Standard          Ample light     â”‚ â”‚
â”‚  â”‚    light                           lighting                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  ERA (Optional)                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ancient â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ medieval â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ modern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ futuristicâ”‚ â”‚
â”‚  â”‚    ğŸ›ï¸                   ğŸ°                  ğŸ¢                  ğŸš€       â”‚ â”‚
â”‚  â”‚  Primordial         Historical         Contemporary       Advanced    â”‚ â”‚
â”‚  â”‚   ruins              castles            buildings         technology  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  CONDITION (Optional)                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ pristine â”‚ weathered â”‚ ruined â”‚ collapsed â”‚ flooded â”‚ overgrown       â”‚ â”‚
â”‚  â”‚    âœ¨    â”‚     ğŸª¨     â”‚   ğŸ§±   â”‚     ğŸ’¥     â”‚    ğŸŒŠ   â”‚     ğŸŒ¿          â”‚ â”‚
â”‚  â”‚  Perfect â”‚  Worn but â”‚ Damagedâ”‚  Partiallyâ”‚  Water- â”‚  Vegetation    â”‚ â”‚
â”‚  â”‚  state   â”‚  intact   â”‚  areas â”‚ destroyed â”‚  filled â”‚   covered      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 Monster Spawn Table System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MONSTER SPAWN TABLE SYSTEM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SPAWN TABLE CONFIGURATION                                                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  monsterSpawnTable: {                                                 â”‚   â”‚
â”‚  â”‚    "levelModifier": 2,        // All spawns +2 levels                 â”‚   â”‚
â”‚  â”‚    "entries": [                                                       â”‚   â”‚
â”‚  â”‚      { "monsterId": "fire_elemental", "weight": 30, "minDepth": 3 },  â”‚   â”‚
â”‚  â”‚      { "monsterId": "magma_slime", "weight": 50 },                    â”‚   â”‚
â”‚  â”‚      { "monsterId": "ember_sprite", "weight": 70, "maxDepth": 5 },    â”‚   â”‚
â”‚  â”‚      { "monsterId": "lava_golem", "weight": 10, "minDepth": 7 }       â”‚   â”‚
â”‚  â”‚    ]                                                                  â”‚   â”‚
â”‚  â”‚  }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  WEIGHT DISTRIBUTION (Higher = More Common)                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Total Weight = 30 + 50 + 70 + 10 = 160                                 â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚ 0%                                                              100%  â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚ â”‚ fire_elem    â”‚     magma_slime     â”‚      ember_sprite        â”‚lavaâ”‚ â”‚ â”‚
â”‚  â”‚ â”‚   (18.75%)   â”‚       (31.25%)      â”‚        (43.75%)          â”‚6.25â”‚ â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  DEPTH-BASED FILTERING                                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Depth  â”‚ fire_elemental â”‚ magma_slime â”‚ ember_sprite â”‚ lava_golem     â”‚ â”‚
â”‚  â”‚        â”‚ (minDepth: 3)  â”‚ (no limit)  â”‚ (maxDepth: 5)â”‚ (minDepth: 7)  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚   1    â”‚       âŒ       â”‚      âœ…     â”‚      âœ…      â”‚       âŒ       â”‚ â”‚
â”‚  â”‚   2    â”‚       âŒ       â”‚      âœ…     â”‚      âœ…      â”‚       âŒ       â”‚ â”‚
â”‚  â”‚   3    â”‚       âœ…       â”‚      âœ…     â”‚      âœ…      â”‚       âŒ       â”‚ â”‚
â”‚  â”‚   4    â”‚       âœ…       â”‚      âœ…     â”‚      âœ…      â”‚       âŒ       â”‚ â”‚
â”‚  â”‚   5    â”‚       âœ…       â”‚      âœ…     â”‚      âœ…      â”‚       âŒ       â”‚ â”‚
â”‚  â”‚   6    â”‚       âœ…       â”‚      âœ…     â”‚      âŒ      â”‚       âŒ       â”‚ â”‚
â”‚  â”‚   7+   â”‚       âœ…       â”‚      âœ…     â”‚      âŒ      â”‚       âœ…       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 Terrain Distribution System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TERRAIN DISTRIBUTION SYSTEM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  TERRAIN DISTRIBUTION CONFIGURATION                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  terrainDistribution: {                                               â”‚   â”‚
â”‚  â”‚    "entries": [                                                       â”‚   â”‚
â”‚  â”‚      { "terrainId": "stone_floor", "percentage": 60 },                â”‚   â”‚
â”‚  â”‚      { "terrainId": "rubble", "percentage": 20 },                     â”‚   â”‚
â”‚  â”‚      { "terrainId": "lava_rock", "percentage": 15 },                  â”‚   â”‚
â”‚  â”‚      { "terrainId": "lava_pool", "percentage": 5 }                    â”‚   â”‚
â”‚  â”‚    ]                                                                  â”‚   â”‚
â”‚  â”‚  }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  PERCENTAGE VISUALIZATION                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 0%                                                              100%  â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â”‚ â”‚          stone_floor (60%)        â”‚ rubble     â”‚lava_rockâ”‚ lava   â”‚ â”‚ â”‚
â”‚  â”‚ â”‚                                   â”‚   (20%)    â”‚  (15%)  â”‚  (5%)  â”‚ â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  GENERATED ROOM EXAMPLE (10x10 grid)                                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚     . . . . . . . . . .     Legend:                                    â”‚ â”‚
â”‚  â”‚     . . R . . . . . . .     . = stone_floor (60 tiles)                 â”‚ â”‚
â”‚  â”‚     . . . . . . . R . .     R = rubble (20 tiles)                      â”‚ â”‚
â”‚  â”‚     . . . . L . . . . .     L = lava_rock (15 tiles)                   â”‚ â”‚
â”‚  â”‚     . . R . L . . . . .     ~ = lava_pool (5 tiles)                    â”‚ â”‚
â”‚  â”‚     . . . . L L . R . .                                                â”‚ â”‚
â”‚  â”‚     . . . . ~ L . . . .                                                â”‚ â”‚
â”‚  â”‚     R . . . ~ . . . . .                                                â”‚ â”‚
â”‚  â”‚     . . . . ~ . . R . .                                                â”‚ â”‚
â”‚  â”‚     . . . . . . . . . .                                                â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 Hazard Frequency System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       HAZARD FREQUENCY SYSTEM                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  HAZARD FREQUENCY CONFIGURATION                                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  hazardFrequency: {                                                   â”‚   â”‚
â”‚  â”‚    "baseChance": 0.15,        // 15% base hazard chance               â”‚   â”‚
â”‚  â”‚    "hazardTypes": [           // Hazard terrain types to spawn        â”‚   â”‚
â”‚  â”‚      "lava_pool",                                                     â”‚   â”‚
â”‚  â”‚      "fire_geyser",                                                   â”‚   â”‚
â”‚  â”‚      "unstable_ground"                                                â”‚   â”‚
â”‚  â”‚    ],                                                                 â”‚   â”‚
â”‚  â”‚    "depthScaling": 0.02       // +2% per floor depth                  â”‚   â”‚
â”‚  â”‚  }                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  DEPTH SCALING CALCULATION                                                   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Effective Chance = baseChance + (depth Ã— depthScaling)                â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Example with baseChance: 0.15, depthScaling: 0.02                     â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â”‚  Depth â”‚ Calculation          â”‚ Effective Chance                       â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â”‚
â”‚  â”‚    1   â”‚ 0.15 + (1 Ã— 0.02)    â”‚ 17%                                    â”‚ â”‚
â”‚  â”‚    3   â”‚ 0.15 + (3 Ã— 0.02)    â”‚ 21%                                    â”‚ â”‚
â”‚  â”‚    5   â”‚ 0.15 + (5 Ã— 0.02)    â”‚ 25%                                    â”‚ â”‚
â”‚  â”‚   10   â”‚ 0.15 + (10 Ã— 0.02)   â”‚ 35%                                    â”‚ â”‚
â”‚  â”‚   20   â”‚ 0.15 + (20 Ã— 0.02)   â”‚ 55%                                    â”‚ â”‚
â”‚  â”‚                                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â”‚  HAZARD CHANCE GRAPH                                                         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Chance                                                                â”‚ â”‚
â”‚  â”‚    60%â”‚                                              â•±                 â”‚ â”‚
â”‚  â”‚       â”‚                                           â•±                    â”‚ â”‚
â”‚  â”‚    45%â”‚                                        â•±                       â”‚ â”‚
â”‚  â”‚       â”‚                                     â•±                          â”‚ â”‚
â”‚  â”‚    30%â”‚                                  â•±                             â”‚ â”‚
â”‚  â”‚       â”‚                               â•±                                â”‚ â”‚
â”‚  â”‚    15%â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ base        â”‚ â”‚
â”‚  â”‚       â”‚                                                                â”‚ â”‚
â”‚  â”‚     0%â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â–¶ Depth          â”‚ â”‚
â”‚  â”‚             1     5    10    15    20    25    30                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.7 Descriptor System Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DESCRIPTOR SYSTEM INTEGRATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  DESCRIPTOR FLOW                                                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  1. System requests description for a room in "volcanic" biome        â”‚   â”‚
â”‚  â”‚        â”‚                                                              â”‚   â”‚
â”‚  â”‚        â–¼                                                              â”‚   â”‚
â”‚  â”‚  2. Check impliedTags: ["volcanic", "heat", "danger", "fire"]         â”‚   â”‚
â”‚  â”‚        â”‚                                                              â”‚   â”‚
â”‚  â”‚        â–¼                                                              â”‚   â”‚
â”‚  â”‚  3. Apply descriptorPoolOverrides                                     â”‚   â”‚
â”‚  â”‚     â€¢ environmental.lighting â†’ environmental.lighting.volcanic        â”‚   â”‚
â”‚  â”‚     â€¢ environmental.temperature â†’ environmental.temperature.volcanic  â”‚   â”‚
â”‚  â”‚        â”‚                                                              â”‚   â”‚
â”‚  â”‚        â–¼                                                              â”‚   â”‚
â”‚  â”‚  4. Select descriptors from pools                                     â”‚   â”‚
â”‚  â”‚        â”‚                                                              â”‚   â”‚
â”‚  â”‚        â–¼                                                              â”‚   â”‚
â”‚  â”‚  5. Apply emphasizedTerms: ["lava", "sulfur", "heat", "glow"]         â”‚   â”‚
â”‚  â”‚     â€¢ Boost probability of descriptors containing these words         â”‚   â”‚
â”‚  â”‚        â”‚                                                              â”‚   â”‚
â”‚  â”‚        â–¼                                                              â”‚   â”‚
â”‚  â”‚  6. Apply excludedTerms: ["cold", "ice", "frost", "chill"]            â”‚   â”‚
â”‚  â”‚     â€¢ Remove any descriptors containing these words                   â”‚   â”‚
â”‚  â”‚        â”‚                                                              â”‚   â”‚
â”‚  â”‚        â–¼                                                              â”‚   â”‚
â”‚  â”‚  7. Generate final description                                        â”‚   â”‚
â”‚  â”‚     "The chamber glows with an orange light from the lava flow        â”‚   â”‚
â”‚  â”‚      below. The sulfurous air burns your nostrils."                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  POOL OVERRIDE MAPPING                                                       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Default Pool                    â”‚ Override Pool (Volcanic)             â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ environmental.lighting          â”‚ environmental.lighting.volcanic      â”‚ â”‚
â”‚  â”‚ environmental.temperature       â”‚ environmental.temperature.volcanic   â”‚ â”‚
â”‚  â”‚ environmental.smells            â”‚ environmental.smells.volcanic        â”‚ â”‚
â”‚  â”‚ environmental.sounds            â”‚ (uses default - no override)         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.8 File Layer Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            CONFIG LAYER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  config/                                                                     â”‚
â”‚  â”œâ”€â”€ biomes.json â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   {                                         â”‚ references                  â”‚
â”‚  â”‚     "$schema": "./schemas/biomes.schema.json",                            â”‚
â”‚  â”‚     "version": "1.0",                       â”‚                             â”‚
â”‚  â”‚     "biomes": {                             â”‚                             â”‚
â”‚  â”‚       "volcanic": {                         â”‚                             â”‚
â”‚  â”‚         "id": "volcanic",                   â”‚                             â”‚
â”‚  â”‚         "name": "Volcanic",                 â”‚                             â”‚
â”‚  â”‚         "defaultCategoryValues": {          â”‚                             â”‚
â”‚  â”‚           "climate": "scorching",           â”‚                             â”‚
â”‚  â”‚           "lighting": "dim"                 â”‚                             â”‚
â”‚  â”‚         },                                  â”‚                             â”‚
â”‚  â”‚         "impliedTags": [...],               â”‚                             â”‚
â”‚  â”‚         "monsterSpawnTable": {...}          â”‚ â†’ monsters.json             â”‚
â”‚  â”‚         "terrainDistribution": {...}        â”‚ â†’ terrain.json              â”‚
â”‚  â”‚         "musicThemeId": "..."               â”‚ â†’ music-themes.json         â”‚
â”‚  â”‚       },                                    â”‚                             â”‚
â”‚  â”‚       ...                                   â”‚                             â”‚
â”‚  â”‚     }                                       â”‚                             â”‚
â”‚  â”‚   }                                         â”‚                             â”‚
â”‚  â”‚                                             â”‚                             â”‚
â”‚  â”œâ”€â”€ monsters.json (provides monsterId targets)â”‚                             â”‚
â”‚  â”œâ”€â”€ terrain.json (provides terrainId targets) â”‚                             â”‚
â”‚  â”œâ”€â”€ music-themes.json (provides musicThemeId targets)                       â”‚
â”‚  â”‚                                             â”‚                             â”‚
â”‚  â””â”€â”€ schemas/                                  â”‚                             â”‚
â”‚      â””â”€â”€ biomes.schema.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚          {                                                                   â”‚
â”‚            "$schema": "http://json-schema.org/draft-07/schema#",            â”‚
â”‚            "definitions": {                                                  â”‚
â”‚              "BiomeDefinition": {...},                                       â”‚
â”‚              "DefaultCategories": {...},                                     â”‚
â”‚              "SpawnTable": {...},                                            â”‚
â”‚              "SpawnEntry": {...},                                            â”‚
â”‚              "TerrainDistribution": {...},                                   â”‚
â”‚              "TerrainEntry": {...},                                          â”‚
â”‚              "HazardFrequency": {...}                                        â”‚
â”‚            }                                                                 â”‚
â”‚          }                                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Biome Schema Root Definition

### 4.1 Root Configuration Properties

**File:** `config/schemas/biomes.schema.json`

The biome schema follows JSON Schema Draft-07 specification, providing comprehensive validation for biome configuration files.

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Biome Configuration",
    "description": "Schema for biome definitions including environmental categories, descriptor overrides, monster spawn tables, terrain distributions, and hazard frequencies.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "biomes": {
            "type": "object",
            "description": "Map of biome IDs to biome definitions",
            "additionalProperties": {
                "$ref": "#/definitions/BiomeDefinition"
            },
            "minProperties": 1
        }
    },
    "required": ["biomes"],
    "additionalProperties": false,
    "definitions": {
        "BiomeDefinition": { ... },
        "DefaultCategories": { ... },
        "SpawnTable": { ... },
        "SpawnEntry": { ... },
        "TerrainDistribution": { ... },
        "TerrainEntry": { ... },
        "HazardFrequency": { ... }
    }
}
```

### 4.2 BiomeDefinition Schema

The `BiomeDefinition` object defines a complete biome with all its environmental properties.

```json
"BiomeDefinition": {
    "type": "object",
    "description": "A biome definition with environmental categories, descriptors, and spawn configurations",
    "properties": {
        "id": {
            "type": "string",
            "description": "Unique identifier for the biome (lowercase kebab-case)",
            "pattern": "^[a-z][a-z0-9-]*$",
            "minLength": 1,
            "maxLength": 50
        },
        "name": {
            "type": "string",
            "description": "Display name shown to players",
            "minLength": 1,
            "maxLength": 100
        },
        "description": {
            "type": "string",
            "description": "Flavor text describing the biome"
        },
        "defaultCategoryValues": {
            "$ref": "#/definitions/DefaultCategories",
            "description": "Default environmental category values for this biome"
        },
        "impliedTags": {
            "type": "array",
            "description": "Tags automatically applied to rooms in this biome for descriptor filtering",
            "items": {
                "type": "string",
                "minLength": 1
            }
        },
        "descriptorPoolOverrides": {
            "type": "object",
            "description": "Map of descriptor category to override pool ID",
            "additionalProperties": {
                "type": "string"
            }
        },
        "emphasizedTerms": {
            "type": "array",
            "description": "Terms that should be emphasized in descriptor selection",
            "items": {
                "type": "string",
                "minLength": 1
            }
        },
        "excludedTerms": {
            "type": "array",
            "description": "Terms that should be excluded from descriptors",
            "items": {
                "type": "string",
                "minLength": 1
            }
        },
        "monsterSpawnTable": {
            "$ref": "#/definitions/SpawnTable",
            "description": "Monster spawn configuration for this biome"
        },
        "terrainDistribution": {
            "$ref": "#/definitions/TerrainDistribution",
            "description": "Terrain type distribution percentages"
        },
        "hazardFrequency": {
            "$ref": "#/definitions/HazardFrequency",
            "description": "Hazard spawn frequency configuration"
        },
        "musicThemeId": {
            "type": "string",
            "description": "Reference to music theme in music-themes.json",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "ambientSoundId": {
            "type": "string",
            "description": "Reference to ambient sound in sound-effects.json",
            "pattern": "^[a-z][a-z0-9-]*$"
        },
        "sortOrder": {
            "type": "integer",
            "description": "Order for display sorting (lower values first)",
            "minimum": 0
        }
    },
    "required": ["id", "name", "description", "defaultCategoryValues", "impliedTags", "descriptorPoolOverrides", "emphasizedTerms", "excludedTerms"],
    "additionalProperties": false
}
```

---

## 5. Default Category Values

### 5.1 Climate Enumeration

The `climate` field defines the temperature characteristic of the biome.

```json
"climate": {
    "type": "string",
    "description": "Temperature characteristic of the biome",
    "enum": ["freezing", "cold", "temperate", "warm", "hot", "scorching"]
}
```

| Climate | Description | Temperature Effect |
|---------|-------------|-------------------|
| `freezing` | Extreme cold | Cold damage over time |
| `cold` | Chilly environment | Minor stamina drain |
| `temperate` | Comfortable temperature | No effect |
| `warm` | Heated environment | Minor stamina drain |
| `hot` | Very warm | Increased stamina drain |
| `scorching` | Extreme heat | Fire damage over time |

### 5.2 Lighting Enumeration

The `lighting` field defines the ambient light level of the biome.

```json
"lighting": {
    "type": "string",
    "description": "Ambient light level of the biome",
    "enum": ["dark", "dim", "normal", "bright"]
}
```

| Lighting | Description | Visibility Effect |
|----------|-------------|-------------------|
| `dark` | No natural light | Severely reduced sight |
| `dim` | Minimal light | Reduced sight range |
| `normal` | Standard lighting | Normal visibility |
| `bright` | Ample light | Extended sight range |

### 5.3 Era Enumeration

The optional `era` field defines the architectural/temporal style of the biome.

```json
"era": {
    "type": "string",
    "description": "Architectural/temporal style of the biome",
    "enum": ["ancient", "medieval", "modern", "futuristic"]
}
```

| Era | Description | Architectural Style |
|-----|-------------|---------------------|
| `ancient` | Primordial structures | Ruins, temples, tombs |
| `medieval` | Historical period | Castles, dungeons, keeps |
| `modern` | Contemporary | Buildings, bunkers |
| `futuristic` | Advanced technology | Space stations, labs |

### 5.4 Condition Enumeration

The optional `condition` field defines the physical state of structures in the biome.

```json
"condition": {
    "type": "string",
    "description": "Physical state of structures in the biome",
    "enum": ["pristine", "weathered", "ruined", "collapsed", "flooded", "overgrown"]
}
```

| Condition | Description | Visual Effect |
|-----------|-------------|---------------|
| `pristine` | Perfect state | Clean, maintained |
| `weathered` | Worn but intact | Faded, aged |
| `ruined` | Damaged areas | Broken sections |
| `collapsed` | Partially destroyed | Debris, blocked paths |
| `flooded` | Water-filled | Pools, streams |
| `overgrown` | Vegetation covered | Vines, roots, moss |

### DefaultCategories Definition

```json
"DefaultCategories": {
    "type": "object",
    "description": "Default environmental category values for a biome",
    "properties": {
        "climate": {
            "type": "string",
            "description": "Temperature characteristic",
            "enum": ["freezing", "cold", "temperate", "warm", "hot", "scorching"]
        },
        "lighting": {
            "type": "string",
            "description": "Ambient light level",
            "enum": ["dark", "dim", "normal", "bright"]
        },
        "era": {
            "type": "string",
            "description": "Architectural/temporal style (optional)",
            "enum": ["ancient", "medieval", "modern", "futuristic"]
        },
        "condition": {
            "type": "string",
            "description": "Physical state of structures (optional)",
            "enum": ["pristine", "weathered", "ruined", "collapsed", "flooded", "overgrown"]
        }
    },
    "required": ["climate", "lighting"],
    "additionalProperties": false
}
```

---

## 6. Descriptor Configuration

### 6.1 Implied Tags

The `impliedTags` array contains tags automatically applied to rooms in this biome for descriptor filtering.

**Configuration:**
```json
{
    "impliedTags": ["underground", "natural", "stone", "cave"]
}
```

**Effect:**
- Tags are used by the descriptor system to filter appropriate text
- Multiple tags allow for nuanced descriptor selection
- Tags are combined with room-specific tags

**Example Tags by Biome:**
| Biome | Implied Tags |
|-------|--------------|
| `cave` | underground, natural, stone, cave |
| `dungeon` | underground, constructed, stone, dungeon |
| `volcanic` | volcanic, heat, danger, fire |
| `frozen` | frozen, ice, cold, snow |
| `swamp` | swamp, wet, decay, water, muck |
| `ruins` | ruins, ancient, stone, decay |
| `forest` | forest, outdoor, natural, trees |
| `desert` | desert, outdoor, dry, sand |

### 6.2 Descriptor Pool Overrides

The `descriptorPoolOverrides` object maps default descriptor categories to biome-specific pools.

**Configuration:**
```json
{
    "descriptorPoolOverrides": {
        "environmental.lighting": "environmental.lighting.volcanic",
        "environmental.temperature": "environmental.temperature.volcanic",
        "environmental.smells": "environmental.smells.volcanic"
    }
}
```

**Effect:**
- When generating descriptions, the system uses override pools instead of defaults
- Categories not in the map use their default pools
- Pool IDs reference entries in descriptor configuration files

**Common Override Categories:**
| Category | Description |
|----------|-------------|
| `environmental.lighting` | Light source descriptions |
| `environmental.temperature` | Temperature descriptions |
| `environmental.smells` | Olfactory descriptions |
| `environmental.sounds` | Auditory descriptions |
| `environmental.textures` | Tactile descriptions |

### 6.3 Emphasized Terms

The `emphasizedTerms` array contains words that should be prioritized in descriptor selection.

**Configuration:**
```json
{
    "emphasizedTerms": ["lava", "sulfur", "heat", "glow", "magma"]
}
```

**Effect:**
- Descriptors containing these terms have increased selection probability
- Creates thematic consistency within the biome
- Multiple terms can be emphasized simultaneously

### 6.4 Excluded Terms

The `excludedTerms` array contains words that should be filtered out of descriptors.

**Configuration:**
```json
{
    "excludedTerms": ["cold", "ice", "frost", "chill", "freezing"]
}
```

**Effect:**
- Descriptors containing these terms are removed from the pool
- Prevents thematically inappropriate descriptions
- Ensures immersion is maintained

---

## 7. Monster Spawn Table Configuration

### 7.1 SpawnTable Definition

The `SpawnTable` object defines monster spawning rules for the biome.

```json
"SpawnTable": {
    "type": "object",
    "description": "Monster spawn configuration for a biome",
    "properties": {
        "entries": {
            "type": "array",
            "description": "List of spawn entries with weights",
            "items": {
                "$ref": "#/definitions/SpawnEntry"
            },
            "minItems": 1
        },
        "levelModifier": {
            "type": "integer",
            "description": "Level modifier added to all spawned monsters",
            "default": 0
        }
    },
    "required": ["entries"],
    "additionalProperties": false
}
```

### 7.2 SpawnEntry Definition

The `SpawnEntry` object defines a single monster spawn entry.

```json
"SpawnEntry": {
    "type": "object",
    "description": "A single monster spawn entry with weight and depth restrictions",
    "properties": {
        "monsterId": {
            "type": "string",
            "description": "Reference to monster ID in monsters.json",
            "pattern": "^[a-z][a-z0-9_]*$"
        },
        "weight": {
            "type": "integer",
            "description": "Spawn weight (higher = more common)",
            "minimum": 1,
            "default": 100
        },
        "minDepth": {
            "type": "integer",
            "description": "Minimum floor depth for this monster to spawn",
            "minimum": 1
        },
        "maxDepth": {
            "type": "integer",
            "description": "Maximum floor depth for this monster to spawn",
            "minimum": 1
        }
    },
    "required": ["monsterId"],
    "additionalProperties": false
}
```

### 7.3 Depth-Based Spawning

Depth restrictions allow for progressive difficulty within biomes.

**Rules:**
- `minDepth` only: Monster spawns on floor N and deeper
- `maxDepth` only: Monster spawns up to floor N
- Both: Monster spawns between minDepth and maxDepth (inclusive)
- Neither: Monster spawns on all floors

**Example Configuration:**
```json
{
    "monsterSpawnTable": {
        "levelModifier": 2,
        "entries": [
            { "monsterId": "goblin", "weight": 100 },
            { "monsterId": "orc", "weight": 50, "minDepth": 3 },
            { "monsterId": "troll", "weight": 20, "minDepth": 5, "maxDepth": 8 },
            { "monsterId": "dragon", "weight": 5, "minDepth": 10 }
        ]
    }
}
```

---

## 8. Terrain Distribution Configuration

### 8.1 TerrainDistribution Definition

The `TerrainDistribution` object defines terrain type percentages for room generation.

```json
"TerrainDistribution": {
    "type": "object",
    "description": "Terrain type distribution for a biome",
    "properties": {
        "entries": {
            "type": "array",
            "description": "List of terrain entries with percentages",
            "items": {
                "$ref": "#/definitions/TerrainEntry"
            },
            "minItems": 1
        }
    },
    "required": ["entries"],
    "additionalProperties": false
}
```

```json
"TerrainEntry": {
    "type": "object",
    "description": "A single terrain entry with percentage",
    "properties": {
        "terrainId": {
            "type": "string",
            "description": "Reference to terrain ID in terrain.json",
            "pattern": "^[a-z][a-z0-9_-]*$"
        },
        "percentage": {
            "type": "number",
            "description": "Percentage of tiles using this terrain (0-100)",
            "minimum": 0,
            "maximum": 100
        }
    },
    "required": ["terrainId", "percentage"],
    "additionalProperties": false
}
```

### 8.2 Percentage Validation

**Rules:**
- Each percentage must be between 0 and 100
- Percentages do not need to sum to 100 (remainder uses default floor)
- Zero percentage means the terrain type is available but rare

**Example Configuration:**
```json
{
    "terrainDistribution": {
        "entries": [
            { "terrainId": "stone_floor", "percentage": 60 },
            { "terrainId": "rubble", "percentage": 20 },
            { "terrainId": "water_shallow", "percentage": 10 },
            { "terrainId": "pit", "percentage": 5 }
        ]
    }
}
```

**Note:** The remaining 5% would use the default terrain type for unspecified areas.

---

## 9. Hazard Frequency Configuration

### 9.1 HazardFrequency Definition

The `HazardFrequency` object defines hazard spawning rules.

```json
"HazardFrequency": {
    "type": "object",
    "description": "Hazard spawn frequency configuration",
    "properties": {
        "baseChance": {
            "type": "number",
            "description": "Base probability of hazard spawning (0.0 to 1.0)",
            "minimum": 0,
            "maximum": 1,
            "default": 0.1
        },
        "hazardTypes": {
            "type": "array",
            "description": "List of hazard terrain IDs that can spawn",
            "items": {
                "type": "string",
                "pattern": "^[a-z][a-z0-9_-]*$"
            }
        },
        "depthScaling": {
            "type": "number",
            "description": "Additional chance per floor depth",
            "minimum": 0,
            "default": 0
        }
    },
    "additionalProperties": false
}
```

### 9.2 Depth Scaling

Depth scaling increases hazard frequency on deeper floors.

**Calculation:**
```
Effective Chance = min(1.0, baseChance + (depth Ã— depthScaling))
```

**Example Configuration:**
```json
{
    "hazardFrequency": {
        "baseChance": 0.15,
        "hazardTypes": ["lava_pool", "fire_geyser", "unstable_ground"],
        "depthScaling": 0.02
    }
}
```

**Result at Various Depths:**
| Depth | Calculation | Effective Chance |
|-------|-------------|------------------|
| 1 | 0.15 + (1 Ã— 0.02) | 17% |
| 5 | 0.15 + (5 Ã— 0.02) | 25% |
| 10 | 0.15 + (10 Ã— 0.02) | 35% |
| 20 | 0.15 + (20 Ã— 0.02) | 55% |

---

## 10. Audio Configuration

### 10.1 Music Theme Association

The optional `musicThemeId` field references a music theme from `music-themes.json`.

**Configuration:**
```json
{
    "musicThemeId": "volcanic_cavern"
}
```

**Effect:**
- When entering a room in this biome, the specified music theme plays
- If not specified, uses default exploration music
- Music transitions smoothly between biomes

### 10.2 Ambient Sound Association

The optional `ambientSoundId` field references an ambient sound from `sound-effects.json`.

**Configuration:**
```json
{
    "ambientSoundId": "lava_bubbling"
}
```

**Effect:**
- Ambient sounds loop while in rooms of this biome
- Layer with room-specific sounds
- Creates atmospheric immersion

---

## 11. Validation Rules

### 11.1 ID Pattern Validation

| Property | Pattern | Allows Hyphen |
|----------|---------|---------------|
| `BiomeDefinition.id` | `^[a-z][a-z0-9-]*$` | Yes |
| `monsterId` | `^[a-z][a-z0-9_]*$` | No (underscore) |
| `terrainId` | `^[a-z][a-z0-9_-]*$` | Yes |
| `musicThemeId` | `^[a-z][a-z0-9-]*$` | Yes |
| `ambientSoundId` | `^[a-z][a-z0-9-]*$` | Yes |

### 11.2 Range Validation

| Property | Range | Validation Error |
|----------|-------|------------------|
| `weight` | >= 1 | "weight must be >= 1" |
| `minDepth` | >= 1 | "minDepth must be >= 1" |
| `maxDepth` | >= 1 | "maxDepth must be >= 1" |
| `percentage` | 0-100 | "percentage must be between 0 and 100" |
| `baseChance` | 0-1 | "baseChance must be between 0 and 1" |
| `depthScaling` | >= 0 | "depthScaling must be >= 0" |
| `sortOrder` | >= 0 | "sortOrder must be >= 0" |

### 11.3 Required Fields

| Definition | Required Fields |
|------------|-----------------|
| `BiomeDefinition` | id, name, description, defaultCategoryValues, impliedTags, descriptorPoolOverrides, emphasizedTerms, excludedTerms |
| `DefaultCategories` | climate, lighting |
| `SpawnTable` | entries |
| `SpawnEntry` | monsterId |
| `TerrainDistribution` | entries |
| `TerrainEntry` | terrainId, percentage |

### 11.4 Enum Validation

| Enum | Values |
|------|--------|
| `climate` | freezing, cold, temperate, warm, hot, scorching |
| `lighting` | dark, dim, normal, bright |
| `era` | ancient, medieval, modern, futuristic |
| `condition` | pristine, weathered, ruined, collapsed, flooded, overgrown |

---

## 12. Configuration Schema

### Complete Biomes Schema File

**File:** `config/schemas/biomes.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Biome Configuration",
    "description": "Schema for biome definitions including environmental categories, descriptor overrides, monster spawn tables, terrain distributions, and hazard frequencies.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "description": "Reference to the JSON schema file for validation"
        },
        "version": {
            "type": "string",
            "description": "Optional version identifier for the configuration file",
            "pattern": "^[0-9]+\\.[0-9]+$"
        },
        "biomes": {
            "type": "object",
            "description": "Map of biome IDs to biome definitions",
            "additionalProperties": {
                "$ref": "#/definitions/BiomeDefinition"
            },
            "minProperties": 1
        }
    },
    "required": ["biomes"],
    "additionalProperties": false,
    "definitions": {
        "BiomeDefinition": {
            "type": "object",
            "description": "A biome definition with environmental categories, descriptors, and spawn configurations",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "Unique identifier for the biome (lowercase kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 1,
                    "maxLength": 50
                },
                "name": {
                    "type": "string",
                    "description": "Display name shown to players",
                    "minLength": 1,
                    "maxLength": 100
                },
                "description": {
                    "type": "string",
                    "description": "Flavor text describing the biome"
                },
                "defaultCategoryValues": {
                    "$ref": "#/definitions/DefaultCategories",
                    "description": "Default environmental category values for this biome"
                },
                "impliedTags": {
                    "type": "array",
                    "description": "Tags automatically applied to rooms in this biome for descriptor filtering",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "descriptorPoolOverrides": {
                    "type": "object",
                    "description": "Map of descriptor category to override pool ID",
                    "additionalProperties": {
                        "type": "string"
                    }
                },
                "emphasizedTerms": {
                    "type": "array",
                    "description": "Terms that should be emphasized in descriptor selection",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "excludedTerms": {
                    "type": "array",
                    "description": "Terms that should be excluded from descriptors",
                    "items": {
                        "type": "string",
                        "minLength": 1
                    }
                },
                "monsterSpawnTable": {
                    "$ref": "#/definitions/SpawnTable",
                    "description": "Monster spawn configuration for this biome"
                },
                "terrainDistribution": {
                    "$ref": "#/definitions/TerrainDistribution",
                    "description": "Terrain type distribution percentages"
                },
                "hazardFrequency": {
                    "$ref": "#/definitions/HazardFrequency",
                    "description": "Hazard spawn frequency configuration"
                },
                "musicThemeId": {
                    "type": "string",
                    "description": "Reference to music theme in music-themes.json",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "ambientSoundId": {
                    "type": "string",
                    "description": "Reference to ambient sound in sound-effects.json",
                    "pattern": "^[a-z][a-z0-9-]*$"
                },
                "sortOrder": {
                    "type": "integer",
                    "description": "Order for display sorting (lower values first)",
                    "minimum": 0
                }
            },
            "required": ["id", "name", "description", "defaultCategoryValues", "impliedTags", "descriptorPoolOverrides", "emphasizedTerms", "excludedTerms"],
            "additionalProperties": false
        },
        "DefaultCategories": {
            "type": "object",
            "description": "Default environmental category values for a biome",
            "properties": {
                "climate": {
                    "type": "string",
                    "description": "Temperature characteristic",
                    "enum": ["freezing", "cold", "temperate", "warm", "hot", "scorching"]
                },
                "lighting": {
                    "type": "string",
                    "description": "Ambient light level",
                    "enum": ["dark", "dim", "normal", "bright"]
                },
                "era": {
                    "type": "string",
                    "description": "Architectural/temporal style (optional)",
                    "enum": ["ancient", "medieval", "modern", "futuristic"]
                },
                "condition": {
                    "type": "string",
                    "description": "Physical state of structures (optional)",
                    "enum": ["pristine", "weathered", "ruined", "collapsed", "flooded", "overgrown"]
                }
            },
            "required": ["climate", "lighting"],
            "additionalProperties": false
        },
        "SpawnTable": {
            "type": "object",
            "description": "Monster spawn configuration for a biome",
            "properties": {
                "entries": {
                    "type": "array",
                    "description": "List of spawn entries with weights",
                    "items": {
                        "$ref": "#/definitions/SpawnEntry"
                    },
                    "minItems": 1
                },
                "levelModifier": {
                    "type": "integer",
                    "description": "Level modifier added to all spawned monsters",
                    "default": 0
                }
            },
            "required": ["entries"],
            "additionalProperties": false
        },
        "SpawnEntry": {
            "type": "object",
            "description": "A single monster spawn entry with weight and depth restrictions",
            "properties": {
                "monsterId": {
                    "type": "string",
                    "description": "Reference to monster ID in monsters.json",
                    "pattern": "^[a-z][a-z0-9_]*$"
                },
                "weight": {
                    "type": "integer",
                    "description": "Spawn weight (higher = more common)",
                    "minimum": 1,
                    "default": 100
                },
                "minDepth": {
                    "type": "integer",
                    "description": "Minimum floor depth for this monster to spawn",
                    "minimum": 1
                },
                "maxDepth": {
                    "type": "integer",
                    "description": "Maximum floor depth for this monster to spawn",
                    "minimum": 1
                }
            },
            "required": ["monsterId"],
            "additionalProperties": false
        },
        "TerrainDistribution": {
            "type": "object",
            "description": "Terrain type distribution for a biome",
            "properties": {
                "entries": {
                    "type": "array",
                    "description": "List of terrain entries with percentages",
                    "items": {
                        "$ref": "#/definitions/TerrainEntry"
                    },
                    "minItems": 1
                }
            },
            "required": ["entries"],
            "additionalProperties": false
        },
        "TerrainEntry": {
            "type": "object",
            "description": "A single terrain entry with percentage",
            "properties": {
                "terrainId": {
                    "type": "string",
                    "description": "Reference to terrain ID in terrain.json",
                    "pattern": "^[a-z][a-z0-9_-]*$"
                },
                "percentage": {
                    "type": "number",
                    "description": "Percentage of tiles using this terrain (0-100)",
                    "minimum": 0,
                    "maximum": 100
                }
            },
            "required": ["terrainId", "percentage"],
            "additionalProperties": false
        },
        "HazardFrequency": {
            "type": "object",
            "description": "Hazard spawn frequency configuration",
            "properties": {
                "baseChance": {
                    "type": "number",
                    "description": "Base probability of hazard spawning (0.0 to 1.0)",
                    "minimum": 0,
                    "maximum": 1,
                    "default": 0.1
                },
                "hazardTypes": {
                    "type": "array",
                    "description": "List of hazard terrain IDs that can spawn",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9_-]*$"
                    }
                },
                "depthScaling": {
                    "type": "number",
                    "description": "Additional chance per floor depth",
                    "minimum": 0,
                    "default": 0
                }
            },
            "additionalProperties": false
        }
    }
}
```

---

## 13. Configuration File Updates

### Updated biomes.json

Update the existing `biomes.json` to include the schema reference.

**File:** `config/biomes.json`

```json
{
    "$schema": "./schemas/biomes.schema.json",
    "version": "1.0",
    "biomes": {
        "cave": {
            "id": "cave",
            "name": "Cave",
            "description": "Natural underground cavern system",
            "defaultCategoryValues": {
                "climate": "cold",
                "lighting": "dim",
                "era": "ancient"
            },
            "impliedTags": ["underground", "natural", "stone", "cave"],
            "descriptorPoolOverrides": {
                "environmental.lighting": "environmental.lighting.cave",
                "environmental.sounds": "environmental.sounds.cave"
            },
            "emphasizedTerms": ["dripping", "echo", "stone", "stalactite"],
            "excludedTerms": ["sunlight", "breeze", "grass"]
        },
        "dungeon": {
            "id": "dungeon",
            "name": "Dungeon",
            "description": "Constructed underground passages and chambers",
            "defaultCategoryValues": {
                "climate": "cold",
                "lighting": "dim",
                "era": "medieval"
            },
            "impliedTags": ["underground", "constructed", "stone", "dungeon"],
            "descriptorPoolOverrides": {
                "environmental.lighting": "environmental.lighting.dungeon"
            },
            "emphasizedTerms": ["torch", "chains", "iron", "stone"],
            "excludedTerms": ["sunlight", "trees", "grass"]
        },
        "volcanic": {
            "id": "volcanic",
            "name": "Volcanic",
            "description": "Areas of active or dormant volcanic activity",
            "defaultCategoryValues": {
                "climate": "scorching",
                "lighting": "dim"
            },
            "impliedTags": ["volcanic", "heat", "danger", "fire"],
            "descriptorPoolOverrides": {
                "environmental.lighting": "environmental.lighting.volcanic",
                "environmental.temperature": "environmental.temperature.volcanic",
                "environmental.smells": "environmental.smells.volcanic"
            },
            "emphasizedTerms": ["lava", "sulfur", "heat", "glow", "magma"],
            "excludedTerms": ["cold", "ice", "frost", "chill", "freezing"]
        },
        "frozen": {
            "id": "frozen",
            "name": "Frozen",
            "description": "Ice-covered or extremely cold regions",
            "defaultCategoryValues": {
                "climate": "freezing",
                "lighting": "bright"
            },
            "impliedTags": ["frozen", "ice", "cold", "snow"],
            "descriptorPoolOverrides": {
                "environmental.temperature": "environmental.temperature.frozen",
                "environmental.sounds": "environmental.sounds.frozen"
            },
            "emphasizedTerms": ["ice", "frost", "frozen", "cold", "chill"],
            "excludedTerms": ["warm", "heat", "fire", "lava", "sweat"]
        },
        "swamp": {
            "id": "swamp",
            "name": "Swamp",
            "description": "Waterlogged wetlands with decaying vegetation",
            "defaultCategoryValues": {
                "climate": "warm",
                "lighting": "dim",
                "condition": "flooded"
            },
            "impliedTags": ["swamp", "wet", "decay", "water", "muck"],
            "descriptorPoolOverrides": {
                "environmental.smells": "environmental.smells.swamp",
                "environmental.sounds": "environmental.sounds.swamp"
            },
            "emphasizedTerms": ["murky", "rotting", "mud", "stagnant", "squelch"],
            "excludedTerms": ["dry", "arid", "dusty", "clean"]
        },
        "ruins": {
            "id": "ruins",
            "name": "Ruins",
            "description": "Crumbling remains of ancient structures",
            "defaultCategoryValues": {
                "climate": "temperate",
                "lighting": "normal",
                "era": "ancient",
                "condition": "collapsed"
            },
            "impliedTags": ["ruins", "ancient", "stone", "decay"],
            "descriptorPoolOverrides": {},
            "emphasizedTerms": ["crumbling", "ancient", "worn", "faded", "forgotten"],
            "excludedTerms": ["new", "pristine", "polished"]
        },
        "forest": {
            "id": "forest",
            "name": "Forest",
            "description": "Dense woodland area",
            "defaultCategoryValues": {
                "climate": "temperate",
                "lighting": "dim",
                "condition": "overgrown"
            },
            "impliedTags": ["forest", "outdoor", "natural", "trees"],
            "descriptorPoolOverrides": {
                "environmental.sounds": "environmental.sounds.forest",
                "environmental.smells": "environmental.smells.forest"
            },
            "emphasizedTerms": ["leaves", "bark", "branches", "canopy", "undergrowth"],
            "excludedTerms": ["stone", "dungeon", "torch"]
        },
        "desert": {
            "id": "desert",
            "name": "Desert",
            "description": "Arid wasteland or sandy expanse",
            "defaultCategoryValues": {
                "climate": "hot",
                "lighting": "bright"
            },
            "impliedTags": ["desert", "outdoor", "dry", "sand"],
            "descriptorPoolOverrides": {
                "environmental.temperature": "environmental.temperature.desert"
            },
            "emphasizedTerms": ["sand", "sun", "dry", "parched", "dune"],
            "excludedTerms": ["wet", "damp", "moist", "water"]
        }
    }
}
```

---

## 14. Data Model Changes

### No Domain Changes Required

This phase creates only a JSON Schema file and updates the configuration file reference. No changes to domain entities, services, or application layer are required.

| Layer | Changes |
|-------|---------|
| Domain | None |
| Application | None |
| Infrastructure | None |
| Configuration | One schema file added, one config file updated with $schema reference |

### Schema as Documentation

The schema serves as:
- **Validation contract** for biome configuration
- **IDE documentation** via description fields
- **Modding reference** for custom biome creation
- **Design specification** for biome mechanics

---

## 15. Logging Specifications

### No Runtime Logging Required

Schema validation occurs at design-time in IDE/editors, not at runtime. No logging infrastructure changes are needed for this phase.

| Component | Level | Events |
|-----------|-------|--------|
| N/A | N/A | Schema validation is IDE-based |

---

## 16. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Schema Valid Structure | ~1 |
| Climate Enum Validation | ~1 |
| Spawn Table Validation | ~1 |
| Terrain Distribution Validation | ~1 |
| Configuration File Validation | ~1 |
| **Total** | **~5** |

### Test Descriptions

#### BiomesSchemaTests.cs

```csharp
[TestFixture]
public class BiomesSchemaTests
{
    /// <summary>
    /// Verifies the schema file is valid JSON Schema Draft-07.
    /// </summary>
    [Test]
    public void Schema_IsValidJsonSchemaDraft07();

    /// <summary>
    /// Verifies the biomes.json validates against the schema without errors.
    /// </summary>
    [Test]
    public void BiomesJson_ValidatesAgainstSchema();

    /// <summary>
    /// Verifies climate must be one of the valid enum values.
    /// </summary>
    [Test]
    public void Climate_InvalidEnum_FailsValidation();

    /// <summary>
    /// Verifies terrain percentage must be between 0 and 100.
    /// </summary>
    [Test]
    public void TerrainPercentage_OutOfRange_FailsValidation();

    /// <summary>
    /// Verifies hazard baseChance must be between 0 and 1.
    /// </summary>
    [Test]
    public void HazardBaseChance_OutOfRange_FailsValidation();
}
```

### Test Implementation Notes

Tests should use a JSON Schema validation library (e.g., `NJsonSchema` for C#) to:
1. Load the schema file
2. Validate test JSON documents
3. Assert expected validation results

---

## 17. Use Cases

### UC-001: Load Biome Configuration

**Actor:** Game System
**Flow:** System starts -> Loads `biomes.json` -> Schema validates content -> Biomes available for level generation

### UC-002: Edit Biomes in IDE

**Actor:** Developer/Modder
**Flow:** Opens `biomes.json` in VS Code -> IDE loads schema -> Autocomplete suggests properties -> Validation errors shown inline

### UC-003: Add New Biome

**Actor:** Modder
**Flow:** Adds new biome key to `biomes` object -> Sets id, name, description -> Configures defaultCategoryValues with climate and lighting -> Defines impliedTags, emphasized/excluded terms -> IDE validates structure

### UC-004: Configure Monster Spawn Table

**Actor:** Modder
**Flow:** Adds monsterSpawnTable to biome -> Defines entries with monsterId and weight -> Optionally sets minDepth/maxDepth -> Sets levelModifier -> IDE validates spawn weights >= 1

### UC-005: Configure Terrain Distribution

**Actor:** Modder
**Flow:** Adds terrainDistribution to biome -> Defines entries with terrainId and percentage -> IDE validates percentages 0-100 -> Generation uses distribution for room tiles

### UC-006: Invalid Climate Value

**Actor:** Modder
**Flow:** Sets climate to "boiling" (invalid) -> IDE shows error "climate must be one of: freezing, cold, temperate, warm, hot, scorching" -> Modder corrects to valid value

---

## 18. Deliverable Checklist

### Schema Files
- [ ] `config/schemas/biomes.schema.json` created
- [ ] Schema follows JSON Schema Draft-07 format
- [ ] Schema includes all 7 definitions (BiomeDefinition, DefaultCategories, SpawnTable, SpawnEntry, TerrainDistribution, TerrainEntry, HazardFrequency)

### Validation Rules
- [ ] Biome ID pattern validation: `^[a-z][a-z0-9-]*$`
- [ ] Climate enum validation (6 values)
- [ ] Lighting enum validation (4 values)
- [ ] Era enum validation (4 values, optional)
- [ ] Condition enum validation (6 values, optional)
- [ ] Spawn weight validation (>= 1)
- [ ] Terrain percentage validation (0-100)
- [ ] Hazard base chance validation (0-1)
- [ ] Required fields enforced for all definitions

### Configuration Files
- [ ] `biomes.json` updated with $schema reference
- [ ] All 8 existing biomes validate against schema

### Testing
- [ ] ~5 unit tests implemented
- [ ] All tests passing
- [ ] Tests cover happy path and error cases

### Documentation
- [ ] Schema properties have descriptions
- [ ] This design specification complete

---

## 19. Acceptance Criteria

### Functional
- [ ] `biomes.schema.json` created in `config/schemas/` directory
- [ ] Schema validates existing `biomes.json` without errors
- [ ] Default category values validated with climate and lighting enums
- [ ] Era and condition enums validated as optional
- [ ] Implied tags validated as string array
- [ ] Descriptor pool overrides validated as string-to-string map
- [ ] Emphasized/excluded terms validated as string arrays
- [ ] Monster spawn table validated with weights >= 1
- [ ] Terrain distribution percentages validated (0-100)
- [ ] Hazard frequency validated (baseChance 0-1)
- [ ] VS Code provides autocomplete when schema linked

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] ~5 unit tests pass
- [ ] Schema file is valid JSON
- [ ] All schema properties have descriptions

---

## 20. Dependencies

### Required from Prior Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| Monster Schema | `config/schemas/monsters.schema.json` | monsterId references in spawn tables |
| Monster Config | `config/monsters.json` | Provides monster IDs |
| Terrain Schema | `config/schemas/terrain.schema.json` | terrainId references in distributions |
| Terrain Config | `config/terrain.json` | Provides terrain IDs |

### Provides to Future Versions

| Type | Usage |
|------|-------|
| `biomes.schema.json` | Validates biome configuration |
| Biome IDs | Referenced by room-types.json and level generation |
| Category enums | Reusable in room type lighting overrides |

### Implementation Order Note

**v0.14.4a can be implemented in parallel with v0.14.4b, v0.14.4c, and v0.14.4d** as they have no internal dependencies within v0.14.4.

---

## 21. Future Considerations

### Deferred to Future Versions

- **Cross-reference validation**: Validating monsterId exists in monsters.json
- **Cross-reference validation**: Validating terrainId exists in terrain.json
- **Biome generation logic**: Runtime room generation using biome config
- **Climate effects**: Damage/stamina effects from temperature
- **Lighting effects**: Visibility calculations based on lighting

### Out of Scope

- **Room type schema** (v0.14.4b) - Room type definitions that may reference biomes
- **Terrain schema expansion** (v0.14.4c) - Terrain types referenced by distributions
- **Interactive object schema** (v0.14.4d) - Objects that may spawn in biomes
- **Runtime biome application**: Application-level generation (domain logic)
- **Biome balance tuning**: Specific spawn weights (design decisions)

### Potential Future Enhancements

If the biome system expands, consider adding to the schema:

**Weather System:**
```json
"weatherPatterns": {
    "type": "array",
    "description": "Possible weather conditions in this biome",
    "items": {
        "type": "object",
        "properties": {
            "weatherId": { "type": "string" },
            "probability": { "type": "number", "minimum": 0, "maximum": 1 },
            "duration": { "type": "object" }
        }
    }
}
```

**Time of Day Effects:**
```json
"timeEffects": {
    "type": "object",
    "description": "How time of day affects the biome",
    "properties": {
        "dawn": { "$ref": "#/definitions/TimeEffect" },
        "day": { "$ref": "#/definitions/TimeEffect" },
        "dusk": { "$ref": "#/definitions/TimeEffect" },
        "night": { "$ref": "#/definitions/TimeEffect" }
    }
}
```

**Biome Transitions:**
```json
"adjacentBiomes": {
    "type": "array",
    "description": "Biomes that can border this one",
    "items": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$"
    }
}
```

**Resource Nodes:**
```json
"resourceNodes": {
    "type": "array",
    "description": "Gatherable resources in this biome",
    "items": {
        "type": "object",
        "properties": {
            "resourceId": { "type": "string" },
            "spawnChance": { "type": "number" }
        }
    }
}
```

**NPC Factions:**
```json
"dominantFaction": {
    "type": "string",
    "description": "Faction that controls this biome region",
    "pattern": "^[a-z][a-z0-9-]*$"
}
```

**Event Triggers:**
```json
"randomEvents": {
    "type": "array",
    "description": "Special events that can occur in this biome",
    "items": {
        "type": "object",
        "properties": {
            "eventId": { "type": "string" },
            "triggerChance": { "type": "number" },
            "requirements": { "type": "object" }
        }
    }
}
```

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
