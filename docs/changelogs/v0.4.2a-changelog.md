# v0.4.2a Changelog — Puzzle Core

**Date:** 2026-01-13  
**Version:** 0.4.2a  
**Phase Name:** Puzzle Core  
**Test Results:** All 1,529 tests pass (+41 new)

---

## Summary

Established the foundational puzzle infrastructure with state management, type classification, attempt tracking, and Room integration. This creates the core framework that specific puzzle type validators (v0.4.2b) and riddle mechanics (v0.4.2c) will extend.

---

## New Features

### Puzzle State Machine
- 5-state lifecycle: `Unsolved` → `InProgress` → `Solved` / `Failed` → `Locked`
- Automatic state transitions via `BeginAttempt()`, `Solve()`, `RecordFailedAttempt()`
- Configurable reset mechanics with turn-based countdown

### Puzzle Types
- 5 categories: `Sequence`, `Combination`, `Pattern`, `Riddle`, `Logic`
- Type-specific validation deferred to v0.4.2b

### Attempt Tracking
- `PuzzleAttempt` value object tracks active progress
- Supports step-based sequences and input-based combinations
- In-memory attempt storage via `PuzzleService`

### Room Integration
- `Room.Puzzles` collection with 6 management methods
- Keyword-based puzzle lookup
- Type filtering and unsolved queries
- Automatic reset tick processing

---

## Files Added

| Layer | File | Lines |
|-------|------|-------|
| Domain | `Enums/PuzzleState.cs` | 65 |
| Domain | `Enums/PuzzleType.cs` | 70 |
| Domain | `ValueObjects/PuzzleAttempt.cs` | 170 |
| Domain | `Entities/Puzzle.cs` | 380 |
| Domain | `Definitions/PuzzleDefinition.cs` | 75 |
| Application | `Interfaces/IPuzzleService.cs` | 290 |
| Application | `Services/PuzzleService.cs` | 360 |
| Config | `config/puzzles.json` | 105 |

---

## Files Modified

| File | Changes |
|------|---------|
| `Room.cs` | +80 lines (field, 3 properties, 6 methods) |

---

## Test Files Added

| File | Tests |
|------|-------|
| `Enums/PuzzleStateTests.cs` | 2 |
| `Enums/PuzzleTypeTests.cs` | 2 |
| `ValueObjects/PuzzleAttemptTests.cs` | 10 |
| `Entities/PuzzleTests.cs` | 20 |
| `Entities/RoomPuzzleTests.cs` | 9 |
| **Total** | **41** |

---

## Configuration

`config/puzzles.json` includes 8 sample definitions:
- Stone Altar Sequence (Sequence, difficulty 3)
- Ancient Combination Lock (Combination, difficulty 2)
- Pressure Plate Pattern (Pattern, difficulty 4)
- Sphinx's Riddle (Riddle, difficulty 3)
- Crystal Alignment (Logic, difficulty 5)
- Vault Lock Chain (3 puzzles with prerequisites)

---

## Future Work

- **v0.4.2b:** Type-specific validators (Sequence, Combination, Pattern)
- **v0.4.2c:** Riddle mechanics, hint system, reward integration
