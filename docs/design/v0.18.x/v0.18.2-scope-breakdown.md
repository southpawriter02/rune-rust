# v0.18.2 Scope Breakdown: Cognitive Paradox Syndrome (CPS)

## Overview

v0.18.2 implements **Cognitive Paradox Syndrome (CPS)** — the progressive mental deterioration that occurs when the human mind processes reality-breaking paradoxes. CPS builds on the Psychic Stress system, adding staged symptoms and the Panic Table for severe psychological breaks.

> *"The mind is a machine designed to process logic. The Glitch is pure anti-logic. CPS is the friction of a logical engine grinding against an impossible reality."*

---

## Feature Tree

```
v0.18.2 — Cognitive Paradox Syndrome
├── Domain Layer
│   ├── CpsStage (enum)
│   ├── CpsState (value object)
│   ├── PanicEffect (enum)
│   └── PanicResult (record)
│
├── Application Layer
│   ├── ICpsService (interface)
│   └── CpsService (implementation)
│
├── Infrastructure Layer
│   └── Panic table configuration
│
├── Configuration
│   ├── cps_stages.json
│   └── panic_table.json
│
└── Tests (~12 unit tests)
```

---

## In Scope

### Domain Layer

#### CpsStage Enum

```csharp
/// <summary>
/// Defines the four stages of Cognitive Paradox Syndrome progression.
/// Stages correspond to Psychic Stress thresholds and represent
/// increasing cognitive breakdown from paradox exposure.
/// </summary>
public enum CpsStage
{
    /// <summary>
    /// Stage 0: No CPS symptoms. Stress below 20%.
    /// Normal cognitive function.
    /// </summary>
    None = 0,

    /// <summary>
    /// Stage 1: Weight of Knowing. Stress 20-49%.
    /// Symptoms: Migraines, tinnitus, mild auditory paresthesia.
    /// Reversible with cognitive hygiene (rest, silence, darkness).
    /// </summary>
    WeightOfKnowing = 1,

    /// <summary>
    /// Stage 2: Glimmer-Madness. Stress 50-79%.
    /// Symptoms: Visual hallucinations, semantic drift, vertigo.
    /// Critical - requires immediate extraction and Silent Room protocol.
    /// </summary>
    GlimmerMadness = 2,

    /// <summary>
    /// Stage 3: Ruin-Madness. Stress 80-99%.
    /// Symptoms: Logic collapse, violent paranoia, logic-locks.
    /// Terminal - Panic Table rolls required. Person effectively gone.
    /// </summary>
    RuinMadness = 3,

    /// <summary>
    /// Stage 4: The Hollow Shell. Stress 100%.
    /// The mind is erased. Catatonia or hollow behavior.
    /// Character is a biological automaton - unplayable.
    /// </summary>
    HollowShell = 4
}
```

#### PanicEffect Enum

```csharp
/// <summary>
/// Panic Table effects for Stage 3 (Ruin-Madness) breaks.
/// Rolled on d10 when character enters Stage 3 or fails a Logic Save.
/// </summary>
public enum PanicEffect
{
    /// <summary>
    /// d10 1-2: Logic Lock. Character stares at anomaly.
    /// Effect: Stunned 1 turn, Defense -5.
    /// </summary>
    Freeze = 1,

    /// <summary>
    /// d10 3-4: Evacuation Protocol. Flee stress source.
    /// Effect: Must use Move action away from source.
    /// </summary>
    Flight = 2,

    /// <summary>
    /// d10 5-6: Paradox Fury. Attack nearest entity.
    /// Effect: Must Attack nearest target (friend or foe).
    /// </summary>
    Fight = 3,

    /// <summary>
    /// d10 7: Word Salad. Shout nonsense.
    /// Effect: Stealth impossible for party.
    /// </summary>
    Babble = 4,

    /// <summary>
    /// d10 8: Purge. Self-harm to relieve pressure.
    /// Effect: Take 1d6 damage (ignores Soak).
    /// </summary>
    SelfHarm = 5,

    /// <summary>
    /// d10 9: Phantom Data. Hallucinate cover/walls.
    /// Effect: Disadvantage on next action.
    /// </summary>
    Hallucination = 6,

    /// <summary>
    /// d10 10: System Crash. Catatonic collapse.
    /// Effect: Prone + Stunned 1d4 turns.
    /// </summary>
    Catatonia = 7
}
```

#### CpsState Value Object

```csharp
/// <summary>
/// Represents the current CPS state derived from Psychic Stress.
/// Immutable value object that maps stress to CPS symptoms.
/// </summary>
public sealed record CpsState
{
    /// <summary>Current Psychic Stress value (0-100).</summary>
    public int CurrentStress { get; init; }

    /// <summary>Gets the current CPS stage based on stress.</summary>
    public CpsStage Stage => CurrentStress switch
    {
        < 20 => CpsStage.None,
        < 50 => CpsStage.WeightOfKnowing,
        < 80 => CpsStage.GlimmerMadness,
        < 100 => CpsStage.RuinMadness,
        _ => CpsStage.HollowShell
    };

    /// <summary>Gets the stage name for display.</summary>
    public string StageName => Stage switch
    {
        CpsStage.None => "Clear",
        CpsStage.WeightOfKnowing => "Weight of Knowing",
        CpsStage.GlimmerMadness => "Glimmer-Madness",
        CpsStage.RuinMadness => "Ruin-Madness",
        CpsStage.HollowShell => "The Hollow Shell",
        _ => "Unknown"
    };

    /// <summary>Whether character has visual UI distortion effects.</summary>
    public bool HasVisualDistortion => Stage >= CpsStage.GlimmerMadness;

    /// <summary>Whether Logic checks have disadvantage.</summary>
    public bool HasLogicDisadvantage => Stage >= CpsStage.GlimmerMadness;

    /// <summary>Whether Panic Table rolls are required.</summary>
    public bool RequiresPanicRoll => Stage == CpsStage.RuinMadness;

    /// <summary>Whether character is effectively lost.</summary>
    public bool IsHollow => Stage == CpsStage.HollowShell;

    /// <summary>Gets the UI distortion level (0-4).</summary>
    public int UiDistortionLevel => (int)Stage;

    /// <summary>Gets symptom descriptions for current stage.</summary>
    public IReadOnlyList<string> Symptoms => Stage switch
    {
        CpsStage.WeightOfKnowing => new[]
        {
            "Migraines (The Pressure)",
            "High-pitched tinnitus (The Static Hiss)",
            "Mild auditory paresthesia",
            "Irritability"
        },
        CpsStage.GlimmerMadness => new[]
        {
            "Visual hallucinations (fractals)",
            "The Writhing Text (letters rearrange)",
            "Vertigo",
            "Semantic drift (forgetting names)"
        },
        CpsStage.RuinMadness => new[]
        {
            "Violent paranoia",
            "Logic-Locks (repeating actions)",
            "Loss of self-identity",
            "Worship of anomalies"
        },
        CpsStage.HollowShell => new[]
        {
            "Catatonia",
            "Hollow behavior (mimicking without comprehension)",
            "No pupillary response",
            "Complete lack of survival instinct"
        },
        _ => Array.Empty<string>()
    };
}
```

#### PanicResult Record

```csharp
/// <summary>
/// Result of a Panic Table roll for Stage 3 CPS.
/// </summary>
public sealed record PanicResult
{
    /// <summary>The d10 roll result.</summary>
    public int DieRoll { get; init; }

    /// <summary>The panic effect triggered.</summary>
    public PanicEffect Effect { get; init; }

    /// <summary>Display name of the effect.</summary>
    public string EffectName { get; init; } = string.Empty;

    /// <summary>Description of what happens.</summary>
    public string Description { get; init; } = string.Empty;

    /// <summary>Duration in turns (if applicable).</summary>
    public int? DurationTurns { get; init; }

    /// <summary>Self-damage amount (if applicable).</summary>
    public int? SelfDamage { get; init; }

    /// <summary>Status effects to apply.</summary>
    public IReadOnlyList<string> StatusEffects { get; init; } = Array.Empty<string>();

    /// <summary>Whether this forces a specific action.</summary>
    public bool ForcesAction { get; init; }

    /// <summary>The forced action type (if applicable).</summary>
    public string? ForcedActionType { get; init; }
}
```

### Application Layer

#### ICpsService Interface

```csharp
/// <summary>
/// Service for managing Cognitive Paradox Syndrome mechanics.
/// CPS is derived from Psychic Stress and adds staged symptoms.
/// </summary>
public interface ICpsService
{
    /// <summary>Gets the current CPS state for a character.</summary>
    CpsState GetCpsState(Guid characterId);

    /// <summary>Gets the CPS stage for a character.</summary>
    CpsStage GetCurrentStage(Guid characterId);

    /// <summary>
    /// Checks if CPS stage changed after stress update.
    /// </summary>
    CpsStageChangeResult CheckStageChange(
        Guid characterId,
        int previousStress,
        int newStress);

    /// <summary>
    /// Performs a Panic Table roll for Stage 3 CPS.
    /// </summary>
    PanicResult RollPanicTable(Guid characterId);

    /// <summary>
    /// Gets the UI distortion parameters for current CPS state.
    /// </summary>
    CpsUiEffects GetUiEffects(Guid characterId);

    /// <summary>
    /// Applies a Panic Effect to a character (status effects, damage, etc.).
    /// </summary>
    void ApplyPanicEffect(Guid characterId, PanicResult panicResult);

    /// <summary>
    /// Checks if character is recoverable (Stage 2 or below).
    /// </summary>
    bool IsRecoverable(Guid characterId);

    /// <summary>
    /// Gets the recovery protocol for current CPS stage.
    /// </summary>
    CpsRecoveryProtocol GetRecoveryProtocol(Guid characterId);
}
```

#### CpsStageChangeResult Record

```csharp
/// <summary>
/// Result of checking CPS stage change after stress modification.
/// </summary>
public sealed record CpsStageChangeResult
{
    /// <summary>Previous CPS stage.</summary>
    public CpsStage PreviousStage { get; init; }

    /// <summary>New CPS stage.</summary>
    public CpsStage NewStage { get; init; }

    /// <summary>Whether the stage changed.</summary>
    public bool StageChanged => PreviousStage != NewStage;

    /// <summary>Whether stage increased (worsened).</summary>
    public bool StageWorsened => NewStage > PreviousStage;

    /// <summary>Whether stage decreased (improved).</summary>
    public bool StageImproved => NewStage < PreviousStage;

    /// <summary>Whether entering Stage 3 (requires Panic roll).</summary>
    public bool EnteredRuinMadness =>
        PreviousStage < CpsStage.RuinMadness &&
        NewStage == CpsStage.RuinMadness;

    /// <summary>Whether entering Stage 4 (character lost).</summary>
    public bool EnteredHollowShell =>
        PreviousStage < CpsStage.HollowShell &&
        NewStage == CpsStage.HollowShell;
}
```

#### CpsUiEffects Record

```csharp
/// <summary>
/// UI visual effects for CPS state representation.
/// </summary>
public sealed record CpsUiEffects
{
    /// <summary>Current CPS stage.</summary>
    public CpsStage Stage { get; init; }

    /// <summary>Visual distortion intensity (0.0 - 1.0).</summary>
    public float DistortionIntensity { get; init; }

    /// <summary>Whether to apply peripheral static.</summary>
    public bool PeripheralStatic { get; init; }

    /// <summary>Whether to apply text glitching (leetspeak).</summary>
    public bool TextGlitching { get; init; }

    /// <summary>Leetspeak substitution level (0-4).</summary>
    public int LeetSpeakLevel { get; init; }

    /// <summary>Whether to show system warning overlays.</summary>
    public bool SystemWarnings { get; init; }

    /// <summary>Color tint for UI elements.</summary>
    public string ColorTint { get; init; } = "#FFFFFF";

    /// <summary>Whether screen should have "lag" effect.</summary>
    public bool ScreenLag { get; init; }
}
```

#### CpsRecoveryProtocol Record

```csharp
/// <summary>
/// Recovery protocol recommendations for current CPS stage.
/// </summary>
public sealed record CpsRecoveryProtocol
{
    /// <summary>Current CPS stage.</summary>
    public CpsStage Stage { get; init; }

    /// <summary>Whether recovery is possible.</summary>
    public bool IsRecoverable { get; init; }

    /// <summary>Recommended protocol name.</summary>
    public string ProtocolName { get; init; } = string.Empty;

    /// <summary>Protocol steps/requirements.</summary>
    public IReadOnlyList<string> Steps { get; init; } = Array.Empty<string>();

    /// <summary>Estimated recovery time.</summary>
    public string RecoveryTime { get; init; } = string.Empty;

    /// <summary>Urgency level (Low, Medium, High, Critical, None).</summary>
    public string Urgency { get; init; } = "None";
}
```

### Configuration

#### cps_stages.json

```json
{
  "version": "1.0",
  "stages": [
    {
      "stage": 0,
      "name": "None",
      "displayName": "Clear",
      "stressRange": { "min": 0, "max": 19 },
      "symptoms": [],
      "uiEffects": {
        "distortionIntensity": 0.0,
        "peripheralStatic": false,
        "textGlitching": false,
        "leetSpeakLevel": 0
      },
      "recoveryProtocol": null
    },
    {
      "stage": 1,
      "name": "WeightOfKnowing",
      "displayName": "Weight of Knowing",
      "stressRange": { "min": 20, "max": 49 },
      "symptoms": [
        "Migraines (The Pressure)",
        "High-pitched tinnitus (The Static Hiss)",
        "Mild auditory paresthesia (hearing whispers in wind)",
        "Irritability"
      ],
      "fieldSigns": [
        "Subject frequently rubs temples",
        "Asks 'Did you hear that?'",
        "Stares at geometry for too long"
      ],
      "uiEffects": {
        "distortionIntensity": 0.1,
        "peripheralStatic": true,
        "textGlitching": false,
        "leetSpeakLevel": 0,
        "colorTint": "#E8E8E8"
      },
      "recoveryProtocol": {
        "name": "Cognitive Hygiene",
        "steps": [
          "Rest in safe location",
          "Silence and darkness",
          "Avoid anomaly exposure"
        ],
        "recoveryTime": "12-24 hours",
        "urgency": "Low"
      }
    },
    {
      "stage": 2,
      "name": "GlimmerMadness",
      "displayName": "Glimmer-Madness",
      "stressRange": { "min": 50, "max": 79 },
      "symptoms": [
        "Visual hallucinations (fractals overlaying vision)",
        "The Writhing Text (letters rearrange)",
        "Vertigo",
        "Semantic drift (forgetting names of common objects)"
      ],
      "fieldSigns": [
        "Responds to stimuli that aren't there",
        "Describes colors that don't exist",
        "Cannot read written text reliably"
      ],
      "uiEffects": {
        "distortionIntensity": 0.4,
        "peripheralStatic": true,
        "textGlitching": true,
        "leetSpeakLevel": 2,
        "colorTint": "#FFE0B0",
        "screenLag": true
      },
      "mechanicalEffects": {
        "logicDisadvantage": true
      },
      "recoveryProtocol": {
        "name": "Silent Room Protocol",
        "steps": [
          "Immediate extraction from field",
          "48-hour sensory deprivation",
          "Memory-Mirror Suppressant administration"
        ],
        "recoveryTime": "48+ hours",
        "urgency": "Critical"
      }
    },
    {
      "stage": 3,
      "name": "RuinMadness",
      "displayName": "Ruin-Madness",
      "stressRange": { "min": 80, "max": 99 },
      "symptoms": [
        "Violent paranoia",
        "Logic-Locks (repeating physical action or phrase endlessly)",
        "Loss of self-identity",
        "Worship of anomalies"
      ],
      "fieldSigns": [
        "Attempts to interact with hazardous anomalies",
        "Speaks in Word-Salad (random technical/mythic jargon)",
        "Hostility to 'un-enlightened' teammates"
      ],
      "uiEffects": {
        "distortionIntensity": 0.7,
        "peripheralStatic": true,
        "textGlitching": true,
        "leetSpeakLevel": 4,
        "systemWarnings": true,
        "colorTint": "#FF8080",
        "screenLag": true
      },
      "mechanicalEffects": {
        "logicDisadvantage": true,
        "panicTableRequired": true
      },
      "recoveryProtocol": {
        "name": "Terminal Protocol",
        "steps": [
          "Subject is effectively lost",
          "Contain and restrain if possible",
          "Do not engage in conversation"
        ],
        "recoveryTime": "None - irreversible in field conditions",
        "urgency": "None - person is gone"
      }
    },
    {
      "stage": 4,
      "name": "HollowShell",
      "displayName": "The Hollow Shell",
      "stressRange": { "min": 100, "max": 100 },
      "symptoms": [
        "Catatonia",
        "Hollow behavior (mimicking sounds/actions without comprehension)",
        "Hamingja (soul) overwritten by Blight-noise"
      ],
      "fieldSigns": [
        "No pupillary response",
        "Echo-lalia",
        "Complete lack of survival instinct"
      ],
      "uiEffects": {
        "distortionIntensity": 1.0,
        "blackScreen": true,
        "colorTint": "#000000"
      },
      "mechanicalEffects": {
        "characterLost": true
      },
      "recoveryProtocol": {
        "name": "None",
        "steps": ["Subject is a biological automaton"],
        "recoveryTime": "N/A",
        "urgency": "N/A"
      }
    }
  ]
}
```

#### panic_table.json

```json
{
  "version": "1.0",
  "table": [
    {
      "dieRange": { "min": 1, "max": 2 },
      "effect": "Freeze",
      "name": "Logic Lock",
      "description": "Character loses all actions this turn. Stares at a geometric anomaly.",
      "flavor": "The angles... they don't connect...",
      "mechanicalImpact": {
        "statusEffects": ["Stunned"],
        "duration": 1,
        "defensePenalty": 5
      }
    },
    {
      "dieRange": { "min": 3, "max": 4 },
      "effect": "Flight",
      "name": "Evacuation Protocol",
      "description": "Character spends all movement fleeing the source of stress.",
      "flavor": "Abort! Abort!",
      "mechanicalImpact": {
        "forcedAction": "Move",
        "direction": "away_from_source"
      }
    },
    {
      "dieRange": { "min": 5, "max": 6 },
      "effect": "Fight",
      "name": "Paradox Fury",
      "description": "Character attacks nearest entity (friend or foe).",
      "flavor": "Silence the noise!",
      "mechanicalImpact": {
        "forcedAction": "Attack",
        "target": "nearest"
      }
    },
    {
      "dieRange": { "min": 7, "max": 7 },
      "effect": "Babble",
      "name": "Word Salad",
      "description": "Character shouts nonsensical technical jargon.",
      "flavor": "KERNEL PANIC BUFFER OVERFLOW RECURSIVE INFINITY—",
      "mechanicalImpact": {
        "partyEffect": "stealth_impossible"
      }
    },
    {
      "dieRange": { "min": 8, "max": 8 },
      "effect": "SelfHarm",
      "name": "Purge",
      "description": "Character inflicts damage to self to 'let the pressure out.'",
      "flavor": "Just... need to let it out...",
      "mechanicalImpact": {
        "selfDamage": "1d6",
        "ignoresSoak": true
      }
    },
    {
      "dieRange": { "min": 9, "max": 9 },
      "effect": "Hallucination",
      "name": "Phantom Data",
      "description": "Character treats empty space as cover or a wall.",
      "flavor": "There's a wall here! Can't you see it?!",
      "mechanicalImpact": {
        "statusEffects": ["Disadvantage"],
        "duration": 1
      }
    },
    {
      "dieRange": { "min": 10, "max": 10 },
      "effect": "Catatonia",
      "name": "System Crash",
      "description": "Character falls Prone and unresponsive.",
      "flavor": "CRITICAL_ERROR... rebooting...",
      "mechanicalImpact": {
        "statusEffects": ["Prone", "Stunned"],
        "durationDice": "1d4"
      }
    }
  ]
}
```

---

## Out of Scope

The following are explicitly **not** included in v0.18.2:

| Feature | Deferred To | Reason |
|---------|-------------|--------|
| Visual shader effects | v0.19.x | UI/Graphics version |
| Leetspeak text rendering | v0.19.x | UI version |
| Audio distortion effects | v0.19.x | Audio version |
| Logic Save checks | v0.18.3 | Requires Trauma Check integration |
| Forlorn conversion | v0.21.x | Enemy system |

---

## Unit Tests (~12 tests)

### CpsState Tests

| Test | Description |
|------|-------------|
| `CpsState_Stage_None_WhenUnder20` | Verify Stage 0 for stress 0-19 |
| `CpsState_Stage_WeightOfKnowing_When20To49` | Verify Stage 1 |
| `CpsState_Stage_GlimmerMadness_When50To79` | Verify Stage 2 |
| `CpsState_Stage_RuinMadness_When80To99` | Verify Stage 3 |
| `CpsState_Stage_HollowShell_At100` | Verify Stage 4 |
| `CpsState_RequiresPanicRoll_OnlyAtStage3` | Verify panic flag |
| `CpsState_HasVisualDistortion_AtStage2Plus` | Verify distortion flag |

### CpsService Tests

| Test | Description |
|------|-------------|
| `CheckStageChange_DetectsIncrease` | Stage worsening detected |
| `CheckStageChange_DetectsDecrease` | Stage improvement detected |
| `CheckStageChange_DetectsRuinMadnessEntry` | Stage 3 entry flagged |
| `RollPanicTable_ReturnsValidEffect` | Effect within d10 range |
| `GetUiEffects_ScalesWithStage` | Distortion scales correctly |

---

## Acceptance Criteria

### Functional Requirements

- [ ] CPS stages correctly map to stress ranges
- [ ] Stage transitions detected when stress changes
- [ ] Panic Table rolls produce valid effects
- [ ] UI effects scale with CPS stage
- [ ] Recovery protocols defined for recoverable stages
- [ ] Hollow Shell state marked as character lost

### Quality Requirements

- [ ] All public methods have XML documentation
- [ ] Stage configuration externalized to JSON
- [ ] Panic Table configuration externalized to JSON
- [ ] Unit test coverage ≥ 90%

---

## Dependencies

### Requires

| Dependency | Purpose |
|------------|---------|
| Stress System (v0.18.0) | Stress values for stage calculation |
| Dice System (v0.6.x) | d10 Panic Table rolls |
| Status Effect System (v0.10.x) | Stunned, Prone effects |

### Provides

| Feature | Consumer |
|---------|----------|
| `CpsStage` | Combat UI effects |
| `PanicResult` | Combat action forcing |
| `CpsUiEffects` | UI rendering |

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01-17 | Initial scope breakdown |
