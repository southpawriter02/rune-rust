# v0.8.1 Inventory & Equipment - Scope Breakdown

**Version:** 0.8.1
**Theme:** Navigation & Information
**Prerequisites:** v0.8.0c Complete (Character & Settings - Keyboard Shortcuts)
**Total Estimated Tests:** ~35 new tests

---

## Executive Summary

The Navigation & Information sub-version implements panels and services for player navigation and information display: a visual map view showing explored dungeon rooms, a quest log window for tracking active and completed quests, and a tooltip service providing hover information for items, abilities, and UI elements.

Key focus areas:
- **Map View**: Visual dungeon layout with room connections
- **Quest Log**: Active/completed quest tracking with details
- **Tooltips**: Contextual hover information throughout the UI

The work is divided into **three sub-parts**:

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.8.1a | Map View Panel | Visual room layout, exploration tracking | ~12 |
| v0.8.1b | Quest Log Window | Quest list, objectives, rewards display | ~13 |
| v0.8.1c | Tooltip Service | Item/ability/UI tooltips with styling | ~10 |

---

## Existing Infrastructure

### Already Implemented (from v0.8.1)

| Feature | Location | Notes |
|---------|----------|-------|
| CharacterCreationWizard | `Views/CharacterCreationWizard.axaml` | Multi-step window |
| SettingsWindow | `Views/SettingsWindow.axaml` | Tabbed settings |
| KeyboardShortcutService | `Services/KeyboardShortcutService.cs` | Hotkeys |
| WindowLayoutService | `Services/WindowLayoutService.cs` | Panel regions |

### Already Implemented (from prior versions)

| Feature | Location | Notes |
|---------|----------|-------|
| Room | `Domain/Entities/Room.cs` | Room data |
| RoomConnection | `Domain/ValueObjects/RoomConnection.cs` | Room links |
| Quest | `Domain/Entities/Quest.cs` | Quest entity |
| QuestObjective | `Domain/ValueObjects/QuestObjective.cs` | Objectives |
| QuestService | `Application/Services/QuestService.cs` | Quest logic |
| Item | `Domain/Entities/Item.cs` | Item data |
| AbilityDefinition | `Domain/Entities/AbilityDefinition.cs` | Ability data |

### Needs Implementation (v0.8.1)

| Feature | Part | Notes |
|---------|------|-------|
| MapViewPanel | v0.8.1a | Visual dungeon map |
| MapViewPanelViewModel | v0.8.1a | Map state binding |
| RoomNodeControl | v0.8.1a | Room display |
| QuestLogWindow | v0.8.1b | Quest tracking UI |
| QuestLogViewModel | v0.8.1b | Quest state |
| QuestEntryControl | v0.8.1b | Individual quest |
| ITooltipService | v0.8.0c | Tooltip interface |
| TooltipService | v0.8.0c | Tooltip logic |
| TooltipControl | v0.8.0c | Tooltip display |

---

## Feature Analysis & Categorization

### Map View Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Room node rendering | Medium | Room connections | **v0.8.1a** |
| Room connections | Medium | Path drawing | **v0.8.1a** |
| Exploration tracking | Low | Room visited state | **v0.8.1a** |
| Current room highlight | Low | Game state | **v0.8.1a** |
| Zoom/pan | Medium | Transform | **v0.8.1a** |

### Quest Log Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Active quest list | Low | Quest service | **v0.8.1b** |
| Completed quest list | Low | Quest service | **v0.8.1b** |
| Quest details view | Medium | Quest data | **v0.8.1b** |
| Objective tracking | Medium | Real-time updates | **v0.8.1b** |
| Quest rewards display | Low | Quest data | **v0.8.1b** |

### Tooltip Features

| Feature | Complexity | Dependencies | Assigned Part |
|---------|------------|--------------|---------------|
| Tooltip service | Medium | Delay handling | **v0.8.0c** |
| Item tooltips | Medium | Item data | **v0.8.0c** |
| Ability tooltips | Medium | Ability data | **v0.8.0c** |
| UI element tooltips | Low | Attached property | **v0.8.0c** |
| Auto-positioning | Medium | Screen bounds | **v0.8.0c** |

---

## Part Definitions

---

## v0.8.1a: Map View Panel

[v0.8.1a Design Specification](v0.8.1a-design-specification.md)

### Overview

Implement a visual map view panel that displays the dungeon layout with explored rooms, connections between rooms, and the player's current location. Unexplored rooms appear as "???" until visited.

### Scope

**In Scope:**
- `MapViewPanel` UserControl
- `MapViewPanelViewModel` with room data binding
- `RoomNodeControl` for individual rooms
- `ConnectionLineControl` for room connections
- Room exploration state (explored/unexplored)
- Current room highlighting
- Room icon by type (shop, danger, boss, etc.)
- Room name on hover
- Connection visibility (locked doors shown differently)
- Legend display
- Zoom controls (optional)
- Pan with drag (optional)
- Toggle via keyboard (M key)

**Out of Scope:**
- Quest log (v0.8.1b)
- Tooltips (v0.8.0c)
- Real-time entity tracking (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| User Controls | 3 | `MapViewPanel`, `RoomNodeControl`, `ConnectionLineControl` |
| ViewModels | 2 | `MapViewPanelViewModel`, `RoomNodeViewModel` |
| Styles | 1 | `MapViewStyles.axaml` |
| Unit Tests | ~12 | Room rendering, connection tests |

### Map View Panel Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DUNGEON MAP                                 â”‚
â”‚                                                         [âˆ’] [+] [â—]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                         â”‚
â”‚                    â”‚  ???  â”‚  Unexplored                             â”‚
â”‚                    â””â”€â”€â”€â”¬â”€â”€â”€â”˜                                         â”‚
â”‚                        â”‚                                              â”‚
â”‚                        â”‚                                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚ Guard â”‚â”€â”€â”‚ Hall  â”‚â”€â”€â”‚ Armry â”‚                             â”‚
â”‚         â”‚ Room  â”‚  â”‚       â”‚  â”‚  ğŸ›¡   â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                        â”‚                                              â”‚
â”‚                        â”‚                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚         â”‚ Store â”‚â”€â”€â”‚ [@]   â”‚â•â•â”‚  ???  â”‚  (locked door)              â”‚
â”‚         â”‚  ğŸ’°   â”‚  â”‚ Cave  â”‚  â”‚       â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                        â”‚                                              â”‚
â”‚                        â”‚                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                         â”‚
â”‚                    â”‚ Exit  â”‚                                         â”‚
â”‚                    â”‚  ğŸšª   â”‚                                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Legend: [@]=You  [???]=Unexplored  â•â•=Locked  ğŸ’°=Shop  ğŸ›¡=Armory   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RoomNodeControl

```csharp
namespace RuneAndRust.Avalonia.Controls;

/// <summary>
/// Displays a room node on the map.
/// </summary>
public class RoomNodeControl : TemplatedControl
{
    public static readonly StyledProperty<Room?> RoomProperty =
        AvaloniaProperty.Register<RoomNodeControl, Room?>(nameof(Room));
    
    public static readonly StyledProperty<bool> IsExploredProperty =
        AvaloniaProperty.Register<RoomNodeControl, bool>(nameof(IsExplored));
    
    public static readonly StyledProperty<bool> IsCurrentProperty =
        AvaloniaProperty.Register<RoomNodeControl, bool>(nameof(IsCurrent));
    
    public static readonly StyledProperty<RoomType> RoomTypeProperty =
        AvaloniaProperty.Register<RoomNodeControl, RoomType>(nameof(RoomType));
    
    public Room? Room
    {
        get => GetValue(RoomProperty);
        set => SetValue(RoomProperty, value);
    }
    
    public bool IsExplored
    {
        get => GetValue(IsExploredProperty);
        set => SetValue(IsExploredProperty, value);
    }
    
    public bool IsCurrent
    {
        get => GetValue(IsCurrentProperty);
        set => SetValue(IsCurrentProperty, value);
    }
    
    public RoomType RoomType
    {
        get => GetValue(RoomTypeProperty);
        set => SetValue(RoomTypeProperty, value);
    }
    
    public string DisplayName => IsExplored ? Room?.Name ?? "Room" : "???";
    
    public string Icon => RoomType switch
    {
        RoomType.Shop => "ğŸ’°",
        RoomType.Armory => "ğŸ›¡",
        RoomType.Boss => "â˜ ",
        RoomType.Exit => "ğŸšª",
        RoomType.Danger => "âš ",
        RoomType.Treasure => "ğŸ’",
        _ => ""
    };
    
    public IBrush BorderBrush => IsCurrent 
        ? Brushes.Gold 
        : IsExplored ? Brushes.DimGray : Brushes.DarkGray;
    
    public IBrush BackgroundBrush => IsCurrent
        ? new SolidColorBrush(Color.FromArgb(128, 255, 215, 0))
        : IsExplored ? Brushes.DarkSlateGray : Brushes.Black;
}
```

### MapViewPanelViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class MapViewPanelViewModel : ViewModelBase
{
    private readonly IGameSessionService _gameSession;
    private readonly IRoomMapService _roomMap;
    
    [ObservableProperty]
    private ObservableCollection<RoomNodeViewModel> _rooms = new();
    
    [ObservableProperty]
    private ObservableCollection<ConnectionViewModel> _connections = new();
    
    [ObservableProperty]
    private Guid _currentRoomId;
    
    [ObservableProperty]
    private double _zoomLevel = 1.0;
    
    [ObservableProperty]
    private Point _panOffset = new(0, 0);
    
    public MapViewPanelViewModel(IGameSessionService gameSession, IRoomMapService roomMap)
    {
        _gameSession = gameSession;
        _roomMap = roomMap;
        
        _gameSession.OnRoomChanged += HandleRoomChanged;
        
        BuildMapLayout();
    }
    
    [RelayCommand]
    private void ZoomIn()
    {
        ZoomLevel = Math.Min(2.0, ZoomLevel + 0.25);
    }
    
    [RelayCommand]
    private void ZoomOut()
    {
        ZoomLevel = Math.Max(0.5, ZoomLevel - 0.25);
    }
    
    [RelayCommand]
    private void CenterOnPlayer()
    {
        // Center view on current room
        var currentRoom = Rooms.FirstOrDefault(r => r.RoomId == CurrentRoomId);
        if (currentRoom is not null)
        {
            PanOffset = new Point(-currentRoom.X + 200, -currentRoom.Y + 200);
        }
    }
    
    private void BuildMapLayout()
    {
        Rooms.Clear();
        Connections.Clear();
        
        var exploredRooms = _gameSession.GetExploredRooms();
        var layout = _roomMap.CalculateLayout(exploredRooms);
        
        foreach (var (room, position) in layout)
        {
            Rooms.Add(new RoomNodeViewModel(room, position, room.Id == CurrentRoomId));
        }
        
        foreach (var connection in _roomMap.GetConnections(exploredRooms))
        {
            Connections.Add(new ConnectionViewModel(connection));
        }
    }
    
    private void HandleRoomChanged(Room room)
    {
        CurrentRoomId = room.Id;
        BuildMapLayout(); // Rebuild to include newly explored rooms
    }
}
```

### Acceptance Criteria

- [ ] Map panel displays explored rooms
- [ ] Unexplored rooms show as "???"
- [ ] Current room is highlighted (gold border)
- [ ] Room connections display correctly
- [ ] Locked doors show differently (â•)
- [ ] Room type icons display
- [ ] Hover shows room name
- [ ] Legend explains symbols
- [ ] M key toggles map visibility
- [ ] Zoom controls work (optional)
- [ ] Pan with drag works (optional)
- [ ] Map updates when entering new room
- [ ] ~12 unit tests pass

---

## v0.8.1b: Quest Log Window

[v0.8.1b Design Specification](v0.8.1b-design-specification.md)

### Overview

Implement a quest log window that displays active and completed quests with details including objectives, progress, and rewards. The active quest can be tracked for on-screen reminders.

### Scope

**In Scope:**
- `QuestLogWindow` modal window
- `QuestLogViewModel` with quest data binding
- `QuestEntryControl` for individual quests
- Active quests section
- Completed quests section (collapsible)
- Quest details panel
- Objective list with checkmarks
- Progress tracking (e.g., "2/5 goblins")
- Rewards display
- "Track Quest" button for HUD tracking
- Toggle via keyboard (J key)
- Quest sorting (by urgency, name)

**Out of Scope:**
- Map view (v0.8.1a)
- Tooltips (v0.8.0c)
- Quest markers on map (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Windows | 1 | `QuestLogWindow` |
| ViewModels | 2 | `QuestLogViewModel`, `QuestEntryViewModel` |
| User Controls | 2 | `QuestEntryControl`, `ObjectiveListControl` |
| Styles | 1 | `QuestLogStyles.axaml` |
| Unit Tests | ~13 | Quest display, tracking tests |

### Quest Log Window Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         QUEST LOG                             [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ACTIVE QUESTS (3)       â”‚ â”‚                                     â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ THE SKELETON KEY                    â”‚ â”‚
â”‚ â”‚ â–º The Skeleton Key  â˜…   â”‚ â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                   â”‚ â”‚
â”‚ â”‚   Rescue the Miner      â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚   Find Lost Artifact    â”‚ â”‚ The old innkeeper has asked you to  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ retrieve a key from the skeleton    â”‚ â”‚
â”‚ â”‚ â–¼ COMPLETED (5)         â”‚ â”‚ guardian in the dark cave.          â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                     â”‚ â”‚
â”‚ â”‚   âœ“ Enter the Cave      â”‚ â”‚ OBJECTIVES:                         â”‚ â”‚
â”‚ â”‚   âœ“ Find the Map        â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚   âœ“ Defeat Goblins      â”‚ â”‚ â˜‘ Speak to the innkeeper            â”‚ â”‚
â”‚ â”‚   âœ“ Basic Training      â”‚ â”‚ â˜‘ Enter the dark cave               â”‚ â”‚
â”‚ â”‚   âœ“ First Steps         â”‚ â”‚ â˜ Defeat the skeleton guardian      â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â˜ Retrieve the rusty key            â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â˜ Return to the innkeeper           â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ REWARDS:                            â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â€¢ 100 XP                            â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â€¢ 50 Gold                           â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â€¢ Unlocks: Armory access            â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚                                     â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ PROGRESS: 2/5 objectives            â”‚ â”‚
â”‚ â”‚                         â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  40%               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   [ â˜… Track Quest ]  [ Close ]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


TRACKED QUEST HUD (on-screen):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜… THE SKELETON KEY                  â”‚
â”‚   â˜ Defeat the skeleton guardian    â”‚
â”‚   â˜ Retrieve the rusty key          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### QuestLogViewModel

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class QuestLogViewModel : ViewModelBase
{
    private readonly IQuestService _questService;
    
    [ObservableProperty]
    private ObservableCollection<QuestEntryViewModel> _activeQuests = new();
    
    [ObservableProperty]
    private ObservableCollection<QuestEntryViewModel> _completedQuests = new();
    
    [ObservableProperty]
    private QuestEntryViewModel? _selectedQuest;
    
    [ObservableProperty]
    private bool _showCompletedQuests = true;
    
    [ObservableProperty]
    private Guid? _trackedQuestId;
    
    public QuestLogViewModel(IQuestService questService)
    {
        _questService = questService;
        _questService.OnQuestUpdated += HandleQuestUpdated;
        
        LoadQuests();
    }
    
    [RelayCommand]
    private void SelectQuest(QuestEntryViewModel quest)
    {
        SelectedQuest = quest;
    }
    
    [RelayCommand]
    private void TrackQuest()
    {
        if (SelectedQuest is null) return;
        
        TrackedQuestId = SelectedQuest.QuestId;
        _questService.SetTrackedQuest(SelectedQuest.QuestId);
    }
    
    [RelayCommand]
    private void ToggleCompletedQuests()
    {
        ShowCompletedQuests = !ShowCompletedQuests;
    }
    
    private void LoadQuests()
    {
        ActiveQuests.Clear();
        CompletedQuests.Clear();
        
        foreach (var quest in _questService.GetActiveQuests())
        {
            ActiveQuests.Add(new QuestEntryViewModel(quest, quest.Id == TrackedQuestId));
        }
        
        foreach (var quest in _questService.GetCompletedQuests())
        {
            CompletedQuests.Add(new QuestEntryViewModel(quest, false));
        }
    }
    
    private void HandleQuestUpdated(Quest quest)
    {
        // Find and update the quest entry
        var entry = ActiveQuests.FirstOrDefault(q => q.QuestId == quest.Id)
                 ?? CompletedQuests.FirstOrDefault(q => q.QuestId == quest.Id);
        
        if (entry is not null)
        {
            entry.UpdateFrom(quest);
        }
        else
        {
            LoadQuests(); // New quest, reload
        }
    }
}

public partial class QuestEntryViewModel : ViewModelBase
{
    public Guid QuestId { get; }
    
    [ObservableProperty]
    private string _title;
    
    [ObservableProperty]
    private string _description;
    
    [ObservableProperty]
    private ObservableCollection<ObjectiveViewModel> _objectives = new();
    
    [ObservableProperty]
    private ObservableCollection<RewardViewModel> _rewards = new();
    
    [ObservableProperty]
    private bool _isCompleted;
    
    [ObservableProperty]
    private bool _isTracked;
    
    [ObservableProperty]
    private double _progressPercentage;
    
    [ObservableProperty]
    private string _progressText;
}
```

### ObjectiveViewModel

```csharp
public partial class ObjectiveViewModel : ViewModelBase
{
    [ObservableProperty]
    private string _description;
    
    [ObservableProperty]
    private bool _isCompleted;
    
    [ObservableProperty]
    private int _currentProgress;
    
    [ObservableProperty]
    private int _requiredProgress;
    
    [ObservableProperty]
    private bool _hasProgress;
    
    public string StatusIcon => IsCompleted ? "â˜‘" : "â˜";
    
    public string ProgressText => HasProgress 
        ? $"({CurrentProgress}/{RequiredProgress})" 
        : "";
}
```

### Acceptance Criteria

- [ ] Quest log opens with J key
- [ ] Active quests section shows incomplete quests
- [ ] Completed quests section shows finished quests
- [ ] Completed section is collapsible
- [ ] Selecting quest shows details
- [ ] Objectives display with checkmarks
- [ ] Progress objectives show counts
- [ ] Rewards display correctly
- [ ] Progress bar shows completion %
- [ ] Track Quest marks quest for HUD
- [ ] Tracked quest shows â˜… indicator
- [ ] Quest updates appear in real-time
- [ ] ~13 unit tests pass

---

## v0.8.0c: Tooltip Service

[v0.8.0c Design Specification](v0.8.0c-design-specification.md)

### Overview

Implement a tooltip service that provides hover information for items, abilities, and UI elements. Tooltips appear after a configurable delay, auto-position to stay on screen, and use consistent styling.

### Scope

**In Scope:**
- `ITooltipService` interface
- `TooltipService` implementation
- `TooltipControl` custom control
- Item tooltips (name, type, stats, description, value)
- Ability tooltips (name, cost, cooldown, effects, description)
- Status effect tooltips
- UI element tooltips (attached property)
- Configurable show delay (default 500ms)
- Auto-positioning (stay on screen)
- Tooltip styling (consistent look)
- Rich content support (icons, colors)
- Hide on mouse leave
- Disable tooltips option

**Out of Scope:**
- Map view (v0.8.1a)
- Quest log (v0.8.1b)
- Interactive tooltips (future)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Interfaces | 1 | `ITooltipService` |
| Services | 1 | `TooltipService` |
| Controls | 1 | `TooltipControl` |
| Attached Properties | 1 | `Tooltip.Content` |
| Styles | 1 | `TooltipStyles.axaml` |
| Unit Tests | ~10 | Tooltip display, positioning tests |

### Tooltip Designs

```
ITEM TOOLTIP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš” IRON SWORD                        â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚ Weapon (One-Handed Sword)           â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Damage:  2d6 + 3  Slashing      â”‚ â”‚
â”‚ â”‚ Attack:  +4                     â”‚ â”‚
â”‚ â”‚ Speed:   Normal                 â”‚ â”‚
â”‚ â”‚ Weight:  3 lbs                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ A sturdy iron blade, well-balanced  â”‚
â”‚ and reliable in combat.             â”‚
â”‚                                     â”‚
â”‚ Value: 25 gold                      â”‚
â”‚ [Right-click for options]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ABILITY TOOLTIP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”¥ FIREBALL                         â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚ Evocation â€¢ 3rd Level               â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Damage:   3d6 fire              â”‚ â”‚
â”‚ â”‚ Range:    6 cells               â”‚ â”‚
â”‚ â”‚ Area:     Circle (radius 2)     â”‚ â”‚
â”‚ â”‚ Cost:     15 mana               â”‚ â”‚
â”‚ â”‚ Cooldown: 3 turns               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ Hurl a ball of fire that explodes,  â”‚
â”‚ engulfing all creatures in the area â”‚
â”‚ in flames.                          â”‚
â”‚                                     â”‚
â”‚ [Press 1 to use]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STATUS EFFECT TOOLTIP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ©¸ BLEEDING                         â”‚
â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚ Debuff â€¢ Physical                   â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Effect:   2 damage per turn     â”‚ â”‚
â”‚ â”‚ Duration: 3 turns remaining     â”‚ â”‚
â”‚ â”‚ Source:   Skeleton's attack     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚ You are losing blood from a wound.  â”‚
â”‚ Take fire damage to cauterize.      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


UI ELEMENT TOOLTIP (simple):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Toggle Inventory (I)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ITooltipService Interface

```csharp
namespace RuneAndRust.Avalonia.Services;

/// <summary>
/// Manages tooltip display throughout the application.
/// </summary>
public interface ITooltipService
{
    /// <summary>Gets or sets the show delay in milliseconds.</summary>
    int ShowDelayMs { get; set; }
    
    /// <summary>Gets or sets whether tooltips are enabled.</summary>
    bool IsEnabled { get; set; }
    
    /// <summary>Shows a tooltip for an item.</summary>
    void ShowItemTooltip(Item item, Control target);
    
    /// <summary>Shows a tooltip for an ability.</summary>
    void ShowAbilityTooltip(AbilityDefinition ability, Control target);
    
    /// <summary>Shows a tooltip for a status effect.</summary>
    void ShowStatusEffectTooltip(StatusEffect effect, Control target);
    
    /// <summary>Shows a simple text tooltip.</summary>
    void ShowTextTooltip(string text, Control target);
    
    /// <summary>Shows a custom tooltip with rich content.</summary>
    void ShowTooltip(TooltipContent content, Control target);
    
    /// <summary>Hides the current tooltip.</summary>
    void HideTooltip();
    
    /// <summary>Event when tooltip content changes.</summary>
    event Action<TooltipContent?>? OnTooltipChanged;
}

public record TooltipContent(
    string Title,
    string? Subtitle,
    IReadOnlyList<TooltipSection> Sections,
    string? Description,
    string? Footer
);

public record TooltipSection(
    string? Header,
    IReadOnlyList<TooltipLine> Lines
);

public record TooltipLine(string Label, string Value, Color? ValueColor = null);
```

### TooltipService Implementation

```csharp
namespace RuneAndRust.Avalonia.Services;

public class TooltipService : ITooltipService
{
    private readonly ILogger<TooltipService> _logger;
    private CancellationTokenSource? _showCts;
    private Control? _currentTarget;
    
    public int ShowDelayMs { get; set; } = 500;
    public bool IsEnabled { get; set; } = true;
    
    public event Action<TooltipContent?>? OnTooltipChanged;
    
    public void ShowItemTooltip(Item item, Control target)
    {
        if (!IsEnabled) return;
        
        var content = BuildItemTooltip(item);
        ScheduleShow(content, target);
    }
    
    public void ShowAbilityTooltip(AbilityDefinition ability, Control target)
    {
        if (!IsEnabled) return;
        
        var content = BuildAbilityTooltip(ability);
        ScheduleShow(content, target);
    }
    
    public void ShowTextTooltip(string text, Control target)
    {
        if (!IsEnabled) return;
        
        var content = new TooltipContent(text, null, Array.Empty<TooltipSection>(), null, null);
        ScheduleShow(content, target);
    }
    
    public void HideTooltip()
    {
        _showCts?.Cancel();
        _showCts = null;
        _currentTarget = null;
        OnTooltipChanged?.Invoke(null);
    }
    
    private async void ScheduleShow(TooltipContent content, Control target)
    {
        _showCts?.Cancel();
        _showCts = new CancellationTokenSource();
        _currentTarget = target;
        
        try
        {
            await Task.Delay(ShowDelayMs, _showCts.Token);
            OnTooltipChanged?.Invoke(content);
        }
        catch (TaskCanceledException)
        {
            // Tooltip was cancelled before showing
        }
    }
    
    private TooltipContent BuildItemTooltip(Item item)
    {
        var sections = new List<TooltipSection>
        {
            new TooltipSection(null, new List<TooltipLine>
            {
                new("Damage", item.Damage ?? "â€”"),
                new("Attack", $"+{item.AttackBonus}"),
                new("Weight", $"{item.Weight} lbs")
            })
        };
        
        return new TooltipContent(
            $"{item.GetCategoryIcon()} {item.Name.ToUpper()}",
            $"{item.ItemType} ({item.Category})",
            sections,
            item.Description,
            $"Value: {item.Value} gold"
        );
    }
    
    private TooltipContent BuildAbilityTooltip(AbilityDefinition ability)
    {
        var sections = new List<TooltipSection>
        {
            new TooltipSection(null, new List<TooltipLine>
            {
                new("Damage", ability.DamageFormula ?? "â€”"),
                new("Range", $"{ability.Range} cells"),
                new("Cost", $"{ability.Cost.Amount} {ability.Cost.ResourceTypeId}"),
                new("Cooldown", ability.Cooldown > 0 ? $"{ability.Cooldown} turns" : "None")
            })
        };
        
        return new TooltipContent(
            $"{ability.Icon} {ability.Name.ToUpper()}",
            $"{ability.School} â€¢ Level {ability.Level}",
            sections,
            ability.Description,
            ability.Hotkey is not null ? $"[Press {ability.Hotkey} to use]" : null
        );
    }
}
```

### TooltipControl

```csharp
namespace RuneAndRust.Avalonia.Controls;

/// <summary>
/// Displays rich tooltip content.
/// </summary>
public class TooltipControl : TemplatedControl
{
    public static readonly StyledProperty<TooltipContent?> ContentProperty =
        AvaloniaProperty.Register<TooltipControl, TooltipContent?>(nameof(Content));
    
    public TooltipContent? Content
    {
        get => GetValue(ContentProperty);
        set => SetValue(ContentProperty, value);
    }
    
    protected override void OnPropertyChanged(AvaloniaPropertyChangedEventArgs change)
    {
        base.OnPropertyChanged(change);
        
        if (change.Property == ContentProperty)
        {
            IsVisible = Content is not null;
            if (Content is not null)
            {
                PositionTooltip();
            }
        }
    }
    
    private void PositionTooltip()
    {
        // Position near mouse, keeping on screen
        var mousePos = GetMousePosition();
        var screenBounds = GetScreenBounds();
        
        var x = mousePos.X + 16; // Offset from cursor
        var y = mousePos.Y + 16;
        
        // Keep on screen
        if (x + Bounds.Width > screenBounds.Right)
            x = mousePos.X - Bounds.Width - 8;
        if (y + Bounds.Height > screenBounds.Bottom)
            y = mousePos.Y - Bounds.Height - 8;
        
        Canvas.SetLeft(this, x);
        Canvas.SetTop(this, y);
    }
}
```

### Attached Property Usage

```xml
<!-- Simple tooltip via attached property -->
<Button Content="ğŸ’" 
        local:Tooltip.Text="Toggle Inventory (I)" />

<!-- Rich tooltip via attached property -->
<ItemSlotControl Item="{Binding Item}"
                 local:Tooltip.Item="{Binding Item}" />

<!-- Ability tooltip -->
<AbilityButton Ability="{Binding Ability}"
               local:Tooltip.Ability="{Binding Ability}" />
```

### Acceptance Criteria

- [ ] Tooltips appear after 500ms delay
- [ ] Item tooltips show all stats
- [ ] Ability tooltips show cost/effects
- [ ] Status effect tooltips show duration
- [ ] Simple text tooltips work
- [ ] Tooltips stay on screen
- [ ] Tooltips follow consistent styling
- [ ] Tooltips hide on mouse leave
- [ ] Attached property works for simple tips
- [ ] Tooltips can be disabled in settings
- [ ] ~10 unit tests pass

---

## Dependencies & Prerequisites

```
v0.8.0c (Keyboard Shortcuts) - REQUIRED
    â”‚
    â””â”€â”€ Character & Settings complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                          â”‚
v0.8.1 (Navigation & Information)                                         â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.8.1a: Map View Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: Room connections, exploration state             â”‚
    â”‚       Provides: MapViewPanel, RoomNodeControl                       â”‚
    â”‚                                                                     â”‚
    â”œâ”€â”€ v0.8.1b: Quest Log Window â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚       Dependencies: QuestService, v0.8.1a (map icons)               â”‚
    â”‚       Provides: QuestLogWindow, QuestEntryControl                   â”‚
    â”‚                                                                     â”‚
    â””â”€â”€ v0.8.0c: Tooltip Service â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            Dependencies: Item/Ability data, v0.8.1b (quest tips optional)
            Provides: ITooltipService, TooltipControl
```

---

## Estimated Effort Summary

| Part | New Files | Modified Files | Est. Tests | Complexity |
|------|-----------|----------------|------------|------------|
| v0.8.1a | ~5 | ~2 | ~12 | Medium-High |
| v0.8.1b | ~5 | ~1 | ~13 | Medium |
| v0.8.0c | ~4 | ~3 | ~10 | Medium |
| **Total** | **~14** | **~6** | **~35** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Map layout complexity | Medium | Medium | Use grid/force-directed layout |
| Quest real-time updates | Low | Low | Event-based refresh |
| Tooltip positioning edge cases | Low | Medium | Boundary checking |
| Performance with many rooms | Low | Low | Limit visible area, virtualize |

---

## Design Decisions (Confirmed)

### Map View

| Decision | Value | Notes |
|----------|-------|-------|
| **Room Shape** | Rectangles | Simple, clear |
| **Connection Lines** | Straight | With locked indicator |
| **Unexplored** | "???" text | Mystery preserved |
| **Current Room** | Gold highlight | Clear visibility |

### Quest Log

| Decision | Value | Notes |
|----------|-------|-------|
| **Layout** | List + Details | Master-detail pattern |
| **Tracking** | Single quest | HUD display |
| **Progress** | Percentage + bar | Visual feedback |

### Tooltips

| Decision | Value | Notes |
|----------|-------|-------|
| **Delay** | 500ms (configurable) | Standard UX |
| **Position** | Auto (near cursor) | Stay on screen |
| **Style** | Dark with border | Consistent look |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.8.1a Design Spec** - Create detailed design for Map View Panel
3. **v0.8.1a Implementation** - Build map visualization
4. **v0.8.1b Design Spec** - Create specification for Quest Log Window
5. **v0.8.1b Implementation** - Build quest tracking UI
6. **v0.8.0c Design Spec** - Create specification for Tooltip Service
7. **v0.8.0c Implementation** - Build tooltip system

---

*This scope breakdown provides a structured approach to implementing v0.8.1 Navigation & Information. The map view aids exploration, quest log tracks progress, and tooltips provide contextual information throughout the GUI.*
