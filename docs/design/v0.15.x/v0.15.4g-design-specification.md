# v0.15.4g Design Specification: Improvised Tool Crafting System

**Version:** 0.15.4g
**Theme:** Improvised Tool Crafting (Component-Based Field Fabrication)
**Author:** Claude
**Created:** 2026-01-17
**Status:** Draft
**Prerequisites:** v0.15.0 Complete (Dice Pool Refactor), v0.15.1 Complete (Skill Infrastructure), v0.15.4a Complete (Lockpicking System), v0.15.4b Complete (Terminal Hacking System), v0.15.4c Complete (ICE Countermeasures), v0.15.4d Complete (Trap Disarmament System), v0.15.4e Complete (Jury-Rigging System), v0.15.4f Complete (Glitch Exploitation System)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [ImprovisedTool Value Object](#4-improvisedtool-value-object)
5. [ToolRecipe Value Object](#5-toolrecipe-value-object)
6. [CraftingComponent Value Object](#6-craftingcomponent-value-object)
7. [ImprovisedToolCraftingService](#7-improvisedtoolcraftingservice-implementation)
8. [Tool Usage Mechanics](#8-tool-usage-mechanics)
9. [Component Acquisition](#9-component-acquisition)
10. [Data Model Changes](#10-data-model-changes)
11. [Configuration Files](#11-configuration-files)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

The Improvised Tool Crafting System enables characters to create bypass tools from salvaged components found during exploration. In Aethelgard's post-apocalyptic world, proper tools are rare and precious—survivors must often improvise, cobbling together functional equipment from salvaged springs, wires, and circuit fragments.

This phase implements the crafting recipes, component requirements, and tool bonuses that integrate with all previous v0.15.4 bypass systems. Characters who successfully salvage components from locks, traps, and terminals can transform those materials into specialized tools that provide dice pool bonuses.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Value Objects** | `ImprovisedTool`, `ToolRecipe`, `CraftingComponent` |
| **Services** | `ImprovisedToolCraftingService` |
| **Configuration** | `improvised-tools.json`, `crafting-components.json` |
| **Tests** | ~2 new unit tests |

### 1.3 Architectural Significance

This version establishes the **Field Fabrication Pattern** that reflects Aethelgard's scarcity and resourcefulness themes:

- **Component Scavenging**: Valuable materials come from critical successes on bypass checks
- **Recipe Knowledge**: Characters learn to combine components in useful ways
- **Tool Specialization**: Each improvised tool aids specific bypass types
- **Cargo Cult Crafting**: Characters follow learned patterns without true understanding

---

## 2. Feature Overview

```
v0.15.4g Improvised Tool Crafting System
├── ImprovisedTool Value Object
│   ├── ToolId (unique identifier)
│   ├── ToolName (display name)
│   ├── ComponentsRequired (list of components)
│   ├── CraftDc (difficulty to create)
│   └── BonusWhenUsed (dice pool modifier)
├── Craftable Tools
│   ├── Shim Picks (+1d10 to locks)
│   ├── Wire Probe (+1d10 to terminals)
│   ├── Glitch Trigger (force glitch state)
│   └── Bypass Clamps (skip one layer)
├── Component System
│   ├── Salvage from critical successes
│   ├── Component types (metal, wire, circuit)
│   └── Component quality (standard, rare)
└── Crafting Procedure
    ├── Component verification
    ├── Craft check (WITS or FINESSE)
    ├── Success: Tool created
    └── Failure: Components lost
```

---

## 3. Architecture Diagrams

### 3.1 Improvised Tool Crafting Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    IMPROVISED TOOL CRAFTING FLOW                             │
└─────────────────────────────────────────────────────────────────────────────┘

    Character acquires components from salvage
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 1: CHECK COMPONENTS                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  Query inventory for required components                                     │
│                                                                              │
│  Shim Picks requires:     Wire Probe requires:                              │
│  ┌─────────────────┐      ┌─────────────────┐                               │
│  │ [Scrap Metal]×3 │      │ [Copper Wire]×2 │                               │
│  │                 │      │ [Handle]×1      │                               │
│  └─────────────────┘      └─────────────────┘                               │
│                                                                              │
│  Glitch Trigger requires: Bypass Clamps requires:                           │
│  ┌─────────────────┐      ┌─────────────────┐                               │
│  │ [Capacitor]×1   │      │ [Metal Clips]×4 │                               │
│  │ [Wire]×4        │      │                 │                               │
│  └─────────────────┘      └─────────────────┘                               │
│                                                                              │
│  ┌─────────────────────┐   ┌─────────────────────┐                          │
│  │ COMPONENTS MET      │   │ COMPONENTS MISSING  │                          │
│  │ Proceed to crafting │   │ Cannot craft        │                          │
│  └──────────┬──────────┘   └──────────┬──────────┘                          │
└─────────────┼──────────────────────────┼────────────────────────────────────┘
              │                          │
              │                          ▼
              │              ┌─────────────────────┐
              │              │ "You lack:          │
              │              │ - [Copper Wire]×1   │
              │              │ Search for more     │
              │              │ components."        │
              │              └─────────────────────┘
              │
              ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 2: CRAFTING ATTEMPT                                │
├─────────────────────────────────────────────────────────────────────────────┤
│  Roll higher of WITS or FINESSE vs. Craft DC                                │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │ Tool              │ Craft DC │ Attribute                             │  │
│  ├───────────────────┼──────────┼───────────────────────────────────────┤  │
│  │ Shim Picks        │ 10       │ Higher of WITS/FINESSE                │  │
│  │ Wire Probe        │ 12       │ Higher of WITS/FINESSE                │  │
│  │ Glitch Trigger    │ 14       │ WITS (understanding circuits)         │  │
│  │ Bypass Clamps     │ 12       │ FINESSE (precise metalwork)           │  │
│  └───────────────────┴──────────┴───────────────────────────────────────┘  │
│                                                                              │
│  Modifiers:                                                                  │
│  + Has [Tinker's Toolkit]: +1d10                                            │
│  + Has workshop access: +2d10                                               │
│  - In hostile environment: -1d10                                            │
│  - Under time pressure: -1d10                                               │
└─────────────────────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 3: CRAFTING RESULT                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐                │
│  │ CRITICAL        │ │ SUCCESS         │ │ FAILURE         │                │
│  │ (Net ≥5)        │ │ (Net >0)        │ │ (Net ≤0)        │                │
│  ├─────────────────┤ ├─────────────────┤ ├─────────────────┤                │
│  │ Tool created    │ │ Tool created    │ │ Components      │                │
│  │ Components used │ │ Components used │ │ CONSUMED        │                │
│  │ BONUS: Quality  │ │                 │ │ No tool         │                │
│  │ upgrade!        │ │                 │ │ produced        │                │
│  │                 │ │                 │ │                 │                │
│  │ Tool grants     │ │ Tool grants     │ │ "The components │                │
│  │ +2d10 instead   │ │ normal bonus    │ │ break in your   │                │
│  │ of +1d10        │ │ (+1d10)         │ │ hands..."       │                │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘                │
│                                                                              │
│  Special: FUMBLE (0 successes, ≥1 botch)                                    │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Components destroyed + character takes 1d6 damage (sparks, cuts)        ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Tool Usage in Bypass Systems

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    IMPROVISED TOOL INTEGRATION                               │
└─────────────────────────────────────────────────────────────────────────────┘

    Character attempts bypass with improvised tool
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      TOOL APPLICABILITY CHECK                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────┬────────────────────────────────────────────────────┐  │
│  │ Tool             │ Applicable To                                      │  │
│  ├──────────────────┼────────────────────────────────────────────────────┤  │
│  │ Shim Picks       │ Lockpicking (v0.15.4a)                             │  │
│  │ Wire Probe       │ Terminal Hacking (v0.15.4b)                        │  │
│  │ Glitch Trigger   │ Glitch Exploitation (v0.15.4f)                     │  │
│  │ Bypass Clamps    │ Terminal Hacking Layer Skip (v0.15.4b)             │  │
│  └──────────────────┴────────────────────────────────────────────────────┘  │
│                                                                              │
│  If tool matches bypass type:                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Apply tool bonus to dice pool                                        │   │
│  │                                                                       │   │
│  │ Standard: +1d10 to pool                                               │   │
│  │ Quality (from crit craft): +2d10 to pool                              │   │
│  │                                                                       │   │
│  │ Special Tools:                                                        │   │
│  │ - Glitch Trigger: Force mechanism into [Glitched] state              │   │
│  │ - Bypass Clamps: Skip Layer 1 of terminal infiltration               │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  Tool Durability:                                                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ Improvised tools degrade with use:                                    │   │
│  │ - Standard tool: 3 uses before breaking                               │   │
│  │ - Quality tool: 5 uses before breaking                                │   │
│  │ - Fumble on bypass: Tool breaks immediately                           │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PRESENTATION LAYER                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│  ConsoleInputHandler          IGameRenderer                                  │
│  - ParseCraftCommand()        - RenderCraftingAttemptAsync()                │
│  - ParseUseToolCommand()      - RenderCraftingResultAsync()                 │
│                               - RenderToolInventoryAsync()                   │
│                               - RenderMissingComponentsAsync()               │
└─────────────────────────────────────────────────────────────────────────────┘
                │                              ▲
                ▼                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                           APPLICATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  GameEngine                                                                  │
│  - HandleCraftToolAsync()                                                   │
│  - HandleUseToolAsync()                                                     │
│  - GetAvailableRecipes()                                                    │
│  - GetToolInventory()                                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                │                              ▲
                ▼                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN SERVICES                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ ImprovisedToolCraftingService                                        │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ + GetAvailableRecipes() → IEnumerable<ToolRecipe>                   │   │
│  │ + CanCraft(recipe, inventory) → ComponentCheckResult                │   │
│  │ + AttemptCraft(character, recipe, diceRoller) → CraftResult         │   │
│  │ + GetToolBonus(tool, bypassType) → int                              │   │
│  │ + ApplyToolToBypass(tool, context) → ModifiedContext                │   │
│  │ + UseTool(tool) → ToolUsageResult                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  Integration with Bypass Services:                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ LockpickingService.AttemptPick():                                    │   │
│  │   if (hasTool("Shim Picks"))                                         │   │
│  │     dicePool += _craftingService.GetToolBonus(tool, BypassType.Lock);│   │
│  │                                                                       │   │
│  │ TerminalHackingService.AttemptInfiltration():                        │   │
│  │   if (hasTool("Bypass Clamps"))                                      │   │
│  │     currentLayer = 2; // Skip Layer 1                                │   │
│  │                                                                       │   │
│  │ GlitchExploitationService.AttemptExploit():                          │   │
│  │   if (hasTool("Glitch Trigger") && !mechanism.IsGlitched)            │   │
│  │     mechanism = mechanism.ForceGlitchState();                        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                │                              ▲
                ▼                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN VALUE OBJECTS                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  ImprovisedTool           ToolRecipe              CraftingComponent         │
│  - ToolId                 - RecipeId              - ComponentId             │
│  - ToolName               - ToolName              - ComponentName           │
│  - ToolType               - Description           - ComponentType           │
│  - BonusAmount            - Components            - Quantity                │
│  - UsesRemaining          - CraftDc               - Source                  │
│  - IsQuality              - RequiredAttribute                               │
│                           - ResultingTool                                    │
│                                                                              │
│  CraftResult              ComponentCheckResult    ToolUsageResult           │
│  - Success                - CanCraft              - ToolUsed                │
│  - IsCritical             - MissingComponents     - UsesRemaining           │
│  - IsFumble               - ExcessComponents      - ToolBroken              │
│  - ToolCreated                                    - NarrativeText           │
│  - ComponentsConsumed                                                       │
│  - Damage (if fumble)                                                       │
│  - NarrativeText                                                            │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. ImprovisedTool Value Object

### 4.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ImprovisedTool.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents an improvised tool crafted from salvaged components.
/// These tools provide bonuses to specific bypass operations.
/// </summary>
/// <remarks>
/// Improvised tools are fragile compared to proper equipment. They have
/// limited uses before breaking and can be destroyed prematurely on fumbles.
/// Quality tools (from critical crafting) have better durability and bonuses.
/// </remarks>
/// <param name="ToolId">Unique identifier for this tool instance.</param>
/// <param name="ToolName">Display name of the tool.</param>
/// <param name="ToolType">Classification determining what bypass types it aids.</param>
/// <param name="BonusAmount">Dice pool bonus when used (typically 1d10 or 2d10).</param>
/// <param name="UsesRemaining">Number of uses before the tool breaks.</param>
/// <param name="IsQuality">True if crafted with a critical success (better stats).</param>
/// <param name="SpecialEffect">Optional special effect (e.g., "Force Glitch State").</param>
public readonly record struct ImprovisedTool(
    string ToolId,
    string ToolName,
    ImprovisedToolType ToolType,
    int BonusAmount,
    int UsesRemaining,
    bool IsQuality,
    string? SpecialEffect = null)
{
    /// <summary>
    /// Standard tool durability (uses before breaking).
    /// </summary>
    public const int StandardDurability = 3;

    /// <summary>
    /// Quality tool durability (uses before breaking).
    /// </summary>
    public const int QualityDurability = 5;

    /// <summary>
    /// Standard dice bonus for improvised tools.
    /// </summary>
    public const int StandardBonus = 1;

    /// <summary>
    /// Enhanced dice bonus for quality improvised tools.
    /// </summary>
    public const int QualityBonus = 2;

    /// <summary>
    /// Gets whether this tool is still usable.
    /// </summary>
    public bool IsUsable => UsesRemaining > 0;

    /// <summary>
    /// Gets a description of the tool's current condition.
    /// </summary>
    public string Condition => UsesRemaining switch
    {
        0 => "Broken",
        1 => "Nearly broken",
        2 => "Worn",
        _ => IsQuality ? "Good condition (Quality)" : "Serviceable"
    };

    /// <summary>
    /// Gets the bypass type this tool assists with.
    /// </summary>
    public BypassType AssistsWithBypassType => ToolType switch
    {
        ImprovisedToolType.ShimPicks => BypassType.Lockpicking,
        ImprovisedToolType.WireProbe => BypassType.TerminalHacking,
        ImprovisedToolType.GlitchTrigger => BypassType.GlitchExploitation,
        ImprovisedToolType.BypassClamps => BypassType.TerminalHacking,
        _ => BypassType.None
    };

    /// <summary>
    /// Gets whether this tool has a special effect beyond dice bonus.
    /// </summary>
    public bool HasSpecialEffect => !string.IsNullOrEmpty(SpecialEffect);

    /// <summary>
    /// Creates a standard Shim Picks tool.
    /// </summary>
    /// <param name="isQuality">True if crafted with critical success.</param>
    /// <returns>A new Shim Picks tool.</returns>
    public static ImprovisedTool CreateShimPicks(bool isQuality = false)
    {
        return new ImprovisedTool(
            ToolId: Guid.NewGuid().ToString(),
            ToolName: isQuality ? "Quality Shim Picks" : "Shim Picks",
            ToolType: ImprovisedToolType.ShimPicks,
            BonusAmount: isQuality ? QualityBonus : StandardBonus,
            UsesRemaining: isQuality ? QualityDurability : StandardDurability,
            IsQuality: isQuality,
            SpecialEffect: null);
    }

    /// <summary>
    /// Creates a standard Wire Probe tool.
    /// </summary>
    /// <param name="isQuality">True if crafted with critical success.</param>
    /// <returns>A new Wire Probe tool.</returns>
    public static ImprovisedTool CreateWireProbe(bool isQuality = false)
    {
        return new ImprovisedTool(
            ToolId: Guid.NewGuid().ToString(),
            ToolName: isQuality ? "Quality Wire Probe" : "Wire Probe",
            ToolType: ImprovisedToolType.WireProbe,
            BonusAmount: isQuality ? QualityBonus : StandardBonus,
            UsesRemaining: isQuality ? QualityDurability : StandardDurability,
            IsQuality: isQuality,
            SpecialEffect: null);
    }

    /// <summary>
    /// Creates a Glitch Trigger tool.
    /// </summary>
    /// <param name="isQuality">True if crafted with critical success.</param>
    /// <returns>A new Glitch Trigger tool.</returns>
    public static ImprovisedTool CreateGlitchTrigger(bool isQuality = false)
    {
        return new ImprovisedTool(
            ToolId: Guid.NewGuid().ToString(),
            ToolName: isQuality ? "Quality Glitch Trigger" : "Glitch Trigger",
            ToolType: ImprovisedToolType.GlitchTrigger,
            BonusAmount: isQuality ? QualityBonus : StandardBonus,
            UsesRemaining: isQuality ? QualityDurability : StandardDurability,
            IsQuality: isQuality,
            SpecialEffect: "Force mechanism into [Glitched] state");
    }

    /// <summary>
    /// Creates a Bypass Clamps tool.
    /// </summary>
    /// <param name="isQuality">True if crafted with critical success.</param>
    /// <returns>A new Bypass Clamps tool.</returns>
    public static ImprovisedTool CreateBypassClamps(bool isQuality = false)
    {
        return new ImprovisedTool(
            ToolId: Guid.NewGuid().ToString(),
            ToolName: isQuality ? "Quality Bypass Clamps" : "Bypass Clamps",
            ToolType: ImprovisedToolType.BypassClamps,
            BonusAmount: isQuality ? QualityBonus : StandardBonus,
            UsesRemaining: isQuality ? QualityDurability : StandardDurability,
            IsQuality: isQuality,
            SpecialEffect: "Skip Layer 1 of terminal infiltration");
    }

    /// <summary>
    /// Consumes one use of the tool.
    /// </summary>
    /// <returns>A new tool with decremented uses, or null if broken.</returns>
    public ImprovisedTool? UseOnce()
    {
        if (UsesRemaining <= 1)
            return null; // Tool breaks

        return this with { UsesRemaining = UsesRemaining - 1 };
    }

    /// <summary>
    /// Forces the tool to break (e.g., from a fumble).
    /// </summary>
    /// <returns>A broken tool with 0 uses.</returns>
    public ImprovisedTool Break()
    {
        return this with { UsesRemaining = 0 };
    }

    /// <summary>
    /// Creates a display string for the tool.
    /// </summary>
    public string ToDisplayString()
    {
        var lines = new List<string>
        {
            $"[{ToolName}]",
            $"Type: {ToolType}",
            $"Bonus: +{BonusAmount}d10 to {AssistsWithBypassType}",
            $"Uses: {UsesRemaining}/{(IsQuality ? QualityDurability : StandardDurability)}",
            $"Condition: {Condition}"
        };

        if (HasSpecialEffect)
            lines.Add($"Special: {SpecialEffect}");

        return string.Join(Environment.NewLine, lines);
    }
}

/// <summary>
/// Classification of improvised tools by their function.
/// </summary>
public enum ImprovisedToolType
{
    /// <summary>Aids lockpicking attempts (+1d10 to locks).</summary>
    ShimPicks,

    /// <summary>Aids terminal hacking attempts (+1d10 to terminals).</summary>
    WireProbe,

    /// <summary>Forces glitched state on mechanisms.</summary>
    GlitchTrigger,

    /// <summary>Skips Layer 1 of terminal infiltration.</summary>
    BypassClamps
}

/// <summary>
/// Types of bypass operations that tools can assist with.
/// </summary>
public enum BypassType
{
    /// <summary>No specific bypass type.</summary>
    None,

    /// <summary>Lock manipulation (v0.15.4a).</summary>
    Lockpicking,

    /// <summary>Terminal infiltration (v0.15.4b).</summary>
    TerminalHacking,

    /// <summary>Trap neutralization (v0.15.4d).</summary>
    TrapDisarmament,

    /// <summary>Corrupted technology exploitation (v0.15.4f).</summary>
    GlitchExploitation
}
```

---

## 5. ToolRecipe Value Object

### 5.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ToolRecipe.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Defines the requirements for crafting an improvised tool.
/// Recipes specify components needed, crafting difficulty, and the resulting tool.
/// </summary>
/// <param name="RecipeId">Unique identifier for the recipe.</param>
/// <param name="ToolName">Name of the tool this recipe produces.</param>
/// <param name="Description">Flavor description of the crafting process.</param>
/// <param name="RequiredComponents">List of components needed to craft.</param>
/// <param name="CraftDc">Difficulty class for the crafting check.</param>
/// <param name="RequiredAttribute">Primary attribute for the crafting check.</param>
/// <param name="ResultingToolType">The type of tool produced.</param>
public readonly record struct ToolRecipe(
    string RecipeId,
    string ToolName,
    string Description,
    IReadOnlyList<ComponentRequirement> RequiredComponents,
    int CraftDc,
    CraftingAttribute RequiredAttribute,
    ImprovisedToolType ResultingToolType)
{
    /// <summary>
    /// Creates the Shim Picks recipe.
    /// </summary>
    public static ToolRecipe ShimPicks => new(
        RecipeId: "recipe_shim_picks",
        ToolName: "Shim Picks",
        Description: "Bend scrap metal into thin shims that slip between lock pins, " +
                    "allowing manipulation without proper lockpicks.",
        RequiredComponents: new List<ComponentRequirement>
        {
            new("Scrap Metal", ComponentType.Metal, 3)
        }.AsReadOnly(),
        CraftDc: 10,
        RequiredAttribute: CraftingAttribute.WitsOrFinesse,
        ResultingToolType: ImprovisedToolType.ShimPicks);

    /// <summary>
    /// Creates the Wire Probe recipe.
    /// </summary>
    public static ToolRecipe WireProbe => new(
        RecipeId: "recipe_wire_probe",
        ToolName: "Wire Probe",
        Description: "A carefully wrapped probe of copper wire attached to an insulated " +
                    "handle, used to manipulate exposed terminal circuits.",
        RequiredComponents: new List<ComponentRequirement>
        {
            new("Copper Wire", ComponentType.Wire, 2),
            new("Handle", ComponentType.Misc, 1)
        }.AsReadOnly(),
        CraftDc: 12,
        RequiredAttribute: CraftingAttribute.WitsOrFinesse,
        ResultingToolType: ImprovisedToolType.WireProbe);

    /// <summary>
    /// Creates the Glitch Trigger recipe.
    /// </summary>
    public static ToolRecipe GlitchTrigger => new(
        RecipeId: "recipe_glitch_trigger",
        ToolName: "Glitch Trigger",
        Description: "A crude device that emits an electromagnetic pulse pattern " +
                    "known to induce glitched states in Old World machinery.",
        RequiredComponents: new List<ComponentRequirement>
        {
            new("Capacitor", ComponentType.Circuit, 1),
            new("Wire", ComponentType.Wire, 4)
        }.AsReadOnly(),
        CraftDc: 14,
        RequiredAttribute: CraftingAttribute.Wits,
        ResultingToolType: ImprovisedToolType.GlitchTrigger);

    /// <summary>
    /// Creates the Bypass Clamps recipe.
    /// </summary>
    public static ToolRecipe BypassClamps => new(
        RecipeId: "recipe_bypass_clamps",
        ToolName: "Bypass Clamps",
        Description: "Spring-loaded metal clips that physically bypass the outer " +
                    "access layer of a terminal, connecting directly to inner circuits.",
        RequiredComponents: new List<ComponentRequirement>
        {
            new("Metal Clips", ComponentType.Metal, 4)
        }.AsReadOnly(),
        CraftDc: 12,
        RequiredAttribute: CraftingAttribute.Finesse,
        ResultingToolType: ImprovisedToolType.BypassClamps);

    /// <summary>
    /// Gets all available standard recipes.
    /// </summary>
    public static IReadOnlyList<ToolRecipe> AllRecipes => new List<ToolRecipe>
    {
        ShimPicks,
        WireProbe,
        GlitchTrigger,
        BypassClamps
    }.AsReadOnly();

    /// <summary>
    /// Gets the total component count required.
    /// </summary>
    public int TotalComponentsRequired => RequiredComponents.Sum(c => c.Quantity);

    /// <summary>
    /// Creates a display string for the recipe.
    /// </summary>
    public string ToDisplayString()
    {
        var componentList = string.Join(", ",
            RequiredComponents.Select(c => $"{c.ComponentName} ×{c.Quantity}"));

        return $"""
            [{ToolName}] (DC {CraftDc}, {RequiredAttribute})
            Components: {componentList}
            {Description}
            """;
    }
}

/// <summary>
/// Specifies a single component requirement for a recipe.
/// </summary>
/// <param name="ComponentName">Display name of the component.</param>
/// <param name="ComponentType">Type classification of the component.</param>
/// <param name="Quantity">Number of this component needed.</param>
public readonly record struct ComponentRequirement(
    string ComponentName,
    ComponentType ComponentType,
    int Quantity);

/// <summary>
/// Attribute options for crafting checks.
/// </summary>
public enum CraftingAttribute
{
    /// <summary>Use WITS for understanding complex mechanisms.</summary>
    Wits,

    /// <summary>Use FINESSE for precise manipulation.</summary>
    Finesse,

    /// <summary>Use the higher of WITS or FINESSE.</summary>
    WitsOrFinesse
}
```

---

## 6. CraftingComponent Value Object

### 6.1 Value Object Definition

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/CraftingComponent.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a salvaged component that can be used in crafting improvised tools.
/// Components are acquired through critical successes on bypass checks.
/// </summary>
/// <param name="ComponentId">Unique identifier for this component instance.</param>
/// <param name="ComponentName">Display name of the component.</param>
/// <param name="ComponentType">Type classification (Metal, Wire, Circuit, Misc).</param>
/// <param name="SourceDescription">Where this component was salvaged from.</param>
/// <param name="IsRare">True if this is a rare/valuable component.</param>
public readonly record struct CraftingComponent(
    string ComponentId,
    string ComponentName,
    ComponentType ComponentType,
    string SourceDescription,
    bool IsRare = false)
{
    /// <summary>
    /// Creates a Scrap Metal component.
    /// </summary>
    public static CraftingComponent CreateScrapMetal(string source = "salvaged mechanism")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Scrap Metal",
            ComponentType: ComponentType.Metal,
            SourceDescription: source);
    }

    /// <summary>
    /// Creates a Metal Clips component.
    /// </summary>
    public static CraftingComponent CreateMetalClips(string source = "salvaged mechanism")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Metal Clips",
            ComponentType: ComponentType.Metal,
            SourceDescription: source);
    }

    /// <summary>
    /// Creates a Copper Wire component.
    /// </summary>
    public static CraftingComponent CreateCopperWire(string source = "salvaged mechanism")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Copper Wire",
            ComponentType: ComponentType.Wire,
            SourceDescription: source);
    }

    /// <summary>
    /// Creates a generic Wire component.
    /// </summary>
    public static CraftingComponent CreateWire(string source = "salvaged mechanism")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Wire",
            ComponentType: ComponentType.Wire,
            SourceDescription: source);
    }

    /// <summary>
    /// Creates a Capacitor component.
    /// </summary>
    public static CraftingComponent CreateCapacitor(string source = "salvaged mechanism")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Capacitor",
            ComponentType: ComponentType.Circuit,
            SourceDescription: source,
            IsRare: true);
    }

    /// <summary>
    /// Creates a Handle component.
    /// </summary>
    public static CraftingComponent CreateHandle(string source = "salvaged mechanism")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Handle",
            ComponentType: ComponentType.Misc,
            SourceDescription: source);
    }

    /// <summary>
    /// Creates a High-Tension Spring component.
    /// </summary>
    public static CraftingComponent CreateHighTensionSpring(string source = "salvaged lock")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "High-Tension Spring",
            ComponentType: ComponentType.Metal,
            SourceDescription: source);
    }

    /// <summary>
    /// Creates a Circuit Fragment component.
    /// </summary>
    public static CraftingComponent CreateCircuitFragment(string source = "salvaged terminal")
    {
        return new CraftingComponent(
            ComponentId: Guid.NewGuid().ToString(),
            ComponentName: "Circuit Fragment",
            ComponentType: ComponentType.Circuit,
            SourceDescription: source);
    }

    /// <summary>
    /// Gets whether this component can substitute for the given type.
    /// </summary>
    public bool CanSubstituteFor(ComponentType required)
    {
        // Some components are interchangeable
        return ComponentType == required ||
               (ComponentType == ComponentType.Metal && required == ComponentType.Misc);
    }

    /// <summary>
    /// Creates a display string for the component.
    /// </summary>
    public string ToDisplayString()
    {
        var rareTag = IsRare ? " [Rare]" : "";
        return $"[{ComponentName}]{rareTag} - {SourceDescription}";
    }
}

/// <summary>
/// Type classification for crafting components.
/// </summary>
public enum ComponentType
{
    /// <summary>Metal scraps, clips, springs (from locks, structures).</summary>
    Metal,

    /// <summary>Wire, cables, filaments (from electronics, traps).</summary>
    Wire,

    /// <summary>Circuit boards, capacitors, chips (from terminals, devices).</summary>
    Circuit,

    /// <summary>Miscellaneous parts (handles, casings, etc.).</summary>
    Misc
}
```

---

## 7. ImprovisedToolCraftingService Implementation

### 7.1 Service Interface

**File:** `src/Core/RuneAndRust.Domain/Interfaces/IImprovisedToolCraftingService.cs`

```csharp
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.Interfaces;

/// <summary>
/// Service interface for the improvised tool crafting system.
/// Handles recipe lookup, component validation, and crafting attempts.
/// </summary>
public interface IImprovisedToolCraftingService
{
    /// <summary>
    /// Gets all available tool recipes.
    /// </summary>
    /// <returns>Collection of craftable tool recipes.</returns>
    IReadOnlyList<ToolRecipe> GetAvailableRecipes();

    /// <summary>
    /// Checks if a character has the components to craft a recipe.
    /// </summary>
    /// <param name="recipe">The recipe to check.</param>
    /// <param name="inventory">The character's component inventory.</param>
    /// <returns>Result indicating if crafting is possible and what's missing.</returns>
    ComponentCheckResult CanCraft(ToolRecipe recipe, IReadOnlyList<CraftingComponent> inventory);

    /// <summary>
    /// Attempts to craft an improvised tool.
    /// </summary>
    /// <param name="character">Character attempting to craft.</param>
    /// <param name="recipe">Recipe being crafted.</param>
    /// <param name="inventory">Available components.</param>
    /// <param name="diceRoller">Dice rolling service.</param>
    /// <returns>Result of the crafting attempt.</returns>
    CraftResult AttemptCraft(
        CharacterCraftingContext character,
        ToolRecipe recipe,
        IReadOnlyList<CraftingComponent> inventory,
        IDiceRoller diceRoller);

    /// <summary>
    /// Gets the dice pool bonus for using a tool on a specific bypass type.
    /// </summary>
    /// <param name="tool">The improvised tool.</param>
    /// <param name="bypassType">The type of bypass being attempted.</param>
    /// <returns>Dice pool bonus (0 if tool doesn't apply).</returns>
    int GetToolBonus(ImprovisedTool tool, BypassType bypassType);

    /// <summary>
    /// Applies a tool to a bypass context, modifying dice pool and consuming a use.
    /// </summary>
    /// <param name="tool">The tool being used.</param>
    /// <param name="bypassType">The type of bypass.</param>
    /// <returns>Result including modified tool (or null if broken).</returns>
    ToolUsageResult UseTool(ImprovisedTool tool, BypassType bypassType);

    /// <summary>
    /// Gets components that would be salvaged from a critical success on bypass.
    /// </summary>
    /// <param name="bypassType">Type of bypass that critically succeeded.</param>
    /// <param name="mechanismType">Type of mechanism bypassed.</param>
    /// <param name="diceRoller">For random component selection.</param>
    /// <returns>List of salvaged components.</returns>
    IReadOnlyList<CraftingComponent> GetSalvageFromCritical(
        BypassType bypassType,
        string mechanismType,
        IDiceRoller diceRoller);
}

/// <summary>
/// Character context for crafting checks.
/// </summary>
/// <param name="Wits">Character's WITS attribute.</param>
/// <param name="Finesse">Character's FINESSE attribute.</param>
/// <param name="HasTinkersToolkit">True if character has [Tinker's Toolkit].</param>
/// <param name="HasWorkshopAccess">True if in a proper workshop.</param>
/// <param name="IsUnderPressure">True if time pressure or hostile environment.</param>
public readonly record struct CharacterCraftingContext(
    int Wits,
    int Finesse,
    bool HasTinkersToolkit,
    bool HasWorkshopAccess,
    bool IsUnderPressure);

/// <summary>
/// Result of checking if a recipe can be crafted.
/// </summary>
/// <param name="CanCraft">True if all components are available.</param>
/// <param name="MissingComponents">List of missing components with quantities.</param>
/// <param name="MatchedComponents">Components from inventory that will be used.</param>
public readonly record struct ComponentCheckResult(
    bool CanCraft,
    IReadOnlyList<ComponentRequirement> MissingComponents,
    IReadOnlyList<CraftingComponent> MatchedComponents);

/// <summary>
/// Result of a crafting attempt.
/// </summary>
/// <param name="Success">True if crafting succeeded.</param>
/// <param name="IsCritical">True if crafting critically succeeded (quality tool).</param>
/// <param name="IsFumble">True if crafting fumbled (damage + components lost).</param>
/// <param name="ToolCreated">The created tool (null if failed).</param>
/// <param name="ComponentsConsumed">Components that were used/lost.</param>
/// <param name="FumbleDamage">Damage taken on fumble (0 otherwise).</param>
/// <param name="NarrativeText">Descriptive text for the result.</param>
public readonly record struct CraftResult(
    bool Success,
    bool IsCritical,
    bool IsFumble,
    ImprovisedTool? ToolCreated,
    IReadOnlyList<CraftingComponent> ComponentsConsumed,
    int FumbleDamage,
    string NarrativeText);

/// <summary>
/// Result of using an improvised tool.
/// </summary>
/// <param name="BonusApplied">The dice pool bonus that was applied.</param>
/// <param name="SpecialEffectTriggered">True if special effect activated.</param>
/// <param name="SpecialEffectDescription">Description of special effect (if any).</param>
/// <param name="ModifiedTool">The tool after use (null if broken).</param>
/// <param name="ToolBroke">True if the tool broke from this use.</param>
/// <param name="NarrativeText">Descriptive text.</param>
public readonly record struct ToolUsageResult(
    int BonusApplied,
    bool SpecialEffectTriggered,
    string? SpecialEffectDescription,
    ImprovisedTool? ModifiedTool,
    bool ToolBroke,
    string NarrativeText);
```

### 7.2 Service Implementation

**File:** `src/Core/RuneAndRust.Domain/Services/ImprovisedToolCraftingService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Domain.Interfaces;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Domain.Services;

/// <summary>
/// Implements the improvised tool crafting system.
/// Enables characters to create bypass tools from salvaged components.
/// </summary>
public class ImprovisedToolCraftingService : IImprovisedToolCraftingService
{
    private readonly ILogger<ImprovisedToolCraftingService> _logger;

    /// <summary>
    /// Dice pool bonus for having [Tinker's Toolkit].
    /// </summary>
    private const int TinkersToolkitBonus = 1;

    /// <summary>
    /// Dice pool bonus for workshop access.
    /// </summary>
    private const int WorkshopBonus = 2;

    /// <summary>
    /// Dice pool penalty for being under pressure.
    /// </summary>
    private const int PressurePenalty = 1;

    /// <summary>
    /// Damage dice on fumble (1d6).
    /// </summary>
    private const int FumbleDamageDice = 6;

    public ImprovisedToolCraftingService(ILogger<ImprovisedToolCraftingService> logger)
    {
        _logger = logger;
    }

    /// <inheritdoc/>
    public IReadOnlyList<ToolRecipe> GetAvailableRecipes()
    {
        return ToolRecipe.AllRecipes;
    }

    /// <inheritdoc/>
    public ComponentCheckResult CanCraft(ToolRecipe recipe, IReadOnlyList<CraftingComponent> inventory)
    {
        var missing = new List<ComponentRequirement>();
        var matched = new List<CraftingComponent>();

        foreach (var requirement in recipe.RequiredComponents)
        {
            var available = inventory
                .Where(c => c.ComponentName == requirement.ComponentName ||
                           (c.ComponentType == requirement.ComponentType &&
                            c.CanSubstituteFor(requirement.ComponentType)))
                .Take(requirement.Quantity)
                .ToList();

            if (available.Count < requirement.Quantity)
            {
                missing.Add(requirement with
                {
                    Quantity = requirement.Quantity - available.Count
                });
            }

            matched.AddRange(available);
        }

        var canCraft = missing.Count == 0;

        _logger.LogDebug(
            "Component check for {Recipe}: CanCraft={CanCraft}, Missing={MissingCount}",
            recipe.ToolName, canCraft, missing.Count);

        return new ComponentCheckResult(canCraft, missing.AsReadOnly(), matched.AsReadOnly());
    }

    /// <inheritdoc/>
    public CraftResult AttemptCraft(
        CharacterCraftingContext character,
        ToolRecipe recipe,
        IReadOnlyList<CraftingComponent> inventory,
        IDiceRoller diceRoller)
    {
        // First check components
        var componentCheck = CanCraft(recipe, inventory);
        if (!componentCheck.CanCraft)
        {
            _logger.LogWarning(
                "Craft attempt failed - missing components for {Recipe}",
                recipe.ToolName);

            return new CraftResult(
                Success: false,
                IsCritical: false,
                IsFumble: false,
                ToolCreated: null,
                ComponentsConsumed: Array.Empty<CraftingComponent>(),
                FumbleDamage: 0,
                NarrativeText: "You lack the required components to craft this tool.");
        }

        // Calculate dice pool
        var attribute = GetCraftingAttribute(character, recipe.RequiredAttribute);
        var dicePool = attribute;

        if (character.HasTinkersToolkit)
            dicePool += TinkersToolkitBonus;
        if (character.HasWorkshopAccess)
            dicePool += WorkshopBonus;
        if (character.IsUnderPressure)
            dicePool -= PressurePenalty;

        dicePool = Math.Max(1, dicePool); // Minimum 1 die

        _logger.LogDebug(
            "Crafting {Recipe}: Attribute={Attribute}, Pool={Pool}, DC={DC}",
            recipe.ToolName, attribute, dicePool, recipe.CraftDc);

        // Roll crafting check
        var rollResult = diceRoller.RollSkillCheck(dicePool, recipe.CraftDc);

        // Handle fumble
        if (rollResult.IsFumble)
        {
            var damage = diceRoller.RollDice(1, FumbleDamageDice);

            _logger.LogInformation(
                "Crafting fumble for {Recipe}: Components lost, {Damage} damage",
                recipe.ToolName, damage);

            return new CraftResult(
                Success: false,
                IsCritical: false,
                IsFumble: true,
                ToolCreated: null,
                ComponentsConsumed: componentCheck.MatchedComponents,
                FumbleDamage: damage,
                NarrativeText: GenerateFumbleNarrative(recipe, damage));
        }

        // Handle failure
        if (rollResult.NetSuccesses <= 0)
        {
            _logger.LogDebug(
                "Crafting failed for {Recipe}: {NetSuccesses} net successes",
                recipe.ToolName, rollResult.NetSuccesses);

            return new CraftResult(
                Success: false,
                IsCritical: false,
                IsFumble: false,
                ToolCreated: null,
                ComponentsConsumed: componentCheck.MatchedComponents,
                FumbleDamage: 0,
                NarrativeText: GenerateFailureNarrative(recipe));
        }

        // Handle success
        var isCritical = rollResult.IsCritical;
        var tool = CreateTool(recipe.ResultingToolType, isCritical);

        _logger.LogInformation(
            "Crafting succeeded for {Recipe}: Critical={Critical}, Tool={Tool}",
            recipe.ToolName, isCritical, tool.ToolName);

        return new CraftResult(
            Success: true,
            IsCritical: isCritical,
            IsFumble: false,
            ToolCreated: tool,
            ComponentsConsumed: componentCheck.MatchedComponents,
            FumbleDamage: 0,
            NarrativeText: GenerateSuccessNarrative(recipe, isCritical, tool));
    }

    /// <inheritdoc/>
    public int GetToolBonus(ImprovisedTool tool, BypassType bypassType)
    {
        if (!tool.IsUsable)
            return 0;

        if (tool.AssistsWithBypassType != bypassType)
            return 0;

        return tool.BonusAmount;
    }

    /// <inheritdoc/>
    public ToolUsageResult UseTool(ImprovisedTool tool, BypassType bypassType)
    {
        if (!tool.IsUsable)
        {
            return new ToolUsageResult(
                BonusApplied: 0,
                SpecialEffectTriggered: false,
                SpecialEffectDescription: null,
                ModifiedTool: null,
                ToolBroke: false,
                NarrativeText: $"The {tool.ToolName} is broken and cannot be used.");
        }

        var bonus = GetToolBonus(tool, bypassType);
        var modifiedTool = tool.UseOnce();
        var broke = modifiedTool == null;

        _logger.LogDebug(
            "Tool used: {Tool}, Bonus={Bonus}, Broke={Broke}, RemainingUses={Uses}",
            tool.ToolName, bonus, broke, modifiedTool?.UsesRemaining ?? 0);

        return new ToolUsageResult(
            BonusApplied: bonus,
            SpecialEffectTriggered: tool.HasSpecialEffect,
            SpecialEffectDescription: tool.SpecialEffect,
            ModifiedTool: modifiedTool,
            ToolBroke: broke,
            NarrativeText: GenerateUsageNarrative(tool, bonus, broke));
    }

    /// <inheritdoc/>
    public IReadOnlyList<CraftingComponent> GetSalvageFromCritical(
        BypassType bypassType,
        string mechanismType,
        IDiceRoller diceRoller)
    {
        var components = new List<CraftingComponent>();
        var source = $"salvaged from {mechanismType}";

        // Determine salvage based on bypass type
        switch (bypassType)
        {
            case BypassType.Lockpicking:
                components.Add(CraftingComponent.CreateHighTensionSpring(source));
                if (diceRoller.RollDice(1, 4) >= 3)
                    components.Add(CraftingComponent.CreateScrapMetal(source));
                break;

            case BypassType.TerminalHacking:
                components.Add(CraftingComponent.CreateCircuitFragment(source));
                components.Add(CraftingComponent.CreateWire(source));
                if (diceRoller.RollDice(1, 6) == 6)
                    components.Add(CraftingComponent.CreateCapacitor(source));
                break;

            case BypassType.TrapDisarmament:
                components.Add(CraftingComponent.CreateWire(source));
                components.Add(CraftingComponent.CreateMetalClips(source));
                break;

            case BypassType.GlitchExploitation:
                components.Add(CraftingComponent.CreateCircuitFragment(source));
                if (diceRoller.RollDice(1, 4) >= 3)
                    components.Add(CraftingComponent.CreateCapacitor(source));
                break;

            default:
                components.Add(CraftingComponent.CreateScrapMetal(source));
                break;
        }

        _logger.LogInformation(
            "Salvage from critical {BypassType} on {Mechanism}: {Count} components",
            bypassType, mechanismType, components.Count);

        return components.AsReadOnly();
    }

    private int GetCraftingAttribute(CharacterCraftingContext character, CraftingAttribute required)
    {
        return required switch
        {
            CraftingAttribute.Wits => character.Wits,
            CraftingAttribute.Finesse => character.Finesse,
            CraftingAttribute.WitsOrFinesse => Math.Max(character.Wits, character.Finesse),
            _ => Math.Max(character.Wits, character.Finesse)
        };
    }

    private ImprovisedTool CreateTool(ImprovisedToolType toolType, bool isQuality)
    {
        return toolType switch
        {
            ImprovisedToolType.ShimPicks => ImprovisedTool.CreateShimPicks(isQuality),
            ImprovisedToolType.WireProbe => ImprovisedTool.CreateWireProbe(isQuality),
            ImprovisedToolType.GlitchTrigger => ImprovisedTool.CreateGlitchTrigger(isQuality),
            ImprovisedToolType.BypassClamps => ImprovisedTool.CreateBypassClamps(isQuality),
            _ => throw new ArgumentOutOfRangeException(nameof(toolType))
        };
    }

    private string GenerateSuccessNarrative(ToolRecipe recipe, bool isCritical, ImprovisedTool tool)
    {
        if (isCritical)
        {
            return $"Your hands move with practiced precision. The components click together " +
                   $"perfectly—the {tool.ToolName} is of exceptional quality! " +
                   $"This tool will serve you well for {ImprovisedTool.QualityDurability} uses " +
                   $"and grants +{tool.BonusAmount}d10.";
        }

        return $"After careful work, you've fashioned a serviceable {tool.ToolName}. " +
               $"It's rough around the edges but functional—good for {ImprovisedTool.StandardDurability} uses " +
               $"with a +{tool.BonusAmount}d10 bonus.";
    }

    private string GenerateFailureNarrative(ToolRecipe recipe)
    {
        return $"Despite your efforts, the {recipe.ToolName} won't come together properly. " +
               "The components break apart as you work, their salvaged nature proving " +
               "too damaged to form anything useful. Your materials are lost.";
    }

    private string GenerateFumbleNarrative(ToolRecipe recipe, int damage)
    {
        return $"A spark flies as components short-circuit! The {recipe.ToolName} attempt " +
               $"fails catastrophically—sharp metal and crackling electricity catch you " +
               $"off guard. You take {damage} damage from cuts and burns. " +
               "The components are utterly ruined.";
    }

    private string GenerateUsageNarrative(ImprovisedTool tool, int bonus, bool broke)
    {
        if (broke)
        {
            return $"The {tool.ToolName} proves its worth one last time (+{bonus}d10), " +
                   "then crumbles in your hands—its improvised construction finally " +
                   "giving way. The tool is broken.";
        }

        return $"You apply your {tool.ToolName} with practiced care (+{bonus}d10). " +
               $"The tool holds together—{tool.UsesRemaining - 1} uses remain.";
    }
}
```

---

## 8. Tool Usage Mechanics

### 8.1 Tool Bonus Application

| Tool | Applies To | Standard Bonus | Quality Bonus |
|------|-----------|----------------|---------------|
| Shim Picks | Lockpicking | +1d10 | +2d10 |
| Wire Probe | Terminal Hacking | +1d10 | +2d10 |
| Glitch Trigger | Glitch Exploitation | +1d10 | +2d10 |
| Bypass Clamps | Terminal Hacking | +1d10 | +2d10 |

### 8.2 Special Effects

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SPECIAL TOOL EFFECTS                                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  [GLITCH TRIGGER]                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│  Special Effect: Force mechanism into [Glitched] state                       │
│                                                                              │
│  When activated on a NON-glitched mechanism:                                 │
│  • Mechanism becomes [Glitched] for 1d4+1 rounds                            │
│  • Can then use Glitch Exploitation bypass method (v0.15.4f)                │
│  • Enables -4 DC bonus if pattern is observed                               │
│  • WARNING: Also adds +2 DC from [Glitched] state                           │
│                                                                              │
│  Net benefit: Skilled characters can turn -4 DC window into opportunity     │
│  Risk: Unskilled characters just made it harder                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  [BYPASS CLAMPS]                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  Special Effect: Skip Layer 1 of terminal infiltration                       │
│                                                                              │
│  When used on terminal hacking (v0.15.4b):                                  │
│  • Automatically passes Layer 1 (Access)                                    │
│  • Start infiltration at Layer 2 (Authentication)                           │
│  • Saves time and eliminates Layer 1 failure risk                           │
│  • Does NOT bypass ICE (ICE triggers on Layer 2 failure)                    │
│                                                                              │
│  Best used for: Time-critical infiltrations, avoiding lockouts              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 8.3 Tool Durability

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         TOOL DURABILITY SYSTEM                               │
└─────────────────────────────────────────────────────────────────────────────┘

    Standard Tools:                    Quality Tools:
    ┌──────────────────────┐           ┌──────────────────────┐
    │ Uses: 3              │           │ Uses: 5              │
    │ Bonus: +1d10         │           │ Bonus: +2d10         │
    │                      │           │                      │
    │ Use 1: ███░░ (2 left)│           │ Use 1: █████░ (4 left)│
    │ Use 2: ██░░░ (1 left)│           │ Use 2: ████░░ (3 left)│
    │ Use 3: █░░░░ BREAKS  │           │ Use 3: ███░░░ (2 left)│
    └──────────────────────┘           │ Use 4: ██░░░░ (1 left)│
                                       │ Use 5: █░░░░░ BREAKS  │
                                       └──────────────────────┘

    Special Breakage:
    ┌────────────────────────────────────────────────────────────────────────┐
    │ FUMBLE on bypass attempt while using tool = TOOL BREAKS IMMEDIATELY    │
    │ The tool shatters, snaps, or short-circuits from misuse.               │
    └────────────────────────────────────────────────────────────────────────┘
```

---

## 9. Component Acquisition

### 9.1 Salvage Sources

| Bypass Type | Source | Potential Salvage |
|-------------|--------|-------------------|
| Lockpicking | Lock mechanism | [High-Tension Spring], [Scrap Metal] |
| Terminal Hacking | Terminal circuits | [Circuit Fragment], [Wire], [Capacitor] |
| Trap Disarmament | Trap mechanism | [Wire], [Metal Clips], [Capacitor] |
| Glitch Exploitation | Corrupted device | [Circuit Fragment], [Capacitor] |

### 9.2 Salvage Triggers

Components are acquired through **critical successes** (net successes ≥ 5) on bypass checks:

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SALVAGE ACQUISITION FLOW                             │
└─────────────────────────────────────────────────────────────────────────────┘

    Bypass attempt succeeds with critical (net ≥5)
                │
                ▼
    ┌───────────────────────────────────────────────────────────────────────┐
    │                     SALVAGE OPPORTUNITY                                │
    ├───────────────────────────────────────────────────────────────────────┤
    │                                                                        │
    │  "Your exceptional technique allows you to extract valuable            │
    │   components while bypassing the mechanism."                           │
    │                                                                        │
    │  Roll for salvage (automatic based on mechanism type):                 │
    │                                                                        │
    │  Lock:     [High-Tension Spring] (guaranteed)                         │
    │            [Scrap Metal] (50% chance)                                 │
    │                                                                        │
    │  Terminal: [Circuit Fragment] (guaranteed)                            │
    │            [Wire] (guaranteed)                                        │
    │            [Capacitor] (16% chance - rare!)                           │
    │                                                                        │
    │  Trap:     [Wire] (guaranteed)                                        │
    │            [Metal Clips] (guaranteed)                                 │
    │                                                                        │
    └───────────────────────────────────────────────────────────────────────┘
```

### 9.3 Component Rarity

| Component | Rarity | Primary Sources |
|-----------|--------|-----------------|
| Scrap Metal | Common | Locks, structures |
| Metal Clips | Common | Traps, containers |
| Wire | Common | Terminals, traps |
| Copper Wire | Common | Electronics |
| Handle | Common | Tools, devices |
| Circuit Fragment | Uncommon | Terminals |
| High-Tension Spring | Uncommon | Complex locks |
| Capacitor | Rare | Military terminals, advanced traps |

---

## 10. Data Model Changes

### 10.1 New Value Objects

| Value Object | Layer | Description |
|--------------|-------|-------------|
| `ImprovisedTool` | Domain | Represents a crafted bypass tool with durability |
| `ToolRecipe` | Domain | Defines crafting requirements and results |
| `CraftingComponent` | Domain | Salvaged components for crafting |
| `ComponentRequirement` | Domain | Specifies component needs for a recipe |
| `ComponentCheckResult` | Domain | Result of component availability check |
| `CraftResult` | Domain | Result of a crafting attempt |
| `ToolUsageResult` | Domain | Result of using a tool |
| `CharacterCraftingContext` | Domain | Character attributes for crafting |

### 10.2 New Enums

| Enum | Layer | Description |
|------|-------|-------------|
| `ImprovisedToolType` | Domain | Tool classification (ShimPicks, WireProbe, etc.) |
| `BypassType` | Domain | Types of bypass operations |
| `ComponentType` | Domain | Component classification (Metal, Wire, Circuit, Misc) |
| `CraftingAttribute` | Domain | Which attribute(s) to use for crafting |

### 10.3 Entity Relationship Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    IMPROVISED TOOL CRAFTING DATA MODEL                       │
└─────────────────────────────────────────────────────────────────────────────┘

┌───────────────────────────────┐       ┌───────────────────────────────┐
│        ToolRecipe             │       │      CraftingComponent        │
│       (Value Object)          │       │       (Value Object)          │
├───────────────────────────────┤       ├───────────────────────────────┤
│ + RecipeId: string            │       │ + ComponentId: string         │
│ + ToolName: string            │       │ + ComponentName: string       │
│ + Description: string         │       │ + ComponentType: ComponentType│
│ + RequiredComponents: List<>  │       │ + SourceDescription: string   │
│ + CraftDc: int                │       │ + IsRare: bool                │
│ + RequiredAttribute: Crafting-│       ├───────────────────────────────┤
│   Attribute                   │       │ + CreateScrapMetal()          │
│ + ResultingToolType: Improv-  │       │ + CreateCopperWire()          │
│   isedToolType                │       │ + CreateCapacitor()           │
├───────────────────────────────┤       │ + CanSubstituteFor()          │
│ + ShimPicks (static)          │       └───────────────────────────────┘
│ + WireProbe (static)          │
│ + GlitchTrigger (static)      │               │
│ + BypassClamps (static)       │               │ consumed to create
│ + AllRecipes (static)         │               │
└───────────────────────────────┘               ▼
        │                               ┌───────────────────────────────┐
        │ defines                       │       ImprovisedTool          │
        │                               │       (Value Object)          │
        ▼                               ├───────────────────────────────┤
┌───────────────────────────────┐       │ + ToolId: string              │
│    ComponentRequirement       │       │ + ToolName: string            │
│       (Value Object)          │       │ + ToolType: ImprovisedToolType│
├───────────────────────────────┤       │ + BonusAmount: int            │
│ + ComponentName: string       │       │ + UsesRemaining: int          │
│ + ComponentType: ComponentType│       │ + IsQuality: bool             │
│ + Quantity: int               │       │ + SpecialEffect: string?      │
└───────────────────────────────┘       ├───────────────────────────────┤
                                        │ + IsUsable: bool              │
                                        │ + AssistsWithBypassType: ...  │
                                        │ + HasSpecialEffect: bool      │
                                        ├───────────────────────────────┤
                                        │ + CreateShimPicks()           │
                                        │ + CreateWireProbe()           │
                                        │ + CreateGlitchTrigger()       │
                                        │ + CreateBypassClamps()        │
                                        │ + UseOnce(): ImprovisedTool?  │
                                        │ + Break(): ImprovisedTool     │
                                        └───────────────────────────────┘
```

---

## 11. Configuration Files

### 11.1 improvised-tools.json

**File:** `config/improvised-tools.json`

```json
{
  "$schema": "./schemas/improvised-tools.schema.json",
  "recipes": [
    {
      "recipeId": "recipe_shim_picks",
      "toolName": "Shim Picks",
      "description": "Bend scrap metal into thin shims that slip between lock pins, allowing manipulation without proper lockpicks.",
      "resultingToolType": "ShimPicks",
      "craftDc": 10,
      "requiredAttribute": "WitsOrFinesse",
      "standardBonus": 1,
      "qualityBonus": 2,
      "standardDurability": 3,
      "qualityDurability": 5,
      "components": [
        {
          "componentName": "Scrap Metal",
          "componentType": "Metal",
          "quantity": 3
        }
      ],
      "applicableTo": ["Lockpicking"],
      "specialEffect": null
    },
    {
      "recipeId": "recipe_wire_probe",
      "toolName": "Wire Probe",
      "description": "A carefully wrapped probe of copper wire attached to an insulated handle, used to manipulate exposed terminal circuits.",
      "resultingToolType": "WireProbe",
      "craftDc": 12,
      "requiredAttribute": "WitsOrFinesse",
      "standardBonus": 1,
      "qualityBonus": 2,
      "standardDurability": 3,
      "qualityDurability": 5,
      "components": [
        {
          "componentName": "Copper Wire",
          "componentType": "Wire",
          "quantity": 2
        },
        {
          "componentName": "Handle",
          "componentType": "Misc",
          "quantity": 1
        }
      ],
      "applicableTo": ["TerminalHacking"],
      "specialEffect": null
    },
    {
      "recipeId": "recipe_glitch_trigger",
      "toolName": "Glitch Trigger",
      "description": "A crude device that emits an electromagnetic pulse pattern known to induce glitched states in Old World machinery.",
      "resultingToolType": "GlitchTrigger",
      "craftDc": 14,
      "requiredAttribute": "Wits",
      "standardBonus": 1,
      "qualityBonus": 2,
      "standardDurability": 3,
      "qualityDurability": 5,
      "components": [
        {
          "componentName": "Capacitor",
          "componentType": "Circuit",
          "quantity": 1
        },
        {
          "componentName": "Wire",
          "componentType": "Wire",
          "quantity": 4
        }
      ],
      "applicableTo": ["GlitchExploitation"],
      "specialEffect": "Force mechanism into [Glitched] state"
    },
    {
      "recipeId": "recipe_bypass_clamps",
      "toolName": "Bypass Clamps",
      "description": "Spring-loaded metal clips that physically bypass the outer access layer of a terminal, connecting directly to inner circuits.",
      "resultingToolType": "BypassClamps",
      "craftDc": 12,
      "requiredAttribute": "Finesse",
      "standardBonus": 1,
      "qualityBonus": 2,
      "standardDurability": 3,
      "qualityDurability": 5,
      "components": [
        {
          "componentName": "Metal Clips",
          "componentType": "Metal",
          "quantity": 4
        }
      ],
      "applicableTo": ["TerminalHacking"],
      "specialEffect": "Skip Layer 1 of terminal infiltration"
    }
  ],
  "craftingModifiers": {
    "tinkersToolkit": {
      "bonusDice": 1,
      "description": "[Tinker's Toolkit] provides basic tools for crafting"
    },
    "workshopAccess": {
      "bonusDice": 2,
      "description": "Proper workshop with workbench and lighting"
    },
    "underPressure": {
      "penaltyDice": 1,
      "description": "Hostile environment or time pressure"
    }
  },
  "fumbleEffects": {
    "damageDice": "1d6",
    "description": "Sparks, sharp metal, or electrical discharge",
    "componentsLost": true
  }
}
```

### 11.2 crafting-components.json

**File:** `config/crafting-components.json`

```json
{
  "$schema": "./schemas/crafting-components.schema.json",
  "components": [
    {
      "componentId": "comp_scrap_metal",
      "componentName": "Scrap Metal",
      "componentType": "Metal",
      "rarity": "Common",
      "sources": ["Locks", "Structures", "Containers"],
      "description": "Twisted bits of metal salvaged from machinery."
    },
    {
      "componentId": "comp_metal_clips",
      "componentName": "Metal Clips",
      "componentType": "Metal",
      "rarity": "Common",
      "sources": ["Traps", "Containers", "Locks"],
      "description": "Small spring-loaded metal clips."
    },
    {
      "componentId": "comp_wire",
      "componentName": "Wire",
      "componentType": "Wire",
      "rarity": "Common",
      "sources": ["Terminals", "Traps", "Electronics"],
      "description": "Lengths of insulated or bare wire."
    },
    {
      "componentId": "comp_copper_wire",
      "componentName": "Copper Wire",
      "componentType": "Wire",
      "rarity": "Common",
      "sources": ["Terminals", "Electronics"],
      "description": "High-quality copper wiring."
    },
    {
      "componentId": "comp_handle",
      "componentName": "Handle",
      "componentType": "Misc",
      "rarity": "Common",
      "sources": ["Tools", "Devices"],
      "description": "An insulated grip or handle."
    },
    {
      "componentId": "comp_high_tension_spring",
      "componentName": "High-Tension Spring",
      "componentType": "Metal",
      "rarity": "Uncommon",
      "sources": ["Complex Locks", "Traps"],
      "description": "A precisely calibrated spring under high tension."
    },
    {
      "componentId": "comp_circuit_fragment",
      "componentName": "Circuit Fragment",
      "componentType": "Circuit",
      "rarity": "Uncommon",
      "sources": ["Terminals", "Devices"],
      "description": "A partial circuit board with intact traces."
    },
    {
      "componentId": "comp_capacitor",
      "componentName": "Capacitor",
      "componentType": "Circuit",
      "rarity": "Rare",
      "sources": ["Military Terminals", "Advanced Traps", "Glitched Devices"],
      "description": "A functional capacitor that can store electrical charge."
    }
  ],
  "salvageRules": {
    "criticalSuccessRequired": true,
    "salvageByBypassType": {
      "Lockpicking": {
        "guaranteed": ["High-Tension Spring"],
        "chance": [
          { "component": "Scrap Metal", "probability": 0.5 }
        ]
      },
      "TerminalHacking": {
        "guaranteed": ["Circuit Fragment", "Wire"],
        "chance": [
          { "component": "Capacitor", "probability": 0.167 }
        ]
      },
      "TrapDisarmament": {
        "guaranteed": ["Wire", "Metal Clips"],
        "chance": []
      },
      "GlitchExploitation": {
        "guaranteed": ["Circuit Fragment"],
        "chance": [
          { "component": "Capacitor", "probability": 0.5 }
        ]
      }
    }
  }
}
```

### 11.3 Configuration Schema

**File:** `config/schemas/improvised-tools.schema.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "improvised-tools.schema.json",
  "title": "Improvised Tools Configuration",
  "description": "Schema for improvised tool recipes and crafting rules",
  "type": "object",
  "required": ["recipes", "craftingModifiers", "fumbleEffects"],
  "properties": {
    "recipes": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "recipeId", "toolName", "description", "resultingToolType",
          "craftDc", "requiredAttribute", "standardBonus", "qualityBonus",
          "standardDurability", "qualityDurability", "components", "applicableTo"
        ],
        "properties": {
          "recipeId": { "type": "string" },
          "toolName": { "type": "string", "maxLength": 50 },
          "description": { "type": "string", "maxLength": 500 },
          "resultingToolType": {
            "type": "string",
            "enum": ["ShimPicks", "WireProbe", "GlitchTrigger", "BypassClamps"]
          },
          "craftDc": { "type": "integer", "minimum": 1, "maximum": 30 },
          "requiredAttribute": {
            "type": "string",
            "enum": ["Wits", "Finesse", "WitsOrFinesse"]
          },
          "standardBonus": { "type": "integer", "minimum": 1 },
          "qualityBonus": { "type": "integer", "minimum": 1 },
          "standardDurability": { "type": "integer", "minimum": 1 },
          "qualityDurability": { "type": "integer", "minimum": 1 },
          "components": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["componentName", "componentType", "quantity"],
              "properties": {
                "componentName": { "type": "string" },
                "componentType": {
                  "type": "string",
                  "enum": ["Metal", "Wire", "Circuit", "Misc"]
                },
                "quantity": { "type": "integer", "minimum": 1 }
              }
            }
          },
          "applicableTo": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["Lockpicking", "TerminalHacking", "TrapDisarmament", "GlitchExploitation"]
            }
          },
          "specialEffect": { "type": ["string", "null"] }
        }
      }
    },
    "craftingModifiers": {
      "type": "object",
      "properties": {
        "tinkersToolkit": {
          "type": "object",
          "required": ["bonusDice", "description"],
          "properties": {
            "bonusDice": { "type": "integer" },
            "description": { "type": "string" }
          }
        },
        "workshopAccess": {
          "type": "object",
          "required": ["bonusDice", "description"],
          "properties": {
            "bonusDice": { "type": "integer" },
            "description": { "type": "string" }
          }
        },
        "underPressure": {
          "type": "object",
          "required": ["penaltyDice", "description"],
          "properties": {
            "penaltyDice": { "type": "integer" },
            "description": { "type": "string" }
          }
        }
      }
    },
    "fumbleEffects": {
      "type": "object",
      "required": ["damageDice", "description", "componentsLost"],
      "properties": {
        "damageDice": { "type": "string", "pattern": "^\\d+d\\d+$" },
        "description": { "type": "string" },
        "componentsLost": { "type": "boolean" }
      }
    }
  }
}
```

---

## 12. Logging Specifications

### 12.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `ImprovisedToolCraftingService` | Information | Crafting success/failure, salvage acquired |
| `ImprovisedToolCraftingService` | Debug | Component checks, dice pool calculations, tool usage |
| `ImprovisedToolCraftingService` | Warning | Missing components, invalid recipe attempts |
| `ImprovisedToolCraftingService` | Error | Invalid tool type, crafting service failures |

### 12.2 Log Message Templates

```csharp
// ImprovisedToolCraftingService - Information
"Crafting succeeded for {Recipe}: Critical={Critical}, Tool={Tool}"
"Crafting fumble for {Recipe}: Components lost, {Damage} damage"
"Salvage from critical {BypassType} on {Mechanism}: {Count} components"

// ImprovisedToolCraftingService - Debug
"Component check for {Recipe}: CanCraft={CanCraft}, Missing={MissingCount}"
"Crafting {Recipe}: Attribute={Attribute}, Pool={Pool}, DC={DC}"
"Crafting failed for {Recipe}: {NetSuccesses} net successes"
"Tool used: {Tool}, Bonus={Bonus}, Broke={Broke}, RemainingUses={Uses}"

// ImprovisedToolCraftingService - Warning
"Craft attempt failed - missing components for {Recipe}"

// ImprovisedToolCraftingService - Error
"Invalid tool type {ToolType} in CreateTool"
```

---

## 13. Unit Testing Requirements

### 13.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Tool crafting succeeds with components | ~1 |
| Crafted tool provides correct bonus | ~1 |
| **Total** | **~2** |

### 13.2 Test Specifications

**File:** `tests/RuneAndRust.Domain.Tests/Services/ImprovisedToolCraftingServiceTests.cs`

```csharp
using NUnit.Framework;
using Moq;
using RuneAndRust.Domain.Services;
using RuneAndRust.Domain.ValueObjects;
using RuneAndRust.Domain.Interfaces;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Domain.Tests.Services;

[TestFixture]
public class ImprovisedToolCraftingServiceTests
{
    private ImprovisedToolCraftingService _service;
    private Mock<IDiceRoller> _diceRollerMock;
    private Mock<ILogger<ImprovisedToolCraftingService>> _loggerMock;

    [SetUp]
    public void Setup()
    {
        _loggerMock = new Mock<ILogger<ImprovisedToolCraftingService>>();
        _diceRollerMock = new Mock<IDiceRoller>();

        _service = new ImprovisedToolCraftingService(_loggerMock.Object);
    }

    [Test]
    public void AttemptCraft_WithSufficientComponents_SucceedsAndCreatesTool()
    {
        // Arrange
        var recipe = ToolRecipe.ShimPicks;
        var components = new List<CraftingComponent>
        {
            CraftingComponent.CreateScrapMetal("test"),
            CraftingComponent.CreateScrapMetal("test"),
            CraftingComponent.CreateScrapMetal("test")
        };
        var character = new CharacterCraftingContext(
            Wits: 4,
            Finesse: 3,
            HasTinkersToolkit: true,
            HasWorkshopAccess: false,
            IsUnderPressure: false);

        // Mock successful roll (net successes > 0)
        _diceRollerMock
            .Setup(d => d.RollSkillCheck(It.IsAny<int>(), It.IsAny<int>()))
            .Returns(new SkillCheckResult(
                NetSuccesses: 2,
                IsCritical: false,
                IsFumble: false,
                TotalSuccesses: 3,
                TotalBotches: 1));

        // Act
        var result = _service.AttemptCraft(character, recipe, components, _diceRollerMock.Object);

        // Assert
        Assert.Multiple(() =>
        {
            Assert.That(result.Success, Is.True, "Crafting should succeed");
            Assert.That(result.ToolCreated, Is.Not.Null, "Tool should be created");
            Assert.That(result.ToolCreated!.Value.ToolType, Is.EqualTo(ImprovisedToolType.ShimPicks));
            Assert.That(result.ComponentsConsumed.Count, Is.EqualTo(3), "Components should be consumed");
        });
    }

    [Test]
    public void GetToolBonus_ForMatchingBypassType_ReturnsCorrectBonus()
    {
        // Arrange
        var standardTool = ImprovisedTool.CreateShimPicks(isQuality: false);
        var qualityTool = ImprovisedTool.CreateShimPicks(isQuality: true);

        // Act
        var standardBonus = _service.GetToolBonus(standardTool, BypassType.Lockpicking);
        var qualityBonus = _service.GetToolBonus(qualityTool, BypassType.Lockpicking);
        var wrongTypeBonus = _service.GetToolBonus(standardTool, BypassType.TerminalHacking);

        // Assert
        Assert.Multiple(() =>
        {
            Assert.That(standardBonus, Is.EqualTo(ImprovisedTool.StandardBonus),
                "Standard tool should give +1d10");
            Assert.That(qualityBonus, Is.EqualTo(ImprovisedTool.QualityBonus),
                "Quality tool should give +2d10");
            Assert.That(wrongTypeBonus, Is.EqualTo(0),
                "Wrong bypass type should give no bonus");
        });
    }

    [Test]
    public void CanCraft_WithMissingComponents_ReturnsFalseWithMissingList()
    {
        // Arrange
        var recipe = ToolRecipe.WireProbe; // Requires: Copper Wire ×2, Handle ×1
        var components = new List<CraftingComponent>
        {
            CraftingComponent.CreateCopperWire("test") // Only 1 of 2 required
        };

        // Act
        var result = _service.CanCraft(recipe, components);

        // Assert
        Assert.Multiple(() =>
        {
            Assert.That(result.CanCraft, Is.False, "Should not be able to craft");
            Assert.That(result.MissingComponents.Count, Is.GreaterThan(0), "Should list missing components");
        });
    }

    [Test]
    public void UseTool_DecrementsUsesAndEventuallyBreaks()
    {
        // Arrange
        var tool = ImprovisedTool.CreateShimPicks(isQuality: false);
        var initialUses = tool.UsesRemaining;

        // Act - Use until broken
        ImprovisedTool? currentTool = tool;
        var usageCount = 0;

        while (currentTool != null && usageCount < 10) // Safety limit
        {
            var result = _service.UseTool(currentTool.Value, BypassType.Lockpicking);
            currentTool = result.ModifiedTool;
            usageCount++;
        }

        // Assert
        Assert.Multiple(() =>
        {
            Assert.That(usageCount, Is.EqualTo(ImprovisedTool.StandardDurability),
                "Tool should break after standard durability uses");
            Assert.That(currentTool, Is.Null, "Tool should be null after breaking");
        });
    }
}
```

---

## 14. Use Cases

### UC-001: Craft Shim Picks Successfully

**Actor:** Player
**Flow:**
1. Player selects "Craft Tool" option
2. Player chooses "Shim Picks" recipe
3. System verifies 3× [Scrap Metal] in inventory
4. Player rolls WITS or FINESSE vs DC 10
5. Success: [Shim Picks] added to inventory
6. Components removed from inventory

### UC-002: Craft With Critical Success

**Actor:** Player
**Flow:**
1. Player attempts to craft Wire Probe
2. Player rolls net successes ≥ 5
3. System creates [Quality Wire Probe]
4. Tool has +2d10 bonus and 5 uses (vs normal +1d10 and 3 uses)

### UC-003: Crafting Fumble

**Actor:** Player
**Flow:**
1. Player attempts to craft Glitch Trigger
2. Player rolls 0 successes with ≥1 botch
3. Components are destroyed
4. Player takes 1d6 damage from sparks/cuts
5. No tool created

### UC-004: Use Shim Picks on Lock

**Actor:** Player
**Flow:**
1. Player encounters locked door
2. Player selects [Shim Picks] from inventory
3. System adds +1d10 to lockpicking dice pool
4. Player rolls lockpicking check
5. Tool uses decremented (or tool breaks on fumble)

### UC-005: Salvage Components from Critical Lockpick

**Actor:** Player
**Flow:**
1. Player successfully picks lock with critical (net ≥5)
2. System generates salvage roll
3. Player receives [High-Tension Spring] (guaranteed)
4. 50% chance for additional [Scrap Metal]
5. Components added to inventory

---

## 15. Deliverable Checklist

### Value Objects
- [ ] `ImprovisedTool` value object created
- [ ] `ImprovisedTool.CreateShimPicks()` factory method
- [ ] `ImprovisedTool.CreateWireProbe()` factory method
- [ ] `ImprovisedTool.CreateGlitchTrigger()` factory method
- [ ] `ImprovisedTool.CreateBypassClamps()` factory method
- [ ] `ImprovisedTool.UseOnce()` method
- [ ] `ToolRecipe` value object created
- [ ] `ToolRecipe.AllRecipes` static collection
- [ ] `CraftingComponent` value object created
- [ ] Component factory methods (CreateScrapMetal, etc.)
- [ ] `ComponentRequirement` value object created
- [ ] `ComponentCheckResult` value object created
- [ ] `CraftResult` value object created
- [ ] `ToolUsageResult` value object created
- [ ] `CharacterCraftingContext` value object created

### Enums
- [ ] `ImprovisedToolType` enum created
- [ ] `BypassType` enum created
- [ ] `ComponentType` enum created
- [ ] `CraftingAttribute` enum created

### Services
- [ ] `IImprovisedToolCraftingService` interface defined
- [ ] `ImprovisedToolCraftingService` implemented
- [ ] `GetAvailableRecipes()` method
- [ ] `CanCraft()` method
- [ ] `AttemptCraft()` method
- [ ] `GetToolBonus()` method
- [ ] `UseTool()` method
- [ ] `GetSalvageFromCritical()` method

### Configuration Files
- [ ] `config/improvised-tools.json` created
- [ ] `config/crafting-components.json` created
- [ ] `config/schemas/improvised-tools.schema.json` created

### Integration
- [ ] `LockpickingService` integrates with tool bonus
- [ ] `TerminalHackingService` integrates with tool bonus
- [ ] `GlitchExploitationService` integrates with Glitch Trigger
- [ ] Critical success salvage integrated into bypass services

### Testing
- [ ] ~2 unit tests implemented
- [ ] Tool crafting with components test
- [ ] Tool bonus application test
- [ ] All tests passing

### Quality
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] XML documentation complete
- [ ] Configuration files validate against schemas

---

## 16. Acceptance Criteria

### Functional
- [ ] Shim Picks craftable with 3× Scrap Metal at DC 10
- [ ] Wire Probe craftable with 2× Copper Wire + 1× Handle at DC 12
- [ ] Glitch Trigger craftable with 1× Capacitor + 4× Wire at DC 14
- [ ] Bypass Clamps craftable with 4× Metal Clips at DC 12
- [ ] Standard tools provide +1d10 bonus
- [ ] Quality tools (critical craft) provide +2d10 bonus
- [ ] Standard tools have 3 uses before breaking
- [ ] Quality tools have 5 uses before breaking
- [ ] Crafting fumble causes 1d6 damage and loses components
- [ ] Tools only apply bonus to matching bypass type
- [ ] Glitch Trigger can force [Glitched] state on mechanisms
- [ ] Bypass Clamps skip Layer 1 of terminal infiltration
- [ ] Critical bypass success yields salvage components

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~2 tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete for all public types

---

## 17. Dependencies

### 17.1 Required from Previous Versions

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `LockpickingService` | v0.15.4a | Tool bonus integration |
| `TerminalHackingService` | v0.15.4b | Tool bonus & clamp integration |
| `GlitchExploitationService` | v0.15.4f | Glitch Trigger integration |
| `IDiceRoller` | Domain | Crafting checks, salvage rolls |
| Success-counting dice | v0.15.0 | Core resolution mechanic |
| Critical success detection | v0.15.0 | Salvage trigger |

### 17.2 Provides to Future Versions

| Type | Usage |
|------|-------|
| `ImprovisedTool` | Any bypass system can check for applicable tools |
| `CraftingComponent` | Inventory management, trading systems |
| `ImprovisedToolCraftingService` | Reusable crafting framework |
| Component salvage system | Resource economy for dungeon exploration |

---

## 18. Future Considerations

### Deferred to v0.15.4i (Specialization Integration)

- **Scrap-Tinker [Master Craftsman]**: Craft [Masterwork Tools] with rare components
- **Tool Repair**: Ability to restore uses to damaged tools
- **Custom Recipes**: Specializations unlocking unique tool recipes

### Out of Scope

- **Tool Upgrading**: Converting standard tools to quality
- **Component Trading**: Economy system for components
- **Decay/Degradation**: Tools degrading over time even when unused
- **Tool Sets**: Bonuses for having matching tool sets
- **Permanent Tools**: Non-improvised tools that don't degrade

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
