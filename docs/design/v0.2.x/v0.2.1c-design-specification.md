# v0.2.1c Design Specification: Codex Hints

## Overview

**Version:** 0.2.1c
**Status:** Planning
**Focus:** Implement the Codex Hints system for guiding players toward undiscovered content
**Prerequisites:** v0.2.1b (Lore Fragments)
**Estimated Unit Tests:** ~20

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Data Models](#5-data-models)
6. [Configuration Schemas](#6-configuration-schemas)
7. [Service Specifications](#7-service-specifications)
8. [Hint Generation Flow](#8-hint-generation-flow)
9. [User-Facing Changes](#9-user-facing-changes)
10. [Logging Requirements](#10-logging-requirements)
11. [Unit Test Specifications](#11-unit-test-specifications)
12. [Use Cases](#12-use-cases)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

This version introduces the Codex Hints system, which guides players toward discovering more information about incomplete codex entries. When viewing a partially revealed entry, players see contextual hints about where to find additional knowledge. Hints integrate with both regular codex entries (from v0.2.1a) and fragmented lore entries (from v0.2.1b), creating a cohesive discovery guidance system.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Value Objects** | CodexHint, HintContext |
| **Enums** | HintType, HintPriority |
| **Commands** | Enhanced `codex <topic>` with hints display |
| **Services** | CodexHintService (ICodexHintService) |
| **Configuration** | Updates to codex-entries.json, lore-fragments.json |
| **Tests** | ~20 new unit tests |

### Architectural Significance

This version completes the discovery guidance pattern established in prior versions:
- Hints as contextual guidance toward undiscovered content
- Integration with CodexEntry reveal conditions (v0.2.1a)
- Integration with LoreFragment location hints (v0.2.1b)
- Foundation for enhanced UI display (v0.2.1d)

---

## 2. Feature Overview

```
v0.2.1c Features
├── Codex Hint System
│   ├── CodexHint value object
│   ├── HintType enum (Action, Location, NPC, Item, Combat)
│   ├── HintPriority enum (Low, Medium, High)
│   └── Contextual hint generation
├── Hint Sources
│   ├── Incomplete codex entries (hidden sections)
│   ├── Undiscovered related entries
│   ├── Fragment location hints
│   └── Cross-reference suggestions
├── Hint Display
│   ├── Enhanced codex <topic> output
│   ├── Hints section for incomplete entries
│   └── "See Also" with discovery hints
└── Service Layer
    ├── CodexHintService (hint generation)
    ├── ICodexHintService interface
    └── Integration with CodexService and LoreFragmentService
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRESENTATION LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌────────────────┐  │
│  │   CodexHandler      │  │   InputHandler      │  │ IGameRenderer  │  │
│  │   (updated)         │  │   (no changes)      │  │ (updated)      │  │
│  │                     │  │                     │  │                │  │
│  │ + HandleCodexView() │  │                     │  │ + RenderHints()│  │
│  │   // includes hints │  │                     │  │ + RenderSeeAlso│  │
│  └─────────┬───────────┘  └─────────────────────┘  └───────┬────────┘  │
│            │                                               │           │
└────────────┼───────────────────────────────────────────────┼───────────┘
             │                                               │
             ▼                                               ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      CodexHintService                           │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + GetHintsForEntry(playerId, entryId) : IReadOnlyList<CodexHint>│   │
│  │ + GetHintsForFragment(playerId, entryId) : IReadOnlyList<...>  │   │
│  │ + GetRelatedEntryHints(playerId, entryId) : IReadOnlyList<...> │   │
│  │ + GetNextDiscoveryHint(playerId) : CodexHint?                  │   │
│  │ + GenerateHintFromCondition(condition) : CodexHint             │   │
│  │ + FilterHintsByPriority(hints, min) : IReadOnlyList<CodexHint> │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    CodexService (updated)                       │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + GetEntryWithHints(playerId, entryId) : CodexEntryWithHintsDto │   │
│  │ // Integrates hints into entry viewing                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    GameSessionService (updated)                 │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + ViewCodexEntry(topic) : CodexEntryDto // now includes hints  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │                         CodexHint                               │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │ + HintType: HintType                                            │    │
│  │ + Priority: HintPriority                                        │    │
│  │ + Text: string                                                  │    │
│  │ + Context: HintContext                                          │    │
│  │ + TargetId: string?                                             │    │
│  │ + IsForHiddenSection: bool                                      │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │                        HintContext                              │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │ + SourceEntryId: string                                         │    │
│  │ + SectionIndex: int?                                            │    │
│  │ + RelatedEntryId: string?                                       │    │
│  │ + FragmentEntryId: string?                                      │    │
│  │ + FragmentIndex: int?                                           │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
│  ENUMS                                                                  │
│  ┌────────────────────────────────┐  ┌────────────────────────────┐   │
│  │          HintType              │  │       HintPriority         │   │
│  ├────────────────────────────────┤  ├────────────────────────────┤   │
│  │ Action                         │  │ Low                        │   │
│  │ Location                       │  │ Medium                     │   │
│  │ NPC                            │  │ High                       │   │
│  │ Item                           │  │                            │   │
│  │ Combat                         │  │                            │   │
│  │ Document                       │  │                            │   │
│  │ Exploration                    │  │                            │   │
│  │ CrossReference                 │  │                            │   │
│  └────────────────────────────────┘  └────────────────────────────┘   │
│                                                                         │
│  DEFINITIONS (updated)                                                  │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │                CodexEntryDefinition (updated)                   │    │
│  ├────────────────────────────────────────────────────────────────┤    │
│  │ + RevealHints: IReadOnlyList<string>  // NEW                   │    │
│  │ // Hints for revealing hidden sections                          │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Configuration Updates:                                                 │
│  ├── config/codex-entries.json (add revealHints to sections)           │
│  └── No new config files required                                      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Hint Generation Flow

```
┌───────────────────┐
│   Player views    │
│   codex entry     │
│   (incomplete)    │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ CodexHintService  │
│ .GetHintsForEntry │
│ (playerId,        │
│  entryId)         │
└─────────┬─────────┘
          │
          ▼
┌───────────────────────────────────────────────────────────────┐
│                    HINT COLLECTION                             │
├───────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────┐                                         │
│  │ 1. Get entry      │                                         │
│  │    definition     │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ 2. Check for      │                                         │
│  │    hidden sections│                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────────────────────────────────────────────┐│
│  │                FOR EACH HIDDEN SECTION                     ││
│  ├───────────────────────────────────────────────────────────┤│
│  │                                                            ││
│  │  ┌───────────────────┐                                    ││
│  │  │ Get reveal        │                                    ││
│  │  │ conditions        │                                    ││
│  │  └─────────┬─────────┘                                    ││
│  │            │                                               ││
│  │            ▼                                               ││
│  │  ┌───────────────────┐                                    ││
│  │  │ Check if player   │      ┌───────────────────┐         ││
│  │  │ has met condition │──YES▶│ Skip (already     │         ││
│  │  └─────────┬─────────┘      │ revealed)         │         ││
│  │            │                └───────────────────┘         ││
│  │           NO                                               ││
│  │            │                                               ││
│  │            ▼                                               ││
│  │  ┌───────────────────┐                                    ││
│  │  │ Generate hint     │                                    ││
│  │  │ from condition    │                                    ││
│  │  │ + revealHints     │                                    ││
│  │  └─────────┬─────────┘                                    ││
│  │            │                                               ││
│  └────────────┼───────────────────────────────────────────────┘│
│               │                                                 │
│               ▼                                                 │
│  ┌───────────────────┐                                         │
│  │ 3. Check related  │                                         │
│  │    entries        │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────────────────────────────────────────────┐│
│  │              FOR EACH RELATED ENTRY                        ││
│  ├───────────────────────────────────────────────────────────┤│
│  │                                                            ││
│  │  ┌───────────────────┐      ┌───────────────────┐         ││
│  │  │ Player has        │──YES▶│ Skip (already     │         ││
│  │  │ discovered?       │      │ discovered)       │         ││
│  │  └─────────┬─────────┘      └───────────────────┘         ││
│  │            │                                               ││
│  │           NO                                               ││
│  │            │                                               ││
│  │            ▼                                               ││
│  │  ┌───────────────────┐                                    ││
│  │  │ Generate cross-   │                                    ││
│  │  │ reference hint    │                                    ││
│  │  └───────────────────┘                                    ││
│  │                                                            ││
│  └────────────────────────────────────────────────────────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
             │
             ▼
┌───────────────────┐
│ Filter and sort   │
│ hints by priority │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ Return hints to   │
│ display           │
└───────────────────┘
```

### 3.3 Fragment Hint Integration Flow

```
┌───────────────────┐
│   Player views    │
│   fragment        │
│   collection      │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ CodexHintService  │
│ .GetHintsFor      │
│ Fragment(playerId,│
│ entryId)          │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│ Get fragmented    │
│ entry definition  │
└─────────┬─────────┘
          │
          ▼
┌───────────────────────────────────────────────────────────────┐
│              FOR EACH MISSING FRAGMENT                         │
├───────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────┐                                         │
│  │ Get fragment      │                                         │
│  │ definition        │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ Create hint from  │                                         │
│  │ LocationHint +    │                                         │
│  │ SourceType        │                                         │
│  └───────────────────┘                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
             │
             ▼
┌───────────────────┐
│ Return fragment   │
│ hints             │
└───────────────────┘
```

---

## 4. User Stories

### US-2.1c-1: View Hints for Incomplete Entry
**As a** player viewing an incomplete codex entry
**I want to** see hints about how to reveal more content
**So that** I know what actions might unlock hidden sections

**Acceptance Criteria:**
- Incomplete entries show a "Hints" section
- Hints describe actions without spoiling content
- Each hint relates to a specific reveal condition
- Hints are ordered by relevance/priority

### US-2.1c-2: View Cross-Reference Hints
**As a** player viewing a codex entry
**I want to** see hints about related undiscovered entries
**So that** I can explore connected topics

**Acceptance Criteria:**
- "See Also" section shows discovered related entries
- Undiscovered related entries show as hints
- Hints suggest how to discover related entries
- No spoilers about undiscovered entry content

### US-2.1c-3: View Fragment Collection Hints
**As a** player viewing an incomplete fragment collection
**I want to** see hints about where to find missing fragments
**So that** I can complete the collection

**Acceptance Criteria:**
- Missing fragments show location hints
- Hints integrate with v0.2.1b LocationHint field
- Hint type matches fragment source type
- Already-found fragments don't show hints

### US-2.1c-4: Get Next Discovery Suggestion
**As a** player exploring the dungeon
**I want to** get a suggestion for what to discover next
**So that** I have guidance on expanding my codex

**Acceptance Criteria:**
- System can suggest a single "next" discovery
- Suggestion based on current player progress
- Prioritizes entries with partial completion
- Falls back to entries related to discovered content

### US-2.1c-5: Configure Hints via JSON
**As a** game designer
**I want to** define custom reveal hints in configuration
**So that** hints feel contextually appropriate

**Acceptance Criteria:**
- RevealHints can be added to codex entry sections
- Custom hints override generated hints
- Hints support the same vague style as LocationHint
- Empty hints fall back to auto-generated

---

## 5. Data Models

### 5.1 HintType Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Types of hints that guide players toward codex discoveries.
/// </summary>
/// <remarks>
/// Used to categorize hints and influence their display formatting.
/// </remarks>
public enum HintType
{
    /// <summary>
    /// Hint about a specific action to perform.
    /// </summary>
    /// <example>"Defeat more of these creatures."</example>
    Action,

    /// <summary>
    /// Hint about visiting a location.
    /// </summary>
    /// <example>"Explore the depths of the dungeon."</example>
    Location,

    /// <summary>
    /// Hint about talking to an NPC.
    /// </summary>
    /// <example>"Seek wisdom from those who remember."</example>
    NPC,

    /// <summary>
    /// Hint about examining or acquiring an item.
    /// </summary>
    /// <example>"Study artifacts of the old kingdom."</example>
    Item,

    /// <summary>
    /// Hint about combat encounters.
    /// </summary>
    /// <example>"Face these foes repeatedly to learn their ways."</example>
    Combat,

    /// <summary>
    /// Hint about reading documents.
    /// </summary>
    /// <example>"Seek knowledge in ancient texts."</example>
    Document,

    /// <summary>
    /// Hint about exploring the environment.
    /// </summary>
    /// <example>"Examine your surroundings carefully."</example>
    Exploration,

    /// <summary>
    /// Hint about discovering a related entry.
    /// </summary>
    /// <example>"Learn more about connected topics."</example>
    CrossReference
}
```

### 5.2 HintPriority Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Priority levels for codex hints.
/// </summary>
/// <remarks>
/// Used to sort and filter hints when displaying to players.
/// Higher priority hints are shown first or exclusively.
/// </remarks>
public enum HintPriority
{
    /// <summary>
    /// Low priority hint, shown when no better hints available.
    /// </summary>
    /// <remarks>
    /// Typically for cross-references or distant discoveries.
    /// </remarks>
    Low,

    /// <summary>
    /// Medium priority hint, standard display level.
    /// </summary>
    /// <remarks>
    /// Default priority for most reveal condition hints.
    /// </remarks>
    Medium,

    /// <summary>
    /// High priority hint, shown prominently.
    /// </summary>
    /// <remarks>
    /// For entries close to completion or highly relevant.
    /// </remarks>
    High
}
```

### 5.3 CodexHint Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents a hint guiding players toward codex discoveries.
/// </summary>
/// <remarks>
/// Hints are generated from reveal conditions, fragment locations,
/// and related entry references. They provide contextual guidance
/// without spoiling undiscovered content.
/// </remarks>
public readonly record struct CodexHint
{
    /// <summary>
    /// Gets the type of hint.
    /// </summary>
    public HintType HintType { get; init; }

    /// <summary>
    /// Gets the priority of this hint.
    /// </summary>
    public HintPriority Priority { get; init; }

    /// <summary>
    /// Gets the hint text displayed to the player.
    /// </summary>
    /// <example>"Defeat more goblins to learn their weaknesses."</example>
    public string Text { get; init; }

    /// <summary>
    /// Gets context about where this hint originates.
    /// </summary>
    public HintContext Context { get; init; }

    /// <summary>
    /// Gets the optional target ID (entry, fragment, etc.).
    /// </summary>
    /// <remarks>
    /// Used internally for tracking hint sources.
    /// Not displayed to players.
    /// </remarks>
    public string? TargetId { get; init; }

    /// <summary>
    /// Gets whether this hint is for revealing a hidden section.
    /// </summary>
    /// <remarks>
    /// True for section reveal hints, false for entry discovery hints.
    /// </remarks>
    public bool IsForHiddenSection { get; init; }

    /// <summary>
    /// Creates a hint for revealing a hidden section.
    /// </summary>
    public static CodexHint ForHiddenSection(
        HintType hintType,
        string text,
        string sourceEntryId,
        int sectionIndex,
        HintPriority priority = HintPriority.Medium)
    {
        return new CodexHint
        {
            HintType = hintType,
            Priority = priority,
            Text = text,
            Context = HintContext.ForSection(sourceEntryId, sectionIndex),
            TargetId = null,
            IsForHiddenSection = true
        };
    }

    /// <summary>
    /// Creates a hint for discovering a related entry.
    /// </summary>
    public static CodexHint ForRelatedEntry(
        HintType hintType,
        string text,
        string sourceEntryId,
        string relatedEntryId,
        HintPriority priority = HintPriority.Low)
    {
        return new CodexHint
        {
            HintType = hintType,
            Priority = priority,
            Text = text,
            Context = HintContext.ForRelatedEntry(sourceEntryId, relatedEntryId),
            TargetId = relatedEntryId,
            IsForHiddenSection = false
        };
    }

    /// <summary>
    /// Creates a hint for finding a missing fragment.
    /// </summary>
    public static CodexHint ForFragment(
        HintType hintType,
        string text,
        string fragmentEntryId,
        int fragmentIndex,
        HintPriority priority = HintPriority.Medium)
    {
        return new CodexHint
        {
            HintType = hintType,
            Priority = priority,
            Text = text,
            Context = HintContext.ForFragment(fragmentEntryId, fragmentIndex),
            TargetId = null,
            IsForHiddenSection = false
        };
    }

    /// <summary>
    /// Creates a general discovery hint.
    /// </summary>
    public static CodexHint ForDiscovery(
        HintType hintType,
        string text,
        string targetEntryId,
        HintPriority priority = HintPriority.Medium)
    {
        return new CodexHint
        {
            HintType = hintType,
            Priority = priority,
            Text = text,
            Context = HintContext.Empty,
            TargetId = targetEntryId,
            IsForHiddenSection = false
        };
    }
}
```

### 5.4 HintContext Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Provides context about the source of a codex hint.
/// </summary>
/// <remarks>
/// Used to track where hints originate for debugging
/// and to prevent duplicate hint generation.
/// </remarks>
public readonly record struct HintContext
{
    /// <summary>
    /// Gets the source codex entry ID.
    /// </summary>
    public string? SourceEntryId { get; init; }

    /// <summary>
    /// Gets the section index if hint is for a specific section.
    /// </summary>
    public int? SectionIndex { get; init; }

    /// <summary>
    /// Gets the related entry ID if hint is a cross-reference.
    /// </summary>
    public string? RelatedEntryId { get; init; }

    /// <summary>
    /// Gets the fragment entry ID if hint is for a fragment.
    /// </summary>
    public string? FragmentEntryId { get; init; }

    /// <summary>
    /// Gets the fragment index if hint is for a specific fragment.
    /// </summary>
    public int? FragmentIndex { get; init; }

    /// <summary>
    /// Gets an empty context.
    /// </summary>
    public static HintContext Empty => new();

    /// <summary>
    /// Creates context for a section hint.
    /// </summary>
    public static HintContext ForSection(string sourceEntryId, int sectionIndex)
    {
        return new HintContext
        {
            SourceEntryId = sourceEntryId,
            SectionIndex = sectionIndex
        };
    }

    /// <summary>
    /// Creates context for a related entry hint.
    /// </summary>
    public static HintContext ForRelatedEntry(string sourceEntryId, string relatedEntryId)
    {
        return new HintContext
        {
            SourceEntryId = sourceEntryId,
            RelatedEntryId = relatedEntryId
        };
    }

    /// <summary>
    /// Creates context for a fragment hint.
    /// </summary>
    public static HintContext ForFragment(string fragmentEntryId, int fragmentIndex)
    {
        return new HintContext
        {
            FragmentEntryId = fragmentEntryId,
            FragmentIndex = fragmentIndex
        };
    }
}
```

### 5.5 CodexSection Update

```csharp
// Add to CodexSection value object (from v0.2.1a):

/// <summary>
/// Gets a custom hint for revealing this section.
/// </summary>
/// <remarks>
/// If provided, overrides auto-generated hints from reveal conditions.
/// Should be vague and atmospheric, not spoilery.
/// </remarks>
/// <example>"Those who prove themselves in battle may learn more."</example>
public string? RevealHint { get; init; }

// Update Create method:
public static CodexSection Create(
    string title,
    string content,
    int order,
    bool requiresReveal = false,
    string? revealHint = null)
{
    return new CodexSection
    {
        Title = title ?? string.Empty,
        Content = content ?? string.Empty,
        Order = order,
        RequiresReveal = requiresReveal,
        RevealHint = revealHint
    };
}
```

### 5.6 CodexEntryWithHintsDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for a codex entry including discovery hints.
/// </summary>
public class CodexEntryWithHintsDto
{
    /// <summary>
    /// Gets the entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry category.
    /// </summary>
    public CodexCategory Category { get; init; }

    /// <summary>
    /// Gets the visible sections.
    /// </summary>
    public IReadOnlyList<CodexSectionDto> Sections { get; init; } = [];

    /// <summary>
    /// Gets whether the entry is complete.
    /// </summary>
    public bool IsComplete { get; init; }

    /// <summary>
    /// Gets the completion percentage.
    /// </summary>
    public int CompletionPercent { get; init; }

    /// <summary>
    /// Gets hints for revealing hidden sections.
    /// </summary>
    public IReadOnlyList<CodexHint> RevealHints { get; init; } = [];

    /// <summary>
    /// Gets discovered related entries.
    /// </summary>
    public IReadOnlyList<RelatedEntryDto> DiscoveredRelated { get; init; } = [];

    /// <summary>
    /// Gets hints for undiscovered related entries.
    /// </summary>
    public IReadOnlyList<CodexHint> RelatedHints { get; init; } = [];

    /// <summary>
    /// Gets whether this entry was assembled from fragments.
    /// </summary>
    public bool IsFromFragments { get; init; }
}

/// <summary>
/// DTO for a related entry reference.
/// </summary>
public class RelatedEntryDto
{
    /// <summary>
    /// Gets the entry ID.
    /// </summary>
    public string EntryId { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry title.
    /// </summary>
    public string Title { get; init; } = string.Empty;

    /// <summary>
    /// Gets the entry category.
    /// </summary>
    public CodexCategory Category { get; init; }
}
```

---

## 6. Configuration Schemas

### 6.1 Updated codex-entries.json (excerpt)

```json
{
  "$schema": "../schemas/codex-entries.schema.json",
  "entries": [
    {
      "id": "goblin-bestiary",
      "title": "Goblin",
      "category": "Bestiary",
      "sections": [
        {
          "title": "Overview",
          "content": "Goblins are small, cunning creatures...",
          "order": 1,
          "requiresReveal": false
        },
        {
          "title": "Weaknesses",
          "content": "Goblins fear fire and bright light...",
          "order": 2,
          "requiresReveal": true,
          "revealHint": "Engage these creatures in combat to learn their vulnerabilities."
        },
        {
          "title": "Society",
          "content": "Goblin tribes are led by the strongest...",
          "order": 3,
          "requiresReveal": true,
          "revealHint": "Extensive experience against goblin-kind reveals their social structure."
        }
      ],
      "unlockConditions": [...],
      "revealConditions": [...],
      "relatedEntryIds": ["goblin-chief-bestiary", "goblin-lair-location"],
      "tags": ["monster", "goblinoid", "common"]
    }
  ]
}
```

### 6.2 Updated codex-entries.schema.json (excerpt)

```json
{
  "definitions": {
    "codexSection": {
      "type": "object",
      "required": ["content", "order"],
      "properties": {
        "title": {
          "type": "string",
          "maxLength": 100,
          "description": "Section title (optional)"
        },
        "content": {
          "type": "string",
          "minLength": 1,
          "maxLength": 2000,
          "description": "Section content text"
        },
        "order": {
          "type": "integer",
          "minimum": 1,
          "description": "Display order (lower = earlier)"
        },
        "requiresReveal": {
          "type": "boolean",
          "default": false,
          "description": "Whether this section is hidden initially"
        },
        "revealHint": {
          "type": "string",
          "maxLength": 200,
          "description": "Custom hint for revealing this section (optional)"
        }
      }
    }
  }
}
```

---

## 7. Service Specifications

### 7.1 ICodexHintService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Provides operations for generating and managing codex hints.
/// </summary>
public interface ICodexHintService
{
    /// <summary>
    /// Gets hints for an incomplete codex entry.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="entryId">The entry ID.</param>
    /// <returns>List of hints for revealing hidden sections.</returns>
    IReadOnlyList<CodexHint> GetHintsForEntry(Guid playerId, string entryId);

    /// <summary>
    /// Gets hints for an incomplete fragment collection.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="entryId">The fragmented entry ID.</param>
    /// <returns>List of hints for finding missing fragments.</returns>
    IReadOnlyList<CodexHint> GetHintsForFragments(Guid playerId, string entryId);

    /// <summary>
    /// Gets hints for discovering related entries.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <param name="entryId">The source entry ID.</param>
    /// <returns>List of hints for undiscovered related entries.</returns>
    IReadOnlyList<CodexHint> GetRelatedEntryHints(Guid playerId, string entryId);

    /// <summary>
    /// Gets a suggestion for the next discovery.
    /// </summary>
    /// <param name="playerId">The player's ID.</param>
    /// <returns>A hint for what to discover next, or null if none.</returns>
    CodexHint? GetNextDiscoveryHint(Guid playerId);

    /// <summary>
    /// Generates a hint from a reveal condition.
    /// </summary>
    /// <param name="condition">The unlock/reveal condition.</param>
    /// <param name="customHint">Optional custom hint text.</param>
    /// <returns>A generated hint.</returns>
    CodexHint GenerateHintFromCondition(
        CodexUnlockCondition condition,
        string? customHint = null);

    /// <summary>
    /// Filters hints by minimum priority.
    /// </summary>
    /// <param name="hints">The hints to filter.</param>
    /// <param name="minimumPriority">The minimum priority to include.</param>
    /// <returns>Filtered hints.</returns>
    IReadOnlyList<CodexHint> FilterHintsByPriority(
        IReadOnlyList<CodexHint> hints,
        HintPriority minimumPriority);
}
```

### 7.2 CodexHintService Implementation

```csharp
namespace RuneAndRust.Application.Services;

/// <summary>
/// Generates and manages codex hints for guiding player discoveries.
/// </summary>
public class CodexHintService : ICodexHintService
{
    private readonly ICodexService _codexService;
    private readonly ILoreFragmentService _fragmentService;
    private readonly ILogger<CodexHintService> _logger;

    // Mapping from trigger types to hint types
    private static readonly Dictionary<UnlockTriggerType, HintType> TriggerToHintType = new()
    {
        { UnlockTriggerType.DefeatMonster, HintType.Combat },
        { UnlockTriggerType.ExamineItem, HintType.Item },
        { UnlockTriggerType.AcquireItem, HintType.Item },
        { UnlockTriggerType.ExploreRoom, HintType.Location },
        { UnlockTriggerType.DialogueChoice, HintType.NPC },
        { UnlockTriggerType.ReadDocument, HintType.Document },
        { UnlockTriggerType.FlagSet, HintType.Action }
    };

    // Mapping from fragment source types to hint types
    private static readonly Dictionary<FragmentSourceType, HintType> SourceToHintType = new()
    {
        { FragmentSourceType.Document, HintType.Document },
        { FragmentSourceType.Inscription, HintType.Exploration },
        { FragmentSourceType.NPCDialogue, HintType.NPC },
        { FragmentSourceType.ItemExamination, HintType.Item },
        { FragmentSourceType.EnvironmentExamination, HintType.Exploration },
        { FragmentSourceType.CombatDrop, HintType.Combat }
    };

    /// <summary>
    /// Initializes a new instance of CodexHintService.
    /// </summary>
    public CodexHintService(
        ICodexService codexService,
        ILoreFragmentService fragmentService,
        ILogger<CodexHintService> logger)
    {
        _codexService = codexService;
        _fragmentService = fragmentService;
        _logger = logger;

        _logger.LogInformation("CodexHintService initialized");
    }

    /// <inheritdoc />
    public IReadOnlyList<CodexHint> GetHintsForEntry(Guid playerId, string entryId)
    {
        _logger.LogDebug(
            "GetHintsForEntry called for player: {PlayerId}, entry: {EntryId}",
            playerId, entryId);

        var hints = new List<CodexHint>();

        // Get the entry and its definition
        var entry = _codexService.GetDiscoveredEntries(playerId)
            .FirstOrDefault(e => e.DefinitionId.Equals(entryId, StringComparison.OrdinalIgnoreCase));

        if (entry is null || entry.IsComplete)
        {
            return hints;
        }

        var definition = _codexService.GetCodexEntryDefinition(entryId);
        if (definition is null)
        {
            return hints;
        }

        // Get hints for unrevealed sections
        var revealedCount = entry.RevealedSections;
        var sections = definition.Sections.OrderBy(s => s.Order).ToList();

        for (var i = revealedCount; i < sections.Count; i++)
        {
            var section = sections[i];
            if (!section.RequiresReveal) continue;

            // Find the reveal condition for this section
            var conditionIndex = i - definition.GetInitialSectionCount();
            if (conditionIndex >= 0 && conditionIndex < definition.RevealConditions.Count)
            {
                var condition = definition.RevealConditions[conditionIndex];
                var hint = GenerateHintFromCondition(condition, section.RevealHint);
                hints.Add(CodexHint.ForHiddenSection(
                    hint.HintType,
                    hint.Text,
                    entryId,
                    i,
                    DetermineHintPriority(revealedCount, sections.Count)));
            }
            else if (!string.IsNullOrEmpty(section.RevealHint))
            {
                // Use custom hint if no condition found
                hints.Add(CodexHint.ForHiddenSection(
                    HintType.Action,
                    section.RevealHint,
                    entryId,
                    i,
                    HintPriority.Medium));
            }
        }

        return hints;
    }

    /// <inheritdoc />
    public IReadOnlyList<CodexHint> GetHintsForFragments(Guid playerId, string entryId)
    {
        _logger.LogDebug(
            "GetHintsForFragments called for player: {PlayerId}, entry: {EntryId}",
            playerId, entryId);

        var hints = new List<CodexHint>();

        var entryDef = _fragmentService.GetFragmentedEntryDefinition(entryId);
        if (entryDef is null)
        {
            return hints;
        }

        var progress = _fragmentService.GetCollectionProgress(playerId, entryId);
        if (progress is null || progress.Value.IsComplete)
        {
            return hints;
        }

        var missingIndices = progress.Value.GetMissingIndices();

        foreach (var index in missingIndices)
        {
            // Find the fragment definition for this index
            var fragmentId = entryDef.FragmentIds.ElementAtOrDefault(index - 1);
            if (string.IsNullOrEmpty(fragmentId)) continue;

            var fragmentDef = _fragmentService.GetFragmentDefinition(fragmentId);
            if (fragmentDef is null) continue;

            var hintType = SourceToHintType.GetValueOrDefault(
                fragmentDef.SourceType,
                HintType.Exploration);

            var hintText = !string.IsNullOrEmpty(fragmentDef.LocationHint)
                ? fragmentDef.LocationHint
                : GenerateDefaultFragmentHint(fragmentDef.SourceType);

            hints.Add(CodexHint.ForFragment(
                hintType,
                hintText,
                entryId,
                index,
                HintPriority.Medium));
        }

        return hints;
    }

    /// <inheritdoc />
    public IReadOnlyList<CodexHint> GetRelatedEntryHints(Guid playerId, string entryId)
    {
        _logger.LogDebug(
            "GetRelatedEntryHints called for player: {PlayerId}, entry: {EntryId}",
            playerId, entryId);

        var hints = new List<CodexHint>();

        var definition = _codexService.GetCodexEntryDefinition(entryId);
        if (definition is null)
        {
            return hints;
        }

        var discoveredEntries = _codexService.GetDiscoveredEntries(playerId);

        foreach (var relatedId in definition.RelatedEntryIds)
        {
            var isDiscovered = discoveredEntries.Any(
                e => e.DefinitionId.Equals(relatedId, StringComparison.OrdinalIgnoreCase));

            if (!isDiscovered)
            {
                var relatedDef = _codexService.GetCodexEntryDefinition(relatedId);
                if (relatedDef is null) continue;

                var hintText = GenerateCrossReferenceHint(relatedDef.Category);

                hints.Add(CodexHint.ForRelatedEntry(
                    HintType.CrossReference,
                    hintText,
                    entryId,
                    relatedId,
                    HintPriority.Low));
            }
        }

        return hints;
    }

    /// <inheritdoc />
    public CodexHint? GetNextDiscoveryHint(Guid playerId)
    {
        _logger.LogDebug("GetNextDiscoveryHint called for player: {PlayerId}", playerId);

        var discoveredEntries = _codexService.GetDiscoveredEntries(playerId);

        // Priority 1: Incomplete entries (close to completion)
        var incompleteEntry = discoveredEntries
            .Where(e => !e.IsComplete)
            .OrderByDescending(e => e.GetCompletionPercent())
            .FirstOrDefault();

        if (incompleteEntry is not null)
        {
            var hints = GetHintsForEntry(playerId, incompleteEntry.DefinitionId);
            if (hints.Count > 0)
            {
                return hints.First();
            }
        }

        // Priority 2: Incomplete fragment collections
        var incompleteFragments = _fragmentService.GetIncompleteCollections(playerId);
        if (incompleteFragments.Count > 0)
        {
            var closestToComplete = incompleteFragments
                .OrderByDescending(f => f.PercentComplete)
                .First();

            var fragmentHints = GetHintsForFragments(playerId, closestToComplete.EntryId);
            if (fragmentHints.Count > 0)
            {
                return fragmentHints.First();
            }
        }

        // Priority 3: Related entries of discovered content
        foreach (var entry in discoveredEntries.Take(5))
        {
            var relatedHints = GetRelatedEntryHints(playerId, entry.DefinitionId);
            if (relatedHints.Count > 0)
            {
                return relatedHints.First();
            }
        }

        return null;
    }

    /// <inheritdoc />
    public CodexHint GenerateHintFromCondition(
        CodexUnlockCondition condition,
        string? customHint = null)
    {
        // Use custom hint if provided
        if (!string.IsNullOrEmpty(customHint))
        {
            var hintType = TriggerToHintType.GetValueOrDefault(
                condition.TriggerType,
                HintType.Action);

            return CodexHint.ForDiscovery(hintType, customHint, string.Empty);
        }

        // Generate hint based on condition type
        var generatedHint = GenerateHintText(condition);
        var type = TriggerToHintType.GetValueOrDefault(condition.TriggerType, HintType.Action);

        return CodexHint.ForDiscovery(type, generatedHint, condition.TargetId);
    }

    /// <inheritdoc />
    public IReadOnlyList<CodexHint> FilterHintsByPriority(
        IReadOnlyList<CodexHint> hints,
        HintPriority minimumPriority)
    {
        return hints
            .Where(h => h.Priority >= minimumPriority)
            .OrderByDescending(h => h.Priority)
            .ToList();
    }

    /// <summary>
    /// Generates hint text from a condition.
    /// </summary>
    private string GenerateHintText(CodexUnlockCondition condition)
    {
        return condition.TriggerType switch
        {
            UnlockTriggerType.DefeatMonster when condition.Count > 1 =>
                $"Continue facing these foes in battle. ({condition.Count} encounters)",
            UnlockTriggerType.DefeatMonster =>
                "Face this creature in combat.",
            UnlockTriggerType.ExamineItem =>
                "Carefully examine relevant items.",
            UnlockTriggerType.AcquireItem =>
                "Acquire certain items to learn more.",
            UnlockTriggerType.ExploreRoom =>
                "Explore new areas to uncover this knowledge.",
            UnlockTriggerType.DialogueChoice =>
                "Speak with those who may know more.",
            UnlockTriggerType.ReadDocument =>
                "Seek wisdom in written texts.",
            UnlockTriggerType.FlagSet =>
                "Certain actions may reveal more.",
            _ => "Continue exploring to learn more."
        };
    }

    /// <summary>
    /// Generates a default fragment hint based on source type.
    /// </summary>
    private string GenerateDefaultFragmentHint(FragmentSourceType sourceType)
    {
        return sourceType switch
        {
            FragmentSourceType.Document => "Found in ancient texts and documents.",
            FragmentSourceType.Inscription => "Carved into stone in forgotten places.",
            FragmentSourceType.NPCDialogue => "Spoken by those with knowledge of the past.",
            FragmentSourceType.ItemExamination => "Hidden within artifacts and relics.",
            FragmentSourceType.EnvironmentExamination => "Revealed by careful observation.",
            FragmentSourceType.CombatDrop => "Carried by creatures of significance.",
            _ => "Lost somewhere in the depths."
        };
    }

    /// <summary>
    /// Generates a cross-reference hint for a category.
    /// </summary>
    private string GenerateCrossReferenceHint(CodexCategory category)
    {
        return category switch
        {
            CodexCategory.Bestiary => "Related creatures await discovery.",
            CodexCategory.Locations => "Connected places remain unexplored.",
            CodexCategory.ItemsAndArtifacts => "Associated items hold more knowledge.",
            CodexCategory.Characters => "Related individuals have stories untold.",
            CodexCategory.Factions => "Connected organizations operate nearby.",
            CodexCategory.History => "Historical connections remain hidden.",
            CodexCategory.Legends => "Linked myths await discovery.",
            CodexCategory.CraftingKnowledge => "Related crafting secrets exist.",
            _ => "Related knowledge awaits."
        };
    }

    /// <summary>
    /// Determines hint priority based on completion progress.
    /// </summary>
    private HintPriority DetermineHintPriority(int revealed, int total)
    {
        if (total == 0) return HintPriority.Low;

        var percent = (revealed * 100) / total;
        return percent switch
        {
            >= 75 => HintPriority.High,
            >= 50 => HintPriority.Medium,
            _ => HintPriority.Low
        };
    }
}
```

### 7.3 CodexService Updates

```csharp
// Add to ICodexService interface:

/// <summary>
/// Gets a codex entry with discovery hints.
/// </summary>
/// <param name="playerId">The player's ID.</param>
/// <param name="entryId">The entry ID.</param>
/// <returns>Entry with hints, or null if not discovered.</returns>
CodexEntryWithHintsDto? GetEntryWithHints(Guid playerId, string entryId);
```

```csharp
// Add to CodexService implementation:

private readonly ICodexHintService _hintService;

// Update constructor to inject ICodexHintService

/// <inheritdoc />
public CodexEntryWithHintsDto? GetEntryWithHints(Guid playerId, string entryId)
{
    _logger.LogDebug(
        "GetEntryWithHints called for player: {PlayerId}, entry: {EntryId}",
        playerId, entryId);

    var entry = GetDiscoveredEntries(playerId)
        .FirstOrDefault(e => e.DefinitionId.Equals(entryId, StringComparison.OrdinalIgnoreCase));

    if (entry is null)
    {
        return null;
    }

    var definition = GetCodexEntryDefinition(entryId);
    if (definition is null)
    {
        return null;
    }

    // Get visible sections
    var visibleSections = definition.GetVisibleSections(entry.RevealedSections)
        .Select(s => new CodexSectionDto
        {
            Title = s.Title,
            Content = s.Content
        })
        .ToList();

    // Get reveal hints for hidden sections
    var revealHints = _hintService.GetHintsForEntry(playerId, entryId);

    // Get related entry info
    var discoveredRelated = new List<RelatedEntryDto>();
    var relatedHints = new List<CodexHint>();

    foreach (var relatedId in definition.RelatedEntryIds)
    {
        var relatedEntry = GetDiscoveredEntries(playerId)
            .FirstOrDefault(e => e.DefinitionId.Equals(relatedId, StringComparison.OrdinalIgnoreCase));

        if (relatedEntry is not null)
        {
            var relatedDef = GetCodexEntryDefinition(relatedId);
            discoveredRelated.Add(new RelatedEntryDto
            {
                EntryId = relatedId,
                Title = relatedDef?.Title ?? relatedId,
                Category = relatedEntry.Category
            });
        }
    }

    relatedHints.AddRange(_hintService.GetRelatedEntryHints(playerId, entryId));

    return new CodexEntryWithHintsDto
    {
        EntryId = entry.DefinitionId,
        Title = entry.Title,
        Category = entry.Category,
        Sections = visibleSections,
        IsComplete = entry.IsComplete,
        CompletionPercent = entry.GetCompletionPercent(),
        RevealHints = revealHints,
        DiscoveredRelated = discoveredRelated,
        RelatedHints = relatedHints,
        IsFromFragments = entry.IsFromFragments
    };
}
```

---

## 8. Hint Generation Flow

### 8.1 Entry View with Hints

```
Player enters "codex goblin"
          │
          ▼
┌───────────────────┐
│ GameSessionService│
│ ViewCodexEntry()  │
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│   CodexService    │
│ GetEntryWithHints │
└─────────┬─────────┘
          │
          ▼
┌───────────────────────────────────────────────────────────────┐
│                    BUILD ENTRY DTO                             │
├───────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────┐                                         │
│  │ Get entry and     │                                         │
│  │ definition        │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ Get visible       │                                         │
│  │ sections          │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ CodexHintService  │                                         │
│  │ .GetHintsForEntry │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ CodexHintService  │                                         │
│  │ .GetRelatedEntry  │                                         │
│  │  Hints            │                                         │
│  └─────────┬─────────┘                                         │
│            │                                                    │
│            ▼                                                    │
│  ┌───────────────────┐                                         │
│  │ Build discovered  │                                         │
│  │ related list      │                                         │
│  └───────────────────┘                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
             │
             ▼
┌───────────────────┐
│  Return DTO to    │
│  renderer         │
└───────────────────┘
```

---

## 9. User-Facing Changes

### 9.1 Enhanced Entry Display

**Incomplete Entry with Hints:**
```
═══════════════════════════════════════════════
                    GOBLIN
              [Bestiary] - 33%
═══════════════════════════════════════════════

▓▓▓▓▓▓░░░░░░░░░░░░░░ 33% Complete

───────────────────────────────────────────────
Overview
───────────────────────────────────────────────
Goblins are small, cunning creatures that
infest the upper levels of dungeons. They are
cowardly when alone but dangerous in groups.

───────────────────────────────────────────────
                   HINTS
───────────────────────────────────────────────
To learn more about this topic:

  [Combat] Engage these creatures in combat to
           learn their vulnerabilities.

  [Combat] Extensive experience against
           goblin-kind reveals their social
           structure.

───────────────────────────────────────────────
                  SEE ALSO
───────────────────────────────────────────────
Discovered:
  (none)

To Discover:
  [?] Related creatures await discovery.
  [?] Connected places remain unexplored.

═══════════════════════════════════════════════
```

**Complete Entry:**
```
═══════════════════════════════════════════════
                    GOBLIN
            [Bestiary] - Complete
═══════════════════════════════════════════════

───────────────────────────────────────────────
Overview
───────────────────────────────────────────────
Goblins are small, cunning creatures...

───────────────────────────────────────────────
Weaknesses
───────────────────────────────────────────────
Goblins fear fire and bright light...

───────────────────────────────────────────────
Society
───────────────────────────────────────────────
Goblin tribes are led by the strongest...

───────────────────────────────────────────────
                  SEE ALSO
───────────────────────────────────────────────
Discovered:
  • Goblin Chief [Bestiary]

To Discover:
  [?] Connected places remain unexplored.

═══════════════════════════════════════════════
```

### 9.2 Fragment Collection with Hints

```
═══════════════════════════════════════════════
        THE PROPHECY OF DARKNESS
              [Legends] - 2/4
═══════════════════════════════════════════════

▓▓▓▓▓▓▓▓▓▓░░░░░░░░░░ 50% Complete

───────────────────────────────────────────────
Fragment I: The First Verse [FOUND]
───────────────────────────────────────────────
When shadows grow long and the sun turns cold...

───────────────────────────────────────────────
Fragment II: The Warning [FOUND]
───────────────────────────────────────────────
The stars shall weep tears of crimson flame...

───────────────────────────────────────────────
Fragment III: ??? [NOT YET DISCOVERED]
───────────────────────────────────────────────
  [NPC] Spoken by one who remembers the old
        ways.

───────────────────────────────────────────────
Fragment IV: ??? [NOT YET DISCOVERED]
───────────────────────────────────────────────
  [Item] Hidden within an artifact of the old
         kingdom.

═══════════════════════════════════════════════
```

---

## 10. Logging Requirements

### 10.1 Debug Logs

```
[DEBUG] GetHintsForEntry called for player: {PlayerId}, entry: {EntryId}
[DEBUG] GetHintsForFragments called for player: {PlayerId}, entry: {EntryId}
[DEBUG] GetRelatedEntryHints called for player: {PlayerId}, entry: {EntryId}
[DEBUG] GetNextDiscoveryHint called for player: {PlayerId}
[DEBUG] Generated {Count} hints for entry: {EntryId}
```

### 10.2 Info Logs

```
[INFO] CodexHintService initialized
[INFO] GetEntryWithHints returned {HintCount} hints for {EntryId}
```

### 10.3 Warning Logs

```
[WARN] Entry definition not found for hints: {EntryId}
[WARN] No reveal conditions found for hidden section: {EntryId}[{SectionIndex}]
```

---

## 11. Unit Test Specifications

### 11.1 Test Files

| File | Tests | Coverage |
|------|-------|----------|
| `CodexHintTests.cs` | ~4 | Value object creation, factory methods |
| `HintContextTests.cs` | ~3 | Context creation, factory methods |
| `CodexHintServiceTests.cs` | ~10 | Hint generation, filtering, priority |
| `CodexServiceHintIntegrationTests.cs` | ~3 | GetEntryWithHints integration |

### 11.2 CodexHintTests.cs

```csharp
[TestFixture]
public class CodexHintTests
{
    [Test]
    public void ForHiddenSection_CreatesCorrectHint()

    [Test]
    public void ForRelatedEntry_SetsContextCorrectly()

    [Test]
    public void ForFragment_SetsFragmentContext()

    [Test]
    public void ForDiscovery_SetsTargetId()
}
```

### 11.3 HintContextTests.cs

```csharp
[TestFixture]
public class HintContextTests
{
    [Test]
    public void ForSection_SetsSourceAndIndex()

    [Test]
    public void ForRelatedEntry_SetsBothEntryIds()

    [Test]
    public void ForFragment_SetsFragmentInfo()
}
```

### 11.4 CodexHintServiceTests.cs

```csharp
[TestFixture]
public class CodexHintServiceTests
{
    [Test]
    public void GetHintsForEntry_IncompleteEntry_ReturnsHints()

    [Test]
    public void GetHintsForEntry_CompleteEntry_ReturnsEmpty()

    [Test]
    public void GetHintsForEntry_UsesCustomRevealHint()

    [Test]
    public void GetHintsForFragments_MissingFragments_ReturnsHints()

    [Test]
    public void GetHintsForFragments_CompleteCollection_ReturnsEmpty()

    [Test]
    public void GetRelatedEntryHints_UndiscoveredRelated_ReturnsHints()

    [Test]
    public void GetRelatedEntryHints_AllDiscovered_ReturnsEmpty()

    [Test]
    public void GetNextDiscoveryHint_PrioritizesIncomplete()

    [Test]
    public void GenerateHintFromCondition_MapsCorrectHintType()

    [Test]
    public void FilterHintsByPriority_FiltersCorrectly()
}
```

### 11.5 CodexServiceHintIntegrationTests.cs

```csharp
[TestFixture]
public class CodexServiceHintIntegrationTests
{
    [Test]
    public void GetEntryWithHints_IncludesRevealHints()

    [Test]
    public void GetEntryWithHints_IncludesRelatedHints()

    [Test]
    public void GetEntryWithHints_IncludesDiscoveredRelated()
}
```

---

## 12. Use Cases

### UC-2.1c-1: View Entry with Reveal Hints

**Preconditions:**
- Player has discovered "goblin-bestiary" entry
- Entry is 33% complete (1 of 3 sections revealed)
- Hidden sections have reveal conditions

**Flow:**
1. Player enters `codex goblin`
2. CodexService.GetEntryWithHints called
3. CodexHintService generates hints from reveal conditions
4. DTO includes visible section + 2 hints
5. Renderer displays entry with "HINTS" section

**Postconditions:**
- Player sees visible content
- Player sees hints for unlocking more content
- Hints don't spoil hidden content

### UC-2.1c-2: View Fragment Collection with Hints

**Preconditions:**
- Player has 2 of 4 fragments for "prophecy-of-darkness"
- Missing fragments have LocationHint configured

**Flow:**
1. Player enters `codex fragments prophecy`
2. LoreFragmentService provides collection progress
3. CodexHintService generates hints for missing fragments
4. Display shows found fragments + hints for missing

**Postconditions:**
- Player sees collected fragment content
- Missing fragments show location hints
- Hints guide player toward completion

---

## 13. Acceptance Criteria

### AC-2.1c-1: Entry Reveal Hints
- [ ] Incomplete entries show "Hints" section
- [ ] Hints generated from reveal conditions
- [ ] Custom revealHint overrides generated hints
- [ ] Complete entries don't show reveal hints
- [ ] Hints don't spoil hidden content

### AC-2.1c-2: Related Entry Hints
- [ ] "See Also" shows discovered related entries
- [ ] Undiscovered related show as hints
- [ ] Hints categorized by entry type
- [ ] Already discovered entries listed by name

### AC-2.1c-3: Fragment Hints Integration
- [ ] Missing fragments show LocationHint
- [ ] Hint type matches fragment source type
- [ ] Default hints generated if no LocationHint
- [ ] Complete collections don't show fragment hints

### AC-2.1c-4: Hint Priority System
- [ ] Hints have priority (Low/Medium/High)
- [ ] Near-complete entries get High priority
- [ ] Cross-references get Low priority
- [ ] FilterHintsByPriority works correctly

### AC-2.1c-5: Next Discovery Suggestion
- [ ] GetNextDiscoveryHint returns a hint
- [ ] Prioritizes incomplete entries
- [ ] Falls back to fragment collections
- [ ] Falls back to related entries

### AC-2.1c-6: Configuration
- [ ] revealHint field added to section schema
- [ ] Custom hints load from JSON
- [ ] Empty/missing hints fall back to generated

### AC-2.1c-7: Unit Tests
- [ ] ~20 unit tests implemented
- [ ] All tests pass
- [ ] Value object, service, and integration tests included

---

## 14. Deliverable Checklist

### Domain Layer
- [ ] ValueObjects/CodexHint.cs
- [ ] ValueObjects/HintContext.cs
- [ ] Enums/HintType.cs
- [ ] Enums/HintPriority.cs
- [ ] Update ValueObjects/CodexSection.cs (add RevealHint)

### Application Layer
- [ ] Interfaces/ICodexHintService.cs
- [ ] Services/CodexHintService.cs
- [ ] DTOs/CodexEntryWithHintsDto.cs
- [ ] DTOs/RelatedEntryDto.cs
- [ ] Update Interfaces/ICodexService.cs (add GetEntryWithHints)
- [ ] Update Services/CodexService.cs (implement GetEntryWithHints)
- [ ] Update Services/GameSessionService.cs (use GetEntryWithHints)

### Infrastructure Layer
- [ ] Update config/codex-entries.json (add revealHint examples)
- [ ] Update config/schemas/codex-entries.schema.json (add revealHint)

### Presentation Layer
- [ ] Update CodexHandler (display hints)
- [ ] Update IGameRenderer (add RenderHints, RenderSeeAlso)

### Tests
- [ ] Tests/Domain/ValueObjects/CodexHintTests.cs
- [ ] Tests/Domain/ValueObjects/HintContextTests.cs
- [ ] Tests/Application/Services/CodexHintServiceTests.cs
- [ ] Tests/Application/Services/CodexServiceHintIntegrationTests.cs

### Documentation
- [ ] XML documentation on all public members

---

## 15. Dependencies

### From v0.2.1a (Codex Foundation)
| Component | Purpose for v0.2.1c |
|-----------|---------------------|
| `CodexEntry` | Entry completion status for hint generation |
| `CodexEntryDefinition` | Reveal conditions for hints |
| `CodexSection` | Extended with RevealHint |
| `CodexUnlockCondition` | Source for generated hints |
| `ICodexService` | Extended with GetEntryWithHints |
| `CodexService` | Integration point for hint service |

### From v0.2.1b (Lore Fragments)
| Component | Purpose for v0.2.1c |
|-----------|---------------------|
| `LoreFragmentDefinition` | LocationHint for fragment hints |
| `FragmentSourceType` | Maps to HintType |
| `ILoreFragmentService` | Fragment collection progress |
| `FragmentCollectionProgress` | Missing indices for hints |

---

## 16. Future Considerations

### v0.2.1d: Codex UI Enhancements
- Visual hint icons based on HintType
- Collapsible hint sections
- Hint filtering UI controls
- Progress visualization with hints

### Dynamic Hints
- Context-aware hints based on player location
- Time-based hint urgency
- Hint cooldowns to prevent spam

### Achievement Integration
- Hints for achievement-related discoveries
- Special hints for rare content

---

*This design specification establishes the Codex Hints system as the discovery guidance layer, integrating with both regular codex entries and fragment collections to help players explore the full depth of the world's lore.*
