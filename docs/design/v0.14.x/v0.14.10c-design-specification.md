# v0.14.10c Design Specification: Codex Schema

## Document Information

| Field | Value |
|-------|-------|
| **Version** | v0.14.10c |
| **Feature** | Codex Schema |
| **Status** | Draft |
| **Created** | 2026-01-17 |
| **Depends On** | v0.14.9e (Capture Template Schema), v0.14.10b (Quest Schema) |
| **Provides To** | v0.15.x (Codex Service Implementation), Journal UI System |

---

## 1. Executive Summary

### 1.1 Overview

This specification defines the Codex Schema for configuring knowledge entries, categories, and progressive revelation mechanics in Aethelgard. The Codex system serves as the player's archaeological knowledge base, assembling fragments of understanding about the pre-Blight world through Data Captures and gameplay discoveries.

The schema enables:
- **Progressive Revelation**: Entries unlock in stages (Fragment → Partial → Complete → Mastery)
- **Keyword Matching**: Data Captures auto-assign to Codex entries via keyword correlation
- **Multi-Source Unlocking**: 8 distinct unlock condition types from various gameplay systems
- **Relational Knowledge**: Entries link to related content through typed relationships
- **Category Organization**: Hierarchical categorization with subcategory support

### 1.2 Deliverables

| Deliverable | Layer | Description |
|-------------|-------|-------------|
| `codex.schema.json` | Configuration | JSON Schema Draft-07 validation schema |
| `codex.json` | Configuration | Codex entry and category definitions |
| `CodexEntry` | Schema Definition | Entry with sections, keywords, and unlock conditions |
| `CodexCategory` | Schema Definition | Category with subcategories |
| `EntrySection` | Schema Definition | Content section with unlock requirements |
| `UnlockCondition` | Schema Definition | Polymorphic unlock condition (8 types) |
| `EntryRelation` | Schema Definition | Typed relationship to other entries |
| `ProgressionLevel` | Schema Definition | Revelation stage definition |
| ~6 Unit Tests | Testing | Schema validation and loading tests |

### 1.3 Architectural Significance

The Codex Schema serves as the central knowledge repository configuration, integrating with:

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        CODEX SCHEMA INTEGRATION                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────┐     ┌──────────────────┐     ┌─────────────────┐  │
│  │  Capture Template│     │   Codex Schema   │     │  Quest Schema   │  │
│  │   (v0.14.9e)     │────▶│   (v0.14.10c)    │◀────│  (v0.14.10b)    │  │
│  │                  │     │                  │     │                 │  │
│  │  matchKeywords   │     │  - CodexEntry    │     │ QuestComplete   │  │
│  │  captureType     │     │  - Categories    │     │ unlock type     │  │
│  │                  │     │  - UnlockCond    │     │                 │  │
│  └──────────────────┘     └────────┬─────────┘     └─────────────────┘  │
│                                    │                                     │
│                           ┌────────▼─────────┐                          │
│                           │  Journal UI      │                          │
│                           │                  │                          │
│                           │  - Codex Tab     │                          │
│                           │  - Bestiary Tab  │                          │
│                           │  - Field Guide   │                          │
│                           └──────────────────┘                          │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Feature Overview

```
v0.14.10c Codex Schema
├── Schema Definitions
│   ├── CodexEntry
│   │   ├── id (kebab-case identifier)
│   │   ├── title (display name)
│   │   ├── categoryId (reference to category)
│   │   ├── era (historical period)
│   │   ├── summary (brief description)
│   │   ├── sections[] (progressive content)
│   │   ├── matchKeywords[] (capture correlation)
│   │   ├── unlockConditions[] (initial unlock)
│   │   ├── progressionLevels[] (revelation stages)
│   │   ├── relatedEntries[] (typed relationships)
│   │   └── metadata (optional extra data)
│   │
│   ├── CodexCategory
│   │   ├── id (kebab-case identifier)
│   │   ├── name (display name)
│   │   ├── description (category summary)
│   │   ├── icon (UI icon reference)
│   │   ├── sortOrder (display ordering)
│   │   └── subcategories[] (nested categories)
│   │
│   ├── EntrySection
│   │   ├── id (section identifier)
│   │   ├── title (section heading)
│   │   ├── content (markdown text)
│   │   ├── unlockThreshold (0.0-1.0)
│   │   └── captureRequirement (optional capture type)
│   │
│   ├── UnlockCondition
│   │   ├── type (8 unlock types)
│   │   └── parameters (type-specific values)
│   │
│   ├── EntryRelation
│   │   ├── entryId (target entry reference)
│   │   ├── relationType (5 relationship types)
│   │   └── description (optional context)
│   │
│   └── ProgressionLevel
│       ├── level (Fragment/Partial/Complete/Mastery)
│       ├── threshold (0.0-1.0)
│       ├── description (level meaning)
│       └── rewards[] (optional unlocks)
│
├── Configuration Files
│   ├── codex.schema.json (validation schema)
│   └── codex.json (entry definitions)
│
└── Unit Tests (~6 tests)
    ├── COD-001: Valid schema loads successfully
    ├── COD-002: Invalid entry ID rejected
    ├── COD-003: Unknown category reference rejected
    ├── COD-004: Unlock condition validation
    ├── COD-005: Progression threshold ordering
    └── COD-006: Keyword matching correlation
```

---

## 3. Architecture Diagrams

### 3.1 Codex Data Structure

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          CODEX SCHEMA STRUCTURE                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  codex.json                                                              │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                                                                    │  │
│  │  categories[]                     entries[]                        │  │
│  │  ┌─────────────────────┐         ┌─────────────────────────────┐  │  │
│  │  │ CodexCategory       │    ┌───▶│ CodexEntry                  │  │  │
│  │  │                     │    │    │                             │  │  │
│  │  │ ├─ id: "lore"       │    │    │ ├─ id: "codex-blight-001"  │  │  │
│  │  │ ├─ name: "Lore"     │◀───┼────│ ├─ categoryId: "lore"      │  │  │
│  │  │ ├─ subcategories[]  │    │    │ ├─ title: "The Blight"     │  │  │
│  │  │ │   ├─ "origins"    │    │    │ ├─ era: "pre-blight"       │  │  │
│  │  │ │   └─ "history"    │    │    │ ├─ sections[]              │  │  │
│  │  │ └─ sortOrder: 1     │    │    │ ├─ matchKeywords[]         │  │  │
│  │  └─────────────────────┘    │    │ ├─ unlockConditions[]      │  │  │
│  │                              │    │ ├─ progressionLevels[]     │  │  │
│  │  ┌─────────────────────┐    │    │ └─ relatedEntries[]        │  │  │
│  │  │ CodexCategory       │    │    └─────────────────────────────┘  │  │
│  │  │                     │    │                                      │  │
│  │  │ ├─ id: "bestiary"   │    │    ┌─────────────────────────────┐  │  │
│  │  │ ├─ name: "Bestiary" │◀───┼───▶│ CodexEntry                  │  │  │
│  │  │ └─ sortOrder: 2     │    │    │ ├─ id: "codex-beast-001"   │  │  │
│  │  └─────────────────────┘    │    │ └─ categoryId: "bestiary"  │  │  │
│  │                              │    └─────────────────────────────┘  │  │
│  │  ... (6 categories)         │                                      │  │
│  │                              │                                      │  │
│  └──────────────────────────────┴────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Progressive Revelation Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      PROGRESSIVE REVELATION SYSTEM                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Data Capture Acquired                                                   │
│         │                                                                │
│         ▼                                                                │
│  ┌──────────────────┐                                                   │
│  │ Extract Keywords │                                                   │
│  │ from Capture     │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐    ┌─────────────────────────────────────────┐   │
│  │ Match Keywords   │───▶│ CodexEntry.matchKeywords[]              │   │
│  │ Against Entries  │    │ ["blight", "origin", "catastrophe"]     │   │
│  └────────┬─────────┘    └─────────────────────────────────────────┘   │
│           │                                                              │
│           ▼                                                              │
│  ┌──────────────────┐                                                   │
│  │ Calculate        │    Progress = capturesCollected / totalRequired  │
│  │ Entry Progress   │                                                   │
│  └────────┬─────────┘                                                   │
│           │                                                              │
│           ▼                                                              │
│  ┌────────────────────────────────────────────────────────────────┐    │
│  │                    PROGRESSION LEVELS                           │    │
│  │                                                                 │    │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐   │    │
│  │  │FRAGMENT │─▶│ PARTIAL │─▶│COMPLETE │─▶│    MASTERY      │   │    │
│  │  │  0.25   │  │  0.50   │  │  0.75   │  │     1.00        │   │    │
│  │  │         │  │         │  │         │  │                 │   │    │
│  │  │ Basic   │  │ Core    │  │ Full    │  │ Expert insight  │   │    │
│  │  │ outline │  │ details │  │ content │  │ + hidden lore   │   │    │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘   │    │
│  │                                                                 │    │
│  │  Sections unlock progressively based on threshold values        │    │
│  └────────────────────────────────────────────────────────────────┘    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Unlock Condition Types

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       UNLOCK CONDITION TYPES (8)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐    │
│  │                                                                  │    │
│  │  1. CaptureCollected      4. LocationVisited    7. LevelReached │    │
│  │  ┌────────────────────┐   ┌────────────────┐   ┌──────────────┐ │    │
│  │  │ captureId: string  │   │ locationId:    │   │ minLevel:    │ │    │
│  │  │ quality?: number   │   │   string       │   │   integer    │ │    │
│  │  └────────────────────┘   └────────────────┘   └──────────────┘ │    │
│  │                                                                  │    │
│  │  2. QuestComplete         5. ItemObtained      8. ManualUnlock  │    │
│  │  ┌────────────────────┐   ┌────────────────┐   ┌──────────────┐ │    │
│  │  │ questId: string    │   │ itemId: string │   │ triggerId:   │ │    │
│  │  │ objectiveId?:      │   │ quantity?:     │   │   string     │ │    │
│  │  │   string           │   │   integer      │   │              │ │    │
│  │  └────────────────────┘   └────────────────┘   └──────────────┘ │    │
│  │                                                                  │    │
│  │  3. EnemyKilled           6. FactionReputation                  │    │
│  │  ┌────────────────────┐   ┌─────────────────────────────────┐   │    │
│  │  │ enemyId: string    │   │ factionId: string               │   │    │
│  │  │ count?: integer    │   │ minReputation: integer          │   │    │
│  │  │ bossOnly?: boolean │   │ standing?: ReputationStanding   │   │    │
│  │  └────────────────────┘   └─────────────────────────────────┘   │    │
│  │                                                                  │    │
│  └─────────────────────────────────────────────────────────────────┘    │
│                                                                          │
│  Multiple conditions use AND/OR logic via conditionLogic property        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Configuration Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      CONFIGURATION LAYER PLACEMENT                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │ PRESENTATION LAYER                                                 │  │
│  │                                                                    │  │
│  │  Journal UI ─────────────────────────────────────────────────────▶│  │
│  │    │ Displays codex entries, categories, progression              │  │
│  │    │ Renders unlocked sections, hides locked content              │  │
│  └────┼──────────────────────────────────────────────────────────────┘  │
│       │                                                                  │
│  ┌────▼──────────────────────────────────────────────────────────────┐  │
│  │ APPLICATION LAYER (v0.15.x - Future)                              │  │
│  │                                                                    │  │
│  │  ICodexService                                                     │  │
│  │    │ ├─ GetEntryById(entryId)                                     │  │
│  │    │ ├─ GetEntriesByCategory(categoryId)                          │  │
│  │    │ ├─ GetEntryProgress(entryId)                                 │  │
│  │    │ ├─ CheckUnlockConditions(entry, playerState)                 │  │
│  │    │ └─ MatchCaptureToEntries(capture)                            │  │
│  └────┼──────────────────────────────────────────────────────────────┘  │
│       │                                                                  │
│  ┌────▼──────────────────────────────────────────────────────────────┐  │
│  │ INFRASTRUCTURE LAYER                                               │  │
│  │                                                                    │  │
│  │  CodexProvider (v0.15.x - Future)                                 │  │
│  │    │ ├─ LoadFromJson(path)                                        │  │
│  │    │ ├─ ValidateAgainstSchema()                                   │  │
│  │    │ └─ BuildKeywordIndex()                                       │  │
│  └────┼──────────────────────────────────────────────────────────────┘  │
│       │                                                                  │
│  ┌────▼──────────────────────────────────────────────────────────────┐  │
│  │ CONFIGURATION LAYER ◀─────────────────── v0.14.10c (This Version) │  │
│  │                                                                    │  │
│  │  codex.schema.json                                                │  │
│  │    │ JSON Schema Draft-07 validation                              │  │
│  │    │                                                              │  │
│  │  codex.json                                                       │  │
│  │    ├─ categories[] ─── CodexCategory definitions                  │  │
│  │    └─ entries[] ────── CodexEntry definitions                     │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Schema Root Definition

### 4.1 Root Object

The root object defines the codex configuration file structure.

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "codex.schema.json",
  "title": "Codex Configuration Schema",
  "description": "Defines codex entries, categories, and progressive revelation mechanics",
  "type": "object",
  "required": ["version", "categories", "entries"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver format)",
      "examples": ["1.0.0"]
    },
    "categories": {
      "type": "array",
      "description": "Codex category definitions",
      "minItems": 1,
      "items": { "$ref": "#/definitions/CodexCategory" }
    },
    "entries": {
      "type": "array",
      "description": "Codex entry definitions",
      "items": { "$ref": "#/definitions/CodexEntry" }
    },
    "globalKeywords": {
      "type": "array",
      "description": "Keywords that apply to all entries for baseline matching",
      "items": { "type": "string" }
    },
    "progressionDefaults": {
      "$ref": "#/definitions/ProgressionDefaults",
      "description": "Default progression level thresholds"
    }
  }
}
```

### 4.2 Root Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `version` | string | Yes | Schema version in semver format |
| `categories` | array | Yes | Category definitions (min 1) |
| `entries` | array | Yes | Entry definitions |
| `globalKeywords` | array | No | Keywords for baseline matching |
| `progressionDefaults` | object | No | Default threshold values |

---

## 5. CodexEntry Definition

### 5.1 Entry Schema

```json
{
  "CodexEntry": {
    "type": "object",
    "description": "A codex entry representing a piece of world knowledge",
    "required": ["id", "categoryId", "title", "sections"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^codex-[a-z][a-z0-9-]*-\\d{3}$",
        "description": "Unique entry identifier (codex-{category}-{number})",
        "examples": ["codex-blight-001", "codex-beast-012", "codex-faction-003"]
      },
      "categoryId": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$",
        "description": "Reference to parent category"
      },
      "subcategoryId": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$",
        "description": "Optional reference to subcategory"
      },
      "title": {
        "type": "string",
        "minLength": 1,
        "maxLength": 100,
        "description": "Display title for the entry"
      },
      "era": {
        "type": "string",
        "enum": ["pre-blight", "blight", "post-blight", "unknown"],
        "description": "Historical era the entry pertains to"
      },
      "summary": {
        "type": "string",
        "maxLength": 500,
        "description": "Brief entry summary shown in list views"
      },
      "sections": {
        "type": "array",
        "description": "Progressive content sections",
        "minItems": 1,
        "items": { "$ref": "#/definitions/EntrySection" }
      },
      "matchKeywords": {
        "type": "array",
        "description": "Keywords for Data Capture correlation",
        "items": {
          "type": "string",
          "minLength": 2,
          "maxLength": 50
        },
        "minItems": 1,
        "uniqueItems": true
      },
      "unlockConditions": {
        "type": "array",
        "description": "Conditions required to initially reveal entry",
        "items": { "$ref": "#/definitions/UnlockCondition" }
      },
      "conditionLogic": {
        "type": "string",
        "enum": ["and", "or"],
        "default": "or",
        "description": "Logic for combining multiple unlock conditions"
      },
      "progressionLevels": {
        "type": "array",
        "description": "Custom progression thresholds for this entry",
        "items": { "$ref": "#/definitions/ProgressionLevel" }
      },
      "relatedEntries": {
        "type": "array",
        "description": "Typed relationships to other entries",
        "items": { "$ref": "#/definitions/EntryRelation" }
      },
      "totalFragments": {
        "type": "integer",
        "minimum": 1,
        "maximum": 20,
        "default": 4,
        "description": "Total capture fragments required for completion"
      },
      "legendValue": {
        "type": "integer",
        "minimum": 1,
        "maximum": 100,
        "default": 10,
        "description": "Legend progression reward upon completion"
      },
      "icon": {
        "type": "string",
        "description": "Icon asset reference for UI display"
      },
      "imageAsset": {
        "type": "string",
        "description": "Full illustration asset path"
      },
      "sortPriority": {
        "type": "integer",
        "default": 0,
        "description": "Sort order within category (higher = first)"
      },
      "hidden": {
        "type": "boolean",
        "default": false,
        "description": "If true, entry is hidden until first unlock condition met"
      },
      "metadata": {
        "type": "object",
        "description": "Optional extensible metadata",
        "additionalProperties": true
      }
    }
  }
}
```

### 5.2 Entry Properties Reference

| Property | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `id` | string | Yes | - | Unique identifier following `codex-{cat}-{num}` pattern |
| `categoryId` | string | Yes | - | Parent category reference |
| `subcategoryId` | string | No | - | Optional subcategory reference |
| `title` | string | Yes | - | Display title (1-100 chars) |
| `era` | enum | No | - | Historical era classification |
| `summary` | string | No | - | Brief description (max 500 chars) |
| `sections` | array | Yes | - | Progressive content sections (min 1) |
| `matchKeywords` | array | No | - | Keywords for capture matching |
| `unlockConditions` | array | No | - | Initial unlock requirements |
| `conditionLogic` | enum | No | `"or"` | How to combine conditions |
| `progressionLevels` | array | No | - | Custom progression thresholds |
| `relatedEntries` | array | No | - | Typed relationships |
| `totalFragments` | integer | No | `4` | Required captures (1-20) |
| `legendValue` | integer | No | `10` | Legend reward (1-100) |
| `icon` | string | No | - | Icon asset path |
| `imageAsset` | string | No | - | Full illustration path |
| `sortPriority` | integer | No | `0` | Category sort order |
| `hidden` | boolean | No | `false` | Hide until unlocked |
| `metadata` | object | No | - | Extensible metadata |

---

## 6. CodexCategory Definition

### 6.1 Category Schema

```json
{
  "CodexCategory": {
    "type": "object",
    "description": "A codex category for organizing entries",
    "required": ["id", "name"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$",
        "description": "Unique category identifier",
        "examples": ["lore", "bestiary", "items", "locations", "characters", "mechanics"]
      },
      "name": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50,
        "description": "Display name for the category"
      },
      "description": {
        "type": "string",
        "maxLength": 200,
        "description": "Brief category description"
      },
      "icon": {
        "type": "string",
        "description": "Icon asset reference"
      },
      "sortOrder": {
        "type": "integer",
        "minimum": 0,
        "default": 0,
        "description": "Display ordering (lower = first)"
      },
      "subcategories": {
        "type": "array",
        "description": "Nested subcategories",
        "items": { "$ref": "#/definitions/CodexSubcategory" }
      },
      "defaultExpanded": {
        "type": "boolean",
        "default": true,
        "description": "Whether category is expanded by default in UI"
      },
      "hidden": {
        "type": "boolean",
        "default": false,
        "description": "If true, category hidden until it has unlocked entries"
      }
    }
  }
}
```

### 6.2 Subcategory Schema

```json
{
  "CodexSubcategory": {
    "type": "object",
    "description": "A subcategory within a codex category",
    "required": ["id", "name"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^[a-z][a-z0-9-]*$",
        "description": "Unique subcategory identifier within parent"
      },
      "name": {
        "type": "string",
        "minLength": 1,
        "maxLength": 50,
        "description": "Display name"
      },
      "description": {
        "type": "string",
        "maxLength": 200,
        "description": "Brief description"
      },
      "sortOrder": {
        "type": "integer",
        "minimum": 0,
        "default": 0,
        "description": "Display ordering within parent"
      }
    }
  }
}
```

### 6.3 Standard Categories

The following six standard categories are defined per the scope breakdown:

| Category ID | Name | Description |
|-------------|------|-------------|
| `lore` | Lore | Historical events, myths, and world history |
| `bestiary` | Bestiary | Creatures, enemies, and wildlife |
| `items` | Items | Equipment, artifacts, and consumables |
| `locations` | Locations | Places, regions, and landmarks |
| `characters` | Characters | Notable NPCs and historical figures |
| `mechanics` | Mechanics | Game systems and runic crafting knowledge |

---

## 7. EntrySection Definition

### 7.1 Section Schema

```json
{
  "EntrySection": {
    "type": "object",
    "description": "A content section within a codex entry",
    "required": ["id", "title", "content", "unlockThreshold"],
    "additionalProperties": false,
    "properties": {
      "id": {
        "type": "string",
        "pattern": "^section-[a-z][a-z0-9-]*$",
        "description": "Unique section identifier within entry",
        "examples": ["section-overview", "section-origins", "section-weakness"]
      },
      "title": {
        "type": "string",
        "minLength": 1,
        "maxLength": 100,
        "description": "Section heading"
      },
      "content": {
        "type": "string",
        "minLength": 1,
        "description": "Section content (supports markdown)"
      },
      "unlockThreshold": {
        "type": "number",
        "minimum": 0.0,
        "maximum": 1.0,
        "description": "Progress threshold required to reveal section (0.0-1.0)"
      },
      "captureRequirement": {
        "type": "string",
        "enum": [
          "TextFragment",
          "EchoRecording",
          "VisualRecord",
          "Specimen",
          "OralHistory",
          "RunicTrace"
        ],
        "description": "Optional specific capture type required"
      },
      "sortOrder": {
        "type": "integer",
        "minimum": 0,
        "default": 0,
        "description": "Display ordering within entry"
      },
      "spoilerLevel": {
        "type": "string",
        "enum": ["none", "minor", "major"],
        "default": "none",
        "description": "Spoiler classification for UI warnings"
      }
    }
  }
}
```

### 7.2 Section Threshold Guidelines

| Threshold | Level | Content Type |
|-----------|-------|--------------|
| `0.00` | Initial | Always visible once entry unlocked |
| `0.25` | Fragment | Basic overview and introduction |
| `0.50` | Partial | Core details and primary information |
| `0.75` | Complete | Full content with advanced details |
| `1.00` | Mastery | Expert insights, hidden lore, secrets |

---

## 8. UnlockCondition Definition

### 8.1 Polymorphic Condition Schema

```json
{
  "UnlockCondition": {
    "type": "object",
    "description": "A condition that must be met to unlock an entry or section",
    "required": ["type"],
    "oneOf": [
      { "$ref": "#/definitions/CaptureCollectedCondition" },
      { "$ref": "#/definitions/QuestCompleteCondition" },
      { "$ref": "#/definitions/EnemyKilledCondition" },
      { "$ref": "#/definitions/LocationVisitedCondition" },
      { "$ref": "#/definitions/ItemObtainedCondition" },
      { "$ref": "#/definitions/FactionReputationCondition" },
      { "$ref": "#/definitions/LevelReachedCondition" },
      { "$ref": "#/definitions/ManualUnlockCondition" }
    ]
  }
}
```

### 8.2 Condition Type Definitions

#### CaptureCollectedCondition

```json
{
  "CaptureCollectedCondition": {
    "type": "object",
    "description": "Unlocks when a specific Data Capture is collected",
    "required": ["type", "captureId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "CaptureCollected"
      },
      "captureId": {
        "type": "string",
        "pattern": "^cap-[a-z][a-z0-9-]*-\\d{3}$",
        "description": "Reference to capture template ID"
      },
      "minQuality": {
        "type": "integer",
        "minimum": 1,
        "maximum": 100,
        "description": "Minimum quality value required"
      }
    }
  }
}
```

#### QuestCompleteCondition

```json
{
  "QuestCompleteCondition": {
    "type": "object",
    "description": "Unlocks when a quest or objective is completed",
    "required": ["type", "questId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "QuestComplete"
      },
      "questId": {
        "type": "string",
        "pattern": "^quest-[a-z][a-z0-9-]*-\\d{3}$",
        "description": "Reference to quest ID (from v0.14.10b)"
      },
      "objectiveId": {
        "type": "string",
        "pattern": "^obj-[a-z][a-z0-9-]*$",
        "description": "Optional specific objective within quest"
      }
    }
  }
}
```

#### EnemyKilledCondition

```json
{
  "EnemyKilledCondition": {
    "type": "object",
    "description": "Unlocks when enemies of a type are defeated",
    "required": ["type", "enemyId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "EnemyKilled"
      },
      "enemyId": {
        "type": "string",
        "pattern": "^enemy-[a-z][a-z0-9-]*$",
        "description": "Reference to enemy definition ID"
      },
      "count": {
        "type": "integer",
        "minimum": 1,
        "default": 1,
        "description": "Number of kills required"
      },
      "bossOnly": {
        "type": "boolean",
        "default": false,
        "description": "If true, only boss variants count"
      }
    }
  }
}
```

#### LocationVisitedCondition

```json
{
  "LocationVisitedCondition": {
    "type": "object",
    "description": "Unlocks when a location is discovered",
    "required": ["type", "locationId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "LocationVisited"
      },
      "locationId": {
        "type": "string",
        "pattern": "^loc-[a-z][a-z0-9-]*$",
        "description": "Reference to location definition ID"
      }
    }
  }
}
```

#### ItemObtainedCondition

```json
{
  "ItemObtainedCondition": {
    "type": "object",
    "description": "Unlocks when an item is obtained",
    "required": ["type", "itemId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "ItemObtained"
      },
      "itemId": {
        "type": "string",
        "pattern": "^item-[a-z][a-z0-9-]*$",
        "description": "Reference to item definition ID"
      },
      "quantity": {
        "type": "integer",
        "minimum": 1,
        "default": 1,
        "description": "Quantity required"
      }
    }
  }
}
```

#### FactionReputationCondition

```json
{
  "FactionReputationCondition": {
    "type": "object",
    "description": "Unlocks when faction reputation threshold is reached",
    "required": ["type", "factionId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "FactionReputation"
      },
      "factionId": {
        "type": "string",
        "pattern": "^faction-[a-z][a-z0-9-]*$",
        "description": "Reference to faction ID (from v0.14.10a)"
      },
      "minReputation": {
        "type": "integer",
        "minimum": -1000,
        "maximum": 1000,
        "description": "Minimum reputation value required"
      },
      "standing": {
        "type": "string",
        "enum": ["Hostile", "Unfriendly", "Neutral", "Friendly", "Honored", "Revered", "Exalted"],
        "description": "Alternative: minimum standing tier required"
      }
    }
  }
}
```

#### LevelReachedCondition

```json
{
  "LevelReachedCondition": {
    "type": "object",
    "description": "Unlocks when player reaches a level",
    "required": ["type", "minLevel"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "LevelReached"
      },
      "minLevel": {
        "type": "integer",
        "minimum": 1,
        "maximum": 100,
        "description": "Minimum player level required"
      }
    }
  }
}
```

#### ManualUnlockCondition

```json
{
  "ManualUnlockCondition": {
    "type": "object",
    "description": "Unlocks via script or game event trigger",
    "required": ["type", "triggerId"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "const": "ManualUnlock"
      },
      "triggerId": {
        "type": "string",
        "pattern": "^trigger-[a-z][a-z0-9-]*$",
        "description": "Script trigger identifier"
      },
      "description": {
        "type": "string",
        "description": "Human-readable description of unlock trigger"
      }
    }
  }
}
```

### 8.3 Unlock Types Summary

| Type | Parameters | Description |
|------|------------|-------------|
| `CaptureCollected` | captureId, minQuality? | Data Capture obtained |
| `QuestComplete` | questId, objectiveId? | Quest or objective completed |
| `EnemyKilled` | enemyId, count?, bossOnly? | Enemy defeats |
| `LocationVisited` | locationId | Location discovered |
| `ItemObtained` | itemId, quantity? | Item acquired |
| `FactionReputation` | factionId, minReputation/standing | Faction standing |
| `LevelReached` | minLevel | Player level threshold |
| `ManualUnlock` | triggerId | Script/event trigger |

---

## 9. EntryRelation Definition

### 9.1 Relation Schema

```json
{
  "EntryRelation": {
    "type": "object",
    "description": "A typed relationship to another codex entry",
    "required": ["entryId", "relationType"],
    "additionalProperties": false,
    "properties": {
      "entryId": {
        "type": "string",
        "pattern": "^codex-[a-z][a-z0-9-]*-\\d{3}$",
        "description": "Reference to related entry ID"
      },
      "relationType": {
        "type": "string",
        "enum": ["SeeAlso", "Prerequisite", "Sequel", "Contradiction", "Expansion"],
        "description": "Type of relationship"
      },
      "description": {
        "type": "string",
        "maxLength": 200,
        "description": "Optional context for the relationship"
      },
      "bidirectional": {
        "type": "boolean",
        "default": false,
        "description": "If true, relationship applies in both directions"
      },
      "spoilerWarning": {
        "type": "boolean",
        "default": false,
        "description": "If true, UI shows spoiler warning before revealing"
      }
    }
  }
}
```

### 9.2 Relation Types

| Relation Type | Description | Typical Use |
|---------------|-------------|-------------|
| `SeeAlso` | General related content | Cross-references between topics |
| `Prerequisite` | Should read before this entry | Foundational knowledge |
| `Sequel` | Continues this entry's topic | Chronological/logical sequence |
| `Contradiction` | Contains conflicting information | Unreliable narrators, propaganda |
| `Expansion` | Provides additional detail | Deep-dive supplementary content |

---

## 10. ProgressionLevel Definition

### 10.1 Progression Schema

```json
{
  "ProgressionLevel": {
    "type": "object",
    "description": "A progression stage for entry revelation",
    "required": ["level", "threshold"],
    "additionalProperties": false,
    "properties": {
      "level": {
        "type": "string",
        "enum": ["Fragment", "Partial", "Complete", "Mastery"],
        "description": "Progression level name"
      },
      "threshold": {
        "type": "number",
        "minimum": 0.0,
        "maximum": 1.0,
        "description": "Progress value required (0.0-1.0)"
      },
      "description": {
        "type": "string",
        "maxLength": 200,
        "description": "Description of what this level represents"
      },
      "rewards": {
        "type": "array",
        "description": "Optional rewards granted at this level",
        "items": { "$ref": "#/definitions/ProgressionReward" }
      },
      "uiStyle": {
        "type": "string",
        "description": "Optional UI style class for this level"
      }
    }
  }
}
```

### 10.2 ProgressionReward Schema

```json
{
  "ProgressionReward": {
    "type": "object",
    "description": "A reward granted upon reaching a progression level",
    "required": ["type"],
    "additionalProperties": false,
    "properties": {
      "type": {
        "type": "string",
        "enum": ["Legend", "Achievement", "Unlock", "Item"],
        "description": "Reward type"
      },
      "value": {
        "type": "integer",
        "description": "Numeric value (e.g., Legend points)"
      },
      "referenceId": {
        "type": "string",
        "description": "Reference ID for achievements/items"
      }
    }
  }
}
```

### 10.3 Default Progression Levels

```json
{
  "ProgressionDefaults": {
    "type": "object",
    "description": "Default progression level configuration",
    "additionalProperties": false,
    "properties": {
      "levels": {
        "type": "array",
        "items": { "$ref": "#/definitions/ProgressionLevel" },
        "default": [
          {
            "level": "Fragment",
            "threshold": 0.25,
            "description": "Basic outline and introduction"
          },
          {
            "level": "Partial",
            "threshold": 0.50,
            "description": "Core details and primary information"
          },
          {
            "level": "Complete",
            "threshold": 0.75,
            "description": "Full content with advanced details"
          },
          {
            "level": "Mastery",
            "threshold": 1.00,
            "description": "Expert insights and hidden lore"
          }
        ]
      }
    }
  }
}
```

---

## 11. Configuration Schema

### 11.1 Complete JSON Schema (codex.schema.json)

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "codex.schema.json",
  "title": "Codex Configuration Schema",
  "description": "Defines codex entries, categories, and progressive revelation mechanics for the Scavenger's Journal",
  "type": "object",
  "required": ["version", "categories", "entries"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver format)",
      "examples": ["1.0.0"]
    },
    "categories": {
      "type": "array",
      "description": "Codex category definitions",
      "minItems": 1,
      "items": { "$ref": "#/definitions/CodexCategory" }
    },
    "entries": {
      "type": "array",
      "description": "Codex entry definitions",
      "items": { "$ref": "#/definitions/CodexEntry" }
    },
    "globalKeywords": {
      "type": "array",
      "description": "Keywords that apply to all entries for baseline matching",
      "items": { "type": "string" }
    },
    "progressionDefaults": {
      "$ref": "#/definitions/ProgressionDefaults",
      "description": "Default progression level thresholds"
    }
  },
  "definitions": {
    "CodexCategory": {
      "type": "object",
      "description": "A codex category for organizing entries",
      "required": ["id", "name"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique category identifier"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "Display name for the category"
        },
        "description": {
          "type": "string",
          "maxLength": 200,
          "description": "Brief category description"
        },
        "icon": {
          "type": "string",
          "description": "Icon asset reference"
        },
        "sortOrder": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Display ordering (lower = first)"
        },
        "subcategories": {
          "type": "array",
          "description": "Nested subcategories",
          "items": { "$ref": "#/definitions/CodexSubcategory" }
        },
        "defaultExpanded": {
          "type": "boolean",
          "default": true,
          "description": "Whether category is expanded by default in UI"
        },
        "hidden": {
          "type": "boolean",
          "default": false,
          "description": "If true, category hidden until it has unlocked entries"
        }
      }
    },
    "CodexSubcategory": {
      "type": "object",
      "description": "A subcategory within a codex category",
      "required": ["id", "name"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique subcategory identifier within parent"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "Display name"
        },
        "description": {
          "type": "string",
          "maxLength": 200,
          "description": "Brief description"
        },
        "sortOrder": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Display ordering within parent"
        }
      }
    },
    "CodexEntry": {
      "type": "object",
      "description": "A codex entry representing a piece of world knowledge",
      "required": ["id", "categoryId", "title", "sections"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^codex-[a-z][a-z0-9-]*-\\d{3}$",
          "description": "Unique entry identifier"
        },
        "categoryId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Reference to parent category"
        },
        "subcategoryId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Optional reference to subcategory"
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Display title for the entry"
        },
        "era": {
          "type": "string",
          "enum": ["pre-blight", "blight", "post-blight", "unknown"],
          "description": "Historical era the entry pertains to"
        },
        "summary": {
          "type": "string",
          "maxLength": 500,
          "description": "Brief entry summary shown in list views"
        },
        "sections": {
          "type": "array",
          "description": "Progressive content sections",
          "minItems": 1,
          "items": { "$ref": "#/definitions/EntrySection" }
        },
        "matchKeywords": {
          "type": "array",
          "description": "Keywords for Data Capture correlation",
          "items": {
            "type": "string",
            "minLength": 2,
            "maxLength": 50
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "unlockConditions": {
          "type": "array",
          "description": "Conditions required to initially reveal entry",
          "items": { "$ref": "#/definitions/UnlockCondition" }
        },
        "conditionLogic": {
          "type": "string",
          "enum": ["and", "or"],
          "default": "or",
          "description": "Logic for combining multiple unlock conditions"
        },
        "progressionLevels": {
          "type": "array",
          "description": "Custom progression thresholds for this entry",
          "items": { "$ref": "#/definitions/ProgressionLevel" }
        },
        "relatedEntries": {
          "type": "array",
          "description": "Typed relationships to other entries",
          "items": { "$ref": "#/definitions/EntryRelation" }
        },
        "totalFragments": {
          "type": "integer",
          "minimum": 1,
          "maximum": 20,
          "default": 4,
          "description": "Total capture fragments required for completion"
        },
        "legendValue": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 10,
          "description": "Legend progression reward upon completion"
        },
        "icon": {
          "type": "string",
          "description": "Icon asset reference for UI display"
        },
        "imageAsset": {
          "type": "string",
          "description": "Full illustration asset path"
        },
        "sortPriority": {
          "type": "integer",
          "default": 0,
          "description": "Sort order within category (higher = first)"
        },
        "hidden": {
          "type": "boolean",
          "default": false,
          "description": "If true, entry is hidden until first unlock condition met"
        },
        "metadata": {
          "type": "object",
          "description": "Optional extensible metadata",
          "additionalProperties": true
        }
      }
    },
    "EntrySection": {
      "type": "object",
      "description": "A content section within a codex entry",
      "required": ["id", "title", "content", "unlockThreshold"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^section-[a-z][a-z0-9-]*$",
          "description": "Unique section identifier within entry"
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Section heading"
        },
        "content": {
          "type": "string",
          "minLength": 1,
          "description": "Section content (supports markdown)"
        },
        "unlockThreshold": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Progress threshold required to reveal section"
        },
        "captureRequirement": {
          "type": "string",
          "enum": [
            "TextFragment",
            "EchoRecording",
            "VisualRecord",
            "Specimen",
            "OralHistory",
            "RunicTrace"
          ],
          "description": "Optional specific capture type required"
        },
        "sortOrder": {
          "type": "integer",
          "minimum": 0,
          "default": 0,
          "description": "Display ordering within entry"
        },
        "spoilerLevel": {
          "type": "string",
          "enum": ["none", "minor", "major"],
          "default": "none",
          "description": "Spoiler classification for UI warnings"
        }
      }
    },
    "UnlockCondition": {
      "type": "object",
      "description": "A condition that must be met to unlock content",
      "required": ["type"],
      "oneOf": [
        {
          "properties": {
            "type": { "const": "CaptureCollected" },
            "captureId": {
              "type": "string",
              "pattern": "^cap-[a-z][a-z0-9-]*-\\d{3}$"
            },
            "minQuality": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          },
          "required": ["type", "captureId"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "QuestComplete" },
            "questId": {
              "type": "string",
              "pattern": "^quest-[a-z][a-z0-9-]*-\\d{3}$"
            },
            "objectiveId": {
              "type": "string",
              "pattern": "^obj-[a-z][a-z0-9-]*$"
            }
          },
          "required": ["type", "questId"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "EnemyKilled" },
            "enemyId": {
              "type": "string",
              "pattern": "^enemy-[a-z][a-z0-9-]*$"
            },
            "count": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            },
            "bossOnly": {
              "type": "boolean",
              "default": false
            }
          },
          "required": ["type", "enemyId"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "LocationVisited" },
            "locationId": {
              "type": "string",
              "pattern": "^loc-[a-z][a-z0-9-]*$"
            }
          },
          "required": ["type", "locationId"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "ItemObtained" },
            "itemId": {
              "type": "string",
              "pattern": "^item-[a-z][a-z0-9-]*$"
            },
            "quantity": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          "required": ["type", "itemId"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "FactionReputation" },
            "factionId": {
              "type": "string",
              "pattern": "^faction-[a-z][a-z0-9-]*$"
            },
            "minReputation": {
              "type": "integer",
              "minimum": -1000,
              "maximum": 1000
            },
            "standing": {
              "type": "string",
              "enum": ["Hostile", "Unfriendly", "Neutral", "Friendly", "Honored", "Revered", "Exalted"]
            }
          },
          "required": ["type", "factionId"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "LevelReached" },
            "minLevel": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          },
          "required": ["type", "minLevel"],
          "additionalProperties": false
        },
        {
          "properties": {
            "type": { "const": "ManualUnlock" },
            "triggerId": {
              "type": "string",
              "pattern": "^trigger-[a-z][a-z0-9-]*$"
            },
            "description": {
              "type": "string"
            }
          },
          "required": ["type", "triggerId"],
          "additionalProperties": false
        }
      ]
    },
    "EntryRelation": {
      "type": "object",
      "description": "A typed relationship to another codex entry",
      "required": ["entryId", "relationType"],
      "additionalProperties": false,
      "properties": {
        "entryId": {
          "type": "string",
          "pattern": "^codex-[a-z][a-z0-9-]*-\\d{3}$",
          "description": "Reference to related entry ID"
        },
        "relationType": {
          "type": "string",
          "enum": ["SeeAlso", "Prerequisite", "Sequel", "Contradiction", "Expansion"],
          "description": "Type of relationship"
        },
        "description": {
          "type": "string",
          "maxLength": 200,
          "description": "Optional context for the relationship"
        },
        "bidirectional": {
          "type": "boolean",
          "default": false,
          "description": "If true, relationship applies in both directions"
        },
        "spoilerWarning": {
          "type": "boolean",
          "default": false,
          "description": "If true, UI shows spoiler warning before revealing"
        }
      }
    },
    "ProgressionLevel": {
      "type": "object",
      "description": "A progression stage for entry revelation",
      "required": ["level", "threshold"],
      "additionalProperties": false,
      "properties": {
        "level": {
          "type": "string",
          "enum": ["Fragment", "Partial", "Complete", "Mastery"],
          "description": "Progression level name"
        },
        "threshold": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Progress value required (0.0-1.0)"
        },
        "description": {
          "type": "string",
          "maxLength": 200,
          "description": "Description of what this level represents"
        },
        "rewards": {
          "type": "array",
          "description": "Optional rewards granted at this level",
          "items": { "$ref": "#/definitions/ProgressionReward" }
        },
        "uiStyle": {
          "type": "string",
          "description": "Optional UI style class for this level"
        }
      }
    },
    "ProgressionReward": {
      "type": "object",
      "description": "A reward granted upon reaching a progression level",
      "required": ["type"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["Legend", "Achievement", "Unlock", "Item"],
          "description": "Reward type"
        },
        "value": {
          "type": "integer",
          "description": "Numeric value (e.g., Legend points)"
        },
        "referenceId": {
          "type": "string",
          "description": "Reference ID for achievements/items"
        }
      }
    },
    "ProgressionDefaults": {
      "type": "object",
      "description": "Default progression level configuration",
      "additionalProperties": false,
      "properties": {
        "levels": {
          "type": "array",
          "items": { "$ref": "#/definitions/ProgressionLevel" }
        }
      }
    }
  }
}
```

---

## 12. Example Configuration File

### 12.1 codex.json Example

```json
{
  "$schema": "./codex.schema.json",
  "version": "1.0.0",
  "progressionDefaults": {
    "levels": [
      {
        "level": "Fragment",
        "threshold": 0.25,
        "description": "Basic outline and introduction",
        "rewards": [{ "type": "Legend", "value": 5 }]
      },
      {
        "level": "Partial",
        "threshold": 0.50,
        "description": "Core details and primary information",
        "rewards": [{ "type": "Legend", "value": 10 }]
      },
      {
        "level": "Complete",
        "threshold": 0.75,
        "description": "Full content with advanced details",
        "rewards": [{ "type": "Legend", "value": 15 }]
      },
      {
        "level": "Mastery",
        "threshold": 1.00,
        "description": "Expert insights and hidden lore",
        "rewards": [
          { "type": "Legend", "value": 25 },
          { "type": "Achievement", "referenceId": "achieve-loremaster" }
        ]
      }
    ]
  },
  "categories": [
    {
      "id": "lore",
      "name": "Lore",
      "description": "Historical events, myths, and world history",
      "icon": "icon-lore-book",
      "sortOrder": 1,
      "subcategories": [
        { "id": "origins", "name": "Origins", "sortOrder": 1 },
        { "id": "history", "name": "History", "sortOrder": 2 },
        { "id": "myths", "name": "Myths & Legends", "sortOrder": 3 }
      ]
    },
    {
      "id": "bestiary",
      "name": "Bestiary",
      "description": "Creatures, enemies, and wildlife of Aethelgard",
      "icon": "icon-bestiary",
      "sortOrder": 2,
      "subcategories": [
        { "id": "blighted", "name": "Blighted Creatures", "sortOrder": 1 },
        { "id": "wildlife", "name": "Wildlife", "sortOrder": 2 },
        { "id": "constructs", "name": "Constructs", "sortOrder": 3 }
      ]
    },
    {
      "id": "items",
      "name": "Items",
      "description": "Equipment, artifacts, and consumables",
      "icon": "icon-items",
      "sortOrder": 3
    },
    {
      "id": "locations",
      "name": "Locations",
      "description": "Places, regions, and landmarks",
      "icon": "icon-map",
      "sortOrder": 4
    },
    {
      "id": "characters",
      "name": "Characters",
      "description": "Notable NPCs and historical figures",
      "icon": "icon-characters",
      "sortOrder": 5
    },
    {
      "id": "mechanics",
      "name": "Mechanics",
      "description": "Game systems and runic crafting knowledge",
      "icon": "icon-gears",
      "sortOrder": 6,
      "hidden": true
    }
  ],
  "entries": [
    {
      "id": "codex-blight-001",
      "categoryId": "lore",
      "subcategoryId": "origins",
      "title": "The Blight: Origin Unknown",
      "era": "blight",
      "summary": "The catastrophic event that ended the old world and birthed the twisted landscape of today.",
      "totalFragments": 6,
      "legendValue": 25,
      "icon": "icon-blight",
      "matchKeywords": ["blight", "catastrophe", "origin", "corruption", "old world"],
      "unlockConditions": [
        {
          "type": "CaptureCollected",
          "captureId": "cap-blight-origin-001"
        }
      ],
      "sections": [
        {
          "id": "section-overview",
          "title": "What We Know",
          "content": "The Blight came without warning. In a single night, the great cities fell silent, their populations transformed into something... other. The survivors speak of a spreading darkness, a corruption that twisted flesh and stone alike.",
          "unlockThreshold": 0.0,
          "sortOrder": 1
        },
        {
          "id": "section-theories",
          "title": "Scholar Theories",
          "content": "Three primary theories persist among the learned of the Hollow Covenant:\n\n1. **The Runic Collapse** - An experiment with Elder Runes triggered a cascade failure\n2. **The Breach** - Something broke through from another realm\n3. **The Awakening** - An ancient entity, long dormant, finally stirred\n\nNone have been proven. Perhaps none can be.",
          "unlockThreshold": 0.25,
          "sortOrder": 2
        },
        {
          "id": "section-witnesses",
          "title": "Witness Accounts",
          "content": "Echo recordings from the first days are fragmentary at best. Most who witnessed the initial outbreak did not survive long enough to create lasting records. Those that exist speak of the sky turning to brass, of the ground weeping black ichor.",
          "unlockThreshold": 0.50,
          "captureRequirement": "EchoRecording",
          "sortOrder": 3
        },
        {
          "id": "section-patterns",
          "title": "Spread Patterns",
          "content": "The Blight did not spread uniformly. Some regions fell within hours; others held for weeks. The pattern suggests intentionality—or perhaps resistance from unknown sources. The Iron Covenant's fortress held longest, though at terrible cost.",
          "unlockThreshold": 0.75,
          "sortOrder": 4
        },
        {
          "id": "section-truth",
          "title": "The Hidden Truth",
          "content": "Deep within the Hollow Covenant's restricted archives lies a single phrase, repeated across a dozen ancient texts: *'They knew. They always knew.'*\n\nWho 'they' were, and what they knew, remains the greatest mystery of our age.",
          "unlockThreshold": 1.0,
          "spoilerLevel": "major",
          "sortOrder": 5
        }
      ],
      "relatedEntries": [
        {
          "entryId": "codex-lore-002",
          "relationType": "Sequel",
          "description": "The aftermath of the Blight"
        },
        {
          "entryId": "codex-faction-001",
          "relationType": "SeeAlso",
          "description": "The Hollow Covenant's research"
        }
      ]
    },
    {
      "id": "codex-beast-001",
      "categoryId": "bestiary",
      "subcategoryId": "blighted",
      "title": "Hollow Stalker",
      "era": "post-blight",
      "summary": "A common predator born of Blight corruption, hunting in the ruins of the old world.",
      "totalFragments": 4,
      "legendValue": 10,
      "icon": "icon-beast-stalker",
      "matchKeywords": ["stalker", "hollow", "predator", "blighted", "ruins"],
      "unlockConditions": [
        {
          "type": "EnemyKilled",
          "enemyId": "enemy-hollow-stalker",
          "count": 1
        }
      ],
      "sections": [
        {
          "id": "section-appearance",
          "title": "Appearance",
          "content": "The Hollow Stalker appears as a twisted quadruped, its body elongated and joints bending at unnatural angles. Its skin is a mottled gray, stretched thin over visible ribs and spine. Where eyes should be, only hollow sockets remain—yet it sees with terrible precision.",
          "unlockThreshold": 0.0,
          "sortOrder": 1
        },
        {
          "id": "section-behavior",
          "title": "Behavior",
          "content": "Stalkers hunt in packs of three to seven. They communicate through subsonic clicks inaudible to human ears. A lone Stalker is rarely truly alone—its packmates lurk nearby, waiting for the prey to commit to an attack.",
          "unlockThreshold": 0.25,
          "sortOrder": 2
        },
        {
          "id": "section-weaknesses",
          "title": "Weaknesses",
          "content": "Fire disrupts their coordination. Bright light blinds their empty sockets momentarily. Strike the spine where it curves most sharply—the bone is thin there, and a solid blow can sever their connection to the pack mind.",
          "unlockThreshold": 0.50,
          "sortOrder": 3
        },
        {
          "id": "section-origin",
          "title": "Origin",
          "content": "Before the Blight, these were hunting hounds—loyal companions bred for tracking game through dense forests. The corruption hollowed out their loyalty along with their eyes, leaving only hunger.",
          "unlockThreshold": 1.0,
          "captureRequirement": "Specimen",
          "sortOrder": 4
        }
      ],
      "relatedEntries": [
        {
          "entryId": "codex-beast-002",
          "relationType": "SeeAlso",
          "description": "Pack Alpha variant"
        }
      ]
    },
    {
      "id": "codex-location-001",
      "categoryId": "locations",
      "title": "The Shattered Spire",
      "era": "pre-blight",
      "summary": "Once a beacon of learning, now a treacherous ruin filled with echoes of lost knowledge.",
      "totalFragments": 5,
      "legendValue": 15,
      "icon": "icon-location-spire",
      "matchKeywords": ["spire", "tower", "academy", "ruin", "knowledge", "library"],
      "unlockConditions": [
        {
          "type": "LocationVisited",
          "locationId": "loc-shattered-spire"
        }
      ],
      "sections": [
        {
          "id": "section-discovery",
          "title": "First Glimpse",
          "content": "The Shattered Spire rises from the Ashlands like a broken finger pointing accusingly at the sky. Once, it stood three hundred spans tall—a monument to the old world's mastery of runic architecture. Now, barely a third remains standing.",
          "unlockThreshold": 0.0,
          "sortOrder": 1
        },
        {
          "id": "section-history",
          "title": "Historical Records",
          "content": "The Spire served as the Academy of Elevated Studies, where the greatest minds of the pre-Blight era gathered to push the boundaries of runic theory. Their final experiments may have contributed to the catastrophe itself.",
          "unlockThreshold": 0.40,
          "captureRequirement": "TextFragment",
          "sortOrder": 2
        },
        {
          "id": "section-dangers",
          "title": "Current Dangers",
          "content": "The lower levels remain accessible, though unstable. Residual runic energy creates pockets of temporal distortion—some explorers report losing hours, others return aged decades. The upper ruins are home to Shade Weavers.",
          "unlockThreshold": 0.60,
          "sortOrder": 3
        },
        {
          "id": "section-secrets",
          "title": "Hidden Chambers",
          "content": "Behind a wall marked with the glyph for 'truth,' a hidden archive survives. Within: personal journals of the Archmage Vaelen, detailing experiments that should never be repeated—and one that must be, if the Blight is ever to be undone.",
          "unlockThreshold": 1.0,
          "spoilerLevel": "major",
          "sortOrder": 4
        }
      ],
      "relatedEntries": [
        {
          "entryId": "codex-lore-003",
          "relationType": "Expansion",
          "description": "Archmage Vaelen's research"
        },
        {
          "entryId": "codex-beast-005",
          "relationType": "SeeAlso",
          "description": "Shade Weavers found in the upper ruins"
        }
      ]
    },
    {
      "id": "codex-faction-001",
      "categoryId": "characters",
      "title": "The Hollow Covenant",
      "era": "post-blight",
      "summary": "Scholars and archivists dedicated to preserving and understanding pre-Blight knowledge.",
      "totalFragments": 4,
      "legendValue": 15,
      "icon": "icon-faction-covenant",
      "matchKeywords": ["hollow", "covenant", "scholars", "archive", "knowledge", "preservation"],
      "unlockConditions": [
        {
          "type": "FactionReputation",
          "factionId": "faction-hollow-covenant",
          "standing": "Friendly"
        }
      ],
      "conditionLogic": "or",
      "sections": [
        {
          "id": "section-public",
          "title": "Public Face",
          "content": "The Hollow Covenant presents itself as benevolent keepers of history. Their scribes travel the wastes, collecting artifacts and transcribing fading texts. They trade knowledge freely, asking only for contributions to their ever-growing archives.",
          "unlockThreshold": 0.0,
          "sortOrder": 1
        },
        {
          "id": "section-structure",
          "title": "Internal Structure",
          "content": "The Covenant operates in concentric circles of trust. Outer Circle members handle collection and trade. Inner Circle scholars analyze and categorize. The Core—whose existence is officially denied—guards knowledge deemed too dangerous for common hands.",
          "unlockThreshold": 0.50,
          "sortOrder": 2
        },
        {
          "id": "section-secrets",
          "title": "Hidden Agenda",
          "content": "The Covenant's true purpose extends beyond preservation. They seek the *Lexicon of Undoing*—a mythical text said to contain the ritual that caused the Blight, and by extension, the means to reverse it. They will pay any price to find it.",
          "unlockThreshold": 1.0,
          "spoilerLevel": "major",
          "sortOrder": 3
        }
      ],
      "relatedEntries": [
        {
          "entryId": "codex-blight-001",
          "relationType": "SeeAlso",
          "description": "Their research into the Blight"
        }
      ]
    },
    {
      "id": "codex-item-001",
      "categoryId": "items",
      "title": "Echo Stone",
      "era": "pre-blight",
      "summary": "A resonant crystal capable of recording and replaying sounds from the past.",
      "totalFragments": 3,
      "legendValue": 10,
      "icon": "icon-item-echo-stone",
      "matchKeywords": ["echo", "stone", "crystal", "recording", "memory", "sound"],
      "unlockConditions": [
        {
          "type": "ItemObtained",
          "itemId": "item-echo-stone"
        }
      ],
      "sections": [
        {
          "id": "section-description",
          "title": "Description",
          "content": "A palm-sized crystal of deep amber hue, warm to the touch. When activated, it replays sounds captured in its vicinity—sometimes from moments ago, sometimes from before the Blight itself.",
          "unlockThreshold": 0.0,
          "sortOrder": 1
        },
        {
          "id": "section-usage",
          "title": "Usage",
          "content": "Press the stone to a flat surface and speak the activation phrase: *'Let memory speak.'* The stone will vibrate and begin playback. Duration varies based on the stone's quality and the strength of the recorded sounds.",
          "unlockThreshold": 0.50,
          "sortOrder": 2
        },
        {
          "id": "section-crafting",
          "title": "Crafting Notes",
          "content": "Echo Stones form naturally in places of great emotional intensity. Battlefields, ancient temples, and sites of tragedy often yield the highest quality specimens. The crystal structure traps sound vibrations in a stable runic lattice.",
          "unlockThreshold": 1.0,
          "captureRequirement": "RunicTrace",
          "sortOrder": 3
        }
      ]
    }
  ]
}
```

---

## 13. Logging Specifications

### 13.1 Log Categories

| Category | Level | Description |
|----------|-------|-------------|
| `Codex.Load` | Info | Schema loading and parsing events |
| `Codex.Validation` | Warning/Error | Schema validation failures |
| `Codex.Unlock` | Info | Entry unlock condition evaluations |
| `Codex.Progress` | Debug | Progression threshold calculations |
| `Codex.Keyword` | Debug | Keyword matching operations |

### 13.2 Log Message Formats

```
[INFO] Codex.Load: Loaded {count} entries in {categories} categories
[INFO] Codex.Load: Built keyword index with {keywordCount} unique keywords
[WARN] Codex.Validation: Entry {entryId} references unknown category {categoryId}
[ERROR] Codex.Validation: Entry {entryId} has invalid ID format
[INFO] Codex.Unlock: Entry {entryId} unlocked via {conditionType}
[DEBUG] Codex.Progress: Entry {entryId} progress updated to {progress} ({level})
[DEBUG] Codex.Keyword: Capture matched {matchCount} entries via keywords [{keywords}]
```

---

## 14. Unit Testing Requirements

### 14.1 Test Matrix

| Test ID | Test Name | Description | Expected Result |
|---------|-----------|-------------|-----------------|
| COD-001 | ValidSchemaLoads | Load valid codex.json against schema | Loads without errors |
| COD-002 | InvalidEntryIdRejected | Entry ID not matching pattern | Validation error |
| COD-003 | UnknownCategoryRejected | Entry references non-existent category | Validation error |
| COD-004 | UnlockConditionValidation | All 8 unlock types parse correctly | Conditions deserialized |
| COD-005 | ProgressionThresholdOrder | Thresholds must be ascending | Validation error if disordered |
| COD-006 | KeywordMatchingCorrelation | Capture keywords match entry keywords | Correct entries returned |

### 14.2 Test Specifications

#### COD-001: ValidSchemaLoads

```
GIVEN a valid codex.json file
WHEN validated against codex.schema.json
THEN validation succeeds
AND all categories are parsed
AND all entries are parsed
AND keyword index is built
```

#### COD-002: InvalidEntryIdRejected

```
GIVEN an entry with id "invalid_id_format"
WHEN validated against schema
THEN validation fails
AND error message indicates pattern mismatch
AND error references the invalid entry
```

#### COD-003: UnknownCategoryRejected

```
GIVEN an entry with categoryId "nonexistent-category"
WHEN cross-referenced against categories array
THEN validation fails
AND error identifies the orphaned entry
AND error lists the invalid category reference
```

#### COD-004: UnlockConditionValidation

```
GIVEN entries with each of the 8 unlock condition types
WHEN parsed and validated
THEN each condition type deserializes correctly
AND required parameters are present
AND optional parameters use defaults
```

#### COD-005: ProgressionThresholdOrder

```
GIVEN progression levels with thresholds [0.25, 0.50, 0.75, 1.0]
WHEN validated
THEN validation succeeds

GIVEN progression levels with thresholds [0.50, 0.25, 0.75, 1.0]
WHEN validated
THEN validation fails with ordering error
```

#### COD-006: KeywordMatchingCorrelation

```
GIVEN an entry with matchKeywords ["blight", "origin"]
AND a capture with keywords ["origin", "catastrophe"]
WHEN keyword matching is performed
THEN the entry is returned as a match
AND match score reflects keyword overlap (1 of 2 = 50%)
```

---

## 15. Use Cases

### 15.1 Load Codex Configuration

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Load Codex Configuration                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: CodexProvider, Configuration System                             │
│ Trigger: Game initialization or configuration reload                     │
│                                                                          │
│ Main Flow:                                                               │
│   1. CodexProvider locates codex.json and codex.schema.json             │
│   2. JSON content is parsed                                              │
│   3. Content is validated against schema                                 │
│   4. Categories array is indexed by id                                   │
│   5. Entries array is indexed by id and categoryId                      │
│   6. Keyword index is built from all entry matchKeywords                 │
│   7. Cross-references are validated (categoryId exists, relatedEntries) │
│   8. Configuration is cached for runtime access                          │
│                                                                          │
│ Alternate Flow (Validation Failure):                                     │
│   3a. Schema validation fails                                            │
│   3b. Error logged with specific validation failure                      │
│   3c. System falls back to cached configuration or fails startup         │
│                                                                          │
│ Postconditions:                                                          │
│   - All entries accessible by ID                                         │
│   - Keyword index ready for capture matching                             │
│   - Category hierarchy available for UI                                  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.2 Unlock Codex Entry

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Unlock Codex Entry                                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Player, Unlock System, CodexService                             │
│ Trigger: Player action satisfies unlock condition                        │
│                                                                          │
│ Main Flow:                                                               │
│   1. Game event occurs (kill, visit, obtain, etc.)                      │
│   2. Event is matched against entry unlock conditions                    │
│   3. For each matching entry:                                            │
│      a. Check conditionLogic (AND/OR)                                   │
│      b. Evaluate all conditions                                          │
│      c. If satisfied, mark entry as unlocked                            │
│   4. Entry initial sections (threshold 0.0) become visible              │
│   5. Notification sent to UI                                             │
│   6. Legend progress updated                                             │
│                                                                          │
│ Condition Types Evaluated:                                               │
│   - CaptureCollected: Check player capture inventory                     │
│   - QuestComplete: Query quest completion state                          │
│   - EnemyKilled: Check kill tracker for enemy type                       │
│   - LocationVisited: Query discovery state                               │
│   - ItemObtained: Check inventory                                        │
│   - FactionReputation: Query faction standing                            │
│   - LevelReached: Check player level                                     │
│   - ManualUnlock: Check trigger flag state                               │
│                                                                          │
│ Postconditions:                                                          │
│   - Entry visible in journal                                             │
│   - Initial sections readable                                            │
│   - Progress tracking initialized                                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.3 Match Capture to Entries

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Match Data Capture to Codex Entries                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Player, Capture System, CodexService                            │
│ Trigger: Player acquires a Data Capture                                  │
│                                                                          │
│ Main Flow:                                                               │
│   1. Capture acquired with matchKeywords array                          │
│   2. Keywords extracted from capture template (v0.14.9e)                │
│   3. Keyword index queried for matching entries                          │
│   4. Match scores calculated (keywords matched / total keywords)         │
│   5. Entries above threshold returned as candidates                      │
│   6. Player presented with assignment options (if multiple)              │
│   7. Selected entry's progress incremented                               │
│                                                                          │
│ Matching Algorithm:                                                      │
│   score = matchedKeywords.count / entry.matchKeywords.count             │
│   threshold = 0.3 (configurable)                                        │
│   candidates = entries.where(score >= threshold)                         │
│                                                                          │
│ Postconditions:                                                          │
│   - Capture assigned to entry                                            │
│   - Entry progress updated                                               │
│   - New sections may unlock based on threshold                           │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.4 Progress Entry Revelation

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Progress Entry to New Revelation Level                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Capture Assignment, CodexService, Reward System                 │
│ Trigger: Capture assigned to entry increases progress                    │
│                                                                          │
│ Main Flow:                                                               │
│   1. Capture assigned to entry                                          │
│   2. Progress recalculated: capturesAssigned / totalFragments           │
│   3. New progress compared against progression thresholds               │
│   4. If new threshold crossed:                                          │
│      a. New sections with unlockThreshold <= progress revealed          │
│      b. Progression level updated (Fragment/Partial/Complete/Mastery)   │
│      c. Level rewards granted                                           │
│      d. UI notification displayed                                        │
│   5. If Mastery reached (1.0), completion rewards granted               │
│                                                                          │
│ Progress Calculation:                                                    │
│   progress = min(assignedCaptures / totalFragments, 1.0)                │
│                                                                          │
│ Threshold Levels (default):                                              │
│   - Fragment: 0.25 (1 of 4 captures)                                    │
│   - Partial: 0.50 (2 of 4 captures)                                     │
│   - Complete: 0.75 (3 of 4 captures)                                    │
│   - Mastery: 1.00 (4 of 4 captures)                                     │
│                                                                          │
│ Postconditions:                                                          │
│   - New sections visible in UI                                           │
│   - Legend points awarded                                                │
│   - Achievement progress updated (if applicable)                         │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### 15.5 Display Entry with Progressive Content

```
┌─────────────────────────────────────────────────────────────────────────┐
│ USE CASE: Display Codex Entry in Journal UI                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ Actors: Player, Journal UI, CodexService                                │
│ Trigger: Player selects entry in journal                                 │
│                                                                          │
│ Main Flow:                                                               │
│   1. Entry selected from category listing                               │
│   2. Current progress retrieved for entry                               │
│   3. Sections filtered by unlockThreshold <= progress                   │
│   4. Locked sections displayed as "[Requires more fragments]"           │
│   5. Visible sections rendered with markdown formatting                  │
│   6. Related entries shown (respecting spoiler warnings)                 │
│   7. Progress bar/indicator displayed                                    │
│   8. Current progression level shown                                     │
│                                                                          │
│ Section Visibility Rules:                                                │
│   - section.unlockThreshold <= entry.progress: Show content             │
│   - section.captureRequirement set: Requires specific capture type      │
│   - section.spoilerLevel != "none": Show with warning if revealed       │
│                                                                          │
│ Related Entry Display:                                                   │
│   - SeeAlso: Shown in "Related" section                                 │
│   - Prerequisite: "Read First" indicator                                │
│   - Sequel: "Continue Reading" indicator                                │
│   - Contradiction: "Conflicting Account" warning                        │
│   - Expansion: "Learn More" link                                        │
│                                                                          │
│ Postconditions:                                                          │
│   - Entry content displayed appropriately                                │
│   - Progress clear to player                                             │
│   - Navigation to related entries available                              │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 16. Deliverable Checklist

### Configuration Files

| Item | Status | Notes |
|------|--------|-------|
| `codex.schema.json` | Pending | JSON Schema Draft-07 validation |
| `codex.json` | Pending | Entry and category definitions |

### Schema Definitions

| Item | Status | Notes |
|------|--------|-------|
| `CodexEntry` | Defined | Section 5 |
| `CodexCategory` | Defined | Section 6 |
| `EntrySection` | Defined | Section 7 |
| `UnlockCondition` (8 types) | Defined | Section 8 |
| `EntryRelation` | Defined | Section 9 |
| `ProgressionLevel` | Defined | Section 10 |

### Unit Tests

| Item | Status | Notes |
|------|--------|-------|
| COD-001: ValidSchemaLoads | Pending | Schema validation |
| COD-002: InvalidEntryIdRejected | Pending | ID pattern enforcement |
| COD-003: UnknownCategoryRejected | Pending | Cross-reference validation |
| COD-004: UnlockConditionValidation | Pending | All 8 types |
| COD-005: ProgressionThresholdOrder | Pending | Ordering enforcement |
| COD-006: KeywordMatchingCorrelation | Pending | Capture integration |

---

## 17. Acceptance Criteria

### Functional Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| AC-01 | Schema validates all 6 definition types | Run test COD-001 |
| AC-02 | Entry IDs follow `codex-{category}-{number}` pattern | Run test COD-002 |
| AC-03 | Category references are validated | Run test COD-003 |
| AC-04 | All 8 unlock condition types are supported | Run test COD-004 |
| AC-05 | Progression thresholds must be ascending | Run test COD-005 |
| AC-06 | Keyword matching correlates captures to entries | Run test COD-006 |
| AC-07 | 6 standard categories defined | Inspect configuration |
| AC-08 | 4 progression levels defined | Inspect configuration |
| AC-09 | 5 relation types defined | Inspect schema |
| AC-10 | Capture type requirements supported | Inspect schema |

### Quality Criteria

| ID | Criterion | Verification |
|----|-----------|--------------|
| QC-01 | Schema follows JSON Schema Draft-07 | Schema linter validation |
| QC-02 | All properties have descriptions | Manual inspection |
| QC-03 | Examples provided for complex types | Manual inspection |
| QC-04 | Default values documented | Manual inspection |
| QC-05 | Integration with v0.14.9e patterns consistent | Cross-reference check |

---

## 18. Dependencies

### Required From

| Version | Component | Usage |
|---------|-----------|-------|
| v0.14.9e | Capture Template Schema | matchKeywords correlation, CaptureType enum |
| v0.14.10a | Faction Schema | FactionReputation condition references |
| v0.14.10b | Quest Schema | QuestComplete condition references |

### Provides To

| Version | Component | Usage |
|---------|-----------|-------|
| v0.15.x | Codex Service | Runtime loading and query operations |
| v0.15.x | Journal UI | Entry display and category navigation |
| v0.15.x | Progression System | Legend rewards integration |
| Future | Achievement System | Mastery achievement triggers |

---

## 19. Future Considerations

### Deferred to Future Versions

| Feature | Rationale |
|---------|-----------|
| Dynamic entry generation | Runtime complexity beyond schema scope |
| Multi-language content | Localization system not yet defined |
| Entry versioning | Content management beyond initial scope |
| Collaborative entries | Multiplayer not in current scope |
| Audio content embedding | Asset management system required |

### Extension Points

| Extension | Mechanism |
|-----------|-----------|
| Custom unlock conditions | Additional `oneOf` entries in UnlockCondition |
| New progression levels | Extend ProgressionLevel enum |
| Additional relation types | Extend EntryRelation relationType enum |
| Category hierarchies | Deeper subcategory nesting support |
| Content formatting | Markdown extension for game-specific elements |

---

## 20. Appendix

### A. ID Pattern Reference

| Entity | Pattern | Example |
|--------|---------|---------|
| Codex Entry | `codex-{category}-{number}` | `codex-blight-001` |
| Category | `{lowercase-kebab}` | `lore`, `bestiary` |
| Subcategory | `{lowercase-kebab}` | `origins`, `blighted` |
| Section | `section-{name}` | `section-overview` |
| Capture (ref) | `cap-{entry}-{number}` | `cap-blight-origin-001` |
| Quest (ref) | `quest-{name}-{number}` | `quest-covenant-intro-001` |
| Faction (ref) | `faction-{name}` | `faction-hollow-covenant` |

### B. Capture Type Reference (from v0.14.9e)

| Type | Description | Typical Source |
|------|-------------|----------------|
| `TextFragment` | Written documents, notes, journals | Found items, archives |
| `EchoRecording` | Audio memories, preserved sounds | Echo Stones |
| `VisualRecord` | Images, paintings, photographs | Ruins, galleries |
| `Specimen` | Physical samples, artifacts | Defeated enemies, harvest |
| `OralHistory` | NPC conversations, stories | Dialog, contacts |
| `RunicTrace` | Runic patterns, magical residue | Investigation, crafting |

### C. Progression Calculation Example

```
Entry: codex-blight-001
Total Fragments: 6
Captures Assigned: 4

Progress = 4 / 6 = 0.667 (66.7%)

Unlocked Sections:
- section-overview (threshold: 0.0) ✓
- section-theories (threshold: 0.25) ✓
- section-witnesses (threshold: 0.50) ✓
- section-patterns (threshold: 0.75) ✗ (needs 0.083 more)
- section-truth (threshold: 1.0) ✗

Current Level: Partial (0.50-0.749)
Next Level: Complete (requires 5 captures, progress = 0.833)
```

### D. Keyword Matching Example

```
Capture Keywords: ["corruption", "origin", "darkness", "ruin"]

Entry 1: codex-blight-001
  matchKeywords: ["blight", "catastrophe", "origin", "corruption", "old world"]
  Matches: ["origin", "corruption"] = 2
  Score: 2/5 = 0.40 ✓ (above 0.3 threshold)

Entry 2: codex-beast-001
  matchKeywords: ["stalker", "hollow", "predator", "blighted", "ruins"]
  Matches: [] = 0 (Note: "ruin" != "ruins" - exact match)
  Score: 0/5 = 0.00 ✗

Entry 3: codex-location-001
  matchKeywords: ["spire", "tower", "academy", "ruin", "knowledge", "library"]
  Matches: ["ruin"] = 1
  Score: 1/6 = 0.167 ✗ (below threshold)

Result: codex-blight-001 suggested for assignment
```

---

*End of v0.14.10c Design Specification*
