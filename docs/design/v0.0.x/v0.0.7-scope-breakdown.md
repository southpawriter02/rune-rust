# v0.0.7 Equipment System - Scope Breakdown

**Version:** 0.0.7
**Theme:** Equipment System
**Prerequisites:** v0.0.6 Complete (Enhanced Combat System)
**Total Estimated Tests:** ~45 new tests

---

## Executive Summary

The Equipment System introduces wearable and wieldable items that modify player stats and integrate with the combat system. Players can equip weapons to determine their damage dice pools and armor to increase defense, with optional stat requirements and class restrictions.

The work is divided into **three sub-phases**:

| Phase | Name | Focus | Est. Tests |
|-------|------|-------|------------|
| v0.0.7a | Core Equipment Infrastructure | Equipment slots, equip/unequip commands, Item entity updates | ~18 |
| v0.0.7b | Weapon System | Weapon types, damage dice, combat integration | ~15 |
| v0.0.7c | Armor & Requirements | Armor types, stat modifiers, equipment requirements | ~12 |

---

## Feature Analysis & Categorization

### From v0.0.7-index.md - Equipment Slots

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Equipment Slots Enum | Low | None | **v0.0.7a** |
| Equipment Dictionary on Player | Medium | EquipmentSlot enum | **v0.0.7a** |
| Equip Command | Medium | Equipment dictionary, Item updates | **v0.0.7a** |
| Unequip Command | Low | Equipment dictionary | **v0.0.7a** |
| Equipment Display | Low | Equipment dictionary | **v0.0.7a** |

### From v0.0.7-index.md - Equipment Stats

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Weapon Damage Dice | Medium | DicePool (v0.0.5), Item entity | **v0.0.7b** |
| Combat Integration | High | CombatService (v0.0.5c), Weapon system | **v0.0.7b** |
| Armor Defense Bonus | Medium | Item entity, Stats | **v0.0.7c** |
| Stat Modifiers | Medium | Item entity, PlayerAttributes | **v0.0.7c** |

### From v0.0.7-index.md - Weapon Types

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Swords | Low | Weapon system | **v0.0.7b** |
| Axes | Low | Weapon system | **v0.0.7b** |
| Daggers | Low | Weapon system | **v0.0.7b** |
| Staffs | Low | Weapon system | **v0.0.7b** |

### From v0.0.7-index.md - Armor Types

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Light Armor | Low | Armor system | **v0.0.7c** |
| Medium Armor | Low | Armor system | **v0.0.7c** |
| Heavy Armor | Low | Armor system | **v0.0.7c** |

### From v0.0.7-index.md - Equipment Requirements

| Feature | Complexity | Dependencies | Assigned Phase |
|---------|------------|--------------|----------------|
| Stat Requirements | Medium | PlayerAttributes, Item entity | **v0.0.7c** |
| Class Requirements | Medium | ClassId on Player, Item entity | **v0.0.7c** |

---

## Phase Definitions

---

## v0.0.7a: Core Equipment Infrastructure

[v0.0.7a Design Specification](v0.0.7a-design-specification.md)

### Overview

Establish the foundational equipment system including equipment slots, the ability to equip and unequip items, and necessary updates to the Item and Player entities.

### Scope

**In Scope:**
- `EquipmentSlot` enum (Weapon, Armor, Shield, Helmet, Boots, Ring, Amulet)
- `Equipment` dictionary on `Player` entity
- `EquipmentSlot?` property on `Item` entity
- `EquipCommand` and `UnequipCommand`
- `EquipmentService` for equip/unequip logic
- Equipment display in status/inventory
- Basic validation (item has correct slot, slot not already occupied)

**Out of Scope:**
- Weapon damage dice (v0.0.7b)
- Combat integration (v0.0.7b)
- Armor defense bonuses (v0.0.7c)
- Stat modifiers (v0.0.7c)
- Equipment requirements (v0.0.7c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Enums | 1 | `EquipmentSlot` |
| Domain Services | 1 | `EquipmentService` |
| Application Services | 1 | Update `GameSessionService` |
| Commands | 2 | `EquipCommand`, `UnequipCommand` |
| DTOs | 2 | `EquippedItemDto`, `EquipmentSlotsDto` |
| Unit Tests | ~18 | |

### Data Model Changes

```
NEW: EquipmentSlot (Enum)
├── Weapon
├── Armor
├── Shield
├── Helmet
├── Boots
├── Ring
└── Amulet

MODIFY: Item (Entity)
└── ADD: EquipmentSlot?: EquipmentSlot (nullable - not all items are equippable)

MODIFY: Player (Entity)
├── ADD: Equipment: Dictionary<EquipmentSlot, Item>
├── ADD: GetEquippedItem(slot): Item?
├── ADD: Equip(item): bool
├── ADD: Unequip(slot): Item?
└── ADD: IsSlotOccupied(slot): bool
```

### User-Facing Changes

**Commands:**
```
> equip <item>           # Equip an item from inventory
> unequip <slot>         # Remove equipment from a slot
> equipment              # Show all equipped items
```

**Output Example:**
```
> equipment

=== Equipment ===
Weapon:  Rusty Sword
Armor:   Leather Armor
Shield:  (empty)
Helmet:  (empty)
Boots:   Worn Boots
Ring:    (empty)
Amulet:  (empty)

> equip Iron Shield
You equip the Iron Shield.

> unequip weapon
You unequip the Rusty Sword.
```

### Acceptance Criteria

- [ ] `EquipmentSlot` enum contains all 7 slots
- [ ] Player can equip items with matching equipment slots
- [ ] Player cannot equip items without equipment slots
- [ ] Player cannot equip to an already-occupied slot without unequipping first
- [ ] Unequipping returns item to inventory
- [ ] Equipment display shows all slots with equipped items or "(empty)"
- [ ] ~18 unit tests pass

---

## v0.0.7b: Weapon System

[v0.0.7b Design Specification](v0.0.7b-design-specification.md)

### Overview

Implement weapon types with distinct damage dice pools and integrate with the combat system so equipped weapons determine attack damage.

### Scope

**In Scope:**
- `DamageDice` property on `Item` (dice notation string, e.g., "1d8")
- `WeaponType` enum (Sword, Axe, Dagger, Staff)
- `WeaponType?` property on `Item`
- Update `GetPlayerDamagePool` in `CombatService` to use equipped weapon
- Weapon definitions in configuration
- Weapon-specific stat bonuses (e.g., Dagger +1 Finesse)

**Out of Scope:**
- Armor defense (v0.0.7c)
- General stat modifiers (v0.0.7c)
- Equipment requirements (v0.0.7c)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Enums | 1 | `WeaponType` |
| Domain Services | 1 | Update `CombatService` |
| Configuration | 1 | `weapons.json` |
| DTOs | 1 | `WeaponDto` |
| Unit Tests | ~15 | |

### Data Model Changes

```
NEW: WeaponType (Enum)
├── Sword
├── Axe
├── Dagger
└── Staff

MODIFY: Item (Entity)
├── ADD: DamageDice: string? (e.g., "1d8", "2d6")
├── ADD: WeaponType?: WeaponType
└── ADD: WeaponBonuses: StatModifiers? (weapon-specific bonuses)

MODIFY: CombatService
└── UPDATE: GetPlayerDamagePool(player) to check equipped weapon
```

### Weapon Definitions

| Weapon Type | Damage Dice | Special | Description |
|-------------|-------------|---------|-------------|
| Sword | 1d8 | Balanced | Standard melee weapon |
| Axe | 1d10 | -1 to attack rolls | Heavy, high damage |
| Dagger | 1d4 | +2 Finesse | Quick, precise |
| Staff | 1d6 | +2 Will | Magic-focused |

### User-Facing Changes

**Combat Output Example:**
```
> attack goblin

You attack the Goblin with your Iron Sword!
Attack Roll: [15] + 3 (Finesse) = 18 vs Defense 12
Hit! Rolling damage...
Damage Roll: 1d8 [6] + 2 (Might) = 8 damage!
The Goblin takes 8 damage. (HP: 30 -> 22)
```

**Unarmed Combat:**
```
> attack goblin

You attack the Goblin with your fists!
Attack Roll: [12] + 3 (Finesse) = 15 vs Defense 12
Hit! Rolling damage...
Damage Roll: 1d4 [3] + 2 (Might) = 5 damage!
The Goblin takes 5 damage. (HP: 30 -> 25)
```

### Acceptance Criteria

- [ ] Weapons have `DamageDice` property using dice notation
- [ ] Combat uses equipped weapon's damage dice instead of default 1d6
- [ ] Unarmed attacks use 1d4 (reduced from default 1d6)
- [ ] Each weapon type has distinct characteristics
- [ ] Weapon-specific bonuses apply when equipped
- [ ] Combat output shows weapon name
- [ ] ~15 unit tests pass

---

## v0.0.7c: Armor & Requirements

[v0.0.7c Design Specification](v0.0.7c-design-specification.md)

### Overview

Implement armor types with defense bonuses and stat modifiers, plus equipment requirements based on attributes and class.

### Scope

**In Scope:**
- `ArmorType` enum (Light, Medium, Heavy)
- `ArmorType?` property on `Item`
- `DefenseBonus` property on `Item`
- `StatModifiers` property on `Item` (general attribute bonuses)
- `EquipmentRequirements` value object
- `Requirements` property on `Item`
- Armor definitions in configuration
- Requirement validation in `EquipmentService`
- Speed/initiative penalties for heavy armor

**Out of Scope:**
- Status effect resistances (future version)

### Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Domain Enums | 1 | `ArmorType` |
| Domain Value Objects | 2 | `StatModifiers`, `EquipmentRequirements` |
| Domain Services | 1 | Update `EquipmentService` |
| Configuration | 1 | `armor.json` |
| DTOs | 1 | `ArmorDto` |
| Unit Tests | ~12 | |

### Data Model Changes

```
NEW: ArmorType (Enum)
├── Light
├── Medium
└── Heavy

NEW: EquipmentRequirements (Value Object)
├── MinMight: int?
├── MinFortitude: int?
├── MinWill: int?
├── MinWits: int?
├── MinFinesse: int?
├── RequiredClassIds: IReadOnlyList<string>?
└── MeetsRequirements(player): bool

MODIFY: Item (Entity)
├── ADD: ArmorType?: ArmorType
├── ADD: DefenseBonus: int (default 0)
├── ADD: StatModifiers: StatModifiers? (attribute bonuses when equipped)
├── ADD: InitiativePenalty: int (default 0, for heavy armor)
└── ADD: Requirements: EquipmentRequirements?

MODIFY: Player (Entity)
├── ADD: GetEffectiveStats(): Stats (base + equipment bonuses)
└── ADD: GetEffectiveAttributes(): PlayerAttributes (base + equipment bonuses)

MODIFY: EquipmentService
└── ADD: CanEquip(player, item): (bool, string?) with requirement validation
```

### Armor Definitions

| Armor Type | Defense Bonus | Initiative Penalty | Requirements | Description |
|------------|---------------|-------------------|--------------|-------------|
| Light | +2 | 0 | None | Leather, cloth |
| Medium | +4 | -1 | Fortitude 12 | Chain, scale |
| Heavy | +6 | -3 | Fortitude 14, Might 12 | Plate, full armor |

### User-Facing Changes

**Requirement Failure Example:**
```
> equip Plate Armor

You cannot equip Plate Armor.
Requirements not met:
  - Fortitude 14 required (you have 10)
  - Might 12 required (you have 11)
```

**Status with Equipment Bonuses:**
```
> status

=== Hero (Level 1 Warrior) ===
HP: 100/100
Might: 12 (+2 from Ring of Strength = 14)
Fortitude: 10
Defense: 5 (+4 from Chain Mail = 9)
Initiative: -1 (Chain Mail penalty)
```

### Acceptance Criteria

- [ ] Armor provides defense bonuses when equipped
- [ ] Heavy armor applies initiative penalty
- [ ] Equipment can have stat requirements
- [ ] Equipment can have class requirements
- [ ] Players cannot equip items they don't meet requirements for
- [ ] Clear error messages explain unmet requirements
- [ ] Equipment bonuses reflected in effective stats
- [ ] ~12 unit tests pass

---

## Dependencies & Prerequisites

```
v0.0.5 (Dice Pool System) - REQUIRED
    │
    └── v0.0.5c: Combat Integration ──────────────────┐
            (GetPlayerDamagePool, DicePool)           │
                                                      │
v0.0.6 (Enhanced Combat System) - REQUIRED            │
    │                                                 │
    ├── v0.0.6a: Multi-Monster Combat ────────────────┤
    ├── v0.0.6b: Monster AI & Flee ───────────────────┤
    ├── v0.0.6c: Status Effect Framework ─────────────┤
    └── v0.0.6d: Status Effect Integration ───────────┘
                                                      │
                                                      ▼
v0.0.7 (Equipment System)
    │
    ├── v0.0.7a: Core Equipment Infrastructure ───────┐
    │       Dependencies: None (foundation)           │
    │                                                 │
    ├── v0.0.7b: Weapon System ───────────────────────┤
    │       Dependencies: v0.0.7a, v0.0.5c            │
    │                                                 │
    └── v0.0.7c: Armor & Requirements ────────────────┘
            Dependencies: v0.0.7a
```

**Note:** v0.0.7b and v0.0.7c can be developed in parallel after v0.0.7a is complete.

---

## Estimated Effort Summary

| Phase | New Files | Modified Files | Est. Tests | Complexity |
|-------|-----------|----------------|------------|------------|
| v0.0.7a | ~5 | ~4 | ~18 | Medium |
| v0.0.7b | ~3 | ~3 | ~15 | Medium |
| v0.0.7c | ~4 | ~3 | ~12 | Medium |
| **Total** | **~12** | **~10** | **~45** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Item entity becomes too complex | Medium | Medium | Consider splitting into Equipment subclass |
| Combat balance disruption | High | Medium | Start with conservative stat bonuses, tune later |
| Inventory management complexity | Medium | Low | Clear separation between equipped and inventory items |
| Requirement system too restrictive | Medium | Low | Make most equipment have no requirements initially |
| Performance with many equipment checks | Low | Low | Cache effective stats, recalculate on equip/unequip |

---

## Design Decisions (Confirmed)

### Equipment Slots

| Decision | Value | Notes |
|----------|-------|-------|
| **Number of slots** | 7 | Weapon, Armor, Shield, Helmet, Boots, Ring, Amulet |
| **Two-handed weapons** | Future | Initially all weapons are one-handed |
| **Dual-wielding** | Future | Initially only one weapon slot |
| **Accessory slots** | 1 Ring, 1 Amulet | Could expand in future versions |

### Weapon Mechanics

| Decision | Value | Notes |
|----------|-------|-------|
| **Unarmed damage** | 1d4 | Reduced from default 1d6 to incentivize weapons |
| **Weapon bonus type** | Attribute bonus | e.g., Dagger gives +2 Finesse |
| **Damage notation** | Dice string | Uses existing DicePool.Parse (e.g., "1d8") |

### Armor Mechanics

| Decision | Value | Notes |
|----------|-------|-------|
| **Defense calculation** | Additive | Base defense + armor bonus |
| **Heavy armor penalty** | Initiative | Affects turn order in combat |
| **Armor types** | 3 | Light, Medium, Heavy (simple tier system) |

### Requirements

| Decision | Value | Notes |
|----------|-------|-------|
| **Requirement types** | Attributes, Class | Stats and class restrictions |
| **Unmet requirement behavior** | Block equip | Cannot equip, clear error message |
| **Requirement display** | On item inspect | Show requirements when examining items |

---

## Configuration Examples

### weapons.json

```json
{
  "weapons": [
    {
      "id": "iron_sword",
      "name": "Iron Sword",
      "description": "A standard iron sword.",
      "weaponType": "Sword",
      "damageDice": "1d8",
      "value": 50
    },
    {
      "id": "battle_axe",
      "name": "Battle Axe",
      "description": "A heavy two-handed axe.",
      "weaponType": "Axe",
      "damageDice": "1d10",
      "attackModifier": -1,
      "value": 75
    },
    {
      "id": "steel_dagger",
      "name": "Steel Dagger",
      "description": "A quick, precise blade.",
      "weaponType": "Dagger",
      "damageDice": "1d4",
      "statBonuses": { "finesse": 2 },
      "value": 40
    },
    {
      "id": "oak_staff",
      "name": "Oak Staff",
      "description": "A sturdy wooden staff imbued with minor magic.",
      "weaponType": "Staff",
      "damageDice": "1d6",
      "statBonuses": { "will": 2 },
      "value": 45
    }
  ]
}
```

### armor.json

```json
{
  "armor": [
    {
      "id": "leather_armor",
      "name": "Leather Armor",
      "description": "Light armor made of tanned leather.",
      "armorType": "Light",
      "defenseBonus": 2,
      "initiativePenalty": 0,
      "value": 30
    },
    {
      "id": "chain_mail",
      "name": "Chain Mail",
      "description": "Interlocking metal rings providing solid protection.",
      "armorType": "Medium",
      "defenseBonus": 4,
      "initiativePenalty": -1,
      "requirements": { "minFortitude": 12 },
      "value": 100
    },
    {
      "id": "plate_armor",
      "name": "Plate Armor",
      "description": "Full plate armor offering maximum protection.",
      "armorType": "Heavy",
      "defenseBonus": 6,
      "initiativePenalty": -3,
      "requirements": { "minFortitude": 14, "minMight": 12 },
      "value": 500
    }
  ]
}
```

---

## Files Summary

### Files to Create (New)

| Phase | File | Purpose |
|-------|------|---------|
| 7a | `EquipmentSlot.cs` | Enum for equipment slots |
| 7a | `EquipmentService.cs` | Service for equip/unequip logic |
| 7a | `EquipmentDtos.cs` | DTOs for equipment display |
| 7b | `WeaponType.cs` | Enum for weapon types |
| 7b | `config/weapons.json` | Weapon definitions |
| 7c | `ArmorType.cs` | Enum for armor types |
| 7c | `EquipmentRequirements.cs` | Value object for requirements |
| 7c | `StatModifiers.cs` | Value object for stat bonuses |
| 7c | `config/armor.json` | Armor definitions |

### Files to Modify

| Phase | File | Changes |
|-------|------|---------|
| 7a | `Item.cs` | Add `EquipmentSlot?` property |
| 7a | `Player.cs` | Add `Equipment` dictionary, equip/unequip methods |
| 7a | `GameSessionService.cs` | Handle equip/unequip commands |
| 7a | `ConsoleInputHandler.cs` | Parse equip/unequip commands |
| 7a | `SpectreGameRenderer.cs` | Render equipment display |
| 7b | `Item.cs` | Add `DamageDice`, `WeaponType`, `WeaponBonuses` |
| 7b | `CombatService.cs` | Update `GetPlayerDamagePool` |
| 7c | `Item.cs` | Add `ArmorType`, `DefenseBonus`, `StatModifiers`, `Requirements` |
| 7c | `Player.cs` | Add `GetEffectiveStats`, `GetEffectiveAttributes` |
| 7c | `EquipmentService.cs` | Add requirement validation |

---

## Next Steps

1. **Review & Approve** - Confirm scope breakdown
2. **v0.0.7a Design Spec** - Create detailed design specification for core infrastructure
3. **Implement v0.0.7a** - Build equipment slots and commands
4. **v0.0.7b Design Spec** - Create weapon system specification
5. **v0.0.7c Design Spec** - Create armor and requirements specification
6. **Implement v0.0.7b & v0.0.7c** - Can be done in parallel after v0.0.7a

---

*This scope breakdown provides a structured approach to implementing v0.0.7 Equipment System. Each sub-phase builds on the previous, with v0.0.7b (Weapons) and v0.0.7c (Armor) being developable in parallel after v0.0.7a (Core Infrastructure) is complete.*
