# v0.3.2c Design Specification: Categories & Management

## Overview

**Version:** 0.3.2c
**Parent:** v0.3.2 (Quest Chains & Advanced Features)
**Prerequisites:** v0.3.2a Complete (Quest Chains), v0.3.2b Complete (Failure Conditions)
**Status:** Design Complete
**Estimated Unit Tests:** ~25

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Data Models](#5-data-models)
6. [Configuration Schemas](#6-configuration-schemas)
7. [Service Specifications](#7-service-specifications)
8. [User-Facing Changes](#8-user-facing-changes)
9. [Logging Requirements](#9-logging-requirements)
10. [Unit Test Specifications](#10-unit-test-specifications)
11. [Use Cases](#11-use-cases)
12. [Acceptance Criteria](#12-acceptance-criteria)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

This phase implements quest organization and management features including categories, abandonment, repeatable quests, and journal filtering. Players can organize their quest log by category (Main, Side, Daily, Repeatable, Event), abandon unwanted non-main quests, and filter the quest journal view. The QuestCategory enum defines organizational categories, while the QuestJournalFilter value object enables flexible filtering. Daily and repeatable quests introduce cooldown mechanics for ongoing engagement.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Enums** | QuestCategory |
| **Value Objects** | QuestJournalFilter |
| **Quest Updates** | Category, IsRepeatable, IsDaily, RepeatCooldown, Abandon(), ResetForRepeat() |
| **Player Updates** | AbandonedQuestIds, AbandonQuest(), HasAbandonedQuest(), GetQuestsByCategory() |
| **Service Updates** | QuestService abandonment methods |
| **Tests** | ~25 new unit tests |

### Architectural Significance

This version establishes the **quest organization pattern** that enables:
- Category-based quest organization for better player experience
- Quest abandonment for non-critical quests
- Repeatable and daily quest mechanics for ongoing engagement
- Flexible journal filtering with persistent filter state
- Integration with existing chain and failure systems from v0.3.2a/b
- Foundation for event and seasonal quest content

---

## 2. Feature Overview

```
v0.3.2c Features
├── QuestCategory Enum
│   ├── Main (story quests, cannot abandon)
│   ├── Side (optional quests)
│   ├── Daily (reset daily, repeatable)
│   ├── Repeatable (infinitely repeatable with cooldown)
│   └── Event (seasonal/time-limited)
├── Quest Entity Updates
│   ├── Category (QuestCategory)
│   ├── IsRepeatable (bool)
│   ├── IsDaily (computed: Category == Daily)
│   ├── RepeatCooldown (int? turns or time)
│   ├── RepeatableAfter (DateTime?)
│   ├── SetCategory() method
│   ├── SetRepeatable() method
│   ├── ResetForRepeat() method
│   └── Abandon() method
├── Player Entity Updates
│   ├── AbandonedQuestIds (IReadOnlyList<string>)
│   ├── AbandonQuest() method
│   ├── HasAbandonedQuest() method
│   └── GetQuestsByCategory() method
├── QuestJournalFilter Value Object
│   ├── Category filter (nullable)
│   ├── Status filter (nullable)
│   ├── TimedOnly flag
│   ├── ChainsOnly flag
│   ├── SearchText filter
│   ├── ForCategory() factory
│   ├── ActiveOnly factory
│   └── Apply() method
├── Commands
│   ├── quests [category|status]
│   └── abandon "Quest Name"
└── Quest Journal Updates
    ├── Filtered view by category
    ├── Abandonment confirmation
    ├── Daily quest cooldown display
    └── Filter persistence
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRESENTATION LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    IGameRenderer (updated)                       │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ RenderQuestJournalAsync(QuestJournalDto)  // filtered view      │   │
│  │ RenderAbandonConfirmAsync(AbandonConfirmDto) // confirmation    │   │
│  │ RenderDailyQuestsAsync(DailyQuestStatusDto)  // cooldown info   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    IQuestService (updated)                       │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + AbandonQuest(player, questId): AbandonmentResult              │   │
│  │ + GetQuestsByCategory(player, category): IEnumerable<Quest>     │   │
│  │ + GetFilteredQuests(player, filter): IEnumerable<Quest>         │   │
│  │ + CanAbandon(quest): bool                                        │   │
│  │ + ResetDailyQuests(player): IEnumerable<Quest>                  │   │
│  │ + GetRepeatableQuests(player): IEnumerable<Quest>               │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    AbandonConfirmDto (new)                       │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + QuestId: Guid                                                  │   │
│  │ + QuestName: string                                              │   │
│  │ + Progress: int (percentage)                                     │   │
│  │ + ObjectivesCompleted: int                                       │   │
│  │ + TotalObjectives: int                                           │   │
│  │ + CanRestart: bool                                               │   │
│  │ + WarningMessage: string                                         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    AbandonmentResult (new)                       │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + Success: bool                                                  │   │
│  │ + QuestId: string                                                │   │
│  │ + QuestName: string                                              │   │
│  │ + FailureReason: string?                                         │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    DailyQuestStatusDto (new)                     │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + QuestId: string                                                │   │
│  │ + QuestName: string                                              │   │
│  │ + Status: string                                                 │   │
│  │ + ResetTime: DateTime?                                           │   │
│  │ + TimeUntilReset: TimeSpan?                                      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    QuestJournalDto (updated)                     │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + ActiveFilter: QuestJournalFilterDto?              // NEW      │   │
│  │ + FilteredQuestCount: int                           // NEW      │   │
│  │ + TotalQuestCount: int                              // NEW      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    QuestJournalFilterDto (new)                   │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + Category: string?                                              │   │
│  │ + Status: string?                                                │   │
│  │ + TimedOnly: bool                                                │   │
│  │ + ChainsOnly: bool                                               │   │
│  │ + SearchText: string?                                            │   │
│  │ + DisplayName: string                                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ENUMS                                                                  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    QuestCategory (new)                           │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ Main                                                             │   │
│  │ Side                                                             │   │
│  │ Daily                                                            │   │
│  │ Repeatable                                                       │   │
│  │ Event                                                            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    QuestJournalFilter (new)                      │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + Category: QuestCategory?                                       │   │
│  │ + Status: QuestStatus?                                           │   │
│  │ + TimedOnly: bool                                                │   │
│  │ + ChainsOnly: bool                                               │   │
│  │ + SearchText: string?                                            │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + Default: static (show all)                                     │   │
│  │ + ForCategory(category): static                                  │   │
│  │ + ActiveOnly: static                                             │   │
│  │ + Apply(quests): IEnumerable<Quest>                             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ENTITIES                                                               │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Quest (updated)                               │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + Category: QuestCategory                           // NEW      │   │
│  │ + IsRepeatable: bool                                // NEW      │   │
│  │ + IsDaily: bool                                     // NEW      │   │
│  │ + RepeatCooldown: int?                              // NEW      │   │
│  │ + RepeatableAfter: DateTime?                        // NEW      │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + SetCategory(category): void                       // NEW      │   │
│  │ + SetRepeatable(cooldown?): void                    // NEW      │   │
│  │ + ResetForRepeat(): void                            // NEW      │   │
│  │ + Abandon(): void                                   // NEW      │   │
│  │ + CanBeAbandoned(): bool                            // NEW      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                    Player (updated)                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + AbandonedQuestIds: IReadOnlyList<string>          // NEW      │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + AbandonQuest(quest): void                         // NEW      │   │
│  │ + HasAbandonedQuest(questDefinitionId): bool        // NEW      │   │
│  │ + GetQuestsByCategory(category): IEnumerable<Quest> // NEW      │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Configuration Updates:                                                 │
│  └── quests.json (updated with category, repeatable fields)            │
│                                                                         │
│  quests.schema.json Updates:                                            │
│  ├── category enum validation                                          │
│  ├── isRepeatable boolean                                              │
│  └── repeatCooldown field                                              │
│                                                                         │
│  IConfigurationProvider Updates:                                        │
│  └── LoadQuestDefinitions() - includes category and repeat fields      │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Quest Category Organization

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      QUEST CATEGORY ORGANIZATION                        │
└─────────────────────────────────────────────────────────────────────────┘

    QuestCategory Enum
    ├─────────────────────────────────────────────────────────────────┐
    │                                                                 │
    │  Main                                                           │
    │  ├── Primary story quests                                       │
    │  ├── Cannot be abandoned                                        │
    │  ├── Prominent journal display                                  │
    │  └── Example: "The Shadow Over Thornwood" chain                 │
    │                                                                 │
    │  Side                                                           │
    │  ├── Optional quests for extra content                          │
    │  ├── Can be abandoned                                           │
    │  ├── Standard journal display                                   │
    │  └── Example: "The Goblin Menace"                              │
    │                                                                 │
    │  Daily                                                          │
    │  ├── Reset every day (midnight server time)                     │
    │  ├── Automatically repeatable                                   │
    │  ├── Show cooldown timer when completed                         │
    │  └── Example: "Training Dummy Practice"                         │
    │                                                                 │
    │  Repeatable                                                     │
    │  ├── Can be completed multiple times                            │
    │  ├── Optional cooldown between completions                      │
    │  ├── Progress resets on completion                              │
    │  └── Example: "Clear the Dungeon Entrance"                      │
    │                                                                 │
    │  Event                                                          │
    │  ├── Time-limited seasonal quests                               │
    │  ├── Available during specific periods                          │
    │  ├── Special rewards                                            │
    │  └── Example: "Winter Festival Tasks"                           │
    │                                                                 │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.3 Quest Abandonment Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      QUEST ABANDONMENT FLOW                             │
└─────────────────────────────────────────────────────────────────────────┘

    Player enters: abandon "Lost Heirloom"
            │
            ▼
    ┌───────────────────────────────────────┐
    │   QuestService.GetQuestByName()       │
    │   Find quest in active quests         │
    └───────────────────────────────────────┘
            │
            ├── Quest not found
            │       │
            │       ▼
            │   Error: "Quest not found in active quests."
            │
            └── Quest found
                    │
                    ▼
    ┌───────────────────────────────────────┐
    │   Check: quest.CanBeAbandoned()       │
    │   (Category != Main)                  │
    └───────────────────────────────────────┘
            │
            ├── Cannot abandon (Main quest)
            │       │
            │       ▼
            │   Error: "Main quests cannot be abandoned."
            │
            └── Can abandon
                    │
                    ▼
    ┌───────────────────────────────────────┐
    │   Display Confirmation                │
    │   ┌─────────────────────────────────┐ │
    │   │     ABANDON QUEST?              │ │
    │   │                                 │ │
    │   │ Quest: Lost Heirloom            │ │
    │   │ Progress: 50% (1/2 objectives)  │ │
    │   │                                 │ │
    │   │ WARNING: All progress lost.     │ │
    │   │ You may restart this quest.     │ │
    │   │                                 │ │
    │   │ [1] Confirm   [2] Cancel        │ │
    │   └─────────────────────────────────┘ │
    └───────────────────────────────────────┘
            │
            ├── User selects Cancel
            │       │
            │       ▼
            │   "Quest abandonment cancelled."
            │
            └── User confirms
                    │
                    ▼
    ┌───────────────────────────────────────┐
    │   quest.Abandon()                     │
    │   ├── Set Status = Available          │
    │   └── Reset all objective progress    │
    └───────────────────────────────────────┘
            │
            ▼
    ┌───────────────────────────────────────┐
    │   player.AbandonQuest(quest)          │
    │   ├── Remove from ActiveQuests        │
    │   └── Add to AbandonedQuestIds        │
    └───────────────────────────────────────┘
            │
            ▼
    Display: "Quest 'Lost Heirloom' has been abandoned."
```

### 3.4 Quest Journal Filter Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      QUEST JOURNAL FILTER FLOW                          │
└─────────────────────────────────────────────────────────────────────────┘

    Player enters: quests main
            │
            ▼
    ┌───────────────────────────────────────┐
    │   Parse filter argument               │
    │   "main" → QuestCategory.Main         │
    └───────────────────────────────────────┘
            │
            ▼
    ┌───────────────────────────────────────┐
    │   Create QuestJournalFilter           │
    │   QuestJournalFilter.ForCategory(Main)│
    └───────────────────────────────────────┘
            │
            ▼
    ┌───────────────────────────────────────┐
    │   Get all player quests               │
    │   player.ActiveQuests + Completed     │
    │   + Failed (as applicable)            │
    └───────────────────────────────────────┘
            │
            ▼
    ┌───────────────────────────────────────┐
    │   filter.Apply(allQuests)             │
    │   ├── Filter by Category == Main      │
    │   ├── Filter by Status (if set)       │
    │   ├── Filter by Timed (if set)        │
    │   ├── Filter by Chain (if set)        │
    │   └── Filter by SearchText (if set)   │
    └───────────────────────────────────────┘
            │
            ▼
    ┌───────────────────────────────────────┐
    │   Display filtered results            │
    │                                       │
    │   QUEST JOURNAL - MAIN QUESTS         │
    │   ─────────────────────────────────   │
    │                                       │
    │   THE SHADOW OVER THORNWOOD (2/5)     │
    │     Chapter 2: Into Dark Forest       │
    │     [ACTIVE]                          │
    │                                       │
    │   Filter: Main | Showing 1 chain      │
    └───────────────────────────────────────┘
```

### 3.5 Daily Quest Reset Flow

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      DAILY QUEST RESET FLOW                             │
└─────────────────────────────────────────────────────────────────────────┘

    Server Time: 00:00:00 (Midnight)
            │
            ▼
    ┌───────────────────────────────────────┐
    │   DailyResetService.ProcessReset()    │
    │   (Called at server midnight)         │
    └───────────────────────────────────────┘
            │
            ▼
    For each player:
            │
            ▼
    ┌───────────────────────────────────────┐
    │   Get completed daily quests          │
    │   player.CompletedQuests              │
    │   .Where(q => q.Category == Daily)    │
    └───────────────────────────────────────┘
            │
            ▼
    For each completed daily quest:
            │
            ▼
    ┌───────────────────────────────────────┐
    │   quest.ResetForRepeat()              │
    │   ├── Status = Available              │
    │   └── Reset objective progress        │
    └───────────────────────────────────────┘
            │
            ▼
    ┌───────────────────────────────────────┐
    │   Move quest to available pool        │
    │   (Ready for player to accept again)  │
    └───────────────────────────────────────┘
            │
            ▼
    Next player login:
    ┌─────────────────────────────────────────────────────────────────┐
    │  DAILY QUESTS AVAILABLE                                         │
    │  ─────────────────────────────────────────────────────────────  │
    │                                                                 │
    │  • Training Dummy Practice                      [AVAILABLE]     │
    │      Defeat 3 training dummies                                  │
    │      Rewards: 25 XP, 10 gold                                    │
    │                                                                 │
    │  • Guard Patrol                                 [AVAILABLE]     │
    │      Complete a patrol route                                    │
    │      Rewards: 20 XP, 15 gold                                    │
    │                                                                 │
    │  Daily quests reset each day at midnight.                       │
    └─────────────────────────────────────────────────────────────────┘
```

---

## 4. User Stories

### US-3.2c-1: Organize Quests by Category
**As a** player
**I want to** see my quests organized by category
**So that** I can easily find the type of quest I'm looking for

**Acceptance Criteria:**
- Quest journal shows category for each quest
- Main quests are visually prominent
- Side quests display in separate section
- Daily quests show availability status
- Filter by category works correctly

### US-3.2c-2: Abandon Unwanted Quests
**As a** player
**I want to** abandon quests I no longer want to complete
**So that** I can declutter my quest log

**Acceptance Criteria:**
- Can abandon side, daily, repeatable, and event quests
- Cannot abandon main story quests
- Confirmation prompt shows before abandonment
- Progress is reset when quest is abandoned
- Abandoned quest can be restarted later

### US-3.2c-3: Complete Daily Quests
**As a** player
**I want to** complete daily quests that reset each day
**So that** I have ongoing tasks for regular rewards

**Acceptance Criteria:**
- Daily quests marked with Daily category
- Completed daily quests show cooldown timer
- Daily quests reset at midnight server time
- Rewards can be earned once per day
- Daily status visible in quest journal

### US-3.2c-4: Repeat Completed Quests
**As a** player
**I want to** replay repeatable quests
**So that** I can earn rewards multiple times

**Acceptance Criteria:**
- Repeatable quests can be completed multiple times
- Optional cooldown between completions
- Progress resets when quest completes
- Cooldown timer shows if applicable
- Quest becomes available after cooldown expires

### US-3.2c-5: Filter Quest Journal
**As a** player
**I want to** filter my quest journal
**So that** I can focus on specific quest types

**Acceptance Criteria:**
- Can filter by category (main, side, daily, etc.)
- Can filter by status (active, completed, failed)
- Can filter timed quests only
- Can filter chain quests only
- Filter persists during session
- Filter count shows "Showing X of Y quests"

### US-3.2c-6: Configure Quest Categories
**As a** game designer
**I want to** assign categories to quests in configuration
**So that** quests are properly organized

**Acceptance Criteria:**
- Category can be set in quest configuration
- Default category is Side if not specified
- Repeatable flag can be set with optional cooldown
- Invalid category produces clear error
- Category affects quest behavior (abandonment, reset)

---

## 5. Data Models

### 5.1 QuestCategory Enum

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Categories for organizing quests.
/// </summary>
/// <remarks>
/// Quest categories affect display, behavior (abandonment), and reset mechanics.
/// Main quests cannot be abandoned. Daily and Repeatable quests support reset.
/// </remarks>
public enum QuestCategory
{
    /// <summary>
    /// Main story quests.
    /// </summary>
    /// <remarks>
    /// Primary narrative quests that cannot be abandoned.
    /// Displayed prominently in the quest journal.
    /// </remarks>
    Main,

    /// <summary>
    /// Optional side quests.
    /// </summary>
    /// <remarks>
    /// Non-critical quests that can be abandoned.
    /// Provide additional content and rewards.
    /// </remarks>
    Side,

    /// <summary>
    /// Daily repeatable quests.
    /// </summary>
    /// <remarks>
    /// Reset at midnight server time each day.
    /// Can be completed once per day for rewards.
    /// </remarks>
    Daily,

    /// <summary>
    /// Infinitely repeatable quests.
    /// </summary>
    /// <remarks>
    /// Can be completed multiple times with optional cooldown.
    /// Progress resets on completion.
    /// </remarks>
    Repeatable,

    /// <summary>
    /// Event or seasonal quests.
    /// </summary>
    /// <remarks>
    /// Time-limited quests available during specific periods.
    /// May offer unique rewards not available otherwise.
    /// </remarks>
    Event
}
```

### 5.2 QuestJournalFilter Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Filter options for the quest journal.
/// </summary>
/// <remarks>
/// Immutable record struct for filtering quest collections.
/// Supports category, status, timed, chain, and text search filters.
/// Filters can be combined for precise quest selection.
/// </remarks>
public readonly record struct QuestJournalFilter
{
    /// <summary>
    /// Gets the category filter.
    /// </summary>
    /// <remarks>
    /// Null means all categories. Set to filter by specific category.
    /// </remarks>
    public QuestCategory? Category { get; init; }

    /// <summary>
    /// Gets the status filter.
    /// </summary>
    /// <remarks>
    /// Null means all statuses. Set to filter Active, Completed, Failed, etc.
    /// </remarks>
    public QuestStatus? Status { get; init; }

    /// <summary>
    /// Gets whether to show only timed quests.
    /// </summary>
    /// <remarks>
    /// When true, only shows quests with time limits.
    /// Uses Quest.IsTimed from v0.3.2b.
    /// </remarks>
    public bool TimedOnly { get; init; }

    /// <summary>
    /// Gets whether to show only chain quests.
    /// </summary>
    /// <remarks>
    /// When true, only shows quests that are part of a chain.
    /// Uses Quest.IsInChain from v0.3.2a.
    /// </remarks>
    public bool ChainsOnly { get; init; }

    /// <summary>
    /// Gets the text search filter.
    /// </summary>
    /// <remarks>
    /// Searches quest name and description.
    /// Case-insensitive partial match.
    /// </remarks>
    public string? SearchText { get; init; }

    /// <summary>
    /// Gets the default filter (show all quests).
    /// </summary>
    public static QuestJournalFilter Default => new();

    /// <summary>
    /// Creates a category filter.
    /// </summary>
    /// <param name="category">The category to filter by.</param>
    /// <returns>A filter for the specified category.</returns>
    public static QuestJournalFilter ForCategory(QuestCategory category) => new()
    {
        Category = category
    };

    /// <summary>
    /// Creates a filter for active quests only.
    /// </summary>
    public static QuestJournalFilter ActiveOnly => new()
    {
        Status = QuestStatus.Active
    };

    /// <summary>
    /// Creates a filter for completed quests only.
    /// </summary>
    public static QuestJournalFilter CompletedOnly => new()
    {
        Status = QuestStatus.Completed
    };

    /// <summary>
    /// Creates a filter for failed quests only.
    /// </summary>
    public static QuestJournalFilter FailedOnly => new()
    {
        Status = QuestStatus.Failed
    };

    /// <summary>
    /// Creates a filter for timed quests only.
    /// </summary>
    public static QuestJournalFilter TimedQuests => new()
    {
        TimedOnly = true
    };

    /// <summary>
    /// Creates a filter for chain quests only.
    /// </summary>
    public static QuestJournalFilter ChainQuests => new()
    {
        ChainsOnly = true
    };

    /// <summary>
    /// Creates a filter with text search.
    /// </summary>
    /// <param name="searchText">The text to search for.</param>
    /// <returns>A filter with the search text set.</returns>
    public static QuestJournalFilter WithSearch(string searchText) => new()
    {
        SearchText = searchText
    };

    /// <summary>
    /// Applies the filter to a quest collection.
    /// </summary>
    /// <param name="quests">The quests to filter.</param>
    /// <returns>Filtered quest collection.</returns>
    /// <remarks>
    /// Filters are applied in order: Category, Status, Timed, Chains, SearchText.
    /// All filters must match for a quest to be included.
    /// </remarks>
    public IEnumerable<Quest> Apply(IEnumerable<Quest> quests)
    {
        ArgumentNullException.ThrowIfNull(quests);

        var result = quests;

        if (Category.HasValue)
            result = result.Where(q => q.Category == Category.Value);

        if (Status.HasValue)
            result = result.Where(q => q.Status == Status.Value);

        if (TimedOnly)
            result = result.Where(q => q.IsTimed);

        if (ChainsOnly)
            result = result.Where(q => q.IsInChain);

        if (!string.IsNullOrEmpty(SearchText))
        {
            var searchLower = SearchText.ToLowerInvariant();
            result = result.Where(q =>
                q.Name.Contains(searchLower, StringComparison.OrdinalIgnoreCase) ||
                q.Description.Contains(searchLower, StringComparison.OrdinalIgnoreCase));
        }

        return result;
    }

    /// <summary>
    /// Gets whether any filter is active.
    /// </summary>
    public bool HasActiveFilter =>
        Category.HasValue ||
        Status.HasValue ||
        TimedOnly ||
        ChainsOnly ||
        !string.IsNullOrEmpty(SearchText);

    /// <summary>
    /// Gets a display name for the current filter.
    /// </summary>
    /// <returns>Human-readable filter description.</returns>
    public string GetDisplayName()
    {
        var parts = new List<string>();

        if (Category.HasValue)
            parts.Add(Category.Value.ToString());

        if (Status.HasValue)
            parts.Add(Status.Value.ToString());

        if (TimedOnly)
            parts.Add("Timed");

        if (ChainsOnly)
            parts.Add("Chains");

        if (!string.IsNullOrEmpty(SearchText))
            parts.Add($"\"{SearchText}\"");

        return parts.Count > 0 ? string.Join(", ", parts) : "All";
    }
}
```

### 5.3 Quest Entity Updates

```csharp
// Additions to existing Quest class in RuneAndRust.Domain.Entities

/// <summary>
/// Gets the quest category.
/// </summary>
/// <remarks>
/// Determines organizational placement and behavior (abandonment, reset).
/// Defaults to Side if not specified.
/// </remarks>
public QuestCategory Category { get; private set; } = QuestCategory.Side;

/// <summary>
/// Gets whether this quest is repeatable.
/// </summary>
/// <remarks>
/// Repeatable quests can be completed multiple times.
/// Progress resets on completion.
/// </remarks>
public bool IsRepeatable { get; private set; }

/// <summary>
/// Gets whether this is a daily quest.
/// </summary>
/// <remarks>
/// Daily quests are a special type of repeatable that reset at midnight.
/// Computed from Category for convenience.
/// </remarks>
public bool IsDaily => Category == QuestCategory.Daily;

/// <summary>
/// Gets the cooldown for repeatable quests (in turns or hours).
/// </summary>
/// <remarks>
/// Null means no cooldown (immediately repeatable).
/// For daily quests, this is typically ignored as they reset at midnight.
/// </remarks>
public int? RepeatCooldown { get; private set; }

/// <summary>
/// Gets when this quest can be repeated.
/// </summary>
/// <remarks>
/// Set when a repeatable quest is completed.
/// Null if quest is not completed or has no cooldown.
/// </remarks>
public DateTime? RepeatableAfter { get; private set; }

/// <summary>
/// Gets whether the quest is on cooldown.
/// </summary>
/// <remarks>
/// True if RepeatableAfter is set and is in the future.
/// </remarks>
public bool IsOnCooldown => RepeatableAfter.HasValue && RepeatableAfter.Value > DateTime.UtcNow;

/// <summary>
/// Gets the time remaining until the quest can be repeated.
/// </summary>
/// <remarks>
/// Returns null if not on cooldown or not repeatable.
/// </remarks>
public TimeSpan? CooldownRemaining => IsOnCooldown
    ? RepeatableAfter!.Value - DateTime.UtcNow
    : null;

/// <summary>
/// Sets the quest category.
/// </summary>
/// <param name="category">The category to set.</param>
public void SetCategory(QuestCategory category)
{
    Category = category;
}

/// <summary>
/// Marks the quest as repeatable with an optional cooldown.
/// </summary>
/// <param name="cooldownTurns">Optional cooldown in turns or hours.</param>
/// <remarks>
/// Repeatable quests can be completed multiple times.
/// Daily quests are automatically repeatable with a midnight reset.
/// </remarks>
public void SetRepeatable(int? cooldownTurns = null)
{
    IsRepeatable = true;
    RepeatCooldown = cooldownTurns;
}

/// <summary>
/// Resets a repeatable quest for another completion.
/// </summary>
/// <exception cref="InvalidOperationException">Thrown if quest is not repeatable.</exception>
/// <remarks>
/// Resets status to Available and clears objective progress.
/// Does not clear RepeatableAfter if on cooldown.
/// </remarks>
public void ResetForRepeat()
{
    if (!IsRepeatable && Category != QuestCategory.Daily)
        throw new InvalidOperationException("Quest is not repeatable.");

    Status = QuestStatus.Available;

    foreach (var objective in _objectives)
    {
        objective.ResetProgress();
    }

    // Clear failure reason if any
    FailureReason = null;

    // Note: RepeatableAfter is not cleared here - cooldown check is separate
}

/// <summary>
/// Sets the cooldown after completing a repeatable quest.
/// </summary>
/// <param name="cooldownHours">Hours until quest is repeatable.</param>
public void SetRepeatCooldown(int cooldownHours)
{
    if (cooldownHours > 0)
    {
        RepeatableAfter = DateTime.UtcNow.AddHours(cooldownHours);
    }
    else
    {
        RepeatableAfter = null;
    }
}

/// <summary>
/// Clears the repeat cooldown (makes quest immediately available).
/// </summary>
public void ClearRepeatCooldown()
{
    RepeatableAfter = null;
}

/// <summary>
/// Gets whether this quest can be abandoned.
/// </summary>
/// <returns>True if quest can be abandoned, false for main quests.</returns>
/// <remarks>
/// Main quests cannot be abandoned to ensure story progression.
/// All other categories can be abandoned.
/// </remarks>
public bool CanBeAbandoned()
{
    return Category != QuestCategory.Main;
}

/// <summary>
/// Abandons this quest.
/// </summary>
/// <exception cref="InvalidOperationException">
/// Thrown if quest is not active or is a main quest.
/// </exception>
/// <remarks>
/// Resets quest to Available status and clears objective progress.
/// Quest can be accepted again after abandonment.
/// </remarks>
public void Abandon()
{
    if (Status != QuestStatus.Active)
        throw new InvalidOperationException("Can only abandon active quests.");

    if (Category == QuestCategory.Main)
        throw new InvalidOperationException("Cannot abandon main quests.");

    Status = QuestStatus.Available;

    foreach (var objective in _objectives)
    {
        objective.ResetProgress();
    }

    // Clear any failure or timing state
    FailureReason = null;
    if (IsTimed && TurnsRemaining.HasValue)
    {
        TurnsRemaining = TimeLimit; // Reset time if timed
    }
}
```

### 5.4 Player Entity Updates

```csharp
// Additions to existing Player class in RuneAndRust.Domain.Entities

/// <summary>
/// Gets quests that have been abandoned by the player.
/// </summary>
/// <remarks>
/// Tracks quest definition IDs that were abandoned.
/// Used to show abandonment history or apply restrictions.
/// </remarks>
public IReadOnlyList<string> AbandonedQuestIds => _abandonedQuestIds;
private readonly List<string> _abandonedQuestIds = new();

/// <summary>
/// Abandons a quest.
/// </summary>
/// <param name="quest">The quest to abandon.</param>
/// <exception cref="ArgumentNullException">Thrown if quest is null.</exception>
/// <remarks>
/// Removes quest from active quests and calls quest.Abandon().
/// Records the abandonment in AbandonedQuestIds.
/// </remarks>
public void AbandonQuest(Quest quest)
{
    ArgumentNullException.ThrowIfNull(quest);

    if (_activeQuests.Remove(quest))
    {
        quest.Abandon();
        _abandonedQuestIds.Add(quest.DefinitionId);
    }
}

/// <summary>
/// Gets whether a specific quest has been abandoned.
/// </summary>
/// <param name="questDefinitionId">The quest definition ID to check.</param>
/// <returns>True if the quest was previously abandoned.</returns>
public bool HasAbandonedQuest(string questDefinitionId)
{
    if (string.IsNullOrWhiteSpace(questDefinitionId))
        return false;

    return _abandonedQuestIds.Any(id =>
        id.Equals(questDefinitionId, StringComparison.OrdinalIgnoreCase));
}

/// <summary>
/// Gets the count of abandoned quests.
/// </summary>
public int AbandonedQuestCount => _abandonedQuestIds.Count;

/// <summary>
/// Gets active quests filtered by category.
/// </summary>
/// <param name="category">The category to filter by.</param>
/// <returns>Active quests matching the category.</returns>
public IEnumerable<Quest> GetQuestsByCategory(QuestCategory category)
{
    return _activeQuests.Where(q => q.Category == category);
}

/// <summary>
/// Gets all quests (active, completed, failed) filtered by category.
/// </summary>
/// <param name="category">The category to filter by.</param>
/// <returns>All quests matching the category.</returns>
public IEnumerable<Quest> GetAllQuestsByCategory(QuestCategory category)
{
    var results = new List<Quest>();

    results.AddRange(_activeQuests.Where(q => q.Category == category));
    results.AddRange(_completedQuests.Where(q => q.Category == category));
    results.AddRange(_failedQuests.Where(q => q.Category == category));

    return results;
}

/// <summary>
/// Gets all main quests (active, completed, failed).
/// </summary>
/// <returns>All main story quests.</returns>
public IEnumerable<Quest> GetMainQuests()
{
    return GetAllQuestsByCategory(QuestCategory.Main);
}

/// <summary>
/// Gets all daily quests.
/// </summary>
/// <returns>All daily quests.</returns>
public IEnumerable<Quest> GetDailyQuests()
{
    return GetAllQuestsByCategory(QuestCategory.Daily);
}

/// <summary>
/// Gets completed daily quests that need to be reset.
/// </summary>
/// <returns>Completed daily quests.</returns>
public IEnumerable<Quest> GetCompletedDailyQuests()
{
    return _completedQuests.Where(q => q.Category == QuestCategory.Daily);
}
```

---

## 6. Configuration Schemas

### 6.1 quests.json Updates (Categories & Repeatable)

```json
{
  "$schema": "../schemas/quests.schema.json",
  "quests": [
    {
      "id": "training-dummy",
      "name": "Training Dummy Practice",
      "description": "Keep your skills sharp by practicing on the training dummies.",
      "category": "Daily",
      "isRepeatable": true,
      "giverNpcId": "training-master",
      "objectives": [
        {
          "type": "Kill",
          "description": "Defeat training dummies",
          "target": { "targetType": "training-dummy" },
          "requiredCount": 3
        }
      ],
      "rewards": {
        "entries": [
          { "type": "XP", "amount": 25 },
          { "type": "Gold", "amount": 10 }
        ]
      }
    },
    {
      "id": "guard-patrol",
      "name": "Guard Patrol",
      "description": "Help the town guard by completing a patrol route.",
      "category": "Daily",
      "isRepeatable": true,
      "giverNpcId": "guard-captain",
      "objectives": [
        {
          "type": "Explore",
          "description": "Visit all patrol checkpoints",
          "target": { "targetId": "patrol-route-1" }
        }
      ],
      "rewards": {
        "entries": [
          { "type": "XP", "amount": 20 },
          { "type": "Gold", "amount": 15 },
          { "type": "Reputation", "targetId": "town-guard", "amount": 10, "displayName": "Town Guard" }
        ]
      }
    },
    {
      "id": "rat-problem",
      "name": "Rat Problem",
      "description": "The innkeeper needs help with a pest problem in the cellar.",
      "category": "Side",
      "isRepeatable": false,
      "giverNpcId": "innkeeper",
      "objectives": [
        {
          "type": "Kill",
          "description": "Kill rats in the cellar",
          "target": { "targetType": "cellar-rat" },
          "requiredCount": 5
        }
      ],
      "rewards": {
        "entries": [
          { "type": "XP", "amount": 30 },
          { "type": "Gold", "amount": 15 }
        ]
      }
    },
    {
      "id": "dungeon-clear",
      "name": "Clear the Dungeon Entrance",
      "description": "The dungeon entrance is overrun with monsters again. Clear them out.",
      "category": "Repeatable",
      "isRepeatable": true,
      "repeatCooldown": 24,
      "giverNpcId": "adventurer-guild-master",
      "objectives": [
        {
          "type": "Kill",
          "description": "Clear monsters from entrance",
          "target": { "targetType": "dungeon-monster" },
          "requiredCount": 10
        }
      ],
      "rewards": {
        "entries": [
          { "type": "XP", "amount": 50 },
          { "type": "Gold", "amount": 30 }
        ]
      }
    },
    {
      "id": "winter-festival-gathering",
      "name": "Winter Festival Preparations",
      "description": "Help gather decorations for the winter festival.",
      "category": "Event",
      "isRepeatable": false,
      "giverNpcId": "festival-organizer",
      "objectives": [
        {
          "type": "Collect",
          "description": "Gather winter berries",
          "target": { "targetId": "winter-berry" },
          "requiredCount": 10
        },
        {
          "type": "Collect",
          "description": "Collect pine branches",
          "target": { "targetId": "pine-branch" },
          "requiredCount": 5
        }
      ],
      "rewards": {
        "entries": [
          { "type": "XP", "amount": 75 },
          { "type": "Item", "targetId": "festival-token", "displayName": "Festival Token" }
        ]
      }
    }
  ]
}
```

### 6.2 quests.schema.json Updates

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Quest Configuration",
  "description": "Quest definitions including categories and repeatable mechanics",
  "type": "object",
  "required": ["quests"],
  "properties": {
    "quests": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/questDefinition"
      }
    }
  },
  "definitions": {
    "questDefinition": {
      "type": "object",
      "required": ["id", "name", "objectives"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100
        },
        "description": {
          "type": "string",
          "maxLength": 2000
        },
        "category": {
          "type": "string",
          "enum": ["Main", "Side", "Daily", "Repeatable", "Event"],
          "default": "Side",
          "description": "Quest category for organization and behavior"
        },
        "isRepeatable": {
          "type": "boolean",
          "default": false,
          "description": "Whether quest can be completed multiple times"
        },
        "repeatCooldown": {
          "type": "integer",
          "minimum": 0,
          "maximum": 168,
          "description": "Cooldown in hours between completions (0 = no cooldown)"
        },
        "giverNpcId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "timeLimit": {
          "type": "integer",
          "minimum": 1,
          "maximum": 1000,
          "description": "Time limit in turns (from v0.3.2b)"
        },
        "chainId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Chain this quest belongs to (from v0.3.2a)"
        },
        "objectives": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/objective"
          }
        },
        "failureConditions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/failureCondition"
          },
          "description": "Conditions that cause quest failure (from v0.3.2b)"
        },
        "rewards": {
          "$ref": "#/definitions/questReward"
        }
      }
    },
    "objective": {
      "type": "object",
      "required": ["type", "description"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["Kill", "Collect", "Talk", "Explore", "Escort", "Interact"]
        },
        "description": {
          "type": "string"
        },
        "target": {
          "type": "object",
          "properties": {
            "targetId": { "type": "string" },
            "targetType": { "type": "string" }
          }
        },
        "requiredCount": {
          "type": "integer",
          "minimum": 1,
          "default": 1
        }
      }
    },
    "failureCondition": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["TimeExpired", "NPCDied", "ItemLost", "ReputationDropped", "LeftArea", "WrongTarget", "Custom"]
        },
        "targetId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "threshold": {
          "type": "integer"
        },
        "message": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "questReward": {
      "type": "object",
      "required": ["entries"],
      "properties": {
        "entries": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rewardEntry"
          }
        }
      }
    },
    "rewardEntry": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["XP", "Gold", "Item", "Reputation", "Unlock"]
        },
        "amount": {
          "type": "integer"
        },
        "targetId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$"
        },
        "displayName": {
          "type": ["string", "null"]
        }
      }
    }
  }
}
```

---

## 7. Service Specifications

### 7.1 IQuestService Updates

```csharp
namespace RuneAndRust.Application.Interfaces;

// Additions to existing IQuestService interface

/// <summary>
/// Abandons an active quest for a player.
/// </summary>
/// <param name="player">The player abandoning the quest.</param>
/// <param name="questId">The quest definition ID or name.</param>
/// <returns>The result of the abandonment attempt.</returns>
/// <remarks>
/// Main quests cannot be abandoned.
/// Quest must be in player's active quests.
/// </remarks>
AbandonmentResult AbandonQuest(Player player, string questId);

/// <summary>
/// Gets whether a quest can be abandoned.
/// </summary>
/// <param name="quest">The quest to check.</param>
/// <returns>True if the quest can be abandoned.</returns>
bool CanAbandon(Quest quest);

/// <summary>
/// Gets quests filtered by category.
/// </summary>
/// <param name="player">The player.</param>
/// <param name="category">The category to filter by.</param>
/// <returns>Quests matching the category.</returns>
IEnumerable<Quest> GetQuestsByCategory(Player player, QuestCategory category);

/// <summary>
/// Gets quests matching a filter.
/// </summary>
/// <param name="player">The player.</param>
/// <param name="filter">The filter to apply.</param>
/// <returns>Filtered quest collection.</returns>
IEnumerable<Quest> GetFilteredQuests(Player player, QuestJournalFilter filter);

/// <summary>
/// Resets daily quests for a player.
/// </summary>
/// <param name="player">The player.</param>
/// <returns>Quests that were reset.</returns>
/// <remarks>
/// Called during daily reset processing.
/// Moves completed daily quests back to available.
/// </remarks>
IEnumerable<Quest> ResetDailyQuests(Player player);

/// <summary>
/// Gets repeatable quests available for completion.
/// </summary>
/// <param name="player">The player.</param>
/// <returns>Repeatable quests not on cooldown.</returns>
IEnumerable<Quest> GetAvailableRepeatableQuests(Player player);

/// <summary>
/// Gets repeatable quests currently on cooldown.
/// </summary>
/// <param name="player">The player.</param>
/// <returns>Repeatable quests that are on cooldown.</returns>
IEnumerable<Quest> GetCooldownQuests(Player player);

/// <summary>
/// Gets a quest by name (case-insensitive).
/// </summary>
/// <param name="player">The player.</param>
/// <param name="questName">The quest name to search for.</param>
/// <returns>The matching quest, or null if not found.</returns>
Quest? GetQuestByName(Player player, string questName);
```

### 7.2 QuestService Implementation Updates

```csharp
namespace RuneAndRust.Application.Services;

// Additions to existing QuestService class

/// <inheritdoc />
public AbandonmentResult AbandonQuest(Player player, string questId)
{
    ArgumentNullException.ThrowIfNull(player);
    ArgumentException.ThrowIfNullOrWhiteSpace(questId);

    // Find quest by ID or name
    var quest = player.ActiveQuests.FirstOrDefault(q =>
        q.DefinitionId.Equals(questId, StringComparison.OrdinalIgnoreCase) ||
        q.Name.Equals(questId, StringComparison.OrdinalIgnoreCase));

    if (quest == null)
    {
        _logger.LogWarning(
            "Abandonment failed: Quest '{QuestId}' not found in active quests",
            questId);

        return new AbandonmentResult
        {
            Success = false,
            QuestId = questId,
            QuestName = questId,
            FailureReason = "Quest not found in active quests."
        };
    }

    if (!quest.CanBeAbandoned())
    {
        _logger.LogWarning(
            "Abandonment failed: Quest '{QuestId}' is a main quest",
            quest.DefinitionId);

        return new AbandonmentResult
        {
            Success = false,
            QuestId = quest.DefinitionId,
            QuestName = quest.Name,
            FailureReason = "Main quests cannot be abandoned."
        };
    }

    player.AbandonQuest(quest);

    _logger.LogInformation(
        "Quest '{QuestId}' abandoned by player",
        quest.DefinitionId);

    return new AbandonmentResult
    {
        Success = true,
        QuestId = quest.DefinitionId,
        QuestName = quest.Name,
        FailureReason = null
    };
}

/// <inheritdoc />
public bool CanAbandon(Quest quest)
{
    ArgumentNullException.ThrowIfNull(quest);
    return quest.CanBeAbandoned();
}

/// <inheritdoc />
public IEnumerable<Quest> GetQuestsByCategory(Player player, QuestCategory category)
{
    ArgumentNullException.ThrowIfNull(player);
    return player.GetQuestsByCategory(category);
}

/// <inheritdoc />
public IEnumerable<Quest> GetFilteredQuests(Player player, QuestJournalFilter filter)
{
    ArgumentNullException.ThrowIfNull(player);

    // Combine all quest collections
    var allQuests = new List<Quest>();
    allQuests.AddRange(player.ActiveQuests);
    allQuests.AddRange(player.CompletedQuests);
    allQuests.AddRange(player.FailedQuests);

    return filter.Apply(allQuests);
}

/// <inheritdoc />
public IEnumerable<Quest> ResetDailyQuests(Player player)
{
    ArgumentNullException.ThrowIfNull(player);

    var resetQuests = new List<Quest>();

    var completedDailies = player.GetCompletedDailyQuests().ToList();

    foreach (var quest in completedDailies)
    {
        quest.ResetForRepeat();
        quest.ClearRepeatCooldown();
        resetQuests.Add(quest);

        _logger.LogDebug(
            "Daily quest '{QuestId}' reset for player",
            quest.DefinitionId);
    }

    if (resetQuests.Count > 0)
    {
        _logger.LogInformation(
            "Reset {Count} daily quests for player",
            resetQuests.Count);
    }

    return resetQuests;
}

/// <inheritdoc />
public IEnumerable<Quest> GetAvailableRepeatableQuests(Player player)
{
    ArgumentNullException.ThrowIfNull(player);

    return player.CompletedQuests
        .Where(q => q.IsRepeatable && !q.IsOnCooldown);
}

/// <inheritdoc />
public IEnumerable<Quest> GetCooldownQuests(Player player)
{
    ArgumentNullException.ThrowIfNull(player);

    return player.CompletedQuests
        .Where(q => q.IsRepeatable && q.IsOnCooldown);
}

/// <inheritdoc />
public Quest? GetQuestByName(Player player, string questName)
{
    ArgumentNullException.ThrowIfNull(player);

    if (string.IsNullOrWhiteSpace(questName))
        return null;

    return player.ActiveQuests.FirstOrDefault(q =>
        q.Name.Equals(questName, StringComparison.OrdinalIgnoreCase));
}
```

### 7.3 Application DTOs

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// Result of a quest abandonment attempt.
/// </summary>
/// <param name="Success">Whether the abandonment succeeded.</param>
/// <param name="QuestId">The quest definition ID.</param>
/// <param name="QuestName">The quest display name.</param>
/// <param name="FailureReason">Reason for failure if unsuccessful.</param>
public record AbandonmentResult(
    bool Success,
    string QuestId,
    string QuestName,
    string? FailureReason);

/// <summary>
/// DTO for abandonment confirmation display.
/// </summary>
/// <param name="QuestId">The quest instance ID.</param>
/// <param name="QuestName">The quest display name.</param>
/// <param name="Progress">Completion percentage.</param>
/// <param name="ObjectivesCompleted">Number of objectives completed.</param>
/// <param name="TotalObjectives">Total number of objectives.</param>
/// <param name="CanRestart">Whether quest can be restarted after abandonment.</param>
/// <param name="WarningMessage">Warning message to display.</param>
public record AbandonConfirmDto(
    Guid QuestId,
    string QuestName,
    int Progress,
    int ObjectivesCompleted,
    int TotalObjectives,
    bool CanRestart,
    string WarningMessage);

/// <summary>
/// DTO for daily quest status display.
/// </summary>
/// <param name="QuestId">The quest definition ID.</param>
/// <param name="QuestName">The quest display name.</param>
/// <param name="Status">Current status string.</param>
/// <param name="ResetTime">When the quest resets.</param>
/// <param name="TimeUntilReset">Time remaining until reset.</param>
public record DailyQuestStatusDto(
    string QuestId,
    string QuestName,
    string Status,
    DateTime? ResetTime,
    TimeSpan? TimeUntilReset)
{
    /// <summary>
    /// Gets a formatted time until reset string.
    /// </summary>
    public string FormattedTimeUntilReset => TimeUntilReset.HasValue
        ? $"{(int)TimeUntilReset.Value.TotalHours}h {TimeUntilReset.Value.Minutes}m"
        : "Available";
}

/// <summary>
/// DTO for quest journal filter display.
/// </summary>
/// <param name="Category">The category filter.</param>
/// <param name="Status">The status filter.</param>
/// <param name="TimedOnly">Whether showing timed quests only.</param>
/// <param name="ChainsOnly">Whether showing chain quests only.</param>
/// <param name="SearchText">The search text filter.</param>
/// <param name="DisplayName">Human-readable filter description.</param>
public record QuestJournalFilterDto(
    string? Category,
    string? Status,
    bool TimedOnly,
    bool ChainsOnly,
    string? SearchText,
    string DisplayName);

/// <summary>
/// Updates to QuestSummaryDto to include category.
/// </summary>
public record QuestSummaryDto(
    Guid Id,
    string Name,
    string Description,
    string Status,
    string Category,           // NEW
    int Progress,
    bool IsTimed,
    int? TurnsRemaining,
    bool IsInChain,
    string? ChainName,
    bool IsRepeatable,         // NEW
    bool IsOnCooldown,         // NEW
    TimeSpan? CooldownRemaining); // NEW
```

---

## 8. User-Facing Changes

### 8.1 Filtered Quest Journal

```
> quests main

┌─────────────────────────────────────────────────────────────┐
│               QUEST JOURNAL - MAIN QUESTS                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  THE SHADOW OVER THORNWOOD                        (2/5)     │
│  ───────────────────────────────────────────────────────────│
│    Chapter 2: Into the Dark Forest          [ACTIVE]        │
│    Next: The Heart of Corruption                            │
│                                                             │
│  THE MERCHANT GUILD                               (0/3)     │
│  ───────────────────────────────────────────────────────────│
│    [LOCKED] Requires: Merchant Guild reputation 100+        │
│                                                             │
│  Filter: Main | Showing 2 quest chains                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘

> quests side

┌─────────────────────────────────────────────────────────────┐
│               QUEST JOURNAL - SIDE QUESTS                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  • The Goblin Menace                            [COMPLETE]  │
│  • Lost Heirloom                                [ACTIVE]    │
│  • Rat Problem                                  [AVAILABLE] │
│                                                             │
│  Filter: Side | Showing 3 quests                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.2 Quest Abandonment

```
> abandon "Lost Heirloom"

┌─────────────────────────────────────────────────────────────┐
│                   ABANDON QUEST?                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Quest: Lost Heirloom                                       │
│  Progress: 50% (1/2 objectives)                             │
│                                                             │
│  WARNING: All progress will be lost.                        │
│  You may be able to restart this quest later.               │
│                                                             │
│  [1] Confirm - Abandon this quest                           │
│  [2] Cancel - Keep the quest                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘

> 1

Quest "Lost Heirloom" has been abandoned.

---

> abandon "The Shadow Over Thornwood"

Cannot abandon "The Shadow Over Thornwood".
Main story quests cannot be abandoned.
```

### 8.3 Daily Quests

```
> quests daily

┌─────────────────────────────────────────────────────────────┐
│               QUEST JOURNAL - DAILY QUESTS                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  • Training Dummy Practice                      [AVAILABLE] │
│      Defeat 3 training dummies                              │
│      Rewards: 25 XP, 10 gold                                │
│                                                             │
│  • Guard Patrol                                 [COMPLETED] │
│      Resets in: 18h 32m                                     │
│                                                             │
│  • Gather Herbs                                 [ACTIVE]    │
│      Collect 5 medicinal herbs (2/5)                        │
│      Rewards: 20 XP, 15 gold                                │
│                                                             │
│  Daily quests reset each day at midnight.                   │
│                                                             │
│  Filter: Daily | Showing 3 quests                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.4 Repeatable Quests

```
> quests repeatable

┌─────────────────────────────────────────────────────────────┐
│            QUEST JOURNAL - REPEATABLE QUESTS                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  • Clear the Dungeon Entrance                   [AVAILABLE] │
│      Clear monsters from entrance (10 required)             │
│      Rewards: 50 XP, 30 gold                                │
│                                                             │
│  • Arena Challenge                              [COOLDOWN]  │
│      Available in: 6h 15m                                   │
│                                                             │
│  • Mining Contract                              [ACTIVE]    │
│      Gather 20 iron ore (12/20)                             │
│      Rewards: 40 XP, 25 gold                                │
│                                                             │
│  Filter: Repeatable | Showing 3 quests                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.5 Combined Filters

```
> quests active timed

┌─────────────────────────────────────────────────────────────┐
│          QUEST JOURNAL - ACTIVE TIMED QUESTS                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ⏱ Urgent Delivery                          ⚠ 5 turns left │
│     [SIDE] Deliver medicine to Thornwood                    │
│                                                             │
│  ⏱ Protect the Merchant                      12 turns left  │
│     [SIDE] Escort Grimbold through the pass                 │
│                                                             │
│  Filter: Active, Timed | Showing 2 of 8 quests              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.6 Command Reference

```
Quest Journal Commands:
───────────────────────────────────────────────────────────────
> quests                    Show all quests
> quests main               Show main story quests only
> quests side               Show side quests only
> quests daily              Show daily quests
> quests repeatable         Show repeatable quests
> quests event              Show event quests
> quests active             Show active quests only
> quests completed          Show completed quests
> quests failed             Show failed quests
> quests timed              Show timed quests only
> quests chains             Show chain quests only

Quest Management Commands:
───────────────────────────────────────────────────────────────
> abandon "Quest Name"      Abandon a quest (not main quests)
> abandon                   Show list of abandonable quests
```

---

## 9. Logging Requirements

### 9.1 Log Events

| Event | Level | Message Template | Properties |
|-------|-------|------------------|------------|
| Quest Abandoned | Info | "Quest '{QuestId}' abandoned by player" | QuestId |
| Abandon Failed (Not Found) | Warning | "Abandonment failed: Quest '{QuestId}' not found in active quests" | QuestId |
| Abandon Failed (Main) | Warning | "Abandonment failed: Quest '{QuestId}' is a main quest" | QuestId |
| Daily Reset | Info | "Reset {Count} daily quests for player" | Count |
| Daily Reset (Individual) | Debug | "Daily quest '{QuestId}' reset for player" | QuestId |
| Filter Applied | Debug | "Applied quest filter: {FilterName}, found {Count} quests" | FilterName, Count |
| Repeat Cooldown Set | Debug | "Quest '{QuestId}' cooldown set to {Hours} hours" | QuestId, Hours |

### 9.2 Example Log Output

```
[2024-01-20 14:30:00 INF] Quest 'lost-heirloom' abandoned by player
[2024-01-20 14:30:00 DBG] Applied quest filter: Side, found 3 quests

[2024-01-20 14:35:00 WRN] Abandonment failed: Quest 'shadow-chapter-2' is a main quest

[2024-01-21 00:00:00 DBG] Daily quest 'training-dummy' reset for player
[2024-01-21 00:00:00 DBG] Daily quest 'guard-patrol' reset for player
[2024-01-21 00:00:00 INF] Reset 2 daily quests for player

[2024-01-21 10:15:00 DBG] Quest 'dungeon-clear' cooldown set to 24 hours
```

---

## 10. Unit Test Specifications

### 10.1 QuestCategory Tests (~4 tests)

```csharp
namespace RuneAndRust.Domain.Tests.Enums;

[TestFixture]
public class QuestCategoryTests
{
    [Test]
    public void QuestCategory_HasExpectedValues()
    {
        var values = Enum.GetValues<QuestCategory>();

        values.Should().Contain(QuestCategory.Main);
        values.Should().Contain(QuestCategory.Side);
        values.Should().Contain(QuestCategory.Daily);
        values.Should().Contain(QuestCategory.Repeatable);
        values.Should().Contain(QuestCategory.Event);
        values.Should().HaveCount(5);
    }

    [Test]
    public void QuestCategory_Main_IsFirst()
    {
        ((int)QuestCategory.Main).Should().Be(0);
    }

    [Test]
    public void QuestCategory_CanBeConvertedToString()
    {
        QuestCategory.Daily.ToString().Should().Be("Daily");
    }

    [Test]
    public void QuestCategory_CanBeParsedFromString()
    {
        Enum.Parse<QuestCategory>("Repeatable").Should().Be(QuestCategory.Repeatable);
    }
}
```

### 10.2 QuestJournalFilter Tests (~7 tests)

```csharp
namespace RuneAndRust.Domain.Tests.ValueObjects;

[TestFixture]
public class QuestJournalFilterTests
{
    [Test]
    public void Default_ReturnsFilterWithNoConstraints()
    {
        var filter = QuestJournalFilter.Default;

        filter.Category.Should().BeNull();
        filter.Status.Should().BeNull();
        filter.TimedOnly.Should().BeFalse();
        filter.ChainsOnly.Should().BeFalse();
        filter.SearchText.Should().BeNull();
    }

    [Test]
    public void ForCategory_CreatesCategoryFilter()
    {
        var filter = QuestJournalFilter.ForCategory(QuestCategory.Daily);

        filter.Category.Should().Be(QuestCategory.Daily);
    }

    [Test]
    public void ActiveOnly_CreatesActiveStatusFilter()
    {
        var filter = QuestJournalFilter.ActiveOnly;

        filter.Status.Should().Be(QuestStatus.Active);
    }

    [Test]
    public void Apply_FiltersByCategory()
    {
        var quests = CreateTestQuests();
        var filter = QuestJournalFilter.ForCategory(QuestCategory.Main);

        var result = filter.Apply(quests).ToList();

        result.Should().AllSatisfy(q => q.Category.Should().Be(QuestCategory.Main));
    }

    [Test]
    public void Apply_FiltersByMultipleCriteria()
    {
        var quests = CreateTestQuests();
        var filter = new QuestJournalFilter
        {
            Category = QuestCategory.Side,
            Status = QuestStatus.Active
        };

        var result = filter.Apply(quests).ToList();

        result.Should().AllSatisfy(q =>
        {
            q.Category.Should().Be(QuestCategory.Side);
            q.Status.Should().Be(QuestStatus.Active);
        });
    }

    [Test]
    public void Apply_FiltersBySearchText()
    {
        var quests = CreateTestQuests();
        var filter = QuestJournalFilter.WithSearch("goblin");

        var result = filter.Apply(quests).ToList();

        result.Should().AllSatisfy(q =>
            q.Name.Should().ContainEquivalentOf("goblin"));
    }

    [Test]
    public void GetDisplayName_ReturnsFormattedFilterDescription()
    {
        var filter = new QuestJournalFilter
        {
            Category = QuestCategory.Daily,
            Status = QuestStatus.Active
        };

        filter.GetDisplayName().Should().Be("Daily, Active");
    }
}
```

### 10.3 Quest Category Tests (~5 tests)

```csharp
namespace RuneAndRust.Domain.Tests.Entities;

[TestFixture]
public class QuestCategoryEntityTests
{
    [Test]
    public void Quest_DefaultCategory_IsSide()
    {
        var quest = CreateTestQuest();

        quest.Category.Should().Be(QuestCategory.Side);
    }

    [Test]
    public void SetCategory_UpdatesCategory()
    {
        var quest = CreateTestQuest();

        quest.SetCategory(QuestCategory.Main);

        quest.Category.Should().Be(QuestCategory.Main);
    }

    [Test]
    public void IsDaily_TrueWhenCategoryIsDaily()
    {
        var quest = CreateTestQuest();
        quest.SetCategory(QuestCategory.Daily);

        quest.IsDaily.Should().BeTrue();
    }

    [Test]
    public void CanBeAbandoned_FalseForMainQuests()
    {
        var quest = CreateTestQuest();
        quest.SetCategory(QuestCategory.Main);

        quest.CanBeAbandoned().Should().BeFalse();
    }

    [Test]
    public void CanBeAbandoned_TrueForSideQuests()
    {
        var quest = CreateTestQuest();
        quest.SetCategory(QuestCategory.Side);

        quest.CanBeAbandoned().Should().BeTrue();
    }
}
```

### 10.4 Quest Abandonment Tests (~5 tests)

```csharp
namespace RuneAndRust.Domain.Tests.Entities;

[TestFixture]
public class QuestAbandonmentTests
{
    [Test]
    public void Abandon_SetsStatusToAvailable()
    {
        var quest = CreateActiveQuest();
        quest.SetCategory(QuestCategory.Side);

        quest.Abandon();

        quest.Status.Should().Be(QuestStatus.Available);
    }

    [Test]
    public void Abandon_ResetsObjectiveProgress()
    {
        var quest = CreateActiveQuestWithProgress();
        quest.SetCategory(QuestCategory.Side);

        quest.Abandon();

        quest.Objectives.Should().AllSatisfy(o =>
            o.CurrentProgress.Should().Be(0));
    }

    [Test]
    public void Abandon_ThrowsForMainQuests()
    {
        var quest = CreateActiveQuest();
        quest.SetCategory(QuestCategory.Main);

        var act = () => quest.Abandon();

        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*main*");
    }

    [Test]
    public void Abandon_ThrowsForNonActiveQuests()
    {
        var quest = CreateCompletedQuest();
        quest.SetCategory(QuestCategory.Side);

        var act = () => quest.Abandon();

        act.Should().Throw<InvalidOperationException>()
            .WithMessage("*active*");
    }

    [Test]
    public void Abandon_ResetsTimedQuestTimer()
    {
        var quest = CreateActiveTimedQuest(timeLimit: 20, turnsRemaining: 5);
        quest.SetCategory(QuestCategory.Side);

        quest.Abandon();

        quest.TurnsRemaining.Should().Be(20);
    }
}
```

### 10.5 Player Abandonment Tests (~4 tests)

```csharp
namespace RuneAndRust.Domain.Tests.Entities;

[TestFixture]
public class PlayerAbandonmentTests
{
    [Test]
    public void AbandonQuest_RemovesFromActiveQuests()
    {
        var player = CreateTestPlayer();
        var quest = CreateActiveQuest();
        quest.SetCategory(QuestCategory.Side);
        player.AddQuest(quest);

        player.AbandonQuest(quest);

        player.ActiveQuests.Should().NotContain(quest);
    }

    [Test]
    public void AbandonQuest_AddsToAbandonedList()
    {
        var player = CreateTestPlayer();
        var quest = CreateActiveQuest("test-quest");
        quest.SetCategory(QuestCategory.Side);
        player.AddQuest(quest);

        player.AbandonQuest(quest);

        player.AbandonedQuestIds.Should().Contain("test-quest");
    }

    [Test]
    public void HasAbandonedQuest_ReturnsTrueForAbandonedQuest()
    {
        var player = CreateTestPlayer();
        var quest = CreateActiveQuest("test-quest");
        quest.SetCategory(QuestCategory.Side);
        player.AddQuest(quest);
        player.AbandonQuest(quest);

        player.HasAbandonedQuest("test-quest").Should().BeTrue();
    }

    [Test]
    public void GetQuestsByCategory_ReturnsCorrectQuests()
    {
        var player = CreateTestPlayer();
        var mainQuest = CreateActiveQuest("main-1");
        mainQuest.SetCategory(QuestCategory.Main);
        var sideQuest = CreateActiveQuest("side-1");
        sideQuest.SetCategory(QuestCategory.Side);
        player.AddQuest(mainQuest);
        player.AddQuest(sideQuest);

        var mainQuests = player.GetQuestsByCategory(QuestCategory.Main).ToList();

        mainQuests.Should().ContainSingle();
        mainQuests[0].DefinitionId.Should().Be("main-1");
    }
}
```

### 10.6 Test Summary Table

| File | Tests | Coverage |
|------|-------|----------|
| `QuestCategoryTests.cs` | ~4 | Enum values and parsing |
| `QuestJournalFilterTests.cs` | ~7 | Filter creation and Apply method |
| `QuestCategoryEntityTests.cs` | ~5 | Quest category property and behavior |
| `QuestAbandonmentTests.cs` | ~5 | Quest.Abandon method |
| `PlayerAbandonmentTests.cs` | ~4 | Player abandonment methods |
| **Total** | **~25** | |

---

## 11. Use Cases

### UC-3.2c-1: Quest Abandonment

**Actors:** Player, System
**Preconditions:** Player has active non-main quest
**Trigger:** Player enters "abandon" command

**Main Flow:**
1. Player enters "abandon 'Quest Name'"
2. System finds quest in active quests
3. System checks quest.CanBeAbandoned()
4. System displays confirmation prompt
5. Player confirms abandonment
6. System calls quest.Abandon()
7. System calls player.AbandonQuest(quest)
8. System displays success message

**Alternative Flow - Main Quest:**
3a. Quest is Main category
3b. System displays error: "Main quests cannot be abandoned."
3c. Use case ends

**Postconditions:**
- Quest removed from ActiveQuests
- Quest status set to Available
- Quest objective progress reset
- Quest ID added to AbandonedQuestIds

### UC-3.2c-2: Filtered Quest Journal

**Actors:** Player, System
**Preconditions:** Player has quests
**Trigger:** Player enters filter command

**Main Flow:**
1. Player enters "quests main"
2. System parses filter argument
3. System creates QuestJournalFilter
4. System retrieves all player quests
5. System applies filter to collection
6. System renders filtered results
7. System displays filter status line

**Postconditions:**
- Filtered quests displayed
- Filter indicator shown
- Quest count shows filtered/total

### UC-3.2c-3: Daily Quest Reset

**Actors:** System, Player
**Preconditions:** Player has completed daily quests
**Trigger:** Server midnight

**Main Flow:**
1. System triggers daily reset
2. System gets completed daily quests
3. For each daily quest:
   a. System calls quest.ResetForRepeat()
   b. System clears cooldown
4. Quests become available again
5. Player sees available daily quests on login

**Postconditions:**
- Daily quests reset to Available
- Objective progress cleared
- Quests can be accepted again

---

## 12. Acceptance Criteria

### AC-3.2c-1: Quest Categories
- [ ] QuestCategory enum has 5 values (Main, Side, Daily, Repeatable, Event)
- [ ] Quest.Category defaults to Side
- [ ] Quest.SetCategory() updates category
- [ ] Main quests display prominently
- [ ] Category visible in quest journal

### AC-3.2c-2: Quest Abandonment
- [ ] Can abandon Side, Daily, Repeatable, Event quests
- [ ] Cannot abandon Main quests
- [ ] Confirmation prompt displays before abandonment
- [ ] Progress resets on abandonment
- [ ] Abandoned quest ID tracked in player

### AC-3.2c-3: Daily Quests
- [ ] Daily quests marked with Daily category
- [ ] Completed dailies show reset countdown
- [ ] Daily quests reset at midnight
- [ ] Reset clears objective progress
- [ ] Daily status visible in journal

### AC-3.2c-4: Repeatable Quests
- [ ] Repeatable flag can be set
- [ ] RepeatCooldown respected
- [ ] ResetForRepeat() clears progress
- [ ] Cooldown timer displays correctly
- [ ] Quests available after cooldown

### AC-3.2c-5: Quest Filtering
- [ ] Filter by category works
- [ ] Filter by status works
- [ ] TimedOnly filter works
- [ ] ChainsOnly filter works
- [ ] SearchText filter works
- [ ] Multiple filters combine correctly
- [ ] Filter count displays accurately

### AC-3.2c-6: Unit Tests
- [ ] ~25 unit tests pass covering categories, abandonment, and filtering

---

## 13. Deliverable Checklist

### Domain Layer
- [ ] `QuestCategory.cs` - Enum for quest categories
- [ ] `QuestJournalFilter.cs` - Value object for journal filtering
- [ ] Quest entity updates (Category, IsRepeatable, Abandon, etc.)
- [ ] Player entity updates (AbandonedQuestIds, AbandonQuest, etc.)

### Application Layer
- [ ] IQuestService updates (AbandonQuest, GetFilteredQuests, etc.)
- [ ] QuestService implementation updates
- [ ] `AbandonmentResult.cs` - Result DTO
- [ ] `AbandonConfirmDto.cs` - Confirmation display DTO
- [ ] `DailyQuestStatusDto.cs` - Daily status DTO
- [ ] `QuestJournalFilterDto.cs` - Filter display DTO
- [ ] QuestSummaryDto updates (Category, IsRepeatable fields)

### Infrastructure Layer
- [ ] quests.json updates with category and repeatable fields
- [ ] quests.schema.json updates for category validation
- [ ] Configuration loader updates for new fields

### Presentation Layer
- [ ] IGameRenderer updates for filtered journal
- [ ] Abandonment confirmation rendering
- [ ] Daily quest status rendering
- [ ] Filter status line display

### Tests
- [ ] `QuestCategoryTests.cs` (~4 tests)
- [ ] `QuestJournalFilterTests.cs` (~7 tests)
- [ ] `QuestCategoryEntityTests.cs` (~5 tests)
- [ ] `QuestAbandonmentTests.cs` (~5 tests)
- [ ] `PlayerAbandonmentTests.cs` (~4 tests)

### Documentation
- [ ] XML documentation on all new types
- [ ] Updated configuration schema documentation

---

## 14. Dependencies

### From v0.3.2b (Failure Conditions)
| Component | Purpose for v0.3.2c |
|-----------|---------------------|
| Quest.IsTimed | TimedOnly filter support |
| Quest.TurnsRemaining | Timed quest display |
| Player.FailedQuests | Combined quest filtering |
| QuestStatus.Failed | Failed filter support |

### From v0.3.2a (Quest Chains)
| Component | Purpose for v0.3.2c |
|-----------|---------------------|
| Quest.IsInChain | ChainsOnly filter support |
| Quest.ChainId | Chain grouping in filtered views |
| QuestChain entity | Chain-based organization |

### From v0.3.1 (Quest Rewards & NPCs)
| Component | Purpose for v0.3.2c |
|-----------|---------------------|
| Quest entity | Base for category/abandonment extensions |
| Player.ActiveQuests | Source for abandonment |
| Player.CompletedQuests | Daily reset source |
| QuestStatus enum | Filter support |
| QuestService | Base for filtering/abandonment |

### From v0.3.0 (Core Quest System)
| Component | Purpose for v0.3.2c |
|-----------|---------------------|
| QuestObjective | Progress reset on abandonment |
| Quest.Status | Status-based filtering |

---

## 15. Future Considerations

### Deferred Features (Not in v0.3.2c Scope)
- **Weekly Quests** - Quests that reset weekly (future category)
- **Quest Favorites** - Pinning important quests (UI enhancement)
- **Sort Options** - Sorting by name, progress, time (UI enhancement)
- **Abandonment Penalties** - Reputation loss for abandonment (design decision)
- **Abandonment Limits** - Maximum abandonments per day (anti-abuse)

### v0.4.0 Integration Points
- Puzzle quests may use Event category for limited-time puzzles
- Puzzle chains integrate with existing chain/category system
- Repeatable puzzle challenges for practice

### Extension Points
- Custom category types for special events
- Category-specific rewards multipliers
- Category unlock progression (unlock Daily after tutorial)
- Category-based quest limits (max 3 active dailies)

### Dependency Tree

```
v0.3.2c Categories & Management
    │
    ├── REQUIRES from v0.3.2b
    │   ├── Quest.IsTimed (filter support)
    │   ├── Quest.TurnsRemaining (display)
    │   └── Player.FailedQuests (combined filtering)
    │
    ├── REQUIRES from v0.3.2a
    │   ├── Quest.IsInChain (filter support)
    │   └── QuestChain entity (organization)
    │
    ├── REQUIRES from v0.3.1
    │   ├── Quest entity
    │   ├── Player quest collections
    │   └── QuestService
    │
    └── PROVIDES to v0.4.0
        ├── QuestCategory enum
        ├── QuestJournalFilter pattern
        ├── Quest abandonment mechanics
        └── Repeatable quest infrastructure
```

---

*This design specification provides a comprehensive implementation guide for v0.3.2c Categories & Management. The category and management system enables better quest organization, player agency through abandonment, and ongoing engagement through daily and repeatable quests.*
