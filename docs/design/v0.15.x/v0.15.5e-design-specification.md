# v0.15.5e Design Specification: Hazard Detection System

**Version:** 0.15.5e
**Theme:** Hazard Detection System
**Author:** Claude
**Created:** 2026-01-18
**Status:** Draft
**Prerequisites:** v0.15.5a Complete (Extended Tracking System), v0.15.5b Complete (Counter-Tracking System), v0.15.5c Complete (Foraging System), v0.15.5d Complete (Navigation System)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
   - 3.1 [Hazard Detection Flow Diagram](#31-hazard-detection-flow-diagram)
   - 3.2 [Consequence Application Flow](#32-consequence-application-flow)
   - 3.3 [Service Interaction Diagram](#33-service-interaction-diagram)
   - 3.4 [Layer Architecture](#34-layer-architecture)
4. [HazardType Enum](#4-hazardtype-enum)
5. [HazardDetectionResult Value Object](#5-hazarddetectionresult-value-object)
6. [HazardDetectionService Implementation](#6-hazarddetectionservice-implementation)
7. [Detection Methods](#7-detection-methods)
8. [Consequence Table](#8-consequence-table)
9. [Data Model Changes](#9-data-model-changes)
10. [Configuration Files](#10-configuration-files)
    - 10.1 [hazard-types.json](#101-hazard-typesjson)
    - 10.2 [hazard-types.schema.json](#102-hazard-typesschemajson)
    - 10.3 [Configuration Schema Summary](#103-configuration-schema-summary)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)
16. [Dependencies](#16-dependencies)
17. [Future Considerations](#17-future-considerations)
18. [Document Metadata](#18-document-metadata)

---

## 1. Executive Summary

### 1.1 Purpose

This document provides a comprehensive design specification for v0.15.5e, the Hazard Detection System. This phase implements environmental hazard detection mechanics for the Wasteland Survival skill, enabling characters to identify and avoid dangerous environmental conditions before suffering their consequences.

Hazard detection in Aethelgard represents the survivor's ability to read the environment for signs of danger—unstable structures, toxic zones, glitch pockets, and ambush sites. The system supports both passive detection (automatic hints for high-WITS characters) and active investigation (formal identification checks). Characters who fail to detect hazards suffer the appropriate consequences.

The system classifies five hazard types with varying detection DCs and consequences, from minor damage to poison effects to reality-warping glitch encounters.

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Enums** | `HazardType` |
| **Value Objects** | `HazardDetectionResult` |
| **Services** | `IHazardDetectionService`, `HazardDetectionService` |
| **Configuration** | `hazard-types.json` |
| **Tests** | ~2 new unit tests |

### 1.3 Architectural Significance

This version establishes the **passive/active detection pattern** that will be reused for other awareness mechanics:

- **Passive detection**: Automatic hints based on character stats (WITS ÷ 2 vs hazard DC)
- **Active investigation**: Formal skill checks to identify hazards definitively
- **Consequence escalation**: Undetected hazards apply penalties when triggered
- **Area sweep mechanics**: Detecting multiple hazards in a single location

---

## 2. Feature Overview

```
v0.15.5e Hazard Detection System
├── Hazard Types
│   ├── ObviousDanger (DC 8, minor damage)
│   ├── HiddenPit (DC 12, 2d10 fall damage)
│   ├── ToxicZone (DC 16, poison 3 rounds)
│   ├── GlitchPocket (DC 20, random effect)
│   └── AmbushSite (DC 16, surprise attack)
├── Detection Methods
│   ├── Passive Perception (WITS ÷ 2 vs DC)
│   ├── Active Investigation (full skill check)
│   └── Area Sweep (multiple hazards)
├── Hazard Detection Result
│   ├── HazardDetected (was it found)
│   ├── HazardType (what kind)
│   ├── AvoidanceOptions (ways around)
│   └── ConsequenceIfMissed (what happens)
├── Consequence Table
│   ├── ObviousDanger → Minor damage
│   ├── HiddenPit → 2d10 fall damage
│   ├── ToxicZone → Poison (3 rounds)
│   ├── GlitchPocket → Random effect
│   └── AmbushSite → Surprise attack
└── Unit Tests (~2)
```

---

## 3. Architecture Diagrams

### 3.1 Hazard Detection Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      HAZARD DETECTION FLOW DIAGRAM                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    Player enters area OR performs investigate action                         │
│           │                                                                  │
│           ├─────────────────────────────────┐                               │
│           ▼                                 ▼                               │
│    ┌─────────────────────────┐       ┌─────────────────────────┐            │
│    │   PASSIVE DETECTION     │       │   ACTIVE INVESTIGATION  │            │
│    │   (Automatic on entry)  │       │   (Player-initiated)    │            │
│    └───────────┬─────────────┘       └───────────┬─────────────┘            │
│                │                                 │                          │
│                ▼                                 ▼                          │
│    ┌─────────────────────────┐       ┌─────────────────────────┐            │
│    │  PASSIVE CHECK          │       │  FULL SKILL CHECK       │            │
│    ├─────────────────────────┤       ├─────────────────────────┤            │
│    │  Passive = WITS ÷ 2     │       │  Roll Wasteland Survival│            │
│    │  Compare vs Hazard DC   │       │  vs Hazard DC           │            │
│    │  No dice roll           │       │  Standard success rules │            │
│    └───────────┬─────────────┘       └───────────┬─────────────┘            │
│                │                                 │                          │
│                ├─────────────────────────────────┤                          │
│                ▼                                 ▼                          │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    DETECTION OUTCOME                                 │  │
│    ├─────────────────────────────────────────────────────────────────────┤  │
│    │                                                                      │  │
│    │  Passive >= DC (hint only):                                         │  │
│    │  ├── "You sense something is wrong..."                              │  │
│    │  └── Hazard type NOT revealed, just awareness                       │  │
│    │                                                                      │  │
│    │  Active Success:                                                     │  │
│    │  ├── Hazard type identified                                         │  │
│    │  ├── Avoidance options provided                                     │  │
│    │  └── Consequence warned                                             │  │
│    │                                                                      │  │
│    │  Active Critical (Net ≥ 5):                                         │  │
│    │  ├── All above PLUS                                                 │  │
│    │  └── Additional context (how to disable/exploit)                    │  │
│    │                                                                      │  │
│    │  Failure/Undetected:                                                │  │
│    │  ├── No warning given                                               │  │
│    │  └── Consequence applies when triggered                             │  │
│    │                                                                      │  │
│    └─────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  HAZARD TYPE DCs:                                                           │
│  ─────────────────────────────────────────────────────────────────────      │
│  │ Hazard Type     │ DC  │ Description                               │     │
│  │─────────────────│─────│─────────────────────────────────────────│     │
│  │ ObviousDanger   │  8  │ Unstable debris, exposed wiring          │     │
│  │ HiddenPit       │ 12  │ Concealed drop, false floor              │     │
│  │ ToxicZone       │ 16  │ Chemical spill, radiation, bio-hazard    │     │
│  │ GlitchPocket    │ 20  │ Reality distortion, unstable space       │     │
│  │ AmbushSite      │ 16  │ Signs of hostile presence or trap        │     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Consequence Application Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      CONSEQUENCE APPLICATION FLOW                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│    Hazard NOT detected, player proceeds                                      │
│           │                                                                  │
│           ▼                                                                  │
│    ┌─────────────────────────────────────────────────────────────────────┐  │
│    │                    HAZARD TRIGGERED                                  │  │
│    └───────────┬─────────────────────────────────────────────────────────┘  │
│                │                                                             │
│    ┌───────────┼───────────┬───────────┬───────────┬───────────┐            │
│    ▼           ▼           ▼           ▼           ▼           ▼            │
│  ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐                       │
│  │OBVS │    │ PIT │    │TOXIC│    │GLTCH│    │AMBSH│                       │
│  │DNGR │    │     │    │     │    │     │    │     │                       │
│  └──┬──┘    └──┬──┘    └──┬──┘    └──┬──┘    └──┬──┘                       │
│     │          │          │          │          │                           │
│     ▼          ▼          ▼          ▼          ▼                           │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    CONSEQUENCE TABLE                                 │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  OBVIOUS DANGER:                                                     │   │
│  │  ├── 1d6 damage (minor cuts, burns, bruises)                        │   │
│  │  └── No lasting effect                                              │   │
│  │                                                                      │   │
│  │  HIDDEN PIT:                                                         │   │
│  │  ├── 2d10 fall damage                                               │   │
│  │  ├── DC 12 Acrobatics to halve damage                               │   │
│  │  └── May require assistance to escape                               │   │
│  │                                                                      │   │
│  │  TOXIC ZONE:                                                         │   │
│  │  ├── Apply [Poisoned] status for 3 rounds                           │   │
│  │  ├── 1d6 damage per round while poisoned                            │   │
│  │  └── DC 14 ENDURANCE save ends early                                │   │
│  │                                                                      │   │
│  │  GLITCH POCKET:                                                      │   │
│  │  ├── Roll on Glitch Effect Table (d6)                               │   │
│  │  │   1: Teleport 2d6 rooms in random direction                      │   │
│  │  │   2: 2d10 psychic damage                                         │   │
│  │  │   3: Equipment malfunction (random item disabled)                │   │
│  │  │   4: Time skip (lose 1d4 hours)                                  │   │
│  │  │   5: Memory echo (replay last combat)                            │   │
│  │  │   6: Reality anchor (cannot leave room for 1d6 rounds)           │   │
│  │  └── Apply [Disoriented] status                                     │   │
│  │                                                                      │   │
│  │  AMBUSH SITE:                                                        │   │
│  │  ├── Enemies gain surprise round                                    │   │
│  │  ├── Player cannot act first round                                  │   │
│  │  └── Enemies attack with advantage                                  │   │
│  │                                                                      │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Interaction Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SERVICE INTERACTION DIAGRAM                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                      ROOM ENTRY / INVESTIGATE COMMAND               │   │
│   │                        (Triggers detection)                          │   │
│   └─────────────────────────────────┬───────────────────────────────────┘   │
│                                     │                                        │
│                           initiates detection                               │
│                                     │                                        │
│                                     ▼                                        │
│   ┌─────────────────────────────────────────────────────────────────────┐   │
│   │                 HAZARD DETECTION SERVICE                             │   │
│   │                  (IHazardDetectionService)                           │   │
│   ├─────────────────────────────────────────────────────────────────────┤   │
│   │  + CheckPassiveDetection(player, hazards[])                          │   │
│   │  + InvestigateArea(player, area)                                     │   │
│   │  + InvestigateSpecific(player, hazard)                               │   │
│   │  + GetHazardConsequence(hazardType)                                  │   │
│   │  + ApplyHazardConsequence(player, hazardType)                        │   │
│   └──────────┬──────────────────────────┬───────────────────────────────┘   │
│              │                          │                                    │
│    performs check              applies consequence                          │
│              │                          │                                    │
│              ▼                          ▼                                    │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │   SKILL CHECK SERVICE   │  │  STATUS EFFECT SERVICE  │                  │
│   │   (ISkillCheckService)  │  │  (IStatusEffectService) │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ + PerformCheckWithDC()  │  │ + ApplyStatus()         │                  │
│   │ + GetPassiveValue()     │  │ + HasStatus()           │                  │
│   └──────────┬──────────────┘  └─────────────────────────┘                  │
│              │                                                               │
│       rolls dice                                                            │
│              │                                                               │
│              ▼                                                               │
│   ┌─────────────────────────┐  ┌─────────────────────────┐                  │
│   │     DICE SERVICE        │  │   DAMAGE SERVICE        │                  │
│   │     (IDiceService)      │  │   (IDamageService)      │                  │
│   ├─────────────────────────┤  ├─────────────────────────┤                  │
│   │ + RollPool(count)       │  │ + ApplyDamage()         │                  │
│   │ + CountSuccesses()      │  │ + RollDamage()          │                  │
│   └─────────────────────────┘  └─────────────────────────┘                  │
│                                                                              │
│   Data Flow:                                                                │
│   ─────────────────────────────────────────────────────────────────────    │
│   1. On room entry: CheckPassiveDetection() runs automatically              │
│   2. Passive check compares WITS ÷ 2 against each hazard's DC               │
│   3. If passive >= DC: hint provided (no type revealed)                     │
│   4. On 'investigate' command: InvestigateArea() performs full check        │
│   5. Active success: full HazardDetectionResult with type and options       │
│   6. If player proceeds without detection: ApplyHazardConsequence()         │
│   7. Consequence applies damage, status effects, or triggers encounter      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           LAYER ARCHITECTURE                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                      DOMAIN LAYER                                    │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Enums/                                                              │    │
│  │  ├── HazardType.cs                                                   │    │
│  │  │   └── ObviousDanger, HiddenPit, ToxicZone,                       │    │
│  │  │       GlitchPocket, AmbushSite                                   │    │
│  │  │                                                                   │    │
│  │  ValueObjects/                                                       │    │
│  │  └── HazardDetectionResult.cs                                       │    │
│  │      └── HazardDetected, HazardType, AvoidanceOptions,              │    │
│  │          ConsequenceIfMissed, DetectionMethod                        │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    APPLICATION LAYER                                 │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  Interfaces/                                                         │    │
│  │  └── IHazardDetectionService.cs                                     │    │
│  │      ├── CheckPassiveDetection(player, hazards[])                   │    │
│  │      ├── InvestigateArea(player, area)                              │    │
│  │      ├── InvestigateSpecific(player, hazard)                        │    │
│  │      ├── GetHazardConsequence(hazardType)                           │    │
│  │      └── ApplyHazardConsequence(player, hazardType)                 │    │
│  │                                                                      │    │
│  │  Services/                                                           │    │
│  │  └── HazardDetectionService.cs                                      │    │
│  │      └── Implements IHazardDetectionService                         │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                     │                                        │
│                                     ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                   INFRASTRUCTURE LAYER                               │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │                                                                      │    │
│  │  config/                                                             │    │
│  │  ├── hazard-types.json                                              │    │
│  │  │   └── Hazard definitions, DCs, consequences, descriptions        │    │
│  │  │                                                                   │    │
│  │  └── schemas/                                                        │    │
│  │      └── hazard-types.schema.json                                   │    │
│  │          └── JSON Schema validation                                 │    │
│  │                                                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. HazardType Enum

### 4.1 Purpose

The `HazardType` enum defines the five categories of environmental hazards that characters can detect and avoid. Each hazard type has a detection DC and a specific consequence when triggered.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/HazardType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the types of environmental hazards that can be detected in the Wasteland Survival system.
/// </summary>
/// <remarks>
/// Hazard types represent different categories of environmental danger with varying
/// detection difficulties and consequences. Characters can detect hazards passively
/// (high WITS gives automatic hints) or actively (formal skill checks).
///
/// Detection DCs follow a progression based on how concealed or subtle the hazard is:
/// - Obvious dangers are easy to spot but still harmful if ignored
/// - Hidden pits require more attention to notice
/// - Toxic zones and ambush sites are moderately difficult
/// - Glitch pockets are extremely subtle reality distortions
/// </remarks>
public enum HazardType
{
    /// <summary>
    /// Obvious environmental danger such as unstable debris, exposed wiring, or crumbling structures.
    /// Detection DC: 8 - Easy to spot but still causes minor damage if walked into.
    /// Consequence: 1d6 minor damage.
    /// </summary>
    ObviousDanger = 0,

    /// <summary>
    /// Concealed drop or false floor that causes fall damage.
    /// Detection DC: 12 - Requires attention to notice the subtle signs.
    /// Consequence: 2d10 fall damage, may require assistance to escape.
    /// </summary>
    HiddenPit = 1,

    /// <summary>
    /// Chemical spill, radiation zone, or biological hazard that poisons those who enter.
    /// Detection DC: 16 - Often invisible or odorless, requires survival knowledge.
    /// Consequence: [Poisoned] status for 3 rounds, 1d6 damage per round.
    /// </summary>
    ToxicZone = 2,

    /// <summary>
    /// Reality distortion zone where space and time behave unpredictably.
    /// Detection DC: 20 - Extremely subtle, only visible to trained observers.
    /// Consequence: Random glitch effect from the Glitch Effect Table.
    /// </summary>
    GlitchPocket = 3,

    /// <summary>
    /// Area showing signs of hostile presence or prepared ambush.
    /// Detection DC: 16 - Requires reading environmental cues for danger signs.
    /// Consequence: Enemies gain surprise round, player cannot act first round.
    /// </summary>
    AmbushSite = 4
}
```

### 4.3 Hazard Type Summary Table

| HazardType | Value | DC | Consequence |
|------------|-------|----|--------------|
| `ObviousDanger` | 0 | 8 | 1d6 minor damage |
| `HiddenPit` | 1 | 12 | 2d10 fall damage |
| `ToxicZone` | 2 | 16 | [Poisoned] 3 rounds, 1d6/round |
| `GlitchPocket` | 3 | 20 | Random glitch effect |
| `AmbushSite` | 4 | 16 | Surprise round for enemies |

---

## 5. HazardDetectionResult Value Object

### 5.1 Purpose

The `HazardDetectionResult` value object encapsulates the outcome of a hazard detection attempt, including whether the hazard was found, what type it is, how to avoid it, and what happens if it's triggered.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/HazardDetectionResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the outcome of a hazard detection attempt.
/// </summary>
/// <remarks>
/// HazardDetectionResult captures all information about a detected (or undetected) hazard:
/// - Whether detection succeeded
/// - The type of hazard (if detected)
/// - Options for avoiding the hazard
/// - Consequences if the hazard is triggered
///
/// For passive detection (hints only), HazardDetected is true but HazardType may not
/// be fully identified—only a general sense of danger is provided.
/// </remarks>
/// <param name="HazardDetected">Whether the hazard was successfully detected.</param>
/// <param name="HazardType">The type of hazard, if identified.</param>
/// <param name="AvoidanceOptions">Ways to avoid or circumvent the hazard.</param>
/// <param name="ConsequenceIfMissed">What happens if the hazard is triggered.</param>
/// <param name="DetectionMethod">How the hazard was detected (passive or active).</param>
/// <param name="NetSuccesses">Number of successes on active detection (0 for passive).</param>
public readonly record struct HazardDetectionResult(
    bool HazardDetected,
    HazardType? HazardType,
    IReadOnlyList<string> AvoidanceOptions,
    string ConsequenceIfMissed,
    DetectionMethod DetectionMethod,
    int NetSuccesses)
{
    /// <summary>
    /// Gets whether the hazard type was fully identified (not just sensed).
    /// </summary>
    /// <remarks>
    /// Passive detection provides awareness but not identification.
    /// Active detection with success provides full identification.
    /// </remarks>
    public bool FullyIdentified => HazardDetected && DetectionMethod == Domain.Enums.DetectionMethod.ActiveInvestigation;

    /// <summary>
    /// Gets whether this was a critical detection (additional context available).
    /// </summary>
    public bool IsCritical => NetSuccesses >= 5;

    /// <summary>
    /// Creates a result for a passively sensed hazard (hint only).
    /// </summary>
    public static HazardDetectionResult PassiveHint(HazardType hazardType) =>
        new(
            HazardDetected: true,
            HazardType: null, // Type not revealed for passive
            AvoidanceOptions: new[] { "Investigate the area to learn more" },
            ConsequenceIfMissed: "Unknown danger",
            DetectionMethod: Domain.Enums.DetectionMethod.PassivePerception,
            NetSuccesses: 0);

    /// <summary>
    /// Creates a result for an actively detected hazard.
    /// </summary>
    public static HazardDetectionResult ActiveSuccess(
        HazardType hazardType,
        IReadOnlyList<string> avoidanceOptions,
        string consequence,
        int netSuccesses) =>
        new(
            HazardDetected: true,
            HazardType: hazardType,
            AvoidanceOptions: avoidanceOptions,
            ConsequenceIfMissed: consequence,
            DetectionMethod: Domain.Enums.DetectionMethod.ActiveInvestigation,
            NetSuccesses: netSuccesses);

    /// <summary>
    /// Creates a result for a failed detection (hazard not found).
    /// </summary>
    public static HazardDetectionResult NotDetected() =>
        new(
            HazardDetected: false,
            HazardType: null,
            AvoidanceOptions: Array.Empty<string>(),
            ConsequenceIfMissed: string.Empty,
            DetectionMethod: Domain.Enums.DetectionMethod.None,
            NetSuccesses: 0);

    /// <summary>
    /// Creates a display string describing the detection result.
    /// </summary>
    public string ToDisplayString()
    {
        if (!HazardDetected)
        {
            return "You don't detect any hazards in the immediate area.";
        }

        if (DetectionMethod == Domain.Enums.DetectionMethod.PassivePerception)
        {
            return "Something feels wrong here. You sense danger, but can't identify its nature. Consider investigating further.";
        }

        var result = $"HAZARD DETECTED: {HazardType}\n";
        result += $"Consequence if triggered: {ConsequenceIfMissed}\n";
        result += "Avoidance options:\n";

        foreach (var option in AvoidanceOptions)
        {
            result += $"  - {option}\n";
        }

        if (IsCritical)
        {
            result += "\n[CRITICAL] You gain additional insight into this hazard.";
        }

        return result;
    }
}

/// <summary>
/// Defines how a hazard was detected.
/// </summary>
public enum DetectionMethod
{
    /// <summary>
    /// No detection attempted or detection failed.
    /// </summary>
    None = 0,

    /// <summary>
    /// Automatic detection based on WITS ÷ 2 vs hazard DC.
    /// Provides hint but not full identification.
    /// </summary>
    PassivePerception = 1,

    /// <summary>
    /// Full skill check via investigate command.
    /// Provides complete hazard identification on success.
    /// </summary>
    ActiveInvestigation = 2,

    /// <summary>
    /// Area sweep checking for multiple hazards.
    /// </summary>
    AreaSweep = 3
}
```

---

## 6. HazardDetectionService Implementation

### 6.1 Purpose

The `HazardDetectionService` coordinates hazard detection attempts, managing both passive perception and active investigation, and applying consequences when hazards are triggered.

### 6.2 Interface Definition

**File:** `src/Core/RuneAndRust.Application/Interfaces/IHazardDetectionService.cs`

```csharp
namespace RuneAndRust.Application.Interfaces;

using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Service interface for hazard detection operations in the Wasteland Survival system.
/// </summary>
public interface IHazardDetectionService
{
    /// <summary>
    /// Checks for passive detection of hazards when entering an area.
    /// </summary>
    /// <param name="player">The player entering the area.</param>
    /// <param name="hazards">The hazards present in the area.</param>
    /// <returns>List of hazards that triggered passive awareness (hints only).</returns>
    IReadOnlyList<HazardDetectionResult> CheckPassiveDetection(Player player, IReadOnlyList<HazardType> hazards);

    /// <summary>
    /// Actively investigates an area for all hazards.
    /// </summary>
    /// <param name="player">The player investigating.</param>
    /// <param name="hazards">The hazards present in the area.</param>
    /// <returns>Detection results for each hazard in the area.</returns>
    IReadOnlyList<HazardDetectionResult> InvestigateArea(Player player, IReadOnlyList<HazardType> hazards);

    /// <summary>
    /// Actively investigates a specific hazard.
    /// </summary>
    /// <param name="player">The player investigating.</param>
    /// <param name="hazardType">The type of hazard to investigate.</param>
    /// <returns>Detection result for the specific hazard.</returns>
    HazardDetectionResult InvestigateSpecific(Player player, HazardType hazardType);

    /// <summary>
    /// Gets the detection DC for a hazard type.
    /// </summary>
    /// <param name="hazardType">The hazard type.</param>
    /// <returns>The detection difficulty class.</returns>
    int GetDetectionDc(HazardType hazardType);

    /// <summary>
    /// Gets the consequence description for a hazard type.
    /// </summary>
    /// <param name="hazardType">The hazard type.</param>
    /// <returns>Description of what happens when triggered.</returns>
    string GetHazardConsequence(HazardType hazardType);

    /// <summary>
    /// Applies the consequence of triggering a hazard.
    /// </summary>
    /// <param name="player">The player triggering the hazard.</param>
    /// <param name="hazardType">The type of hazard triggered.</param>
    /// <returns>Result describing what happened.</returns>
    HazardTriggerResult ApplyHazardConsequence(Player player, HazardType hazardType);
}
```

### 6.3 HazardTriggerResult

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/HazardTriggerResult.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents the result of triggering a hazard.
/// </summary>
/// <param name="HazardType">The type of hazard that was triggered.</param>
/// <param name="DamageDealt">Amount of damage dealt, if any.</param>
/// <param name="StatusApplied">Status effect applied, if any.</param>
/// <param name="StatusDuration">Duration of status effect in rounds.</param>
/// <param name="SpecialEffect">Description of any special effect (glitch, ambush, etc.).</param>
/// <param name="RequiresAssistance">Whether player needs help to recover.</param>
public readonly record struct HazardTriggerResult(
    HazardType HazardType,
    int DamageDealt,
    string? StatusApplied,
    int StatusDuration,
    string? SpecialEffect,
    bool RequiresAssistance)
{
    /// <summary>
    /// Creates a display string describing what happened.
    /// </summary>
    public string ToDisplayString()
    {
        var parts = new List<string> { $"You triggered a {HazardType}!" };

        if (DamageDealt > 0)
        {
            parts.Add($"You take {DamageDealt} damage.");
        }

        if (!string.IsNullOrEmpty(StatusApplied))
        {
            parts.Add($"You are now [{StatusApplied}] for {StatusDuration} rounds.");
        }

        if (!string.IsNullOrEmpty(SpecialEffect))
        {
            parts.Add(SpecialEffect);
        }

        if (RequiresAssistance)
        {
            parts.Add("You may need assistance to recover from this.");
        }

        return string.Join(" ", parts);
    }
}
```

### 6.4 Service Implementation

**File:** `src/Core/RuneAndRust.Application/Services/HazardDetectionService.cs`

```csharp
namespace RuneAndRust.Application.Services;

using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Implements hazard detection operations for the Wasteland Survival system.
/// </summary>
/// <remarks>
/// The HazardDetectionService handles both passive and active detection:
///
/// Passive Detection (on room entry):
/// - Compares WITS ÷ 2 against each hazard's DC
/// - If passive >= DC: provides hint (no type revealed)
/// - No dice roll required
///
/// Active Detection (investigate command):
/// - Performs full Wasteland Survival skill check
/// - Success reveals hazard type and avoidance options
/// - Critical success (net >= 5) provides additional context
///
/// Consequence Application:
/// - Applies damage, status effects, or special effects
/// - Glitch pockets use random effect table
/// - Ambush sites trigger surprise rounds
/// </remarks>
public class HazardDetectionService : IHazardDetectionService
{
    private readonly ISkillCheckService _skillCheckService;
    private readonly IDiceService _diceService;
    private readonly IStatusEffectService _statusEffectService;
    private readonly IDamageService _damageService;
    private readonly ILogger<HazardDetectionService> _logger;

    public HazardDetectionService(
        ISkillCheckService skillCheckService,
        IDiceService diceService,
        IStatusEffectService statusEffectService,
        IDamageService damageService,
        ILogger<HazardDetectionService> logger)
    {
        _skillCheckService = skillCheckService;
        _diceService = diceService;
        _statusEffectService = statusEffectService;
        _damageService = damageService;
        _logger = logger;
    }

    /// <inheritdoc />
    public IReadOnlyList<HazardDetectionResult> CheckPassiveDetection(
        Player player,
        IReadOnlyList<HazardType> hazards)
    {
        var results = new List<HazardDetectionResult>();
        int passivePerception = player.Attributes.Wits / 2;

        _logger.LogDebug(
            "Checking passive detection for Player {PlayerId} with passive {Passive}",
            player.Id, passivePerception);

        foreach (var hazard in hazards)
        {
            int dc = GetDetectionDc(hazard);

            if (passivePerception >= dc)
            {
                _logger.LogInformation(
                    "Player {PlayerId} passively sensed {HazardType} (passive {Passive} >= DC {Dc})",
                    player.Id, hazard, passivePerception, dc);

                results.Add(HazardDetectionResult.PassiveHint(hazard));
            }
            else
            {
                _logger.LogDebug(
                    "Player {PlayerId} did not sense {HazardType} (passive {Passive} < DC {Dc})",
                    player.Id, hazard, passivePerception, dc);
            }
        }

        return results;
    }

    /// <inheritdoc />
    public IReadOnlyList<HazardDetectionResult> InvestigateArea(
        Player player,
        IReadOnlyList<HazardType> hazards)
    {
        _logger.LogInformation(
            "Player {PlayerId} investigating area with {Count} potential hazards",
            player.Id, hazards.Count);

        var results = new List<HazardDetectionResult>();

        foreach (var hazard in hazards)
        {
            results.Add(InvestigateSpecific(player, hazard));
        }

        return results;
    }

    /// <inheritdoc />
    public HazardDetectionResult InvestigateSpecific(Player player, HazardType hazardType)
    {
        int dc = GetDetectionDc(hazardType);

        _logger.LogDebug(
            "Player {PlayerId} investigating for {HazardType} (DC {Dc})",
            player.Id, hazardType, dc);

        var skillContext = new SkillContext(
            SkillType.WastelandSurvival,
            dc,
            0,
            $"Investigating for {hazardType}");

        var checkResult = _skillCheckService.PerformCheckWithDC(player, skillContext);

        if (checkResult.NetSuccesses >= dc)
        {
            _logger.LogInformation(
                "Player {PlayerId} detected {HazardType} ({Net} successes vs DC {Dc})",
                player.Id, hazardType, checkResult.NetSuccesses, dc);

            return HazardDetectionResult.ActiveSuccess(
                hazardType,
                GetAvoidanceOptions(hazardType),
                GetHazardConsequence(hazardType),
                checkResult.NetSuccesses);
        }

        _logger.LogDebug(
            "Player {PlayerId} failed to detect {HazardType} ({Net} successes vs DC {Dc})",
            player.Id, hazardType, checkResult.NetSuccesses, dc);

        return HazardDetectionResult.NotDetected();
    }

    /// <inheritdoc />
    public int GetDetectionDc(HazardType hazardType)
    {
        return hazardType switch
        {
            HazardType.ObviousDanger => 8,
            HazardType.HiddenPit => 12,
            HazardType.ToxicZone => 16,
            HazardType.GlitchPocket => 20,
            HazardType.AmbushSite => 16,
            _ => 12
        };
    }

    /// <inheritdoc />
    public string GetHazardConsequence(HazardType hazardType)
    {
        return hazardType switch
        {
            HazardType.ObviousDanger => "1d6 minor damage from debris, wiring, or unstable structure",
            HazardType.HiddenPit => "2d10 fall damage, may require assistance to escape",
            HazardType.ToxicZone => "[Poisoned] for 3 rounds, taking 1d6 damage per round",
            HazardType.GlitchPocket => "Random glitch effect (teleport, psychic damage, equipment malfunction, etc.)",
            HazardType.AmbushSite => "Enemies gain surprise round, you cannot act in the first round",
            _ => "Unknown hazard consequence"
        };
    }

    /// <inheritdoc />
    public HazardTriggerResult ApplyHazardConsequence(Player player, HazardType hazardType)
    {
        _logger.LogWarning(
            "Player {PlayerId} triggered {HazardType}",
            player.Id, hazardType);

        return hazardType switch
        {
            HazardType.ObviousDanger => ApplyObviousDanger(player),
            HazardType.HiddenPit => ApplyHiddenPit(player),
            HazardType.ToxicZone => ApplyToxicZone(player),
            HazardType.GlitchPocket => ApplyGlitchPocket(player),
            HazardType.AmbushSite => ApplyAmbushSite(player),
            _ => new HazardTriggerResult(hazardType, 0, null, 0, "Unknown hazard", false)
        };
    }

    private IReadOnlyList<string> GetAvoidanceOptions(HazardType hazardType)
    {
        return hazardType switch
        {
            HazardType.ObviousDanger => new[]
            {
                "Carefully navigate around the debris",
                "Clear a path through (may take time)",
                "Find an alternate route"
            },
            HazardType.HiddenPit => new[]
            {
                "Walk around the concealed area",
                "Jump over the pit (Acrobatics check)",
                "Use a plank or debris to bridge the gap"
            },
            HazardType.ToxicZone => new[]
            {
                "Find a path that avoids the contaminated area",
                "Use protective equipment (gas mask, hazmat)",
                "Wait for conditions to clear (if temporary)"
            },
            HazardType.GlitchPocket => new[]
            {
                "Give the distortion a wide berth",
                "Wait for the glitch cycle to stabilize",
                "Attempt to time passage through (extremely risky)"
            },
            HazardType.AmbushSite => new[]
            {
                "Approach from a different direction",
                "Create a distraction to draw enemies out",
                "Prepare for combat before entering",
                "Find a way to avoid the area entirely"
            },
            _ => new[] { "Proceed with caution" }
        };
    }

    private HazardTriggerResult ApplyObviousDanger(Player player)
    {
        int damage = _diceService.RollSum(1, 6);
        _damageService.ApplyDamage(player, damage, DamageType.Physical);

        return new HazardTriggerResult(
            HazardType.ObviousDanger,
            damage,
            null,
            0,
            null,
            false);
    }

    private HazardTriggerResult ApplyHiddenPit(Player player)
    {
        int damage = _diceService.RollSum(2, 10);
        _damageService.ApplyDamage(player, damage, DamageType.Physical);

        return new HazardTriggerResult(
            HazardType.HiddenPit,
            damage,
            null,
            0,
            "You fall into a concealed pit!",
            true);
    }

    private HazardTriggerResult ApplyToxicZone(Player player)
    {
        _statusEffectService.ApplyStatus(player, StatusEffectType.Poisoned, 3);

        return new HazardTriggerResult(
            HazardType.ToxicZone,
            0,
            "Poisoned",
            3,
            "You inhale toxic fumes! You will take 1d6 damage each round.",
            false);
    }

    private HazardTriggerResult ApplyGlitchPocket(Player player)
    {
        int effectRoll = _diceService.RollSingle(6);
        string effect = effectRoll switch
        {
            1 => "Reality tears—you are teleported 2d6 rooms in a random direction!",
            2 => "Psychic feedback—you take 2d10 psychic damage!",
            3 => "Equipment malfunction—a random item is disabled until repaired!",
            4 => "Time skip—you lose 1d4 hours, disoriented and confused!",
            5 => "Memory echo—you experience a vivid flashback of past combat!",
            6 => "Reality anchor—you cannot leave this room for 1d6 rounds!",
            _ => "Strange glitch effect—reality shimmers around you."
        };

        int damage = effectRoll == 2 ? _diceService.RollSum(2, 10) : 0;
        if (damage > 0)
        {
            _damageService.ApplyDamage(player, damage, DamageType.Psychic);
        }

        _statusEffectService.ApplyStatus(player, StatusEffectType.Disoriented, 2);

        return new HazardTriggerResult(
            HazardType.GlitchPocket,
            damage,
            "Disoriented",
            2,
            effect,
            false);
    }

    private HazardTriggerResult ApplyAmbushSite(Player player)
    {
        return new HazardTriggerResult(
            HazardType.AmbushSite,
            0,
            null,
            0,
            "Enemies spring from concealment! They gain a surprise round—you cannot act in the first round of combat!",
            false);
    }
}
```

---

## 7. Detection Methods

### 7.1 Passive Perception

Passive perception occurs automatically when entering a new area. It provides a hint that something is wrong but does not identify the specific hazard.

**Calculation:** `Passive = WITS ÷ 2`

**Comparison:** If `Passive >= Hazard DC`, the player receives a hint.

**Hint Example:** "Something feels wrong here. You sense danger, but can't identify its nature."

### 7.2 Active Investigation

Active investigation is triggered by the player using the `investigate` command. It performs a full Wasteland Survival skill check.

**Roll:** Standard success-counting (8-10 = success, 1 = botch)

**Success:** Reveals hazard type, avoidance options, and consequences.

**Critical (Net ≥ 5):** Provides additional context on how to disable or exploit the hazard.

### 7.3 Area Sweep

Area sweep investigates all hazards in the current location with a single command. Each hazard requires its own skill check.

**Command:** `investigate area` or `sweep`

**Result:** Returns detection results for each hazard present.

### 7.4 Detection Method Summary

| Method | Trigger | Roll | Information Revealed |
|--------|---------|------|---------------------|
| Passive | Room entry | None (WITS ÷ 2) | Hint only, no type |
| Active | `investigate` | Full skill check | Type, options, consequence |
| Critical | Active, net ≥ 5 | Full skill check | Above + additional context |
| Sweep | `investigate area` | Multiple checks | All hazards in area |

---

## 8. Consequence Table

### 8.1 Consequence Summary

| Hazard | DC | Damage | Status | Duration | Special |
|--------|----|---------|---------|---------|---------|
| ObviousDanger | 8 | 1d6 | — | — | Minor injury |
| HiddenPit | 12 | 2d10 | — | — | May need assistance |
| ToxicZone | 16 | 1d6/round | Poisoned | 3 rounds | DC 14 END ends early |
| GlitchPocket | 20 | Varies | Disoriented | 2 rounds | Random effect table |
| AmbushSite | 16 | — | — | — | Surprise round |

### 8.2 Glitch Effect Table

Roll d6 when entering a Glitch Pocket:

| Roll | Effect | Mechanical Impact |
|------|--------|-------------------|
| 1 | Teleport | Move 2d6 rooms in random direction |
| 2 | Psychic Feedback | Take 2d10 psychic damage |
| 3 | Equipment Malfunction | Random item disabled until repaired |
| 4 | Time Skip | Lose 1d4 hours |
| 5 | Memory Echo | Replay vivid combat memory (narrative) |
| 6 | Reality Anchor | Cannot leave room for 1d6 rounds |

### 8.3 Poison Mechanics

When poisoned by a Toxic Zone:
- **Duration:** 3 rounds
- **Damage:** 1d6 per round at start of turn
- **Save:** DC 14 ENDURANCE at end of each turn to end early
- **Cure:** Antidote consumable immediately removes poison

---

## 9. Data Model Changes

### 9.1 New Enums

| Enum | Layer | Description |
|------|-------|-------------|
| `HazardType` | Domain | Environmental hazard classifications |
| `DetectionMethod` | Domain | How hazard was detected |

### 9.2 New Value Objects

| Value Object | Layer | Description |
|--------------|-------|-------------|
| `HazardDetectionResult` | Domain | Outcome of detection attempt |
| `HazardTriggerResult` | Domain | Outcome of triggering a hazard |

### 9.3 New Interfaces

| Interface | Layer | Description |
|-----------|-------|-------------|
| `IHazardDetectionService` | Application | Hazard detection service contract |

### 9.4 New Services

| Service | Layer | Description |
|---------|-------|-------------|
| `HazardDetectionService` | Application | Hazard detection service implementation |

---

## 10. Configuration Files

### 10.1 hazard-types.json

**File:** `config/hazard-types.json`

```json
{
    "$schema": "./schemas/hazard-types.schema.json",
    "hazardTypes": [
        {
            "id": "obvious-danger",
            "type": "ObviousDanger",
            "detectionDc": 8,
            "displayName": "Obvious Danger",
            "description": "Unstable debris, exposed wiring, crumbling structures, or other visible hazards that still cause harm if walked into carelessly.",
            "consequence": {
                "damageType": "Physical",
                "damageDice": "1d6",
                "statusEffect": null,
                "statusDuration": 0,
                "specialEffect": null
            },
            "avoidanceOptions": [
                "Carefully navigate around the debris",
                "Clear a path through (may take time)",
                "Find an alternate route"
            ]
        },
        {
            "id": "hidden-pit",
            "type": "HiddenPit",
            "detectionDc": 12,
            "displayName": "Hidden Pit",
            "description": "Concealed drops, false floors, covered holes, or unstable ground that gives way underfoot.",
            "consequence": {
                "damageType": "Physical",
                "damageDice": "2d10",
                "statusEffect": null,
                "statusDuration": 0,
                "specialEffect": "May require assistance to escape",
                "requiresAssistance": true
            },
            "avoidanceOptions": [
                "Walk around the concealed area",
                "Jump over the pit (Acrobatics check)",
                "Use a plank or debris to bridge the gap"
            ]
        },
        {
            "id": "toxic-zone",
            "type": "ToxicZone",
            "detectionDc": 16,
            "displayName": "Toxic Zone",
            "description": "Chemical spills, radiation pockets, biological contamination, or other environmental poisons.",
            "consequence": {
                "damageType": null,
                "damageDice": null,
                "statusEffect": "Poisoned",
                "statusDuration": 3,
                "specialEffect": "Take 1d6 damage each round while poisoned",
                "saveDc": 14,
                "saveAttribute": "Endurance"
            },
            "avoidanceOptions": [
                "Find a path that avoids the contaminated area",
                "Use protective equipment (gas mask, hazmat)",
                "Wait for conditions to clear (if temporary)"
            ]
        },
        {
            "id": "glitch-pocket",
            "type": "GlitchPocket",
            "detectionDc": 20,
            "displayName": "Glitch Pocket",
            "description": "Reality distortion zones where space, time, and matter behave unpredictably due to lingering Jötun corruption.",
            "consequence": {
                "damageType": "Special",
                "damageDice": null,
                "statusEffect": "Disoriented",
                "statusDuration": 2,
                "specialEffect": "Roll on Glitch Effect Table",
                "glitchEffectTable": true
            },
            "avoidanceOptions": [
                "Give the distortion a wide berth",
                "Wait for the glitch cycle to stabilize",
                "Attempt to time passage through (extremely risky)"
            ]
        },
        {
            "id": "ambush-site",
            "type": "AmbushSite",
            "detectionDc": 16,
            "displayName": "Ambush Site",
            "description": "Signs of hostile presence—fresh tracks, disturbed debris, concealed positions, or other indicators of a prepared ambush.",
            "consequence": {
                "damageType": null,
                "damageDice": null,
                "statusEffect": null,
                "statusDuration": 0,
                "specialEffect": "Enemies gain surprise round",
                "surpriseRound": true
            },
            "avoidanceOptions": [
                "Approach from a different direction",
                "Create a distraction to draw enemies out",
                "Prepare for combat before entering",
                "Find a way to avoid the area entirely"
            ]
        }
    ],
    "glitchEffectTable": [
        {
            "roll": 1,
            "effect": "Teleport",
            "description": "Reality tears—you are teleported 2d6 rooms in a random direction!",
            "mechanic": "teleport_random",
            "distance": "2d6"
        },
        {
            "roll": 2,
            "effect": "Psychic Feedback",
            "description": "Psychic feedback—you take 2d10 psychic damage!",
            "mechanic": "damage",
            "damageDice": "2d10",
            "damageType": "Psychic"
        },
        {
            "roll": 3,
            "effect": "Equipment Malfunction",
            "description": "Equipment malfunction—a random item is disabled until repaired!",
            "mechanic": "disable_item"
        },
        {
            "roll": 4,
            "effect": "Time Skip",
            "description": "Time skip—you lose 1d4 hours, disoriented and confused!",
            "mechanic": "time_skip",
            "duration": "1d4"
        },
        {
            "roll": 5,
            "effect": "Memory Echo",
            "description": "Memory echo—you experience a vivid flashback of past combat!",
            "mechanic": "narrative"
        },
        {
            "roll": 6,
            "effect": "Reality Anchor",
            "description": "Reality anchor—you cannot leave this room for 1d6 rounds!",
            "mechanic": "movement_lock",
            "duration": "1d6"
        }
    ],
    "passiveDetectionFormula": "WITS / 2"
}
```

### 10.2 hazard-types.schema.json

**File:** `config/schemas/hazard-types.schema.json`

```json
{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://runeandrust.game/schemas/hazard-types.schema.json",
    "title": "Hazard Types Configuration",
    "description": "Configuration schema for hazard type definitions and consequences",
    "type": "object",
    "required": ["hazardTypes", "glitchEffectTable", "passiveDetectionFormula"],
    "properties": {
        "hazardTypes": {
            "type": "array",
            "description": "Array of hazard type definitions",
            "items": {
                "type": "object",
                "required": ["id", "type", "detectionDc", "displayName", "description", "consequence", "avoidanceOptions"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "Unique identifier for the hazard type"
                    },
                    "type": {
                        "type": "string",
                        "enum": ["ObviousDanger", "HiddenPit", "ToxicZone", "GlitchPocket", "AmbushSite"],
                        "description": "Hazard type enum value"
                    },
                    "detectionDc": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 30,
                        "description": "Difficulty class for detecting this hazard"
                    },
                    "displayName": {
                        "type": "string",
                        "description": "Human-readable name for UI display"
                    },
                    "description": {
                        "type": "string",
                        "description": "Flavor text describing the hazard"
                    },
                    "consequence": {
                        "type": "object",
                        "description": "What happens when the hazard is triggered",
                        "properties": {
                            "damageType": {
                                "type": ["string", "null"],
                                "enum": ["Physical", "Psychic", "Special", null],
                                "description": "Type of damage dealt"
                            },
                            "damageDice": {
                                "type": ["string", "null"],
                                "pattern": "^\\d+d\\d+$",
                                "description": "Dice expression for damage (e.g., '2d10')"
                            },
                            "statusEffect": {
                                "type": ["string", "null"],
                                "description": "Status effect applied"
                            },
                            "statusDuration": {
                                "type": "integer",
                                "minimum": 0,
                                "description": "Duration of status effect in rounds"
                            },
                            "specialEffect": {
                                "type": ["string", "null"],
                                "description": "Description of any special effect"
                            },
                            "requiresAssistance": {
                                "type": "boolean",
                                "default": false,
                                "description": "Whether player needs help to recover"
                            },
                            "surpriseRound": {
                                "type": "boolean",
                                "default": false,
                                "description": "Whether enemies gain surprise round"
                            },
                            "glitchEffectTable": {
                                "type": "boolean",
                                "default": false,
                                "description": "Whether to roll on glitch effect table"
                            },
                            "saveDc": {
                                "type": "integer",
                                "minimum": 1,
                                "description": "DC for save to end effect early"
                            },
                            "saveAttribute": {
                                "type": "string",
                                "description": "Attribute used for save"
                            }
                        }
                    },
                    "avoidanceOptions": {
                        "type": "array",
                        "items": { "type": "string" },
                        "description": "Ways to avoid or circumvent the hazard"
                    }
                }
            }
        },
        "glitchEffectTable": {
            "type": "array",
            "description": "Random effects for glitch pocket hazards",
            "items": {
                "type": "object",
                "required": ["roll", "effect", "description", "mechanic"],
                "properties": {
                    "roll": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 6,
                        "description": "D6 roll that triggers this effect"
                    },
                    "effect": {
                        "type": "string",
                        "description": "Name of the effect"
                    },
                    "description": {
                        "type": "string",
                        "description": "Narrative description shown to player"
                    },
                    "mechanic": {
                        "type": "string",
                        "description": "Mechanical effect type"
                    },
                    "damageDice": {
                        "type": "string",
                        "description": "Damage dice if applicable"
                    },
                    "damageType": {
                        "type": "string",
                        "description": "Damage type if applicable"
                    },
                    "distance": {
                        "type": "string",
                        "description": "Distance dice for teleport effects"
                    },
                    "duration": {
                        "type": "string",
                        "description": "Duration dice for timed effects"
                    }
                }
            }
        },
        "passiveDetectionFormula": {
            "type": "string",
            "description": "Formula for calculating passive detection value"
        }
    }
}
```

### 10.3 Configuration Schema Summary

| Config File | Schema File | Purpose |
|-------------|-------------|---------|
| `hazard-types.json` | `hazard-types.schema.json` | Hazard definitions, DCs, consequences, glitch table |

---

## 11. Logging Specifications

### 11.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `HazardDetectionService` | Information | Detection attempts, hazard triggered |
| `HazardDetectionService` | Debug | Passive checks, DC comparisons, dice results |
| `HazardDetectionService` | Warning | Hazard triggered, consequence applied |
| `HazardDetectionService` | Error | Invalid hazard type, service failures |

### 11.2 Log Message Examples

```
[Debug] Checking passive detection for Player {PlayerId} with passive {Passive}
[Information] Player {PlayerId} passively sensed {HazardType} (passive {Passive} >= DC {Dc})
[Debug] Player {PlayerId} did not sense {HazardType} (passive {Passive} < DC {Dc})
[Information] Player {PlayerId} investigating area with {Count} potential hazards
[Debug] Player {PlayerId} investigating for {HazardType} (DC {Dc})
[Information] Player {PlayerId} detected {HazardType} ({Net} successes vs DC {Dc})
[Debug] Player {PlayerId} failed to detect {HazardType} ({Net} successes vs DC {Dc})
[Warning] Player {PlayerId} triggered {HazardType}
```

---

## 12. Unit Testing Requirements

### 12.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Hazard type sets correct DC | 1 |
| Missed hazard applies consequence | 1 |
| **Total** | **~2** |

### 12.2 Test Specifications

**File:** `tests/RuneAndRust.Tests/Services/HazardDetectionServiceTests.cs`

```csharp
[TestFixture]
public class HazardDetectionServiceTests
{
    [Test]
    [TestCase(HazardType.ObviousDanger, 8)]
    [TestCase(HazardType.HiddenPit, 12)]
    [TestCase(HazardType.ToxicZone, 16)]
    [TestCase(HazardType.GlitchPocket, 20)]
    [TestCase(HazardType.AmbushSite, 16)]
    public void GetDetectionDc_GivenHazardType_ReturnsCorrectDc(
        HazardType hazardType,
        int expectedDc);

    [Test]
    public void ApplyHazardConsequence_GivenUndetectedHazard_AppliesCorrectEffect();
}
```

### 12.3 Test Case Details

**Test 1: Detection DC Calculation**
- Verifies each hazard type returns the correct detection DC
- Covers all 5 hazard types
- Uses parameterized test cases

**Test 2: Consequence Application**
- Triggers an undetected hazard
- Verifies damage, status effects, or special effects are applied
- Checks player state after triggering

---

## 13. Use Cases

### UC-001: Passive Detection on Room Entry
**Actor:** Player
**Flow:** Enter new area → System runs passive check (WITS ÷ 2) → If passive >= DC, receive hint → Decide whether to investigate or proceed

### UC-002: Active Hazard Investigation
**Actor:** Player
**Flow:** Use investigate command → Perform Wasteland Survival check → On success, receive full hazard details → Choose avoidance option

### UC-003: Trigger Undetected Hazard
**Actor:** Player
**Flow:** Proceed without detection → Hazard triggers → System applies consequence → Player suffers damage/status/effect

### UC-004: Area Sweep Investigation
**Actor:** Player
**Flow:** Use investigate area command → Perform check for each hazard → Receive results for all hazards → Plan route accordingly

---

## 14. Deliverable Checklist

### 14.1 Domain Layer

- [ ] `HazardType.cs` enum created in `Enums/`
- [ ] `DetectionMethod.cs` enum created in `Enums/`
- [ ] `HazardDetectionResult.cs` value object created in `ValueObjects/`
- [ ] `HazardTriggerResult.cs` value object created in `ValueObjects/`

### 14.2 Application Layer

- [ ] `IHazardDetectionService.cs` interface created in `Interfaces/`
- [ ] `HazardDetectionService.cs` created in `Services/`
- [ ] Service registered in dependency injection

### 14.3 Configuration

- [ ] `config/hazard-types.json` created
- [ ] `config/schemas/hazard-types.schema.json` created
- [ ] Configuration files validate against schemas

### 14.4 Testing

- [ ] `HazardDetectionServiceTests.cs` created (~2 tests)
- [ ] All tests passing

### 14.5 Documentation

- [ ] XML documentation complete on all public members
- [ ] Design specification finalized

---

## 15. Acceptance Criteria

### 15.1 Functional

- [ ] Hazard type correctly determines detection DC (8/12/16/16/20)
- [ ] Passive detection uses WITS ÷ 2 comparison
- [ ] Passive detection provides hint without revealing type
- [ ] Active investigation reveals hazard type and avoidance options
- [ ] Critical detection (net ≥ 5) provides additional context
- [ ] Missed hazard applies correct consequence when triggered
- [ ] ObviousDanger deals 1d6 damage
- [ ] HiddenPit deals 2d10 damage
- [ ] ToxicZone applies [Poisoned] for 3 rounds
- [ ] GlitchPocket rolls on glitch effect table
- [ ] AmbushSite grants enemies surprise round

### 15.2 Quality

- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~2 tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete

---

## 16. Dependencies

### 16.1 Required from Previous Versions

| Type | Version | Usage |
|------|---------|-------|
| `ISkillCheckService` | v0.15.0 | Perform hazard detection skill checks |
| `IDiceService` | v0.15.0 | Roll damage dice, glitch effect table |
| `IStatusEffectService` | v0.10.x | Apply Poisoned, Disoriented status |
| `IDamageService` | v0.11.x | Apply damage from hazards |
| `SkillContext` | v0.15.1 | Convert detection context for skill checks |

### 16.2 Provides to Future Versions

| Type | Usage |
|------|-------|
| `HazardType` | v0.15.5g Scout Action hazard detection |
| `IHazardDetectionService` | v0.15.5i Exploration Synergies combined checks |
| `HazardDetectionResult` | v0.15.6 Advanced Perception passive integration |

---

## 17. Future Considerations

### 17.1 Deferred to v0.15.5g (Scout Action)

- **Scout-based hazard detection**: Scout action reveals hazards in adjacent rooms
- **Combined reveal**: Scout shows both rooms and their hazards

### 17.2 Deferred to v0.15.6 (Advanced Perception)

- **Passive perception integration**: Unified passive check system across all detection types
- **Three-layer examination**: Expert examination reveals hidden hazards

### 17.3 Out of Scope

- **Hazard creation/placement**: How hazards are placed in rooms (room generation system)
- **Trap disarmament**: Actively disabling hazards (covered in v0.15.4 System Bypass)
- **Environmental hazard damage over time**: Sustained exposure effects (future environmental system)

---

## 18. Document Metadata

---

*Document Version: 1.0*
*Last Updated: 2026-01-18*
*Author: Claude*

---

### Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-18 | Claude | Initial design specification |

---

*This design specification provides the detailed blueprint for implementing v0.15.5e Hazard Detection System. This establishes passive/active detection patterns for environmental awareness in the Wasteland Survival skill expansion.*
