# v0.20.1b Changelog — Skjaldmær Tier 2 Abilities

**Version**: 0.20.1b  
**Date**: 2026-02-10  
**Category**: Domain / Application Layer — Specialization Abilities

---

## Summary

Implements the three Tier 2 abilities for the Skjaldmær specialization: **Hold the Line** (movement blocking), **Counter-Shield** (reactive damage), and **Rally** (ally save bonus). Adds a prerequisite validation service for PP–tier threshold enforcement.

---

## Added

### Domain Layer — Value Objects

| File                                  | Purpose                                                    |
| ------------------------------------- | ---------------------------------------------------------- |
| `ValueObjects/HoldTheLineState.cs`    | Immutable state for Hold the Line (2-turn movement block)  |
| `ValueObjects/RallyBuff.cs`           | One-use saving throw buff applied to allies (+2 save)      |
| `ValueObjects/CounterShieldResult.cs` | Result of Counter-Shield reaction (1d6 damage to attacker) |

### Application Layer — Interfaces

| File                                 | Purpose                                                       |
| ------------------------------------ | ------------------------------------------------------------- |
| `Interfaces/IPrerequisiteService.cs` | PP threshold validation with `PrerequisiteCheckResult` record |

### Application Layer — Services

| File                                        | Purpose                                               |
| ------------------------------------------- | ----------------------------------------------------- |
| `Services/PrerequisiteService.cs`           | PP cost lookups, tier threshold checks, audit logging |
| `Services/SkjaldmaerTier2AbilityService.cs` | Hold the Line, Counter-Shield, Rally operations       |

### Configuration

| File                          | Change                                                                           |
| ----------------------------- | -------------------------------------------------------------------------------- |
| `config/specializations.json` | Added Tier 2 ability entries (Hold the Line, Counter-Shield, Rally) to Skjaldmær |

### Unit Tests

| File                                                           | Tests    |
| -------------------------------------------------------------- | -------- |
| `ValueObjects/HoldTheLineStateTests.cs` (Domain)               | 9 tests  |
| `ValueObjects/RallyBuffTests.cs` (Domain)                      | 5 tests  |
| `ValueObjects/CounterShieldResultTests.cs` (Domain)            | 6 tests  |
| `Services/PrerequisiteServiceTests.cs` (Application)           | 7 tests  |
| `Services/SkjaldmaerTier2AbilityServiceTests.cs` (Application) | 10 tests |

---

## Changed

| File                                      | Change                                                       |
| ----------------------------------------- | ------------------------------------------------------------ |
| `Interfaces/ISkjaldmaerAbilityService.cs` | Extended with Tier 2 method signatures (v0.20.1a → v0.20.1b) |

---

## Technical Details

### Ability Specifications

| Ability        | Type     | AP Cost | Effect                                         | Duration  |
| -------------- | -------- | ------- | ---------------------------------------------- | --------- |
| Hold the Line  | Active   | 3 AP    | Block enemy movement through Skjaldmær's space | 2 turns   |
| Counter-Shield | Reaction | 0 AP    | Deal 1d6 damage to melee attacker on block     | Instant   |
| Rally          | Active   | 2 AP    | Grant +2 save to allies within 6 spaces        | Next save |

### Prerequisite System

| Tier     | PP Threshold | PP Cost per Ability |
| -------- | ------------ | ------------------- |
| Tier 1   | 0 PP         | 0 PP (free)         |
| Tier 2   | 8 PP         | 4 PP each           |
| Tier 3   | 16 PP        | 5 PP each           |
| Capstone | 24 PP        | 6 PP                |

---

## Verification

| Metric         | Result          |
| -------------- | --------------- |
| Build Errors   | 0               |
| Build Warnings | 0               |
| New Tests      | 37              |
| All Tests Pass | ✓ (4,308 total) |

---

## Dependencies

- **Depends on**: v0.20.1a (Tier 1 abilities, BlockChargeResource, ShieldWallState, SkjaldmaerAbilityId enum)
- **Required by**: v0.20.1c (Tier 3 abilities), future combat system integration
