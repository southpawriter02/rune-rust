# Changelog: v0.1.0 - The Survivor's Beginning

**Release Date:** December 18, 2025
**Total Tests:** 557 (324 new tests added)

## Table of Contents

- [Summary](#summary)
- [New Files Created](#new-files-created)
- [Files Modified](#files-modified)
- [Code Implementation Details](#code-implementation-details)
- [Logging Matrix](#logging-matrix)
- [Complete Test Inventory](#complete-test-inventory)
- [Test Summary by Category](#test-summary-by-category)
- [DI Registration](#di-registration)
- [Build Verification](#build-verification)
- [Test Verification](#test-verification)
- [Directory Structure After v0.1.0](#directory-structure-after-v010)
- [Running Tests](#running-tests)
- [Database Migration](#database-migration)
- [Commands Reference (Updated)](#commands-reference-updated)
- [Character Creation Example Flow](#character-creation-example-flow)
- [Character Stat Examples](#character-stat-examples)
- [Next Steps (v0.1.1 or v0.2.0)](#next-steps-v011-or-v020)

---

## Summary

Version 0.1.0 introduces the **Character Creation System**, transforming Rune & Rust from a state machine into a role-playing game with persistent character identities. This release implements a complete character generation pipeline spanning the Core domain layer (character entities, lineage, archetype enums), Engine layer (factory pattern with attribute distribution, stat calculation formulas), Persistence layer (EF Core repository with specialized queries), and Terminal layer (Spectre.Console wizard with rich UI).

Key architectural patterns introduced: **Factory Pattern** for character instantiation with bonus application, **Repository Specialization** for character-specific queries, **Wizard Controller** for multi-step user interaction, and **Derived Stat Calculation** with formula-based stat generation.

---

## New Files Created

### Core Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/ArchetypeType.cs` | Defines four character archetypes with combat style bonuses |
| `RuneAndRust.Core/Enums/LineageType.cs` | Defines four character lineages with heritage-based attribute modifiers |
| `RuneAndRust.Core/Entities/Character.cs` | Complete character entity with 21 properties including attributes, derived stats, progression |
| `RuneAndRust.Core/Interfaces/ICharacterRepository.cs` | Specialized repository interface extending IRepository with name-based queries |

### Engine Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Engine/Factories/CharacterFactory.cs` | Factory for creating characters with attribute allocation and bonus application |

### Persistence Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Persistence/Repositories/CharacterRepository.cs` | EF Core implementation of character-specific repository operations |

### Terminal Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Terminal/Services/CharacterCreationController.cs` | Spectre.Console wizard controller with 4-step creation flow |

### Test Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Tests/Core/ArchetypeTypeTests.cs` | Enum validation tests for ArchetypeType (7 tests) |
| `RuneAndRust.Tests/Core/LineageTypeTests.cs` | Enum validation tests for LineageType (7 tests) |
| `RuneAndRust.Tests/Core/CharacterEntityTests.cs` | Character entity property and method tests (23 tests) |
| `RuneAndRust.Tests/Engine/CharacterFactoryTests.cs` | Factory creation and bonus application tests (32 tests) |
| `RuneAndRust.Tests/Engine/DerivedStatsTests.cs` | Stat calculation formula validation tests (28 tests) |
| `RuneAndRust.Tests/Integration/CharacterPersistenceTests.cs` | Character repository integration tests (21 tests) |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Core/Interfaces/IStatCalculationService.cs` | Added derived stat calculation methods: CalculateMaxHP, CalculateMaxStamina, CalculateActionPoints, RecalculateDerivedStats, GetArchetypeBonuses, GetLineageBonuses |
| `RuneAndRust.Engine/Services/StatCalculationService.cs` | Implemented derived stat formulas and bonus lookup tables for all lineages and archetypes |
| `RuneAndRust.Engine/Services/CommandParser.cs` | Added RequiresCharacterCreation flag to ParseResult; added "new" and "create" commands in MainMenu phase |
| `RuneAndRust.Persistence/Data/RuneAndRustDbContext.cs` | Added Characters DbSet with entity configuration (unique name index, max lengths, required fields) |
| `RuneAndRust.Terminal/Program.cs` | Version bump to v0.1.0; registered CharacterFactory, CharacterCreationController, ICharacterRepository in DI container |
| `RuneAndRust.Tests/Engine/GameServiceTests.cs` | Updated tests to accommodate character creation flow (5 tests) |

---

## Code Implementation Details

### Core Layer: Character Enums

#### ArchetypeType Enum

Four combat specializations with stat bonuses:

```csharp
public enum ArchetypeType
{
    Warrior = 0,      // +2 Sturdiness, +1 Might
    Skirmisher = 1,   // +2 Finesse, +1 Wits
    Adept = 2,        // +2 Wits, +1 Will
    Mystic = 3        // +2 Will, +1 Sturdiness
}
```

**Archetype Bonuses:**
- **Warrior**: Frontline combatant (+2 STU, +1 MIG)
- **Skirmisher**: Speed and precision (+2 FIN, +1 WIT)
- **Adept**: Runic practitioner (+2 WIT, +1 WIL)
- **Mystic**: Primal force wielder (+2 WIL, +1 STU)

#### LineageType Enum

Four heritage types with attribute modifiers:

```csharp
public enum LineageType
{
    Human = 0,        // +1 to all attributes
    RuneMarked = 1,   // +2 Wits, +2 Will, -1 Sturdiness
    IronBlooded = 2,  // +2 Sturdiness, +2 Might, -1 Wits
    VargrKin = 3      // +2 Finesse, +2 Wits, -1 Will
}
```

**Lineage Bonuses:**
- **Human**: Balanced adaptability (+1 to all 5 attributes)
- **Rune-Marked**: Mental prowess at physical cost (+2 WIT, +2 WIL, -1 STU)
- **Iron-Blooded**: Physical power at mental cost (+2 STU, +2 MIG, -1 WIT)
- **Vargr-Kin**: Agility at willpower cost (+2 FIN, +2 WIT, -1 WIL)

### Core Layer: Character Entity

**Properties:**
- **Identity**: Id (Guid), Name (string)
- **Core Attributes** (range 1-10, default 5):
  - Sturdiness: Physical resilience
  - Might: Raw physical power
  - Wits: Mental acuity
  - Will: Mental fortitude
  - Finesse: Agility and precision
- **Derived Stats**:
  - MaxHP / CurrentHP
  - MaxStamina / CurrentStamina
  - ActionPoints
- **Progression**: Level (default 1), ExperiencePoints (default 0)
- **Metadata**: Lineage, Archetype, CreatedAt, LastModified

**Key Methods:**
- `int GetAttribute(Attribute attribute)` - Retrieves attribute value by enum
- `void SetAttribute(Attribute attribute, int value)` - Sets attribute value by enum
- Throws `ArgumentOutOfRangeException` for invalid attribute types

### Engine Layer: CharacterFactory

**Constants:**
- `BaseAttributeValue = 5` - Starting value for all attributes
- `AttributePointPool = 10` - Points available for custom distribution

**Method Signatures:**

```csharp
Character CreateSimple(string name, LineageType lineage, ArchetypeType archetype)
```
- Creates character with base attributes (5 each)
- Applies lineage bonuses
- Applies archetype bonuses
- Clamps all attributes to [1, 10]
- Calculates derived stats (MaxHP, MaxStamina, ActionPoints)
- Sets CurrentHP = MaxHP, CurrentStamina = MaxStamina

```csharp
Character CreateWithDistribution(
    string name,
    LineageType lineage,
    ArchetypeType archetype,
    Dictionary<Attribute, int> attributeDistribution)
```
- Validates total points exactly equals AttributePointPool (10)
- Throws `ArgumentException` if point total is incorrect
- Applies custom distribution before lineage/archetype bonuses
- Follows same bonus application and clamping logic as CreateSimple

**Behavior Details:**
- Bonus application is additive (lineage + archetype)
- Clamping prevents attributes from exceeding valid range after bonuses
- Logs at Trace level for individual bonus applications
- Logs at Information level for character creation start/completion

### Engine Layer: StatCalculationService (New Methods)

**Derived Stat Formulas:**

```csharp
int CalculateMaxHP(int sturdiness)
```
- Formula: `50 + (Sturdiness * 10)`
- Range: 60 (STU=1) to 150 (STU=10)

```csharp
int CalculateMaxStamina(int finesse, int sturdiness)
```
- Formula: `20 + (Finesse * 5) + (Sturdiness * 3)`
- Range: 28 (FIN=1, STU=1) to 100 (FIN=10, STU=10)

```csharp
int CalculateActionPoints(int wits)
```
- Formula: `2 + (Wits / 4)` (integer division)
- Range: 2 (WIT=1-3) to 4 (WIT=8-10)
- Breakpoints: WIT 1-3 → 2 AP, WIT 4-7 → 3 AP, WIT 8-10 → 4 AP

```csharp
void RecalculateDerivedStats(Character character)
```
- Updates MaxHP, CurrentHP (set to MaxHP)
- Updates MaxStamina, CurrentStamina (set to MaxStamina)
- Updates ActionPoints
- Logs Information level with all calculated values

**Bonus Lookup Tables:**

`GetArchetypeBonuses(ArchetypeType archetype)` returns:
- Warrior: {Sturdiness: +2, Might: +1}
- Skirmisher: {Finesse: +2, Wits: +1}
- Adept: {Wits: +2, Will: +1}
- Mystic: {Will: +2, Sturdiness: +1}

`GetLineageBonuses(LineageType lineage)` returns:
- Human: {All attributes: +1}
- RuneMarked: {Wits: +2, Will: +2, Sturdiness: -1}
- IronBlooded: {Sturdiness: +2, Might: +2, Wits: -1}
- VargrKin: {Finesse: +2, Wits: +2, Will: -1}

### Persistence Layer: CharacterRepository

Extends `GenericRepository<Character>` with specialized queries:

**Method Signatures:**

```csharp
Task<Character?> GetByNameAsync(string name)
```
- Returns first character matching exact name (case-sensitive)
- Returns null if no match found
- Logs Debug level on query and result

```csharp
Task<bool> NameExistsAsync(string name)
```
- Checks if any character with exact name exists
- Returns boolean result
- Logs Debug level with query and result

```csharp
Task<IEnumerable<Character>> GetAllOrderedByCreationAsync()
```
- Returns all characters ordered by CreatedAt descending (newest first)
- Logs Debug level with retrieved count

```csharp
Task<Character?> GetMostRecentAsync()
```
- Returns character with most recent LastModified timestamp
- Returns null if database is empty
- Logs Debug level with result or empty message

**Database Configuration:**
- Table: "Characters"
- Primary Key: Id (Guid)
- Unique Index: Name (max 100 characters)
- All attributes stored as required integers
- Enums stored as integer values
- Timestamps stored as required DateTimes

### Terminal Layer: CharacterCreationController

**Wizard Flow:**

**Step 1: Name Input**
- Prompts: `"Enter character name (or 'cancel' to abort)"`
- Validation:
  - Minimum length: 2 characters
  - Maximum length: 50 characters
  - Non-empty, non-whitespace
  - "cancel" keyword exits wizard
- Checks for duplicate name via repository
- Displays error and exits if name exists

**Step 2: Lineage Selection**
- Displays SelectionPrompt with 4 lineages
- Each choice shows: Name, Description, Bonus summary
- Color-coded: Yellow for name, Green for bonuses
- Logs selection

**Step 3: Archetype Selection**
- Displays SelectionPrompt with 4 archetypes
- Each choice shows: Name, Description, Bonus summary
- Color-coded: Yellow for name, Green for bonuses
- Logs selection

**Step 4: Character Preview & Confirmation**
- Displays rounded-border table with:
  - Identity (Name, Lineage, Archetype)
  - Core Attributes (color-coded by value: red ≤3, yellow 4-5, green 6-7, cyan ≥8)
  - Derived Stats (color-coded: red HP, yellow Stamina, blue ActionPoints)
- Confirms with: `"Create this character?"`
- Default: Yes

**Post-Creation:**
- Saves character to database via repository
- Displays success panel with double border
- Returns Character entity to caller

**UI Color Scheme:**
- Cyan: Section headers
- Yellow: Names and labels
- Green: Confirmation prompts, bonuses
- Grey: Flavor text, section dividers
- Red/Yellow/Green/Cyan: Stat value color-coding

---

## Logging Matrix

### CharacterFactory

| Event | Level | Template |
|-------|-------|----------|
| CreateSimple start | Information | `"Creating simple character: {Name}, Lineage: {Lineage}, Archetype: {Archetype}"` |
| CreateSimple complete | Information | `"Character {Name} created successfully with final stats - STU:{Sturdiness} MIG:{Might} WIT:{Wits} WIL:{Will} FIN:{Finesse}"` |
| CreateWithDistribution start | Information | `"Creating character with custom distribution: {Name}, Lineage: {Lineage}, Archetype: {Archetype}"` |
| Invalid point total | Warning | `"Invalid point distribution: {TotalPoints} points used, expected {Expected}"` |
| CreateWithDistribution complete | Information | `"Character {Name} created with custom distribution - STU:{Sturdiness} MIG:{Might} WIT:{Wits} WIL:{Will} FIN:{Finesse}"` |
| Bonus application | Trace | `"Applied {Bonus:+0;-0} to {Attribute}: {OldValue} -> {NewValue}"` |

### StatCalculationService (New Entries)

| Event | Level | Template |
|-------|-------|----------|
| MaxHP calculation | Trace | `"Calculating MaxHP for Sturdiness {Sturdiness}"` |
| MaxHP result | Debug | `"MaxHP calculated: 50 + ({Sturdiness} * 10) = {Result}"` |
| MaxStamina calculation | Trace | `"Calculating MaxStamina for Finesse {Finesse}, Sturdiness {Sturdiness}"` |
| MaxStamina result | Debug | `"MaxStamina calculated: 20 + ({Finesse} * 5) + ({Sturdiness} * 3) = {Result}"` |
| ActionPoints calculation | Trace | `"Calculating ActionPoints for Wits {Wits}"` |
| ActionPoints result | Debug | `"ActionPoints calculated: 2 + ({Wits} / 4) = {Result}"` |
| Recalculate start | Information | `"Recalculating derived stats for character {CharacterName}"` |
| Recalculate complete | Information | `"Derived stats calculated - MaxHP: {MaxHP}, MaxStamina: {MaxStamina}, ActionPoints: {ActionPoints}"` |
| Get archetype bonuses | Trace | `"Getting attribute bonuses for archetype {Archetype}"` |
| Archetype result | Debug | `"Archetype {Archetype} provides {BonusCount} bonuses"` |
| Get lineage bonuses | Trace | `"Getting attribute bonuses for lineage {Lineage}"` |
| Lineage result | Debug | `"Lineage {Lineage} provides {BonusCount} bonuses"` |

### CharacterRepository

| Event | Level | Template |
|-------|-------|----------|
| Get by name query | Debug | `"Fetching character by name: {Name}"` |
| Get by name - not found | Debug | `"No character found with name: {Name}"` |
| Get by name - found | Debug | `"Found character '{CharacterName}' ({CharacterId})"` |
| Name exists query | Debug | `"Checking if character name exists: {Name}"` |
| Name exists result | Debug | `"Character name '{Name}' exists: {Exists}"` |
| Get all ordered query | Debug | `"Fetching all characters ordered by creation date"` |
| Get all ordered result | Debug | `"Retrieved {Count} characters"` |
| Get most recent query | Debug | `"Fetching most recently modified character"` |
| Get most recent - empty | Debug | `"No characters found in database"` |
| Get most recent - found | Debug | `"Most recent character: '{CharacterName}' (last modified: {LastModified})"` |

### CharacterCreationController

| Event | Level | Template |
|-------|-------|----------|
| Wizard start | Information | `"Starting character creation wizard"` |
| Cancel during name | Information | `"Character creation cancelled during name entry"` |
| Duplicate name | Warning | `"Duplicate character name attempted: {Name}"` |
| Cancel during confirm | Information | `"Character creation cancelled during confirmation"` |
| Character saved | Information | `"Character created and saved: {CharacterName} ({CharacterId})"` |

### CommandParser (Updated)

| Event | Level | Template |
|-------|-------|----------|
| New/Create command | Information | `"Character creation requested from MainMenu."` |

---

## Complete Test Inventory

### Core/ArchetypeTypeTests.cs (7 tests)

| Test Name | Description |
|-----------|-------------|
| `ArchetypeType_ShouldHaveExactlyFourValues` | Validates enum has exactly 4 values |
| `ArchetypeType_ShouldContain_Warrior` | Warrior value exists |
| `ArchetypeType_ShouldContain_Skirmisher` | Skirmisher value exists |
| `ArchetypeType_ShouldContain_Adept` | Adept value exists |
| `ArchetypeType_ShouldContain_Mystic` | Mystic value exists |
| `ArchetypeType_EnumValues_ShouldBeSequential` | Values are sequential 0,1,2,3 |
| `ArchetypeType_ToString_ReturnsExpectedName` | ToString returns correct name (4 cases) |

### Core/LineageTypeTests.cs (7 tests)

| Test Name | Description |
|-----------|-------------|
| `LineageType_ShouldHaveExactlyFourValues` | Validates enum has exactly 4 values |
| `LineageType_ShouldContain_Human` | Human value exists |
| `LineageType_ShouldContain_RuneMarked` | RuneMarked value exists |
| `LineageType_ShouldContain_IronBlooded` | IronBlooded value exists |
| `LineageType_ShouldContain_VargrKin` | VargrKin value exists |
| `LineageType_EnumValues_ShouldBeSequential` | Values are sequential 0,1,2,3 |
| `LineageType_ToString_ReturnsExpectedName` | ToString returns correct name (4 cases) |

### Core/CharacterEntityTests.cs (23 tests)

| Test Name | Description |
|-----------|-------------|
| `Character_NewInstance_HasUniqueId` | Each character has unique non-empty GUID |
| `Character_NewInstance_HasDefaultName` | Default name is empty string |
| `Character_NewInstance_HasDefaultLineage` | Default lineage is Human |
| `Character_NewInstance_HasDefaultArchetype` | Default archetype is Warrior |
| `Character_NewInstance_HasDefaultAttributes` | All attributes default to 5 |
| `Character_NewInstance_HasDefaultDerivedStats` | MaxHP=100, MaxStamina=60, ActionPoints=3 |
| `Character_NewInstance_HasDefaultProgression` | Level=1, ExperiencePoints=0 |
| `Character_NewInstance_HasCreatedAtTimestamp` | CreatedAt set to current UTC time |
| `Character_Name_CanBeSet` | Name property is settable |
| `Character_Lineage_CanBeSet` | Lineage property is settable |
| `Character_Archetype_CanBeSet` | Archetype property is settable |
| `Character_Sturdiness_CanBeSetToValidValues` | Sturdiness accepts 1, 5, 10 (3 cases) |
| `GetAttribute_Sturdiness_ReturnsCorrectValue` | GetAttribute returns Sturdiness value |
| `GetAttribute_Might_ReturnsCorrectValue` | GetAttribute returns Might value |
| `GetAttribute_Wits_ReturnsCorrectValue` | GetAttribute returns Wits value |
| `GetAttribute_Will_ReturnsCorrectValue` | GetAttribute returns Will value |
| `GetAttribute_Finesse_ReturnsCorrectValue` | GetAttribute returns Finesse value |
| `GetAttribute_InvalidAttribute_ThrowsArgumentOutOfRangeException` | Invalid enum throws exception |
| `SetAttribute_Sturdiness_SetsCorrectValue` | SetAttribute sets Sturdiness |
| `SetAttribute_Might_SetsCorrectValue` | SetAttribute sets Might |
| `SetAttribute_Wits_SetsCorrectValue` | SetAttribute sets Wits |
| `SetAttribute_Will_SetsCorrectValue` | SetAttribute sets Will |
| `SetAttribute_Finesse_SetsCorrectValue` | SetAttribute sets Finesse |
| `SetAttribute_InvalidAttribute_ThrowsArgumentOutOfRangeException` | Invalid enum throws exception |
| `Character_CurrentHP_CannotExceedMaxHP` | Documents that model allows CurrentHP > MaxHP |
| `Character_CurrentStamina_CannotExceedMaxStamina` | Documents that model allows CurrentStamina > MaxStamina |
| `Character_LastModified_CanBeUpdated` | LastModified timestamp can be updated |

### Engine/CharacterFactoryTests.cs (32 tests, including 16 combination tests)

| Test Name | Description |
|-----------|-------------|
| `CreateSimple_WithValidInputs_CreatesCharacter` | Creates character with name, lineage, archetype |
| `CreateSimple_WithHumanLineage_AppliesPlusOneToBonuses` | Human lineage adds +1 to all attributes |
| `CreateSimple_WithRuneMarkedLineage_AppliesCorrectBonuses` | RuneMarked applies +2 WIT/WIL, -1 STU |
| `CreateSimple_WithIronBloodedLineage_AppliesCorrectBonuses` | IronBlooded applies +2 STU/MIG, -1 WIT |
| `CreateSimple_WithVargrKinLineage_AppliesCorrectBonuses` | VargrKin applies +2 FIN/WIT, -1 WIL |
| `CreateSimple_WithMysticArchetype_AppliesCorrectBonuses` | Mystic applies +2 WIL, +1 STU |
| `CreateSimple_ClampsAttributesToValidRange` | Attributes clamped to max 10 |
| `CreateSimple_ClampsNegativesToMinimum` | Attributes clamped to min 1 |
| `CreateSimple_CalculatesDerivedStats` | Derived stats calculated correctly |
| `CreateSimple_SetsUniqueId` | Each character has unique ID |
| `CreateWithDistribution_WithValidPoints_CreatesCharacter` | Custom distribution with exactly 10 points succeeds |
| `CreateWithDistribution_AppliesDistributionBeforeBonuses` | Distribution applied before lineage/archetype |
| `CreateWithDistribution_WithWrongPointTotal_ThrowsArgumentException` | 11 points throws ArgumentException |
| `CreateWithDistribution_WithTooFewPoints_ThrowsArgumentException` | 9 points throws ArgumentException |
| `BaseAttributeValue_ShouldBeFive` | Constant BaseAttributeValue equals 5 |
| `AttributePointPool_ShouldBeTen` | Constant AttributePointPool equals 10 |
| `CreateSimple_AllCombinations_CreateValidCharacter(Human, Warrior)` | Human Warrior combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(Human, Skirmisher)` | Human Skirmisher combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(Human, Adept)` | Human Adept combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(Human, Mystic)` | Human Mystic combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(RuneMarked, Warrior)` | RuneMarked Warrior combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(RuneMarked, Skirmisher)` | RuneMarked Skirmisher combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(RuneMarked, Adept)` | RuneMarked Adept combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(RuneMarked, Mystic)` | RuneMarked Mystic combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(IronBlooded, Warrior)` | IronBlooded Warrior combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(IronBlooded, Skirmisher)` | IronBlooded Skirmisher combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(IronBlooded, Adept)` | IronBlooded Adept combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(IronBlooded, Mystic)` | IronBlooded Mystic combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(VargrKin, Warrior)` | VargrKin Warrior combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(VargrKin, Skirmisher)` | VargrKin Skirmisher combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(VargrKin, Adept)` | VargrKin Adept combination valid |
| `CreateSimple_AllCombinations_CreateValidCharacter(VargrKin, Mystic)` | VargrKin Mystic combination valid |

### Engine/DerivedStatsTests.cs (28 tests)

| Test Name | Description |
|-----------|-------------|
| `CalculateMaxHP_WithMinimumSturdiness_Returns60` | STU=1 yields 60 HP |
| `CalculateMaxHP_WithDefaultSturdiness_Returns100` | STU=5 yields 100 HP |
| `CalculateMaxHP_WithMaximumSturdiness_Returns150` | STU=10 yields 150 HP |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(1, 60)` | STU=1 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(2, 70)` | STU=2 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(3, 80)` | STU=3 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(4, 90)` | STU=4 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(5, 100)` | STU=5 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(6, 110)` | STU=6 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(7, 120)` | STU=7 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(8, 130)` | STU=8 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(9, 140)` | STU=9 formula validation |
| `CalculateMaxHP_AllValidSturdiness_ReturnsCorrectHP(10, 150)` | STU=10 formula validation |
| `CalculateMaxStamina_WithMinimumStats_Returns28` | FIN=1, STU=1 yields 28 Stamina |
| `CalculateMaxStamina_WithDefaultStats_Returns60` | FIN=5, STU=5 yields 60 Stamina |
| `CalculateMaxStamina_WithMaximumStats_Returns100` | FIN=10, STU=10 yields 100 Stamina |
| `CalculateMaxStamina_VariousCombinations_ReturnsCorrectStamina(1, 1, 28)` | FIN=1, STU=1 formula validation |
| `CalculateMaxStamina_VariousCombinations_ReturnsCorrectStamina(5, 5, 60)` | FIN=5, STU=5 formula validation |
| `CalculateMaxStamina_VariousCombinations_ReturnsCorrectStamina(10, 1, 73)` | FIN=10, STU=1 formula validation |
| `CalculateMaxStamina_VariousCombinations_ReturnsCorrectStamina(1, 10, 55)` | FIN=1, STU=10 formula validation |
| `CalculateMaxStamina_VariousCombinations_ReturnsCorrectStamina(8, 6, 78)` | FIN=8, STU=6 formula validation |
| `CalculateActionPoints_WithMinimumWits_Returns2` | WIT=1 yields 2 AP |
| `CalculateActionPoints_WithDefaultWits_Returns3` | WIT=5 yields 3 AP |
| `CalculateActionPoints_WithMaximumWits_Returns4` | WIT=10 yields 4 AP |
| `CalculateActionPoints_AllValidWits_ReturnsCorrectAP(1-10, expected)` | 10 theory cases validating formula across full range |
| `RecalculateDerivedStats_UpdatesAllDerivedStats` | All derived stats recalculated |
| `RecalculateDerivedStats_SetsCurrentToMax` | Current HP/Stamina set to Max values |
| `GetArchetypeBonuses_Warrior_ReturnsSturdinessAndMight` | Warrior bonuses correct |
| `GetArchetypeBonuses_Skirmisher_ReturnsFinesseAndWits` | Skirmisher bonuses correct |
| `GetArchetypeBonuses_Adept_ReturnsWitsAndWill` | Adept bonuses correct |
| `GetArchetypeBonuses_Mystic_ReturnsWillAndSturdiness` | Mystic bonuses correct |
| `GetLineageBonuses_Human_ReturnsPlusOneToAll` | Human bonuses correct (5 attributes) |
| `GetLineageBonuses_RuneMarked_ReturnsCorrectBonuses` | RuneMarked bonuses correct |
| `GetLineageBonuses_IronBlooded_ReturnsCorrectBonuses` | IronBlooded bonuses correct |
| `GetLineageBonuses_VargrKin_ReturnsCorrectBonuses` | VargrKin bonuses correct |

### Integration/CharacterPersistenceTests.cs (21 tests)

| Test Name | Description |
|-----------|-------------|
| `AddAsync_ShouldPersistCharacter` | Character saved and retrieved correctly |
| `AddAsync_ShouldPersistLineage` | Lineage enum persisted |
| `AddAsync_ShouldPersistArchetype` | Archetype enum persisted |
| `AddAsync_ShouldPersistAttributes` | All 5 attributes persisted |
| `AddAsync_ShouldPersistDerivedStats` | MaxHP, MaxStamina, ActionPoints persisted |
| `AddAsync_ShouldPersistProgression` | Level and ExperiencePoints persisted |
| `GetByIdAsync_ExistingCharacter_ReturnsCharacter` | Find by ID succeeds |
| `GetByIdAsync_NonExistentId_ReturnsNull` | Non-existent ID returns null |
| `GetByNameAsync_ExistingName_ReturnsCharacter` | Find by name succeeds |
| `GetByNameAsync_NonExistentName_ReturnsNull` | Non-existent name returns null |
| `NameExistsAsync_ExistingName_ReturnsTrue` | Name existence check returns true |
| `NameExistsAsync_NonExistentName_ReturnsFalse` | Name existence check returns false |
| `GetAllOrderedByCreationAsync_MultipleCharacters_ReturnsOrderedByCreationDesc` | Characters ordered newest first |
| `GetAllOrderedByCreationAsync_EmptyDatabase_ReturnsEmpty` | Empty database returns empty list |
| `GetMostRecentAsync_WithCharacters_ReturnsMostRecentlyModified` | Most recent character by LastModified |
| `GetMostRecentAsync_NoCharacters_ReturnsNull` | Empty database returns null |
| `UpdateAsync_UpdatesCharacterProperties` | Character name and lineage updated |
| `UpdateAsync_UpdatesAttributes` | Character attributes updated |
| `DeleteAsync_RemovesCharacter` | Character deleted successfully |
| `DeleteAsync_NonExistentId_DoesNotThrow` | Deleting non-existent ID does not throw |
| `Character_DefaultValues_AreSetCorrectly` | All default values verified |

### Engine/CommandParserTests.cs (2 new tests)

| Test Name | Description |
|-----------|-------------|
| `ParseAndExecute_MainMenu_NewCommand_ShouldRequireCharacterCreation("new")` | "new" command sets RequiresCharacterCreation flag |
| `ParseAndExecute_MainMenu_NewCommand_ShouldRequireCharacterCreation("create")` | "create" command sets RequiresCharacterCreation flag |

---

## Test Summary by Category

| Category | Test Count |
|----------|------------|
| Core/ArchetypeTypeTests | 7 |
| Core/AttributeTests | 12 |
| Core/CharacterEntityTests | 23 |
| Core/CharacterTests | 10 |
| Core/GamePhaseTests | 9 |
| Core/GameStateTests | 29 |
| Core/LineageTypeTests | 7 |
| Core/PendingGameActionTests | 7 |
| Engine/CharacterFactoryTests | 32 |
| Engine/CommandParserTests | 41 |
| Engine/DerivedStatsTests | 28 |
| Engine/DiceServiceTests | 24 |
| Engine/GameLoopTests | 18 |
| Engine/GameServiceTests | 5 |
| Engine/SaveManagerTests | 19 |
| Engine/StatCalculationServiceTests | 35 |
| Integration/CharacterPersistenceTests | 21 |
| Integration/PersistenceTests | 17 |
| Integration/RoomPersistenceTests | 213 |
| **Total** | **557** |

---

## DI Registration

Added to `RuneAndRust.Terminal/Program.cs`:

```csharp
// Register Character Repository
services.AddScoped<ICharacterRepository, CharacterRepository>();

// Register Character Creation Services
services.AddScoped<CharacterFactory>();
services.AddScoped<CharacterCreationController>();
```

**Lifetime Choices:**
- `CharacterFactory`: Scoped - New instance per service scope for database operations
- `CharacterCreationController`: Scoped - New instance per wizard invocation
- `ICharacterRepository`: Scoped - Follows EF Core DbContext lifetime pattern

---

## Build Verification

```
Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:03.45
```

---

## Test Verification

```
Test run for RuneAndRust.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (arm64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:   557, Skipped:     0, Total:   557, Duration: 430 ms
```

**New Tests Added:** 324 tests
**Previous Total (v0.0.4):** 233 tests
**New Total (v0.1.0):** 557 tests

---

## Directory Structure After v0.1.0

```
RuneAndRust/
├── RuneAndRust.Core/
│   ├── Entities/
│   │   ├── Character.cs              # NEW
│   │   └── SaveGame.cs
│   ├── Enums/
│   │   ├── ArchetypeType.cs          # NEW
│   │   ├── Attribute.cs
│   │   ├── GamePhase.cs
│   │   ├── LineageType.cs            # NEW
│   │   └── PendingGameAction.cs
│   ├── Interfaces/
│   │   ├── ICharacterRepository.cs   # NEW
│   │   ├── IDiceService.cs
│   │   ├── IGameService.cs
│   │   ├── IInputHandler.cs
│   │   ├── IRepository.cs
│   │   ├── ISaveGameRepository.cs
│   │   └── IStatCalculationService.cs # MODIFIED
│   └── Models/
│       ├── Character.cs
│       └── GameState.cs
├── RuneAndRust.Engine/
│   ├── Factories/
│   │   └── CharacterFactory.cs       # NEW
│   └── Services/
│       ├── CommandParser.cs          # MODIFIED
│       ├── DiceService.cs
│       ├── GameService.cs
│       ├── SaveManager.cs
│       └── StatCalculationService.cs # MODIFIED
├── RuneAndRust.Persistence/
│   ├── Data/
│   │   └── RuneAndRustDbContext.cs   # MODIFIED
│   └── Repositories/
│       ├── CharacterRepository.cs    # NEW
│       ├── GenericRepository.cs
│       └── SaveGameRepository.cs
├── RuneAndRust.Terminal/
│   ├── Program.cs                    # MODIFIED
│   └── Services/
│       ├── CharacterCreationController.cs # NEW
│       └── TerminalInputHandler.cs
├── RuneAndRust.Tests/
│   ├── Core/
│   │   ├── ArchetypeTypeTests.cs     # NEW
│   │   ├── AttributeTests.cs
│   │   ├── CharacterEntityTests.cs   # NEW
│   │   ├── CharacterTests.cs
│   │   ├── GamePhaseTests.cs
│   │   ├── GameStateTests.cs
│   │   ├── LineageTypeTests.cs       # NEW
│   │   └── PendingGameActionTests.cs
│   ├── Engine/
│   │   ├── CharacterFactoryTests.cs  # NEW
│   │   ├── CommandParserTests.cs     # MODIFIED
│   │   ├── DerivedStatsTests.cs      # NEW
│   │   ├── DiceServiceTests.cs
│   │   ├── GameLoopTests.cs
│   │   ├── GameServiceTests.cs
│   │   ├── SaveManagerTests.cs
│   │   └── StatCalculationServiceTests.cs
│   └── Integration/
│       ├── CharacterPersistenceTests.cs # NEW
│       └── PersistenceTests.cs
└── docs/
    └── changelogs/
        ├── v0.0.2.md
        ├── v0.0.3.md
        ├── v0.0.4.md
        └── v0.1.0.md                 # NEW
```

---

## Running Tests

### Run All Tests
```bash
dotnet test
```

### Run Character Creation Tests Only
```bash
# Character entity tests
dotnet test --filter "FullyQualifiedName~CharacterEntityTests"

# Factory tests
dotnet test --filter "FullyQualifiedName~CharacterFactoryTests"

# Derived stats tests
dotnet test --filter "FullyQualifiedName~DerivedStatsTests"

# Character persistence tests
dotnet test --filter "FullyQualifiedName~CharacterPersistenceTests"

# All character-related tests
dotnet test --filter "FullyQualifiedName~Character"
```

### Run Specific Test Categories
```bash
# Enum validation tests
dotnet test --filter "FullyQualifiedName~ArchetypeTypeTests|FullyQualifiedName~LineageTypeTests"

# Integration tests only
dotnet test --filter "FullyQualifiedName~Integration"
```

---

## Database Migration

### Create Migration
```bash
dotnet ef migrations add AddCharacterEntity \
  --project RuneAndRust.Persistence \
  --startup-project RuneAndRust.Terminal
```

### Apply Migration
```bash
dotnet ef database update \
  --project RuneAndRust.Persistence \
  --startup-project RuneAndRust.Terminal
```

### View Character Schema
```sql
SELECT
  column_name,
  data_type,
  is_nullable,
  column_default
FROM information_schema.columns
WHERE table_name = 'Characters'
ORDER BY ordinal_position;
```

---

## Commands Reference (Updated)

### MainMenu Phase
```
new, create      - Create a new character
start, play      - Start the game
load             - Load a saved game
quit, exit, q    - Exit the application
help, ?          - Display available commands
```

---

## Character Creation Example Flow

```
═══════════════════════════════════════
          CHARACTER CREATION
═══════════════════════════════════════
Forge your survivor in the ashes of the old world.
Choose wisely, for these choices shape your fate.

Step 1: Name Your Survivor

Enter character name (or 'cancel' to abort): Aria Stormborn

Step 2: Choose Your Lineage

Select your lineage:
  > Human - Adaptable survivors who endure through sheer determination. (+1 to all attributes)
    Rune-Marked - Descendants bearing ancient runic inscriptions in their skin. (+2 Wits, +2 Will, -1 Sturdiness)
    Iron-Blooded - Those with machine-integrated bloodlines from the old world. (+2 Sturdiness, +2 Might, -1 Wits)
    Vargr-Kin - Wolf-kin bearing the curse of the northern wastes. (+2 Finesse, +2 Wits, -1 Will)

Selected: Human

Step 3: Choose Your Archetype

Select your archetype:
    Warrior - Frontline combatant specializing in durability and melee damage. (+2 Sturdiness, +1 Might)
  > Skirmisher - Cunning fighter favoring speed and precision over raw power. (+2 Finesse, +1 Wits)
    Adept - Runic practitioner channeling ancient power through inscribed formulas. (+2 Wits, +1 Will)
    Mystic - Wielder of primal forces, drawing power from the world's corruption. (+2 Will, +1 Sturdiness)

Selected: Skirmisher

Step 4: Review Your Character

╭────────────────────────────────────╮
│     Attribute      │     Value     │
├────────────────────┼───────────────┤
│ Name               │ Aria Stormborn│
│ Lineage            │ Human         │
│ Archetype          │ Skirmisher    │
│                    │               │
│ --- ATTRIBUTES --- │               │
│ Sturdiness         │ 6             │
│ Might              │ 6             │
│ Wits               │ 7             │
│ Will               │ 6             │
│ Finesse            │ 8             │
│                    │               │
│ --- DERIVED STATS -│               │
│ Max HP             │ 110           │
│ Max Stamina        │ 78            │
│ Action Points      │ 3             │
╰────────────────────────────────────╯

Create this character? (Y/n): Y

╔═══════════════════════════════════════╗
║ Your character, Aria Stormborn, has   ║
║ been forged in the ashes of the old   ║
║ world.                                 ║
║ May they survive the trials ahead.    ║
╚═══════════════════════════════════════╝
```

---

## Character Stat Examples

### Sample Build: Human Warrior (Tank)
- **Attributes**: STU 8, MIG 7, WIT 6, WIL 6, FIN 6
- **Derived Stats**: MaxHP 130, MaxStamina 78, ActionPoints 3
- **Role**: Frontline tank with high durability

### Sample Build: Rune-Marked Adept (Caster)
- **Attributes**: STU 4, MIG 5, WIT 9, WIL 9, FIN 5
- **Derived Stats**: MaxHP 90, MaxStamina 57, ActionPoints 4
- **Role**: High-intelligence caster with max action points

### Sample Build: Iron-Blooded Warrior (Bruiser)
- **Attributes**: STU 10, MIG 10, WIT 4, WIL 5, FIN 5
- **Derived Stats**: MaxHP 150, MaxStamina 70, ActionPoints 3
- **Role**: Maximum HP bruiser (attribute clamping applied)

### Sample Build: Vargr-Kin Skirmisher (Speed Build)
- **Attributes**: STU 5, MIG 5, WIT 9, WIL 4, FIN 10
- **Derived Stats**: MaxHP 100, MaxStamina 85, ActionPoints 4
- **Role**: High mobility with maximum stamina and action points

---

## Next Steps (v0.1.1 or v0.2.0)

Potential features for the next release:

### Character System Enhancements
- Attribute point distribution UI (custom allocation during creation)
- Character deletion/archiving functionality
- Character listing screen with summary table
- Switch active character command

### Gameplay Integration
- Bind created character to GameState.CurrentCharacter
- Character-based stat checks in combat/skill resolution
- Experience gain and leveling system
- Attribute increase on level-up

### Persistence Enhancements
- Link characters to save game slots
- Character-specific save games (prevent save slot conflicts)
- Character backup/export functionality

### UI Polish
- Character sheet display command in Exploration phase
- Color-coded stat display based on archetype
- Comparison view during archetype selection
