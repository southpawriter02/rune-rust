# v0.16.3c Changelog - Weighted Item Selection

**Release Date:** 2026-01-28

## Overview

Introduces weighted random selection system for loot drops, including the `WeightedItem` value object and `WeightedItemPool` entity with O(log n) binary search selection.

## Added

### Domain Layer

- **WeightedItem** (`src/Core/RuneAndRust.Domain/ValueObjects/WeightedItem.cs`)
    - `readonly record struct` wrapping `LootEntry` with selection weight
    - Properties: `Item`, `Weight`, `Rarity`, `ItemId`, `IsSelectable`
    - Weight constants: `CommonWeight=100`, `UncommonWeight=50`, `RareWeight=25`, `VeryRareWeight=10`, `UniqueWeight=5`
    - Factory methods: `Create`, `CreateCommon`, `CreateUncommon`, `CreateRare`, `CreateVeryRare`, `CreateUnique`
    - Probability methods: `GetSelectionProbability`, `FormatProbability`

- **WeightedItemPool** (`src/Core/RuneAndRust.Domain/Entities/WeightedItemPool.cs`)
    - Entity managing weighted item collection with O(log n) selection
    - Properties: `Items`, `TotalWeight`, `ItemCount`, `SelectableItemCount`, `HasSelectableItems`
    - Factory methods: `Create`, `CreateFrom`
    - Item management: `Add`, `AddRange`, `Remove`, `Contains`, `Clear`
    - Selection: `SelectRandom(Random)`, `SelectRandom(seed)` using binary search
    - Probability: `GetSelectionProbability`, `GetAllProbabilities`
    - Zero-weight items excluded from selection but retained in pool

### Testing

- **WeightedItemTests** (12 tests)
    - Creation validation, rarity factory methods
    - IsSelectable behavior for zero-weight items
    - Probability calculations and formatting

- **WeightedItemPoolTests** (13 tests)
    - Distribution testing with 1000 iterations
    - Edge cases: empty pool, all-zero weights
    - Total weight calculation, excluding zero-weight items
    - Item management: Add, Remove, Contains, Clear

## Dependencies

- Requires v0.16.3b (Smart Loot Algorithm) for `LootEntry` with `CategoryId`
- Used by v0.16.3d (Smart Loot Service Implementation)
