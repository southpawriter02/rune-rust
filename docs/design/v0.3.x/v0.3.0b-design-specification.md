# v0.3.0b Design Specification: Quest Journal & Commands

## Overview

**Version:** 0.3.0b
**Parent:** v0.3.0 (Quest Foundation)
**Prerequisites:** v0.3.0a Complete (Quest Entity & Objectives)
**Status:** Design Complete
**Estimated Unit Tests:** ~25

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [User Stories](#4-user-stories)
5. [Data Models](#5-data-models)
6. [Service Specifications](#6-service-specifications)
7. [Command Specifications](#7-command-specifications)
8. [Rendering Specifications](#8-rendering-specifications)
9. [User-Facing Changes](#9-user-facing-changes)
10. [Logging Requirements](#10-logging-requirements)
11. [Unit Test Specifications](#11-unit-test-specifications)
12. [Use Cases](#12-use-cases)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Executive Summary

This phase implements the player-facing quest journal interface and the QuestService for quest management. Players can view their active and completed quests, see detailed progress information, and navigate between quest list and detail views. The QuestService provides the application layer coordination between the domain entities and the presentation layer.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Services** | QuestService (IQuestService) |
| **Commands** | `quests`, `journal`, `quest <name/number>` |
| **TUI Views** | Quest journal list, Quest detail view |
| **DTOs** | QuestSummaryDto, QuestDetailDto, ObjectiveSummaryDto |
| **Value Objects** | QuestCountSummary |
| **Tests** | ~25 new unit tests |

### Architectural Significance

This version establishes the **quest interaction pattern** that players will use throughout the game:
- QuestService as the central coordinator for all quest operations
- Command-based quest viewing with `quests` and `quest` commands
- TUI rendering for quest journal display
- DTOs for clean separation between domain and presentation

---

## 2. Feature Overview

```
v0.3.0b Features
├── QuestService
│   ├── GetActiveQuests(playerId)
│   ├── GetCompletedQuests(playerId)
│   ├── GetQuest(playerId, questId)
│   ├── GetQuestByDefinition(playerId, definitionId)
│   ├── FindQuestByName(playerId, name)
│   ├── CreateQuest(definitionId, playerId, giverNpcId?)
│   ├── AcceptQuest(playerId, questId)
│   ├── CompleteQuest(playerId, questId)
│   ├── GetCompletableQuests(playerId)
│   ├── GetQuestCounts(playerId)
│   └── HasActiveQuest(playerId, definitionId)
├── Quest Commands
│   ├── QuestsCommand (list view)
│   ├── JournalCommand (alias)
│   └── QuestCommand <name/number> (detail view)
├── Quest Journal TUI
│   ├── Quest list display
│   ├── Active/Completed filtering
│   ├── Progress indicators
│   └── Ready-to-turn-in markers
└── Quest Detail TUI
    ├── Quest information display
    ├── Objective list with progress
    ├── Progress bars
    └── Hint display
```

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRESENTATION LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  COMMANDS                                                               │
│  ┌────────────────────┐  ┌────────────────────┐                        │
│  │   QuestsCommand    │  │   QuestCommand     │                        │
│  ├────────────────────┤  ├────────────────────┤                        │
│  │ Alias: journal     │  │ Args: name/number  │                        │
│  │ Shows quest list   │  │ Shows quest detail │                        │
│  └────────────────────┘  └────────────────────┘                        │
│                                                                         │
│  TUI VIEWS                                                              │
│  ┌────────────────────┐  ┌────────────────────┐                        │
│  │  QuestJournalView  │  │  QuestDetailView   │                        │
│  ├────────────────────┤  ├────────────────────┤                        │
│  │ List of quests     │  │ Single quest info  │                        │
│  │ Progress %         │  │ All objectives     │                        │
│  │ Status indicators  │  │ Progress bars      │                        │
│  │ Quick navigation   │  │ Hints              │                        │
│  └────────────────────┘  └────────────────────┘                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                       IQuestService                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + GetActiveQuests(playerId) : IEnumerable<Quest>                │   │
│  │ + GetCompletedQuests(playerId) : IEnumerable<Quest>             │   │
│  │ + GetQuest(playerId, questId) : Quest?                          │   │
│  │ + GetQuestByDefinition(playerId, defId) : Quest?                │   │
│  │ + FindQuestByName(playerId, name) : Quest?                      │   │
│  │ + CreateQuest(defId, playerId, npcId?) : Quest                  │   │
│  │ + AcceptQuest(playerId, questId) : bool                         │   │
│  │ + CompleteQuest(playerId, questId) : bool                       │   │
│  │ + GetCompletableQuests(playerId) : IEnumerable<Quest>           │   │
│  │ + GetQuestCounts(playerId) : QuestCountSummary                  │   │
│  │ + HasActiveQuest(playerId, defId) : bool                        │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  DTOs                                                                   │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐      │
│  │ QuestSummaryDto  │  │ QuestDetailDto   │  │ObjectiveSummaryDto│     │
│  ├──────────────────┤  ├──────────────────┤  ├──────────────────┤      │
│  │ Id               │  │ Id               │  │ Description      │      │
│  │ Name             │  │ Name             │  │ Type             │      │
│  │ Status           │  │ Description      │  │ CurrentCount     │      │
│  │ ProgressPercent  │  │ Status           │  │ RequiredCount    │      │
│  │ IsReadyToTurnIn  │  │ ProgressPercent  │  │ IsComplete       │      │
│  │ ObjectivePreview │  │ GiverName        │  │ IsOptional       │      │
│  │ ListIndex        │  │ TurnInNpcName    │  │ ProgressPercent  │      │
│  └──────────────────┘  │ Objectives       │  │ ProgressString   │      │
│                        │ Hint             │  └──────────────────┘      │
│                        │ AcceptedAt       │                            │
│                        │ CompletedAt      │                            │
│                        └──────────────────┘                            │
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │                     QuestCountSummary                             │  │
│  ├──────────────────────────────────────────────────────────────────┤  │
│  │ + Active: int                                                     │  │
│  │ + Completed: int                                                  │  │
│  │ + ReadyToTurnIn: int                                             │  │
│  │ + Total: int (computed)                                          │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  FROM v0.3.0a:                                                          │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │         Quest          │  │    QuestObjective      │                │
│  │         Player         │  │    QuestDefinition     │                │
│  │       QuestStatus      │  │    ObjectiveType       │                │
│  │     ObjectiveTarget    │  │  ObjectiveDefinition   │                │
│  └────────────────────────┘  └────────────────────────┘                │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Command Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       QUEST COMMAND FLOW                                │
└─────────────────────────────────────────────────────────────────────────┘

User Input: "quests" or "journal"
         │
         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      ConsoleInputHandler                                │
├─────────────────────────────────────────────────────────────────────────┤
│  ParseCommand("quests") → QuestsCommand                                 │
│  ParseCommand("journal") → QuestsCommand                                │
│  ParseCommand("quest goblin") → QuestCommand("goblin")                  │
│  ParseCommand("quest 1") → QuestCommand(1)                              │
└─────────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      GameSessionService                                 │
├─────────────────────────────────────────────────────────────────────────┤
│  HandleQuestsCommand() → IQuestService.GetActiveQuests()               │
│  HandleQuestCommand(arg) → IQuestService.FindQuestByName()             │
│                          → IQuestService.GetQuest()                    │
└─────────────────────────────────────────────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         IGameRenderer                                   │
├─────────────────────────────────────────────────────────────────────────┤
│  RenderQuestJournalAsync(QuestJournalDto)                              │
│  RenderQuestDetailAsync(QuestDetailDto)                                │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.3 QuestService Dependency Graph

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         QuestService                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Dependencies:                                                          │
│  ┌──────────────────────────┐                                          │
│  │ IConfigurationProvider   │ ◄── Quest definitions                    │
│  └──────────────────────────┘                                          │
│  ┌──────────────────────────┐                                          │
│  │    IPlayerRepository     │ ◄── Player lookup (optional)             │
│  └──────────────────────────┘                                          │
│  ┌──────────────────────────┐                                          │
│  │ ILogger<QuestService>    │ ◄── Logging                              │
│  └──────────────────────────┘                                          │
│                                                                         │
│  Operations:                                                            │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │ GetActiveQuests(playerId)                                         │  │
│  │   └── Player.ActiveQuests.Where(q => q.Status == Active)         │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │ CreateQuest(definitionId, playerId, giverNpcId?)                  │  │
│  │   └── IConfigurationProvider.GetQuestDefinition()                │  │
│  │   └── Quest.Create(definition, playerId, giverNpcId)             │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────────────┐  │
│  │ FindQuestByName(playerId, name)                                   │  │
│  │   └── Player.ActiveQuests + CompletedQuests                      │  │
│  │   └── Case-insensitive partial match                             │  │
│  └──────────────────────────────────────────────────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. User Stories

### US-3.0b-1: View Active Quests
**As a** player
**I want to** view my active quests in a journal
**So that** I can see what objectives I need to complete

**Acceptance Criteria:**
- `quests` command shows list of active quests
- Each quest shows name and progress percentage
- Quests ready to turn in are marked
- Numbered list for easy navigation

### US-3.0b-2: View Completed Quests
**As a** player
**I want to** view my completed quests
**So that** I can see my achievements

**Acceptance Criteria:**
- `quests completed` shows completed quest list
- Each quest shows name and completion date
- Can distinguish from active quests

### US-3.0b-3: View Quest Details
**As a** player
**I want to** see detailed information about a quest
**So that** I know exactly what I need to do

**Acceptance Criteria:**
- `quest <name>` shows quest details
- `quest <number>` shows quest by list position
- Shows all objectives with progress
- Shows hints if available
- Shows quest giver and turn-in NPC

### US-3.0b-4: Quest Service Management
**As a** game system
**I want to** have a centralized service for quest operations
**So that** all quest logic is consistent

**Acceptance Criteria:**
- QuestService provides all quest queries
- QuestService handles quest creation from definitions
- QuestService manages quest acceptance and completion
- Proper logging for all operations

---

## 5. Data Models

### 5.1 QuestCountSummary Value Object

```csharp
namespace RuneAndRust.Application.ValueObjects;

/// <summary>
/// Summary counts of player quests by status.
/// </summary>
/// <param name="Active">Number of active quests.</param>
/// <param name="Completed">Number of completed quests.</param>
/// <param name="ReadyToTurnIn">Number of quests ready to turn in.</param>
public readonly record struct QuestCountSummary(
    int Active,
    int Completed,
    int ReadyToTurnIn)
{
    /// <summary>
    /// Gets the total number of quests (active + completed).
    /// </summary>
    public int Total => Active + Completed;

    /// <summary>
    /// Gets whether there are any active quests.
    /// </summary>
    public bool HasActiveQuests => Active > 0;

    /// <summary>
    /// Gets whether there are quests ready to turn in.
    /// </summary>
    public bool HasCompletableQuests => ReadyToTurnIn > 0;

    /// <summary>
    /// Creates an empty summary.
    /// </summary>
    public static QuestCountSummary Empty => new(0, 0, 0);

    /// <summary>
    /// Creates a display string for the summary.
    /// </summary>
    public string ToDisplayString()
    {
        var parts = new List<string>();

        if (Active > 0)
            parts.Add($"{Active} active");
        if (ReadyToTurnIn > 0)
            parts.Add($"{ReadyToTurnIn} ready to turn in");
        if (Completed > 0)
            parts.Add($"{Completed} completed");

        return parts.Count > 0 ? string.Join(", ", parts) : "No quests";
    }
}
```

### 5.2 QuestSummaryDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// Summary information for displaying a quest in a list.
/// </summary>
/// <param name="Id">The quest instance ID.</param>
/// <param name="Name">The quest display name.</param>
/// <param name="Status">The current quest status.</param>
/// <param name="ProgressPercent">Overall progress as 0-100.</param>
/// <param name="IsReadyToTurnIn">Whether the quest can be turned in.</param>
/// <param name="ObjectivePreview">Brief preview of current objectives.</param>
/// <param name="ListIndex">Position in the displayed list (1-based).</param>
public record QuestSummaryDto(
    Guid Id,
    string Name,
    QuestStatus Status,
    int ProgressPercent,
    bool IsReadyToTurnIn,
    string ObjectivePreview,
    int ListIndex)
{
    /// <summary>
    /// Creates a QuestSummaryDto from a Quest entity.
    /// </summary>
    /// <param name="quest">The quest entity.</param>
    /// <param name="listIndex">The position in the list.</param>
    /// <returns>A new QuestSummaryDto.</returns>
    public static QuestSummaryDto FromQuest(Quest quest, int listIndex)
    {
        ArgumentNullException.ThrowIfNull(quest);

        var preview = CreateObjectivePreview(quest);

        return new QuestSummaryDto(
            quest.Id,
            quest.Name,
            quest.Status,
            quest.GetProgressPercent(),
            quest.CanTurnIn(),
            preview,
            listIndex);
    }

    private static string CreateObjectivePreview(Quest quest)
    {
        var incompleteObjectives = quest.GetIncompleteObjectives().Take(2).ToList();

        if (incompleteObjectives.Count == 0)
        {
            return "All objectives complete";
        }

        var previews = incompleteObjectives
            .Select(o => $"{o.Description} {o.GetProgressString()}")
            .ToList();

        var remaining = quest.Objectives.Count(o => !o.IsComplete && !o.IsHidden) - 2;
        if (remaining > 0)
        {
            previews.Add($"+{remaining} more");
        }

        return string.Join(", ", previews);
    }
}
```

### 5.3 QuestDetailDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// Detailed information for displaying a single quest.
/// </summary>
/// <param name="Id">The quest instance ID.</param>
/// <param name="DefinitionId">The quest definition ID.</param>
/// <param name="Name">The quest display name.</param>
/// <param name="Description">The quest narrative description.</param>
/// <param name="Status">The current quest status.</param>
/// <param name="ProgressPercent">Overall progress as 0-100.</param>
/// <param name="IsReadyToTurnIn">Whether the quest can be turned in.</param>
/// <param name="GiverNpcName">Display name of the quest giver NPC.</param>
/// <param name="TurnInNpcName">Display name of the turn-in NPC.</param>
/// <param name="Objectives">List of objective summaries.</param>
/// <param name="Hint">Optional hint text.</param>
/// <param name="AcceptedAt">When the quest was accepted.</param>
/// <param name="CompletedAt">When the quest was completed (if applicable).</param>
public record QuestDetailDto(
    Guid Id,
    string DefinitionId,
    string Name,
    string Description,
    QuestStatus Status,
    int ProgressPercent,
    bool IsReadyToTurnIn,
    string? GiverNpcName,
    string? TurnInNpcName,
    IReadOnlyList<ObjectiveSummaryDto> Objectives,
    string? Hint,
    DateTime? AcceptedAt,
    DateTime? CompletedAt)
{
    /// <summary>
    /// Creates a QuestDetailDto from a Quest entity.
    /// </summary>
    /// <param name="quest">The quest entity.</param>
    /// <param name="giverNpcName">Optional giver NPC display name.</param>
    /// <param name="turnInNpcName">Optional turn-in NPC display name.</param>
    /// <returns>A new QuestDetailDto.</returns>
    public static QuestDetailDto FromQuest(
        Quest quest,
        string? giverNpcName = null,
        string? turnInNpcName = null)
    {
        ArgumentNullException.ThrowIfNull(quest);

        var objectives = quest.Objectives
            .Where(o => !o.IsHidden)
            .OrderBy(o => o.Order)
            .Select(ObjectiveSummaryDto.FromObjective)
            .ToList();

        return new QuestDetailDto(
            quest.Id,
            quest.DefinitionId,
            quest.Name,
            quest.Description,
            quest.Status,
            quest.GetProgressPercent(),
            quest.CanTurnIn(),
            giverNpcName ?? quest.GiverNpcId,
            turnInNpcName ?? quest.TurnInNpcId,
            objectives,
            quest.Hint,
            quest.AcceptedAt,
            quest.CompletedAt);
    }

    /// <summary>
    /// Gets a status display string.
    /// </summary>
    public string StatusDisplay => Status switch
    {
        QuestStatus.Available => "Available",
        QuestStatus.Active when IsReadyToTurnIn => "Ready to Turn In",
        QuestStatus.Active => $"Active ({ProgressPercent}%)",
        QuestStatus.Completed => "Completed",
        QuestStatus.Failed => "Failed",
        _ => Status.ToString()
    };
}
```

### 5.4 ObjectiveSummaryDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// Summary information for displaying a quest objective.
/// </summary>
/// <param name="Id">The objective instance ID.</param>
/// <param name="Description">The objective description.</param>
/// <param name="Type">The objective type.</param>
/// <param name="CurrentCount">Current progress count.</param>
/// <param name="RequiredCount">Required count for completion.</param>
/// <param name="IsComplete">Whether the objective is complete.</param>
/// <param name="IsOptional">Whether the objective is optional.</param>
/// <param name="ProgressPercent">Progress as 0-100.</param>
/// <param name="ProgressString">Formatted progress string.</param>
/// <param name="TargetDisplayName">Display name of the target.</param>
/// <param name="LocationHint">Optional location hint.</param>
public record ObjectiveSummaryDto(
    Guid Id,
    string Description,
    ObjectiveType Type,
    int CurrentCount,
    int RequiredCount,
    bool IsComplete,
    bool IsOptional,
    int ProgressPercent,
    string ProgressString,
    string TargetDisplayName,
    string? LocationHint)
{
    /// <summary>
    /// Creates an ObjectiveSummaryDto from a QuestObjective entity.
    /// </summary>
    /// <param name="objective">The objective entity.</param>
    /// <returns>A new ObjectiveSummaryDto.</returns>
    public static ObjectiveSummaryDto FromObjective(QuestObjective objective)
    {
        ArgumentNullException.ThrowIfNull(objective);

        return new ObjectiveSummaryDto(
            objective.Id,
            objective.Description,
            objective.Type,
            objective.CurrentCount,
            objective.RequiredCount,
            objective.IsComplete,
            objective.IsOptional,
            objective.GetProgressPercent(),
            objective.GetProgressString(),
            objective.Target.DisplayName,
            objective.Target.LocationHint);
    }

    /// <summary>
    /// Gets a full display string with checkmark/bullet.
    /// </summary>
    public string ToDisplayString()
    {
        var marker = IsComplete ? "\u2713" : "\u2022"; // ✓ or •
        var optional = IsOptional ? " (Optional)" : "";
        return $"{marker} {Description} {ProgressString}{optional}";
    }
}
```

### 5.5 QuestJournalDto

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// Data transfer object for rendering the quest journal view.
/// </summary>
/// <param name="ActiveQuests">List of active quest summaries.</param>
/// <param name="CompletedQuests">List of completed quest summaries.</param>
/// <param name="Counts">Quest count summary.</param>
/// <param name="ShowCompleted">Whether to show completed quests.</param>
public record QuestJournalDto(
    IReadOnlyList<QuestSummaryDto> ActiveQuests,
    IReadOnlyList<QuestSummaryDto> CompletedQuests,
    QuestCountSummary Counts,
    bool ShowCompleted = false)
{
    /// <summary>
    /// Gets the quests to display based on filter.
    /// </summary>
    public IReadOnlyList<QuestSummaryDto> DisplayedQuests =>
        ShowCompleted ? CompletedQuests : ActiveQuests;

    /// <summary>
    /// Creates a QuestJournalDto from quest collections.
    /// </summary>
    public static QuestJournalDto Create(
        IEnumerable<Quest> activeQuests,
        IEnumerable<Quest> completedQuests,
        bool showCompleted = false)
    {
        var activeList = activeQuests
            .OrderByDescending(q => q.CanTurnIn())
            .ThenByDescending(q => q.GetProgressPercent())
            .Select((q, i) => QuestSummaryDto.FromQuest(q, i + 1))
            .ToList();

        var completedList = completedQuests
            .OrderByDescending(q => q.CompletedAt)
            .Select((q, i) => QuestSummaryDto.FromQuest(q, i + 1))
            .ToList();

        var counts = new QuestCountSummary(
            activeList.Count,
            completedList.Count,
            activeList.Count(q => q.IsReadyToTurnIn));

        return new QuestJournalDto(activeList, completedList, counts, showCompleted);
    }
}
```

---

## 6. Service Specifications

### 6.1 IQuestService Interface

```csharp
namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Service for managing quest lifecycle and queries.
/// </summary>
/// <remarks>
/// Provides centralized coordination for all quest operations,
/// including creation, acceptance, completion, and queries.
/// </remarks>
public interface IQuestService
{
    /// <summary>
    /// Gets all active quests for a player.
    /// </summary>
    /// <param name="player">The player whose quests to retrieve.</param>
    /// <returns>Enumerable of active quests.</returns>
    IEnumerable<Quest> GetActiveQuests(Player player);

    /// <summary>
    /// Gets all completed quests for a player.
    /// </summary>
    /// <param name="player">The player whose quests to retrieve.</param>
    /// <returns>Enumerable of completed quests.</returns>
    IEnumerable<Quest> GetCompletedQuests(Player player);

    /// <summary>
    /// Gets a specific quest by ID.
    /// </summary>
    /// <param name="player">The player who owns the quest.</param>
    /// <param name="questId">The quest ID.</param>
    /// <returns>The quest, or null if not found.</returns>
    Quest? GetQuest(Player player, Guid questId);

    /// <summary>
    /// Gets a quest by its definition ID.
    /// </summary>
    /// <param name="player">The player who owns the quest.</param>
    /// <param name="definitionId">The quest definition ID.</param>
    /// <returns>The quest, or null if not found.</returns>
    Quest? GetQuestByDefinition(Player player, string definitionId);

    /// <summary>
    /// Finds a quest by name (partial, case-insensitive match).
    /// </summary>
    /// <param name="player">The player whose quests to search.</param>
    /// <param name="name">The name to search for.</param>
    /// <returns>The matching quest, or null if not found.</returns>
    Quest? FindQuestByName(Player player, string name);

    /// <summary>
    /// Gets a quest by its position in the active quest list.
    /// </summary>
    /// <param name="player">The player whose quests to search.</param>
    /// <param name="listIndex">The 1-based list position.</param>
    /// <returns>The quest at that position, or null if invalid.</returns>
    Quest? GetQuestByListIndex(Player player, int listIndex);

    /// <summary>
    /// Creates a new quest from a definition.
    /// </summary>
    /// <param name="definitionId">The quest definition ID.</param>
    /// <param name="player">The player who will own the quest.</param>
    /// <param name="giverNpcId">Optional ID of the NPC giving the quest.</param>
    /// <returns>The created quest.</returns>
    /// <exception cref="ArgumentException">Thrown if definition not found.</exception>
    Quest CreateQuest(string definitionId, Player player, string? giverNpcId = null);

    /// <summary>
    /// Accepts a quest for a player.
    /// </summary>
    /// <param name="player">The player accepting the quest.</param>
    /// <param name="quest">The quest to accept.</param>
    /// <returns>True if the quest was accepted.</returns>
    bool AcceptQuest(Player player, Quest quest);

    /// <summary>
    /// Completes a quest for a player.
    /// </summary>
    /// <param name="player">The player completing the quest.</param>
    /// <param name="questId">The quest ID to complete.</param>
    /// <returns>True if the quest was completed.</returns>
    bool CompleteQuest(Player player, Guid questId);

    /// <summary>
    /// Gets all quests that are ready to be turned in.
    /// </summary>
    /// <param name="player">The player whose quests to check.</param>
    /// <returns>Enumerable of completable quests.</returns>
    IEnumerable<Quest> GetCompletableQuests(Player player);

    /// <summary>
    /// Gets quest count summary for a player.
    /// </summary>
    /// <param name="player">The player whose counts to retrieve.</param>
    /// <returns>Quest count summary.</returns>
    QuestCountSummary GetQuestCounts(Player player);

    /// <summary>
    /// Checks if player has a specific quest active.
    /// </summary>
    /// <param name="player">The player to check.</param>
    /// <param name="definitionId">The quest definition ID.</param>
    /// <returns>True if the player has this quest active.</returns>
    bool HasActiveQuest(Player player, string definitionId);

    /// <summary>
    /// Gets the quest journal DTO for rendering.
    /// </summary>
    /// <param name="player">The player whose journal to retrieve.</param>
    /// <param name="showCompleted">Whether to show completed quests.</param>
    /// <returns>Quest journal DTO.</returns>
    QuestJournalDto GetQuestJournal(Player player, bool showCompleted = false);

    /// <summary>
    /// Gets the quest detail DTO for rendering.
    /// </summary>
    /// <param name="quest">The quest to get details for.</param>
    /// <returns>Quest detail DTO.</returns>
    QuestDetailDto GetQuestDetail(Quest quest);

    /// <summary>
    /// Gets all available quest definitions.
    /// </summary>
    /// <returns>List of quest definitions.</returns>
    IReadOnlyList<QuestDefinition> GetQuestDefinitions();

    /// <summary>
    /// Gets a specific quest definition.
    /// </summary>
    /// <param name="definitionId">The definition ID.</param>
    /// <returns>The definition, or null if not found.</returns>
    QuestDefinition? GetQuestDefinition(string definitionId);
}
```

### 6.2 QuestService Implementation

```csharp
namespace RuneAndRust.Application.Services;

/// <summary>
/// Service implementation for managing quest lifecycle and queries.
/// </summary>
public class QuestService : IQuestService
{
    private readonly IConfigurationProvider _configurationProvider;
    private readonly ILogger<QuestService> _logger;

    /// <summary>
    /// Initializes a new instance of the QuestService.
    /// </summary>
    /// <param name="configurationProvider">Configuration provider for quest definitions.</param>
    /// <param name="logger">Logger instance.</param>
    public QuestService(
        IConfigurationProvider configurationProvider,
        ILogger<QuestService> logger)
    {
        _configurationProvider = configurationProvider ?? throw new ArgumentNullException(nameof(configurationProvider));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc />
    public IEnumerable<Quest> GetActiveQuests(Player player)
    {
        ArgumentNullException.ThrowIfNull(player);

        _logger.LogDebug("Getting active quests for player {PlayerId}", player.Id);

        return player.ActiveQuests
            .Where(q => q.Status == QuestStatus.Active)
            .OrderByDescending(q => q.CanTurnIn())
            .ThenByDescending(q => q.GetProgressPercent());
    }

    /// <inheritdoc />
    public IEnumerable<Quest> GetCompletedQuests(Player player)
    {
        ArgumentNullException.ThrowIfNull(player);

        _logger.LogDebug("Getting completed quests for player {PlayerId}", player.Id);

        return player.CompletedQuests
            .OrderByDescending(q => q.CompletedAt);
    }

    /// <inheritdoc />
    public Quest? GetQuest(Player player, Guid questId)
    {
        ArgumentNullException.ThrowIfNull(player);

        return player.GetQuest(questId);
    }

    /// <inheritdoc />
    public Quest? GetQuestByDefinition(Player player, string definitionId)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);

        return player.GetActiveQuestByDefinition(definitionId);
    }

    /// <inheritdoc />
    public Quest? FindQuestByName(Player player, string name)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);

        _logger.LogDebug("Finding quest by name '{Name}' for player {PlayerId}", name, player.Id);

        // Search active quests first
        var quest = player.ActiveQuests
            .FirstOrDefault(q => q.Name.Contains(name, StringComparison.OrdinalIgnoreCase));

        if (quest != null)
        {
            _logger.LogDebug("Found active quest '{QuestName}' matching '{Name}'", quest.Name, name);
            return quest;
        }

        // Then search completed quests
        quest = player.CompletedQuests
            .FirstOrDefault(q => q.Name.Contains(name, StringComparison.OrdinalIgnoreCase));

        if (quest != null)
        {
            _logger.LogDebug("Found completed quest '{QuestName}' matching '{Name}'", quest.Name, name);
        }
        else
        {
            _logger.LogDebug("No quest found matching '{Name}'", name);
        }

        return quest;
    }

    /// <inheritdoc />
    public Quest? GetQuestByListIndex(Player player, int listIndex)
    {
        ArgumentNullException.ThrowIfNull(player);

        if (listIndex < 1)
        {
            _logger.LogDebug("Invalid list index {Index}", listIndex);
            return null;
        }

        var activeQuests = GetActiveQuests(player).ToList();

        if (listIndex > activeQuests.Count)
        {
            _logger.LogDebug(
                "List index {Index} out of range (max: {Max})",
                listIndex, activeQuests.Count);
            return null;
        }

        return activeQuests[listIndex - 1];
    }

    /// <inheritdoc />
    public Quest CreateQuest(string definitionId, Player player, string? giverNpcId = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);
        ArgumentNullException.ThrowIfNull(player);

        _logger.LogDebug(
            "Creating quest '{DefinitionId}' for player {PlayerId}",
            definitionId, player.Id);

        var definition = _configurationProvider.GetQuestDefinition(definitionId);

        if (definition == null)
        {
            _logger.LogError("Quest definition not found: {DefinitionId}", definitionId);
            throw new ArgumentException(
                $"Quest definition not found: {definitionId}",
                nameof(definitionId));
        }

        var quest = Quest.Create(definition, player.Id, giverNpcId);

        _logger.LogInformation(
            "Created quest '{QuestName}' ({QuestId}) for player {PlayerId}",
            quest.Name, quest.Id, player.Id);

        return quest;
    }

    /// <inheritdoc />
    public bool AcceptQuest(Player player, Quest quest)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentNullException.ThrowIfNull(quest);

        _logger.LogDebug(
            "Player {PlayerId} attempting to accept quest '{QuestName}'",
            player.Id, quest.Name);

        var result = player.AcceptQuest(quest);

        if (result)
        {
            _logger.LogInformation(
                "Player {PlayerId} accepted quest '{QuestName}'",
                player.Id, quest.Name);
        }
        else
        {
            _logger.LogWarning(
                "Player {PlayerId} could not accept quest '{QuestName}'",
                player.Id, quest.Name);
        }

        return result;
    }

    /// <inheritdoc />
    public bool CompleteQuest(Player player, Guid questId)
    {
        ArgumentNullException.ThrowIfNull(player);

        var quest = player.GetQuest(questId);
        if (quest == null)
        {
            _logger.LogWarning(
                "Quest {QuestId} not found for player {PlayerId}",
                questId, player.Id);
            return false;
        }

        _logger.LogDebug(
            "Player {PlayerId} attempting to complete quest '{QuestName}'",
            player.Id, quest.Name);

        var completed = player.CompleteQuest(questId);

        if (completed != null)
        {
            _logger.LogInformation(
                "Player {PlayerId} completed quest '{QuestName}'",
                player.Id, quest.Name);
            return true;
        }

        _logger.LogWarning(
            "Player {PlayerId} could not complete quest '{QuestName}' - objectives not met",
            player.Id, quest.Name);
        return false;
    }

    /// <inheritdoc />
    public IEnumerable<Quest> GetCompletableQuests(Player player)
    {
        ArgumentNullException.ThrowIfNull(player);

        return player.GetCompletableQuests();
    }

    /// <inheritdoc />
    public QuestCountSummary GetQuestCounts(Player player)
    {
        ArgumentNullException.ThrowIfNull(player);

        var active = player.ActiveQuests.Count;
        var completed = player.CompletedQuests.Count;
        var readyToTurnIn = player.GetCompletableQuests().Count();

        return new QuestCountSummary(active, completed, readyToTurnIn);
    }

    /// <inheritdoc />
    public bool HasActiveQuest(Player player, string definitionId)
    {
        ArgumentNullException.ThrowIfNull(player);
        ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);

        return player.HasActiveQuest(definitionId);
    }

    /// <inheritdoc />
    public QuestJournalDto GetQuestJournal(Player player, bool showCompleted = false)
    {
        ArgumentNullException.ThrowIfNull(player);

        _logger.LogDebug(
            "Getting quest journal for player {PlayerId} (showCompleted: {ShowCompleted})",
            player.Id, showCompleted);

        return QuestJournalDto.Create(
            GetActiveQuests(player),
            GetCompletedQuests(player),
            showCompleted);
    }

    /// <inheritdoc />
    public QuestDetailDto GetQuestDetail(Quest quest)
    {
        ArgumentNullException.ThrowIfNull(quest);

        _logger.LogDebug("Getting quest detail for quest {QuestId}", quest.Id);

        // TODO: In future, could look up NPC names from NPC service
        return QuestDetailDto.FromQuest(quest);
    }

    /// <inheritdoc />
    public IReadOnlyList<QuestDefinition> GetQuestDefinitions()
    {
        return _configurationProvider.GetQuestDefinitions();
    }

    /// <inheritdoc />
    public QuestDefinition? GetQuestDefinition(string definitionId)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);

        return _configurationProvider.GetQuestDefinition(definitionId);
    }
}
```

---

## 7. Command Specifications

### 7.1 QuestsCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to display the quest journal.
/// </summary>
/// <param name="ShowCompleted">If true, show completed quests instead of active.</param>
public record QuestsCommand(bool ShowCompleted = false) : GameCommand;
```

### 7.2 QuestCommand

```csharp
namespace RuneAndRust.Application.Commands;

/// <summary>
/// Command to display a specific quest's details.
/// </summary>
/// <param name="QuestIdentifier">The quest name or list number.</param>
public record QuestCommand(string QuestIdentifier) : GameCommand;
```

### 7.3 Command Parsing Updates

```csharp
// In ConsoleInputHandler.ParseCommand():

"quests" or "journal" => ParseQuestsCommand(argument),
"quest" => ParseQuestCommand(argument),

/// <summary>
/// Parses the quests/journal command.
/// </summary>
/// <param name="argument">Optional argument (e.g., "completed").</param>
/// <returns>A QuestsCommand.</returns>
private GameCommand ParseQuestsCommand(string? argument)
{
    var showCompleted = argument?.Equals("completed", StringComparison.OrdinalIgnoreCase) == true
                     || argument?.Equals("done", StringComparison.OrdinalIgnoreCase) == true;

    return new QuestsCommand(showCompleted);
}

/// <summary>
/// Parses the quest command.
/// </summary>
/// <param name="argument">The quest identifier (name or number).</param>
/// <returns>A QuestCommand or error command.</returns>
private GameCommand ParseQuestCommand(string? argument)
{
    if (string.IsNullOrWhiteSpace(argument))
    {
        return new ErrorCommand("Usage: quest <name> or quest <number>");
    }

    return new QuestCommand(argument.Trim());
}
```

### 7.4 GameSessionService Command Handling

```csharp
// In GameSessionService.ProcessCommandAsync():

case QuestsCommand questsCmd:
    await HandleQuestsCommandAsync(questsCmd, ct);
    break;

case QuestCommand questCmd:
    await HandleQuestCommandAsync(questCmd, ct);
    break;

/// <summary>
/// Handles the quests/journal command.
/// </summary>
private async Task HandleQuestsCommandAsync(QuestsCommand command, CancellationToken ct)
{
    var journal = _questService.GetQuestJournal(_player, command.ShowCompleted);
    await _renderer.RenderQuestJournalAsync(journal, ct);
}

/// <summary>
/// Handles the quest detail command.
/// </summary>
private async Task HandleQuestCommandAsync(QuestCommand command, CancellationToken ct)
{
    Quest? quest = null;

    // Try parsing as number first
    if (int.TryParse(command.QuestIdentifier, out var listIndex))
    {
        quest = _questService.GetQuestByListIndex(_player, listIndex);
    }
    else
    {
        // Search by name
        quest = _questService.FindQuestByName(_player, command.QuestIdentifier);
    }

    if (quest == null)
    {
        await _renderer.RenderMessageAsync(
            $"Quest not found: {command.QuestIdentifier}",
            MessageType.Warning,
            ct);
        return;
    }

    var detail = _questService.GetQuestDetail(quest);
    await _renderer.RenderQuestDetailAsync(detail, ct);
}
```

### 7.5 User Commands Reference

| Command | Description | Example |
|---------|-------------|---------|
| `quests` | Display active quests | `quests` |
| `journal` | Alias for quests | `journal` |
| `quests completed` | Show completed quests | `quests completed` |
| `quests done` | Alias for completed | `quests done` |
| `quest <name>` | View quest by name (partial match) | `quest goblin` |
| `quest <number>` | View quest by list position | `quest 1` |

---

## 8. Rendering Specifications

### 8.1 IGameRenderer Additions

```csharp
// Add to IGameRenderer interface:

/// <summary>
/// Renders the quest journal view.
/// </summary>
/// <param name="journal">The quest journal data.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderQuestJournalAsync(QuestJournalDto journal, CancellationToken ct = default);

/// <summary>
/// Renders a quest detail view.
/// </summary>
/// <param name="detail">The quest detail data.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderQuestDetailAsync(QuestDetailDto detail, CancellationToken ct = default);
```

### 8.2 Quest Journal Display

```
┌─────────────────────────────────────────────────────────────┐
│                       QUEST JOURNAL                         │
├─────────────────────────────────────────────────────────────┤
│  Active Quests: 3                    Completed: 7           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ACTIVE QUESTS                                              │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  [1] The Goblin Menace                              60%     │
│      • Defeat goblins (3/5)                                 │
│                                                             │
│  [2] The Lost Heirloom                      [READY] 100%    │
│      ✓ Find the Golden Locket (1/1)                         │
│      • Return the locket to Grimbold (0/1)                  │
│                                                             │
│  [3] Mapping the Depths                             33%     │
│      ✓ Visit the Grand Hall (1/1)                           │
│      • Visit the Underground Lake (0/1)                     │
│      • Visit the Ancient Library (0/1)                      │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Type 'quest <#>' for details  |  'quests completed' for    │
│  completed quests                                           │
└─────────────────────────────────────────────────────────────┘
```

### 8.3 Quest Detail Display

```
┌─────────────────────────────────────────────────────────────┐
│                    THE GOBLIN MENACE                        │
├─────────────────────────────────────────────────────────────┤
│  Status: Active                      Progress: 60%          │
│  Given by: Guard Captain                                    │
│  Turn in to: Guard Captain                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  The dungeon entrance is overrun with goblins. Clear them   │
│  out to make the area safe for other adventurers.           │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  OBJECTIVES                                                 │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  • Defeat goblins                                  (3/5)    │
│    ████████████░░░░░░░░ 60%                                 │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  HINT                                                       │
│  Goblins are commonly found in the upper dungeon levels.    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.4 Completed Quest Display

```
┌─────────────────────────────────────────────────────────────┐
│                       QUEST JOURNAL                         │
├─────────────────────────────────────────────────────────────┤
│  Active Quests: 3                    Completed: 7           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  COMPLETED QUESTS                                           │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  [1] A Small Problem                       Completed         │
│      Completed: 2024-01-19 14:30                            │
│                                                             │
│  [2] The Ancient Tome                      Completed         │
│      Completed: 2024-01-18 09:15                            │
│                                                             │
│  [3] Cave Exploration                      Completed         │
│      Completed: 2024-01-17 16:45                            │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Type 'quest <#>' for details  |  'quests' for active       │
└─────────────────────────────────────────────────────────────┘
```

### 8.5 Console Output Examples

**Simple Console Output (non-TUI):**

```
> quests
=== QUEST JOURNAL ===
Active: 3 | Completed: 7 | Ready to turn in: 1

ACTIVE QUESTS:
[1] The Goblin Menace (60%)
    • Defeat goblins (3/5)

[2] The Lost Heirloom [READY TO TURN IN]
    ✓ Find the Golden Locket
    • Return the locket to Grimbold

[3] Mapping the Depths (33%)
    ✓ Visit the Grand Hall
    • Visit the Underground Lake
    • Visit the Ancient Library

Type 'quest <number>' to view details.
Type 'quests completed' for completed quests.

---

> quest 1
=== THE GOBLIN MENACE ===
Status: Active (60% complete)
Given by: Guard Captain
Turn in to: Guard Captain

The dungeon entrance is overrun with goblins. Clear them out
to make the area safe for other adventurers.

OBJECTIVES:
  • Defeat goblins (3/5) ████████████░░░░░░░░

HINT: Goblins are commonly found in the upper dungeon levels.

---

> quests completed
=== QUEST JOURNAL - COMPLETED ===
Completed: 7

[1] A Small Problem - Completed 2024-01-19
[2] The Ancient Tome - Completed 2024-01-18
[3] Cave Exploration - Completed 2024-01-17
...

Type 'quests' to view active quests.
```

---

## 9. User-Facing Changes

### 9.1 New Commands

| Command | Description |
|---------|-------------|
| `quests` | Opens the quest journal showing active quests |
| `journal` | Alias for `quests` |
| `quests completed` | Shows completed quests |
| `quest <name>` | Shows details for a quest matching the name |
| `quest <number>` | Shows details for quest at that list position |

### 9.2 Help Text Updates

```
QUEST COMMANDS:
  quests, journal     View your quest journal
  quests completed    View completed quests
  quest <name/#>      View details for a specific quest

EXAMPLES:
  > quests            Show active quests
  > quest 1           View first quest in list
  > quest goblin      View quest with "goblin" in name
```

---

## 10. Logging Requirements

### 10.1 Log Events

| Event | Level | Message Template | Properties |
|-------|-------|------------------|------------|
| Journal View | Debug | "Getting quest journal for player {PlayerId}" | PlayerId |
| Quest Search | Debug | "Finding quest by name '{Name}' for player {PlayerId}" | Name, PlayerId |
| Quest Found | Debug | "Found quest '{QuestName}' matching '{Name}'" | QuestName, Name |
| Quest Not Found | Debug | "No quest found matching '{Name}'" | Name |
| Quest Created | Information | "Created quest '{QuestName}' ({QuestId}) for player {PlayerId}" | QuestName, QuestId, PlayerId |
| Quest Accepted | Information | "Player {PlayerId} accepted quest '{QuestName}'" | PlayerId, QuestName |
| Quest Completed | Information | "Player {PlayerId} completed quest '{QuestName}'" | PlayerId, QuestName |
| Quest Accept Failed | Warning | "Player {PlayerId} could not accept quest '{QuestName}'" | PlayerId, QuestName |
| Quest Complete Failed | Warning | "Player {PlayerId} could not complete quest '{QuestName}'" | PlayerId, QuestName |
| Definition Not Found | Error | "Quest definition not found: {DefinitionId}" | DefinitionId |

### 10.2 Example Log Output

```
[2024-01-20 14:30:15 DBG] Getting quest journal for player e5f6g7h8-...
[2024-01-20 14:30:16 DBG] Finding quest by name 'goblin' for player e5f6g7h8-...
[2024-01-20 14:30:16 DBG] Found active quest 'The Goblin Menace' matching 'goblin'
[2024-01-20 14:30:16 DBG] Getting quest detail for quest a1b2c3d4-...
```

---

## 11. Unit Test Specifications

### 11.1 QuestService Tests (~12 tests)

```csharp
namespace RuneAndRust.Application.Tests.Services;

[TestFixture]
public class QuestServiceTests
{
    private QuestService _questService;
    private Mock<IConfigurationProvider> _configProviderMock;
    private Mock<ILogger<QuestService>> _loggerMock;
    private Player _player;
    private QuestDefinition _testDefinition;

    [SetUp]
    public void Setup()
    {
        _loggerMock = new Mock<ILogger<QuestService>>();
        _configProviderMock = new Mock<IConfigurationProvider>();

        _testDefinition = QuestDefinition.Create(
            "test-quest",
            "Test Quest",
            "A test quest.",
            new[]
            {
                ObjectiveDefinition.Create(
                    ObjectiveType.Kill,
                    "Defeat enemies",
                    ObjectiveTarget.Any("enemy", "Enemies"),
                    5)
            });

        _configProviderMock
            .Setup(p => p.GetQuestDefinition("test-quest"))
            .Returns(_testDefinition);

        _configProviderMock
            .Setup(p => p.GetQuestDefinitions())
            .Returns(new[] { _testDefinition });

        _questService = new QuestService(
            _configProviderMock.Object,
            _loggerMock.Object);

        _player = Player.Create("Test Player");
    }

    [Test]
    public void GetActiveQuests_ReturnsOnlyActiveQuests()
    {
        var quest = _questService.CreateQuest("test-quest", _player);
        _questService.AcceptQuest(_player, quest);

        var activeQuests = _questService.GetActiveQuests(_player).ToList();

        activeQuests.Should().ContainSingle();
        activeQuests[0].Status.Should().Be(QuestStatus.Active);
    }

    [Test]
    public void GetActiveQuests_WithNoQuests_ReturnsEmpty()
    {
        var activeQuests = _questService.GetActiveQuests(_player);

        activeQuests.Should().BeEmpty();
    }

    [Test]
    public void FindQuestByName_PartialMatch_ReturnsQuest()
    {
        var quest = _questService.CreateQuest("test-quest", _player);
        _questService.AcceptQuest(_player, quest);

        var found = _questService.FindQuestByName(_player, "Test");

        found.Should().NotBeNull();
        found!.Name.Should().Be("Test Quest");
    }

    [Test]
    public void FindQuestByName_CaseInsensitive_ReturnsQuest()
    {
        var quest = _questService.CreateQuest("test-quest", _player);
        _questService.AcceptQuest(_player, quest);

        var found = _questService.FindQuestByName(_player, "TEST QUEST");

        found.Should().NotBeNull();
    }

    [Test]
    public void FindQuestByName_NotFound_ReturnsNull()
    {
        var found = _questService.FindQuestByName(_player, "nonexistent");

        found.Should().BeNull();
    }

    [Test]
    public void GetQuestByListIndex_ValidIndex_ReturnsQuest()
    {
        var quest = _questService.CreateQuest("test-quest", _player);
        _questService.AcceptQuest(_player, quest);

        var found = _questService.GetQuestByListIndex(_player, 1);

        found.Should().NotBeNull();
        found!.Id.Should().Be(quest.Id);
    }

    [Test]
    public void GetQuestByListIndex_InvalidIndex_ReturnsNull()
    {
        var found = _questService.GetQuestByListIndex(_player, 99);

        found.Should().BeNull();
    }

    [Test]
    public void GetQuestByListIndex_ZeroIndex_ReturnsNull()
    {
        var found = _questService.GetQuestByListIndex(_player, 0);

        found.Should().BeNull();
    }

    [Test]
    public void CreateQuest_ValidDefinition_ReturnsQuest()
    {
        var quest = _questService.CreateQuest("test-quest", _player);

        quest.Should().NotBeNull();
        quest.Name.Should().Be("Test Quest");
        quest.PlayerId.Should().Be(_player.Id);
    }

    [Test]
    public void CreateQuest_InvalidDefinition_ThrowsArgumentException()
    {
        var act = () => _questService.CreateQuest("invalid-quest", _player);

        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void GetQuestCounts_ReturnsCorrectCounts()
    {
        var quest = _questService.CreateQuest("test-quest", _player);
        _questService.AcceptQuest(_player, quest);

        var counts = _questService.GetQuestCounts(_player);

        counts.Active.Should().Be(1);
        counts.Completed.Should().Be(0);
        counts.ReadyToTurnIn.Should().Be(0);
    }

    [Test]
    public void HasActiveQuest_WithActiveQuest_ReturnsTrue()
    {
        var quest = _questService.CreateQuest("test-quest", _player);
        _questService.AcceptQuest(_player, quest);

        var hasQuest = _questService.HasActiveQuest(_player, "test-quest");

        hasQuest.Should().BeTrue();
    }
}
```

### 11.2 DTO Tests (~8 tests)

```csharp
[TestFixture]
public class QuestDtoTests
{
    private Quest _quest;
    private QuestDefinition _definition;

    [SetUp]
    public void Setup()
    {
        _definition = QuestDefinition.Create(
            "test-quest",
            "Test Quest",
            "A test quest description.",
            new[]
            {
                ObjectiveDefinition.Create(
                    ObjectiveType.Kill,
                    "Defeat enemies",
                    ObjectiveTarget.Any("enemy", "Enemies"),
                    5,
                    order: 1),
                ObjectiveDefinition.Create(
                    ObjectiveType.Explore,
                    "Visit location",
                    ObjectiveTarget.Specific("room-1", "Test Room"),
                    1,
                    order: 2)
            },
            hint: "Test hint");

        _quest = Quest.Create(_definition, Guid.NewGuid());
        _quest.Accept();
    }

    [Test]
    public void QuestSummaryDto_FromQuest_MapsCorrectly()
    {
        var dto = QuestSummaryDto.FromQuest(_quest, 1);

        dto.Id.Should().Be(_quest.Id);
        dto.Name.Should().Be("Test Quest");
        dto.Status.Should().Be(QuestStatus.Active);
        dto.ListIndex.Should().Be(1);
    }

    [Test]
    public void QuestSummaryDto_CalculatesProgress()
    {
        _quest.Objectives[0].SetProgress(3); // 60%

        var dto = QuestSummaryDto.FromQuest(_quest, 1);

        dto.ProgressPercent.Should().Be(30); // (60 + 0) / 2
    }

    [Test]
    public void QuestDetailDto_FromQuest_MapsAllFields()
    {
        var dto = QuestDetailDto.FromQuest(_quest);

        dto.Id.Should().Be(_quest.Id);
        dto.Name.Should().Be("Test Quest");
        dto.Description.Should().Be("A test quest description.");
        dto.Hint.Should().Be("Test hint");
        dto.Objectives.Should().HaveCount(2);
    }

    [Test]
    public void ObjectiveSummaryDto_FromObjective_MapsCorrectly()
    {
        var objective = _quest.Objectives[0];
        objective.SetProgress(3);

        var dto = ObjectiveSummaryDto.FromObjective(objective);

        dto.Description.Should().Be("Defeat enemies");
        dto.CurrentCount.Should().Be(3);
        dto.RequiredCount.Should().Be(5);
        dto.ProgressPercent.Should().Be(60);
    }

    [Test]
    public void QuestJournalDto_SortsQuestsByProgress()
    {
        var quest2 = Quest.Create(_definition, _quest.PlayerId);
        quest2.Accept();
        quest2.Objectives[0].SetProgress(5);
        quest2.Objectives[1].SetProgress(1);

        var journal = QuestJournalDto.Create(
            new[] { _quest, quest2 },
            Array.Empty<Quest>());

        // quest2 should be first (100% and completable)
        journal.ActiveQuests[0].Id.Should().Be(quest2.Id);
    }

    [Test]
    public void QuestCountSummary_CalculatesTotal()
    {
        var summary = new QuestCountSummary(3, 5, 1);

        summary.Total.Should().Be(8);
        summary.HasActiveQuests.Should().BeTrue();
        summary.HasCompletableQuests.Should().BeTrue();
    }

    [Test]
    public void QuestCountSummary_ToDisplayString_FormatsCorrectly()
    {
        var summary = new QuestCountSummary(3, 5, 1);

        var display = summary.ToDisplayString();

        display.Should().Contain("3 active");
        display.Should().Contain("1 ready to turn in");
        display.Should().Contain("5 completed");
    }

    [Test]
    public void QuestCountSummary_Empty_ReturnsNoQuests()
    {
        var summary = QuestCountSummary.Empty;

        summary.ToDisplayString().Should().Be("No quests");
    }
}
```

### 11.3 Command Parsing Tests (~5 tests)

```csharp
[TestFixture]
public class QuestCommandParsingTests
{
    private ConsoleInputHandler _handler;

    [SetUp]
    public void Setup()
    {
        _handler = new ConsoleInputHandler();
    }

    [Test]
    public void ParseCommand_Quests_ReturnsQuestsCommand()
    {
        var command = _handler.ParseCommand("quests");

        command.Should().BeOfType<QuestsCommand>();
        ((QuestsCommand)command).ShowCompleted.Should().BeFalse();
    }

    [Test]
    public void ParseCommand_Journal_ReturnsQuestsCommand()
    {
        var command = _handler.ParseCommand("journal");

        command.Should().BeOfType<QuestsCommand>();
    }

    [Test]
    public void ParseCommand_QuestsCompleted_ReturnsQuestsCommandWithFlag()
    {
        var command = _handler.ParseCommand("quests completed");

        command.Should().BeOfType<QuestsCommand>();
        ((QuestsCommand)command).ShowCompleted.Should().BeTrue();
    }

    [Test]
    public void ParseCommand_QuestWithName_ReturnsQuestCommand()
    {
        var command = _handler.ParseCommand("quest goblin");

        command.Should().BeOfType<QuestCommand>();
        ((QuestCommand)command).QuestIdentifier.Should().Be("goblin");
    }

    [Test]
    public void ParseCommand_QuestWithNumber_ReturnsQuestCommand()
    {
        var command = _handler.ParseCommand("quest 1");

        command.Should().BeOfType<QuestCommand>();
        ((QuestCommand)command).QuestIdentifier.Should().Be("1");
    }
}
```

---

## 12. Use Cases

### UC-001: View Quest Journal
**Actor:** Player
**Flow:**
1. Player enters `quests` command
2. System retrieves active quests via QuestService
3. System creates QuestJournalDto
4. Renderer displays quest list with progress

### UC-002: View Quest Details
**Actor:** Player
**Flow:**
1. Player enters `quest 1` or `quest goblin`
2. System parses identifier
3. System looks up quest by index or name
4. System creates QuestDetailDto
5. Renderer displays quest details

### UC-003: View Completed Quests
**Actor:** Player
**Flow:**
1. Player enters `quests completed`
2. System retrieves completed quests
3. System creates QuestJournalDto with ShowCompleted=true
4. Renderer displays completed quest list

### UC-004: Quest Not Found
**Actor:** Player
**Flow:**
1. Player enters `quest unknown`
2. System searches for quest
3. No match found
4. Renderer displays "Quest not found" message

---

## 13. Acceptance Criteria

### AC-3.0b-1: QuestService
- [ ] QuestService implements IQuestService interface
- [ ] GetActiveQuests returns only active quests
- [ ] GetCompletedQuests returns only completed quests
- [ ] FindQuestByName performs case-insensitive partial match
- [ ] GetQuestByListIndex returns correct quest for 1-based index
- [ ] CreateQuest creates quest from definition
- [ ] AcceptQuest adds quest to player's active quests
- [ ] CompleteQuest moves quest to completed quests
- [ ] GetQuestCounts returns accurate counts
- [ ] Appropriate logging for all operations

### AC-3.0b-2: Commands
- [ ] `quests` command displays active quests
- [ ] `journal` alias works identically to `quests`
- [ ] `quests completed` shows completed quests
- [ ] `quest <name>` shows quest matching name
- [ ] `quest <number>` shows quest at list position
- [ ] Invalid quest identifier shows appropriate message

### AC-3.0b-3: DTOs
- [ ] QuestSummaryDto maps all required fields
- [ ] QuestDetailDto includes all objectives
- [ ] ObjectiveSummaryDto calculates progress correctly
- [ ] QuestJournalDto sorts quests by completion readiness

### AC-3.0b-4: Rendering
- [ ] Quest journal displays all active quests
- [ ] Progress percentages display correctly
- [ ] Ready-to-turn-in quests are marked
- [ ] Objectives show checkmarks when complete
- [ ] Quest detail shows all information
- [ ] Progress bars render correctly

### AC-3.0b-5: Unit Tests
- [ ] ~25 unit tests implemented
- [ ] All tests pass
- [ ] Tests cover service, DTOs, and command parsing

---

## 14. Deliverable Checklist

### Application Layer
- [ ] `Interfaces/IQuestService.cs`
- [ ] `Services/QuestService.cs`
- [ ] `DTOs/QuestSummaryDto.cs`
- [ ] `DTOs/QuestDetailDto.cs`
- [ ] `DTOs/ObjectiveSummaryDto.cs`
- [ ] `DTOs/QuestJournalDto.cs`
- [ ] `ValueObjects/QuestCountSummary.cs`
- [ ] `Commands/QuestsCommand.cs`
- [ ] `Commands/QuestCommand.cs`

### Presentation Layer
- [ ] `Interfaces/IGameRenderer.cs` updates
- [ ] `ConsoleInputHandler.cs` updates (command parsing)
- [ ] `ConsoleRenderer.cs` updates (quest rendering)

### Service Integration
- [ ] `GameSessionService.cs` updates (command handling)
- [ ] Service registration in DI container

### Tests
- [ ] `Application.Tests/Services/QuestServiceTests.cs`
- [ ] `Application.Tests/DTOs/QuestDtoTests.cs`
- [ ] `Presentation.Tests/QuestCommandParsingTests.cs`

### Documentation
- [ ] XML documentation on all public members
- [ ] Help text updates for quest commands

---

## 15. Dependencies

### Required from v0.3.0a
| Type | Location | Usage |
|------|----------|-------|
| Quest | Domain/Entities | Core quest entity |
| QuestObjective | Domain/Entities | Objective tracking |
| QuestStatus | Domain/Enums | Status filtering |
| ObjectiveType | Domain/Enums | Objective display |
| QuestDefinition | Domain/Definitions | Quest creation |
| Player updates | Domain/Entities | Quest collections |
| IConfigurationProvider | Application/Interfaces | Definition loading |

### Required from Existing Infrastructure
| Type | Location | Usage |
|------|----------|-------|
| IGameRenderer | Presentation/Interfaces | Display rendering |
| ConsoleInputHandler | Presentation | Command parsing |
| GameSessionService | Application/Services | Command handling |
| ILogger | Microsoft.Extensions.Logging | Logging |

### Provides to v0.3.0c (Progress Tracking)
| Type | Usage |
|------|-------|
| IQuestService | Quest operations coordination |
| QuestDetailDto | Progress display updates |
| Command infrastructure | Progress notifications |

---

## 16. Future Considerations

### Deferred to v0.3.0c
- **Progress Notifications**: Automatic updates on game events
- **Dialogue Integration**: Accept quests via NPC dialogue
- **Event-Driven Updates**: Kill, collect, explore tracking

### Deferred to v0.3.1
- **Quest Rewards Display**: Show rewards in detail view
- **Prerequisite Display**: Show required quests
- **Level Requirements**: Show level requirements

### Deferred to Future Versions
- **Quest Map Markers**: Show locations on map
- **Quest Tracking**: Pin quest to HUD
- **Quest Sharing**: Share quest progress with party
- **Quest Sorting**: Sort by name, progress, type
- **Quest Filtering**: Filter by objective type

---

*Document Version: 1.0*
*Last Updated: 2024-01-20*
*Author: Claude Code*
