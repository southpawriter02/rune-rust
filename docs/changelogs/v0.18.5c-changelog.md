# v0.18.5c Changelog — Rest Integration Layer

**Date:** 2026-02-02  
**Phase:** 3/4 of v0.18.5 (Integration Layer)

---

## Summary

Implements the **UnifiedRestHandler** service that orchestrates rest processing across all trauma economy systems, coordinating stress recovery, specialization resource resets, trauma checks, CPS stage detection, and party effects.

---

## Added

### Domain Layer

- `RestIntegrationResult.cs` — Value object aggregating all rest processing outcomes (263 lines)
    - Factory methods: `Create()`, `Empty()`
    - Validation: `IsValid()`
    - Computed properties: `IsSignificantRecovery`, `IsFullRecovery`, `AcquiredNewTraumas`, `HasPartyBonus`
- `PartyContext.cs` — Record for party-wide rest effects (62 lines)
    - Factory methods: `Empty`, `WithMembers()`, `WithBerserker()`

### Application Layer

- `UnifiedRestHandler.cs` — Orchestration service (437 lines)
    - Processing pipeline:
        1. Stress recovery via `IStressService.RecoverStress()`
        2. Resource resets (Momentum → 0, Coherence → 50 on Long/Sanctuary)
        3. Trauma checks via `ITraumaService.PerformTraumaCheckAsync()`
        4. CPS stage change detection (StressThreshold → CpsStage mapping)
        5. Party bonus application (Berserker FrenzyBeyondReason)
    - Required dependencies: `IStressService`, `ITraumaService`
    - Optional dependencies: `IRageService`, `IMomentumService`, `ICoherenceService`

### Unit Tests

- `UnifiedRestHandlerTests.cs` — 24 tests covering:
    - Constructor validation (null checks, optional dependencies)
    - Basic rest flow processing
    - Stress recovery (Short/Long/Sanctuary)
    - Trauma check execution and trauma acquisition
    - Specialization resource resets
    - Party effects (Berserker FrenzyBeyondReason bonus)
    - CPS stage improvement detection
    - Result object validation

---

## Verification

| Check     | Result   |
| --------- | -------- |
| Build     | ✅ Pass  |
| New Tests | 24/24 ✅ |
| Warnings  | 0        |
| Errors    | 0        |
