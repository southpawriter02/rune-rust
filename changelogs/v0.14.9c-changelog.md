# v0.14.9c Changelog - NPC Descriptor Schema

## Summary

Introduced the comprehensive **NPC Descriptor Schema** (`npc-descriptors.schema.json`) which validates NPC flavor text descriptors including physical appearance descriptions, ambient dialogue barks, and emotional reaction descriptors. This schema enables full customization of NPC presentation organized by archetype and context—all without code changes. Supports 8 archetypes (Dvergr, Seidkona, Bandit, Raider, Merchant, Guard, Citizen, Forlorn), 16 bark types, 15 reaction types, and 24 trigger events. This is the third entry in the v0.14.9 Advanced Descriptor Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/npc-descriptors.schema.json](config/schemas/npc-descriptors.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (10 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `NPCPhysicalDescriptor` | Physical appearance descriptions | id, text, archetype, subtype, descriptorType |
| `NPCAmbientBarkDescriptor` | Ambient dialogue barks | id, text, archetype, subtype, barkType |
| `NPCReactionDescriptor` | Emotional reaction descriptions | id, text, archetype, subtype, reactionType, triggerEvent |
| `NPCArchetype` | 8 NPC archetypes enum | - |
| `NPCCondition` | 6 condition states enum | - |
| `Disposition` | 5 disposition levels enum | - |
| `BarkType` | 16 bark types enum | - |
| `ReactionType` | 15 reaction types enum | - |
| `TriggerEvent` | 24 trigger events enum | - |

### Category Enumeration (3 values)

| Category | Description | File Pattern |
|----------|-------------|--------------|
| `npc-physical` | Physical appearance | physical-descriptors.json |
| `npc-barks` | Ambient dialogue | ambient-barks.json |
| `npc-reactions` | Emotional responses | reaction-descriptors.json |

### NPCArchetype Enumeration (8 values)

| Archetype | Description | Cultural Voice |
|-----------|-------------|----------------|
| `Dvergr` | Dwarven craftsmen/engineers | Technical, precise, obsessed with function |
| `Seidkona` | Norse magic practitioners | Mystical, archaic, speaking in metaphor |
| `Bandit` | Outlaws and thieves | Harsh, survivalist, desperate |
| `Raider` | Aggressive warriors | Aggressive, confrontational |
| `Merchant` | Traders and shopkeepers | Mercantile, shrewd, practical |
| `Guard` | Protectors and enforcers | Duty-bound, alert, authoritative |
| `Citizen` | Common folk | Varied, everyday concerns |
| `Forlorn` | Blight-corrupted NPCs | Broken, haunted, unstable |

### Descriptor Type Enumeration (6 values)

| Type | Description | Example |
|------|-------------|---------|
| `FullBody` | Overall physical appearance | "A stocky Dvergr covered in soot..." |
| `Face` | Facial features and expression | "An elderly face whose eyes reflect light strangely..." |
| `Clothing` | Attire and garments | "Robes inscribed with protective runes..." |
| `Equipment` | Tools, weapons, gear | "Tools hanging from every belt loop..." |
| `Bearing` | Posture, demeanor, presence | "This scout moves with predatory grace..." |
| `Distinguishing` | Unique identifying traits | "A singed beard, evidence of explosive mishaps..." |

### BarkType Enumeration (16 values)

| Type | Category | Description |
|------|----------|-------------|
| `AtWork` | Work | Performing task |
| `IdleConversation` | Social | Casual chat |
| `Observation` | Alert | Noticing environment |
| `Warning` | Alert | Caution |
| `Greeting` | Social | Welcoming |
| `Celebration` | Mood | Joy |
| `Concern` | Alert | Worry |
| `Suspicion` | Alert | Distrust |
| `Encouragement` | Social | Positive feedback |
| `Complaint` | Mood | Dissatisfaction |
| `Teaching` | Social | Sharing knowledge |
| `Threat` | Combat | Intimidation |
| `Insult` | Combat | Mockery |
| `Wounded` | Combat | Taking damage |
| `Fleeing` | Combat | Retreat |
| `BattleCry` | Combat | Combat initiation |

### ReactionType Enumeration (15 values)

| Type | Category | Description |
|------|----------|-------------|
| `Surprised` | Neutral | Shock, unexpected |
| `Angry` | Negative | Rage, fury |
| `Fearful` | Negative | Fear, terror |
| `Relieved` | Positive | Relief |
| `Suspicious` | Negative | Mistrust |
| `Joyful` | Positive | Happiness |
| `Pained` | Neutral | Physical pain |
| `Confused` | Neutral | Bewilderment |
| `Impressed` | Positive | Admiration |
| `Disgusted` | Negative | Disgust |
| `Grateful` | Positive | Thankfulness |
| `Betrayed` | Negative | Betrayal |
| `Proud` | Positive | Pride |
| `Curious` | Positive | Interest |
| `Resigned` | Neutral | Acceptance |

### TriggerEvent Enumeration (24 values)

| Event | Category | Description |
|-------|----------|-------------|
| `PlayerApproaches` | Social | Player enters proximity |
| `PlayerAttacks` | Combat | Player initiates combat |
| `PlayerHelps` | Social | Player provides assistance |
| `PlayerGifts` | Social | Player gives item |
| `PlayerSteals` | Social | Player takes item |
| `AllyKilled` | Combat | Friendly NPC dies |
| `EnemyKilled` | Combat | Hostile NPC dies |
| `TakingDamage` | Combat | NPC receives damage |
| `VictoryAchieved` | Combat | Combat won |
| `TreasureFound` | Discovery | Valuable discovered |
| `SecretRevealed` | Discovery | Hidden info found |
| `MechanismRepaired` | Achievement | Machine fixed |
| `AncientKnowledgeFound` | Discovery | Lore discovered |
| `TrapTriggered` | Danger | Trap activated |
| `BlightEncounter` | Danger | Blight detected |
| `StructuralCollapse` | Danger | Building damage |
| `AmbushDetected` | Danger | Ambush discovered |
| `QuestCompleted` | Achievement | Quest finished |
| `BetrayalDetected` | Social | Treachery discovered |
| `GiftReceived` | Social | Item received |
| `TheftDetected` | Social | Theft discovered |
| `MagicWitnessed` | Discovery | Magic observed |
| `RuneActivated` | Discovery | Rune powered |
| `ProphecyFulfilled` | Discovery | Prediction realized |

### NPCCondition Enumeration (6 values)

| Condition | Description | Visual Indicators |
|-----------|-------------|-------------------|
| `Healthy` | Normal state | Clean, alert, unblemished |
| `Wounded` | Injured | Bandages, blood, limping |
| `Exhausted` | Fatigued | Drooping, dark circles, slow |
| `Affluent` | Wealthy | Fine clothes, jewelry, clean |
| `Impoverished` | Poor | Rags, thin, dirty |
| `BattleReady` | Combat prepared | Armor donned, weapons drawn |

### Disposition Enumeration (5 values)

| Disposition | Relationship | Typical Behaviors |
|-------------|--------------|-------------------|
| `Hostile` | Enemies | Attack on sight, threats, insults |
| `Unfriendly` | Distrustful | Suspicion, warnings, reluctant help |
| `Neutral` | Unknown | Observation, cautious interaction |
| `Friendly` | Positive | Greetings, encouragement, assistance |
| `Allied` | Partners | Full cooperation, defense, teaching |

### Action Tendency Enumeration (8 values)

| Tendency | Description | Typical Context |
|----------|-------------|-----------------|
| `Approach` | Move toward player | Friendly, Curious |
| `Flee` | Run away | Fearful, Overwhelmed |
| `Attack` | Engage in combat | Angry, Hostile |
| `Assist` | Help player | Grateful, Allied |
| `Ignore` | No action | Neutral, Uninvolved |
| `Report` | Tell others | Suspicious, Betrayed |
| `Investigate` | Examine | Curious, Surprised |
| `Guard` | Defensive stance | Suspicious, Protective |

### Configuration Files (3 Example Files)

| File | Description | Pools Count |
|------|-------------|-------------|
| `physical-descriptors.json` | Physical appearance descriptors | 12 pools |
| `ambient-barks.json` | Ambient dialogue barks | 12 pools |
| `reaction-descriptors.json` | Reaction descriptors | 14 pools |

### Variable Placeholders Documented

| Category | Variables |
|----------|-----------|
| NPC | `{NPCName}`, `{NPCArchetype}`, `{NPCSubtype}`, `{NPCTitle}` |
| Player | `{PlayerName}`, `{PlayerClass}`, `{PlayerFaction}` |
| Context | `{Biome}`, `{LocationName}`, `{TimeOfDay}`, `{Weather}` |
| Activity | `{Activity}`, `{Tool}`, `{Resource}`, `{ItemName}` |
| Physical | `{Height}`, `{Build}`, `{HairColor}`, `{EyeColor}`, `{Weapon}`, `{Armor}` |
| Reaction | `{Disposition}`, `{Condition}`, `{PlayerAction}`, `{TriggerEvent}`, `{AllyName}` |

### Unit Tests
- **[NPCDescriptorSchemaTests.cs](tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/NPCDescriptorSchemaTests.cs)** - 113 tests
  - `NPCDescriptorSchema_LoadsAndParses_Successfully` - Schema structure validation (10 definitions)
  - `NPCDescriptorSchema_*_PassesValidation` - 3 tests for configuration files
  - `NPCPhysicalDescriptor_*` - 11 tests for physical descriptor validation
  - `NPCAmbientBarkDescriptor_*` - 20 tests for bark validation
  - `NPCReactionDescriptor_*` - 20 tests for reaction validation
  - `NPCArchetype_*` - 11 tests for archetype enum validation
  - `Disposition_*` - 9 tests for disposition validation
  - `TriggerEvent_*` - 25 tests for trigger event validation
  - `NPCCondition_*` - 8 tests for condition validation
  - `Configuration_*` - 6 tests for root configuration validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/npc-descriptors.schema.json` | Added |
| `config/npc-descriptors/physical-descriptors.json` | Added |
| `config/npc-descriptors/ambient-barks.json` | Added |
| `config/npc-descriptors/reaction-descriptors.json` | Added |
| `tests/.../Schemas/NPCDescriptorSchemaTests.cs` | Added |
| `changelogs/v0.14.9c-changelog.md` | Added |

## Test Results

```
Test summary: total: 113, failed: 0, succeeded: 113, skipped: 0
Build succeeded with 0 errors
```

## Schema Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  NPC DESCRIPTOR CONFIGURATION                                   │
├─────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"             │
│  type: object                                                   │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ROOT PROPERTIES                                          │  │
│  │  version: "1.0.0"       (semver format)                   │  │
│  │  category: "npc-physical" | "npc-barks" | "npc-reactions" │  │
│  │  pools: { poolId: [descriptors] }                         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  NPC PHYSICAL DESCRIPTOR                                  │  │
│  │  id: "dvergr_tinkerer_fullbody_001"                       │  │
│  │  text: "A stocky Dvergr covered in soot..."               │  │
│  │  weight: 10 (selection probability)                       │  │
│  │  archetype: "Dvergr" (8 archetypes)                       │  │
│  │  subtype: "Tinkerer"                                      │  │
│  │  descriptorType: "FullBody" (6 types)                     │  │
│  │  condition: "Healthy" (6 conditions, optional)            │  │
│  │  ageCategory: "MiddleAged" (4 ages, optional)             │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  NPC AMBIENT BARK DESCRIPTOR                              │  │
│  │  id: "dvergr_tinkerer_atwork_001"                         │  │
│  │  text: "Tolerance specifications are off..."              │  │
│  │  barkType: "AtWork" (16 types)                            │  │
│  │  activityContext: "Working" (10 contexts, optional)       │  │
│  │  dispositionContext: "Friendly" (5 dispositions, optional)│  │
│  │  triggerCondition: "PlayerNearby" (8 conditions, optional)│  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  NPC REACTION DESCRIPTOR                                  │  │
│  │  id: "dvergr_tinkerer_impressed_001"                      │  │
│  │  text: "You have the look of someone who can fix things." │  │
│  │  reactionType: "Impressed" (15 types)                     │  │
│  │  triggerEvent: "MechanismRepaired" (24 events)            │  │
│  │  intensity: "Moderate" (4 levels, optional)               │  │
│  │  priorDisposition: "Neutral" (optional)                   │  │
│  │  actionTendency: "Assist" (8 tendencies, optional)        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## NPC Description Generation Flow

```
  NPC Spawns in Room
           │
           ▼
  ┌────────────────────────┐
  │ 1. DETERMINE ARCHETYPE │
  │ "Dvergr Tinkerer"      │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 2. DETERMINE CONDITION │
  │ "Healthy" / "Wounded"  │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 3. BUILD COMPOSITE     │
  │ FullBody + Face +      │
  │ Distinguishing         │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 4. SELECT BY WEIGHT    │
  │ Weighted random from   │
  │ each pool              │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────────────────────────────────────┐
  │ OUTPUT: "A stocky Dvergr covered in soot and machine   │
  │          oil, tools hanging from every belt loop."     │
  └────────────────────────────────────────────────────────┘
```

## v0.14.9 Advanced Descriptor Schemas - Progress

| Version | Schema | Tests | Status |
|---------|--------|-------|--------|
| v0.14.9a | `dialogue.schema.json` | 76 ✓ | Complete |
| v0.14.9b | `ability-descriptors.schema.json` | 103 ✓ | Complete |
| v0.14.9c | `npc-descriptors.schema.json` | 113 ✓ | **Complete** |
| v0.14.9d | `psychological-descriptors.schema.json` | ~6 | Pending |
| v0.14.9e | `capture-templates.schema.json` | ~6 | Pending |
| **Total** | **5 schemas** | **~310 tests** | 3/5 complete |

## Modding Scenarios Enabled

After this implementation, modders can:
- Create custom NPC archetypes with unique physical descriptors
- Define archetype-specific subtypes (e.g., Dvergr Runecaster, Bandit Leader)
- Add condition-specific appearance variations (Wounded, Exhausted, BattleReady)
- Create age-appropriate descriptors (Young, MiddleAged, Elderly, Ageless)
- Design ambient barks for any activity/disposition combination
- Define reaction responses to all 24 trigger events
- Set up action tendencies for NPC behavior after reactions
- Create biome-specific descriptor variants
- Use variable placeholders for dynamic content substitution

---

*Third entry in v0.14.9 Advanced Descriptor Configuration Schemas series. Next: v0.14.9d (Psychological Descriptor Schema).*
