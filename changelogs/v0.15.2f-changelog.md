# v0.15.2f Changelog - Balance Checks

**Release Date:** 2026-01-23
**Focus:** Balance check mechanics for traversing narrow or unstable surfaces
**Prerequisites:** v0.15.2a-e Complete (Climbing, Leaping, Fall Damage, Stealth Movement, Chase Sequences)

---

## Summary

This release implements the balance check system, enabling tactical traversal challenges where characters must maintain balance on narrow or unstable surfaces. The system features width-based DCs, stability modifiers, and fall consequence integration.

---

## Added

### Domain Layer

#### Enums
- **`BalanceWidth`**: Surface width categories
  - `Wide`: 2+ feet, DC 2
  - `Narrow`: ~1 foot, DC 3
  - `Cable`: ~6 inches, DC 4
  - `RazorEdge`: < 6 inches, DC 5

- **`SurfaceStability`**: Stability states
  - `Stable`: +0 DC
  - `Unstable`: +1 DC
  - `Swaying`: +2 DC

- **`SurfaceCondition`**: Surface conditions
  - `Dry`: +0 DC
  - `Wet`: +1 DC
  - `Icy`: +2 DC

#### Value Objects
- **`BalanceSurface`**: Surface properties
  - Width, stability, condition
  - Length and height
  - DC calculation properties
  - Factory methods for common surfaces

- **`BalanceContext`**: Check modifiers
  - Surface + environmental modifiers
  - Wind and encumbrance
  - Balance pole support
  - Long traverse tracking

- **`BalanceCheckResult`**: Outcome capture
  - Success/failure state
  - Stamina costs
  - Fall trigger info
  - Narrative generation

### Application Layer

#### Interfaces
- **`IBalanceService`**: Balance operations contract
  - `AttemptBalance()`: Perform check
  - `CreateContext()`: Build context
  - `CalculateDc()`: DC calculation
  - `GetWidthCategory()`: Inch to category
  - `RequiresBalanceCheck()`: Threshold check

#### Services
- **`BalanceService`**: Full implementation
  - Width-based DC calculation
  - Stability, condition, wind modifiers
  - Dice integration
  - Comprehensive logging

### Configuration

- **`config/balance-surfaces.json`**: Data-driven configuration
  - Width categories and DCs
  - Stability/condition modifiers
  - Environmental modifiers
  - Outcome definitions

- **`config/schemas/balance-surfaces.schema.json`**: JSON Schema validation

---

## Mechanics

### Width-Based DC
```
WIDE (2+ ft)      → DC 2 successes
NARROW (~1 ft)    → DC 3 successes
CABLE (~6 in)     → DC 4 successes
RAZOR EDGE (<6in) → DC 5 successes
```

### Modifier Stacking
```
Final DC = Base DC (from width)
         + Stability Modifier (0-2)
         + Condition Modifier (0-2)
         + Wind Modifier (0-2)
         + Encumbrance Modifier (0-2)
         - Balance Pole (-1)
```

### Outcome Table
| Outcome | Margin | Stamina | Result |
|---------|--------|---------|--------|
| Critical | +5 | 0 | Cross with grace |
| Exceptional | +3-4 | 1 | Confident crossing |
| Full Success | +1-2 | 1 | Safe crossing |
| Marginal | 0 | 2 | Wobbling but safe |
| Failure | <0 | 0 | Fall |
| Fumble | 0+botch | 0 | Fall + disorientation |

---

## Testing

Added 39 unit tests in `BalanceServiceTests`:
- Width DC tests (5 tests)
- Width category tests (5 tests)
- Modifier tests (6 tests)
- DC calculation tests (7 tests)
- Balance check requirement tests (3 tests)
- Balance attempt tests (5 tests)
- BalanceSurface value object tests (4 tests)
- BalanceContext value object tests (3 tests)
- BalanceCheckResult value object tests (2 tests)

---

## Files Changed

### Added
- `src/Core/RuneAndRust.Domain/Enums/BalanceWidth.cs`
- `src/Core/RuneAndRust.Domain/Enums/SurfaceStability.cs`
- `src/Core/RuneAndRust.Domain/Enums/SurfaceCondition.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/BalanceSurface.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/BalanceContext.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/BalanceCheckResult.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IBalanceService.cs`
- `src/Core/RuneAndRust.Application/Services/BalanceService.cs`
- `config/balance-surfaces.json`
- `config/schemas/balance-surfaces.schema.json`
- `tests/RuneAndRust.Application.UnitTests/Services/BalanceServiceTests.cs`
- `changelogs/v0.15.2f-changelog.md`

---

## Breaking Changes

None.

---

## Migration Guide

No migration required. Balance service is opt-in via dependency injection.
