# v0.0.4a Design Specification: Archetype & Class Foundations

## Overview

**Version:** 0.0.4a
**Status:** Implemented
**Focus:** Establish the data-driven class hierarchy with archetypes and specializations
**Prerequisites:** v0.0.3 (Player Creation & Identity)
**Estimated Unit Tests:** ~25

---

## Table of Contents

1. [User Stories](#user-stories)
2. [Architecture](#architecture)
3. [Data Models](#data-models)
4. [Configuration Schemas](#configuration-schemas)
5. [Service Specifications](#service-specifications)
6. [Character Creation Flow](#character-creation-flow)
7. [Code Examples](#code-examples)
8. [Logging Requirements](#logging-requirements)
9. [Unit Test Specifications](#unit-test-specifications)
10. [Acceptance Criteria](#acceptance-criteria)
11. [Documentation Requirements](#documentation-requirements)
12. [Deliverable Checklist](#deliverable-checklist)

---

## User Stories

### US-4a-1: View Available Archetypes
**As a** player creating a new character
**I want to** see all available archetypes with descriptions
**So that** I can understand the base class types before choosing

**Acceptance Criteria:**
- Display archetype name, description, and playstyle summary
- Show which classes derive from each archetype
- Indicate stat tendencies (offensive, defensive, balanced, support)

### US-4a-2: View Available Classes
**As a** player creating a new character
**I want to** see all classes available for my chosen archetype
**So that** I can pick a specialization that fits my playstyle

**Acceptance Criteria:**
- Display class name, description, and unique features
- Show base stat modifiers
- Show stat growth rates per level
- Indicate primary resource type (preview for v0.0.4b)

### US-4a-3: Select a Class
**As a** player creating a new character
**I want to** select a class during character creation
**So that** my character has a defined role and abilities

**Acceptance Criteria:**
- Class selection step appears after race/background selection
- Player can navigate back to change selection
- Selected class applies stat modifiers to base stats
- Character summary shows chosen class

### US-4a-4: Class Requirements
**As a** game designer
**I want to** define prerequisites for certain classes
**So that** some classes require specific races or minimum stats

**Acceptance Criteria:**
- Classes can require specific race(s)
- Classes can require minimum attribute values
- Unmet requirements show clear explanation
- Requirements are optional (most classes have none)

### US-4a-5: View Class in Status
**As a** player during gameplay
**I want to** see my class displayed in my status
**So that** I can reference my character's role

**Acceptance Criteria:**
- Status command shows archetype and class
- Class-modified stats are displayed (not base stats)

---

## Architecture

### Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         PRESENTATION LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌────────────────┐  │
│  │ ArchetypeSelectView │  │  ClassSelectView    │  │  StatusView    │  │
│  │                     │  │                     │  │  (updated)     │  │
│  │ - DisplayArchetypes │  │ - DisplayClasses    │  │                │  │
│  │ - HandleSelection   │  │ - HandleSelection   │  │ - ShowClass    │  │
│  └─────────┬───────────┘  └─────────┬───────────┘  └───────┬────────┘  │
│            │                        │                      │           │
└────────────┼────────────────────────┼──────────────────────┼───────────┘
             │                        │                      │
             ▼                        ▼                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                        ClassService                              │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + GetAllArchetypes() : IReadOnlyList<ArchetypeDto>              │   │
│  │ + GetArchetype(id) : ArchetypeDto?                              │   │
│  │ + GetClassesForArchetype(archetypeId) : IReadOnlyList<ClassDto> │   │
│  │ + GetAllClasses() : IReadOnlyList<ClassDto>                     │   │
│  │ + GetClass(id) : ClassDto?                                      │   │
│  │ + ValidateClassRequirements(classId, player) : ValidationResult │   │
│  │ + ApplyClassToPlayer(classId, player) : void                    │   │
│  │ + CalculateModifiedStats(baseStats, classId) : Stats            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DOMAIN LAYER                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ENTITIES                                                               │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │  ArchetypeDefinition   │  │    ClassDefinition     │                │
│  ├────────────────────────┤  ├────────────────────────┤                │
│  │ + Id: string           │  │ + Id: string           │                │
│  │ + Name: string         │  │ + Name: string         │                │
│  │ + Description: string  │  │ + Description: string  │                │
│  │ + PlaystyleSummary: str│  │ + ArchetypeId: string  │                │
│  │ + StatTendency: enum   │  │ + StatModifiers: Stats │                │
│  └────────────────────────┘  │ + GrowthRates: Stats   │                │
│                              │ + Requirements: ClassReq│                │
│                              │ + PrimaryResourceId: str│                │
│                              │ + StartingAbilityIds: []│                │
│                              └────────────────────────┘                │
│                                                                         │
│  VALUE OBJECTS                                                          │
│  ┌────────────────────────┐  ┌────────────────────────┐                │
│  │   ClassRequirements    │  │    StatModifiers       │                │
│  ├────────────────────────┤  ├────────────────────────┤                │
│  │ + AllowedRaceIds: []   │  │ + MaxHealth: int       │                │
│  │ + MinimumAttributes:   │  │ + Attack: int          │                │
│  │   Dictionary<str,int>  │  │ + Defense: int         │                │
│  └────────────────────────┘  │ + Might: int           │                │
│                              │ + Fortitude: int       │                │
│                              │ + Will: int            │                │
│                              │ + Wits: int            │                │
│                              │ + Finesse: int         │                │
│                              └────────────────────────┘                │
│                                                                         │
│  PLAYER UPDATES                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                          Player                                  │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + ArchetypeId: string        // NEW                             │   │
│  │ + ClassId: string            // NEW                             │   │
│  │ + SetClass(archetypeId, classId): void  // NEW                  │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                             │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                   ConfigurationLoader                            │   │
│  ├─────────────────────────────────────────────────────────────────┤   │
│  │ + LoadArchetypes(path) : IReadOnlyList<ArchetypeDefinition>     │   │
│  │ + LoadClasses(path) : IReadOnlyList<ClassDefinition>            │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
│  Configuration Files:                                                   │
│  ├── config/archetypes.json                                            │
│  └── config/classes.json                                               │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### Class Hierarchy Diagram

```
                    ┌─────────────────┐
                    │   ARCHETYPES    │
                    └────────┬────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
        ▼                    ▼                    ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│    WARRIOR    │   │  SKIRMISHER   │   │    MYSTIC     │
│               │   │               │   │               │
│ Stat Tendency:│   │ Stat Tendency:│   │ Stat Tendency:│
│  Defensive    │   │  Offensive    │   │  Offensive/   │
│               │   │               │   │  Support      │
└───────┬───────┘   └───────┬───────┘   └───────┬───────┘
        │                   │                   │
        ▼                   ▼                   ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│ SHIELDMAIDEN  │   │ SHADOW-WALKER │   │ GALDR-CASTER  │
│               │   │               │   │               │
│ +HP, +DEF     │   │ +ATK, +FIN    │   │ +ATK, +WILL   │
│ -ATK          │   │ -HP, -DEF     │   │ -HP, -DEF     │
│               │   │               │   │               │
│ Resource:     │   │ Resource:     │   │ Resource:     │
│   Rage        │   │   Energy      │   │   Mana        │
└───────────────┘   └───────────────┘   └───────────────┘

        ┌───────────────┐               ┌───────────────┐
        │     ADEPT     │               │  BLOOD-PRIEST │
        │               │               │  (from Mystic)│
        │ Stat Tendency:│               │               │
        │  Balanced     │               │ +HP, +WILL    │
        └───────┬───────┘               │ -ATK          │
                │                       │               │
                ▼                       │ Resource:     │
        ┌───────────────┐               │   Faith       │
        │ SCRAP-TINKER  │               └───────────────┘
        │               │
        │ +WITS, +FIN   │
        │ Balanced      │
        │               │
        │ Resource:     │
        │   Focus       │
        └───────────────┘
```

---

## Data Models

### ArchetypeDefinition Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a base class archetype from which specialized classes derive.
/// </summary>
/// <remarks>
/// Archetypes define the fundamental playstyle category (Warrior, Mystic, etc.)
/// and serve as a grouping mechanism for related classes. They are loaded
/// from configuration and should not be instantiated directly.
/// </remarks>
public class ArchetypeDefinition : IEntity
{
    /// <summary>
    /// Gets the unique identifier for this archetype.
    /// </summary>
    /// <example>"warrior", "mystic", "skirmisher", "adept"</example>
    public string Id { get; private set; }

    /// <summary>
    /// Gets the display name of this archetype.
    /// </summary>
    /// <example>"Warrior", "Mystic"</example>
    public string Name { get; private set; }

    /// <summary>
    /// Gets the detailed description of this archetype.
    /// </summary>
    public string Description { get; private set; }

    /// <summary>
    /// Gets a brief summary of the archetype's playstyle.
    /// </summary>
    /// <example>"Masters of martial combat who thrive on the front lines."</example>
    public string PlaystyleSummary { get; private set; }

    /// <summary>
    /// Gets the general stat tendency for classes in this archetype.
    /// </summary>
    public StatTendency StatTendency { get; private set; }

    /// <summary>
    /// Private constructor for EF Core.
    /// </summary>
    private ArchetypeDefinition()
    {
        Id = null!;
        Name = null!;
        Description = null!;
        PlaystyleSummary = null!;
    }

    /// <summary>
    /// Creates a new archetype definition.
    /// </summary>
    public static ArchetypeDefinition Create(
        string id,
        string name,
        string description,
        string playstyleSummary,
        StatTendency statTendency)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);

        return new ArchetypeDefinition
        {
            Id = id.ToLowerInvariant(),
            Name = name,
            Description = description,
            PlaystyleSummary = playstyleSummary,
            StatTendency = statTendency
        };
    }
}

/// <summary>
/// Indicates the general stat focus of an archetype or class.
/// </summary>
public enum StatTendency
{
    /// <summary>High attack, low defense.</summary>
    Offensive,

    /// <summary>High defense, lower attack.</summary>
    Defensive,

    /// <summary>No strong bias in either direction.</summary>
    Balanced,

    /// <summary>Focus on supporting allies (healing, buffs).</summary>
    Support
}
```

### ClassDefinition Entity

```csharp
namespace RuneAndRust.Domain.Entities;

/// <summary>
/// Represents a specialized player class derived from an archetype.
/// </summary>
/// <remarks>
/// Classes define specific stat modifiers, growth rates, resource types,
/// and starting abilities. They are loaded from configuration and should
/// not be instantiated directly.
/// </remarks>
public class ClassDefinition : IEntity
{
    /// <summary>
    /// Gets the unique identifier for this class.
    /// </summary>
    /// <example>"shieldmaiden", "galdr-caster", "shadow-walker"</example>
    public string Id { get; private set; }

    /// <summary>
    /// Gets the display name of this class.
    /// </summary>
    public string Name { get; private set; }

    /// <summary>
    /// Gets the detailed description of this class.
    /// </summary>
    public string Description { get; private set; }

    /// <summary>
    /// Gets the ID of the archetype this class belongs to.
    /// </summary>
    public string ArchetypeId { get; private set; }

    /// <summary>
    /// Gets the stat modifiers applied when selecting this class.
    /// </summary>
    /// <remarks>
    /// These modifiers are added to the player's base stats.
    /// Can be positive or negative.
    /// </remarks>
    public StatModifiers StatModifiers { get; private set; }

    /// <summary>
    /// Gets the stat growth rates per level for this class.
    /// </summary>
    /// <remarks>
    /// These values determine how much each stat increases on level up.
    /// Used in v0.0.8 (Experience & Leveling).
    /// </remarks>
    public StatModifiers GrowthRates { get; private set; }

    /// <summary>
    /// Gets the requirements to select this class.
    /// </summary>
    /// <remarks>
    /// Null or empty requirements mean any character can select this class.
    /// </remarks>
    public ClassRequirements? Requirements { get; private set; }

    /// <summary>
    /// Gets the ID of the primary resource type for this class.
    /// </summary>
    /// <remarks>
    /// References a ResourceTypeDefinition from v0.0.4b.
    /// Example: "mana", "rage", "energy", "faith", "focus"
    /// </remarks>
    public string PrimaryResourceId { get; private set; }

    /// <summary>
    /// Gets the IDs of abilities this class starts with.
    /// </summary>
    /// <remarks>
    /// References AbilityDefinitions from v0.0.4c.
    /// </remarks>
    public IReadOnlyList<string> StartingAbilityIds { get; private set; }

    /// <summary>
    /// Private constructor for EF Core.
    /// </summary>
    private ClassDefinition()
    {
        Id = null!;
        Name = null!;
        Description = null!;
        ArchetypeId = null!;
        PrimaryResourceId = null!;
        StartingAbilityIds = Array.Empty<string>();
    }

    /// <summary>
    /// Creates a new class definition.
    /// </summary>
    public static ClassDefinition Create(
        string id,
        string name,
        string description,
        string archetypeId,
        StatModifiers statModifiers,
        StatModifiers growthRates,
        string primaryResourceId,
        IEnumerable<string>? startingAbilityIds = null,
        ClassRequirements? requirements = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentException.ThrowIfNullOrWhiteSpace(archetypeId);
        ArgumentException.ThrowIfNullOrWhiteSpace(primaryResourceId);

        return new ClassDefinition
        {
            Id = id.ToLowerInvariant(),
            Name = name,
            Description = description,
            ArchetypeId = archetypeId.ToLowerInvariant(),
            StatModifiers = statModifiers,
            GrowthRates = growthRates,
            PrimaryResourceId = primaryResourceId.ToLowerInvariant(),
            StartingAbilityIds = startingAbilityIds?.ToList() ?? new List<string>(),
            Requirements = requirements
        };
    }
}
```

### StatModifiers Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents stat modifications that can be applied to a character.
/// </summary>
/// <remarks>
/// Used for class bonuses, equipment bonuses, buff effects, etc.
/// Values can be positive (bonuses) or negative (penalties).
/// </remarks>
public readonly record struct StatModifiers
{
    /// <summary>Maximum health modifier.</summary>
    public int MaxHealth { get; init; }

    /// <summary>Attack power modifier.</summary>
    public int Attack { get; init; }

    /// <summary>Defense modifier.</summary>
    public int Defense { get; init; }

    /// <summary>Might attribute modifier.</summary>
    public int Might { get; init; }

    /// <summary>Fortitude attribute modifier.</summary>
    public int Fortitude { get; init; }

    /// <summary>Will attribute modifier.</summary>
    public int Will { get; init; }

    /// <summary>Wits attribute modifier.</summary>
    public int Wits { get; init; }

    /// <summary>Finesse attribute modifier.</summary>
    public int Finesse { get; init; }

    /// <summary>
    /// Gets a StatModifiers instance with all values set to zero.
    /// </summary>
    public static StatModifiers None => new();

    /// <summary>
    /// Applies these modifiers to a base Stats value.
    /// </summary>
    /// <param name="baseStats">The base stats to modify.</param>
    /// <returns>A new Stats instance with modifiers applied.</returns>
    public Stats ApplyTo(Stats baseStats)
    {
        return new Stats(
            maxHealth: Math.Max(1, baseStats.MaxHealth + MaxHealth),
            attack: Math.Max(0, baseStats.Attack + Attack),
            defense: Math.Max(0, baseStats.Defense + Defense)
        );
    }

    /// <summary>
    /// Combines two StatModifiers by adding their values.
    /// </summary>
    public static StatModifiers operator +(StatModifiers a, StatModifiers b)
    {
        return new StatModifiers
        {
            MaxHealth = a.MaxHealth + b.MaxHealth,
            Attack = a.Attack + b.Attack,
            Defense = a.Defense + b.Defense,
            Might = a.Might + b.Might,
            Fortitude = a.Fortitude + b.Fortitude,
            Will = a.Will + b.Will,
            Wits = a.Wits + b.Wits,
            Finesse = a.Finesse + b.Finesse
        };
    }
}
```

### ClassRequirements Value Object

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the prerequisites required to select a class.
/// </summary>
public readonly record struct ClassRequirements
{
    /// <summary>
    /// Gets the race IDs that can select this class.
    /// </summary>
    /// <remarks>
    /// Empty or null means all races are allowed.
    /// </remarks>
    public IReadOnlyList<string>? AllowedRaceIds { get; init; }

    /// <summary>
    /// Gets the minimum attribute values required.
    /// </summary>
    /// <remarks>
    /// Key is attribute ID (e.g., "might"), value is minimum required.
    /// Empty or null means no attribute requirements.
    /// </remarks>
    public IReadOnlyDictionary<string, int>? MinimumAttributes { get; init; }

    /// <summary>
    /// Gets whether this requirements object has any actual requirements.
    /// </summary>
    public bool HasRequirements =>
        (AllowedRaceIds?.Count > 0) ||
        (MinimumAttributes?.Count > 0);

    /// <summary>
    /// Validates whether a player meets these requirements.
    /// </summary>
    /// <param name="raceId">The player's race ID.</param>
    /// <param name="attributes">The player's attribute values.</param>
    /// <returns>A validation result indicating success or failure reasons.</returns>
    public ClassRequirementValidation Validate(
        string raceId,
        IReadOnlyDictionary<string, int> attributes)
    {
        var failures = new List<string>();

        // Check race requirement
        if (AllowedRaceIds?.Count > 0 &&
            !AllowedRaceIds.Contains(raceId, StringComparer.OrdinalIgnoreCase))
        {
            failures.Add($"Requires race: {string.Join(" or ", AllowedRaceIds)}");
        }

        // Check attribute requirements
        if (MinimumAttributes?.Count > 0)
        {
            foreach (var (attrId, minValue) in MinimumAttributes)
            {
                if (!attributes.TryGetValue(attrId, out var playerValue) ||
                    playerValue < minValue)
                {
                    failures.Add($"Requires {attrId} >= {minValue}");
                }
            }
        }

        return new ClassRequirementValidation(failures.Count == 0, failures);
    }
}

/// <summary>
/// Result of validating class requirements.
/// </summary>
/// <param name="IsValid">Whether all requirements are met.</param>
/// <param name="FailureReasons">List of unmet requirements (empty if valid).</param>
public record ClassRequirementValidation(
    bool IsValid,
    IReadOnlyList<string> FailureReasons);
```

### Player Entity Updates

```csharp
// Additions to existing Player class

/// <summary>
/// Gets the ID of the player's archetype.
/// </summary>
/// <remarks>
/// Set during character creation when a class is selected.
/// </remarks>
public string? ArchetypeId { get; private set; }

/// <summary>
/// Gets the ID of the player's class.
/// </summary>
/// <remarks>
/// Set during character creation. Determines resource type and abilities.
/// </remarks>
public string? ClassId { get; private set; }

/// <summary>
/// Sets the player's class and archetype.
/// </summary>
/// <param name="archetypeId">The archetype ID.</param>
/// <param name="classId">The class ID.</param>
/// <exception cref="ArgumentException">Thrown if IDs are null or empty.</exception>
public void SetClass(string archetypeId, string classId)
{
    ArgumentException.ThrowIfNullOrWhiteSpace(archetypeId);
    ArgumentException.ThrowIfNullOrWhiteSpace(classId);

    ArchetypeId = archetypeId.ToLowerInvariant();
    ClassId = classId.ToLowerInvariant();
}

/// <summary>
/// Gets whether the player has selected a class.
/// </summary>
public bool HasClass => !string.IsNullOrEmpty(ClassId);
```

---

## Configuration Schemas

### archetypes.json

```json
{
  "$schema": "archetypes.schema.json",
  "archetypes": [
    {
      "id": "warrior",
      "name": "Warrior",
      "description": "Warriors are masters of martial combat, trained in the art of weapons and armor. They excel at direct confrontation, using their strength and endurance to overpower foes.",
      "playstyleSummary": "Frontline fighter with high survivability",
      "statTendency": "defensive"
    },
    {
      "id": "skirmisher",
      "name": "Skirmisher",
      "description": "Skirmishers are agile combatants who rely on speed, precision, and cunning rather than brute force. They strike from the shadows and exploit enemy weaknesses.",
      "playstyleSummary": "High damage dealer with mobility focus",
      "statTendency": "offensive"
    },
    {
      "id": "adept",
      "name": "Adept",
      "description": "Adepts are versatile individuals who have honed practical skills and technical knowledge. They solve problems through ingenuity and resourcefulness.",
      "playstyleSummary": "Versatile utility class with gadgets and tricks",
      "statTendency": "balanced"
    },
    {
      "id": "mystic",
      "name": "Mystic",
      "description": "Mystics channel supernatural forces, whether arcane magic, divine power, or primal energies. They wield abilities beyond the reach of mundane warriors.",
      "playstyleSummary": "Spellcaster with powerful abilities",
      "statTendency": "offensive"
    }
  ]
}
```

### classes.json

```json
{
  "$schema": "classes.schema.json",
  "classes": [
    {
      "id": "shieldmaiden",
      "name": "Shieldmaiden",
      "description": "Shieldmaidens are stalwart defenders who stand between their allies and danger. They wield heavy shields and armor, absorbing punishment that would fell lesser warriors. Their fury builds in battle, unleashing devastating counterattacks.",
      "archetypeId": "warrior",
      "statModifiers": {
        "maxHealth": 20,
        "attack": -2,
        "defense": 5,
        "might": 2,
        "fortitude": 3,
        "will": 0,
        "wits": -1,
        "finesse": -2
      },
      "growthRates": {
        "maxHealth": 12,
        "attack": 2,
        "defense": 3,
        "might": 2,
        "fortitude": 2,
        "will": 1,
        "wits": 1,
        "finesse": 1
      },
      "primaryResourceId": "rage",
      "startingAbilityIds": ["shield-bash", "taunt"],
      "requirements": null
    },
    {
      "id": "shadow-walker",
      "name": "Shadow-Walker",
      "description": "Shadow-Walkers are deadly assassins who strike from darkness. They excel at finding weak points and delivering devastating single attacks. Quick and elusive, they avoid direct confrontation in favor of precision strikes.",
      "archetypeId": "skirmisher",
      "statModifiers": {
        "maxHealth": -10,
        "attack": 5,
        "defense": -2,
        "might": -1,
        "fortitude": -1,
        "will": 0,
        "wits": 2,
        "finesse": 4
      },
      "growthRates": {
        "maxHealth": 6,
        "attack": 4,
        "defense": 1,
        "might": 1,
        "fortitude": 1,
        "will": 1,
        "wits": 2,
        "finesse": 3
      },
      "primaryResourceId": "energy",
      "startingAbilityIds": ["backstab", "shadowstep"],
      "requirements": null
    },
    {
      "id": "scrap-tinker",
      "name": "Scrap-Tinker",
      "description": "Scrap-Tinkers are ingenious inventors who create gadgets and contraptions from salvaged materials. They deploy turrets, traps, and devices to control the battlefield, making up for combat limitations with clever engineering.",
      "archetypeId": "adept",
      "statModifiers": {
        "maxHealth": 0,
        "attack": 0,
        "defense": 0,
        "might": -1,
        "fortitude": 0,
        "will": 1,
        "wits": 4,
        "finesse": 2
      },
      "growthRates": {
        "maxHealth": 8,
        "attack": 2,
        "defense": 2,
        "might": 1,
        "fortitude": 1,
        "will": 2,
        "wits": 3,
        "finesse": 2
      },
      "primaryResourceId": "focus",
      "startingAbilityIds": ["deploy-turret", "repair-kit"],
      "requirements": null
    },
    {
      "id": "galdr-caster",
      "name": "Galdr-Caster",
      "description": "Galdr-Casters wield the power of runic magic, channeling arcane energies through ancient incantations. They command devastating offensive spells but are physically frail, requiring protection from direct combat.",
      "archetypeId": "mystic",
      "statModifiers": {
        "maxHealth": -15,
        "attack": 8,
        "defense": -3,
        "might": -2,
        "fortitude": -2,
        "will": 5,
        "wits": 3,
        "finesse": 0
      },
      "growthRates": {
        "maxHealth": 5,
        "attack": 5,
        "defense": 1,
        "might": 1,
        "fortitude": 1,
        "will": 4,
        "wits": 2,
        "finesse": 1
      },
      "primaryResourceId": "mana",
      "startingAbilityIds": ["flame-bolt", "arcane-shield"],
      "requirements": null
    },
    {
      "id": "blood-priest",
      "name": "Blood-Priest",
      "description": "Blood-Priests serve dark powers, channeling divine energy through sacrifice and devotion. They can heal allies or smite enemies, drawing power from acts of faith. Their magic comes at a cost, but their versatility is unmatched.",
      "archetypeId": "mystic",
      "statModifiers": {
        "maxHealth": 5,
        "attack": 2,
        "defense": 0,
        "might": 0,
        "fortitude": 1,
        "will": 4,
        "wits": 1,
        "finesse": -1
      },
      "growthRates": {
        "maxHealth": 8,
        "attack": 2,
        "defense": 2,
        "might": 1,
        "fortitude": 2,
        "will": 3,
        "wits": 2,
        "finesse": 1
      },
      "primaryResourceId": "faith",
      "startingAbilityIds": ["healing-word", "smite"],
      "requirements": null
    }
  ]
}
```

### JSON Schema: archetypes.schema.json

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Archetypes Configuration",
  "type": "object",
  "required": ["archetypes"],
  "properties": {
    "archetypes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "name", "description", "playstyleSummary", "statTendency"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$",
            "description": "Unique identifier (lowercase, alphanumeric with hyphens)"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "description": "Display name"
          },
          "description": {
            "type": "string",
            "minLength": 10,
            "description": "Detailed description"
          },
          "playstyleSummary": {
            "type": "string",
            "minLength": 1,
            "description": "Brief playstyle summary"
          },
          "statTendency": {
            "type": "string",
            "enum": ["offensive", "defensive", "balanced", "support"],
            "description": "General stat focus"
          }
        }
      }
    }
  }
}
```

### JSON Schema: classes.schema.json

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Classes Configuration",
  "type": "object",
  "required": ["classes"],
  "properties": {
    "classes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "name", "description", "archetypeId", "statModifiers", "growthRates", "primaryResourceId"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9-]*$"
          },
          "name": { "type": "string", "minLength": 1 },
          "description": { "type": "string", "minLength": 10 },
          "archetypeId": { "type": "string", "pattern": "^[a-z][a-z0-9-]*$" },
          "statModifiers": { "$ref": "#/definitions/statModifiers" },
          "growthRates": { "$ref": "#/definitions/statModifiers" },
          "primaryResourceId": { "type": "string" },
          "startingAbilityIds": {
            "type": "array",
            "items": { "type": "string" }
          },
          "requirements": { "$ref": "#/definitions/classRequirements" }
        }
      }
    }
  },
  "definitions": {
    "statModifiers": {
      "type": "object",
      "properties": {
        "maxHealth": { "type": "integer" },
        "attack": { "type": "integer" },
        "defense": { "type": "integer" },
        "might": { "type": "integer" },
        "fortitude": { "type": "integer" },
        "will": { "type": "integer" },
        "wits": { "type": "integer" },
        "finesse": { "type": "integer" }
      }
    },
    "classRequirements": {
      "type": ["object", "null"],
      "properties": {
        "allowedRaceIds": {
          "type": "array",
          "items": { "type": "string" }
        },
        "minimumAttributes": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        }
      }
    }
  }
}
```

---

## Service Specifications

### ClassService

```csharp
namespace RuneAndRust.Application.Services;

/// <summary>
/// Provides operations for archetype and class management.
/// </summary>
public class ClassService
{
    private readonly IReadOnlyList<ArchetypeDefinition> _archetypes;
    private readonly IReadOnlyList<ClassDefinition> _classes;
    private readonly ILogger<ClassService> _logger;

    public ClassService(
        IConfigurationLoader configLoader,
        ILogger<ClassService> logger)
    {
        _logger = logger;
        _archetypes = configLoader.LoadArchetypes("config/archetypes.json");
        _classes = configLoader.LoadClasses("config/classes.json");

        _logger.LogInformation(
            "ClassService initialized with {ArchetypeCount} archetypes and {ClassCount} classes",
            _archetypes.Count,
            _classes.Count);
    }

    /// <summary>
    /// Gets all available archetypes.
    /// </summary>
    public IReadOnlyList<ArchetypeDto> GetAllArchetypes()
    {
        _logger.LogDebug("GetAllArchetypes called");
        return _archetypes.Select(a => a.ToDto()).ToList();
    }

    /// <summary>
    /// Gets a specific archetype by ID.
    /// </summary>
    public ArchetypeDto? GetArchetype(string id)
    {
        _logger.LogDebug("GetArchetype called for ID: {ArchetypeId}", id);
        var archetype = _archetypes.FirstOrDefault(
            a => a.Id.Equals(id, StringComparison.OrdinalIgnoreCase));
        return archetype?.ToDto();
    }

    /// <summary>
    /// Gets all classes for a specific archetype.
    /// </summary>
    public IReadOnlyList<ClassDto> GetClassesForArchetype(string archetypeId)
    {
        _logger.LogDebug("GetClassesForArchetype called for: {ArchetypeId}", archetypeId);
        return _classes
            .Where(c => c.ArchetypeId.Equals(archetypeId, StringComparison.OrdinalIgnoreCase))
            .Select(c => c.ToDto())
            .ToList();
    }

    /// <summary>
    /// Gets all available classes.
    /// </summary>
    public IReadOnlyList<ClassDto> GetAllClasses()
    {
        _logger.LogDebug("GetAllClasses called");
        return _classes.Select(c => c.ToDto()).ToList();
    }

    /// <summary>
    /// Gets a specific class by ID.
    /// </summary>
    public ClassDto? GetClass(string id)
    {
        _logger.LogDebug("GetClass called for ID: {ClassId}", id);
        var classDef = _classes.FirstOrDefault(
            c => c.Id.Equals(id, StringComparison.OrdinalIgnoreCase));
        return classDef?.ToDto();
    }

    /// <summary>
    /// Validates whether a player meets the requirements for a class.
    /// </summary>
    public ClassRequirementValidation ValidateClassRequirements(
        string classId,
        string raceId,
        IReadOnlyDictionary<string, int> attributes)
    {
        _logger.LogDebug(
            "ValidateClassRequirements for Class: {ClassId}, Race: {RaceId}",
            classId, raceId);

        var classDef = _classes.FirstOrDefault(
            c => c.Id.Equals(classId, StringComparison.OrdinalIgnoreCase));

        if (classDef == null)
        {
            _logger.LogWarning("Class not found: {ClassId}", classId);
            return new ClassRequirementValidation(false, new[] { "Class not found" });
        }

        if (classDef.Requirements == null || !classDef.Requirements.Value.HasRequirements)
        {
            _logger.LogDebug("Class {ClassId} has no requirements", classId);
            return new ClassRequirementValidation(true, Array.Empty<string>());
        }

        var result = classDef.Requirements.Value.Validate(raceId, attributes);

        if (!result.IsValid)
        {
            _logger.LogInformation(
                "Class requirements not met for {ClassId}: {Reasons}",
                classId, string.Join(", ", result.FailureReasons));
        }

        return result;
    }

    /// <summary>
    /// Applies a class to a player, setting archetype/class IDs and applying stat modifiers.
    /// </summary>
    public void ApplyClassToPlayer(string classId, Player player)
    {
        _logger.LogDebug(
            "ApplyClassToPlayer for Class: {ClassId}, Player: {PlayerName}",
            classId, player.Name);

        var classDef = _classes.FirstOrDefault(
            c => c.Id.Equals(classId, StringComparison.OrdinalIgnoreCase))
            ?? throw new ArgumentException($"Class not found: {classId}", nameof(classId));

        player.SetClass(classDef.ArchetypeId, classDef.Id);

        var modifiedStats = classDef.StatModifiers.ApplyTo(player.Stats);
        player.SetStats(modifiedStats);

        _logger.LogInformation(
            "Applied class {ClassName} to {PlayerName}. " +
            "Stats: HP {OldHP}->{NewHP}, ATK {OldATK}->{NewATK}, DEF {OldDEF}->{NewDEF}",
            classDef.Name, player.Name,
            player.Stats.MaxHealth - classDef.StatModifiers.MaxHealth, player.Stats.MaxHealth,
            player.Stats.Attack - classDef.StatModifiers.Attack, player.Stats.Attack,
            player.Stats.Defense - classDef.StatModifiers.Defense, player.Stats.Defense);
    }

    /// <summary>
    /// Calculates what stats would be after applying a class (for preview).
    /// </summary>
    public Stats CalculateModifiedStats(Stats baseStats, string classId)
    {
        var classDef = _classes.FirstOrDefault(
            c => c.Id.Equals(classId, StringComparison.OrdinalIgnoreCase));

        if (classDef == null)
            return baseStats;

        return classDef.StatModifiers.ApplyTo(baseStats);
    }
}
```

---

## Character Creation Flow

### Updated Character Creation Wizard

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    CHARACTER CREATION WIZARD                            │
│                        (Updated for v0.0.4a)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  Step 1: Name                                                           │
│     │    (from v0.0.3)                                                  │
│     ▼                                                                   │
│  Step 2: Race Selection                                                 │
│     │    (from v0.0.3)                                                  │
│     ▼                                                                   │
│  Step 3: Background/Lineage                                             │
│     │    (from v0.0.3)                                                  │
│     ▼                                                                   │
│  Step 4: Attributes (Point-Buy)                                         │
│     │    (from v0.0.3)                                                  │
│     ▼                                                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Step 5: ARCHETYPE SELECTION (NEW)                               │   │
│  │                                                                  │   │
│  │   Choose your path:                                              │   │
│  │                                                                  │   │
│  │   [1] Warrior    - Frontline fighter with high survivability    │   │
│  │   [2] Skirmisher - High damage dealer with mobility focus       │   │
│  │   [3] Adept      - Versatile utility class with gadgets         │   │
│  │   [4] Mystic     - Spellcaster with powerful abilities          │   │
│  │                                                                  │   │
│  │   > 1                                                            │   │
│  └──────────────────────────────────┬──────────────────────────────┘   │
│                                     │                                   │
│                                     ▼                                   │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ Step 6: CLASS SELECTION (NEW)                                   │   │
│  │                                                                  │   │
│  │   Warrior Classes:                                               │   │
│  │                                                                  │   │
│  │   [1] Shieldmaiden                                               │   │
│  │       Stalwart defender who absorbs punishment                   │   │
│  │       HP: +20  ATK: -2  DEF: +5                                  │   │
│  │       Resource: Rage (builds in combat)                          │   │
│  │                                                                  │   │
│  │   > 1                                                            │   │
│  └──────────────────────────────────┬──────────────────────────────┘   │
│                                     │                                   │
│                                     ▼                                   │
│  Step 7: Description                                                    │
│     │    (from v0.0.3)                                                  │
│     ▼                                                                   │
│  Step 8: Character Summary                                              │
│          (updated to show class)                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### TUI Mockups

#### Archetype Selection View

```
╔════════════════════════════════════════════════════════════════════════╗
║                         CHOOSE YOUR PATH                               ║
╠════════════════════════════════════════════════════════════════════════╣
║                                                                        ║
║  Your archetype determines your fundamental approach to challenges.    ║
║                                                                        ║
║  ┌────────────────────────────────────────────────────────────────┐   ║
║  │ [1] WARRIOR                                        [Defensive] │   ║
║  │     Masters of martial combat who thrive on the front lines.   │   ║
║  │     Classes: Shieldmaiden                                      │   ║
║  └────────────────────────────────────────────────────────────────┘   ║
║                                                                        ║
║  ┌────────────────────────────────────────────────────────────────┐   ║
║  │ [2] SKIRMISHER                                     [Offensive] │   ║
║  │     Agile combatants who strike from the shadows.              │   ║
║  │     Classes: Shadow-Walker                                     │   ║
║  └────────────────────────────────────────────────────────────────┘   ║
║                                                                        ║
║  ┌────────────────────────────────────────────────────────────────┐   ║
║  │ [3] ADEPT                                           [Balanced] │   ║
║  │     Versatile problem-solvers with practical skills.           │   ║
║  │     Classes: Scrap-Tinker                                      │   ║
║  └────────────────────────────────────────────────────────────────┘   ║
║                                                                        ║
║  ┌────────────────────────────────────────────────────────────────┐   ║
║  │ [4] MYSTIC                                         [Offensive] │   ║
║  │     Wielders of supernatural forces and arcane power.          │   ║
║  │     Classes: Galdr-Caster, Blood-Priest                        │   ║
║  └────────────────────────────────────────────────────────────────┘   ║
║                                                                        ║
║  Enter your choice (1-4): _                                            ║
║                                                                        ║
╚════════════════════════════════════════════════════════════════════════╝
```

#### Class Selection View

```
╔════════════════════════════════════════════════════════════════════════╗
║                    MYSTIC - CHOOSE YOUR CLASS                          ║
╠════════════════════════════════════════════════════════════════════════╣
║                                                                        ║
║  ┌────────────────────────────────────────────────────────────────┐   ║
║  │ [1] GALDR-CASTER                                               │   ║
║  │                                                                 │   ║
║  │ Galdr-Casters wield the power of runic magic, channeling       │   ║
║  │ arcane energies through ancient incantations. They command     │   ║
║  │ devastating offensive spells but are physically frail.         │   ║
║  │                                                                 │   ║
║  │ Stats:  HP: -15   ATK: +8   DEF: -3                            │   ║
║  │         Might: -2  Fort: -2  Will: +5  Wits: +3  Fin: +0       │   ║
║  │                                                                 │   ║
║  │ Resource: Mana (regenerates per turn)                          │   ║
║  │ Starting Abilities: Flame Bolt, Arcane Shield                  │   ║
║  └────────────────────────────────────────────────────────────────┘   ║
║                                                                        ║
║  ┌────────────────────────────────────────────────────────────────┐   ║
║  │ [2] BLOOD-PRIEST                                               │   ║
║  │                                                                 │   ║
║  │ Blood-Priests serve dark powers, channeling divine energy      │   ║
║  │ through sacrifice and devotion. They can heal allies or        │   ║
║  │ smite enemies, drawing power from acts of faith.               │   ║
║  │                                                                 │   ║
║  │ Stats:  HP: +5    ATK: +2   DEF: +0                            │   ║
║  │         Might: +0  Fort: +1  Will: +4  Wits: +1  Fin: -1       │   ║
║  │                                                                 │   ║
║  │ Resource: Faith (builds from healing/support)                  │   ║
║  │ Starting Abilities: Healing Word, Smite                        │   ║
║  └────────────────────────────────────────────────────────────────┘   ║
║                                                                        ║
║  Enter your choice (1-2), or [B]ack to archetypes: _                   ║
║                                                                        ║
╚════════════════════════════════════════════════════════════════════════╝
```

#### Updated Status Display

```
╔════════════════════════════════════════════════════════════════════════╗
║                           CHARACTER STATUS                             ║
╠════════════════════════════════════════════════════════════════════════╣
║                                                                        ║
║  Name:       Astrid Ironheart                                          ║
║  Race:       Human                                                     ║
║  Background: Soldier                                                   ║
║  Archetype:  Warrior                                                   ║
║  Class:      Shieldmaiden                                              ║
║                                                                        ║
║  ─────────────────────────────────────────────────────────────────     ║
║                                                                        ║
║  VITALS                                                                ║
║  Health:     120/120  ████████████████████                             ║
║  Rage:       0/100    ░░░░░░░░░░░░░░░░░░░░                             ║
║                                                                        ║
║  COMBAT STATS                                                          ║
║  Attack:     8                                                         ║
║  Defense:    10                                                        ║
║                                                                        ║
║  ATTRIBUTES                                                            ║
║  Might:      12   Fortitude: 14   Will: 8                              ║
║  Wits:       7    Finesse:   6                                         ║
║                                                                        ║
╚════════════════════════════════════════════════════════════════════════╝
```

---

## Logging Requirements

### Log Events

| Event | Level | Message Template | Properties |
|-------|-------|------------------|------------|
| Service Init | Information | "ClassService initialized with {ArchetypeCount} archetypes and {ClassCount} classes" | ArchetypeCount, ClassCount |
| Archetype Loaded | Debug | "Loaded archetype: {ArchetypeId} ({ArchetypeName})" | ArchetypeId, ArchetypeName |
| Class Loaded | Debug | "Loaded class: {ClassId} ({ClassName}) under archetype {ArchetypeId}" | ClassId, ClassName, ArchetypeId |
| Archetype Selected | Information | "Player selected archetype: {ArchetypeId}" | ArchetypeId |
| Class Selected | Information | "Player {PlayerName} selected class: {ClassName} ({ClassId})" | PlayerName, ClassName, ClassId |
| Stats Modified | Information | "Applied class {ClassName} to {PlayerName}. Stats: HP {OldHP}->{NewHP}, ATK {OldATK}->{NewATK}, DEF {OldDEF}->{NewDEF}" | ClassName, PlayerName, OldHP, NewHP, OldATK, NewATK, OldDEF, NewDEF |
| Requirements Check | Debug | "Validating requirements for {ClassId}: Race={RaceId}" | ClassId, RaceId |
| Requirements Failed | Information | "Class requirements not met for {ClassId}: {Reasons}" | ClassId, Reasons |
| Config Load Error | Error | "Failed to load {ConfigFile}: {ErrorMessage}" | ConfigFile, ErrorMessage |
| Invalid Class ID | Warning | "Class not found: {ClassId}" | ClassId |

### Example Log Output

```
[2024-01-15 10:30:15 INF] ClassService initialized with 4 archetypes and 5 classes
[2024-01-15 10:30:15 DBG] Loaded archetype: warrior (Warrior)
[2024-01-15 10:30:15 DBG] Loaded archetype: skirmisher (Skirmisher)
[2024-01-15 10:30:15 DBG] Loaded archetype: adept (Adept)
[2024-01-15 10:30:15 DBG] Loaded archetype: mystic (Mystic)
[2024-01-15 10:30:15 DBG] Loaded class: shieldmaiden (Shieldmaiden) under archetype warrior
[2024-01-15 10:30:15 DBG] Loaded class: shadow-walker (Shadow-Walker) under archetype skirmisher
[2024-01-15 10:30:15 DBG] Loaded class: scrap-tinker (Scrap-Tinker) under archetype adept
[2024-01-15 10:30:15 DBG] Loaded class: galdr-caster (Galdr-Caster) under archetype mystic
[2024-01-15 10:30:15 DBG] Loaded class: blood-priest (Blood-Priest) under archetype mystic
[2024-01-15 10:32:45 INF] Player selected archetype: warrior
[2024-01-15 10:32:52 INF] Player Astrid selected class: Shieldmaiden (shieldmaiden)
[2024-01-15 10:32:52 INF] Applied class Shieldmaiden to Astrid. Stats: HP 100->120, ATK 10->8, DEF 5->10
```

---

## Unit Test Specifications

### ArchetypeDefinition Tests (~5 tests)

```csharp
namespace RuneAndRust.Domain.Tests.Entities;

[TestFixture]
public class ArchetypeDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_ReturnsArchetype()
    {
        // Arrange & Act
        var archetype = ArchetypeDefinition.Create(
            "warrior", "Warrior", "Masters of martial combat",
            "Frontline fighter", StatTendency.Defensive);

        // Assert
        archetype.Id.Should().Be("warrior");
        archetype.Name.Should().Be("Warrior");
        archetype.StatTendency.Should().Be(StatTendency.Defensive);
    }

    [Test]
    public void Create_WithNullId_ThrowsArgumentException()
    {
        var act = () => ArchetypeDefinition.Create(
            null!, "Warrior", "Description", "Summary", StatTendency.Defensive);
        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void Create_NormalizesIdToLowercase()
    {
        var archetype = ArchetypeDefinition.Create(
            "WARRIOR", "Warrior", "Description", "Summary", StatTendency.Defensive);
        archetype.Id.Should().Be("warrior");
    }

    [Test]
    public void Create_WithEmptyDescription_ThrowsArgumentException()
    {
        var act = () => ArchetypeDefinition.Create(
            "warrior", "Warrior", "", "Summary", StatTendency.Defensive);
        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void StatTendency_AllValuesAreDefined()
    {
        Enum.GetValues<StatTendency>().Should().HaveCount(4);
    }
}
```

### ClassDefinition Tests (~6 tests)

```csharp
[TestFixture]
public class ClassDefinitionTests
{
    [Test]
    public void Create_WithValidParameters_ReturnsClass()
    {
        var modifiers = new StatModifiers { MaxHealth = 20, Attack = -2, Defense = 5 };
        var growth = new StatModifiers { MaxHealth = 12, Attack = 2, Defense = 3 };

        var classDef = ClassDefinition.Create(
            "shieldmaiden", "Shieldmaiden", "Stalwart defender", "warrior",
            modifiers, growth, "rage", new[] { "shield-bash", "taunt" });

        classDef.Id.Should().Be("shieldmaiden");
        classDef.ArchetypeId.Should().Be("warrior");
        classDef.PrimaryResourceId.Should().Be("rage");
        classDef.StartingAbilityIds.Should().HaveCount(2);
    }

    [Test]
    public void Create_WithNullArchetypeId_ThrowsArgumentException()
    {
        var act = () => ClassDefinition.Create(
            "shieldmaiden", "Shieldmaiden", "Description", null!,
            StatModifiers.None, StatModifiers.None, "rage");
        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void Create_WithNoStartingAbilities_HasEmptyList()
    {
        var classDef = ClassDefinition.Create(
            "test", "Test", "Description", "warrior",
            StatModifiers.None, StatModifiers.None, "rage");
        classDef.StartingAbilityIds.Should().BeEmpty();
    }

    [Test]
    public void Create_WithNullRequirements_HasNullRequirements()
    {
        var classDef = ClassDefinition.Create(
            "test", "Test", "Description", "warrior",
            StatModifiers.None, StatModifiers.None, "rage", requirements: null);
        classDef.Requirements.Should().BeNull();
    }

    [Test]
    public void Create_NormalizesIdsToLowercase()
    {
        var classDef = ClassDefinition.Create(
            "SHIELDMAIDEN", "Shieldmaiden", "Description", "WARRIOR",
            StatModifiers.None, StatModifiers.None, "RAGE");
        classDef.Id.Should().Be("shieldmaiden");
        classDef.ArchetypeId.Should().Be("warrior");
        classDef.PrimaryResourceId.Should().Be("rage");
    }

    [Test]
    public void Create_WithRequirements_StoresRequirements()
    {
        var requirements = new ClassRequirements
        {
            AllowedRaceIds = new[] { "elf", "human" },
            MinimumAttributes = new Dictionary<string, int> { { "will", 12 } }
        };
        var classDef = ClassDefinition.Create(
            "test", "Test", "Description", "mystic",
            StatModifiers.None, StatModifiers.None, "mana", requirements: requirements);
        classDef.Requirements.Should().NotBeNull();
        classDef.Requirements!.Value.AllowedRaceIds.Should().Contain("elf");
    }
}
```

### StatModifiers Tests (~4 tests)

```csharp
[TestFixture]
public class StatModifiersTests
{
    [Test]
    public void None_ReturnsAllZeroModifiers()
    {
        var modifiers = StatModifiers.None;
        modifiers.MaxHealth.Should().Be(0);
        modifiers.Attack.Should().Be(0);
        modifiers.Defense.Should().Be(0);
    }

    [Test]
    public void ApplyTo_AddsModifiersToBaseStats()
    {
        var baseStats = new Stats(100, 10, 5);
        var modifiers = new StatModifiers { MaxHealth = 20, Attack = -2, Defense = 5 };
        var result = modifiers.ApplyTo(baseStats);
        result.MaxHealth.Should().Be(120);
        result.Attack.Should().Be(8);
        result.Defense.Should().Be(10);
    }

    [Test]
    public void ApplyTo_ClampsMinimumValues()
    {
        var baseStats = new Stats(10, 5, 3);
        var modifiers = new StatModifiers { MaxHealth = -20, Attack = -10, Defense = -5 };
        var result = modifiers.ApplyTo(baseStats);
        result.MaxHealth.Should().Be(1);
        result.Attack.Should().Be(0);
        result.Defense.Should().Be(0);
    }

    [Test]
    public void Addition_CombinesModifiers()
    {
        var a = new StatModifiers { MaxHealth = 10, Attack = 2 };
        var b = new StatModifiers { MaxHealth = 5, Attack = 3, Defense = 2 };
        var result = a + b;
        result.MaxHealth.Should().Be(15);
        result.Attack.Should().Be(5);
        result.Defense.Should().Be(2);
    }
}
```

### ClassRequirements Tests (~4 tests)

```csharp
[TestFixture]
public class ClassRequirementsTests
{
    [Test]
    public void Validate_WithNoRequirements_ReturnsValid()
    {
        var requirements = new ClassRequirements();
        var result = requirements.Validate("human", new Dictionary<string, int>());
        result.IsValid.Should().BeTrue();
    }

    [Test]
    public void Validate_WithMatchingRace_ReturnsValid()
    {
        var requirements = new ClassRequirements { AllowedRaceIds = new[] { "elf", "human" } };
        var result = requirements.Validate("elf", new Dictionary<string, int>());
        result.IsValid.Should().BeTrue();
    }

    [Test]
    public void Validate_WithNonMatchingRace_ReturnsInvalid()
    {
        var requirements = new ClassRequirements { AllowedRaceIds = new[] { "elf" } };
        var result = requirements.Validate("dwarf", new Dictionary<string, int>());
        result.IsValid.Should().BeFalse();
        result.FailureReasons.Should().Contain(r => r.Contains("Requires race"));
    }

    [Test]
    public void Validate_WithInsufficientAttribute_ReturnsInvalid()
    {
        var requirements = new ClassRequirements
        {
            MinimumAttributes = new Dictionary<string, int> { { "will", 14 } }
        };
        var attributes = new Dictionary<string, int> { { "will", 10 } };
        var result = requirements.Validate("human", attributes);
        result.IsValid.Should().BeFalse();
        result.FailureReasons.Should().Contain(r => r.Contains("will >= 14"));
    }
}
```

### ClassService Tests (~6 tests)

```csharp
[TestFixture]
public class ClassServiceTests
{
    private Mock<IConfigurationLoader> _configLoaderMock;
    private Mock<ILogger<ClassService>> _loggerMock;
    private ClassService _service;

    [SetUp]
    public void Setup()
    {
        _configLoaderMock = new Mock<IConfigurationLoader>();
        _loggerMock = new Mock<ILogger<ClassService>>();

        var archetypes = new List<ArchetypeDefinition>
        {
            ArchetypeDefinition.Create("warrior", "Warrior", "Desc", "Summary", StatTendency.Defensive),
            ArchetypeDefinition.Create("mystic", "Mystic", "Desc", "Summary", StatTendency.Offensive)
        };
        var classes = new List<ClassDefinition>
        {
            ClassDefinition.Create("shieldmaiden", "Shieldmaiden", "Desc", "warrior",
                new StatModifiers { MaxHealth = 20 }, StatModifiers.None, "rage"),
            ClassDefinition.Create("galdr-caster", "Galdr-Caster", "Desc", "mystic",
                new StatModifiers { Attack = 8 }, StatModifiers.None, "mana")
        };

        _configLoaderMock.Setup(x => x.LoadArchetypes(It.IsAny<string>())).Returns(archetypes);
        _configLoaderMock.Setup(x => x.LoadClasses(It.IsAny<string>())).Returns(classes);
        _service = new ClassService(_configLoaderMock.Object, _loggerMock.Object);
    }

    [Test]
    public void GetAllArchetypes_ReturnsAllArchetypes()
    {
        var result = _service.GetAllArchetypes();
        result.Should().HaveCount(2);
    }

    [Test]
    public void GetClassesForArchetype_ReturnsMatchingClasses()
    {
        var result = _service.GetClassesForArchetype("warrior");
        result.Should().HaveCount(1);
        result[0].Id.Should().Be("shieldmaiden");
    }

    [Test]
    public void GetClass_WithValidId_ReturnsClass()
    {
        var result = _service.GetClass("shieldmaiden");
        result.Should().NotBeNull();
        result!.Name.Should().Be("Shieldmaiden");
    }

    [Test]
    public void GetClass_WithInvalidId_ReturnsNull()
    {
        var result = _service.GetClass("nonexistent");
        result.Should().BeNull();
    }

    [Test]
    public void ApplyClassToPlayer_UpdatesPlayerClassAndStats()
    {
        var player = new Player("Test");
        var originalHP = player.Stats.MaxHealth;
        _service.ApplyClassToPlayer("shieldmaiden", player);
        player.ClassId.Should().Be("shieldmaiden");
        player.ArchetypeId.Should().Be("warrior");
        player.Stats.MaxHealth.Should().Be(originalHP + 20);
    }

    [Test]
    public void ApplyClassToPlayer_WithInvalidClass_ThrowsArgumentException()
    {
        var player = new Player("Test");
        var act = () => _service.ApplyClassToPlayer("nonexistent", player);
        act.Should().Throw<ArgumentException>();
    }
}
```

---

## Acceptance Criteria

### AC-4a-1: Archetype Configuration Loading
- [ ] Archetypes load successfully from `config/archetypes.json`
- [ ] All 4 default archetypes are present (Warrior, Skirmisher, Adept, Mystic)
- [ ] Invalid JSON produces clear error message
- [ ] Missing required fields produce validation error

### AC-4a-2: Class Configuration Loading
- [ ] Classes load successfully from `config/classes.json`
- [ ] All 5 default classes are present
- [ ] Each class references a valid archetype
- [ ] Stat modifiers are correctly parsed

### AC-4a-3: Character Creation Flow
- [ ] Archetype selection step appears after attributes
- [ ] Class selection step appears after archetype selection
- [ ] Player can navigate back to change selections
- [ ] Selected class is displayed in character summary

### AC-4a-4: Stat Modifier Application
- [ ] Class stat modifiers apply to player's base stats
- [ ] Negative modifiers reduce stats (with minimum bounds)
- [ ] Modified stats display in status command

### AC-4a-5: Class Requirements (if implemented)
- [ ] Classes with race requirements show only valid races
- [ ] Classes with attribute requirements show unmet requirements
- [ ] Invalid selections produce helpful error messages

### AC-4a-6: Logging
- [ ] Service initialization logs archetype and class counts
- [ ] Class selection logs player name, class name, and class ID
- [ ] Stat modifications log before/after values
- [ ] Configuration errors log at Error level

### AC-4a-7: Unit Tests
- [ ] All unit tests pass
- [ ] Test coverage includes happy path and error cases
- [ ] Mocks used appropriately for dependencies

---

## Documentation Requirements

### Code Documentation
- [ ] All public types have XML documentation
- [ ] All public methods have XML documentation with `<param>`, `<returns>`, `<exception>` tags
- [ ] `<remarks>` sections explain non-obvious behavior
- [ ] `<example>` tags show usage where helpful

### Configuration Documentation
- [ ] JSON schema files created for archetypes and classes
- [ ] Example configuration files documented
- [ ] Schema validation integrated into loading

### User Documentation (if applicable)
- [ ] Character creation guide updated with class selection
- [ ] Class descriptions added to game help

---

## Deliverable Checklist

### Domain Layer
- [ ] `ArchetypeDefinition.cs` entity
- [ ] `ClassDefinition.cs` entity
- [ ] `StatModifiers.cs` value object
- [ ] `ClassRequirements.cs` value object
- [ ] `ClassRequirementValidation.cs` record
- [ ] `StatTendency.cs` enum
- [ ] Player entity updates (`ArchetypeId`, `ClassId`, `SetClass()`)

### Application Layer
- [ ] `ClassService.cs`
- [ ] `ArchetypeDto.cs`
- [ ] `ClassDto.cs`
- [ ] DTO mapping extensions

### Infrastructure Layer
- [ ] `ConfigurationLoader` updates for archetypes and classes
- [ ] `config/archetypes.json`
- [ ] `config/classes.json`
- [ ] `archetypes.schema.json`
- [ ] `classes.schema.json`

### Presentation Layer
- [ ] `ArchetypeSelectView.cs` (TUI)
- [ ] `ClassSelectView.cs` (TUI)
- [ ] Character creation wizard updates
- [ ] Status view updates to show class

### Tests
- [ ] `ArchetypeDefinitionTests.cs`
- [ ] `ClassDefinitionTests.cs`
- [ ] `StatModifiersTests.cs`
- [ ] `ClassRequirementsTests.cs`
- [ ] `ClassServiceTests.cs`

### Documentation
- [ ] XML documentation on all public members
- [ ] JSON schema files
- [ ] Update ROADMAP.md to mark items complete

---

## Dependencies

### Required from v0.0.3
- Player creation wizard infrastructure
- Race definitions (for class requirements)
- Attribute system (for point-buy and requirements)
- Configuration loading infrastructure

### Provided to v0.0.4b
- `ClassDefinition.PrimaryResourceId` for resource binding
- Player `ClassId` for resource assignment

### Provided to v0.0.4c
- `ClassDefinition.StartingAbilityIds` for ability assignment
- Player `ClassId` for ability binding
