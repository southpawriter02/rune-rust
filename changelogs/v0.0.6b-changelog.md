# v0.0.6b Changelog - Monster AI & Flee System

**Date:** 2026-01-08

## Added

### Domain Layer - Enums
- `AIBehavior` enum: Aggressive, Defensive, Cowardly, Support, Chaotic
- `AIAction` enum: Attack, Defend, Heal, Buff, Flee, Wait
- `CombatLogType` enum: 13 log entry types for combat events

### Domain Layer - Value Objects
- `AIDecision` value object with factory methods for all action types
- `AIContext` value object with health/ally/enemy computed properties
- `FleeAttemptResult` and `OpportunityAttackResult` for flee mechanics

### Domain Layer - Entities
- `CombatLogEntry` entity for tracking combat events

### Domain Layer - Modifications
- `Monster.Behavior`, `CanHeal`, `HealAmount` properties
- `Monster.SetBehavior()`, `EnableHealing()`, `Heal()` methods
- `Monster.CreateGoblinShaman()`, `Monster.CreateSlime()` factory methods
- Updated existing monsters with behavior assignments (Goblin=Cowardly, Orc=Aggressive)
- `Combatant.Behavior`, `CanHeal`, `HealAmount`, `IsDefending` properties
- `Combatant.SetDefending()`, `ResetTurnState()` methods
- `CombatEncounter.CombatLog`, `AddLogEntry()`, `GetRecentLogEntries()`, `GetLogEntriesForRound()`
- `CombatEncounter.GetAlliesFor()`, `GetEnemiesForMonster()`, `RemoveMonster()`

### Application Layer - Services
- `MonsterAIService` with 5 behavior decision algorithms
- `FleeService` with DC calculation and opportunity attacks
- `CombatLogService` for creating log entries

## Tests Added

| Test File | Count |
|-----------|-------|
| `AIBehaviorTests.cs` | 6 |
| `AIDecisionTests.cs` | 6 |
| `AIContextTests.cs` | 5 |
| `CombatLogEntryTests.cs` | 3 |
| `MonsterAIServiceTests.cs` | 5 |
| **Total New** | 25 |

## Test Results

```
Domain Tests:      237 passed
Application Tests: 117 passed
Architecture Tests:  8 passed
Total:             362 passed
```

## Technical Notes

- Flee DC formula: 12 + (2 Ã— enemy count)
- Flee uses Finesse attribute for skill check
- Opportunity attack damage: 50% of monster's attack stat
- Cowardly monsters have 50% flee chance at <30% HP
- Support monsters prioritize healing wounded allies
- Chaotic monsters have randomized action selection
