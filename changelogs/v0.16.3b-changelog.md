# v0.16.3b Changelog - Smart Loot Algorithm

**Release Date:** 2026-01-28

## Overview

Introduces the foundational value objects and interface for the smart loot algorithm, implementing a 60/40 class-appropriate loot bias system.

## Added

### Domain Layer

- **SmartLootContext** (`src/Core/RuneAndRust.Domain/ValueObjects/SmartLootContext.cs`)
    - `readonly record struct` encapsulating smart loot selection inputs
    - Properties: `PlayerArchetypeId`, `QualityTier`, `AvailableItems`, `BiasPercentage`, `RandomSeed`
    - Factory methods: `Create`, `CreateRandomOnly`, `CreateForTesting`
    - Computed properties: `HasPlayerArchetype`, `HasAvailableItems`, `NormalizedArchetypeId`
    - Default bias percentage of 60% for class-appropriate items

- **SmartLootResult** (`src/Core/RuneAndRust.Domain/ValueObjects/SmartLootResult.cs`)
    - `readonly record struct` containing selection output with metadata
    - Properties: `SelectedItem`, `WasClassAppropriate`, `BiasRoll`, `FilteredPoolSize`, `TotalPoolSize`, `SelectionReason`
    - Factory methods: `Empty`, `CreateClassAppropriate`, `CreateRandom`, `CreateFallback`, `CreateRandomOnly`
    - Computed properties: `HasSelection`, `BiasRollFavoredClass`, `FilteredPoolPercentage`

### Application Layer

- **ISmartLootService** (`src/Core/RuneAndRust.Application/Interfaces/ISmartLootService.cs`)
    - Interface defining the smart loot selection contract
    - Methods: `SelectItem`, `FilterClassAppropriateItems`, `CalculateBiasResult`, `GetStatistics`, `ResetStatistics`
    - Nested `SmartLootStatistics` record with percentage calculations

### Testing

- **SmartLootContextTests** (11 tests)
- **SmartLootResultTests** (10 tests)

## Changed

- **LootEntry** (`src/Core/RuneAndRust.Domain/ValueObjects/LootEntry.cs`)
    - Added `CategoryId` property for class-appropriate filtering
    - Updated `Create` factory method to accept optional `categoryId` parameter
    - Added `HasCategory` computed property

- **JsonConfigurationProvider** (`src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`)
    - Updated `LootEntry.Create` calls to use named parameters

## Dependencies

- Requires v0.16.3a (Equipment Class Mapping) for `IEquipmentClassMappingProvider`
- Requires v0.16.0 (Quality Tier System) for `QualityTier` enum
