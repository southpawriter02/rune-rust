# v0.14.3d Changelog - Boss Schema

## Summary

Implemented `bosses.schema.json` with comprehensive validation for boss encounter definitions, the most complex schema in the v0.14.3 series. The schema includes 8 distinct definitions that work together to define complete boss encounters: multi-phase configurations, health thresholds, ability rotations, enrage mechanics, summon configurations, vulnerability windows, and boss-specific dialogue/announcements. This schema enables full customization of boss encounters without code changes, supporting modding scenarios for complex boss fights with multiple phases, dynamic difficulty, and strategic mechanics.

## Added

### Schema Files
- **[config/schemas/bosses.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/bosses.schema.json)** - JSON Schema Draft-07 for boss encounter configuration

### Schema Definitions (8 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `BossDefinition` | Complete boss encounter with all mechanics | id, name, description, baseMonsterId, phases |
| `BossPhase` | Combat phase with behavior and abilities | id, name, healthThresholdPercent, behavior |
| `EnrageConfig` | Enrage trigger and stat multipliers | triggerType, triggerValue, statMultipliers |
| `SummonConfig` | Minion spawning configuration | monsterId, count, triggerType |
| `VulnerabilityWindow` | Damage bonus window | id, triggerType, triggerValue, durationTurns |
| `BossAnnouncement` | Boss dialogue configuration | trigger, text |
| `QuantityRange` | Min/max range for summon counts | min, max |
| `StatModifiers` | Flat stat adjustments for phases | (all optional) |

### BossDefinition Properties
| Property | Type | Constraint | Description |
|----------|------|------------|-------------|
| `id` | string | Pattern: `^[a-z][a-z0-9_-]*$` | Unique identifier (hyphen-allowed) |
| `name` | string | minLength: 1 | Display name (required) |
| `title` | string | maxLength: 100 | Optional title (e.g., "Lord of Bones") |
| `description` | string | (required) | Lore/flavor text |
| `baseMonsterId` | string | Pattern: `^[a-z][a-z0-9_]*$` | Reference to monsters.json |
| `baseHealth` | integer | >= 1 | Override health value |
| `phases` | array | minItems: 1 | Phase definitions (required) |
| `enrage` | EnrageConfig | (optional) | Enrage mechanics |
| `summons` | array | (optional) | Summon configurations |
| `vulnerabilityWindows` | array | (optional) | Vulnerability windows |
| `announcements` | array | (optional) | Boss dialogue |
| `uniqueLootTableId` | string | Pattern validated | Reference to loot-tables.json |
| `musicTrackId` | string | Pattern validated | Boss music track |
| `arenaRequirements` | object | (optional) | Arena size/terrain requirements |
| `sortOrder` | integer | >= 0 | Display order |

### Boss Behavior Patterns (5)
| Behavior | Target Priority | Ability Focus | Use Case |
|----------|-----------------|---------------|----------|
| `Aggressive` | Highest damage dealer | Max damage | Default phase |
| `Defensive` | Self / healer | Defensive/heals | Low HP phase |
| `Tactical` | Weakest or dangerous | CC/debuffs | Strategic phase |
| `Berserk` | Random / nearest | All-out attack | Enrage/final phase |
| `Summoner` | N/A (summon focus) | Minion spawning | Summon phase |

### Enrage Trigger Types (4)
| Trigger | Value Meaning | Example |
|---------|---------------|---------|
| `Timer` | Seconds until enrage | 300 (5 minutes) |
| `HealthPercent` | HP % that triggers | 20 (at 20% HP) |
| `TurnCount` | Turns until enrage | 30 turns |
| `AllyDeath` | On minion death | N/A |

### Summon Trigger Types (4)
| Trigger | When Summons Occur |
|---------|-------------------|
| `PhaseStart` | When entering a phase |
| `Timer` | Every N seconds |
| `HealthPercent` | When HP drops below threshold |
| `Random` | % chance per turn |

### Vulnerability Trigger Types (4)
| Trigger | Value Type | When Window Opens |
|---------|------------|-------------------|
| `AfterAbility` | Ability ID | After boss uses ability |
| `PhaseTransition` | Phase ID | When entering phase |
| `Timer` | Seconds | Every N seconds |
| `HealthPercent` | HP % | At health threshold |

### Announcement Triggers (6)
| Trigger | Description |
|---------|-------------|
| `BattleStart` | Combat begins |
| `PhaseTransition` | Entering a phase |
| `Enrage` | Enrage triggers |
| `LowHealth` | HP drops below threshold |
| `Victory` | Boss defeats players |
| `Summon` | Summoning minions |

### Configuration Updates
- **[config/bosses.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/bosses.json)** - Created with 3 example bosses:
  - `skeleton-king` - 3 phases, Timer enrage, skeleton summons, bone_storm vulnerability
  - `shadow-weaver` - 2 phases, TurnCount enrage, fade_away vulnerability
  - `stone-guardian` - 3 phases, HealthPercent enrage, phase transition vulnerability

### Unit Tests
- **[BossesSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/BossesSchemaTests.cs)** - 7 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (8 definitions)
  - `BossesJson_ValidatesAgainstSchema` - Backwards compatibility (3 bosses)
  - `Phases_EmptyArray_FailsValidation` - Phases minItems: 1 validation
  - `HealthThreshold_OutOfRange_FailsValidation` - Health threshold 0-100 range
  - `Behavior_InvalidEnum_FailsValidation` - Behavior enum (5 values)
  - `EnrageTriggerType_InvalidEnum_FailsValidation` - Enrage trigger enum (4 values)
  - `VulnerabilityDuration_Zero_FailsValidation` - Duration >= 1 validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/bosses.schema.json` | Added |
| `config/bosses.json` | Added (3 example bosses) |
| `tests/.../Schemas/BossesSchemaTests.cs` | Added |
| `changelogs/v0.14.3d-changelog.md` | Added |

## Test Results

```
Test summary: total: 7, failed: 0, succeeded: 7, skipped: 0
Build succeeded with 0 errors
```

## Example Boss Structure

```
Skeleton King (skeleton-king)
├── Phase 1 (100%-60% HP)
│   ├── Behavior: Tactical
│   ├── Abilities: Bone Throw, Shield Bash
│   └── Announcement: "You dare challenge me?"
├── Phase 2 (60%-30% HP)
│   ├── Behavior: Summoner
│   ├── Abilities: Summon Skeletons, Dark Wave
│   ├── Summons: 2-4 Skeletons every 3 turns (max 6)
│   └── Announcement: "Rise, my minions!"
├── Phase 3 (30%-0% HP)
│   ├── Behavior: Berserk
│   ├── Abilities: Bone Storm, Death Strike
│   ├── Stat Modifiers: +10 ATK, +5 SPD
│   ├── Vulnerability: After Bone Storm (2 turns, 2x damage)
│   └── Announcement: "ENOUGH! I will destroy you all!"
└── Enrage: After 5 minutes, +50% damage, +25% speed
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Create complex multi-phase boss encounters
- Define custom behavior patterns per phase
- Configure multiple enrage trigger conditions
- Set up minion summoning rules with cooldowns and caps
- Define strategic vulnerability windows after abilities
- Add dramatic boss dialogue at key moments
- Reference base monsters for stats and appearance
- Link unique loot tables and music tracks
- Specify arena size requirements

---

*Final entry in v0.14.3 Monster Configuration Schemas series. See also: v0.14.3a (Monster Schema), v0.14.3b (Trait Schema), v0.14.3c (Tier Schema).*
