# v0.15.4g Changelog - Improvised Tool Crafting System

**Release Date:** 2026-01-24
**Version:** v0.15.4g
**Phase:** System Bypass Skill Expansion (v0.15.x)
**Sub-Phase:** Improvised Tool Crafting System (v0.15.4g)

---

## Summary

Implemented the **Improvised Tool Crafting System**, enabling characters to create bypass tools from salvaged components. Characters can craft four distinct tools: Shim Picks (+1d10 to lockpicking), Wire Probe (+1d10 to terminal hacking), Glitch Trigger (force glitch state on mechanisms), and Bypass Clamps (skip terminal Layer 1).

Components are acquired through **critical successes** (net successes ≥5) on bypass checks. Each bypass type yields specific components: lockpicking yields springs and scrap metal, terminal hacking yields circuit fragments and wire, trap disarmament yields wire and metal clips, and glitch exploitation yields circuits and capacitors.

This version builds upon v0.15.4f (Glitch Exploitation System) and provides the crafting mechanics that reward skilled play with tangible benefits.

---

## Added

### Domain Enums (4 files)

| File | Description |
|------|-------------|
| `ImprovisedToolType.cs` | Four tool types: ShimPicks, WireProbe, GlitchTrigger, BypassClamps |
| `BypassType.cs` | Five bypass types: None, Lockpicking, TerminalHacking, TrapDisarmament, GlitchExploitation |
| `ComponentType.cs` | Four component types: Metal, Wire, Circuit, Misc |
| `CraftingAttribute.cs` | Three attribute options: Wits, Finesse, WitsOrFinesse |

### Domain Value Objects (4 files)

| File | Description |
|------|-------------|
| `ImprovisedTool.cs` | Record struct for crafted tools with durability, bonus, and quality tracking |
| `ToolRecipe.cs` | Record struct with static recipe definitions and component requirements |
| `ComponentRequirement.cs` | Record struct specifying component name, type, and quantity needed |
| `CraftingComponent.cs` | Record struct for salvaged components with factory methods and substitution logic |

### Domain Interfaces (1 file)

| File | Description |
|------|-------------|
| `IImprovisedToolCraftingService.cs` | Service contract plus result value objects (CharacterCraftingContext, ComponentCheckResult, CraftResult, ToolUsageResult) |

### Application Services (1 file)

| File | Description |
|------|-------------|
| `ImprovisedToolCraftingService.cs` | Full implementation with exhaustive logging, dice integration, and narrative generation |

### Configuration Files (4 files)

| File | Description |
|------|-------------|
| `config/system-bypass/improvised-tools.json` | Tool recipes, crafting modifiers, and durability configuration |
| `config/system-bypass/crafting-components.json` | Component definitions and salvage rules by bypass type |
| `config/schemas/improvised-tools.schema.json` | JSON Schema for validating tool configuration |
| `config/schemas/crafting-components.schema.json` | JSON Schema for validating component configuration |

### Unit Tests (1 file)

| File | Description |
|------|-------------|
| `ImprovisedToolCraftingServiceTests.cs` | ~30 tests covering recipes, crafting, tool usage, and salvage generation |

---

## Craftable Tools

| Tool | Components | DC | Attribute | Standard | Quality |
|------|------------|----|-----------|-----------| --------|
| Shim Picks | 3× Scrap Metal | 10 | Wits or Finesse | +1d10 locks, 3 uses | +2d10 locks, 5 uses |
| Wire Probe | 2× Copper Wire + 1× Handle | 12 | Wits or Finesse | +1d10 terminals, 3 uses | +2d10 terminals, 5 uses |
| Glitch Trigger | 1× Capacitor + 4× Wire | 14 | Wits | Force glitch, 3 uses | Force glitch, 5 uses |
| Bypass Clamps | 4× Metal Clips | 12 | Finesse | Skip Layer 1, 3 uses | Skip Layer 1, 5 uses |

### Tool Quality

| Quality | Crafting Result | Bonus | Durability |
|---------|-----------------|-------|------------|
| Standard | Normal success | +1d10 | 3 uses |
| Quality | Critical success (≥5 net) | +2d10 | 5 uses |

### Tool Condition States

| Condition | Uses Remaining | Description |
|-----------|----------------|-------------|
| Fresh | Full | Newly crafted, pristine condition |
| Serviceable | 3+ | Good working order |
| Worn | 2 | Shows signs of stress |
| Nearly Broken | 1 | One use left, handle with care |
| Broken | 0 | No longer functional |

---

## Component Types

| Type | Description | Example Components |
|------|-------------|-------------------|
| Metal | Structural materials | Scrap Metal, Metal Clips, High-Tension Spring |
| Wire | Conductive materials | Copper Wire, Wire |
| Circuit | Electronic components | Circuit Fragment, Capacitor (Rare) |
| Misc | General utility | Handle |

### Component Substitution Rules

| Substitution | Rule |
|--------------|------|
| Same Type | Always valid |
| Metal → Misc | Metal can substitute for Misc (improvised handles) |

---

## Salvage Rules by Bypass Type

Components are salvaged from **critical successes** (net successes ≥5) on bypass checks:

| Bypass Type | Guaranteed | Chance (50%) | Chance (16%) |
|-------------|------------|--------------|--------------|
| Lockpicking | High-Tension Spring | Scrap Metal | — |
| Terminal Hacking | Circuit Fragment, Wire | — | Capacitor (Rare) |
| Trap Disarmament | Wire, Metal Clips | — | — |
| Glitch Exploitation | Circuit Fragment | Capacitor (Rare) | — |

### Salvage Narrative Examples

- **Lockpicking:** "The spring flies free as the lock surrenders—quick hands save the mechanism's guts."
- **Terminal Hacking:** "Behind the interface panel, salvageable components await those who know where to look."
- **Trap Disarmament:** "Careful hands claim wire and clips from the now-harmless mechanism."
- **Glitch Exploitation:** "The corrupted device yields its secrets—and its components."

---

## Crafting Modifiers

| Condition | Dice Modifier | Description |
|-----------|---------------|-------------|
| Tinker's Toolkit | +1d10 | Proper tools for improvised work |
| Workshop Access | +2d10 | Stable environment with equipment |
| Under Pressure | -1d10 | Combat, time constraints, or threat |

### Modifier Stacking

Modifiers stack additively:
- Workshop + Toolkit = +3d10
- Workshop + Pressure = +1d10
- Toolkit + Pressure = +0d10

### Minimum Dice Pool

The crafting dice pool cannot drop below **1d10** regardless of negative modifiers.

---

## Crafting Outcomes

### Success Tiers

| Net Successes | Result | Outcome |
|---------------|--------|---------|
| < 0 | Fumble | 1d6 damage, components destroyed |
| 0 | Failure | Components preserved, can retry |
| 1-4 | Success | Standard tool created |
| ≥5 | Critical | Quality tool created |

### Fumble Consequences

When crafting fails catastrophically (fumble):
1. **1d6 damage** to the crafter (sharp edges, electrical shock, etc.)
2. **All components consumed** and destroyed
3. **No tool created**
4. Narrative describes the mishap

---

## ImprovisedTool Value Object

### Properties

| Property | Type | Description |
|----------|------|-------------|
| ToolId | string | Unique identifier for this tool instance |
| ToolName | string | Display name of the tool |
| ToolType | ImprovisedToolType | Type classification |
| BonusAmount | int | Number of bonus dice (+1 or +2) |
| UsesRemaining | int | Remaining uses before breaking |
| IsQuality | bool | Whether this is a quality (critical) tool |
| SpecialEffect | string? | Special effect description (Glitch Trigger, Bypass Clamps) |

### Computed Properties

| Property | Description |
|----------|-------------|
| IsUsable | True if UsesRemaining > 0 |
| Condition | Current condition string (Fresh, Serviceable, Worn, Nearly Broken, Broken) |
| AssistsWithBypassType | The bypass type this tool provides bonus to |
| HasSpecialEffect | True if tool has a special effect |

### Factory Methods

| Method | Description |
|--------|-------------|
| CreateShimPicks(bool isQuality) | +1/+2d10 to lockpicking attempts |
| CreateWireProbe(bool isQuality) | +1/+2d10 to terminal hacking attempts |
| CreateGlitchTrigger(bool isQuality) | Force glitch state on mechanisms |
| CreateBypassClamps(bool isQuality) | Skip Layer 1 of terminal infiltration |

### Instance Methods

| Method | Description |
|--------|-------------|
| UseOnce() | Decrement uses, return modified tool or null if broken |
| Break() | Force tool to 0 uses |
| ToDisplayString() | Formatted output for UI |
| ToLogString() | Compact output for logging |

---

## ToolRecipe Value Object

### Properties

| Property | Type | Description |
|----------|------|-------------|
| RecipeId | string | Unique recipe identifier |
| ToolName | string | Name of the tool to craft |
| Description | string | Flavor description of the tool |
| RequiredComponents | IReadOnlyList&lt;ComponentRequirement&gt; | Components needed |
| CraftDc | int | Difficulty class for crafting |
| RequiredAttribute | CraftingAttribute | Attribute used for crafting roll |
| ResultingToolType | ImprovisedToolType | Type of tool created |

### Static Recipes

| Recipe | Description |
|--------|-------------|
| ShimPicks | 3× Scrap Metal, DC 10, Wits or Finesse |
| WireProbe | 2× Copper Wire + 1× Handle, DC 12, Wits or Finesse |
| GlitchTrigger | 1× Capacitor + 4× Wire, DC 14, Wits |
| BypassClamps | 4× Metal Clips, DC 12, Finesse |
| AllRecipes | Collection of all available recipes |

---

## CraftingComponent Value Object

### Properties

| Property | Type | Description |
|----------|------|-------------|
| ComponentId | string | Unique identifier for this component instance |
| ComponentName | string | Display name of the component |
| ComponentType | ComponentType | Type classification (Metal, Wire, Circuit, Misc) |
| SourceDescription | string | Where this component was salvaged from |
| IsRare | bool | Whether this is a rare/valuable component |

### Factory Methods

| Method | Rarity | Description |
|--------|--------|-------------|
| CreateScrapMetal(source) | Common | Structural metal from locks/containers |
| CreateMetalClips(source) | Common | Small metal fasteners from traps |
| CreateCopperWire(source) | Common | Conductive wire from terminals |
| CreateWire(source) | Common | Generic wire from various sources |
| CreateHandle(source) | Common | Grip component from tools |
| CreateHighTensionSpring(source) | Uncommon | Spring from complex locks |
| CreateCircuitFragment(source) | Uncommon | Partial circuit board from terminals |
| CreateCapacitor(source) | Rare | Power storage component (valuable!) |

### Instance Methods

| Method | Description |
|--------|-------------|
| CanSubstituteFor(ComponentType) | Check if this component can substitute for another type |
| ToDisplayString() | Formatted output for UI |
| ToLogString() | Compact output for logging |

---

## Result Value Objects

### CharacterCraftingContext

| Property | Type | Description |
|----------|------|-------------|
| Wits | int | Character's Wits attribute |
| Finesse | int | Character's Finesse attribute |
| HasTinkersToolkit | bool | Whether character has Tinker's Toolkit |
| HasWorkshopAccess | bool | Whether character has workshop access |
| IsUnderPressure | bool | Whether character is under pressure |

### ComponentCheckResult

| Property | Type | Description |
|----------|------|-------------|
| CanCraft | bool | Whether crafting is possible |
| MissingComponents | IReadOnlyList&lt;ComponentRequirement&gt; | Components still needed |
| MatchedComponents | IReadOnlyList&lt;CraftingComponent&gt; | Components that would be consumed |

### ImprovisedCraftResult

| Property | Type | Description |
|----------|------|-------------|
| Success | bool | Whether crafting succeeded |
| IsCritical | bool | Whether result was a critical success |
| IsFumble | bool | Whether result was a fumble |
| ToolCreated | ImprovisedTool? | The created tool (null on failure) |
| ComponentsConsumed | IReadOnlyList&lt;CraftingComponent&gt; | Components that were used |
| FumbleDamage | int | Damage taken on fumble (0 otherwise) |
| NarrativeText | string | Descriptive text for the outcome |

### ToolUsageResult

| Property | Type | Description |
|----------|------|-------------|
| BonusApplied | int | Number of bonus dice applied |
| SpecialEffectTriggered | bool | Whether special effect activated |
| SpecialEffectDescription | string? | Description of special effect |
| ModifiedTool | ImprovisedTool? | Tool after use (null if broken) |
| ToolBroke | bool | Whether tool broke after this use |
| NarrativeText | string | Descriptive text for the usage |

---

## IImprovisedToolCraftingService Interface

### Methods

| Method | Description |
|--------|-------------|
| GetAvailableRecipes() | Returns all craftable tool recipes |
| CanCraft(recipe, inventory) | Checks if inventory has required components |
| AttemptCraft(context, recipe, inventory) | Rolls crafting check and creates tool |
| GetToolBonus(tool, bypassType) | Returns bonus dice if tool matches bypass type |
| UseTool(tool, bypassType) | Applies tool effect and decrements uses |
| GetSalvageFromCritical(bypassType, mechanismType) | Generates components from critical bypass |

---

## Files Created

| Category | Files |
|----------|-------|
| Domain Enums | 4 |
| Domain Value Objects | 4 |
| Domain Interfaces | 1 |
| Application Services | 1 |
| Configuration | 4 |
| Unit Tests | 1 |
| Documentation | 1 |
| **Total** | **16** |

---

## Key Design Decisions

### 1. Service Placement in Application Layer

Following the pattern established in v0.15.4e/f, `ImprovisedToolCraftingService` is placed in `RuneAndRust.Application/Services/` rather than `Domain/Services/`. This aligns with Clean Architecture principles where application services orchestrate domain logic.

### 2. Component Substitution System

Metal components can substitute for Misc type requirements (improvised handles from scrap metal). This adds flexibility to crafting without making it trivial.

### 3. Critical Success Threshold

Net successes ≥5 yields quality tools with +2d10 bonus and 5 uses instead of standard +1d10 and 3 uses. This rewards skilled crafters with tangibly better results.

### 4. Fumble Consequences

Fumbles (negative net successes) result in 1d6 damage AND component loss. This creates meaningful risk when crafting, especially for rare components like Capacitors.

### 5. Tool-Bypass Type Matching

Tools only provide bonuses when used for their intended bypass type:
- Shim Picks → Lockpicking only
- Wire Probe → Terminal Hacking only
- Glitch Trigger → Glitch Exploitation only
- Bypass Clamps → Terminal Hacking only

### 6. Minimum Dice Pool

The crafting dice pool cannot drop below 1d10, ensuring there's always a chance of success even under adverse conditions.

### 7. Two-Pass Component Matching

The service uses a two-pass algorithm: first matching components by exact name, then by type substitution. This ensures the most specific components are used first.

---

## Integration Points

### With Bypass Systems

| System | Integration |
|--------|-------------|
| Lockpicking (v0.15.4a) | Shim Picks provide +1/+2d10 bonus |
| Terminal Hacking (v0.15.4b) | Wire Probe provides +1/+2d10 bonus; Bypass Clamps skip Layer 1 |
| Trap Disarmament (v0.15.4d) | Salvage source only (no dedicated tool yet) |
| Glitch Exploitation (v0.15.4f) | Glitch Trigger forces glitch state |

### With Jury-Rigging System (v0.15.4e)

The crafting system complements jury-rigging by providing reusable tools rather than one-time modifications. Characters can choose between:
- **Jury-Rigging:** Immediate, one-time modifications
- **Improvised Crafting:** Reusable tools requiring component investment

---

## Dependencies

| Dependency | Usage |
|------------|-------|
| IDiceService | Dice rolling for crafting checks (d10 pools), fumble damage (d6), salvage chance (d6) |
| ILogger&lt;T&gt; | Exhaustive logging at Information/Debug/Warning levels |
| DicePool | D10 pool creation for crafting rolls |

---

## Breaking Changes

None. This version adds new functionality without modifying existing interfaces or contracts.

---

## Acceptance Criteria Status

| Criterion | Status |
|-----------|--------|
| Shim Picks craftable with 3× Scrap Metal at DC 10 | ✅ |
| Wire Probe craftable with 2× Copper Wire + 1× Handle at DC 12 | ✅ |
| Glitch Trigger craftable with 1× Capacitor + 4× Wire at DC 14 | ✅ |
| Bypass Clamps craftable with 4× Metal Clips at DC 12 | ✅ |
| Standard tools provide +1d10 bonus | ✅ |
| Quality tools (critical craft) provide +2d10 bonus | ✅ |
| Standard tools have 3 uses before breaking | ✅ |
| Quality tools have 5 uses before breaking | ✅ |
| Crafting fumble causes 1d6 damage and loses components | ✅ |
| Tools only apply bonus to matching bypass type | ✅ |
| Tinker's Toolkit provides +1d10 crafting bonus | ✅ |
| Workshop access provides +2d10 crafting bonus | ✅ |
| Pressure penalty applies -1d10 to crafting | ✅ |
| Critical bypass successes yield salvage components | ✅ |
| Metal can substitute for Misc component type | ✅ |
| Build succeeds with 0 errors/warnings | ⏳ |
| All tests pass | ⏳ |
| Configuration files validate against schemas | ✅ |
| XML documentation complete for all public types | ✅ |
| Exhaustive logging at appropriate levels | ✅ |

---

## Next Steps

- **v0.15.4h:** Integration of Improvised Tools with existing bypass service flows
- **v0.15.5:** Salvage & Component Identification System
- **v0.15.6:** System Bypass Skill Tree Integration
