# v0.16.3d Changelog - Loot Service Integration

**Release Date:** 2026-01-28

## Overview

Integrates the smart loot system into `LootService`, enabling class-appropriate equipment bias when generating loot drops from defeated monsters with player context.

## Added

### Domain Layer

- **LootDrop** (`src/Core/RuneAndRust.Domain/ValueObjects/LootDrop.cs`)
    - `WasClassAppropriate` — Boolean property indicating class-appropriate selection
    - `PlayerArchetypeId` — Nullable string property for the player's archetype
    - `SelectionReason` — Human-readable explanation of selection logic
    - `BiasRoll` — Integer property storing the 0-99 roll value for debugging
    - `HasPlayerContext` — Computed property for quick archetype null-check
    - `CreateFrom(SmartLootResult, archetypeId, sourceMonster)` — Factory method for smart loot drops
    - `CreateRandom(LootEntry, sourceMonster)` — Factory method for context-less drops

- **DroppedItem** (`src/Core/RuneAndRust.Domain/ValueObjects/DroppedItem.cs`)
    - `CreateFromLootEntry(LootEntry, quantity?)` — Factory method converting `LootEntry` to `DroppedItem`
    - `ConvertKebabToTitleCase(string)` — Helper for deriving display names from IDs

### Application Layer

- **ILootService** (`src/Core/RuneAndRust.Application/Interfaces/ILootService.cs`)
    - `GenerateLoot(Monster, Player)` — New method signature for smart loot generation

- **LootService** (`src/Core/RuneAndRust.Application/Services/LootService.cs`)
    - `ISmartLootService?` — Optional dependency injection for smart loot
    - Implemented `GenerateLoot(Monster, Player)` with smart loot integration
    - Fallback to basic generation when player context unavailable
    - Comprehensive logging at Information and Debug levels

### Testing

- **LootDropSmartLootTests** (7 tests)
    - `CreateFrom` with class-appropriate and random results
    - `CreateRandom` default values
    - `HasPlayerContext` computed property
    - `Empty` static property defaults

- **LootServiceSmartLootTests** (5 tests)
    - Null monster/player handling
    - Smart loot service unavailability
    - Monster without definition ID or loot table

## Dependencies

- Requires v0.16.3b (Smart Loot Algorithm) for `ISmartLootService`
- Requires v0.16.3c (Weighted Selection) for `WeightedItemPool`
