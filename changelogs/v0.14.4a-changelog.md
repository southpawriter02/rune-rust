# v0.14.4a Changelog - Biome Schema

## Summary

Implemented `biomes.schema.json` with comprehensive validation for biome definitions, the first schema in the v0.14.4 Environment Configuration Schemas series. The schema includes 7 distinct definitions that work together to define complete biome configurations: environmental category values (climate, lighting, era, condition), descriptor system integration (implied tags, pool overrides, term filters), monster spawn tables with depth-based filtering, terrain distribution percentages, hazard frequency with depth scaling, and audio associations. This schema enables full customization of biome environments without code changes, supporting modding scenarios such as sci-fi space stations, underwater caverns, haunted mansions, or procedurally generated wilderness areas.

## Added

### Schema Files
- **[config/schemas/biomes.schema.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/schemas/biomes.schema.json)** - JSON Schema Draft-07 for biome configuration

### Schema Definitions (7 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `BiomeDefinition` | Complete biome with environmental categories and spawn config | id, name, description, defaultCategoryValues, impliedTags, descriptorPoolOverrides, emphasizedTerms, excludedTerms |
| `DefaultCategories` | Environmental category values | climate, lighting |
| `SpawnTable` | Monster spawn configuration | entries |
| `SpawnEntry` | Single monster spawn entry with weight | monsterId |
| `TerrainDistribution` | Terrain type percentages | entries |
| `TerrainEntry` | Single terrain entry with percentage | terrainId, percentage |
| `HazardFrequency` | Hazard spawn frequency configuration | (all optional with defaults) |

### BiomeDefinition Properties
| Property | Type | Constraint | Description |
|----------|------|------------|-------------|
| `id` | string | Pattern: `^[a-z][a-z0-9-]*$` | Unique identifier (kebab-case) |
| `name` | string | minLength: 1 | Display name (required) |
| `description` | string | (required) | Flavor text describing the biome |
| `defaultCategoryValues` | DefaultCategories | (required) | Climate, lighting, era, condition |
| `impliedTags` | array | (required) | Tags for descriptor filtering |
| `descriptorPoolOverrides` | object | (required) | Category to pool ID mapping |
| `emphasizedTerms` | array | (required) | Terms to prioritize in descriptors |
| `excludedTerms` | array | (required) | Terms to filter from descriptors |
| `monsterSpawnTable` | SpawnTable | (optional) | Monster spawn configuration |
| `terrainDistribution` | TerrainDistribution | (optional) | Terrain percentage allocation |
| `hazardFrequency` | HazardFrequency | (optional) | Hazard spawn frequency |
| `musicThemeId` | string | Pattern validated | Reference to music-themes.json |
| `ambientSoundId` | string | Pattern validated | Reference to sound-effects.json |
| `sortOrder` | integer | >= 0 | Display order |

### Climate Enumeration (6 values)
| Climate | Description | Effect |
|---------|-------------|--------|
| `freezing` | Extreme cold | Cold damage over time |
| `cold` | Chilly environment | Minor stamina drain |
| `temperate` | Comfortable temperature | No effect |
| `warm` | Heated environment | Minor stamina drain |
| `hot` | Very warm | Increased stamina drain |
| `scorching` | Extreme heat | Fire damage over time |

### Lighting Enumeration (4 values)
| Lighting | Description | Effect |
|----------|-------------|--------|
| `dark` | No natural light | Severely reduced sight |
| `dim` | Minimal light | Reduced sight range |
| `normal` | Standard lighting | Normal visibility |
| `bright` | Ample light | Extended sight range |

### Era Enumeration (4 values, optional)
| Era | Description | Architectural Style |
|-----|-------------|---------------------|
| `ancient` | Primordial structures | Ruins, temples, tombs |
| `medieval` | Historical period | Castles, dungeons, keeps |
| `modern` | Contemporary | Buildings, bunkers |
| `futuristic` | Advanced technology | Space stations, labs |

### Condition Enumeration (6 values, optional)
| Condition | Description | Visual Effect |
|-----------|-------------|---------------|
| `pristine` | Perfect state | Clean, maintained |
| `weathered` | Worn but intact | Faded, aged |
| `ruined` | Damaged areas | Broken sections |
| `collapsed` | Partially destroyed | Debris, blocked paths |
| `flooded` | Water-filled | Pools, streams |
| `overgrown` | Vegetation covered | Vines, roots, moss |

### Configuration Updates
- **[config/biomes.json](file:///Volumes/GitHub/github/southpawriter02/rune-rust/config/biomes.json)** - Updated with `$schema` reference to new schema
  - All 8 existing biomes validate: cave, dungeon, volcanic, frozen, swamp, ruins, forest, desert

### Unit Tests
- **[BiomesSchemaTests.cs](file:///Volumes/GitHub/github/southpawriter02/rune-rust/tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/BiomesSchemaTests.cs)** - 8 tests
  - `Schema_IsValidJsonSchemaDraft07` - Schema structure validation (7 definitions)
  - `BiomesJson_ValidatesAgainstSchema` - Backwards compatibility (8 biomes)
  - `Climate_InvalidEnum_FailsValidation` - Climate enum (6 values)
  - `Lighting_InvalidEnum_FailsValidation` - Lighting enum (4 values)
  - `TerrainPercentage_OutOfRange_FailsValidation` - Percentage 0-100 range
  - `HazardBaseChance_OutOfRange_FailsValidation` - Base chance 0-1 range
  - `SpawnWeight_LessThanOne_FailsValidation` - Weight >= 1 validation
  - `BiomeId_InvalidPattern_FailsValidation` - Kebab-case pattern

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/biomes.schema.json` | Added |
| `config/biomes.json` | Modified ($schema reference) |
| `tests/.../Schemas/BiomesSchemaTests.cs` | Added |
| `changelogs/v0.14.4a-changelog.md` | Added |

## Test Results

```
Test summary: total: 8, failed: 0, succeeded: 8, skipped: 0
Build succeeded with 0 errors
```

## Example Biome Structure

```
Volcanic Biome (volcanic)
├── Default Categories
│   ├── Climate: scorching (extreme heat)
│   └── Lighting: dim (minimal light)
├── Descriptor Configuration
│   ├── Implied Tags: [volcanic, heat, danger, fire]
│   ├── Pool Overrides:
│   │   ├── environmental.lighting → environmental.lighting.volcanic
│   │   ├── environmental.temperature → environmental.temperature.volcanic
│   │   └── environmental.smells → environmental.smells.volcanic
│   ├── Emphasized: [lava, sulfur, heat, glow, magma]
│   └── Excluded: [cold, ice, frost, chill, freezing]
└── Optional Spawn Configuration (if defined)
    ├── Monster Spawn Table: fire_elemental, magma_slime, etc.
    ├── Terrain Distribution: lava_pool 15%, lava_rock 20%, stone 65%
    └── Hazard Frequency: 20% base, +2% per depth
```

## Descriptor System Integration

```
┌─────────────────────────────────────────────────────────────────┐
│  1. Request description for room in "volcanic" biome            │
│        │                                                        │
│        ▼                                                        │
│  2. Load impliedTags: [volcanic, heat, danger, fire]            │
│        │                                                        │
│        ▼                                                        │
│  3. Apply descriptorPoolOverrides:                              │
│     • environmental.lighting → environmental.lighting.volcanic  │
│     • environmental.temperature → environmental.temperature.volcanic │
│        │                                                        │
│        ▼                                                        │
│  4. Select descriptors from pools                               │
│        │                                                        │
│        ▼                                                        │
│  5. Boost emphasizedTerms: [lava, sulfur, heat, glow]           │
│        │                                                        │
│        ▼                                                        │
│  6. Remove excludedTerms: [cold, ice, frost, chill]             │
│        │                                                        │
│        ▼                                                        │
│  7. Generate final description                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Modding Scenarios Enabled

After this implementation, modders can:
- Create new biome types with custom environmental categories
- Define thematic descriptor filtering with implied tags
- Override specific descriptor pools for biome-specific text
- Control term emphasis and exclusion for thematic consistency
- Configure monster spawn tables with weighted entries
- Set depth-based spawn restrictions for progressive difficulty
- Define terrain distribution percentages for room generation
- Configure hazard frequency with depth scaling
- Associate music themes and ambient sounds

---

*First entry in v0.14.4 Environment Configuration Schemas series. See also: v0.14.4b (Room Type Schema), v0.14.4c (Terrain Schema Expansion), v0.14.4d (Interactive Object Schema).*
