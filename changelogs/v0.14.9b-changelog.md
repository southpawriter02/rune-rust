# v0.14.9b Changelog - Ability Descriptor Schema

## Summary

Introduced the comprehensive **Ability Descriptor Schema** (`ability-descriptors.schema.json`) which validates Galdr (magic) and ability flavor text descriptors including casting sequences, manifestation descriptions, outcome narratives, miscast effects, weapon art descriptions, and skill usage flavor text. This schema enables full customization of all ability-related narrative content in the game, supporting the Norse runic magic system (24 Elder Futhark runes), weapon arts, and general skill usage descriptions—all without code changes. This is the second entry in the v0.14.9 Advanced Descriptor Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/ability-descriptors.schema.json](config/schemas/ability-descriptors.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (8 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `GaldrActionDescriptor` | Casting sequence flavor text | id, text, actionType |
| `GaldrManifestationDescriptor` | Sensory manifestation effects | id, text, manifestationType, runeSchool |
| `GaldrOutcomeDescriptor` | Ability outcome narratives | id, text, outcomeType, abilityName |
| `GaldrMiscastDescriptor` | Magical failure narratives | id, text, miscastType, severity |
| `WeaponArtDescriptor` | Combat ability flavor text | id, text, abilityCategory, abilityName |
| `SkillUsageDescriptor` | Skill action flavor text | id, text, skillName |
| `RuneSchool` | 24 Elder Futhark runes enum | - |
| `SuccessLevel` | Success/failure levels enum | - |

### Category Enumeration (6 values)

| Category | Description | File Pattern |
|----------|-------------|--------------|
| `galdr-actions` | Galdr casting sequences | galdr-actions.json |
| `galdr-manifestations` | Sensory magic effects | galdr-manifestations.json |
| `galdr-outcomes` | Ability results | galdr-outcomes.json |
| `galdr-miscasts` | Magical failures | galdr-miscasts.json |
| `weapon-arts` | Combat ability flavor | weapon-arts.json |
| `skill-usage` | Skill action flavor | skill-usage.json |

### Action Type Enumeration (7 values)

| Type | Phase | Description |
|------|-------|-------------|
| `Invocation` | Beginning | Player begins casting |
| `Chant` | Continuation | Runic recitation |
| `RuneManifestation` | Visual | Rune appears |
| `Discharge` | Release | Magic effect fires |
| `Aftermath` | Post-cast | Environmental effects |
| `EffectTrigger` | Reactive | Ward/triggered effect |
| `Activation` | Buff/Toggle | Ability activation |

### Manifestation Type Enumeration (5 values)

| Type | Sense | Description |
|------|-------|-------------|
| `Visual` | Sight | Lights, colors, shapes |
| `Auditory` | Hearing | Sounds, words, music |
| `Tactile` | Touch | Temperature, pressure |
| `Supernatural` | Otherworldly | Unnatural effects |
| `RunicGlyph` | Sight | Rune symbol appearance |

### Outcome Type Enumeration (8 values)

| Type | Description |
|------|-------------|
| `Hit` | Standard successful attack |
| `Miss` | Attack failed to connect |
| `CriticalHit` | Devastating success |
| `PartialEffect` | Reduced effectiveness |
| `FullEffect` | Complete success |
| `Resisted` | Target reduced effect |
| `Immune` | Target unaffected |
| `Amplified` | Enhanced effect |

### Miscast Type Enumeration (7 values)

| Type | Description |
|------|-------------|
| `BlightCorruption` | Runic Blight corrupts spell |
| `Paradox` | Reality rebels against magic |
| `Backlash` | Magic recoils on caster |
| `Fizzle` | Spell fails harmlessly |
| `WildMagic` | Uncontrolled random effects |
| `AlfheimDistortion` | Cursed Choir interference |
| `RunicInversion` | Rune meaning reverses |

### Severity Enumeration (4 values)

| Severity | Effect Range | Description |
|----------|--------------|-------------|
| `Minor` | None-Cosmetic | Embarrassing but harmless |
| `Moderate` | 5-8 damage, 1-2 turn debuff | Painful but recoverable |
| `Severe` | 8-12 damage, 2-3 turn debuff | Significant consequences |
| `Catastrophic` | 12+ damage, permanent effects | Devastating, potentially fatal |

### Rune School Enumeration (24 Elder Futhark Runes)

| Rune | Name | Symbol | Domain |
|------|------|--------|--------|
| 1 | Fehu | ᚠ | Fire/Wealth |
| 2 | Uruz | ᚢ | Strength/Health |
| 3 | Thurisaz | ᚦ | Ice/Thorns |
| 4 | Ansuz | ᚨ | Wind/Divine |
| 5 | Raido | ᚱ | Journey/Movement |
| 6 | Kenaz | ᚲ | Torch/Knowledge |
| 7 | Gebo | ᚷ | Gift/Exchange |
| 8 | Wunjo | ᚹ | Joy/Harmony |
| 9 | Hagalaz | ᚺ | Hail/Destruction |
| 10 | Naudiz | ᚾ | Need/Constraint |
| 11 | Isa | ᛁ | Ice/Stillness |
| 12 | Jera | ᛃ | Year/Harvest |
| 13 | Eihwaz | ᛇ | Yew/Death |
| 14 | Perthro | ᛈ | Mystery/Fate |
| 15 | Algiz | ᛉ | Protection/Elk |
| 16 | Sowilo | ᛊ | Sun/Victory |
| 17 | Tiwaz | ᛏ | Tyr/Justice |
| 18 | Berkanan | ᛒ | Birch/Growth |
| 19 | Ehwaz | ᛖ | Horse/Partnership |
| 20 | Mannaz | ᛗ | Man/Mind |
| 21 | Laguz | ᛚ | Water/Flow |
| 22 | Ingwaz | ᛝ | Ing/Fertility |
| 23 | Dagaz | ᛞ | Day/Awakening |
| 24 | Othala | ᛟ | Heritage/Home |

### Success Level Enumeration (5 values)

| Level | Successes | Description |
|-------|-----------|-------------|
| `MinorSuccess` | 1-2 | Barely achieved |
| `SolidSuccess` | 3-4 | Standard success |
| `ExceptionalSuccess` | 5+ | Outstanding result |
| `Failure` | 0 | Did not succeed |
| `CriticalFailure` | Special | Catastrophic failure |

### Weapon Type Enumeration (7 values)

| Type | Description |
|------|-------------|
| `TwoHanded` | Two-handed weapons |
| `OneHanded` | One-handed weapons |
| `DualWield` | Dual-wielded weapons |
| `Bow` | Ranged bow |
| `Crossbow` | Ranged crossbow |
| `Unarmed` | No weapon |
| `Shield` | Shield-based |

### Ability Category Enumeration (5 values)

| Category | Description |
|----------|-------------|
| `WeaponArt` | Special weapon attacks |
| `TacticalAbility` | Combat maneuvers |
| `DefensiveAbility` | Protective actions |
| `PassiveAbility` | Constant effects |
| `ResourceAbility` | Resource management |

### Configuration Files (4 Example Files)

| File | Description | Pools Count |
|------|-------------|-------------|
| `galdr-actions.json` | Galdr casting sequences | 8 pools |
| `galdr-miscasts.json` | Magical failure narratives | 8 pools |
| `galdr-outcomes.json` | Ability outcome narratives | 8 pools |
| `weapon-arts.json` | Combat ability flavor | 5 pools |

### Variable Placeholders Documented

| Category | Variables |
|----------|-----------|
| Character | `{Caster}`, `{Target}`, `{Enemy}`, `{Ally}` |
| Ability | `{Ability}`, `{Rune}`, `{RuneSymbol}`, `{Element}` |
| Weapon | `{Weapon}`, `{WeaponType}` |
| Outcome | `{Damage}`, `{SuccessCount}`, `{Healing}`, `{Duration}` |
| Location | `{Target_Location}`, `{Vital_Location}`, `{Biome}`, `{Environment_Feature}` |
| Corruption | `{BlightEffect}`, `{ParadoxManifestation}`, `{CorruptionLevel}` |

### Unit Tests
- **[AbilityDescriptorSchemaTests.cs](tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/AbilityDescriptorSchemaTests.cs)** - 103 tests
  - `AbilityDescriptorSchema_LoadsAndParses_Successfully` - Schema structure validation (8 definitions)
  - `AbilityDescriptorSchema_*_PassesValidation` - 4 tests for configuration files
  - `GaldrActionDescriptor_*` - 9 tests for action descriptor validation
  - `RuneSchool_*` - 28 tests for all 24 rune schools + invalid cases
  - `SuccessLevel_*` - 9 tests for success level validation
  - `GaldrMiscastDescriptor_*` - 15 tests for miscast validation
  - `PoolIdPattern_*` - 10 tests for pool ID pattern validation
  - `WeaponArtDescriptor_*` - 15 tests for weapon art validation
  - `Configuration_*` - 13 tests for root configuration validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/ability-descriptors.schema.json` | Added |
| `config/ability-descriptors/galdr-actions.json` | Added |
| `config/ability-descriptors/galdr-miscasts.json` | Added |
| `config/ability-descriptors/galdr-outcomes.json` | Added |
| `config/ability-descriptors/weapon-arts.json` | Added |
| `tests/.../Schemas/AbilityDescriptorSchemaTests.cs` | Added |
| `changelogs/v0.14.9b-changelog.md` | Added |

## Test Results

```
Test summary: total: 103, failed: 0, succeeded: 99, skipped: 4
Build succeeded with 0 errors

Note: 4 tests skipped due to NJsonSchema limitation with propertyNames 
pattern validation. Pool ID patterns are validated by external tooling 
(VS Code, JSON Schema CLI validators).
```

## Schema Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  ABILITY DESCRIPTOR CONFIGURATION                               │
├─────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"             │
│  type: object                                                   │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ROOT PROPERTIES                                          │  │
│  │  version: "1.0.0"       (semver format)                   │  │
│  │  category: "galdr-actions" | "galdr-miscasts" | ...       │  │
│  │  pools: { poolId: [descriptors] }                         │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  DESCRIPTOR POOLS (additionalProperties)                  │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ "fehu_flamebolt_solid": [                           │  │  │
│  │  │   { id, text, actionType, runeSchool, weight, ... } │  │  │
│  │  │ ]                                                   │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  GALDR ACTION DESCRIPTOR                                  │  │
│  │  id: "fehu_flamebolt_solid_001"                           │  │
│  │  text: "You sing the Fehu rune..." (with {Variables})     │  │
│  │  weight: 10 (selection probability)                       │  │
│  │  actionType: "Invocation" | "Discharge" | ...             │  │
│  │  runeSchool: "Fehu" | null (generic)                      │  │
│  │  successLevel: "SolidSuccess" | null                      │  │
│  │  tags: ["Verbose", "Dramatic"]                            │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  GALDR MISCAST DESCRIPTOR                                 │  │
│  │  id: "blight_corruption_moderate_001"                     │  │
│  │  text: "The Blight corrupts your Galdr!"                  │  │
│  │  miscastType: "BlightCorruption" | "Paradox" | ...        │  │
│  │  severity: "Minor" | "Moderate" | "Severe" | "Catastrophic"│
│  │  mechanicalEffect: { damage, status, duration, ... }      │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  WEAPON ART DESCRIPTOR                                    │  │
│  │  id: "whirlwind_strike_001"                               │  │
│  │  text: "You spin your {Weapon} in a deadly arc!"          │  │
│  │  abilityCategory: "WeaponArt" | "TacticalAbility" | ...   │  │
│  │  abilityName: "WhirlwindStrike"                           │  │
│  │  weaponType: "TwoHanded" | null                           │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Galdr Casting Flow

```
  Player casts Galdr ability
               │
               ▼
    ┌──────────────────────────┐
    │ 1. INVOCATION            │
    │ "You invoke Fehu..."     │
    │ (ActionType: Invocation) │
    └────────────┬─────────────┘
                 │
                 ▼
    ┌──────────────────────────┐
    │ 2. RUNE MANIFESTATION    │
    │ "The rune blazes crimson"│
    │ (ActionType: RuneManifestation)
    └────────────┬─────────────┘
                 │
                 ▼
    ┌──────────────────────────┐
    │ 3. DISCHARGE             │
    │ "Fire answers your call!"│
    │ (ActionType: Discharge)  │
    └────────────┬─────────────┘
                 │
        ┌────────┴────────┐
        │                 │
     Success           Failure
        │                 │
        ▼                 ▼
 ┌─────────────┐  ┌─────────────┐
 │ 4a. OUTCOME │  │ 4b. MISCAST │
 │ "{Target}   │  │ "The Blight │
 │  is burned!"│  │  warps      │
 │             │  │  Fehu!"     │
 └─────────────┘  └─────────────┘
```

## v0.14.9 Advanced Descriptor Schemas - Progress

| Version | Schema | Tests | Status |
|---------|--------|-------|--------|
| v0.14.9a | `dialogue.schema.json` | 76 ✓ | Complete |
| v0.14.9b | `ability-descriptors.schema.json` | 103 ✓ | **Complete** |
| v0.14.9c | `npc-descriptors.schema.json` | ~6 | Pending |
| v0.14.9d | `psychological-descriptors.schema.json` | ~6 | Pending |
| v0.14.9e | `capture-templates.schema.json` | ~6 | Pending |
| **Total** | **5 schemas** | **~197 tests** | 2/5 complete |

## Modding Scenarios Enabled

After this implementation, modders can:
- Add custom Galdr abilities with unique casting sequences per rune school
- Create ability-specific flavor text for any of the 24 Elder Futhark runes
- Define success-level-specific descriptions (minor, solid, exceptional)
- Add miscast effects with mechanical consequences (damage, status, corruption)
- Create biome-specific ability variants (Muspelheim fire bonuses, etc.)
- Design weapon arts for any weapon type with category-specific descriptions
- Customize skill usage flavor text for non-combat skill checks
- Use variable placeholders for dynamic content substitution

---

*Second entry in v0.14.9 Advanced Descriptor Configuration Schemas series. Next: v0.14.9c (NPC Descriptor Schema).*
