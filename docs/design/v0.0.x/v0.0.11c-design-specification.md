# v0.0.11c Design Specification: Environmental & Sensory Descriptors

**Version:** 0.0.11c
**Phase Name:** Environmental & Sensory Descriptors
**Parent Version:** v0.0.11 (Descriptors & Ambience)
**Prerequisites:** v0.0.11a Complete (Descriptor Framework Expansion)
**Estimated Tests:** ~18 unit tests

---

## 1. Overview

### 1.1 Purpose

Create a rich sensory layer system with detailed lighting, ambient sounds, smells, temperature sensations, and weather effects. Each sense provides distinct, coherent descriptors based on the environment context established in v0.0.11a, creating immersive atmospheric descriptions that engage multiple senses.

### 1.2 Current State

| Area | Current State (v0.0.11a) | Target State (v0.0.11c) |
|------|--------------------------|-------------------------|
| Lighting | Single generic pool | Light source types + darkness levels |
| Sounds | Single pool, no layering | Layered system (distant, nearby, immediate) |
| Smells | Single pool | Biome-specific pools + intensity levels |
| Temperature | Single pool | Climate-integrated descriptors |
| Weather | Not implemented | Indoor/outdoor weather conditions |
| Time of day | Not implemented | Dawn, day, dusk, night effects |
| Combination | Random 2-3 elements | Coherent multi-sense generation |

### 1.3 Design Principles

1. **Multi-Sensory Immersion**: Engage sight, sound, smell, touch (temperature) for rich atmosphere
2. **Layered Depth**: Sounds have distance layers, smells have intensity levels
3. **Coherence**: All senses work together within biome/climate context
4. **Biome-Driven**: Each biome has sensory preferences and exclusions
5. **Configurable**: All sensory pools loaded from JSON

---

## 2. Scope

### 2.1 In Scope

- Light source type definitions (torch, crystal, bioluminescence, sunlight, magical, moonlight)
- Darkness level descriptors (pitch black, dim, shadowy, normal, bright, blinding)
- Layered ambient sound system (distant, nearby, immediate layers)
- Biome-specific sound pools (cave, dungeon, forest, volcanic, frozen, swamp)
- Smell intensity levels (faint, noticeable, strong, overwhelming)
- Biome-specific smell pools
- Temperature sensation descriptors integrated with climate category
- Weather condition descriptors (rain, wind, storm, snow, fog)
- Indoor vs outdoor weather variants
- Time-of-day effects (dawn, day, dusk, night)
- `SensoryDescriptorService` for multi-sense generation
- `SensoryDescription` value object for combined output
- Configuration files: `lighting.json`, `sounds.json`, `smells.json`, `weather.json`

### 2.2 Out of Scope (Future Phases)

- Interactive objects (v0.0.11d)
- Ambient events (v0.0.11d)
- Game mechanics based on senses (visibility, hearing checks - future version)
- Dynamic weather changes during gameplay (future version)

---

## 3. Data Model

### 3.1 New: SensoryDescription (Value Object)

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// A complete multi-sense description of an environment.
/// </summary>
/// <remarks>
/// Combines visual, auditory, olfactory, and tactile sensations into
/// a coherent atmospheric description. Each sense can have multiple
/// descriptors that work together to create immersion.
/// </remarks>
public readonly record struct SensoryDescription
{
    /// <summary>
    /// Visual description including lighting and visibility.
    /// </summary>
    public LightingDescription Lighting { get; init; }

    /// <summary>
    /// Layered sound descriptions by distance.
    /// </summary>
    public SoundDescription Sounds { get; init; }

    /// <summary>
    /// Smell description with intensity.
    /// </summary>
    public SmellDescription Smell { get; init; }

    /// <summary>
    /// Temperature sensation description.
    /// </summary>
    public string Temperature { get; init; }

    /// <summary>
    /// Weather condition description if applicable.
    /// </summary>
    public string? Weather { get; init; }

    /// <summary>
    /// Time of day effects if applicable.
    /// </summary>
    public string? TimeOfDay { get; init; }

    /// <summary>
    /// Returns true if any sensory descriptions are present.
    /// </summary>
    public bool HasDescriptions =>
        !string.IsNullOrEmpty(Lighting.Description) ||
        Sounds.HasSounds ||
        !string.IsNullOrEmpty(Smell.Description) ||
        !string.IsNullOrEmpty(Temperature);

    /// <summary>
    /// Combines all sensory descriptions into a narrative paragraph.
    /// </summary>
    /// <param name="maxSenses">Maximum number of senses to include (default 4).</param>
    /// <returns>A combined atmospheric description.</returns>
    public string ToNarrative(int maxSenses = 4)
    {
        var parts = new List<string>();

        // Add lighting first (sets the visual scene)
        if (!string.IsNullOrEmpty(Lighting.Description))
            parts.Add(Lighting.Description);

        // Add primary sound
        if (!string.IsNullOrEmpty(Sounds.Primary))
            parts.Add(Sounds.Primary);

        // Add smell
        if (!string.IsNullOrEmpty(Smell.Description))
            parts.Add(Smell.Description);

        // Add temperature
        if (!string.IsNullOrEmpty(Temperature))
            parts.Add(Temperature);

        // Add weather if present
        if (!string.IsNullOrEmpty(Weather))
            parts.Add(Weather);

        // Limit to max senses
        var selected = parts.Take(maxSenses);

        return string.Join(" ", selected);
    }
}

/// <summary>
/// Lighting and visibility description.
/// </summary>
/// <param name="Description">The lighting description text.</param>
/// <param name="LightSource">The type of light source (torch, crystal, etc.).</param>
/// <param name="DarknessLevel">The darkness level (dim, bright, etc.).</param>
public readonly record struct LightingDescription(
    string Description,
    string? LightSource,
    string? DarknessLevel);

/// <summary>
/// Layered sound description.
/// </summary>
public readonly record struct SoundDescription
{
    /// <summary>
    /// Distant background sounds (echoes, wind, thunder).
    /// </summary>
    public string? Distant { get; init; }

    /// <summary>
    /// Nearby room-level sounds (dripping, creaking, breathing).
    /// </summary>
    public string? Nearby { get; init; }

    /// <summary>
    /// Immediate close sounds (your heartbeat, nearby creatures).
    /// </summary>
    public string? Immediate { get; init; }

    /// <summary>
    /// Gets the primary sound (first non-null layer).
    /// </summary>
    public string? Primary => Nearby ?? Distant ?? Immediate;

    /// <summary>
    /// Returns true if any sound layers are present.
    /// </summary>
    public bool HasSounds =>
        !string.IsNullOrEmpty(Distant) ||
        !string.IsNullOrEmpty(Nearby) ||
        !string.IsNullOrEmpty(Immediate);

    /// <summary>
    /// Combines all sound layers into a single description.
    /// </summary>
    public string ToFullDescription()
    {
        var parts = new List<string>();
        if (!string.IsNullOrEmpty(Distant)) parts.Add(Distant);
        if (!string.IsNullOrEmpty(Nearby)) parts.Add(Nearby);
        if (!string.IsNullOrEmpty(Immediate)) parts.Add(Immediate);
        return string.Join(" ", parts);
    }
}

/// <summary>
/// Smell description with intensity.
/// </summary>
/// <param name="Description">The formatted smell description.</param>
/// <param name="Intensity">The smell intensity level.</param>
/// <param name="SmellType">The type of smell (decay, sulfur, etc.).</param>
public readonly record struct SmellDescription(
    string Description,
    SmellIntensity Intensity,
    string? SmellType);

/// <summary>
/// Smell intensity levels.
/// </summary>
public enum SmellIntensity
{
    /// <summary>Barely noticeable.</summary>
    Faint,

    /// <summary>Clearly present.</summary>
    Noticeable,

    /// <summary>Dominant odor.</summary>
    Strong,

    /// <summary>Nearly unbearable.</summary>
    Overwhelming
}
```

### 3.2 New: LightSourceDefinition (Configuration)

**File:** `src/Core/RuneAndRust.Application/Configuration/SensoryConfiguration.cs`

```csharp
namespace RuneAndRust.Application.Configuration;

/// <summary>
/// Configuration for sensory descriptor pools.
/// </summary>
public class SensoryConfiguration
{
    /// <summary>
    /// Light source definitions.
    /// </summary>
    public IReadOnlyDictionary<string, LightSourceDefinition> LightSources { get; init; } =
        new Dictionary<string, LightSourceDefinition>();

    /// <summary>
    /// Darkness level definitions.
    /// </summary>
    public IReadOnlyDictionary<string, DarknessLevelDefinition> DarknessLevels { get; init; } =
        new Dictionary<string, DarknessLevelDefinition>();

    /// <summary>
    /// Weather condition definitions.
    /// </summary>
    public IReadOnlyDictionary<string, WeatherDefinition> WeatherConditions { get; init; } =
        new Dictionary<string, WeatherDefinition>();

    /// <summary>
    /// Time of day definitions.
    /// </summary>
    public IReadOnlyDictionary<string, TimeOfDayDefinition> TimesOfDay { get; init; } =
        new Dictionary<string, TimeOfDayDefinition>();
}

/// <summary>
/// Defines a light source type with visual characteristics.
/// </summary>
public class LightSourceDefinition
{
    /// <summary>
    /// Light source identifier (e.g., "torch", "crystal").
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Light color/quality (e.g., "warm orange", "cold blue").
    /// </summary>
    public string LightQuality { get; init; } = string.Empty;

    /// <summary>
    /// Descriptor pool path for this light source.
    /// </summary>
    public string DescriptorPool { get; init; } = string.Empty;

    /// <summary>
    /// Atmospheric mood this light creates.
    /// </summary>
    public string Atmosphere { get; init; } = string.Empty;

    /// <summary>
    /// Biomes where this light source is common.
    /// </summary>
    public IReadOnlyList<string> CommonBiomes { get; init; } = [];

    /// <summary>
    /// Whether this light source flickers/moves.
    /// </summary>
    public bool IsFlickering { get; init; }
}

/// <summary>
/// Defines a darkness/visibility level.
/// </summary>
public class DarknessLevelDefinition
{
    /// <summary>
    /// Darkness level identifier (e.g., "dim", "bright").
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Numeric visibility level (0 = pitch black, 100 = blinding).
    /// </summary>
    public int VisibilityLevel { get; init; }

    /// <summary>
    /// Descriptor pool path for this darkness level.
    /// </summary>
    public string DescriptorPool { get; init; } = string.Empty;

    /// <summary>
    /// Tags applied when at this darkness level.
    /// </summary>
    public IReadOnlyList<string> ImpliedTags { get; init; } = [];
}

/// <summary>
/// Defines a weather condition.
/// </summary>
public class WeatherDefinition
{
    /// <summary>
    /// Weather condition identifier (e.g., "rain", "storm").
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Descriptor pool for indoor effects.
    /// </summary>
    public string IndoorPool { get; init; } = string.Empty;

    /// <summary>
    /// Descriptor pool for outdoor effects.
    /// </summary>
    public string OutdoorPool { get; init; } = string.Empty;

    /// <summary>
    /// Climate values where this weather can occur.
    /// </summary>
    public IReadOnlyList<string> ValidClimates { get; init; } = [];

    /// <summary>
    /// Whether this weather affects visibility.
    /// </summary>
    public bool AffectsVisibility { get; init; }

    /// <summary>
    /// Whether this weather affects sound (muffling, etc.).
    /// </summary>
    public bool AffectsSound { get; init; }
}

/// <summary>
/// Defines a time of day period.
/// </summary>
public class TimeOfDayDefinition
{
    /// <summary>
    /// Time period identifier (e.g., "dawn", "night").
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Descriptor pool for outdoor effects.
    /// </summary>
    public string OutdoorPool { get; init; } = string.Empty;

    /// <summary>
    /// Light quality during this time period.
    /// </summary>
    public string LightQuality { get; init; } = string.Empty;

    /// <summary>
    /// Default darkness level for outdoor areas.
    /// </summary>
    public string DefaultDarknessLevel { get; init; } = string.Empty;

    /// <summary>
    /// Tags applied during this time.
    /// </summary>
    public IReadOnlyList<string> ImpliedTags { get; init; } = [];
}
```

### 3.3 New: SensoryContext (Value Object)

```csharp
namespace RuneAndRust.Application.Services;

/// <summary>
/// Context for sensory descriptor generation.
/// </summary>
public record SensoryContext
{
    /// <summary>
    /// The environment context from v0.0.11a.
    /// </summary>
    public EnvironmentContext Environment { get; init; }

    /// <summary>
    /// The current light source type (if known).
    /// </summary>
    public string? LightSource { get; init; }

    /// <summary>
    /// The current weather condition (if any).
    /// </summary>
    public string? Weather { get; init; }

    /// <summary>
    /// The current time of day (if applicable).
    /// </summary>
    public string? TimeOfDay { get; init; }

    /// <summary>
    /// Whether the location is indoors or outdoors.
    /// </summary>
    public bool IsIndoor { get; init; } = true;

    /// <summary>
    /// Whether the location has active combat.
    /// </summary>
    public bool InCombat { get; init; }

    /// <summary>
    /// Additional tags for filtering.
    /// </summary>
    public IReadOnlyList<string> AdditionalTags { get; init; } = [];

    /// <summary>
    /// Gets all effective tags including environment and additional.
    /// </summary>
    public IEnumerable<string> GetAllTags()
    {
        var tags = new List<string>();

        // Add environment-derived tags
        if (Environment.DerivedTags != null)
            tags.AddRange(Environment.DerivedTags);

        // Add biome as tag
        if (!string.IsNullOrEmpty(Environment.Biome))
            tags.Add(Environment.Biome);

        // Add climate as tag
        if (!string.IsNullOrEmpty(Environment.Climate))
            tags.Add(Environment.Climate);

        // Add indoor/outdoor tag
        tags.Add(IsIndoor ? "indoor" : "outdoor");

        // Add combat tag
        if (InCombat)
            tags.Add("combat");

        // Add additional tags
        tags.AddRange(AdditionalTags);

        return tags.Distinct();
    }
}
```

---

## 4. Services

### 4.1 SensoryDescriptorService

**File:** `src/Core/RuneAndRust.Application/Services/SensoryDescriptorService.cs`

```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Generates multi-sensory environmental descriptions.
/// </summary>
/// <remarks>
/// This service coordinates descriptor selection across all senses,
/// ensuring coherent atmospheric descriptions based on environment context.
/// </remarks>
public class SensoryDescriptorService
{
    private readonly DescriptorService _descriptorService;
    private readonly EnvironmentCoherenceService _coherenceService;
    private readonly SensoryConfiguration _config;
    private readonly ILogger<SensoryDescriptorService> _logger;
    private readonly Random _random = new();

    public SensoryDescriptorService(
        DescriptorService descriptorService,
        EnvironmentCoherenceService coherenceService,
        SensoryConfiguration config,
        ILogger<SensoryDescriptorService> logger)
    {
        _descriptorService = descriptorService ?? throw new ArgumentNullException(nameof(descriptorService));
        _coherenceService = coherenceService ?? throw new ArgumentNullException(nameof(coherenceService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));

        _logger.LogDebug(
            "SensoryDescriptorService initialized with {LightSources} light sources, {WeatherConditions} weather types",
            _config.LightSources.Count, _config.WeatherConditions.Count);
    }

    /// <summary>
    /// Generates a complete multi-sensory description.
    /// </summary>
    /// <param name="context">The sensory context.</param>
    /// <returns>A complete sensory description.</returns>
    public SensoryDescription GenerateSensoryDescription(SensoryContext context)
    {
        _logger.LogDebug(
            "Generating sensory description for biome={Biome}, climate={Climate}",
            context.Environment.Biome, context.Environment.Climate);

        return new SensoryDescription
        {
            Lighting = GetLightingDescription(context),
            Sounds = GetSoundDescription(context),
            Smell = GetSmellDescription(context),
            Temperature = GetTemperatureDescription(context),
            Weather = GetWeatherDescription(context),
            TimeOfDay = GetTimeOfDayDescription(context)
        };
    }

    /// <summary>
    /// Gets a lighting description based on context.
    /// </summary>
    public LightingDescription GetLightingDescription(SensoryContext context)
    {
        var tags = context.GetAllTags().ToList();
        var lightingLevel = context.Environment.Lighting ?? "dim";

        // Determine light source
        var lightSource = context.LightSource ?? InferLightSource(context);

        // Get lighting pool based on source and level
        string poolPath;
        if (!string.IsNullOrEmpty(lightSource) &&
            _config.LightSources.TryGetValue(lightSource, out var sourceDef))
        {
            poolPath = sourceDef.DescriptorPool;
        }
        else
        {
            poolPath = $"environmental.lighting_{lightingLevel}";
        }

        var description = _descriptorService.GetDescriptor(poolPath, tags);

        // Fall back to generic lighting pool
        if (string.IsNullOrEmpty(description))
        {
            description = _descriptorService.GetDescriptor("environmental.lighting", tags);
        }

        return new LightingDescription(description ?? string.Empty, lightSource, lightingLevel);
    }

    /// <summary>
    /// Gets a layered sound description.
    /// </summary>
    public SoundDescription GetSoundDescription(SensoryContext context)
    {
        var tags = context.GetAllTags().ToList();
        var biome = context.Environment.Biome ?? "dungeon";

        // Get distant sounds
        var distant = GetSoundLayer("distant", biome, tags);

        // Get nearby sounds
        var nearby = GetSoundLayer("nearby", biome, tags);

        // Get immediate sounds (more situational)
        string? immediate = null;
        if (context.InCombat)
        {
            immediate = _descriptorService.GetDescriptor("environmental.sounds_immediate_combat", tags);
        }

        return new SoundDescription
        {
            Distant = distant,
            Nearby = nearby,
            Immediate = immediate
        };
    }

    /// <summary>
    /// Gets a smell description with intensity.
    /// </summary>
    public SmellDescription GetSmellDescription(SensoryContext context)
    {
        var tags = context.GetAllTags().ToList();
        var biome = context.Environment.Biome ?? "dungeon";

        // Determine intensity based on biome characteristics
        var intensity = DetermineSmellIntensity(context);

        // Get biome-specific smell
        var poolPath = $"environmental.smells_{biome}";
        var smellType = _descriptorService.GetDescriptor(poolPath, tags);

        // Fall back to generic pool
        if (string.IsNullOrEmpty(smellType))
        {
            smellType = _descriptorService.GetDescriptor("environmental.smells", tags);
        }

        // Format with intensity template
        var description = FormatSmellWithIntensity(smellType, intensity);

        return new SmellDescription(description, intensity, ExtractSmellType(smellType));
    }

    /// <summary>
    /// Gets a temperature description based on climate.
    /// </summary>
    public string GetTemperatureDescription(SensoryContext context)
    {
        var tags = context.GetAllTags().ToList();
        var climate = context.Environment.Climate ?? "temperate";

        // Get climate-specific temperature pool
        var poolPath = $"environmental.temperature_{climate}";
        var description = _descriptorService.GetDescriptor(poolPath, tags);

        // Fall back to generic pool
        if (string.IsNullOrEmpty(description))
        {
            description = _descriptorService.GetDescriptor("environmental.temperature", tags);
        }

        return description ?? string.Empty;
    }

    /// <summary>
    /// Gets a weather description if applicable.
    /// </summary>
    public string? GetWeatherDescription(SensoryContext context)
    {
        if (string.IsNullOrEmpty(context.Weather)) return null;

        if (!_config.WeatherConditions.TryGetValue(context.Weather, out var weatherDef))
        {
            _logger.LogDebug("Unknown weather condition: {Weather}", context.Weather);
            return null;
        }

        // Validate weather is appropriate for climate
        var climate = context.Environment.Climate ?? "temperate";
        if (weatherDef.ValidClimates.Count > 0 && !weatherDef.ValidClimates.Contains(climate))
        {
            _logger.LogDebug(
                "Weather {Weather} not valid for climate {Climate}",
                context.Weather, climate);
            return null;
        }

        var tags = context.GetAllTags().ToList();
        var poolPath = context.IsIndoor ? weatherDef.IndoorPool : weatherDef.OutdoorPool;

        return _descriptorService.GetDescriptor(poolPath, tags);
    }

    /// <summary>
    /// Gets a time of day description if applicable.
    /// </summary>
    public string? GetTimeOfDayDescription(SensoryContext context)
    {
        if (string.IsNullOrEmpty(context.TimeOfDay)) return null;
        if (context.IsIndoor) return null; // Time of day only affects outdoor

        if (!_config.TimesOfDay.TryGetValue(context.TimeOfDay, out var timeDef))
        {
            return null;
        }

        var tags = context.GetAllTags().ToList();
        return _descriptorService.GetDescriptor(timeDef.OutdoorPool, tags);
    }

    /// <summary>
    /// Generates a brief atmospheric summary using 2-3 senses.
    /// </summary>
    public string GenerateBriefAtmosphere(SensoryContext context)
    {
        var full = GenerateSensoryDescription(context);
        return full.ToNarrative(3);
    }

    /// <summary>
    /// Generates a detailed atmospheric description using all senses.
    /// </summary>
    public string GenerateDetailedAtmosphere(SensoryContext context)
    {
        var full = GenerateSensoryDescription(context);

        var parts = new List<string>();

        // Include all layers of sound
        if (full.Sounds.HasSounds)
        {
            parts.Add(full.Sounds.ToFullDescription());
        }

        // Add other senses
        if (!string.IsNullOrEmpty(full.Lighting.Description))
            parts.Add(full.Lighting.Description);

        if (!string.IsNullOrEmpty(full.Smell.Description))
            parts.Add(full.Smell.Description);

        if (!string.IsNullOrEmpty(full.Temperature))
            parts.Add(full.Temperature);

        if (!string.IsNullOrEmpty(full.Weather))
            parts.Add(full.Weather);

        if (!string.IsNullOrEmpty(full.TimeOfDay))
            parts.Add(full.TimeOfDay);

        return string.Join(" ", parts);
    }

    private string? InferLightSource(SensoryContext context)
    {
        var biome = context.Environment.Biome;

        // Infer common light sources by biome
        return biome switch
        {
            "cave" => _random.NextDouble() > 0.5 ? "bioluminescence" : null,
            "dungeon" => "torch",
            "volcanic" => "lava_glow",
            "frozen" => context.IsIndoor ? "crystal" : null,
            "ruins" => _random.NextDouble() > 0.7 ? "magical" : null,
            "forest" => context.IsIndoor ? null : "sunlight",
            _ => null
        };
    }

    private string? GetSoundLayer(string layer, string biome, List<string> tags)
    {
        // Try biome-specific layer pool
        var poolPath = $"environmental.sounds_{layer}_{biome}";
        var sound = _descriptorService.GetDescriptor(poolPath, tags);

        // Fall back to generic layer pool
        if (string.IsNullOrEmpty(sound))
        {
            poolPath = $"environmental.sounds_{layer}";
            sound = _descriptorService.GetDescriptor(poolPath, tags);
        }

        return sound;
    }

    private SmellIntensity DetermineSmellIntensity(SensoryContext context)
    {
        // Strong smells in certain biomes
        return context.Environment.Biome switch
        {
            "swamp" => SmellIntensity.Strong,
            "volcanic" => SmellIntensity.Strong,
            "frozen" => SmellIntensity.Faint, // Cold suppresses smell
            _ => SmellIntensity.Noticeable
        };
    }

    private string FormatSmellWithIntensity(string? smellType, SmellIntensity intensity)
    {
        if (string.IsNullOrEmpty(smellType)) return string.Empty;

        // If the smell already has intensity words, return as-is
        if (smellType.Contains("assaults") || smellType.Contains("fills") ||
            smellType.Contains("hint") || smellType.Contains("reek"))
        {
            return smellType;
        }

        // Otherwise, wrap with intensity template
        return intensity switch
        {
            SmellIntensity.Faint => $"A faint hint of {smellType} lingers in the air.",
            SmellIntensity.Noticeable => smellType,
            SmellIntensity.Strong => $"The pungent {smellType} fills your nostrils.",
            SmellIntensity.Overwhelming => $"The overwhelming {smellType} is nearly unbearable.",
            _ => smellType
        };
    }

    private string? ExtractSmellType(string? description)
    {
        // Simple extraction - could be enhanced
        return description?.Split(' ').LastOrDefault();
    }
}
```

### 4.2 Service Integration Flow

```
┌─────────────────────────────────────────────────────────────────┐
│               SENSORY DESCRIPTION GENERATION FLOW               │
└─────────────────────────────────────────────────────────────────┘

    Room.Enter() or Look command
           │
           ▼
    SensoryDescriptorService.GenerateSensoryDescription(context)
           │
           ├── GetLightingDescription()
           │   ├── Infer light source from biome
           │   ├── Get source-specific pool OR level-specific pool
           │   └── Return LightingDescription
           │
           ├── GetSoundDescription()
           │   ├── Get distant sounds (biome-specific → generic)
           │   ├── Get nearby sounds (biome-specific → generic)
           │   ├── Get immediate sounds (if in combat)
           │   └── Return SoundDescription
           │
           ├── GetSmellDescription()
           │   ├── Determine intensity from biome
           │   ├── Get biome-specific smell → generic
           │   ├── Format with intensity template
           │   └── Return SmellDescription
           │
           ├── GetTemperatureDescription()
           │   ├── Get climate-specific pool
           │   └── Return temperature string
           │
           ├── GetWeatherDescription() [if weather set]
           │   ├── Validate weather for climate
           │   ├── Get indoor or outdoor pool
           │   └── Return weather string
           │
           └── GetTimeOfDayDescription() [if outdoor]
                   │
                   ▼
           Return SensoryDescription
                   │
                   ▼
           ToNarrative(maxSenses) → Combined text output
```

---

## 5. Command Changes

### 5.1 Enhanced Look Command

The existing `look` command will use `SensoryDescriptorService` for richer room descriptions:

```csharp
// In GameView or LookCommandHandler:
public async Task HandleLookAsync()
{
    var room = _gameSession.CurrentRoom;
    var sensoryContext = BuildSensoryContext(room);

    // Generate sensory atmosphere
    var atmosphere = _sensoryService.GenerateBriefAtmosphere(sensoryContext);

    // Combine with room description
    var fullDescription = $"{room.Description}\n\n{atmosphere}";

    await _renderer.RenderRoomDescriptionAsync(fullDescription);
}
```

### 5.2 Examine Room Command Enhancement

When examining a room in detail, provide full sensory output:

```csharp
// examine room (or look closely)
var atmosphere = _sensoryService.GenerateDetailedAtmosphere(sensoryContext);
```

---

## 6. Rendering Changes

### 6.1 Atmospheric Room Descriptions

**Brief (normal look):**
```
The chamber is dimly lit by flickering torches. The sound of dripping water
echoes in the distance. A damp chill clings to your skin.
```

**Detailed (examine room):**
```
The chamber is dimly lit by flickering torches, casting dancing shadows across
the rough-hewn walls. From somewhere deeper in the tunnels, the sound of
dripping water echoes faintly. Closer, you hear the soft skittering of unseen
creatures. The smell of damp stone fills your nostrils. A damp chill clings to
your skin, making you shiver despite your cloak.
```

### 6.2 Biome-Specific Examples

**Cave:**
```
Eerie phosphorescent fungi cast a pale green glow across the cavern. Water drips
steadily from stalactites overhead. The smell of mineral deposits and damp earth
surrounds you. The air is cool and humid.
```

**Volcanic:**
```
A dim orange glow emanates from fissures in the rock, casting everything in
hellish light. The rumble of distant lava flows vibrates through your feet.
Sulfurous fumes sting your eyes and throat. Oppressive heat radiates from every
surface.
```

**Frozen:**
```
Crystalline ice formations refract pale blue light throughout the chamber. An
eerie silence hangs in the frigid air. Your breath crystallizes before you.
A bone-chilling cold seeps into your very bones.
```

**Swamp:**
```
Murky light filters through the dense canopy above. The buzz and croak of
insects fills the humid air. The stench of rotting vegetation assaults your
senses with every breath. Oppressive warmth and moisture cling to your skin.
```

---

## 7. Configuration

### 7.1 lighting.json

**File:** `config/descriptors/lighting.json`

```json
{
  "category": "lighting",
  "pools": {
    "lighting_torch": {
      "id": "lighting_torch",
      "name": "Torch Lighting",
      "descriptors": [
        {
          "id": "flickering_torches",
          "text": "Flickering torches cast dancing shadows across the walls",
          "weight": 25
        },
        {
          "id": "warm_torchlight",
          "text": "Warm torchlight bathes the area in orange glow",
          "weight": 25
        },
        {
          "id": "guttering_flames",
          "text": "Guttering torch flames threaten to plunge you into darkness",
          "weight": 15,
          "tags": ["danger"]
        },
        {
          "id": "smoky_torches",
          "text": "Smoky torches line the walls, their flames wavering",
          "weight": 20
        },
        {
          "id": "sparse_torchlight",
          "text": "Sparse torchlight leaves pools of shadow between the sconces",
          "weight": 15
        }
      ]
    },
    "lighting_crystal": {
      "id": "lighting_crystal",
      "name": "Crystal Lighting",
      "descriptors": [
        {
          "id": "crystalline_glow",
          "text": "Luminescent crystals emit a steady blue-white glow",
          "weight": 30
        },
        {
          "id": "prismatic_light",
          "text": "Light refracts through crystal formations, painting rainbows on the stone",
          "weight": 25
        },
        {
          "id": "crystal_radiance",
          "text": "Crystalline radiance illuminates every corner with ethereal light",
          "weight": 25
        },
        {
          "id": "pulsing_crystals",
          "text": "The crystals pulse gently with inner light, like a slow heartbeat",
          "weight": 20,
          "tags": ["magical"]
        }
      ]
    },
    "lighting_bioluminescence": {
      "id": "lighting_bioluminescence",
      "name": "Bioluminescent Lighting",
      "descriptors": [
        {
          "id": "phosphorescent_fungi",
          "text": "Phosphorescent fungi cast an eerie green glow across the cavern",
          "weight": 30
        },
        {
          "id": "glowing_moss",
          "text": "Patches of glowing moss cling to the walls, providing dim illumination",
          "weight": 25
        },
        {
          "id": "luminous_lichen",
          "text": "Luminous lichen creates pools of pale blue light",
          "weight": 25
        },
        {
          "id": "fungal_glow",
          "text": "The soft glow of bioluminescent life forms lights your path",
          "weight": 20
        }
      ]
    },
    "lighting_magical": {
      "id": "lighting_magical",
      "name": "Magical Lighting",
      "descriptors": [
        {
          "id": "arcane_glow",
          "text": "A sourceless arcane glow illuminates the chamber",
          "weight": 25
        },
        {
          "id": "pulsing_runes",
          "text": "Ancient runes pulse with eldritch light along the walls",
          "weight": 25
        },
        {
          "id": "floating_orbs",
          "text": "Motes of magical light drift lazily through the air",
          "weight": 25
        },
        {
          "id": "ethereal_radiance",
          "text": "Ethereal radiance fills the space with no visible source",
          "weight": 25
        }
      ]
    },
    "lighting_sunlight": {
      "id": "lighting_sunlight",
      "name": "Sunlight",
      "descriptors": [
        {
          "id": "warm_sunlight",
          "text": "Warm sunlight streams through gaps in the canopy",
          "weight": 30,
          "tags": ["outdoor", "forest"]
        },
        {
          "id": "golden_rays",
          "text": "Golden rays of sunlight pierce the gloom",
          "weight": 25
        },
        {
          "id": "dappled_light",
          "text": "Dappled sunlight creates a shifting pattern on the ground",
          "weight": 25,
          "tags": ["forest"]
        },
        {
          "id": "harsh_sun",
          "text": "The harsh sun beats down relentlessly",
          "weight": 20,
          "tags": ["desert"]
        }
      ]
    },
    "lighting_moonlight": {
      "id": "lighting_moonlight",
      "name": "Moonlight",
      "descriptors": [
        {
          "id": "pale_moonlight",
          "text": "Pale moonlight casts long shadows across the landscape",
          "weight": 30
        },
        {
          "id": "silvery_glow",
          "text": "A silvery lunar glow bathes everything in ethereal light",
          "weight": 30
        },
        {
          "id": "moon_shadows",
          "text": "The moon creates deep pools of shadow between its silver beams",
          "weight": 20
        },
        {
          "id": "full_moon",
          "text": "The full moon illuminates the night with surprising clarity",
          "weight": 20
        }
      ]
    },
    "lighting_lava_glow": {
      "id": "lighting_lava_glow",
      "name": "Lava/Volcanic Lighting",
      "descriptors": [
        {
          "id": "hellish_glow",
          "text": "A hellish orange glow emanates from cracks in the stone",
          "weight": 30
        },
        {
          "id": "lava_light",
          "text": "Rivers of molten rock cast everything in crimson light",
          "weight": 25
        },
        {
          "id": "volcanic_radiance",
          "text": "The volcanic glow makes the shadows dance like demons",
          "weight": 25
        },
        {
          "id": "ember_light",
          "text": "Embers and flowing lava provide an ominous illumination",
          "weight": 20
        }
      ]
    },
    "lighting_pitch_black": {
      "id": "lighting_pitch_black",
      "name": "Pitch Black",
      "descriptors": [
        {
          "id": "impenetrable_darkness",
          "text": "Impenetrable darkness surrounds you on all sides",
          "weight": 30
        },
        {
          "id": "absolute_black",
          "text": "The darkness is absolute - you cannot see your hand before your face",
          "weight": 30
        },
        {
          "id": "void_darkness",
          "text": "You stand in a void of complete darkness",
          "weight": 20
        },
        {
          "id": "blind_dark",
          "text": "The darkness renders you completely blind",
          "weight": 20
        }
      ]
    },
    "lighting_dim": {
      "id": "lighting_dim",
      "name": "Dim Lighting",
      "descriptors": [
        {
          "id": "dim_shadows",
          "text": "Dim light barely holds the pressing shadows at bay",
          "weight": 25
        },
        {
          "id": "murky_gloom",
          "text": "Murky gloom makes it difficult to see clearly",
          "weight": 25
        },
        {
          "id": "faint_light",
          "text": "Faint light struggles to illuminate the space",
          "weight": 25
        },
        {
          "id": "twilight_dim",
          "text": "A perpetual twilight gloom hangs over the area",
          "weight": 25
        }
      ]
    },
    "lighting_bright": {
      "id": "lighting_bright",
      "name": "Bright Lighting",
      "descriptors": [
        {
          "id": "well_lit",
          "text": "The area is well-lit, with no shadows to hide in",
          "weight": 30
        },
        {
          "id": "bright_illumination",
          "text": "Bright light fills every corner of the space",
          "weight": 30
        },
        {
          "id": "clear_visibility",
          "text": "Clear, bright light grants perfect visibility",
          "weight": 20
        },
        {
          "id": "brilliant_light",
          "text": "Brilliant light banishes all shadows",
          "weight": 20
        }
      ]
    }
  }
}
```

### 7.2 sounds.json

**File:** `config/descriptors/sounds.json`

```json
{
  "category": "sounds",
  "pools": {
    "sounds_distant": {
      "id": "sounds_distant",
      "name": "Distant Sounds (Generic)",
      "descriptors": [
        { "id": "distant_echo", "text": "Distant echoes reverberate through unseen passages", "weight": 25 },
        { "id": "far_rumble", "text": "A far-off rumbling vibrates through the stone", "weight": 20 },
        { "id": "wind_howl", "text": "Wind howls through distant openings", "weight": 20 },
        { "id": "distant_drip", "text": "The steady drip of water echoes from somewhere far away", "weight": 20 },
        { "id": "thunder_roll", "text": "Thunder rolls in the distance", "weight": 15, "tags": ["outdoor", "storm"] }
      ]
    },
    "sounds_distant_cave": {
      "id": "sounds_distant_cave",
      "name": "Distant Sounds (Cave)",
      "descriptors": [
        { "id": "deep_drip", "text": "Deep within the caverns, water drips into underground pools", "weight": 30 },
        { "id": "cave_wind", "text": "A mournful wind moans through distant tunnels", "weight": 25 },
        { "id": "bat_flutter", "text": "The distant flutter of bat wings echoes through the darkness", "weight": 20 },
        { "id": "rock_settling", "text": "Rocks settle and shift in the deep places", "weight": 25 }
      ]
    },
    "sounds_distant_volcanic": {
      "id": "sounds_distant_volcanic",
      "name": "Distant Sounds (Volcanic)",
      "descriptors": [
        { "id": "lava_rumble", "text": "The constant rumble of flowing lava vibrates through your feet", "weight": 30 },
        { "id": "steam_hiss", "text": "Distant steam vents hiss and roar", "weight": 25 },
        { "id": "rock_crack", "text": "Rocks crack and groan under thermal stress", "weight": 25 },
        { "id": "deep_roar", "text": "A deep, ominous roar emanates from below", "weight": 20 }
      ]
    },
    "sounds_nearby": {
      "id": "sounds_nearby",
      "name": "Nearby Sounds (Generic)",
      "descriptors": [
        { "id": "water_drip", "text": "Water drips steadily from the ceiling", "weight": 25 },
        { "id": "creak_groan", "text": "Something creaks and groans nearby", "weight": 20 },
        { "id": "skitter", "text": "Something skitters in the shadows just out of sight", "weight": 20, "tags": ["danger"] },
        { "id": "settling_dust", "text": "Dust settles with soft whispers", "weight": 20 },
        { "id": "eerie_silence", "text": "An eerie silence hangs in the air", "weight": 15 }
      ]
    },
    "sounds_nearby_forest": {
      "id": "sounds_nearby_forest",
      "name": "Nearby Sounds (Forest)",
      "descriptors": [
        { "id": "leaves_rustle", "text": "Leaves rustle in the gentle breeze", "weight": 30 },
        { "id": "bird_song", "text": "Birds sing in the branches overhead", "weight": 25 },
        { "id": "branches_creak", "text": "Tree branches creak and sway", "weight": 20 },
        { "id": "undergrowth", "text": "Something moves through the undergrowth nearby", "weight": 15 },
        { "id": "insect_buzz", "text": "Insects buzz and hum around you", "weight": 10 }
      ]
    },
    "sounds_nearby_swamp": {
      "id": "sounds_nearby_swamp",
      "name": "Nearby Sounds (Swamp)",
      "descriptors": [
        { "id": "frog_chorus", "text": "A chorus of frogs fills the humid air", "weight": 25 },
        { "id": "insect_drone", "text": "The constant drone of insects surrounds you", "weight": 25 },
        { "id": "water_bubble", "text": "Stagnant water bubbles and gurgles", "weight": 20 },
        { "id": "squelch", "text": "The ground squelches with every step", "weight": 20 },
        { "id": "splash", "text": "Something splashes in the murky water nearby", "weight": 10 }
      ]
    },
    "sounds_immediate_combat": {
      "id": "sounds_immediate_combat",
      "name": "Immediate Sounds (Combat)",
      "descriptors": [
        { "id": "heartbeat", "text": "Your heartbeat pounds in your ears", "weight": 30 },
        { "id": "ragged_breath", "text": "Your ragged breathing fills the silence between blows", "weight": 30 },
        { "id": "blood_rush", "text": "Blood rushes through your veins", "weight": 20 },
        { "id": "enemy_snarl", "text": "Your enemy's snarling breath is close", "weight": 20 }
      ]
    }
  }
}
```

### 7.3 smells.json

**File:** `config/descriptors/smells.json`

```json
{
  "category": "smells",
  "pools": {
    "smells_cave": {
      "id": "smells_cave",
      "name": "Cave Smells",
      "descriptors": [
        { "id": "mineral", "text": "The sharp scent of minerals and wet stone", "weight": 30 },
        { "id": "damp_earth", "text": "The earthy smell of damp soil", "weight": 25 },
        { "id": "stale_air", "text": "Stale, ancient air that hasn't moved in centuries", "weight": 25 },
        { "id": "guano", "text": "The acrid stench of bat guano", "weight": 20 }
      ]
    },
    "smells_dungeon": {
      "id": "smells_dungeon",
      "name": "Dungeon Smells",
      "descriptors": [
        { "id": "musty", "text": "Musty air thick with age and neglect", "weight": 25 },
        { "id": "torch_smoke", "text": "The acrid smell of torch smoke", "weight": 25 },
        { "id": "rust_mold", "text": "The smell of rust and mold", "weight": 25 },
        { "id": "death", "text": "A faint hint of death lingers in the air", "weight": 15, "tags": ["danger"] },
        { "id": "damp_stone", "text": "The smell of damp stone permeates everything", "weight": 10 }
      ]
    },
    "smells_volcanic": {
      "id": "smells_volcanic",
      "name": "Volcanic Smells",
      "descriptors": [
        { "id": "sulfur", "text": "Sulfurous fumes sting your eyes and throat", "weight": 35 },
        { "id": "brimstone", "text": "The reek of brimstone fills the air", "weight": 30 },
        { "id": "ash", "text": "The bitter taste of ash coats your tongue", "weight": 20 },
        { "id": "burning_rock", "text": "The acrid smell of burning rock", "weight": 15 }
      ]
    },
    "smells_frozen": {
      "id": "smells_frozen",
      "name": "Frozen Smells",
      "descriptors": [
        { "id": "crisp_cold", "text": "The crisp, clean scent of snow", "weight": 35 },
        { "id": "no_smell", "text": "The cold suppresses all but the faintest smells", "weight": 30 },
        { "id": "ice", "text": "A faint, sharp scent of ice crystals", "weight": 20 },
        { "id": "frozen_earth", "text": "The subtle smell of frozen earth", "weight": 15 }
      ]
    },
    "smells_swamp": {
      "id": "smells_swamp",
      "name": "Swamp Smells",
      "descriptors": [
        { "id": "decay", "text": "The stench of rotting vegetation assaults your senses", "weight": 30 },
        { "id": "stagnant", "text": "Stagnant, fetid water fills the air with its reek", "weight": 25 },
        { "id": "decomposition", "text": "The sweet-sick smell of decomposition", "weight": 25 },
        { "id": "mud", "text": "Rich, organic mud mixed with decay", "weight": 20 }
      ]
    },
    "smells_forest": {
      "id": "smells_forest",
      "name": "Forest Smells",
      "descriptors": [
        { "id": "pine", "text": "The fresh scent of pine needles", "weight": 25 },
        { "id": "loam", "text": "Rich forest loam and fallen leaves", "weight": 25 },
        { "id": "wildflowers", "text": "The delicate fragrance of wildflowers", "weight": 20 },
        { "id": "bark_moss", "text": "The earthy smell of bark and moss", "weight": 20 },
        { "id": "rain_forest", "text": "The clean scent of recent rain on leaves", "weight": 10 }
      ]
    },
    "smells_ruins": {
      "id": "smells_ruins",
      "name": "Ruins Smells",
      "descriptors": [
        { "id": "ancient_dust", "text": "Ancient dust coats your tongue with each breath", "weight": 30 },
        { "id": "crumbling_stone", "text": "The musty smell of crumbling stone", "weight": 25 },
        { "id": "forgotten", "text": "The smell of places long forgotten", "weight": 25 },
        { "id": "decay_age", "text": "The subtle decay of ages", "weight": 20 }
      ]
    }
  }
}
```

### 7.4 weather.json

**File:** `config/descriptors/weather.json`

```json
{
  "category": "weather",
  "pools": {
    "weather_rain_indoor": {
      "id": "weather_rain_indoor",
      "name": "Rain (Indoor)",
      "descriptors": [
        { "id": "rain_roof", "text": "Rain patters steadily on the roof above", "weight": 30 },
        { "id": "water_seep", "text": "Water seeps through cracks in the ceiling", "weight": 25 },
        { "id": "damp_air", "text": "Damp air drifts in from outside", "weight": 25 },
        { "id": "distant_rain", "text": "The muffled sound of rain reaches you from outside", "weight": 20 }
      ]
    },
    "weather_rain_outdoor": {
      "id": "weather_rain_outdoor",
      "name": "Rain (Outdoor)",
      "descriptors": [
        { "id": "steady_rain", "text": "Steady rain patters against you", "weight": 30 },
        { "id": "rain_soaked", "text": "Rain soaks through your clothing", "weight": 25 },
        { "id": "puddles", "text": "Rain pools in puddles around your feet", "weight": 25 },
        { "id": "grey_curtain", "text": "A grey curtain of rain limits your vision", "weight": 20 }
      ]
    },
    "weather_storm_indoor": {
      "id": "weather_storm_indoor",
      "name": "Storm (Indoor)",
      "descriptors": [
        { "id": "thunder_rumble", "text": "Thunder rumbles overhead, shaking the walls", "weight": 30 },
        { "id": "lightning_flash", "text": "Lightning flashes through the windows", "weight": 25 },
        { "id": "storm_howl", "text": "The storm howls outside, rattling the shutters", "weight": 25 },
        { "id": "wind_whistle", "text": "Wind whistles through every crack and gap", "weight": 20 }
      ]
    },
    "weather_storm_outdoor": {
      "id": "weather_storm_outdoor",
      "name": "Storm (Outdoor)",
      "descriptors": [
        { "id": "lightning_sky", "text": "Lightning splits the sky, briefly turning night to day", "weight": 30 },
        { "id": "thunder_crash", "text": "Thunder crashes around you with deafening force", "weight": 25 },
        { "id": "driving_rain", "text": "Driving rain stings your face", "weight": 25 },
        { "id": "storm_fury", "text": "The full fury of the storm batters you", "weight": 20 }
      ]
    },
    "weather_snow_indoor": {
      "id": "weather_snow_indoor",
      "name": "Snow (Indoor)",
      "descriptors": [
        { "id": "snow_drift", "text": "Snow drifts through gaps, piling in corners", "weight": 30 },
        { "id": "cold_draft", "text": "Cold drafts carry snowflakes inside", "weight": 30 },
        { "id": "muffled_quiet", "text": "The snow outside muffles all sound", "weight": 20 },
        { "id": "frost_glass", "text": "Frost patterns creep across any glass", "weight": 20 }
      ]
    },
    "weather_snow_outdoor": {
      "id": "weather_snow_outdoor",
      "name": "Snow (Outdoor)",
      "descriptors": [
        { "id": "snow_swirl", "text": "Snow swirls around you in dancing flurries", "weight": 30 },
        { "id": "white_world", "text": "The world is blanketed in white", "weight": 25 },
        { "id": "snow_crunch", "text": "Snow crunches beneath your feet", "weight": 25 },
        { "id": "blinding_white", "text": "The snow creates a blinding white expanse", "weight": 20 }
      ]
    },
    "weather_fog_indoor": {
      "id": "weather_fog_indoor",
      "name": "Fog (Indoor)",
      "descriptors": [
        { "id": "mist_seep", "text": "Mist seeps under doors and through cracks", "weight": 35 },
        { "id": "fog_tendrils", "text": "Tendrils of fog creep along the floor", "weight": 35 },
        { "id": "damp_fog", "text": "Clammy fog makes everything damp to the touch", "weight": 30 }
      ]
    },
    "weather_fog_outdoor": {
      "id": "weather_fog_outdoor",
      "name": "Fog (Outdoor)",
      "descriptors": [
        { "id": "thick_fog", "text": "Thick fog limits visibility to mere feet", "weight": 30 },
        { "id": "fog_blanket", "text": "A blanket of fog muffles sight and sound", "weight": 30 },
        { "id": "shapes_fog", "text": "Shapes loom suddenly from the fog", "weight": 25 },
        { "id": "fog_swirl", "text": "Fog swirls around you like ghostly fingers", "weight": 15, "tags": ["horror"] }
      ]
    },
    "weather_wind_indoor": {
      "id": "weather_wind_indoor",
      "name": "Wind (Indoor)",
      "descriptors": [
        { "id": "drafts_whistle", "text": "Drafts whistle through gaps in the walls", "weight": 35 },
        { "id": "wind_moan", "text": "Wind moans through the corridors", "weight": 35 },
        { "id": "banging_shutters", "text": "Loose shutters bang in the wind", "weight": 30 }
      ]
    },
    "weather_wind_outdoor": {
      "id": "weather_wind_outdoor",
      "name": "Wind (Outdoor)",
      "descriptors": [
        { "id": "strong_wind", "text": "A strong wind buffets you", "weight": 30 },
        { "id": "howling_wind", "text": "Wind howls across the open ground", "weight": 30 },
        { "id": "biting_wind", "text": "A biting wind cuts through your clothing", "weight": 25 },
        { "id": "gusting_wind", "text": "Gusting wind threatens to knock you off balance", "weight": 15 }
      ]
    }
  }
}
```

### 7.5 Configuration Schema Summary

| Configuration | Properties | Description |
|---------------|------------|-------------|
| LightSourceDefinition | Id, LightQuality, DescriptorPool, Atmosphere, CommonBiomes, IsFlickering | Light source types |
| DarknessLevelDefinition | Id, VisibilityLevel, DescriptorPool, ImpliedTags | Visibility levels |
| WeatherDefinition | Id, IndoorPool, OutdoorPool, ValidClimates, AffectsVisibility, AffectsSound | Weather conditions |
| TimeOfDayDefinition | Id, OutdoorPool, LightQuality, DefaultDarknessLevel, ImpliedTags | Time periods |

---

## 8. Acceptance Criteria

### 8.1 Lighting System

- [ ] Light source types defined (torch, crystal, bioluminescence, magical, sunlight, moonlight, lava)
- [ ] Darkness level pools implemented (pitch black, dim, normal, bright, blinding)
- [ ] Light sources inferred from biome when not specified
- [ ] Lighting descriptions integrate with environment context

### 8.2 Sound System

- [ ] Layered sound system implemented (distant, nearby, immediate)
- [ ] Biome-specific sound pools (cave, dungeon, forest, volcanic, swamp)
- [ ] Combat-specific immediate sounds
- [ ] Sound layers combinable for detailed descriptions

### 8.3 Smell System

- [ ] Biome-specific smell pools implemented
- [ ] Smell intensity levels work (faint, noticeable, strong, overwhelming)
- [ ] Intensity determined by biome characteristics
- [ ] Smell descriptions formatted with intensity templates

### 8.4 Temperature System

- [ ] Climate-specific temperature pools
- [ ] Temperature integrates with climate from EnvironmentContext
- [ ] Fallback to generic temperature pool

### 8.5 Weather System

- [ ] Weather conditions defined (rain, storm, snow, fog, wind)
- [ ] Indoor vs outdoor variants
- [ ] Weather validated against climate
- [ ] Weather descriptions integrate correctly

### 8.6 Time of Day

- [ ] Time periods defined (dawn, day, dusk, night)
- [ ] Outdoor-only effects
- [ ] Light quality changes by time

### 8.7 Integration

- [ ] SensoryDescriptorService generates complete SensoryDescription
- [ ] ToNarrative() combines senses coherently
- [ ] Brief and detailed atmosphere generation
- [ ] Look command uses sensory descriptions

### 8.8 General

- [ ] ~18 unit tests pass
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings

---

## 9. Test Specifications

### 9.1 Unit Tests (~18 tests)

#### SensoryDescriptorServiceTests.cs

```csharp
[TestFixture]
public class SensoryDescriptorServiceTests
{
    [Test]
    public void GetLightingDescription_WithLightSource_UsesSourcePool();

    [Test]
    public void GetLightingDescription_WithoutSource_InfersFromBiome();

    [Test]
    public void GetSoundDescription_ReturnsLayeredSounds();

    [Test]
    public void GetSoundDescription_WithCombat_IncludesImmediateSounds();

    [Test]
    public void GetSmellDescription_UsesBiomeSpecificPool();

    [Test]
    public void GetSmellDescription_AppliesIntensityBasedOnBiome();

    [Test]
    public void GetTemperatureDescription_UsesClimateSpecificPool();

    [Test]
    public void GetWeatherDescription_ValidatesClimate();

    [Test]
    public void GetWeatherDescription_UsesIndoorOrOutdoorPool();

    [Test]
    public void GetTimeOfDayDescription_ReturnsNullForIndoor();

    [Test]
    public void GenerateSensoryDescription_CombinesAllSenses();

    [Test]
    public void GenerateBriefAtmosphere_LimitsToThreeSenses();

    [Test]
    public void GenerateDetailedAtmosphere_IncludesAllSoundLayers();
}
```

#### SensoryDescriptionTests.cs

```csharp
[TestFixture]
public class SensoryDescriptionTests
{
    [Test]
    public void ToNarrative_CombinesSensesInOrder();

    [Test]
    public void ToNarrative_RespectsMaxSensesLimit();

    [Test]
    public void SoundDescription_Primary_ReturnsFirstNonNull();

    [Test]
    public void SoundDescription_ToFullDescription_CombinesAllLayers();

    [Test]
    public void HasDescriptions_ReturnsTrueWhenAnyPresent();
}
```

---

## 10. Dependencies

### 10.1 Required from v0.0.11a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `EnvironmentContext` | `Domain/ValueObjects/EnvironmentContext.cs` | Biome, climate, lighting context |
| `EnvironmentCoherenceService` | `Application/Services/EnvironmentCoherenceService.cs` | Get biome info |
| `DescriptorService` | `Application/Services/DescriptorService.cs` | Base descriptor selection |
| `BiomeDefinition` | `Application/Configuration/BiomeConfiguration.cs` | Biome characteristics |

### 10.2 Provides to v0.0.11d

| Type | Usage |
|------|-------|
| `SensoryDescriptorService` | Integrated into room descriptions |
| `SensoryDescription` | Used by ambient event system |
| `SensoryContext` | Passed through for object descriptions |

---

## 11. Files Summary

### 11.1 New Files

| File | Purpose |
|------|---------|
| `src/Core/RuneAndRust.Domain/ValueObjects/SensoryDescription.cs` | Sensory value objects |
| `src/Core/RuneAndRust.Application/Configuration/SensoryConfiguration.cs` | Sensory definitions |
| `src/Core/RuneAndRust.Application/Services/SensoryDescriptorService.cs` | Multi-sense generation |
| `config/descriptors/lighting.json` | Light source and darkness pools |
| `config/descriptors/sounds.json` | Layered sound pools |
| `config/descriptors/smells.json` | Biome smell pools |
| `config/descriptors/weather.json` | Weather condition pools |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/SensoryDescriptionTests.cs` | Value object tests |
| `tests/RuneAndRust.Application.UnitTests/Services/SensoryDescriptorServiceTests.cs` | Service tests |

### 11.2 Modified Files

| File | Changes |
|------|---------|
| `config/descriptors/environmental.json` | Restructured into new files |
| `GameView.cs` | Use SensoryDescriptorService for look command |
| `IGameRenderer.cs` | Enhanced room description methods |
| `DependencyInjection.cs` | Register SensoryDescriptorService |

---

*This design specification establishes a comprehensive multi-sensory system that creates immersive atmospheric descriptions. By layering lighting, sounds, smells, temperature, weather, and time effects, the system engages multiple senses to bring environments to life while maintaining coherence with the biome and climate context from v0.0.11a.*
