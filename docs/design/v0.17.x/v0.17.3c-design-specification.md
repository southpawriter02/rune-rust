# v0.17.3c Design Specification: Starting Abilities

**Version:** 0.17.3c  
**Phase Name:** Starting Abilities  
**Parent Version:** v0.17.3 (Archetype System)  
**Prerequisites:** v0.17.3b Complete (Resource Bonuses)  
**Estimated Tests:** ~8 unit tests

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [AbilityType Enum](#4-abilitytype-enum)
5. [ArchetypeAbilityGrant Value Object](#5-archetypeabilitygrant-value-object)
6. [Data Model Changes](#6-data-model-changes)
7. [Configuration File Schemas](#7-configuration-file-schemas)
8. [Logging Specifications](#8-logging-specifications)
9. [Unit Testing Requirements](#9-unit-testing-requirements)
10. [Use Cases](#10-use-cases)
11. [User Stories](#11-user-stories)
12. [Deliverable Checklist](#12-deliverable-checklist)
13. [Acceptance Criteria](#13-acceptance-criteria)
14. [Dependencies](#14-dependencies)
15. [Future Considerations](#15-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

This specification defines the `AbilityType` enumeration and `ArchetypeAbilityGrant` value object that encapsulate the starting abilities each archetype receives. Every archetype grants exactly 3 starting abilities that define the character's initial combat capabilities.

The starting abilities per archetype are:

| Archetype  | Ability 1          | Ability 2             | Ability 3        |
| ---------- | ------------------ | --------------------- | ---------------- |
| Warrior    | Power Strike (A)   | Defensive Stance (S)  | Iron Will (P)    |
| Skirmisher | Quick Strike (A)   | Evasive Maneuvers (A) | Opportunist (P)  |
| Mystic     | Aether Bolt (A)    | Aether Shield (A)     | Aether Sense (P) |
| Adept      | Precise Strike (A) | Assess Weakness (A)   | Resourceful (P)  |

_(A = Active, S = Stance, P = Passive)_

This phase establishes the ability grant pattern that the character creation workflow uses to initialize new characters with archetype-appropriate abilities.

### 1.2 Key Deliverables

| Category          | Items                                         |
| ----------------- | --------------------------------------------- |
| **Enums**         | `AbilityType`                                 |
| **Value Objects** | `ArchetypeAbilityGrant`                       |
| **Configuration** | `archetypes.json` (startingAbilities section) |
| **Tests**         | ~8 unit tests                                 |

### 1.3 Architectural Significance

This version establishes the **Ability Grant Pattern** used throughout character progression:

- **Ability Type Classification**: Active, Passive, and Stance abilities
- **Immutable Ability Grants**: Starting abilities are fixed per archetype
- **Ability ID References**: Grants reference abilities by string ID
- **Integration Ready**: Designed to work with Ability System (v0.15.x)
- **Three Ability Standard**: Each archetype grants exactly 3 starting abilities
- **Mixed Ability Types**: Each archetype has a mix of active and passive abilities

---

## 2. Feature Overview

```
v0.17.3c Starting Abilities
├── AbilityType Enum
│   ├── Active (0) — Activated abilities that cost resources
│   ├── Passive (1) — Always-on abilities with no activation
│   └── Stance (2) — Toggleable modes that modify behavior
├── ArchetypeAbilityGrant Value Object
│   ├── AbilityId: string (e.g., "power-strike")
│   ├── AbilityName: string (e.g., "Power Strike")
│   ├── AbilityType: AbilityType (Active/Passive/Stance)
│   ├── Description: string
│   └── IsPassive: bool (computed from AbilityType)
└── Configuration Files
    └── archetypes.json (startingAbilities section)
```

### 2.1 Scope Alignment

**In Scope:**

- `AbilityType` enum with 3 values (Active, Passive, Stance)
- `ArchetypeAbilityGrant` value object for ability grant data
- Configuration schema extension for startingAbilities section
- 12 total starting abilities (3 per archetype × 4 archetypes)
- Helper methods for ability type classification

**Out of Scope:**

- Actual ability implementation → v0.15.x Ability System
- Ability effects and mechanics → v0.15.x Ability System
- Specialization mappings → v0.17.3d
- Archetype provider service → v0.17.3e
- Archetype application service → v0.17.3f

---

## 3. Architecture Diagrams

### 3.1 Starting Abilities System Overview

```
┌─────────────────────────────────────────────────────────────────────┐
│                 STARTING ABILITIES SYSTEM OVERVIEW                   │
└─────────────────────────────────────────────────────────────────────┘

    ArchetypeDefinition (v0.17.3a)
           │
           │  has-many (composition, exactly 3)
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                   ArchetypeAbilityGrant[]                            │
├─────────────────────────────────────────────────────────────────────┤
│  - AbilityId: string         (e.g., "power-strike")                 │
│  - AbilityName: string       (e.g., "Power Strike")                 │
│  - AbilityType: AbilityType  (Active, Passive, Stance)              │
│  - Description: string       (brief ability description)            │
│  - IsPassive: bool           (true if AbilityType == Passive)       │
└─────────────────────────────────────────────────────────────────────┘
           │
           │  classified by
           ▼
┌─────────────────────────────────────────────────────────────────────┐
│                        AbilityType Enum                              │
├─────────────────────────────────────────────────────────────────────┤
│  Active (0)   — Must be activated, costs resources, has cooldown    │
│  Passive (1)  — Always active, no action required                   │
│  Stance (2)   — Toggle on/off, modifies combat behavior             │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.2 Ability Grant Application Flow

```
┌─────────────────────────────────────────────────────────────────────┐
│                  ABILITY GRANT APPLICATION FLOW                      │
└─────────────────────────────────────────────────────────────────────┘

    Character Creation: Apply Archetype (Step 4)
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 1. Get ArchetypeAbilityGrant[] for selected archetype           │
    │    (exactly 3 abilities)                                         │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 2. For each ability grant:                                       │
    │    a. Resolve AbilityId to AbilityDefinition (v0.15.x)           │
    │    b. Add ability to character's ability list                    │
    │    c. If IsPassive: Apply passive effects immediately            │
    │    d. If Active/Stance: Add to action bar                        │
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    ┌──────────────────────────────────────────────────────────────────┐
    │ 3. Display granted abilities:                                    │
    │    "You have learned: Power Strike, Defensive Stance, Iron Will"│
    └──────────────────────────────────────────────────────────────────┘
           │
           ▼
    Character has 3 starting abilities from archetype
```

### 3.3 Starting Abilities by Archetype

```
┌─────────────────────────────────────────────────────────────────────┐
│                 STARTING ABILITIES BY ARCHETYPE                      │
└─────────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                         WARRIOR                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │  1. Power Strike          [ACTIVE]                              │
    │     "A powerful melee attack that deals bonus damage."          │
    │                                                                  │
    │  2. Defensive Stance      [STANCE]                              │
    │     "Reduces damage taken but slows movement."                  │
    │                                                                  │
    │  3. Iron Will             [PASSIVE]                             │
    │     "Resistance to fear and mental effects."                    │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                        SKIRMISHER                                │
    ├─────────────────────────────────────────────────────────────────┤
    │  1. Quick Strike          [ACTIVE]                              │
    │     "A fast attack with reduced cooldown."                      │
    │                                                                  │
    │  2. Evasive Maneuvers     [ACTIVE]                              │
    │     "Dodge the next incoming attack."                           │
    │                                                                  │
    │  3. Opportunist           [PASSIVE]                             │
    │     "Bonus damage when attacking from advantage."               │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                          MYSTIC                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │  1. Aether Bolt           [ACTIVE]                              │
    │     "Launch a bolt of Aetheric energy at a target."             │
    │                                                                  │
    │  2. Aether Shield         [ACTIVE]                              │
    │     "Create a temporary barrier that absorbs damage."           │
    │                                                                  │
    │  3. Aether Sense          [PASSIVE]                             │
    │     "Detect nearby Aetheric sources and anomalies."             │
    └─────────────────────────────────────────────────────────────────┘

    ┌─────────────────────────────────────────────────────────────────┐
    │                           ADEPT                                  │
    ├─────────────────────────────────────────────────────────────────┤
    │  1. Precise Strike        [ACTIVE]                              │
    │     "A calculated attack that targets weak points."             │
    │                                                                  │
    │  2. Assess Weakness       [ACTIVE]                              │
    │     "Study an enemy to reveal vulnerabilities."                 │
    │                                                                  │
    │  3. Resourceful           [PASSIVE]                             │
    │     "Chance to preserve consumables when used."                 │
    └─────────────────────────────────────────────────────────────────┘
```

### 3.4 Ability Type Decision Tree

```
┌─────────────────────────────────────────────────────────────────────┐
│                    ABILITY TYPE DECISION TREE                        │
└─────────────────────────────────────────────────────────────────────┘

    Get ArchetypeAbilityGrant
           │
           ▼
    ┌──────────────────────┐
    │ Check AbilityType    │
    └──────────┬───────────┘
               │
    ┌──────────┼────────────────────────────┐
    │          │                            │
    ▼          ▼                            ▼
┌────────┐ ┌────────┐                  ┌────────┐
│ Active │ │ Stance │                  │Passive │
└───┬────┘ └───┬────┘                  └───┬────┘
    │          │                            │
    ▼          ▼                            ▼
┌────────────────────┐ ┌────────────────────┐ ┌────────────────────┐
│ Requires Action    │ │ Toggle On/Off      │ │ Always Active      │
│ Costs Resource     │ │ Modifies Behavior  │ │ No Activation      │
│ Has Cooldown       │ │ No Resource Cost   │ │ Permanent Effect   │
│ Add to Action Bar  │ │ Add to Stance List │ │ Apply Immediately  │
└────────────────────┘ └────────────────────┘ └────────────────────┘
    │                      │                       │
    └──────────────────────┴───────────────────────┘
                           │
                           ▼
              Character ability initialized
```

### 3.5 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                            │
├─────────────────────────────────────────────────────────────────────┤
│  CharacterCreationView (v0.17.5)                                     │
│  └── Displays granted abilities after archetype selection           │
│                                                                      │
│  AbilityBarView                                                      │
│  └── Shows active/stance abilities on action bar                    │
│                                                                      │
│  CharacterSheetView                                                  │
│  └── Lists all abilities with icons by AbilityType                  │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                              │
├─────────────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │           IArchetypeApplicationService (v0.17.3f)             │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  Uses ArchetypeAbilityGrant[] to grant abilities:             │  │
│  │  - Resolve each AbilityId                                     │  │
│  │  - Add to character ability list                              │  │
│  │  - Apply passive effects                                      │  │
│  └───────────────────────────────────────────────────────────────┘  │
│                                                                      │
│  ┌───────────────────────────────────────────────────────────────┐  │
│  │              IAbilityService (v0.15.x)                        │  │
│  ├───────────────────────────────────────────────────────────────┤  │
│  │  Provides ability definitions and mechanics                   │  │
│  │  Used to resolve AbilityId to full AbilityDefinition          │  │
│  └───────────────────────────────────────────────────────────────┘  │
└───────┬─────────────────────────────────────────────────────────────┘
        │
        ▼
┌─────────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                                 │
├─────────────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────┐  ┌─────────────────────────────┐   │
│  │     AbilityType            │  │   ArchetypeAbilityGrant     │   │
│  │       (Enum)               │  │     (Value Object)          │   │
│  ├────────────────────────────┤  ├─────────────────────────────┤   │
│  │ Active = 0                 │  │ AbilityId: string           │   │
│  │ Passive = 1                │◀─│ AbilityName: string         │   │
│  │ Stance = 2                 │  │ AbilityType: AbilityType    │   │
│  └────────────────────────────┘  │ Description: string         │   │
│                                  │ IsPassive: bool             │   │
│                                  └─────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. AbilityType Enum

### 4.1 Purpose

The `AbilityType` enum classifies abilities into three categories based on their activation and behavior. This classification affects how abilities are displayed, activated, and processed.

### 4.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/Enums/AbilityType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the classification of abilities by activation type.
/// </summary>
/// <remarks>
/// <para>
/// AbilityType determines how an ability is used and displayed in the game.
/// Each type has distinct characteristics for activation, cost, and effect.
/// </para>
/// <para>
/// The three ability types are:
/// - Active: Player-activated abilities that cost resources and have cooldowns
/// - Passive: Always-on abilities that provide constant benefits
/// - Stance: Toggleable modes that modify character behavior
/// </para>
/// <para>
/// Starting abilities are distributed across types:
/// - Warrior: 1 Active, 1 Stance, 1 Passive
/// - Skirmisher: 2 Active, 1 Passive
/// - Mystic: 2 Active, 1 Passive
/// - Adept: 2 Active, 1 Passive
/// </para>
/// </remarks>
public enum AbilityType
{
    /// <summary>
    /// Active abilities require player activation.
    /// </summary>
    /// <remarks>
    /// Characteristics:
    /// - Must be activated by player action
    /// - Typically costs Stamina or Aether Pool
    /// - Has cooldown between uses
    /// - Displayed on action bar
    /// - Examples: Power Strike, Aether Bolt, Quick Strike
    /// </remarks>
    Active = 0,

    /// <summary>
    /// Passive abilities are always active.
    /// </summary>
    /// <remarks>
    /// Characteristics:
    /// - No activation required
    /// - No resource cost
    /// - Always provides benefit
    /// - Displayed in abilities list, not action bar
    /// - Examples: Iron Will, Opportunist, Aether Sense
    /// </remarks>
    Passive = 1,

    /// <summary>
    /// Stance abilities toggle between active/inactive states.
    /// </summary>
    /// <remarks>
    /// Characteristics:
    /// - Toggled on/off by player
    /// - No resource cost to activate
    /// - Modifies character behavior while active
    /// - Only one stance active at a time (typically)
    /// - Examples: Defensive Stance, Aggressive Stance
    /// </remarks>
    Stance = 2
}
```

### 4.3 Ability Type Reference Table

| Enum Value | Integer | Activation   | Cost     | Effect Duration |
| ---------- | ------- | ------------ | -------- | --------------- |
| `Active`   | 0       | Player input | Resource | Instant/Timed   |
| `Passive`  | 1       | None         | None     | Permanent       |
| `Stance`   | 2       | Toggle       | None     | Until toggled   |

---

## 5. ArchetypeAbilityGrant Value Object

### 5.1 Purpose

The `ArchetypeAbilityGrant` value object encapsulates the data for a single starting ability granted by an archetype. Each archetype provides exactly 3 ability grants.

### 5.2 Implementation

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/ArchetypeAbilityGrant.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Represents a starting ability granted by an archetype.
/// </summary>
/// <remarks>
/// <para>
/// ArchetypeAbilityGrant is an immutable value object that defines which
/// ability a character receives when selecting an archetype. The AbilityId
/// references an ability in the Ability System (v0.15.x).
/// </para>
/// <para>
/// Each archetype grants exactly 3 abilities, typically distributed as:
/// - 1-2 Active abilities for combat actions
/// - 1 Passive ability for constant benefits
/// - 0-1 Stance ability for tactical options (Warrior only)
/// </para>
/// </remarks>
/// <param name="AbilityId">Unique identifier for the ability (kebab-case).</param>
/// <param name="AbilityName">Display name for the ability.</param>
/// <param name="AbilityType">Classification of the ability.</param>
/// <param name="Description">Brief description of the ability's effect.</param>
public readonly record struct ArchetypeAbilityGrant(
    string AbilityId,
    string AbilityName,
    AbilityType AbilityType,
    string Description)
{
    /// <summary>
    /// Gets whether this is a passive ability.
    /// </summary>
    public bool IsPassive => AbilityType == AbilityType.Passive;

    /// <summary>
    /// Gets whether this is an active ability.
    /// </summary>
    public bool IsActive => AbilityType == AbilityType.Active;

    /// <summary>
    /// Gets whether this is a stance ability.
    /// </summary>
    public bool IsStance => AbilityType == AbilityType.Stance;

    /// <summary>
    /// Gets whether this ability requires activation (Active or Stance).
    /// </summary>
    public bool RequiresActivation => AbilityType != AbilityType.Passive;

    /// <summary>
    /// Gets the ability type as a display string.
    /// </summary>
    public string TypeDisplay => AbilityType switch
    {
        AbilityType.Active => "[ACTIVE]",
        AbilityType.Passive => "[PASSIVE]",
        AbilityType.Stance => "[STANCE]",
        _ => "[UNKNOWN]"
    };

    /// <summary>
    /// Creates an ability grant with validation.
    /// </summary>
    /// <param name="abilityId">The ability identifier.</param>
    /// <param name="abilityName">The display name.</param>
    /// <param name="abilityType">The ability type.</param>
    /// <param name="description">The description.</param>
    /// <returns>A new ArchetypeAbilityGrant instance.</returns>
    /// <exception cref="ArgumentException">Thrown when required strings are null or whitespace.</exception>
    public static ArchetypeAbilityGrant Create(
        string abilityId,
        string abilityName,
        AbilityType abilityType,
        string description)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(abilityId);
        ArgumentException.ThrowIfNullOrWhiteSpace(abilityName);
        ArgumentException.ThrowIfNullOrWhiteSpace(description);

        // Normalize ability ID to lowercase
        var normalizedId = abilityId.ToLowerInvariant();

        return new ArchetypeAbilityGrant(
            normalizedId,
            abilityName,
            abilityType,
            description);
    }

    /// <summary>
    /// Creates an active ability grant.
    /// </summary>
    public static ArchetypeAbilityGrant CreateActive(
        string abilityId,
        string abilityName,
        string description) =>
        Create(abilityId, abilityName, AbilityType.Active, description);

    /// <summary>
    /// Creates a passive ability grant.
    /// </summary>
    public static ArchetypeAbilityGrant CreatePassive(
        string abilityId,
        string abilityName,
        string description) =>
        Create(abilityId, abilityName, AbilityType.Passive, description);

    /// <summary>
    /// Creates a stance ability grant.
    /// </summary>
    public static ArchetypeAbilityGrant CreateStance(
        string abilityId,
        string abilityName,
        string description) =>
        Create(abilityId, abilityName, AbilityType.Stance, description);

    /// <summary>
    /// Gets a formatted display string for UI.
    /// </summary>
    public string GetDisplayString() =>
        $"{AbilityName} {TypeDisplay}\n{Description}";

    /// <summary>
    /// Gets a short display string for lists.
    /// </summary>
    public string GetShortDisplay() =>
        $"{AbilityName} {TypeDisplay}";

    /// <inheritdoc />
    public override string ToString() =>
        $"{AbilityId}: {AbilityName} ({AbilityType})";
}
```

### 5.3 Starting Abilities Reference Table

| Archetype  | AbilityId           | AbilityName       | AbilityType | Description                                      |
| ---------- | ------------------- | ----------------- | ----------- | ------------------------------------------------ |
| Warrior    | `power-strike`      | Power Strike      | Active      | A powerful melee attack that deals bonus damage. |
| Warrior    | `defensive-stance`  | Defensive Stance  | Stance      | Reduces damage taken but slows movement.         |
| Warrior    | `iron-will`         | Iron Will         | Passive     | Resistance to fear and mental effects.           |
| Skirmisher | `quick-strike`      | Quick Strike      | Active      | A fast attack with reduced cooldown.             |
| Skirmisher | `evasive-maneuvers` | Evasive Maneuvers | Active      | Dodge the next incoming attack.                  |
| Skirmisher | `opportunist`       | Opportunist       | Passive     | Bonus damage when attacking from advantage.      |
| Mystic     | `aether-bolt`       | Aether Bolt       | Active      | Launch a bolt of Aetheric energy at a target.    |
| Mystic     | `aether-shield`     | Aether Shield     | Active      | Create a temporary barrier that absorbs damage.  |
| Mystic     | `aether-sense`      | Aether Sense      | Passive     | Detect nearby Aetheric sources and anomalies.    |
| Adept      | `precise-strike`    | Precise Strike    | Active      | A calculated attack that targets weak points.    |
| Adept      | `assess-weakness`   | Assess Weakness   | Active      | Study an enemy to reveal vulnerabilities.        |
| Adept      | `resourceful`       | Resourceful       | Passive     | Chance to preserve consumables when used.        |

---

## 6. Data Model Changes

### 6.1 New Types Summary

| Type                    | Layer  | Category     | Description                 |
| ----------------------- | ------ | ------------ | --------------------------- |
| `AbilityType`           | Domain | Enum         | Active, Passive, Stance     |
| `ArchetypeAbilityGrant` | Domain | Value Object | Starting ability grant data |

### 6.2 File Locations

```
src/Core/RuneAndRust.Domain/
├── Enums/
│   └── AbilityType.cs                           ← NEW
├── ValueObjects/
│   └── ArchetypeAbilityGrant.cs                 ← NEW

config/
└── archetypes.json                              ← UPDATED (startingAbilities section)
```

### 6.3 Type Relationships

```
┌─────────────────────────┐
│  ArchetypeDefinition    │
│      (v0.17.3a)         │
└───────────┬─────────────┘
            │ has-many (exactly 3)
            ▼
┌─────────────────────────┐       ┌─────────────────────────┐
│ ArchetypeAbilityGrant[] │──────▶│      AbilityType        │
│    (Value Object)       │ uses  │       (Enum)            │
├─────────────────────────┤       ├─────────────────────────┤
│ AbilityId: string       │       │ Active = 0              │
│ AbilityName: string     │       │ Passive = 1             │
│ AbilityType: AbilityType│       │ Stance = 2              │
│ Description: string     │       └─────────────────────────┘
│ IsPassive: bool         │
└─────────────────────────┘
            │
            │ references
            ▼
┌─────────────────────────┐
│   AbilityDefinition     │
│     (v0.15.x)           │
│  (resolved by AbilityId)│
└─────────────────────────┘
```

---

## 7. Configuration File Schemas

### 7.1 archetypes.json (Starting Abilities Section)

**File:** `config/archetypes.json` (updated with startingAbilities)

```json
{
    "$schema": "./schemas/archetypes.schema.json",
    "archetypes": [
        {
            "archetypeId": "Warrior",
            "displayName": "Warrior",
            "startingAbilities": [
                {
                    "abilityId": "power-strike",
                    "abilityName": "Power Strike",
                    "abilityType": "Active",
                    "description": "A powerful melee attack that deals bonus damage."
                },
                {
                    "abilityId": "defensive-stance",
                    "abilityName": "Defensive Stance",
                    "abilityType": "Stance",
                    "description": "Reduces damage taken but slows movement."
                },
                {
                    "abilityId": "iron-will",
                    "abilityName": "Iron Will",
                    "abilityType": "Passive",
                    "description": "Resistance to fear and mental effects."
                }
            ]
        },
        {
            "archetypeId": "Skirmisher",
            "displayName": "Skirmisher",
            "startingAbilities": [
                {
                    "abilityId": "quick-strike",
                    "abilityName": "Quick Strike",
                    "abilityType": "Active",
                    "description": "A fast attack with reduced cooldown."
                },
                {
                    "abilityId": "evasive-maneuvers",
                    "abilityName": "Evasive Maneuvers",
                    "abilityType": "Active",
                    "description": "Dodge the next incoming attack."
                },
                {
                    "abilityId": "opportunist",
                    "abilityName": "Opportunist",
                    "abilityType": "Passive",
                    "description": "Bonus damage when attacking from advantage."
                }
            ]
        },
        {
            "archetypeId": "Mystic",
            "displayName": "Mystic",
            "startingAbilities": [
                {
                    "abilityId": "aether-bolt",
                    "abilityName": "Aether Bolt",
                    "abilityType": "Active",
                    "description": "Launch a bolt of Aetheric energy at a target."
                },
                {
                    "abilityId": "aether-shield",
                    "abilityName": "Aether Shield",
                    "abilityType": "Active",
                    "description": "Create a temporary barrier that absorbs damage."
                },
                {
                    "abilityId": "aether-sense",
                    "abilityName": "Aether Sense",
                    "abilityType": "Passive",
                    "description": "Detect nearby Aetheric sources and anomalies."
                }
            ]
        },
        {
            "archetypeId": "Adept",
            "displayName": "Adept",
            "startingAbilities": [
                {
                    "abilityId": "precise-strike",
                    "abilityName": "Precise Strike",
                    "abilityType": "Active",
                    "description": "A calculated attack that targets weak points."
                },
                {
                    "abilityId": "assess-weakness",
                    "abilityName": "Assess Weakness",
                    "abilityType": "Active",
                    "description": "Study an enemy to reveal vulnerabilities."
                },
                {
                    "abilityId": "resourceful",
                    "abilityName": "Resourceful",
                    "abilityType": "Passive",
                    "description": "Chance to preserve consumables when used."
                }
            ]
        }
    ]
}
```

### 7.2 Schema Extension for Starting Abilities

**File:** `config/schemas/archetypes.schema.json` (startingAbilities section)

```json
{
    "$defs": {
        "startingAbilities": {
            "type": "array",
            "description": "Starting abilities granted by the archetype",
            "items": { "$ref": "#/$defs/abilityGrant" },
            "minItems": 3,
            "maxItems": 3
        },
        "abilityGrant": {
            "type": "object",
            "description": "A starting ability granted to the character",
            "required": [
                "abilityId",
                "abilityName",
                "abilityType",
                "description"
            ],
            "properties": {
                "abilityId": {
                    "type": "string",
                    "description": "Unique ability identifier (kebab-case)",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "minLength": 3,
                    "maxLength": 50
                },
                "abilityName": {
                    "type": "string",
                    "description": "Display name for the ability",
                    "minLength": 1,
                    "maxLength": 50
                },
                "abilityType": {
                    "type": "string",
                    "description": "Classification of the ability",
                    "enum": ["Active", "Passive", "Stance"]
                },
                "description": {
                    "type": "string",
                    "description": "Brief description of the ability",
                    "minLength": 1,
                    "maxLength": 200
                }
            }
        }
    }
}
```

---

## 8. Logging Specifications

### 8.1 Log Levels by Component

| Component               | Level       | Events                               |
| ----------------------- | ----------- | ------------------------------------ |
| `ArchetypeAbilityGrant` | Debug       | Grant creation, property access      |
| `ArchetypeAbilityGrant` | Information | Ability granted to character         |
| `ArchetypeAbilityGrant` | Warning     | Unknown ability ID during resolution |

### 8.2 Logging Rules

- **Debug**: Ability grant object creation and lookup
- **Information**: Successful ability grant to character
- **Warning**: Ability ID not found in ability system
- **Error**: Invalid ability grant configuration

---

## 9. Unit Testing Requirements

### 9.1 Test Count: ~8 tests

```csharp
[TestFixture]
public class AbilityTypeEnumTests
{
    [Test]
    public void AbilityType_HasThreeValues()
    {
        // Arrange & Act
        var values = Enum.GetValues<AbilityType>();

        // Assert
        values.Should().HaveCount(3);
    }

    [Test]
    public void AbilityType_ActiveHasValue0()
    {
        // Arrange & Act & Assert
        ((int)AbilityType.Active).Should().Be(0);
    }

    [Test]
    public void AbilityType_PassiveHasValue1()
    {
        // Arrange & Act & Assert
        ((int)AbilityType.Passive).Should().Be(1);
    }
}

[TestFixture]
public class ArchetypeAbilityGrantTests
{
    [Test]
    public void Create_WithValidData_ReturnsGrant()
    {
        // Arrange & Act
        var grant = ArchetypeAbilityGrant.Create(
            "power-strike",
            "Power Strike",
            AbilityType.Active,
            "A powerful melee attack.");

        // Assert
        grant.AbilityId.Should().Be("power-strike");
        grant.AbilityName.Should().Be("Power Strike");
        grant.AbilityType.Should().Be(AbilityType.Active);
        grant.IsActive.Should().BeTrue();
        grant.IsPassive.Should().BeFalse();
    }

    [Test]
    public void Create_NormalizesAbilityId()
    {
        // Arrange & Act
        var grant = ArchetypeAbilityGrant.Create(
            "Power-Strike",
            "Power Strike",
            AbilityType.Active,
            "Description");

        // Assert
        grant.AbilityId.Should().Be("power-strike");
    }

    [Test]
    public void CreatePassive_SetsCorrectType()
    {
        // Arrange & Act
        var grant = ArchetypeAbilityGrant.CreatePassive(
            "iron-will",
            "Iron Will",
            "Resistance to fear.");

        // Assert
        grant.AbilityType.Should().Be(AbilityType.Passive);
        grant.IsPassive.Should().BeTrue();
        grant.RequiresActivation.Should().BeFalse();
    }

    [Test]
    public void CreateStance_SetsCorrectType()
    {
        // Arrange & Act
        var grant = ArchetypeAbilityGrant.CreateStance(
            "defensive-stance",
            "Defensive Stance",
            "Reduces damage taken.");

        // Assert
        grant.AbilityType.Should().Be(AbilityType.Stance);
        grant.IsStance.Should().BeTrue();
        grant.RequiresActivation.Should().BeTrue();
    }

    [Test]
    public void Create_WithNullAbilityId_ThrowsArgumentException()
    {
        // Arrange
        Action act = () => ArchetypeAbilityGrant.Create(
            null!,
            "Name",
            AbilityType.Active,
            "Description");

        // Assert
        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void GetDisplayString_ReturnsFormattedOutput()
    {
        // Arrange
        var grant = ArchetypeAbilityGrant.CreateActive(
            "power-strike",
            "Power Strike",
            "A powerful melee attack.");

        // Act
        var display = grant.GetDisplayString();

        // Assert
        display.Should().Contain("Power Strike");
        display.Should().Contain("[ACTIVE]");
        display.Should().Contain("A powerful melee attack.");
    }
}
```

---

## 10. Use Cases

### UC-001: View Starting Abilities in Archetype Selection

**Actor:** Player  
**Precondition:** Player is viewing archetype details in Step 4  
**Flow:** Select archetype → Load ArchetypeAbilityGrant[] → Display ability names with types → Show descriptions on detail view  
**Postcondition:** Player sees 3 starting abilities for the archetype

### UC-002: Grant Abilities on Archetype Confirmation

**Actor:** System  
**Precondition:** Player has confirmed archetype selection  
**Flow:** Get ability grants → Resolve each AbilityId → Add abilities to character → Apply passive effects → Display confirmation  
**Postcondition:** Character has 3 starting abilities

### UC-003: Display Ability Types Appropriately

**Actor:** System  
**Precondition:** Character has abilities granted  
**Flow:** Check each ability's AbilityType → Place Active/Stance on action bar → Show Passive in ability panel → Apply type-appropriate icons  
**Postcondition:** Abilities displayed correctly by type

---

## 11. User Stories

**US-001:** As a player, I want to see the 3 starting abilities for each archetype before selecting so I can understand my initial combat options.

**US-002:** As a Warrior, I want to start with Defensive Stance so I can immediately play as a tank.

**US-003:** As a Mystic, I want to start with Aether Bolt and Aether Shield so I have both offensive and defensive magical options.

**US-004:** As a player, I want ability types clearly labeled so I understand which abilities I activate vs. which are always on.

---

## 12. Deliverable Checklist

### Enums

- [ ] `AbilityType` enum with 3 values (Active, Passive, Stance)
- [ ] Explicit integer values assigned (0-2)
- [ ] Full XML documentation with remarks

### Value Objects

- [ ] `ArchetypeAbilityGrant` value object
- [ ] All properties: AbilityId, AbilityName, AbilityType, Description
- [ ] Helper properties: IsPassive, IsActive, IsStance, RequiresActivation
- [ ] Factory methods: Create, CreateActive, CreatePassive, CreateStance
- [ ] Display methods: GetDisplayString, GetShortDisplay
- [ ] AbilityId normalization to lowercase
- [ ] Full XML documentation

### Configuration Files

- [ ] `archetypes.json` updated with startingAbilities section
- [ ] Schema extended with startingAbilities and abilityGrant definitions
- [ ] All 4 archetypes have exactly 3 abilities
- [ ] All 12 abilities have correct types and descriptions

### Testing

- [ ] ~8 unit tests implemented
- [ ] All tests passing
- [ ] Edge cases covered (null validation, type helpers)

---

## 13. Acceptance Criteria

### Functional

- [ ] `AbilityType` enum has exactly 3 values
- [ ] Warrior has: Power Strike (Active), Defensive Stance (Stance), Iron Will (Passive)
- [ ] Skirmisher has: Quick Strike (Active), Evasive Maneuvers (Active), Opportunist (Passive)
- [ ] Mystic has: Aether Bolt (Active), Aether Shield (Active), Aether Sense (Passive)
- [ ] Adept has: Precise Strike (Active), Assess Weakness (Active), Resourceful (Passive)
- [ ] Each archetype has exactly 3 starting abilities
- [ ] AbilityId is normalized to lowercase (kebab-case)
- [ ] IsPassive returns true only for Passive abilities
- [ ] RequiresActivation returns true for Active and Stance

### Quality

- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~8 unit tests pass
- [ ] XML documentation complete for all public types

---

## 14. Dependencies

### Required from Previous Phases

| Type                  | Phase    | Usage                            |
| --------------------- | -------- | -------------------------------- |
| `Archetype`           | v0.17.3a | Archetype identification         |
| `ArchetypeDefinition` | v0.17.3a | Will compose with ability grants |

### Provides to Future Phases

| Type                    | Phase    | Usage                                |
| ----------------------- | -------- | ------------------------------------ |
| `AbilityType`           | v0.17.3e | Provider categorizes abilities       |
| `ArchetypeAbilityGrant` | v0.17.3e | Provider returns ability grants      |
| `ArchetypeAbilityGrant` | v0.17.3f | Application service grants abilities |
| `AbilityType`           | v0.15.x  | Integration with Ability System      |

---

## 15. Future Considerations

### Deferred to v0.17.3d

- Specialization mappings per archetype
- Available specializations list
- Recommended first specialization

### Deferred to v0.17.3e

- Provider service integration with ability grants

### Deferred to v0.17.3f

- Application service for granting abilities to characters
- Integration with Ability System (v0.15.x) for resolution

### Out of Scope for v0.17.3

- Ability mechanics and effects (v0.15.x)
- Ability leveling and upgrades
- Additional starting abilities beyond 3 per archetype
- Ability unlocking through progression

---

_Document Version: 1.0_  
_Last Updated: 2026-01-27_
