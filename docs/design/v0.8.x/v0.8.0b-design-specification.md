# v0.8.0b Design Specification: Settings Window

**Version:** 0.8.0b
**Parent:** v0.8.0 (Character & Settings)
**Prerequisites:** v0.8.0a Complete (Character Creation Wizard)
**Status:** Design Complete
**Estimated Unit Tests:** ~10

---

## Table of Contents

1. [Overview](#1-overview)
2. [Feature Overview](#2-feature-overview)
3. [Architecture](#3-architecture)
4. [Settings Window](#4-settings-window)
5. [Settings Window ViewModel](#5-settings-window-viewmodel)
6. [Tab ViewModels](#6-tab-viewmodels)
7. [Tab Controls](#7-tab-controls)
8. [Settings Configuration](#8-settings-configuration)
9. [Styles](#9-styles)
10. [Logging Specifications](#10-logging-specifications)
11. [Unit Testing Requirements](#11-unit-testing-requirements)
12. [Use Cases](#12-use-cases)
13. [Deliverable Checklist](#13-deliverable-checklist)
14. [Acceptance Criteria](#14-acceptance-criteria)
15. [Dependencies](#15-dependencies)
16. [Future Considerations](#16-future-considerations)

---

## 1. Overview

### Purpose

Implement a comprehensive settings window with tabbed categories for audio, display, gameplay, and controls configuration. Settings persist across sessions to JSON and apply in real-time where possible, with Apply/Cancel/OK standard behavior.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Windows** | `SettingsWindow` (expanded) |
| **ViewModels** | `SettingsWindowViewModel` + 4 tab VMs |
| **User Controls** | 4 tab controls |
| **Configuration** | `settings.json` schema |
| **Tests** | ~10 unit tests |

### Design Principles

1. **Categorized Settings**: Logical tab groupings
2. **Immediate Feedback**: Real-time preview where applicable
3. **Standard UX**: Apply/Cancel/OK pattern
4. **Persistence**: JSON-based settings storage

---

## 2. Feature Overview

```
v0.8.0b Features
├── SettingsWindow
│   ├── Tabbed navigation (Audio, Display, Gameplay, Controls)
│   ├── Apply/Cancel/OK button row
│   └── Unsaved changes detection
│
├── Audio Tab
│   ├── Master volume slider (0-100%)
│   ├── Music volume slider (0-100%)
│   ├── Sound effects slider (0-100%)
│   ├── Enable sound effects checkbox
│   └── Mute all audio checkbox
│
├── Display Tab
│   ├── Theme dropdown (Dark Fantasy, High Fantasy, etc.)
│   ├── Font size slider (80%-150%)
│   ├── Enable combat animations checkbox
│   ├── Enable room transition effects checkbox
│   └── High contrast mode checkbox
│
├── Gameplay Tab
│   ├── Difficulty dropdown (Easy, Normal, Hard)
│   ├── Difficulty description text
│   ├── Auto-save frequency dropdown
│   ├── Show combat tooltips checkbox
│   ├── Show tutorial hints checkbox
│   └── Confirm dangerous actions checkbox
│
└── Controls Tab
    ├── Keybinding list (scrollable)
    ├── Global shortcuts section
    ├── Game shortcuts section
    ├── Rebind button per binding
    └── Reset to Defaults button
```

---

## 3. Architecture

### Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       PRESENTATION LAYER                                │
├─────────────────────────────────────────────────────────────────────────┤
│  SettingsWindow                                                         │
│  └── SettingsWindowViewModel                                            │
│       ├── SelectedTabIndex: int                                         │
│       ├── HasChanges: bool                                              │
│       ├── AudioTab: AudioSettingsTabViewModel                           │
│       ├── DisplayTab: DisplaySettingsTabViewModel                       │
│       ├── GameplayTab: GameplaySettingsTabViewModel                     │
│       ├── ControlsTab: ControlsSettingsTabViewModel                     │
│       ├── ApplyCommand                                                  │
│       ├── CancelCommand                                                 │
│       └── OkCommand                                                     │
│                                                                         │
│  Tab ViewModels                                                         │
│  ├── AudioSettingsTabViewModel (volumes, mute)                          │
│  ├── DisplaySettingsTabViewModel (theme, font, animations)              │
│  ├── GameplaySettingsTabViewModel (difficulty, auto-save, hints)        │
│  └── ControlsSettingsTabViewModel (keybindings, rebind)                 │
└────────────────────────────────────┬────────────────────────────────────┘
                                     │
                                     ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         APPLICATION LAYER                               │
├─────────────────────────────────────────────────────────────────────────┤
│  ISettingsService                                                       │
│  ├── GetSettings(): GameSettings                                        │
│  ├── SaveSettings(settings): void                                       │
│  └── ResetToDefaults(): void                                            │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Settings Window

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/SettingsWindow.axaml`

```xml
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RuneAndRust.Avalonia.ViewModels"
        x:Class="RuneAndRust.Avalonia.Views.SettingsWindow"
        x:DataType="vm:SettingsWindowViewModel"
        Title="Settings"
        Width="700" Height="500"
        WindowStartupLocation="CenterOwner">
    
    <Grid RowDefinitions="*,Auto">
        
        <!-- Tab Content -->
        <Grid Grid.Row="0" ColumnDefinitions="150,*">
            
            <!-- Tab List -->
            <ListBox Grid.Column="0" 
                     SelectedIndex="{Binding SelectedTabIndex}"
                     Classes="settings-tabs">
                <ListBoxItem Content="Audio" />
                <ListBoxItem Content="Display" />
                <ListBoxItem Content="Gameplay" />
                <ListBoxItem Content="Controls" />
            </ListBox>
            
            <!-- Tab Panels -->
            <Border Grid.Column="1" Classes="settings-content" Padding="24">
                <ContentControl>
                    <ContentControl.Content>
                        <Binding Path="SelectedTabIndex">
                            <Binding.Converter>
                                <vm:TabIndexToContentConverter>
                                    <vm:TabIndexToContentConverter.Tabs>
                                        <x:Array Type="vm:ViewModelBase">
                                            <vm:AudioSettingsTabViewModel />
                                            <vm:DisplaySettingsTabViewModel />
                                            <vm:GameplaySettingsTabViewModel />
                                            <vm:ControlsSettingsTabViewModel />
                                        </x:Array>
                                    </vm:TabIndexToContentConverter.Tabs>
                                </vm:TabIndexToContentConverter>
                            </Binding.Converter>
                        </Binding>
                    </ContentControl.Content>
                </ContentControl>
            </Border>
        </Grid>
        
        <!-- Button Row -->
        <Border Grid.Row="1" Classes="settings-footer" Padding="16">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        Spacing="8">
                <Button Content="Apply" 
                        Command="{Binding ApplyCommand}"
                        IsEnabled="{Binding HasChanges}" />
                <Button Content="Cancel" 
                        Command="{Binding CancelCommand}" />
                <Button Content="OK" 
                        Command="{Binding OkCommand}"
                        Classes="primary" />
            </StackPanel>
        </Border>
        
    </Grid>
</Window>
```

---

## 5. Settings Window ViewModel

**File:** `src/Presentation/RuneAndRust.Avalonia/ViewModels/SettingsWindowViewModel.cs`

```csharp
namespace RuneAndRust.Avalonia.ViewModels;

public partial class SettingsWindowViewModel : ViewModelBase
{
    private readonly ISettingsService _settingsService;
    private readonly GameSettings _originalSettings;
    private readonly Action _closeWindow;

    [ObservableProperty] private int _selectedTabIndex;
    [ObservableProperty] private bool _hasChanges;

    [ObservableProperty] private AudioSettingsTabViewModel _audioTab;
    [ObservableProperty] private DisplaySettingsTabViewModel _displayTab;
    [ObservableProperty] private GameplaySettingsTabViewModel _gameplayTab;
    [ObservableProperty] private ControlsSettingsTabViewModel _controlsTab;

    public SettingsWindowViewModel(ISettingsService settingsService, Action closeWindow)
    {
        _settingsService = settingsService;
        _closeWindow = closeWindow;
        _originalSettings = settingsService.GetSettings().Clone();

        var settings = settingsService.GetSettings();
        AudioTab = new AudioSettingsTabViewModel(settings.Audio, OnSettingChanged);
        DisplayTab = new DisplaySettingsTabViewModel(settings.Display, OnSettingChanged);
        GameplayTab = new GameplaySettingsTabViewModel(settings.Gameplay, OnSettingChanged);
        ControlsTab = new ControlsSettingsTabViewModel(settings.Controls, OnSettingChanged);
    }

    // Design-time constructor
    public SettingsWindowViewModel()
    {
        _settingsService = null!;
        _originalSettings = new();
        _closeWindow = () => { };
        AudioTab = new AudioSettingsTabViewModel();
        DisplayTab = new DisplaySettingsTabViewModel();
        GameplayTab = new GameplaySettingsTabViewModel();
        ControlsTab = new ControlsSettingsTabViewModel();
    }

    [RelayCommand]
    private void Apply()
    {
        var settings = BuildSettings();
        _settingsService.SaveSettings(settings);
        HasChanges = false;
        Log.Information("Settings applied");
    }

    [RelayCommand]
    private void Cancel()
    {
        _settingsService.SaveSettings(_originalSettings);
        _closeWindow();
    }

    [RelayCommand]
    private void Ok()
    {
        if (HasChanges) Apply();
        _closeWindow();
    }

    private void OnSettingChanged() => HasChanges = true;

    private GameSettings BuildSettings() => new()
    {
        Audio = AudioTab.ToSettings(),
        Display = DisplayTab.ToSettings(),
        Gameplay = GameplayTab.ToSettings(),
        Controls = ControlsTab.ToSettings()
    };
}
```

---

## 6. Tab ViewModels

### AudioSettingsTabViewModel

```csharp
public partial class AudioSettingsTabViewModel : ViewModelBase
{
    private readonly Action? _onChanged;

    [ObservableProperty] private int _masterVolume = 75;
    [ObservableProperty] private int _musicVolume = 50;
    [ObservableProperty] private int _sfxVolume = 85;
    [ObservableProperty] private bool _enableSoundEffects = true;
    [ObservableProperty] private bool _muteAll;

    public AudioSettingsTabViewModel(AudioSettings settings, Action onChanged)
    {
        _onChanged = onChanged;
        MasterVolume = settings.MasterVolume;
        MusicVolume = settings.MusicVolume;
        SfxVolume = settings.SfxVolume;
        EnableSoundEffects = settings.EnableSoundEffects;
        MuteAll = settings.MuteAll;
    }

    public AudioSettingsTabViewModel() { }

    public AudioSettings ToSettings() => new()
    {
        MasterVolume = MasterVolume,
        MusicVolume = MusicVolume,
        SfxVolume = SfxVolume,
        EnableSoundEffects = EnableSoundEffects,
        MuteAll = MuteAll
    };

    partial void OnMasterVolumeChanged(int value) => _onChanged?.Invoke();
    partial void OnMusicVolumeChanged(int value) => _onChanged?.Invoke();
    partial void OnSfxVolumeChanged(int value) => _onChanged?.Invoke();
    partial void OnEnableSoundEffectsChanged(bool value) => _onChanged?.Invoke();
    partial void OnMuteAllChanged(bool value) => _onChanged?.Invoke();
}
```

### DisplaySettingsTabViewModel

```csharp
public partial class DisplaySettingsTabViewModel : ViewModelBase
{
    private readonly Action? _onChanged;

    [ObservableProperty] private string _selectedTheme = "Dark Fantasy";
    [ObservableProperty] private int _fontSizePercent = 100;
    [ObservableProperty] private bool _enableCombatAnimations = true;
    [ObservableProperty] private bool _enableRoomTransitions = true;
    [ObservableProperty] private bool _highContrastMode;

    public ObservableCollection<string> AvailableThemes { get; } = new()
    {
        "Dark Fantasy", "High Fantasy", "Classic", "Minimal"
    };

    public DisplaySettingsTabViewModel(DisplaySettings settings, Action onChanged)
    {
        _onChanged = onChanged;
        SelectedTheme = settings.Theme;
        FontSizePercent = settings.FontSizePercent;
        EnableCombatAnimations = settings.EnableCombatAnimations;
        EnableRoomTransitions = settings.EnableRoomTransitions;
        HighContrastMode = settings.HighContrastMode;
    }

    public DisplaySettingsTabViewModel() { }

    public DisplaySettings ToSettings() => new()
    {
        Theme = SelectedTheme,
        FontSizePercent = FontSizePercent,
        EnableCombatAnimations = EnableCombatAnimations,
        EnableRoomTransitions = EnableRoomTransitions,
        HighContrastMode = HighContrastMode
    };

    partial void OnSelectedThemeChanged(string value) => _onChanged?.Invoke();
    partial void OnFontSizePercentChanged(int value) => _onChanged?.Invoke();
    partial void OnEnableCombatAnimationsChanged(bool value) => _onChanged?.Invoke();
    partial void OnEnableRoomTransitionsChanged(bool value) => _onChanged?.Invoke();
    partial void OnHighContrastModeChanged(bool value) => _onChanged?.Invoke();
}
```

### GameplaySettingsTabViewModel

```csharp
public partial class GameplaySettingsTabViewModel : ViewModelBase
{
    private readonly Action? _onChanged;

    [ObservableProperty] private string _difficulty = "Normal";
    [ObservableProperty] private string _autoSaveFrequency = "Every 5 minutes";
    [ObservableProperty] private bool _showCombatTooltips = true;
    [ObservableProperty] private bool _showTutorialHints = true;
    [ObservableProperty] private bool _confirmDangerousActions;

    public ObservableCollection<string> Difficulties { get; } = new() { "Easy", "Normal", "Hard" };
    public ObservableCollection<string> AutoSaveOptions { get; } = new()
    {
        "Disabled", "Every 1 minute", "Every 5 minutes", "Every 10 minutes"
    };

    public string DifficultyDescription => Difficulty switch
    {
        "Easy" => "+20% damage dealt, -20% damage taken",
        "Normal" => "Standard experience",
        "Hard" => "-20% damage dealt, +20% damage taken",
        _ => ""
    };

    public GameplaySettingsTabViewModel(GameplaySettings settings, Action onChanged)
    {
        _onChanged = onChanged;
        Difficulty = settings.Difficulty;
        AutoSaveFrequency = settings.AutoSaveFrequency;
        ShowCombatTooltips = settings.ShowCombatTooltips;
        ShowTutorialHints = settings.ShowTutorialHints;
        ConfirmDangerousActions = settings.ConfirmDangerousActions;
    }

    public GameplaySettingsTabViewModel() { }

    public GameplaySettings ToSettings() => new()
    {
        Difficulty = Difficulty,
        AutoSaveFrequency = AutoSaveFrequency,
        ShowCombatTooltips = ShowCombatTooltips,
        ShowTutorialHints = ShowTutorialHints,
        ConfirmDangerousActions = ConfirmDangerousActions
    };

    partial void OnDifficultyChanged(string value)
    {
        OnPropertyChanged(nameof(DifficultyDescription));
        _onChanged?.Invoke();
    }
}
```

### ControlsSettingsTabViewModel

```csharp
public partial class ControlsSettingsTabViewModel : ViewModelBase
{
    private readonly Action? _onChanged;

    [ObservableProperty] private ObservableCollection<KeybindingViewModel> _globalBindings = new();
    [ObservableProperty] private ObservableCollection<KeybindingViewModel> _gameBindings = new();
    [ObservableProperty] private bool _isRebinding;
    [ObservableProperty] private KeybindingViewModel? _rebindingTarget;

    public ControlsSettingsTabViewModel(ControlsSettings settings, Action onChanged)
    {
        _onChanged = onChanged;
        foreach (var (action, key) in settings.GlobalBindings)
            GlobalBindings.Add(new KeybindingViewModel(action, key, "Global", StartRebind));
        foreach (var (action, key) in settings.GameBindings)
            GameBindings.Add(new KeybindingViewModel(action, key, "Game", StartRebind));
    }

    public ControlsSettingsTabViewModel()
    {
        GlobalBindings.Add(new KeybindingViewModel("Help / Shortcuts", "F1", "Global", null));
        GlobalBindings.Add(new KeybindingViewModel("Quick Save", "F5", "Global", null));
        GameBindings.Add(new KeybindingViewModel("Toggle Inventory", "I", "Game", null));
    }

    private void StartRebind(KeybindingViewModel binding)
    {
        IsRebinding = true;
        RebindingTarget = binding;
    }

    public void CompleteRebind(string newKey)
    {
        if (RebindingTarget != null)
        {
            RebindingTarget.CurrentKey = newKey;
            _onChanged?.Invoke();
        }
        IsRebinding = false;
        RebindingTarget = null;
    }

    [RelayCommand]
    private void ResetToDefaults()
    {
        GlobalBindings.Clear();
        GlobalBindings.Add(new KeybindingViewModel("Help / Shortcuts", "F1", "Global", StartRebind));
        GlobalBindings.Add(new KeybindingViewModel("Quick Save", "F5", "Global", StartRebind));
        GlobalBindings.Add(new KeybindingViewModel("Quick Load", "F9", "Global", StartRebind));
        GlobalBindings.Add(new KeybindingViewModel("Close Window", "Escape", "Global", StartRebind));
        _onChanged?.Invoke();
    }

    public ControlsSettings ToSettings() => new()
    {
        GlobalBindings = GlobalBindings.ToDictionary(b => b.ActionName, b => b.CurrentKey),
        GameBindings = GameBindings.ToDictionary(b => b.ActionName, b => b.CurrentKey)
    };
}

public partial class KeybindingViewModel : ObservableObject
{
    private readonly Action<KeybindingViewModel>? _onRebind;

    public string ActionName { get; }
    public string Category { get; }
    [ObservableProperty] private string _currentKey;

    public KeybindingViewModel(string action, string key, string category, Action<KeybindingViewModel>? onRebind)
    {
        ActionName = action;
        CurrentKey = key;
        Category = category;
        _onRebind = onRebind;
    }

    [RelayCommand]
    private void Rebind() => _onRebind?.Invoke(this);
}
```

---

## 7. Tab Controls

**File:** `src/Presentation/RuneAndRust.Avalonia/Views/Settings/SettingsTabTemplates.axaml`

```xml
<ResourceDictionary>
    <!-- Audio Tab -->
    <DataTemplate DataType="vm:AudioSettingsTabViewModel">
        <StackPanel Spacing="16">
            <TextBlock Text="AUDIO SETTINGS" Classes="tab-title" />
            
            <StackPanel Spacing="4">
                <TextBlock Text="Master Volume" />
                <Grid ColumnDefinitions="*,50">
                    <Slider Grid.Column="0" Value="{Binding MasterVolume}" Minimum="0" Maximum="100" />
                    <TextBlock Grid.Column="1" Text="{Binding MasterVolume, StringFormat={}{0}%}" />
                </Grid>
            </StackPanel>
            
            <StackPanel Spacing="4">
                <TextBlock Text="Music Volume" />
                <Grid ColumnDefinitions="*,50">
                    <Slider Grid.Column="0" Value="{Binding MusicVolume}" Minimum="0" Maximum="100" />
                    <TextBlock Grid.Column="1" Text="{Binding MusicVolume, StringFormat={}{0}%}" />
                </Grid>
            </StackPanel>
            
            <StackPanel Spacing="4">
                <TextBlock Text="Sound Effects" />
                <Grid ColumnDefinitions="*,50">
                    <Slider Grid.Column="0" Value="{Binding SfxVolume}" Minimum="0" Maximum="100" />
                    <TextBlock Grid.Column="1" Text="{Binding SfxVolume, StringFormat={}{0}%}" />
                </Grid>
            </StackPanel>
            
            <CheckBox Content="Enable Sound Effects" IsChecked="{Binding EnableSoundEffects}" />
            <CheckBox Content="Mute All Audio" IsChecked="{Binding MuteAll}" />
        </StackPanel>
    </DataTemplate>

    <!-- Display Tab -->
    <DataTemplate DataType="vm:DisplaySettingsTabViewModel">
        <StackPanel Spacing="16">
            <TextBlock Text="DISPLAY SETTINGS" Classes="tab-title" />
            
            <StackPanel Spacing="4">
                <TextBlock Text="Theme" />
                <ComboBox ItemsSource="{Binding AvailableThemes}" SelectedItem="{Binding SelectedTheme}" />
            </StackPanel>
            
            <StackPanel Spacing="4">
                <TextBlock Text="Font Size" />
                <Grid ColumnDefinitions="*,50">
                    <Slider Grid.Column="0" Value="{Binding FontSizePercent}" Minimum="80" Maximum="150" />
                    <TextBlock Grid.Column="1" Text="{Binding FontSizePercent, StringFormat={}{0}%}" />
                </Grid>
            </StackPanel>
            
            <CheckBox Content="Enable Combat Animations" IsChecked="{Binding EnableCombatAnimations}" />
            <CheckBox Content="Enable Room Transition Effects" IsChecked="{Binding EnableRoomTransitions}" />
            <CheckBox Content="High Contrast Mode" IsChecked="{Binding HighContrastMode}" />
        </StackPanel>
    </DataTemplate>

    <!-- Gameplay Tab -->
    <DataTemplate DataType="vm:GameplaySettingsTabViewModel">
        <StackPanel Spacing="16">
            <TextBlock Text="GAMEPLAY SETTINGS" Classes="tab-title" />
            
            <StackPanel Spacing="4">
                <TextBlock Text="Difficulty" />
                <ComboBox ItemsSource="{Binding Difficulties}" SelectedItem="{Binding Difficulty}" />
                <TextBlock Text="{Binding DifficultyDescription}" Classes="muted" FontSize="11" />
            </StackPanel>
            
            <StackPanel Spacing="4">
                <TextBlock Text="Auto-Save Frequency" />
                <ComboBox ItemsSource="{Binding AutoSaveOptions}" SelectedItem="{Binding AutoSaveFrequency}" />
            </StackPanel>
            
            <CheckBox Content="Show Combat Tooltips" IsChecked="{Binding ShowCombatTooltips}" />
            <CheckBox Content="Show Tutorial Hints" IsChecked="{Binding ShowTutorialHints}" />
            <CheckBox Content="Confirm Before Dangerous Actions" IsChecked="{Binding ConfirmDangerousActions}" />
        </StackPanel>
    </DataTemplate>

    <!-- Controls Tab -->
    <DataTemplate DataType="vm:ControlsSettingsTabViewModel">
        <Grid RowDefinitions="Auto,*,Auto">
            <TextBlock Grid.Row="0" Text="CONTROLS" Classes="tab-title" Margin="0,0,0,16" />
            
            <ScrollViewer Grid.Row="1">
                <StackPanel Spacing="16">
                    <TextBlock Text="GLOBAL" FontWeight="SemiBold" />
                    <ItemsControl ItemsSource="{Binding GlobalBindings}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,80,80" Margin="0,4">
                                    <TextBlock Grid.Column="0" Text="{Binding ActionName}" />
                                    <TextBlock Grid.Column="1" Text="{Binding CurrentKey}" HorizontalAlignment="Center" />
                                    <Button Grid.Column="2" Content="Rebind" Command="{Binding RebindCommand}" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <TextBlock Text="GAME" FontWeight="SemiBold" Margin="0,8,0,0" />
                    <ItemsControl ItemsSource="{Binding GameBindings}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="*,80,80" Margin="0,4">
                                    <TextBlock Grid.Column="0" Text="{Binding ActionName}" />
                                    <TextBlock Grid.Column="1" Text="{Binding CurrentKey}" HorizontalAlignment="Center" />
                                    <Button Grid.Column="2" Content="Rebind" Command="{Binding RebindCommand}" />
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>
            
            <Button Grid.Row="2" Content="Reset to Defaults" Command="{Binding ResetToDefaultsCommand}" 
                    HorizontalAlignment="Center" Margin="0,16,0,0" />
        </Grid>
    </DataTemplate>
</ResourceDictionary>
```

---

## 8. Settings Configuration

**File:** `config/settings.json`

```json
{
  "$schema": "./schemas/settings.schema.json",
  "version": "1.0",
  "audio": {
    "masterVolume": 75,
    "musicVolume": 50,
    "sfxVolume": 85,
    "enableSoundEffects": true,
    "muteAll": false
  },
  "display": {
    "theme": "Dark Fantasy",
    "fontSizePercent": 100,
    "enableCombatAnimations": true,
    "enableRoomTransitions": true,
    "highContrastMode": false
  },
  "gameplay": {
    "difficulty": "Normal",
    "autoSaveFrequency": "Every 5 minutes",
    "showCombatTooltips": true,
    "showTutorialHints": true,
    "confirmDangerousActions": false
  },
  "controls": {
    "globalBindings": {
      "Help / Shortcuts": "F1",
      "Quick Save": "F5",
      "Quick Load": "F9",
      "Close Window": "Escape"
    },
    "gameBindings": {
      "Toggle Inventory": "I",
      "Toggle Map": "M",
      "Toggle Quest Log": "J",
      "Toggle Character": "C"
    }
  }
}
```

---

## 9. Styles

**File:** `src/Presentation/RuneAndRust.Avalonia/Styles/SettingsStyles.axaml`

```xml
<Styles xmlns="https://github.com/avaloniaui">
    <Style Selector="ListBox.settings-tabs">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
    </Style>
    <Style Selector="ListBox.settings-tabs ListBoxItem">
        <Setter Property="Padding" Value="16,12" />
    </Style>
    <Style Selector="ListBox.settings-tabs ListBoxItem:selected">
        <Setter Property="Background" Value="{StaticResource PrimaryBrush}" />
    </Style>
    <Style Selector="Border.settings-content">
        <Setter Property="Background" Value="{StaticResource SurfaceBrush}" />
    </Style>
    <Style Selector="Border.settings-footer">
        <Setter Property="Background" Value="{StaticResource SurfaceDarkBrush}" />
        <Setter Property="BorderThickness" Value="0,1,0,0" />
        <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}" />
    </Style>
    <Style Selector="TextBlock.tab-title">
        <Setter Property="FontSize" Value="16" />
        <Setter Property="FontWeight" Value="Bold" />
        <Setter Property="Margin" Value="0,0,0,16" />
    </Style>
</Styles>
```

---

## 10. Logging Specifications

| Component | Level | Events |
|-----------|-------|--------|
| SettingsWindowViewModel | Information | Apply, Cancel, OK |
| Tab ViewModels | Debug | Setting changes |
| SettingsService | Information | Save, Load, Reset |

---

## 11. Unit Testing Requirements

| Feature | Tests |
|---------|-------|
| Audio tab bindings | 2 |
| Display tab bindings | 2 |
| Gameplay tab bindings | 2 |
| Apply/Cancel/OK | 2 |
| Persistence | 2 |
| **Total** | **~10** |

---

## 12. Use Cases

- **UC-080b-001**: Adjust master volume
- **UC-080b-002**: Change theme
- **UC-080b-003**: Change difficulty
- **UC-080b-004**: Rebind a key
- **UC-080b-005**: Reset keybindings to defaults
- **UC-080b-006**: Apply and close

---

## 13. Deliverable Checklist

- [ ] `Views/SettingsWindow.axaml` updated
- [ ] `ViewModels/SettingsWindowViewModel.cs` created
- [ ] 4 tab ViewModels created
- [ ] `SettingsTabTemplates.axaml` created
- [ ] `SettingsStyles.axaml` created
- [ ] `settings.json` schema created
- [ ] ~10 unit tests implemented

---

## 14. Acceptance Criteria

- [ ] Settings window opens from menu
- [ ] Four tabs display correctly
- [ ] Audio sliders adjust volumes
- [ ] Mute checkbox works
- [ ] Theme dropdown changes theme
- [ ] Font size slider adjusts text
- [ ] Difficulty dropdown saves
- [ ] Keybinding list shows bindings
- [ ] Rebind captures new key
- [ ] Reset to Defaults works
- [ ] Apply saves without closing
- [ ] Cancel reverts changes
- [ ] OK saves and closes
- [ ] ~10 unit tests pass

---

## 15. Dependencies

### Required from v0.8.0a
- Wizard window patterns

### Required from Application Layer
- `ISettingsService`, `GameSettings`, section classes

### Provides to v0.8.0c
- Controls tab integration, keybinding model

---

## 16. Future Considerations

### Deferred to v0.9.0
- Graphics/resolution settings
- Accessibility options
- Profile management

---

*Document Version: 1.0*
*Last Updated: 2026-01-10*
