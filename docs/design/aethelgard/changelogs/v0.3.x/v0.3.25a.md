# Changelog: v0.3.25a - The Schema (JSON Format Definition)
**Release Date:** 2025-12-27

---

## Summary

Version 0.3.25a establishes the JSON schema infrastructure for externalized capture templates, migrating all 19 hardcoded C# templates from `RuneAndRust.Engine/Services/CaptureTemplates.cs` to JSON format. This release introduces a JSON Schema (draft 2020-12) for validation, organizes templates into 6 category files, and implements dual validation scripts (PowerShell and Bash) with comprehensive Domain 4 compliance checking. Changes span the **Data Layer** (schema definition, category files, documentation) and **Scripts Layer** (validation tooling). Key architectural patterns include schema-driven content validation, category-based template organization, and automated Domain 4 forbidden pattern detection. This infrastructure enables content authors to add new lore fragments without modifying code.

---

## New Files Created

### Data Layer - Schema Definition

| File | Purpose |
|------|---------|
| `data/capture-templates/schema/capture-template.schema.json` | JSON Schema (draft 2020-12) with validation rules for capture templates; defines required fields, CaptureType enum values, content length constraints, and quality ranges |
| `data/capture-templates/README.md` | Quick reference documentation for content authors; includes CaptureType definitions, Domain 4 compliance table, template structure guide, and validation instructions |

### Data Layer - Category Template Files (6 files, 19 templates total)

| File | Template Count | CaptureTypes Used |
|------|----------------|-------------------|
| `data/capture-templates/categories/rusted-servitor.json` | 4 | Specimen, TextFragment, VisualRecord, RunicTrace |
| `data/capture-templates/categories/generic-container.json` | 3 | TextFragment (2), OralHistory (1) |
| `data/capture-templates/categories/blighted-creature.json` | 3 | Specimen, VisualRecord, RunicTrace |
| `data/capture-templates/categories/industrial-site.json` | 3 | EchoRecording, VisualRecord, TextFragment |
| `data/capture-templates/categories/ancient-ruin.json` | 3 | TextFragment, OralHistory, VisualRecord |
| `data/capture-templates/categories/field-guide-triggers.json` | 3 | OralHistory (2), TextFragment (1) |

### Scripts Layer - Validation Tooling

| File | Purpose |
|------|---------|
| `scripts/validate-templates.ps1` | PowerShell validation script; checks JSON syntax, required fields, CaptureType enum validity, ID uniqueness, content length constraints, quality ranges, and Domain 4 compliance |
| `scripts/validate-templates.sh` | Bash validation script (cross-platform); functionally equivalent to PowerShell version; requires `jq` for JSON parsing |

---

## Code Implementation Details

### JSON Schema Definition

**File:** `data/capture-templates/schema/capture-template.schema.json`

**Schema Metadata:**
```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://runeandrust.game/schemas/capture-template.schema.json",
  "title": "Capture Template Collection",
  "description": "Schema for Data Capture template files in Rune & Rust. All content must follow AAM-VOICE Layer 2 (Diagnostic) constraints and Domain 4 compliance (no precision measurements)."
}
```

**Required Top-Level Fields:**
- `$schema` (string): Reference to schema file
- `category` (string): Category identifier matching filename (kebab-case, pattern: `^[a-z][a-z0-9-]*$`)
- `version` (string): Schema version for migration tracking (semver format, pattern: `^\d+\.\d+\.\d+$`)
- `templates` (array): Array of capture templates (minimum 1 item)

**Optional Top-Level Fields:**
- `description` (string): Human-readable category description for content authors
- `matchKeywords` (array): Default keywords for all templates in category (can be overridden per-template)

**Template Object Definition (`$defs/captureTemplate`):**

Required Fields:
- `id` (string): Unique template identifier, kebab-case, globally unique across all files (pattern: `^[a-z][a-z0-9-]*$`)
- `type` (string): CaptureType enum value (one of: TextFragment, EchoRecording, VisualRecord, Specimen, OralHistory, RunicTrace)
- `fragmentContent` (string): Lore text content, Domain 4 compliant (length: 20-1000 characters)
- `source` (string): Discovery context shown in UI (length: 5-100 characters)

Optional Fields:
- `matchKeywords` (array): Keywords for Codex auto-assignment; overrides category-level keywords if provided
- `quality` (integer): Quality value affecting Legend rewards (range: 1-100, default: 15)
- `tags` (array): Metadata tags for filtering and categorization (not displayed in-game)
- `domain4Notes` (string): Author notes on Domain 4 compliance (internal documentation only)

**CaptureType Enum Values:**

| Type | Voice Style | Description |
|------|-------------|-------------|
| TextFragment | Scholarly, formal, historical | Written records, notes, torn pages |
| EchoRecording | Personal, urgent, often corrupted | Audio logs, transcribed recordings |
| VisualRecord | Descriptive, technical, observational | Schematics, diagrams, images |
| Specimen | Analytical, clinical, scientific | Biological samples, tissue analysis |
| OralHistory | Conversational, dialectal, personal | Dialogue fragments, rumors, traditions |
| RunicTrace | Mystical, precise, layered | Magical/technological trace analysis |

**Validation Constraints:**

| Field | Constraint | Value |
|-------|------------|-------|
| `id` | Pattern | Kebab-case: `^[a-z][a-z0-9-]*$` |
| `id` | Uniqueness | Globally unique across all category files |
| `type` | Enum | Must be one of 6 CaptureType values |
| `fragmentContent` | Min length | 20 characters |
| `fragmentContent` | Max length | 1000 characters |
| `fragmentContent` | Domain 4 | No precision measurements (checked by validation scripts) |
| `source` | Min length | 5 characters |
| `source` | Max length | 100 characters |
| `quality` | Range | 1-100 (inclusive) |
| `quality` | Default | 15 |
| `category` | Pattern | Kebab-case: `^[a-z][a-z0-9-]*$` |
| `version` | Pattern | Semver: `^\d+\.\d+\.\d+$` |

---

### Example Category File Structure

**File:** `data/capture-templates/categories/rusted-servitor.json`

**Complete File Contents:**
```json
{
  "$schema": "../schema/capture-template.schema.json",
  "category": "rusted-servitor",
  "version": "1.0.0",
  "description": "Templates for Rusted Servitor encounters and automaton examinations. Matched by keywords: servitor, automaton, machine.",
  "matchKeywords": ["servitor", "automaton", "machine", "mechanical"],
  "templates": [
    {
      "id": "servitor-fungal-infection",
      "type": "Specimen",
      "fragmentContent": "The servo-motor shows signs of organic fungal infiltration. Mycelial threads have woven through the mechanical joints, creating an unsettling fusion of rust and growth.",
      "source": "Servitor examination",
      "quality": 15,
      "tags": ["servitor", "fungal", "blight-adjacent"]
    },
    {
      "id": "servitor-maintenance-log",
      "type": "TextFragment",
      "fragmentContent": "Recovered maintenance logs, partially corrupted: '...Unit 7-Alpha reporting nominal function. Awaiting directives from Central. Note: Unusual signal interference detected in lower sectors...'",
      "source": "Recovered data-slate",
      "matchKeywords": ["servitor", "automaton", "aesir"],
      "quality": 15,
      "tags": ["aesir", "pre-glitch", "log"]
    },
    {
      "id": "servitor-crystal-growth",
      "type": "VisualRecord",
      "fragmentContent": "Crystalline growths cluster around the primary actuator joints. The formations pulse with a faint amber luminescence when the unit attempts movement, suggesting some form of energy harvesting.",
      "source": "Visual inspection",
      "matchKeywords": ["servitor", "automaton", "crystal"],
      "quality": 15,
      "tags": ["crystal", "energy"]
    },
    {
      "id": "servitor-aetheric-resonance",
      "type": "RunicTrace",
      "fragmentContent": "Faint Aetheric resonance detected in the power coupling. The signature matches pre-Glitch Aesir manufacturing standards, though degradation patterns suggest centuries of dormancy.",
      "source": "Runic analysis",
      "matchKeywords": ["servitor", "aesir", "rune", "aetheric"],
      "quality": 15,
      "tags": ["aetheric", "pre-glitch", "runic"]
    }
  ]
}
```

**Template Behaviors:**
- Category-level `matchKeywords` array provides default keywords for all templates
- Individual templates can override category keywords with template-specific `matchKeywords`
- All templates default to `quality: 15` (standard Legend reward value)
- Tags array enables content filtering but is not displayed in-game
- Schema reference uses relative path `../schema/capture-template.schema.json`

---

### Template Migration Details

All 19 templates were migrated from the C# record type in `RuneAndRust.Engine/Services/CaptureTemplates.cs`:

**Original C# Definition:**
```csharp
public record CaptureTemplate(
    CaptureType Type,
    string FragmentContent,
    string Source,
    string[] MatchingKeywords
);
```

**Migration Mapping:**

| Category | Templates | ID Examples | Source Location |
|----------|-----------|-------------|-----------------|
| rusted-servitor | 4 | `servitor-fungal-infection`, `servitor-maintenance-log` | `CaptureTemplates.cs` lines 10-47 |
| generic-container | 3 | `container-eastern-tunnels`, `container-old-tormund` | `CaptureTemplates.cs` lines 50-74 |
| blighted-creature | 3 | `blight-tissue-mutation`, `blight-awareness-retained` | `CaptureTemplates.cs` lines 77-101 |
| industrial-site | 3 | `industrial-echo-stone`, `industrial-schematics` | `CaptureTemplates.cs` lines 104-128 |
| ancient-ruin | 3 | `ruin-wall-inscription`, `ruin-wanderers-tales` | `CaptureTemplates.cs` lines 131-155 |
| field-guide-triggers | 3 | `guide-psychic-stress`, `guide-combat-training` | `CaptureTemplates.cs` lines 158-182 |

**Migration Changes:**
- C# property `FragmentContent` → JSON field `fragmentContent` (camelCase)
- C# property `MatchingKeywords` → JSON field `matchKeywords` (camelCase)
- Added required `id` field (kebab-case identifier)
- Added optional `quality` field (defaults to 15)
- Added optional `tags` field for metadata
- Category-level keywords moved to file-level `matchKeywords` array
- Source moved from C# parameter to JSON `source` field

**Complete Template Inventory:**

| ID | Type | Category | Content Preview |
|----|------|----------|-----------------|
| `servitor-fungal-infection` | Specimen | rusted-servitor | "The servo-motor shows signs of organic fungal infiltration..." |
| `servitor-maintenance-log` | TextFragment | rusted-servitor | "Recovered maintenance logs, partially corrupted..." |
| `servitor-crystal-growth` | VisualRecord | rusted-servitor | "Crystalline growths cluster around the primary actuator..." |
| `servitor-aetheric-resonance` | RunicTrace | rusted-servitor | "Faint Aetheric resonance detected in the power coupling..." |
| `container-eastern-tunnels` | TextFragment | generic-container | "A crumpled note with faded writing..." |
| `container-old-tormund` | OralHistory | generic-container | "This container bears clan-marks matching stories..." |
| `container-inventory-records` | TextFragment | generic-container | "Inventory records scratched into the container's lid..." |
| `blight-tissue-mutation` | Specimen | blighted-creature | "Tissue samples reveal extensive cellular mutation..." |
| `blight-awareness-retained` | VisualRecord | blighted-creature | "The creature's eyes retained a disturbing awareness..." |
| `blight-deliberate-exposure` | RunicTrace | blighted-creature | "Residual Aetheric contamination lingers in the remains..." |
| `industrial-echo-stone` | EchoRecording | industrial-site | "A damaged echo-stone preserves a fragment..." |
| `industrial-schematics` | VisualRecord | industrial-site | "Schematics etched into a metal plate..." |
| `industrial-safety-notice` | TextFragment | industrial-site | "Safety notices posted throughout the area..." |
| `ruin-wall-inscription` | TextFragment | ancient-ruin | "Wall inscriptions, partially eroded..." |
| `ruin-wanderers-tales` | OralHistory | ancient-ruin | "This site matches descriptions from the Wanderer's Tales..." |
| `ruin-defaced-murals` | VisualRecord | ancient-ruin | "Murals cover what remains of the walls..." |
| `guide-psychic-stress` | OralHistory | field-guide-triggers | "The veterans speak of Psychic Stress in hushed tones..." |
| `guide-combat-training` | TextFragment | field-guide-triggers | "A training manual, dog-eared and stained..." |
| `guide-encumbrance` | OralHistory | field-guide-triggers | "The pack-master's wisdom: 'Every gram matters out there...'" |

---

## Validation Scripts

### PowerShell Validation Script

**File:** `scripts/validate-templates.ps1`

**Script Parameters:**
```powershell
param(
    [string]$SchemaPath = "data/capture-templates/schema/capture-template.schema.json",
    [string]$TemplatesPath = "data/capture-templates/categories"
)
```

**Validation Checks Performed:**

1. **JSON Syntax Validation**
   - Parses JSON using `ConvertFrom-Json`
   - Reports parse errors with exception messages

2. **Required Top-Level Fields**
   - Checks for `$schema`, `category`, `version`, `templates` fields
   - Ensures `templates` array is non-empty

3. **Template Required Fields**
   - Validates presence of `id`, `type`, `fragmentContent`, `source`
   - Reports missing fields with template ID

4. **ID Format Validation**
   - Regex pattern: `^[a-z][a-z0-9-]*$` (kebab-case)
   - Reports invalid formats

5. **ID Uniqueness Check**
   - Tracks all template IDs across all category files
   - Reports duplicate IDs

6. **CaptureType Enum Validation**
   - Valid types array: TextFragment, EchoRecording, VisualRecord, Specimen, OralHistory, RunicTrace
   - Reports invalid type values

7. **Content Length Validation**
   - `fragmentContent`: 20-1000 characters
   - `source`: 5-100 characters (maximum)
   - Reports violations with actual character counts

8. **Quality Range Validation**
   - Range: 1-100 (inclusive)
   - Reports out-of-range values

9. **Domain 4 Compliance Check**
   - Scans `fragmentContent` for forbidden patterns
   - Reports first violation per template as warning

**Domain 4 Forbidden Patterns:**

| Pattern | Example Match | Violation Type |
|---------|---------------|----------------|
| `\d+%` | "95%" | Percentages |
| `\d+\.\d+` | "18.5" | Decimal precision |
| `\d+\s*(meters?\|km\|kilometers?\|miles?\|feet\|ft)` | "800 meters" | Distance units |
| `\d+\s*(degrees?\|C\|F\|celsius\|fahrenheit)` | "35°C" | Temperature |
| `\d+\s*(seconds?\|minutes?\|hours?\|days?\|years?)` | "18 seconds" | Precise time |
| `\d+\s*(ppm\|dB\|Hz\|kg\|lbs?\|pounds?)` | "6-12 ppm" | Technical units |
| `\d{4,}` | "10000" | Large precise numbers |
| `API\|CPU\|GPU\|RAM\|ROM\|HTTP\|URL` | "API" | Modern tech acronyms |

**Output Format:**

```
=== Capture Template Validator ===
v0.3.25a - Rune & Rust

Loaded schema: data/capture-templates/schema/capture-template.schema.json

Validating: generic-container.json
  OK 3 templates found

Validating: rusted-servitor.json
  OK 4 templates found

...

=== Summary ===
Total template files: 6
Total templates: 19

Warnings: 0

OK All templates valid!
```

**Exit Codes:**
- `0`: All validations passed (no errors)
- `1`: One or more validation errors detected

**Lines of Code:** 184 lines

---

### Bash Validation Script

**File:** `scripts/validate-templates.sh`

**Script Configuration:**
```bash
SCHEMA_PATH="data/capture-templates/schema/capture-template.schema.json"
TEMPLATES_PATH="data/capture-templates/categories"
```

**Dependencies:**
- `jq` (JSON processor) - Required for JSON parsing
- Script checks for `jq` availability and provides installation instructions if missing

**Validation Checks Performed:**

Identical to PowerShell script:
1. JSON syntax validation (via `jq empty`)
2. Required top-level fields (`$schema`, `category`, `version`, `templates`)
3. Template required fields (`id`, `type`, `fragmentContent`, `source`)
4. ID format validation (kebab-case regex)
5. ID uniqueness check (across all files)
6. CaptureType enum validation
7. Content length constraints (fragmentContent 20-1000, source 5+)
8. Quality range validation (1-100)
9. Domain 4 compliance patterns (via `grep -E`)

**Implementation Differences from PowerShell:**

| Aspect | PowerShell | Bash |
|--------|-----------|------|
| JSON parsing | `ConvertFrom-Json` | `jq` |
| Pattern matching | `-match` operator | `grep -E` |
| Array handling | `@()` syntax | Bash arrays `()` |
| Conditionals | `if (-not $var)` | `if [ -z "$VAR" ]` |
| Loops | `foreach ($item in $array)` | `for ITEM in $ARRAY` |

**Output Format:** Identical to PowerShell script

**Exit Codes:**
- `0`: All validations passed
- `1`: Validation errors or missing dependencies

**Lines of Code:** 202 lines

---

## Domain 4 Compliance

### Validation Enforcement

Both validation scripts implement automated Domain 4 compliance checking by scanning `fragmentContent` for forbidden precision measurement patterns:

**Forbidden Pattern Categories:**

1. **Percentages** - `\d+%`
   - Example violation: "95% casualties"
   - Compliant alternative: "nearly all perished"

2. **Decimal Precision** - `\d+\.\d+`
   - Example violation: "18.5°C temperature"
   - Compliant alternative: "uncomfortably warm"

3. **Distance Measurements** - `\d+\s*(meters?|km|kilometers?|miles?|feet|ft)`
   - Example violation: "800 meters away"
   - Compliant alternative: "beyond bowshot"

4. **Temperature Units** - `\d+\s*(degrees?|°C|°F|celsius|fahrenheit)`
   - Example violation: "35 degrees Celsius"
   - Compliant alternative: "oppressively hot"

5. **Precise Time** - `\d+\s*(seconds?|minutes?|hours?|days?|years?)`
   - Example violation: "18 seconds elapsed"
   - Compliant alternative: "several moments"

6. **Technical Units** - `\d+\s*(ppm|dB|Hz|kg|lbs?|pounds?)`
   - Example violation: "H2S 6-12 ppm"
   - Compliant alternative: "air thick with sulfurous stench"

7. **Large Precise Numbers** - `\d{4,}`
   - Example violation: "10,000 residents"
   - Compliant alternative: "a thriving settlement"

8. **Modern Tech Acronyms** - `API|CPU|GPU|RAM|ROM|HTTP|URL`
   - Example violation: "API error"
   - Compliant alternative: "Anomaly detected"

### Compliance Verification Results

All 19 migrated templates passed Domain 4 compliance validation:

```
=== Summary ===
Total template files: 6
Total templates: 19
Errors: 0
Domain 4 Warnings: 0

OK All templates valid!
```

**Domain 4 Compliant Content Examples:**

| Template ID | CaptureType | Domain 4 Compliant Phrasing |
|-------------|-------------|----------------------------|
| `servitor-fungal-infection` | Specimen | "signs of organic fungal infiltration" (no measurement) |
| `blight-tissue-mutation` | Specimen | "fractal patterns" (no precision) |
| `servitor-aetheric-resonance` | RunicTrace | "centuries of dormancy" (vague temporal reference) |
| `industrial-schematics` | VisualRecord | "several sections" (imprecise count) |
| `ruin-wanderers-tales` | OralHistory | "Where the three rivers once met" (relative location) |

---

## Directory Structure After Release

```
rune-rust/
├── data/
│   └── capture-templates/ [NEW]
│       ├── schema/
│       │   └── capture-template.schema.json [NEW]
│       ├── categories/
│       │   ├── ancient-ruin.json [NEW]
│       │   ├── blighted-creature.json [NEW]
│       │   ├── field-guide-triggers.json [NEW]
│       │   ├── generic-container.json [NEW]
│       │   ├── industrial-site.json [NEW]
│       │   └── rusted-servitor.json [NEW]
│       └── README.md [NEW]
│
├── scripts/
│   ├── validate-templates.ps1 [NEW]
│   └── validate-templates.sh [NEW]
│
├── RuneAndRust.Engine/
│   └── Services/
│       └── CaptureTemplates.cs [PENDING DEPRECATION]
│
└── RuneAndRust.Core/
    └── Enums/
        └── CaptureType.cs [REFERENCED]
```

**Directory Annotations:**

- **`data/capture-templates/`** - New data directory for externalized content
- **`data/capture-templates/schema/`** - JSON Schema definitions
- **`data/capture-templates/categories/`** - Template JSON files organized by category
- **`scripts/`** - Existing scripts directory, now includes validation tooling
- **`CaptureTemplates.cs`** - Pending deprecation in v0.3.25b (will be removed when JSON loader is implemented)
- **`CaptureType.cs`** - Source of truth for enum values referenced by schema

---

## Verification Results

### Schema Validation

```bash
$ bash scripts/validate-templates.sh

=== Capture Template Validator ===
v0.3.25a - Rune & Rust

Loaded schema: data/capture-templates/schema/capture-template.schema.json

Validating: generic-container.json
  Found 3 templates
  OK 3 templates validated

Validating: rusted-servitor.json
  Found 4 templates
  OK 4 templates validated

Validating: industrial-site.json
  Found 3 templates
  OK 3 templates validated

Validating: ancient-ruin.json
  Found 3 templates
  OK 3 templates validated

Validating: field-guide-triggers.json
  Found 3 templates
  OK 3 templates validated

Validating: blighted-creature.json
  Found 3 templates
  OK 3 templates validated

=== Summary ===
Total template files: 6
Total templates: 19

OK All templates valid!
```

**Validation Summary:**
- Total template files validated: 6
- Total templates validated: 19
- JSON syntax errors: 0
- Required field violations: 0
- ID format violations: 0
- Duplicate ID violations: 0
- CaptureType enum violations: 0
- Content length violations: 0
- Quality range violations: 0
- Domain 4 compliance warnings: 0

### File Metrics

| Metric | Value |
|--------|-------|
| New files created | 10 |
| New directories | 3 (`data/capture-templates/`, `data/capture-templates/schema/`, `data/capture-templates/categories/`) |
| Templates migrated | 19 |
| Category files | 6 |
| Schema lines | 111 |
| Validation script lines (PowerShell) | 184 |
| Validation script lines (Bash) | 202 |
| README lines | 118 |
| Total new documentation lines | 229 (schema + README) |
| Total validation script lines | 386 (combined) |

### Template Distribution

| Category | Template Count | Percentage |
|----------|----------------|------------|
| rusted-servitor | 4 | 21.1% |
| generic-container | 3 | 15.8% |
| blighted-creature | 3 | 15.8% |
| industrial-site | 3 | 15.8% |
| ancient-ruin | 3 | 15.8% |
| field-guide-triggers | 3 | 15.8% |
| **Total** | **19** | **100%** |

### CaptureType Distribution

| CaptureType | Count | Percentage |
|-------------|-------|------------|
| TextFragment | 6 | 31.6% |
| OralHistory | 4 | 21.1% |
| VisualRecord | 4 | 21.1% |
| Specimen | 2 | 10.5% |
| RunicTrace | 2 | 10.5% |
| EchoRecording | 1 | 5.3% |
| **Total** | **19** | **100%** |

---

## Running Validation

### PowerShell (Windows, macOS with PowerShell Core)

```powershell
# Default paths (from repository root)
pwsh scripts/validate-templates.ps1

# Custom paths
pwsh scripts/validate-templates.ps1 -SchemaPath "custom/schema.json" -TemplatesPath "custom/templates"
```

### Bash (macOS, Linux, WSL)

```bash
# Default paths (from repository root)
bash scripts/validate-templates.sh

# Make executable (one-time setup)
chmod +x scripts/validate-templates.sh
./scripts/validate-templates.sh
```

**Prerequisites:**
- **PowerShell:** PowerShell 7+ (Windows built-in, macOS/Linux via `brew install powershell`)
- **Bash:** `jq` JSON processor (`brew install jq` on macOS, `apt install jq` on Linux)

---

## Technical Implementation Notes

### 1. JSON Schema Draft 2020-12

The schema uses JSON Schema Draft 2020-12, the latest stable draft version:

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema"
}
```

**Rationale:**
- Modern draft with improved validation capabilities
- Better support for `$defs` (replaces deprecated `definitions`)
- Enhanced string pattern matching for kebab-case validation

### 2. Kebab-Case Validation Pattern

Template IDs and category names enforce kebab-case via regex:

```json
{
  "pattern": "^[a-z][a-z0-9-]*$"
}
```

**Pattern Explanation:**
- `^[a-z]` - Must start with lowercase letter
- `[a-z0-9-]*` - Followed by zero or more lowercase letters, digits, or hyphens
- `$` - End of string

**Valid Examples:** `servitor-fungal-infection`, `guide-psychic-stress`, `container-old-tormund`

**Invalid Examples:** `Servitor_Fungal` (uppercase, underscore), `123-template` (starts with digit)

### 3. Global ID Uniqueness

The validation scripts track all template IDs across all category files to ensure global uniqueness:

**PowerShell Implementation:**
```powershell
$allTemplateIds = @()
foreach ($template in $content.templates) {
    if ($allTemplateIds -contains $template.id) {
        $errors += "Duplicate template ID '$($template.id)'"
    }
    $allTemplateIds += $template.id
}
```

**Bash Implementation:**
```bash
ALL_IDS=()
for i in $(seq 0 $((COUNT - 1))); do
    ID=$(jq -r ".templates[$i].id // empty" "$FILE")
    if [[ " ${ALL_IDS[*]} " =~ " ${ID} " ]]; then
        ERRORS+=("Duplicate template ID '$ID'")
    fi
    ALL_IDS+=("$ID")
done
```

**Rationale:**
- Prevents accidental ID collisions across category files
- Ensures templates can be uniquely referenced in code
- Simplifies future template lookup implementation

### 4. Category-Level vs Template-Level Keywords

The schema supports keyword inheritance:

```json
{
  "matchKeywords": ["servitor", "automaton", "machine"],  // Category-level default
  "templates": [
    {
      "id": "servitor-fungal-infection",
      // Inherits category-level keywords
    },
    {
      "id": "servitor-maintenance-log",
      "matchKeywords": ["servitor", "automaton", "aesir"],  // Override
    }
  ]
}
```

**Behaviors:**
- Templates without `matchKeywords` inherit category-level array
- Templates with `matchKeywords` completely override category defaults (no merging)
- Reduces repetition for templates sharing common keywords

### 5. Domain 4 Compliance as Warnings

Domain 4 violations are reported as **warnings**, not errors:

**Rationale:**
- Pattern detection has false positives (e.g., "Unit 7-Alpha" contains digits but is not a measurement)
- Authors should review warnings but validation doesn't block commits
- Balances automated enforcement with editorial judgment
- Prevents overly restrictive content authoring workflow

---

## Related Releases

### Predecessor
- **v0.3.24b "The Golden Master"** (Alpha Packaging) - Centralized version management via `BuildInfo` class, consolidated EF Core migrations

### Next Release
- **v0.3.25b "The Loader"** (JSON Template Loading) - Will implement JSON file deserialization, integrate with existing `CaptureType` enum, deprecate `CaptureTemplates.cs`

### Parent Plan
- **v0.3.25 "The Externalization"** (Content Decoupling) - Multi-release initiative to externalize hardcoded content into JSON format

---

## Next Steps

The following tasks are planned for **v0.3.25b "The Loader"**:

- Implement `ITemplateLoaderService` interface in Engine layer
- Create `JsonTemplateLoader` service with file I/O and deserialization
- Integrate JSON loader with existing `CaptureService`
- Add template loading logging (file paths, template counts, load time)
- Write unit tests for JSON deserialization and schema validation
- Register `ITemplateLoaderService` in DI container (`App.axaml.cs`)
- Deprecate and remove `CaptureTemplates.cs` hardcoded template list
- Update `CaptureService` to load templates from JSON on initialization
- Add error handling for missing files, invalid JSON, schema violations

**Future Enhancements (v0.3.26+):**
- Hot-reload capability for template files during development
- Template versioning and migration system
- Localization support for `fragmentContent` and `source` fields
- Template editor UI for content authors
- Template usage analytics (most/least frequently captured)

---

**End of Changelog v0.3.25a**
