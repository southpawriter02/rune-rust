# v0.13.1c Changelog: Monster Group Display

**Release Date:** 2026-01-20

---

## Summary

Implemented Monster Group Display UI components for presenting grouped enemy compositions, coordinated tactics, leader designations, and group morale effects. These components provide players with strategic information about enemy groups during combat, including member health bars, tactic indicators, and leader defeat notifications.

---

## Added

### DTOs

- **MonsterGroupDisplayDto** — Complete group display data
  - `GroupId`: Unique group instance identifier
  - `GroupName`: Display name (e.g., "Goblin Warband")
  - `Members`: List of group member display data
  - `CurrentTactic`: Current coordinated behavior
  - `HasLeader`: Whether group has a living leader
  - `LeaderRole`: Role designation of the leader
  - `ActiveSynergies`: List of active synergy effects

- **GroupMemberDisplayDto** — Individual member data
  - `MonsterId`: Unique monster instance ID
  - `MemberName`: Display name
  - `Role`: Tactical role (melee, ranged, leader, caster)
  - `CurrentHealth/MaxHealth/HealthPercent`: Health values
  - `IsLeader`: Leader designation flag
  - `IsAlive`: Alive status

- **TacticDisplayDto** — Tactic display data
  - `TacticType`: Tactic enum string value
  - `TacticName`: Display name (e.g., "Flanking Assault")
  - `Description`: Brief tactic description
  - `RoleAssignments`: Role-specific action descriptions

- **RoleAssignmentDto** — Role assignment within a tactic
  - `RoleName`: Role name (e.g., "Archer", "Chief")
  - `ActionDescription`: What this role does

- **LeaderStatusDto** — Leader status display data
  - `LeaderName/LeaderRole`: Leader identification
  - `IsAlive/IsDefeated`: Status flags
  - `MoraleEffects`: Morale effects on defeat

- **SynergyDisplayDto** — Synergy effect display data
  - `SynergyId/SynergyName`: Synergy identification
  - `EffectDescription`: Effect description text
  - `IsTriggered`: Recently triggered flag
  - `SourceRole`: Role that provides synergy

### Configuration

- **MonsterGroupDisplayConfig** — Master configuration class
  - Layout: `TotalWidth`, `TotalHeight`, `StartX`, `StartY`
  - Cards: `MemberCardWidth`, `CardSpacing`, `MemberCardStartRow`
  - Rows: `TacticIndicatorRow`, `MoraleHintRow`, `MoraleEffectRow`
  - Symbols and Colors sub-configurations

- **MonsterGroupSymbols** — Symbol configuration
  - `LeaderBadge`: "[*]"
  - Card border characters: ┌, ┐, └, ┘, ─, │
  - Tree prefixes: "|-- ", "+-- "

- **MonsterGroupColors** — Color configuration
  - `HeaderColor`: Cyan
  - `LeaderColor`: Yellow
  - `TacticColor/TacticHighlightColor`: Yellow/Cyan
  - `SynergyColor`: Green
  - `HintColor`: DarkYellow
  - `CriticalHealthColor`: DarkRed
  - Effect box colors

- **EffectBoxConfig** — Effect box settings
  - `Width`: 53, `Height`: 10, `StartRow`: 3

### Renderers

- **MonsterGroupRenderer**
  - `FormatGroupHeader()`: Centered uppercase group name
  - `FormatMemberCard()`: Multi-line card with borders
  - `FormatMemberHealthBar()`: "HP: current/max" format
  - `GetMemberHealthColor()`: Green → Yellow → Orange → Red
  - `GetLeaderBadgeSymbol()`: Returns "[*]"
  - `FormatTacticDescription()`: Tree-style tactic display
  - `FormatRoleAssignment()`: Role action with prefix
  - `FormatSynergyText()`: Active/Triggered format

### UI Components

- **MonsterGroupView**
  - `RenderGroup()`: Complete group display
  - `ShowMemberHealth()`: Update individual health bar
  - `HighlightLeader()`: Highlight leader member
  - `ShowMoraleEffect()`: Display synergy notification
  - `Clear()`: Remove display

- **TacticIndicator**
  - `RenderTactic()`: Display tactic with role assignments
  - `ShowTacticDetails()`: Show tactic description
  - `HighlightActiveTactic()`: Highlight when executing
  - `Clear()`: Remove indicator

- **LeaderBadge**
  - `RenderBadge()`: Display leader badge
  - `ShowLeaderBonus()`: Display leader bonuses
  - `ShowLeaderDefeated()`: Effect box on death
  - `Clear()`: Remove badge

### Configuration Files

- `config/monster-group-display.json`
  - Complete with 8 tactic descriptions and role actions
- `config/schemas/monster-group-display.schema.json`

### Tests

- `MonsterGroupRendererTests` (~18 tests)
  - Header formatting and centering
  - Member card with leader badge
  - Health color thresholds (10 cases)
  - Tactic and synergy formatting

- `MonsterGroupViewTests` (~8 tests)
  - Render group with header and hint
  - Clear state reset
  - Constructor validation

- `TacticIndicatorTests` (~8 tests)
  - Render tactic with role assignments
  - Highlight with color change
  - Clear state

- `LeaderBadgeTests` (~12 tests)
  - Render badge for living leader
  - Leader defeated effect box
  - Leader bonus display
  - Constructor validation

---

## Visual Examples

### Monster Group Display Layout

```
                        GOBLIN WARBAND

   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
   │ [*] LEADER  │  │   Goblin    │  │   Goblin    │
   │   Goblin    │  │   Archer    │  │   Shaman    │
   │   Chief     │  │             │  │             │
   │ HP: 45/45   │  │ HP: 20/20   │  │ HP: 25/25   │
   └─────────────┘  └─────────────┘  └─────────────┘

   TACTIC: Flanking Assault
   |-- Archers: Attack from range
   |-- Chief: Engage in melee
   +-- Shaman: Provide support

   Kill the Chief to break morale!
```

### Leader Defeated Effect Box

```
+===================================================+
|  [!]  LEADER DEFEATED                             |
+===================================================+
|                                                   |
|  Goblin Chief has fallen!                         |
|                                                   |
|  Group morale broken:                             |
|  |-- -25% attack for all remaining goblins        |
|  +-- 50% chance to flee on each turn              |
|                                                   |
+===================================================+
```

### Member Health Color Thresholds

| Health % | Color |
|----------|-------|
| >75% | Green |
| 51-75% | Yellow |
| 26-50% | DarkYellow (Orange) |
| 1-25% | Red |
| 0% | DarkRed |

---

## Dependencies

### Required (from v0.10.4c)

- `IMonsterGroupService`: Get group instances
- `MonsterGroupDefinition`: Group templates
- `GroupMember`: Member definition with role
- `GroupTactic`: Tactic enum values
- `GroupSynergy`: Synergy effect definitions

### Required (from v0.13.1a)

- `ITerminalService`: WriteAt, WriteColoredAt methods
- `HealthColorThreshold`: Shared color threshold pattern

### Provides (for Future Versions)

- `MonsterGroupView`: Reusable group display component
- `MonsterGroupDisplayConfig`: Shared configuration patterns
- `MonsterGroupRenderer`: Reusable rendering utilities

---

## Test Results

```
Project total tests: 263
New tests added: ~46
     Passed: 263
Total time: 141ms
```
