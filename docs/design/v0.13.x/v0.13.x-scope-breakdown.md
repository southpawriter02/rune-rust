# v0.13.x UI Consolidation Pass - Scope Breakdown

**Version Series:** 0.13.x
**Theme:** UI Consolidation Pass
**Prerequisites:** v0.12.1c Complete (Achievements & Leaderboards)
**Total Estimated Tests:** ~150 new tests

---

## Executive Summary

The UI Consolidation Pass batches all deferred TUI/GUI implementation work from v0.10.x through v0.12.x into a cohesive version series. By consolidating UI work, we ensure consistent styling across features, reduce context-switching, and enable holistic design decisions with full knowledge of all features requiring display.

This version series focuses exclusively on presentation layer components - no new domain logic, services, or business rules are introduced. All underlying functionality already exists from prior versions.

Additionally, this series addresses **UI standardization** to resolve disparities that accumulated during incremental development from v0.1.x through v0.9.x, including naming conventions, theming, service integration patterns, and error handling consistency.

The work is divided into **six minor versions**:

| Version | Name | Focus | Est. Tests |
|---------|------|-------|------------|
| v0.13.0 | Combat UI | Status effects, AoE zones, combo display, defense/stance indicators | ~25 |
| v0.13.1 | Boss & Monster UI | Boss health bar, phase indicators, monster group display | ~20 |
| v0.13.2 | Ability Tree UI | Tree visualization, node display, prerequisite lines | ~20 |
| v0.13.3 | Crafting UI | Resource panel, crafting station, recipe browser, gathering display | ~25 |
| v0.13.4 | Achievements & Statistics UI | Achievement panel, statistics dashboard, leaderboards, dice history | ~30 |
| v0.13.5 | UI Standardization | Naming alignment, theme consolidation, service patterns, accessibility | ~30 |

---

## Existing Infrastructure

### From v0.10.x (Advanced Combat & Abilities)

| Feature | Location | Notes |
|---------|----------|-------|
| StatusEffectDefinition | `Domain/Entities/StatusEffectDefinition.cs` | Effect templates |
| IBuffDebuffService | `Application/Interfaces/IBuffDebuffService.cs` | Buff/debuff management |
| IAoEService | `Application/Interfaces/IAoEService.cs` | AoE zone logic |
| IComboService | `Application/Interfaces/IComboService.cs` | Combo chain tracking |
| IDefenseActionService | `Application/Interfaces/IDefenseActionService.cs` | Defense actions |
| ICombatStanceService | `Application/Interfaces/ICombatStanceService.cs` | Stance management |
| AbilityTreeDefinition | `Domain/Entities/AbilityTreeDefinition.cs` | Ability trees |
| IAbilityTreeService | `Application/Interfaces/IAbilityTreeService.cs` | Tree progression |
| BossDefinition | `Domain/Entities/BossDefinition.cs` | Boss templates |
| IBossEncounterService | `Application/Interfaces/IBossEncounterService.cs` | Boss encounters |
| MonsterGroupDefinition | `Domain/Entities/MonsterGroupDefinition.cs` | Group templates |

### From v0.11.x (Crafting & Resources)

| Feature | Location | Notes |
|---------|----------|-------|
| ResourceDefinition | `Domain/Entities/ResourceDefinition.cs` | Resource templates |
| IResourceService | `Application/Interfaces/IResourceService.cs` | Resource management |
| RecipeDefinition | `Domain/Entities/RecipeDefinition.cs` | Recipe templates |
| ICraftingService | `Application/Interfaces/ICraftingService.cs` | Crafting logic |
| IGatheringService | `Application/Interfaces/IGatheringService.cs` | Gathering mechanics |

### From v0.12.x (Statistics & Achievements)

| Feature | Location | Notes |
|---------|----------|-------|
| PlayerStatistics | `Domain/Entities/PlayerStatistics.cs` | Stats tracking |
| IStatisticsService | `Application/Interfaces/IStatisticsService.cs` | Stats queries |
| DiceRollHistory | `Domain/Entities/DiceRollHistory.cs` | Roll tracking |
| IDiceHistoryService | `Application/Interfaces/IDiceHistoryService.cs` | Dice history |
| AchievementDefinition | `Domain/Entities/AchievementDefinition.cs` | Achievement templates |
| IAchievementService | `Application/Interfaces/IAchievementService.cs` | Achievement tracking |
| ILeaderboardService | `Application/Interfaces/ILeaderboardService.cs` | Leaderboards |

### From v0.1.x-v0.9.x (Existing UI - Requires Standardization)

| Component | Location | Disparity Issue |
|-----------|----------|-----------------|
| HealthBar | `Presentation.Tui/UI/HealthBar.cs` | Uses `HealthBarConfig` thresholds |
| ResourceBar | `Presentation.Tui/UI/ResourceBar.cs` | Uses static dictionary for colors |
| CombatGridView | `Presentation.Tui/Views/CombatGridView.cs` | Method-based color logic |
| SpectreGameRenderer | `Presentation.Tui/Rendering/SpectreGameRenderer.cs` | Inline color strings |
| Colors.axaml | `Presentation.Gui/Themes/Colors.axaml` | Centralized but underutilized |
| HealthBarControl | `Presentation.Gui/Controls/HealthBarControl.cs` | Hardcoded `Brushes.*` values |
| GridCellControl | `Presentation.Gui/Controls/GridCellControl.cs` | Hardcoded terrain colors |
| GridRenderer | `Presentation.Shared/Adapters/GridRenderer.cs` | Shared but not leveraged |

---

## UI Disparity Analysis

### Identified Issues from v0.1.x-v0.9.x Incremental Development

| Category | TUI Pattern | GUI Pattern | Issue |
|----------|-------------|-------------|-------|
| **Naming** | `-Panel`, `-View`, `-Bar`, `-Renderer` | `-Panel`, `-Bar`, `-Control`, `-Overlay` | Inconsistent suffixes |
| **Theming** | 5+ color definition locations | Centralized theme + hardcoded overrides | Fragmented color management |
| **Service Integration** | Constructor injection (required) | Optional properties on ViewModels | Different DI patterns |
| **Error Handling** | Logging + null checks | Silent binding handlers | Inconsistent observability |
| **Shared Code** | Minimal utilization | Minimal utilization | Duplication across layers |

### Color Definition Fragmentation (TUI)

```
Location                           Pattern
─────────────────────────────────────────────────────────
HealthBarConfig.cs                 Configuration-based thresholds
ResourceBar.cs                     Static Dictionary<string, ConsoleColor>
CombatGridView.cs                  Method-based switch expression
SpectreGameRenderer.cs             Inline string colors ("yellow", "red")
ColoredText.cs                     Factory methods
```

### Theme Underutilization (GUI)

```
Colors.axaml defines:              Controls use:
─────────────────────────────────────────────────────────
HealthColor (#228B22)              Brushes.ForestGreen (hardcoded)
HealthLowColor (#FF4500)           Brushes.OrangeRed (hardcoded)
ManaColor (#4169E1)                Brushes.RoyalBlue (hardcoded)
EntityColors                       Brushes.LimeGreen (different green!)
```

---

## Version Definitions

---

# v0.13.0: Combat UI

[v0.13.0 Design Specification](v0.13.0-design-specification.md)

## Overview

Implement all combat-related UI components including status effect display, AoE zone highlighting, combo chain indicators, defense action prompts, and combat stance indicators. These components visualize the combat state introduced in v0.10.x.

## Sub-Parts

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.0a | Status Effect Display | Buff/debuff icons, timers, stacks, tooltips, immunity | ~8 |
| v0.13.0b | AoE Zone Overlay | Zone grid overlay, hazard indicators, duration display | ~6 |
| v0.13.0c | Combo System Display | Chain indicator, available prompt, bonus display | ~5 |
| v0.13.0d | Defense Action Display | Block/dodge/parry prompts, timing window, feedback | ~6 |

## Scope

**In Scope:**
- Status effect display:
  - Buff/debuff icons
  - Duration timers (countdown)
  - Stack count display
  - Effect tooltips (hover/select details)
  - Immunity indicators
- AoE zone highlighting:
  - Zone grid overlay for affected tiles
  - Hazard indicators for persistent zones
  - Zone duration display
- Combo system display:
  - Combo chain indicator (position in sequence)
  - Combo available prompt
  - Combo bonus display (accumulated multiplier)
- Defense action display:
  - Block/dodge/parry prompts
  - Reaction window timing indicator
  - Defense result feedback (success/failure)
- Combat stance display:
  - Active stance indicator
  - Stance modifier summary
  - Stance switch animation/feedback

**Out of Scope:**
- Boss encounter UI (v0.13.1)
- Monster group UI (v0.13.1)
- Ability tree UI (v0.13.2)

## Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 5 | StatusEffectDisplay, AoEOverlay, ComboIndicator, DefensePrompts, StanceIndicator |
| Renderers | 5 | Effect renderer, zone renderer, combo renderer, defense renderer, stance renderer |
| View Updates | 1 | CombatView integration |
| Unit Tests | ~25 | Display, rendering, update tests |

## Combat UI Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                      COMBAT UI ARCHITECTURE                          │
└─────────────────────────────────────────────────────────────────────┘

     Services                            UI Components
     ────────                            ─────────────

     IBuffDebuffService ──────────────▶ ┌──────────────────────────┐
         │                              │  StatusEffectDisplay     │
         │ GetActiveEffects()           ├──────────────────────────┤
         │                              │  + RenderBuffs()         │
         │                              │  + RenderDebuffs()       │
         │                              │  + ShowTooltip()         │
         │                              │  + UpdateDurations()     │
         └────────────────────────────▶ └──────────────────────────┘

     IAoEService ─────────────────────▶ ┌──────────────────────────┐
         │                              │  AoEZoneOverlay          │
         │ GetActiveZones()             ├──────────────────────────┤
         │                              │  + RenderZones()         │
         │                              │  + HighlightTiles()      │
         │                              │  + ShowHazardIcons()     │
         └────────────────────────────▶ └──────────────────────────┘

     IComboService ───────────────────▶ ┌──────────────────────────┐
         │                              │  ComboChainIndicator     │
         │ GetCurrentCombo()            ├──────────────────────────┤
         │                              │  + RenderChain()         │
         │                              │  + ShowAvailablePrompt() │
         │                              │  + DisplayBonus()        │
         └────────────────────────────▶ └──────────────────────────┘

     IDefenseActionService ───────────▶ ┌──────────────────────────┐
         │                              │  DefenseActionPrompts    │
         │ GetAvailableActions()        ├──────────────────────────┤
         │                              │  + ShowPrompts()         │
         │                              │  + RenderTimingWindow()  │
         │                              │  + ShowResult()          │
         └────────────────────────────▶ └──────────────────────────┘

     ICombatStanceService ────────────▶ ┌──────────────────────────┐
         │                              │  StanceIndicator         │
         │ GetActiveStance()            ├──────────────────────────┤
         │                              │  + RenderStance()        │
         │                              │  + ShowModifiers()       │
         │                              │  + AnimateSwitch()       │
         └────────────────────────────▶ └──────────────────────────┘


    COMBAT VIEW LAYOUT
    ──────────────────

    ┌─────────────────────────────────────────────────────────────────┐
    │ [Aggressive Stance]           COMBAT                            │
    ├─────────────────────────────────────────────────────────────────┤
    │                                                                  │
    │  BUFFS: [D3] [+2] [5t]    DEBUFFS: [F2t] [I3t]                  │
    │                                                                  │
    │  ┌─────────────────────────────────────────────────────────────┐│
    │  │                      COMBAT AREA                            ││
    │  │     +===+===+===+                                           ││
    │  │     | F |   |   |  <- AoE Zone (Fire, 2 turns)              ││
    │  │     +===+===+===+                                           ││
    │  │     | F | @ |   |                                           ││
    │  │     +===+===+===+                                           ││
    │  │     |   |   | G |                                           ││
    │  │     +===+===+===+                                           ││
    │  └─────────────────────────────────────────────────────────────┘│
    │                                                                  │
    │  COMBO: [Strike] -> [Slash] -> [?]    +25% damage bonus         │
    │                                                                  │
    │  DEFENSE OPTIONS: [B]lock  [D]odge  [P]arry                     │
    │  ────────────────────────────────────────────────────────────── │
    │  Reaction Window: [========..] 0.8s remaining                   │
    │                                                                  │
    └─────────────────────────────────────────────────────────────────┘
```

## Acceptance Criteria

- [ ] Status effect icons display correctly for all effect types
- [ ] Duration timers count down each turn
- [ ] Stack counts show for stacking effects
- [ ] Effect tooltips show on hover/select
- [ ] Immunity indicators show when applicable
- [ ] AoE zones highlight affected tiles
- [ ] Hazard indicators show for persistent zones
- [ ] Zone duration displays remaining turns
- [ ] Combo chain shows current position
- [ ] Combo available prompt appears when combo can continue
- [ ] Combo bonus displays accumulated multiplier
- [ ] Defense action prompts show available actions
- [ ] Reaction window timing indicator works
- [ ] Defense result feedback shows success/failure
- [ ] Active stance indicator displays current stance
- [ ] Stance modifier summary shows stat changes
- [ ] Stance switch animation provides feedback
- [ ] ~25 unit tests pass

---

# v0.13.1: Boss & Monster UI

[v0.13.1 Design Specification](v0.13.1-design-specification.md)

## Overview

Implement boss encounter UI components including prominent health bars with phase markers, phase transition effects, enrage timers, and vulnerability windows. Also implement monster group display showing composition, tactics, and leader designation.

## Sub-Parts

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.1a | Boss Health Bar | Health bar with phase markers, damage animation | ~6 |
| v0.13.1b | Boss Status Display | Phase info, enrage timer, vulnerability window | ~6 |
| v0.13.1c | Monster Group Display | Composition view, tactic indicators, leader badge | ~8 |

## Scope

**In Scope:**
- Boss encounter display:
  - Boss health bar with phase markers
  - Phase transition visual effects
  - Enrage timer countdown display
  - Vulnerability window indicator
- Monster group display:
  - Group composition view
  - Tactic indicators for coordinated behaviors
  - Leader designation highlighting

**Out of Scope:**
- Combat status effects (v0.13.0)
- Ability tree UI (v0.13.2)

## Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 4 | BossHealthBar, PhaseIndicator, EnrageTimer, VulnerabilityWindow |
| UI Components | 3 | MonsterGroupView, TacticIndicator, LeaderBadge |
| View Updates | 1 | CombatView integration |
| Unit Tests | ~20 | Boss display, group display tests |

## Boss Encounter UI Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                   BOSS ENCOUNTER UI ARCHITECTURE                     │
└─────────────────────────────────────────────────────────────────────┘

     IBossEncounterService                    UI Components
     ─────────────────────                    ─────────────

     GetBossState() ────────────────────────▶ ┌──────────────────────┐
         │                                    │  BossHealthBar       │
         │ BossEncounterState                 ├──────────────────────┤
         │ |-- CurrentHP                      │  + RenderBar()       │
         │ |-- MaxHP                          │  + ShowPhaseMarkers()│
         │ |-- CurrentPhase                   │  + AnimateDamage()   │
         │ |-- PhaseThresholds                └──────────────────────┘
         │ |-- IsEnraged                             │
         │ |-- EnrageTimer                           │
         │ +-- IsVulnerable                          v
         │                                    ┌──────────────────────┐
         +──────────────────────────────────▶ │  PhaseIndicator      │
                                              ├──────────────────────┤
                                              │  + ShowCurrentPhase()│
                                              │  + TransitionEffect()│
                                              └──────────────────────┘


    BOSS HEALTH BAR DISPLAY
    ───────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                    <<  SKELETON KING  >>                            │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │   HP: 2,847 / 5,000                                                  │
    │   +============================================================+    │
    │   |############################................................|    │
    │   +============================================================+    │
    │                    |                |                |               │
    │                 Phase 2          Phase 3          Phase 4            │
    │                  (75%)            (50%)            (25%)             │
    │                                                                      │
    │   Phase: 2 - EMPOWERED   [!] Enrage in: 5 turns                     │
    │                                                                      │
    │   [!] VULNERABILITY WINDOW OPEN (2 turns) - Deal +50% damage!       │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘


    MONSTER GROUP DISPLAY
    ─────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                      GOBLIN WARBAND                                  │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │   ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                 │
    │   │ [*] LEADER  │  │   Goblin    │  │   Goblin    │                 │
    │   │   Goblin    │  │   Archer    │  │   Shaman    │                 │
    │   │   Chief     │  │             │  │             │                 │
    │   │ HP: 45/45   │  │ HP: 20/20   │  │ HP: 25/25   │                 │
    │   └─────────────┘  └─────────────┘  └─────────────┘                 │
    │                                                                      │
    │   TACTIC: Flanking Assault                                           │
    │   |-- Archers attack from range                                      │
    │   |-- Chief engages in melee                                         │
    │   +-- Shaman provides support                                        │
    │                                                                      │
    │   Kill the Chief to break morale!                                    │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘
```

## Acceptance Criteria

- [ ] Boss health bar displays with correct percentage
- [ ] Phase markers show at correct positions
- [ ] Phase transitions trigger visual effects
- [ ] Enrage timer counts down correctly
- [ ] Vulnerability window indicator shows when active
- [ ] Monster group composition displays all members
- [ ] Tactic indicators show coordinated behaviors
- [ ] Leader designation highlights group leader
- [ ] Group morale effects are communicated
- [ ] ~20 unit tests pass

---

# v0.13.2: Ability Tree UI

[v0.13.2 Design Specification](v0.13.2-design-specification.md)

## Overview

Implement the ability tree visualization system including hierarchical node display, unlock progress indicators, talent point tracking, prerequisite connection lines, and node tooltips.

## Sub-Parts

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.2a | Tree Visualization | Hierarchical layout, tier columns, visual structure | ~6 |
| v0.13.2b | Node Display & States | Locked/available/unlocked states, node rendering | ~6 |
| v0.13.2c | Prerequisite Lines | Connection lines, satisfied/unsatisfied states | ~4 |
| v0.13.2d | Tooltips & Interaction | Node tooltips, unlock action, talent point display | ~4 |

## Scope

**In Scope:**
- Tree visualization:
  - Hierarchical node display
  - Visual tree structure rendering
- Unlock progress:
  - Locked/unlocked/available node states
  - Progress toward unlocking
- Talent point counter:
  - Available points display
  - Spent points tracking
- Prerequisite lines:
  - Visual connections between dependent nodes
  - Line state (satisfied/unsatisfied)
- Node tooltips:
  - Ability details on hover/select
  - Requirements display

**Out of Scope:**
- Combat UI (v0.13.0)
- Boss encounter UI (v0.13.1)

## Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 3 | AbilityTreeView, TreeNodeRenderer, PrerequisiteLines |
| UI Components | 2 | TalentPointDisplay, NodeTooltip |
| View Updates | 1 | CharacterView integration |
| Commands | 1 | `AbilityTreeCommand` |
| Unit Tests | ~20 | Tree rendering, node display tests |

## Ability Tree UI Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                   ABILITY TREE UI ARCHITECTURE                       │
└─────────────────────────────────────────────────────────────────────┘

     IAbilityTreeService                      UI Components
     ───────────────────                      ─────────────

     GetTreeDefinition() ────────────────▶ ┌────────────────────────┐
         │                                 │  AbilityTreeView       │
         │ AbilityTreeDefinition           ├────────────────────────┤
         │ |-- RootNodes                   │  + RenderTree()        │
         │ |-- AllNodes                    │  + RenderConnections() │
         │ +-- Tiers                       │  + HandleSelection()   │
         │                                 └────────────────────────┘
         │                                           │
     GetPlayerProgress() ────────────────▶          │
         │                                           v
         │ PlayerAbilityProgress           ┌────────────────────────┐
         │ |-- UnlockedNodes               │  TreeNodeRenderer      │
         │ |-- AvailablePoints             ├────────────────────────┤
         │ +-- SpentPoints                 │  + RenderNode()        │
         │                                 │  + GetNodeState()      │
         │                                 │  + ShowTooltip()       │
         │                                 └────────────────────────┘


    ABILITY TREE DISPLAY
    ────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                      WARRIOR ABILITY TREE                           │
    ├─────────────────────────────────────────────────────────────────────┤
    │  Talent Points: 3 Available | 12 Spent                              │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │  TIER 1                    TIER 2                    TIER 3         │
    │  ──────                    ──────                    ──────         │
    │                                                                      │
    │  ┌─────────┐              ┌─────────┐              ┌─────────┐      │
    │  │ [x]Power│--------------│ [x]Cleave│--------------│ ( )Whirl│      │
    │  │  Strike │              │         │              │   wind  │      │
    │  └─────────┘              └─────────┘              └─────────┘      │
    │       │                        │                        │           │
    │       │                        │                        │           │
    │  ┌─────────┐              ┌─────────┐              ┌─────────┐      │
    │  │ [x]Iron │--------------│ ( )Shield│--------------│ [L]Last │      │
    │  │   Skin  │              │   Bash  │              │   Stand │      │
    │  └─────────┘              └─────────┘              └─────────┘      │
    │       │                                                             │
    │       │                                                             │
    │  ┌─────────┐              ┌─────────┐                               │
    │  │ [x]Battle│--------------│ ( )War  │                               │
    │  │   Cry   │              │   Cry   │                               │
    │  └─────────┘              └─────────┘                               │
    │                                                                      │
    │  Legend: [x] Unlocked   ( ) Available   [L] Locked                  │
    │                                                                      │
    │  [Select a node to view details or unlock]                          │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘

    NODE TOOLTIP (on selection)
    ───────────────────────────

    ┌─────────────────────────────────────────────┐
    │             WHIRLWIND                        │
    ├─────────────────────────────────────────────┤
    │ Tier 3 | Cost: 2 points                     │
    ├─────────────────────────────────────────────┤
    │ Spin in a deadly arc, dealing 150% weapon   │
    │ damage to all adjacent enemies.             │
    ├─────────────────────────────────────────────┤
    │ Cooldown: 4 turns                           │
    │ Resource: 25 Rage                           │
    ├─────────────────────────────────────────────┤
    │ Prerequisites:                              │
    │ [x] Cleave (Tier 2)                         │
    │ [x] 8 points spent in tree                  │
    ├─────────────────────────────────────────────┤
    │ Status: AVAILABLE - Press [U] to unlock     │
    └─────────────────────────────────────────────┘
```

## Acceptance Criteria

- [ ] Tree visualization displays hierarchical structure
- [ ] Unlocked nodes show check mark indicator
- [ ] Available nodes show circle indicator
- [ ] Locked nodes show lock indicator
- [ ] Talent point counter shows available/spent
- [ ] Prerequisite lines connect dependent nodes
- [ ] Line colors indicate satisfied/unsatisfied
- [ ] Node tooltips show on selection
- [ ] Ability details display in tooltip
- [ ] Requirements display in tooltip
- [ ] Unlock action works for available nodes
- [ ] ~20 unit tests pass

---

# v0.13.3: Crafting UI

[v0.13.3 Design Specification](v0.13.3-design-specification.md)

## Overview

Implement all crafting-related UI components including resource inventory panel, crafting station interface, recipe browser with search/filter, recipe discovery tracking, and gathering display for harvestable resources.

## Sub-Parts

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.3a | Resource Inventory Panel | Resource display, stacks, type icons, filtering | ~6 |
| v0.13.3b | Crafting Station Interface | Station menu, recipe list, material availability | ~8 |
| v0.13.3c | Recipe Browser & Details | Search, filter, recipe details, quality display | ~6 |
| v0.13.3d | Gathering Display | Harvestable indicators, dice check, yield display | ~5 |

## Scope

**In Scope:**
- Resource management display:
  - Resource inventory panel
  - Resource stack display with quantities
  - Resource type icons (ore, herb, leather, gem)
- Crafting interface:
  - Crafting station menu (station-specific recipes)
  - Recipe browser with search/filter
  - Recipe details view (materials, output)
  - Material availability highlighting
  - Crafting progress feedback
  - Quality result display
- Recipe discovery:
  - Recipe book panel
  - New recipe notification
  - Recipe unlock progress (discovered/total)
- Resource gathering:
  - Harvestable indicators in rooms
  - Gathering dice check display
  - Yield display

**Out of Scope:**
- Combat UI (v0.13.0)
- Boss encounter UI (v0.13.1)
- Ability tree UI (v0.13.2)

## Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 6 | ResourcePanel, CraftingStationMenu, RecipeBrowser, RecipeDetails, RecipeBook, GatheringDisplay |
| Notifications | 2 | RecipeDiscoveryNotification, CraftingResultNotification |
| View Updates | 2 | InventoryView, RoomView integration |
| Commands | 2 | `CraftCommand`, `RecipesCommand` |
| Unit Tests | ~25 | Crafting display, recipe browser tests |

## Crafting UI Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                     CRAFTING UI ARCHITECTURE                         │
└─────────────────────────────────────────────────────────────────────┘

     Services                               UI Components
     ────────                               ─────────────

     IResourceService ──────────────────▶ ┌────────────────────────────┐
         │                                │  ResourceInventoryPanel    │
         │ GetResources()                 ├────────────────────────────┤
         │                                │  + RenderResources()       │
         │                                │  + ShowResourceDetails()   │
         │                                │  + FilterByType()          │
         +──────────────────────────────▶ └────────────────────────────┘

     ICraftingService ──────────────────▶ ┌────────────────────────────┐
         │                                │  CraftingStationMenu       │
         │ GetRecipesForStation()         ├────────────────────────────┤
         │                                │  + RenderRecipeList()      │
         │                                │  + ShowRecipeDetails()     │
         │                                │  + HighlightCraftable()    │
         │                                │  + ShowCraftingProgress()  │
         +──────────────────────────────▶ └────────────────────────────┘

     IGatheringService ─────────────────▶ ┌────────────────────────────┐
         │                                │  GatheringDisplay          │
         │ GetHarvestables()              ├────────────────────────────┤
         │                                │  + ShowHarvestableNodes()  │
         │                                │  + RenderDiceCheck()       │
         │                                │  + ShowYield()             │
         +──────────────────────────────▶ └────────────────────────────┘


    RESOURCE INVENTORY PANEL
    ────────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                       RESOURCES                                      │
    ├─────────────────────────────────────────────────────────────────────┤
    │  Filter: [All] [Ore] [Herb] [Leather] [Gem] [Misc]                  │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │  ORE                     HERBS                   LEATHER            │
    │  ───                     ─────                   ───────            │
    │  [O] Iron Ore      x24   [H] Healing Herb   x15  [L] Leather     x8 │
    │  [O] Silver Ore    x12   [H] Mana Bloom     x7   [L] Thick Hide  x5 │
    │  [O] Gold Ore      x3    [H] Fire Blossom   x4   [L] Dragon Scale x1│
    │                          [H] Frost Lily     x2                       │
    │                                                                      │
    │  GEMS                    MISC                                        │
    │  ────                    ────                                        │
    │  [G] Ruby           x5   [M] Enchanting Dust x12                     │
    │  [G] Sapphire       x3   [M] Magic Essence   x8                      │
    │  [G] Emerald        x2                                               │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘


    CRAFTING STATION MENU
    ─────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                    BLACKSMITH FORGE                                  │
    ├─────────────────────────────────────────────────────────────────────┤
    │  Search: [____________]    Filter: [All] [Weapons] [Armor]          │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │  AVAILABLE RECIPES                           YOUR MATERIALS          │
    │  ─────────────────                           ──────────────          │
    │                                                                      │
    │  [x] Iron Sword          [2 Iron Ore]        Iron Ore: 24 [x]       │
    │  [x] Iron Shield         [3 Iron Ore]        Silver Ore: 12 [x]     │
    │  [x] Steel Blade         [2 Iron, 1 Coal]    Coal: 8 [x]            │
    │  [ ] Silver Ring         [2 Silver, 1 Gem]   Ruby: 5                │
    │  [ ] Mithril Armor       [5 Mithril Ore]     Mithril Ore: 0 [ ]     │
    │                                                                      │
    │  ────────────────────────────────────────────────────────────────── │
    │  Selected: Steel Blade                                               │
    │                                                                      │
    │  ┌─────────────────────────────────────────────────────────────────┐│
    │  │ STEEL BLADE                                      Quality: ***   ││
    │  │ A finely crafted blade of hardened steel                        ││
    │  │                                                                  ││
    │  │ Required Materials:           You Have:                         ││
    │  │ |-- Iron Ore x2               24 [x]                            ││
    │  │ +-- Coal x1                   8 [x]                             ││
    │  │                                                                  ││
    │  │ Output: Steel Blade (Common-Rare based on skill)                ││
    │  │                                                                  ││
    │  │ [C]raft                                                          ││
    │  └─────────────────────────────────────────────────────────────────┘│
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘


    GATHERING DISPLAY
    ─────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │  FOREST CLEARING                                                     │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │  Harvestable Resources:                                              │
    │  ┌─────────────────────────────────────────────────────────────────┐│
    │  │  [H] Healing Herbs (x3)     DC 10  [G]ather                     ││
    │  │  [M] Cave Mushrooms (x2)    DC 12  [G]ather                     ││
    │  └─────────────────────────────────────────────────────────────────┘│
    │                                                                      │
    │  ════════════════════════════════════════════════════════════════   │
    │                                                                      │
    │  GATHERING: Healing Herbs                                            │
    │  ─────────────────────────                                           │
    │  Skill Check: Herbalism (DC 10)                                      │
    │                                                                      │
    │  Rolling: 1d20 + 3 (Herbalism)                                       │
    │  Result: [14] + 3 = 17  [x] SUCCESS!                                │
    │                                                                      │
    │  Yield: [H] Healing Herb x2                                         │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘
```

## Acceptance Criteria

- [ ] Resource inventory panel displays all resources
- [ ] Resource stacks show correct quantities
- [ ] Resource type icons display correctly
- [ ] Filter tabs filter by resource type
- [ ] Crafting station menu shows station recipes
- [ ] Recipe browser supports search
- [ ] Recipe browser supports filtering
- [ ] Recipe details show materials and output
- [ ] Material availability highlights owned vs needed
- [ ] Crafting progress shows during creation
- [ ] Quality result displays after crafting
- [ ] Recipe book shows collected recipes
- [ ] New recipe notification displays on discovery
- [ ] Recipe unlock progress shows discovered/total
- [ ] Harvestable indicators show in rooms
- [ ] Gathering dice check displays roll
- [ ] Yield display shows gathered resources
- [ ] ~25 unit tests pass

---

# v0.13.4: Achievements & Statistics UI

[v0.13.4 Design Specification](v0.13.4-design-specification.md)

## Overview

Implement achievements and statistics UI including achievement panel with categories, progress bars, and notifications. Also implement statistics dashboard with category tabs, leaderboard view, dice history panel, and playtime display.

## Sub-Parts

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.4a | Achievement Panel | Achievement browser, categories, progress bars, notifications | ~8 |
| v0.13.4b | Statistics Dashboard | Stats overview, category tabs, comparison view, charts | ~8 |
| v0.13.4c | Leaderboard View | Ranked entries, score breakdown, personal best highlighting | ~6 |
| v0.13.4d | Dice History Panel | Roll history, streak indicators, roll distribution | ~8 |

## Scope

**In Scope:**
- Achievement system UI:
  - Achievement panel (full browser)
  - Achievement categories (organized by type)
  - Progress bars for incremental achievements
  - Achievement notifications on unlock
  - Rarity indicators (tier badges)
- Statistics display:
  - Statistics dashboard (comprehensive overview)
  - Category tabs (Combat, Exploration, Crafting, etc.)
  - Stat comparison (session vs all-time)
  - Graphical displays (charts for trends)
- Leaderboards:
  - Leaderboard view (local high scores)
  - Score breakdown (component display)
  - Personal best highlighting
- Dice history:
  - Roll history panel (recent log)
  - Streak indicators
  - Roll statistics (averages, distribution)
- Playtime display:
  - Session timer
  - Total playtime

**Out of Scope:**
- Combat UI (v0.13.0)
- Boss encounter UI (v0.13.1)
- Ability tree UI (v0.13.2)
- Crafting UI (v0.13.3)

## Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 6 | AchievementPanel, AchievementCategoryView, ProgressBar, AchievementNotification, RarityBadge, AchievementCard |
| UI Components | 4 | StatisticsDashboard, CategoryTabs, StatComparison, SimpleChart |
| UI Components | 3 | LeaderboardView, ScoreBreakdown, PersonalBestHighlight |
| UI Components | 3 | DiceHistoryPanel, StreakIndicator, RollDistribution |
| UI Components | 2 | SessionTimer, PlaytimeDisplay |
| Commands | 3 | `AchievementsCommand`, `LeaderboardCommand`, `DiceHistoryCommand` |
| Unit Tests | ~30 | Achievement display, statistics, leaderboard tests |

## Achievement UI Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                   ACHIEVEMENT UI ARCHITECTURE                        │
└─────────────────────────────────────────────────────────────────────┘

     IAchievementService                     UI Components
     ───────────────────                     ─────────────

     GetAllAchievements() ──────────────▶ ┌────────────────────────────┐
         │                                │  AchievementPanel          │
         │ AchievementDefinition[]        ├────────────────────────────┤
         │                                │  + RenderCategories()      │
         │                                │  + FilterByCategory()      │
         │                                │  + ShowAchievementCard()   │
         +──────────────────────────────▶ └────────────────────────────┘

     GetProgress(player) ───────────────▶ ┌────────────────────────────┐
         │                                │  AchievementCard           │
         │ AchievementProgress[]          ├────────────────────────────┤
         │                                │  + RenderProgress()        │
         │                                │  + ShowTierBadge()         │
         │                                │  + AnimateUnlock()         │
         +──────────────────────────────▶ └────────────────────────────┘


    ACHIEVEMENT PANEL
    ─────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                        ACHIEVEMENTS                                  │
    ├─────────────────────────────────────────────────────────────────────┤
    │  Total Points: 485 | Unlocked: 23/75 (31%)                          │
    ├─────────────────────────────────────────────────────────────────────┤
    │  [All] [Combat] [Exploration] [Progression] [Collection] [Challenge]│
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │  COMBAT ACHIEVEMENTS                                                 │
    │  ───────────────────                                                │
    │                                                                      │
    │  ┌─────────────────────────────────────────────────────────────────┐│
    │  │ [x] FIRST BLOOD                                   Bronze (10)   ││
    │  │   Defeat your first monster                                     ││
    │  │   [########################################] 100%               ││
    │  └─────────────────────────────────────────────────────────────────┘│
    │                                                                      │
    │  ┌─────────────────────────────────────────────────────────────────┐│
    │  │ [~] MONSTER SLAYER                                Silver (25)   ││
    │  │   Defeat 100 monsters                                           ││
    │  │   [####################....................] 47/100 (47%)       ││
    │  └─────────────────────────────────────────────────────────────────┘│
    │                                                                      │
    │  ┌─────────────────────────────────────────────────────────────────┐│
    │  │ ( ) BOSS HUNTER                                     Gold (50)   ││
    │  │   Defeat 10 different bosses                                    ││
    │  │   [########................................] 2/10 (20%)         ││
    │  └─────────────────────────────────────────────────────────────────┘│
    │                                                                      │
    │  ┌─────────────────────────────────────────────────────────────────┐│
    │  │ [L] ??? (Secret Achievement)                       Platinum     ││
    │  │   ???                                                           ││
    │  │   [........................................] Locked             ││
    │  └─────────────────────────────────────────────────────────────────┘│
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘


    ACHIEVEMENT NOTIFICATION (Pop-up)
    ─────────────────────────────────

    +=====================================================+
    |  [!]  ACHIEVEMENT UNLOCKED!                         |
    +=====================================================+
    |                                                     |
    |  MONSTER SLAYER                                     |
    |  Defeat 100 monsters                                |
    |                                                     |
    |  Silver   |   +25 Points                            |
    +=====================================================+


    LEADERBOARD VIEW
    ────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                        LEADERBOARDS                                  │
    ├─────────────────────────────────────────────────────────────────────┤
    │ [High Score] [Speedrun] [No Death] [Achievement Points] [Boss Slayer]│
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │   HIGH SCORE LEADERBOARD                                            │
    │   ─────────────────────                                             │
    │                                                                      │
    │   Rank    Name           Class      Level    Score      Date        │
    │   ════════════════════════════════════════════════════════════════  │
    │   #1      Thorin        Warrior      15     125,430    2026-01-05   │
    │   #2      Elara         Mage         12      98,750    2026-01-03   │
    │   #3      Shadow        Rogue        14      87,320    2026-01-08   │
    │    4      Grok          Warrior      10      65,100    2026-01-01   │
    │   >5      Hero (You)    Paladin       8      52,340    2026-01-10   │
    │    6      Luna          Healer        9      48,200    2026-01-02   │
    │    7      Drake         Ranger        7      35,600    2025-12-28   │
    │                                                                      │
    │   ────────────────────────────────────────────────────────────────── │
    │   Your Best: 52,340 (Rank #5)                                       │
    │                                                                      │
    │   SCORE BREAKDOWN:                                                   │
    │   |-- Monsters Killed: 127 x 10 = 1,270                             │
    │   |-- Bosses Killed: 3 x 500 = 1,500                                │
    │   |-- Rooms Discovered: 42 x 25 = 1,050                             │
    │   |-- Gold Earned: 15,340                                            │
    │   |-- Level Multiplier: x1.8                                         │
    │   |-- Achievement Bonus: 4,850                                       │
    │   +-- Death Penalty: -300                                            │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘


    DICE HISTORY PANEL
    ──────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │                        DICE HISTORY                                  │
    ├─────────────────────────────────────────────────────────────────────┤
    │                                                                      │
    │   RECENT ROLLS (d20)                                                 │
    │   ──────────────────                                                │
    │   18, 14, 12, 3, 20!, 8, 15, 11, 19, 7, 16, 4, 9, 13, 20!, 6        │
    │                                                                      │
    │   ────────────────────────────────────────────────────────────────── │
    │                                                                      │
    │   STATISTICS                  LUCK RATING                            │
    │   ──────────                  ───────────                            │
    │   Total d20 Rolls: 523        LUCKY (+6.7%)                          │
    │   Natural 20s: 47 (9.0%)                                            │
    │   Natural 1s: 31 (5.9%)       Current Streak: +3                    │
    │   Average Roll: 11.2          (3 above-average in a row)            │
    │   Expected: 10.5                                                     │
    │                               Longest Lucky: +7                      │
    │                               Longest Unlucky: -5                    │
    │                                                                      │
    │   ────────────────────────────────────────────────────────────────── │
    │                                                                      │
    │   ROLL DISTRIBUTION                                                  │
    │   ─────────────────                                                  │
    │                                                                      │
    │   1  [####................]  31 (5.9%)                              │
    │   2  [####................]  28 (5.4%)                              │
    │   3  [#####...............]  30 (5.7%)                              │
    │   ...                                                                │
    │   19 [######..............]  35 (6.7%)                              │
    │   20 [#########...........]  47 (9.0%) <- Above expected!           │
    │                                                                      │
    └─────────────────────────────────────────────────────────────────────┘
```

## Acceptance Criteria

- [ ] Achievement panel displays all achievements
- [ ] Achievement categories filter correctly
- [ ] Progress bars show correct percentages
- [ ] Achievement notifications pop up on unlock
- [ ] Rarity indicators show correct tier badges
- [ ] Secret achievements hidden until unlocked
- [ ] Statistics dashboard displays all categories
- [ ] Category tabs switch views correctly
- [ ] Stat comparison shows session vs all-time
- [ ] Graphical displays render trends
- [ ] Leaderboard view shows ranked entries
- [ ] Score breakdown shows components
- [ ] Personal best highlighting works
- [ ] Dice history panel shows recent rolls
- [ ] Streak indicators display correctly
- [ ] Roll statistics show averages
- [ ] Session timer tracks current session
- [ ] Total playtime displays correctly
- [ ] ~30 unit tests pass

---

# v0.13.5: UI Standardization

[v0.13.5 Design Specification](v0.13.5-design-specification.md)

## Overview

Address UI disparities that accumulated during incremental development from v0.1.x through v0.9.x. This includes standardizing naming conventions, consolidating theming systems, unifying service integration patterns, establishing consistent error handling, and improving shared layer utilization. Also addresses cross-cutting concerns including accessibility and performance optimization.

## Sub-Parts

| Part | Name | Focus | Est. Tests |
|------|------|-------|------------|
| v0.13.5a | Naming Convention Alignment | Standardize component suffixes across TUI/GUI | ~4 |
| v0.13.5b | Theme Consolidation | Create shared IThemeService, unify color definitions | ~8 |
| v0.13.5c | Service Integration Patterns | Standardize DI patterns across presentation layers | ~6 |
| v0.13.5d | Error Handling & Logging | Consistent logging strategy for UI components | ~4 |
| v0.13.5e | Shared Layer Utilization | Refactor to leverage Presentation.Shared | ~4 |
| v0.13.5f | Accessibility & Performance | Color blind modes, keyboard nav, lazy loading | ~4 |

## Scope

**In Scope:**
- Naming convention alignment:
  - Audit all TUI/GUI component names
  - Establish `-Panel` for containers, `-Control`/`-View` for components
  - Rename inconsistent components
  - Update references throughout codebase
- Theme consolidation:
  - Create `IThemeService` in Presentation.Shared
  - Implement TUI adapter (ConsoleColor mapping)
  - Implement GUI adapter (Avalonia Brush mapping)
  - Migrate all hardcoded colors to theme service
  - Remove duplicate color definitions
- Service integration patterns:
  - Define standard DI registration pattern
  - Standardize required vs optional dependencies
  - Create base classes for presentation components
  - Update existing components to use patterns
- Error handling & logging:
  - Define logging strategy for UI components
  - Add consistent null checking patterns
  - Implement fallback rendering for errors
  - Add diagnostic logging for UI state
- Shared layer utilization:
  - Identify duplicated logic between TUI/GUI
  - Extract to Presentation.Shared
  - Refactor existing components to use shared code
  - Document shared component guidelines
- Cross-cutting concerns:
  - Color palette review/unification
  - Icon style unification
  - Font/typography consistency
  - Animation timing standardization
  - Color blind mode alternatives
  - Screen reader support
  - Keyboard navigation
  - Lazy loading for performance
  - Animation optimization

**Out of Scope:**
- New feature UI (covered in v0.13.0-v0.13.4)
- Domain/Application layer changes

## Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| Interfaces | 1 | IThemeService |
| Services | 2 | TuiThemeAdapter, GuiThemeAdapter |
| Base Classes | 2 | TuiComponentBase, GuiControlBase |
| Refactored Components | ~15 | Existing TUI/GUI components updated |
| Configuration | 2 | ThemeConfiguration, AccessibilitySettings |
| Accessibility | 3 | ColorBlindMode, ScreenReaderLabels, KeyboardNav |
| Performance | 2 | LazyLoader, AnimationOptimizer |
| Unit Tests | ~30 | Theme service, adapter, component tests |

## UI Standardization Architecture

```
┌─────────────────────────────────────────────────────────────────────┐
│                  UI STANDARDIZATION ARCHITECTURE                      │
└─────────────────────────────────────────────────────────────────────┘

    BEFORE (Current State - Disparities)
    ─────────────────────────────────────

    TUI Layer                              GUI Layer
    ─────────                              ─────────

    HealthBarConfig.cs                     Colors.axaml
    |-- Threshold configs                  |-- Centralized colors
    +-- ConsoleColor mapping               +-- (Often ignored)

    ResourceBar.cs                         HealthBarControl.cs
    |-- Static Dictionary                  |-- Hardcoded Brushes.*
    +-- Custom colors                      +-- Ignores theme

    CombatGridView.cs                      GridCellControl.cs
    |-- Method-based colors                |-- Hardcoded terrain
    +-- Switch expressions                 +-- Direct brush refs

    SpectreGameRenderer.cs                 EntityTokenControl.cs
    |-- Inline strings                     |-- Different greens
    +-- "yellow", "red"                    +-- Brushes.LimeGreen


    AFTER (Standardized - v0.13.5)
    ──────────────────────────────

                      Presentation.Shared
                      ───────────────────
                              │
                    ┌─────────┴─────────┐
                    │   IThemeService   │
                    ├───────────────────┤
                    │ GetColor(key)     │
                    │ GetIcon(key)      │
                    │ GetAnimation(key) │
                    └─────────┬─────────┘
                              │
            ┌─────────────────┼─────────────────┐
            │                 │                 │
            v                 v                 v
    ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
    │ThemeDefinition│ │TuiThemeAdapter│ │GuiThemeAdapter│
    ├───────────────┤ ├───────────────┤ ├───────────────┤
    │ Colors        │ │ ToConsole()   │ │ ToBrush()     │
    │ Icons         │ │ GetTuiIcon()  │ │ GetGuiIcon()  │
    │ Animations    │ │               │ │               │
    └───────────────┘ └───────────────┘ └───────────────┘


    NAMING CONVENTION STANDARD
    ──────────────────────────

    Suffix          Usage                       Examples
    ──────────────────────────────────────────────────────────────────
    -Panel          Container/layout            InventoryPanel, CombatPanel
    -View           Full-screen view            CombatView, CharacterView
    -Control        Interactive element         HealthBarControl, SlotControl
    -Renderer       Output generation           GridRenderer, TextRenderer
    -Display        Read-only output            StatusDisplay, ScoreDisplay
    -Indicator      Status visualization        ComboIndicator, StanceIndicator


    SERVICE INTEGRATION STANDARD
    ────────────────────────────

    // Standard pattern for all presentation components
    public class ComponentBase
    {
        // Required dependencies - constructor injection
        protected readonly IThemeService Theme;
        protected readonly ILogger Logger;

        // Optional dependencies - property injection
        public IAccessibilityService? Accessibility { get; set; }

        protected ComponentBase(IThemeService theme, ILogger logger)
        {
            Theme = theme ?? throw new ArgumentNullException(nameof(theme));
            Logger = logger ?? throw new ArgumentNullException(nameof(logger));
        }
    }


    ERROR HANDLING STANDARD
    ───────────────────────

    // Consistent pattern for all UI operations
    protected void SafeRender(Action renderAction, string componentName)
    {
        try
        {
            renderAction();
        }
        catch (Exception ex)
        {
            Logger.LogWarning(ex, "Render failed for {Component}", componentName);
            RenderFallback(componentName);
        }
    }


    THEME SERVICE INTERFACE
    ───────────────────────

    public interface IThemeService
    {
        // Color access
        ThemeColor GetColor(ColorKey key);
        ThemeColor GetHealthColor(double percentage);
        ThemeColor GetResourceColor(ResourceType type);

        // Icon access
        string GetIcon(IconKey key);
        string GetStatusIcon(StatusEffectCategory category);

        // Animation timing
        TimeSpan GetAnimationDuration(AnimationKey key);

        // Accessibility
        bool IsColorBlindModeEnabled { get; }
        ColorBlindMode ColorBlindMode { get; set; }
    }


    THEME COLOR DEFINITIONS
    ───────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │  ColorPalette (Centralized)                                        │
    │  ─────────────────────────                                         │
    │  Primary:    #4A90D9 (Blue)      Secondary: #2ECC71 (Green)        │
    │  Accent:     #E74C3C (Red)       Warning:   #F39C12 (Orange)       │
    │  Background: #1A1A2E             Surface:   #16213E                 │
    │  Text:       #EAEAEA             Muted:     #7F8C8D                 │
    │                                                                      │
    │  Health Thresholds:                                                 │
    │  |-- 100-76%: HealthFull (#228B22)                                  │
    │  |-- 75-51%:  HealthGood (#32CD32)                                  │
    │  |-- 50-26%:  HealthLow (#FFD700)                                   │
    │  +-- 25-0%:   HealthCritical (#DC143C)                              │
    │                                                                      │
    │  Resource Colors:                                                   │
    │  |-- Mana:    #4169E1            |-- Rage:   #DC143C                │
    │  |-- Energy:  #FFD700            |-- Focus:  #00CED1                │
    │  +-- Stamina: #32CD32                                               │
    │                                                                      │
    │  Status Effect Colors:                                              │
    │  |-- Buff:    #32CD32            |-- Debuff: #DC143C                │
    │  |-- Fire:    #FF4500            |-- Ice:    #00BFFF                │
    │  |-- Poison:  #9400D3            |-- Lightning: #FFD700             │
    └─────────────────────────────────────────────────────────────────────┘


    ACCESSIBILITY FEATURES
    ──────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │  Color Blind Modes                                                  │
    │  ─────────────────                                                  │
    │  Protanopia:   Red -> Blue shift                                    │
    │  Deuteranopia: Green -> Yellow shift                                │
    │  Tritanopia:   Blue -> Cyan shift                                   │
    │                                                                      │
    │  Alternative Indicators:                                            │
    │  |-- Shapes in addition to colors (square, circle, triangle, diamond)│
    │  |-- Patterns for status effects                                    │
    │  +-- Text labels alongside icons                                    │
    │                                                                      │
    │  Screen Reader Support                                              │
    │  ─────────────────────                                              │
    │  |-- Alt text for all icons                                         │
    │  |-- Descriptive labels for interactive elements                    │
    │  +-- Logical focus order                                            │
    │                                                                      │
    │  Keyboard Navigation                                                │
    │  ───────────────────                                                │
    │  |-- Tab: Move between panels                                       │
    │  |-- Arrow keys: Navigate within panels                             │
    │  |-- Enter: Select/activate                                         │
    │  +-- Escape: Back/close                                             │
    └─────────────────────────────────────────────────────────────────────┘


    PERFORMANCE OPTIMIZATION
    ────────────────────────

    ┌─────────────────────────────────────────────────────────────────────┐
    │  Lazy Loading                                                       │
    │  ────────────                                                       │
    │  |-- Achievement list: Load visible + buffer                        │
    │  |-- Leaderboard: Load top 20, fetch more on scroll                │
    │  +-- Statistics charts: Render on tab activation                   │
    │                                                                      │
    │  Animation Optimization                                             │
    │  ──────────────────────                                             │
    │  |-- Disable animations on low-power mode                          │
    │  |-- Reduce animation complexity for large lists                   │
    │  +-- Skip frames during heavy load                                 │
    └─────────────────────────────────────────────────────────────────────┘
```

## Components Requiring Refactoring

| Component | Layer | Current Issue | Refactoring Required |
|-----------|-------|---------------|---------------------|
| HealthBar | TUI | Uses HealthBarConfig | Migrate to IThemeService |
| ResourceBar | TUI | Static color dictionary | Migrate to IThemeService |
| CombatGridView | TUI | Method-based colors | Migrate to IThemeService |
| SpectreGameRenderer | TUI | Inline string colors | Migrate to IThemeService |
| ColoredText | TUI | Factory-based colors | Migrate to IThemeService |
| HealthBarControl | GUI | Hardcoded Brushes.* | Use theme bindings |
| GridCellControl | GUI | Hardcoded terrain colors | Use theme bindings |
| EntityTokenControl | GUI | Different green values | Use theme bindings |
| DamagePopupControl | GUI | Hardcoded popup colors | Use theme bindings |
| MessageTypeToColorConverter | GUI | Hardcoded brush mapping | Use IThemeService |

## Acceptance Criteria

- [ ] All TUI components follow naming convention
- [ ] All GUI components follow naming convention
- [ ] IThemeService interface defined in Presentation.Shared
- [ ] TuiThemeAdapter implements IThemeService for console
- [ ] GuiThemeAdapter implements IThemeService for Avalonia
- [ ] All hardcoded colors migrated to theme service
- [ ] HealthBarConfig consolidated into theme service
- [ ] ResourceBar uses theme service
- [ ] CombatGridView uses theme service
- [ ] SpectreGameRenderer uses theme service
- [ ] HealthBarControl uses theme bindings
- [ ] GridCellControl uses theme bindings
- [ ] EntityTokenControl uses consistent colors
- [ ] Service injection patterns standardized
- [ ] Error handling patterns consistent
- [ ] Shared layer properly utilized
- [ ] Color blind modes implemented
- [ ] Screen reader labels added
- [ ] Keyboard navigation functional
- [ ] Lazy loading improves performance
- [ ] Animation optimization applied
- [ ] ~30 unit tests pass

---

## Dependencies & Prerequisites

```
v0.12.1c (Leaderboards) - REQUIRED
    │
    +── All domain services complete ──────────────────────────────────────┐
                                                                           │
v0.13.x (UI Consolidation Pass)                                            │
    │                                                                      │
    |── v0.13.0: Combat UI ────────────────────────────────────────────────┤
    │       Dependencies: v0.10.x services                                 │
    │       Provides: Status effect, AoE, combo, defense, stance display   │
    │       Sub-parts: a (status), b (AoE), c (combo), d (defense)         │
    │                                                                      │
    |── v0.13.1: Boss & Monster UI ────────────────────────────────────────┤
    │       Dependencies: v0.10.4x services                                │
    │       Provides: Boss health bar, phase indicators, group display     │
    │       Sub-parts: a (health bar), b (status), c (groups)              │
    │                                                                      │
    |── v0.13.2: Ability Tree UI ──────────────────────────────────────────┤
    │       Dependencies: v0.10.x ability services                         │
    │       Provides: Tree visualization, node display, tooltips           │
    │       Sub-parts: a (tree), b (nodes), c (lines), d (tooltips)        │
    │                                                                      │
    |── v0.13.3: Crafting UI ──────────────────────────────────────────────┤
    │       Dependencies: v0.11.x crafting services                        │
    │       Provides: Resource panel, crafting interface, gathering        │
    │       Sub-parts: a (resources), b (station), c (recipes), d (gather) │
    │                                                                      │
    |── v0.13.4: Achievements & Statistics UI ─────────────────────────────┤
    │       Dependencies: v0.12.x services                                 │
    │       Provides: Achievement panel, statistics, leaderboards          │
    │       Sub-parts: a (achievements), b (stats), c (leaderboard), d (dice)│
    │                                                                      │
    +── v0.13.5: UI Standardization ───────────────────────────────────────┘
            Dependencies: v0.13.0-v0.13.4 complete (for pattern application)
            Provides: Theme service, naming standards, accessibility
            Sub-parts: a (naming), b (theme), c (DI), d (errors), e (shared), f (a11y)
```

---

## Estimated Effort Summary

| Version | New Files | Modified Files | Est. Tests | Complexity |
|---------|-----------|----------------|------------|------------|
| v0.13.0 | ~8 | ~3 | ~25 | Medium-High |
| v0.13.1 | ~6 | ~2 | ~20 | Medium |
| v0.13.2 | ~5 | ~2 | ~20 | Medium-High |
| v0.13.3 | ~8 | ~3 | ~25 | Medium-High |
| v0.13.4 | ~15 | ~5 | ~30 | High |
| v0.13.5 | ~10 | ~15 | ~30 | High |
| **Total** | **~52** | **~30** | **~150** | |

---

## Risk Assessment

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Inconsistent styling across versions | Medium | Medium | Establish style guide in v0.13.0 |
| Performance with many UI components | Medium | Low | Lazy loading, optimization in v0.13.5 |
| Accessibility compliance gaps | Medium | Medium | Early accessibility review |
| Complex tree rendering | Medium | Low | Use proven ASCII rendering patterns |
| Animation performance | Low | Medium | Disable option, reduce complexity |
| Refactoring breaks existing UI | Medium | Medium | Comprehensive test coverage |
| Theme migration complexity | Medium | Medium | Incremental migration with adapter layer |

---

## Design Decisions (Confirmed)

### General UI

| Decision | Value | Notes |
|----------|-------|-------|
| **Framework** | Spectre.Console (TUI), Avalonia (GUI) | Existing frameworks |
| **Icon Set** | ASCII fallback + Unicode optional | Cross-platform support |
| **Notification Duration** | 5 seconds | Visible but not intrusive |
| **Animation** | Optional | Disable for performance |

### Naming Convention

| Decision | Value | Notes |
|----------|-------|-------|
| **Containers** | `-Panel` suffix | InventoryPanel, CombatPanel |
| **Full Views** | `-View` suffix | CombatView, CharacterView |
| **Interactive** | `-Control` suffix | HealthBarControl, SlotControl |
| **Output** | `-Renderer`/`-Display` suffix | GridRenderer, StatusDisplay |
| **Status** | `-Indicator` suffix | ComboIndicator, StanceIndicator |

### Theming

| Decision | Value | Notes |
|----------|-------|-------|
| **Central Service** | IThemeService | In Presentation.Shared |
| **TUI Adapter** | TuiThemeAdapter | Maps to ConsoleColor |
| **GUI Adapter** | GuiThemeAdapter | Maps to Avalonia Brush |
| **Color Source** | Single JSON/XAML | No hardcoded colors |

### Accessibility

| Decision | Value | Notes |
|----------|-------|-------|
| **Color Blind Support** | 3 modes | Protanopia, Deuteranopia, Tritanopia |
| **Keyboard Navigation** | Full support | Tab, arrows, enter, escape |
| **Screen Reader** | Alt text | For all icons |
| **Shape Indicators** | Required | Alongside colors |

---

## Next Steps

1. **Review & Approve** - Confirm v0.13.x scope breakdown
2. **v0.13.0 Design Spec** - Create detailed design for Combat UI
3. **v0.13.0a-d Implementation** - Build combat display components
4. **v0.13.1 Design Spec** - Create specification for Boss & Monster UI
5. **v0.13.1a-c Implementation** - Build boss/monster display
6. **v0.13.2 Design Spec** - Create specification for Ability Tree UI
7. **v0.13.2a-d Implementation** - Build tree visualization
8. **v0.13.3 Design Spec** - Create specification for Crafting UI
9. **v0.13.3a-d Implementation** - Build crafting interface
10. **v0.13.4 Design Spec** - Create specification for Achievements & Statistics UI
11. **v0.13.4a-d Implementation** - Build achievements, statistics
12. **v0.13.5 Design Spec** - Create specification for UI Standardization
13. **v0.13.5a-f Implementation** - Apply standards, theme consolidation, accessibility

---

*This scope breakdown provides a structured approach to implementing the v0.13.x UI Consolidation Pass. By organizing work into minor versions with sub-parts, we maintain clear milestones while enabling granular progress tracking. The addition of v0.13.5 (UI Standardization) addresses accumulated disparities from incremental v0.1.x-v0.9.x development.*
