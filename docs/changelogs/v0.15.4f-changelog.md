# v0.15.4f Changelog - Glitch Exploitation System

**Release Date:** 2026-01-24
**Version:** v0.15.4f
**Phase:** System Bypass Skill Expansion (v0.15.x)
**Sub-Phase:** Glitch Exploitation System (v0.15.4f)

---

## Summary

Implemented the **Glitch Exploitation System**, enabling characters to observe, predict, and exploit the corrupted behavior of [Glitched] Old World technology. Characters can study glitched mechanisms (WITS DC 14) to identify their cycle patterns and time actions to coincide with the Permissive phase for a -4 DC bonus, or proceed blind and roll on the Chaos table for unpredictable results.

This version builds upon v0.15.4e (Jury-Rigging System) and provides the underlying mechanics for the `BypassMethod.GlitchExploitation` method. When a character selects Glitch Exploitation on a [Glitched] mechanism, this service determines the DC modifier based on pattern observation or chaos roll outcomes.

---

## Added

### Domain Enums (2 files)

| File | Description |
|------|-------------|
| `GlitchCyclePhase.cs` | Four cycle phases: Stable, Unstable, Permissive, Lockdown |
| `ChaosEffect.cs` | Three chaos effects: Against (+4 DC), Neutral (+0 DC), Helps (-2 DC) |

### Domain Value Objects (3 files)

| File | Description |
|------|-------------|
| `GlitchState.cs` | Record struct capturing glitch cycle state with phase, chaos roll, and computed DC modifier |
| `ChaosResult.cs` | Record struct for chaos roll outcome with d6 mapping to effect and narrative |
| `GlitchObservationResult.cs` | Record struct for pattern observation attempt with success state and narrative |

### Domain Interfaces (1 file)

| File | Description |
|------|-------------|
| `IGlitchExploitationService.cs` | Service contract for glitch observation, chaos rolls, and phase management |

### Application Services (1 file)

| File | Description |
|------|-------------|
| `GlitchExploitationService.cs` | Full implementation with exhaustive logging and dice integration |

### Configuration Files (2 files)

| File | Description |
|------|-------------|
| `config/system-bypass/glitch-cycles.json` | Glitch cycle configuration with phases, chaos table, and narrative text |
| `config/schemas/glitch-cycles.schema.json` | JSON Schema for validating glitch cycle configuration |

### Unit Tests (1 file)

| File | Description |
|------|-------------|
| `GlitchExploitationServiceTests.cs` | 40+ tests covering observation, chaos rolls, phases, and state transitions |

---

## Glitch Cycle Phases

| Phase | DC Modifier | Description |
|-------|-------------|-------------|
| Stable | +0 | Normal [Glitched] behavior, corruption simmering beneath the surface |
| Unstable | +0 | Erratic behavior intensifies—lights flicker, strange sounds emerge |
| Permissive | -4 | **EXPLOIT WINDOW!** Defenses momentarily lapse, strike now! |
| Lockdown | +2 | System compensates for corruption, becomes more resistant |

### Phase Cycle Order

```
Stable → Unstable → Permissive → Lockdown → (repeat)
```

### Phase Duration

Each phase lasts **1d4+1 rounds** (2-5 rounds), except Permissive which lasts **1d4 rounds** (1-4 rounds) to create urgency.

---

## Pattern Observation

### Mechanics

- **Check Type:** WITS check vs. DC 14
- **Time Required:** 1 round
- **Success:** Pattern identified, can time actions to exploit the Permissive phase
- **Failure:** Pattern unknown, must roll on Chaos table or retry observation

### Benefits of Identification

| Benefit | Description |
|---------|-------------|
| Timing Knowledge | Know current phase and when exploit window opens |
| -4 DC Bonus | Guaranteed bonus when acting in Permissive phase |
| Risk Elimination | No need for unpredictable Chaos roll |

---

## Chaos Table (d6)

When a character proceeds without observing the pattern, they must roll on the Chaos table:

| Roll | Effect | DC Modifier | Probability | Description |
|------|--------|-------------|-------------|-------------|
| 1-2 | Against | +4 | 33% | The glitch actively resists your interference |
| 3-4 | Neutral | +0 | 33% | No particular effect, normal [Glitched] resistance |
| 5-6 | Helps | -2 | 33% | Fortune favors the bold! Glitch aids your attempt |

### Risk/Reward Analysis

| Approach | Average Modifier | Best Case | Worst Case |
|----------|-----------------|-----------|------------|
| Pattern Observation | -4 (guaranteed) | -4 | -4 |
| Chaos Roll | +0.67 (average) | -2 | +4 |

Observation is statistically superior (-4 guaranteed vs. +0.67 average), but costs 1 round and a WITS DC 14 check.

---

## DC Modifier Calculation

### Pattern Identified

| Condition | DC Modifier |
|-----------|-------------|
| In Exploit Window (Permissive) | -4 |
| Outside Exploit Window | +0 |

### Pattern Not Identified

| Chaos Roll | Effect | DC Modifier |
|------------|--------|-------------|
| 1-2 | Against | +4 |
| 3-4 | Neutral | +0 |
| 5-6 | Helps | -2 |

---

## GlitchState Value Object

### Properties

| Property | Type | Description |
|----------|------|-------------|
| GlitchCycleIdentified | bool | Whether pattern has been observed |
| CyclePhase | GlitchCyclePhase | Current phase in the cycle |
| ExploitWindow | GlitchCyclePhase | The phase that grants the DC bonus |
| ChaosRoll | int? | d6 chaos roll result (null if pattern identified) |
| PhaseDuration | int | Duration of current phase in rounds |
| RoundsInCurrentPhase | int | Rounds elapsed in current phase |

### Computed Properties

| Property | Description |
|----------|-------------|
| IsInExploitWindow | True if identified AND in Permissive phase |
| DcModifier | The DC modifier based on current state |
| StateDescription | Narrative text for current phase |
| RoundsUntilPhaseChange | Countdown to phase transition |

### Factory Methods

| Method | Description |
|--------|-------------|
| CreateUnobserved() | Initial state before observation attempt |
| CreateObserved() | State after successful pattern observation |
| CreateWithChaos() | State with d6 chaos roll result |

### Instance Methods

| Method | Description |
|--------|-------------|
| AdvancePhase() | Transition to next phase in cycle |
| AdvanceRound() | Increment round counter, auto-advance if duration exceeded |
| ToDisplayString() | Formatted output for UI |
| ToLogString() | Compact output for logging |

---

## ChaosResult Value Object

### Properties

| Property | Type | Description |
|----------|------|-------------|
| Roll | int | The d6 roll result (1-6) |
| Effect | ChaosEffect | The resulting effect category |
| DcModifier | int | The DC modifier applied |
| NarrativeText | string | Flavor text describing the outcome |

### Computed Properties

| Property | Description |
|----------|-------------|
| EffectSummary | Short description like "Glitch works against you (+4 DC)" |

### Factory Methods

| Method | Description |
|--------|-------------|
| FromRoll(int) | Creates result from d6 roll (1-6) with automatic effect mapping |

---

## GlitchObservationResult Value Object

### Properties

| Property | Type | Description |
|----------|------|-------------|
| Success | bool | Whether observation succeeded (net > 0) |
| NetSuccesses | int | Net successes from WITS check |
| GlitchState | GlitchState | The resulting glitch state |
| NarrativeText | string | Descriptive text for the attempt |

### Computed Properties

| Property | Description |
|----------|-------------|
| WasAttempted | True if observation was attempted (not skipped) |
| CanTimeActions | True if pattern identified, can wait for window |
| RequiresChaosRoll | True if pattern not identified |
| InExploitWindow | Current exploit window status (null if not identified) |

### Factory Methods

| Method | Description |
|--------|-------------|
| Succeeded() | Creates successful observation result with narrative |
| Failed() | Creates failed observation result |
| Skipped() | Creates result for skipped observation |

---

## IGlitchExploitationService Interface

### Methods

| Method | Description |
|--------|-------------|
| ObserveGlitchPattern(int, string) | Attempt WITS DC 14 pattern observation |
| GetCurrentCyclePhase(GlitchState) | Get current phase from state |
| IsInExploitWindow(GlitchState) | Check if in Permissive with identified pattern |
| CalculateGlitchModifier(GlitchState) | Get DC modifier for current state |
| RollChaos() | Roll d6 on Chaos table |
| AdvanceRound(GlitchState) | Advance state by one round |
| InitializeGlitchState(string) | Create initial unobserved state |

---

## Files Created

| Category | Files |
|----------|-------|
| Domain Enums | 2 |
| Domain Value Objects | 3 |
| Domain Interfaces | 1 |
| Application Services | 1 |
| Configuration | 2 |
| Unit Tests | 1 |
| Documentation | 1 |
| **Total** | **11** |

---

## Key Design Decisions

### 1. Immutable State Transitions

`GlitchState` uses the `readonly record struct` pattern with `this with { }` syntax for immutable state transitions. `AdvancePhase()` and `AdvanceRound()` return new instances rather than mutating.

### 2. Exploit Window = Permissive Phase

The exploit window is always the Permissive phase (-4 DC). This is hardcoded in the `DefaultExploitWindow` constant for consistency, though the `ExploitWindow` property allows future flexibility.

### 3. Chaos Roll Probability Distribution

The d6 chaos table is evenly distributed (33% each):
- 1-2: Against (+4 DC) - worst case
- 3-4: Neutral (+0 DC) - average case
- 5-6: Helps (-2 DC) - best case

This makes the average chaos modifier +0.67, significantly worse than the -4 guaranteed by pattern observation.

### 4. Shorter Permissive Duration

The Permissive phase uses 1d4 rounds (1-4) instead of 1d4+1 (2-5) to create urgency. Characters must act quickly when the window opens.

### 5. Service Placement in Application Layer

Following the pattern established in v0.15.4e, `GlitchExploitationService` is placed in `RuneAndRust.Application/Services/` rather than `Domain/Services/`.

### 6. Phase Tracking Per-Mechanism

Each glitched mechanism maintains its own cycle state. Different terminals, locks, or devices cycle independently.

---

## Integration with Jury-Rigging System

This service integrates with the Jury-Rigging System (v0.15.4e) as follows:

1. When `BypassMethod.GlitchExploitation` is selected on a [Glitched] mechanism
2. The `GlitchExploitationService` determines the DC modifier
3. The modifier is applied to the experiment roll's DC

### Integration Flow

```
JuryRiggingService.SelectMethod(state, GlitchExploitation)
    └── Validate: state.IsGlitched == true
        └── Initialize glitch state via GlitchExploitationService

JuryRiggingService.PerformExperiment(state, context, score)
    └── If method == GlitchExploitation:
        └── Get modifier from GlitchExploitationService.CalculateGlitchModifier()
        └── Apply modifier to effective DC
```

---

## Dependencies

| Dependency | Usage |
|------------|-------|
| IDiceService | Dice rolling for WITS checks (d10), chaos rolls (d6), phase determination (d4) |
| ILogger&lt;T&gt; | Exhaustive logging at Information/Debug/Warning levels |
| DicePool | D10, D6, D4 pool creation for various roll types |

---

## Breaking Changes

None. This version adds new functionality without modifying existing interfaces or contracts.

---

## Acceptance Criteria Status

| Criterion | Status |
|-----------|--------|
| Pattern observation uses WITS DC 14 | ✅ |
| Successful observation identifies glitch cycle | ✅ |
| Exploit window (Permissive phase) provides -4 DC bonus | ✅ |
| Chaos table correctly maps d6 rolls to modifiers | ✅ |
| d6 1-2 results in +4 DC (against) | ✅ |
| d6 3-4 results in +0 DC (neutral) | ✅ |
| d6 5-6 results in -2 DC (helps) | ✅ |
| Phase advancement cycles correctly | ✅ |
| Build succeeds with 0 errors/warnings | ✅ |
| All tests pass | ✅ |
| Configuration files validate against schemas | ✅ |
| XML documentation complete for all public types | ✅ |
| Exhaustive logging at appropriate levels | ✅ |

---

## Next Steps

- **v0.15.4g:** Integration of Glitch Exploitation with Jury-Rigging experiment flow
- **v0.15.5:** Salvage & Component Identification System
- **v0.15.6:** System Bypass Skill Tree Integration
