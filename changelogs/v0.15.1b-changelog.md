# v0.15.1b Changelog - Outcome Classification

**Version:** 0.15.1b  
**Release Date:** 2026-01-23  
**Theme:** Outcome Classification  

---

## Overview

This release introduces enhanced outcome classification with detailed metadata and a robust system for tracking and managing fumble consequences from catastrophic skill check failures.

---

## Added

### Domain Layer

#### Enums
- **`DescriptorCategory`** - Categorizes skill check outcomes for voice guidance descriptor lookup (Catastrophic, Failed, Marginal, Competent, Impressive, Masterful)
- **`FumbleType`** - Categorizes fumble consequences by skill and effect:
  - `TrustShattered` - Persuasion fumble, blocks checks with target
  - `LieExposed` - Deception fumble, -2d10 penalty
  - `ChallengeAccepted` - Intimidation fumble, initiates combat
  - `MechanismJammed` - Lockpicking fumble, +2 DC
  - `SystemLockout` - Hacking fumble, disables terminal
  - `ForcedExecution` - Trap disarmament fumble, triggers trap
  - `TheSlip` - Climbing fumble, causes fall
  - `TheLongFall` - Leaping fumble, extra damage + disoriented
  - `SystemWideAlert` - Stealth fumble, alerts all nearby enemies

#### Value Objects
- **`OutcomeDetails`** - Enhanced outcome metadata including:
  - `OutcomeType` - SkillOutcome tier
  - `Margin` - Success/failure margin
  - `IsFumble` / `IsCritical` flags
  - `DescriptorCategory` - For voice guidance
  - Factory method `FromDiceResult()`

#### Entities
- **`FumbleConsequence`** - Tracks lasting effects from fumbled skill checks:
  - Consequence lifecycle (active/inactive)
  - Expiration and recovery conditions
  - Blocking, dice penalty, and DC modifier effects
  - Methods: `IsExpired()`, `CanRecover()`, `Deactivate()`, `BlocksCheck()`, `GetDicePenalty()`, `GetDcModifier()`

#### Interfaces
- **`IFumbleConsequenceRepository`** - Persistence interface for fumble consequences

### Application Layer

#### Interfaces
- **`IFumbleConsequenceService`** - Service interface for managing fumble consequences
- **`IFumbleConsequenceConfigurationProvider`** - Configuration provider interface
- **`FumbleConsequenceConfiguration`** - Configuration record for fumble types

#### Services
- **`FumbleConsequenceService`** - Complete implementation with:
  - Consequence creation with skill-based type determination
  - Check blocking detection
  - Recovery and manual deactivation
  - Expiration processing
  - Dice/DC penalty calculation
  - Structured logging

### Infrastructure Layer

#### Repositories
- **`InMemoryFumbleConsequenceRepository`** - Thread-safe in-memory storage

#### Configuration
- **`FumbleConsequenceConfigurationProvider`** - Default configuration for all fumble types

### Configuration
- **`fumble-consequences.json`** - Configuration file for fumble consequence definitions

### Unit Tests
- **`OutcomeDetailsTests.cs`** - 6 tests covering outcome mapping and description
- **`FumbleConsequenceTests.cs`** - 15 tests covering entity lifecycle and behavior
- **`FumbleConsequenceServiceTests.cs`** - 10 tests covering service operations

---

## Technical Details

### FumbleType Extension Methods
- `BlocksAllTargets()` - Whether fumble affects all targets
- `IsInstant()` - Whether fumble has instant effect
- `GetAssociatedSkillId()` - Maps fumble type to skill
- `GetDisplayName()` - Human-readable name

### Consequence Effects by Type
| FumbleType | Blocks Check | Dice Penalty | DC Modifier |
|------------|--------------|--------------|-------------|
| TrustShattered | ✓ (specific target) | - | - |
| LieExposed | - | -2 | - |
| ChallengeAccepted | - | - | - |
| MechanismJammed | - | - | +2 |
| SystemLockout | - | - | - |
| ForcedExecution | - | - | - |
| TheSlip | - | - | - |
| TheLongFall | - | - | - |
| SystemWideAlert | ✓ (all targets) | - | - |

---

## Dependencies

- **v0.15.0** - Dice Pool Refactor (DiceRollResult, IsFumble, IsCriticalSuccess)
- **v0.15.0c** - Skill Check Refactor (SkillOutcome, SkillCheckResult)
- **v0.15.1a** - Skill Context & Modifiers (SkillContext)

---

## Migration Notes

- No breaking changes
- New components are additive
- Existing skill check systems continue to work without modification

---

## Files Changed

### New Files
- `src/Core/RuneAndRust.Domain/Enums/DescriptorCategory.cs`
- `src/Core/RuneAndRust.Domain/Enums/FumbleType.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/OutcomeDetails.cs`
- `src/Core/RuneAndRust.Domain/Entities/FumbleConsequence.cs`
- `src/Core/RuneAndRust.Domain/Interfaces/IFumbleConsequenceRepository.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IFumbleConsequenceService.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IFumbleConsequenceConfigurationProvider.cs`
- `src/Core/RuneAndRust.Application/Services/FumbleConsequenceService.cs`
- `src/Infrastructure/RuneAndRust.Infrastructure/Repositories/InMemoryFumbleConsequenceRepository.cs`
- `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/FumbleConsequenceConfigurationProvider.cs`
- `config/fumble-consequences.json`
- `tests/RuneAndRust.Domain.UnitTests/ValueObjects/OutcomeDetailsTests.cs`
- `tests/RuneAndRust.Domain.UnitTests/Entities/FumbleConsequenceTests.cs`
- `tests/RuneAndRust.Application.UnitTests/Services/FumbleConsequenceServiceTests.cs`

---

## Test Results

```
Total tests: 31
     Passed: 31
Build: 0 errors, 0 warnings
```
