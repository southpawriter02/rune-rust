# Changelog: v0.17.1a - Background Enum & Definition

**Release Date:** 2026-01-29
**Phase:** Background System (1/5)
**Status:** Complete

---

## Overview

Implements the Background enum and BackgroundDefinition entity that form the foundation of the v0.17.1 Background System. Unlike Lineage (inherited bloodline traits) or Archetype (combat role), Background represents what the character did before the Great Silence—their profession, learned skills, and accumulated possessions.

This phase establishes the core types that all subsequent v0.17.1x phases depend upon for skill grants (v0.17.1b), equipment grants (v0.17.1c), provider services (v0.17.1d), and application services (v0.17.1e).

---

## Added

### Domain Layer

#### Enums

- **`Background`** (`Enums/Background.cs`)
    - Enum defining 6 pre-Silence profession options with explicit integer values (0-5)
    - Values: VillageSmith, TravelingHealer, RuinDelver, ClanGuard, WanderingSkald, OutcastScavenger
    - Comprehensive XML documentation with skill grants, equipment, social standing, and narrative hooks per value
    - Follows the same pattern established by `Lineage` enum (v0.17.0a)

#### Entities

- **`BackgroundDefinition`** (`Entities/BackgroundDefinition.cs`)
    - Sealed class implementing `IEntity` for background data
    - Properties: Id, BackgroundId, DisplayName, Description, SelectionText, ProfessionBefore, SocialStanding, NarrativeHooks
    - Factory method `Create(...)` with validation for all required string parameters
    - Narrative hook methods:
        - `HasNarrativeHooks()`: Checks if hooks exist
        - `GetNarrativeHookCount()`: Returns hook count
        - `HasNarrativeHookContaining(string)`: Case-insensitive keyword search across hooks
    - Helper methods:
        - `GetCreationSummary()`: Formatted profession + standing string for UI
        - `ToString()`: Debug-friendly representation
    - Structured logging at Debug and Information levels during creation
    - Private constructor for EF Core materialization

### Configuration Files

- **`config/backgrounds.json`** (partial - definition section only)
    - All 6 backgrounds with complete definition data
    - Schema reference to `backgrounds.schema.json`
    - Each entry includes: backgroundId, displayName, description, selectionText, professionBefore, socialStanding, narrativeHooks
    - Replaces legacy backgrounds.json with v0.17.1a format

- **`config/schemas/backgrounds.schema.json`**
    - JSON Schema Draft 7 validation for backgrounds.json
    - Enforces exactly 6 backgrounds with enum-constrained backgroundId values
    - String length constraints on all text fields
    - narrativeHooks array with maxItems: 10
    - Replaces legacy schema with v0.17.1a format

### Unit Tests

- **`BackgroundTests`** (`Enums/BackgroundTests.cs`) — 3 tests
    - `Background_HasSixValues_CountEquals6`: Verifies enum count
    - `Background_ContainsAllExpectedValues`: Verifies all 6 values present
    - `Background_HasExplicitIntValues`: Verifies integer mappings 0-5

- **`BackgroundDefinitionTests`** (`Entities/BackgroundDefinitionTests.cs`) — 12 tests
    - `Create_WithValidParameters_CreatesDefinition`: Full creation with all properties
    - `Create_WithNullDisplayName_ThrowsArgumentException`: Validation test
    - `Create_WithEmptyDescription_ThrowsArgumentException`: Validation test
    - `Create_WithNullProfessionBefore_ThrowsArgumentException`: Validation test
    - `Create_WithWhitespaceSocialStanding_ThrowsArgumentException`: Validation test
    - `HasNarrativeHooks_WithHooks_ReturnsTrue`: Hook existence check
    - `HasNarrativeHooks_WithoutHooks_ReturnsFalse`: Empty hooks check
    - `HasNarrativeHookContaining_WithMatchingKeyword_ReturnsTrue`: Keyword search
    - `HasNarrativeHookContaining_WithNonMatchingKeyword_ReturnsFalse`: Non-match
    - `HasNarrativeHookContaining_WithNullOrWhitespaceKeyword_ReturnsFalse`: Edge cases (3 test cases)
    - `GetCreationSummary_ReturnsFormattedString`: Summary formatting
    - `ToString_ReturnsDisplayNameAndId`: Debug representation
    - `Create_WithoutNarrativeHooks_DefaultsToEmptyList`: Optional parameter default

---

## Design Decisions

### Background vs Lineage Pattern

- BackgroundDefinition follows the same sealed-class-with-factory-method pattern as LineageDefinition
- However, BackgroundDefinition is simpler because it does not compose value objects (no attribute modifiers, passive bonuses, traits, or trauma baselines)
- Instead, it uses string properties for ProfessionBefore and SocialStanding, and a `IReadOnlyList<string>` for NarrativeHooks
- Skill and equipment grants will be added in v0.17.1b and v0.17.1c respectively

### Legacy Configuration Replacement

- The existing `backgrounds.json` and `backgrounds.schema.json` contained legacy data (Soldier, Scholar, Thief, etc.) from an earlier design iteration
- These files have been replaced with the v0.17.1a format matching the current design specification
- The new format uses `backgroundId` (enum name) instead of `id` (kebab-case), and `selectionText` instead of `lore`

### Narrative Hook System

- Narrative hooks are stored as plain strings rather than structured objects
- This keeps the system simple and allows flexible matching via substring search
- Future versions may add structured hook types if more complex matching is needed

---

## Dependencies

### Prerequisites

- v0.17.0 (Lineage System) — Complete
- `IEntity` interface from Domain layer

### Provides to v0.17.1b

| Type                   | Usage                              |
| ---------------------- | ---------------------------------- |
| `Background`           | Referenced by skill grants         |
| `BackgroundDefinition` | Extended with SkillGrants property |

### Provides to v0.17.1c

| Type                   | Usage                                  |
| ---------------------- | -------------------------------------- |
| `Background`           | Referenced by equipment grants         |
| `BackgroundDefinition` | Extended with EquipmentGrants property |

### Provides to v0.17.1d-e

| Type                   | Usage                    |
| ---------------------- | ------------------------ |
| `Background`           | Key for provider lookups |
| `BackgroundDefinition` | Returned by provider     |
