# v0.13.4c Design Specification: Leaderboard View

**Version:** 0.13.4c
**Theme:** Leaderboard View
**Author:** Claude
**Created:** 2026-01-16
**Status:** Draft
**Prerequisites:** v0.13.4b Complete (Statistics Dashboard), v0.12.x Leaderboard Services Complete

---

## 1. Overview

### 1.1 Purpose

This document provides a comprehensive design specification for v0.13.4c, the Leaderboard View implementation. This part focuses on displaying ranked leaderboard entries for various categories, score breakdown showing component contributions, personal best highlighting, and player rank display.

### 1.2 Scope

**In Scope:**
- Leaderboard view with ranked entries
- Multiple leaderboard categories (High Score, Speedrun, No Death, Achievement Points, Boss Slayer)
- Score breakdown showing component contributions
- Personal best highlighting
- Player rank display
- Top 3 special highlighting
- Category tab navigation

**Out of Scope:**
- Achievement panel (v0.13.4a - completed)
- Statistics dashboard (v0.13.4b - completed)
- Dice history panel (v0.13.4d)
- New domain logic or leaderboard calculations (provided by v0.12.x services)

### 1.3 Key Deliverables

| Type | Count | Details |
|------|-------|---------|
| UI Components | 3 | `LeaderboardView`, `ScoreBreakdownPanel`, `PersonalBestHighlight` |
| Renderers | 1 | `LeaderboardEntryRenderer` |
| DTOs | 2 | `LeaderboardDisplayDto`, `ScoreComponentDto` |
| Configuration | 1 | `LeaderboardViewConfig` |
| Commands | 1 | `LeaderboardCommand` |
| Unit Tests | ~6 | Leaderboard display, ranking, breakdown, highlight tests |

---

## 2. Dependencies

### 2.1 Required Services (from v0.12.x)

| Service | Location | Purpose |
|---------|----------|---------|
| `ILeaderboardService` | `Application/Interfaces/ILeaderboardService.cs` | Retrieve leaderboard entries, rankings |
| `LeaderboardEntry` | `Domain/Entities/LeaderboardEntry.cs` | Individual leaderboard entry entity |
| `LeaderboardCategory` | `Domain/Enums/LeaderboardCategory.cs` | Leaderboard category enumeration |
| `ScoreComponents` | `Domain/ValueObjects/ScoreComponents.cs` | Score breakdown value object |

### 2.2 Required UI Infrastructure (from v0.7.x-v0.8.x)

| Component | Location | Purpose |
|-----------|----------|---------|
| `ITerminalService` | `Presentation.Tui/Services/ITerminalService.cs` | Terminal output abstraction |
| `MainMenuView` | `Presentation.Tui/Views/MainMenuView.cs` | Integration point for leaderboard command |

### 2.3 Related v0.13.4 Components

| Component | Version | Relationship |
|-----------|---------|--------------|
| `AchievementPanel` | v0.13.4a | Similar panel patterns, shared styling conventions |
| `CategoryTabs` | v0.13.4b | Reusable for leaderboard category tabs |
| `StatisticsDashboardConfig` | v0.13.4b | Similar configuration pattern |

---

## 3. Architecture Diagrams

### 3.1 Leaderboard View Layer Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          PRESENTATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    LeaderboardView (New)                             │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + RenderLeaderboard(IEnumerable<LeaderboardEntry>) : void            │    │
│  │ + SelectCategory(LeaderboardCategory) : void                         │    │
│  │ + HighlightPlayerEntry(LeaderboardEntry) : void                      │    │
│  │ + ShowPlayerRank(int rank, int total) : void                         │    │
│  │ + SetPosition(int x, int y) : void                                   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                          │                                                   │
│         ┌────────────────┼────────────────┬──────────────────┐              │
│         ▼                ▼                ▼                  ▼              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │Leaderboard  │  │ScoreBreak   │  │PersonalBest │  │CategoryTabs │        │
│  │EntryRenderer│  │downPanel    │  │Highlight    │  │(from 4b)    │        │
│  │   (New)     │  │   (New)     │  │  (New)      │  │             │        │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤  ├─────────────┤        │
│  │FormatEntry()│  │RenderBreak  │  │RenderPerson │  │RenderTabs() │        │
│  │GetRankColor │  │down()       │  │alBest()     │  │SelectTab()  │        │
│  │FormatScore()│  │FormatCompon │  │CompareToEnt │  │HighlightAct │        │
│  │FormatDate() │  │ent()        │  │ry()         │  │ive()        │        │
│  └─────────────┘  │ShowMultipli │  │ShowNewRecor │  └─────────────┘        │
│                   │ers()        │  │d()          │                          │
│                   │ShowPenaltie │  └─────────────┘                          │
│                   │s()          │                                            │
│                   └─────────────┘                                            │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    LeaderboardDisplayDto (New DTO)                   │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + Rank: int                                                          │    │
│  │ + PlayerName: string                                                 │    │
│  │ + CharacterClass: string                                             │    │
│  │ + Level: int                                                         │    │
│  │ + Score: int (or TimeSpan for Speedrun, int for Floors)              │    │
│  │ + Date: DateTime                                                     │    │
│  │ + IsCurrentPlayer: bool                                              │    │
│  │ + Category: LeaderboardCategory                                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    ScoreComponentDto (New DTO)                       │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + Name: string                                                       │    │
│  │ + Count: int                                                         │    │
│  │ + PointsEach: int                                                    │    │
│  │ + TotalPoints: int                                                   │    │
│  │ + IsMultiplier: bool                                                 │    │
│  │ + IsPenalty: bool                                                    │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    LeaderboardViewConfig (New)                       │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + PanelWidth: int (default 72)                                       │    │
│  │ + PanelHeight: int (default 35)                                      │    │
│  │ + RankColumnWidth: int (default 6)                                   │    │
│  │ + NameColumnWidth: int (default 14)                                  │    │
│  │ + ClassColumnWidth: int (default 10)                                 │    │
│  │ + LevelColumnWidth: int (default 8)                                  │    │
│  │ + ScoreColumnWidth: int (default 12)                                 │    │
│  │ + DateColumnWidth: int (default 12)                                  │    │
│  │ + TopThreeColor: ConsoleColor (Yellow)                               │    │
│  │ + PlayerHighlightColor: ConsoleColor (Cyan)                          │    │
│  │ + DefaultEntryColor: ConsoleColor (White)                            │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          APPLICATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    ILeaderboardService (existing v0.12.x)            │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetLeaderboard(category) : IReadOnlyList<LeaderboardEntry>         │    │
│  │ + GetPlayerRank(playerId, category) : int                            │    │
│  │ + GetPlayerBest(playerId, category) : LeaderboardEntry?              │    │
│  │ + GetScoreBreakdown(entryId) : ScoreComponents                       │    │
│  │ + GetTopEntries(category, count) : IReadOnlyList<LeaderboardEntry>   │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │   LeaderboardEntry      │      │   ScoreComponents       │               │
│  │   (existing v0.12.x)    │      │   (existing v0.12.x)    │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + Id: Guid              │      │ + MonstersKilled: int   │               │
│  │ + PlayerId: string      │      │ + BossesKilled: int     │               │
│  │ + PlayerName: string    │      │ + RoomsDiscovered: int  │               │
│  │ + CharacterClass: string│      │ + GoldEarned: long      │               │
│  │ + Level: int            │      │ + LevelMultiplier: float│               │
│  │ + Score: long           │      │ + AchievementBonus: int │               │
│  │ + Category: LeaderboardCat│    │ + DeathPenalty: int     │               │
│  │ + AchievedAt: DateTime  │      │ + TotalScore: long      │               │
│  │ + TimeElapsed: TimeSpan?│      └─────────────────────────┘               │
│  │ + FloorsCleared: int?   │                                                 │
│  └─────────────────────────┘                                                 │
│                                                                              │
│  ┌─────────────────────────┐                                                 │
│  │   LeaderboardCategory   │                                                 │
│  │   (existing v0.12.x)    │                                                 │
│  ├─────────────────────────┤                                                 │
│  │ + HighScore             │                                                 │
│  │ + Speedrun              │                                                 │
│  │ + NoDeath               │                                                 │
│  │ + AchievementPoints     │                                                 │
│  │ + BossSlayer            │                                                 │
│  └─────────────────────────┘                                                 │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Leaderboard View Display Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    LEADERBOARD VIEW DISPLAY FLOW                             │
└─────────────────────────────────────────────────────────────────────────────┘

    User enters "leaderboard" or "lb" command
           │
           ▼
┌─────────────────────────┐
│   LeaderboardCommand    │
│   Execute()             │
└───────────┬─────────────┘
            │
            │ 1. Get leaderboard entries and player data
            ▼
┌─────────────────────────────────────────────────────────────┐
│    ILeaderboardService                                       │
│                                                              │
│  ┌───────────────────────┐  ┌───────────────────────┐       │
│  │GetLeaderboard(cat)    │  │GetPlayerBest(playerId)│       │
│  └───────────┬───────────┘  └───────────┬───────────┘       │
│              │                          │                    │
│              │ Returns ranked entries   │ Returns best entry │
└──────────────┼──────────────────────────┼───────────────────┘
               │                          │
               │ 2. Map to display DTOs   │
               ▼                          ▼
┌─────────────────────────────────────────────────────────────┐
│    LeaderboardView                                           │
│                                                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ RenderHeader()                                         │  │
│  │ - "LEADERBOARDS"                                       │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                   │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ RenderCategoryTabs()                                   │  │
│  │ [High Score] [Speedrun] [No Death] [Ach Pts] [Boss]   │  │
│  └───────────────────────────────────────────────────────┘  │
│                          │                                   │
│                          │ 3. Render leaderboard entries     │
│                          ▼                                   │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ RenderLeaderboardTable()                               │  │
│  └───────────┬───────────────────────────────────────────┘  │
│              │                                               │
│              │ 4. Render each entry row                      │
└──────────────┼───────────────────────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────────────────────┐
│    LeaderboardEntryRenderer                                  │
│                                                              │
│  FormatEntry(entry, rank)                                    │
│  - GetRankColor(rank) → #1/#2/#3 special, player highlight  │
│  - FormatScore(score) → "125,430" comma-separated           │
│  - FormatDate(date) → "2026-01-05" ISO format               │
│              │                                               │
│              ▼                                               │
│    ┌─────────────────────────────────────────────────────┐  │
│    │ Display format per entry:                            │  │
│    │                                                      │  │
│    │ #1      Thorin        Warrior      15    125,430    │  │
│    │ #2      Elara         Mage         12     98,750    │  │
│    │ >5      Hero (You)    Paladin       8     52,340    │  │
│    └─────────────────────────────────────────────────────┘  │
└──────────────┬───────────────────────────────────────────────┘
               │
               │ 5. Render personal best and score breakdown
               ▼
┌─────────────────────────────────────────────────────────────┐
│    PersonalBestHighlight                                     │
│                                                              │
│  RenderPersonalBest(playerBestEntry)                         │
│  - "Your Best: 52,340 (Rank #5)"                            │
│              │                                               │
│              ▼                                               │
│    ScoreBreakdownPanel                                       │
│                                                              │
│  RenderBreakdown(scoreComponents)                            │
│  - FormatComponent(name, count, points)                      │
│  - ShowMultipliers(levelMultiplier)                          │
│  - ShowPenalties(deathPenalty)                               │
│              │                                               │
│              ▼                                               │
│    ┌─────────────────────────────────────────────────────┐  │
│    │ SCORE BREAKDOWN:                                     │  │
│    │ |-- Monsters Killed: 127 x 10 = 1,270               │  │
│    │ |-- Bosses Killed: 3 x 500 = 1,500                  │  │
│    │ |-- Level Multiplier: x1.8                          │  │
│    │ +-- Death Penalty: -300                             │  │
│    │                                                      │  │
│    │ TOTAL: 52,340                                       │  │
│    └─────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 Category Selection Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CATEGORY SELECTION FLOW                                   │
└─────────────────────────────────────────────────────────────────────────────┘

    User Presses Category Tab Key (1-5)
           │
           ▼
┌─────────────────────────────┐
│    LeaderboardView          │
│    HandleCategoryInput()    │
└───────────┬─────────────────┘
            │
            │ Determine selected category
            ▼
┌─────────────────────────────────────────────────────────────┐
│  Key Mapping                                                 │
│                                                              │
│  Key 1 = High Score (LeaderboardCategory.HighScore)         │
│  Key 2 = Speedrun (LeaderboardCategory.Speedrun)            │
│  Key 3 = No Death (LeaderboardCategory.NoDeath)             │
│  Key 4 = Achievement Points (LeaderboardCategory.AchievementPoints)│
│  Key 5 = Boss Slayer (LeaderboardCategory.BossSlayer)       │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ Update active category
            ▼
┌─────────────────────────────┐
│  SelectCategory(category)   │
└───────────┬─────────────────┘
            │
            │ Fetch new leaderboard data
            ▼
┌─────────────────────────────────────────────────────────────┐
│  ILeaderboardService.GetLeaderboard(category)                │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ Update column headers based on category
            ▼
┌─────────────────────────────────────────────────────────────┐
│  Column Header Mapping                                       │
│                                                              │
│  High Score:      Rank  Name  Class  Level  Score   Date    │
│  Speedrun:        Rank  Name  Class  Level  Time    Date    │
│  No Death:        Rank  Name  Class  Level  Floors  Date    │
│  Achievement Pts: Rank  Name  Class  Level  Points  Date    │
│  Boss Slayer:     Rank  Name  Class  Level  Bosses  Date    │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ Re-render leaderboard
            ▼
┌─────────────────────────────┐
│  RenderLeaderboard()        │
└─────────────────────────────┘
```

### 3.4 Score Breakdown Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SCORE BREAKDOWN FLOW                                      │
└─────────────────────────────────────────────────────────────────────────────┘

    User selects entry to view breakdown (or automatic for player's entry)
           │
           ▼
┌─────────────────────────────┐
│  Request Score Breakdown    │
└───────────┬─────────────────┘
            │
            │ Get score components
            ▼
┌─────────────────────────────────────────────────────────────┐
│    ILeaderboardService.GetScoreBreakdown(entryId)            │
│                                                              │
│    Returns ScoreComponents:                                  │
│    |-- MonstersKilled: int                                   │
│    |-- BossesKilled: int                                     │
│    |-- RoomsDiscovered: int                                  │
│    |-- GoldEarned: long                                      │
│    |-- LevelMultiplier: float                                │
│    |-- AchievementBonus: int                                 │
│    +-- DeathPenalty: int                                     │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ Map to display DTOs
            ▼
┌─────────────────────────────────────────────────────────────┐
│    ScoreBreakdownPanel                                       │
│                                                              │
│  MapToScoreComponentDtos(scoreComponents)                    │
│              │                                               │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Base Point Components (not multipliers or penalties)  │  │
│  │ |-- Monsters Killed: 127 x 10 = 1,270                 │  │
│  │ |-- Bosses Killed: 3 x 500 = 1,500                    │  │
│  │ |-- Rooms Discovered: 42 x 25 = 1,050                 │  │
│  │ +-- Gold Earned: 15,340                               │  │
│  └───────────────────────────────────────────────────────┘  │
│              │                                               │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Multipliers (positive modifiers)                       │  │
│  │ |-- Level Multiplier: x1.8                            │  │
│  │ +-- Achievement Bonus: 4,850                          │  │
│  └───────────────────────────────────────────────────────┘  │
│              │                                               │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Penalties (negative modifiers)                         │  │
│  │ +-- Death Penalty: -300                               │  │
│  └───────────────────────────────────────────────────────┘  │
│              │                                               │
│              ▼                                               │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ Total:                                                 │  │
│  │ TOTAL: 52,340                                         │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. Leaderboard View Component

### 4.1 LeaderboardView Class

**Purpose:** Displays the main leaderboard panel with ranked entries, category tabs, and player highlighting.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/LeaderboardView.cs`

```csharp
using RuneAndRust.Application.DTOs;
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Enums;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Configuration;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays the leaderboard with ranked entries organized by category.
/// </summary>
/// <remarks>
/// Leaderboards show ranked player entries for various categories
/// (High Score, Speedrun, No Death, Achievement Points, Boss Slayer).
/// The current player's entry is highlighted, and top 3 entries have
/// special formatting.
/// </remarks>
public class LeaderboardView
{
    private readonly LeaderboardEntryRenderer _entryRenderer;
    private readonly ScoreBreakdownPanel _breakdownPanel;
    private readonly PersonalBestHighlight _personalBestHighlight;
    private readonly ITerminalService _terminalService;
    private readonly LeaderboardViewConfig _config;
    private readonly ILogger<LeaderboardView> _logger;

    private LeaderboardCategory _activeCategory;
    private IReadOnlyList<LeaderboardDisplayDto> _entries = Array.Empty<LeaderboardDisplayDto>();
    private LeaderboardDisplayDto? _playerBest;
    private string _currentPlayerId = string.Empty;
    private (int X, int Y) _panelPosition;

    /// <summary>
    /// Gets the currently active leaderboard category.
    /// </summary>
    public LeaderboardCategory ActiveCategory => _activeCategory;

    private static readonly (string Name, LeaderboardCategory Category)[] CategoryDefinitions =
    {
        ("High Score", LeaderboardCategory.HighScore),
        ("Speedrun", LeaderboardCategory.Speedrun),
        ("No Death", LeaderboardCategory.NoDeath),
        ("Ach Pts", LeaderboardCategory.AchievementPoints),
        ("Boss Slayer", LeaderboardCategory.BossSlayer)
    };

    /// <summary>
    /// Creates a new instance of the LeaderboardView component.
    /// </summary>
    /// <param name="entryRenderer">The entry renderer for formatting entries.</param>
    /// <param name="breakdownPanel">The score breakdown panel component.</param>
    /// <param name="personalBestHighlight">The personal best highlight component.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for leaderboard display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public LeaderboardView(
        LeaderboardEntryRenderer entryRenderer,
        ScoreBreakdownPanel breakdownPanel,
        PersonalBestHighlight personalBestHighlight,
        ITerminalService terminalService,
        LeaderboardViewConfig config,
        ILogger<LeaderboardView> logger)
    {
        _entryRenderer = entryRenderer ?? throw new ArgumentNullException(nameof(entryRenderer));
        _breakdownPanel = breakdownPanel ?? throw new ArgumentNullException(nameof(breakdownPanel));
        _personalBestHighlight = personalBestHighlight ?? throw new ArgumentNullException(nameof(personalBestHighlight));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));

        _activeCategory = LeaderboardCategory.HighScore;
    }

    /// <summary>
    /// Sets the panel position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _panelPosition = (x, y);
    }

    /// <summary>
    /// Sets the current player ID for highlighting.
    /// </summary>
    /// <param name="playerId">The current player's ID.</param>
    public void SetCurrentPlayer(string playerId)
    {
        _currentPlayerId = playerId;
    }

    /// <summary>
    /// Renders the leaderboard with the given entries.
    /// </summary>
    /// <param name="entries">The leaderboard entries to display.</param>
    public void RenderLeaderboard(IEnumerable<LeaderboardDisplayDto> entries)
    {
        _entries = entries.ToList();

        _logger.LogDebug(
            "Rendering leaderboard: {EntryCount} entries for {Category}",
            _entries.Count, _activeCategory);

        // Clear panel area
        ClearPanel();

        // Render panel header
        RenderHeader();

        // Render category tabs
        RenderCategoryTabs();

        // Render column headers
        RenderColumnHeaders();

        // Render each entry
        RenderEntries();

        // Render personal best if available
        if (_playerBest is not null)
        {
            RenderPersonalBestSection();
        }

        _logger.LogInformation(
            "Leaderboard rendered with {Count} entries for {Category}",
            _entries.Count, _activeCategory);
    }

    /// <summary>
    /// Selects a leaderboard category.
    /// </summary>
    /// <param name="category">The category to select.</param>
    public void SelectCategory(LeaderboardCategory category)
    {
        _activeCategory = category;
        _logger.LogDebug("Leaderboard category changed to: {Category}", category);
    }

    /// <summary>
    /// Highlights a specific player's entry.
    /// </summary>
    /// <param name="entry">The entry to highlight.</param>
    public void HighlightPlayerEntry(LeaderboardDisplayDto entry)
    {
        // Highlight is determined by IsCurrentPlayer flag in DTO
        _logger.LogDebug("Highlighting player entry: {PlayerName}", entry.PlayerName);
    }

    /// <summary>
    /// Shows the player's rank out of total entries.
    /// </summary>
    /// <param name="rank">The player's rank.</param>
    /// <param name="total">The total number of entries.</param>
    public void ShowPlayerRank(int rank, int total)
    {
        var rankText = $"Your Rank: #{rank} of {total}";
        _terminalService.WriteAt(
            _panelPosition.X + 2,
            _panelPosition.Y + _config.PanelHeight - 3,
            rankText);
    }

    /// <summary>
    /// Sets the player's personal best entry for display.
    /// </summary>
    /// <param name="personalBest">The player's best entry.</param>
    public void SetPersonalBest(LeaderboardDisplayDto? personalBest)
    {
        _playerBest = personalBest;
    }

    /// <summary>
    /// Handles category input from user key press.
    /// </summary>
    /// <param name="key">The pressed key (1-5).</param>
    public void HandleCategoryInput(int key)
    {
        var category = key switch
        {
            1 => LeaderboardCategory.HighScore,
            2 => LeaderboardCategory.Speedrun,
            3 => LeaderboardCategory.NoDeath,
            4 => LeaderboardCategory.AchievementPoints,
            5 => LeaderboardCategory.BossSlayer,
            _ => _activeCategory
        };

        SelectCategory(category);
    }

    private void ClearPanel()
    {
        for (int y = 0; y < _config.PanelHeight; y++)
        {
            _terminalService.WriteAt(
                _panelPosition.X,
                _panelPosition.Y + y,
                new string(' ', _config.PanelWidth));
        }
    }

    private void RenderHeader()
    {
        var headerLine = new string('=', _config.PanelWidth - 2);
        var title = "LEADERBOARDS";
        var titlePadding = (_config.PanelWidth - title.Length - 2) / 2;

        _terminalService.WriteAt(_panelPosition.X, _panelPosition.Y, $"+{headerLine}+");
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 1,
            $"|{new string(' ', titlePadding)}{title}{new string(' ', _config.PanelWidth - title.Length - titlePadding - 2)}|");
        _terminalService.WriteAt(_panelPosition.X, _panelPosition.Y + 2, $"+{headerLine}+");
    }

    private void RenderCategoryTabs()
    {
        var tabLine = " ";
        foreach (var (name, category) in CategoryDefinitions)
        {
            var isActive = category == _activeCategory;
            var tabText = isActive ? $"[{name}]" : $" {name} ";
            tabLine += tabText + " ";
        }

        var paddedTabs = tabLine.PadRight(_config.PanelWidth - 2);
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 3,
            $"|{paddedTabs}|");
        _terminalService.WriteAt(
            _panelPosition.X,
            _panelPosition.Y + 4,
            $"+{new string('=', _config.PanelWidth - 2)}+");
    }

    private void RenderColumnHeaders()
    {
        var categoryHeader = GetCategoryDisplayName(_activeCategory);
        var headerY = _panelPosition.Y + 6;

        _terminalService.WriteAt(_panelPosition.X + 3, headerY, $"{categoryHeader} LEADERBOARD");
        _terminalService.WriteAt(_panelPosition.X + 3, headerY + 1, new string('-', categoryHeader.Length + 12));

        // Column headers vary by category
        var columnHeader = GetColumnHeader();
        _terminalService.WriteAt(_panelPosition.X + 3, headerY + 3, columnHeader);
        _terminalService.WriteAt(_panelPosition.X + 3, headerY + 4, new string('=', _config.PanelWidth - 8));
    }

    private string GetColumnHeader()
    {
        var rankCol = "Rank".PadRight(_config.RankColumnWidth);
        var nameCol = "Name".PadRight(_config.NameColumnWidth);
        var classCol = "Class".PadRight(_config.ClassColumnWidth);
        var levelCol = "Level".PadRight(_config.LevelColumnWidth);
        var dateCol = "Date".PadRight(_config.DateColumnWidth);

        var scoreLabel = _activeCategory switch
        {
            LeaderboardCategory.Speedrun => "Time",
            LeaderboardCategory.NoDeath => "Floors",
            LeaderboardCategory.AchievementPoints => "Points",
            LeaderboardCategory.BossSlayer => "Bosses",
            _ => "Score"
        };
        var scoreCol = scoreLabel.PadRight(_config.ScoreColumnWidth);

        return $"{rankCol}{nameCol}{classCol}{levelCol}{scoreCol}{dateCol}";
    }

    private string GetCategoryDisplayName(LeaderboardCategory category)
    {
        return category switch
        {
            LeaderboardCategory.HighScore => "HIGH SCORE",
            LeaderboardCategory.Speedrun => "SPEEDRUN",
            LeaderboardCategory.NoDeath => "NO DEATH",
            LeaderboardCategory.AchievementPoints => "ACHIEVEMENT POINTS",
            LeaderboardCategory.BossSlayer => "BOSS SLAYER",
            _ => category.ToString().ToUpperInvariant()
        };
    }

    private void RenderEntries()
    {
        var startY = _panelPosition.Y + 11;
        var currentY = startY;

        foreach (var entry in _entries.Take(10)) // Show top 10
        {
            var formattedEntry = _entryRenderer.FormatEntry(entry, _activeCategory, _config);
            _terminalService.WriteAt(_panelPosition.X + 3, currentY, formattedEntry);
            currentY++;
        }
    }

    private void RenderPersonalBestSection()
    {
        var separatorY = _panelPosition.Y + 22;
        _terminalService.WriteAt(
            _panelPosition.X + 3,
            separatorY,
            new string('-', _config.PanelWidth - 8));

        _personalBestHighlight.RenderPersonalBest(
            _playerBest!,
            _panelPosition.X + 3,
            separatorY + 1);
    }
}
```

### 4.2 Category Tab Mappings

**Purpose:** Provides category tab key mappings for switching between leaderboard types.

| Key | Category | Value Column | Description |
|-----|----------|--------------|-------------|
| 1 | High Score | Score | Total points earned |
| 2 | Speedrun | Time | Fastest completion time |
| 3 | No Death | Floors | Most floors without dying |
| 4 | Achievement Points | Points | Total achievement points |
| 5 | Boss Slayer | Bosses | Most bosses defeated |

### 4.3 Panel Header and Tabs

The leaderboard header displays:
- Title: "LEADERBOARDS" centered
- Category tabs with active indicator

```
+=====================================================================+
|                        LEADERBOARDS                                  |
+=====================================================================+
| [High Score] [Speedrun] [No Death] [Ach Pts] [Boss Slayer]          |
+=====================================================================+
```

---

## 5. Leaderboard Entry Renderer Component

### 5.1 LeaderboardEntryRenderer Class

**Purpose:** Formats individual leaderboard entries with proper column alignment, rank indicators, and colors.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Renderers/LeaderboardEntryRenderer.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Configuration;
using RuneAndRust.Domain.Enums;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.Renderers;

/// <summary>
/// Renders individual leaderboard entries with proper formatting.
/// </summary>
/// <remarks>
/// Handles rank indicators (#1, #2, #3 for top three, >N for current player),
/// column alignment, score/time/floor formatting, and date display.
/// </remarks>
public class LeaderboardEntryRenderer
{
    private readonly ILogger<LeaderboardEntryRenderer> _logger;

    /// <summary>
    /// Creates a new instance of the LeaderboardEntryRenderer.
    /// </summary>
    /// <param name="logger">Logger for diagnostic output.</param>
    public LeaderboardEntryRenderer(ILogger<LeaderboardEntryRenderer> logger)
    {
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Formats a leaderboard entry for display.
    /// </summary>
    /// <param name="entry">The entry to format.</param>
    /// <param name="category">The leaderboard category.</param>
    /// <param name="config">The view configuration.</param>
    /// <returns>The formatted entry string.</returns>
    public string FormatEntry(
        LeaderboardDisplayDto entry,
        LeaderboardCategory category,
        LeaderboardViewConfig config)
    {
        var rankStr = FormatRank(entry.Rank, entry.IsCurrentPlayer);
        var rankCol = rankStr.PadRight(config.RankColumnWidth);

        var nameStr = entry.IsCurrentPlayer
            ? $"{entry.PlayerName} (You)"
            : entry.PlayerName;
        nameStr = TruncateOrPad(nameStr, config.NameColumnWidth);

        var classCol = TruncateOrPad(entry.CharacterClass, config.ClassColumnWidth);
        var levelCol = entry.Level.ToString().PadLeft(config.LevelColumnWidth - 2).PadRight(config.LevelColumnWidth);
        var scoreCol = FormatScoreColumn(entry, category).PadLeft(config.ScoreColumnWidth - 2).PadRight(config.ScoreColumnWidth);
        var dateCol = FormatDate(entry.Date);

        return $"{rankCol}{nameStr}{classCol}{levelCol}{scoreCol}{dateCol}";
    }

    /// <summary>
    /// Formats the rank indicator.
    /// </summary>
    /// <param name="rank">The rank number.</param>
    /// <param name="isCurrentPlayer">Whether this is the current player's entry.</param>
    /// <returns>The formatted rank string.</returns>
    public string FormatRank(int rank, bool isCurrentPlayer)
    {
        if (isCurrentPlayer)
        {
            return $">{rank}";
        }

        return rank switch
        {
            1 => "#1",
            2 => "#2",
            3 => "#3",
            _ => rank.ToString()
        };
    }

    /// <summary>
    /// Gets the console color for a rank.
    /// </summary>
    /// <param name="rank">The rank number.</param>
    /// <param name="isCurrentPlayer">Whether this is the current player's entry.</param>
    /// <returns>The appropriate console color.</returns>
    public ConsoleColor GetRankColor(int rank, bool isCurrentPlayer)
    {
        if (isCurrentPlayer)
        {
            return ConsoleColor.Cyan;
        }

        return rank switch
        {
            1 => ConsoleColor.Yellow,      // Gold
            2 => ConsoleColor.Gray,        // Silver
            3 => ConsoleColor.DarkYellow,  // Bronze
            _ => ConsoleColor.White
        };
    }

    /// <summary>
    /// Formats a score value with comma separators.
    /// </summary>
    /// <param name="score">The score to format.</param>
    /// <returns>The formatted score string.</returns>
    public string FormatScore(long score)
    {
        return score.ToString("N0");
    }

    /// <summary>
    /// Formats a date in ISO format.
    /// </summary>
    /// <param name="date">The date to format.</param>
    /// <returns>The formatted date string (YYYY-MM-DD).</returns>
    public string FormatDate(DateTime date)
    {
        return date.ToString("yyyy-MM-dd");
    }

    /// <summary>
    /// Formats a time span for speedrun display.
    /// </summary>
    /// <param name="time">The time span to format.</param>
    /// <returns>The formatted time string (H:MM:SS).</returns>
    public string FormatTime(TimeSpan time)
    {
        return $"{(int)time.TotalHours}:{time.Minutes:D2}:{time.Seconds:D2}";
    }

    private string FormatScoreColumn(LeaderboardDisplayDto entry, LeaderboardCategory category)
    {
        return category switch
        {
            LeaderboardCategory.Speedrun => FormatTime(entry.TimeElapsed ?? TimeSpan.Zero),
            LeaderboardCategory.NoDeath => entry.FloorsCleared?.ToString() ?? "0",
            LeaderboardCategory.BossSlayer => entry.BossesDefeated?.ToString() ?? "0",
            _ => FormatScore(entry.Score)
        };
    }

    private string TruncateOrPad(string text, int width)
    {
        if (text.Length > width - 1)
        {
            return text.Substring(0, width - 4) + "...";
        }
        return text.PadRight(width);
    }
}
```

### 5.2 Rank Indicator Formatting

| Rank | Format | Color | Description |
|------|--------|-------|-------------|
| 1 | `#1` | Yellow | Gold - First place |
| 2 | `#2` | Gray | Silver - Second place |
| 3 | `#3` | DarkYellow | Bronze - Third place |
| 4+ | `4` | White | Standard rank |
| Player | `>5` | Cyan | Current player's entry |

### 5.3 Score Formatting by Category

| Category | Format | Example |
|----------|--------|---------|
| High Score | Comma-separated | `125,430` |
| Speedrun | H:MM:SS | `1:23:45` |
| No Death | Integer | `42` |
| Achievement Points | Comma-separated | `485` |
| Boss Slayer | Integer | `15` |

---

## 6. Score Breakdown Panel Component

### 6.1 ScoreBreakdownPanel Class

**Purpose:** Displays the detailed breakdown of how a score was calculated, including base components, multipliers, and penalties.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/ScoreBreakdownPanel.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays a detailed breakdown of score components.
/// </summary>
/// <remarks>
/// Shows how a score was calculated with base components (monsters killed, rooms discovered),
/// multipliers (level bonus, achievement bonus), and penalties (death penalty).
/// </remarks>
public class ScoreBreakdownPanel
{
    private readonly ITerminalService _terminalService;
    private readonly LeaderboardViewConfig _config;
    private readonly ILogger<ScoreBreakdownPanel> _logger;

    /// <summary>
    /// Creates a new instance of the ScoreBreakdownPanel component.
    /// </summary>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public ScoreBreakdownPanel(
        ITerminalService terminalService,
        LeaderboardViewConfig config,
        ILogger<ScoreBreakdownPanel> logger)
    {
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders the score breakdown.
    /// </summary>
    /// <param name="components">The score component DTOs.</param>
    /// <param name="totalScore">The total score.</param>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void RenderBreakdown(
        IReadOnlyList<ScoreComponentDto> components,
        long totalScore,
        int x,
        int y)
    {
        _terminalService.WriteAt(x, y, "SCORE BREAKDOWN:");
        _terminalService.WriteAt(x, y + 1, new string('-', 50));

        var currentY = y + 2;

        // Render base components
        var baseComponents = components.Where(c => !c.IsMultiplier && !c.IsPenalty).ToList();
        foreach (var component in baseComponents)
        {
            var line = FormatComponent(component);
            var prefix = component == baseComponents.Last() && !components.Any(c => c.IsMultiplier || c.IsPenalty)
                ? "+"
                : "|";
            _terminalService.WriteAt(x, currentY, $"{prefix}-- {line}");
            currentY++;
        }

        // Render multipliers
        var multipliers = components.Where(c => c.IsMultiplier).ToList();
        foreach (var multiplier in multipliers)
        {
            var line = FormatMultiplier(multiplier);
            var prefix = multiplier == multipliers.Last() && !components.Any(c => c.IsPenalty)
                ? "+"
                : "|";
            _terminalService.WriteAt(x, currentY, $"{prefix}-- {line}");
            currentY++;
        }

        // Render penalties
        var penalties = components.Where(c => c.IsPenalty).ToList();
        foreach (var penalty in penalties)
        {
            var line = FormatPenalty(penalty);
            var prefix = penalty == penalties.Last() ? "+" : "|";
            _terminalService.WriteAt(x, currentY, $"{prefix}-- {line}");
            currentY++;
        }

        // Render total
        currentY++;
        _terminalService.WriteAt(x, currentY, $"TOTAL: {totalScore:N0}");

        _logger.LogDebug("Rendered score breakdown with {Count} components", components.Count);
    }

    /// <summary>
    /// Formats a base score component.
    /// </summary>
    /// <param name="component">The component to format.</param>
    /// <returns>The formatted component string.</returns>
    public string FormatComponent(ScoreComponentDto component)
    {
        if (component.PointsEach > 0 && component.Count > 0)
        {
            return $"{component.Name}: {component.Count} x {component.PointsEach} = {component.TotalPoints:N0}";
        }
        return $"{component.Name}: {component.TotalPoints:N0}";
    }

    /// <summary>
    /// Formats a multiplier component.
    /// </summary>
    /// <param name="multiplier">The multiplier to format.</param>
    /// <returns>The formatted multiplier string.</returns>
    public string FormatMultiplier(ScoreComponentDto multiplier)
    {
        if (multiplier.Name.Contains("Multiplier"))
        {
            var value = multiplier.TotalPoints / 100.0;
            return $"{multiplier.Name}: x{value:F1}";
        }
        return $"{multiplier.Name}: {multiplier.TotalPoints:N0}";
    }

    /// <summary>
    /// Formats a penalty component.
    /// </summary>
    /// <param name="penalty">The penalty to format.</param>
    /// <returns>The formatted penalty string.</returns>
    public string FormatPenalty(ScoreComponentDto penalty)
    {
        return $"{penalty.Name}: -{Math.Abs(penalty.TotalPoints):N0}";
    }

    /// <summary>
    /// Shows all multipliers.
    /// </summary>
    /// <param name="multipliers">The multiplier components.</param>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void ShowMultipliers(IEnumerable<ScoreComponentDto> multipliers, int x, int y)
    {
        var currentY = y;
        foreach (var multiplier in multipliers)
        {
            _terminalService.WriteAt(x, currentY, $"|-- {FormatMultiplier(multiplier)}");
            currentY++;
        }
    }

    /// <summary>
    /// Shows all penalties.
    /// </summary>
    /// <param name="penalties">The penalty components.</param>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void ShowPenalties(IEnumerable<ScoreComponentDto> penalties, int x, int y)
    {
        var currentY = y;
        foreach (var penalty in penalties)
        {
            _terminalService.WriteAt(x, currentY, $"+-- {FormatPenalty(penalty)}");
            currentY++;
        }
    }
}
```

### 6.2 Component Formatting Rules

| Type | Format | Example |
|------|--------|---------|
| Base (with count) | `Name: count x points = total` | `Monsters Killed: 127 x 10 = 1,270` |
| Base (flat) | `Name: total` | `Gold Earned: 15,340` |
| Multiplier | `Name: xN.N` | `Level Multiplier: x1.8` |
| Bonus | `Name: total` | `Achievement Bonus: 4,850` |
| Penalty | `Name: -total` | `Death Penalty: -300` |

### 6.3 Tree Prefix Characters

| Position | Character | Meaning |
|----------|-----------|---------|
| Intermediate | `\|--` | More items follow |
| Last | `+--` | Final item in group |

---

## 7. Personal Best Highlight Component

### 7.1 PersonalBestHighlight Class

**Purpose:** Displays the current player's personal best entry with highlighting and optional new record notification.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/PersonalBestHighlight.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays and highlights the player's personal best entry.
/// </summary>
/// <remarks>
/// Shows the player's best score/time/floor count with their rank.
/// Can display a "NEW RECORD!" notification when a record is broken.
/// </remarks>
public class PersonalBestHighlight
{
    private readonly ITerminalService _terminalService;
    private readonly LeaderboardViewConfig _config;
    private readonly ILogger<PersonalBestHighlight> _logger;

    private bool _isNewRecord;

    /// <summary>
    /// Creates a new instance of the PersonalBestHighlight component.
    /// </summary>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public PersonalBestHighlight(
        ITerminalService terminalService,
        LeaderboardViewConfig config,
        ILogger<PersonalBestHighlight> logger)
    {
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Renders the player's personal best entry.
    /// </summary>
    /// <param name="personalBest">The player's best entry.</param>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void RenderPersonalBest(LeaderboardDisplayDto personalBest, int x, int y)
    {
        var bestText = $"Your Best: {personalBest.Score:N0} (Rank #{personalBest.Rank})";
        _terminalService.WriteAt(x, y, bestText);

        if (_isNewRecord)
        {
            _terminalService.WriteAt(x, y + 1, "*** NEW RECORD! ***");
            _isNewRecord = false;
        }

        _logger.LogDebug("Rendered personal best: Rank {Rank}, Score {Score}",
            personalBest.Rank, personalBest.Score);
    }

    /// <summary>
    /// Compares two entries to determine if a new record was set.
    /// </summary>
    /// <param name="current">The current entry.</param>
    /// <param name="previous">The previous best entry.</param>
    public void CompareToEntry(LeaderboardDisplayDto current, LeaderboardDisplayDto previous)
    {
        if (current.Score > previous.Score)
        {
            _isNewRecord = true;
            _logger.LogInformation("New record set! Previous: {Previous}, New: {New}",
                previous.Score, current.Score);
        }
    }

    /// <summary>
    /// Sets the new record flag for display.
    /// </summary>
    public void ShowNewRecord()
    {
        _isNewRecord = true;
        _logger.LogDebug("New record flag set");
    }

    /// <summary>
    /// Clears the new record flag.
    /// </summary>
    public void ClearNewRecord()
    {
        _isNewRecord = false;
    }
}
```

### 7.2 Personal Best Display Format

```
Your Best: 52,340 (Rank #5)
*** NEW RECORD! ***
```

---

## 8. Display DTOs

### 8.1 LeaderboardDisplayDto

**Purpose:** Data transfer object for displaying leaderboard entries.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/LeaderboardDisplayDto.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Data transfer object for displaying a leaderboard entry.
/// </summary>
public class LeaderboardDisplayDto
{
    /// <summary>
    /// Gets or sets the rank position (1-based).
    /// </summary>
    public int Rank { get; set; }

    /// <summary>
    /// Gets or sets the player's name.
    /// </summary>
    public required string PlayerName { get; set; }

    /// <summary>
    /// Gets or sets the character class.
    /// </summary>
    public required string CharacterClass { get; set; }

    /// <summary>
    /// Gets or sets the character level.
    /// </summary>
    public int Level { get; set; }

    /// <summary>
    /// Gets or sets the score value.
    /// </summary>
    public long Score { get; set; }

    /// <summary>
    /// Gets or sets the achievement date.
    /// </summary>
    public DateTime Date { get; set; }

    /// <summary>
    /// Gets or sets whether this is the current player's entry.
    /// </summary>
    public bool IsCurrentPlayer { get; set; }

    /// <summary>
    /// Gets or sets the leaderboard category.
    /// </summary>
    public LeaderboardCategory Category { get; set; }

    /// <summary>
    /// Gets or sets the time elapsed (for Speedrun category).
    /// </summary>
    public TimeSpan? TimeElapsed { get; set; }

    /// <summary>
    /// Gets or sets the floors cleared (for No Death category).
    /// </summary>
    public int? FloorsCleared { get; set; }

    /// <summary>
    /// Gets or sets the bosses defeated (for Boss Slayer category).
    /// </summary>
    public int? BossesDefeated { get; set; }
}
```

### 8.2 ScoreComponentDto

**Purpose:** Data transfer object for score breakdown components.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/ScoreComponentDto.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Data transfer object for a score breakdown component.
/// </summary>
public class ScoreComponentDto
{
    /// <summary>
    /// Gets or sets the component name.
    /// </summary>
    public required string Name { get; set; }

    /// <summary>
    /// Gets or sets the count (e.g., monsters killed).
    /// </summary>
    public int Count { get; set; }

    /// <summary>
    /// Gets or sets the points earned per unit.
    /// </summary>
    public int PointsEach { get; set; }

    /// <summary>
    /// Gets or sets the total points for this component.
    /// </summary>
    public int TotalPoints { get; set; }

    /// <summary>
    /// Gets or sets whether this is a multiplier.
    /// </summary>
    public bool IsMultiplier { get; set; }

    /// <summary>
    /// Gets or sets whether this is a penalty (negative points).
    /// </summary>
    public bool IsPenalty { get; set; }
}
```

---

## 9. Configuration

### 9.1 LeaderboardViewConfig

**Purpose:** Configuration settings for the Leaderboard View display.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Configuration/LeaderboardViewConfig.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.Configuration;

/// <summary>
/// Configuration settings for the leaderboard view display.
/// </summary>
public class LeaderboardViewConfig
{
    /// <summary>
    /// Gets or sets the total width of the leaderboard panel.
    /// </summary>
    public int PanelWidth { get; set; } = 72;

    /// <summary>
    /// Gets or sets the total height of the leaderboard panel.
    /// </summary>
    public int PanelHeight { get; set; } = 35;

    /// <summary>
    /// Gets or sets the width of the rank column.
    /// </summary>
    public int RankColumnWidth { get; set; } = 6;

    /// <summary>
    /// Gets or sets the width of the name column.
    /// </summary>
    public int NameColumnWidth { get; set; } = 14;

    /// <summary>
    /// Gets or sets the width of the class column.
    /// </summary>
    public int ClassColumnWidth { get; set; } = 10;

    /// <summary>
    /// Gets or sets the width of the level column.
    /// </summary>
    public int LevelColumnWidth { get; set; } = 8;

    /// <summary>
    /// Gets or sets the width of the score column.
    /// </summary>
    public int ScoreColumnWidth { get; set; } = 12;

    /// <summary>
    /// Gets or sets the width of the date column.
    /// </summary>
    public int DateColumnWidth { get; set; } = 12;

    /// <summary>
    /// Gets or sets the color for top 3 entries.
    /// </summary>
    public ConsoleColor TopThreeColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>
    /// Gets or sets the color for the current player's entry.
    /// </summary>
    public ConsoleColor PlayerHighlightColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>
    /// Gets or sets the default entry color.
    /// </summary>
    public ConsoleColor DefaultEntryColor { get; set; } = ConsoleColor.White;

    /// <summary>
    /// Gets or sets the maximum number of entries to display.
    /// </summary>
    public int MaxDisplayEntries { get; set; } = 10;
}
```

---

## 10. Leaderboard Command

### 10.1 LeaderboardCommand Class

**Purpose:** Command handler for displaying the leaderboard view.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Commands/LeaderboardCommand.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.UI;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Domain.Enums;
using Microsoft.Extensions.Logging;

namespace RuneAndRust.Presentation.Tui.Commands;

/// <summary>
/// Command handler for displaying the leaderboard view.
/// </summary>
public class LeaderboardCommand : ICommand
{
    private readonly ILeaderboardService _leaderboardService;
    private readonly LeaderboardView _view;
    private readonly ScoreBreakdownPanel _breakdownPanel;
    private readonly ILogger<LeaderboardCommand> _logger;

    /// <summary>
    /// Gets the command name.
    /// </summary>
    public string Name => "leaderboard";

    /// <summary>
    /// Gets the command aliases.
    /// </summary>
    public IReadOnlyList<string> Aliases => new[] { "lb", "scores", "highscores" };

    /// <summary>
    /// Gets the command description.
    /// </summary>
    public string Description => "View leaderboards";

    /// <summary>
    /// Creates a new instance of the LeaderboardCommand.
    /// </summary>
    /// <param name="leaderboardService">The leaderboard service.</param>
    /// <param name="view">The leaderboard view component.</param>
    /// <param name="breakdownPanel">The score breakdown panel.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public LeaderboardCommand(
        ILeaderboardService leaderboardService,
        LeaderboardView view,
        ScoreBreakdownPanel breakdownPanel,
        ILogger<LeaderboardCommand> logger)
    {
        _leaderboardService = leaderboardService ?? throw new ArgumentNullException(nameof(leaderboardService));
        _view = view ?? throw new ArgumentNullException(nameof(view));
        _breakdownPanel = breakdownPanel ?? throw new ArgumentNullException(nameof(breakdownPanel));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Executes the leaderboard command.
    /// </summary>
    /// <param name="args">The command arguments.</param>
    /// <param name="context">The command context.</param>
    public async Task ExecuteAsync(string[] args, CommandContext context)
    {
        _logger.LogInformation("Executing leaderboard command");

        // Parse category from args if provided
        var category = ParseCategory(args);
        _view.SelectCategory(category);

        // Get leaderboard entries
        var entries = await _leaderboardService.GetLeaderboardAsync(category);

        // Get player's personal best
        var playerBest = await _leaderboardService.GetPlayerBestAsync(context.PlayerId, category);

        // Map to display DTOs
        var displayEntries = MapToDisplayDtos(entries, context.PlayerId);

        // Set player info
        _view.SetCurrentPlayer(context.PlayerId);
        if (playerBest is not null)
        {
            var playerBestDto = MapToDisplayDto(playerBest, context.PlayerId, entries.ToList());
            _view.SetPersonalBest(playerBestDto);
        }

        // Set view position
        _view.SetPosition(0, 0);

        // Render leaderboard
        _view.RenderLeaderboard(displayEntries);

        // If player has an entry, show score breakdown
        if (playerBest is not null)
        {
            var breakdown = await _leaderboardService.GetScoreBreakdownAsync(playerBest.Id);
            var breakdownDtos = MapToScoreComponentDtos(breakdown);
            _breakdownPanel.RenderBreakdown(breakdownDtos, playerBest.Score, 3, 26);
        }

        _logger.LogInformation("Leaderboard displayed successfully for {Category}", category);
    }

    private LeaderboardCategory ParseCategory(string[] args)
    {
        if (args.Length == 0)
        {
            return LeaderboardCategory.HighScore;
        }

        return args[0].ToLowerInvariant() switch
        {
            "speed" or "speedrun" => LeaderboardCategory.Speedrun,
            "nodeath" or "no-death" => LeaderboardCategory.NoDeath,
            "ach" or "achievements" or "points" => LeaderboardCategory.AchievementPoints,
            "boss" or "bosses" => LeaderboardCategory.BossSlayer,
            _ => LeaderboardCategory.HighScore
        };
    }

    private IEnumerable<LeaderboardDisplayDto> MapToDisplayDtos(
        IEnumerable<LeaderboardEntry> entries,
        string currentPlayerId)
    {
        return entries.Select((entry, index) => MapToDisplayDto(entry, currentPlayerId, entries.ToList()));
    }

    private LeaderboardDisplayDto MapToDisplayDto(
        LeaderboardEntry entry,
        string currentPlayerId,
        IReadOnlyList<LeaderboardEntry> allEntries)
    {
        var rank = allEntries.ToList().IndexOf(entry) + 1;

        return new LeaderboardDisplayDto
        {
            Rank = rank,
            PlayerName = entry.PlayerName,
            CharacterClass = entry.CharacterClass,
            Level = entry.Level,
            Score = entry.Score,
            Date = entry.AchievedAt,
            IsCurrentPlayer = entry.PlayerId == currentPlayerId,
            Category = entry.Category,
            TimeElapsed = entry.TimeElapsed,
            FloorsCleared = entry.FloorsCleared,
            BossesDefeated = entry.BossesDefeated
        };
    }

    private IReadOnlyList<ScoreComponentDto> MapToScoreComponentDtos(ScoreComponents components)
    {
        var dtos = new List<ScoreComponentDto>();

        // Base components
        dtos.Add(new ScoreComponentDto
        {
            Name = "Monsters Killed",
            Count = components.MonstersKilled,
            PointsEach = 10,
            TotalPoints = components.MonstersKilled * 10
        });

        dtos.Add(new ScoreComponentDto
        {
            Name = "Bosses Killed",
            Count = components.BossesKilled,
            PointsEach = 500,
            TotalPoints = components.BossesKilled * 500
        });

        dtos.Add(new ScoreComponentDto
        {
            Name = "Rooms Discovered",
            Count = components.RoomsDiscovered,
            PointsEach = 25,
            TotalPoints = components.RoomsDiscovered * 25
        });

        dtos.Add(new ScoreComponentDto
        {
            Name = "Gold Earned",
            Count = 0,
            PointsEach = 0,
            TotalPoints = (int)components.GoldEarned
        });

        // Multipliers
        dtos.Add(new ScoreComponentDto
        {
            Name = "Level Multiplier",
            TotalPoints = (int)(components.LevelMultiplier * 100),
            IsMultiplier = true
        });

        if (components.AchievementBonus > 0)
        {
            dtos.Add(new ScoreComponentDto
            {
                Name = "Achievement Bonus",
                TotalPoints = components.AchievementBonus,
                IsMultiplier = true
            });
        }

        // Penalties
        if (components.DeathPenalty > 0)
        {
            dtos.Add(new ScoreComponentDto
            {
                Name = "Death Penalty",
                TotalPoints = -components.DeathPenalty,
                IsPenalty = true
            });
        }

        return dtos;
    }
}
```

---

## 11. Category-Specific Display

### 11.1 High Score Leaderboard

```
   HIGH SCORE LEADERBOARD
   ----------------------

   Rank    Name           Class      Level    Score      Date
   =================================================================
   #1      Thorin        Warrior      15     125,430    2026-01-05
   #2      Elara         Mage         12      98,750    2026-01-03
   #3      Shadow        Rogue        14      87,320    2026-01-08
    4      Grok          Warrior      10      65,100    2026-01-01
   >5      Hero (You)    Paladin       8      52,340    2026-01-10
    6      Luna          Healer        9      48,200    2026-01-02
    7      Drake         Ranger        7      35,600    2025-12-28
```

### 11.2 Speedrun Leaderboard

```
   SPEEDRUN LEADERBOARD
   --------------------

   Rank    Name           Class      Level    Time       Date
   =================================================================
   #1      Shadow        Rogue        10     1:23:45    2026-01-08
   #2      Wind          Ranger        8     1:45:20    2026-01-05
   #3      Flash         Mage          9     2:01:33    2026-01-10
    4      Dash          Rogue         7     2:15:42    2026-01-03
   >5      Hero (You)    Paladin       8     2:34:18    2026-01-10
```

### 11.3 No Death Leaderboard

```
   NO DEATH LEADERBOARD
   --------------------

   Rank    Name           Class      Level    Floors     Date
   =================================================================
   #1      Iron          Warrior      15        42      2026-01-03
   #2      Shield        Paladin      12        38      2026-01-01
   #3      Stone         Warrior      11        35      2026-01-08
    4      Wall          Paladin      10        32      2026-01-05
   >5      Hero (You)    Paladin       8        28      2026-01-10
```

### 11.4 Achievement Points Leaderboard

```
   ACHIEVEMENT POINTS LEADERBOARD
   ------------------------------

   Rank    Name           Class      Level    Points     Date
   =================================================================
   #1      Collector     Ranger       15        985      2026-01-08
   #2      Hunter        Rogue        14        875      2026-01-05
   #3      Seeker        Mage         13        750      2026-01-03
    4      Explorer      Ranger       12        685      2026-01-01
   >5      Hero (You)    Paladin       8        485      2026-01-10
```

### 11.5 Boss Slayer Leaderboard

```
   BOSS SLAYER LEADERBOARD
   -----------------------

   Rank    Name           Class      Level    Bosses     Date
   =================================================================
   #1      Slayer        Warrior      15        28      2026-01-08
   #2      Champion      Paladin      14        24      2026-01-05
   #3      Vanquisher    Mage         13        21      2026-01-03
    4      Conqueror     Warrior      12        18      2026-01-01
   >5      Hero (You)    Paladin       8        15      2026-01-10
```

---

## 12. User-Facing Display Examples

### 12.1 Full Leaderboard View

```
+=====================================================================+
|                        LEADERBOARDS                                  |
+=====================================================================+
| [High Score] [Speedrun] [No Death] [Ach Pts] [Boss Slayer]          |
+=====================================================================+
|                                                                      |
|   HIGH SCORE LEADERBOARD                                            |
|   ----------------------                                             |
|                                                                      |
|   Rank    Name           Class      Level    Score      Date        |
|   ================================================================= |
|   #1      Thorin        Warrior      15     125,430    2026-01-05   |
|   #2      Elara         Mage         12      98,750    2026-01-03   |
|   #3      Shadow        Rogue        14      87,320    2026-01-08   |
|    4      Grok          Warrior      10      65,100    2026-01-01   |
|   >5      Hero (You)    Paladin       8      52,340    2026-01-10   |
|    6      Luna          Healer        9      48,200    2026-01-02   |
|    7      Drake         Ranger        7      35,600    2025-12-28   |
|                                                                      |
|   ----------------------------------------------------------------- |
|   Your Best: 52,340 (Rank #5)                                       |
|                                                                      |
|   SCORE BREAKDOWN:                                                   |
|   ----------------------------------------------------------------- |
|   |-- Monsters Killed: 127 x 10 = 1,270                             |
|   |-- Bosses Killed: 3 x 500 = 1,500                                |
|   |-- Rooms Discovered: 42 x 25 = 1,050                             |
|   |-- Gold Earned: 15,340                                            |
|   |-- Level Multiplier: x1.8                                         |
|   |-- Achievement Bonus: 4,850                                       |
|   +-- Death Penalty: -300                                            |
|                                                                      |
|   TOTAL: 52,340                                                      |
|                                                                      |
+=====================================================================+
```

---

## 13. Acceptance Criteria

### 13.1 Leaderboard View Display

- [ ] Leaderboard view displays with proper header and borders
- [ ] Title "LEADERBOARDS" centered in header
- [ ] All 5 category tabs display correctly

### 13.2 Category Tabs

- [ ] Active tab shows with brackets `[High Score]`
- [ ] Inactive tabs show without brackets ` Speedrun `
- [ ] Keys 1-5 switch between categories
- [ ] Tab switching updates column headers appropriately
- [ ] Tab switching fetches new leaderboard data

### 13.3 Entry Display

- [ ] Entries display in correct rank order
- [ ] Top 3 entries show `#1`, `#2`, `#3` prefixes
- [ ] Current player's entry shows `>N` prefix
- [ ] Name column truncates long names with `...`
- [ ] Score column shows comma-separated values
- [ ] Date column shows ISO format (YYYY-MM-DD)

### 13.4 Category-Specific Formatting

- [ ] High Score shows "Score" column with points
- [ ] Speedrun shows "Time" column in H:MM:SS format
- [ ] No Death shows "Floors" column with integer
- [ ] Achievement Points shows "Points" column
- [ ] Boss Slayer shows "Bosses" column with integer

### 13.5 Personal Best and Breakdown

- [ ] Personal best displays with rank
- [ ] Score breakdown shows all components
- [ ] Components grouped by type (base, multiplier, penalty)
- [ ] Tree structure uses correct prefix characters
- [ ] Total displays at bottom

### 13.6 Colors and Highlighting

- [ ] Top 3 entries use special color (Yellow)
- [ ] Current player's entry uses highlight color (Cyan)
- [ ] Standard entries use default color (White)

---

## 14. Unit Tests

### 14.1 Test Categories

| Test Category | Count | Description |
|--------------|-------|-------------|
| LeaderboardView Tests | 2 | View rendering and category switching |
| LeaderboardEntryRenderer Tests | 2 | Entry formatting and rank display |
| ScoreBreakdownPanel Tests | 1 | Breakdown formatting |
| PersonalBestHighlight Tests | 1 | Personal best display |

### 14.2 Test Specifications

```csharp
// LeaderboardView Tests
[Fact]
public void RenderLeaderboard_WithValidEntries_DisplaysCorrectly()
{
    // Arrange: Create leaderboard entry DTOs
    // Act: Call RenderLeaderboard
    // Assert: Verify terminal output contains expected elements
}

[Fact]
public void SelectCategory_ChangesCategory_UpdatesColumnHeaders()
{
    // Arrange: Set initial category to HighScore
    // Act: Call SelectCategory with Speedrun
    // Assert: Verify column header shows "Time" instead of "Score"
}

// LeaderboardEntryRenderer Tests
[Fact]
public void FormatRank_TopThree_ReturnsHashPrefix()
{
    // Arrange: Create renderer
    // Act: Call FormatRank with rank 1, 2, 3
    // Assert: Returns "#1", "#2", "#3"
}

[Fact]
public void FormatRank_CurrentPlayer_ReturnsArrowPrefix()
{
    // Arrange: Create renderer
    // Act: Call FormatRank with isCurrentPlayer=true
    // Assert: Returns ">5"
}

// ScoreBreakdownPanel Tests
[Fact]
public void FormatComponent_WithCountAndPoints_ReturnsCalculation()
{
    // Arrange: Create component with count=127, pointsEach=10
    // Act: Call FormatComponent
    // Assert: Returns "Monsters Killed: 127 x 10 = 1,270"
}

// PersonalBestHighlight Tests
[Fact]
public void RenderPersonalBest_WithValidEntry_DisplaysRankAndScore()
{
    // Arrange: Create personal best DTO
    // Act: Call RenderPersonalBest
    // Assert: Output contains "Your Best: 52,340 (Rank #5)"
}
```

---

## 15. File Summary

### 15.1 New Files

| File | Type | Purpose |
|------|------|---------|
| `UI/LeaderboardView.cs` | UI Component | Main leaderboard panel |
| `UI/ScoreBreakdownPanel.cs` | UI Component | Score breakdown display |
| `UI/PersonalBestHighlight.cs` | UI Component | Personal best highlighting |
| `Renderers/LeaderboardEntryRenderer.cs` | Renderer | Entry formatting |
| `DTOs/LeaderboardDisplayDto.cs` | DTO | Leaderboard entry display data |
| `DTOs/ScoreComponentDto.cs` | DTO | Score component data |
| `Configuration/LeaderboardViewConfig.cs` | Config | View settings |
| `Commands/LeaderboardCommand.cs` | Command | Leaderboard command handler |

### 15.2 Modified Files

| File | Type | Changes |
|------|------|---------|
| `Startup/ServiceRegistration.cs` | DI | Register new components |

---

## 16. Design Decisions

### 16.1 Confirmed Decisions (from scope breakdown)

| Decision | Value | Rationale |
|----------|-------|-----------|
| Top Highlight | `#1`, `#2`, `#3` | Special formatting for podium |
| Player Highlight | `>N` | Arrow prefix for visibility |
| Score Format | Comma-separated | `125,430` for readability |
| Date Format | `YYYY-MM-DD` | ISO standard format |
| Categories | 5 types | High Score, Speedrun, No Death, Ach Pts, Boss Slayer |

### 16.2 Implementation Decisions

| Decision | Value | Rationale |
|----------|-------|-----------|
| Max Display Entries | 10 | Fits panel height |
| Column Widths | 6/14/10/8/12/12 | Balanced layout |
| Top 3 Color | Yellow | Gold association |
| Player Color | Cyan | Distinct highlight |
| Breakdown Tree | `\|--` and `+--` | Clear hierarchy |

---

## 17. Dependencies

### 17.1 Required from v0.12.x

| Type | Location | Usage |
|------|----------|-------|
| `ILeaderboardService` | `Application/Interfaces/` | Retrieve entries and rankings |
| `LeaderboardEntry` | `Domain/Entities/` | Entry data model |
| `LeaderboardCategory` | `Domain/Enums/` | Category enumeration |
| `ScoreComponents` | `Domain/ValueObjects/` | Breakdown data |

### 17.2 Required from v0.13.4a-b

| Type | Location | Usage |
|------|----------|-------|
| `ITerminalService` | `Presentation.Tui/Services/` | Terminal output |
| Panel styling patterns | v0.13.4a-b | Consistent UI appearance |

### 17.3 Provides to v0.13.4d

| Type | Usage |
|------|-------|
| `LeaderboardView` patterns | Similar panel structure |
| `LeaderboardViewConfig` pattern | Configuration approach |

---

## 18. Future Considerations

### 18.1 Deferred Features (Out of Scope)

| Feature | Target Version | Notes |
|---------|----------------|-------|
| Online Leaderboards | v0.14.x+ | Network connectivity required |
| Leaderboard Filtering | v0.14.x+ | Filter by date range, class |
| Entry Details Popup | v0.14.x+ | Detailed view of any entry |
| Ghost Runs | v0.14.x+ | Replay comparison |

---

## 19. Changelog

| Version | Date | Changes |
|---------|------|---------|
| v0.13.4c-draft | 2026-01-16 | Initial design specification |

---

*This specification provides complete implementation details for v0.13.4c Leaderboard View. All features are derived from the v0.13.4-scope-breakdown.md and v0.13.x-scope-breakdown.md documents. No new features or functionality have been invented.*
