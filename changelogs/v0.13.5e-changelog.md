# v0.13.5e Changelog — Shared Layer Utilization

**Release Date:** 2026-01-21  
**Status:** Implementation Complete

---

## Summary

Extracted duplicated formatting, grid math, icon lookup, and validation logic from TUI/GUI layers into centralized `Presentation.Shared` utility classes, reducing code duplication and ensuring consistency across presentation layers.

---

## Added

### Utility Classes

- **`FormatUtilities`** — Centralized formatting operations
  - `FormatPercentage(int, int)` / `FormatPercentage(double)` — Percentage formatting with clamping
  - `FormatDuration(TimeSpan, bool)` — Human-readable duration (compact/verbose)
  - `FormatNumber(int)` — Thousands-separated numbers
  - `FormatCompactNumber(long)` — Compact notation (K, M, B)
  - `FormatDelta(int)` / `FormatDelta(int, int)` — Signed delta strings
  - `TruncateText(string, int, string)` — Text truncation with ellipsis
  - `CenterText(string, int)` — Center-padded text

- **`GridUtilities`** — Grid coordinate calculations
  - `CalculateGridPosition(int, int)` — Linear index to (x, y)
  - `CalculateLinearIndex(int, int, int)` — (x, y) to linear index
  - `IsValidPosition(int, int, int, int)` — Bounds checking
  - `GetAdjacentPositions(int, int)` — Cardinal adjacent cells
  - `GetAllAdjacentPositions(int, int)` — Including diagonals
  - `GetValidAdjacentPositions(...)` — Bounded adjacent cells
  - `CalculateManhattanDistance(...)` — Taxicab distance
  - `CalculateChebyshevDistance(...)` — Chessboard distance
  - `GetDirection(...)` — Direction between positions

- **`IconUtilities`** — Icon/symbol lookups
  - `GetDirectionIcon(Direction, bool)` — Arrow icons (Unicode/ASCII)
  - `GetDamageTypeIcon(DamageType, bool)` — Damage type icons
  - `GetDieFaceIcon(int, bool)` — Die face symbols (1-6)
  - `GetDiceIcon(DiceType, bool)` — Dice type icons
  - `GetStatusIcon(StatusType, bool)` — Status indicator icons

- **`ValidationUtilities`** — Value validation and normalization
  - `ValidatePercentage(double)` — 0-1 range check
  - `ValidateCurrentMax(int, int)` — Current ≤ max check
  - `IsInRange(int/double, ...)` — Range validation
  - `ClampValue(int/double, ...)` — Value clamping
  - `ClampPercentage(double)` — [0, 1] clamping
  - `NormalizeValue(int/double, ...)` — 0-1 normalization
  - `DenormalizeValue(double, int, int)` — Denormalization
  - `ValidateGridDimensions(int, int)` — Positive dimension check
  - `ValidateGridPosition(...)` — Grid bounds check

### Enums

- **`Direction`** — Cardinal/intercardinal directions (`None`, `North`, `NorthEast`, `East`, `SouthEast`, `South`, `SouthWest`, `West`, `NorthWest`)
- **`StatusType`** — Status indicators (`Success`, `Failure`, `Warning`, `Info`, `Pending`, `InProgress`)
- **`DiceType`** — Dice types (`D4=4`, `D6=6`, `D8=8`, `D10=10`, `D12=12`, `D20=20`, `D100=100`)

### Test Coverage

- **`RuneAndRust.Presentation.Shared.UnitTests`** — New test project
  - `FormatUtilitiesTests` — 22 tests
  - `GridUtilitiesTests` — 17 tests
  - `IconUtilitiesTests` — 18 tests
  - `ValidationUtilitiesTests` — 17 tests

### Documentation

- **`docs/guidelines/SharedLayerGuidelines.md`** — Guidelines for Presentation.Shared layer usage

---

## Technical Notes

- All utility classes are static with no internal state (thread-safe)
- Comprehensive XML documentation with examples on all public APIs
- Icon utilities support Unicode/ASCII fallback pattern for terminal compatibility
- Grid utilities support both tuple and individual coordinate parameters

---

## File Changes

### New Files (17)

```
src/Presentation/RuneAndRust.Presentation.Shared/
├── Enums/
│   ├── DiceType.cs
│   ├── Direction.cs
│   └── StatusType.cs
└── Utilities/
    ├── FormatUtilities.cs
    ├── GridUtilities.cs
    ├── IconUtilities.cs
    └── ValidationUtilities.cs

tests/RuneAndRust.Presentation.Shared.UnitTests/
├── RuneAndRust.Presentation.Shared.UnitTests.csproj
└── Utilities/
    ├── FormatUtilitiesTests.cs
    ├── GridUtilitiesTests.cs
    ├── IconUtilitiesTests.cs
    └── ValidationUtilitiesTests.cs

docs/guidelines/
└── SharedLayerGuidelines.md
```

---

## Related

- **Design Specification:** `docs/design/v0.13.x/v0.13.5e-design-specification.md`
- **Scope Breakdown:** `docs/design/v0.13.x/v0.13.5-scope-breakdown.md`
