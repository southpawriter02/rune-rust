# v0.14.9e Changelog - Capture Template Schema

## Summary

Introduced the comprehensive **Capture Template Schema** (`capture-templates.schema.json`) which validates lore capture template files including capture type classification, content constraints, quality/reward values, keyword matching, and Domain 4 compliance requirements. This schema enables full customization of discoverable content fragments and Field Guide entries—all without code changes. Supports 6 capture types (TextFragment, EchoRecording, VisualRecord, Specimen, OralHistory, RunicTrace) with AAM-VOICE Layer 2 guidelines. This is the fifth and final entry in the v0.14.9 Advanced Descriptor Configuration Schemas series.

## Added

### Schema File
- **[config/schemas/capture-templates.schema.json](config/schemas/capture-templates.schema.json)** - Comprehensive JSON Schema Draft-07

### Schema Definitions (2 Total)

| Definition | Description | Required Fields |
|------------|-------------|-----------------|
| `CaptureTemplate` | Individual capture template definition | id, type, fragmentContent, source |
| `CaptureType` | 6 capture types enum | - |

### Root Configuration Properties

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `$schema` | string | No | JSON Schema reference |
| `category` | string | **Yes** | Category identifier (kebab-case) |
| `version` | string | **Yes** | Schema version (semver) |
| `description` | string | No | Human-readable category description |
| `matchKeywords` | array | No | Default keywords for all templates |
| `templates` | array | **Yes** | Array of capture templates |

### CaptureType Enumeration (6 values)

| Type | Voice Style | Typical Sources |
|------|-------------|-----------------|
| `TextFragment` | Scholarly, formal, historical | Written records, notes, torn pages |
| `EchoRecording` | Personal, urgent, corrupted | Audio logs, memory recordings |
| `VisualRecord` | Descriptive, observational | Schematics, diagrams, images |
| `Specimen` | Analytical, clinical, scientific | Biological samples, tissue analysis |
| `OralHistory` | Conversational, dialectal | Dialogue fragments, rumors, traditions |
| `RunicTrace` | Mystical, precise, layered | Magical/technological trace analysis |

### Category Files (6 Examples)

| Category | Templates | Keywords | Focus |
|----------|-----------|----------|-------|
| `rusted-servitor` | 4 | servitor, automaton, machine | Mechanical encounters |
| `blighted-creature` | 3 | blight, corrupted, creature | Corruption creatures |
| `ancient-ruin` | 3 | ruin, ancient, pre-glitch | Pre-Glitch discoveries |
| `industrial-site` | 3 | industrial, forge, factory | Factory locations |
| `generic-container` | 3 | container, loot, salvage | General container loot |
| `field-guide-triggers` | 3 | guide, manual, instruction | Gameplay tutorials |

### Quality Value System

| Range | Level | Description | Legend Contribution |
|-------|-------|-------------|---------------------|
| 1-10 | Minor | Low Legend contribution | Common background flavor |
| 11-25 | Standard | Normal Legend contribution | Regular discoveries (default = 15) |
| 26-50 | Notable | Enhanced Legend contribution | Important revelations |
| 51-75 | Significant | High Legend contribution | Major story pieces |
| 76-100 | Exceptional | Maximum Legend contribution | Critical plot elements |

### Content Constraints

| Field | Constraint | Description |
|-------|------------|-------------|
| `id` | Pattern `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| `category` | Pattern `^[a-z][a-z0-9-]*$` | Lowercase kebab-case |
| `version` | Pattern `^\d+\.\d+\.\d+$` | Semver format |
| `fragmentContent` | 20-1000 characters | Lore text content |
| `source` | 5-100 characters | Discovery context |
| `quality` | 1-100 | Legend reward value |
| `matchKeywords` | minLength: 2, minItems: 1 | Codex matching keywords |

### Domain 4 Compliance

| Forbidden | Correction |
|-----------|------------|
| "95% casualties" | "nearly all perished" |
| "18.5C temperature" | "uncomfortably warm" |
| "800 meters away" | "beyond bowshot" |
| "10,000 residents" | "a thriving settlement" |
| "Emergency bypass terminal" | "the humming altar" |
| "Power core" | "the heart-stone" |
| "Database" | "the memory-well" |
| "Robot" | "automaton" or "iron-walker" |

### AAM-VOICE Layer 2 Vocabulary

| Don't Write | Write Instead |
|-------------|---------------|
| "Terminal" | "Rune-slate" or "speaking-stone" |
| "Sensor" | "Watcher-eye" |
| "Power grid" | "Life-web" |
| "Circuit" | "Rune-path" |
| "Diagnostic" | "Divination" |
| "Error message" | "Warning glyph" |
| "System failure" | "The silence" |
| "Reboot" | "Awakening" |

### Unit Tests
- **[CaptureTemplateSchemaTests.cs](tests/RuneAndRust.Infrastructure.IntegrationTests/Schemas/CaptureTemplateSchemaTests.cs)** - 49 tests
  - `CaptureTemplateSchema_LoadsAndParses_Successfully` - Schema structure validation (2 definitions)
  - `CaptureTemplateSchema_*_PassesValidation` - 6 tests for category files
  - `CaptureTemplate_*` - 5 tests for template validation
  - `CaptureType_*` - 10 tests for capture type enum validation
  - `ContentLength_*` - 4 tests for content length constraints
  - `QualityRange_*` - 5 tests for quality value validation
  - `CategoryPattern_*` - 8 tests for category pattern validation
  - `Configuration_*` - 7 tests for root configuration validation
  - `Keywords_*` - 3 tests for keyword validation

## Files Changed

| File | Change Type |
|------|-------------|
| `config/schemas/capture-templates.schema.json` | Added |
| `config/capture-templates/rusted-servitor.json` | Added |
| `config/capture-templates/blighted-creature.json` | Added |
| `config/capture-templates/ancient-ruin.json` | Added |
| `config/capture-templates/industrial-site.json` | Added |
| `config/capture-templates/generic-container.json` | Added |
| `config/capture-templates/field-guide-triggers.json` | Added |
| `tests/.../Schemas/CaptureTemplateSchemaTests.cs` | Added |
| `changelogs/v0.14.9e-changelog.md` | Added |

## Test Results

```
Test summary: total: 49, failed: 0, succeeded: 49, skipped: 0
Build succeeded with 0 errors
```

## Schema Structure

```
┌─────────────────────────────────────────────────────────────────┐
│  CAPTURE TEMPLATE COLLECTION                                    │
├─────────────────────────────────────────────────────────────────┤
│  $schema: "http://json-schema.org/draft-07/schema#"             │
│  type: object                                                   │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  ROOT PROPERTIES                                          │  │
│  │  category: "rusted-servitor"  (kebab-case)                │  │
│  │  version: "1.0.0"             (semver format)             │  │
│  │  description: "..."           (optional)                  │  │
│  │  matchKeywords: [...]         (category defaults)         │  │
│  │  templates: [...]             (capture definitions)       │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  CAPTURE TEMPLATE                                         │  │
│  │  id: "servitor-fungal-infection"  (globally unique)       │  │
│  │  type: "Specimen"                 (6 capture types)       │  │
│  │  fragmentContent: "The servo-motor shows signs..."        │  │
│  │  source: "Servitor examination"   (UI display)            │  │
│  │  matchKeywords: [...] (optional override)                 │  │
│  │  quality: 15 (1-100, default 15)                          │  │
│  │  tags: [...] (metadata, not displayed)                    │  │
│  │  domain4Notes: "..." (author notes)                       │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Keyword Inheritance Flow

```
  Category matchKeywords (default)
           │
           ├──► Template without matchKeywords → Uses category keywords
           │
           └──► Template with matchKeywords → Overrides category keywords
           
  Example:
  ═══════
  Category: ["servitor", "automaton", "machine"]
  
  Template A: (no keywords)
  → Uses: ["servitor", "automaton", "machine"]
  
  Template B: matchKeywords: ["servitor", "aesir", "rune"]
  → Uses: ["servitor", "aesir", "rune"] (override)
```

## Data Capture Acquisition Flow

```
  Player Action Triggers Capture
           │
           ▼
  ┌────────────────────────┐
  │ 1. IDENTIFY CATEGORY   │
  │ rusted-servitor, etc.  │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 2. SELECT TEMPLATE     │
  │ Random/weighted        │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 3. RESOLVE KEYWORDS    │
  │ Inheritance rules      │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 4. CREATE CAPTURE      │
  │ Add to Field Guide     │
  └───────────┬────────────┘
              │
              ▼
  ┌────────────────────────┐
  │ 5. CODEX MATCHING      │
  │ Award Legend progress  │
  └────────────────────────┘
```

## v0.14.9 Advanced Descriptor Schemas - Complete

| Version | Schema | Tests | Status |
|---------|--------|-------|--------|
| v0.14.9a | `dialogue.schema.json` | 76 ✓ | Complete |
| v0.14.9b | `ability-descriptors.schema.json` | 103 ✓ | Complete |
| v0.14.9c | `npc-descriptors.schema.json` | 113 ✓ | Complete |
| v0.14.9d | `psychological-descriptors.schema.json` | 71 ✓ | Complete |
| v0.14.9e | `capture-templates.schema.json` | 49 ✓ | **Complete** |
| **Total** | **5 schemas** | **412 tests** | **100% complete** |

## Modding Scenarios Enabled

After this implementation, modders can:
- Create custom capture template categories for new encounter types
- Define templates with any of 6 capture types
- Configure quality values (1-100) for Legend progression balance
- Set up category-level default keywords for Codex matching
- Override keywords per-template for specific Codex entries
- Add domain4Notes for compliance documentation
- Use tags for content filtering and analytics
- Follow AAM-VOICE Layer 2 vocabulary guidelines

---

*Fifth and final entry in v0.14.9 Advanced Descriptor Configuration Schemas series. v0.14.9 is now complete with 5 schemas and 412 tests.*
