# v0.0.9a Design Specification: Monster Definitions

**Version:** 0.0.9a
**Phase Name:** Monster Definitions
**Parent Version:** v0.0.9 (Monster Variety & Loot)
**Prerequisites:** v0.0.8 Complete (Experience & Leveling), v0.0.6b (AIBehavior enum)
**Estimated Tests:** ~18 unit tests

---

## 1. Overview

### 1.1 Purpose

Replace hardcoded monster factory methods with a data-driven monster definition system. Monsters are loaded from JSON configuration with stats, descriptions, behaviors, and base XP values, enabling easy content creation without code changes.

### 1.2 Scope

**In Scope:**
- `MonsterDefinition` entity loaded from JSON configuration
- `IMonsterService` interface and `MonsterService` implementation for spawning
- `config/monsters.json` with default monster types
- Five initial monster types (Goblin, Skeleton, Orc, Giant Spider, Slime)
- Monster descriptions and examine command enhancement
- Migration of existing `Monster.CreateGoblin()` to definition-based spawning
- Update `Room` to spawn monsters using `MonsterService`

**Out of Scope:**
- Damage type resistances (v0.0.9b)
- Tier system and stat multipliers (v0.0.9c)
- Monster traits and abilities (v0.0.9c)
- Loot tables and currency drops (v0.0.9d)

### 1.3 Design Goals

1. **Data-Driven**: All monster types defined in JSON, no code changes needed for new monsters
2. **Clean Architecture**: Domain definitions, application services, infrastructure loading
3. **Backward Compatible**: Existing combat system works unchanged with new monsters
4. **Extensible**: Foundation for resistances, tiers, traits, and loot in subsequent phases
5. **Testable**: All services have interfaces for mocking and unit testing

---

## 2. Data Model

### 2.1 New Entities

#### MonsterDefinition

A data-driven template for spawning monster instances.

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a monster type that can be spawned in the game world.
/// </summary>
/// <remarks>
/// Monster definitions are loaded from configuration and serve as templates
/// for creating Monster entity instances. They define base stats, behavior,
/// and display information but do not represent active monsters in combat.
/// </remarks>
public class MonsterDefinition
{
    /// <summary>
    /// Gets the unique identifier for this monster type.
    /// </summary>
    /// <example>"goblin", "skeleton", "giant_spider"</example>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Gets the display name shown in combat and room descriptions.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Gets the brief description shown in room listings.
    /// </summary>
    public string Description { get; init; } = string.Empty;

    /// <summary>
    /// Gets the detailed description shown when examining this monster.
    /// </summary>
    public string ExamineText { get; init; } = string.Empty;

    /// <summary>
    /// Gets the base maximum health before tier modifiers.
    /// </summary>
    public int BaseHealth { get; init; }

    /// <summary>
    /// Gets the base attack value before tier modifiers.
    /// </summary>
    public int BaseAttack { get; init; }

    /// <summary>
    /// Gets the base defense value before tier modifiers.
    /// </summary>
    public int BaseDefense { get; init; }

    /// <summary>
    /// Gets the base experience value awarded on defeat before tier modifiers.
    /// </summary>
    public int BaseExperienceValue { get; init; }

    /// <summary>
    /// Gets the AI behavior pattern for this monster type.
    /// </summary>
    /// <remarks>
    /// References the AIBehavior enum from v0.0.6b.
    /// Determines combat decision-making (target selection, flee threshold, etc.).
    /// </remarks>
    public AIBehavior AIBehavior { get; init; } = AIBehavior.Aggressive;

    /// <summary>
    /// Gets the categorical tags for this monster.
    /// </summary>
    /// <remarks>
    /// Tags enable grouping and filtering monsters (e.g., "undead", "beast", "humanoid").
    /// Used for abilities that affect specific creature types.
    /// </remarks>
    public IReadOnlyList<string> Tags { get; init; } = [];

    /// <summary>
    /// Gets the relative spawn weight for random monster selection.
    /// </summary>
    /// <remarks>
    /// Higher weights mean more frequent spawns in random selection.
    /// A monster with weight 100 spawns twice as often as one with weight 50.
    /// </remarks>
    public int SpawnWeight { get; init; } = 100;

    /// <summary>
    /// Gets the display sort order within monster lists.
    /// </summary>
    public int SortOrder { get; init; } = 0;

    /// <summary>
    /// Creates a validated MonsterDefinition.
    /// </summary>
    public static MonsterDefinition Create(
        string id,
        string name,
        string description,
        string examineText,
        int baseHealth,
        int baseAttack,
        int baseDefense,
        int baseExperienceValue,
        AIBehavior aiBehavior = AIBehavior.Aggressive,
        IEnumerable<string>? tags = null,
        int spawnWeight = 100,
        int sortOrder = 0)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(baseHealth);
        ArgumentOutOfRangeException.ThrowIfNegative(baseAttack);
        ArgumentOutOfRangeException.ThrowIfNegative(baseDefense);
        ArgumentOutOfRangeException.ThrowIfNegative(baseExperienceValue);
        ArgumentOutOfRangeException.ThrowIfNegativeOrZero(spawnWeight);

        return new MonsterDefinition
        {
            Id = id.ToLowerInvariant(),
            Name = name,
            Description = description,
            ExamineText = examineText,
            BaseHealth = baseHealth,
            BaseAttack = baseAttack,
            BaseDefense = baseDefense,
            BaseExperienceValue = baseExperienceValue,
            AIBehavior = aiBehavior,
            Tags = tags?.Select(t => t.ToLowerInvariant()).ToList() ?? [],
            SpawnWeight = spawnWeight,
            SortOrder = sortOrder
        };
    }
}
```

### 2.2 Modified Entities

#### Monster

Add reference to the source definition.

**File:** `src/Core/RuneAndRust.Domain/Entities/Monster.cs`

**Changes:**

```csharp
// ADD: New property after Description
/// <summary>
/// Gets the ID of the MonsterDefinition this monster was spawned from.
/// </summary>
/// <remarks>
/// Used to look up the original definition for examine text, tags, etc.
/// Null for legacy monsters created without definitions.
/// </remarks>
public string? DefinitionId { get; private set; }

/// <summary>
/// Gets the experience value awarded when this monster is defeated.
/// </summary>
/// <remarks>
/// Base value from definition, may be modified by tier in v0.0.9c.
/// </remarks>
public int ExperienceValue { get; private set; }

// ADD: New constructor overload
/// <summary>
/// Creates a monster from a MonsterDefinition.
/// </summary>
internal Monster(string definitionId, string name, string description,
    int maxHealth, Stats stats, int experienceValue)
{
    Id = Guid.NewGuid();
    DefinitionId = definitionId;
    Name = name ?? throw new ArgumentNullException(nameof(name));
    Description = description ?? throw new ArgumentNullException(nameof(description));
    MaxHealth = maxHealth > 0 ? maxHealth : throw new ArgumentOutOfRangeException(nameof(maxHealth));
    Health = maxHealth;
    Stats = stats;
    ExperienceValue = experienceValue;
}

// DEPRECATE (mark obsolete, remove in future version):
/// <summary>
/// Factory method to create a basic goblin enemy.
/// </summary>
/// <returns>A new goblin monster.</returns>
/// <remarks>
/// Deprecated: Use IMonsterService.SpawnMonster("goblin") instead.
/// </remarks>
[Obsolete("Use IMonsterService.SpawnMonster(\"goblin\") instead. Will be removed in v0.1.0.")]
public static Monster CreateGoblin() => new(
    "Goblin",
    "A small, green creature with sharp teeth and beady eyes. It looks hostile.",
    30,
    new Stats(30, 8, 2)
);
```

---

## 3. Service Interfaces

### 3.1 IMonsterService

**File:** `src/Core/RuneAndRust.Application/Interfaces/IMonsterService.cs`

```csharp
using RuneAndRust.Domain.Definitions;
using RuneAndRust.Domain.Entities;

namespace RuneAndRust.Application.Interfaces;

/// <summary>
/// Service for managing monster definitions and spawning monster instances.
/// </summary>
public interface IMonsterService
{
    /// <summary>
    /// Gets a monster definition by its ID.
    /// </summary>
    /// <param name="definitionId">The unique identifier of the monster definition.</param>
    /// <returns>The monster definition, or null if not found.</returns>
    MonsterDefinition? GetDefinition(string definitionId);

    /// <summary>
    /// Gets all available monster definitions.
    /// </summary>
    /// <returns>Read-only list of all monster definitions.</returns>
    IReadOnlyList<MonsterDefinition> GetAllDefinitions();

    /// <summary>
    /// Gets all monster definitions with a specific tag.
    /// </summary>
    /// <param name="tag">The tag to filter by (e.g., "undead", "beast").</param>
    /// <returns>Read-only list of matching monster definitions.</returns>
    IReadOnlyList<MonsterDefinition> GetDefinitionsByTag(string tag);

    /// <summary>
    /// Spawns a new monster instance from a definition.
    /// </summary>
    /// <param name="definitionId">The ID of the monster definition to spawn.</param>
    /// <returns>A new Monster entity instance.</returns>
    /// <exception cref="ArgumentException">Thrown when the definition ID is not found.</exception>
    Monster SpawnMonster(string definitionId);

    /// <summary>
    /// Spawns a random monster using weighted selection.
    /// </summary>
    /// <returns>A new Monster entity instance.</returns>
    /// <exception cref="InvalidOperationException">Thrown when no monster definitions are available.</exception>
    Monster SpawnRandomMonster();

    /// <summary>
    /// Spawns a random monster from definitions matching a specific tag.
    /// </summary>
    /// <param name="tag">The tag to filter by.</param>
    /// <returns>A new Monster entity instance.</returns>
    /// <exception cref="InvalidOperationException">Thrown when no matching definitions are found.</exception>
    Monster SpawnRandomMonsterByTag(string tag);
}
```

### 3.2 IGameConfigurationProvider Updates

**File:** `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`

**Add to interface:**

```csharp
/// <summary>
/// Gets all monster definitions.
/// </summary>
/// <returns>Read-only list of monster definitions.</returns>
IReadOnlyList<MonsterDefinition> GetMonsters();

/// <summary>
/// Gets a monster definition by ID.
/// </summary>
/// <param name="monsterId">The monster identifier.</param>
/// <returns>The monster definition or null if not found.</returns>
MonsterDefinition? GetMonsterById(string monsterId);
```

---

## 4. Service Implementation

### 4.1 MonsterService

**File:** `src/Core/RuneAndRust.Application/Services/MonsterService.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Domain.Definitions;
using RuneAndRust.Domain.Entities;
using RuneAndRust.Domain.ValueObjects;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Service for spawning monsters from configuration-driven definitions.
/// </summary>
public class MonsterService : IMonsterService
{
    private readonly IGameConfigurationProvider _configProvider;
    private readonly Random _random;

    /// <summary>
    /// Creates a new MonsterService.
    /// </summary>
    /// <param name="configProvider">The game configuration provider.</param>
    public MonsterService(IGameConfigurationProvider configProvider)
    {
        _configProvider = configProvider ?? throw new ArgumentNullException(nameof(configProvider));
        _random = new Random();
    }

    /// <summary>
    /// Creates a MonsterService with a specific random instance for testing.
    /// </summary>
    internal MonsterService(IGameConfigurationProvider configProvider, Random random)
    {
        _configProvider = configProvider ?? throw new ArgumentNullException(nameof(configProvider));
        _random = random ?? throw new ArgumentNullException(nameof(random));
    }

    /// <inheritdoc />
    public MonsterDefinition? GetDefinition(string definitionId)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(definitionId);
        return _configProvider.GetMonsterById(definitionId.ToLowerInvariant());
    }

    /// <inheritdoc />
    public IReadOnlyList<MonsterDefinition> GetAllDefinitions()
    {
        return _configProvider.GetMonsters();
    }

    /// <inheritdoc />
    public IReadOnlyList<MonsterDefinition> GetDefinitionsByTag(string tag)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(tag);
        var normalizedTag = tag.ToLowerInvariant();
        return _configProvider.GetMonsters()
            .Where(m => m.Tags.Contains(normalizedTag))
            .ToList();
    }

    /// <inheritdoc />
    public Monster SpawnMonster(string definitionId)
    {
        var definition = GetDefinition(definitionId)
            ?? throw new ArgumentException($"Monster definition '{definitionId}' not found.", nameof(definitionId));

        return CreateMonsterFromDefinition(definition);
    }

    /// <inheritdoc />
    public Monster SpawnRandomMonster()
    {
        var definitions = GetAllDefinitions();
        if (definitions.Count == 0)
            throw new InvalidOperationException("No monster definitions available.");

        var definition = SelectWeightedRandom(definitions);
        return CreateMonsterFromDefinition(definition);
    }

    /// <inheritdoc />
    public Monster SpawnRandomMonsterByTag(string tag)
    {
        var definitions = GetDefinitionsByTag(tag);
        if (definitions.Count == 0)
            throw new InvalidOperationException($"No monster definitions found with tag '{tag}'.");

        var definition = SelectWeightedRandom(definitions);
        return CreateMonsterFromDefinition(definition);
    }

    private Monster CreateMonsterFromDefinition(MonsterDefinition definition)
    {
        var stats = new Stats(definition.BaseHealth, definition.BaseAttack, definition.BaseDefense);

        return new Monster(
            definition.Id,
            definition.Name,
            definition.Description,
            definition.BaseHealth,
            stats,
            definition.BaseExperienceValue
        );
    }

    private MonsterDefinition SelectWeightedRandom(IReadOnlyList<MonsterDefinition> definitions)
    {
        var totalWeight = definitions.Sum(d => d.SpawnWeight);
        var roll = _random.Next(totalWeight);

        var currentWeight = 0;
        foreach (var definition in definitions)
        {
            currentWeight += definition.SpawnWeight;
            if (roll < currentWeight)
                return definition;
        }

        // Fallback (should never reach here)
        return definitions[^1];
    }
}
```

---

## 5. Configuration

### 5.1 JSON Schema

**File:** `config/monsters.json`

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "monsters": [
    {
      "id": "goblin",
      "name": "Goblin",
      "description": "A small, green creature with sharp teeth and beady eyes. It looks hostile.",
      "examineText": "This goblin clutches a rusty dagger and eyes you with malicious intent. Its green skin is mottled and covered in grime, and it chatters angrily in its crude language.",
      "baseHealth": 30,
      "baseAttack": 8,
      "baseDefense": 2,
      "baseExperienceValue": 25,
      "aiBehavior": "Aggressive",
      "tags": ["humanoid"],
      "spawnWeight": 100,
      "sortOrder": 1
    },
    {
      "id": "skeleton",
      "name": "Skeleton",
      "description": "An animated pile of bones held together by dark magic.",
      "examineText": "Dark magic holds these bones together in a mockery of life. Its hollow eye sockets glow with an eerie blue light, and it moves with an unsettling, jerky gait.",
      "baseHealth": 25,
      "baseAttack": 10,
      "baseDefense": 1,
      "baseExperienceValue": 30,
      "aiBehavior": "Aggressive",
      "tags": ["undead"],
      "spawnWeight": 80,
      "sortOrder": 2
    },
    {
      "id": "orc",
      "name": "Orc",
      "description": "A hulking, brutish warrior with green skin and tusks.",
      "examineText": "This orc towers over you, muscles rippling beneath scarred green skin. Its yellowed tusks protrude from a jaw set in a permanent snarl, and it carries a crude but deadly weapon.",
      "baseHealth": 50,
      "baseAttack": 12,
      "baseDefense": 4,
      "baseExperienceValue": 50,
      "aiBehavior": "Aggressive",
      "tags": ["humanoid"],
      "spawnWeight": 50,
      "sortOrder": 3
    },
    {
      "id": "giant_spider",
      "name": "Giant Spider",
      "description": "A horse-sized spider with glistening fangs dripping venom.",
      "examineText": "Eight multi-faceted eyes gleam in the darkness as this enormous arachnid shifts on its hairy legs. Webbing trails from its spinnerets, and its fangs glisten with a viscous, greenish venom.",
      "baseHealth": 20,
      "baseAttack": 6,
      "baseDefense": 1,
      "baseExperienceValue": 20,
      "aiBehavior": "Defensive",
      "tags": ["beast"],
      "spawnWeight": 60,
      "sortOrder": 4
    },
    {
      "id": "slime",
      "name": "Slime",
      "description": "A quivering mass of translucent, acidic gel.",
      "examineText": "This gelatinous creature pulses and wobbles as it moves, leaving a trail of acidic residue. Within its semi-transparent body, you can see the partially dissolved remains of its previous victims.",
      "baseHealth": 40,
      "baseAttack": 4,
      "baseDefense": 0,
      "baseExperienceValue": 15,
      "aiBehavior": "Chaotic",
      "tags": ["ooze"],
      "spawnWeight": 40,
      "sortOrder": 5
    }
  ]
}
```

### 5.2 Configuration DTO

**File:** `src/Core/RuneAndRust.Application/Configuration/MonsterConfigurationDto.cs`

```csharp
using System.Text.Json.Serialization;

namespace RuneAndRust.Application.Configuration;

/// <summary>
/// Root configuration object for monsters.json.
/// </summary>
public class MonsterConfiguration
{
    [JsonPropertyName("monsters")]
    public List<MonsterDefinitionDto> Monsters { get; set; } = [];
}

/// <summary>
/// DTO for deserializing monster definitions from JSON.
/// </summary>
public class MonsterDefinitionDto
{
    [JsonPropertyName("id")]
    public string Id { get; set; } = string.Empty;

    [JsonPropertyName("name")]
    public string Name { get; set; } = string.Empty;

    [JsonPropertyName("description")]
    public string Description { get; set; } = string.Empty;

    [JsonPropertyName("examineText")]
    public string ExamineText { get; set; } = string.Empty;

    [JsonPropertyName("baseHealth")]
    public int BaseHealth { get; set; }

    [JsonPropertyName("baseAttack")]
    public int BaseAttack { get; set; }

    [JsonPropertyName("baseDefense")]
    public int BaseDefense { get; set; }

    [JsonPropertyName("baseExperienceValue")]
    public int BaseExperienceValue { get; set; }

    [JsonPropertyName("aiBehavior")]
    public string AIBehavior { get; set; } = "Aggressive";

    [JsonPropertyName("tags")]
    public List<string> Tags { get; set; } = [];

    [JsonPropertyName("spawnWeight")]
    public int SpawnWeight { get; set; } = 100;

    [JsonPropertyName("sortOrder")]
    public int SortOrder { get; set; } = 0;
}
```

### 5.3 JsonConfigurationProvider Updates

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`

**Add to implementation:**

```csharp
private List<MonsterDefinition>? _monsters;

/// <inheritdoc />
public IReadOnlyList<MonsterDefinition> GetMonsters()
{
    if (_monsters == null)
    {
        var config = LoadConfiguration<MonsterConfiguration>("monsters.json");
        _monsters = config.Monsters.Select(MapToMonsterDefinition).ToList();
    }
    return _monsters;
}

/// <inheritdoc />
public MonsterDefinition? GetMonsterById(string monsterId)
{
    return GetMonsters().FirstOrDefault(m =>
        m.Id.Equals(monsterId, StringComparison.OrdinalIgnoreCase));
}

private static MonsterDefinition MapToMonsterDefinition(MonsterDefinitionDto dto)
{
    var aiBehavior = Enum.TryParse<AIBehavior>(dto.AIBehavior, ignoreCase: true, out var behavior)
        ? behavior
        : AIBehavior.Aggressive;

    return MonsterDefinition.Create(
        dto.Id,
        dto.Name,
        dto.Description,
        dto.ExamineText,
        dto.BaseHealth,
        dto.BaseAttack,
        dto.BaseDefense,
        dto.BaseExperienceValue,
        aiBehavior,
        dto.Tags,
        dto.SpawnWeight,
        dto.SortOrder
    );
}
```

---

## 6. Command Changes

### 6.1 Examine Command Enhancement

Update the examine command to handle monster examination with detailed information.

**File:** `src/Core/RuneAndRust.Application/Services/GameSessionService.cs`

**Add examine monster handling:**

```csharp
private string HandleExamineCommand(string target, GameSession session)
{
    var normalizedTarget = target.ToLowerInvariant().Trim();

    // Check if examining a monster in the room
    var monster = session.CurrentRoom.GetAliveMonsters()
        .FirstOrDefault(m => m.Name.ToLowerInvariant() == normalizedTarget ||
                            (m.DefinitionId?.Equals(normalizedTarget, StringComparison.OrdinalIgnoreCase) ?? false));

    if (monster != null)
    {
        return FormatMonsterExamination(monster);
    }

    // ... existing item/room examination logic
}

private string FormatMonsterExamination(Monster monster)
{
    var sb = new StringBuilder();
    sb.AppendLine($"=== {monster.Name} ===");

    // Get examine text from definition if available
    if (!string.IsNullOrEmpty(monster.DefinitionId))
    {
        var definition = _monsterService.GetDefinition(monster.DefinitionId);
        if (definition != null && !string.IsNullOrEmpty(definition.ExamineText))
        {
            sb.AppendLine(definition.ExamineText);
            sb.AppendLine();

            if (definition.Tags.Count > 0)
            {
                sb.AppendLine($"Type: {string.Join(", ", definition.Tags)}");
            }
        }
        else
        {
            sb.AppendLine(monster.Description);
            sb.AppendLine();
        }
    }
    else
    {
        sb.AppendLine(monster.Description);
        sb.AppendLine();
    }

    sb.AppendLine($"Health: {monster.Health}/{monster.MaxHealth}");

    return sb.ToString();
}
```

---

## 7. DTOs

### 7.1 MonsterExamineDto

**File:** `src/Core/RuneAndRust.Application/DTOs/MonsterExamineDto.cs`

```csharp
namespace RuneAndRust.Application.DTOs;

/// <summary>
/// DTO for monster examination information.
/// </summary>
public class MonsterExamineDto
{
    /// <summary>
    /// Gets the monster's display name.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Gets the detailed examination text.
    /// </summary>
    public string ExamineText { get; init; } = string.Empty;

    /// <summary>
    /// Gets the monster's current health.
    /// </summary>
    public int CurrentHealth { get; init; }

    /// <summary>
    /// Gets the monster's maximum health.
    /// </summary>
    public int MaxHealth { get; init; }

    /// <summary>
    /// Gets the monster's tags (e.g., "undead", "beast").
    /// </summary>
    public IReadOnlyList<string> Tags { get; init; } = [];

    /// <summary>
    /// Gets the monster's AI behavior type.
    /// </summary>
    public string Behavior { get; init; } = string.Empty;
}
```

---

## 8. Rendering Changes

### 8.1 Room Monster Display

Update room rendering to use definition-based information.

**Current format:**
```
Enemies:
  • Goblin - HP: 30/30
```

**New format:**
```
Enemies:
  • Goblin (humanoid) - HP: 30/30
```

**Implementation in SpectreGameRenderer:**

```csharp
private void RenderMonsters(Room room, IMonsterService monsterService)
{
    var monsters = room.GetAliveMonsters();
    if (!monsters.Any()) return;

    AnsiConsole.MarkupLine("[red]Enemies:[/]");
    foreach (var monster in monsters)
    {
        var tagsDisplay = string.Empty;
        if (!string.IsNullOrEmpty(monster.DefinitionId))
        {
            var definition = monsterService.GetDefinition(monster.DefinitionId);
            if (definition?.Tags.Count > 0)
            {
                tagsDisplay = $" ({string.Join(", ", definition.Tags)})";
            }
        }

        AnsiConsole.MarkupLine($"  • [red]{monster.Name}[/]{tagsDisplay} - HP: {monster.Health}/{monster.MaxHealth}");
    }
}
```

### 8.2 Examine Display

**Format:**
```
=== Skeleton ===
Dark magic holds these bones together in a mockery of life. Its hollow
eye sockets glow with an eerie blue light, and it moves with an
unsettling, jerky gait.

Type: undead
Health: 25/25
```

---

## 9. Integration Points

### 9.1 Room Monster Spawning

Update `Room` or `GameSessionService` to use `IMonsterService` for spawning:

```csharp
// Before (hardcoded):
room.AddMonster(Monster.CreateGoblin());

// After (definition-based):
room.AddMonster(_monsterService.SpawnMonster("goblin"));

// Or random spawn:
room.AddMonster(_monsterService.SpawnRandomMonster());
```

### 9.2 Combat Integration

No changes required to `CombatService`. The Monster entity interface remains compatible. Combat uses `Monster.Stats`, `Monster.Health`, etc. which are all populated from the definition.

### 9.3 Experience Integration

When a monster is defeated, use `Monster.ExperienceValue`:

```csharp
// In combat resolution:
if (monster.IsDefeated)
{
    var xpGained = monster.ExperienceValue;
    player.AddExperience(xpGained);
}
```

---

## 10. Default Monster Definitions

| Monster | HP | ATK | DEF | XP | Behavior | Tags | Weight |
|---------|----|----|-----|-----|----------|------|--------|
| Goblin | 30 | 8 | 2 | 25 | Aggressive | humanoid | 100 |
| Skeleton | 25 | 10 | 1 | 30 | Aggressive | undead | 80 |
| Orc | 50 | 12 | 4 | 50 | Aggressive | humanoid | 50 |
| Giant Spider | 20 | 6 | 1 | 20 | Defensive | beast | 60 |
| Slime | 40 | 4 | 0 | 15 | Chaotic | ooze | 40 |

---

## 11. Acceptance Criteria

### 11.1 Functional Requirements

- [ ] Monster definitions load successfully from `config/monsters.json`
- [ ] At least 5 default monster types are defined and loadable
- [ ] `MonsterService.SpawnMonster(id)` creates correct monster instances
- [ ] `MonsterService.SpawnRandomMonster()` uses weighted selection
- [ ] `MonsterService.GetDefinitionsByTag(tag)` filters correctly
- [ ] Examine command displays detailed monster information
- [ ] Monster tags display in room listings
- [ ] Existing combat system works with definition-based monsters
- [ ] `Monster.ExperienceValue` is populated from definition
- [ ] `Monster.DefinitionId` references the source definition

### 11.2 Non-Functional Requirements

- [ ] Configuration loading is performant (cached after first load)
- [ ] Invalid configuration produces clear error messages
- [ ] Service is testable with mock configuration provider

---

## 12. Test Specifications

### 12.1 MonsterDefinition Tests (~4 tests)

| Test Name | Description |
|-----------|-------------|
| `Create_ValidInput_ReturnsDefinition` | Valid parameters create definition |
| `Create_EmptyId_ThrowsArgumentException` | Empty ID throws |
| `Create_NegativeHealth_ThrowsArgumentOutOfRangeException` | Negative health throws |
| `Create_NormalizesIdAndTags` | ID and tags converted to lowercase |

### 12.2 MonsterService Tests (~8 tests)

| Test Name | Description |
|-----------|-------------|
| `GetDefinition_ValidId_ReturnsDefinition` | Known ID returns definition |
| `GetDefinition_InvalidId_ReturnsNull` | Unknown ID returns null |
| `GetAllDefinitions_ReturnsAllDefinitions` | Returns complete list |
| `GetDefinitionsByTag_ValidTag_ReturnsMatching` | Tag filtering works |
| `GetDefinitionsByTag_NoMatches_ReturnsEmpty` | No matches returns empty list |
| `SpawnMonster_ValidId_ReturnsMonster` | Creates monster with correct stats |
| `SpawnMonster_InvalidId_ThrowsArgumentException` | Unknown ID throws |
| `SpawnRandomMonster_UsesWeightedSelection` | Higher weights spawn more often |

### 12.3 Configuration Loading Tests (~3 tests)

| Test Name | Description |
|-----------|-------------|
| `GetMonsters_LoadsFromJson` | Configuration loads correctly |
| `GetMonsterById_ReturnsCorrectDefinition` | Lookup by ID works |
| `GetMonsters_CachesResults` | Multiple calls return same instance |

### 12.4 Integration Tests (~3 tests)

| Test Name | Description |
|-----------|-------------|
| `ExamineMonster_DisplaysDetailedInfo` | Examine command shows examine text |
| `SpawnedMonster_HasCorrectExperienceValue` | XP value from definition |
| `CombatWithDefinitionMonster_WorksCorrectly` | Combat unchanged |

---

## 13. Dependencies

### 13.1 Required Prior Work

| Dependency | Version | Status | Notes |
|------------|---------|--------|-------|
| AIBehavior enum | v0.0.6b | Required | Used for monster behavior |
| Configuration system | v0.0.3 | Complete | JSON loading infrastructure |
| Monster entity | v0.0.1 | Complete | Base entity to extend |
| Combat system | v0.0.5 | Complete | Uses Monster interface |

### 13.2 External Dependencies

None new - uses existing System.Text.Json for configuration loading.

---

## 14. Files Summary

### 14.1 New Files

| File | Purpose |
|------|---------|
| `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs` | Monster template entity |
| `src/Core/RuneAndRust.Application/Interfaces/IMonsterService.cs` | Monster service interface |
| `src/Core/RuneAndRust.Application/Services/MonsterService.cs` | Monster service implementation |
| `src/Core/RuneAndRust.Application/Configuration/MonsterConfigurationDto.cs` | JSON deserialization DTOs |
| `src/Core/RuneAndRust.Application/DTOs/MonsterExamineDto.cs` | Examine output DTO |
| `config/monsters.json` | Monster definitions |
| `tests/RuneAndRust.Domain.Tests/Definitions/MonsterDefinitionTests.cs` | Definition unit tests |
| `tests/RuneAndRust.Application.Tests/Services/MonsterServiceTests.cs` | Service unit tests |

### 14.2 Modified Files

| File | Changes |
|------|---------|
| `Monster.cs` | Add DefinitionId, ExperienceValue, new constructor |
| `IGameConfigurationProvider.cs` | Add GetMonsters, GetMonsterById |
| `JsonConfigurationProvider.cs` | Implement monster loading |
| `GameSessionService.cs` | Update examine command, inject IMonsterService |
| `SpectreGameRenderer.cs` | Update monster display with tags |

---

## 15. Future Considerations

### 15.1 v0.0.9b Preparation

The `MonsterDefinition` entity will be extended with:
- `BaseResistances: DamageResistances` - damage type resistances

### 15.2 v0.0.9c Preparation

The `MonsterDefinition` entity will be extended with:
- `PossibleTiers: IReadOnlyList<string>` - valid tiers for this monster
- `PossibleTraits: IReadOnlyList<string>` - possible traits
- `NameGenerator: NameGeneratorConfig?` - for named monsters

### 15.3 v0.0.9d Preparation

The `MonsterDefinition` entity will be extended with:
- `LootTableId: string?` - reference to loot table

---

*This design specification provides a complete foundation for data-driven monster definitions, enabling easy content expansion without code changes.*
