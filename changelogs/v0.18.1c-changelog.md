# Changelog: v0.18.1c - ICorruptionService Interface

**Release Date:** 2026-02-01
**Phase:** Runic Blight Corruption (3/5)
**Status:** Complete

---

## Overview

Implements the `ICorruptionService` interface — the Application Layer service contract for all Runic Blight Corruption management operations. This is the third phase of v0.18.1 (Runic Blight Corruption), establishing the **Service Contract Pattern** that parallels `IStressService` from v0.18.0c.

The interface defines 9 methods across three categories: 5 query methods for reading corruption state and derived penalties, 3 command methods for adding, transferring, and removing corruption, and 1 terminal method for performing Terminal Error survival checks.

Additionally creates two prerequisite value objects (`CorruptionTransferResult`, `CorruptionSkillModifiers`) that are referenced as return types by the interface. These were listed in the design specification as v0.18.1d deliverables, but are required for the interface to compile — following the same pattern as v0.18.1b creating `CorruptionSource` that was listed as a v0.18.1a dependency.

---

## Added

### Domain Layer — Value Objects

- **`CorruptionTransferResult`** (`Domain/ValueObjects/CorruptionTransferResult.cs`)
    - `readonly record struct` with private constructor and `Create` factory method
    - Properties: Success, AmountTransferred, SourceNewCorruption, TargetNewCorruption, TargetTerminalError
    - Captures the complete outcome of Blot-Priest corruption transfer between two characters
    - Custom ToString with transfer outcome, amount moved, both corruption values, and Terminal Error warning
    - Comprehensive XML documentation with `<summary>`, `<remarks>`, `<value>`, `<example>`, `<seealso>` tags

- **`CorruptionSkillModifiers`** (`Domain/ValueObjects/CorruptionSkillModifiers.cs`)
    - `readonly record struct` with private constructor and `Create` factory method
    - Properties: TechBonus, SocialPenalty, FactionLocked
    - Arrow property: HasModifiers (true when any modifier is active)
    - Static property: None (zero modifiers for uncorrupted characters)
    - Stage-based modifier composite: Uncorrupted (0/0/false), Tainted (+1/-1/false), Infected+ (+2/-2/true)
    - Custom ToString with modifier display or "No modifiers" for uncorrupted
    - Comprehensive XML documentation with stage table in `<list type="table">`

### Application Layer — Interface

- **`ICorruptionService`** (`Application/Interfaces/ICorruptionService.cs`)
    - Box comment header with `═══` separators matching IStressService pattern (Version: 0.18.1c)
    - File-scoped namespace: `RuneAndRust.Application.Interfaces`
    - Using statements: Application.Exceptions, Domain.Enums, Domain.ValueObjects
    - Interface-level XML documentation with `<summary>`, `<remarks>` (Overview, Responsibilities, Mechanics, Resource Penalties, Consumers), `<example>`, `<seealso>`
    - Corruption mechanics table with all 6 stages and their effects
    - Resource penalty formulas documented (HP, AP, Resolve)

#### Query Methods (5)

| Method | Returns | Description |
| --- | --- | --- |
| `GetCorruptionState(Guid)` | `CorruptionState` | Read current corruption snapshot |
| `GetMaxHpPenaltyPercent(Guid)` | `int` | HP penalty (0-50%) via floor(corruption/10)*5 |
| `GetMaxApPenaltyPercent(Guid)` | `int` | AP penalty (0-50%) via floor(corruption/10)*5 |
| `GetResolveDicePenalty(Guid)` | `int` | Resolve dice penalty (0-5) via floor(corruption/20) |
| `GetSkillModifiers(Guid)` | `CorruptionSkillModifiers` | Stage-based tech bonus, social penalty, faction lock |

#### Command Methods (3)

| Method | Returns | Description |
| --- | --- | --- |
| `AddCorruption(Guid, int, CorruptionSource)` | `CorruptionAddResult` | Add corruption with threshold/stage tracking |
| `TransferCorruption(Guid, Guid, int)` | `CorruptionTransferResult` | Blot-Priest corruption transfer between characters |
| `RemoveCorruption(Guid, int, string)` | `bool` | Extremely rare corruption removal (narrative events) |

#### Terminal Error Methods (1)

| Method | Returns | Description |
| --- | --- | --- |
| `PerformTerminalErrorCheck(Guid)` | `TerminalErrorResult` | WILL-based survival check at corruption 100 |

### Unit Tests

- **`CorruptionTransferResultTests`** (`ValueObjects/CorruptionTransferResultTests.cs`) — 14 test methods (20 test case executions)
    - Factory — Create: successful transfer properties, Terminal Error flag, failed transfer with zero amount
    - TargetTerminalError: 3 parameterized boundary cases (99/100/50)
    - AmountTransferred: 4 parameterized amount cases (1/10/50/100)
    - ToString: successful transfer, successful with Terminal Error, failed transfer
    - Record equality: same values equal, different values not equal

- **`CorruptionSkillModifiersTests`** (`ValueObjects/CorruptionSkillModifiersTests.cs`) — 16 test methods (24 test case executions)
    - Factory — Create: all properties stored correctly
    - Factory — None: zero modifiers with no faction lock
    - HasModifiers: all-zero returns false, 5 parameterized active modifier cases
    - Stage verification: Uncorrupted, Tainted, Infected, Blighted, Corrupted stage modifiers
    - ToString: with modifiers and faction lock, with modifiers no lock, no modifiers
    - Record equality: same values equal, different values not equal, None equals Create(0,0,false)

### Glossary

- **`config/glossary.json`** — Added 3 glossary entries (sortOrder 96-98)
    - `corruption-transfer-result`: Immutable result capturing corruption transfer outcome between two characters
    - `corruption-skill-modifiers`: Immutable composite of stage-based tech bonus, social penalty, and faction lock
    - `corruption-service`: Application layer interface defining the contract for corruption management operations

---

## Changed

### Documentation

- **`docs/design/v0.18.x/v0.18.1-scope-breakdown.md`** — Checked off v0.18.1c acceptance criteria
- **`docs/design/v0.18.x/v0.18.1c-design-specification.md`** — Checked off all deliverable and acceptance criteria items

---

## Design Decisions

### CorruptionTransferResult and CorruptionSkillModifiers Created in v0.18.1c

The design specification lists `CorruptionTransferResult` and `CorruptionSkillModifiers` as "Defined in v0.18.1d (Implementation)" in the dependencies table. However, the `ICorruptionService` interface references both as return types for `TransferCorruption()` and `GetSkillModifiers()` respectively. For the interface to compile without implementation dependencies (acceptance criteria), these value objects must exist. They were created in v0.18.1c following the same pattern as v0.18.1b creating `CorruptionSource` that was listed as a v0.18.1a dependency.

### #region Directives for Section Organization

The `IStressService` interface (v0.18.0c) uses `#region` / `#endregion` blocks for organizing Query Methods, Command Methods, and Internal Methods. `ICorruptionService` follows this same pattern with three regions: Query Methods, Command Methods, and Terminal Error Methods. This differs from the domain layer convention of `═══` comment separators but matches the established Application layer interface convention.

### Box Comment Header Follows IStressService Pattern

The box comment header uses `═══` double-line separators with the file name, description, and version — matching the `IStressService.cs` header format. Other interfaces in the Application layer have varying header styles; the IStressService pattern was followed as the most recent and comprehensive example.

### HasModifiers Arrow Property on CorruptionSkillModifiers

The design specification defines `CorruptionSkillModifiers` with only three properties (TechBonus, SocialPenalty, FactionLocked). A `HasModifiers` arrow property was added following the established pattern where value objects include convenience boolean properties (e.g., `IsUncorrupted` on CorruptionState, `NowFactionLocked` on CorruptionAddResult). This enables consumers to quickly check whether any modifiers are active without inspecting each property individually.

### None Static Property on CorruptionSkillModifiers

A `None` static property was added for uncorrupted characters, following the pattern of `CorruptionState.Uncorrupted` and `StressState.Calm`. This provides a semantic factory for the common case of no modifiers and enables clean equality checks (e.g., `modifiers == CorruptionSkillModifiers.None`).

### Test Count Expansion

The design specification estimated ~0 tests for v0.18.1c (interface only). With the addition of `CorruptionTransferResult` and `CorruptionSkillModifiers` value objects, the implementation includes 30 test methods across 2 test files (44 individual test case executions). This is consistent with prior phases where value objects are thoroughly tested at the boundary conditions.

---

## Dependencies

### Prerequisites

| Type | Phase | Usage |
| --- | --- | --- |
| `CorruptionState` | v0.18.1a | Return type for `GetCorruptionState` |
| `CorruptionStage` | v0.18.1a | Referenced in interface documentation and `<seealso>` |
| `CorruptionSource` | v0.18.1b | Parameter type for `AddCorruption` |
| `CorruptionAddResult` | v0.18.1b | Return type for `AddCorruption` |
| `TerminalErrorResult` | v0.18.1b | Return type for `PerformTerminalErrorCheck` |
| `CorruptionTracker` | v0.18.1b | Referenced by value object `<seealso>` tags |
| `CharacterNotFoundException` | v0.18.0d | Exception type documented on all methods |
| `IStressService` | v0.18.0c | Pattern reference for interface structure and documentation |

### Provides to Future Phases

| Type | Phase | Usage |
| --- | --- | --- |
| `ICorruptionService` | v0.18.1d | Interface for CorruptionService implementation |
| `CorruptionTransferResult` | v0.18.1d | Return type created by CorruptionService.TransferCorruption |
| `CorruptionSkillModifiers` | v0.18.1d | Return type created by CorruptionService.GetSkillModifiers |
| `ICorruptionService` | v0.18.5 | Consumed by resource integration service |

---

## Logging Strategy

No runtime logging in v0.18.1c — `ICorruptionService` is an interface and value objects have no side effects. Logging specifications in the design specification (section 8) are for the `CorruptionService` implementation (v0.18.1d) which will log corruption state changes, threshold crossings, stage transitions, faction lock events, corruption transfers, corruption removal, and Terminal Error outcomes.

---

## Files Created

| Path | Description |
|------|-------------|
| `src/Core/RuneAndRust.Domain/ValueObjects/CorruptionTransferResult.cs` | Corruption transfer result value object |
| `src/Core/RuneAndRust.Domain/ValueObjects/CorruptionSkillModifiers.cs` | Corruption skill modifiers value object |
| `src/Core/RuneAndRust.Application/Interfaces/ICorruptionService.cs` | ICorruptionService interface (9 methods) |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CorruptionTransferResultTests.cs` | CorruptionTransferResult tests (14 methods) |
| `tests/RuneAndRust.Domain.UnitTests/ValueObjects/CorruptionSkillModifiersTests.cs` | CorruptionSkillModifiers tests (16 methods) |
| `changelogs/v0.18.1c-changelog.md` | This changelog |

## Files Modified

| Path | Description |
|------|-------------|
| `config/glossary.json` | Added 3 glossary entries (sortOrder 96-98) |
| `docs/design/v0.18.x/v0.18.1-scope-breakdown.md` | Checked off v0.18.1c acceptance criteria |
| `docs/design/v0.18.x/v0.18.1c-design-specification.md` | Checked off deliverable and acceptance criteria |

---

## Notes

- Total unit tests for v0.18.1c: 30 test methods across 2 test files (44 individual test case executions, exceeding the ~0 estimate due to prerequisite value objects)
- All 44 new test executions pass; all existing tests unaffected (0 regressions)
- Build succeeds with 0 errors, 0 warnings
- All new files follow established codebase patterns: `═══════` box comment headers and section separators for value objects, `#region` directives for the interface, file-scoped namespaces, comprehensive XML documentation with `<summary>`, `<remarks>`, `<para>`, `<list>`, `<example>`, `<seealso>`, and `<value>` tags
- Pre-existing glossary schema validation failure at term #88 remains (unrelated to v0.18.1c changes)
- The ICorruptionService interface parallels IStressService (v0.18.0c) with corruption-specific mechanics: near-permanent accumulation, Blot-Priest transfer, Terminal Error checks, and stage-based skill modifiers
- CorruptionTransferResult and CorruptionSkillModifiers value objects follow the established readonly record struct pattern with private constructors and factory methods
