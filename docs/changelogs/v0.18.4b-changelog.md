# v0.18.4b Changelog — Momentum System (Storm Blade)

**Release Date:** 2026-02-01  
**Version:** 0.18.4b

## Summary

Implements the Domain Layer Foundation for the **Momentum System** — a flow-state resource for the Storm Blade specialization that rewards sustained aggression and punishes interruption.

---

## Added

### Domain Layer — Enums

- **MomentumThreshold.cs** — 5-value enum representing momentum intensity tiers:
    - `Stationary` (0-20 momentum) — No flow state, no bonuses
    - `Moving` (21-40 momentum) — Building flow, +1 attack/defense
    - `Flowing` (41-60 momentum) — Active chain attacks, 1 bonus attack
    - `Surging` (61-80 momentum) — High momentum, reduced recovery
    - `Unstoppable` (81-100 momentum) — Maximum flow, +10% crit, 2 bonus attacks

- **MomentumSource.cs** — 4-value enum representing momentum generation sources:
    - `SuccessfulAttack` — 10 momentum per hit
    - `KillingBlow` — 20 momentum per kill
    - `ChainAttack` — 5 momentum per consecutive hit
    - `MovementAction` — floor(distance/2) momentum

### Domain Layer — Entity

- **MomentumState.cs** — Core domain entity tracking Storm Blade momentum status:
    - `Create()` factory method with threshold computation
    - `DetermineThreshold()` static method for threshold lookup
    - `BonusAttacks` — 0/0/1/1/2 scaling by threshold
    - `MovementBonus` — floor(momentum/20), ranges 0-5
    - `AttackBonus` and `DefenseBonus` — 0-4 scaling by threshold
    - `CriticalChance` — +10% only at Unstoppable
    - `ConsecutiveHits` — Tracks chain for bonus calculation
    - Constants for all threshold boundaries and decay values

### Domain Layer — Value Objects

- **MomentumGainResult.cs** — Immutable record for momentum gain transactions:
    - Tracks previous/new momentum, amount gained, source
    - Chain bonus tracking
    - Threshold change detection
    - `CappedAtMaximum` and `IsUnstoppableGain` computed properties

- **MomentumDecayResult.cs** — Immutable record for momentum decay transactions:
    - Tracks previous/new momentum, amount decayed, decay reason
    - Chain broken flag
    - Threshold change detection
    - `ZeroedOut`, `IsFullReset`, and `ExitedUnstoppable` computed properties

### Tests

- **MomentumStateTests.cs** — 71 unit tests covering:
    - Factory method creation (valid and invalid)
    - Threshold boundary tests (parameterized)
    - Bonus attack calculations (0/0/1/1/2)
    - Movement bonus calculations
    - Attack/Defense bonus scaling
    - Critical chance (+10% at Unstoppable only)
    - Edge cases (clamping, negative values, over-max)
    - Constants verification
    - ToString formatting

---

## Verification

```
dotnet build → 0 errors, 0 warnings
dotnet test MomentumStateTests → 71/71 passed
dotnet test (full suite) → 4105+ passed
```

---

## Files Added

| Path                                                                | Description                       |
| ------------------------------------------------------------------- | --------------------------------- |
| `src/Core/RuneAndRust.Domain/Enums/MomentumThreshold.cs`            | Momentum intensity threshold enum |
| `src/Core/RuneAndRust.Domain/Enums/MomentumSource.cs`               | Momentum generation source enum   |
| `src/Core/RuneAndRust.Domain/Entities/MomentumState.cs`             | Core momentum state entity        |
| `src/Core/RuneAndRust.Domain/ValueObjects/MomentumGainResult.cs`    | Momentum gain transaction record  |
| `src/Core/RuneAndRust.Domain/ValueObjects/MomentumDecayResult.cs`   | Momentum decay transaction record |
| `tests/RuneAndRust.Domain.UnitTests/Entities/MomentumStateTests.cs` | Unit tests for MomentumState      |

---

## Dependencies

- **Prerequisite:** v0.17.4 (Specialization System), v0.18.0 (Psychic Stress)
- **Related:** v0.18.4a (Rage System — Berserker)
- **Next Phase:** v0.18.4c (Coherence System) or v0.18.4d (Service Interfaces)
