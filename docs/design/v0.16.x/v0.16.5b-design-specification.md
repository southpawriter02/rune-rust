# v0.16.5b Design Specification: Special Effect System

## Document Information

| Field               | Value                                   |
| ------------------- | --------------------------------------- |
| **Version**         | v0.16.5b                                |
| **Feature**         | Special Effect System                   |
| **Status**          | Draft                                   |
| **Dependencies**    | v0.16.5a (UniqueItem, SpecialEffectIds) |
| **Estimated Tests** | 18                                      |

---

## 1. Executive Summary

Version 0.16.5b implements the special effect types that make Myth-Forged items unique. This phase establishes the `SpecialEffect` value object, `SpecialEffectType` enum (14 types), effect processing hooks, and the configuration-driven `special-effects.json` schema. These effects provide powerful unique modifiers like armor penetration, life steal, elemental damage, and passive detection abilities.

### 1.1 Feature Overview

```
v0.16.5b: Special Effect System
├── Domain Layer
│   ├── SpecialEffectType Enum (14 types)
│   │   ├── Combat Effects
│   │   │   ├── IgnoreArmor (bypass defense)
│   │   │   ├── LifeSteal (heal on damage)
│   │   │   ├── Cleave (hit adjacent)
│   │   │   ├── Phase (cannot be blocked)
│   │   │   └── Reflect (return damage)
│   │   ├── Elemental Effects
│   │   │   ├── FireDamage
│   │   │   ├── IceDamage
│   │   │   └── LightningDamage
│   │   ├── Triggered Effects
│   │   │   ├── Slow (reduce target speed)
│   │   │   └── AutoHide (enter hidden on kill)
│   │   └── Passive Effects
│   │       ├── Detection (reveal hidden/traps)
│   │       ├── CriticalBonus (increased crit)
│   │       ├── DamageReduction (flat DR)
│   │       └── FearAura (intimidate enemies)
│   ├── SpecialEffect Value Object
│   │   ├── EffectId (configuration reference)
│   │   ├── EffectType (enum value)
│   │   ├── TriggerType (when effect activates)
│   │   ├── Magnitude (effect strength)
│   │   └── Description (player-facing text)
│   └── EffectTriggerType Enum
│       ├── OnAttack     (attacking triggers)
│       ├── OnHit        (successful hit triggers)
│       ├── OnDamageDealt (after damage applied)
│       ├── OnDamageTaken (when receiving damage)
│       ├── OnKill       (defeating enemy triggers)
│       └── Passive      (always active)
└── Configuration
    ├── special-effects.json
    └── special-effects.schema.json
```

### 1.2 Goals

1. Define `SpecialEffectType` enum with all 14 effect types
2. Define `EffectTriggerType` enum for activation timing
3. Create immutable `SpecialEffect` value object with full validation
4. Establish effect processing hook interfaces (implementation deferred)
5. Create JSON configuration schema for effect definitions

### 1.3 Non-Goals (Deferred)

- Effect processing implementation (combat integration - future)
- Unique item registry (v0.16.5c)
- Drop integration (v0.16.5d)
- Visual effect presentation (v0.16.5e)

---

## 2. Architecture

### 2.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────┐
│                    CONFIGURATION LAYER                          │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                  special-effects.json                       ││
│  │  ┌─────────────────┐  ┌─────────────────┐                   ││
│  │  │ ignore-armor    │  │ life-steal      │  ...              ││
│  │  │ - type          │  │ - type          │                   ││
│  │  │ - trigger       │  │ - trigger       │                   ││
│  │  │ - magnitude     │  │ - magnitude     │                   ││
│  │  │ - description   │  │ - description   │                   ││
│  │  └─────────────────┘  └─────────────────┘                   ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      DOMAIN LAYER                               │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                  SpecialEffect (VO)                       │  │
│  │  ┌─────────────────────────────────────────────────────┐  │  │
│  │  │ EffectId: string ("ignore-armor")                   │  │  │
│  │  │ EffectType: SpecialEffectType (IgnoreArmor)         │  │  │
│  │  │ TriggerType: EffectTriggerType (OnAttack)           │  │  │
│  │  │ Magnitude: decimal (1.0 = 100%)                     │  │  │
│  │  │ DamageTypeId: string? (for elemental effects)       │  │  │
│  │  │ Description: string (player-facing text)            │  │  │
│  │  └─────────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌─────────────────────────┐  ┌─────────────────────────────┐   │
│  │ SpecialEffectType       │  │ EffectTriggerType           │   │
│  │ (Enum - 14 types)       │  │ (Enum - 6 triggers)         │   │
│  │ ┌───────────────────┐   │  │ ┌───────────────────────┐   │   │
│  │ │ None = 0          │   │  │ │ Passive = 0           │   │   │
│  │ │ IgnoreArmor = 1   │   │  │ │ OnAttack = 1          │   │   │
│  │ │ LifeSteal = 2     │   │  │ │ OnHit = 2             │   │   │
│  │ │ Cleave = 3        │   │  │ │ OnDamageDealt = 3     │   │   │
│  │ │ Phase = 4         │   │  │ │ OnDamageTaken = 4     │   │   │
│  │ │ Reflect = 5       │   │  │ │ OnKill = 5            │   │   │
│  │ │ FireDamage = 6    │   │  │ └───────────────────────┘   │   │
│  │ │ IceDamage = 7     │   │  └─────────────────────────────┘   │
│  │ │ LightningDamage=8 │   │                                    │
│  │ │ Slow = 9          │   │                                    │
│  │ │ AutoHide = 10     │   │                                    │
│  │ │ Detection = 11    │   │                                    │
│  │ │ CriticalBonus = 12│   │                                    │
│  │ │ DamageReduction=13│   │                                    │
│  │ │ FearAura = 14     │   │                                    │
│  │ └───────────────────┘   │                                    │
│  └─────────────────────────┘                                    │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 Effect Processing Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    EFFECT TRIGGER FLOW                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  COMBAT EVENT                                                   │
│       │                                                         │
│       ▼                                                         │
│  ┌──────────────────┐                                           │
│  │ Identify Trigger │                                           │
│  │ Type             │                                           │
│  └────────┬─────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │              MATCH TRIGGER TO EFFECTS                     │   │
│  ├──────────────────────────────────────────────────────────┤   │
│  │                                                          │   │
│  │  OnAttack         OnHit           OnDamageDealt          │   │
│  │  ├─IgnoreArmor    ├─FireDamage    └─LifeSteal            │   │
│  │  ├─Cleave         ├─IceDamage                            │   │
│  │  └─Phase          ├─LightningDmg                         │   │
│  │                   └─Slow                                 │   │
│  │                                                          │   │
│  │  OnDamageTaken    OnKill          Passive                │   │
│  │  └─Reflect        └─AutoHide      ├─Detection            │   │
│  │                                   ├─CriticalBonus        │   │
│  │                                   ├─DamageReduction      │   │
│  │                                   └─FearAura             │   │
│  └──────────────────────────────────────────────────────────┘   │
│           │                                                     │
│           ▼                                                     │
│  ┌──────────────────┐                                           │
│  │ Get Equipped     │                                           │
│  │ Item Effects     │                                           │
│  └────────┬─────────┘                                           │
│           │                                                     │
│           ▼                                                     │
│  ┌──────────────────┐     ┌──────────────────┐                  │
│  │ Filter by        │────►│ Apply Effect     │                  │
│  │ Trigger Type     │     │ Magnitude        │                  │
│  └──────────────────┘     └──────────────────┘                  │
│                                  │                              │
│                                  ▼                              │
│                           ┌──────────────────┐                  │
│                           │ Return Modified  │                  │
│                           │ Combat Result    │                  │
│                           └──────────────────┘                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.3 Integration with UniqueItem (v0.16.5a)

```
┌─────────────────────────────────────────────────────────────────┐
│                   INTEGRATION CONTEXT                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                    UniqueItem (v0.16.5a)                  │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │ ItemId: "shadowfang-blade"                         │  │   │
│  │  │ Name: "Shadowfang Blade"                           │  │   │
│  │  │ Stats: ItemStats { Might: 5, BonusDamage: 15 }     │  │   │
│  │  │ SpecialEffectIds: ["life-steal", "shadow-damage"]  │──┼───┤
│  │  └────────────────────────────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│                              │ references                       │
│                              ▼                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │                  SpecialEffect (v0.16.5b)                 │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │ "life-steal"                                       │  │   │
│  │  │ ├─ EffectType: LifeSteal                           │  │   │
│  │  │ ├─ TriggerType: OnDamageDealt                      │  │   │
│  │  │ ├─ Magnitude: 0.15 (15% heal)                      │  │   │
│  │  │ └─ Description: "Heals 15% of damage dealt"        │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  │  ┌────────────────────────────────────────────────────┐  │   │
│  │  │ "shadow-damage"                                    │  │   │
│  │  │ ├─ EffectType: FireDamage (shadow = dark fire)     │  │   │
│  │  │ ├─ TriggerType: OnHit                              │  │   │
│  │  │ ├─ Magnitude: 10 (bonus damage)                    │  │   │
│  │  │ ├─ DamageTypeId: "shadow"                          │  │   │
│  │  │ └─ Description: "Deals 10 shadow damage on hit"    │  │   │
│  │  └────────────────────────────────────────────────────┘  │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
│  FUTURE (Combat Integration):                                   │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │ ISpecialEffectProcessor (deferred)                       │   │
│  │ ├─ ProcessOnAttack(attacker, effects) → AttackModifiers  │   │
│  │ ├─ ProcessOnHit(attacker, target, effects) → HitEffects  │   │
│  │ ├─ ProcessOnDamage(damage, effects) → ModifiedDamage     │   │
│  │ └─ ProcessPassive(entity, effects) → PassiveModifiers    │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. Data Model

### 3.1 SpecialEffectType Enum

**Location:** `src/Core/RuneAndRust.Domain/Enums/SpecialEffectType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines the types of special effects available on Myth-Forged items.
/// Each effect has specific trigger conditions and combat implications.
/// </summary>
public enum SpecialEffectType
{
    /// <summary>No effect (default).</summary>
    None = 0,

    // ==================== Combat Effects ====================

    /// <summary>
    /// Attacks ignore target's armor/defense completely.
    /// Trigger: OnAttack
    /// </summary>
    IgnoreArmor = 1,

    /// <summary>
    /// Heals the attacker for a percentage of damage dealt.
    /// Trigger: OnDamageDealt
    /// </summary>
    LifeSteal = 2,

    /// <summary>
    /// Attack hits adjacent enemies in addition to primary target.
    /// Trigger: OnAttack
    /// </summary>
    Cleave = 3,

    /// <summary>
    /// Attack cannot be blocked or parried.
    /// Trigger: OnAttack
    /// </summary>
    Phase = 4,

    /// <summary>
    /// Returns a percentage of damage taken back to attacker.
    /// Trigger: OnDamageTaken
    /// </summary>
    Reflect = 5,

    // ==================== Elemental Effects ====================

    /// <summary>
    /// Deals additional fire damage on hit.
    /// Trigger: OnHit
    /// </summary>
    FireDamage = 6,

    /// <summary>
    /// Deals additional ice damage on hit.
    /// Trigger: OnHit
    /// </summary>
    IceDamage = 7,

    /// <summary>
    /// Deals additional lightning damage on hit.
    /// Trigger: OnHit
    /// </summary>
    LightningDamage = 8,

    // ==================== Triggered Effects ====================

    /// <summary>
    /// Reduces target's movement speed on hit.
    /// Trigger: OnHit
    /// </summary>
    Slow = 9,

    /// <summary>
    /// Automatically enters [Hidden] state after defeating an enemy.
    /// Trigger: OnKill
    /// </summary>
    AutoHide = 10,

    // ==================== Passive Effects ====================

    /// <summary>
    /// Reveals hidden enemies and traps within range.
    /// Trigger: Passive
    /// </summary>
    Detection = 11,

    /// <summary>
    /// Increases critical hit chance.
    /// Trigger: Passive
    /// </summary>
    CriticalBonus = 12,

    /// <summary>
    /// Reduces all incoming damage by a flat amount.
    /// Trigger: Passive
    /// </summary>
    DamageReduction = 13,

    /// <summary>
    /// Intimidates nearby enemies, potentially causing fear.
    /// Trigger: Passive
    /// </summary>
    FearAura = 14
}
```

### 3.2 EffectTriggerType Enum

**Location:** `src/Core/RuneAndRust.Domain/Enums/EffectTriggerType.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

/// <summary>
/// Defines when a special effect activates during combat or gameplay.
/// </summary>
public enum EffectTriggerType
{
    /// <summary>Effect is always active while item is equipped.</summary>
    Passive = 0,

    /// <summary>Triggers when initiating an attack (before hit calculation).</summary>
    OnAttack = 1,

    /// <summary>Triggers when an attack successfully hits (after hit calculation).</summary>
    OnHit = 2,

    /// <summary>Triggers after damage has been dealt to target.</summary>
    OnDamageDealt = 3,

    /// <summary>Triggers when the wearer receives damage.</summary>
    OnDamageTaken = 4,

    /// <summary>Triggers when the wearer defeats an enemy.</summary>
    OnKill = 5
}
```

### 3.3 SpecialEffect Value Object

**Location:** `src/Core/RuneAndRust.Domain/ValueObjects/SpecialEffect.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

using RuneAndRust.Domain.Enums;

/// <summary>
/// Immutable value object representing a special effect on a Myth-Forged item.
/// Effects are defined in configuration and referenced by UniqueItem.SpecialEffectIds.
/// </summary>
public readonly record struct SpecialEffect
{
    /// <summary>Configuration identifier (e.g., "life-steal").</summary>
    public string EffectId { get; }

    /// <summary>The type of special effect.</summary>
    public SpecialEffectType EffectType { get; }

    /// <summary>When this effect triggers.</summary>
    public EffectTriggerType TriggerType { get; }

    /// <summary>
    /// Effect strength/magnitude. Interpretation varies by effect type:
    /// - Percentage effects (LifeSteal, Reflect): 0.0-1.0 (e.g., 0.15 = 15%)
    /// - Flat damage (ElementalDamage): absolute value (e.g., 10 damage)
    /// - Chance effects (CriticalBonus): 0.0-1.0 (e.g., 0.05 = 5% bonus)
    /// - Duration (Slow): seconds or turns
    /// </summary>
    public decimal Magnitude { get; }

    /// <summary>
    /// Optional damage type for elemental effects (e.g., "fire", "ice", "shadow").
    /// Only relevant for FireDamage, IceDamage, LightningDamage effects.
    /// </summary>
    public string? DamageTypeId { get; }

    /// <summary>Player-facing description of the effect.</summary>
    public string Description { get; }

    /// <summary>Empty/null effect.</summary>
    public static SpecialEffect None => new("none", SpecialEffectType.None,
        EffectTriggerType.Passive, 0m, null, "No effect");

    private SpecialEffect(
        string effectId,
        SpecialEffectType effectType,
        EffectTriggerType triggerType,
        decimal magnitude,
        string? damageTypeId,
        string description)
    {
        EffectId = effectId;
        EffectType = effectType;
        TriggerType = triggerType;
        Magnitude = magnitude;
        DamageTypeId = damageTypeId;
        Description = description;
    }

    /// <summary>
    /// Creates a new SpecialEffect with validation.
    /// </summary>
    public static SpecialEffect Create(
        string effectId,
        SpecialEffectType effectType,
        EffectTriggerType triggerType,
        decimal magnitude,
        string? damageTypeId = null,
        string? description = null)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(effectId, nameof(effectId));

        if (effectType == SpecialEffectType.None)
        {
            throw new ArgumentException(
                "Cannot create effect with None type.", nameof(effectType));
        }

        // Validate magnitude based on effect type
        ValidateMagnitude(effectType, magnitude);

        // Validate damage type for elemental effects
        ValidateDamageType(effectType, damageTypeId);

        // Validate trigger type matches expected for effect type
        ValidateTriggerType(effectType, triggerType);

        return new SpecialEffect(
            effectId.ToLowerInvariant(),
            effectType,
            triggerType,
            magnitude,
            damageTypeId?.ToLowerInvariant(),
            description ?? GenerateDefaultDescription(effectType, magnitude, damageTypeId));
    }

    /// <summary>
    /// Validates magnitude is appropriate for the effect type.
    /// </summary>
    private static void ValidateMagnitude(SpecialEffectType effectType, decimal magnitude)
    {
        switch (effectType)
        {
            // Percentage effects must be 0.0-1.0
            case SpecialEffectType.LifeSteal:
            case SpecialEffectType.Reflect:
            case SpecialEffectType.CriticalBonus:
                ArgumentOutOfRangeException.ThrowIfNegative(magnitude, nameof(magnitude));
                ArgumentOutOfRangeException.ThrowIfGreaterThan(magnitude, 1.0m, nameof(magnitude));
                break;

            // Flat values must be non-negative
            case SpecialEffectType.FireDamage:
            case SpecialEffectType.IceDamage:
            case SpecialEffectType.LightningDamage:
            case SpecialEffectType.DamageReduction:
            case SpecialEffectType.Slow:
                ArgumentOutOfRangeException.ThrowIfNegative(magnitude, nameof(magnitude));
                break;

            // Binary effects (magnitude ignored but should be 1.0)
            case SpecialEffectType.IgnoreArmor:
            case SpecialEffectType.Cleave:
            case SpecialEffectType.Phase:
            case SpecialEffectType.AutoHide:
            case SpecialEffectType.Detection:
            case SpecialEffectType.FearAura:
                // No validation needed - magnitude is informational
                break;
        }
    }

    /// <summary>
    /// Validates damage type is provided for elemental effects.
    /// </summary>
    private static void ValidateDamageType(SpecialEffectType effectType, string? damageTypeId)
    {
        var isElemental = effectType is
            SpecialEffectType.FireDamage or
            SpecialEffectType.IceDamage or
            SpecialEffectType.LightningDamage;

        if (isElemental && string.IsNullOrWhiteSpace(damageTypeId))
        {
            throw new ArgumentException(
                $"DamageTypeId is required for {effectType} effects.",
                nameof(damageTypeId));
        }
    }

    /// <summary>
    /// Validates trigger type is appropriate for the effect type.
    /// </summary>
    private static void ValidateTriggerType(SpecialEffectType effectType, EffectTriggerType triggerType)
    {
        var expectedTrigger = GetExpectedTriggerType(effectType);

        if (triggerType != expectedTrigger)
        {
            throw new ArgumentException(
                $"Effect {effectType} expects trigger {expectedTrigger}, got {triggerType}.",
                nameof(triggerType));
        }
    }

    /// <summary>
    /// Gets the expected trigger type for an effect type.
    /// </summary>
    public static EffectTriggerType GetExpectedTriggerType(SpecialEffectType effectType) =>
        effectType switch
        {
            SpecialEffectType.IgnoreArmor => EffectTriggerType.OnAttack,
            SpecialEffectType.Cleave => EffectTriggerType.OnAttack,
            SpecialEffectType.Phase => EffectTriggerType.OnAttack,

            SpecialEffectType.FireDamage => EffectTriggerType.OnHit,
            SpecialEffectType.IceDamage => EffectTriggerType.OnHit,
            SpecialEffectType.LightningDamage => EffectTriggerType.OnHit,
            SpecialEffectType.Slow => EffectTriggerType.OnHit,

            SpecialEffectType.LifeSteal => EffectTriggerType.OnDamageDealt,

            SpecialEffectType.Reflect => EffectTriggerType.OnDamageTaken,

            SpecialEffectType.AutoHide => EffectTriggerType.OnKill,

            SpecialEffectType.Detection => EffectTriggerType.Passive,
            SpecialEffectType.CriticalBonus => EffectTriggerType.Passive,
            SpecialEffectType.DamageReduction => EffectTriggerType.Passive,
            SpecialEffectType.FearAura => EffectTriggerType.Passive,

            _ => EffectTriggerType.Passive
        };

    /// <summary>
    /// Generates a default description for an effect.
    /// </summary>
    private static string GenerateDefaultDescription(
        SpecialEffectType effectType,
        decimal magnitude,
        string? damageTypeId) =>
        effectType switch
        {
            SpecialEffectType.IgnoreArmor => "Attacks ignore target's defense",
            SpecialEffectType.LifeSteal => $"Heals {magnitude:P0} of damage dealt",
            SpecialEffectType.Cleave => "Attacks hit adjacent enemies",
            SpecialEffectType.Phase => "Attacks cannot be blocked",
            SpecialEffectType.Reflect => $"Returns {magnitude:P0} of damage taken to attacker",
            SpecialEffectType.FireDamage => $"Deals {magnitude} fire damage on hit",
            SpecialEffectType.IceDamage => $"Deals {magnitude} ice damage on hit",
            SpecialEffectType.LightningDamage => $"Deals {magnitude} lightning damage on hit",
            SpecialEffectType.Slow => $"Slows target for {magnitude} seconds",
            SpecialEffectType.AutoHide => "Enter hidden state after killing an enemy",
            SpecialEffectType.Detection => "Reveals hidden enemies and traps",
            SpecialEffectType.CriticalBonus => $"+{magnitude:P0} critical hit chance",
            SpecialEffectType.DamageReduction => $"Reduces incoming damage by {magnitude}",
            SpecialEffectType.FearAura => "Intimidates nearby enemies",
            _ => "Unknown effect"
        };

    /// <summary>
    /// Checks if this effect has the specified trigger type.
    /// </summary>
    public bool HasTrigger(EffectTriggerType trigger) => TriggerType == trigger;

    /// <summary>
    /// Checks if this is a passive effect.
    /// </summary>
    public bool IsPassive => TriggerType == EffectTriggerType.Passive;

    /// <summary>
    /// Checks if this is an elemental damage effect.
    /// </summary>
    public bool IsElemental => EffectType is
        SpecialEffectType.FireDamage or
        SpecialEffectType.IceDamage or
        SpecialEffectType.LightningDamage;

    public override string ToString() =>
        $"SpecialEffect[{EffectId}: {EffectType} @ {TriggerType}, Mag:{Magnitude}]";
}
```

---

## 4. Configuration

### 4.1 special-effects.json

**Location:** `config/special-effects.json`

```json
{
    "$schema": "./special-effects.schema.json",
    "specialEffects": [
        {
            "effectId": "ignore-armor",
            "effectType": "IgnoreArmor",
            "triggerType": "OnAttack",
            "magnitude": 1.0,
            "description": "Attacks completely bypass target's defense"
        },
        {
            "effectId": "life-steal",
            "effectType": "LifeSteal",
            "triggerType": "OnDamageDealt",
            "magnitude": 0.15,
            "description": "Heals 15% of damage dealt to enemies"
        },
        {
            "effectId": "cleave",
            "effectType": "Cleave",
            "triggerType": "OnAttack",
            "magnitude": 1.0,
            "description": "Attacks hit all adjacent enemies"
        },
        {
            "effectId": "phase-strike",
            "effectType": "Phase",
            "triggerType": "OnAttack",
            "magnitude": 1.0,
            "description": "Attacks cannot be blocked or parried"
        },
        {
            "effectId": "damage-reflect",
            "effectType": "Reflect",
            "triggerType": "OnDamageTaken",
            "magnitude": 0.25,
            "description": "Returns 25% of damage taken to the attacker"
        },
        {
            "effectId": "fire-damage",
            "effectType": "FireDamage",
            "triggerType": "OnHit",
            "magnitude": 10,
            "damageTypeId": "fire",
            "description": "Deals 10 fire damage on successful hits"
        },
        {
            "effectId": "ice-damage",
            "effectType": "IceDamage",
            "triggerType": "OnHit",
            "magnitude": 8,
            "damageTypeId": "ice",
            "description": "Deals 8 ice damage on successful hits"
        },
        {
            "effectId": "lightning-damage",
            "effectType": "LightningDamage",
            "triggerType": "OnHit",
            "magnitude": 12,
            "damageTypeId": "lightning",
            "description": "Deals 12 lightning damage on successful hits"
        },
        {
            "effectId": "shadow-damage",
            "effectType": "FireDamage",
            "triggerType": "OnHit",
            "magnitude": 10,
            "damageTypeId": "shadow",
            "description": "Deals 10 shadow damage on successful hits"
        },
        {
            "effectId": "slow-strike",
            "effectType": "Slow",
            "triggerType": "OnHit",
            "magnitude": 2.0,
            "description": "Slows target for 2 seconds on hit"
        },
        {
            "effectId": "shadow-step",
            "effectType": "AutoHide",
            "triggerType": "OnKill",
            "magnitude": 1.0,
            "description": "Enter hidden state after defeating an enemy"
        },
        {
            "effectId": "true-sight",
            "effectType": "Detection",
            "triggerType": "Passive",
            "magnitude": 1.0,
            "description": "Reveals hidden enemies and traps within range"
        },
        {
            "effectId": "critical-edge",
            "effectType": "CriticalBonus",
            "triggerType": "Passive",
            "magnitude": 0.1,
            "description": "+10% critical hit chance"
        },
        {
            "effectId": "damage-reduction",
            "effectType": "DamageReduction",
            "triggerType": "Passive",
            "magnitude": 5,
            "description": "Reduces all incoming damage by 5"
        },
        {
            "effectId": "fear-aura",
            "effectType": "FearAura",
            "triggerType": "Passive",
            "magnitude": 1.0,
            "description": "Intimidates nearby enemies, potentially causing them to flee"
        }
    ]
}
```

### 4.2 special-effects.schema.json

**Location:** `config/special-effects.schema.json`

```json
{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "special-effects.schema.json",
    "title": "Special Effects Configuration",
    "description": "Schema for Myth-Forged special effect definitions",
    "type": "object",
    "required": ["specialEffects"],
    "properties": {
        "$schema": { "type": "string" },
        "specialEffects": {
            "type": "array",
            "items": { "$ref": "#/definitions/specialEffect" },
            "minItems": 1
        }
    },
    "definitions": {
        "specialEffect": {
            "type": "object",
            "required": ["effectId", "effectType", "triggerType", "magnitude"],
            "properties": {
                "effectId": {
                    "type": "string",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "description": "Unique identifier in kebab-case"
                },
                "effectType": {
                    "type": "string",
                    "enum": [
                        "IgnoreArmor",
                        "LifeSteal",
                        "Cleave",
                        "Phase",
                        "Reflect",
                        "FireDamage",
                        "IceDamage",
                        "LightningDamage",
                        "Slow",
                        "AutoHide",
                        "Detection",
                        "CriticalBonus",
                        "DamageReduction",
                        "FearAura"
                    ]
                },
                "triggerType": {
                    "type": "string",
                    "enum": [
                        "Passive",
                        "OnAttack",
                        "OnHit",
                        "OnDamageDealt",
                        "OnDamageTaken",
                        "OnKill"
                    ]
                },
                "magnitude": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Effect strength (interpretation varies by type)"
                },
                "damageTypeId": {
                    "type": "string",
                    "pattern": "^[a-z][a-z0-9-]*$",
                    "description": "Damage type for elemental effects"
                },
                "description": {
                    "type": "string",
                    "description": "Player-facing description"
                }
            }
        }
    }
}
```

---

## 5. Logging Specification

### 5.1 Log Events

| Event                     | Level   | Template                                                                    |
| ------------------------- | ------- | --------------------------------------------------------------------------- |
| SpecialEffect created     | Debug   | `"Created SpecialEffect {EffectId}: {EffectType} @ {TriggerType}"`          |
| Effect validation failed  | Warning | `"SpecialEffect validation failed for {EffectId}: {ValidationError}"`       |
| Invalid magnitude         | Warning | `"Invalid magnitude {Magnitude} for effect type {EffectType}"`              |
| Missing damage type       | Warning | `"Missing damageTypeId for elemental effect {EffectId}"`                    |
| Trigger type mismatch     | Warning | `"Trigger type mismatch for {EffectId}: expected {Expected}, got {Actual}"` |
| Effect loaded from config | Debug   | `"Loaded {Count} special effects from configuration"`                       |

---

## 6. Unit Testing

### 6.1 Test Classes

| Test Class               | Location                         | Tests |
| ------------------------ | -------------------------------- | ----- |
| `SpecialEffectTypeTests` | `Domain.UnitTests/Enums/`        | 3     |
| `EffectTriggerTypeTests` | `Domain.UnitTests/Enums/`        | 2     |
| `SpecialEffectTests`     | `Domain.UnitTests/ValueObjects/` | 13    |

### 6.2 SpecialEffectTypeTests

```csharp
[TestFixture]
public class SpecialEffectTypeTests
{
    [Test]
    public void SpecialEffectType_HasExpected14Types()
    {
        // Arrange & Act
        var types = Enum.GetValues<SpecialEffectType>();

        // Assert (14 types + None = 15)
        types.Should().HaveCount(15);
    }

    [Test]
    [TestCase(SpecialEffectType.IgnoreArmor, 1)]
    [TestCase(SpecialEffectType.LifeSteal, 2)]
    [TestCase(SpecialEffectType.FearAura, 14)]
    public void SpecialEffectType_HasCorrectValues(SpecialEffectType type, int expected)
    {
        // Assert
        ((int)type).Should().Be(expected);
    }

    [Test]
    public void SpecialEffectType_None_IsZero()
    {
        // Assert
        ((int)SpecialEffectType.None).Should().Be(0);
    }
}
```

### 6.3 EffectTriggerTypeTests

```csharp
[TestFixture]
public class EffectTriggerTypeTests
{
    [Test]
    public void EffectTriggerType_HasExpected6Types()
    {
        // Arrange & Act
        var types = Enum.GetValues<EffectTriggerType>();

        // Assert
        types.Should().HaveCount(6);
    }

    [Test]
    [TestCase(EffectTriggerType.Passive, 0)]
    [TestCase(EffectTriggerType.OnAttack, 1)]
    [TestCase(EffectTriggerType.OnKill, 5)]
    public void EffectTriggerType_HasCorrectValues(EffectTriggerType type, int expected)
    {
        // Assert
        ((int)type).Should().Be(expected);
    }
}
```

### 6.4 SpecialEffectTests

```csharp
[TestFixture]
public class SpecialEffectTests
{
    [Test]
    public void Create_WithValidData_CreatesEffect()
    {
        // Arrange & Act
        var effect = SpecialEffect.Create(
            "life-steal",
            SpecialEffectType.LifeSteal,
            EffectTriggerType.OnDamageDealt,
            0.15m,
            description: "Heals 15% damage");

        // Assert
        effect.EffectId.Should().Be("life-steal");
        effect.EffectType.Should().Be(SpecialEffectType.LifeSteal);
        effect.TriggerType.Should().Be(EffectTriggerType.OnDamageDealt);
        effect.Magnitude.Should().Be(0.15m);
    }

    [Test]
    public void Create_NormalizesEffectId()
    {
        // Arrange & Act
        var effect = SpecialEffect.Create(
            "LIFE-STEAL",
            SpecialEffectType.LifeSteal,
            EffectTriggerType.OnDamageDealt,
            0.15m);

        // Assert
        effect.EffectId.Should().Be("life-steal");
    }

    [Test]
    public void Create_WithNullEffectId_ThrowsArgumentException()
    {
        // Arrange & Act
        var act = () => SpecialEffect.Create(
            null!,
            SpecialEffectType.LifeSteal,
            EffectTriggerType.OnDamageDealt,
            0.15m);

        // Assert
        act.Should().Throw<ArgumentException>();
    }

    [Test]
    public void Create_WithNoneType_ThrowsArgumentException()
    {
        // Arrange & Act
        var act = () => SpecialEffect.Create(
            "invalid",
            SpecialEffectType.None,
            EffectTriggerType.Passive,
            0m);

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*None type*");
    }

    [Test]
    public void Create_PercentageEffect_ValidatesMagnitudeRange()
    {
        // Arrange & Act
        var act = () => SpecialEffect.Create(
            "life-steal",
            SpecialEffectType.LifeSteal,
            EffectTriggerType.OnDamageDealt,
            1.5m); // Over 100%

        // Assert
        act.Should().Throw<ArgumentOutOfRangeException>();
    }

    [Test]
    public void Create_ElementalEffect_RequiresDamageTypeId()
    {
        // Arrange & Act
        var act = () => SpecialEffect.Create(
            "fire-damage",
            SpecialEffectType.FireDamage,
            EffectTriggerType.OnHit,
            10m,
            damageTypeId: null); // Missing required damage type

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*DamageTypeId*");
    }

    [Test]
    public void Create_ElementalEffect_WithDamageType_Succeeds()
    {
        // Arrange & Act
        var effect = SpecialEffect.Create(
            "fire-damage",
            SpecialEffectType.FireDamage,
            EffectTriggerType.OnHit,
            10m,
            damageTypeId: "fire");

        // Assert
        effect.DamageTypeId.Should().Be("fire");
        effect.IsElemental.Should().BeTrue();
    }

    [Test]
    public void Create_WithWrongTriggerType_ThrowsArgumentException()
    {
        // Arrange - LifeSteal should be OnDamageDealt, not Passive
        var act = () => SpecialEffect.Create(
            "life-steal",
            SpecialEffectType.LifeSteal,
            EffectTriggerType.Passive, // Wrong trigger
            0.15m);

        // Assert
        act.Should().Throw<ArgumentException>()
            .WithMessage("*expects trigger*");
    }

    [Test]
    public void GetExpectedTriggerType_ReturnsCorrectTriggers()
    {
        // Assert
        SpecialEffect.GetExpectedTriggerType(SpecialEffectType.IgnoreArmor)
            .Should().Be(EffectTriggerType.OnAttack);
        SpecialEffect.GetExpectedTriggerType(SpecialEffectType.LifeSteal)
            .Should().Be(EffectTriggerType.OnDamageDealt);
        SpecialEffect.GetExpectedTriggerType(SpecialEffectType.Detection)
            .Should().Be(EffectTriggerType.Passive);
    }

    [Test]
    public void IsPassive_ForPassiveEffect_ReturnsTrue()
    {
        // Arrange
        var effect = SpecialEffect.Create(
            "detection",
            SpecialEffectType.Detection,
            EffectTriggerType.Passive,
            1.0m);

        // Assert
        effect.IsPassive.Should().BeTrue();
    }

    [Test]
    public void IsElemental_ForElementalEffects_ReturnsTrue()
    {
        // Arrange
        var fire = SpecialEffect.Create("fire", SpecialEffectType.FireDamage,
            EffectTriggerType.OnHit, 10m, "fire");
        var ice = SpecialEffect.Create("ice", SpecialEffectType.IceDamage,
            EffectTriggerType.OnHit, 10m, "ice");
        var lightning = SpecialEffect.Create("lightning", SpecialEffectType.LightningDamage,
            EffectTriggerType.OnHit, 10m, "lightning");
        var lifeSteal = SpecialEffect.Create("ls", SpecialEffectType.LifeSteal,
            EffectTriggerType.OnDamageDealt, 0.1m);

        // Assert
        fire.IsElemental.Should().BeTrue();
        ice.IsElemental.Should().BeTrue();
        lightning.IsElemental.Should().BeTrue();
        lifeSteal.IsElemental.Should().BeFalse();
    }

    [Test]
    public void None_ReturnsDefaultEffect()
    {
        // Arrange & Act
        var none = SpecialEffect.None;

        // Assert
        none.EffectId.Should().Be("none");
        none.EffectType.Should().Be(SpecialEffectType.None);
        none.Magnitude.Should().Be(0m);
    }

    [Test]
    public void Create_GeneratesDefaultDescription_WhenNotProvided()
    {
        // Arrange & Act
        var effect = SpecialEffect.Create(
            "life-steal",
            SpecialEffectType.LifeSteal,
            EffectTriggerType.OnDamageDealt,
            0.15m);

        // Assert
        effect.Description.Should().Contain("15%");
        effect.Description.Should().Contain("damage dealt");
    }
}
```

---

## 7. Acceptance Criteria

| #   | Criterion                                                      | Verification       |
| --- | -------------------------------------------------------------- | ------------------ |
| 1   | `SpecialEffectType` enum defines all 14 effect types plus None | Unit test          |
| 2   | `EffectTriggerType` enum defines all 6 trigger types           | Unit test          |
| 3   | `SpecialEffect` validates magnitude ranges per effect type     | Unit test          |
| 4   | Elemental effects require damage type ID                       | Unit test          |
| 5   | Effect/trigger type pairing is validated                       | Unit test          |
| 6   | IgnoreArmor effect has OnAttack trigger                        | Unit test          |
| 7   | LifeSteal effect validates percentage (0-100%)                 | Unit test          |
| 8   | JSON configuration loads 15+ example effects                   | Manual/Integration |
| 9   | JSON schema validates configuration structure                  | Schema validation  |

---

## 8. Deliverable Checklist

### 8.1 Domain Layer

- [ ] `SpecialEffectType.cs` - Enum with 14 effect types + None
- [ ] `EffectTriggerType.cs` - Enum with 6 trigger types
- [ ] `SpecialEffect.cs` - Value object with full validation

### 8.2 Configuration

- [ ] `config/special-effects.json` - 15 example effects
- [ ] `config/special-effects.schema.json` - JSON Schema

### 8.3 Tests

- [ ] `SpecialEffectTypeTests.cs` - Enum validation
- [ ] `EffectTriggerTypeTests.cs` - Enum validation
- [ ] `SpecialEffectTests.cs` - Value object tests

---

## 9. Dependencies

### 9.1 Required

| Dependency                  | Version  | Purpose               |
| --------------------------- | -------- | --------------------- |
| UniqueItem.SpecialEffectIds | v0.16.5a | References effect IDs |

### 9.2 Dependents

| Feature          | Version  | Relationship                   |
| ---------------- | -------- | ------------------------------ |
| Unique Registry  | v0.16.5c | Uses SpecialEffect for display |
| Drop Integration | v0.16.5d | Loads effects with items       |
| Presentation     | v0.16.5e | Displays effect descriptions   |

---

## 10. Future Considerations

### 10.1 Deferred to Combat Integration

- `ISpecialEffectProcessor` interface for effect execution
- Combat integration hooks (modify damage, apply effects)
- Effect stacking rules (multiple items with same effect)
- Effect priority ordering

### 10.2 Deferred to Later Versions

- Set bonus effects (when wearing multiple items from a set)
- Conditional effects (trigger under specific conditions)
- Scaling effects (magnitude scales with player level)
- Timed effects (effects that expire after duration)
