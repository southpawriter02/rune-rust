## v0.16.x - Advanced Loot & Proficiency Systems

**Focus:** Quality-tier loot generation, weapon/armor proficiencies, smart loot filtering, and equipment progression

### Overview

This version transforms the basic loot system into a comprehensive equipment progression framework. Characters gain meaningful power increases through a five-tier quality system, must manage proficiency requirements for effective equipment use, and benefit from class-appropriate "smart loot" filtering.

**Design Philosophy:**
- **Progressive Power Fantasy** - Each tier represents ~50-80% power increase
- **Class Identity** - Weapons align with archetypes (Warrior=MIGHT, Skirmisher=FINESSE)
- **Meaningful Choices** - Trade-offs in armor (mobility vs. protection) and weapons (reach vs. speed)
- **Excitement Through Rarity** - Myth-Forged items are memorable, run-defining moments

---

### Version Structure

| Version | Focus | Primary Deliverables |
|---------|-------|----------------------|
| v0.16.0 | Quality Tier System | QualityTier enum, tier-based stat scaling, drop tables |
| v0.16.1 | Weapon Proficiencies | Proficiency levels, archetype matrix, acquisition methods |
| v0.16.2 | Armor Proficiencies | Armor categories, penalties, Galdr interference |
| v0.16.3 | Smart Loot Generation | Class-appropriate filtering, weighted selection |
| v0.16.4 | Container Loot | Auto-generation for chests, biome modifiers |
| v0.16.5 | Unique Items | Myth-Forged registry, duplicate prevention, special effects |

---

### v0.16.0 - Quality Tier System

**Source:** [loot-generation.md](../../aethelgard/design/04-systems/loot-generation.md)

#### QualityTier Enum
```
QualityTier
├── JuryRigged (Tier 0) - Gray #808080 - Trash/Starter
├── Scavenged (Tier 1) - White #FFFFFF - Standard
├── ClanForged (Tier 2) - Green #00FF00 - Enhanced
├── Optimized (Tier 3) - Purple #800080 - Superior
├── MythForged (Tier 4) - Gold #FFD700 - Legendary
```

#### Stat Scaling by Tier
| Tier | Weapon Dmg | Accuracy | Armor HP | Def Bonus | Attr Bonus |
|------|------------|----------|----------|-----------|------------|
| 0 | 1d6 | -1 | +5 | +1 | None |
| 1 | 1d6+1 | 0 | +10 | +1 | None |
| 2 | 1d6+3 | 0 | +15 | +2 | +1 |
| 3 | 2d6 | +1 | +20 | +2 | +1 to +2 |
| 4 | 2d6+4 | +2 | +30 | +3 | +2 to +4 |

#### Drop Probability Tables
| Enemy Type | Tier 0 | Tier 1 | Tier 2 | Tier 3 | Tier 4 | None |
|------------|--------|--------|--------|--------|--------|------|
| Servitor | 60% | 30% | 0% | 0% | 0% | 10% |
| Drone | 0% | 40% | 40% | 20% | 0% | 0% |
| Boss | 0% | 0% | 0% | 30% | 70% | 0% |

#### Deliverables
- [ ] `QualityTier` enum with 5 tiers
- [ ] `TierStatScaling` value object
- [ ] `DropProbabilityTable` entity
- [ ] `ITierScalingService` interface
- [ ] Tier color constants for UI
- [ ] Drop table configuration loading

---

### v0.16.1 - Weapon Proficiency System

**Source:** [weap-proficiencies.md](../../aethelgard/design/resources/items/weapons/weap-proficiencies.md)

#### WeaponProficiencyLevel Enum
```
WeaponProficiencyLevel
├── NonProficient - -3 attack, -2 damage, no special properties
├── Proficient - Normal attack/damage, full special properties
├── Expert - +1 attack, unlock advanced techniques
├── Master - +2 attack, +1 damage, unlock signature techniques
```

#### WeaponCategory Enum
```
WeaponCategory
├── Axes - Hand axes, bearded axes, greataxes, throwing axes
├── Swords - Short swords, arming swords, sabers, greatswords
├── Hammers - Maces, war hammers, flails, mauls, morning stars
├── Daggers - Knives, stilettos, dirks, throwing knives
├── Polearms - Spears, javelins, halberds, pikes, atgeirs
├── Staves - Quarterstaffs, walking sticks, iron-shod staves
├── Bows - Shortbows, longbows, recurve bows, composite bows
├── Crossbows - Light crossbows, heavy crossbows, repeating
├── Shields - Bucklers, round shields, kite shields, tower shields
├── Firearms - Pistols, rifles, hand cannons (special training)
├── ArcaneImplements - Wands, orbs, foci, channeling implements
```

#### Archetype Weapon Proficiency Matrix
| Archetype | Proficient Categories |
|-----------|----------------------|
| Warrior | All weapons, all armor, shields |
| Skirmisher | Daggers, one-handed swords, one-handed axes, bows, crossbows |
| Mystic | Daggers, staves, arcane implements |
| Adept | Daggers, staves, one-handed hammers, light crossbows |

#### Proficiency Acquisition Methods
| Method | Cost | Time | Notes |
|--------|------|------|-------|
| Archetype Selection | Free | Instant | Starting proficiencies |
| Specialization | Free | Instant | Per specialization path |
| NPC Training | 50-200 PS | 1-4 weeks | One proficiency |
| Combat Experience | — | 10 combats | Using non-proficient weapon |
| Progression Point | 2 PP | Instant | One proficiency category |

#### Deliverables
- [ ] `WeaponProficiencyLevel` enum
- [ ] `WeaponCategory` enum
- [ ] `CharacterProficiencies` entity
- [ ] `ProficiencyMatrix` configuration
- [ ] `IProficiencyService` interface
- [ ] Proficiency check integration with combat
- [ ] Proficiency acquisition tracking

---

### v0.16.2 - Armor Proficiency System

**Source:** [proficiencies.md](../../aethelgard/design/resources/items/armor/proficiencies.md)

#### ArmorProficiencyLevel Enum
```
ArmorProficiencyLevel
├── NonProficient - All penalties doubled, -2 attack, no special properties
├── Proficient - Normal penalties and function
├── Expert - Penalties reduced by one tier (Heavy → Medium)
├── Master - Penalties reduced, +1 Defense, maintenance halved
```

#### ArmorCategory Enum
```
ArmorCategory
├── LightArmor - Cloth, padded, leather, hide, studded leather
├── MediumArmor - Chain mail, scale mail, ring mail, brigandine, splint
├── HeavyArmor - Half plate, full plate, fortress armor
├── Shields - Bucklers, round shields, kite shields, tower shields
├── Specialized - Servitor shell, symbiotic carapace (requires training)
```

#### Archetype Armor Proficiency Matrix
| Archetype | Proficient | Non-Proficient |
|-----------|------------|----------------|
| Warrior | Light, Medium, Heavy, Shields | None |
| Skirmisher | Light, Medium | Heavy, Tower Shields |
| Mystic | Light only | Medium, Heavy (blocks Galdr) |
| Adept | Light only | Medium, Heavy (impairs WITS) |

#### Non-Proficiency Penalties
| Situation | Normal Penalty | Non-Proficient Penalty |
|-----------|---------------|------------------------|
| Mystic in Medium | -1d10 Agility, +2 Stamina | -2d10 Agility, +4 Stamina |
| Skirmisher in Heavy | -2d10 Agility, +5 Stamina | -4d10 Agility, +10 Stamina |
| Mystic in Heavy | -2d10 Agility, +5 Stamina | Cannot cast Galdr |

#### Galdr Channeling Interference
- [ ] **Medium Armor** - -2 to all Galdr checks
- [ ] **Heavy Armor** - Cannot cast Galdr (Faraday-cage effect)

#### Proficiency Acquisition Methods
| Method | Cost | Time | Notes |
|--------|------|------|-------|
| Archetype Selection | Free | Instant | Starting proficiencies |
| Specialization | Free | Instant | Per specialization path |
| NPC Training | 100-400 PS | 2-6 weeks | One category |
| Combat Experience | — | 15 combats | Wearing non-proficient armor |
| Progression Point | 3 PP | Instant | One armor category |

#### Deliverables
- [ ] `ArmorProficiencyLevel` enum
- [ ] `ArmorCategory` enum
- [ ] Armor penalty calculation service
- [ ] Galdr interference checking
- [ ] Proficiency matrix configuration
- [ ] Non-proficiency penalty doubling logic

---

### v0.16.3 - Smart Loot Generation

**Source:** [loot-generation.md](../../aethelgard/design/04-systems/loot-generation.md)

#### Class-Appropriate Filtering
```
Smart Loot Algorithm:
  1. Roll 0-99
  2. If roll < 60: Filter for PlayerClass items
  3. If roll >= 60 OR no class items: Select from all items
  4. Apply quality tier filter
  5. Select random item from filtered pool
```

#### Equipment Slot Categories
| Slot | Categories | Attribute Scaling |
|------|------------|-------------------|
| Weapon | Axe, Greatsword, Blunt, HeavyBlunt | MIGHT |
| Weapon | Spear, Dagger, Blade, Rifle | FINESSE |
| Weapon | Staff, Focus | WILL |
| Weapon | EnergyMelee, Arc-Cannon | WITS |
| Armor | Light | FINESSE (Bonus) |
| Armor | Medium | Balanced |
| Armor | Heavy | STURDINESS (Bonus) |
| Accessory | Ring, Amulet, Tool | Varies |

#### Weighted Selection System
- [ ] Use existing `weight` property in `LootEntry`
- [ ] Implement weighted random selection
- [ ] Higher weights = more common drops
- [ ] Quality tier affects weight pool

#### Deliverables
- [ ] `ISmartLootService` interface
- [ ] Class-appropriate filtering logic (60% bias)
- [ ] Weighted item selection implementation
- [ ] Equipment category to class mapping
- [ ] Fallback to random selection

---

### v0.16.4 - Container Loot Generation

#### ContainerLootTable Entity
```
ContainerLootTable
├── ContainerId: string
├── ContainerType: ContainerType enum
├── QualityRange: (min, max) tiers
├── ItemCount: (min, max) items
├── GuaranteedItems: List<string>
├── BiomeModifiers: LootModifiers
└── IsLooted: bool
```

#### ContainerType Enum
```
ContainerType
├── SmallChest - 1-2 items, Tier 0-1
├── MediumChest - 2-4 items, Tier 1-2
├── LargeChest - 3-5 items, Tier 2-3
├── BossChest - 4-6 items, Tier 3-4, guaranteed currency
├── HiddenCache - 1-3 items, Tier 1-3, requires discovery
├── Corpse - 0-2 items, Tier 0-1
├── Locker - 1-2 items, Tier 0-2
```

#### Biome Loot Modifiers
| Modifier | Effect |
|----------|--------|
| GoldMultiplier | Scales currency drops |
| DropRateMultiplier | Affects probability |
| QualityBonus | Shifts tier distribution up |
| RareChanceBonus | Increases Tier 3-4 odds |

#### Deliverables
- [ ] `ContainerLootTable` entity
- [ ] `ContainerType` enum
- [ ] `IContainerLootService` interface
- [ ] Biome modifier application
- [ ] Container auto-generation on room load
- [ ] Looted state persistence

---

### v0.16.5 - Unique Items & Myth-Forged

#### UniqueItemRegistry Entity
```
UniqueItemRegistry
├── RunId: string
├── DroppedUniques: List<string>
├── EquippedUniques: Dictionary<string, string> (itemId → characterId)
└── Methods:
    ├── HasDropped(itemId) → bool
    ├── RegisterDrop(itemId)
    └── GetAvailableUniques(tier) → List<UniqueItem>
```

#### UniqueItem Entity
```
UniqueItem
├── ItemId: string
├── Name: string
├── Quality: QualityTier.MythForged (always)
├── SpecialEffect: string
├── EffectDescription: string
├── LoreText: string
├── DropSource: List<string> (enemy types)
└── IsOnePerRun: bool
```

#### Special Effect Types
| Effect | Description |
|--------|-------------|
| IgnoresArmor | Damage bypasses defense |
| LifeSteal | Heal on hit |
| Cleave | Hits multiple targets |
| ElementalDamage | Adds fire/ice/lightning |
| AttributeBoost | +2 to +4 attribute bonus |
| AbilityUnlock | Grants unique ability |

#### Myth-Forged Drop Logic
```
On Boss Kill:
  1. Roll for Myth-Forged (70% for boss)
  2. If Myth-Forged:
     a. Check UniqueItemRegistry
     b. Filter out already-dropped uniques
     c. Select from remaining pool
     d. Register in UniqueItemRegistry
  3. Apply special visual/audio feedback
```

#### Deliverables
- [ ] `UniqueItemRegistry` entity
- [ ] `UniqueItem` entity
- [ ] Duplicate prevention logic
- [ ] Special effect definitions
- [ ] Myth-Forged drop feedback
- [ ] Lore text integration

---

### Implementation Estimates

| Version | Focus | Entities | Services | Tests |
|---------|-------|----------|----------|-------|
| v0.16.0 | Quality Tiers | ~3 | ~2 | ~15 |
| v0.16.1 | Weapon Proficiencies | ~4 | ~2 | ~20 |
| v0.16.2 | Armor Proficiencies | ~3 | ~2 | ~15 |
| v0.16.3 | Smart Loot | ~2 | ~2 | ~15 |
| v0.16.4 | Container Loot | ~3 | ~2 | ~12 |
| v0.16.5 | Unique Items | ~3 | ~2 | ~10 |
| **Total** | | **~18** | **~12** | **~87** |

---

### Cross-Cutting Concerns

#### Combat Integration
- Proficiency checks on every attack roll
- Non-proficient penalties applied to damage
- Special properties gated by proficiency level
- Galdr blocking for Mystics in heavy armor

#### UI Feedback
- Color coding by quality tier
- Proficiency warnings on equip
- "Cannot use special properties" indicators
- Myth-Forged drop effects (gold beam, special sound)

#### Progression Integration
- Proficiency acquisition through combat experience
- PP spending for proficiency unlocks
- Specialization proficiency grants
- Attribute cap extension from equipment (+2 to +4)

---

### Dependencies

**Requires from Previous Versions:**
- v0.4.x-v0.5.x: Basic item/equipment system
- v0.10.x: Status effects (for Galdr interference)
- v0.11.x: Combat system (for proficiency integration)
- v0.15.0: Dice pool refactor (for penalty dice)

**Provides to Future Versions:**
- Equipment progression framework
- Proficiency system for specializations
- Quality tier infrastructure for crafting
- Unique item tracking for achievements

---

### Configuration Files

| File | Purpose |
|------|---------|
| `quality-tiers.json` | Tier definitions, colors, stat scaling |
| `drop-tables.json` | Enemy type probability matrices |
| `weapon-proficiencies.json` | Category definitions, archetype matrix |
| `armor-proficiencies.json` | Category definitions, penalties, Galdr rules |
| `container-loot.json` | Container type definitions |
| `unique-items.json` | Myth-Forged item definitions |
| `loot-modifiers.json` | Biome modifier definitions |

---

### Acceptance Criteria (Overall)

- [ ] QualityTier enum with 5 tiers implemented
- [ ] Stat scaling applies correctly by tier
- [ ] Drop tables use probability matrices
- [ ] Weapon proficiency levels affect attack/damage
- [ ] Non-proficient weapon penalty (-3 attack, -2 damage) applies
- [ ] Armor proficiency penalties double when non-proficient
- [ ] Mystics cannot cast Galdr in heavy armor
- [ ] Smart loot filters 60% toward player class
- [ ] Weighted selection uses weight property
- [ ] Container loot generates automatically
- [ ] Biome modifiers affect loot quality/quantity
- [ ] Unique items prevent duplicates per run
- [ ] Myth-Forged special effects function
- [ ] Color coding displays correctly
- [ ] Proficiency acquisition tracks correctly
- [ ] ~87 unit tests pass
