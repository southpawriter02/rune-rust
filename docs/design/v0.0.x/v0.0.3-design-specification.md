# v0.0.3 Design Specification: Player Creation & Identity

[v0.0.2 Changelog](../../changelogs/v0.0.3-changelog.md)

**Version:** 0.0.3
**Status:** Implemented
**Focus:** Rich player creation experience with data-driven customization foundation
**Prerequisite:** v0.0.2 (Core Game Loop Polish)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Player Creation System](#4-player-creation-system)
   - 4.1 [Player Name Validation](#41-player-name-validation)
   - 4.2 [Race Selection System](#42-race-selection-system)
   - 4.3 [Background/Lineage System](#43-backgroundlineage-system)
   - 4.4 [Point-Buy Attribute System](#44-point-buy-attribute-system)
   - 4.5 [Player Description](#45-player-description)
   - 4.6 [Character Summary Screen](#46-character-summary-screen)
5. [Save System Enhancements](#5-save-system-enhancements)
   - 5.1 [Multiple Save Slots](#51-multiple-save-slots)
   - 5.2 [Delete Save Command](#52-delete-save-command)
6. [Customization Foundation](#6-customization-foundation)
   - 6.1 [Game Terminology Configuration](#61-game-terminology-configuration)
   - 6.2 [Race Definitions](#62-race-definitions)
   - 6.3 [Attribute Definitions](#63-attribute-definitions)
7. [Terminology & Lexicon System](#7-terminology--lexicon-system)
   - 7.1 [Lexicon Configuration](#71-lexicon-configuration)
   - 7.2 [Lexicon Service](#72-lexicon-service)
   - 7.3 [Synonym Pools](#73-synonym-pools)
   - 7.4 [Context-Aware Selection](#74-context-aware-selection)
8. [Descriptor System (Text Variety Engine)](#8-descriptor-system-text-variety-engine)
   - 8.1 [Setting Aesthetic/Theme](#81-setting-aesthetictheme)
   - 8.2 [Environmental Descriptors](#82-environmental-descriptors)
   - 8.3 [Interactive Object Descriptors](#83-interactive-object-descriptors)
   - 8.4 [Puzzle Descriptors](#84-puzzle-descriptors)
   - 8.5 [Examine Descriptors](#85-examine-descriptors)
   - 8.6 [Combat Descriptors](#86-combat-descriptors)
   - 8.7 [Skill Check Descriptors](#87-skill-check-descriptors)
   - 8.8 [Ability Descriptors](#88-ability-descriptors)
   - 8.9 [Dice Result Descriptors](#89-dice-result-descriptors)
   - 8.10 [NPC Appearance Descriptors](#810-npc-appearance-descriptors)
   - 8.11 [Descriptor Weighting & Combinations](#811-descriptor-weighting--combinations)
9. [Data Model Changes](#9-data-model-changes)
10. [Configuration File Schemas](#10-configuration-file-schemas)
11. [Logging Specifications](#11-logging-specifications)
12. [Unit Testing Requirements](#12-unit-testing-requirements)
13. [Use Cases](#13-use-cases)
14. [Deliverable Checklist](#14-deliverable-checklist)
15. [Acceptance Criteria](#15-acceptance-criteria)

---

## 1. Executive Summary

Version 0.0.3 introduces **comprehensive player creation** with races, backgrounds, and point-buy attributes, along with the foundational **data-driven customization systems** that will power the entire game. This release establishes the **Terminology & Lexicon System** for configurable game language and the **Descriptor System** for rich, varied text generation.

### Key Deliverables

| Category | Items |
|----------|-------|
| **Player Creation** | Name validation, Race selection, Background/Lineage, Point-buy stats, Description, Character summary |
| **Save System** | Multiple save slots, Delete save command |
| **Customization Foundation** | Terminology config, Race definitions, Attribute definitions |
| **Lexicon System** | Configuration file, Lexicon service, Synonym pools, Context-aware selection |
| **Descriptor System** | 10 descriptor categories, Weighting system, Combination rules |
| **Tests** | ~120 new unit tests |

### Architectural Significance

This version establishes **data-driven design patterns** that will be used throughout the game:
- Configuration files define game content (not hardcoded enums)
- Services load and manage definitions at runtime
- Text generation uses pools and weighted selection
- All player-facing terminology is configurable

---

## 2. Feature Overview

```
v0.0.3 Features
├── Player Creation System
│   ├── Name Validation (length, characters)
│   ├── Race Selection (Human, Elf, Dwarf, Halfling)
│   ├── Background/Lineage (stat bonuses, abilities)
│   ├── Point-Buy Attributes (Might, Fortitude, Will, Wits, Finesse)
│   ├── Player Description (optional backstory)
│   └── Character Summary Screen
├── Save System Enhancements
│   ├── Multiple Save Slots
│   └── Delete Save Command
├── Customization Foundation
│   ├── Game Terminology Configuration
│   ├── Race Definitions (data-driven)
│   └── Attribute Definitions (configurable)
├── Terminology & Lexicon System
│   ├── Lexicon Configuration File
│   ├── Lexicon Service
│   ├── Synonym Pools
│   └── Context-Aware Selection
└── Descriptor System (Text Variety Engine)
    ├── Setting Aesthetic/Theme
    ├── Environmental Descriptors
    ├── Interactive Object Descriptors
    ├── Puzzle Descriptors
    ├── Examine Descriptors
    ├── Combat Descriptors
    ├── Skill Check Descriptors
    ├── Ability Descriptors
    ├── Dice Result Descriptors
    ├── NPC Appearance Descriptors
    └── Weighting & Combinations
```

---

## 3. Architecture Diagrams

### 3.1 Player Creation Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         PLAYER CREATION WIZARD                               │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
            ┌───────────────────────┼───────────────────────┐
            ▼                       ▼                       ▼
┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐
│  Step 1: Name     │   │  Step 2: Race     │   │  Step 3: Background│
│                   │   │                   │   │                   │
│  - Validation     │──▶│  - Load from JSON │──▶│  - Stat bonuses   │
│  - Length check   │   │  - Show modifiers │   │  - Starter ability│
│  - Char filter    │   │  - Description    │   │  - Description    │
└───────────────────┘   └───────────────────┘   └───────────────────┘
                                    │
            ┌───────────────────────┼───────────────────────┐
            ▼                       ▼                       ▼
┌───────────────────┐   ┌───────────────────┐   ┌───────────────────┐
│  Step 4: Stats    │   │  Step 5: Backstory│   │  Step 6: Summary  │
│                   │   │                   │   │                   │
│  - Point-buy      │──▶│  - Optional text  │──▶│  - Full sheet     │
│  - 5 attributes   │   │  - Max 500 chars  │   │  - Confirm/Edit   │
│  - Min/Max limits │   │                   │   │                   │
└───────────────────┘   └───────────────────┘   └───────────────────┘
                                                        │
                                                        ▼
                                            ┌───────────────────┐
                                            │  Create Player    │
                                            │  Start Game       │
                                            └───────────────────┘
```

### 3.2 Data-Driven Configuration Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          Configuration Files (JSON)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │  races.json │  │ attributes  │  │  lexicon    │  │   descriptors/      │ │
│  │             │  │   .json     │  │   .json     │  │   *.json            │ │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘ │
└─────────┼────────────────┼────────────────┼────────────────────┼────────────┘
          │                │                │                    │
          ▼                ▼                ▼                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Configuration Loading Layer                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐  │
│  │  RaceDefinition     │  │ AttributeDefinition │  │ LexiconDefinition   │  │
│  │  Loader             │  │ Loader              │  │ Loader              │  │
│  └──────────┬──────────┘  └──────────┬──────────┘  └──────────┬──────────┘  │
│             │                        │                        │             │
│             ▼                        ▼                        ▼             │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IConfigurationProvider                           │    │
│  │  - GetRaces() : IReadOnlyList<RaceDefinition>                      │    │
│  │  - GetAttributes() : IReadOnlyList<AttributeDefinition>            │    │
│  │  - GetLexicon() : LexiconConfiguration                             │    │
│  │  - GetDescriptors(category) : DescriptorPool                       │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            Application Services                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐  │
│  │  GameTerminology    │  │   LexiconService    │  │  DescriptorService  │  │
│  │  Service            │  │                     │  │                     │  │
│  │                     │  │  - GetTerm()        │  │  - Generate()       │  │
│  │  - GetDisplayName() │  │  - GetSynonym()     │  │  - Combine()        │  │
│  │  - GetDescription() │  │  - GetContext()     │  │  - GetWeighted()    │  │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Lexicon & Descriptor System Flow

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                              TEXT GENERATION REQUEST                           │
│  Example: "Player attacks goblin and deals 15 damage"                         │
└───────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│                                LexiconService                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │  1. Identify required terms: "attack", "damage"                         │  │
│  │  2. Get context: Combat, High damage                                    │  │
│  │  3. Select synonyms based on context:                                   │  │
│  │     - "attack" → ["strikes", "slashes", "swings at"] → "slashes"       │  │
│  │     - "damage" → ["wounds", "injures", "hurts"] → "wounds"             │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│                              DescriptorService                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐  │
│  │  1. Get descriptor category: Combat → Hit descriptions                  │  │
│  │  2. Apply weighting based on damage severity (15 = moderate)           │  │
│  │  3. Select from pool: "strikes true", "slashes deeply", "connects"     │  │
│  │  4. Combine with context: "...slashes deeply, wounding the goblin"     │  │
│  └─────────────────────────────────────────────────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│                               FINAL OUTPUT                                     │
│  "You slash the goblin, your blade cutting deeply. The creature staggers,     │
│   wounded by your strike. (15 damage)"                                        │
└───────────────────────────────────────────────────────────────────────────────┘
```

### 3.4 New Project Structure

```
src/
├── Core/
│   ├── RuneAndRust.Domain/
│   │   ├── Entities/
│   │   │   ├── Player.cs (modified - add RaceId, BackgroundId, Description)
│   │   │   └── ...
│   │   ├── ValueObjects/
│   │   │   ├── Stats.cs (modified - add core attributes)
│   │   │   ├── PlayerAttributes.cs (new)
│   │   │   └── ...
│   │   └── Definitions/ (new folder)
│   │       ├── RaceDefinition.cs
│   │       ├── BackgroundDefinition.cs
│   │       └── AttributeDefinition.cs
│   └── RuneAndRust.Application/
│       ├── Services/
│       │   ├── GameTerminologyService.cs (new)
│       │   ├── LexiconService.cs (new)
│       │   ├── DescriptorService.cs (new)
│       │   ├── PlayerCreationService.cs (new)
│       │   └── ...
│       ├── Configuration/
│       │   ├── LexiconConfiguration.cs (new)
│       │   ├── DescriptorConfiguration.cs (new)
│       │   └── ...
│       └── Interfaces/
│           ├── IConfigurationProvider.cs (new)
│           └── ...
├── Infrastructure/
│   └── RuneAndRust.Infrastructure/
│       └── Configuration/
│           ├── JsonConfigurationProvider.cs (new)
│           └── ConfigurationLoader.cs (new)
└── config/ (new folder at solution root)
    ├── races.json
    ├── backgrounds.json
    ├── attributes.json
    ├── lexicon.json
    ├── terminology.json
    └── descriptors/
        ├── environmental.json
        ├── combat.json
        ├── examine.json
        ├── npcs.json
        └── ...
```

---

## 4. Player Creation System

### 4.1 Player Name Validation

**Purpose:** Enforce consistent naming rules for player characters.

#### Validation Rules

| Rule | Constraint |
|------|------------|
| Minimum length | 2 characters |
| Maximum length | 30 characters |
| Allowed characters | Letters, spaces, hyphens, apostrophes |
| First character | Must be a letter |
| Consecutive spaces | Not allowed |
| Leading/trailing whitespace | Trimmed automatically |

#### Implementation

**PlayerNameValidator.cs (new file: Domain/Validation/):**
```csharp
using System.Text.RegularExpressions;

namespace RuneAndRust.Domain.Validation;

/// <summary>
/// Validates player character names according to game rules.
/// </summary>
public static partial class PlayerNameValidator
{
    private const int MinLength = 2;
    private const int MaxLength = 30;

    [GeneratedRegex(@"^[A-Za-z][A-Za-z\s\-']*$")]
    private static partial Regex ValidNamePattern();

    [GeneratedRegex(@"\s{2,}")]
    private static partial Regex ConsecutiveSpacesPattern();

    /// <summary>
    /// Validates a player name and returns the result.
    /// </summary>
    /// <param name="name">The name to validate.</param>
    /// <returns>Validation result with success status and error message if invalid.</returns>
    public static (bool IsValid, string? ErrorMessage) Validate(string? name)
    {
        if (string.IsNullOrWhiteSpace(name))
            return (false, "Name cannot be empty.");

        var trimmed = name.Trim();

        if (trimmed.Length < MinLength)
            return (false, $"Name must be at least {MinLength} characters.");

        if (trimmed.Length > MaxLength)
            return (false, $"Name cannot exceed {MaxLength} characters.");

        if (!ValidNamePattern().IsMatch(trimmed))
            return (false, "Name can only contain letters, spaces, hyphens, and apostrophes, and must start with a letter.");

        if (ConsecutiveSpacesPattern().IsMatch(trimmed))
            return (false, "Name cannot contain consecutive spaces.");

        return (true, null);
    }

    /// <summary>
    /// Normalizes a valid name (trims whitespace, normalizes internal spacing).
    /// </summary>
    /// <param name="name">The name to normalize.</param>
    /// <returns>The normalized name.</returns>
    public static string Normalize(string name)
    {
        var trimmed = name.Trim();
        return ConsecutiveSpacesPattern().Replace(trimmed, " ");
    }
}
```

#### Unit Tests
```csharp
[TestFixture]
public class PlayerNameValidatorTests
{
    [TestCase("A", false)] // Too short
    [TestCase("Ab", true)] // Minimum valid
    [TestCase("Thorin Oakenshield", true)] // Valid with space
    [TestCase("O'Brien", true)] // Valid with apostrophe
    [TestCase("Jean-Luc", true)] // Valid with hyphen
    [TestCase("1stPlayer", false)] // Starts with number
    [TestCase("Player  Name", false)] // Consecutive spaces
    [TestCase("Player@Name", false)] // Invalid character
    [TestCase("", false)] // Empty
    [TestCase("   ", false)] // Whitespace only
    public void Validate_ReturnsExpectedResult(string name, bool expectedValid)
    {
        var (isValid, _) = PlayerNameValidator.Validate(name);
        Assert.That(isValid, Is.EqualTo(expectedValid));
    }

    [Test]
    public void Validate_NameExceedsMaxLength_ReturnsFalse()
    {
        var longName = new string('A', 31);
        var (isValid, errorMessage) = PlayerNameValidator.Validate(longName);
        Assert.That(isValid, Is.False);
        Assert.That(errorMessage, Does.Contain("30"));
    }

    [Test]
    public void Normalize_TrimsWhitespace()
    {
        var result = PlayerNameValidator.Normalize("  Hero  ");
        Assert.That(result, Is.EqualTo("Hero"));
    }
}
```

---

### 4.2 Race Selection System

**Purpose:** Allow players to choose from configurable races with unique stat modifiers and descriptions.

#### Default Races

| Race | Stat Modifiers | Special Trait |
|------|---------------|---------------|
| **Human** | +1 to all attributes | Adaptable (bonus skill point per level) |
| **Elf** | +2 Finesse, +1 Wits, -1 Fortitude | Keen Senses (perception bonus) |
| **Dwarf** | +2 Fortitude, +1 Might, -1 Finesse | Stout (poison resistance) |
| **Halfling** | +2 Wits, +1 Finesse, -1 Might | Lucky (reroll natural 1s) |

#### RaceDefinition Entity

**RaceDefinition.cs (new file: Domain/Definitions/):**
```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a playable race loaded from configuration.
/// </summary>
/// <remarks>
/// Race definitions are data-driven, allowing new races to be added
/// without code changes. Each race has stat modifiers and special traits.
/// </remarks>
public class RaceDefinition
{
    /// <summary>
    /// Unique identifier for this race.
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name shown to players.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Narrative description of the race.
    /// </summary>
    public string Description { get; init; } = string.Empty;

    /// <summary>
    /// Lore and background information.
    /// </summary>
    public string Lore { get; init; } = string.Empty;

    /// <summary>
    /// Attribute modifiers applied when selecting this race.
    /// Keys are attribute IDs, values are modifier amounts.
    /// </summary>
    public IReadOnlyDictionary<string, int> AttributeModifiers { get; init; } =
        new Dictionary<string, int>();

    /// <summary>
    /// Special racial trait identifier.
    /// </summary>
    public string? TraitId { get; init; }

    /// <summary>
    /// Display name of the special trait.
    /// </summary>
    public string? TraitName { get; init; }

    /// <summary>
    /// Description of what the trait does.
    /// </summary>
    public string? TraitDescription { get; init; }

    /// <summary>
    /// Whether this race is available for player selection.
    /// </summary>
    public bool IsPlayable { get; init; } = true;

    /// <summary>
    /// Display order in selection lists (lower = earlier).
    /// </summary>
    public int SortOrder { get; init; } = 100;
}
```

#### Race Configuration File

**config/races.json:**
```json
{
  "$schema": "./schemas/races.schema.json",
  "version": "1.0",
  "races": [
    {
      "id": "human",
      "name": "Human",
      "description": "Versatile and adaptable, humans are found in every corner of the realm.",
      "lore": "Humans are the most numerous of the civilized races, known for their ambition and diversity. Their relatively short lifespans drive them to achieve greatness in whatever time they have.",
      "attributeModifiers": {
        "might": 1,
        "fortitude": 1,
        "will": 1,
        "wits": 1,
        "finesse": 1
      },
      "traitId": "adaptable",
      "traitName": "Adaptable",
      "traitDescription": "Gain one additional skill point each level.",
      "isPlayable": true,
      "sortOrder": 1
    },
    {
      "id": "elf",
      "name": "Elf",
      "description": "Graceful and long-lived, elves possess an innate connection to magic and nature.",
      "lore": "The elves are an ancient people who witnessed the dawn of civilization. Their long lives grant them patience and perspective, though some say it also breeds a certain detachment from the concerns of shorter-lived races.",
      "attributeModifiers": {
        "might": 0,
        "fortitude": -1,
        "will": 0,
        "wits": 1,
        "finesse": 2
      },
      "traitId": "keen_senses",
      "traitName": "Keen Senses",
      "traitDescription": "Bonus to perception checks and cannot be surprised.",
      "isPlayable": true,
      "sortOrder": 2
    },
    {
      "id": "dwarf",
      "name": "Dwarf",
      "description": "Stout and hardy, dwarves are master craftsmen who dwell in mountain strongholds.",
      "lore": "Dwarves are renowned throughout the realm for their craftsmanship, their love of ale, and their stubbornness. Their underground kingdoms are marvels of engineering, carved over generations.",
      "attributeModifiers": {
        "might": 1,
        "fortitude": 2,
        "will": 0,
        "wits": 0,
        "finesse": -1
      },
      "traitId": "stout",
      "traitName": "Stout Constitution",
      "traitDescription": "Resistance to poison and advantage on saves against toxins.",
      "isPlayable": true,
      "sortOrder": 3
    },
    {
      "id": "halfling",
      "name": "Halfling",
      "description": "Small in stature but big in heart, halflings are known for their luck and quick wits.",
      "lore": "Halflings prefer the simple pleasures: good food, warm hearths, and peaceful communities. Yet when adventure calls, their natural luck and nimbleness serve them surprisingly well.",
      "attributeModifiers": {
        "might": -1,
        "fortitude": 0,
        "will": 0,
        "wits": 2,
        "finesse": 1
      },
      "traitId": "lucky",
      "traitName": "Lucky",
      "traitDescription": "Once per encounter, reroll a natural 1 on any check.",
      "isPlayable": true,
      "sortOrder": 4
    }
  ]
}
```

#### UI Flow (TUI)

```
╭────────────────────── Choose Your Race ──────────────────────╮
│                                                              │
│  > Human                                                     │
│    Elf                                                       │
│    Dwarf                                                     │
│    Halfling                                                  │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│  HUMAN                                                       │
│  Versatile and adaptable, humans are found in every corner   │
│  of the realm.                                               │
│                                                              │
│  Attribute Modifiers:                                        │
│    Might +1, Fortitude +1, Will +1, Wits +1, Finesse +1     │
│                                                              │
│  Special Trait: Adaptable                                    │
│    Gain one additional skill point each level.               │
╰──────────────────────────────────────────────────────────────╯
```

---

### 4.3 Background/Lineage System

**Purpose:** Provide additional customization through backgrounds that grant stat bonuses and starting abilities based on the character's past profession or upbringing.

#### Default Backgrounds

| Background | Category | Stat Bonuses | Starter Ability | Starting Items |
|------------|----------|--------------|-----------------|----------------|
| **Soldier** | Profession | +2 Might | Shield Bash | Iron Shield |
| **Scholar** | Profession | +2 Wits | Lore Recall | Ancient Tome |
| **Thief** | Profession | +2 Finesse | Sneak Attack | Lockpicks |
| **Healer** | Profession | +2 Will | Minor Heal | Healing Herbs |
| **Mountainborn** | Lineage | +1 Fort, +1 Might | Endurance | Climbing Gear |
| **Coastlander** | Lineage | +1 Finesse, +1 Wits | Swim | Fishing Net |
| **Forestkin** | Lineage | +1 Wits, +1 Finesse | Track | Hunter's Bow |
| **Cityfolk** | Lineage | +1 Will, +1 Wits | Streetwise | City Map |

#### BackgroundDefinition Entity

**BackgroundDefinition.cs (new file: Domain/Definitions/):**
```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a player background (profession or lineage) loaded from configuration.
/// </summary>
public class BackgroundDefinition
{
    /// <summary>
    /// Unique identifier for this background.
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name shown to players.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Category of background (Profession, Lineage, etc.).
    /// </summary>
    public string Category { get; init; } = string.Empty;

    /// <summary>
    /// Brief description of the background.
    /// </summary>
    public string Description { get; init; } = string.Empty;

    /// <summary>
    /// Extended lore and narrative.
    /// </summary>
    public string Lore { get; init; } = string.Empty;

    /// <summary>
    /// Attribute bonuses from this background.
    /// </summary>
    public IReadOnlyDictionary<string, int> AttributeBonuses { get; init; } =
        new Dictionary<string, int>();

    /// <summary>
    /// Starting ability granted by this background.
    /// </summary>
    public string? StarterAbilityId { get; init; }

    /// <summary>
    /// Display name of the starter ability.
    /// </summary>
    public string? StarterAbilityName { get; init; }

    /// <summary>
    /// Description of the starter ability.
    /// </summary>
    public string? StarterAbilityDescription { get; init; }

    /// <summary>
    /// Item IDs that the player starts with.
    /// </summary>
    public IReadOnlyList<string> StartingItems { get; init; } = [];

    /// <summary>
    /// Whether this background is available for selection.
    /// </summary>
    public bool IsPlayable { get; init; } = true;

    /// <summary>
    /// Display order within category.
    /// </summary>
    public int SortOrder { get; init; } = 100;
}
```

#### Background Configuration File

**config/backgrounds.json:**
```json
{
  "$schema": "./schemas/backgrounds.schema.json",
  "version": "1.0",
  "backgrounds": [
    {
      "id": "soldier",
      "name": "Soldier",
      "category": "Profession",
      "description": "You served in an army or militia, learning the ways of combat.",
      "lore": "Years of drilling, marching, and fighting have hardened your body and mind. You've seen comrades fall and enemies routed, and you carry those experiences with you.",
      "attributeBonuses": {
        "might": 2
      },
      "starterAbilityId": "shield_bash",
      "starterAbilityName": "Shield Bash",
      "starterAbilityDescription": "Stun an enemy for one turn using your shield.",
      "startingItems": ["iron_shield"],
      "isPlayable": true,
      "sortOrder": 1
    },
    {
      "id": "scholar",
      "name": "Scholar",
      "category": "Profession",
      "description": "You spent years studying ancient texts and accumulating knowledge.",
      "lore": "The musty halls of libraries and academies were your home. You learned that knowledge is power, and you've accumulated quite a bit of both.",
      "attributeBonuses": {
        "wits": 2
      },
      "starterAbilityId": "lore_recall",
      "starterAbilityName": "Lore Recall",
      "starterAbilityDescription": "Identify items and gain insight into monster weaknesses.",
      "startingItems": ["ancient_tome"],
      "isPlayable": true,
      "sortOrder": 2
    },
    {
      "id": "mountainborn",
      "name": "Mountainborn",
      "category": "Lineage",
      "description": "You were raised in the harsh mountain peaks, building endurance.",
      "lore": "The thin air and treacherous terrain of the high peaks forged you into someone who can endure hardships that would break others.",
      "attributeBonuses": {
        "fortitude": 1,
        "might": 1
      },
      "starterAbilityId": "endurance",
      "starterAbilityName": "Endurance",
      "starterAbilityDescription": "Resist exhaustion and recover faster from exertion.",
      "startingItems": ["climbing_gear"],
      "isPlayable": true,
      "sortOrder": 10
    }
  ]
}
```

---

### 4.4 Point-Buy Attribute System

**Purpose:** Allow players to customize their starting attributes through a point-buy system.

#### Core Attributes

| Attribute | Abbreviation | Description | Primary Effects |
|-----------|--------------|-------------|-----------------|
| **Might** | MIG | Physical power and strength | Melee damage, carry capacity, breaking objects |
| **Fortitude** | FOR | Endurance and constitution | Max HP, resistance to poison/disease, stamina |
| **Will** | WIL | Mental fortitude and magic | Magic power, resistance to mind effects, focus |
| **Wits** | WIT | Intelligence and perception | Critical chance, trap detection, lore knowledge |
| **Finesse** | FIN | Agility and precision | Accuracy, dodge chance, stealth, lockpicking |

#### Point-Buy Rules

| Rule | Value |
|------|-------|
| Starting points | 25 |
| Base attribute value | 8 |
| Minimum attribute | 6 |
| Maximum attribute (before racial) | 15 |
| Maximum attribute (after racial) | 18 |
| Point cost (8-14) | 1 point per increase |
| Point cost (14-15) | 2 points per increase |

#### AttributeDefinition Entity

**AttributeDefinition.cs (new file: Domain/Definitions/):**
```csharp
namespace RuneAndRust.Domain.Definitions;

/// <summary>
/// Defines a player attribute loaded from configuration.
/// </summary>
public class AttributeDefinition
{
    /// <summary>
    /// Unique identifier (e.g., "might", "fortitude").
    /// </summary>
    public string Id { get; init; } = string.Empty;

    /// <summary>
    /// Display name shown to players.
    /// </summary>
    public string Name { get; init; } = string.Empty;

    /// <summary>
    /// Three-letter abbreviation (e.g., "MIG", "FOR").
    /// </summary>
    public string Abbreviation { get; init; } = string.Empty;

    /// <summary>
    /// Description of what this attribute affects.
    /// </summary>
    public string Description { get; init; } = string.Empty;

    /// <summary>
    /// List of primary effects this attribute influences.
    /// </summary>
    public IReadOnlyList<string> PrimaryEffects { get; init; } = [];

    /// <summary>
    /// Display order in attribute lists.
    /// </summary>
    public int SortOrder { get; init; } = 100;

    /// <summary>
    /// Associated color for UI display (hex code).
    /// </summary>
    public string Color { get; init; } = "#FFFFFF";
}
```

#### PlayerAttributes Value Object

**PlayerAttributes.cs (new file: Domain/ValueObjects/):**
```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the core attribute values for a player character.
/// </summary>
public readonly record struct PlayerAttributes
{
    /// <summary>
    /// Physical power and strength.
    /// </summary>
    public int Might { get; init; }

    /// <summary>
    /// Endurance and constitution.
    /// </summary>
    public int Fortitude { get; init; }

    /// <summary>
    /// Mental fortitude and magical power.
    /// </summary>
    public int Will { get; init; }

    /// <summary>
    /// Intelligence and perception.
    /// </summary>
    public int Wits { get; init; }

    /// <summary>
    /// Agility and precision.
    /// </summary>
    public int Finesse { get; init; }

    /// <summary>
    /// Creates attributes with specified values.
    /// </summary>
    public PlayerAttributes(int might, int fortitude, int will, int wits, int finesse)
    {
        Might = ValidateAttribute(might, nameof(might));
        Fortitude = ValidateAttribute(fortitude, nameof(fortitude));
        Will = ValidateAttribute(will, nameof(will));
        Wits = ValidateAttribute(wits, nameof(wits));
        Finesse = ValidateAttribute(finesse, nameof(finesse));
    }

    /// <summary>
    /// Gets the default starting attributes (all 8).
    /// </summary>
    public static PlayerAttributes Default => new(8, 8, 8, 8, 8);

    /// <summary>
    /// Gets an attribute value by its ID.
    /// </summary>
    public int GetByName(string attributeId) => attributeId.ToLowerInvariant() switch
    {
        "might" or "mig" => Might,
        "fortitude" or "for" => Fortitude,
        "will" or "wil" => Will,
        "wits" or "wit" => Wits,
        "finesse" or "fin" => Finesse,
        _ => throw new ArgumentException($"Unknown attribute: {attributeId}")
    };

    /// <summary>
    /// Creates new attributes with a modifier applied.
    /// </summary>
    public PlayerAttributes WithModifiers(IReadOnlyDictionary<string, int> modifiers)
    {
        var might = Might;
        var fortitude = Fortitude;
        var will = Will;
        var wits = Wits;
        var finesse = Finesse;

        foreach (var (attr, mod) in modifiers)
        {
            switch (attr.ToLowerInvariant())
            {
                case "might": might += mod; break;
                case "fortitude": fortitude += mod; break;
                case "will": will += mod; break;
                case "wits": wits += mod; break;
                case "finesse": finesse += mod; break;
            }
        }

        return new PlayerAttributes(
            Math.Clamp(might, 1, 30),
            Math.Clamp(fortitude, 1, 30),
            Math.Clamp(will, 1, 30),
            Math.Clamp(wits, 1, 30),
            Math.Clamp(finesse, 1, 30)
        );
    }

    /// <summary>
    /// Calculates the total point cost of these attributes.
    /// </summary>
    public int CalculatePointCost()
    {
        return CalculateSingleCost(Might) +
               CalculateSingleCost(Fortitude) +
               CalculateSingleCost(Will) +
               CalculateSingleCost(Wits) +
               CalculateSingleCost(Finesse);
    }

    private static int CalculateSingleCost(int value)
    {
        // Base 8 costs 0, each point up to 14 costs 1, 15 costs 2 extra
        if (value <= 8) return 0;
        if (value <= 14) return value - 8;
        return (14 - 8) + ((value - 14) * 2); // 6 + 2 per point above 14
    }

    private static int ValidateAttribute(int value, string name)
    {
        if (value < 1 || value > 30)
            throw new ArgumentOutOfRangeException(name, $"Attribute must be between 1 and 30");
        return value;
    }

    public override string ToString() =>
        $"MIG:{Might} FOR:{Fortitude} WIL:{Will} WIT:{Wits} FIN:{Finesse}";
}
```

#### Point-Buy UI (TUI)

```
╭──────────────────── Allocate Attributes ─────────────────────╮
│                                                              │
│  Points Remaining: 7                                         │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │ Attribute     Value   Racial   Total   Cost            │ │
│  ├─────────────────────────────────────────────────────────┤ │
│  │ Might         [12]    +1       13      4 pts           │ │
│  │ Fortitude     [10]    +1       11      2 pts           │ │
│  │ Will          [10]    +1       11      2 pts           │ │
│  │ Wits          [10]    +1       11      2 pts           │ │
│  │ Finesse       [10]    +1       11      2 pts           │ │
│  └─────────────────────────────────────────────────────────┘ │
│                                        Total: 12/25 pts      │
│                                                              │
│  [+] Increase  [-] Decrease  [Tab] Next  [Enter] Confirm    │
│                                                              │
│  MIGHT (MIG)                                                 │
│  Physical power and strength.                                │
│  Affects: Melee damage, carry capacity, breaking objects     │
╰──────────────────────────────────────────────────────────────╯
```

---

### 4.5 Player Description

**Purpose:** Allow players to write an optional backstory or description for their character.

#### Constraints

| Rule | Value |
|------|-------|
| Minimum length | 0 (optional) |
| Maximum length | 500 characters |
| Allowed content | Any printable characters |
| Line breaks | Allowed (max 5) |

#### Player Entity Changes

**Player.cs modifications:**
```csharp
/// <summary>
/// Gets the player's race definition ID.
/// </summary>
public string RaceId { get; private set; } = "human";

/// <summary>
/// Gets the player's background definition ID.
/// </summary>
public string BackgroundId { get; private set; } = "soldier";

/// <summary>
/// Gets the player's core attributes.
/// </summary>
public PlayerAttributes Attributes { get; private set; } = PlayerAttributes.Default;

/// <summary>
/// Gets the player's optional description/backstory.
/// </summary>
public string Description { get; private set; } = string.Empty;

/// <summary>
/// Sets the player's description (max 500 characters).
/// </summary>
public void SetDescription(string description)
{
    if (description.Length > 500)
        throw new ArgumentException("Description cannot exceed 500 characters");

    var lineBreaks = description.Count(c => c == '\n');
    if (lineBreaks > 5)
        throw new ArgumentException("Description cannot have more than 5 line breaks");

    Description = description;
}
```

#### UI for Description Entry

```
╭────────────────── Character Backstory ───────────────────────╮
│                                                              │
│  Write a brief backstory for your character (optional):      │
│                                                              │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ Born in the shadow of the Ironpeak Mountains, Thorin     ││
│  │ learned the ways of the forge from his father. When      ││
│  │ raiders destroyed his village, he took up arms to seek   ││
│  │ vengeance and protect others from the same fate.         ││
│  │                                                          ││
│  │                                                          ││
│  └──────────────────────────────────────────────────────────┘│
│                                                              │
│  Characters: 247/500                                         │
│                                                              │
│  [Enter] Continue  [Esc] Skip                                │
╰──────────────────────────────────────────────────────────────╯
```

---

### 4.6 Character Summary Screen

**Purpose:** Display a complete character sheet before starting the game.

#### Summary Display

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                            CHARACTER SUMMARY                                  ║
╠══════════════════════════════════════════════════════════════════════════════╣
║                                                                              ║
║  Name:        Thorin Stoneheart                                              ║
║  Race:        Dwarf                                                          ║
║  Background:  Soldier                                                        ║
║                                                                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  ATTRIBUTES                                                                  ║
║  ┌──────────────────────────────────────────────────────────────────────┐   ║
║  │ Might      14  ████████████████░░░░░░░░░░░░░░                        │   ║
║  │ Fortitude  16  ████████████████████░░░░░░░░░░  (+2 Dwarf)            │   ║
║  │ Will       10  ████████████░░░░░░░░░░░░░░░░░░                        │   ║
║  │ Wits       10  ████████████░░░░░░░░░░░░░░░░░░                        │   ║
║  │ Finesse     8  ██████████░░░░░░░░░░░░░░░░░░░░  (-1 Dwarf)            │   ║
║  └──────────────────────────────────────────────────────────────────────┘   ║
║                                                                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  DERIVED STATS                                                               ║
║  ┌──────────────────────────────────────────────────────────────────────┐   ║
║  │ Health:     120 (100 base + 20 from Fortitude)                       │   ║
║  │ Attack:      14 (from Might)                                         │   ║
║  │ Defense:      8 (from Finesse)                                       │   ║
║  └──────────────────────────────────────────────────────────────────────┘   ║
║                                                                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  RACIAL TRAIT: Stout Constitution                                            ║
║  Resistance to poison and advantage on saves against toxins.                 ║
║                                                                              ║
║  BACKGROUND ABILITY: Shield Bash                                             ║
║  Stun an enemy for one turn using your shield.                              ║
║                                                                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  STARTING EQUIPMENT                                                          ║
║  • Iron Shield                                                               ║
║                                                                              ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  BACKSTORY                                                                   ║
║  Born in the shadow of the Ironpeak Mountains, Thorin learned the ways of    ║
║  the forge from his father. When raiders destroyed his village, he took up   ║
║  arms to seek vengeance and protect others from the same fate.               ║
║                                                                              ║
╚══════════════════════════════════════════════════════════════════════════════╝

  [C] Confirm and Start    [E] Edit Character    [B] Back to Name Entry
```

---

## 5. Save System Enhancements

### 5.1 Multiple Save Slots

**Purpose:** Support unlimited save slots with unique names and automatic slot management.

#### Implementation

**IGameRepository Changes:**
```csharp
/// <summary>
/// Gets all saved game summaries, supporting pagination.
/// </summary>
/// <param name="skip">Number of results to skip.</param>
/// <param name="take">Maximum number of results to return.</param>
/// <param name="ct">Cancellation token.</param>
/// <returns>Paginated list of game session summaries.</returns>
Task<IReadOnlyList<GameSessionSummary>> GetSavedGamesAsync(
    int skip = 0,
    int take = 100,
    CancellationToken ct = default);

/// <summary>
/// Gets the total count of saved games.
/// </summary>
Task<int> GetSavedGamesCountAsync(CancellationToken ct = default);
```

**Enhanced GameSessionSummary:**
```csharp
/// <summary>
/// Summary information for a saved game session.
/// </summary>
public record GameSessionSummary(
    Guid SessionId,
    string PlayerName,
    DateTime LastPlayedAt,
    string RaceName,
    string BackgroundName,
    int PlayerLevel,
    string CurrentRoomName,
    TimeSpan TotalPlayTime
);
```

### 5.2 Delete Save Command

**Purpose:** Allow players to permanently delete saved games.

#### Command Syntax
```
delete <save>     # Delete a save by name or number
deletesave        # Show delete confirmation UI
```

#### New Command Record
```csharp
/// <summary>
/// Command to delete a saved game.
/// </summary>
/// <param name="SaveIdentifier">The save name or slot number to delete.</param>
public record DeleteSaveCommand(string? SaveIdentifier = null) : GameCommand;
```

#### Implementation

**GameSessionService - New Method:**
```csharp
/// <summary>
/// Deletes a saved game session.
/// </summary>
/// <param name="sessionId">The ID of the session to delete.</param>
/// <param name="ct">Cancellation token.</param>
/// <returns>True if the session was deleted; false if not found.</returns>
public async Task<bool> DeleteSaveAsync(Guid sessionId, CancellationToken ct = default)
{
    _logger.LogInformation("Deleting save: {SessionId}", sessionId);

    var session = await _repository.GetByIdAsync(sessionId, ct);
    if (session == null)
    {
        _logger.LogWarning("Delete failed - save not found: {SessionId}", sessionId);
        return false;
    }

    await _repository.DeleteAsync(sessionId, ct);

    _logger.LogInformation(
        "Save deleted: {SessionId}, Player: {PlayerName}",
        sessionId, session.Player.Name);

    return true;
}
```

#### UI Flow

```
╭───────────────────── Delete Save ────────────────────────────╮
│                                                              │
│  Select a save to delete:                                    │
│                                                              │
│  > 1. Thorin (Dwarf Soldier) - Level 5                       │
│    2. Elara (Elf Scholar) - Level 3                          │
│    3. Finn (Halfling Thief) - Level 8                        │
│    4. [Cancel]                                               │
│                                                              │
╰──────────────────────────────────────────────────────────────╯

╭─────────────────── Confirm Deletion ─────────────────────────╮
│                                                              │
│  ⚠ WARNING: This action cannot be undone!                   │
│                                                              │
│  Are you sure you want to delete:                            │
│  "Thorin (Dwarf Soldier) - Level 5"                          │
│  Last played: January 6, 2025 at 3:45 PM                     │
│                                                              │
│  [Y] Yes, delete    [N] No, cancel                           │
│                                                              │
╰──────────────────────────────────────────────────────────────╯
```

---

## 6. Customization Foundation

### 6.1 Game Terminology Configuration

**Purpose:** Allow all player-facing text to be customized via configuration.

#### terminology.json
```json
{
  "$schema": "./schemas/terminology.schema.json",
  "version": "1.0",
  "terminology": {
    "stats": {
      "health": {
        "name": "Health",
        "abbreviation": "HP",
        "description": "Your life force. When it reaches zero, you die."
      },
      "attack": {
        "name": "Attack",
        "abbreviation": "ATK",
        "description": "Your offensive power in combat."
      },
      "defense": {
        "name": "Defense",
        "abbreviation": "DEF",
        "description": "Reduces incoming damage."
      }
    },
    "progression": {
      "experience": {
        "name": "Experience",
        "abbreviation": "XP",
        "description": "Points earned from defeating enemies and completing quests."
      },
      "level": {
        "name": "Level",
        "abbreviation": "LVL",
        "description": "Your overall power and progression."
      },
      "levelUp": {
        "message": "You have gained a level!",
        "sound": "levelup.wav"
      }
    },
    "currency": {
      "primary": {
        "name": "Gold",
        "abbreviation": "G",
        "pluralName": "Gold",
        "symbol": "⚜"
      }
    },
    "ui": {
      "inventory": "Inventory",
      "equipment": "Equipment",
      "stats": "Statistics",
      "quests": "Quest Journal",
      "map": "Map",
      "save": "Save Game",
      "load": "Load Game",
      "quit": "Quit"
    }
  }
}
```

### 6.2 Race Definitions

See [Section 4.2](#42-race-selection-system) for complete race definition schema.

### 6.3 Attribute Definitions

#### config/attributes.json
```json
{
  "$schema": "./schemas/attributes.schema.json",
  "version": "1.0",
  "pointBuyRules": {
    "startingPoints": 25,
    "baseAttributeValue": 8,
    "minimumAttribute": 6,
    "maximumAttribute": 15,
    "maximumAfterRacial": 18,
    "costTable": [
      { "range": [6, 14], "costPerPoint": 1 },
      { "range": [15, 15], "costPerPoint": 2 }
    ]
  },
  "attributes": [
    {
      "id": "might",
      "name": "Might",
      "abbreviation": "MIG",
      "description": "Physical power and strength. Determines raw physical capability.",
      "primaryEffects": [
        "Melee weapon damage",
        "Carrying capacity",
        "Breaking objects",
        "Intimidation"
      ],
      "derivedStats": {
        "meleeDamageBonus": "floor((might - 10) / 2)",
        "carryCapacity": "might * 10"
      },
      "sortOrder": 1,
      "color": "#FF6B6B"
    },
    {
      "id": "fortitude",
      "name": "Fortitude",
      "abbreviation": "FOR",
      "description": "Endurance and constitution. Determines stamina and resilience.",
      "primaryEffects": [
        "Maximum health",
        "Poison resistance",
        "Disease resistance",
        "Stamina regeneration"
      ],
      "derivedStats": {
        "maxHealthBonus": "(fortitude - 10) * 5",
        "poisonResistance": "fortitude"
      },
      "sortOrder": 2,
      "color": "#4ECDC4"
    },
    {
      "id": "will",
      "name": "Will",
      "abbreviation": "WIL",
      "description": "Mental fortitude and magical aptitude. Determines willpower.",
      "primaryEffects": [
        "Magic power",
        "Mind effect resistance",
        "Focus/concentration",
        "Mana pool"
      ],
      "derivedStats": {
        "magicDamageBonus": "floor((will - 10) / 2)",
        "maxMana": "will * 5"
      },
      "sortOrder": 3,
      "color": "#9B59B6"
    },
    {
      "id": "wits",
      "name": "Wits",
      "abbreviation": "WIT",
      "description": "Intelligence and perception. Determines mental acuity.",
      "primaryEffects": [
        "Critical hit chance",
        "Trap detection",
        "Lore knowledge",
        "Initiative bonus"
      ],
      "derivedStats": {
        "criticalChanceBonus": "floor((wits - 10) / 4)",
        "trapDetection": "wits"
      },
      "sortOrder": 4,
      "color": "#F39C12"
    },
    {
      "id": "finesse",
      "name": "Finesse",
      "abbreviation": "FIN",
      "description": "Agility and precision. Determines physical coordination.",
      "primaryEffects": [
        "Attack accuracy",
        "Dodge chance",
        "Stealth",
        "Lockpicking"
      ],
      "derivedStats": {
        "accuracyBonus": "floor((finesse - 10) / 2)",
        "dodgeChance": "floor((finesse - 10) / 4)"
      },
      "sortOrder": 5,
      "color": "#1ABC9C"
    }
  ]
}
```

---

## 7. Terminology & Lexicon System

### 7.1 Lexicon Configuration

**Purpose:** Define all game terminology with synonyms and contextual variations.

#### config/lexicon.json
```json
{
  "$schema": "./schemas/lexicon.schema.json",
  "version": "1.0",
  "contexts": [
    { "id": "combat", "name": "Combat" },
    { "id": "exploration", "name": "Exploration" },
    { "id": "dialogue", "name": "Dialogue" },
    { "id": "formal", "name": "Formal" },
    { "id": "casual", "name": "Casual" }
  ],
  "terms": {
    "attack": {
      "default": "attack",
      "synonyms": ["strike", "swing", "slash", "thrust", "lunge"],
      "contextual": {
        "combat": ["strike", "slash", "thrust"],
        "formal": ["engage", "assail"],
        "casual": ["hit", "whack", "smack"]
      },
      "weights": {
        "strike": 30,
        "slash": 25,
        "swing": 20,
        "thrust": 15,
        "lunge": 10
      }
    },
    "hit": {
      "default": "hits",
      "synonyms": ["connects", "lands", "strikes true", "finds its mark"],
      "contextual": {
        "combat": ["connects", "lands a blow", "strikes true"],
        "formal": ["finds its mark", "successfully engages"]
      },
      "weights": {
        "hits": 25,
        "connects": 25,
        "lands": 20,
        "strikes true": 15,
        "finds its mark": 15
      }
    },
    "miss": {
      "default": "misses",
      "synonyms": ["swings wide", "goes wide", "whiffs", "fails to connect"],
      "contextual": {
        "combat": ["swings wide", "fails to connect", "is deflected"],
        "casual": ["whiffs", "misses completely", "swings at air"]
      }
    },
    "damage": {
      "default": "damage",
      "synonyms": ["wound", "injure", "hurt", "harm"],
      "severity": {
        "light": ["graze", "scratch", "nick"],
        "moderate": ["wound", "injure", "hurt"],
        "heavy": ["devastate", "ravage", "grievously wound"],
        "critical": ["obliterate", "annihilate", "utterly destroy"]
      }
    },
    "kill": {
      "default": "defeats",
      "synonyms": ["slays", "vanquishes", "destroys", "fells"],
      "contextual": {
        "combat": ["slays", "defeats", "vanquishes"],
        "formal": ["vanquishes", "fells", "brings low"]
      }
    },
    "move": {
      "default": "move",
      "synonyms": ["walk", "stride", "venture", "proceed", "travel"],
      "contextual": {
        "exploration": ["venture", "proceed", "make your way"],
        "casual": ["head", "go", "walk"]
      }
    },
    "quantities": {
      "none": ["none", "no", "zero", "not any"],
      "one": ["a", "one", "a single", "a lone"],
      "few": ["a few", "some", "a handful of", "several"],
      "many": ["many", "numerous", "a multitude of", "countless"],
      "horde": ["a horde of", "an army of", "swarms of", "legions of"]
    },
    "conditions": {
      "healthy": ["unharmed", "in good health", "at full strength"],
      "wounded": ["wounded", "injured", "hurt"],
      "bloodied": ["bloodied", "badly wounded", "bleeding heavily"],
      "nearDeath": ["near death", "barely standing", "clinging to life", "at death's door"]
    }
  }
}
```

### 7.2 Lexicon Service

**LexiconService.cs (new file: Application/Services/):**
```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Service for retrieving and selecting terminology with context-aware synonym support.
/// </summary>
public class LexiconService
{
    private readonly LexiconConfiguration _config;
    private readonly ILogger<LexiconService> _logger;
    private readonly Random _random = new();

    public LexiconService(LexiconConfiguration config, ILogger<LexiconService> logger)
    {
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
        _logger.LogDebug("LexiconService initialized with {TermCount} terms", _config.Terms.Count);
    }

    /// <summary>
    /// Gets a term, optionally selecting a synonym based on context.
    /// </summary>
    /// <param name="termId">The term identifier (e.g., "attack", "hit").</param>
    /// <param name="context">Optional context for selection (e.g., "combat", "formal").</param>
    /// <param name="useSynonym">Whether to potentially use a synonym instead of default.</param>
    /// <returns>The selected term string.</returns>
    public string GetTerm(string termId, string? context = null, bool useSynonym = true)
    {
        if (!_config.Terms.TryGetValue(termId, out var term))
        {
            _logger.LogWarning("Unknown term requested: {TermId}", termId);
            return termId; // Return the ID itself as fallback
        }

        if (!useSynonym)
        {
            return term.Default;
        }

        // Check for contextual override
        if (context != null && term.Contextual.TryGetValue(context, out var contextualSynonyms))
        {
            return SelectWeighted(contextualSynonyms, term.Weights);
        }

        // Use general synonyms with weighting
        return SelectWeighted(term.Synonyms.Prepend(term.Default).ToList(), term.Weights);
    }

    /// <summary>
    /// Gets a damage severity descriptor based on percentage of max health.
    /// </summary>
    /// <param name="damagePercent">Damage as percentage of target's max health.</param>
    /// <returns>A severity-appropriate damage word.</returns>
    public string GetDamageSeverity(double damagePercent)
    {
        if (!_config.Terms.TryGetValue("damage", out var term))
            return "damage";

        var severity = damagePercent switch
        {
            < 0.1 => "light",
            < 0.25 => "moderate",
            < 0.5 => "heavy",
            _ => "critical"
        };

        if (term.Severity.TryGetValue(severity, out var options))
        {
            return options[_random.Next(options.Count)];
        }

        return term.Default;
    }

    /// <summary>
    /// Gets a quantity descriptor based on count.
    /// </summary>
    /// <param name="count">The number of items.</param>
    /// <returns>A quantity descriptor phrase.</returns>
    public string GetQuantity(int count)
    {
        if (!_config.Terms.TryGetValue("quantities", out var term))
            return count.ToString();

        var category = count switch
        {
            0 => "none",
            1 => "one",
            <= 3 => "few",
            <= 10 => "many",
            _ => "horde"
        };

        if (term.Severity.TryGetValue(category, out var options))
        {
            return options[_random.Next(options.Count)];
        }

        return count.ToString();
    }

    /// <summary>
    /// Gets a condition descriptor based on health percentage.
    /// </summary>
    /// <param name="healthPercent">Current health as percentage of max.</param>
    /// <returns>A condition descriptor phrase.</returns>
    public string GetCondition(double healthPercent)
    {
        if (!_config.Terms.TryGetValue("conditions", out var term))
            return "wounded";

        var category = healthPercent switch
        {
            >= 1.0 => "healthy",
            >= 0.5 => "wounded",
            >= 0.25 => "bloodied",
            _ => "nearDeath"
        };

        if (term.Severity.TryGetValue(category, out var options))
        {
            return options[_random.Next(options.Count)];
        }

        return "wounded";
    }

    private string SelectWeighted(IList<string> options, IReadOnlyDictionary<string, int>? weights)
    {
        if (options.Count == 0) return string.Empty;
        if (options.Count == 1) return options[0];

        if (weights == null || weights.Count == 0)
        {
            return options[_random.Next(options.Count)];
        }

        var totalWeight = options.Sum(o => weights.GetValueOrDefault(o, 10));
        var roll = _random.Next(totalWeight);
        var cumulative = 0;

        foreach (var option in options)
        {
            cumulative += weights.GetValueOrDefault(option, 10);
            if (roll < cumulative)
                return option;
        }

        return options[0];
    }
}
```

### 7.3 Synonym Pools

Synonym pools are defined within the lexicon configuration (see 7.1). Each term can have:

- **Default**: The standard term used when synonyms are disabled
- **Synonyms**: General-purpose alternatives
- **Contextual**: Context-specific synonym lists
- **Weights**: Probability weights for selection
- **Severity**: Value-based variations (for damage, quantities, etc.)

### 7.4 Context-Aware Selection

The `LexiconService` supports multiple selection contexts:

| Context | Usage |
|---------|-------|
| `combat` | During combat encounters |
| `exploration` | While exploring/moving |
| `dialogue` | In NPC conversations |
| `formal` | Official/serious situations |
| `casual` | Relaxed/humorous situations |

---

## 8. Descriptor System (Text Variety Engine)

### 8.1 Setting Aesthetic/Theme

**Purpose:** Define the overall tone and style for descriptor selection.

#### ThemeConfiguration
```csharp
public class ThemeConfiguration
{
    /// <summary>
    /// The active theme preset.
    /// </summary>
    public string ActiveTheme { get; set; } = "dark_fantasy";

    /// <summary>
    /// Available theme presets.
    /// </summary>
    public IReadOnlyDictionary<string, ThemePreset> Themes { get; set; } =
        new Dictionary<string, ThemePreset>();
}

public class ThemePreset
{
    public string Id { get; set; } = string.Empty;
    public string Name { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;

    /// <summary>
    /// Descriptor pool overrides for this theme.
    /// </summary>
    public IReadOnlyDictionary<string, string> DescriptorOverrides { get; set; } =
        new Dictionary<string, string>();

    /// <summary>
    /// Word filter - excluded terms for this theme.
    /// </summary>
    public IReadOnlyList<string> ExcludedTerms { get; set; } = [];

    /// <summary>
    /// Word emphasis - terms that should be weighted higher.
    /// </summary>
    public IReadOnlyList<string> EmphasizedTerms { get; set; } = [];
}
```

#### config/themes.json
```json
{
  "activeTheme": "dark_fantasy",
  "themes": {
    "dark_fantasy": {
      "id": "dark_fantasy",
      "name": "Dark Fantasy",
      "description": "Grim, atmospheric fantasy with horror elements.",
      "descriptorOverrides": {
        "environmental.lighting": "environmental.lighting.dark",
        "combat.death": "combat.death.grim"
      },
      "excludedTerms": ["cheerful", "bright", "sunny"],
      "emphasizedTerms": ["shadows", "darkness", "dread", "ancient"]
    },
    "high_fantasy": {
      "id": "high_fantasy",
      "name": "High Fantasy",
      "description": "Epic, heroic fantasy with wonder and magic.",
      "descriptorOverrides": {
        "environmental.lighting": "environmental.lighting.bright"
      },
      "excludedTerms": ["gore", "viscera", "rotting"],
      "emphasizedTerms": ["magnificent", "wondrous", "glorious"]
    },
    "horror": {
      "id": "horror",
      "name": "Horror",
      "description": "Terrifying, suspenseful horror atmosphere.",
      "descriptorOverrides": {
        "environmental.sounds": "environmental.sounds.horror"
      },
      "excludedTerms": ["peaceful", "calm", "serene"],
      "emphasizedTerms": ["dread", "terror", "unspeakable", "crawling"]
    }
  }
}
```

### 8.2 Environmental Descriptors

#### config/descriptors/environmental.json
```json
{
  "$schema": "../schemas/descriptors.schema.json",
  "version": "1.0",
  "category": "environmental",
  "pools": {
    "lighting": {
      "id": "lighting",
      "name": "Lighting",
      "descriptors": [
        {
          "id": "dim_torch",
          "text": "dimly lit by flickering torches",
          "weight": 20,
          "tags": ["indoor", "dungeon"],
          "themes": ["dark_fantasy", "horror"]
        },
        {
          "id": "bathed_torchlight",
          "text": "bathed in warm torchlight",
          "weight": 15,
          "tags": ["indoor", "safe"],
          "themes": ["high_fantasy"]
        },
        {
          "id": "shrouded_darkness",
          "text": "shrouded in impenetrable darkness",
          "weight": 25,
          "tags": ["danger", "dungeon"],
          "themes": ["dark_fantasy", "horror"]
        },
        {
          "id": "pale_light",
          "text": "where pale light filters through cracks above",
          "weight": 15,
          "tags": ["underground", "atmospheric"]
        },
        {
          "id": "eerie_glow",
          "text": "illuminated by an eerie phosphorescent glow",
          "weight": 10,
          "tags": ["magic", "cave"],
          "themes": ["dark_fantasy", "horror"]
        },
        {
          "id": "shadows_dance",
          "text": "where shadows dance at the edge of your vision",
          "weight": 15,
          "tags": ["atmospheric", "danger"]
        }
      ]
    },
    "sounds": {
      "id": "sounds",
      "name": "Ambient Sounds",
      "descriptors": [
        {
          "id": "dripping_water",
          "text": "The sound of dripping water echoes in the distance",
          "weight": 25,
          "tags": ["cave", "dungeon"]
        },
        {
          "id": "distant_rumbling",
          "text": "A distant rumbling vibrates through the stone",
          "weight": 15,
          "tags": ["underground", "danger"]
        },
        {
          "id": "eerie_silence",
          "text": "An eerie silence hangs in the air",
          "weight": 20,
          "tags": ["atmospheric", "danger"],
          "themes": ["horror"]
        },
        {
          "id": "scratching_walls",
          "text": "Something scratches within the walls",
          "weight": 15,
          "tags": ["danger", "creature"],
          "themes": ["horror"]
        },
        {
          "id": "wind_moaning",
          "text": "A mournful wind moans through unseen passages",
          "weight": 15,
          "tags": ["atmospheric"]
        },
        {
          "id": "chains_rattling",
          "text": "The distant rattling of chains sends shivers down your spine",
          "weight": 10,
          "tags": ["dungeon", "danger"],
          "themes": ["dark_fantasy", "horror"]
        }
      ]
    },
    "smells": {
      "id": "smells",
      "name": "Ambient Smells",
      "descriptors": [
        {
          "id": "musty_air",
          "text": "The air is thick and musty",
          "weight": 25,
          "tags": ["indoor", "old"]
        },
        {
          "id": "damp_stone",
          "text": "The smell of damp stone fills your nostrils",
          "weight": 20,
          "tags": ["cave", "dungeon"]
        },
        {
          "id": "rotting_vegetation",
          "text": "The stench of rotting vegetation assaults your senses",
          "weight": 15,
          "tags": ["swamp", "decay"],
          "themes": ["horror"]
        },
        {
          "id": "sulfurous_fumes",
          "text": "Sulfurous fumes sting your eyes and throat",
          "weight": 10,
          "tags": ["volcanic", "danger"]
        },
        {
          "id": "ancient_dust",
          "text": "Ancient dust coats your tongue with each breath",
          "weight": 15,
          "tags": ["ruin", "old"]
        },
        {
          "id": "copper_blood",
          "text": "The metallic tang of blood hangs in the air",
          "weight": 15,
          "tags": ["combat", "danger"],
          "themes": ["dark_fantasy", "horror"]
        }
      ]
    },
    "temperature": {
      "id": "temperature",
      "name": "Temperature Sensations",
      "descriptors": [
        {
          "id": "bone_chilling",
          "text": "A bone-chilling cold seeps into your very soul",
          "weight": 20,
          "tags": ["cold", "supernatural"]
        },
        {
          "id": "oppressive_heat",
          "text": "Oppressive heat radiates from the stone walls",
          "weight": 15,
          "tags": ["volcanic", "forge"]
        },
        {
          "id": "damp_chill",
          "text": "A damp chill clings to your skin",
          "weight": 25,
          "tags": ["cave", "dungeon"]
        },
        {
          "id": "stale_warmth",
          "text": "Stale warmth hangs heavy in the still air",
          "weight": 20,
          "tags": ["indoor", "enclosed"]
        },
        {
          "id": "unnatural_cold",
          "text": "An unnatural cold presence makes your breath visible",
          "weight": 10,
          "tags": ["supernatural", "undead"],
          "themes": ["horror"]
        }
      ]
    },
    "textures": {
      "id": "textures",
      "name": "Surface Textures",
      "descriptors": [
        {
          "id": "rough_hewn",
          "text": "The rough-hewn stone bears ancient chisel marks",
          "weight": 25,
          "tags": ["dungeon", "constructed"]
        },
        {
          "id": "slick_moss",
          "text": "Slick moss covers every surface",
          "weight": 20,
          "tags": ["cave", "wet"]
        },
        {
          "id": "crumbling_mortar",
          "text": "Crumbling mortar crumbles at your touch",
          "weight": 15,
          "tags": ["ruin", "old"]
        },
        {
          "id": "ancient_brickwork",
          "text": "Ancient brickwork shows the passage of countless years",
          "weight": 20,
          "tags": ["constructed", "old"]
        },
        {
          "id": "smooth_worn",
          "text": "The floor is worn smooth by countless footsteps",
          "weight": 20,
          "tags": ["traveled", "old"]
        }
      ]
    }
  }
}
```

### 8.3 Interactive Object Descriptors

#### config/descriptors/objects.json
```json
{
  "category": "objects",
  "pools": {
    "containers": {
      "descriptors": [
        { "id": "weathered_chest", "text": "a weathered wooden chest, its iron bands rusted with age", "weight": 20 },
        { "id": "ornate_coffer", "text": "an ornate coffer inlaid with faded gold filigree", "weight": 15 },
        { "id": "rusted_lockbox", "text": "a rusted lockbox, its mechanism long seized", "weight": 20 },
        { "id": "ancient_urn", "text": "an ancient urn covered in mysterious symbols", "weight": 15 },
        { "id": "rotting_crate", "text": "a rotting wooden crate, its contents long since decayed", "weight": 15 },
        { "id": "stone_sarcophagus", "text": "a stone sarcophagus, its lid slightly ajar", "weight": 15, "tags": ["tomb", "danger"] }
      ]
    },
    "furniture": {
      "descriptors": [
        { "id": "rickety_table", "text": "a rickety table that groans under its own weight", "weight": 20 },
        { "id": "collapsed_throne", "text": "the remains of a collapsed throne, once majestic", "weight": 15 },
        { "id": "rotting_bookshelf", "text": "a rotting bookshelf, its contents turned to pulp", "weight": 20 },
        { "id": "overturned_cart", "text": "an overturned cart, its wheel still slowly spinning", "weight": 15 },
        { "id": "broken_altar", "text": "a broken altar stained with dark residue", "weight": 15, "tags": ["religious", "danger"] },
        { "id": "dusty_workbench", "text": "a dusty workbench covered with abandoned tools", "weight": 15 }
      ]
    },
    "architectural": {
      "descriptors": [
        { "id": "crumbling_pillar", "text": "a crumbling pillar that somehow still supports the ceiling", "weight": 20 },
        { "id": "iron_door", "text": "an iron-banded door, scarred by countless attempts to breach it", "weight": 20 },
        { "id": "spiral_staircase", "text": "a spiral staircase descending into darkness", "weight": 15 },
        { "id": "collapsed_archway", "text": "a collapsed archway, rubble blocking all but a narrow passage", "weight": 20 },
        { "id": "grand_fireplace", "text": "a grand fireplace, cold ashes hinting at past warmth", "weight": 15 },
        { "id": "barred_window", "text": "a barred window offering a glimpse of nothing but stone", "weight": 10 }
      ]
    }
  }
}
```

### 8.4 Puzzle Descriptors

#### config/descriptors/puzzles.json
```json
{
  "category": "puzzles",
  "pools": {
    "mechanisms": {
      "descriptors": [
        { "id": "gears_grind", "text": "Ancient gears grind to life with a deafening screech", "weight": 20 },
        { "id": "runes_flicker", "text": "Mystical runes flicker with an inner light", "weight": 20 },
        { "id": "pressure_plate", "text": "A pressure plate clicks beneath your weight", "weight": 25 },
        { "id": "crystal_resonates", "text": "The crystal resonates with a pure, clear tone", "weight": 15 },
        { "id": "chains_rattle", "text": "Hidden chains rattle somewhere within the walls", "weight": 20 }
      ]
    },
    "clues": {
      "descriptors": [
        { "id": "faded_inscription", "text": "A faded inscription reads", "weight": 25 },
        { "id": "symbols_pattern", "text": "Symbols are arranged in a deliberate pattern", "weight": 20 },
        { "id": "dust_disturbed", "text": "The dust here has been disturbed recently", "weight": 20 },
        { "id": "scratches_floor", "text": "Scratches on the floor suggest something was dragged", "weight": 15 },
        { "id": "portrait_eyes", "text": "The portrait's eyes seem to follow your movement", "weight": 15, "themes": ["horror"] }
      ]
    },
    "states": {
      "descriptors": [
        { "id": "partially_solved", "text": "The mechanism appears partially solved", "weight": 30 },
        { "id": "reset_position", "text": "Everything has reset to its original position", "weight": 25 },
        { "id": "mechanism_jammed", "text": "The mechanism has jammed in place", "weight": 20 },
        { "id": "awaiting_input", "text": "The device hums softly, awaiting input", "weight": 25 }
      ]
    }
  }
}
```

### 8.5 Examine Descriptors

#### config/descriptors/examine.json
```json
{
  "category": "examine",
  "pools": {
    "conditions": {
      "descriptors": [
        { "id": "pristine", "text": "in pristine condition, as if newly forged", "weight": 10 },
        { "id": "battle_worn", "text": "battle-worn but still serviceable", "weight": 25 },
        { "id": "corroded", "text": "heavily corroded by time and neglect", "weight": 20 },
        { "id": "masterfully_crafted", "text": "masterfully crafted with exceptional skill", "weight": 10 },
        { "id": "crude_effective", "text": "crude but brutally effective", "weight": 20 },
        { "id": "ancient_powerful", "text": "ancient and thrumming with latent power", "weight": 15, "tags": ["magic"] }
      ]
    },
    "hidden_details": {
      "descriptors": [
        { "id": "closer_inspection", "text": "Upon closer inspection, you notice", "weight": 30 },
        { "id": "barely_visible", "text": "A barely visible etching reveals", "weight": 20 },
        { "id": "concealed_compartment", "text": "Your fingers find a concealed compartment containing", "weight": 15 },
        { "id": "faint_writing", "text": "Faint writing becomes visible in the right light", "weight": 20 },
        { "id": "hidden_mechanism", "text": "A hidden mechanism clicks as you examine it", "weight": 15 }
      ]
    },
    "lore_hints": {
      "descriptors": [
        { "id": "bears_mark", "text": "It bears the mark of", "weight": 25 },
        { "id": "style_suggests", "text": "The style suggests it originated from", "weight": 25 },
        { "id": "craftsmanship_indicates", "text": "The craftsmanship indicates", "weight": 20 },
        { "id": "legends_speak", "text": "Legends speak of items like this", "weight": 15 },
        { "id": "ancient_script", "text": "Ancient script identifies this as", "weight": 15 }
      ]
    }
  }
}
```

### 8.6 Combat Descriptors

#### config/descriptors/combat.json
```json
{
  "category": "combat",
  "pools": {
    "hit_descriptions": {
      "descriptors": [
        { "id": "strikes_true", "text": "strikes true", "weight": 25 },
        { "id": "slashes_deeply", "text": "slashes deeply", "weight": 20 },
        { "id": "pierces_armor", "text": "pierces through armor", "weight": 15 },
        { "id": "connects_solidly", "text": "connects with a solid blow", "weight": 25 },
        { "id": "finds_gap", "text": "finds a gap in the defense", "weight": 15 },
        { "id": "devastating_blow", "text": "lands a devastating blow", "weight": 10, "minDamagePercent": 0.25 }
      ]
    },
    "miss_descriptions": {
      "descriptors": [
        { "id": "swings_wide", "text": "swings wide", "weight": 25 },
        { "id": "deflected_away", "text": "is deflected away", "weight": 20 },
        { "id": "narrowly_dodged", "text": "is narrowly dodged", "weight": 20 },
        { "id": "parried_expertly", "text": "is parried expertly", "weight": 15 },
        { "id": "misses_completely", "text": "misses completely", "weight": 20 }
      ]
    },
    "damage_severity": {
      "descriptors": [
        { "id": "grazes", "text": "grazes", "weight": 100, "maxDamagePercent": 0.1 },
        { "id": "wounds", "text": "wounds", "weight": 100, "minDamagePercent": 0.1, "maxDamagePercent": 0.25 },
        { "id": "grievously_injures", "text": "grievously injures", "weight": 100, "minDamagePercent": 0.25, "maxDamagePercent": 0.5 },
        { "id": "devastates", "text": "devastates", "weight": 100, "minDamagePercent": 0.5 }
      ]
    },
    "death_descriptions": {
      "descriptors": [
        { "id": "collapses", "text": "collapses to the ground", "weight": 25 },
        { "id": "crumbles_dust", "text": "crumbles to dust", "weight": 15, "tags": ["undead", "construct"] },
        { "id": "final_cry", "text": "lets out a final cry and falls", "weight": 25 },
        { "id": "falls_silent", "text": "falls silent, never to rise again", "weight": 20 },
        { "id": "dissolves_shadows", "text": "dissolves into shadows", "weight": 15, "tags": ["shadow", "demon"] }
      ]
    }
  }
}
```

### 8.7 Skill Check Descriptors

#### config/descriptors/skillchecks.json
```json
{
  "category": "skillchecks",
  "pools": {
    "critical_success": {
      "descriptors": [
        { "id": "spectacular", "text": "A spectacular success!", "weight": 25 },
        { "id": "masterful", "text": "Masterful execution!", "weight": 25 },
        { "id": "beyond_expectations", "text": "The result exceeds all expectations!", "weight": 20 },
        { "id": "perfect", "text": "Perfect! Absolutely flawless!", "weight": 15 },
        { "id": "legendary", "text": "A legendary display of skill!", "weight": 15 }
      ]
    },
    "success": {
      "descriptors": [
        { "id": "accomplished", "text": "You accomplish the task", "weight": 30 },
        { "id": "succeeded", "text": "You succeed", "weight": 30 },
        { "id": "managed_to", "text": "You manage to complete it", "weight": 25 },
        { "id": "pulled_off", "text": "You pull it off", "weight": 15 }
      ]
    },
    "failure": {
      "descriptors": [
        { "id": "fell_short", "text": "You fall just short", "weight": 30 },
        { "id": "couldnt_quite", "text": "You couldn't quite manage it", "weight": 25 },
        { "id": "fumbled", "text": "You fumble the attempt", "weight": 25 },
        { "id": "failed_to", "text": "You fail to complete the task", "weight": 20 }
      ]
    },
    "critical_failure": {
      "descriptors": [
        { "id": "catastrophic", "text": "Catastrophic failure!", "weight": 25 },
        { "id": "disastrous", "text": "A disastrous attempt!", "weight": 25 },
        { "id": "spectacular_misfortune", "text": "Spectacular misfortune strikes!", "weight": 20 },
        { "id": "worst_possible", "text": "The worst possible outcome!", "weight": 15 },
        { "id": "everything_wrong", "text": "Everything that could go wrong, does.", "weight": 15 }
      ]
    }
  }
}
```

### 8.8 Ability Descriptors

#### config/descriptors/abilities.json
```json
{
  "category": "abilities",
  "pools": {
    "casting": {
      "descriptors": [
        { "id": "channels_energy", "text": "channels arcane energy", "weight": 25 },
        { "id": "incants_words", "text": "incants ancient words of power", "weight": 20 },
        { "id": "focuses_power", "text": "focuses inner power", "weight": 25 },
        { "id": "draws_upon", "text": "draws upon mystical forces", "weight": 20 },
        { "id": "gestures_arcane", "text": "traces arcane gestures in the air", "weight": 10 }
      ]
    },
    "effects": {
      "fire": [
        { "id": "flames_erupt", "text": "Flames erupt with searing intensity", "weight": 30 },
        { "id": "fire_engulfs", "text": "Fire engulfs the target", "weight": 25 },
        { "id": "inferno_roars", "text": "An inferno roars to life", "weight": 20 }
      ],
      "ice": [
        { "id": "frost_spreads", "text": "Frost spreads with crystalline precision", "weight": 30 },
        { "id": "cold_bites", "text": "Bitter cold bites deep", "weight": 25 },
        { "id": "ice_encases", "text": "Ice encases the target", "weight": 20 }
      ],
      "shadow": [
        { "id": "shadows_coalesce", "text": "Shadows coalesce into darkness", "weight": 30 },
        { "id": "darkness_consumes", "text": "Darkness consumes all light", "weight": 25 }
      ],
      "light": [
        { "id": "light_blazes", "text": "Brilliant light blazes forth", "weight": 30 },
        { "id": "radiance_burns", "text": "Holy radiance burns the unholy", "weight": 25 }
      ]
    },
    "duration": {
      "descriptors": [
        { "id": "fades_gradually", "text": "The effect fades gradually", "weight": 25 },
        { "id": "dissipates", "text": "The energy dissipates", "weight": 25 },
        { "id": "lingers", "text": "The effect lingers in the air", "weight": 25 },
        { "id": "intensifies", "text": "The power intensifies momentarily before fading", "weight": 15 }
      ]
    }
  }
}
```

### 8.9 Dice Result Descriptors

#### config/descriptors/dice.json
```json
{
  "category": "dice",
  "pools": {
    "natural_one": {
      "descriptors": [
        { "id": "dice_betray", "text": "The dice betray you", "weight": 25 },
        { "id": "fortune_turns", "text": "Fortune turns against you", "weight": 25 },
        { "id": "cruel_twist", "text": "A cruel twist of fate", "weight": 25 },
        { "id": "luck_abandons", "text": "Luck completely abandons you", "weight": 15 },
        { "id": "cursed_roll", "text": "A cursed roll if ever there was one", "weight": 10 }
      ]
    },
    "low_rolls": {
      "descriptors": [
        { "id": "luck_not_side", "text": "Luck is not on your side", "weight": 30 },
        { "id": "barely_missing", "text": "Barely missing the mark", "weight": 30 },
        { "id": "unfavorable", "text": "An unfavorable result", "weight": 25 },
        { "id": "could_be_worse", "text": "It could have been worse", "weight": 15 }
      ]
    },
    "high_rolls": {
      "descriptors": [
        { "id": "fortune_favors", "text": "Fortune favors you", "weight": 30 },
        { "id": "odds_align", "text": "The odds align in your favor", "weight": 25 },
        { "id": "skillful_execution", "text": "Skillful execution", "weight": 25 },
        { "id": "impressive_result", "text": "An impressive result", "weight": 20 }
      ]
    },
    "natural_max": {
      "descriptors": [
        { "id": "destiny_intervenes", "text": "Destiny itself intervenes", "weight": 25 },
        { "id": "legendary_success", "text": "A legendary success", "weight": 25 },
        { "id": "stars_align", "text": "The stars align perfectly", "weight": 20 },
        { "id": "gods_smile", "text": "The gods smile upon you", "weight": 15 },
        { "id": "perfect_moment", "text": "A perfect moment of triumph", "weight": 15 }
      ]
    }
  }
}
```

### 8.10 NPC Appearance Descriptors

#### config/descriptors/npcs.json
```json
{
  "category": "npcs",
  "pools": {
    "physical_features": {
      "descriptors": [
        { "id": "weathered_face", "text": "a weathered face marked by years of hardship", "weight": 20 },
        { "id": "keen_eyes", "text": "keen eyes that miss nothing", "weight": 20 },
        { "id": "scarred_hands", "text": "scarred hands that speak of past battles", "weight": 15 },
        { "id": "imposing_stature", "text": "an imposing stature that commands attention", "weight": 15 },
        { "id": "gaunt_features", "text": "gaunt features stretched over sharp bones", "weight": 15 },
        { "id": "warm_smile", "text": "a warm smile that puts you at ease", "weight": 15 }
      ]
    },
    "clothing": {
      "descriptors": [
        { "id": "tattered_robes", "text": "wearing tattered robes that have seen better days", "weight": 20 },
        { "id": "gleaming_armor", "text": "clad in gleaming armor polished to a mirror shine", "weight": 15 },
        { "id": "humble_garb", "text": "dressed in humble garb befitting a commoner", "weight": 25 },
        { "id": "ornate_vestments", "text": "adorned in ornate vestments of office", "weight": 15 },
        { "id": "practical_leather", "text": "wearing practical leather gear for travel", "weight": 25 }
      ]
    },
    "demeanor": {
      "descriptors": [
        { "id": "nervous_glance", "text": "with nervous glances darting about", "weight": 20 },
        { "id": "confident_stance", "text": "standing with confident ease", "weight": 20 },
        { "id": "weary_expression", "text": "bearing a weary expression", "weight": 20 },
        { "id": "eager_smile", "text": "with an eager smile at your approach", "weight": 15 },
        { "id": "suspicious_gaze", "text": "regarding you with a suspicious gaze", "weight": 15 },
        { "id": "neutral_mask", "text": "face an unreadable mask", "weight": 10 }
      ]
    },
    "voice": {
      "descriptors": [
        { "id": "gravelly_tone", "text": "speaks in a gravelly tone", "weight": 20 },
        { "id": "melodic_speech", "text": "speaks with melodic grace", "weight": 15 },
        { "id": "hesitant_whisper", "text": "whispers hesitantly", "weight": 20 },
        { "id": "booming_voice", "text": "booms with a commanding voice", "weight": 15 },
        { "id": "soft_measured", "text": "speaks softly with measured words", "weight": 15 },
        { "id": "rapid_excited", "text": "chatters rapidly with excitement", "weight": 15 }
      ]
    }
  }
}
```

### 8.11 Descriptor Weighting & Combinations

#### DescriptorService Implementation

**DescriptorService.cs (new file: Application/Services/):**
```csharp
using Microsoft.Extensions.Logging;
using RuneAndRust.Application.Configuration;

namespace RuneAndRust.Application.Services;

/// <summary>
/// Service for generating varied text descriptions using weighted descriptor pools.
/// </summary>
public class DescriptorService
{
    private readonly IReadOnlyDictionary<string, DescriptorPool> _pools;
    private readonly ThemeConfiguration _theme;
    private readonly ILogger<DescriptorService> _logger;
    private readonly Random _random = new();

    // Track recently used descriptors to avoid repetition
    private readonly Dictionary<string, Queue<string>> _recentlyUsed = new();
    private const int RecentHistorySize = 3;

    public DescriptorService(
        IConfigurationProvider configProvider,
        ThemeConfiguration theme,
        ILogger<DescriptorService> logger)
    {
        _pools = configProvider.GetAllDescriptorPools();
        _theme = theme;
        _logger = logger;
        _logger.LogDebug("DescriptorService initialized with {PoolCount} pools", _pools.Count);
    }

    /// <summary>
    /// Gets a single descriptor from a pool.
    /// </summary>
    /// <param name="poolPath">The pool path (e.g., "environmental.lighting").</param>
    /// <param name="tags">Optional tags to filter descriptors.</param>
    /// <param name="context">Optional context for selection.</param>
    /// <returns>The selected descriptor text.</returns>
    public string GetDescriptor(string poolPath, IEnumerable<string>? tags = null, DescriptorContext? context = null)
    {
        // Check for theme override
        var actualPath = _theme.Themes.TryGetValue(_theme.ActiveTheme, out var preset)
            && preset.DescriptorOverrides.TryGetValue(poolPath, out var overridePath)
            ? overridePath
            : poolPath;

        if (!_pools.TryGetValue(actualPath, out var pool))
        {
            _logger.LogWarning("Descriptor pool not found: {PoolPath}", actualPath);
            return string.Empty;
        }

        var candidates = pool.Descriptors.AsEnumerable();

        // Filter by tags
        if (tags?.Any() == true)
        {
            candidates = candidates.Where(d => d.Tags.Intersect(tags).Any());
        }

        // Filter by theme
        var activeTheme = _theme.ActiveTheme;
        candidates = candidates.Where(d => d.Themes.Count == 0 || d.Themes.Contains(activeTheme));

        // Filter by context constraints
        if (context != null)
        {
            candidates = ApplyContextFilters(candidates, context);
        }

        // Apply theme exclusions
        if (preset != null)
        {
            candidates = candidates.Where(d =>
                !preset.ExcludedTerms.Any(term => d.Text.Contains(term, StringComparison.OrdinalIgnoreCase)));
        }

        var candidateList = candidates.ToList();

        if (candidateList.Count == 0)
        {
            _logger.LogDebug("No matching descriptors in pool: {PoolPath}", actualPath);
            return string.Empty;
        }

        // Avoid recently used
        var descriptor = SelectWeightedAvoidingRecent(poolPath, candidateList, preset);

        TrackUsage(poolPath, descriptor.Id);

        _logger.LogDebug("Selected descriptor: {Id} from pool {Pool}", descriptor.Id, poolPath);

        return descriptor.Text;
    }

    /// <summary>
    /// Generates a combined description from multiple pools.
    /// </summary>
    /// <param name="template">Template string with placeholders (e.g., "The room is {lighting}. {sounds}").</param>
    /// <param name="tags">Tags to filter all pools.</param>
    /// <param name="context">Context for all selections.</param>
    /// <returns>The combined description.</returns>
    public string GenerateCombined(string template, IEnumerable<string>? tags = null, DescriptorContext? context = null)
    {
        var tagList = tags?.ToList();

        return System.Text.RegularExpressions.Regex.Replace(template, @"\{([^}]+)\}", match =>
        {
            var poolPath = match.Groups[1].Value;
            return GetDescriptor(poolPath, tagList, context);
        });
    }

    /// <summary>
    /// Gets a room description combining multiple environmental elements.
    /// </summary>
    public string GenerateRoomAtmosphere(IEnumerable<string> roomTags)
    {
        var tags = roomTags.ToList();

        var lighting = GetDescriptor("environmental.lighting", tags);
        var sound = GetDescriptor("environmental.sounds", tags);
        var smell = GetDescriptor("environmental.smells", tags);
        var temp = GetDescriptor("environmental.temperature", tags);

        // Combine 2-3 elements for variety
        var elements = new[] { lighting, sound, smell, temp }
            .Where(e => !string.IsNullOrEmpty(e))
            .OrderBy(_ => _random.Next())
            .Take(_random.Next(2, 4))
            .ToList();

        if (elements.Count == 0) return string.Empty;

        return string.Join(" ", elements);
    }

    /// <summary>
    /// Gets a combat hit description based on damage dealt.
    /// </summary>
    public string GetCombatHitDescription(int damage, int targetMaxHealth)
    {
        var damagePercent = (double)damage / targetMaxHealth;

        var context = new DescriptorContext { DamagePercent = damagePercent };

        var hit = GetDescriptor("combat.hit_descriptions", context: context);
        var severity = GetDescriptor("combat.damage_severity", context: context);

        return $"{hit}, {severity}";
    }

    /// <summary>
    /// Gets an NPC appearance description combining multiple features.
    /// </summary>
    public string GenerateNpcAppearance()
    {
        var physical = GetDescriptor("npcs.physical_features");
        var clothing = GetDescriptor("npcs.clothing");
        var demeanor = GetDescriptor("npcs.demeanor");

        return $"Before you stands a figure with {physical}, {clothing}, {demeanor}.";
    }

    private IEnumerable<Descriptor> ApplyContextFilters(IEnumerable<Descriptor> candidates, DescriptorContext context)
    {
        if (context.DamagePercent.HasValue)
        {
            candidates = candidates.Where(d =>
                (!d.MinDamagePercent.HasValue || context.DamagePercent >= d.MinDamagePercent) &&
                (!d.MaxDamagePercent.HasValue || context.DamagePercent < d.MaxDamagePercent));
        }

        return candidates;
    }

    private Descriptor SelectWeightedAvoidingRecent(string poolPath, List<Descriptor> candidates, ThemePreset? preset)
    {
        // Get recently used IDs for this pool
        var recentIds = _recentlyUsed.TryGetValue(poolPath, out var recent)
            ? recent.ToHashSet()
            : new HashSet<string>();

        // Prefer non-recent, but fall back if all are recent
        var preferred = candidates.Where(d => !recentIds.Contains(d.Id)).ToList();
        var pool = preferred.Count > 0 ? preferred : candidates;

        // Apply theme emphasis
        if (preset != null && preset.EmphasizedTerms.Count > 0)
        {
            foreach (var desc in pool)
            {
                if (preset.EmphasizedTerms.Any(term =>
                    desc.Text.Contains(term, StringComparison.OrdinalIgnoreCase)))
                {
                    // Temporarily boost weight
                    desc.EffectiveWeight = (int)(desc.Weight * 1.5);
                }
                else
                {
                    desc.EffectiveWeight = desc.Weight;
                }
            }
        }

        // Weighted random selection
        var totalWeight = pool.Sum(d => d.EffectiveWeight ?? d.Weight);
        var roll = _random.Next(totalWeight);
        var cumulative = 0;

        foreach (var descriptor in pool)
        {
            cumulative += descriptor.EffectiveWeight ?? descriptor.Weight;
            if (roll < cumulative)
                return descriptor;
        }

        return pool[0];
    }

    private void TrackUsage(string poolPath, string descriptorId)
    {
        if (!_recentlyUsed.TryGetValue(poolPath, out var recent))
        {
            recent = new Queue<string>();
            _recentlyUsed[poolPath] = recent;
        }

        recent.Enqueue(descriptorId);

        while (recent.Count > RecentHistorySize)
        {
            recent.Dequeue();
        }
    }
}

/// <summary>
/// Context information for descriptor selection.
/// </summary>
public class DescriptorContext
{
    public double? DamagePercent { get; set; }
    public double? HealthPercent { get; set; }
    public string? ActiveTheme { get; set; }
    public IReadOnlyList<string> Tags { get; set; } = [];
}
```

---

## 9. Data Model Changes

### 9.1 Entity Changes Summary

| Entity | Change Type | Changes |
|--------|-------------|---------|
| `Player` | Modified | Add `RaceId`, `BackgroundId`, `Attributes`, `Description` |
| `Stats` | Modified | Derive from `PlayerAttributes` |
| `GameSession` | Modified | Store creation choices |

### 9.2 New Entities/Value Objects

| Type | Location | Purpose |
|------|----------|---------|
| `PlayerAttributes` | ValueObjects | Core attribute values |
| `RaceDefinition` | Definitions | Race configuration |
| `BackgroundDefinition` | Definitions | Background configuration |
| `AttributeDefinition` | Definitions | Attribute configuration |

### 9.3 New DTOs

```csharp
// Player creation DTOs
public record RaceDto(string Id, string Name, string Description, IReadOnlyDictionary<string, int> Modifiers);
public record BackgroundDto(string Id, string Name, string Category, string Description, IReadOnlyDictionary<string, int> Bonuses);
public record AttributeDto(string Id, string Name, string Abbreviation, string Description);
public record CharacterCreationDto(string Name, string RaceId, string BackgroundId, PlayerAttributes Attributes, string Description);
public record CharacterSummaryDto(/* all character info for summary screen */);
```

---

## 10. Configuration File Schemas

### File Structure
```
config/
├── schemas/
│   ├── races.schema.json
│   ├── backgrounds.schema.json
│   ├── attributes.schema.json
│   ├── lexicon.schema.json
│   ├── terminology.schema.json
│   ├── descriptors.schema.json
│   └── themes.schema.json
├── races.json
├── backgrounds.json
├── attributes.json
├── lexicon.json
├── terminology.json
├── themes.json
└── descriptors/
    ├── environmental.json
    ├── objects.json
    ├── puzzles.json
    ├── examine.json
    ├── combat.json
    ├── skillchecks.json
    ├── abilities.json
    ├── dice.json
    └── npcs.json
```

---

## 11. Logging Specifications

### Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| PlayerCreationService | Information | Character created |
| PlayerCreationService | Debug | Validation steps, selections |
| LexiconService | Debug | Term selections |
| LexiconService | Warning | Unknown term requested |
| DescriptorService | Debug | Descriptor selections |
| DescriptorService | Warning | Pool not found |
| ConfigurationProvider | Information | Config loaded |
| ConfigurationProvider | Error | Config load failure |

---

## 12. Unit Testing Requirements

### Test Count by Feature

| Feature | Test Count |
|---------|-----------|
| Player Name Validation | 12 |
| Race Selection | 10 |
| Background Selection | 10 |
| Point-Buy System | 15 |
| Player Description | 6 |
| Character Summary | 5 |
| Save Slots | 8 |
| Delete Save | 6 |
| Lexicon Service | 18 |
| Descriptor Service | 25 |
| Configuration Loading | 15 |
| **Total** | **~130** |

---

## 13. Use Cases

### UC-001: Create New Character
**Actor:** Player
**Flow:** Name → Race → Background → Attributes → Description → Summary → Confirm

### UC-002: Delete Saved Game
**Actor:** Player
**Flow:** Select save → Confirm deletion → Save removed

### UC-003: Generate Combat Description
**Actor:** System
**Flow:** Combat event → Lexicon lookup → Descriptor selection → Combined output

---

## 14. Deliverable Checklist

### Player Creation
- [ ] Name validation implemented
- [ ] Race selection with 4 default races
- [ ] Background selection with 8 defaults
- [ ] Point-buy system (25 points)
- [ ] Description field (500 chars)
- [ ] Character summary screen
- [ ] TUI creation wizard

### Save System
- [ ] Multiple save slot support
- [ ] Delete save command
- [ ] Enhanced save summaries

### Customization Foundation
- [ ] terminology.json created
- [ ] races.json created
- [ ] backgrounds.json created
- [ ] attributes.json created
- [ ] GameTerminologyService implemented

### Lexicon System
- [ ] lexicon.json created
- [ ] LexiconService implemented
- [ ] Synonym pools working
- [ ] Context-aware selection working

### Descriptor System
- [ ] All 9 descriptor categories created
- [ ] DescriptorService implemented
- [ ] Theme support working
- [ ] Weighting system working
- [ ] Combination rules working
- [ ] Recent-avoidance working

### Testing
- [ ] ~130 unit tests implemented
- [ ] All tests passing
- [ ] Integration tests for config loading

---

## 15. Acceptance Criteria

### Functional
- [ ] Players can create characters with all options
- [ ] Races modify attributes correctly
- [ ] Backgrounds grant abilities and items
- [ ] Point-buy enforces rules correctly
- [ ] Text generation shows variety (no immediate repeats)
- [ ] Theme affects descriptor selection

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] All tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete

---

*Document Version: 1.0*
*Last Updated: 2025-01-06*
*Author: Claude Code*
