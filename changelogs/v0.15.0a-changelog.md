# Changelog v0.15.0a - Core Dice Mechanics Refactor

**Version**: 0.15.0a  
**Phase**: Core Dice Mechanics Refactor  
**Date**: 2026-01-22

## Summary

Implements success-counting dice mechanics as the foundation for the d10 dice pool system. This refactor adds properties to count successes (8+), botches (1), and calculate net successes for skill checks while preserving sum-based mechanics for damage rolls.

## Added

### Domain Layer
- **`DiceConstants.cs`** - New constants file in `Domain/Constants/`:
  - `SuccessThreshold = 8` (dice showing 8-10 count as successes)
  - `BotchValue = 1` (dice showing 1 count as botches)
  - `CriticalSuccessNet = 5` (5+ net successes for critical)
  - `MinimumPool = 1` (always roll at least 1 die)
  - Success/botch/neutral probability constants

### DiceRollResult Properties
- `TotalSuccesses` - Count of dice showing 8+
- `TotalBotches` - Count of dice showing 1
- `NetSuccesses` - max(0, successes - botches)
- `IsCriticalSuccess` - True when net successes ≥ 5
- `IsFumble` - True when 0 successes AND ≥1 botch
- `RawTotal` - Sum of all dice (for damage rolls)
- `TotalDiceEvaluated` - Base rolls + explosion rolls
- `ToSumString()` - Legacy sum-based format method

### Application Layer
- `RollNetSuccesses()` - Quick roll returning net success count
- `RollDamage()` - Explicit method for sum-based damage rolls

## Changed

### DiceRollResult
- Constructor no longer requires `total` parameter (calculated internally)
- `ToString()` now shows success-counting format: `"5d10: [8,2,9,1,10] → 3S - 1B = 2 net"`
- `IsNaturalMax` and `IsNaturalOne` marked `[Obsolete]` for skill checks

### DiceService
- Advantage/disadvantage now compares `NetSuccesses` instead of `Total`
- `RollOnce()` enforces `MinimumPool` size
- Logging includes success-counting data

### Downstream Consumers
- `SkillCheckResult.DetermineSuccessLevel()` uses `IsFumble`/`IsCriticalSuccess`
- `DiceDescriptorService.GetDiceRollDescriptor()` uses success-counting
- `CombatService` and `InitiativeRoll` retain sum-based mechanics via pragma suppressions

## Technical Notes

- Combat mechanics (damage, initiative) intentionally preserve sum-based calculations
- Files using obsolete properties have `#pragma warning disable CS0618` with comments
- All existing tests updated for new constructor signature
- ~15 new unit tests for success-counting mechanics

## Breaking Changes

- `DiceRollResult` constructor signature changed (removed `total` parameter)
- `IsNaturalMax`/`IsNaturalOne` now obsolete (use `IsCriticalSuccess`/`IsFumble`)
- `AllRollTotals` for advantage/disadvantage now contains `NetSuccesses` values

## Files Modified

### Domain Layer
- ✨ `src/Core/RuneAndRust.Domain/Constants/DiceConstants.cs` (NEW)
- ✏️ `src/Core/RuneAndRust.Domain/ValueObjects/DiceRollResult.cs`
- ✏️ `src/Core/RuneAndRust.Domain/ValueObjects/SkillCheckResult.cs`
- ✏️ `src/Core/RuneAndRust.Domain/ValueObjects/InitiativeRoll.cs`
- ✏️ `src/Core/RuneAndRust.Domain/Services/CombatService.cs`

### Application Layer
- ✏️ `src/Core/RuneAndRust.Application/Services/DiceService.cs`
- ✏️ `src/Core/RuneAndRust.Application/Services/DiceDescriptorService.cs`
- ✏️ `src/Core/RuneAndRust.Application/DTOs/DiceDtos.cs`

### Tests Updated
- Multiple test files updated for new constructor signature
