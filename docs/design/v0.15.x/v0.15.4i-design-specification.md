# v0.15.4i Design Specification: Specialization Integration

**Version:** 0.15.4i
**Theme:** Specialization Integration (Archetype-Specific System Bypass Abilities)
**Author:** Claude
**Created:** 2026-01-17
**Status:** Draft
**Prerequisites:** v0.15.0 Complete (Dice Pool Refactor), v0.15.1 Complete (Skill Infrastructure), v0.15.4a Complete (Lockpicking System), v0.15.4b Complete (Terminal Hacking System), v0.15.4c Complete (ICE Countermeasures), v0.15.4d Complete (Trap Disarmament System), v0.15.4e Complete (Jury-Rigging System), v0.15.4f Complete (Glitch Exploitation System), v0.15.4g Complete (Improvised Tool Crafting), v0.15.4h Complete (Alternative Bypass Methods)

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Scrap-Tinker Abilities](#4-scrap-tinker-abilities)
5. [Ruin-Stalker Abilities](#5-ruin-stalker-abilities)
6. [Jötun-Reader Abilities](#6-jötun-reader-abilities)
7. [Gantry-Runner Abilities](#7-gantry-runner-abilities)
8. [SpecializationAbilityService](#8-specializationabilityservice-implementation)
9. [Integration with Bypass Systems](#9-integration-with-bypass-systems)
10. [Data Model Changes](#10-data-model-changes)
11. [Configuration Files](#11-configuration-files)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)

---

## 1. Executive Summary

### 1.1 Purpose

The Specialization Integration phase connects character archetypes to the System Bypass skill systems, granting unique abilities that reflect each specialization's expertise. In Aethelgard, survivors develop distinct approaches to manipulating Old World technology—the Scrap-Tinker crafts masterwork tools, the Ruin-Stalker turns traps into weapons, the Jötun-Reader communes with ancient archives, and the Gantry-Runner works with speed and precision under pressure.

This phase implements the specialization-specific abilities defined in the v0.15.4 scope breakdown, integrating them with all previous bypass systems (lockpicking, terminal hacking, trap disarmament, jury-rigging, glitch exploitation, tool crafting, and alternative methods).

### 1.2 Key Deliverables

| Category | Items |
|----------|-------|
| **Value Objects** | `SpecializationAbility`, `AbilityTriggerContext`, `AbilityActivationResult` |
| **Enums** | `BypassSpecialization`, `AbilityType`, `TriggerCondition` |
| **Services** | `SpecializationAbilityService` |
| **Configuration** | `bypass-specializations.json` |
| **Tests** | ~2 new unit tests |

### 1.3 Architectural Significance

This version establishes the **Specialization Bonus Pattern** for System Bypass that will be replicated across other skill expansions:

- **Passive Abilities**: Always-active bonuses that modify existing checks
- **Triggered Abilities**: Conditional effects that activate on specific outcomes
- **Unique Actions**: New capabilities only available to specialists
- **Cross-System Integration**: Abilities that span multiple bypass subsystems

---

## 2. Feature Overview

```
v0.15.4i Specialization Integration
├── Scrap-Tinker (Tool Crafting Focus)
│   ├── [Master Craftsman] - Craft [Masterwork Tools] from rare components
│   └── [Relock] - Re-lock bypassed locks to slow pursuit
├── Ruin-Stalker (Trap Focus)
│   ├── [Trap Artist] - Re-arm disabled traps as party defenses
│   └── [Sixth Sense] - Auto-detect traps within 10 feet
├── Jötun-Reader (Terminal Focus)
│   ├── [Deep Access] - Automatically gain [Admin-Level] on success
│   └── [Pattern Recognition] - Reduce [Glitched] DC penalty by 2
├── Gantry-Runner (Speed Focus)
│   ├── [Fast Pick] - Reduced time on bypass attempts
│   └── [Bypass Under Fire] - No penalty when in combat/danger
└── Integration Layer
    ├── Ability registration system
    ├── Trigger condition evaluation
    ├── Bypass service hooks
    └── Narrative integration
```

---

## 3. Architecture Diagrams

### 3.1 Specialization Ability Resolution Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    SPECIALIZATION ABILITY RESOLUTION FLOW                    │
└─────────────────────────────────────────────────────────────────────────────┘

    Character initiates bypass attempt
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 1: CHECK SPECIALIZATION                            │
├─────────────────────────────────────────────────────────────────────────────┤
│  Query character's specialization:                                           │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Specialization       │ System Bypass Focus                              ││
│  ├──────────────────────┼──────────────────────────────────────────────────┤│
│  │ Scrap-Tinker         │ Tool crafting, lock manipulation                 ││
│  │ Ruin-Stalker         │ Trap detection and manipulation                  ││
│  │ Jötun-Reader         │ Terminal hacking, glitch exploitation            ││
│  │ Gantry-Runner        │ Speed, working under pressure                    ││
│  │ (Other)              │ No special bypass abilities                      ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  If character has bypass-focused specialization:                            │
│  → Proceed to ability check                                                 │
│  Otherwise:                                                                 │
│  → Use standard bypass rules                                                │
└─────────────────────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 2: EVALUATE PASSIVE ABILITIES                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  Check for always-active bonuses:                                            │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Ability                │ Passive Effect                                 ││
│  ├────────────────────────┼────────────────────────────────────────────────┤│
│  │ [Sixth Sense]          │ Auto-detect traps within 10 feet               ││
│  │ [Pattern Recognition]  │ Reduce [Glitched] DC penalty by 2              ││
│  │ [Fast Pick]            │ Reduce bypass time by 1 round (min 1)          ││
│  │ [Bypass Under Fire]    │ No penalty when in combat/danger               ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  Apply all applicable passive bonuses to the current bypass attempt         │
└─────────────────────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 3: EXECUTE BYPASS                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  Perform the bypass check with applied modifiers                             │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Standard bypass resolution from v0.15.4a-h                              ││
│  │ - Roll dice pool                                                        ││
│  │ - Count successes (8-10) and botches (1)                                ││
│  │ - Calculate net successes                                               ││
│  │ - Determine outcome: Fumble / Failure / Success / Critical              ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 4: CHECK TRIGGERED ABILITIES                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  Evaluate abilities that trigger on specific outcomes:                       │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Ability              │ Trigger               │ Effect                   ││
│  ├──────────────────────┼───────────────────────┼──────────────────────────┤│
│  │ [Deep Access]        │ Terminal hack success │ Auto-gain [Admin-Level]  ││
│  │ [Master Craftsman]   │ Craft attempt         │ Can craft [Masterwork]   ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  If triggered ability applies:                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Apply ability effect                                                     ││
│  │ Log ability activation                                                   ││
│  │ Generate narrative text                                                  ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
                │
                ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      STEP 5: UNIQUE ACTIONS (Optional)                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  After bypass, specialist may have unique follow-up actions:                 │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ Ability            │ Unique Action                                      ││
│  ├────────────────────┼────────────────────────────────────────────────────┤│
│  │ [Relock]           │ Re-lock a bypassed lock (Scrap-Tinker)             ││
│  │ [Trap Artist]      │ Re-arm a disabled trap (Ruin-Stalker)              ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  These actions are available after successful bypass, not automatic         │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Specialization Ability Types

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                       ABILITY TYPE CLASSIFICATION                            │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                           PASSIVE ABILITIES                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  Always active when conditions are met. No action required.                  │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Sixth Sense] - Ruin-Stalker                                            ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Trigger: Character enters area or moves                                  ││
│  │ Effect: Automatically detect traps within 10 feet                       ││
│  │ Scope: Trap Disarmament System (v0.15.4d)                               ││
│  │                                                                          ││
│  │ Implementation:                                                          ││
│  │ - On room entry, check for traps in 10ft radius                         ││
│  │ - Skip Perception check for detection                                   ││
│  │ - Reveal trap presence (not type or DC)                                 ││
│  │ - "You sense a trap nearby..." narrative                                ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Pattern Recognition] - Jötun-Reader                                    ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Trigger: Interacting with [Glitched] technology                         ││
│  │ Effect: Reduce [Glitched] DC penalty by 2                               ││
│  │ Scope: Glitch Exploitation (v0.15.4f), all bypass systems               ││
│  │                                                                          ││
│  │ Implementation:                                                          ││
│  │ - Normal [Glitched] penalty: +2 DC                                      ││
│  │ - With ability: +0 DC (penalty negated)                                 ││
│  │ - If [Blighted] (+4 DC): reduced to +2 DC                               ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Fast Pick] - Gantry-Runner                                             ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Trigger: Any bypass attempt with time cost                               ││
│  │ Effect: Reduce time by 1 round (minimum 1 round)                        ││
│  │ Scope: Lockpicking (v0.15.4a), Terminal Hacking (v0.15.4b)              ││
│  │                                                                          ││
│  │ Implementation:                                                          ││
│  │ - 3 round terminal hack → 2 rounds                                      ││
│  │ - 1 round lock pick → 1 round (no reduction below 1)                    ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Bypass Under Fire] - Gantry-Runner                                     ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Trigger: Attempting bypass while in combat or under threat              ││
│  │ Effect: Ignore danger/distraction penalties                             ││
│  │ Scope: All bypass systems                                               ││
│  │                                                                          ││
│  │ Implementation:                                                          ││
│  │ - Standard penalty for bypass under fire: -2d10                         ││
│  │ - With ability: No penalty                                              ││
│  │ - Also negates penalties from nearby enemies                            ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          TRIGGERED ABILITIES                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│  Activate automatically when specific conditions are met.                    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Deep Access] - Jötun-Reader                                            ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Trigger: Successful terminal hack (any success, not just critical)      ││
│  │ Effect: Automatically gain [Admin-Level] access                         ││
│  │ Scope: Terminal Hacking System (v0.15.4b)                               ││
│  │                                                                          ││
│  │ Implementation:                                                          ││
│  │ - Normal success grants User-Level access                               ││
│  │ - Critical success grants Admin-Level access                            ││
│  │ - With [Deep Access]: Any success grants Admin-Level                    ││
│  │ - "Your understanding of Jötun systems runs deep..."                    ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Master Craftsman] - Scrap-Tinker                                       ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Trigger: Craft attempt with rare components                              ││
│  │ Effect: Can craft [Masterwork Tools] instead of standard                ││
│  │ Scope: Improvised Tool Crafting (v0.15.4g)                              ││
│  │                                                                          ││
│  │ Implementation:                                                          ││
│  │ - Unlocks [Masterwork Tool] recipes                                     ││
│  │ - Requires rare components (from critical success salvage)              ││
│  │ - [Masterwork Tools]: +2d10 instead of +1d10                            ││
│  │ - Higher durability (7 uses instead of 3)                               ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                          UNIQUE ACTION ABILITIES                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  Grant new actions not available to other characters.                        │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Relock] - Scrap-Tinker                                                 ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Action: Re-lock a previously bypassed lock                              ││
│  │ Requirement: Lock was opened (not destroyed)                            ││
│  │ Check: WITS DC 12                                                       ││
│  │ Effect: Lock is secured again, pursuers must pick/break                 ││
│  │ Time: 1 round                                                           ││
│  │                                                                          ││
│  │ Use Cases:                                                               ││
│  │ - Slow down pursuing enemies                                            ││
│  │ - Secure a room the party is resting in                                 ││
│  │ - Create tactical chokepoints                                           ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ [Trap Artist] - Ruin-Stalker                                            ││
│  ├─────────────────────────────────────────────────────────────────────────┤│
│  │ Action: Re-arm a disabled trap as a defense                             ││
│  │ Requirement: Trap was disabled (not destroyed/triggered)                ││
│  │ Check: WITS DC 14 (or original disarm DC)                               ││
│  │ Effect: Trap is active again, targeting enemies                         ││
│  │ Time: 2 rounds                                                          ││
│  │                                                                          ││
│  │ Use Cases:                                                               ││
│  │ - Set ambushes for pursuing enemies                                     ││
│  │ - Protect a defensive position                                          ││
│  │ - Punish enemies following the party's path                             ││
│  │                                                                          ││
│  │ Friendly Fire Prevention:                                               ││
│  │ - Party members are warned and won't trigger                            ││
│  │ - Requires marking safe paths                                           ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Service Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PRESENTATION LAYER                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│  ConsoleInputHandler          IGameRenderer                                  │
│  - ParseRelockCommand()       - RenderAbilityActivationAsync()              │
│  - ParseRearmTrapCommand()    - RenderSpecializationBonusAsync()            │
│                               - RenderUniqueActionAsync()                    │
└─────────────────────────────────────────────────────────────────────────────┘
                │                              ▲
                ▼                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                           APPLICATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  GameEngine                                                                  │
│  - HandleRelockAsync()                                                      │
│  - HandleRearmTrapAsync()                                                   │
│  - ApplySpecializationBonuses()                                             │
│  - CheckTriggeredAbilities()                                                │
└─────────────────────────────────────────────────────────────────────────────┘
                │                              ▲
                ▼                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN SERVICES                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ SpecializationAbilityService                                        │   │
│  ├─────────────────────────────────────────────────────────────────────┤   │
│  │ + GetAbilitiesFor(specialization) → IEnumerable<SpecializationAbility>│  │
│  │ + GetPassiveBonuses(character, context) → IEnumerable<PassiveBonus> │   │
│  │ + CheckTriggeredAbilities(character, result) → IEnumerable<Trigger> │   │
│  │ + GetUniqueActions(character) → IEnumerable<UniqueAction>           │   │
│  │ + ExecuteUniqueAction(character, action, target) → ActionResult     │   │
│  │ + HasAbility(character, abilityId) → bool                           │   │
│  │ + ApplyPatternRecognition(context) → ModifiedContext                │   │
│  │ + ApplyFastPick(timeRequired) → int                                 │   │
│  │ + ApplyBypassUnderFire(context) → ModifiedContext                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  Integration with Bypass Services:                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ LockpickingService.AttemptPick():                                    │   │
│  │   var bonuses = _specializationService                               │   │
│  │     .GetPassiveBonuses(character, context);                         │   │
│  │   // Apply [Fast Pick], [Bypass Under Fire]                         │   │
│  │   // After success, check for [Relock] availability                 │   │
│  │                                                                       │   │
│  │ TerminalHackingService.AttemptInfiltration():                        │   │
│  │   if (success && _specializationService                              │   │
│  │       .HasAbility(character, "deep_access"))                        │   │
│  │     accessLevel = AccessLevel.AdminLevel; // [Deep Access]          │   │
│  │                                                                       │   │
│  │ TrapDisarmamentService.EnterRoom():                                  │   │
│  │   if (_specializationService.HasAbility(character, "sixth_sense"))   │   │
│  │     AutoDetectTraps(character.Position, 10); // [Sixth Sense]       │   │
│  │                                                                       │   │
│  │ GlitchExploitationService.AttemptExploit():                          │   │
│  │   context = _specializationService                                   │   │
│  │     .ApplyPatternRecognition(context); // Reduce [Glitched] penalty │   │
│  │                                                                       │   │
│  │ ImprovisedToolCraftingService.AttemptCraft():                        │   │
│  │   if (_specializationService.HasAbility(character, "master_craftsman"))│  │
│  │     EnableMasterworkRecipes(); // [Master Craftsman]                │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
                │                              ▲
                ▼                              │
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN VALUE OBJECTS                              │
├─────────────────────────────────────────────────────────────────────────────┤
│  SpecializationAbility       AbilityTriggerContext    AbilityActivationResult│
│  - AbilityId                 - BypassType             - AbilityActivated     │
│  - AbilityName               - OutcomeType            - EffectApplied        │
│  - Specialization            - CurrentContext         - ModifiedResult       │
│  - AbilityType               - TargetState            - NarrativeText        │
│  - TriggerCondition                                                          │
│  - Effect                    UniqueActionResult       PassiveBonus           │
│  - NarrativeText             - ActionSucceeded        - BonusType            │
│                              - TargetModified         - Modifier             │
│                              - TimeSpent              - AppliesTo            │
│                              - NarrativeText          - Description          │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 4. Scrap-Tinker Abilities

### 4.1 [Master Craftsman]

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/SpecializationAbility.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

/// <summary>
/// Represents the [Master Craftsman] ability for Scrap-Tinker specialization.
/// Allows crafting of [Masterwork Tools] from rare components.
/// </summary>
public static partial class SpecializationAbilities
{
    /// <summary>
    /// [Master Craftsman] - Scrap-Tinker ability.
    /// Unlocks Masterwork Tool crafting recipes.
    /// </summary>
    public static SpecializationAbility MasterCraftsman => new(
        AbilityId: "master_craftsman",
        AbilityName: "[Master Craftsman]",
        Specialization: BypassSpecialization.ScrapTinker,
        AbilityType: AbilityType.Triggered,
        TriggerCondition: TriggerCondition.OnCraftAttempt,
        Effect: new AbilityEffect(
            EffectType: EffectType.UnlockRecipes,
            Description: "Unlocks [Masterwork Tool] recipes requiring rare components.",
            Parameters: new Dictionary<string, object>
            {
                ["RecipeCategory"] = "Masterwork",
                ["BonusIncrease"] = 1, // +2d10 instead of +1d10
                ["DurabilityMultiplier"] = 2.33 // 7 uses instead of 3
            }),
        NarrativeText: "Your intimate understanding of salvage and assembly allows you to " +
                      "create tools of exceptional quality—almost as good as Old World manufacture.");

    /// <summary>
    /// Masterwork tool recipes unlocked by [Master Craftsman].
    /// </summary>
    public static IReadOnlyList<MasterworkRecipe> MasterworkRecipes => new List<MasterworkRecipe>
    {
        new("Masterwork Lockpicks", "Precision lockpicks",
            RequiredComponents: new[] { "[Encryption Chip]", "[High-Tension Spring] x2" },
            CraftDc: 16, Bonus: 2, Durability: 7,
            BypassType: BypassType.Lockpicking),

        new("Masterwork Terminal Probe", "Advanced terminal interface",
            RequiredComponents: new[] { "[Circuit Fragment] x2", "[Biometric Sensor]" },
            CraftDc: 18, Bonus: 2, Durability: 7,
            BypassType: BypassType.TerminalHacking),

        new("Masterwork Trap Kit", "Professional disarmament tools",
            RequiredComponents: new[] { "[Trigger Mechanism]", "[Sensor Module]" },
            CraftDc: 16, Bonus: 2, Durability: 7,
            BypassType: BypassType.TrapDisarmament)
    }.AsReadOnly();
}

/// <summary>
/// A masterwork recipe unlocked by [Master Craftsman].
/// </summary>
/// <param name="Name">Display name of the tool.</param>
/// <param name="Description">Flavor description.</param>
/// <param name="RequiredComponents">Rare components needed.</param>
/// <param name="CraftDc">Difficulty to craft.</param>
/// <param name="Bonus">Dice bonus when used (+2d10).</param>
/// <param name="Durability">Number of uses before breaking.</param>
/// <param name="BypassType">What bypass system it aids.</param>
public readonly record struct MasterworkRecipe(
    string Name,
    string Description,
    string[] RequiredComponents,
    int CraftDc,
    int Bonus,
    int Durability,
    BypassType BypassType);
```

### 4.2 [Relock]

```csharp
/// <summary>
/// [Relock] - Scrap-Tinker ability.
/// Can re-lock a bypassed lock to slow pursuit.
/// </summary>
public static SpecializationAbility Relock => new(
    AbilityId: "relock",
    AbilityName: "[Relock]",
    Specialization: BypassSpecialization.ScrapTinker,
    AbilityType: AbilityType.UniqueAction,
    TriggerCondition: TriggerCondition.ManualActivation,
    Effect: new AbilityEffect(
        EffectType: EffectType.UniqueAction,
        Description: "Re-lock a previously bypassed lock.",
        Parameters: new Dictionary<string, object>
        {
            ["CheckAttribute"] = "WITS",
            ["CheckDc"] = 12,
            ["TimeRequired"] = 1, // rounds
            ["RequiresIntactLock"] = true // Cannot relock if door was broken
        }),
    NarrativeText: "With practiced fingers, you manipulate the lock mechanism back into " +
                  "its secured position. Pursuers will have to deal with it themselves.");

/// <summary>
/// Attempts to relock a previously bypassed lock.
/// </summary>
/// <param name="character">Character attempting the relock.</param>
/// <param name="lock">The lock to be relocked.</param>
/// <returns>Result of the relock attempt.</returns>
public static UniqueActionResult AttemptRelock(Character character, LockContext @lock)
{
    // Validate prerequisites
    if (!@lock.WasPickedOpen)
    {
        return UniqueActionResult.Failed(
            "Cannot relock—the lock was not picked open (was it broken?).");
    }

    if (@lock.IsJammed)
    {
        return UniqueActionResult.Failed(
            "Cannot relock—the mechanism is jammed from a previous fumble.");
    }

    // Perform WITS check DC 12
    var wits = character.GetAttribute(AttributeType.Wits);
    var rollResult = DiceRoller.RollPool(wits);
    var netSuccesses = rollResult.Successes - rollResult.Botches;

    if (netSuccesses > 0)
    {
        return UniqueActionResult.Success(
            timeSpent: 1,
            narrative: "The lock clicks back into place. Anyone following will need to " +
                      "pick it themselves—or break it down.");
    }
    else
    {
        return UniqueActionResult.Failed(
            "The mechanism resists your attempts. The lock remains open.");
    }
}
```

---

## 5. Ruin-Stalker Abilities

### 5.1 [Trap Artist]

```csharp
/// <summary>
/// [Trap Artist] - Ruin-Stalker ability.
/// Re-arm disabled traps as party defenses.
/// </summary>
public static SpecializationAbility TrapArtist => new(
    AbilityId: "trap_artist",
    AbilityName: "[Trap Artist]",
    Specialization: BypassSpecialization.RuinStalker,
    AbilityType: AbilityType.UniqueAction,
    TriggerCondition: TriggerCondition.ManualActivation,
    Effect: new AbilityEffect(
        EffectType: EffectType.UniqueAction,
        Description: "Re-arm a disabled trap to target enemies.",
        Parameters: new Dictionary<string, object>
        {
            ["CheckAttribute"] = "WITS",
            ["BaseDc"] = 14,
            ["AlternativeDc"] = "OriginalDisarmDc",
            ["TimeRequired"] = 2, // rounds
            ["RequiresDisabledTrap"] = true,
            ["FriendlyFirePrevention"] = true
        }),
    NarrativeText: "You carefully reverse the disarmament process, resetting springs and " +
                  "triggers. The trap is live again—but this time, it serves your purposes.");

/// <summary>
/// Attempts to re-arm a disabled trap.
/// </summary>
/// <param name="character">Character attempting the re-arm.</param>
/// <param name="trap">The trap to be re-armed.</param>
/// <returns>Result of the re-arm attempt.</returns>
public static UniqueActionResult AttemptRearmTrap(Character character, TrapDisarmState trap)
{
    // Validate prerequisites
    if (trap.Status != DisarmStatus.Disabled)
    {
        return UniqueActionResult.Failed(
            "Cannot re-arm—the trap was not properly disabled (was it triggered or destroyed?).");
    }

    // DC is the higher of 14 or the original disarm DC
    var dc = Math.Max(14, trap.OriginalDc);

    // Perform WITS check
    var wits = character.GetAttribute(AttributeType.Wits);
    var rollResult = DiceRoller.RollPool(wits);
    var netSuccesses = rollResult.Successes - rollResult.Botches;

    if (netSuccesses > 0)
    {
        return UniqueActionResult.Success(
            timeSpent: 2,
            targetModified: true,
            narrative: $"The {trap.TrapType} is live once more. You mark a safe path for " +
                      "your allies—enemies won't be so fortunate.");
    }
    else if (rollResult.Successes == 0 && rollResult.Botches > 0)
    {
        // Fumble - trap triggers on the Ruin-Stalker
        return UniqueActionResult.Fumble(
            timeSpent: 2,
            narrative: "The trap snaps shut unexpectedly! Your own creation turns against you.",
            consequence: TrapTriggerConsequence.ForTrap(trap.TrapType));
    }
    else
    {
        return UniqueActionResult.Failed(
            "The mechanism refuses to reset properly. The trap remains inert.");
    }
}
```

### 5.2 [Sixth Sense]

```csharp
/// <summary>
/// [Sixth Sense] - Ruin-Stalker ability.
/// Automatically detect traps within 10 feet.
/// </summary>
public static SpecializationAbility SixthSense => new(
    AbilityId: "sixth_sense",
    AbilityName: "[Sixth Sense]",
    Specialization: BypassSpecialization.RuinStalker,
    AbilityType: AbilityType.Passive,
    TriggerCondition: TriggerCondition.OnMovement,
    Effect: new AbilityEffect(
        EffectType: EffectType.AutoDetection,
        Description: "Automatically detect traps within 10 feet, bypassing Perception check.",
        Parameters: new Dictionary<string, object>
        {
            ["DetectionRadius"] = 10, // feet
            ["SkipsPerceptionCheck"] = true,
            ["RevealsPresenceOnly"] = true // Does not reveal type or DC
        }),
    NarrativeText: "Years of crawling through deadly ruins have honed your senses. You feel " +
                  "the subtle wrongness of a trap before you see it—a shift in air pressure, " +
                  "a too-perfect arrangement of debris.");

/// <summary>
/// Checks for automatic trap detection based on [Sixth Sense].
/// </summary>
/// <param name="character">Character with the ability.</param>
/// <param name="position">Current position.</param>
/// <param name="trapsInArea">All traps in the current area.</param>
/// <returns>Detected traps within range.</returns>
public static IEnumerable<TrapDetectionResult> CheckSixthSense(
    Character character,
    Position position,
    IEnumerable<TrapContext> trapsInArea)
{
    const int detectionRadius = 10;

    foreach (var trap in trapsInArea)
    {
        if (!trap.IsDetected && trap.Position.DistanceTo(position) <= detectionRadius)
        {
            yield return new TrapDetectionResult(
                TrapId: trap.TrapId,
                IsDetected: true,
                TypeRevealed: false, // [Sixth Sense] only reveals presence
                DcRevealed: false,
                NarrativeText: "Your instincts scream danger. There's a trap somewhere " +
                              "very close—you can feel it in your bones.");
        }
    }
}
```

---

## 6. Jötun-Reader Abilities

### 6.1 [Deep Access]

```csharp
/// <summary>
/// [Deep Access] - Jötun-Reader ability.
/// Automatically gain [Admin-Level] access on any successful terminal hack.
/// </summary>
public static SpecializationAbility DeepAccess => new(
    AbilityId: "deep_access",
    AbilityName: "[Deep Access]",
    Specialization: BypassSpecialization.JotunReader,
    AbilityType: AbilityType.Triggered,
    TriggerCondition: TriggerCondition.OnTerminalHackSuccess,
    Effect: new AbilityEffect(
        EffectType: EffectType.UpgradeResult,
        Description: "Any successful terminal hack grants Admin-Level access.",
        Parameters: new Dictionary<string, object>
        {
            ["UpgradeAccessLevel"] = AccessLevel.AdminLevel,
            ["AppliesToAnySuccess"] = true // Not just critical
        }),
    NarrativeText: "You speak the language of the Jötun machines. Where others see " +
                  "incomprehensible symbols, you see pathways and permissions. The system " +
                  "opens itself to you completely.");

/// <summary>
/// Applies [Deep Access] to upgrade terminal access level.
/// </summary>
/// <param name="baseResult">Original infiltration result.</param>
/// <returns>Modified result with Admin-Level access.</returns>
public static TerminalInfiltrationResult ApplyDeepAccess(TerminalInfiltrationResult baseResult)
{
    if (!baseResult.Success)
        return baseResult; // Only applies on success

    if (baseResult.AccessLevel == AccessLevel.AdminLevel)
        return baseResult; // Already admin (critical success)

    return baseResult with
    {
        AccessLevel = AccessLevel.AdminLevel,
        NarrativeText = baseResult.NarrativeText +
            "\n\n[Deep Access]: Your communion with Jötun systems grants you full " +
            "administrative privileges. Hidden files and locked functions reveal themselves."
    };
}
```

### 6.2 [Pattern Recognition]

```csharp
/// <summary>
/// [Pattern Recognition] - Jötun-Reader ability.
/// Reduce [Glitched] DC penalty by 2.
/// </summary>
public static SpecializationAbility PatternRecognition => new(
    AbilityId: "pattern_recognition",
    AbilityName: "[Pattern Recognition]",
    Specialization: BypassSpecialization.JotunReader,
    AbilityType: AbilityType.Passive,
    TriggerCondition: TriggerCondition.OnGlitchedInteraction,
    Effect: new AbilityEffect(
        EffectType: EffectType.ReducePenalty,
        Description: "Reduce [Glitched] DC penalty by 2 (from +2 to +0).",
        Parameters: new Dictionary<string, object>
        {
            ["PenaltyReduction"] = 2,
            ["AppliesTo"] = new[] { CorruptionLevel.Glitched, CorruptionLevel.Blighted }
        }),
    NarrativeText: "The chaotic flickering of corrupted technology holds no terror for you. " +
                  "You've learned to read the patterns within the chaos, predicting the " +
                  "glitch cycles with uncanny accuracy.");

/// <summary>
/// Applies [Pattern Recognition] to reduce glitch penalties.
/// </summary>
/// <param name="context">Current bypass context.</param>
/// <returns>Modified context with reduced penalty.</returns>
public static BypassContext ApplyPatternRecognition(BypassContext context)
{
    if (context.CorruptionLevel == CorruptionLevel.Normal)
        return context; // No glitch penalty to reduce

    var originalPenalty = context.CorruptionLevel switch
    {
        CorruptionLevel.Glitched => 2,
        CorruptionLevel.Blighted => 4,
        _ => 0
    };

    var reducedPenalty = Math.Max(0, originalPenalty - 2);

    return context with
    {
        DcModifier = context.DcModifier - originalPenalty + reducedPenalty,
        AppliedBonuses = context.AppliedBonuses.Append(
            new AppliedBonus("[Pattern Recognition]", $"-{originalPenalty - reducedPenalty} DC"))
    };
}
```

---

## 7. Gantry-Runner Abilities

### 7.1 [Fast Pick]

```csharp
/// <summary>
/// [Fast Pick] - Gantry-Runner ability.
/// Reduce bypass time by 1 round (minimum 1).
/// </summary>
public static SpecializationAbility FastPick => new(
    AbilityId: "fast_pick",
    AbilityName: "[Fast Pick]",
    Specialization: BypassSpecialization.GantryRunner,
    AbilityType: AbilityType.Passive,
    TriggerCondition: TriggerCondition.OnBypassAttempt,
    Effect: new AbilityEffect(
        EffectType: EffectType.ReduceTime,
        Description: "Reduce bypass time by 1 round (minimum 1 round).",
        Parameters: new Dictionary<string, object>
        {
            ["TimeReduction"] = 1,
            ["MinimumTime"] = 1
        }),
    NarrativeText: "Speed is survival in the gantries. You've learned to work fast, " +
                  "your fingers dancing across mechanisms with practiced efficiency.");

/// <summary>
/// Applies [Fast Pick] to reduce bypass time.
/// </summary>
/// <param name="baseTime">Original time in rounds.</param>
/// <returns>Reduced time (minimum 1).</returns>
public static int ApplyFastPick(int baseTime)
{
    return Math.Max(1, baseTime - 1);
}
```

### 7.2 [Bypass Under Fire]

```csharp
/// <summary>
/// [Bypass Under Fire] - Gantry-Runner ability.
/// No penalty when attempting bypass in combat or danger.
/// </summary>
public static SpecializationAbility BypassUnderFire => new(
    AbilityId: "bypass_under_fire",
    AbilityName: "[Bypass Under Fire]",
    Specialization: BypassSpecialization.GantryRunner,
    AbilityType: AbilityType.Passive,
    TriggerCondition: TriggerCondition.OnBypassInDanger,
    Effect: new AbilityEffect(
        EffectType: EffectType.NegatePenalty,
        Description: "Ignore penalties for attempting bypass while in combat or under threat.",
        Parameters: new Dictionary<string, object>
        {
            ["NegatesPenalties"] = new[]
            {
                "InCombat", // Standard -2d10 penalty
                "EnemiesNearby", // -1d10 per adjacent enemy
                "UnderFire", // -2d10 when being attacked
                "Distracted" // -1d10 general distraction
            }
        }),
    NarrativeText: "Bullets whiz past. Blades flash in your peripheral vision. None of it " +
                  "matters. The lock is all that exists. Your hands are steady, your focus absolute.");

/// <summary>
/// Applies [Bypass Under Fire] to negate danger penalties.
/// </summary>
/// <param name="context">Current bypass context.</param>
/// <returns>Modified context with penalties negated.</returns>
public static BypassContext ApplyBypassUnderFire(BypassContext context)
{
    var dangerPenalties = context.Penalties
        .Where(p => p.Type is PenaltyType.InCombat or
                           PenaltyType.EnemiesNearby or
                           PenaltyType.UnderFire or
                           PenaltyType.Distracted);

    var negatedAmount = dangerPenalties.Sum(p => p.DiceModifier);

    return context with
    {
        DicePoolModifier = context.DicePoolModifier + negatedAmount, // Restore lost dice
        Penalties = context.Penalties.Except(dangerPenalties).ToList(),
        AppliedBonuses = context.AppliedBonuses.Append(
            new AppliedBonus("[Bypass Under Fire]", $"Negated {-negatedAmount}d10 danger penalty"))
    };
}
```

---

## 8. SpecializationAbilityService Implementation

### 8.1 Service Definition

**File:** `src/Core/RuneAndRust.Domain/Services/SpecializationAbilityService.cs`

```csharp
namespace RuneAndRust.Domain.Services;

/// <summary>
/// Service for managing and applying specialization-specific bypass abilities.
/// </summary>
/// <remarks>
/// Each bypass-focused specialization grants unique abilities that modify
/// how characters interact with locks, terminals, traps, and technology.
/// This service centralizes ability lookup, trigger evaluation, and effect application.
/// </remarks>
public class SpecializationAbilityService
{
    private readonly ILogger<SpecializationAbilityService> _logger;
    private readonly IDiceRollerService _diceRoller;
    private readonly IConfigurationLoader _config;

    private readonly Dictionary<BypassSpecialization, IReadOnlyList<SpecializationAbility>> _abilities;

    /// <summary>
    /// Initializes a new instance of the SpecializationAbilityService.
    /// </summary>
    public SpecializationAbilityService(
        ILogger<SpecializationAbilityService> logger,
        IDiceRollerService diceRoller,
        IConfigurationLoader config)
    {
        _logger = logger;
        _diceRoller = diceRoller;
        _config = config;

        _abilities = InitializeAbilities();
    }

    /// <summary>
    /// Gets all bypass abilities for a given specialization.
    /// </summary>
    /// <param name="specialization">The character's specialization.</param>
    /// <returns>All bypass abilities for that specialization.</returns>
    public IEnumerable<SpecializationAbility> GetAbilitiesFor(BypassSpecialization specialization)
    {
        _logger.LogDebug("Getting abilities for {Specialization}", specialization);

        if (_abilities.TryGetValue(specialization, out var abilities))
            return abilities;

        return Enumerable.Empty<SpecializationAbility>();
    }

    /// <summary>
    /// Gets all passive bonuses that apply to the current bypass context.
    /// </summary>
    /// <param name="character">Character attempting bypass.</param>
    /// <param name="context">Current bypass context.</param>
    /// <returns>Applicable passive bonuses.</returns>
    public IEnumerable<PassiveBonus> GetPassiveBonuses(Character character, BypassContext context)
    {
        var specialization = GetBypassSpecialization(character);
        if (specialization == BypassSpecialization.None)
            yield break;

        var abilities = GetAbilitiesFor(specialization)
            .Where(a => a.AbilityType == AbilityType.Passive);

        foreach (var ability in abilities)
        {
            if (ShouldApplyPassive(ability, context))
            {
                _logger.LogDebug("Applying passive ability {Ability}", ability.AbilityName);
                yield return CreatePassiveBonus(ability, context);
            }
        }
    }

    /// <summary>
    /// Checks for triggered abilities based on bypass outcome.
    /// </summary>
    /// <param name="character">Character who performed bypass.</param>
    /// <param name="result">Result of the bypass attempt.</param>
    /// <returns>Triggered abilities and their effects.</returns>
    public IEnumerable<AbilityActivationResult> CheckTriggeredAbilities(
        Character character,
        BypassResult result)
    {
        var specialization = GetBypassSpecialization(character);
        if (specialization == BypassSpecialization.None)
            yield break;

        var abilities = GetAbilitiesFor(specialization)
            .Where(a => a.AbilityType == AbilityType.Triggered);

        foreach (var ability in abilities)
        {
            if (ShouldTrigger(ability, result))
            {
                _logger.LogInformation(
                    "Ability {Ability} triggered for {CharacterId}",
                    ability.AbilityName, character.Id);

                yield return ActivateAbility(ability, character, result);
            }
        }
    }

    /// <summary>
    /// Gets unique actions available to the character.
    /// </summary>
    /// <param name="character">Character to check.</param>
    /// <returns>Available unique actions.</returns>
    public IEnumerable<UniqueAction> GetUniqueActions(Character character)
    {
        var specialization = GetBypassSpecialization(character);
        if (specialization == BypassSpecialization.None)
            yield break;

        var abilities = GetAbilitiesFor(specialization)
            .Where(a => a.AbilityType == AbilityType.UniqueAction);

        foreach (var ability in abilities)
        {
            yield return new UniqueAction(
                ActionId: ability.AbilityId,
                ActionName: ability.AbilityName,
                Description: ability.Effect.Description,
                Specialization: specialization);
        }
    }

    /// <summary>
    /// Executes a unique action.
    /// </summary>
    /// <param name="character">Character performing the action.</param>
    /// <param name="actionId">ID of the action to execute.</param>
    /// <param name="target">Target of the action (lock, trap, etc.).</param>
    /// <returns>Result of the action.</returns>
    public UniqueActionResult ExecuteUniqueAction(
        Character character,
        string actionId,
        object target)
    {
        _logger.LogInformation(
            "Character {CharacterId} executing unique action {ActionId}",
            character.Id, actionId);

        return actionId switch
        {
            "relock" when target is LockContext @lock =>
                SpecializationAbilities.AttemptRelock(character, @lock),

            "trap_artist" when target is TrapDisarmState trap =>
                SpecializationAbilities.AttemptRearmTrap(character, trap),

            _ => UniqueActionResult.Failed($"Unknown action or invalid target: {actionId}")
        };
    }

    /// <summary>
    /// Checks if a character has a specific ability.
    /// </summary>
    public bool HasAbility(Character character, string abilityId)
    {
        var specialization = GetBypassSpecialization(character);
        if (specialization == BypassSpecialization.None)
            return false;

        return GetAbilitiesFor(specialization)
            .Any(a => a.AbilityId == abilityId);
    }

    /// <summary>
    /// Applies [Pattern Recognition] to a bypass context.
    /// </summary>
    public BypassContext ApplyPatternRecognition(BypassContext context)
    {
        return SpecializationAbilities.ApplyPatternRecognition(context);
    }

    /// <summary>
    /// Applies [Fast Pick] to reduce bypass time.
    /// </summary>
    public int ApplyFastPick(int baseTime)
    {
        return SpecializationAbilities.ApplyFastPick(baseTime);
    }

    /// <summary>
    /// Applies [Bypass Under Fire] to negate danger penalties.
    /// </summary>
    public BypassContext ApplyBypassUnderFire(BypassContext context)
    {
        return SpecializationAbilities.ApplyBypassUnderFire(context);
    }

    // ==========================================================================
    // PRIVATE HELPERS
    // ==========================================================================

    private Dictionary<BypassSpecialization, IReadOnlyList<SpecializationAbility>> InitializeAbilities()
    {
        return new Dictionary<BypassSpecialization, IReadOnlyList<SpecializationAbility>>
        {
            [BypassSpecialization.ScrapTinker] = new List<SpecializationAbility>
            {
                SpecializationAbilities.MasterCraftsman,
                SpecializationAbilities.Relock
            }.AsReadOnly(),

            [BypassSpecialization.RuinStalker] = new List<SpecializationAbility>
            {
                SpecializationAbilities.TrapArtist,
                SpecializationAbilities.SixthSense
            }.AsReadOnly(),

            [BypassSpecialization.JotunReader] = new List<SpecializationAbility>
            {
                SpecializationAbilities.DeepAccess,
                SpecializationAbilities.PatternRecognition
            }.AsReadOnly(),

            [BypassSpecialization.GantryRunner] = new List<SpecializationAbility>
            {
                SpecializationAbilities.FastPick,
                SpecializationAbilities.BypassUnderFire
            }.AsReadOnly()
        };
    }

    private BypassSpecialization GetBypassSpecialization(Character character)
    {
        // Map character's specialization to bypass specialization
        return character.Specialization switch
        {
            "Scrap-Tinker" => BypassSpecialization.ScrapTinker,
            "Ruin-Stalker" => BypassSpecialization.RuinStalker,
            "Jötun-Reader" => BypassSpecialization.JotunReader,
            "Gantry-Runner" => BypassSpecialization.GantryRunner,
            _ => BypassSpecialization.None
        };
    }

    private bool ShouldApplyPassive(SpecializationAbility ability, BypassContext context)
    {
        return ability.TriggerCondition switch
        {
            TriggerCondition.OnMovement => true, // Always check on movement
            TriggerCondition.OnGlitchedInteraction =>
                context.CorruptionLevel is CorruptionLevel.Glitched or CorruptionLevel.Blighted,
            TriggerCondition.OnBypassAttempt => true, // Always check on bypass
            TriggerCondition.OnBypassInDanger => context.IsInDanger,
            _ => false
        };
    }

    private bool ShouldTrigger(SpecializationAbility ability, BypassResult result)
    {
        return ability.TriggerCondition switch
        {
            TriggerCondition.OnTerminalHackSuccess =>
                result.BypassType == BypassType.TerminalHacking && result.Success,
            TriggerCondition.OnCraftAttempt =>
                result.BypassType == BypassType.ToolCrafting,
            _ => false
        };
    }

    private PassiveBonus CreatePassiveBonus(SpecializationAbility ability, BypassContext context)
    {
        return ability.AbilityId switch
        {
            "sixth_sense" => new PassiveBonus(
                BonusType: PassiveBonusType.AutoDetection,
                Description: ability.Effect.Description,
                AppliesTo: BypassType.TrapDisarmament),

            "pattern_recognition" => new PassiveBonus(
                BonusType: PassiveBonusType.DcReduction,
                Modifier: -2,
                Description: "Reduce [Glitched] penalty by 2",
                AppliesTo: BypassType.All),

            "fast_pick" => new PassiveBonus(
                BonusType: PassiveBonusType.TimeReduction,
                Modifier: -1,
                Description: "Reduce bypass time by 1 round",
                AppliesTo: BypassType.All),

            "bypass_under_fire" => new PassiveBonus(
                BonusType: PassiveBonusType.PenaltyNegation,
                Description: "Ignore danger penalties",
                AppliesTo: BypassType.All),

            _ => new PassiveBonus(
                BonusType: PassiveBonusType.Other,
                Description: ability.Effect.Description,
                AppliesTo: BypassType.All)
        };
    }

    private AbilityActivationResult ActivateAbility(
        SpecializationAbility ability,
        Character character,
        BypassResult result)
    {
        return ability.AbilityId switch
        {
            "deep_access" => new AbilityActivationResult(
                AbilityActivated: true,
                AbilityName: ability.AbilityName,
                EffectApplied: "Access level upgraded to Admin-Level",
                NarrativeText: ability.NarrativeText),

            "master_craftsman" => new AbilityActivationResult(
                AbilityActivated: true,
                AbilityName: ability.AbilityName,
                EffectApplied: "Masterwork recipes unlocked",
                NarrativeText: ability.NarrativeText),

            _ => new AbilityActivationResult(
                AbilityActivated: false,
                AbilityName: ability.AbilityName,
                EffectApplied: "No effect",
                NarrativeText: "")
        };
    }
}
```

---

## 9. Integration with Bypass Systems

### 9.1 Integration Points

| Bypass System | Ability | Integration Point |
|--------------|---------|-------------------|
| Lockpicking (v0.15.4a) | [Fast Pick] | Reduce time to pick |
| Lockpicking (v0.15.4a) | [Relock] | New action after success |
| Lockpicking (v0.15.4a) | [Bypass Under Fire] | Negate combat penalty |
| Terminal Hacking (v0.15.4b) | [Deep Access] | Upgrade access level |
| Terminal Hacking (v0.15.4b) | [Fast Pick] | Reduce infiltration time |
| Terminal Hacking (v0.15.4b) | [Bypass Under Fire] | Negate combat penalty |
| Trap Disarmament (v0.15.4d) | [Sixth Sense] | Auto-detect nearby traps |
| Trap Disarmament (v0.15.4d) | [Trap Artist] | Re-arm disabled traps |
| Trap Disarmament (v0.15.4d) | [Bypass Under Fire] | Negate combat penalty |
| Glitch Exploitation (v0.15.4f) | [Pattern Recognition] | Reduce glitch penalty |
| Tool Crafting (v0.15.4g) | [Master Craftsman] | Unlock masterwork recipes |
| All Systems | [Bypass Under Fire] | General combat penalty immunity |

### 9.2 Hook Locations in Existing Services

```csharp
// LockpickingService.cs modifications
public async Task<LockpickResult> AttemptPickAsync(Character character, LockContext context)
{
    // NEW: Check for passive bonuses
    var bonuses = _specializationService.GetPassiveBonuses(character, context);

    // NEW: Apply [Fast Pick] if present
    if (bonuses.Any(b => b.BonusType == PassiveBonusType.TimeReduction))
        context = context with { TimeRequired = _specializationService.ApplyFastPick(context.TimeRequired) };

    // NEW: Apply [Bypass Under Fire] if present
    if (context.IsInDanger && bonuses.Any(b => b.BonusType == PassiveBonusType.PenaltyNegation))
        context = _specializationService.ApplyBypassUnderFire(context);

    // ... existing pick logic ...

    // NEW: After success, offer [Relock] if available
    if (result.Success && _specializationService.HasAbility(character, "relock"))
        result = result with { AvailableActions = result.AvailableActions.Append("Relock") };

    return result;
}

// TerminalHackingService.cs modifications
public async Task<TerminalInfiltrationResult> AttemptInfiltrationAsync(...)
{
    // ... existing infiltration logic ...

    // NEW: Apply [Deep Access] on success
    if (result.Success && _specializationService.HasAbility(character, "deep_access"))
        result = SpecializationAbilities.ApplyDeepAccess(result);

    return result;
}

// TrapDisarmamentService.cs modifications
public async Task OnRoomEntryAsync(Character character, Room room)
{
    // NEW: Check [Sixth Sense] for auto-detection
    if (_specializationService.HasAbility(character, "sixth_sense"))
    {
        var detected = SpecializationAbilities.CheckSixthSense(
            character, character.Position, room.Traps);

        foreach (var detection in detected)
            await _renderer.RenderTrapDetectedAsync(detection);
    }
}

// GlitchExploitationService.cs modifications
public async Task<GlitchExploitResult> AttemptExploitAsync(...)
{
    // NEW: Apply [Pattern Recognition] to reduce glitch penalty
    if (_specializationService.HasAbility(character, "pattern_recognition"))
        context = _specializationService.ApplyPatternRecognition(context);

    // ... existing exploit logic ...
}

// ImprovisedToolCraftingService.cs modifications
public IEnumerable<ToolRecipe> GetAvailableRecipes(Character character)
{
    var recipes = _standardRecipes.ToList();

    // NEW: Add masterwork recipes if [Master Craftsman]
    if (_specializationService.HasAbility(character, "master_craftsman"))
        recipes.AddRange(SpecializationAbilities.MasterworkRecipes);

    return recipes;
}
```

---

## 10. Data Model Changes

### 10.1 New Value Objects

| Value Object | Layer | Description |
|-------------|-------|-------------|
| `SpecializationAbility` | Domain | Definition of a specialization ability |
| `AbilityEffect` | Domain | Effect parameters and description |
| `AbilityTriggerContext` | Domain | Context for trigger evaluation |
| `AbilityActivationResult` | Domain | Result of triggered ability |
| `PassiveBonus` | Domain | Passive bonus to apply |
| `UniqueAction` | Domain | Available unique action |
| `UniqueActionResult` | Domain | Result of unique action execution |
| `MasterworkRecipe` | Domain | Masterwork tool recipe |
| `TrapDetectionResult` | Domain | Result of [Sixth Sense] detection |

### 10.2 New Enums

| Enum | Layer | Description |
|------|-------|-------------|
| `BypassSpecialization` | Domain | Specializations with bypass focus |
| `AbilityType` | Domain | Passive, Triggered, UniqueAction |
| `TriggerCondition` | Domain | When abilities activate |
| `EffectType` | Domain | Type of effect applied |
| `PassiveBonusType` | Domain | Categories of passive bonuses |

### 10.3 Enum Definitions

```csharp
/// <summary>
/// Specializations with System Bypass focus.
/// </summary>
public enum BypassSpecialization
{
    /// <summary>No bypass specialization.</summary>
    None,

    /// <summary>Tool crafting and lock manipulation.</summary>
    ScrapTinker,

    /// <summary>Trap detection and manipulation.</summary>
    RuinStalker,

    /// <summary>Terminal hacking and glitch exploitation.</summary>
    JotunReader,

    /// <summary>Speed and working under pressure.</summary>
    GantryRunner
}

/// <summary>
/// Types of specialization abilities.
/// </summary>
public enum AbilityType
{
    /// <summary>Always active when conditions met.</summary>
    Passive,

    /// <summary>Activates on specific outcomes.</summary>
    Triggered,

    /// <summary>Grants new actions.</summary>
    UniqueAction
}

/// <summary>
/// Conditions that trigger abilities.
/// </summary>
public enum TriggerCondition
{
    /// <summary>Manual player activation.</summary>
    ManualActivation,

    /// <summary>On character movement.</summary>
    OnMovement,

    /// <summary>On any bypass attempt.</summary>
    OnBypassAttempt,

    /// <summary>On bypass while in danger.</summary>
    OnBypassInDanger,

    /// <summary>On interaction with glitched tech.</summary>
    OnGlitchedInteraction,

    /// <summary>On successful terminal hack.</summary>
    OnTerminalHackSuccess,

    /// <summary>On craft attempt.</summary>
    OnCraftAttempt
}

/// <summary>
/// Types of passive bonuses.
/// </summary>
public enum PassiveBonusType
{
    /// <summary>Automatic detection of something.</summary>
    AutoDetection,

    /// <summary>Reduction to DC.</summary>
    DcReduction,

    /// <summary>Reduction to time required.</summary>
    TimeReduction,

    /// <summary>Negation of penalties.</summary>
    PenaltyNegation,

    /// <summary>Other bonus type.</summary>
    Other
}
```

---

## 11. Configuration Files

### 11.1 bypass-specializations.json

**File:** `config/bypass-specializations.json`

```json
{
  "$schema": "./schemas/bypass-specializations.schema.json",
  "version": "0.15.4i",
  "specializations": {
    "ScrapTinker": {
      "displayName": "Scrap-Tinker",
      "description": "Masters of salvage and improvised crafting.",
      "bypassFocus": ["Lockpicking", "ToolCrafting"],
      "abilities": [
        {
          "abilityId": "master_craftsman",
          "abilityName": "[Master Craftsman]",
          "type": "Triggered",
          "trigger": "OnCraftAttempt",
          "effect": {
            "type": "UnlockRecipes",
            "description": "Unlocks [Masterwork Tool] recipes.",
            "parameters": {
              "recipeCategory": "Masterwork",
              "bonusIncrease": 1,
              "durabilityMultiplier": 2.33
            }
          },
          "narrativeText": "Your intimate understanding of salvage and assembly allows you to create tools of exceptional quality."
        },
        {
          "abilityId": "relock",
          "abilityName": "[Relock]",
          "type": "UniqueAction",
          "trigger": "ManualActivation",
          "effect": {
            "type": "UniqueAction",
            "description": "Re-lock a previously bypassed lock.",
            "parameters": {
              "checkAttribute": "WITS",
              "checkDc": 12,
              "timeRequired": 1,
              "requiresIntactLock": true
            }
          },
          "narrativeText": "With practiced fingers, you manipulate the lock mechanism back into its secured position."
        }
      ]
    },
    "RuinStalker": {
      "displayName": "Ruin-Stalker",
      "description": "Experts in navigating trapped environments.",
      "bypassFocus": ["TrapDisarmament"],
      "abilities": [
        {
          "abilityId": "trap_artist",
          "abilityName": "[Trap Artist]",
          "type": "UniqueAction",
          "trigger": "ManualActivation",
          "effect": {
            "type": "UniqueAction",
            "description": "Re-arm a disabled trap as a defense.",
            "parameters": {
              "checkAttribute": "WITS",
              "baseDc": 14,
              "alternativeDc": "OriginalDisarmDc",
              "timeRequired": 2,
              "requiresDisabledTrap": true
            }
          },
          "narrativeText": "You carefully reverse the disarmament process. The trap is live again."
        },
        {
          "abilityId": "sixth_sense",
          "abilityName": "[Sixth Sense]",
          "type": "Passive",
          "trigger": "OnMovement",
          "effect": {
            "type": "AutoDetection",
            "description": "Auto-detect traps within 10 feet.",
            "parameters": {
              "detectionRadius": 10,
              "skipsPerceptionCheck": true,
              "revealsPresenceOnly": true
            }
          },
          "narrativeText": "You feel the subtle wrongness of a trap before you see it."
        }
      ]
    },
    "JotunReader": {
      "displayName": "Jötun-Reader",
      "description": "Those who commune with ancient technology.",
      "bypassFocus": ["TerminalHacking", "GlitchExploitation"],
      "abilities": [
        {
          "abilityId": "deep_access",
          "abilityName": "[Deep Access]",
          "type": "Triggered",
          "trigger": "OnTerminalHackSuccess",
          "effect": {
            "type": "UpgradeResult",
            "description": "Any success grants Admin-Level access.",
            "parameters": {
              "upgradeAccessLevel": "AdminLevel",
              "appliesToAnySuccess": true
            }
          },
          "narrativeText": "You speak the language of the Jötun machines. The system opens itself to you completely."
        },
        {
          "abilityId": "pattern_recognition",
          "abilityName": "[Pattern Recognition]",
          "type": "Passive",
          "trigger": "OnGlitchedInteraction",
          "effect": {
            "type": "ReducePenalty",
            "description": "Reduce [Glitched] DC penalty by 2.",
            "parameters": {
              "penaltyReduction": 2,
              "appliesTo": ["Glitched", "Blighted"]
            }
          },
          "narrativeText": "You've learned to read the patterns within the chaos."
        }
      ]
    },
    "GantryRunner": {
      "displayName": "Gantry-Runner",
      "description": "Speed and precision under pressure.",
      "bypassFocus": ["All"],
      "abilities": [
        {
          "abilityId": "fast_pick",
          "abilityName": "[Fast Pick]",
          "type": "Passive",
          "trigger": "OnBypassAttempt",
          "effect": {
            "type": "ReduceTime",
            "description": "Reduce bypass time by 1 round (minimum 1).",
            "parameters": {
              "timeReduction": 1,
              "minimumTime": 1
            }
          },
          "narrativeText": "Speed is survival. Your fingers dance across mechanisms with practiced efficiency."
        },
        {
          "abilityId": "bypass_under_fire",
          "abilityName": "[Bypass Under Fire]",
          "type": "Passive",
          "trigger": "OnBypassInDanger",
          "effect": {
            "type": "NegatePenalty",
            "description": "Ignore danger penalties during bypass.",
            "parameters": {
              "negatesPenalties": ["InCombat", "EnemiesNearby", "UnderFire", "Distracted"]
            }
          },
          "narrativeText": "The lock is all that exists. Your hands are steady, your focus absolute."
        }
      ]
    }
  },
  "masterworkRecipes": [
    {
      "name": "Masterwork Lockpicks",
      "description": "Precision lockpicks of exceptional quality.",
      "requiredComponents": ["[Encryption Chip]", "[High-Tension Spring] x2"],
      "craftDc": 16,
      "bonus": 2,
      "durability": 7,
      "bypassType": "Lockpicking"
    },
    {
      "name": "Masterwork Terminal Probe",
      "description": "Advanced terminal interface tool.",
      "requiredComponents": ["[Circuit Fragment] x2", "[Biometric Sensor]"],
      "craftDc": 18,
      "bonus": 2,
      "durability": 7,
      "bypassType": "TerminalHacking"
    },
    {
      "name": "Masterwork Trap Kit",
      "description": "Professional trap disarmament tools.",
      "requiredComponents": ["[Trigger Mechanism]", "[Sensor Module]"],
      "craftDc": 16,
      "bonus": 2,
      "durability": 7,
      "bypassType": "TrapDisarmament"
    }
  ]
}
```

---

## 12. Logging Specifications

### 12.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `SpecializationAbilityService` | Information | Ability activation, unique action execution |
| `SpecializationAbilityService` | Debug | Passive bonus application, trigger evaluation |
| `SpecializationAbilityService` | Warning | Ability prerequisites not met |
| `SpecializationAbilityService` | Error | Unknown ability, invalid target |

### 12.2 Sample Log Messages

```
[Information] Ability [Deep Access] triggered for char_123
[Information] Character char_456 executing unique action relock
[Debug] Getting abilities for JotunReader: 2 abilities found
[Debug] Applying passive ability [Pattern Recognition] - reducing glitch penalty
[Debug] Applying passive ability [Fast Pick] - time reduced from 3 to 2 rounds
[Debug] [Sixth Sense] detected 1 trap within 10 feet
[Warning] Cannot execute relock - lock was not picked open (was destroyed)
[Error] Unknown unique action: invalid_action_id
```

---

## 13. Unit Testing Requirements

### 13.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| Jötun-Reader [Deep Access] | 1 |
| Ruin-Stalker [Sixth Sense] | 1 |
| **Total** | **~2** |

### 13.2 Test Specifications

**File:** `tests/RuneAndRust.Domain.Tests/Services/SpecializationAbilityServiceTests.cs`

```csharp
[TestFixture]
public class SpecializationAbilityServiceTests
{
    private SpecializationAbilityService _service;
    private Mock<ILogger<SpecializationAbilityService>> _logger;
    private Mock<IDiceRollerService> _diceRoller;
    private Mock<IConfigurationLoader> _config;

    [SetUp]
    public void SetUp()
    {
        _logger = new Mock<ILogger<SpecializationAbilityService>>();
        _diceRoller = new Mock<IDiceRollerService>();
        _config = new Mock<IConfigurationLoader>();
        _service = new SpecializationAbilityService(
            _logger.Object, _diceRoller.Object, _config.Object);
    }

    [Test]
    public void JotunReader_DeepAccess_GainsAdminOnSuccess()
    {
        // Arrange
        var character = TestCharacterFactory.CreateWithSpecialization("Jötun-Reader");
        var hackResult = new TerminalInfiltrationResult(
            Success: true,
            IsCritical: false,
            AccessLevel: AccessLevel.UserLevel, // Standard success = User
            NarrativeText: "You gained access.");

        // Act
        var triggeredAbilities = _service.CheckTriggeredAbilities(character, hackResult);
        var deepAccess = triggeredAbilities.FirstOrDefault(a => a.AbilityName == "[Deep Access]");

        // Apply the triggered ability
        var modifiedResult = SpecializationAbilities.ApplyDeepAccess(hackResult);

        // Assert
        Assert.That(deepAccess, Is.Not.Null);
        Assert.That(deepAccess.AbilityActivated, Is.True);
        Assert.That(modifiedResult.AccessLevel, Is.EqualTo(AccessLevel.AdminLevel));
    }

    [Test]
    public void RuinStalker_SixthSense_AutoDetectsNearbyTraps()
    {
        // Arrange
        var character = TestCharacterFactory.CreateWithSpecialization("Ruin-Stalker");
        var characterPosition = new Position(10, 10);
        var trapsInArea = new List<TrapContext>
        {
            new TrapContext(TrapId: "trap_1", Position: new Position(15, 10), IsDetected: false), // 5 ft - in range
            new TrapContext(TrapId: "trap_2", Position: new Position(25, 10), IsDetected: false), // 15 ft - out of range
            new TrapContext(TrapId: "trap_3", Position: new Position(12, 12), IsDetected: false)  // ~3 ft - in range
        };

        // Act
        var detected = SpecializationAbilities.CheckSixthSense(
            character, characterPosition, trapsInArea).ToList();

        // Assert
        Assert.That(detected, Has.Count.EqualTo(2)); // trap_1 and trap_3
        Assert.That(detected.All(d => d.IsDetected), Is.True);
        Assert.That(detected.All(d => !d.TypeRevealed), Is.True); // Only presence, not type
    }
}
```

---

## 14. Use Cases

### UC-001: Jötun-Reader Terminal Hack with Deep Access

**Actor:** Player (Jötun-Reader)
**Flow:** Approach secured terminal → Attempt hack → Achieve standard success → [Deep Access] triggers → Gain Admin-Level instead of User-Level → Access hidden files

### UC-002: Ruin-Stalker Trap Detection

**Actor:** Player (Ruin-Stalker)
**Flow:** Enter room → [Sixth Sense] triggers → Detect trap within 10 feet → Receive warning without Perception check → Choose to disarm or avoid

### UC-003: Scrap-Tinker Relock

**Actor:** Player (Scrap-Tinker)
**Flow:** Pick lock successfully → Party enters room → Choose to relock → Roll WITS DC 12 → Success: Lock secured → Pursuers must pick/break

### UC-004: Ruin-Stalker Re-arm Trap

**Actor:** Player (Ruin-Stalker)
**Flow:** Disarm trap → Party passes through → Choose to re-arm → Roll WITS DC 14 → Success: Trap active for enemies → Mark safe path for party

### UC-005: Gantry-Runner Bypass Under Fire

**Actor:** Player (Gantry-Runner)
**Flow:** Encounter locked door during combat → Enemies attacking → Attempt lockpick → [Bypass Under Fire] negates combat penalty → Normal roll (no -2d10)

### UC-006: Scrap-Tinker Master Craftsman

**Actor:** Player (Scrap-Tinker)
**Flow:** Gather rare components from critical successes → Access crafting → See [Masterwork] recipes → Craft Masterwork Lockpicks (DC 16) → Receive +2d10 tool with 7 uses

---

## 15. Deliverable Checklist

### Value Objects
- [ ] `SpecializationAbility` value object created
- [ ] `AbilityEffect` value object created
- [ ] `AbilityTriggerContext` value object created
- [ ] `AbilityActivationResult` value object created
- [ ] `PassiveBonus` value object created
- [ ] `UniqueAction` value object created
- [ ] `UniqueActionResult` value object created
- [ ] `MasterworkRecipe` value object created
- [ ] `TrapDetectionResult` value object created

### Enums
- [ ] `BypassSpecialization` enum created
- [ ] `AbilityType` enum created
- [ ] `TriggerCondition` enum created
- [ ] `EffectType` enum created
- [ ] `PassiveBonusType` enum created

### Abilities
- [ ] [Master Craftsman] implemented (Scrap-Tinker)
- [ ] [Relock] implemented (Scrap-Tinker)
- [ ] [Trap Artist] implemented (Ruin-Stalker)
- [ ] [Sixth Sense] implemented (Ruin-Stalker)
- [ ] [Deep Access] implemented (Jötun-Reader)
- [ ] [Pattern Recognition] implemented (Jötun-Reader)
- [ ] [Fast Pick] implemented (Gantry-Runner)
- [ ] [Bypass Under Fire] implemented (Gantry-Runner)

### Services
- [ ] `SpecializationAbilityService` implemented

### Integration
- [ ] LockpickingService integration hooks added
- [ ] TerminalHackingService integration hooks added
- [ ] TrapDisarmamentService integration hooks added
- [ ] GlitchExploitationService integration hooks added
- [ ] ImprovisedToolCraftingService integration hooks added

### Configuration Files
- [ ] `config/bypass-specializations.json` created
- [ ] `config/schemas/bypass-specializations.schema.json` created

### Testing
- [ ] ~2 unit tests implemented
- [ ] All tests passing

---

## 16. Acceptance Criteria

### Functional
- [ ] Jötun-Reader gains Admin-Level on any successful terminal hack
- [ ] Ruin-Stalker auto-detects traps within 10 feet without Perception check
- [ ] Scrap-Tinker can relock bypassed (not broken) locks
- [ ] Ruin-Stalker can re-arm disabled (not triggered) traps
- [ ] Jötun-Reader reduces [Glitched] DC penalty by 2
- [ ] Gantry-Runner reduces bypass time by 1 round
- [ ] Gantry-Runner ignores combat/danger penalties on bypass
- [ ] Scrap-Tinker can craft [Masterwork Tools] from rare components

### Quality
- [ ] Build succeeds with 0 errors
- [ ] Build succeeds with 0 warnings
- [ ] All ~2 unit tests pass
- [ ] Configuration files validate against schemas
- [ ] XML documentation complete on all public members

---

## 17. Dependencies

### 17.1 Required from Previous Versions

| Type | Location | Usage |
|------|----------|-------|
| `LockContext` | v0.15.4a | [Relock] target validation |
| `TerminalInfiltrationResult` | v0.15.4b | [Deep Access] result modification |
| `AccessLevel` | v0.15.4b | Admin-Level upgrade |
| `TrapDisarmState` | v0.15.4d | [Trap Artist] target validation |
| `CorruptionLevel` | v0.15.4a | [Pattern Recognition] trigger |
| `ToolRecipe` | v0.15.4g | Masterwork recipe integration |
| `BypassContext` | All | Passive bonus application |

### 17.2 Provides to Future Versions

| Type | Usage |
|------|-------|
| `SpecializationAbility` | Pattern for other skill specializations |
| `SpecializationAbilityService` | Reusable service pattern |
| `BypassSpecialization` | Character build options |
| `MasterworkRecipe` | Crafting system expansion |

### 17.3 Integration with v0.15.x Overview

This phase completes the v0.15.4 System Bypass Skill Expansion. All specialization abilities listed in the v0.15.x overview are implemented:

| Specialization | Abilities | Status |
|---------------|-----------|--------|
| Scrap-Tinker | [Master Craftsman], [Relock] | ✓ Implemented |
| Ruin-Stalker | [Trap Artist], [Sixth Sense] | ✓ Implemented |
| Jötun-Reader | [Deep Access], [Pattern Recognition] | ✓ Implemented |
| Gantry-Runner | [Fast Pick], [Bypass Under Fire] | ✓ Implemented |

---

## 18. Future Considerations

### 18.1 Deferred to v0.15.5 (Wasteland Survival)

- **Veiðimaðr** specialization abilities for tracking
- **Myr-Stalker** specialization abilities for terrain

### 18.2 Deferred to Future Versions

- **Multi-specialization**: Characters with multiple bypass focuses
- **Ability upgrades**: Enhanced versions of existing abilities
- **Party synergies**: Abilities that benefit from multiple specialists
- **Legendary abilities**: Rank 6+ abilities for master specialists

### 18.3 Out of Scope

- **Combat specializations**: Handled in combat system expansions
- **Social specializations**: Handled in v0.15.3 Rhetoric Expansion
- **General skill bonuses**: Handled in v0.15.1 Skill Infrastructure

---

*Document Version: 1.0*
*Last Updated: 2026-01-17*
*Author: Claude*
