# v0.15.1a Changelog - Skill Context & Modifiers

## Overview

Implements the Skill Context & Modifiers infrastructure, providing structured containers for aggregating and applying contextual modifiers to skill checks. This establishes the foundation for all skill expansions in v0.15.2-v0.15.5.

---

## Added

### Domain Layer - Enums

- **`ModifierCategory.cs`** - Categories for skill modifiers: Equipment, Situational, Environment, Target
- **`EquipmentCategory.cs`** - Equipment types: Tool, Weapon, Armor, Accessory
- **`SurfaceType.cs`** - Surface conditions for climbing/movement: Stable (+1d10), Normal, Wet (-1d10), Compromised (-2d10), Collapsing (-3d10)
- **`LightingLevel.cs`** - Lighting conditions for visual tasks: Bright (DC-1), Normal, Dim (DC+1), Dark (DC+2)
- **`ModifierDuration.cs`** - Modifier persistence: Instant, Round, Scene, Persistent
- **`Disposition.cs`** - NPC disposition: Friendly (+2d10), Neutral, Suspicious (-2d10), Hostile (-2d10)
- **`CorruptionTier.cs`** - Area corruption levels: Normal, Glitched (DC+2), Blighted (DC+4), Resonance (DC+6)

### Domain Layer - Interfaces

- **`ISkillModifier.cs`** - Base interface for all skill modifiers with `DiceModifier`, `DcModifier`, `Category`, and `ToShortDescription()`

### Domain Layer - Value Objects

- **`EquipmentModifier.cs`** - Tool/gear modifier with factory methods `Tool()` and `Armor()`
- **`SituationalModifier.cs`** - Situational modifier with factories for `TimePressure()`, `TakingTime()`, `Familiarity()`, `Distracted()`, `Assisted()`, `Fatigued()`
- **`EnvironmentModifier.cs`** - Environmental modifier with factories `FromSurface()`, `FromLighting()`, `FromCorruption()`
- **`TargetModifier.cs`** - Target-based modifier with factories `FromDisposition()`, `FromSuspicion()`, `FromRelativeStrength()`, `FromResistance()`
- **`SkillContext.cs`** - Container aggregating all modifier types with `TotalDiceModifier`, `TotalDcModifier`, `ToDescription()`, and `Empty` singleton

### Application Layer - Interfaces

- **`ISkillContextBuilder.cs`** - Fluent builder interface for constructing `SkillContext` objects

### Application Layer - Services

- **`SkillContextBuilder.cs`** - Builder implementation with:
  - Fluent chainable API
  - Non-stackable situational modifier duplicate prevention
  - Environment modifier same-type replacement
  - Auto-reset after `Build()`

### Application Layer - Service Updates

- **`SkillCheckService.PerformCheckWithContext()`** - New method accepting `SkillContext` to apply dice pool and DC modifiers

### Configuration

- **`config/equipment-modifiers.json`** - Equipment modifier definitions for common tools

### Unit Tests

- **`SkillContextTests.cs`** - 14 tests for value objects and modifier calculations
- **`SkillContextBuilderTests.cs`** - 12 tests for builder behavior

---

## Technical Details

### Modifier Stacking Rules

- **Equipment**: All stack (benefit from multiple tools)
- **Situational**: Non-stackable by default (can't be rushed twice)
- **Environment**: Same-type replaces (only one surface/lighting condition)
- **Target**: All stack (disposition + suspicion + resistance)

### Minimum Values

- **Dice Pool**: Clamped to minimum 1 die
- **Difficulty Class**: Clamped to minimum 0

---

## Backward Compatibility

- `SkillContext.Empty` singleton allows existing code to work without providing context
- Existing `PerformCheckWithDC` method unchanged
- All existing tests continue to pass

---

## Dependencies

- Builds on v0.15.0 dice pool refactor (success-counting mechanics)
- Provides foundation for v0.15.1b-e and v0.15.2-5 skill expansions

---

## Test Summary

| Test File | Tests | Status |
|-----------|-------|--------|
| `SkillContextTests.cs` | 14 | ✅ All Passing |
| `SkillContextBuilderTests.cs` | 12 | ✅ All Passing |
| **Total** | **26** | **✅ All Passing** |

---

*Version: v0.15.1a*
*Date: 2026-01-22*
