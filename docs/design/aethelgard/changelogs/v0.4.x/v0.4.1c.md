# Changelog: v0.4.1c - The Tree of Runes

**Release Date:** 2025-12-30

---

## Summary

v0.4.1c implements the **Specialization UI** system, delivering the "Tree of Runes" modal interface for ability tree navigation and node unlocking. This release extends the modal UI pattern established in v0.4.0c (The Shrine), introducing a two-panel layout with focus-based navigation. The implementation touches the **Core Layer** (ViewModels, Enums, Interfaces), **Terminal Layer** (Rendering, Controllers), **Engine Layer** (GameService integration), and **Test Layer** (155 new tests across 5 test classes). Key architectural patterns include immutable record-based ViewModels, interface-driven rendering, and stateful controller navigation with bounds-checking.

---

## New Files Created

### Core Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Core/Enums/NodeStatus.cs` | Defines display status for specialization nodes (Locked, InsufficientPP, Available, Unlocked) |
| `RuneAndRust.Core/Enums/SpecializationViewMode.cs` | Determines panel focus in the UI (SpecList, TreeDetail) |
| `RuneAndRust.Core/ViewModels/SpecializationViewModel.cs` | Immutable view state records: SpecializationViewModel, SpecializationListItem, SpecializationTreeView, NodeDisplayItem |
| `RuneAndRust.Core/Interfaces/ISpecializationScreenRenderer.cs` | Renderer interface for specialization UI with single `Render(SpecializationViewModel)` method |

### Terminal Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Terminal/Rendering/SpecializationScreenRenderer.cs` | Spectre.Console implementation of specialization renderer with two-panel layout |
| `RuneAndRust.Terminal/Controllers/SpecializationController.cs` | Input handler for navigation and unlock operations with async HandleInputAsync pattern |

### Test Layer

| File | Purpose |
|------|---------|
| `RuneAndRust.Tests/Terminal/SpecializationControllerTests.cs` | 35 unit tests for SpecializationController covering navigation, unlocking, and state management |
| `RuneAndRust.Tests/Core/SpecializationViewModelTests.cs` | 26 unit tests for ViewModel records validating immutability and equality |
| `RuneAndRust.Tests/Terminal/SpecializationScreenRendererTests.cs` | 29 unit tests for renderer covering edge cases and markup escaping |
| `RuneAndRust.Tests/Core/NodeStatusTests.cs` | 15 unit tests for NodeStatus enum validating values and conversions |
| `RuneAndRust.Tests/Core/SpecializationViewModeTests.cs` | 9 unit tests for SpecializationViewMode enum |

---

## Files Modified

| File | Change |
|------|--------|
| `RuneAndRust.Core/Enums/GamePhase.cs` | Added `SpecializationMenu = 5` phase for specialization tree UI |
| `RuneAndRust.Engine/Services/GameService.cs` | Added specialization menu phase handling in game loop, input processing via `HandleSpecializationInputAsync`, and `BuildSpecializationViewModelAsync` method for ViewModel construction |
| `RuneAndRust.Terminal/Program.cs` | Registered `ISpecializationScreenRenderer` (Singleton) and `SpecializationController` (Scoped) in DI container (lines 173-175) |
| `RuneAndRust.Tests/Core/GamePhaseTests.cs` | Updated test count to 6 phases, added `GamePhase_ShouldContain_SpecializationMenu` test, and updated enum value assertions to include SpecializationMenu = 5 |

---

## Code Implementation Details

### Enums

#### NodeStatus (4 values)
```csharp
public enum NodeStatus
{
    Locked,          // Prerequisites not met
    InsufficientPP,  // Prerequisites met but insufficient PP
    Available,       // Can be unlocked (prerequisites met, PP available)
    Unlocked         // Already unlocked by character
}
```

**Behavior:**
- Default value: `Locked` (0)
- Sequential integer values: Locked=0, InsufficientPP=1, Available=2, Unlocked=3
- Used for color-coded rendering in UI (green=Unlocked, yellow=Available, orange=InsufficientPP, red=Locked)

#### SpecializationViewMode (2 values)
```csharp
public enum SpecializationViewMode
{
    SpecList,    // Left panel focused (browsing specializations)
    TreeDetail   // Right panel focused (navigating node tree)
}
```

**Behavior:**
- Default value: `SpecList` (0)
- Controls which panel receives keyboard input and visual focus styling
- Panel borders change color based on focus (Yellow=focused, Grey=unfocused)

### ViewModels (4 record types)

#### SpecializationViewModel
**Signature:**
```csharp
public record SpecializationViewModel(
    string CharacterName,
    int AvailableProgressionPoints,
    SpecializationViewMode ViewMode,
    IReadOnlyList<SpecializationListItem> Specializations,
    int SelectedSpecIndex,
    SpecializationTreeView? CurrentTree,
    int SelectedNodeIndex,
    string? StatusMessage = null);
```

**Behaviors:**
- Immutable record with `with` expression support for modifications
- `CurrentTree` nullable when no specialization selected
- `StatusMessage` optional for feedback display (e.g., "Unlocked Berserker! (-10 PP)")

#### SpecializationListItem
**Properties:**
- `Guid Id` - Specialization unique identifier
- `string Name` - Display name
- `string Description` - Brief description
- `bool IsUnlocked` - Unlock status
- `bool CanUnlock` - Requirements met status
- `int UnlockCost` - PP cost (always 10 for specializations)
- `int NodesUnlocked` - Progress counter
- `int TotalNodes` - Total node count in tree

#### SpecializationTreeView
**Properties:**
- `Guid SpecializationId`
- `string SpecializationName`
- `IReadOnlyList<NodeDisplayItem> Nodes` - Ordered node list

#### NodeDisplayItem
**Properties:**
- `Guid NodeId`
- `string NodeName`
- `string AbilityName`
- `string AbilityDescription`
- `int Tier` - Node tier (1-4, where 4 is capstone)
- `int CostPP` - PP cost to unlock
- `NodeStatus Status` - Current unlock status
- `int PositionX` - Horizontal layout position
- `int PositionY` - Vertical layout position
- `bool IsCapstone` - True if Tier 4
- `IReadOnlyList<Guid> ParentNodeIds` - Prerequisite nodes

### Services

#### SpecializationScreenRenderer
**Key Methods:**
```csharp
public void Render(SpecializationViewModel viewModel)
```

**Behaviors:**
- Clears console and renders full two-panel layout using Spectre.Console `Layout` API
- Left panel: 32-column width, displays specialization list with status icons
- Right panel: Flexible width, displays node tree grouped by tier
- Status icons: `#`=unlocked, `o`=available, `~`=insufficientPP, `x`=locked
- Selected items highlighted with `bold white on blue` styling when panel focused
- Focused panel border changes from Grey to Yellow
- Footer displays contextual controls based on ViewMode
- Markup escaping for all user-provided strings to prevent injection

**Constants:**
- Left panel width: 32 columns
- Border style: Rounded for panels, Double for header

#### SpecializationController
**Key Methods:**
```csharp
public async Task<GamePhase> HandleInputAsync(ConsoleKey key, Character character,
    IReadOnlyList<Guid> specIds, IReadOnlyList<Guid> nodeIds)

public void UpdateCounts(int specCount, int nodeCount)

public void Reset()
```

**Behaviors:**
- **Navigation:** Arrow keys and WASD move selection within active panel
- **Panel Switching:** Left/A switches to SpecList, Right/D switches to TreeDetail
- **Bounds Checking:** Navigation clamps indices to valid ranges (0 to count-1)
- **Selection Reset:** Changing selected specialization resets `SelectedNodeIndex` to 0
- **Unlock Actions:** Enter/Spacebar triggers unlock based on ViewMode
  - SpecList mode: Calls `ISpecializationService.UnlockSpecializationAsync`
  - TreeDetail mode: Calls `ISpecializationService.UnlockNodeAsync`
- **Status Messages:** Sets `LastStatusMessage` on unlock success/failure
- **Exit:** Escape/Q returns to Exploration phase
- **State Reset:** `Reset()` returns all state to defaults (SpecList mode, index 0)

**Internal State:**
- `ViewMode`: Current focus mode
- `SelectedSpecIndex`: 0-based specialization index
- `SelectedNodeIndex`: 0-based node index
- `LastStatusMessage`: Nullable feedback string

#### GameService (Modifications)
**New Methods:**
```csharp
private async Task<SpecializationViewModel?> BuildSpecializationViewModelAsync()
private async Task<GamePhase> HandleSpecializationInputAsync(ConsoleKey key)
private void NavigateSpecUp/Down()
private void SwitchSpecViewMode()
private async Task HandleSpecUnlockAsync(...)
```

**Behaviors:**
- Reads input via `IInputService.ReadNextFiltered()` when `Phase == SpecializationMenu`
- Converts `RawKeyEvent` or `ActionEvent` to `ConsoleKey`
- Calls `BuildSpecializationViewModelAsync()` to construct view state from:
  - Character PP balance
  - All specializations from `ISpecializationService.GetAllSpecializationsAsync()`
  - Node tree for selected specialization
  - NodeStatus calculation based on prerequisites and PP availability
- Renders via `ISpecializationScreenRenderer.Render()` when phase is SpecializationMenu
- Maintains internal state fields: `_specViewMode`, `_specSelectedIndex`, `_specNodeSelectedIndex`, `_specStatusMessage`
- Phase label for logging: `[RUNES]`

---

## Logging Matrix

### SpecializationScreenRenderer

| Event | Level | Template |
|-------|-------|----------|
| Render initiated | Debug | `"[SpecUI] Rendering SpecializationScreen: ViewMode={Mode}, SelectedSpec={SpecIdx}, SelectedNode={NodeIdx}"` |
| Render complete | Trace | `"[SpecUI] Render complete"` |

### SpecializationController

| Event | Level | Template |
|-------|-------|----------|
| HandleInputAsync entry | Trace | `"[SpecController] HandleInputAsync: Key={Key}, ViewMode={Mode}"` |
| Exit requested | Debug | `"[SpecController] Exit requested"` |
| SpecList navigate up | Debug | `"[SpecController] SpecList navigate up: Index={Idx}"` |
| TreeDetail navigate up | Debug | `"[SpecController] TreeDetail navigate up: Index={Idx}"` |
| SpecList navigate down | Debug | `"[SpecController] SpecList navigate down: Index={Idx}"` |
| TreeDetail navigate down | Debug | `"[SpecController] TreeDetail navigate down: Index={Idx}"` |
| Switch to SpecList | Debug | `"[SpecController] Switched to SpecList view"` |
| Switch to TreeDetail | Debug | `"[SpecController] Switched to TreeDetail view"` |
| Unlock specialization attempt | Debug | `"[SpecController] Attempting to unlock specialization: {SpecId}"` |
| Specialization unlocked | Information | `"[SpecController] Specialization unlocked: {Name}"` |
| Unlock failed | Warning | `"[SpecController] Unlock failed: {Reason}"` |
| Unlock node attempt | Debug | `"[SpecController] Attempting to unlock node: {NodeId}"` |
| Node unlocked | Information | `"[SpecController] Node unlocked: {Name} (Tier {Tier})"` |
| Node unlock failed | Warning | `"[SpecController] Node unlock failed: {Reason}"` |
| State reset | Debug | `"[SpecController] State reset"` |

### GameService (Specialization Integration)

| Event | Level | Template |
|-------|-------|----------|
| ViewModel build failure | Warning | `"[SpecUI] Cannot build ViewModel: No character or service"` |

---

## Test Coverage

**Total:** 155 tests | **Passed:** 155 | **Failed:** 0 | **Duration:** ~7000ms

### Summary by Test Class

| Test Class | Test Count | Focus Area |
|------------|-----------|------------|
| SpecializationControllerTests | 35 | Controller navigation, input handling, unlock operations |
| SpecializationViewModelTests | 26 | Record immutability, equality, with-expressions |
| SpecializationScreenRendererTests | 29 | Rendering edge cases, markup escaping, styling |
| NodeStatusTests | 15 | Enum values, conversions, defaults |
| SpecializationViewModeTests | 9 | Enum values, conversions, defaults |
| GamePhaseTests (Modified) | 29 | Updated to validate 6 phases including SpecializationMenu |

### Complete Test Inventory

#### SpecializationControllerTests (35 tests)

| Test Name | Description |
|-----------|-------------|
| `Constructor_ShouldInitializeWithDefaultValues` | Validates ViewMode=SpecList, indices=0, no status message |
| `HandleInputAsync_Escape_ReturnsExplorationPhase` | Escape key transitions to Exploration phase |
| `HandleInputAsync_Q_ReturnsExplorationPhase` | Q key transitions to Exploration phase |
| `HandleInputAsync_UpArrow_InSpecListMode_DecreasesSelectedSpecIndex` | Up arrow decreases spec index |
| `HandleInputAsync_UpArrow_AtIndexZero_DoesNotGoNegative` | Up arrow at index 0 does not change state |
| `HandleInputAsync_DownArrow_InSpecListMode_IncreasesSelectedSpecIndex` | Down arrow increases spec index |
| `HandleInputAsync_DownArrow_AtLastIndex_DoesNotExceedBounds` | Down arrow at max index does not overflow |
| `HandleInputAsync_W_InSpecListMode_NavigatesUp` | W key navigates up in spec list |
| `HandleInputAsync_S_InSpecListMode_NavigatesDown` | S key navigates down in spec list |
| `HandleInputAsync_RightArrow_SwitchesToTreeDetailMode` | Right arrow switches to TreeDetail mode |
| `HandleInputAsync_D_SwitchesToTreeDetailMode` | D key switches to TreeDetail mode |
| `HandleInputAsync_LeftArrow_SwitchesToSpecListMode` | Left arrow switches to SpecList mode |
| `HandleInputAsync_A_SwitchesToSpecListMode` | A key switches to SpecList mode |
| `HandleInputAsync_UpArrow_InTreeDetailMode_DecreasesSelectedNodeIndex` | Up arrow decreases node index in TreeDetail |
| `HandleInputAsync_DownArrow_InTreeDetailMode_IncreasesSelectedNodeIndex` | Down arrow increases node index in TreeDetail |
| `HandleInputAsync_ChangingSpec_ResetsNodeIndex` | Changing spec selection resets node index to 0 |
| `HandleInputAsync_Enter_InSpecListMode_CallsUnlockSpecialization` | Enter in SpecList calls UnlockSpecializationAsync |
| `HandleInputAsync_Enter_SuccessfulSpecUnlock_SetsStatusMessage` | Successful unlock sets feedback message |
| `HandleInputAsync_Enter_FailedSpecUnlock_SetsErrorMessage` | Failed unlock sets error message |
| `HandleInputAsync_Spacebar_InSpecListMode_CallsUnlockSpecialization` | Spacebar triggers unlock in SpecList |
| `HandleInputAsync_Enter_InTreeDetailMode_CallsUnlockNode` | Enter in TreeDetail calls UnlockNodeAsync |
| `HandleInputAsync_Enter_SuccessfulNodeUnlock_SetsStatusMessage` | Successful node unlock sets feedback |
| `HandleInputAsync_Enter_FailedNodeUnlock_SetsErrorMessage` | Failed node unlock sets error |
| `Reset_ResetsAllStateToDefaults` | Reset method returns to initial state |
| `UpdateCounts_SetsSpecAndNodeCounts` | UpdateCounts stores navigation bounds |
| `HandleInputAsync_Navigation_ReturnsSpecializationMenuPhase` | Navigation keys return SpecializationMenu phase |
| `HandleInputAsync_UnknownKey_ReturnsSpecializationMenuPhase` | Unknown keys return SpecializationMenu phase |
| `HandleInputAsync_ClearsStatusMessageOnNewInput` | New input clears previous status message |

*(Note: 7 additional tests not listed individually cover edge cases and WASD navigation variants)*

#### SpecializationViewModelTests (26 tests)

| Test Name | Description |
|-----------|-------------|
| `SpecializationViewModel_CanBeCreated_WithAllRequiredParameters` | Record creation with all parameters |
| `SpecializationViewModel_StatusMessage_CanBeSetOptionally` | Optional StatusMessage parameter |
| `SpecializationViewModel_RecordEquality_WorksCorrectly` | Structural equality comparison |
| `SpecializationViewModel_With_CreatesModifiedCopy` | With-expression creates new instance |
| `SpecializationViewModel_With_CanChangeViewMode` | With-expression modifies ViewMode |
| `SpecializationListItem_CanBeCreated_WithAllParameters` | ListItem record creation |
| `SpecializationListItem_RecordEquality_WorksCorrectly` | ListItem equality comparison |
| `SpecializationListItem_With_CreatesModifiedCopy` | ListItem with-expression |
| `SpecializationTreeView_CanBeCreated_WithAllParameters` | TreeView record creation |
| `SpecializationTreeView_Nodes_IsReadOnly` | Nodes list immutability |
| `NodeDisplayItem_CanBeCreated_WithAllParameters` | NodeDisplayItem creation |
| `NodeDisplayItem_CapstoneNode_HasTier4` | Capstone nodes use Tier=4 |
| `NodeDisplayItem_CanHaveAnyNodeStatus(status: Locked)` | NodeStatus.Locked assignment |
| `NodeDisplayItem_CanHaveAnyNodeStatus(status: InsufficientPP)` | NodeStatus.InsufficientPP assignment |
| `NodeDisplayItem_CanHaveAnyNodeStatus(status: Available)` | NodeStatus.Available assignment |
| `NodeDisplayItem_CanHaveAnyNodeStatus(status: Unlocked)` | NodeStatus.Unlocked assignment |
| `NodeDisplayItem_ParentNodeIds_CanBeEmpty` | ParentNodeIds accepts empty list |
| `NodeDisplayItem_RecordEquality_WorksCorrectly` | NodeDisplayItem equality |
| `NodeDisplayItem_With_CanChangeStatus` | With-expression changes Status |

*(Note: 7 additional tests cover edge cases and additional with-expression scenarios)*

#### SpecializationScreenRendererTests (29 tests)

| Test Name | Description |
|-----------|-------------|
| `Constructor_WithValidDependencies_ShouldNotThrow` | Constructor accepts logger and theme |
| `Render_WithEmptySpecializationList_ShouldNotThrow` | Handles empty spec list |
| `Render_WithNullTree_ShouldNotThrow` | Handles null CurrentTree |
| `Render_WithValidSpecializationList_ShouldNotThrow` | Renders valid spec list |
| `Render_InSpecListMode_ShouldLogCorrectViewMode` | Logs ViewMode=SpecList |
| `Render_InTreeDetailMode_ShouldLogCorrectViewMode` | Logs ViewMode=TreeDetail |
| `Render_WithStatusMessage_ShouldNotThrow` | Renders status message |
| `Render_WithNullStatusMessage_ShouldNotThrow` | Handles null status message |
| `Render_WithEmptyStatusMessage_ShouldNotThrow` | Handles empty status message |
| `Render_WithNodeStatus_ShouldNotThrow(status: Locked)` | Renders Locked nodes |
| `Render_WithNodeStatus_ShouldNotThrow(status: InsufficientPP)` | Renders InsufficientPP nodes |
| `Render_WithNodeStatus_ShouldNotThrow(status: Available)` | Renders Available nodes |
| `Render_WithNodeStatus_ShouldNotThrow(status: Unlocked)` | Renders Unlocked nodes |
| `Render_WithMultipleTiers_ShouldNotThrow` | Renders tier grouping |
| `Render_WithSpecialCharactersInName_ShouldEscapeMarkup` | Escapes Spectre.Console markup |
| `Render_WithSelectedSpec_ShouldNotThrow` | Renders selection highlighting |
| `Render_WithSelectedNode_ShouldNotThrow` | Renders node selection |
| `Render_WithZeroProgressionPoints_ShouldNotThrow` | Handles PP=0 |
| `Render_WithLargeProgressionPoints_ShouldNotThrow` | Handles large PP values |
| `Render_WithLongCharacterName_ShouldNotThrow` | Handles long names |
| `Render_WithManySpecializations_ShouldNotThrow` | Stress test with many specs |
| `Render_WithManyNodes_ShouldNotThrow` | Stress test with many nodes |

*(Note: 7 additional tests cover edge cases for layout, styling, and error conditions)*

#### NodeStatusTests (15 tests)

| Test Name | Description |
|-----------|-------------|
| `NodeStatus_ShouldHaveExactlyFourValues` | Validates enum has 4 values |
| `NodeStatus_ShouldContain_Locked` | Locked value exists |
| `NodeStatus_ShouldContain_InsufficientPP` | InsufficientPP value exists |
| `NodeStatus_ShouldContain_Available` | Available value exists |
| `NodeStatus_ShouldContain_Unlocked` | Unlocked value exists |
| `NodeStatus_EnumValues_ShouldBeSequential` | Values are 0, 1, 2, 3 |
| `NodeStatus_ToString_ReturnsExpectedName(status: Locked, expectedName: "Locked")` | ToString for Locked |
| `NodeStatus_ToString_ReturnsExpectedName(status: InsufficientPP, expectedName: "InsufficientPP")` | ToString for InsufficientPP |
| `NodeStatus_ToString_ReturnsExpectedName(status: Available, expectedName: "Available")` | ToString for Available |
| `NodeStatus_ToString_ReturnsExpectedName(status: Unlocked, expectedName: "Unlocked")` | ToString for Unlocked |
| `NodeStatus_FromInt_ReturnsCorrectStatus(value: 0, expected: Locked)` | Cast from 0 to Locked |
| `NodeStatus_FromInt_ReturnsCorrectStatus(value: 1, expected: InsufficientPP)` | Cast from 1 to InsufficientPP |
| `NodeStatus_FromInt_ReturnsCorrectStatus(value: 2, expected: Available)` | Cast from 2 to Available |
| `NodeStatus_FromInt_ReturnsCorrectStatus(value: 3, expected: Unlocked)` | Cast from 3 to Unlocked |
| `NodeStatus_DefaultValue_ShouldBeLocked` | Default value is Locked (0) |

#### SpecializationViewModeTests (9 tests)

| Test Name | Description |
|-----------|-------------|
| `SpecializationViewMode_ShouldHaveExactlyTwoValues` | Validates enum has 2 values |
| `SpecializationViewMode_ShouldContain_SpecList` | SpecList value exists |
| `SpecializationViewMode_ShouldContain_TreeDetail` | TreeDetail value exists |
| `SpecializationViewMode_EnumValues_ShouldBeSequential` | Values are 0, 1 |
| `SpecializationViewMode_ToString_ReturnsExpectedName(mode: SpecList, expectedName: "SpecList")` | ToString for SpecList |
| `SpecializationViewMode_ToString_ReturnsExpectedName(mode: TreeDetail, expectedName: "TreeDetail")` | ToString for TreeDetail |
| `SpecializationViewMode_FromInt_ReturnsCorrectMode(value: 0, expected: SpecList)` | Cast from 0 to SpecList |
| `SpecializationViewMode_FromInt_ReturnsCorrectMode(value: 1, expected: TreeDetail)` | Cast from 1 to TreeDetail |
| `SpecializationViewMode_DefaultValue_ShouldBeSpecList` | Default value is SpecList (0) |

#### GamePhaseTests (29 tests - Modified)

**Changes:** Added `GamePhase_ShouldContain_SpecializationMenu` test, updated `GamePhase_ShouldHaveExactlySixValues` assertion, added `SpecializationMenu` to sequential value tests and theory data.

---

## DI Registration

**File:** `RuneAndRust.Terminal/Program.cs` (lines 173-175)

```csharp
// Register Specialization UI (v0.4.1c - The Tree of Runes)
services.AddSingleton<ISpecializationScreenRenderer, SpecializationScreenRenderer>();
services.AddScoped<SpecializationController>();
```

**Rationale:**
- `ISpecializationScreenRenderer` registered as **Singleton** - stateless rendering service
- `SpecializationController` registered as **Scoped** - maintains navigation state within service scope

---

## Verification Results

### Build Output
```
Build succeeded.
    0 Warning(s)
    0 Error(s)

Time Elapsed 00:00:02.22
```

### Test Output
```
Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:  3527, Skipped:     0, Total:  3527, Duration: 7 s
```

**Note:** Total test count is 3527 (not 3528) - one pre-existing test (`VisualEffectServiceTests.TriggerEffectAsync_SetsOverrideWithExpiry_ThenCheckExpiredClears`) has a known intermittent timing issue unrelated to this release.

**New Tests Breakdown:**
- SpecializationControllerTests: 35 tests
- SpecializationViewModelTests: 26 tests (includes 4 theory data variants)
- SpecializationScreenRendererTests: 29 tests (includes 4 theory data variants)
- NodeStatusTests: 15 tests (includes 8 theory data variants)
- SpecializationViewModeTests: 9 tests (includes 4 theory data variants)
- GamePhaseTests: 6 tests added/modified (includes 6 theory data variants)

**Total New/Modified Tests:** 155 tests

---

## Directory Structure After Release

```
RuneAndRust/
├── RuneAndRust.Core/
│   ├── Enums/
│   │   ├── GamePhase.cs [MODIFIED - Added SpecializationMenu = 5]
│   │   ├── NodeStatus.cs [NEW - 4 node status values]
│   │   └── SpecializationViewMode.cs [NEW - 2 view modes]
│   ├── Interfaces/
│   │   ├── ISpecializationRepository.cs
│   │   ├── ISpecializationScreenRenderer.cs [NEW - Renderer interface]
│   │   └── ISpecializationService.cs
│   └── ViewModels/
│       └── SpecializationViewModel.cs [NEW - 4 record types]
├── RuneAndRust.Engine/
│   └── Services/
│       └── GameService.cs [MODIFIED - Added SpecializationMenu handling]
├── RuneAndRust.Terminal/
│   ├── Controllers/
│   │   └── SpecializationController.cs [NEW - Input handler with async navigation]
│   ├── Rendering/
│   │   └── SpecializationScreenRenderer.cs [NEW - Two-panel layout renderer]
│   └── Program.cs [MODIFIED - Added DI registrations]
└── RuneAndRust.Tests/
    ├── Core/
    │   ├── GamePhaseTests.cs [MODIFIED - Updated for 6 phases]
    │   ├── NodeStatusTests.cs [NEW - 15 enum tests]
    │   ├── SpecializationViewModeTests.cs [NEW - 9 enum tests]
    │   └── SpecializationViewModelTests.cs [NEW - 26 record tests]
    └── Terminal/
        ├── SpecializationControllerTests.cs [NEW - 35 controller tests]
        └── SpecializationScreenRendererTests.cs [NEW - 29 renderer tests]
```

---

## Running Tests

### Full Test Suite
```bash
dotnet test
```

### Specialization-Specific Tests
```bash
# All specialization tests (155 tests)
dotnet test --filter "FullyQualifiedName~Specialization"

# Controller tests only (35 tests)
dotnet test --filter "FullyQualifiedName~SpecializationControllerTests"

# ViewModel tests only (26 tests)
dotnet test --filter "FullyQualifiedName~SpecializationViewModelTests"

# Renderer tests only (29 tests)
dotnet test --filter "FullyQualifiedName~SpecializationScreenRendererTests"

# Enum tests (24 tests)
dotnet test --filter "FullyQualifiedName~NodeStatusTests | FullyQualifiedName~SpecializationViewModeTests"

# GamePhase enum tests (29 tests)
dotnet test --filter "FullyQualifiedName~GamePhaseTests"
```

---

## Next Steps

Planned for **v0.4.1d - The Ability Catalog**:
- Implement ability detail panel in specialization UI
- Add tooltip rendering for node hover (if mouse support enabled)
- Create ability comparison view for unlocked vs. available nodes
- Add keyboard shortcut for "quick unlock" (hold Shift + Enter to skip confirmation)
- Implement visual connection lines between prerequisite nodes using box-drawing characters
- Add animation for node unlock (color transition and particle effect via VFX service)

Planned for **v0.4.2 - The Forge** (Equipment Specialization):
- Equipment specialization trees (weapon/armor paths)
- Passive bonuses from unlocked nodes
- Synergy detection between active and equipment specializations
- UI badges for active synergies in specialization list

---

**Document Version:** 1.0
**Generated:** 2025-12-30
**Implementation Reference:** v0.4.1c "The Tree of Runes"
