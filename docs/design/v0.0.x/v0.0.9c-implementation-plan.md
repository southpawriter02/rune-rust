# v0.0.9c Implementation Plan: Monster Tiers & Traits

**Version:** 0.0.9c
**Parent:** v0.0.9 (Monster Variety & Loot)
**Prerequisites:** v0.0.9a Complete (Monster Definitions), v0.0.9b Complete (Damage Types & Resistances)
**Design Specification:** [v0.0.9c-design-specification.md](v0.0.9c-design-specification.md)
**Status:** Ready for Implementation
**Target Tests:** ~332 -> ~356 (+24 tests)

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Dependencies from Previous Phases](#dependencies-from-previous-phases)
3. [Current System Analysis](#current-system-analysis)
4. [Detailed Implementation](#detailed-implementation)
   - [Domain Layer](#domain-layer)
   - [Application Layer](#application-layer)
   - [Infrastructure Layer](#infrastructure-layer)
   - [Configuration](#configuration)
5. [Flow Diagrams](#flow-diagrams)
6. [Testing Strategy](#testing-strategy)
7. [Logging Strategy](#logging-strategy)
8. [Implementation Checklist](#implementation-checklist)
9. [Acceptance Criteria](#acceptance-criteria)
10. [Risk Assessment](#risk-assessment)
11. [File Summary](#file-summary)

---

## Executive Summary

### Purpose
This implementation phase introduces a tier system (e.g., Common, Elite, Boss) and a trait system (e.g., Regenerating, Venomous) to significantly increase monster variety and tactical depth. Tiers provide a mechanism to scale monster difficulty and rewards via multipliers, while traits add unique mechanical effects that require different combat strategies. We will implement data-driven definitions for both systems, update monster generation to use them, and ensure they are properly reflected in the game world and combat.

### Scope
- **In Scope:**
  - `TierDefinition` and `MonsterTrait` entities loaded from JSON configuration.
  - `TraitEffect` enum defining mechanical behaviors.
  - `TierService` and `TraitService` for managing and selecting these definitions.
  - Updates to `MonsterDefinition` to support possible tiers and traits.
  - Updates to `Monster` entity to store runtime tier and traits, and calculation logic for multiplied stats.
  - Procedural name generation for "Named" tier monsters.
  - Configuration files: `config/tiers.json`, `config/traits.json`.
  - Integration into `MonsterService` spawning logic.

- **Out of Scope:**
  - Loot tables and currency (v0.0.9d).
  - Boss-specific AI or dialogue.
  - Player traits/buffs (reserved for future versions).

### Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| **Multiplication Strategy** | Base Stats * Multiplier | Simple, predictable scaling. Allows a "Goblin" to be reused as an "Elite Goblin" easily. |
| **Separation of Concerns** | Dedicated Services | `TierService` and `TraitService` separate logic from `MonsterService`, preventing bloat. |
| **Name Generation** | Configurable Templates | Allows easy extension of name pools for "Named" monsters without code changes. |

---

## Dependencies from Previous Phases

### Dependencies from v0.0.9a (Monster Definitions)

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `MonsterDefinition` | `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs` | Updated to include possible tiers/traits lists. |
| `Monster` | `src/Core/RuneAndRust.Domain/Entities/Monster.cs` | Updated to include tier/trait runtime data. |
| `MonsterService` | `src/Core/RuneAndRust.Application/Services/MonsterService.cs` | Updated to apply tier/trait logic during spawn. |

---

## Current System Analysis

### Existing Monster Spawning

**Location:** `src/Core/RuneAndRust.Application/Services/MonsterService.cs`

**Current Flow:**
```
SpawnMonster(defId)
    â””â”€â”€ GetDefinition(defId)
    â””â”€â”€ Create Monster (Base Stats)
```

### New Monster Spawning Flow

```
SpawnMonster(defId)
    â”œâ”€â”€ GetDefinition(defId)
    â”œâ”€â”€ Select Tier (Weighted Random from Definition.PossibleTiers)
    â”œâ”€â”€ Select Traits (Based on Tier.TraitCount/Chance)
    â”œâ”€â”€ Calculate Stats (Base * TierMultiplier)
    â”œâ”€â”€ Generate Name (If Tier.GeneratesUniqueName)
    â””â”€â”€ Create Monster (Calculated Stats, TierId, TraitIds)
```

---

## Detailed Implementation

### Domain Layer

#### 1. TierDefinition.cs (NEW)

**File:** `src/Core/RuneAndRust.Domain/Definitions/TierDefinition.cs`

```csharp
namespace RuneAndRust.Domain.Definitions;

public class TierDefinition
{
    public string Id { get; init; } = string.Empty;
    public string Name { get; init; } = string.Empty;
    public string? NamePrefix { get; init; }
    public float HealthMultiplier { get; init; } = 1.0f;
    public float AttackMultiplier { get; init; } = 1.0f;
    public float DefenseMultiplier { get; init; } = 1.0f;
    public float ExperienceMultiplier { get; init; } = 1.0f;
    public float LootMultiplier { get; init; } = 1.0f;
    public string Color { get; init; } = "white";
    public int SpawnWeight { get; init; } = 100;
    public bool GeneratesUniqueName { get; init; } = false;
    public int SortOrder { get; init; } = 0;

    public static TierDefinition Create(
        string id, string name, string? namePrefix = null,
        float healthMultiplier = 1.0f, float attackMultiplier = 1.0f, float defenseMultiplier = 1.0f,
        float experienceMultiplier = 1.0f, float lootMultiplier = 1.0f,
        string color = "white", int spawnWeight = 100, bool generatesUniqueName = false, int sortOrder = 0)
    {
        ArgumentException.ThrowIfNullOrWhiteSpace(id);
        ArgumentException.ThrowIfNullOrWhiteSpace(name);
        // ... validations ...

        return new TierDefinition
        {
            Id = id.ToLowerInvariant(), Name = name, NamePrefix = namePrefix,
            HealthMultiplier = healthMultiplier, AttackMultiplier = attackMultiplier, DefenseMultiplier = defenseMultiplier,
            ExperienceMultiplier = experienceMultiplier, LootMultiplier = lootMultiplier,
            Color = color, SpawnWeight = spawnWeight, GeneratesUniqueName = generatesUniqueName, SortOrder = sortOrder
        };
    }

    public static TierDefinition Common => Create("common", "Common", null, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f, "white", 70);
}
```

#### 2. TraitEffect.cs (NEW)

**File:** `src/Core/RuneAndRust.Domain/Enums/TraitEffect.cs`

```csharp
namespace RuneAndRust.Domain.Enums;

public enum TraitEffect
{
    None = 0,
    Regeneration = 1,
    Flying = 2,
    Venomous = 3,
    Armored = 4,
    Berserker = 5,
    Summoner = 6,
    ElementalImmunity = 7,
    ElementalAttack = 8
}
```

#### 3. MonsterTrait.cs (NEW)

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterTrait.cs`

```csharp
using RuneAndRust.Domain.Enums;

namespace RuneAndRust.Domain.Definitions;

public class MonsterTrait
{
    public string Id { get; init; } = string.Empty;
    public string Name { get; init; } = string.Empty;
    public string Description { get; init; } = string.Empty;
    public TraitEffect Effect { get; init; } = TraitEffect.None;
    public int EffectValue { get; init; } = 0;
    public int? TriggerThreshold { get; init; }
    public IReadOnlyList<string> Tags { get; init; } = [];
    public string Color { get; init; } = "white";
    public int SortOrder { get; init; } = 0;

    public static MonsterTrait Create(
        string id, string name, string description, TraitEffect effect,
        int effectValue = 0, int? triggerThreshold = null,
        IEnumerable<string>? tags = null, string color = "white", int sortOrder = 0)
    {
        // ... validations ...
        return new MonsterTrait
        {
            Id = id.ToLowerInvariant(), Name = name, Description = description,
            Effect = effect, EffectValue = effectValue, TriggerThreshold = triggerThreshold,
            Tags = tags?.Select(t => t.ToLowerInvariant()).ToList() ?? [],
            Color = color, SortOrder = sortOrder
        };
    }
}
```

#### 4. NameGeneratorConfig.cs (NEW)

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/NameGeneratorConfig.cs`

```csharp
namespace RuneAndRust.Domain.ValueObjects;

public readonly record struct NameGeneratorConfig
{
    public IReadOnlyList<string> Prefixes { get; init; }
    public IReadOnlyList<string> Suffixes { get; init; }
    public string TitleFormat { get; init; }

    public static NameGeneratorConfig Default => new()
    {
        Prefixes = ["Gr", "Kr", "Th", "Br", "Sk"], // ... full list from spec
        Suffixes = ["ok", "ag", "ul", "ax", "or"], // ... full list from spec
        TitleFormat = "{0} the {1}"
    };

    public string GenerateName(string monsterTypeName, Random? random = null)
    {
        random ??= Random.Shared;
        if (Prefixes.Count == 0 || Suffixes.Count == 0) return monsterTypeName;
        var p = Prefixes[random.Next(Prefixes.Count)];
        var s = Suffixes[random.Next(Suffixes.Count)];
        return string.Format(TitleFormat, p + s, monsterTypeName);
    }
}
```

#### 5. Update MonsterDefinition.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`

```csharp
// Add Properties
public IReadOnlyList<string> PossibleTiers { get; init; } = ["common"];
public IReadOnlyList<string> PossibleTraits { get; init; } = [];
public NameGeneratorConfig? NameGenerator { get; init; }

// Update Create Method...
```

#### 6. Update Monster.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Domain/Entities/Monster.cs`

```csharp
// Add Properties
public string TierId { get; private set; } = "common";
public IReadOnlyList<string> TraitIds { get; private set; } = [];
public string DisplayName { get; private set; } = string.Empty;
public bool IsNamed { get; private set; } = false;
public string DisplayColor { get; private set; } = "white";
public float LootMultiplier { get; private set; } = 1.0f;

// Update Constructor to accept these...
```

### Application Layer

#### 7. ITierService.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Interfaces/ITierService.cs`

```csharp
using RuneAndRust.Domain.Definitions;

namespace RuneAndRust.Application.Interfaces;

public interface ITierService
{
    TierDefinition? GetTier(string tierId);
    IReadOnlyList<TierDefinition> GetAllTiers();
    TierDefinition SelectRandomTier(IReadOnlyList<string> possibleTierIds);
    TierDefinition GetDefaultTier();
}
```

#### 8. ITraitService.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Interfaces/ITraitService.cs`

```csharp
using RuneAndRust.Domain.Definitions;

namespace RuneAndRust.Application.Interfaces;

public interface ITraitService
{
    MonsterTrait? GetTrait(string traitId);
    IReadOnlyList<MonsterTrait> GetAllTraits();
    IReadOnlyList<MonsterTrait> GetTraits(IEnumerable<string> traitIds);
    IReadOnlyList<string> SelectRandomTraits(IReadOnlyList<string> possibleTraitIds, TierDefinition tier);
}
```

#### 9. Update IConfigurationProvider.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`

```csharp
IReadOnlyList<TierDefinition> GetTiers();
TierDefinition? GetTierById(string tierId);
IReadOnlyList<MonsterTrait> GetTraits();
MonsterTrait? GetTraitById(string traitId);
```

#### 10. TierService.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Services/TierService.cs`

```csharp
// Implement ITierService.
// Implement SelectRandomTier using weighted random logic similar to MonsterService.
```

#### 11. TraitService.cs (NEW)

**File:** `src/Core/RuneAndRust.Application/Services/TraitService.cs`

```csharp
// Implement ITraitService.
// SelectRandomTraits logic:
//   - Generally 0 traits for Common (unless config override).
//   - 1-2 traits for Elite/Named based on some logic or additional config in TierDefinition (handled in implementation details).
//   - Randomly pick from possibleTraitIds.
```

#### 12. Update MonsterService.cs (MODIFY)

**File:** `src/Core/RuneAndRust.Application/Services/MonsterService.cs`

```csharp
// Inject ITierService and ITraitService.
// In CreateMonsterFromDefinition:
//   1. Call TierService.SelectRandomTier(def.PossibleTiers)
//   2. Call TraitService.SelectRandomTraits(def.PossibleTraits, selectedTier)
//   3. Calculate Name (Tier Prefix vs Generator)
//   4. Calculate Stats (Base * Tier Multipliers)
//   5. Instantiate Monster with all new details.
```

### Infrastructure Layer

#### 13. Update JsonConfigurationProvider.cs (MODIFY)

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`

```csharp
// Implement GetTiers() loading from tiers.json
// Implement GetTraits() loading from traits.json
```

### Configuration

#### 14. tiers.json (NEW)

**File:** `config/tiers.json`

```json
{
  "tiers": [
    { "id": "common", "name": "Common", "healthMultiplier": 1.0, "spawnWeight": 70 },
    { "id": "named", "name": "Named", "healthMultiplier": 1.5, "lootMultiplier": 2.0, "generatesUniqueName": true, "spawnWeight": 20 },
    { "id": "elite", "name": "Elite", "namePrefix": "Elite", "healthMultiplier": 2.0, "color": "yellow", "spawnWeight": 10 },
    { "id": "boss", "name": "Boss", "namePrefix": "Boss", "healthMultiplier": 5.0, "color": "red", "spawnWeight": 0 }
  ]
}
```

#### 15. traits.json (NEW)

**File:** `config/traits.json`

```json
{
  "traits": [
    { "id": "regenerating", "name": "Regenerating", "effect": "Regeneration", "effectValue": 5, "description": "Heals 5 HP per turn." },
    { "id": "venomous", "name": "Venomous", "effect": "Venomous", "effectValue": 3, "description": "Attacks apply poison." },
    { "id": "armored", "name": "Armored", "effect": "Armored", "effectValue": 2, "description": "Reduces damage by 2." }
  ]
}
```

#### 16. Update monsters.json (MODIFY)

**File:** `config/monsters.json`

Add `possibleTiers` and `possibleTraits` to existing monsters.
```json
{
  "id": "goblin",
  "possibleTiers": ["common", "named", "elite"],
  "possibleTraits": ["regenerating", "venomous"]
}
```

### Presentation Layer

#### 17. Update Output (MODIFY)

- `SpectreGameRenderer`: Update monster display to use `DisplayName` and `DisplayColor`.
- `GameSessionService`: (For `Examine` command) list Traits and Tier info.

---

## Flow Diagrams

### Monster Generation Flow

```
SpawnMonster("goblin")
    â”‚
    â–¼
1. Get Definition ("goblin")
    â”‚
    â–¼
2. Select Tier (Weighted Random from ["common", "named", "elite"])
    â”œâ”€â”€ Named Tier Selected!
    â”‚   â”œâ”€â”€ Multipliers: HP x1.5, Loot x2.0
    â”‚   â””â”€â”€ Name Gen: "Grok the Goblin"
    â”‚
    â–¼
3. Select Traits
    â”œâ”€â”€ Tier allows traits? Yes.
    â””â”€â”€ Random Trail: "Regenerating"
    â”‚
    â–¼
4. Create Monster Entity
    â”œâ”€â”€ HP = 30 * 1.5 = 45
    â”œâ”€â”€ Name = "Grok the Goblin"
    â”œâ”€â”€ Tier = "named"
    â””â”€â”€ Traits = ["regenerating"]
```

---

## Testing Strategy

### Test Files

#### 1. TierServiceTests.cs
**File:** `tests/RuneAndRust.Application.UnitTests/Services/TierServiceTests.cs`
- `SelectRandomTier_RespectsWeights`
- `GetTier_ReturnsCorrectValues`

#### 2. NameGeneratorConfigTests.cs
**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/NameGeneratorConfigTests.cs`
- `GenerateName_UsesPrefixSuffixAndFormat`

#### 3. MonsterServiceTests (Update)
**File:** `tests/RuneAndRust.Application.UnitTests/Services/MonsterServiceTests.cs`
- `SpawnMonster_AppliesTierMultipliers`
- `SpawnMonster_GeneratesNameForNamedTier`
- `SpawnMonster_AssignsTraits`

---

## Logging Strategy

| Operation | Level | Example |
|-----------|-------|---------|
| Spawn | Info | "Spawned [Named] 'Grok the Goblin' (HP: 45, Traits: Regenerating)" |
| Trait Trigger | Debug | "Trait 'Regenerating' healed 5 HP." |

---

## Implementation Checklist

> **Legend:** ğŸŸ¢ No dependencies | ğŸŸ¡ Has dependencies | ğŸ”´ Critical path
> **Complexity:** â­ Simple | â­â­ Moderate | â­â­â­ Complex

---

### Phase 1: Domain Layer (Foundation)

#### 1.1 Create `TraitEffect.cs` ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Domain/Enums/TraitEffect.cs`

- [ ] Create new file in `Enums/` directory
- [ ] Add namespace: `RuneAndRust.Domain.Enums`
- [ ] Add XML documentation for enum
- [ ] **Define `TraitEffect` enum values:**
  - [ ] `None = 0` - No mechanical effect (flavor only)
  - [ ] `Regeneration = 1` - Heals HP per turn (EffectValue = HP healed)
  - [ ] `Flying = 2` - Defense bonus vs melee (EffectValue = defense bonus)
  - [ ] `Venomous = 3` - Attacks may poison (EffectValue = poison damage/turn)
  - [ ] `Armored = 4` - Flat damage reduction (EffectValue = reduction amount)
  - [ ] `Berserker = 5` - Damage bonus at low HP (EffectValue = bonus %, TriggerThreshold = HP %)
  - [ ] `Summoner = 6` - Can summon monsters (future)
  - [ ] `ElementalImmunity = 7` - Immune to damage type (future)
  - [ ] `ElementalAttack = 8` - Deals elemental damage (future)
- [ ] Add XML documentation for each enum value explaining mechanics

**Acceptance:** Enum compiles with clear documentation. Combat system can reference effects.

---

#### 1.2 Create `TierDefinition.cs` ğŸŸ¢ â­â­

**File:** `src/Core/RuneAndRust.Domain/Definitions/TierDefinition.cs`

- [ ] Create new file in `Definitions/` directory (alongside existing `MonsterDefinition.cs`)
- [ ] Add namespace: `RuneAndRust.Domain.Definitions`
- [ ] Add XML documentation for class
- [ ] **Properties (all `init`-only):**
  - [ ] `string Id` - unique identifier (normalized lowercase)
  - [ ] `string Name` - display name ("Common", "Elite", etc.)
  - [ ] `string? NamePrefix` - prefix added to monster name (null for Common/Named)
  - [ ] `float HealthMultiplier` - base health multiplier (default: 1.0f)
  - [ ] `float AttackMultiplier` - base attack multiplier (default: 1.0f)
  - [ ] `float DefenseMultiplier` - base defense multiplier (default: 1.0f)
  - [ ] `float ExperienceMultiplier` - XP reward multiplier (default: 1.0f)
  - [ ] `float LootMultiplier` - loot drop multiplier for v0.0.9d (default: 1.0f)
  - [ ] `string Color` - Spectre.Console color name (default: "white")
  - [ ] `int SpawnWeight` - weighted random selection (default: 100)
  - [ ] `bool GeneratesUniqueName` - uses name generator (default: false)
  - [ ] `int SortOrder` - display ordering (default: 0)
- [ ] **Factory method `Create()`:**
  - [ ] Validate `Id` not null/whitespace (`ArgumentException.ThrowIfNullOrWhiteSpace`)
  - [ ] Validate `Name` not null/whitespace
  - [ ] Validate `HealthMultiplier > 0` (`ThrowIfLessThanOrEqual(0)`)
  - [ ] Validate `AttackMultiplier > 0`
  - [ ] Validate `DefenseMultiplier >= 0` (`ThrowIfNegative`)
  - [ ] Validate `ExperienceMultiplier >= 0`
  - [ ] Validate `LootMultiplier >= 0`
  - [ ] Normalize `Id` to lowercase
  - [ ] Return new instance with validated values
- [ ] **Static property `Common`:**
  - [ ] Returns default Common tier: multipliers 1.0, weight 70, white color

**Acceptance:** `TierDefinition.Create("elite", "Elite", ...)` returns valid instance. Validation rejects invalid multipliers.

---

#### 1.3 Create `MonsterTrait.cs` ğŸŸ¡ â­â­

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterTrait.cs`
**Depends on:** 1.1 (uses `TraitEffect` enum)

- [ ] Create new file in `Definitions/` directory
- [ ] Add namespace: `RuneAndRust.Domain.Definitions`
- [ ] Add using for `RuneAndRust.Domain.Enums`
- [ ] Add XML documentation for class
- [ ] **Properties (all `init`-only):**
  - [ ] `string Id` - unique identifier (normalized lowercase)
  - [ ] `string Name` - display name ("Regenerating", "Armored", etc.)
  - [ ] `string Description` - player-visible description
  - [ ] `TraitEffect Effect` - mechanical effect type (default: `None`)
  - [ ] `int EffectValue` - numeric value for effect (default: 0)
  - [ ] `int? TriggerThreshold` - HP % threshold for conditional effects (nullable)
  - [ ] `IReadOnlyList<string> Tags` - category tags ("passive", "combat", etc.)
  - [ ] `string Color` - Spectre.Console color name (default: "white")
  - [ ] `int SortOrder` - display ordering (default: 0)
- [ ] **Factory method `Create()`:**
  - [ ] Validate `Id` not null/whitespace
  - [ ] Validate `Name` not null/whitespace
  - [ ] Normalize `Id` to lowercase
  - [ ] Normalize all `Tags` to lowercase
  - [ ] Return new instance with validated values

**Acceptance:** `MonsterTrait.Create("regenerating", "Regenerating", "Heals 5 HP per turn.", TraitEffect.Regeneration, 5)` returns valid instance.

---

#### 1.4 Create `NameGeneratorConfig.cs` ğŸŸ¢ â­â­

**File:** `src/Core/RuneAndRust.Domain/ValueObjects/NameGeneratorConfig.cs`

- [ ] Create new file in `ValueObjects/` directory (alongside `Stats.cs`)
- [ ] Add namespace: `RuneAndRust.Domain.ValueObjects`
- [ ] Define as `readonly record struct` (immutable value object pattern)
- [ ] Add XML documentation for struct
- [ ] **Properties (all `init`-only):**
  - [ ] `IReadOnlyList<string> Prefixes` - first name prefixes (["Gr", "Kr", "Th", ...])
  - [ ] `IReadOnlyList<string> Suffixes` - name suffixes (["ok", "ag", "ul", ...])
  - [ ] `string TitleFormat` - format string with {0}=name, {1}=type (e.g., "{0} the {1}")
- [ ] **Static property `Default`:**
  - [ ] Returns config with 10 prefixes, 10 suffixes, format "{0} the {1}"
  - [ ] Prefixes: "Gr", "Kr", "Th", "Br", "Sk", "Dr", "Bl", "Tr", "Zr", "Vr"
  - [ ] Suffixes: "ok", "ag", "ul", "ax", "or", "ek", "im", "an", "ur", "ash"
- [ ] **Method `GenerateName(string monsterTypeName, Random? random = null)`:**
  - [ ] Use `Random.Shared` if random is null
  - [ ] Return `monsterTypeName` if Prefixes or Suffixes empty
  - [ ] Select random prefix and suffix
  - [ ] Combine: `prefix + suffix` (e.g., "Grok")
  - [ ] Format with TitleFormat: e.g., "Grok the Orc"
  - [ ] Return formatted string

**Acceptance:** `NameGeneratorConfig.Default.GenerateName("Orc")` returns names like "Grok the Orc", "Thag the Orc", etc.

---

#### 1.5 Update `MonsterDefinition.cs` ğŸŸ¡ â­â­

**File:** `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`
**Depends on:** 1.4 (uses `NameGeneratorConfig`)

- [ ] Add using for `RuneAndRust.Domain.ValueObjects` (for `NameGeneratorConfig`)
- [ ] **Add new properties (after existing properties):**
  - [ ] `IReadOnlyList<string> PossibleTiers { get; init; } = ["common"];` with XML docs
  - [ ] `IReadOnlyList<string> PossibleTraits { get; init; } = [];` with XML docs
  - [ ] `NameGeneratorConfig? NameGenerator { get; init; }` with XML docs
- [ ] **Update `Create()` factory method signature:**
  - [ ] Add parameter: `IEnumerable<string>? possibleTiers = null`
  - [ ] Add parameter: `IEnumerable<string>? possibleTraits = null`
  - [ ] Add parameter: `NameGeneratorConfig? nameGenerator = null`
- [ ] **Update `Create()` factory method body:**
  - [ ] Assign `PossibleTiers = possibleTiers?.ToList() ?? ["common"]`
  - [ ] Assign `PossibleTraits = possibleTraits?.ToList() ?? []`
  - [ ] Assign `NameGenerator = nameGenerator`

**Acceptance:** Existing monster definitions continue to work with defaults. New properties accessible for tier/trait assignment.

---

#### 1.6 Update `Monster.cs` ğŸŸ¡ â­â­â­

**File:** `src/Core/RuneAndRust.Domain/Entities/Monster.cs`
**Depends on:** All Domain definitions (1.1-1.5)

- [ ] **Add new properties (after existing `ExperienceValue` from v0.0.9a):**
  - [ ] `public string TierId { get; private set; } = "common";` with XML docs
  - [ ] `public IReadOnlyList<string> TraitIds { get; private set; } = [];` with XML docs
  - [ ] `public string DisplayName { get; private set; } = string.Empty;` with XML docs
  - [ ] `public bool IsNamed { get; private set; } = false;` with XML docs
  - [ ] `public string DisplayColor { get; private set; } = "white";` with XML docs
  - [ ] `public float LootMultiplier { get; private set; } = 1.0f;` with XML docs
- [ ] **Add new internal constructor (for tier/trait spawning):**
  - [ ] Parameters: `string definitionId, string name, string description, int maxHealth, Stats stats, int experienceValue, DamageResistances resistances, string tierId, IEnumerable<string> traitIds, string displayName, bool isNamed, string displayColor, float lootMultiplier`
  - [ ] Assign all properties with validation
  - [ ] Mark as `internal` to restrict to Application layer
- [ ] **Update v0.0.9a constructor to set new property defaults:**
  - [ ] Set `TierId = "common"`
  - [ ] Set `TraitIds = []`
  - [ ] Set `DisplayName = name`
  - [ ] Set `IsNamed = false`
  - [ ] Set `DisplayColor = "white"`
  - [ ] Set `LootMultiplier = 1.0f`
- [ ] **Update private EF constructor:**
  - [ ] Initialize all new properties to safe defaults
- [ ] **Update `ToString()` method:**
  - [ ] Use `DisplayName` instead of `Name` for output

**Acceptance:** `Monster` can be instantiated with tier/trait data. Backward compatible with v0.0.9a/9b constructors.

---

### Phase 2: Application Layer (Service Contracts)

#### 2.1 Create `TierConfigurationDto.cs` ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Application/Configuration/TierConfigurationDto.cs`

- [ ] Create new file in `Configuration/` directory
- [ ] Add namespace: `RuneAndRust.Application.Configuration`
- [ ] Add using for `System.Text.Json.Serialization`
- [ ] **Define `TierConfiguration` class:**
  - [ ] `[JsonPropertyName("tiers")] List<TierDefinitionDto> Tiers` (default: empty list)
- [ ] **Define `TierDefinitionDto` class with JSON attributes:**
  - [ ] `id`, `name`, `namePrefix`, `healthMultiplier`, `attackMultiplier`, `defenseMultiplier`
  - [ ] `experienceMultiplier`, `lootMultiplier`, `color`, `spawnWeight`
  - [ ] `generatesUniqueName` (default: false), `sortOrder` (default: 0)

**Acceptance:** DTO can be deserialized from `tiers.json` without exceptions.

---

#### 2.2 Create `TraitConfigurationDto.cs` ğŸŸ¢ â­

**File:** `src/Core/RuneAndRust.Application/Configuration/TraitConfigurationDto.cs`

- [ ] Create new file in `Configuration/` directory
- [ ] Add namespace: `RuneAndRust.Application.Configuration`
- [ ] Add using for `System.Text.Json.Serialization`
- [ ] **Define `TraitConfiguration` class:**
  - [ ] `[JsonPropertyName("traits")] List<MonsterTraitDto> Traits` (default: empty list)
- [ ] **Define `MonsterTraitDto` class with JSON attributes:**
  - [ ] `id`, `name`, `description`, `effect` (string), `effectValue`
  - [ ] `triggerThreshold` (nullable int), `tags` (List<string>)
  - [ ] `color` (default: "white"), `sortOrder` (default: 0)

**Acceptance:** DTO can be deserialized from `traits.json` without exceptions.

---

#### 2.3 Update `MonsterConfigurationDto.cs` ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Configuration/MonsterConfigurationDto.cs`
**Depends on:** Existing v0.0.9a DTO

- [ ] **Add new properties to `MonsterDefinitionDto`:**
  - [ ] `[JsonPropertyName("possibleTiers")] List<string> PossibleTiers` (default: empty)
  - [ ] `[JsonPropertyName("possibleTraits")] List<string> PossibleTraits` (default: empty)
  - [ ] `[JsonPropertyName("nameGenerator")] NameGeneratorDto? NameGenerator` (nullable)
- [ ] **Define `NameGeneratorDto` nested class:**
  - [ ] `[JsonPropertyName("prefixes")] List<string> Prefixes` (default: empty)
  - [ ] `[JsonPropertyName("suffixes")] List<string> Suffixes` (default: empty)
  - [ ] `[JsonPropertyName("titleFormat")] string TitleFormat` (default: "{0} the {1}")

**Acceptance:** Existing monster JSON with new `possibleTiers`/`possibleTraits` fields parses correctly.

---

#### 2.4 Update `IGameConfigurationProvider.cs` ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`
**Depends on:** 1.2, 1.3 (references `TierDefinition`, `MonsterTrait`)

- [ ] Add using for `RuneAndRust.Domain.Definitions` (if not present)
- [ ] **Add interface method declarations:**
  - [ ] `IReadOnlyList<TierDefinition> GetTiers()` with XML docs
  - [ ] `TierDefinition? GetTierById(string tierId)` with XML docs
  - [ ] `IReadOnlyList<MonsterTrait> GetTraits()` with XML docs
  - [ ] `MonsterTrait? GetTraitById(string traitId)` with XML docs

**Acceptance:** Interface compiles; `JsonConfigurationProvider` shows compile errors (expected until implemented).

---

#### 2.5 Create `ITierService.cs` ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Interfaces/ITierService.cs`
**Depends on:** 1.2

- [ ] Create new file in `Interfaces/` directory
- [ ] Add namespace: `RuneAndRust.Application.Interfaces`
- [ ] Add using for `RuneAndRust.Domain.Definitions`
- [ ] **Define `ITierService` interface with XML docs:**
  - [ ] `TierDefinition? GetTier(string tierId)`
  - [ ] `IReadOnlyList<TierDefinition> GetAllTiers()`
  - [ ] `TierDefinition SelectRandomTier(IReadOnlyList<string> possibleTierIds)`
  - [ ] `TierDefinition GetDefaultTier()` - returns Common tier

**Acceptance:** Interface compiles with complete XML documentation.

---

#### 2.6 Create `ITraitService.cs` ğŸŸ¡ â­

**File:** `src/Core/RuneAndRust.Application/Interfaces/ITraitService.cs`
**Depends on:** 1.2, 1.3

- [ ] Create new file in `Interfaces/` directory
- [ ] Add namespace: `RuneAndRust.Application.Interfaces`
- [ ] Add usings for `Domain.Definitions`
- [ ] **Define `ITraitService` interface with XML docs:**
  - [ ] `MonsterTrait? GetTrait(string traitId)`
  - [ ] `IReadOnlyList<MonsterTrait> GetAllTraits()`
  - [ ] `IReadOnlyList<MonsterTrait> GetTraits(IEnumerable<string> traitIds)`
  - [ ] `IReadOnlyList<string> SelectRandomTraits(IReadOnlyList<string> possibleTraitIds, TierDefinition tier)`

**Acceptance:** Interface compiles with complete XML documentation.

---

#### 2.7 Create `TierService.cs` ğŸŸ¡ â­â­â­

**File:** `src/Core/RuneAndRust.Application/Services/TierService.cs`
**Depends on:** 2.4, 2.5, 1.2

- [ ] Create new file in `Services/` directory
- [ ] Add namespace: `RuneAndRust.Application.Services`
- [ ] Add usings for interfaces, definitions, `Microsoft.Extensions.Logging`
- [ ] **Define `TierService` class implementing `ITierService`:**
- [ ] **Private fields:**
  - [ ] `readonly ILogger<TierService> _logger`
  - [ ] `readonly IGameConfigurationProvider _configProvider`
  - [ ] `readonly Random _random`
- [ ] **Public constructor:**
  - [ ] Parameters: `ILogger<TierService> logger, IGameConfigurationProvider configProvider`
  - [ ] Null checks with `ArgumentNullException`
  - [ ] Initialize `_random = new Random()`
- [ ] **Internal constructor (for testing):**
  - [ ] Parameters: `ILogger<TierService> logger, IGameConfigurationProvider configProvider, Random random`
  - [ ] Null checks for all parameters
- [ ] **Implement `GetTier(string tierId)`:**
  - [ ] Return null if input is null/whitespace
  - [ ] Normalize to lowercase
  - [ ] Return `_configProvider.GetTierById()`
- [ ] **Implement `GetAllTiers()`:**
  - [ ] Return `_configProvider.GetTiers()`
- [ ] **Implement `SelectRandomTier(IReadOnlyList<string> possibleTierIds)`:**
  - [ ] If null/empty, log debug and return `GetDefaultTier()`
  - [ ] Get valid tiers by looking up each ID
  - [ ] If no valid tiers found, log warning and return `GetDefaultTier()`
  - [ ] Calculate total weight
  - [ ] If total <= 0, return first valid tier
  - [ ] Weighted random selection: roll `_random.Next(totalWeight)`
  - [ ] Iterate, accumulate weights, return when roll < accumulated
  - [ ] Fallback: return last tier
  - [ ] Log selected tier at Debug level
- [ ] **Implement `GetDefaultTier()`:**
  - [ ] Try `GetTier("common")`
  - [ ] Fallback to `TierDefinition.Common` static property

**Acceptance:** `SelectRandomTier(["common", "elite"])` returns weighted random tier. Default fallback works.

---

#### 2.8 Create `TraitService.cs` ğŸŸ¡ â­â­â­

**File:** `src/Core/RuneAndRust.Application/Services/TraitService.cs`
**Depends on:** 2.4, 2.6, 1.2, 1.3

- [ ] Create new file in `Services/` directory
- [ ] Add namespace: `RuneAndRust.Application.Services`
- [ ] Add usings for interfaces, definitions, logging
- [ ] **Define `TraitService` class implementing `ITraitService`:**
- [ ] **Private fields:**
  - [ ] `readonly ILogger<TraitService> _logger`
  - [ ] `readonly IGameConfigurationProvider _configProvider`
  - [ ] `readonly Random _random`
- [ ] **Public constructor:**
  - [ ] Parameters: `ILogger<TraitService> logger, IGameConfigurationProvider configProvider`
  - [ ] Null checks, initialize `_random = new Random()`
- [ ] **Internal constructor (for testing):**
  - [ ] With explicit `Random` parameter
- [ ] **Implement `GetTrait(string traitId)`:**
  - [ ] Return null if input null/whitespace
  - [ ] Normalize to lowercase
  - [ ] Return `_configProvider.GetTraitById()`
- [ ] **Implement `GetAllTraits()`:**
  - [ ] Return `_configProvider.GetTraits()`
- [ ] **Implement `GetTraits(IEnumerable<string> traitIds)`:**
  - [ ] Map each ID via `GetTrait()`
  - [ ] Filter nulls
  - [ ] Return as list
- [ ] **Implement `SelectRandomTraits(IReadOnlyList<string> possibleTraitIds, TierDefinition tier)`:**
  - [ ] If null/empty, return empty list
  - [ ] **Determine max traits based on tier:**
    - [ ] "common" â†’ 0 traits
    - [ ] "named" â†’ 1 trait
    - [ ] "elite" â†’ 2 traits
    - [ ] "boss" â†’ 3 traits
    - [ ] Default â†’ 0
  - [ ] If maxTraits == 0, return empty list
  - [ ] Copy `possibleTraitIds` to mutable list
  - [ ] Select random count between 1 and maxTraits (inclusive)
  - [ ] For each slot, pick random index, validate trait exists, add to result, remove from available
  - [ ] Log selected traits at Debug level
  - [ ] Return selected trait IDs

**Acceptance:** Elite monsters get 1-2 traits randomly selected. Common monsters get none.

---

#### 2.9 Update `MonsterService.cs` ğŸŸ¡ â­â­â­ ğŸ”´

**File:** `src/Core/RuneAndRust.Application/Services/MonsterService.cs`
**Depends on:** 2.7, 2.8, 1.5, 1.6, v0.0.9a/9b foundations
**Critical:** Core spawning logic

- [ ] **Add new dependencies:**
  - [ ] Add `private readonly ITierService _tierService` field
  - [ ] Add `private readonly ITraitService _traitService` field
  - [ ] Update constructor to inject `ITierService tierService, ITraitService traitService`
  - [ ] Assign with null checks
- [ ] **Add new overload `SpawnMonster(string definitionId, string tierId)`:**
  - [ ] Get definition or throw
  - [ ] Get tier from `_tierService.GetTier(tierId)` or default
  - [ ] Call `CreateMonsterFromDefinition(definition, tier)`
- [ ] **Update `CreateMonsterFromDefinition()` method:**
  - [ ] Add optional `TierDefinition? forcedTier = null` parameter
  - [ ] **Select tier:**
    - [ ] Use `forcedTier` if provided
    - [ ] Otherwise `_tierService.SelectRandomTier(definition.PossibleTiers)`
  - [ ] **Select traits:**
    - [ ] Call `_traitService.SelectRandomTraits(definition.PossibleTraits, tier)`
  - [ ] **Calculate tiered stats:**
    - [ ] `health = (int)Math.Round(definition.BaseHealth * tier.HealthMultiplier)`
    - [ ] `attack = (int)Math.Round(definition.BaseAttack * tier.AttackMultiplier)`
    - [ ] `defense = (int)Math.Round(definition.BaseDefense * tier.DefenseMultiplier)`
    - [ ] `experienceValue = (int)Math.Round(definition.BaseExperienceValue * tier.ExperienceMultiplier)`
  - [ ] **Apply trait stat modifiers:**
    - [ ] Get traits via `_traitService.GetTraits(traitIds)`
    - [ ] For `Armored` trait: `defense += trait.EffectValue`
    - [ ] (Placeholder for other trait stat modifiers)
  - [ ] **Generate display name:**
    - [ ] Call helper `GenerateDisplayName(definition, tier)`
  - [ ] **Create Monster with new constructor:**
    - [ ] Pass all new fields: `tierId`, `traitIds`, `displayName`, `isNamed`, `displayColor`, `lootMultiplier`
- [ ] **Add private helper `GenerateDisplayName(MonsterDefinition, TierDefinition)`:**
  - [ ] If `tier.GeneratesUniqueName`:
    - [ ] Use `definition.NameGenerator ?? NameGeneratorConfig.Default`
    - [ ] Call `nameConfig.GenerateName(definition.Name, _random)`
    - [ ] Return (generatedName, true)
  - [ ] If `tier.NamePrefix` is not null/empty:
    - [ ] Return ($"{tier.NamePrefix} {definition.Name}", false)
  - [ ] Otherwise:
    - [ ] Return (definition.Name, false)

**Acceptance:** `SpawnMonster("orc")` can return "Orc", "Grok the Orc", "Elite Orc", or "Boss Orc" based on tier selection.

---

### Phase 3: Infrastructure Layer (Data Loading)

#### 3.1 Update `JsonConfigurationProvider.cs` ğŸŸ¡ â­â­ ğŸ”´

**File:** `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`
**Depends on:** 2.1, 2.2, 2.3, 2.4, 1.1-1.4
**Critical:** Enables all configuration loading

- [ ] Add usings for new DTOs, `TraitEffect` enum, `NameGeneratorConfig`
- [ ] **Add private fields:**
  - [ ] `private List<TierDefinition>? _tiers;`
  - [ ] `private List<MonsterTrait>? _traits;`
- [ ] **Implement `GetTiers()`:**
  - [ ] Null check `_tiers`
  - [ ] If null, load from `tiers.json` via `LoadConfiguration<TierConfiguration>`
  - [ ] Map each DTO with `MapToTierDefinition()`
  - [ ] Cache in `_tiers`
  - [ ] Return cached list
- [ ] **Implement `GetTierById(string tierId)`:**
  - [ ] Call `GetTiers()` to ensure loaded
  - [ ] Return `FirstOrDefault` matching ID (case-insensitive)
- [ ] **Add private helper `MapToTierDefinition(TierDefinitionDto dto)`:**
  - [ ] Call `TierDefinition.Create()` with all mapped values
  - [ ] Return created definition
- [ ] **Implement `GetTraits()`:**
  - [ ] Null check `_traits`
  - [ ] If null, load from `traits.json` via `LoadConfiguration<TraitConfiguration>`
  - [ ] Map each DTO with `MapToMonsterTrait()`
  - [ ] Cache in `_traits`
  - [ ] Return cached list
- [ ] **Implement `GetTraitById(string traitId)`:**
  - [ ] Call `GetTraits()` to ensure loaded
  - [ ] Return `FirstOrDefault` matching ID (case-insensitive)
- [ ] **Add private helper `MapToMonsterTrait(MonsterTraitDto dto)`:**
  - [ ] Parse `dto.Effect` to `TraitEffect` enum with `Enum.TryParse` (default: `None`)
  - [ ] Call `MonsterTrait.Create()` with all mapped values
  - [ ] Return created definition
- [ ] **Update `MapToMonsterDefinition()` for new fields:**
  - [ ] Map `dto.PossibleTiers` to definition's `PossibleTiers`
  - [ ] Map `dto.PossibleTraits` to definition's `PossibleTraits`
  - [ ] Map `dto.NameGenerator` to `NameGeneratorConfig` if present

**Acceptance:** `GetTiers()` returns 4 tiers from JSON. `GetTraits()` returns 5 traits. Caching works.

---

### Phase 4: Configuration (Data Files)

#### 4.1 Create `config/tiers.json` ğŸŸ¢ â­â­

**File:** `config/tiers.json`

- [ ] Create new file in `config/` directory
- [ ] Add JSON structure with `$schema` reference
- [ ] **Add `tiers` array with 4 definitions:**
- [ ] **Common:**
  - [ ] id: "common", name: "Common", namePrefix: null
  - [ ] All multipliers: 1.0, color: "white", spawnWeight: 70
  - [ ] generatesUniqueName: false, sortOrder: 0
- [ ] **Named:**
  - [ ] id: "named", name: "Named", namePrefix: null
  - [ ] healthMultiplier: 1.5, attackMultiplier: 1.3, defenseMultiplier: 1.2
  - [ ] experienceMultiplier: 2.0, lootMultiplier: 2.0
  - [ ] color: "yellow", spawnWeight: 20, generatesUniqueName: true, sortOrder: 1
- [ ] **Elite:**
  - [ ] id: "elite", name: "Elite", namePrefix: "Elite"
  - [ ] healthMultiplier: 2.0, attackMultiplier: 1.5, defenseMultiplier: 1.5
  - [ ] experienceMultiplier: 3.0, lootMultiplier: 3.0
  - [ ] color: "orange3", spawnWeight: 8, generatesUniqueName: false, sortOrder: 2
- [ ] **Boss:**
  - [ ] id: "boss", name: "Boss", namePrefix: "Boss"
  - [ ] healthMultiplier: 5.0, attackMultiplier: 2.0, defenseMultiplier: 2.0
  - [ ] experienceMultiplier: 10.0, lootMultiplier: 5.0
  - [ ] color: "red", spawnWeight: 2, generatesUniqueName: false, sortOrder: 3
- [ ] Validate JSON syntax

**Acceptance:** JSON parses without errors. All 4 tiers load with correct multipliers.

---

#### 4.2 Create `config/traits.json` ğŸŸ¢ â­â­

**File:** `config/traits.json`

- [ ] Create new file in `config/` directory
- [ ] Add JSON structure with `$schema` reference
- [ ] **Add `traits` array with 5 definitions:**
- [ ] **Regenerating:**
  - [ ] id: "regenerating", name: "Regenerating", description: "Recovers health each turn."
  - [ ] effect: "Regeneration", effectValue: 5, triggerThreshold: null
  - [ ] tags: ["passive", "healing"], color: "green", sortOrder: 0
- [ ] **Flying:**
  - [ ] id: "flying", name: "Flying", description: "Harder to hit with melee attacks."
  - [ ] effect: "Flying", effectValue: 3, triggerThreshold: null
  - [ ] tags: ["passive", "defensive"], color: "cyan", sortOrder: 1
- [ ] **Venomous:**
  - [ ] id: "venomous", name: "Venomous", description: "Attacks may poison the target."
  - [ ] effect: "Venomous", effectValue: 3, triggerThreshold: null
  - [ ] tags: ["combat", "status"], color: "green", sortOrder: 2
- [ ] **Armored:**
  - [ ] id: "armored", name: "Armored", description: "Reduces all incoming damage."
  - [ ] effect: "Armored", effectValue: 3, triggerThreshold: null
  - [ ] tags: ["passive", "defensive"], color: "grey", sortOrder: 3
- [ ] **Berserker:**
  - [ ] id: "berserker", name: "Berserker", description: "Deals more damage when wounded."
  - [ ] effect: "Berserker", effectValue: 50, triggerThreshold: 30
  - [ ] tags: ["combat", "offensive"], color: "red", sortOrder: 4
- [ ] Validate JSON syntax

**Acceptance:** JSON parses without errors. All 5 traits load with correct effects.

---

#### 4.3 Update `config/monsters.json` ğŸŸ¡ â­â­

**File:** `config/monsters.json`
**Depends on:** 4.1, 4.2 (references tier/trait IDs)

- [ ] **Update each existing monster definition:**
- [ ] **Goblin:**
  - [ ] Add: `"possibleTiers": ["common", "named"]`
  - [ ] Add: `"possibleTraits": ["berserker"]`
- [ ] **Skeleton:**
  - [ ] Add: `"possibleTiers": ["common", "named", "elite"]`
  - [ ] Add: `"possibleTraits": []` (undead, no biological traits)
- [ ] **Orc:**
  - [ ] Add: `"possibleTiers": ["common", "named", "elite", "boss"]`
  - [ ] Add: `"possibleTraits": ["berserker", "armored"]`
  - [ ] Add custom name generator: `"nameGenerator": { "prefixes": ["Gr", "Kr", "Th", "Br", "Sk", "Ug", "Mog", "Zug"], "suffixes": ["ok", "ag", "ul", "ax", "or", "ash", "nak", "gul"], "titleFormat": "{0} the {1}" }`
- [ ] **Giant Spider:**
  - [ ] Add: `"possibleTiers": ["common", "named", "elite"]`
  - [ ] Add: `"possibleTraits": ["venomous"]`
- [ ] **Slime:**
  - [ ] Add: `"possibleTiers": ["common", "named"]`
  - [ ] Add: `"possibleTraits": ["regenerating"]`
- [ ] Validate JSON syntax

**Acceptance:** Monsters spawn with appropriate tiers and traits based on configuration.

---

### Phase 5: Presentation Layer (Display)

#### 5.1 Update `SpectreGameRenderer.cs` ğŸŸ¡ â­â­

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Adapters/SpectreGameRenderer.cs`
**Depends on:** 2.6, 1.6

- [ ] **Add dependency injection for `ITraitService`:**
  - [ ] Add `private readonly ITraitService _traitService` field
  - [ ] Update constructor to accept `ITraitService` parameter
- [ ] **Update monster rendering method:**
  - [ ] Use `monster.DisplayColor` for colored name markup
  - [ ] Use `monster.DisplayName` instead of `monster.Name`
  - [ ] Format: `[{monster.DisplayColor}]{monster.DisplayName}[/]`
  - [ ] If `monster.TraitIds.Count > 0`:
    - [ ] Get traits via `_traitService.GetTraits(monster.TraitIds)`
    - [ ] Format each trait with color: `[{trait.Color}]{trait.Name}[/]`
    - [ ] Display on separate line: `    Traits: {joined trait names}`

**Acceptance:** Elite monsters display in orange, Named in yellow, with trait list beneath.

---

#### 5.2 Update `GameSessionService.cs` Examine Logic ğŸŸ¡ â­â­

**File:** `src/Core/RuneAndRust.Application/Services/GameSessionService.cs`
**Depends on:** 2.5, 2.6

- [ ] **Add dependencies:**
  - [ ] Add `private readonly ITierService _tierService` field (if not from v0.0.9a)
  - [ ] Add `private readonly ITraitService _traitService` field
  - [ ] Update constructor with new parameters
- [ ] **Update `FormatMonsterExamination()` method:**
  - [ ] Get tier via `_tierService.GetTier(monster.TierId)`
  - [ ] Get traits via `_traitService.GetTraits(monster.TraitIds)`
  - [ ] Header: Use `monster.DisplayName` with `monster.DisplayColor`
  - [ ] If tier is not "common": Display tier name with color
  - [ ] If traits.Count > 0: List each trait with name, color, and description
  - [ ] Add resistances display (from v0.0.9b)

**Acceptance:** `examine orc` shows tier, traits with descriptions, and resistances.

---

### Phase 6: Testing (Verification)

#### 6.1 Create `TierDefinitionTests.cs` ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Domain.UnitTests/Definitions/TierDefinitionTests.cs`
**Depends on:** 1.2

- [ ] Create test file with `[Fact]` and `[Theory]` tests
- [ ] **Test cases (~4 tests):**
  - [ ] `Create_ValidInputs_ReturnsTierWithCorrectValues`
  - [ ] `Create_EmptyId_ThrowsArgumentException`
  - [ ] `Create_ZeroHealthMultiplier_ThrowsArgumentOutOfRangeException`
  - [ ] `Create_NormalizesIdToLowercase`
  - [ ] `Common_ReturnsDefaultTier`

**Acceptance:** All tests pass. Validation edge cases covered.

---

#### 6.2 Create `MonsterTraitTests.cs` ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Domain.UnitTests/Definitions/MonsterTraitTests.cs`
**Depends on:** 1.3

- [ ] Create test file
- [ ] **Test cases (~3 tests):**
  - [ ] `Create_ValidInputs_ReturnsTraitWithCorrectValues`
  - [ ] `Create_NormalizesIdAndTags`
  - [ ] `Create_EmptyName_ThrowsArgumentException`

**Acceptance:** All tests pass.

---

#### 6.3 Create `NameGeneratorConfigTests.cs` ğŸŸ¡ â­â­

**File:** `tests/RuneAndRust.Domain.UnitTests/ValueObjects/NameGeneratorConfigTests.cs`
**Depends on:** 1.4

- [ ] Create test file
- [ ] **Test cases (~3 tests):**
  - [ ] `GenerateName_UsesPrefixSuffixAndFormat`
  - [ ] `GenerateName_EmptyPrefixes_ReturnsTypeName`
  - [ ] `Default_HasExpectedValues`

**Acceptance:** Name generation produces expected format.

---

#### 6.4 Create `TierServiceTests.cs` ğŸŸ¡ â­â­â­

**File:** `tests/RuneAndRust.Application.UnitTests/Services/TierServiceTests.cs`
**Depends on:** 2.7

- [ ] Create test file with mock `IGameConfigurationProvider`
- [ ] **Test cases (~5 tests):**
  - [ ] `GetTier_ValidId_ReturnsTier`
  - [ ] `GetTier_InvalidId_ReturnsNull`
  - [ ] `SelectRandomTier_EmptyList_ReturnsDefault`
  - [ ] `SelectRandomTier_RespectsWeights` (use seeded Random)
  - [ ] `GetDefaultTier_ReturnsCommonTier`

**Acceptance:** All tests pass with mocked configuration.

---

#### 6.5 Create `TraitServiceTests.cs` ğŸŸ¡ â­â­â­

**File:** `tests/RuneAndRust.Application.UnitTests/Services/TraitServiceTests.cs`
**Depends on:** 2.8

- [ ] Create test file with mock `IGameConfigurationProvider`
- [ ] **Test cases (~5 tests):**
  - [ ] `GetTrait_ValidId_ReturnsTrait`
  - [ ] `GetTraits_MultipleIds_ReturnsMatching`
  - [ ] `SelectRandomTraits_CommonTier_ReturnsEmpty`
  - [ ] `SelectRandomTraits_EliteTier_ReturnsUpTo2Traits`
  - [ ] `SelectRandomTraits_EmptyPossible_ReturnsEmpty`

**Acceptance:** All tests pass. Tier-based trait counts verified.

---

#### 6.6 Update `MonsterServiceTests.cs` ğŸŸ¡ â­â­â­

**File:** `tests/RuneAndRust.Application.UnitTests/Services/MonsterServiceTests.cs`
**Depends on:** 2.9

- [ ] **Add new test cases (~4 tests):**
  - [ ] `SpawnMonster_AppliesTierMultipliers` - Elite orc has 2x HP
  - [ ] `SpawnMonster_GeneratesNameForNamedTier` - Named orc gets generated name
  - [ ] `SpawnMonster_AssignsTraitsBasedOnTier` - Elite gets traits
  - [ ] `SpawnMonster_WithForcedTier_UsesForcedTier`

**Acceptance:** All tests pass. Tier multipliers and trait assignment verified.

---

### Phase 7: Integration & DI Registration

#### 7.1 Update DI Container Registration ğŸŸ¡ â­

**File:** (DI setup file in Presentation layer)
**Depends on:** 2.7, 2.8, 5.1

- [ ] Register `ITierService` â†’ `TierService`
- [ ] Register `ITraitService` â†’ `TraitService`
- [ ] Update `MonsterService` registration (new constructor parameters)
- [ ] Update any affected constructor chains (GameSessionService, SpectreGameRenderer)

**Acceptance:** Application starts without DI resolution errors. Monsters spawn with tiers.

---

### Implementation Order Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: Domain (Foundation)                                â”‚
â”‚  1.1 TraitEffect.cs (enum) â”€â”€â”€â”€â”€â”¬â”€â†’ Phase 2                 â”‚
â”‚  1.2 TierDefinition.cs  â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  1.3 MonsterTrait.cs  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  1.4 NameGeneratorConfig.cs â”€â”€â”€â”€â”¤                           â”‚
â”‚  1.5 MonsterDefinition.cs â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  1.6 Monster.cs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: Application (Services)                             â”‚
â”‚  2.1-2.3 DTOs (parallel)                                    â”‚
â”‚  2.4 IConfigurationProvider â”€â”€â”€â”€â”¬â”€â†’ 2.7, 2.8                â”‚
â”‚  2.5-2.6 Interfaces â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  2.7 TierService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  2.8 TraitService â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
â”‚  2.9 MonsterService (CRITICAL) â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: Infrastructure (Data Loading)                      â”‚
â”‚  3.1 JsonConfigurationProvider (CRITICAL PATH)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 4: Configuration                                      â”‚
â”‚  4.1 tiers.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  4.2 traits.json â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ 4.3                     â”‚
â”‚  4.3 monsters.json (update) â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 5: Presentation                                       â”‚
â”‚  5.1 SpectreGameRenderer.cs                                 â”‚
â”‚  5.2 GameSessionService.cs                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 6: Testing                                            â”‚
â”‚  6.1 TierDefinitionTests.cs                                 â”‚
â”‚  6.2 MonsterTraitTests.cs                                   â”‚
â”‚  6.3 NameGeneratorConfigTests.cs                            â”‚
â”‚  6.4 TierServiceTests.cs                                    â”‚
â”‚  6.5 TraitServiceTests.cs                                   â”‚
â”‚  6.6 MonsterServiceTests.cs (updates)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 7: Integration                                        â”‚
â”‚  7.1 DI Container Registration                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Estimated Effort

| Phase | Tasks | Complexity | Est. Time |
|-------|-------|------------|-----------|
| Domain Layer | 6 files | â­â­ | 2-3 hours |
| Application Layer (DTOs) | 3 files | â­ | 30 min |
| Application Layer (Interfaces) | 3 files | â­ | 30 min |
| Application Layer (Services) | 3 files | â­â­â­ | 3-4 hours |
| Infrastructure Layer | 1 file | â­â­ | 1 hour |
| Configuration | 3 files | â­â­ | 1 hour |
| Presentation Layer | 2 files | â­â­ | 1 hour |
| Testing | 6 files | â­â­â­ | 3-4 hours |
| Integration | 1 task | â­ | 30 min |
| **Total** | **28 items** | | **13-16 hours** |

---

## Acceptance Criteria

### Functional Criteria

#### Tier System
| Criterion | Verification |
|-----------|--------------|
| **Tier Scaling** | Spawning an Elite Goblin (base HP 30, Elite 2.0x multiplier) results in 60 HP |
| **Stat Multipliers** | All multipliers (HP, ATK, DEF, XP, Loot) apply correctly with rounding |
| **Weighted Selection** | Common monsters spawn ~70% of attempts, Named ~20%, Elite ~8%, Boss ~2% |
| **Default Tier** | Monsters with empty `possibleTiers` default to "common" |
| **Forced Tier** | `SpawnMonster("orc", "boss")` always spawns Boss tier regardless of weights |

#### Trait System
| Criterion | Verification |
|-----------|--------------|
| **Trait Assignment** | Elite/Named monsters receive traits from their `possibleTraits` list |
| **Trait Count by Tier** | Common: 0 traits, Named: 1, Elite: 1-2, Boss: 1-3 |
| **Stat Modifiers** | `Armored` trait adds its `effectValue` to monster's defense stat |
| **Empty Traits** | Monsters with empty `possibleTraits` have no traits regardless of tier |
| **Trait Lookup** | `GetTraits()` returns complete trait objects for display |

#### Name Generation
| Criterion | Verification |
|-----------|--------------|
| **Named Tier Names** | Named tier monsters display as "Grok the Orc" not "Named Orc" |
| **Elite/Boss Prefix** | Elite displays as "Elite Goblin", Boss as "Boss Goblin" |
| **Common Names** | Common tier monsters display as plain "Goblin" |
| **Custom Generators** | Orc's custom name generator uses "Ug", "Mog", "Zug" prefixes |
| **Format String** | Title format "{0} the {1}" produces "Thag the Orc" style names |

### Visual Criteria

| Criterion | Verification |
|-----------|--------------|
| **Tier Colors** | Common=white, Named=yellow, Elite=orange3, Boss=red |
| **Monster List** | Elite monsters display: `[orange3]Elite Goblin[/] (humanoid) - HP: 60/60` |
| **Trait Display** | Traits appear below monster: `    Traits: [green]Regenerating[/], [grey]Armored[/]` |
| **Examine Output** | Shows tier name, description, health, traits with descriptions, and resistances |

### Data Verification

| Criterion | Verification |
|-----------|--------------|
| **tiers.json** | Contains 4 tiers (common, named, elite, boss) with all required fields |
| **traits.json** | Contains 5 traits with valid `TraitEffect` enum values |
| **monsters.json** | All 5 monsters updated with `possibleTiers` and `possibleTraits` |
| **Backward Compat** | Monsters without tier/trait fields spawn as Common with no traits |
| **Caching** | Configuration files loaded once and cached for performance |

### Integration Criteria

| Criterion | Verification |
|-----------|--------------|
| **DI Resolution** | Application starts without dependency injection errors |
| **Combat System** | Tiered monsters with modified stats work correctly in combat |
| **XP Rewards** | Elite monsters grant 3x XP (experienceMultiplier from tier) |
| **Loot Ready** | `Monster.LootMultiplier` populated for v0.0.9d integration |
| **All Tests Pass** | ~24 new/updated tests pass with full coverage |

---

## File Summary

### Files to Create
- `src/Core/RuneAndRust.Domain/Definitions/TierDefinition.cs`
- `src/Core/RuneAndRust.Domain/Enums/TraitEffect.cs`
- `src/Core/RuneAndRust.Domain/Definitions/MonsterTrait.cs`
- `src/Core/RuneAndRust.Domain/ValueObjects/NameGeneratorConfig.cs`
- `src/Core/RuneAndRust.Application/Interfaces/ITierService.cs`
- `src/Core/RuneAndRust.Application/Interfaces/ITraitService.cs`
- `src/Core/RuneAndRust.Application/Services/TierService.cs`
- `src/Core/RuneAndRust.Application/Services/TraitService.cs`
- `config/tiers.json`
- `config/traits.json`

### Files to Modify
- `src/Core/RuneAndRust.Domain/Definitions/MonsterDefinition.cs`
- `src/Core/RuneAndRust.Domain/Entities/Monster.cs`
- `src/Core/RuneAndRust.Application/Interfaces/IConfigurationProvider.cs`
- `src/Core/RuneAndRust.Application/Services/MonsterService.cs`
- `src/Infrastructure/RuneAndRust.Infrastructure/Configuration/JsonConfigurationProvider.cs`
- `config/monsters.json`

### Test Files Summary

| File | Test Count | Coverage Focus |
|------|------------|----------------|
| `TierDefinitionTests.cs` | ~4 | Validation, normalization, defaults |
| `MonsterTraitTests.cs` | ~3 | Validation, tag normalization |
| `NameGeneratorConfigTests.cs` | ~3 | Name generation, edge cases |
| `TierServiceTests.cs` | ~5 | Weighted selection, defaults |
| `TraitServiceTests.cs` | ~5 | Tier-based selection, filtering |
| `MonsterServiceTests.cs` (Updates) | ~4 | Tier multipliers, trait assignment |
| **Total** | **~24** |

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Tier multipliers unbalance combat | Medium | Medium | Use conservative multipliers (1.5x-2x) initially |
| Name generator creates inappropriate names | Low | Low | Curated prefix/suffix lists |
| Trait effects too complex to implement | Medium | High | Start with simple passive effects only |
| Performance impact from trait checks | Low | Medium | Cache trait lookups, defer complex calcs |
| Config changes break saves | Low | High | Use defaults for missing tier/trait IDs |

---

## Provides to Future Phases

### To v0.0.9d (Loot & Currency)

| Type | Usage |
|------|-------|
| `Monster.LootMultiplier` | Tier-based loot scaling |
| `TierDefinition.LootMultiplier` | Config-driven loot bonuses |
| `Monster.TierId` | Loot service uses tier for drop quality |

### To Combat Enhancement (Future)

| Type | Usage |
|------|-------|
| `MonsterTrait` | Combat actions check for Regenerating, Armored, etc. |
| `TraitEffect` | Combat service applies trait mechanics each turn |
| `Monster.TraitIds` | Look up active traits during combat |

### To Boss Encounters (Future)

| Type | Usage |
|------|-------|
| `TierDefinition` | "Boss" tier with special flags |
| `Monster.IsNamed` | Named bosses get special treatment |
| `Monster.DisplayName` | Unique boss names displayed prominently |

