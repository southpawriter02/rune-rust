# v0.15.6d Design Specification: Flora & Fauna Observation

**Version:** 0.15.6d
**Parent:** v0.15.6 (Advanced Perception System)
**Prerequisites:** v0.15.6c Complete (Object Category Descriptors)
**Status:** Design Complete

---

## Table of Contents

1. [Overview](#1-overview)
2. [Scope](#2-scope)
3. [Data Model](#3-data-model)
4. [Services](#4-services)
5. [Command Changes](#5-command-changes)
6. [Rendering Changes](#6-rendering-changes)
7. [Configuration](#7-configuration)
8. [Integration with Existing Systems](#8-integration-with-existing-systems)
9. [Acceptance Criteria](#9-acceptance-criteria)
10. [Test Specifications](#10-test-specifications)
11. [Dependencies](#11-dependencies)
12. [Implementation Notes](#12-implementation-notes)
13. [Design Decisions](#13-design-decisions)
14. [Future Considerations](#14-future-considerations)
15. [Appendix A: Flora & Fauna Examples](#appendix-a-flora--fauna-examples)
16. [Appendix B: Biome Ecosystem Reference](#appendix-b-biome-ecosystem-reference)

---

## 1. Overview

### 1.1 Purpose

This phase implements the flora and fauna observation system, enabling players to notice, examine, and interact with the living ecosystem of Aethelgard's biomes. Building upon the object descriptor system from v0.15.6c, this phase creates dedicated infrastructure for biological entities with specialized properties including alchemical uses, harvest mechanics, and behavioral patterns. The system transforms static environments into living ecosystems where observant players can discover resources, identify dangers, and gain deeper immersion in each biome's unique ecology.

### 1.2 Key Changes

| Area | Current State (v0.15.6c) | Target State (v0.15.6d) |
|------|--------------------------|------------------------|
| Object Types | Static objects (containers, furniture, terrain) | Living flora and fauna with behavioral properties |
| Observation | General object descriptors | Species-specific observations with ecological context |
| Interaction | Basic examine command | Species examination with harvest potential |
| Configuration | object-descriptors.json | flora-fauna-descriptors.json with species data |
| Resource Discovery | None | Alchemical uses and harvest opportunities |

### 1.3 Design Principles

1. **Ecological Authenticity**: Each biome has a coherent, believable ecosystem with appropriate flora and fauna
2. **Discovery Reward**: Higher Wits scores reveal more valuable information (alchemical uses, harvest techniques)
3. **Gameplay Integration**: Flora and fauna observations connect to alchemy, crafting, and survival systems
4. **Behavioral Immersion**: Fauna exhibits ambient behaviors that inform players about environmental conditions
5. **Harvest Risk/Reward**: Some flora has harvest risks, creating meaningful choices for resource gathering

---

## 2. Scope

### 2.1 In Scope

- FloraFaunaCategory enum (Flora, Fauna)
- FloraFaunaDescriptor value object with species-specific properties
- IFloraFaunaService interface with ambient observation, species examination, and harvest listing
- Flora species for each biome (Luminous Shelf Fungus, Rust-Eater Moss, Ember Moss, Frost Lichen, Paradox Spore Clusters)
- Fauna species (Cave Rat - universal, Rust Beetles - The Roots, Blight-Moths - Alfheim)
- Configuration file: flora-fauna-descriptors.json
- Three-layer examination integration for species
- Alchemical use discovery through expert examination
- Harvestable flora identification

### 2.2 Out of Scope (Future Phases)

- Puzzle hint integration with flora/fauna (v0.15.6e)
- Search command enhancement for hidden flora (v0.15.6f)
- Reputation modifiers for creature observation (v0.15.6g)
- Actual harvest mechanics and resource collection (future version)
- Fauna combat behaviors (handled by combat system)
- Plant growth or respawn mechanics (future version)
- Animal taming or companion systems (future version)

---

## 3. Data Model

### 3.1 FloraFaunaCategory Enum

```csharp
/// <summary>
/// Categorizes biological entities in the game world into flora (plant life)
/// or fauna (animal life) for observation and interaction purposes.
/// </summary>
/// <remarks>
/// This enum enables specialized handling of living entities separate from
/// the general ObjectCategory system, allowing for biological-specific
/// properties like alchemical uses and harvest mechanics.
/// </remarks>
public enum FloraFaunaCategory
{
    /// <summary>
    /// Plants, fungi, moss, lichen, and other botanical growths.
    /// Flora can often be harvested for alchemical ingredients.
    /// </summary>
    Flora,

    /// <summary>
    /// Ambient creatures, non-hostile animals, and environmental fauna.
    /// Fauna behavior often indicates environmental conditions or dangers.
    /// </summary>
    Fauna
}
```

### 3.2 FloraFaunaDescriptor Value Object

```csharp
/// <summary>
/// Describes a flora or fauna species with observation text, ecological data,
/// and optional harvest/alchemical properties for the perception system.
/// </summary>
/// <remarks>
/// <para>
/// FloraFaunaDescriptor follows the three-layer examination pattern established
/// in v0.15.6b, with each layer revealing progressively detailed information
/// about the species. Expert examination (Layer 3) reveals alchemical uses
/// and harvest techniques.
/// </para>
/// <para>
/// Unlike ObjectDescriptor which describes specific object instances,
/// FloraFaunaDescriptor describes species that can appear in multiple
/// locations based on biome affinity.
/// </para>
/// </remarks>
/// <param name="DescriptorId">Unique identifier for this species descriptor (e.g., "flora-roots-luminous-fungus-01").</param>
/// <param name="Category">Whether this is Flora or Fauna.</param>
/// <param name="SpeciesName">Common name used in game text (e.g., "Luminous Shelf Fungus").</param>
/// <param name="ScientificName">Optional Aethelgard Latin name for flavor (e.g., "Fungus luminaris").</param>
/// <param name="Layer">Examination layer (1 = Cursory, 2 = Detailed, 3 = Expert).</param>
/// <param name="RequiredDc">Difficulty class to perceive this detail level.</param>
/// <param name="Biome">Biome where this species appears (e.g., "The Roots", "Universal").</param>
/// <param name="DescriptorText">The observation text revealed at this layer.</param>
/// <param name="AlchemicalUse">Optional alchemical or crafting use, typically revealed at Layer 3.</param>
/// <param name="HarvestDc">Optional DC required to successfully harvest this flora.</param>
/// <param name="HarvestRisk">Optional description of risks when harvesting (damage, status effects).</param>
public readonly record struct FloraFaunaDescriptor(
    string DescriptorId,
    FloraFaunaCategory Category,
    string SpeciesName,
    string? ScientificName,
    int Layer,
    int RequiredDc,
    string Biome,
    string DescriptorText,
    string? AlchemicalUse,
    int? HarvestDc,
    string? HarvestRisk)
{
    /// <summary>
    /// Gets whether this species can be harvested for resources.
    /// </summary>
    public bool IsHarvestable => Category == FloraFaunaCategory.Flora && HarvestDc.HasValue;

    /// <summary>
    /// Gets whether harvesting this species carries risk.
    /// </summary>
    public bool HasHarvestRisk => !string.IsNullOrEmpty(HarvestRisk);

    /// <summary>
    /// Gets whether this species has known alchemical applications.
    /// </summary>
    public bool HasAlchemicalUse => !string.IsNullOrEmpty(AlchemicalUse);

    /// <summary>
    /// Gets whether this species appears universally across biomes.
    /// </summary>
    public bool IsUniversal => Biome.Equals("Universal", StringComparison.OrdinalIgnoreCase);

    /// <summary>
    /// Checks if this species can appear in the specified biome.
    /// </summary>
    /// <param name="targetBiome">The biome to check against.</param>
    /// <returns>True if the species appears in this biome or is universal.</returns>
    public bool AppearsInBiome(string targetBiome)
    {
        if (IsUniversal) return true;
        return Biome.Equals(targetBiome, StringComparison.OrdinalIgnoreCase);
    }

    /// <summary>
    /// Creates a display string for ambient observation contexts.
    /// </summary>
    /// <returns>A formatted observation string without detailed examination data.</returns>
    public string ToAmbientString()
    {
        return Category == FloraFaunaCategory.Flora
            ? $"patches of {SpeciesName}"
            : $"a {SpeciesName}";
    }

    /// <summary>
    /// Creates a display string for examination contexts.
    /// </summary>
    /// <param name="includeScientific">Whether to include the scientific name.</param>
    /// <returns>A formatted examination header string.</returns>
    public string ToExaminationHeader(bool includeScientific = false)
    {
        if (includeScientific && !string.IsNullOrEmpty(ScientificName))
        {
            return $"{SpeciesName} ({ScientificName})";
        }
        return SpeciesName;
    }
}
```

### 3.3 HarvestableFlora Value Object

```csharp
/// <summary>
/// Represents a harvestable flora instance in the current room with
/// harvest difficulty and risk information for player decision-making.
/// </summary>
/// <remarks>
/// This value object is returned by IFloraFaunaService.GetHarvestableFlora()
/// to provide players with harvest opportunities and the information needed
/// to assess risk vs. reward.
/// </remarks>
/// <param name="SpeciesId">The species descriptor ID for reference.</param>
/// <param name="SpeciesName">The common name for display.</param>
/// <param name="HarvestDc">The DC required for successful harvest.</param>
/// <param name="HarvestRisk">Description of what happens on failed harvest, if any.</param>
/// <param name="AlchemicalUse">What the harvested material can be used for.</param>
public readonly record struct HarvestableFlora(
    string SpeciesId,
    string SpeciesName,
    int HarvestDc,
    string? HarvestRisk,
    string? AlchemicalUse)
{
    /// <summary>
    /// Gets whether attempting to harvest this flora carries risk.
    /// </summary>
    public bool IsRisky => !string.IsNullOrEmpty(HarvestRisk);

    /// <summary>
    /// Creates a display string for the harvest opportunity.
    /// </summary>
    /// <returns>A formatted string describing the harvest option.</returns>
    public string ToDisplayString()
    {
        var riskWarning = IsRisky ? $" [Risk: {HarvestRisk}]" : "";
        return $"{SpeciesName} (DC {HarvestDc}){riskWarning}";
    }
}
```

### 3.4 AmbientObservation Value Object

```csharp
/// <summary>
/// Represents an ambient flora or fauna observation made through passive
/// perception or room entry, combining multiple species into atmospheric text.
/// </summary>
/// <remarks>
/// Ambient observations are generated when entering a room or through passive
/// perception checks. They provide atmospheric flavor and hint at resources
/// or dangers without requiring active examination.
/// </remarks>
/// <param name="Biome">The biome context for this observation.</param>
/// <param name="FloraObserved">List of flora species noticed in the environment.</param>
/// <param name="FaunaObserved">List of fauna species noticed in the environment.</param>
/// <param name="ObservationText">The combined atmospheric description text.</param>
public readonly record struct AmbientObservation(
    string Biome,
    IReadOnlyList<string> FloraObserved,
    IReadOnlyList<string> FaunaObserved,
    string ObservationText)
{
    /// <summary>
    /// Gets whether any flora was observed.
    /// </summary>
    public bool HasFlora => FloraObserved.Count > 0;

    /// <summary>
    /// Gets whether any fauna was observed.
    /// </summary>
    public bool HasFauna => FaunaObserved.Count > 0;

    /// <summary>
    /// Gets whether anything was observed at all.
    /// </summary>
    public bool HasObservations => HasFlora || HasFauna;

    /// <summary>
    /// Gets the total count of species observed.
    /// </summary>
    public int TotalSpeciesCount => FloraObserved.Count + FaunaObserved.Count;
}
```

### 3.5 SpeciesExaminationResult Value Object

```csharp
/// <summary>
/// Contains the result of examining a specific flora or fauna species,
/// including all revealed layers and any special discoveries.
/// </summary>
/// <remarks>
/// This extends the general ExaminationResult pattern from v0.15.6b with
/// species-specific data including alchemical uses and harvest information.
/// </remarks>
/// <param name="SpeciesId">The examined species descriptor ID.</param>
/// <param name="SpeciesName">The species common name.</param>
/// <param name="ScientificName">The Aethelgard Latin name, if known.</param>
/// <param name="Category">Whether this is Flora or Fauna.</param>
/// <param name="LayersRevealed">List of examination layers successfully revealed.</param>
/// <param name="HighestLayerReached">The maximum layer achieved (1, 2, or 3).</param>
/// <param name="SuccessCount">Number of successes rolled on the Wits check.</param>
/// <param name="AlchemicalUseRevealed">Alchemical use info if Layer 3 reached.</param>
/// <param name="HarvestInfoRevealed">Harvest DC and risk if Layer 3 reached on flora.</param>
public readonly record struct SpeciesExaminationResult(
    string SpeciesId,
    string SpeciesName,
    string? ScientificName,
    FloraFaunaCategory Category,
    IReadOnlyList<string> LayersRevealed,
    int HighestLayerReached,
    int SuccessCount,
    string? AlchemicalUseRevealed,
    HarvestableFlora? HarvestInfoRevealed)
{
    /// <summary>
    /// Gets whether expert-level information was revealed.
    /// </summary>
    public bool ReachedExpertLevel => HighestLayerReached >= 3;

    /// <summary>
    /// Gets whether alchemical uses were discovered.
    /// </summary>
    public bool DiscoveredAlchemicalUse => !string.IsNullOrEmpty(AlchemicalUseRevealed);

    /// <summary>
    /// Gets whether harvest information was revealed.
    /// </summary>
    public bool DiscoveredHarvestInfo => HarvestInfoRevealed.HasValue;

    /// <summary>
    /// Gets the examination header for display.
    /// </summary>
    public string GetDisplayHeader()
    {
        if (!string.IsNullOrEmpty(ScientificName) && ReachedExpertLevel)
        {
            return $"{SpeciesName} ({ScientificName})";
        }
        return SpeciesName;
    }
}
```

---

## 4. Services

### 4.1 IFloraFaunaService Interface

```csharp
/// <summary>
/// Service interface for flora and fauna observation, examination, and
/// harvest information within the perception system.
/// </summary>
/// <remarks>
/// <para>
/// This service handles all biological entity observations separate from
/// the general object perception system, enabling specialized handling of
/// species data, ecological behaviors, and harvest mechanics.
/// </para>
/// <para>
/// The service integrates with the three-layer examination system from v0.15.6b
/// and uses the success-counting dice mechanics from v0.15.0.
/// </para>
/// </remarks>
public interface IFloraFaunaService
{
    /// <summary>
    /// Gets ambient flora and fauna observation for a room based on
    /// the player's Wits pool and the room's biome.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Ambient observation occurs automatically when entering a room or
    /// through passive perception. The Wits pool determines how many
    /// species the player notices and how much detail is provided.
    /// </para>
    /// <para>
    /// The observation text is atmospheric and does not require dice rolls,
    /// but higher Wits pools notice more species and subtle details.
    /// </para>
    /// </remarks>
    /// <param name="roomId">The room being observed.</param>
    /// <param name="biome">The biome of the room (determines available species).</param>
    /// <param name="witsPool">The player's Wits dice pool for passive observation.</param>
    /// <returns>An ambient observation with atmospheric text and species list.</returns>
    AmbientObservation GetAmbientObservation(string roomId, string biome, int witsPool);

    /// <summary>
    /// Examines a specific flora or fauna species using the three-layer
    /// examination system with Wits-based success counting.
    /// </summary>
    /// <remarks>
    /// <para>
    /// Examination follows the same DC thresholds as object examination:
    /// - Layer 1 (Cursory): DC 0 (automatic)
    /// - Layer 2 (Detailed): DC 12 (2 successes)
    /// - Layer 3 (Expert): DC 18 (4 successes)
    /// </para>
    /// <para>
    /// Expert examination of flora reveals alchemical uses and harvest
    /// information. Expert examination of fauna reveals behavioral
    /// patterns and environmental indicators.
    /// </para>
    /// </remarks>
    /// <param name="speciesId">The species descriptor ID to examine.</param>
    /// <param name="witsPool">The player's Wits dice pool for the examination.</param>
    /// <returns>The examination result with all revealed information.</returns>
    SpeciesExaminationResult ExamineSpecies(string speciesId, int witsPool);

    /// <summary>
    /// Gets all harvestable flora in the specified room that the player
    /// has discovered through examination or passive perception.
    /// </summary>
    /// <remarks>
    /// This method returns flora that:
    /// 1. Is present in the room's biome
    /// 2. Has been noticed by the player (through ambient observation or examination)
    /// 3. Has harvest mechanics defined (HarvestDc is set)
    ///
    /// The actual harvest action is handled by a separate harvesting system
    /// in a future version; this method only provides discovery information.
    /// </remarks>
    /// <param name="roomId">The room to check for harvestable flora.</param>
    /// <returns>A list of harvestable flora with DC and risk information.</returns>
    IReadOnlyList<HarvestableFlora> GetHarvestableFlora(string roomId);

    /// <summary>
    /// Gets all flora species that can appear in the specified biome.
    /// </summary>
    /// <param name="biome">The biome to get flora for.</param>
    /// <returns>A list of flora species for this biome including universal species.</returns>
    IReadOnlyList<FloraFaunaDescriptor> GetFloraForBiome(string biome);

    /// <summary>
    /// Gets all fauna species that can appear in the specified biome.
    /// </summary>
    /// <param name="biome">The biome to get fauna for.</param>
    /// <returns>A list of fauna species for this biome including universal species.</returns>
    IReadOnlyList<FloraFaunaDescriptor> GetFaunaForBiome(string biome);

    /// <summary>
    /// Gets a specific species descriptor by ID.
    /// </summary>
    /// <param name="speciesId">The species descriptor ID.</param>
    /// <returns>The species descriptor, or null if not found.</returns>
    FloraFaunaDescriptor? GetSpeciesById(string speciesId);
}
```

### 4.2 FloraFaunaService Implementation

```csharp
/// <summary>
/// Implementation of IFloraFaunaService providing flora and fauna
/// observation, examination, and harvest information.
/// </summary>
/// <remarks>
/// <para>
/// This service loads species data from flora-fauna-descriptors.json and
/// provides biome-filtered access for room observations. It integrates
/// with the dice system for examination checks and the three-layer
/// system for progressive information reveal.
/// </para>
/// <para>
/// Species are organized by biome with a "Universal" biome for species
/// that appear across all environments (e.g., Cave Rats).
/// </para>
/// </remarks>
public class FloraFaunaService : IFloraFaunaService
{
    private readonly IFloraFaunaDescriptorRepository _repository;
    private readonly IDiceService _diceService;
    private readonly IPlayerDiscoveryTracker _discoveryTracker;
    private readonly ILogger<FloraFaunaService> _logger;

    // Wits thresholds for ambient observation quantity
    private const int LowWitsThreshold = 2;
    private const int MediumWitsThreshold = 4;
    private const int HighWitsThreshold = 6;

    public FloraFaunaService(
        IFloraFaunaDescriptorRepository repository,
        IDiceService diceService,
        IPlayerDiscoveryTracker discoveryTracker,
        ILogger<FloraFaunaService> logger)
    {
        _repository = repository ?? throw new ArgumentNullException(nameof(repository));
        _diceService = diceService ?? throw new ArgumentNullException(nameof(diceService));
        _discoveryTracker = discoveryTracker ?? throw new ArgumentNullException(nameof(discoveryTracker));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <inheritdoc />
    public AmbientObservation GetAmbientObservation(string roomId, string biome, int witsPool)
    {
        _logger.LogDebug("Getting ambient observation for room {RoomId} in biome {Biome} with Wits {Wits}",
            roomId, biome, witsPool);

        // Determine how many species to reveal based on Wits
        var maxSpecies = witsPool switch
        {
            <= LowWitsThreshold => 1,
            <= MediumWitsThreshold => 2,
            <= HighWitsThreshold => 3,
            _ => 4
        };

        // Get biome-appropriate species
        var flora = GetFloraForBiome(biome)
            .Where(f => f.Layer == 1) // Only Layer 1 for ambient
            .Take(maxSpecies / 2 + 1)
            .ToList();

        var fauna = GetFaunaForBiome(biome)
            .Where(f => f.Layer == 1)
            .Take(maxSpecies / 2)
            .ToList();

        // Track discoveries
        foreach (var f in flora)
        {
            _discoveryTracker.MarkSpeciesDiscovered(roomId, f.DescriptorId);
        }
        foreach (var f in fauna)
        {
            _discoveryTracker.MarkSpeciesDiscovered(roomId, f.DescriptorId);
        }

        // Build atmospheric text
        var observationText = BuildAmbientText(flora, fauna, biome);

        return new AmbientObservation(
            biome,
            flora.Select(f => f.SpeciesName).ToList(),
            fauna.Select(f => f.SpeciesName).ToList(),
            observationText);
    }

    /// <inheritdoc />
    public SpeciesExaminationResult ExamineSpecies(string speciesId, int witsPool)
    {
        _logger.LogDebug("Examining species {SpeciesId} with Wits pool {Wits}", speciesId, witsPool);

        var species = GetSpeciesById(speciesId);
        if (species == null)
        {
            _logger.LogWarning("Species {SpeciesId} not found", speciesId);
            throw new ArgumentException($"Unknown species: {speciesId}", nameof(speciesId));
        }

        // Roll Wits dice using success-counting mechanics
        var rollResult = _diceService.RollSuccessPool(witsPool);
        var successes = rollResult.Successes;

        // Determine highest layer reached
        var highestLayer = successes switch
        {
            >= 4 => 3, // Expert (DC 18)
            >= 2 => 2, // Detailed (DC 12)
            _ => 1     // Cursory (DC 0)
        };

        // Get all descriptors for this species up to the achieved layer
        var allDescriptors = _repository.GetBySpeciesName(species.Value.SpeciesName);
        var revealedLayers = allDescriptors
            .Where(d => d.Layer <= highestLayer)
            .OrderBy(d => d.Layer)
            .Select(d => d.DescriptorText)
            .ToList();

        // Check for alchemical use (Layer 3 only)
        string? alchemicalUse = null;
        HarvestableFlora? harvestInfo = null;

        if (highestLayer >= 3)
        {
            var expertDescriptor = allDescriptors.FirstOrDefault(d => d.Layer == 3);
            if (expertDescriptor.HasAlchemicalUse)
            {
                alchemicalUse = expertDescriptor.AlchemicalUse;
            }

            if (expertDescriptor.IsHarvestable)
            {
                harvestInfo = new HarvestableFlora(
                    expertDescriptor.DescriptorId,
                    expertDescriptor.SpeciesName,
                    expertDescriptor.HarvestDc!.Value,
                    expertDescriptor.HarvestRisk,
                    expertDescriptor.AlchemicalUse);
            }
        }

        return new SpeciesExaminationResult(
            speciesId,
            species.Value.SpeciesName,
            species.Value.ScientificName,
            species.Value.Category,
            revealedLayers,
            highestLayer,
            successes,
            alchemicalUse,
            harvestInfo);
    }

    /// <inheritdoc />
    public IReadOnlyList<HarvestableFlora> GetHarvestableFlora(string roomId)
    {
        _logger.LogDebug("Getting harvestable flora for room {RoomId}", roomId);

        var discoveredSpecies = _discoveryTracker.GetDiscoveredSpecies(roomId);

        return discoveredSpecies
            .Select(id => GetSpeciesById(id))
            .Where(s => s.HasValue && s.Value.IsHarvestable)
            .Select(s => new HarvestableFlora(
                s!.Value.DescriptorId,
                s.Value.SpeciesName,
                s.Value.HarvestDc!.Value,
                s.Value.HarvestRisk,
                s.Value.AlchemicalUse))
            .ToList();
    }

    /// <inheritdoc />
    public IReadOnlyList<FloraFaunaDescriptor> GetFloraForBiome(string biome)
    {
        return _repository.GetByCategory(FloraFaunaCategory.Flora)
            .Where(f => f.AppearsInBiome(biome))
            .ToList();
    }

    /// <inheritdoc />
    public IReadOnlyList<FloraFaunaDescriptor> GetFaunaForBiome(string biome)
    {
        return _repository.GetByCategory(FloraFaunaCategory.Fauna)
            .Where(f => f.AppearsInBiome(biome))
            .ToList();
    }

    /// <inheritdoc />
    public FloraFaunaDescriptor? GetSpeciesById(string speciesId)
    {
        return _repository.GetById(speciesId);
    }

    /// <summary>
    /// Builds atmospheric text combining observed flora and fauna.
    /// </summary>
    private string BuildAmbientText(
        IReadOnlyList<FloraFaunaDescriptor> flora,
        IReadOnlyList<FloraFaunaDescriptor> fauna,
        string biome)
    {
        var parts = new List<string>();

        if (flora.Count > 0)
        {
            var floraNames = string.Join(" and ", flora.Select(f => f.ToAmbientString()));
            parts.Add($"You notice {floraNames} growing nearby");
        }

        if (fauna.Count > 0)
        {
            var faunaText = fauna.Count == 1
                ? $"{fauna[0].ToAmbientString()} moves in the shadows"
                : $"small creatures stir in the darkness";
            parts.Add(faunaText);
        }

        return parts.Count > 0
            ? string.Join(". ", parts) + "."
            : $"The {biome} environment appears barren of obvious life.";
    }
}
```

### 4.3 IFloraFaunaDescriptorRepository Interface

```csharp
/// <summary>
/// Repository interface for loading and querying flora and fauna descriptors
/// from configuration storage.
/// </summary>
public interface IFloraFaunaDescriptorRepository
{
    /// <summary>
    /// Gets a species descriptor by its unique ID.
    /// </summary>
    /// <param name="descriptorId">The descriptor ID.</param>
    /// <returns>The descriptor, or null if not found.</returns>
    FloraFaunaDescriptor? GetById(string descriptorId);

    /// <summary>
    /// Gets all descriptors for a species by common name.
    /// </summary>
    /// <param name="speciesName">The species common name.</param>
    /// <returns>All layer descriptors for this species.</returns>
    IReadOnlyList<FloraFaunaDescriptor> GetBySpeciesName(string speciesName);

    /// <summary>
    /// Gets all descriptors matching a category (Flora or Fauna).
    /// </summary>
    /// <param name="category">The category to filter by.</param>
    /// <returns>All descriptors in this category.</returns>
    IReadOnlyList<FloraFaunaDescriptor> GetByCategory(FloraFaunaCategory category);

    /// <summary>
    /// Gets all descriptors for a specific biome.
    /// </summary>
    /// <param name="biome">The biome name.</param>
    /// <returns>All descriptors for this biome plus universal descriptors.</returns>
    IReadOnlyList<FloraFaunaDescriptor> GetByBiome(string biome);

    /// <summary>
    /// Gets all harvestable flora descriptors.
    /// </summary>
    /// <returns>All flora with harvest DC defined.</returns>
    IReadOnlyList<FloraFaunaDescriptor> GetHarvestable();
}
```

### 4.4 IPlayerDiscoveryTracker Interface

```csharp
/// <summary>
/// Tracks what flora and fauna species a player has discovered in each room,
/// enabling persistent discovery state across sessions.
/// </summary>
/// <remarks>
/// Discovery tracking is essential for the harvest system - players can only
/// harvest flora they have noticed through ambient observation or examination.
/// </remarks>
public interface IPlayerDiscoveryTracker
{
    /// <summary>
    /// Marks a species as discovered in a specific room.
    /// </summary>
    /// <param name="roomId">The room where discovery occurred.</param>
    /// <param name="speciesId">The species descriptor ID.</param>
    void MarkSpeciesDiscovered(string roomId, string speciesId);

    /// <summary>
    /// Gets all species discovered in a specific room.
    /// </summary>
    /// <param name="roomId">The room to query.</param>
    /// <returns>List of discovered species IDs.</returns>
    IReadOnlyList<string> GetDiscoveredSpecies(string roomId);

    /// <summary>
    /// Checks if a specific species has been discovered in a room.
    /// </summary>
    /// <param name="roomId">The room to check.</param>
    /// <param name="speciesId">The species to check for.</param>
    /// <returns>True if discovered, false otherwise.</returns>
    bool IsSpeciesDiscovered(string roomId, string speciesId);
}
```

### 4.5 Service Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    FLORA & FAUNA OBSERVATION FLOW                            │
└─────────────────────────────────────────────────────────────────────────────┘

    Player enters room or uses 'look' command
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      AMBIENT OBSERVATION                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Get room's biome from room data                                         │
│  2. Query biome-appropriate flora and fauna (Layer 1 only)                  │
│  3. Limit species count based on Wits pool:                                 │
│     - Wits ≤2: 1 species, Wits ≤4: 2, Wits ≤6: 3, Wits >6: 4               │
│  4. Mark observed species as discovered for this room                       │
│  5. Build atmospheric description text                                       │
│  6. Return AmbientObservation to renderer                                   │
└─────────────────────────────────────────────────────────────────────────────┘
                        │
                        ▼
           Room description includes flora/fauna text


    Player uses 'examine <species>' command
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      SPECIES EXAMINATION                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Validate species exists and was discovered                              │
│  2. Roll Wits pool using success-counting (8-10 = success)                  │
│  3. Determine highest layer reached:                                        │
│     - 0-1 successes: Layer 1 (Cursory)                                      │
│     - 2-3 successes: Layer 2 (Detailed)                                     │
│     - 4+ successes: Layer 3 (Expert)                                        │
│  4. Aggregate descriptor text for all achieved layers                       │
│  5. If Layer 3 reached:                                                     │
│     - Reveal alchemical use (if any)                                        │
│     - Reveal harvest info (if flora with HarvestDc)                         │
│  6. Return SpeciesExaminationResult                                         │
└─────────────────────────────────────────────────────────────────────────────┘
                        │
                        ▼
           Examination result rendered with layer info


    Player uses 'harvest' or checks harvestable flora
                        │
                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      HARVEST INFORMATION                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  1. Get player's discovered species for this room                           │
│  2. Filter to flora with HarvestDc defined                                  │
│  3. Return list of HarvestableFlora with:                                   │
│     - Species name and ID                                                   │
│     - Harvest DC                                                            │
│     - Risk description (if any)                                             │
│     - Alchemical use (if known)                                             │
└─────────────────────────────────────────────────────────────────────────────┘
                        │
                        ▼
           Harvestable flora list shown to player
```

---

## 5. Command Changes

### 5.1 Examine Command Enhancement

The existing `examine` command from v0.15.6b is extended to handle flora and fauna species names.

```csharp
// In ConsoleInputHandler.ParseCommand():

"examine" or "ex" or "x" => ParseExamineCommand(argument),

private GameCommand ParseExamineCommand(string? argument)
{
    if (string.IsNullOrWhiteSpace(argument))
    {
        return new ExamineCommand();
    }

    // Check if argument matches a known species name
    var normalizedArg = argument.Trim().ToLowerInvariant();

    // Species names can contain spaces, so check against known species
    // The command handler will determine if it's an object or species
    return new ExamineCommand(normalizedArg);
}
```

### 5.2 New: Harvest Command (Information Only)

```csharp
/// <summary>
/// Command to display harvestable flora in the current room.
/// Actual harvesting mechanics are deferred to a future version.
/// </summary>
/// <param name="TargetSpecies">Optional specific species to show harvest info for.</param>
public record HarvestCommand(string? TargetSpecies = null) : GameCommand;

// In ConsoleInputHandler.ParseCommand():

"harvest" or "forage" => ParseHarvestCommand(argument),

private GameCommand ParseHarvestCommand(string? argument)
{
    return new HarvestCommand(argument?.Trim());
}
```

### 5.3 User Commands

| Command | Description | Example |
|---------|-------------|---------|
| `examine <species>` | Examines a flora or fauna species with Wits check | `examine luminous shelf fungus` |
| `ex <species>` | Short form of examine | `ex cave rat` |
| `harvest` | Lists all harvestable flora in current room | `harvest` |
| `harvest <species>` | Shows harvest info for specific species | `harvest rust-eater moss` |
| `forage` | Alias for harvest command | `forage` |

---

## 6. Rendering Changes

### 6.1 IGameRenderer Additions

```csharp
/// <summary>
/// Renders ambient flora and fauna observation text.
/// </summary>
/// <param name="observation">The ambient observation data.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderAmbientObservationAsync(AmbientObservation observation, CancellationToken ct = default);

/// <summary>
/// Renders species examination result with layered detail.
/// </summary>
/// <param name="result">The examination result.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderSpeciesExaminationAsync(SpeciesExaminationResult result, CancellationToken ct = default);

/// <summary>
/// Renders list of harvestable flora in current room.
/// </summary>
/// <param name="harvestable">The list of harvestable flora.</param>
/// <param name="ct">Cancellation token.</param>
Task RenderHarvestableFloraAsync(IReadOnlyList<HarvestableFlora> harvestable, CancellationToken ct = default);
```

### 6.2 Display Examples

#### Ambient Observation (On Room Entry)

```
═══════════════════════════════════════════════════════════════════════════════
                              THE FORGOTTEN DEPTHS
═══════════════════════════════════════════════════════════════════════════════

You stand in a cavern deep within The Roots. Ancient Jötun pipes line the
walls, many corroded beyond recognition.

You notice patches of Luminous Shelf Fungus and Rust-Eater Moss growing
nearby. A Cave Rat moves in the shadows.

Exits: [N] Maintenance Tunnel  [S] Collapsed Passage

> _
```

#### Species Examination (Cursory - Layer 1)

```
> examine luminous shelf fungus

[WITS Check: 1 success]

═══════════════════════════════════════════════════════════════════════════════
                          LUMINOUS SHELF FUNGUS
═══════════════════════════════════════════════════════════════════════════════

A pale, bioluminescent fungus growing in shelf-like formations on the damp
walls. It emits a soft blue-green glow.

> _
```

#### Species Examination (Detailed - Layer 2)

```
> examine luminous shelf fungus

[WITS Check: 3 successes]

═══════════════════════════════════════════════════════════════════════════════
                          LUMINOUS SHELF FUNGUS
═══════════════════════════════════════════════════════════════════════════════

A pale, bioluminescent fungus growing in shelf-like formations on the damp
walls. It emits a soft blue-green glow.

The fungus appears to feed on trace minerals in the rock. Its glow
intensifies when disturbed, possibly a defense mechanism. The oldest
specimens have developed intricate gill patterns.

> _
```

#### Species Examination (Expert - Layer 3)

```
> examine luminous shelf fungus

[WITS Check: 5 successes]

═══════════════════════════════════════════════════════════════════════════════
                  LUMINOUS SHELF FUNGUS (Fungus luminaris)
═══════════════════════════════════════════════════════════════════════════════

A pale, bioluminescent fungus growing in shelf-like formations on the damp
walls. It emits a soft blue-green glow.

The fungus appears to feed on trace minerals in the rock. Its glow
intensifies when disturbed, possibly a defense mechanism. The oldest
specimens have developed intricate gill patterns.

The bioluminescent compound within the fungal tissue can be extracted
through careful processing. Jötun alchemical texts reference its use in
light-producing elixirs and as a base for visibility potions.

───────────────────────────────────────────────────────────────────────────────
ALCHEMICAL USE: Light-producing elixirs, visibility potions
HARVEST DC: 8 | RISK: None
───────────────────────────────────────────────────────────────────────────────

> _
```

#### Harvestable Flora List

```
> harvest

═══════════════════════════════════════════════════════════════════════════════
                          HARVESTABLE FLORA
═══════════════════════════════════════════════════════════════════════════════

The following flora can be harvested in this area:

  • Luminous Shelf Fungus (DC 8)
    Use: Light-producing elixirs, visibility potions

  • Rust-Eater Moss (DC 12) [Risk: Acidic residue]
    Use: Acid compounds, metal-dissolving agents

───────────────────────────────────────────────────────────────────────────────
Use 'harvest <species>' to attempt harvesting (future feature).
───────────────────────────────────────────────────────────────────────────────

> _
```

#### Fauna Examination (Expert - Layer 3)

```
> examine cave rat

[WITS Check: 4 successes]

═══════════════════════════════════════════════════════════════════════════════
                        CAVE RAT (Rattus subterranus)
═══════════════════════════════════════════════════════════════════════════════

A small, dark-furred rodent adapted to life in the depths. It watches you
with intelligent, reflective eyes before scurrying into a crevice.

This species has adapted to complete darkness, relying on keen hearing and
whiskers to navigate. They tend to congregate in areas with stable
temperature and humidity.

Cave rats are reliable indicators of environmental safety - they avoid
areas with toxic gases or unstable ground. Their presence suggests this
area is relatively safe. Jötun workers reportedly used them as "canaries"
to detect hazardous conditions.

───────────────────────────────────────────────────────────────────────────────
BEHAVIOR: Safety indicator - presence suggests stable environment
───────────────────────────────────────────────────────────────────────────────

> _
```

---

## 7. Configuration

### 7.1 flora-fauna-descriptors.json

```json
{
  "version": "0.15.6d",
  "species": [
    {
      "speciesName": "Luminous Shelf Fungus",
      "scientificName": "Fungus luminaris",
      "category": "Flora",
      "biome": "The Roots",
      "descriptors": [
        {
          "id": "flora-roots-luminous-fungus-01",
          "layer": 1,
          "dc": 0,
          "text": "A pale, bioluminescent fungus growing in shelf-like formations on the damp walls. It emits a soft blue-green glow."
        },
        {
          "id": "flora-roots-luminous-fungus-02",
          "layer": 2,
          "dc": 12,
          "text": "The fungus appears to feed on trace minerals in the rock. Its glow intensifies when disturbed, possibly a defense mechanism. The oldest specimens have developed intricate gill patterns."
        },
        {
          "id": "flora-roots-luminous-fungus-03",
          "layer": 3,
          "dc": 18,
          "text": "The bioluminescent compound within the fungal tissue can be extracted through careful processing. Jötun alchemical texts reference its use in light-producing elixirs and as a base for visibility potions.",
          "alchemicalUse": "Light-producing elixirs, visibility potions",
          "harvestDc": 8,
          "harvestRisk": null
        }
      ]
    },
    {
      "speciesName": "Rust-Eater Moss",
      "scientificName": "Muscus ferrophagus",
      "category": "Flora",
      "biome": "The Roots",
      "descriptors": [
        {
          "id": "flora-roots-rust-moss-01",
          "layer": 1,
          "dc": 0,
          "text": "Orange-red moss clings to corroded metal surfaces, its color matching the rust it grows upon."
        },
        {
          "id": "flora-roots-rust-moss-02",
          "layer": 2,
          "dc": 12,
          "text": "The moss appears to actively consume iron oxide, leaving clean metal beneath where it has fed. Small droplets of acidic moisture bead on its surface."
        },
        {
          "id": "flora-roots-rust-moss-03",
          "layer": 3,
          "dc": 18,
          "text": "The moss secretes a compound that accelerates oxidation while simultaneously absorbing the resulting rust. This compound can be carefully extracted for alchemical purposes, though the acid requires proper handling.",
          "alchemicalUse": "Acid compounds, metal-dissolving agents",
          "harvestDc": 12,
          "harvestRisk": "Acidic residue (1d4 damage on failed harvest)"
        }
      ]
    },
    {
      "speciesName": "Ember Moss",
      "scientificName": "Muscus ignis",
      "category": "Flora",
      "biome": "Muspelheim",
      "descriptors": [
        {
          "id": "flora-muspel-ember-moss-01",
          "layer": 1,
          "dc": 0,
          "text": "Deep red moss that seems to glow faintly with inner heat, thriving on volcanic rock near thermal vents."
        },
        {
          "id": "flora-muspel-ember-moss-02",
          "layer": 2,
          "dc": 12,
          "text": "The moss radiates noticeable warmth to the touch. It appears to undergo a form of thermal photosynthesis, converting heat energy directly into growth."
        },
        {
          "id": "flora-muspel-ember-moss-03",
          "layer": 3,
          "dc": 18,
          "text": "Ember Moss contains thermophilic compounds that remain stable at extreme temperatures. Jötun fire-smiths used it in heat-resistant treatments and warming elixirs.",
          "alchemicalUse": "Heat-resistant treatments, warming elixirs",
          "harvestDc": 14,
          "harvestRisk": "Heat damage (1d6 fire damage on failed harvest)"
        }
      ]
    },
    {
      "speciesName": "Frost Lichen",
      "scientificName": "Lichen glacialis",
      "category": "Flora",
      "biome": "Niflheim",
      "descriptors": [
        {
          "id": "flora-nifl-frost-lichen-01",
          "layer": 1,
          "dc": 0,
          "text": "Pale blue lichen forms crystalline patterns on the frozen surfaces, seemingly immune to the bitter cold."
        },
        {
          "id": "flora-nifl-frost-lichen-02",
          "layer": 2,
          "dc": 12,
          "text": "The lichen's cells contain a natural antifreeze compound. Ice crystals form beautiful geometric patterns within its structure rather than destroying the tissue."
        },
        {
          "id": "flora-nifl-frost-lichen-03",
          "layer": 3,
          "dc": 18,
          "text": "The antifreeze compounds within Frost Lichen can be distilled into potent cold-resistance elixirs. The Jötun also used it to preserve organic materials indefinitely.",
          "alchemicalUse": "Cold-resistance elixirs, preservation compounds",
          "harvestDc": 10,
          "harvestRisk": "Frostbite (1d4 cold damage on failed harvest)"
        }
      ]
    },
    {
      "speciesName": "Paradox Spore Clusters",
      "scientificName": "Spora paradoxis",
      "category": "Flora",
      "biome": "Alfheim",
      "descriptors": [
        {
          "id": "flora-alf-paradox-spores-01",
          "layer": 1,
          "dc": 0,
          "text": "Iridescent fungal clusters that seem to shimmer between states of existence, their colors shifting in ways that hurt to observe directly."
        },
        {
          "id": "flora-alf-paradox-spores-02",
          "layer": 2,
          "dc": 12,
          "text": "The spores appear to exist partially outside normal reality. Looking at them from different angles reveals entirely different structures, as if multiple versions occupy the same space."
        },
        {
          "id": "flora-alf-paradox-spores-03",
          "layer": 3,
          "dc": 18,
          "text": "These spores grow where reality is thin, feeding on the boundary between dimensions. Their reality-warping properties make them incredibly dangerous to harvest but invaluable for dimensional alchemy and perception-altering compounds.",
          "alchemicalUse": "Dimensional alchemy, perception-altering compounds",
          "harvestDc": 18,
          "harvestRisk": "Reality distortion (Confusion effect on failed harvest)"
        }
      ]
    },
    {
      "speciesName": "Cave Rat",
      "scientificName": "Rattus subterranus",
      "category": "Fauna",
      "biome": "Universal",
      "descriptors": [
        {
          "id": "fauna-univ-cave-rat-01",
          "layer": 1,
          "dc": 0,
          "text": "A small, dark-furred rodent adapted to life in the depths. It watches you with intelligent, reflective eyes before scurrying into a crevice."
        },
        {
          "id": "fauna-univ-cave-rat-02",
          "layer": 2,
          "dc": 12,
          "text": "This species has adapted to complete darkness, relying on keen hearing and whiskers to navigate. They tend to congregate in areas with stable temperature and humidity."
        },
        {
          "id": "fauna-univ-cave-rat-03",
          "layer": 3,
          "dc": 18,
          "text": "Cave rats are reliable indicators of environmental safety - they avoid areas with toxic gases or unstable ground. Their presence suggests this area is relatively safe. Jötun workers reportedly used them as 'canaries' to detect hazardous conditions."
        }
      ]
    },
    {
      "speciesName": "Rust Beetles",
      "scientificName": "Scarabaeus ferrum",
      "category": "Fauna",
      "biome": "The Roots",
      "descriptors": [
        {
          "id": "fauna-roots-rust-beetle-01",
          "layer": 1,
          "dc": 0,
          "text": "Small beetles with metallic-orange carapaces scuttle across corroded surfaces, their mandibles clicking as they work."
        },
        {
          "id": "fauna-roots-rust-beetle-02",
          "layer": 2,
          "dc": 12,
          "text": "The beetles appear to be consuming the rust itself, their digestive systems somehow processing iron oxide. They leave clean, if pitted, metal in their wake."
        },
        {
          "id": "fauna-roots-rust-beetle-03",
          "layer": 3,
          "dc": 18,
          "text": "Rust Beetles exist in a symbiotic relationship with Rust-Eater Moss - the moss accelerates corrosion while the beetles consume the result. Their carapaces contain concentrated iron compounds that Jötun smiths once harvested for specialized alloys."
        }
      ]
    },
    {
      "speciesName": "Blight-Moths",
      "scientificName": "Papilio macula",
      "category": "Fauna",
      "biome": "Alfheim",
      "descriptors": [
        {
          "id": "fauna-alf-blight-moth-01",
          "layer": 1,
          "dc": 0,
          "text": "Pale moths with wings that seem to absorb light rather than reflect it flutter silently through the corrupted air."
        },
        {
          "id": "fauna-alf-blight-moth-02",
          "layer": 2,
          "dc": 12,
          "text": "The moths are drawn to sources of runic energy, circling active inscriptions or magical items. Their wing scales leave a faintly luminescent dust."
        },
        {
          "id": "fauna-alf-blight-moth-03",
          "layer": 3,
          "dc": 18,
          "text": "Blight-Moths feed on magical radiation, their presence indicating high concentrations of runic energy. Swarms often gather near failing containment wards or reality fractures. Their wing dust has properties useful in detecting magical auras."
        }
      ]
    }
  ]
}
```

### 7.2 Configuration Schema

| Property | Type | Required | Description |
|----------|------|----------|-------------|
| `version` | string | Yes | Configuration version for compatibility |
| `species` | array | Yes | Array of species definitions |
| `species[].speciesName` | string | Yes | Common name for the species |
| `species[].scientificName` | string | No | Aethelgard Latin name (flavor) |
| `species[].category` | string | Yes | "Flora" or "Fauna" |
| `species[].biome` | string | Yes | Biome where species appears, or "Universal" |
| `species[].descriptors` | array | Yes | Array of layer descriptors |
| `descriptors[].id` | string | Yes | Unique descriptor ID |
| `descriptors[].layer` | int | Yes | Examination layer (1, 2, or 3) |
| `descriptors[].dc` | int | Yes | DC required (0, 12, or 18) |
| `descriptors[].text` | string | Yes | Description text for this layer |
| `descriptors[].alchemicalUse` | string | No | Alchemical applications (Layer 3 only) |
| `descriptors[].harvestDc` | int | No | DC for harvest attempt (Flora only) |
| `descriptors[].harvestRisk` | string | No | Risk on failed harvest (Flora only) |

---

## 8. Integration with Existing Systems

### 8.1 Integration with v0.15.6a (Passive Perception)

The Passive Perception system triggers ambient flora/fauna observations:

```csharp
// In PassivePerceptionService, on room entry:
public async Task OnRoomEntryAsync(Room room, Character character)
{
    // Existing passive perception checks...

    // Add flora/fauna ambient observation
    var floraFaunaObservation = _floraFaunaService.GetAmbientObservation(
        room.Id,
        room.Biome,
        character.Stats.Wits);

    if (floraFaunaObservation.HasObservations)
    {
        await _renderer.RenderAmbientObservationAsync(floraFaunaObservation);
    }
}
```

### 8.2 Integration with v0.15.6b (Three-Layer Examination)

Species examination uses the same three-layer DC thresholds:

| Layer | Name | DC | Successes | Flora Reveals | Fauna Reveals |
|-------|------|-----|-----------|---------------|---------------|
| 1 | Cursory | 0 | 0 | Basic appearance | Basic appearance |
| 2 | Detailed | 12 | 2 | Ecological behavior | Behavioral patterns |
| 3 | Expert | 18 | 4 | Alchemical use, harvest info | Environmental indicators |

### 8.3 Integration with v0.15.6c (Object Category Descriptors)

Flora and fauna follow the same biome affinity pattern:

```csharp
// Biome filtering follows the same pattern as ObjectDescriptor
public bool AppearsInBiome(string targetBiome)
{
    if (IsUniversal) return true;
    return Biome.Equals(targetBiome, StringComparison.OrdinalIgnoreCase);
}
```

### 8.4 Integration with Dice System (v0.15.0)

Species examination uses the established success-counting mechanics:

```csharp
// Success-counting dice mechanics (8-10 = success, 1 = botch)
var rollResult = _diceService.RollSuccessPool(witsPool);
var successes = rollResult.Successes;

// Map successes to layers
var highestLayer = successes switch
{
    >= 4 => 3, // Expert
    >= 2 => 2, // Detailed
    _ => 1     // Cursory
};
```

---

## 9. Acceptance Criteria

### 9.1 Flora Observation
- [ ] Flora species appear in room descriptions based on biome
- [ ] Higher Wits scores reveal more flora species in ambient text
- [ ] Each biome has at least one unique flora species
- [ ] Universal flora appears in all biomes

### 9.2 Fauna Observation
- [ ] Fauna species appear in room descriptions based on biome
- [ ] Cave Rat (Universal) appears in all biomes
- [ ] Fauna descriptions convey behavior and environmental meaning

### 9.3 Species Examination
- [ ] `examine <species>` works for discovered flora and fauna
- [ ] Layer 1 (Cursory) is always revealed regardless of roll
- [ ] Layer 2 (Detailed) requires 2+ successes
- [ ] Layer 3 (Expert) requires 4+ successes
- [ ] Expert examination reveals alchemical uses for flora
- [ ] Expert examination reveals scientific names

### 9.4 Harvest System
- [ ] `harvest` command lists discovered harvestable flora
- [ ] Harvest DC and risk are shown for each species
- [ ] Alchemical use is shown if discovered through examination
- [ ] Species must be discovered before appearing in harvest list

### 9.5 General
- [ ] All ~3 unit tests pass
- [ ] Build completes with 0 errors
- [ ] Build completes with 0 warnings
- [ ] Configuration loads correctly from flora-fauna-descriptors.json

---

## 10. Test Specifications

### 10.1 Unit Tests (~3 tests)

#### FloraFaunaServiceTests.cs

```csharp
[TestFixture]
public class FloraFaunaServiceTests
{
    private Mock<IFloraFaunaDescriptorRepository> _repositoryMock;
    private Mock<IDiceService> _diceServiceMock;
    private Mock<IPlayerDiscoveryTracker> _trackerMock;
    private Mock<ILogger<FloraFaunaService>> _loggerMock;
    private FloraFaunaService _service;

    [SetUp]
    public void Setup()
    {
        _repositoryMock = new Mock<IFloraFaunaDescriptorRepository>();
        _diceServiceMock = new Mock<IDiceService>();
        _trackerMock = new Mock<IPlayerDiscoveryTracker>();
        _loggerMock = new Mock<ILogger<FloraFaunaService>>();

        _service = new FloraFaunaService(
            _repositoryMock.Object,
            _diceServiceMock.Object,
            _trackerMock.Object,
            _loggerMock.Object);
    }

    /// <summary>
    /// Test: Biome-appropriate flora appears in room
    /// Verifies that GetAmbientObservation returns flora matching the room's biome.
    /// </summary>
    [Test]
    public void GetAmbientObservation_WithRootsBiome_ReturnsRootsFlora()
    {
        // Arrange
        var rootsFlora = new FloraFaunaDescriptor(
            "flora-roots-luminous-fungus-01",
            FloraFaunaCategory.Flora,
            "Luminous Shelf Fungus",
            "Fungus luminaris",
            1, 0, "The Roots",
            "A pale, bioluminescent fungus...",
            null, null, null);

        _repositoryMock.Setup(r => r.GetByCategory(FloraFaunaCategory.Flora))
            .Returns(new List<FloraFaunaDescriptor> { rootsFlora });
        _repositoryMock.Setup(r => r.GetByCategory(FloraFaunaCategory.Fauna))
            .Returns(new List<FloraFaunaDescriptor>());

        // Act
        var result = _service.GetAmbientObservation("room-01", "The Roots", 4);

        // Assert
        Assert.That(result.HasFlora, Is.True);
        Assert.That(result.FloraObserved, Contains.Item("Luminous Shelf Fungus"));
        _trackerMock.Verify(t => t.MarkSpeciesDiscovered("room-01", "flora-roots-luminous-fungus-01"), Times.Once);
    }

    /// <summary>
    /// Test: Expert observation reveals alchemical uses
    /// Verifies that Layer 3 examination (4+ successes) reveals alchemical data.
    /// </summary>
    [Test]
    public void ExamineSpecies_WithExpertSuccess_RevealsAlchemicalUse()
    {
        // Arrange
        var layer1 = new FloraFaunaDescriptor(
            "flora-roots-luminous-fungus-01",
            FloraFaunaCategory.Flora,
            "Luminous Shelf Fungus", "Fungus luminaris",
            1, 0, "The Roots",
            "Layer 1 text", null, null, null);
        var layer3 = new FloraFaunaDescriptor(
            "flora-roots-luminous-fungus-03",
            FloraFaunaCategory.Flora,
            "Luminous Shelf Fungus", "Fungus luminaris",
            3, 18, "The Roots",
            "Layer 3 text",
            "Light-producing elixirs, visibility potions",
            8, null);

        _repositoryMock.Setup(r => r.GetById("flora-roots-luminous-fungus-01"))
            .Returns(layer1);
        _repositoryMock.Setup(r => r.GetBySpeciesName("Luminous Shelf Fungus"))
            .Returns(new List<FloraFaunaDescriptor> { layer1, layer3 });

        _diceServiceMock.Setup(d => d.RollSuccessPool(It.IsAny<int>()))
            .Returns(new SuccessPoolResult(5, 0)); // 5 successes = Expert

        // Act
        var result = _service.ExamineSpecies("flora-roots-luminous-fungus-01", 6);

        // Assert
        Assert.That(result.ReachedExpertLevel, Is.True);
        Assert.That(result.DiscoveredAlchemicalUse, Is.True);
        Assert.That(result.AlchemicalUseRevealed, Is.EqualTo("Light-producing elixirs, visibility potions"));
    }

    /// <summary>
    /// Test: Harvestable flora lists correctly
    /// Verifies that GetHarvestableFlora returns only discovered, harvestable species.
    /// </summary>
    [Test]
    public void GetHarvestableFlora_WithDiscoveredHarvestableSpecies_ReturnsCorrectList()
    {
        // Arrange
        var harvestable = new FloraFaunaDescriptor(
            "flora-roots-luminous-fungus-03",
            FloraFaunaCategory.Flora,
            "Luminous Shelf Fungus", null,
            3, 18, "The Roots",
            "Expert text",
            "Light elixirs",
            8, null);

        var fauna = new FloraFaunaDescriptor(
            "fauna-univ-cave-rat-01",
            FloraFaunaCategory.Fauna,
            "Cave Rat", null,
            1, 0, "Universal",
            "A rat", null, null, null);

        _trackerMock.Setup(t => t.GetDiscoveredSpecies("room-01"))
            .Returns(new List<string> { "flora-roots-luminous-fungus-03", "fauna-univ-cave-rat-01" });

        _repositoryMock.Setup(r => r.GetById("flora-roots-luminous-fungus-03"))
            .Returns(harvestable);
        _repositoryMock.Setup(r => r.GetById("fauna-univ-cave-rat-01"))
            .Returns(fauna);

        // Act
        var result = _service.GetHarvestableFlora("room-01");

        // Assert
        Assert.That(result.Count, Is.EqualTo(1));
        Assert.That(result[0].SpeciesName, Is.EqualTo("Luminous Shelf Fungus"));
        Assert.That(result[0].HarvestDc, Is.EqualTo(8));
    }
}
```

---

## 11. Dependencies

### 11.1 Required from v0.15.6c

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `ObjectCategory.Creature` | Domain/Enums/ObjectCategory.cs | Base category for fauna observation |
| `ObjectDescriptor` pattern | Domain/Entities/ | Model for FloraFaunaDescriptor design |
| `IObjectDescriptorService` | Application/Interfaces/ | Model for IFloraFaunaService |
| Configuration loading pattern | Infrastructure/Repositories/ | Model for flora-fauna-descriptors.json |
| Biome affinity filtering | Various services | Pattern for AppearsInBiome method |

### 11.2 Required from v0.15.6b

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `ExaminationResult` | Domain/ValueObjects/ | Model for SpeciesExaminationResult |
| Three-layer DC system | Services/ | DC thresholds (0, 12, 18) |
| Layer reveal pattern | Services/ | Progressive information revelation |

### 11.3 Required from v0.15.6a

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `IPassivePerceptionService` | Application/Interfaces/ | Integration point for ambient observation |
| Wits-based observation | Services/ | Determines species count revealed |

### 11.4 Required from v0.15.0

| Type | Location | Usage in this phase |
|------|----------|---------------------|
| `IDiceService` | Application/Interfaces/ | Success-counting dice rolls |
| `SuccessPoolResult` | Domain/ValueObjects/ | Dice roll results |

### 11.5 Provides to v0.15.6e

| Type | Usage |
|------|-------|
| `FloraFaunaDescriptor` | Base for puzzle hint integration with species |
| `IFloraFaunaService` | Service integration for puzzle reveals |
| Species examination pattern | Model for puzzle-linked examination |

---

## 12. Implementation Notes

### 12.1 File Structure

```
src/
├── Domain/
│   ├── Enums/
│   │   └── FloraFaunaCategory.cs          # Flora/Fauna enum
│   └── ValueObjects/
│       ├── FloraFaunaDescriptor.cs        # Species descriptor
│       ├── HarvestableFlora.cs            # Harvest info
│       ├── AmbientObservation.cs          # Ambient observation result
│       └── SpeciesExaminationResult.cs    # Examination result
├── Application/
│   ├── Interfaces/
│   │   ├── IFloraFaunaService.cs          # Service interface
│   │   ├── IFloraFaunaDescriptorRepository.cs  # Repository interface
│   │   └── IPlayerDiscoveryTracker.cs     # Discovery tracking
│   └── Services/
│       └── FloraFaunaService.cs           # Service implementation
├── Infrastructure/
│   ├── Configuration/
│   │   └── flora-fauna-descriptors.json   # Species data
│   └── Repositories/
│       └── FloraFaunaDescriptorRepository.cs  # JSON loading
└── Presentation/
    └── Rendering/
        └── FloraFaunaRenderer.cs          # Display methods

tests/
└── Unit/
    └── Application/
        └── FloraFaunaServiceTests.cs      # ~3 unit tests
```

### 12.2 Implementation Order

1. **Domain Layer**
   - FloraFaunaCategory enum
   - FloraFaunaDescriptor value object
   - HarvestableFlora value object
   - AmbientObservation value object
   - SpeciesExaminationResult value object

2. **Application Layer**
   - IFloraFaunaService interface
   - IFloraFaunaDescriptorRepository interface
   - IPlayerDiscoveryTracker interface
   - FloraFaunaService implementation

3. **Infrastructure Layer**
   - flora-fauna-descriptors.json configuration
   - FloraFaunaDescriptorRepository implementation
   - PlayerDiscoveryTracker implementation

4. **Presentation Layer**
   - IGameRenderer additions
   - Rendering implementations
   - Command parsing updates

5. **Testing**
   - FloraFaunaServiceTests (~3 tests)

---

## 13. Design Decisions

### 13.1 Separate from ObjectDescriptor

**Decision:** Create a separate FloraFaunaDescriptor rather than extending ObjectDescriptor.

**Rationale:**
- Flora and fauna have specialized properties (alchemical use, harvest mechanics, behavior)
- Species appear based on biome, not room-specific object placement
- Different lifecycle management (discovery tracking vs. object state)
- Cleaner separation of concerns for future expansion (crafting, alchemy systems)

### 13.2 Discovery Tracking

**Decision:** Require species discovery before harvest listing.

**Rationale:**
- Rewards observant players who examine their environment
- Creates meaningful progression in room exploration
- Prevents "blind harvesting" without engagement
- Sets up future systems (knowledge journals, bestiaries)

### 13.3 Harvest as Information Only

**Decision:** Implement harvest information display without actual harvesting mechanics.

**Rationale:**
- Keeps v0.15.6d focused on perception and observation
- Harvesting requires inventory, crafting, and resource systems
- Provides foundation for future harvest implementation
- Players can see opportunities even if they can't act on them yet

### 13.4 Fauna Behavior Indicators

**Decision:** Expert fauna examination reveals environmental safety indicators.

**Rationale:**
- Adds gameplay value beyond flavor text
- Cave Rats as "canaries" creates emergent gameplay
- Blight-Moths indicating magical radiation adds tactical information
- Rewards investment in Wits beyond just loot discovery

---

## 14. Future Considerations

### 14.1 Planned Enhancements (v0.15.6e+)

- **Puzzle Hints:** Flora and fauna can be linked to puzzle revelations
- **Search Enhancement:** Hidden flora discoverable through active searching
- **Reputation Effects:** Some creatures react to player reputation

### 14.2 Post-v0.15.6 Potential Features

- **Harvest Mechanics:** Actual resource collection with skill checks
- **Alchemy Integration:** Using harvested materials in crafting
- **Creature Reactions:** Fauna that flees, warns, or assists
- **Seasonal/Time Variation:** Different species at different times
- **Cultivation:** Growing plants in controlled areas
- **Symbiosis Chains:** Interconnected ecosystems affecting each other

---

## Appendix A: Flora & Fauna Examples

### A.1 Complete Species Reference

| Species | Category | Biome | Harvest DC | Risk | Alchemical Use |
|---------|----------|-------|------------|------|----------------|
| Luminous Shelf Fungus | Flora | The Roots | 8 | None | Light elixirs, visibility potions |
| Rust-Eater Moss | Flora | The Roots | 12 | Acidic residue (1d4) | Acid compounds, metal dissolvers |
| Ember Moss | Flora | Muspelheim | 14 | Heat damage (1d6 fire) | Heat-resistant treatments, warming elixirs |
| Frost Lichen | Flora | Niflheim | 10 | Frostbite (1d4 cold) | Cold-resistance elixirs, preservation |
| Paradox Spore Clusters | Flora | Alfheim | 18 | Reality distortion (Confusion) | Dimensional alchemy, perception alteration |
| Cave Rat | Fauna | Universal | - | - | Safety indicator |
| Rust Beetles | Fauna | The Roots | - | - | Iron compound harvesting |
| Blight-Moths | Fauna | Alfheim | - | - | Magical aura detection |

### A.2 Ecological Relationships

```
THE ROOTS ECOSYSTEM
├── Rust-Eater Moss (accelerates corrosion)
│   └── Rust Beetles (consume oxidized metal)
│       └── Symbiotic relationship
├── Luminous Shelf Fungus (bioluminescence)
│   └── Cave Rats (navigate by fungal light)
└── Iron-rich environment supports both systems

ALFHEIM ECOSYSTEM
├── Paradox Spore Clusters (feed on reality boundaries)
│   └── Reality fractures enable growth
├── Blight-Moths (consume runic radiation)
│   └── Gather near wards and magical items
└── Both indicate dangerous magical concentrations
```

---

## Appendix B: Biome Ecosystem Reference

### B.1 The Roots

**Environment:** Deep underground, former Jötun infrastructure, corroded metal, dampness
**Flora:** Luminous Shelf Fungus, Rust-Eater Moss
**Fauna:** Cave Rats (universal), Rust Beetles
**Ecological Theme:** Metal consumption and bioluminescence in darkness

### B.2 Muspelheim

**Environment:** Volcanic, extreme heat, thermal vents, lava flows
**Flora:** Ember Moss
**Fauna:** (Future: Heat-adapted creatures)
**Ecological Theme:** Thermophilic adaptation, fire energy consumption

### B.3 Niflheim

**Environment:** Frozen, ice-covered, bitter cold, frost formations
**Flora:** Frost Lichen
**Fauna:** (Future: Cold-adapted creatures)
**Ecological Theme:** Cryogenic survival, antifreeze biology

### B.4 Alfheim

**Environment:** Reality-warped, magical corruption, dimensional instability
**Flora:** Paradox Spore Clusters
**Fauna:** Blight-Moths
**Ecological Theme:** Reality-feeding organisms, magical radiation ecology

---

*This design specification provides the detailed blueprint for implementing v0.15.6d Flora & Fauna Observation. See the scope breakdown for integration context with other v0.15.6 sub-phases.*
