# v0.13.3c Design Specification: Recipe Browser & Details

**Version:** 0.13.3c
**Parent:** v0.13.3 (Crafting UI)
**Prerequisites:** v0.13.3b Complete (Crafting Station Interface), v0.11.x Complete (Crafting & Resources Services)
**Status:** Design Complete
**Estimated Unit Tests:** ~6

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Feature Overview](#2-feature-overview)
3. [Architecture Diagrams](#3-architecture-diagrams)
4. [Recipe Browser Component](#4-recipe-browser-component)
   - 4.1 [RecipeBrowser Class](#41-recipebrowser-class)
   - 4.2 [Search Functionality](#42-search-functionality)
   - 4.3 [Category Filtering](#43-category-filtering)
5. [Recipe Details Component](#5-recipe-details-component)
   - 5.1 [RecipeDetails Class](#51-recipedetails-class)
   - 5.2 [Material Requirements Display](#52-material-requirements-display)
   - 5.3 [Quality Result Display](#53-quality-result-display)
6. [Recipe Book Component](#6-recipe-book-component)
   - 6.1 [RecipeBook Class](#61-recipebook-class)
   - 6.2 [Discovery Progress](#62-discovery-progress)
   - 6.3 [Station Filtering](#63-station-filtering)
7. [Notification Components](#7-notification-components)
   - 7.1 [RecipeDiscoveryNotification Class](#71-recipediscoverynotification-class)
   - 7.2 [CraftingResultNotification Class](#72-craftingresultnotification-class)
8. [Recipes Command](#8-recipes-command)
9. [Data Model Changes](#9-data-model-changes)
10. [Configuration File Schemas](#10-configuration-file-schemas)
11. [Inventory Integration](#11-inventory-integration)
12. [Logging Specifications](#12-logging-specifications)
13. [Unit Testing Requirements](#13-unit-testing-requirements)
14. [Use Cases](#14-use-cases)
15. [Deliverable Checklist](#15-deliverable-checklist)
16. [Acceptance Criteria](#16-acceptance-criteria)
17. [Dependencies](#17-dependencies)
18. [Future Considerations](#18-future-considerations)

---

## 1. Executive Summary

This version implements the recipe browser with search and filter capabilities, recipe details view showing materials and output, recipe book for collected recipes, and recipe discovery notifications. Players can browse all discovered recipes with search and category filtering, view detailed material requirements with owned quantities, see crafting quality results, track recipe discovery progress, and receive notifications when new recipes are discovered.

### Key Deliverables

| Category | Items |
|----------|-------|
| **UI Components** | `RecipeBrowser`, `RecipeDetails`, `RecipeBook` |
| **Notifications** | `RecipeDiscoveryNotification`, `CraftingResultNotification` |
| **Commands** | `RecipesCommand` |
| **DTOs** | `RecipeBrowserDisplayDto`, `RecipeDetailsDisplayDto`, `RecipeBookEntryDto`, `QualityResultDto` |
| **View Updates** | Inventory integration |
| **Configuration** | `recipe-browser.json` |
| **Tests** | ~6 unit tests |

### Architectural Significance

This version establishes the **Recipe Discovery Pattern** for crafting-related UI:
- Recipe browser provides search and category filtering across all recipes
- Recipe details show full material requirements with owned vs needed comparison
- Quality display uses star rating format (★★★) for crafted item quality tiers
- Recipe book tracks discovered recipes with unlock progress visualization
- Discovery notifications use 5-second auto-dismiss popups
- The pattern integrates with CraftingStationMenu from v0.13.3b for consistent recipe selection

---

## 2. Feature Overview

```
v0.13.3c Features
├── RecipeBrowser (UI Component)
│   ├── RenderRecipes(IEnumerable<RecipeDefinition>)
│   ├── Search(string)
│   ├── FilterByCategory(RecipeCategory)
│   └── SelectRecipe(RecipeDefinition)
│
├── RecipeDetails (UI Component)
│   ├── RenderRecipe(RecipeDefinition)
│   ├── ShowMaterials(IEnumerable<RecipeMaterial>)
│   ├── ShowExpectedOutput(ItemDefinition, QualityRange)
│   └── ShowQualityResult(ItemQuality)
│
├── RecipeBook (UI Component)
│   ├── RenderDiscoveredRecipes(IEnumerable<RecipeDefinition>)
│   ├── ShowUnlockProgress(int, int)
│   ├── HighlightNew(RecipeDefinition)
│   └── FilterByStation(CraftingStation)
│
├── RecipeDiscoveryNotification (Notification)
│   ├── ShowDiscovery(RecipeDefinition)
│   └── GetDuration() -> 5 seconds
│
├── CraftingResultNotification (Notification)
│   ├── ShowResult(CraftedItem)
│   ├── ShowQualityTier(ItemQuality)
│   └── GetDuration() -> 5 seconds
│
├── Recipe Categories
│   ├── Weapons: Swords, daggers, axes
│   ├── Armor: Shields, helmets, body armor
│   ├── Potions: Health, mana, buff potions
│   ├── Jewelry: Rings, amulets
│   └── Tools: Crafting tools, utility items
│
├── Quality Tiers
│   ├── Common: ★
│   ├── Uncommon: ★★
│   ├── Rare: ★★★
│   ├── Epic: ★★★★
│   └── Legendary: ★★★★★
│
└── RecipesCommand
    ├── List all discovered recipes
    ├── Show discovery progress
    └── Filter by category/station
```

### Scope Verification

| Feature | Source | Included |
|---------|--------|----------|
| Recipe browser with search functionality | v0.13.3-scope-breakdown.md | Yes |
| Recipe filter by category | v0.13.3-scope-breakdown.md | Yes |
| Recipe details view (materials, expected output) | v0.13.3-scope-breakdown.md | Yes |
| Quality result display after crafting | v0.13.3-scope-breakdown.md | Yes |
| Recipe book panel for collected recipes | v0.13.3-scope-breakdown.md | Yes |
| New recipe notification on discovery | v0.13.3-scope-breakdown.md | Yes |
| Recipe unlock progress (discovered/total) | v0.13.3-scope-breakdown.md | Yes |
| Resource inventory panel | v0.13.3-scope-breakdown.md | No (v0.13.3a) |
| Crafting station menu | v0.13.3-scope-breakdown.md | No (v0.13.3b) |
| Gathering display | v0.13.3-scope-breakdown.md | No (v0.13.3d) |

---

## 3. Architecture Diagrams

### 3.1 Layer Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          PRESENTATION LAYER                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │    InventoryView        │      │     RecipeBrowser       │               │
│  │    (existing)           │◄────▶│     (NEW)               │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderInventory()     │      │ - RenderRecipes()       │               │
│  │ - HandleRecipesTab()    │      │ - Search()              │               │
│  │ - IntegrateComponents() │      │ - FilterByCategory()    │               │
│  └─────────────────────────┘      │ - SelectRecipe()        │               │
│                                    └───────────┬─────────────┘               │
│                                                │                             │
│  ┌─────────────────────────┐      ┌────────────┴────────────┐               │
│  │     RecipeDetails       │      │       RecipeBook        │               │
│  │     (NEW)               │      │       (NEW)             │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - RenderRecipe()        │      │ - RenderDiscovered()    │               │
│  │ - ShowMaterials()       │      │ - ShowUnlockProgress()  │               │
│  │ - ShowExpectedOutput()  │      │ - HighlightNew()        │               │
│  │ - ShowQualityResult()   │      │ - FilterByStation()     │               │
│  └─────────────────────────┘      └─────────────────────────┘               │
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │ RecipeDiscovery         │      │ CraftingResult          │               │
│  │ Notification (NEW)      │      │ Notification (NEW)      │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ - ShowDiscovery()       │      │ - ShowResult()          │               │
│  │ - GetDuration()         │      │ - ShowQualityTier()     │               │
│  └─────────────────────────┘      │ - GetDuration()         │               │
│                                    └─────────────────────────┘               │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                     QualityTierRenderer (NEW)                            │ │
│  ├─────────────────────────────────────────────────────────────────────────┤ │
│  │ - FormatQuality()       - GetQualityStars()                             │ │
│  │ - GetQualityColor()     - GetQualityName()                              │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          APPLICATION LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    ICraftingService (existing v0.11.x)              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetAllRecipes() : IReadOnlyList<RecipeDefinition>                 │    │
│  │ + GetRecipe(recipeId) : RecipeDefinition?                           │    │
│  │ + GetRecipesByCategory(category) : IReadOnlyList<RecipeDefinition>  │    │
│  │ + GetRecipesForStation(stationId) : IReadOnlyList<RecipeDefinition> │    │
│  │ + GetDiscoveredRecipes(player) : IReadOnlyList<RecipeDefinition>    │    │
│  │ + GetTotalRecipeCount() : int                                       │    │
│  │ + IsRecipeDiscovered(player, recipeId) : bool                       │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IResourceService (existing v0.11.x)              │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetPlayerResources(player) : IReadOnlyList<ResourcePoolDto>       │    │
│  │ + GetResourceQuantity(player, resourceId) : int                     │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │                    IItemService (existing)                          │    │
│  ├─────────────────────────────────────────────────────────────────────┤    │
│  │ + GetItem(itemId) : ItemDefinition?                                 │    │
│  │ + GetItemDisplayInfo(itemId) : ItemDisplayDto?                      │    │
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DOMAIN LAYER                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────┐      ┌─────────────────────────┐               │
│  │    RecipeDefinition     │      │     RecipeCategory      │               │
│  │   (existing v0.11.x)    │      │     (NEW enum)          │               │
│  ├─────────────────────────┤      ├─────────────────────────┤               │
│  │ + Id: string            │      │ + Weapons               │               │
│  │ + Name: string          │      │ + Armor                 │               │
│  │ + Description: string   │      │ + Potions               │               │
│  │ + StationTypeRequired   │      │ + Jewelry               │               │
│  │ + Materials: list       │      │ + Tools                 │               │
│  │ + OutputItemId: string  │      └─────────────────────────┘               │
│  │ + OutputQuantity: int   │                                                 │
│  │ + CraftingTime: float   │      ┌─────────────────────────┐               │
│  │ + RequiredSkillLevel    │      │      ItemQuality        │               │
│  │ + Category: string      │      │     (NEW enum)          │               │
│  └─────────────────────────┘      ├─────────────────────────┤               │
│                                    │ + Common                │               │
│  ┌─────────────────────────┐      │ + Uncommon              │               │
│  │     RecipeMaterial      │      │ + Rare                  │               │
│  │   (existing v0.11.x)    │      │ + Epic                  │               │
│  ├─────────────────────────┤      │ + Legendary             │               │
│  │ + MaterialId: string    │      └─────────────────────────┘               │
│  │ + Quantity: int         │                                                 │
│  │ + IsOptional: bool      │                                                 │
│  └─────────────────────────┘                                                 │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 Recipe Browser Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    RECIPE BROWSER FLOW                                       │
└─────────────────────────────────────────────────────────────────────────────┘

    Player Opens Recipe Browser
           │
           ▼
┌─────────────────────────┐
│     InventoryView       │
│  HandleRecipesTab()     │
└───────────┬─────────────┘
            │
            │ 1. Get discovered recipes
            ▼
┌─────────────────────────┐
│   ICraftingService      │
│  GetDiscoveredRecipes() │
└───────────┬─────────────┘
            │
            │ 2. Returns List<RecipeDefinition>
            ▼
┌─────────────────────────────────────────────────────────────┐
│    RecipeBrowser                                             │
│                                                              │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ ApplySearch()     │  │ ApplyFilter()     │               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
│            │                      │                          │
│            │ 3. Filter by search text and category          │
│            ▼                      ▼                          │
│  ┌───────────────────┐  ┌───────────────────┐               │
│  │ RenderRecipes()   │  │ RenderFilterTabs()│               │
│  └─────────┬─────────┘  └─────────┬─────────┘               │
│            │                      │                          │
│            │ 4. Display filtered recipe list                │
└────────────┼──────────────────────┼─────────────────────────┘
             │                      │
             │ 5. User selects recipe
             ▼                      ▼
┌─────────────────────────────────────────────────────────────┐
│ RecipeDetails                                                │
│                                                              │
│ - RenderRecipe(recipe)          │ 6. Show full recipe info  │
│ - ShowMaterials(materials)      │ 7. Show material list     │
│ - ShowExpectedOutput(output)    │ 8. Show crafted item info │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 9. Display to terminal
            ▼
┌─────────────────────────┐
│   ITerminalService      │
│   WriteAt(x, y, text)   │
│   WriteColoredAt(...)   │
└─────────────────────────┘
```

### 3.3 Recipe Discovery Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    RECIPE DISCOVERY FLOW                                     │
└─────────────────────────────────────────────────────────────────────────────┘

    Player Discovers New Recipe (via crafting, quest, or learning)
           │
           ▼
┌─────────────────────────┐
│   ICraftingService      │
│   OnRecipeDiscovered    │
│   (event/callback)      │
└───────────┬─────────────┘
            │
            │ 1. Recipe discovered event fires
            ▼
┌─────────────────────────────────────────────────────────────┐
│  RecipeDiscoveryNotification                                 │
│                                                              │
│  ShowDiscovery(recipe)                                      │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ +=====================================================+ ││
│  │ |  [!]  NEW RECIPE DISCOVERED!                        | ││
│  │ +=====================================================+ ││
│  │ |                                                     | ││
│  │ |  STEEL BLADE                                        | ││
│  │ |  Forge at: Blacksmith                               | ││
│  │ |                                                     | ││
│  │ +=====================================================+ ││
│  └─────────────────────────────────────────────────────────┘│
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 2. Auto-dismiss after 5 seconds
            ▼
┌─────────────────────────┐
│   Timer (5 seconds)     │
│   Hide notification     │
└───────────┬─────────────┘
            │
            │ 3. Update recipe book
            ▼
┌─────────────────────────────────────────────────────────────┐
│  RecipeBook                                                  │
│                                                              │
│  HighlightNew(recipe)                                       │
│                                                              │
│  - Add to discovered list                                   │
│  - Update unlock progress                                   │
│  - Mark as "NEW" temporarily                                │
└─────────────────────────────────────────────────────────────┘
```

### 3.4 Crafting Result Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    CRAFTING RESULT FLOW                                      │
└─────────────────────────────────────────────────────────────────────────────┘

    Crafting Completes Successfully
           │
           ▼
┌─────────────────────────┐
│   ICraftingService      │
│   CraftItem() returns   │
│   CraftingResult        │
└───────────┬─────────────┘
            │
            │ 1. Determine quality tier based on skill/roll
            ▼
┌─────────────────────────────────────────────────────────────┐
│  CraftingResultNotification                                  │
│                                                              │
│  ShowResult(craftedItem)                                    │
│  ShowQualityTier(quality)                                   │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ +=====================================================+ ││
│  │ |  CRAFTING COMPLETE!                                 | ││
│  │ +=====================================================+ ││
│  │ |                                                     | ││
│  │ |  Steel Blade                                        | ││
│  │ |  Quality: RARE (★★★)                               | ││
│  │ |                                                     | ││
│  │ +=====================================================+ ││
│  └─────────────────────────────────────────────────────────┘│
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 2. Quality tier determines star display
            ▼
┌─────────────────────────────────────────────────────────────┐
│  QualityTierRenderer                                         │
│                                                              │
│  GetQualityStars(ItemQuality.Rare) → "★★★"                 │
│  GetQualityName(ItemQuality.Rare) → "RARE"                  │
│  GetQualityColor(ItemQuality.Rare) → ConsoleColor.Blue      │
└───────────┬─────────────────────────────────────────────────┘
            │
            │ 3. Auto-dismiss after 5 seconds
            ▼
┌─────────────────────────┐
│   Timer (5 seconds)     │
│   Hide notification     │
└─────────────────────────┘
```

---

## 4. Recipe Browser Component

### 4.1 RecipeBrowser Class

**Purpose:** Displays all discovered recipes with search and category filtering capabilities.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/RecipeBrowser.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays all discovered recipes with search and category filtering.
/// </summary>
/// <remarks>
/// Provides recipe browsing functionality including text search by name,
/// category filtering, and recipe selection for detailed view.
/// </remarks>
public class RecipeBrowser
{
    private readonly ICraftingService _craftingService;
    private readonly ITerminalService _terminalService;
    private readonly RecipeBrowserConfig _config;
    private readonly ILogger<RecipeBrowser> _logger;

    private string _searchText = string.Empty;
    private RecipeCategory? _activeCategory;
    private IReadOnlyList<RecipeBrowserDisplayDto> _recipes = Array.Empty<RecipeBrowserDisplayDto>();
    private IReadOnlyList<RecipeBrowserDisplayDto> _filteredRecipes = Array.Empty<RecipeBrowserDisplayDto>();
    private int _selectedIndex;
    private (int X, int Y) _browserPosition;

    /// <summary>
    /// Gets whether the browser is currently visible.
    /// </summary>
    public bool IsVisible { get; private set; }

    /// <summary>
    /// Gets the currently selected recipe index.
    /// </summary>
    public int SelectedIndex => _selectedIndex;

    /// <summary>
    /// Gets the current search text.
    /// </summary>
    public string SearchText => _searchText;

    /// <summary>
    /// Gets the active category filter.
    /// </summary>
    public RecipeCategory? ActiveCategory => _activeCategory;

    /// <summary>
    /// Event raised when a recipe is selected for detailed view.
    /// </summary>
    public event EventHandler<RecipeBrowserDisplayDto>? RecipeSelected;

    /// <summary>
    /// Creates a new instance of the RecipeBrowser component.
    /// </summary>
    /// <param name="craftingService">The crafting service.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for browser display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public RecipeBrowser(
        ICraftingService craftingService,
        ITerminalService terminalService,
        RecipeBrowserConfig config,
        ILogger<RecipeBrowser> logger)
    {
        _craftingService = craftingService ?? throw new ArgumentNullException(nameof(craftingService));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the browser position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _browserPosition = (x, y);
    }

    /// <summary>
    /// Renders the recipe browser with all discovered recipes.
    /// </summary>
    /// <param name="recipes">The recipes to display.</param>
    public void RenderRecipes(IEnumerable<RecipeBrowserDisplayDto> recipes)
    {
        _recipes = recipes.ToList();
        ApplyFilters();
        IsVisible = true;

        // Clear browser area
        ClearBrowser();

        // Render browser header
        RenderHeader();

        // Render search box
        RenderSearchBox();

        // Render category filter tabs
        RenderCategoryTabs();

        // Render recipe list by category
        RenderRecipeList();

        // Render controls hint
        RenderControls();

        _logger.LogDebug(
            "Rendered recipe browser with {Total} recipes, {Filtered} after filtering",
            _recipes.Count,
            _filteredRecipes.Count);
    }

    /// <summary>
    /// Searches recipes by name.
    /// </summary>
    /// <param name="searchText">The text to search for.</param>
    /// <returns>Matching recipes.</returns>
    public IEnumerable<RecipeBrowserDisplayDto> Search(string searchText)
    {
        _searchText = searchText ?? string.Empty;
        ApplyFilters();
        RenderRecipes(_recipes);

        _logger.LogDebug("Search applied: '{SearchText}', {Count} results",
            _searchText, _filteredRecipes.Count);

        return _filteredRecipes;
    }

    /// <summary>
    /// Filters recipes by category.
    /// </summary>
    /// <param name="category">The category to filter by, or null for all.</param>
    public void FilterByCategory(RecipeCategory? category)
    {
        _activeCategory = category;
        ApplyFilters();
        RenderRecipes(_recipes);

        _logger.LogDebug("Category filter applied: {Category}",
            category?.ToString() ?? "All");
    }

    /// <summary>
    /// Selects a recipe by index.
    /// </summary>
    /// <param name="index">The recipe index to select.</param>
    public void SelectRecipe(int index)
    {
        if (index < 0 || index >= _filteredRecipes.Count)
        {
            return;
        }

        _selectedIndex = index;
        var recipe = _filteredRecipes[index];
        RecipeSelected?.Invoke(this, recipe);

        _logger.LogDebug("Selected recipe: {RecipeName}", recipe.Name);
    }

    /// <summary>
    /// Selects the previous recipe in the list.
    /// </summary>
    public void SelectPrevious()
    {
        if (_filteredRecipes.Count == 0) return;

        _selectedIndex = (_selectedIndex - 1 + _filteredRecipes.Count) % _filteredRecipes.Count;
        RefreshSelection();
    }

    /// <summary>
    /// Selects the next recipe in the list.
    /// </summary>
    public void SelectNext()
    {
        if (_filteredRecipes.Count == 0) return;

        _selectedIndex = (_selectedIndex + 1) % _filteredRecipes.Count;
        RefreshSelection();
    }

    /// <summary>
    /// Gets the currently selected recipe.
    /// </summary>
    /// <returns>The selected recipe, or null if none.</returns>
    public RecipeBrowserDisplayDto? GetSelectedRecipe()
    {
        if (_filteredRecipes.Count == 0 || _selectedIndex < 0 || _selectedIndex >= _filteredRecipes.Count)
        {
            return null;
        }

        return _filteredRecipes[_selectedIndex];
    }

    /// <summary>
    /// Appends a character to the search text.
    /// </summary>
    /// <param name="c">The character to append.</param>
    public void AppendSearchChar(char c)
    {
        _searchText += c;
        ApplyFilters();
        RenderRecipes(_recipes);
    }

    /// <summary>
    /// Removes the last character from the search text.
    /// </summary>
    public void BackspaceSearch()
    {
        if (_searchText.Length > 0)
        {
            _searchText = _searchText.Substring(0, _searchText.Length - 1);
            ApplyFilters();
            RenderRecipes(_recipes);
        }
    }

    /// <summary>
    /// Clears the search text.
    /// </summary>
    public void ClearSearch()
    {
        _searchText = string.Empty;
        ApplyFilters();
        RenderRecipes(_recipes);
    }

    /// <summary>
    /// Hides the recipe browser.
    /// </summary>
    public void Hide()
    {
        if (!IsVisible) return;

        ClearBrowser();
        IsVisible = false;
        _recipes = Array.Empty<RecipeBrowserDisplayDto>();
        _filteredRecipes = Array.Empty<RecipeBrowserDisplayDto>();
        _selectedIndex = 0;

        _logger.LogDebug("Recipe browser hidden");
    }

    /// <summary>
    /// Handles keyboard input for the browser.
    /// </summary>
    /// <param name="key">The pressed key.</param>
    /// <returns>True if the input was handled.</returns>
    public bool HandleInput(ConsoleKey key)
    {
        return key switch
        {
            ConsoleKey.UpArrow or ConsoleKey.W => HandleNavigateUp(),
            ConsoleKey.DownArrow or ConsoleKey.S => HandleNavigateDown(),
            ConsoleKey.Enter => HandleSelect(),
            ConsoleKey.Tab => HandleCycleCategory(),
            ConsoleKey.Backspace => HandleBackspace(),
            ConsoleKey.Escape => HandleClose(),
            _ => false
        };
    }

    #region Private Methods

    private void ClearBrowser()
    {
        var blankLine = new string(' ', _config.BrowserWidth);
        for (var y = 0; y < _config.BrowserHeight; y++)
        {
            _terminalService.WriteAt(_browserPosition.X, _browserPosition.Y + y, blankLine);
        }
    }

    private void RenderHeader()
    {
        var headerY = _browserPosition.Y;
        var width = _config.BrowserWidth;

        // Top border
        var topBorder = $"┌{new string('─', width - 2)}┐";
        _terminalService.WriteAt(_browserPosition.X, headerY, topBorder);

        // Title
        var title = "RECIPE BROWSER";
        var titlePadding = (width - 2 - title.Length) / 2;
        var titleLine = $"│{new string(' ', titlePadding)}{title}{new string(' ', width - 2 - titlePadding - title.Length)}│";
        _terminalService.WriteAt(_browserPosition.X, headerY + 1, titleLine);

        // Separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_browserPosition.X, headerY + 2, separator);
    }

    private void RenderSearchBox()
    {
        var searchY = _browserPosition.Y + 3;

        // Search label and input box
        var searchDisplay = _searchText.Length > 0
            ? _searchText.PadRight(_config.SearchBoxWidth)
            : new string('_', _config.SearchBoxWidth);

        var searchLine = $"│  Search: [{searchDisplay}]";
        var padding = _config.BrowserWidth - searchLine.Length - 1;
        searchLine += new string(' ', padding) + "│";

        _terminalService.WriteAt(_browserPosition.X, searchY, searchLine);
    }

    private void RenderCategoryTabs()
    {
        var tabY = _browserPosition.Y + 3;
        var tabX = _browserPosition.X + 28; // After search box

        var categories = new[]
        {
            ("All", (RecipeCategory?)null),
            ("Weapons", (RecipeCategory?)RecipeCategory.Weapons),
            ("Armor", (RecipeCategory?)RecipeCategory.Armor),
            ("Potions", (RecipeCategory?)RecipeCategory.Potions)
        };

        var tabLine = new System.Text.StringBuilder();
        tabLine.Append("Filter: ");

        foreach (var (name, category) in categories)
        {
            var isActive = _activeCategory == category;
            var bracket = isActive ? $"[{name}]" : $" {name} ";
            tabLine.Append(bracket);
            tabLine.Append(' ');
        }

        _terminalService.WriteAt(tabX, tabY, tabLine.ToString());

        // Highlight active tab
        var highlightX = tabX + 8; // After "Filter: "
        foreach (var (name, category) in categories)
        {
            var isActive = _activeCategory == category;
            if (isActive)
            {
                _terminalService.WriteColoredAt(
                    highlightX,
                    tabY,
                    $"[{name}]",
                    _config.ActiveFilterColor);
            }
            highlightX += name.Length + 3;
        }

        // Separator after filters
        var separator = $"├{new string('─', _config.BrowserWidth - 2)}┤";
        _terminalService.WriteAt(_browserPosition.X, tabY + 1, separator);
    }

    private void RenderRecipeList()
    {
        var listY = _browserPosition.Y + 5;
        var columnWidth = (_config.BrowserWidth - 4) / 2;

        // Group recipes by category for column layout
        var grouped = _filteredRecipes
            .GroupBy(r => r.Category)
            .ToDictionary(g => g.Key, g => g.ToList());

        var columnIndex = 0;
        var currentY = listY;

        foreach (var category in Enum.GetValues<RecipeCategory>())
        {
            if (!grouped.TryGetValue(category, out var recipes) || recipes.Count == 0)
            {
                continue;
            }

            var columnX = _browserPosition.X + 2 + (columnIndex * columnWidth);

            // Category header
            var header = category.ToString().ToUpperInvariant();
            _terminalService.WriteColoredAt(columnX, currentY, header, _config.CategoryHeaderColor);
            _terminalService.WriteAt(columnX, currentY + 1, new string('─', header.Length));

            // Recipe entries
            var entryY = currentY + 2;
            var displayCount = Math.Min(recipes.Count, _config.MaxRecipesPerCategory);

            for (var i = 0; i < displayCount; i++)
            {
                var recipe = recipes[i];
                var globalIndex = _filteredRecipes.IndexOf(recipe);
                var isSelected = globalIndex == _selectedIndex;

                RenderRecipeEntry(columnX, entryY + i, recipe, isSelected, columnWidth - 2);
            }

            // Overflow indicator
            if (recipes.Count > displayCount)
            {
                var overflowText = $"... +{recipes.Count - displayCount} more";
                _terminalService.WriteColoredAt(
                    columnX,
                    entryY + displayCount,
                    overflowText,
                    ConsoleColor.DarkGray);
            }

            columnIndex++;
            if (columnIndex >= 2)
            {
                columnIndex = 0;
                currentY += _config.MaxRecipesPerCategory + 4;
            }
        }
    }

    private void RenderRecipeEntry(int x, int y, RecipeBrowserDisplayDto recipe, bool isSelected, int maxWidth)
    {
        var name = recipe.Name;
        if (name.Length > maxWidth - 4)
        {
            name = name.Substring(0, maxWidth - 6) + "..";
        }

        // Selection indicator
        if (isSelected)
        {
            _terminalService.WriteColoredAt(x, y, "►", _config.SelectionColor);
        }

        // Recipe name with craftable indicator
        var craftableIndicator = recipe.IsCraftable ? "[x]" : "[ ]";
        var indicatorColor = recipe.IsCraftable ? _config.CraftableColor : _config.NotCraftableColor;

        _terminalService.WriteColoredAt(x + 2, y, craftableIndicator, indicatorColor);

        var nameColor = isSelected ? _config.SelectionColor : ConsoleColor.White;
        _terminalService.WriteColoredAt(x + 6, y, name, nameColor);

        // New indicator
        if (recipe.IsNew)
        {
            _terminalService.WriteColoredAt(
                x + 6 + name.Length + 1,
                y,
                "NEW",
                _config.NewRecipeColor);
        }
    }

    private void RenderControls()
    {
        var controlsY = _browserPosition.Y + _config.BrowserHeight - 2;
        var width = _config.BrowserWidth;

        // Bottom separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_browserPosition.X, controlsY - 1, separator);

        // Controls hint
        var controls = "│  [↑/↓] Navigate   [Enter] Details   [Tab] Filter   [Esc] Close";
        var padding = width - controls.Length - 1;
        _terminalService.WriteAt(_browserPosition.X, controlsY, controls + new string(' ', padding) + "│");

        // Bottom border
        var bottomBorder = $"└{new string('─', width - 2)}┘";
        _terminalService.WriteAt(_browserPosition.X, controlsY + 1, bottomBorder);
    }

    private void ApplyFilters()
    {
        var filtered = _recipes.AsEnumerable();

        // Apply search filter
        if (!string.IsNullOrWhiteSpace(_searchText))
        {
            var searchLower = _searchText.ToLowerInvariant();
            filtered = filtered.Where(r =>
                r.Name.ToLowerInvariant().Contains(searchLower));
        }

        // Apply category filter
        if (_activeCategory.HasValue)
        {
            filtered = filtered.Where(r => r.Category == _activeCategory.Value);
        }

        _filteredRecipes = filtered.ToList();
        _selectedIndex = Math.Min(_selectedIndex, Math.Max(0, _filteredRecipes.Count - 1));
    }

    private void RefreshSelection()
    {
        RenderRecipeList();
    }

    private bool HandleNavigateUp()
    {
        SelectPrevious();
        return true;
    }

    private bool HandleNavigateDown()
    {
        SelectNext();
        return true;
    }

    private bool HandleSelect()
    {
        var recipe = GetSelectedRecipe();
        if (recipe != null)
        {
            RecipeSelected?.Invoke(this, recipe);
        }
        return true;
    }

    private bool HandleCycleCategory()
    {
        var categories = new RecipeCategory?[]
        {
            null,
            RecipeCategory.Weapons,
            RecipeCategory.Armor,
            RecipeCategory.Potions,
            RecipeCategory.Jewelry,
            RecipeCategory.Tools
        };

        var currentIndex = Array.IndexOf(categories, _activeCategory);
        var nextIndex = (currentIndex + 1) % categories.Length;
        FilterByCategory(categories[nextIndex]);
        return true;
    }

    private bool HandleBackspace()
    {
        BackspaceSearch();
        return true;
    }

    private bool HandleClose()
    {
        Hide();
        return true;
    }

    #endregion
}
```

### 4.2 Search Functionality

**Purpose:** Allow filtering recipes by name using substring matching.

**Search Behavior:**
- Case-insensitive substring matching
- Filters as user types
- Backspace removes characters
- Escape clears search and closes browser

**Search Display:**
```
│  Search: [steel______]    Filter: [All]  Weapons   Armor   Potions │
```

**Search Input Handling:**
- Alphanumeric characters append to search text
- Backspace removes last character
- Search updates results in real-time
- Empty search shows all recipes

### 4.3 Category Filtering

**Purpose:** Filter recipes by crafting category.

**Categories:**

| Category | Description | Examples |
|----------|-------------|----------|
| Weapons | Offensive equipment | Swords, daggers, axes, bows |
| Armor | Defensive equipment | Shields, helmets, body armor |
| Potions | Consumable crafts | Health potions, mana potions, buffs |
| Jewelry | Accessories | Rings, amulets, necklaces |
| Tools | Utility items | Lockpicks, crafting tools |

**Filter Tab Display:**
```
Filter: [All]  Weapons   Armor   Potions
```

**Active Filter Highlighting:**
- Active filter tab shows in brackets `[All]`
- Inactive tabs show without brackets `Weapons`
- Tab cycles through categories

---

## 5. Recipe Details Component

### 5.1 RecipeDetails Class

**Purpose:** Displays full recipe information including materials, output, and quality range.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/RecipeDetails.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays detailed recipe information including materials and output.
/// </summary>
/// <remarks>
/// Shows full recipe details with material requirements, owned quantities,
/// expected output item, and quality range based on player skill.
/// </remarks>
public class RecipeDetails
{
    private readonly IResourceService _resourceService;
    private readonly QualityTierRenderer _qualityRenderer;
    private readonly ITerminalService _terminalService;
    private readonly RecipeBrowserConfig _config;
    private readonly ILogger<RecipeDetails> _logger;

    private RecipeDetailsDisplayDto? _currentRecipe;
    private (int X, int Y) _detailsPosition;

    /// <summary>
    /// Gets whether the details panel is visible.
    /// </summary>
    public bool IsVisible { get; private set; }

    /// <summary>
    /// Gets the currently displayed recipe.
    /// </summary>
    public RecipeDetailsDisplayDto? CurrentRecipe => _currentRecipe;

    /// <summary>
    /// Creates a new instance of the RecipeDetails component.
    /// </summary>
    /// <param name="resourceService">The resource service.</param>
    /// <param name="qualityRenderer">The quality tier renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public RecipeDetails(
        IResourceService resourceService,
        QualityTierRenderer qualityRenderer,
        ITerminalService terminalService,
        RecipeBrowserConfig config,
        ILogger<RecipeDetails> logger)
    {
        _resourceService = resourceService ?? throw new ArgumentNullException(nameof(resourceService));
        _qualityRenderer = qualityRenderer ?? throw new ArgumentNullException(nameof(qualityRenderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the details panel position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _detailsPosition = (x, y);
    }

    /// <summary>
    /// Renders the recipe details.
    /// </summary>
    /// <param name="recipe">The recipe to display.</param>
    public void RenderRecipe(RecipeDetailsDisplayDto recipe)
    {
        _currentRecipe = recipe;
        IsVisible = true;

        // Clear details area
        ClearDetails();

        // Render recipe header
        RenderRecipeHeader(recipe);

        // Render material requirements
        ShowMaterials(recipe.Materials);

        // Render expected output
        ShowExpectedOutput(recipe.OutputItemName, recipe.QualityRange);

        // Render craft action hint
        RenderCraftHint(recipe.IsCraftable);

        _logger.LogDebug("Rendered details for recipe: {RecipeName}", recipe.Name);
    }

    /// <summary>
    /// Shows the material requirements for a recipe.
    /// </summary>
    /// <param name="materials">The material requirements.</param>
    public void ShowMaterials(IEnumerable<MaterialRequirementDto> materials)
    {
        var materialsY = _detailsPosition.Y + 5;

        // Materials header
        _terminalService.WriteAt(_detailsPosition.X + 2, materialsY, "Required Materials:");
        _terminalService.WriteAt(_detailsPosition.X + 32, materialsY, "You Have:");

        var y = materialsY + 1;
        foreach (var material in materials)
        {
            // Material requirement with tree structure
            var prefix = material.IsOptional ? "+-- " : "|-- ";
            var materialLine = $"{prefix}{material.MaterialName} x{material.RequiredQuantity}";

            _terminalService.WriteAt(_detailsPosition.X + 2, y, materialLine);

            // Owned quantity with availability indicator
            var owned = material.OwnedQuantity;
            var isSufficient = owned >= material.RequiredQuantity;
            var ownedText = $"{owned}";
            var indicator = isSufficient ? " [x]" : " [ ]";
            var indicatorColor = isSufficient ? _config.SufficientMaterialColor : _config.InsufficientMaterialColor;

            _terminalService.WriteAt(_detailsPosition.X + 32, y, ownedText);
            _terminalService.WriteColoredAt(_detailsPosition.X + 36, y, indicator, indicatorColor);

            y++;
        }
    }

    /// <summary>
    /// Shows the expected output item and quality range.
    /// </summary>
    /// <param name="itemName">The output item name.</param>
    /// <param name="qualityRange">The quality range description.</param>
    public void ShowExpectedOutput(string itemName, string qualityRange)
    {
        var outputY = _detailsPosition.Y + _config.DetailsHeight - 5;

        _terminalService.WriteAt(_detailsPosition.X + 2, outputY, $"Output: {itemName}");
        _terminalService.WriteAt(_detailsPosition.X + 2, outputY + 1, $"Quality: {qualityRange}");
    }

    /// <summary>
    /// Shows the quality result after crafting.
    /// </summary>
    /// <param name="quality">The crafted item's quality tier.</param>
    public void ShowQualityResult(ItemQuality quality)
    {
        var qualityY = _detailsPosition.Y + 1;
        var qualityX = _detailsPosition.X + _config.DetailsWidth - 15;

        var stars = _qualityRenderer.GetQualityStars(quality);
        var color = _qualityRenderer.GetQualityColor(quality);

        _terminalService.WriteColoredAt(qualityX, qualityY, $"Quality: {stars}", color);

        _logger.LogDebug("Displayed quality result: {Quality}", quality);
    }

    /// <summary>
    /// Hides the details panel.
    /// </summary>
    public void Hide()
    {
        if (!IsVisible) return;

        ClearDetails();
        IsVisible = false;
        _currentRecipe = null;

        _logger.LogDebug("Recipe details hidden");
    }

    #region Private Methods

    private void ClearDetails()
    {
        var blankLine = new string(' ', _config.DetailsWidth);
        for (var y = 0; y < _config.DetailsHeight; y++)
        {
            _terminalService.WriteAt(_detailsPosition.X, _detailsPosition.Y + y, blankLine);
        }
    }

    private void RenderRecipeHeader(RecipeDetailsDisplayDto recipe)
    {
        var headerY = _detailsPosition.Y;
        var width = _config.DetailsWidth;

        // Top border
        var topBorder = $"┌{new string('─', width - 2)}┐";
        _terminalService.WriteAt(_detailsPosition.X, headerY, topBorder);

        // Recipe name with quality indicator
        var qualityStars = _qualityRenderer.GetQualityStars(recipe.ExpectedQuality);
        var titleLine = $"│ {recipe.Name.ToUpperInvariant()}";
        var qualityPadding = width - titleLine.Length - qualityStars.Length - 2;
        titleLine += new string(' ', qualityPadding) + qualityStars + " │";

        _terminalService.WriteAt(_detailsPosition.X, headerY + 1, titleLine);

        // Description
        var descLine = $"│ {recipe.Description}";
        var descPadding = width - descLine.Length - 1;
        descLine += new string(' ', descPadding) + "│";
        _terminalService.WriteAt(_detailsPosition.X, headerY + 2, descLine);

        // Separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_detailsPosition.X, headerY + 3, separator);
    }

    private void RenderCraftHint(bool canCraft)
    {
        var hintY = _detailsPosition.Y + _config.DetailsHeight - 2;
        var width = _config.DetailsWidth;

        // Bottom separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_detailsPosition.X, hintY - 1, separator);

        // Craft action hint
        var hintText = canCraft ? "[C]raft" : "Insufficient materials";
        var hintColor = canCraft ? _config.CraftableColor : _config.NotCraftableColor;

        var hintLine = $"│  {hintText}";
        var padding = width - hintLine.Length - 1;
        _terminalService.WriteAt(_detailsPosition.X, hintY, hintLine + new string(' ', padding) + "│");
        _terminalService.WriteColoredAt(_detailsPosition.X + 3, hintY, hintText, hintColor);

        // Bottom border
        var bottomBorder = $"└{new string('─', width - 2)}┘";
        _terminalService.WriteAt(_detailsPosition.X, hintY + 1, bottomBorder);
    }

    #endregion
}
```

### 5.2 Material Requirements Display

**Purpose:** Show required materials compared to owned quantities.

**Material Display Format:**
```
Required Materials:           You Have:
|-- Iron Ore x2               24 [x]
+-- Coal x1                   8 [x]
```

**Material Display Rules:**
- Tree structure with `|--` for required, `+--` for optional
- Required quantity shown after material name
- Owned quantity shown in "You Have" column
- Availability indicator: `[x]` sufficient, `[ ]` insufficient
- Insufficient materials highlighted in red

### 5.3 Quality Result Display

**Purpose:** Show crafted item quality using star rating system.

**Quality Tiers:**

| Quality | Stars | Color | Description |
|---------|-------|-------|-------------|
| Common | ★ | Gray | Basic quality |
| Uncommon | ★★ | Green | Slightly improved |
| Rare | ★★★ | Blue | Notable quality |
| Epic | ★★★★ | Magenta | Exceptional quality |
| Legendary | ★★★★★ | Yellow | Masterwork quality |

**Quality Display Example:**
```
┌─────────────────────────────────────────────────────────────────────┐
│ STEEL BLADE                                      Quality: ★★★       │
│ A finely crafted blade of hardened steel                            │
```

---

## 6. Recipe Book Component

### 6.1 RecipeBook Class

**Purpose:** Displays the player's collection of discovered recipes with progress tracking.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/RecipeBook.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays the player's discovered recipe collection with progress tracking.
/// </summary>
/// <remarks>
/// Shows all discovered recipes organized by station, with discovery progress
/// and highlighting for newly discovered recipes.
/// </remarks>
public class RecipeBook
{
    private readonly ICraftingService _craftingService;
    private readonly ITerminalService _terminalService;
    private readonly RecipeBrowserConfig _config;
    private readonly ILogger<RecipeBook> _logger;

    private IReadOnlyList<RecipeBookEntryDto> _discoveredRecipes = Array.Empty<RecipeBookEntryDto>();
    private string? _stationFilter;
    private HashSet<string> _newRecipeIds = new();
    private (int X, int Y) _bookPosition;

    /// <summary>
    /// Gets whether the recipe book is visible.
    /// </summary>
    public bool IsVisible { get; private set; }

    /// <summary>
    /// Gets the current station filter.
    /// </summary>
    public string? StationFilter => _stationFilter;

    /// <summary>
    /// Creates a new instance of the RecipeBook component.
    /// </summary>
    /// <param name="craftingService">The crafting service.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for display settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public RecipeBook(
        ICraftingService craftingService,
        ITerminalService terminalService,
        RecipeBrowserConfig config,
        ILogger<RecipeBook> logger)
    {
        _craftingService = craftingService ?? throw new ArgumentNullException(nameof(craftingService));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the recipe book position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _bookPosition = (x, y);
    }

    /// <summary>
    /// Renders the discovered recipes.
    /// </summary>
    /// <param name="recipes">The discovered recipes.</param>
    public void RenderDiscoveredRecipes(IEnumerable<RecipeBookEntryDto> recipes)
    {
        _discoveredRecipes = recipes.ToList();
        IsVisible = true;

        // Clear book area
        ClearBook();

        // Render book header with progress
        RenderHeader();

        // Render unlock progress
        var totalRecipes = _craftingService.GetTotalRecipeCount();
        ShowUnlockProgress(_discoveredRecipes.Count, totalRecipes);

        // Render recipe list grouped by station
        RenderRecipesByStation();

        _logger.LogDebug("Rendered recipe book with {Count} discovered recipes",
            _discoveredRecipes.Count);
    }

    /// <summary>
    /// Shows the unlock progress display.
    /// </summary>
    /// <param name="discovered">Number of discovered recipes.</param>
    /// <param name="total">Total number of recipes.</param>
    public void ShowUnlockProgress(int discovered, int total)
    {
        var progressY = _bookPosition.Y + 3;
        var percentage = total > 0 ? (discovered * 100) / total : 0;

        var progressText = $"Recipes Discovered: {discovered} / {total} ({percentage}%)";
        _terminalService.WriteAt(_bookPosition.X + 2, progressY, progressText);

        // Progress bar
        var barWidth = 30;
        var filledWidth = total > 0 ? (discovered * barWidth) / total : 0;
        var bar = $"[{new string('#', filledWidth)}{new string('.', barWidth - filledWidth)}]";
        _terminalService.WriteColoredAt(_bookPosition.X + 2, progressY + 1, bar, _config.ProgressBarColor);
    }

    /// <summary>
    /// Highlights a newly discovered recipe.
    /// </summary>
    /// <param name="recipeId">The ID of the new recipe.</param>
    public void HighlightNew(string recipeId)
    {
        _newRecipeIds.Add(recipeId);
        _logger.LogDebug("Marked recipe as new: {RecipeId}", recipeId);
    }

    /// <summary>
    /// Clears the new highlight from a recipe.
    /// </summary>
    /// <param name="recipeId">The ID of the recipe.</param>
    public void ClearNewHighlight(string recipeId)
    {
        _newRecipeIds.Remove(recipeId);
    }

    /// <summary>
    /// Filters recipes by crafting station.
    /// </summary>
    /// <param name="stationId">The station ID to filter by, or null for all.</param>
    public void FilterByStation(string? stationId)
    {
        _stationFilter = stationId;
        RenderDiscoveredRecipes(_discoveredRecipes);

        _logger.LogDebug("Station filter applied: {StationId}",
            stationId ?? "All");
    }

    /// <summary>
    /// Hides the recipe book.
    /// </summary>
    public void Hide()
    {
        if (!IsVisible) return;

        ClearBook();
        IsVisible = false;
        _discoveredRecipes = Array.Empty<RecipeBookEntryDto>();

        _logger.LogDebug("Recipe book hidden");
    }

    #region Private Methods

    private void ClearBook()
    {
        var blankLine = new string(' ', _config.BookWidth);
        for (var y = 0; y < _config.BookHeight; y++)
        {
            _terminalService.WriteAt(_bookPosition.X, _bookPosition.Y + y, blankLine);
        }
    }

    private void RenderHeader()
    {
        var headerY = _bookPosition.Y;
        var width = _config.BookWidth;

        // Top border
        var topBorder = $"┌{new string('─', width - 2)}┐";
        _terminalService.WriteAt(_bookPosition.X, headerY, topBorder);

        // Title
        var title = "RECIPE BOOK";
        var titlePadding = (width - 2 - title.Length) / 2;
        var titleLine = $"│{new string(' ', titlePadding)}{title}{new string(' ', width - 2 - titlePadding - title.Length)}│";
        _terminalService.WriteAt(_bookPosition.X, headerY + 1, titleLine);

        // Separator
        var separator = $"├{new string('─', width - 2)}┤";
        _terminalService.WriteAt(_bookPosition.X, headerY + 2, separator);
    }

    private void RenderRecipesByStation()
    {
        var listY = _bookPosition.Y + 6;

        // Apply station filter
        var recipes = _stationFilter == null
            ? _discoveredRecipes
            : _discoveredRecipes.Where(r => r.StationId == _stationFilter).ToList();

        // Group by station
        var grouped = recipes
            .GroupBy(r => r.StationName)
            .ToDictionary(g => g.Key, g => g.ToList());

        var y = listY;
        foreach (var (stationName, stationRecipes) in grouped)
        {
            // Station header
            _terminalService.WriteColoredAt(
                _bookPosition.X + 2,
                y,
                stationName.ToUpperInvariant(),
                _config.StationHeaderColor);
            y++;

            // Recipe entries
            foreach (var recipe in stationRecipes.Take(_config.MaxRecipesPerStation))
            {
                var isNew = _newRecipeIds.Contains(recipe.RecipeId);
                RenderBookEntry(recipe, y, isNew);
                y++;
            }

            // Overflow indicator
            if (stationRecipes.Count > _config.MaxRecipesPerStation)
            {
                var overflow = $"  ... +{stationRecipes.Count - _config.MaxRecipesPerStation} more";
                _terminalService.WriteColoredAt(
                    _bookPosition.X + 2,
                    y,
                    overflow,
                    ConsoleColor.DarkGray);
                y++;
            }

            y++; // Spacing between stations
        }
    }

    private void RenderBookEntry(RecipeBookEntryDto recipe, int y, bool isNew)
    {
        var entryLine = $"  • {recipe.Name}";

        _terminalService.WriteAt(_bookPosition.X + 2, y, entryLine);

        if (isNew)
        {
            _terminalService.WriteColoredAt(
                _bookPosition.X + 4 + recipe.Name.Length + 2,
                y,
                "NEW",
                _config.NewRecipeColor);
        }
    }

    #endregion
}
```

### 6.2 Discovery Progress

**Purpose:** Track and display recipe discovery progress.

**Progress Display Format:**
```
Recipes Discovered: 12 / 35 (34%)
[############........................]
```

**Progress Elements:**
- Discovered count vs total count
- Percentage complete
- Visual progress bar with filled and empty portions

### 6.3 Station Filtering

**Purpose:** Filter discovered recipes by crafting station.

**Station Filter Behavior:**
- `null` shows all discovered recipes
- Specific station ID shows only that station's recipes
- Recipes grouped by station name in display

---

## 7. Notification Components

### 7.1 RecipeDiscoveryNotification Class

**Purpose:** Displays a popup notification when a new recipe is discovered.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/RecipeDiscoveryNotification.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays a notification popup when a new recipe is discovered.
/// </summary>
/// <remarks>
/// Shows a 5-second auto-dismiss popup with the recipe name and
/// crafting station information.
/// </remarks>
public class RecipeDiscoveryNotification
{
    private readonly ITerminalService _terminalService;
    private readonly RecipeBrowserConfig _config;
    private readonly ILogger<RecipeDiscoveryNotification> _logger;

    private (int X, int Y) _notificationPosition;
    private bool _isVisible;
    private CancellationTokenSource? _dismissCancellation;

    /// <summary>
    /// Gets whether the notification is currently visible.
    /// </summary>
    public bool IsVisible => _isVisible;

    /// <summary>
    /// Creates a new instance of the RecipeDiscoveryNotification component.
    /// </summary>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for notification settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public RecipeDiscoveryNotification(
        ITerminalService terminalService,
        RecipeBrowserConfig config,
        ILogger<RecipeDiscoveryNotification> logger)
    {
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the notification position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _notificationPosition = (x, y);
    }

    /// <summary>
    /// Shows the discovery notification.
    /// </summary>
    /// <param name="recipe">The discovered recipe.</param>
    public async Task ShowDiscoveryAsync(RecipeDiscoveryDto recipe)
    {
        // Cancel any existing notification
        _dismissCancellation?.Cancel();
        _dismissCancellation = new CancellationTokenSource();

        _isVisible = true;
        RenderNotification(recipe);

        _logger.LogInformation("Recipe discovered: {RecipeName}", recipe.Name);

        // Auto-dismiss after duration
        try
        {
            await Task.Delay(GetDuration(), _dismissCancellation.Token);
            Hide();
        }
        catch (TaskCanceledException)
        {
            // Notification was manually dismissed or replaced
        }
    }

    /// <summary>
    /// Shows the discovery notification synchronously.
    /// </summary>
    /// <param name="recipe">The discovered recipe.</param>
    public void ShowDiscovery(RecipeDiscoveryDto recipe)
    {
        _isVisible = true;
        RenderNotification(recipe);

        _logger.LogInformation("Recipe discovered: {RecipeName}", recipe.Name);
    }

    /// <summary>
    /// Gets the notification duration.
    /// </summary>
    /// <returns>The duration as a TimeSpan.</returns>
    public TimeSpan GetDuration()
    {
        return TimeSpan.FromSeconds(_config.NotificationDurationSeconds);
    }

    /// <summary>
    /// Hides the notification.
    /// </summary>
    public void Hide()
    {
        if (!_isVisible) return;

        ClearNotification();
        _isVisible = false;
        _dismissCancellation?.Cancel();

        _logger.LogDebug("Recipe discovery notification hidden");
    }

    #region Private Methods

    private void RenderNotification(RecipeDiscoveryDto recipe)
    {
        var width = _config.NotificationWidth;
        var x = _notificationPosition.X;
        var y = _notificationPosition.Y;

        // Top border
        var topBorder = $"+{new string('=', width - 2)}+";
        _terminalService.WriteColoredAt(x, y, topBorder, _config.NotificationBorderColor);

        // Header
        var header = "  [!]  NEW RECIPE DISCOVERED!";
        var headerPadding = width - header.Length - 2;
        var headerLine = $"|{header}{new string(' ', headerPadding)}|";
        _terminalService.WriteColoredAt(x, y + 1, headerLine, _config.NotificationBorderColor);
        _terminalService.WriteColoredAt(x + 3, y + 1, "[!]", _config.NotificationHighlightColor);
        _terminalService.WriteColoredAt(x + 8, y + 1, "NEW RECIPE DISCOVERED!", _config.NotificationHighlightColor);

        // Separator
        var separator = $"+{new string('=', width - 2)}+";
        _terminalService.WriteColoredAt(x, y + 2, separator, _config.NotificationBorderColor);

        // Empty line
        var emptyLine = $"|{new string(' ', width - 2)}|";
        _terminalService.WriteAt(x, y + 3, emptyLine);

        // Recipe name
        var nameLine = $"|  {recipe.Name}";
        var namePadding = width - nameLine.Length - 1;
        _terminalService.WriteAt(x, y + 4, nameLine + new string(' ', namePadding) + "|");
        _terminalService.WriteColoredAt(x + 3, y + 4, recipe.Name, ConsoleColor.White);

        // Station info
        var stationLine = $"|  Forge at: {recipe.StationName}";
        var stationPadding = width - stationLine.Length - 1;
        _terminalService.WriteAt(x, y + 5, stationLine + new string(' ', stationPadding) + "|");

        // Empty line
        _terminalService.WriteAt(x, y + 6, emptyLine);

        // Bottom border
        var bottomBorder = $"+{new string('=', width - 2)}+";
        _terminalService.WriteColoredAt(x, y + 7, bottomBorder, _config.NotificationBorderColor);
    }

    private void ClearNotification()
    {
        var width = _config.NotificationWidth;
        var blankLine = new string(' ', width);

        for (var i = 0; i < 8; i++)
        {
            _terminalService.WriteAt(_notificationPosition.X, _notificationPosition.Y + i, blankLine);
        }
    }

    #endregion
}
```

### 7.2 CraftingResultNotification Class

**Purpose:** Displays crafting result with quality tier after successful crafting.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/UI/CraftingResultNotification.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Renderers;
using RuneAndRust.Presentation.Tui.Services;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.UI;

/// <summary>
/// Displays the crafting result with quality tier after successful crafting.
/// </summary>
/// <remarks>
/// Shows a 5-second auto-dismiss popup with the crafted item name
/// and quality tier using star rating display.
/// </remarks>
public class CraftingResultNotification
{
    private readonly QualityTierRenderer _qualityRenderer;
    private readonly ITerminalService _terminalService;
    private readonly RecipeBrowserConfig _config;
    private readonly ILogger<CraftingResultNotification> _logger;

    private (int X, int Y) _notificationPosition;
    private bool _isVisible;
    private CancellationTokenSource? _dismissCancellation;

    /// <summary>
    /// Gets whether the notification is currently visible.
    /// </summary>
    public bool IsVisible => _isVisible;

    /// <summary>
    /// Creates a new instance of the CraftingResultNotification component.
    /// </summary>
    /// <param name="qualityRenderer">The quality tier renderer.</param>
    /// <param name="terminalService">The terminal output service.</param>
    /// <param name="config">Configuration for notification settings.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public CraftingResultNotification(
        QualityTierRenderer qualityRenderer,
        ITerminalService terminalService,
        RecipeBrowserConfig config,
        ILogger<CraftingResultNotification> logger)
    {
        _qualityRenderer = qualityRenderer ?? throw new ArgumentNullException(nameof(qualityRenderer));
        _terminalService = terminalService ?? throw new ArgumentNullException(nameof(terminalService));
        _config = config ?? throw new ArgumentNullException(nameof(config));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Sets the notification position.
    /// </summary>
    /// <param name="x">The X coordinate.</param>
    /// <param name="y">The Y coordinate.</param>
    public void SetPosition(int x, int y)
    {
        _notificationPosition = (x, y);
    }

    /// <summary>
    /// Shows the crafting result notification.
    /// </summary>
    /// <param name="result">The crafting result.</param>
    public async Task ShowResultAsync(CraftingResultDto result)
    {
        // Cancel any existing notification
        _dismissCancellation?.Cancel();
        _dismissCancellation = new CancellationTokenSource();

        _isVisible = true;
        RenderNotification(result);

        _logger.LogInformation(
            "Crafting complete: {ItemName} with quality {Quality}",
            result.ItemName,
            result.Quality);

        // Auto-dismiss after duration
        try
        {
            await Task.Delay(GetDuration(), _dismissCancellation.Token);
            Hide();
        }
        catch (TaskCanceledException)
        {
            // Notification was manually dismissed or replaced
        }
    }

    /// <summary>
    /// Shows the crafting result notification synchronously.
    /// </summary>
    /// <param name="result">The crafting result.</param>
    public void ShowResult(CraftingResultDto result)
    {
        _isVisible = true;
        RenderNotification(result);

        _logger.LogInformation(
            "Crafting complete: {ItemName} with quality {Quality}",
            result.ItemName,
            result.Quality);
    }

    /// <summary>
    /// Shows the quality tier display.
    /// </summary>
    /// <param name="quality">The quality tier.</param>
    public void ShowQualityTier(ItemQuality quality)
    {
        var y = _notificationPosition.Y + 5;
        var x = _notificationPosition.X + 3;

        var qualityName = _qualityRenderer.GetQualityName(quality);
        var qualityStars = _qualityRenderer.GetQualityStars(quality);
        var qualityColor = _qualityRenderer.GetQualityColor(quality);

        var qualityText = $"Quality: {qualityName} ({qualityStars})";
        _terminalService.WriteColoredAt(x, y, qualityText, qualityColor);
    }

    /// <summary>
    /// Gets the notification duration.
    /// </summary>
    /// <returns>The duration as a TimeSpan.</returns>
    public TimeSpan GetDuration()
    {
        return TimeSpan.FromSeconds(_config.NotificationDurationSeconds);
    }

    /// <summary>
    /// Hides the notification.
    /// </summary>
    public void Hide()
    {
        if (!_isVisible) return;

        ClearNotification();
        _isVisible = false;
        _dismissCancellation?.Cancel();

        _logger.LogDebug("Crafting result notification hidden");
    }

    #region Private Methods

    private void RenderNotification(CraftingResultDto result)
    {
        var width = _config.NotificationWidth;
        var x = _notificationPosition.X;
        var y = _notificationPosition.Y;

        // Top border
        var topBorder = $"+{new string('=', width - 2)}+";
        _terminalService.WriteColoredAt(x, y, topBorder, _config.NotificationBorderColor);

        // Header
        var header = "  CRAFTING COMPLETE!";
        var headerPadding = width - header.Length - 2;
        var headerLine = $"|{header}{new string(' ', headerPadding)}|";
        _terminalService.WriteColoredAt(x, y + 1, headerLine, _config.NotificationBorderColor);
        _terminalService.WriteColoredAt(x + 3, y + 1, "CRAFTING COMPLETE!", _config.NotificationHighlightColor);

        // Separator
        var separator = $"+{new string('=', width - 2)}+";
        _terminalService.WriteColoredAt(x, y + 2, separator, _config.NotificationBorderColor);

        // Empty line
        var emptyLine = $"|{new string(' ', width - 2)}|";
        _terminalService.WriteAt(x, y + 3, emptyLine);

        // Item name
        var nameLine = $"|  {result.ItemName}";
        var namePadding = width - nameLine.Length - 1;
        _terminalService.WriteAt(x, y + 4, nameLine + new string(' ', namePadding) + "|");
        _terminalService.WriteColoredAt(x + 3, y + 4, result.ItemName, ConsoleColor.White);

        // Quality tier
        var qualityName = _qualityRenderer.GetQualityName(result.Quality);
        var qualityStars = _qualityRenderer.GetQualityStars(result.Quality);
        var qualityColor = _qualityRenderer.GetQualityColor(result.Quality);

        var qualityLine = $"|  Quality: {qualityName} ({qualityStars})";
        var qualityPadding = width - qualityLine.Length - 1;
        _terminalService.WriteAt(x, y + 5, qualityLine + new string(' ', qualityPadding) + "|");
        _terminalService.WriteColoredAt(x + 12, y + 5, $"{qualityName} ({qualityStars})", qualityColor);

        // Empty line
        _terminalService.WriteAt(x, y + 6, emptyLine);

        // Bottom border
        var bottomBorder = $"+{new string('=', width - 2)}+";
        _terminalService.WriteColoredAt(x, y + 7, bottomBorder, _config.NotificationBorderColor);
    }

    private void ClearNotification()
    {
        var width = _config.NotificationWidth;
        var blankLine = new string(' ', width);

        for (var i = 0; i < 8; i++)
        {
            _terminalService.WriteAt(_notificationPosition.X, _notificationPosition.Y + i, blankLine);
        }
    }

    #endregion
}
```

**Notification Display Examples:**

**Recipe Discovery:**
```
+=====================================================+
|  [!]  NEW RECIPE DISCOVERED!                        |
+=====================================================+
|                                                     |
|  STEEL BLADE                                        |
|  Forge at: Blacksmith                               |
|                                                     |
+=====================================================+
```

**Crafting Result:**
```
+=====================================================+
|  CRAFTING COMPLETE!                                 |
+=====================================================+
|                                                     |
|  Steel Blade                                        |
|  Quality: RARE (★★★)                               |
|                                                     |
+=====================================================+
```

---

## 8. Recipes Command

**Purpose:** Command-line access to recipe browsing functionality.

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Commands/RecipesCommand.cs`

```csharp
using RuneAndRust.Application.Interfaces;
using RuneAndRust.Presentation.Tui.UI;

namespace RuneAndRust.Presentation.Tui.Commands;

/// <summary>
/// Command to display the recipe browser.
/// </summary>
/// <remarks>
/// Opens the recipe browser UI with optional category filtering.
/// Usage: recipes [category]
/// </remarks>
public class RecipesCommand : ICommand
{
    private readonly RecipeBrowser _recipeBrowser;
    private readonly ICraftingService _craftingService;
    private readonly ILogger<RecipesCommand> _logger;

    /// <summary>
    /// Gets the command name.
    /// </summary>
    public string Name => "recipes";

    /// <summary>
    /// Gets the command description.
    /// </summary>
    public string Description => "Open the recipe browser to view discovered recipes";

    /// <summary>
    /// Gets the command usage.
    /// </summary>
    public string Usage => "recipes [category]";

    /// <summary>
    /// Creates a new instance of the RecipesCommand.
    /// </summary>
    /// <param name="recipeBrowser">The recipe browser component.</param>
    /// <param name="craftingService">The crafting service.</param>
    /// <param name="logger">Logger for diagnostic output.</param>
    public RecipesCommand(
        RecipeBrowser recipeBrowser,
        ICraftingService craftingService,
        ILogger<RecipesCommand> logger)
    {
        _recipeBrowser = recipeBrowser ?? throw new ArgumentNullException(nameof(recipeBrowser));
        _craftingService = craftingService ?? throw new ArgumentNullException(nameof(craftingService));
        _logger = logger ?? throw new ArgumentNullException(nameof(logger));
    }

    /// <summary>
    /// Executes the recipes command.
    /// </summary>
    /// <param name="args">Command arguments.</param>
    /// <param name="context">Command execution context.</param>
    /// <returns>Command result.</returns>
    public CommandResult Execute(string[] args, CommandContext context)
    {
        var player = context.Player;
        if (player == null)
        {
            return CommandResult.Failure("No active player.");
        }

        // Get discovered recipes
        var recipes = _craftingService.GetDiscoveredRecipes(player);

        // Convert to display DTOs
        var displayDtos = recipes.Select(r => new RecipeBrowserDisplayDto(
            RecipeId: r.Id,
            Name: r.Name,
            Description: r.Description,
            Category: MapToCategory(r.Category),
            StationName: r.StationTypeRequired,
            IsCraftable: _craftingService.CanCraft(player, r.Id),
            IsNew: false // Track via RecipeBook
        )).ToList();

        // Apply category filter if provided
        if (args.Length > 0 && Enum.TryParse<RecipeCategory>(args[0], true, out var category))
        {
            _recipeBrowser.FilterByCategory(category);
        }

        // Show browser
        _recipeBrowser.RenderRecipes(displayDtos);

        _logger.LogInformation("Opened recipe browser with {Count} recipes", displayDtos.Count);

        return CommandResult.Success();
    }

    private static RecipeCategory MapToCategory(string categoryString)
    {
        return categoryString?.ToLowerInvariant() switch
        {
            "weapon" or "weapons" => RecipeCategory.Weapons,
            "armor" => RecipeCategory.Armor,
            "potion" or "potions" => RecipeCategory.Potions,
            "jewelry" => RecipeCategory.Jewelry,
            "tool" or "tools" => RecipeCategory.Tools,
            _ => RecipeCategory.Tools // Default
        };
    }
}
```

**Command Usage:**
- `recipes` - Open recipe browser with all discovered recipes
- `recipes weapons` - Open recipe browser filtered to weapons category
- `recipes armor` - Open recipe browser filtered to armor category

---

## 9. Data Model Changes

### 9.1 New Enums

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/RecipeCategory.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Represents the category of a craftable recipe.
/// </summary>
public enum RecipeCategory
{
    /// <summary>Offensive weapons.</summary>
    Weapons,

    /// <summary>Defensive armor.</summary>
    Armor,

    /// <summary>Consumable potions and elixirs.</summary>
    Potions,

    /// <summary>Rings, amulets, and accessories.</summary>
    Jewelry,

    /// <summary>Crafting tools and utility items.</summary>
    Tools
}
```

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/ItemQuality.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Represents the quality tier of a crafted item.
/// </summary>
public enum ItemQuality
{
    /// <summary>Basic quality (★).</summary>
    Common = 1,

    /// <summary>Slightly improved quality (★★).</summary>
    Uncommon = 2,

    /// <summary>Notable quality (★★★).</summary>
    Rare = 3,

    /// <summary>Exceptional quality (★★★★).</summary>
    Epic = 4,

    /// <summary>Masterwork quality (★★★★★).</summary>
    Legendary = 5
}
```

### 9.2 New DTOs

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/DTOs/RecipeDisplayDtos.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.DTOs;

/// <summary>
/// Data transfer object for recipe browser display.
/// </summary>
/// <param name="RecipeId">The recipe's unique identifier.</param>
/// <param name="Name">The display name of the recipe.</param>
/// <param name="Description">The recipe description.</param>
/// <param name="Category">The recipe category.</param>
/// <param name="StationName">The required crafting station name.</param>
/// <param name="IsCraftable">Whether the player can craft this recipe.</param>
/// <param name="IsNew">Whether the recipe was recently discovered.</param>
public record RecipeBrowserDisplayDto(
    string RecipeId,
    string Name,
    string Description,
    RecipeCategory Category,
    string StationName,
    bool IsCraftable,
    bool IsNew);

/// <summary>
/// Data transfer object for recipe details display.
/// </summary>
/// <param name="RecipeId">The recipe's unique identifier.</param>
/// <param name="Name">The display name of the recipe.</param>
/// <param name="Description">The recipe description.</param>
/// <param name="Category">The recipe category.</param>
/// <param name="Materials">The required materials.</param>
/// <param name="OutputItemId">The ID of the output item.</param>
/// <param name="OutputItemName">The display name of the output item.</param>
/// <param name="OutputQuantity">The quantity produced.</param>
/// <param name="QualityRange">Description of possible quality range.</param>
/// <param name="ExpectedQuality">The expected quality based on player skill.</param>
/// <param name="IsCraftable">Whether the player can craft this recipe.</param>
public record RecipeDetailsDisplayDto(
    string RecipeId,
    string Name,
    string Description,
    RecipeCategory Category,
    IReadOnlyList<MaterialRequirementDto> Materials,
    string OutputItemId,
    string OutputItemName,
    int OutputQuantity,
    string QualityRange,
    ItemQuality ExpectedQuality,
    bool IsCraftable);

/// <summary>
/// Data transfer object for recipe book entry.
/// </summary>
/// <param name="RecipeId">The recipe's unique identifier.</param>
/// <param name="Name">The display name of the recipe.</param>
/// <param name="StationId">The required crafting station ID.</param>
/// <param name="StationName">The required crafting station name.</param>
/// <param name="Category">The recipe category.</param>
/// <param name="DiscoveredAt">When the recipe was discovered.</param>
public record RecipeBookEntryDto(
    string RecipeId,
    string Name,
    string StationId,
    string StationName,
    RecipeCategory Category,
    DateTime DiscoveredAt);

/// <summary>
/// Data transfer object for recipe discovery notification.
/// </summary>
/// <param name="RecipeId">The recipe's unique identifier.</param>
/// <param name="Name">The display name of the recipe.</param>
/// <param name="StationName">The required crafting station name.</param>
public record RecipeDiscoveryDto(
    string RecipeId,
    string Name,
    string StationName);

/// <summary>
/// Data transfer object for crafting result notification.
/// </summary>
/// <param name="ItemId">The crafted item's ID.</param>
/// <param name="ItemName">The crafted item's name.</param>
/// <param name="Quantity">The quantity crafted.</param>
/// <param name="Quality">The quality tier achieved.</param>
public record CraftingResultDto(
    string ItemId,
    string ItemName,
    int Quantity,
    ItemQuality Quality);

/// <summary>
/// Data transfer object for quality result display.
/// </summary>
/// <param name="Quality">The quality tier.</param>
/// <param name="QualityName">The display name of the quality.</param>
/// <param name="Stars">The star rating string.</param>
public record QualityResultDto(
    ItemQuality Quality,
    string QualityName,
    string Stars);
```

### 9.3 Quality Tier Renderer

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Renderers/QualityTierRenderer.cs`

```csharp
using RuneAndRust.Presentation.Tui.DTOs;
using RuneAndRust.Presentation.Tui.Configuration;

namespace RuneAndRust.Presentation.Tui.Renderers;

/// <summary>
/// Renders quality tier displays with star ratings.
/// </summary>
/// <remarks>
/// Provides consistent formatting for quality tiers including
/// star ratings, names, and colors.
/// </remarks>
public class QualityTierRenderer
{
    private readonly RecipeBrowserConfig _config;

    /// <summary>
    /// Creates a new instance of the QualityTierRenderer.
    /// </summary>
    /// <param name="config">Configuration for display settings.</param>
    public QualityTierRenderer(RecipeBrowserConfig config)
    {
        _config = config ?? throw new ArgumentNullException(nameof(config));
    }

    /// <summary>
    /// Formats the quality display with name and stars.
    /// </summary>
    /// <param name="quality">The quality tier.</param>
    /// <returns>The formatted quality string.</returns>
    public string FormatQuality(ItemQuality quality)
    {
        var name = GetQualityName(quality);
        var stars = GetQualityStars(quality);
        return $"{name} ({stars})";
    }

    /// <summary>
    /// Gets the star rating for a quality tier.
    /// </summary>
    /// <param name="quality">The quality tier.</param>
    /// <returns>The star rating string.</returns>
    public string GetQualityStars(ItemQuality quality)
    {
        var starCount = (int)quality;
        return new string('★', starCount);
    }

    /// <summary>
    /// Gets the display name for a quality tier.
    /// </summary>
    /// <param name="quality">The quality tier.</param>
    /// <returns>The quality name.</returns>
    public string GetQualityName(ItemQuality quality)
    {
        return quality switch
        {
            ItemQuality.Common => "COMMON",
            ItemQuality.Uncommon => "UNCOMMON",
            ItemQuality.Rare => "RARE",
            ItemQuality.Epic => "EPIC",
            ItemQuality.Legendary => "LEGENDARY",
            _ => "UNKNOWN"
        };
    }

    /// <summary>
    /// Gets the display color for a quality tier.
    /// </summary>
    /// <param name="quality">The quality tier.</param>
    /// <returns>The console color for the quality.</returns>
    public ConsoleColor GetQualityColor(ItemQuality quality)
    {
        return quality switch
        {
            ItemQuality.Common => _config.CommonQualityColor,
            ItemQuality.Uncommon => _config.UncommonQualityColor,
            ItemQuality.Rare => _config.RareQualityColor,
            ItemQuality.Epic => _config.EpicQualityColor,
            ItemQuality.Legendary => _config.LegendaryQualityColor,
            _ => ConsoleColor.White
        };
    }

    /// <summary>
    /// Creates a quality result DTO.
    /// </summary>
    /// <param name="quality">The quality tier.</param>
    /// <returns>The quality result DTO.</returns>
    public QualityResultDto CreateQualityResult(ItemQuality quality)
    {
        return new QualityResultDto(
            Quality: quality,
            QualityName: GetQualityName(quality),
            Stars: GetQualityStars(quality));
    }
}
```

---

## 10. Configuration File Schemas

### 10.1 recipe-browser.json

**File:** `config/recipe-browser.json`

```json
{
  "$schema": "./schemas/recipe-browser.schema.json",
  "browserWidth": 70,
  "browserHeight": 25,
  "detailsWidth": 55,
  "detailsHeight": 15,
  "bookWidth": 50,
  "bookHeight": 20,
  "notificationWidth": 55,
  "notificationDurationSeconds": 5,
  "searchBoxWidth": 12,
  "maxRecipesPerCategory": 6,
  "maxRecipesPerStation": 5,
  "activeFilterColor": "Cyan",
  "selectionColor": "Cyan",
  "craftableColor": "Green",
  "notCraftableColor": "Red",
  "newRecipeColor": "Yellow",
  "categoryHeaderColor": "Yellow",
  "stationHeaderColor": "DarkYellow",
  "progressBarColor": "Cyan",
  "notificationBorderColor": "Yellow",
  "notificationHighlightColor": "White",
  "sufficientMaterialColor": "Green",
  "insufficientMaterialColor": "Red",
  "commonQualityColor": "Gray",
  "uncommonQualityColor": "Green",
  "rareQualityColor": "Blue",
  "epicQualityColor": "Magenta",
  "legendaryQualityColor": "Yellow"
}
```

### 10.2 recipe-browser.schema.json

**File:** `config/schemas/recipe-browser.schema.json`

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "recipe-browser.schema.json",
  "title": "Recipe Browser Configuration",
  "description": "Configuration for recipe browser and related components",
  "type": "object",
  "properties": {
    "browserWidth": {
      "type": "integer",
      "description": "Width of the recipe browser",
      "minimum": 50,
      "maximum": 120,
      "default": 70
    },
    "browserHeight": {
      "type": "integer",
      "description": "Height of the recipe browser",
      "minimum": 15,
      "maximum": 40,
      "default": 25
    },
    "detailsWidth": {
      "type": "integer",
      "description": "Width of the recipe details panel",
      "minimum": 40,
      "maximum": 80,
      "default": 55
    },
    "detailsHeight": {
      "type": "integer",
      "description": "Height of the recipe details panel",
      "minimum": 10,
      "maximum": 25,
      "default": 15
    },
    "bookWidth": {
      "type": "integer",
      "description": "Width of the recipe book panel",
      "minimum": 40,
      "maximum": 80,
      "default": 50
    },
    "bookHeight": {
      "type": "integer",
      "description": "Height of the recipe book panel",
      "minimum": 15,
      "maximum": 35,
      "default": 20
    },
    "notificationWidth": {
      "type": "integer",
      "description": "Width of notification popups",
      "minimum": 40,
      "maximum": 80,
      "default": 55
    },
    "notificationDurationSeconds": {
      "type": "integer",
      "description": "Duration of notification display in seconds",
      "minimum": 1,
      "maximum": 30,
      "default": 5
    },
    "searchBoxWidth": {
      "type": "integer",
      "description": "Width of the search input box",
      "minimum": 8,
      "maximum": 30,
      "default": 12
    },
    "maxRecipesPerCategory": {
      "type": "integer",
      "description": "Maximum recipes shown per category before overflow",
      "minimum": 3,
      "maximum": 15,
      "default": 6
    },
    "maxRecipesPerStation": {
      "type": "integer",
      "description": "Maximum recipes shown per station in recipe book",
      "minimum": 3,
      "maximum": 10,
      "default": 5
    },
    "activeFilterColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Cyan"
    },
    "selectionColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Cyan"
    },
    "craftableColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Green"
    },
    "notCraftableColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Red"
    },
    "newRecipeColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Yellow"
    },
    "categoryHeaderColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Yellow"
    },
    "stationHeaderColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "DarkYellow"
    },
    "progressBarColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Cyan"
    },
    "notificationBorderColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Yellow"
    },
    "notificationHighlightColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "White"
    },
    "sufficientMaterialColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Green"
    },
    "insufficientMaterialColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Red"
    },
    "commonQualityColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Gray"
    },
    "uncommonQualityColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Green"
    },
    "rareQualityColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Blue"
    },
    "epicQualityColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Magenta"
    },
    "legendaryQualityColor": {
      "$ref": "#/$defs/consoleColor",
      "default": "Yellow"
    }
  },
  "$defs": {
    "consoleColor": {
      "type": "string",
      "enum": [
        "Black", "DarkBlue", "DarkGreen", "DarkCyan",
        "DarkRed", "DarkMagenta", "DarkYellow", "Gray",
        "DarkGray", "Blue", "Green", "Cyan",
        "Red", "Magenta", "Yellow", "White"
      ]
    }
  },
  "additionalProperties": false
}
```

### 10.3 Configuration Class

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Configuration/RecipeBrowserConfig.cs`

```csharp
namespace RuneAndRust.Presentation.Tui.Configuration;

/// <summary>
/// Configuration for recipe browser and related components.
/// </summary>
public class RecipeBrowserConfig
{
    /// <summary>Width of the recipe browser.</summary>
    public int BrowserWidth { get; set; } = 70;

    /// <summary>Height of the recipe browser.</summary>
    public int BrowserHeight { get; set; } = 25;

    /// <summary>Width of the recipe details panel.</summary>
    public int DetailsWidth { get; set; } = 55;

    /// <summary>Height of the recipe details panel.</summary>
    public int DetailsHeight { get; set; } = 15;

    /// <summary>Width of the recipe book panel.</summary>
    public int BookWidth { get; set; } = 50;

    /// <summary>Height of the recipe book panel.</summary>
    public int BookHeight { get; set; } = 20;

    /// <summary>Width of notification popups.</summary>
    public int NotificationWidth { get; set; } = 55;

    /// <summary>Duration of notification display in seconds.</summary>
    public int NotificationDurationSeconds { get; set; } = 5;

    /// <summary>Width of the search input box.</summary>
    public int SearchBoxWidth { get; set; } = 12;

    /// <summary>Maximum recipes shown per category.</summary>
    public int MaxRecipesPerCategory { get; set; } = 6;

    /// <summary>Maximum recipes shown per station in recipe book.</summary>
    public int MaxRecipesPerStation { get; set; } = 5;

    /// <summary>Color for active filter tab.</summary>
    public ConsoleColor ActiveFilterColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>Color for selected recipe.</summary>
    public ConsoleColor SelectionColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>Color for craftable recipe indicators.</summary>
    public ConsoleColor CraftableColor { get; set; } = ConsoleColor.Green;

    /// <summary>Color for non-craftable recipe indicators.</summary>
    public ConsoleColor NotCraftableColor { get; set; } = ConsoleColor.Red;

    /// <summary>Color for new recipe indicators.</summary>
    public ConsoleColor NewRecipeColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>Color for category headers.</summary>
    public ConsoleColor CategoryHeaderColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>Color for station headers in recipe book.</summary>
    public ConsoleColor StationHeaderColor { get; set; } = ConsoleColor.DarkYellow;

    /// <summary>Color for progress bar.</summary>
    public ConsoleColor ProgressBarColor { get; set; } = ConsoleColor.Cyan;

    /// <summary>Color for notification borders.</summary>
    public ConsoleColor NotificationBorderColor { get; set; } = ConsoleColor.Yellow;

    /// <summary>Color for notification highlight text.</summary>
    public ConsoleColor NotificationHighlightColor { get; set; } = ConsoleColor.White;

    /// <summary>Color for sufficient material indicators.</summary>
    public ConsoleColor SufficientMaterialColor { get; set; } = ConsoleColor.Green;

    /// <summary>Color for insufficient material indicators.</summary>
    public ConsoleColor InsufficientMaterialColor { get; set; } = ConsoleColor.Red;

    /// <summary>Color for common quality tier.</summary>
    public ConsoleColor CommonQualityColor { get; set; } = ConsoleColor.Gray;

    /// <summary>Color for uncommon quality tier.</summary>
    public ConsoleColor UncommonQualityColor { get; set; } = ConsoleColor.Green;

    /// <summary>Color for rare quality tier.</summary>
    public ConsoleColor RareQualityColor { get; set; } = ConsoleColor.Blue;

    /// <summary>Color for epic quality tier.</summary>
    public ConsoleColor EpicQualityColor { get; set; } = ConsoleColor.Magenta;

    /// <summary>Color for legendary quality tier.</summary>
    public ConsoleColor LegendaryQualityColor { get; set; } = ConsoleColor.Yellow;
}
```

---

## 11. Inventory Integration

### 11.1 Integration Points

**File:** `src/Presentation/RuneAndRust.Presentation.Tui/Views/InventoryView.cs` (modifications)

```csharp
// Add to InventoryView class

private readonly RecipeBrowser _recipeBrowser;
private readonly RecipeDetails _recipeDetails;
private readonly RecipeBook _recipeBook;

/// <summary>
/// Handles the recipes tab display.
/// </summary>
private void HandleRecipesTab()
{
    var player = _gameState.CurrentPlayer;
    if (player == null)
    {
        _logger.LogWarning("Cannot show recipes - no current player");
        return;
    }

    // Get discovered recipes
    var recipes = _craftingService.GetDiscoveredRecipes(player);

    // Convert to display DTOs
    var displayDtos = ConvertToRecipeBrowserDtos(recipes, player);

    // Render recipe browser
    _recipeBrowser.SetPosition(_config.RecipeBrowserX, _config.RecipeBrowserY);
    _recipeBrowser.RenderRecipes(displayDtos);

    _logger.LogDebug("Rendered recipes tab with {Count} recipes", displayDtos.Count);
}

/// <summary>
/// Converts recipe definitions to browser display DTOs.
/// </summary>
private IReadOnlyList<RecipeBrowserDisplayDto> ConvertToRecipeBrowserDtos(
    IEnumerable<RecipeDefinition> recipes,
    Player player)
{
    return recipes.Select(r => new RecipeBrowserDisplayDto(
        RecipeId: r.Id,
        Name: r.Name,
        Description: r.Description,
        Category: MapToRecipeCategory(r.Category),
        StationName: r.StationTypeRequired,
        IsCraftable: _craftingService.CanCraft(player, r.Id),
        IsNew: _recipeBook.IsNewRecipe(r.Id)
    )).ToList();
}

/// <summary>
/// Handles recipe selection from the browser.
/// </summary>
private void HandleRecipeSelected(object? sender, RecipeBrowserDisplayDto recipe)
{
    var player = _gameState.CurrentPlayer;
    if (player == null) return;

    // Get full recipe details
    var recipeDefinition = _craftingService.GetRecipe(recipe.RecipeId);
    if (recipeDefinition == null) return;

    // Convert to details DTO
    var detailsDto = ConvertToRecipeDetailsDto(recipeDefinition, player);

    // Show recipe details
    _recipeDetails.SetPosition(_config.RecipeDetailsX, _config.RecipeDetailsY);
    _recipeDetails.RenderRecipe(detailsDto);
}

/// <summary>
/// Maps a category string to the RecipeCategory enum.
/// </summary>
private static RecipeCategory MapToRecipeCategory(string category)
{
    return category?.ToLowerInvariant() switch
    {
        "weapon" or "weapons" => RecipeCategory.Weapons,
        "armor" => RecipeCategory.Armor,
        "potion" or "potions" => RecipeCategory.Potions,
        "jewelry" => RecipeCategory.Jewelry,
        "tool" or "tools" => RecipeCategory.Tools,
        _ => RecipeCategory.Tools
    };
}
```

---

## 12. Logging Specifications

### 12.1 Log Levels by Component

| Component | Level | Events |
|-----------|-------|--------|
| `RecipeBrowser` | Information | Browser opened |
| `RecipeBrowser` | Debug | Search applied, filter changed, recipe selected |
| `RecipeBrowser` | Warning | No recipes found |
| `RecipeDetails` | Debug | Details rendered, quality shown |
| `RecipeBook` | Information | Recipe book opened |
| `RecipeBook` | Debug | New recipe highlighted, station filter applied |
| `RecipeDiscoveryNotification` | Information | Recipe discovered |
| `RecipeDiscoveryNotification` | Debug | Notification shown/hidden |
| `CraftingResultNotification` | Information | Crafting complete |
| `CraftingResultNotification` | Debug | Notification shown/hidden |
| `QualityTierRenderer` | Debug | Quality formatted |
| `RecipesCommand` | Information | Command executed |

### 12.2 Log Message Examples

```
[INF] RecipeBrowser: Opened recipe browser with 35 recipes
[DBG] RecipeBrowser: Search applied: 'steel', 3 results
[DBG] RecipeBrowser: Category filter applied: Weapons
[DBG] RecipeBrowser: Selected recipe: Steel Blade
[DBG] RecipeDetails: Rendered details for recipe: Steel Blade
[INF] RecipeBook: Opened recipe book with 12 discovered recipes
[DBG] RecipeBook: Marked recipe as new: steel-blade
[DBG] RecipeBook: Station filter applied: Blacksmith Forge
[INF] RecipeDiscoveryNotification: Recipe discovered: Steel Blade
[DBG] RecipeDiscoveryNotification: Recipe discovery notification hidden
[INF] CraftingResultNotification: Crafting complete: Steel Blade with quality Rare
[INF] RecipesCommand: Opened recipe browser with 35 recipes
```

---

## 13. Unit Testing Requirements

### 13.1 Test Count by Feature

| Feature | Test Count |
|---------|------------|
| RecipeBrowser | ~2 |
| QualityTierRenderer | ~2 |
| RecipeBook | ~2 |
| **Total** | **~6** |

### 13.2 Test Specifications

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/RecipeBrowserTests.cs`

```csharp
[TestFixture]
public class RecipeBrowserTests
{
    private Mock<ICraftingService> _mockCraftingService;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<ILogger<RecipeBrowser>> _mockLogger;
    private RecipeBrowserConfig _config;
    private RecipeBrowser _browser;

    [SetUp]
    public void Setup()
    {
        _config = new RecipeBrowserConfig();
        _mockCraftingService = new Mock<ICraftingService>();
        _mockTerminal = new Mock<ITerminalService>();
        _mockLogger = new Mock<ILogger<RecipeBrowser>>();

        _browser = new RecipeBrowser(
            _mockCraftingService.Object,
            _mockTerminal.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    public void Search_WithMatchingText_FiltersRecipes()
    {
        // Arrange
        var recipes = new List<RecipeBrowserDisplayDto>
        {
            CreateRecipeDto("steel-blade", "Steel Blade", RecipeCategory.Weapons),
            CreateRecipeDto("iron-sword", "Iron Sword", RecipeCategory.Weapons),
            CreateRecipeDto("health-potion", "Health Potion", RecipeCategory.Potions)
        };

        _browser.SetPosition(0, 0);
        _browser.RenderRecipes(recipes);

        // Act
        var results = _browser.Search("steel");

        // Assert
        Assert.That(results.Count(), Is.EqualTo(1));
        Assert.That(results.First().Name, Is.EqualTo("Steel Blade"));
    }

    [Test]
    public void FilterByCategory_WithCategory_FiltersRecipes()
    {
        // Arrange
        var recipes = new List<RecipeBrowserDisplayDto>
        {
            CreateRecipeDto("steel-blade", "Steel Blade", RecipeCategory.Weapons),
            CreateRecipeDto("iron-shield", "Iron Shield", RecipeCategory.Armor),
            CreateRecipeDto("health-potion", "Health Potion", RecipeCategory.Potions)
        };

        _browser.SetPosition(0, 0);
        _browser.RenderRecipes(recipes);

        // Act
        _browser.FilterByCategory(RecipeCategory.Weapons);

        // Assert
        Assert.That(_browser.ActiveCategory, Is.EqualTo(RecipeCategory.Weapons));
    }

    #region Test Helpers

    private static RecipeBrowserDisplayDto CreateRecipeDto(
        string id, string name, RecipeCategory category)
    {
        return new RecipeBrowserDisplayDto(
            RecipeId: id,
            Name: name,
            Description: "Test description",
            Category: category,
            StationName: "Test Station",
            IsCraftable: true,
            IsNew: false);
    }

    #endregion
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/Renderers/QualityTierRendererTests.cs`

```csharp
[TestFixture]
public class QualityTierRendererTests
{
    private RecipeBrowserConfig _config;
    private QualityTierRenderer _renderer;

    [SetUp]
    public void Setup()
    {
        _config = new RecipeBrowserConfig();
        _renderer = new QualityTierRenderer(_config);
    }

    [Test]
    [TestCase(ItemQuality.Common, "★")]
    [TestCase(ItemQuality.Uncommon, "★★")]
    [TestCase(ItemQuality.Rare, "★★★")]
    [TestCase(ItemQuality.Epic, "★★★★")]
    [TestCase(ItemQuality.Legendary, "★★★★★")]
    public void GetQualityStars_WithQuality_ReturnsCorrectStars(
        ItemQuality quality, string expectedStars)
    {
        // Act
        var result = _renderer.GetQualityStars(quality);

        // Assert
        Assert.That(result, Is.EqualTo(expectedStars));
    }

    [Test]
    [TestCase(ItemQuality.Common, "COMMON")]
    [TestCase(ItemQuality.Rare, "RARE")]
    [TestCase(ItemQuality.Legendary, "LEGENDARY")]
    public void GetQualityName_WithQuality_ReturnsCorrectName(
        ItemQuality quality, string expectedName)
    {
        // Act
        var result = _renderer.GetQualityName(quality);

        // Assert
        Assert.That(result, Is.EqualTo(expectedName));
    }
}
```

**File:** `tests/RuneAndRust.Presentation.Tui.Tests/UI/RecipeBookTests.cs`

```csharp
[TestFixture]
public class RecipeBookTests
{
    private Mock<ICraftingService> _mockCraftingService;
    private Mock<ITerminalService> _mockTerminal;
    private Mock<ILogger<RecipeBook>> _mockLogger;
    private RecipeBrowserConfig _config;
    private RecipeBook _book;

    [SetUp]
    public void Setup()
    {
        _config = new RecipeBrowserConfig();
        _mockCraftingService = new Mock<ICraftingService>();
        _mockTerminal = new Mock<ITerminalService>();
        _mockLogger = new Mock<ILogger<RecipeBook>>();

        _mockCraftingService.Setup(s => s.GetTotalRecipeCount())
            .Returns(35);

        _book = new RecipeBook(
            _mockCraftingService.Object,
            _mockTerminal.Object,
            _config,
            _mockLogger.Object);
    }

    [Test]
    public void HighlightNew_WithRecipeId_AddsToNewSet()
    {
        // Act
        _book.HighlightNew("steel-blade");

        // Assert - No exception thrown, recipe is tracked
        // (Internal state verification through behavior)
    }

    [Test]
    public void FilterByStation_WithStationId_SetsFilter()
    {
        // Act
        _book.FilterByStation("blacksmith-forge");

        // Assert
        Assert.That(_book.StationFilter, Is.EqualTo("blacksmith-forge"));
    }
}
```

---

## 14. Use Cases

### UC-001: Browse All Recipes

**Actor:** Player
**Flow:** Open inventory → Navigate to Recipes tab → View all discovered recipes → Use search to find specific recipe → Select recipe for details

### UC-002: Filter Recipes by Category

**Actor:** Player
**Flow:** Open recipe browser → Press Tab to cycle categories → View filtered recipes → Find armor recipes → Select recipe to view details

### UC-003: View Recipe Details

**Actor:** Player
**Flow:** Select recipe in browser → View material requirements → See owned quantities → View expected output and quality range → Decide to craft or gather materials

### UC-004: Discover New Recipe

**Actor:** Player
**Flow:** Complete quest or learn recipe → Notification popup shows → Recipe added to book → Recipe marked as "NEW" in browser → View recipe details

### UC-005: View Crafting Result

**Actor:** Player
**Flow:** Complete crafting → Result notification shows → See crafted item name → See quality tier with star rating → Item added to inventory

### UC-006: Track Recipe Progress

**Actor:** Player
**Flow:** Open recipe book → View discovery progress bar → See discovered/total count → Filter by station → Plan which recipes to unlock next

---

## 15. Deliverable Checklist

### UI Components
- [ ] `RecipeBrowser` class implemented
- [ ] `RenderRecipes()` method displays recipes
- [ ] `Search()` method filters by name
- [ ] `FilterByCategory()` method filters by category
- [ ] `SelectRecipe()` method handles selection
- [ ] `RecipeDetails` class implemented
- [ ] `RenderRecipe()` method displays recipe info
- [ ] `ShowMaterials()` method displays requirements
- [ ] `ShowExpectedOutput()` method displays output
- [ ] `ShowQualityResult()` method displays quality
- [ ] `RecipeBook` class implemented
- [ ] `RenderDiscoveredRecipes()` method displays collection
- [ ] `ShowUnlockProgress()` method displays progress
- [ ] `HighlightNew()` method marks new recipes
- [ ] `FilterByStation()` method filters by station

### Notifications
- [ ] `RecipeDiscoveryNotification` class implemented
- [ ] `ShowDiscovery()` method displays notification
- [ ] `GetDuration()` returns 5 seconds
- [ ] Auto-dismiss functionality working
- [ ] `CraftingResultNotification` class implemented
- [ ] `ShowResult()` method displays notification
- [ ] `ShowQualityTier()` method displays stars
- [ ] Auto-dismiss functionality working

### Renderers
- [ ] `QualityTierRenderer` class implemented
- [ ] `GetQualityStars()` returns correct stars
- [ ] `GetQualityName()` returns correct names
- [ ] `GetQualityColor()` returns correct colors

### Commands
- [ ] `RecipesCommand` class implemented
- [ ] Opens recipe browser
- [ ] Supports category argument

### DTOs
- [ ] `RecipeCategory` enum created
- [ ] `ItemQuality` enum created
- [ ] `RecipeBrowserDisplayDto` record created
- [ ] `RecipeDetailsDisplayDto` record created
- [ ] `RecipeBookEntryDto` record created
- [ ] `RecipeDiscoveryDto` record created
- [ ] `CraftingResultDto` record created
- [ ] `QualityResultDto` record created

### Configuration
- [ ] `RecipeBrowserConfig` class created
- [ ] `config/recipe-browser.json` created
- [ ] `config/schemas/recipe-browser.schema.json` created

### View Integration
- [ ] `InventoryView` updated with `HandleRecipesTab()`
- [ ] Recipe browser integration
- [ ] Recipe details integration
- [ ] Recipe selection handling

### Testing
- [ ] ~6 unit tests implemented
- [ ] All tests passing

---

## 16. Acceptance Criteria

### Functional
- [ ] Recipe browser displays all discovered recipes
- [ ] Search filters recipes by name (substring matching)
- [ ] Category filter tabs work correctly
- [ ] Recipe details show materials and output
- [ ] Material requirements show owned vs needed quantities
- [ ] Quality display uses star rating format (★★★)
- [ ] Recipe book shows discovered recipes
- [ ] Recipe book shows unlock progress (discovered/total)
- [ ] New recipe notification displays on discovery
- [ ] Notification auto-dismisses after 5 seconds
- [ ] Crafting result shows quality tier with stars
- [ ] Recipe command opens browser with optional category filter

### Quality
- [ ] Build succeeds with 0 errors/warnings
- [ ] All ~6 unit tests pass
- [ ] Configuration file validates against schema
- [ ] XML documentation complete on all public members
- [ ] No hardcoded values (all configurable)

---

## 17. Dependencies

### Required from v0.11.x

| Type | Location | Usage in v0.13.3c |
|------|----------|-------------------|
| `ICraftingService` | `Application/Interfaces/` | Get recipes, discovery status |
| `IResourceService` | `Application/Interfaces/` | Get player resources |
| `RecipeDefinition` | `Domain/Entities/` | Recipe data |
| `RecipeMaterial` | `Domain/ValueObjects/` | Material requirements |
| `CraftingResult` | `Domain/ValueObjects/` | Crafting outcome |

### Required from v0.13.3a

| Type | Location | Usage in v0.13.3c |
|------|----------|-------------------|
| `ResourceStackDisplayDto` | `Presentation.Tui/DTOs/` | Resource display |
| `ResourceCategory` | `Presentation.Tui/DTOs/` | Category mapping |

### Required from v0.13.3b

| Type | Location | Usage in v0.13.3c |
|------|----------|-------------------|
| `MaterialRequirementDto` | `Presentation.Tui/DTOs/` | Material display |
| `CraftingProgressRenderer` | `Presentation.Tui/Renderers/` | Shared rendering |

### Required from Existing Infrastructure

| Type | Location | Usage in v0.13.3c |
|------|----------|-------------------|
| `ITerminalService` | `Presentation.Tui/Services/` | Terminal output |
| `InventoryView` | `Presentation.Tui/Views/` | Integration point |
| `Player` | `Domain/Entities/` | Player data |

### Provides to v0.13.3d

| Type | Usage |
|------|-------|
| `QualityTierRenderer` | Shared quality display utilities |
| `RecipeCategory` enum | Category organization |

---

## 18. Future Considerations

### Deferred to v0.13.3d

- **Gathering Display**: Harvestable resource indicators
- **Dice Check Display**: Gathering roll visualization
- **Yield Display**: Gathered resource feedback

### Out of Scope

- **Recipe Favorites**: Pin frequently used recipes
- **Recipe Comparison**: Compare recipes side by side
- **Recipe Sorting**: Sort by name, difficulty, materials
- **Recipe History**: Track recently viewed recipes
- **Recipe Sharing**: Share recipes with other players
- **Recipe Upgrades**: Improve recipe quality over time
- **Recipe Variants**: Alternative versions of recipes

### Potential Enhancements (Future Versions)

- **Recipe Preview**: 3D preview of crafted item
- **Material Shortcuts**: Quick navigation to material sources
- **Crafting Queue Integration**: Queue recipes from browser
- **Recipe Achievements**: Unlock achievements for discoveries
- **Recipe Statistics**: Track crafting success rates
- **Recipe Recommendations**: Suggest recipes based on materials

---

*Document Version: 1.0*
*Last Updated: 2026-01-16*
*Author: Claude (AI Assistant)*
