# v0.16.0d - Loot Service Integration

**Release Date:** 2026-01-28

## Summary

Integrates the quality tier system (v0.16.0a-c) into the loot service by enhancing value objects with tier tracking and adding new interface methods for tiered loot generation.

## Added

### Value Objects (Domain)

| Value Object              | Purpose                                            |
| ------------------------- | -------------------------------------------------- |
| `MonsterDropClassMapping` | Maps monster types to drop classes and drop counts |

### Interfaces (Application)

| Interface                   | Purpose                                        |
| --------------------------- | ---------------------------------------------- |
| `IMonsterDropClassProvider` | Provides monster-to-drop-class mapping lookups |

### ILootService Methods

| Method                   | Purpose                                           |
| ------------------------ | ------------------------------------------------- |
| `GenerateTieredLoot`     | Generates tier-aware loot from defeated monsters  |
| `GenerateItemForTier`    | Creates a single item for a specific quality tier |
| `GetDropClassForMonster` | Gets the drop class for a monster entity          |

## Changed

### DroppedItem (Enhanced)

New properties added:

- `QualityTier` - The quality tier of the item (Tier 0-4)
- `AttributeBonus` - Optional attribute bonus value
- `BonusAttribute` - The attribute receiving the bonus
- `FormattedName` - Display name with tier prefix and bonus suffix
- `HasAttributeBonus` - Whether the item has an attribute bonus
- `IsLegendary` - Whether the item is Myth-Forged tier
- `TierValue` - Numeric tier value (0-4)

New factory methods:

- `CreateWeapon` - Creates a tiered weapon item
- `CreateArmor` - Creates a tiered armor item

### LootDrop (Enhanced)

New properties added:

- `HighestTier` - The highest quality tier among all items
- `HasMythForged` - Whether any Myth-Forged items dropped
- `TierCounts` - Count of items per quality tier
- `SourceMonster` - The monster that generated this loot
- `TotalItems` - Total number of items dropped

Updated factory method:

- `Create` - Now auto-calculates tier statistics from items

## Key Features

### Tiered Loot Generation

1. Monster drop class determines tier probability distribution
2. Higher drop classes (Elite, MiniBoss, Boss) have better tier chances
3. Tier 2+ items receive attribute bonuses
4. Loot aggregation tracks tier statistics

### Monster Drop Class Mapping

| Drop Class | Tier Distribution               | Drop Count |
| ---------- | ------------------------------- | ---------- |
| Trash      | Primarily Tier 0-1, 10% empty   | 0-1        |
| Standard   | Guaranteed, up to Tier 3        | 1          |
| Elite      | Guaranteed, small Tier 4 chance | 1-2        |
| MiniBoss   | Tier 2+, 30% Tier 4 chance      | 2          |
| Boss       | Always Tier 3-4, 70% Tier 4     | 3+         |

### FormattedName Display

Format: `[TierName] ItemName +Bonus ATTR`

Examples:

- `[Jury-Rigged] Rusty Dagger`
- `[Clan-Forged] Iron Sword +2 MIG`
- `[Myth-Forged] Ragnarok Blade +5 FIN`

## Tests Added

| Test Class                     | Test Count |
| ------------------------------ | ---------- |
| `DroppedItemTierTests`         | 15 tests   |
| `LootDropTierTests`            | 14 tests   |
| `MonsterDropClassMappingTests` | 18 tests   |

## Dependencies

### Internal Dependencies

- **v0.16.0a**: `QualityTier` enum
- **v0.16.0b**: `ITierScalingService`, `WeaponTierScaling`, `ArmorTierScaling`
- **v0.16.0c**: `EnemyDropClass` enum, `IDropTableProvider`

## Related Design Specification

- [v0.16.0d Design Specification](../design/v0.16.x/v0.16.0d-design-specification.md)
